function v4(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(i,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const kT=!1;var $M=Array.isArray,y4=Array.prototype.indexOf,vw=Array.from,rR=Object.defineProperty,_g=Object.getOwnPropertyDescriptor,sR=Object.getOwnPropertyDescriptors,b4=Object.prototype,x4=Array.prototype,VM=Object.getPrototypeOf,RA=Object.isExtensible;const ls=()=>{};function w4(n){return n()}function DT(n){for(var e=0;e<n.length;e++)n[e]()}function oR(){var n,e,t=new Promise((i,r)=>{n=i,e=r});return{promise:t,resolve:n,reject:e}}function el(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const i of n)if(t.push(i),t.length===e)break;return t}const _o=2,UM=4,yw=8,S4=1<<24,Ih=16,Lh=32,mp=64,bw=128,wc=512,Lo=1024,ba=2048,du=4096,nl=8192,fh=16384,jM=32768,sp=65536,kA=1<<17,GM=1<<18,Hg=1<<19,aR=1<<20,hh=1<<25,op=32768,FT=1<<21,qM=1<<22,Md=1<<23,ph=Symbol("$state"),T4=Symbol("legacy props"),M4=Symbol(""),hg=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function HM(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function C4(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function E4(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function A4(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function P4(n){throw new Error("https://svelte.dev/e/effect_orphan")}function I4(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function L4(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function R4(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function k4(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function D4(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function F4(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const O4=1,z4=2,lR=4,B4=8,N4=16,$4=1,V4=2,U4=4,j4=8,G4=16,q4=1,H4=2,Ao=Symbol(),W4="http://www.w3.org/1999/xhtml";function Z4(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function X4(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function cR(n){return n===this.v}function uR(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function hR(n){return!uR(n,this.v)}let Wg=!1,Y4=!1;function K4(){Wg=!0}let Ur=null;function Eg(n){Ur=n}function Zg(n){return dR().get(n)}function Xg(n,e){return dR().set(n,e),e}function en(n,e=!1,t){Ur={p:Ur,i:!1,c:null,e:null,s:n,x:null,l:Wg&&!e?{s:null,u:null,$:[]}:null}}function tn(n){var e=Ur,t=e.e;if(t!==null){e.e=null;for(var i of t)PR(i)}return n!==void 0&&(e.x=n),e.i=!0,Ur=e.p,n??{}}function Yg(){return!Wg||Ur!==null&&Ur.l===null}function dR(n){return Ur===null&&HM(),Ur.c??=new Map(J4(Ur)||void 0)}function J4(n){let e=n.p;for(;e!==null;){const t=e.c;if(t!==null)return t;e=e.p}return null}let qf=[];function fR(){var n=qf;qf=[],DT(n)}function Rd(n){if(qf.length===0&&!jv){var e=qf;queueMicrotask(()=>{e===qf&&fR()})}qf.push(n)}function Q4(){for(;qf.length>0;)fR()}function pR(n){var e=ir;if(e===null)return Dn.f|=Md,n;if((e.f&jM)===0){if((e.f&bw)===0)throw n;e.b.error(n)}else Ag(n,e)}function Ag(n,e){for(;e!==null;){if((e.f&bw)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const cb=new Set;let Bn=null,Uv=null,kl=null,Il=[],xw=null,OT=!1,jv=!1;class iu{committed=!1;current=new Map;previous=new Map;#t=new Set;#e=new Set;#i=0;#n=0;#s=null;#r=new Set;#o=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){Il=[],Uv=null,this.apply();var t={parent:null,effect:null,effects:[],render_effects:[]};for(const i of e)this.#a(i,t);this.is_fork||this.#u(),this.is_deferred()?(this.#l(t.effects),this.#l(t.render_effects)):(Uv=this,Bn=null,DA(t.render_effects),DA(t.effects),Uv=null,this.#s?.resolve()),kl=null}#a(e,t){e.f^=Lo;for(var i=e.first;i!==null;){var r=i.f,o=(r&(Lh|mp))!==0,c=o&&(r&Lo)!==0,s=c||(r&nl)!==0||this.skipped_effects.has(i);if((i.f&bw)!==0&&i.b?.is_pending()&&(t={parent:t,effect:i,effects:[],render_effects:[]}),!s&&i.fn!==null){o?i.f^=Lo:(r&UM)!==0?t.effects.push(i):qy(i)&&((i.f&Ih)!==0&&this.#r.add(i),hy(i));var f=i.first;if(f!==null){i=f;continue}}var p=i.parent;for(i=i.next;i===null&&p!==null;)p===t.effect&&(this.#l(t.effects),this.#l(t.render_effects),t=t.parent),i=p.next,p=p.parent}}#l(e){for(const t of e)(t.f&ba)!==0?this.#r.add(t):(t.f&du)!==0&&this.#o.add(t),this.#c(t.deps),ko(t,Lo)}#c(e){if(e!==null)for(const t of e)(t.f&_o)===0||(t.f&op)===0||(t.f^=op,this.#c(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&Md)===0&&(this.current.set(e,e.v),kl?.set(e,e.v))}activate(){Bn=this,this.apply()}deactivate(){Bn===this&&(Bn=null,kl=null)}flush(){if(this.activate(),Il.length>0){if(mR(),Bn!==null&&Bn!==this)return}else this.#i===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#e)e(this);this.#e.clear()}#u(){if(this.#n===0){for(const e of this.#t)e();this.#t.clear()}this.#i===0&&this.#h()}#h(){if(cb.size>1){this.previous.clear();var e=kl,t=!0,i={parent:null,effect:null,effects:[],render_effects:[]};for(const o of cb){if(o===this){t=!1;continue}const c=[];for(const[f,p]of this.current){if(o.current.has(f))if(t&&p!==o.current.get(f))o.current.set(f,p);else continue;c.push(f)}if(c.length===0)continue;const s=[...o.current.keys()].filter(f=>!this.current.has(f));if(s.length>0){var r=Il;Il=[];const f=new Set,p=new Map;for(const g of c)gR(g,s,f,p);if(Il.length>0){Bn=o,o.apply();for(const g of Il)o.#a(g,i);o.deactivate()}Il=r}}Bn=null,kl=e}this.committed=!0,cb.delete(this)}increment(e){this.#i+=1,e&&(this.#n+=1)}decrement(e){this.#i-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)this.#o.delete(e),ko(e,ba),ap(e);for(const e of this.#o)ko(e,du),ap(e);this.flush()}oncommit(e){this.#t.add(e)}ondiscard(e){this.#e.add(e)}settled(){return(this.#s??=oR()).promise}static ensure(){if(Bn===null){const e=Bn=new iu;cb.add(Bn),jv||iu.enqueue(()=>{Bn===e&&e.flush()})}return Bn}static enqueue(e){Rd(e)}apply(){}}function e$(n){var e=jv;jv=!0;try{for(var t;;){if(Q4(),Il.length===0&&(Bn?.flush(),Il.length===0))return xw=null,t;mR()}}finally{jv=e}}function mR(){var n=Yf;OT=!0;var e=null;try{var t=0;for(Lx(!0);Il.length>0;){var i=iu.ensure();if(t++>1e3){var r,o;t$()}i.process(Il),Cd.clear()}}finally{OT=!1,Lx(n),xw=null}}function t$(){try{I4()}catch(n){Ag(n,xw)}}let lh=null;function DA(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var i=n[t++];if((i.f&(fh|nl))===0&&qy(i)&&(lh=new Set,hy(i),i.deps===null&&i.first===null&&i.nodes===null&&(i.teardown===null&&i.ac===null?RR(i):i.fn=null),lh?.size>0)){Cd.clear();for(const r of lh){if((r.f&(fh|nl))!==0)continue;const o=[r];let c=r.parent;for(;c!==null;)lh.has(c)&&(lh.delete(c),o.push(c)),c=c.parent;for(let s=o.length-1;s>=0;s--){const f=o[s];(f.f&(fh|nl))===0&&hy(f)}}lh.clear()}}lh=null}}function gR(n,e,t,i){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const r of n.reactions){const o=r.f;(o&_o)!==0?gR(r,e,t,i):(o&(qM|Ih))!==0&&(o&ba)===0&&_R(r,e,i)&&(ko(r,ba),ap(r))}}function _R(n,e,t){const i=t.get(n);if(i!==void 0)return i;if(n.deps!==null)for(const r of n.deps){if(e.includes(r))return!0;if((r.f&_o)!==0&&_R(r,e,t))return t.set(r,!0),!0}return t.set(n,!1),!1}function ap(n){for(var e=xw=n;e.parent!==null;){e=e.parent;var t=e.f;if(OT&&e===ir&&(t&Ih)!==0&&(t&GM)===0)return;if((t&(mp|Lh))!==0){if((t&Lo)===0)return;e.f^=Lo}}Il.push(e)}function i$(n){let e=0,t=xh(0),i;return()=>{cy()&&(ee(t),Gy(()=>(e===0&&(i=ys(()=>n(()=>Ka(t)))),e+=1,()=>{Rd(()=>{e-=1,e===0&&(i?.(),i=void 0,Ka(t))})})))}}var n$=sp|Hg|bw;function r$(n,e,t){new s$(n,e,t)}class s${parent;#t=!1;#e;#i=null;#n;#s;#r;#o=null;#a=null;#l=null;#c=null;#u=null;#h=0;#d=0;#p=!1;#f=null;#y=i$(()=>(this.#f=xh(this.#h),()=>{this.#f=null}));constructor(e,t,i){this.#e=e,this.#n=t,this.#s=i,this.parent=ir.b,this.#t=!!this.#n.pending,this.#r=Kg(()=>{ir.b=this;{var r=this.#_();try{this.#o=Ll(()=>i(r))}catch(o){this.error(o)}this.#d>0?this.#g():this.#t=!1}return()=>{this.#u?.remove()}},n$)}#b(){try{this.#o=Ll(()=>this.#s(this.#e))}catch(e){this.error(e)}this.#t=!1}#x(){const e=this.#n.pending;e&&(this.#a=Ll(()=>e(this.#e)),iu.enqueue(()=>{var t=this.#_();this.#o=this.#m(()=>(iu.ensure(),Ll(()=>this.#s(t)))),this.#d>0?this.#g():(Xf(this.#a,()=>{this.#a=null}),this.#t=!1)}))}#_(){var e=this.#e;return this.#t&&(this.#u=au(),this.#e.before(this.#u),e=this.#u),e}is_pending(){return this.#t||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#m(e){var t=ir,i=Dn,r=Ur;fu(this.#r),va(this.#r),Eg(this.#r.ctx);try{return e()}catch(o){return pR(o),null}finally{fu(t),va(i),Eg(r)}}#g(){const e=this.#n.pending;this.#o!==null&&(this.#c=document.createDocumentFragment(),this.#c.append(this.#u),FR(this.#o,this.#c)),this.#a===null&&(this.#a=Ll(()=>e(this.#e)))}#v(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#v(e);return}this.#d+=e,this.#d===0&&(this.#t=!1,this.#a&&Xf(this.#a,()=>{this.#a=null}),this.#c&&(this.#e.before(this.#c),this.#c=null))}update_pending_count(e){this.#v(e),this.#h+=e,this.#f&&Pg(this.#f,this.#h)}get_effect_pending(){return this.#y(),ee(this.#f)}error(e){var t=this.#n.onerror;let i=this.#n.failed;if(this.#p||!t&&!i)throw e;this.#o&&(ya(this.#o),this.#o=null),this.#a&&(ya(this.#a),this.#a=null),this.#l&&(ya(this.#l),this.#l=null);var r=!1,o=!1;const c=()=>{if(r){X4();return}r=!0,o&&F4(),iu.ensure(),this.#h=0,this.#l!==null&&Xf(this.#l,()=>{this.#l=null}),this.#t=this.has_pending_snippet(),this.#o=this.#m(()=>(this.#p=!1,Ll(()=>this.#s(this.#e)))),this.#d>0?this.#g():this.#t=!1};var s=Dn;try{va(null),o=!0,t?.(e,c),o=!1}catch(f){Ag(f,this.#r&&this.#r.parent)}finally{va(s)}i&&Rd(()=>{this.#l=this.#m(()=>{iu.ensure(),this.#p=!0;try{return Ll(()=>{i(this.#e,()=>e,()=>c)})}catch(f){return Ag(f,this.#r.parent),null}finally{this.#p=!1}})})}}function o$(n,e,t,i){const r=Yg()?Vy:WM;if(t.length===0&&n.length===0){i(e.map(r));return}var o=Bn,c=ir,s=a$();function f(){Promise.all(t.map(p=>l$(p))).then(p=>{s();try{i([...e.map(r),...p])}catch(g){(c.f&fh)===0&&Ag(g,c)}o?.deactivate(),Px()}).catch(p=>{Ag(p,c)})}n.length>0?Promise.all(n).then(()=>{s();try{return f()}finally{o?.deactivate(),Px()}}):f()}function a$(){var n=ir,e=Dn,t=Ur,i=Bn;return function(o=!0){fu(n),va(e),Eg(t),o&&i?.activate()}}function Px(){fu(null),va(null),Eg(null)}function Vy(n){var e=_o|ba,t=Dn!==null&&(Dn.f&_o)!==0?Dn:null;return ir!==null&&(ir.f|=Hg),{ctx:Ur,deps:null,effects:null,equals:cR,f:e,fn:n,reactions:null,rv:0,v:Ao,wv:0,parent:t??ir,ac:null}}function l$(n,e){let t=ir;t===null&&C4();var i=t.b,r=void 0,o=xh(Ao),c=!Dn,s=new Map;return g$(()=>{var f=oR();r=f.promise;try{Promise.resolve(n()).then(f.resolve,f.reject).then(()=>{p===Bn&&p.committed&&p.deactivate(),Px()})}catch(x){f.reject(x),Px()}var p=Bn;if(c){var g=!i.is_pending();i.update_pending_count(1),p.increment(g),s.get(p)?.reject(hg),s.delete(p),s.set(p,f)}const _=(x,b=void 0)=>{if(p.activate(),b)b!==hg&&(o.f|=Md,Pg(o,b));else{(o.f&Md)!==0&&(o.f^=Md),Pg(o,x);for(const[M,P]of s){if(s.delete(M),M===p)break;P.reject(hg)}}c&&(i.update_pending_count(-1),p.decrement(g))};f.promise.then(_,x=>_(null,x||"unknown"))}),jy(()=>{for(const f of s.values())f.reject(hg)}),new Promise(f=>{function p(g){function _(){g===r?f(o):p(r)}g.then(_,_)}p(r)})}function Kt(n){const e=Vy(n);return OR(e),e}function WM(n){const e=Vy(n);return e.equals=hR,e}function vR(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)ya(e[t])}}function c$(n){for(var e=n.parent;e!==null;){if((e.f&_o)===0)return(e.f&fh)===0?e:null;e=e.parent}return null}function ZM(n){var e,t=ir;fu(c$(n));try{n.f&=~op,vR(n),e=$R(n)}finally{fu(t)}return e}function yR(n){var e=ZM(n);if(n.equals(e)||(Bn?.is_fork||(n.v=e),n.wv=BR()),!gp)if(kl!==null)(cy()||Bn?.is_fork)&&kl.set(n,e);else{var t=(n.f&wc)===0?du:Lo;ko(n,t)}}let zT=new Set;const Cd=new Map;let bR=!1;function xh(n,e){var t={f:0,v:n,reactions:null,equals:cR,rv:0,wv:0};return t}function ii(n,e){const t=xh(n);return OR(t),t}function xR(n,e=!1,t=!0){const i=xh(n);return e||(i.equals=hR),Wg&&t&&Ur!==null&&Ur.l!==null&&(Ur.l.s??=[]).push(i),i}function yt(n,e,t=!1){Dn!==null&&(!nu||(Dn.f&kA)!==0)&&Yg()&&(Dn.f&(_o|Ih|qM|kA))!==0&&!mh?.includes(n)&&D4();let i=t?bs(e):e;return Pg(n,i)}function Pg(n,e){if(!n.equals(e)){var t=n.v;gp?Cd.set(n,e):Cd.set(n,t),n.v=e;var i=iu.ensure();i.capture(n,t),(n.f&_o)!==0&&((n.f&ba)!==0&&ZM(n),ko(n,(n.f&wc)!==0?Lo:du)),n.wv=BR(),wR(n,ba),Yg()&&ir!==null&&(ir.f&Lo)!==0&&(ir.f&(Lh|mp))===0&&(Pl===null?y$([n]):Pl.push(n)),!i.is_fork&&zT.size>0&&!bR&&u$()}return e}function u$(){bR=!1;var n=Yf;Lx(!0);const e=Array.from(zT);try{for(const t of e)(t.f&Lo)!==0&&ko(t,du),qy(t)&&hy(t)}finally{Lx(n)}zT.clear()}function Ka(n){yt(n,n.v+1)}function wR(n,e){var t=n.reactions;if(t!==null)for(var i=Yg(),r=t.length,o=0;o<r;o++){var c=t[o],s=c.f;if(!(!i&&c===ir)){var f=(s&ba)===0;if(f&&ko(c,e),(s&_o)!==0){var p=c;kl?.delete(p),(s&op)===0&&(s&wc&&(c.f|=op),wR(p,du))}else f&&((s&Ih)!==0&&lh!==null&&lh.add(c),ap(c))}}}function bs(n){if(typeof n!="object"||n===null||ph in n)return n;const e=VM(n);if(e!==b4&&e!==x4)return n;var t=new Map,i=$M(n),r=ii(0),o=_c,c=s=>{if(_c===o)return s();var f=Dn,p=_c;va(null),BA(o);var g=s();return va(f),BA(p),g};return i&&t.set("length",ii(n.length)),new Proxy(n,{defineProperty(s,f,p){(!("value"in p)||p.configurable===!1||p.enumerable===!1||p.writable===!1)&&R4();var g=t.get(f);return g===void 0?g=c(()=>{var _=ii(p.value);return t.set(f,_),_}):yt(g,p.value,!0),!0},deleteProperty(s,f){var p=t.get(f);if(p===void 0){if(f in s){const g=c(()=>ii(Ao));t.set(f,g),Ka(r)}}else yt(p,Ao),Ka(r);return!0},get(s,f,p){if(f===ph)return n;var g=t.get(f),_=f in s;if(g===void 0&&(!_||_g(s,f)?.writable)&&(g=c(()=>{var b=bs(_?s[f]:Ao),M=ii(b);return M}),t.set(f,g)),g!==void 0){var x=ee(g);return x===Ao?void 0:x}return Reflect.get(s,f,p)},getOwnPropertyDescriptor(s,f){var p=Reflect.getOwnPropertyDescriptor(s,f);if(p&&"value"in p){var g=t.get(f);g&&(p.value=ee(g))}else if(p===void 0){var _=t.get(f),x=_?.v;if(_!==void 0&&x!==Ao)return{enumerable:!0,configurable:!0,value:x,writable:!0}}return p},has(s,f){if(f===ph)return!0;var p=t.get(f),g=p!==void 0&&p.v!==Ao||Reflect.has(s,f);if(p!==void 0||ir!==null&&(!g||_g(s,f)?.writable)){p===void 0&&(p=c(()=>{var x=g?bs(s[f]):Ao,b=ii(x);return b}),t.set(f,p));var _=ee(p);if(_===Ao)return!1}return g},set(s,f,p,g){var _=t.get(f),x=f in s;if(i&&f==="length")for(var b=p;b<_.v;b+=1){var M=t.get(b+"");M!==void 0?yt(M,Ao):b in s&&(M=c(()=>ii(Ao)),t.set(b+"",M))}if(_===void 0)(!x||_g(s,f)?.writable)&&(_=c(()=>ii(void 0)),yt(_,bs(p)),t.set(f,_));else{x=_.v!==Ao;var P=c(()=>bs(p));yt(_,P)}var k=Reflect.getOwnPropertyDescriptor(s,f);if(k?.set&&k.set.call(g,p),!x){if(i&&typeof f=="string"){var L=t.get("length"),I=Number(f);Number.isInteger(I)&&I>=L.v&&yt(L,I+1)}Ka(r)}return!0},ownKeys(s){ee(r);var f=Reflect.ownKeys(s).filter(_=>{var x=t.get(_);return x===void 0||x.v!==Ao});for(var[p,g]of t)g.v!==Ao&&!(p in s)&&f.push(p);return f},setPrototypeOf(){k4()}})}function FA(n){try{if(n!==null&&typeof n=="object"&&ph in n)return n[ph]}catch{}return n}function SR(n,e){return Object.is(FA(n),FA(e))}var ly,TR,MR,CR;function h$(){if(ly===void 0){ly=window,TR=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;MR=_g(e,"firstChild").get,CR=_g(e,"nextSibling").get,RA(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),RA(t)&&(t.__t=void 0)}}function au(n=""){return document.createTextNode(n)}function Ix(n){return MR.call(n)}function Uy(n){return CR.call(n)}function Bt(n,e){return Ix(n)}function ui(n,e=!1){{var t=Ix(n);return t instanceof Comment&&t.data===""?Uy(t):t}}function ht(n,e=1,t=!1){let i=n;for(;e--;)i=Uy(i);return i}function d$(n){n.textContent=""}function ER(){return!1}let OA=!1;function f$(){OA||(OA=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function ww(n){var e=Dn,t=ir;va(null),fu(null);try{return n()}finally{va(e),fu(t)}}function Sw(n,e,t,i=t){n.addEventListener(e,()=>ww(t));const r=n.__on_r;r?n.__on_r=()=>{r(),i(!0)}:n.__on_r=()=>i(!0),f$()}function AR(n){ir===null&&(Dn===null&&P4(),A4()),gp&&E4()}function p$(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function vu(n,e,t){var i=ir;i!==null&&(i.f&nl)!==0&&(n|=nl);var r={ctx:Ur,deps:null,nodes:null,f:n|ba|wc,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{hy(r),r.f|=jM}catch(s){throw ya(r),s}else e!==null&&ap(r);var o=r;if(t&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&Hg)===0&&(o=o.first,(n&Ih)!==0&&(n&sp)!==0&&o!==null&&(o.f|=sp)),o!==null&&(o.parent=i,i!==null&&p$(o,i),Dn!==null&&(Dn.f&_o)!==0&&(n&mp)===0)){var c=Dn;(c.effects??=[]).push(o)}return r}function cy(){return Dn!==null&&!nu}function jy(n){const e=vu(yw,null,!1);return ko(e,Lo),e.teardown=n,e}function cn(n){AR();var e=ir.f,t=!Dn&&(e&Lh)!==0&&(e&jM)===0;if(t){var i=Ur;(i.e??=[]).push(n)}else return PR(n)}function PR(n){return vu(UM|aR,n,!1)}function XM(n){return AR(),vu(yw|aR,n,!0)}function m$(n){iu.ensure();const e=vu(mp|Hg,n,!0);return(t={})=>new Promise(i=>{t.outro?Xf(e,()=>{ya(e),i(void 0)}):(ya(e),i(void 0))})}function YM(n){return vu(UM,n,!1)}function g$(n){return vu(qM|Hg,n,!0)}function Gy(n,e=0){return vu(yw|e,n,!0)}function Ji(n,e=[],t=[],i=[]){o$(i,e,t,r=>{vu(yw,()=>n(...r.map(ee)),!0)})}function Kg(n,e=0){var t=vu(Ih|e,n,!0);return t}function Ll(n){return vu(Lh|Hg,n,!0)}function IR(n){var e=n.teardown;if(e!==null){const t=gp,i=Dn;zA(!0),va(null);try{e.call(null)}finally{zA(t),va(i)}}}function LR(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const r=t.ac;r!==null&&ww(()=>{r.abort(hg)});var i=t.next;(t.f&mp)!==0?t.parent=null:ya(t,e),t=i}}function _$(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Lh)===0&&ya(e),e=t}}function ya(n,e=!0){var t=!1;(e||(n.f&GM)!==0)&&n.nodes!==null&&n.nodes.end!==null&&(v$(n.nodes.start,n.nodes.end),t=!0),LR(n,e&&!t),Rx(n,0),ko(n,fh);var i=n.nodes&&n.nodes.t;if(i!==null)for(const o of i)o.stop();IR(n);var r=n.parent;r!==null&&r.first!==null&&RR(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function v$(n,e){for(;n!==null;){var t=n===e?null:Uy(n);n.remove(),n=t}}function RR(n){var e=n.parent,t=n.prev,i=n.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===n&&(e.first=i),e.last===n&&(e.last=t))}function Xf(n,e,t=!0){var i=[];kR(n,i,!0);var r=()=>{t&&ya(n),e&&e()},o=i.length;if(o>0){var c=()=>--o||r();for(var s of i)s.out(c)}else r()}function kR(n,e,t){if((n.f&nl)===0){n.f^=nl;var i=n.nodes&&n.nodes.t;if(i!==null)for(const s of i)(s.is_global||t)&&e.push(s);for(var r=n.first;r!==null;){var o=r.next,c=(r.f&sp)!==0||(r.f&Lh)!==0&&(n.f&Ih)!==0;kR(r,e,c?t:!1),r=o}}}function KM(n){DR(n,!0)}function DR(n,e){if((n.f&nl)!==0){n.f^=nl,(n.f&Lo)===0&&(ko(n,ba),ap(n));for(var t=n.first;t!==null;){var i=t.next,r=(t.f&sp)!==0||(t.f&Lh)!==0;DR(t,r?e:!1),t=i}var o=n.nodes&&n.nodes.t;if(o!==null)for(const c of o)(c.is_global||e)&&c.in()}}function FR(n,e){if(n.nodes)for(var t=n.nodes.start,i=n.nodes.end;t!==null;){var r=t===i?null:Uy(t);e.append(t),t=r}}let Yf=!1;function Lx(n){Yf=n}let gp=!1;function zA(n){gp=n}let Dn=null,nu=!1;function va(n){Dn=n}let ir=null;function fu(n){ir=n}let mh=null;function OR(n){Dn!==null&&(mh===null?mh=[n]:mh.push(n))}let Yo=null,Wa=0,Pl=null;function y$(n){Pl=n}let zR=1,uy=0,_c=uy;function BA(n){_c=n}function BR(){return++zR}function qy(n){var e=n.f;if((e&ba)!==0)return!0;if(e&_o&&(n.f&=~op),(e&du)!==0){var t=n.deps;if(t!==null)for(var i=t.length,r=0;r<i;r++){var o=t[r];if(qy(o)&&yR(o),o.wv>n.wv)return!0}(e&wc)!==0&&kl===null&&ko(n,Lo)}return!1}function NR(n,e,t=!0){var i=n.reactions;if(i!==null&&!mh?.includes(n))for(var r=0;r<i.length;r++){var o=i[r];(o.f&_o)!==0?NR(o,e,!1):e===o&&(t?ko(o,ba):(o.f&Lo)!==0&&ko(o,du),ap(o))}}function $R(n){var e=Yo,t=Wa,i=Pl,r=Dn,o=mh,c=Ur,s=nu,f=_c,p=n.f;Yo=null,Wa=0,Pl=null,Dn=(p&(Lh|mp))===0?n:null,mh=null,Eg(n.ctx),nu=!1,_c=++uy,n.ac!==null&&(ww(()=>{n.ac.abort(hg)}),n.ac=null);try{n.f|=FT;var g=n.fn,_=g(),x=n.deps;if(Yo!==null){var b;if(Rx(n,Wa),x!==null&&Wa>0)for(x.length=Wa+Yo.length,b=0;b<Yo.length;b++)x[Wa+b]=Yo[b];else n.deps=x=Yo;if(cy()&&(n.f&wc)!==0)for(b=Wa;b<x.length;b++)(x[b].reactions??=[]).push(n)}else x!==null&&Wa<x.length&&(Rx(n,Wa),x.length=Wa);if(Yg()&&Pl!==null&&!nu&&x!==null&&(n.f&(_o|du|ba))===0)for(b=0;b<Pl.length;b++)NR(Pl[b],n);return r!==null&&r!==n&&(uy++,Pl!==null&&(i===null?i=Pl:i.push(...Pl))),(n.f&Md)!==0&&(n.f^=Md),_}catch(M){return pR(M)}finally{n.f^=FT,Yo=e,Wa=t,Pl=i,Dn=r,mh=o,Eg(c),nu=s,_c=f}}function b$(n,e){let t=e.reactions;if(t!==null){var i=y4.call(t,n);if(i!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[i]=t[r],t.pop())}}t===null&&(e.f&_o)!==0&&(Yo===null||!Yo.includes(e))&&(ko(e,du),(e.f&wc)!==0&&(e.f^=wc,e.f&=~op),vR(e),Rx(e,0))}function Rx(n,e){var t=n.deps;if(t!==null)for(var i=e;i<t.length;i++)b$(n,t[i])}function hy(n){var e=n.f;if((e&fh)===0){ko(n,Lo);var t=ir,i=Yf;ir=n,Yf=!0;try{(e&(Ih|S4))!==0?_$(n):LR(n),IR(n);var r=$R(n);n.teardown=typeof r=="function"?r:null,n.wv=zR;var o;kT&&Y4&&(n.f&ba)!==0&&n.deps}finally{Yf=i,ir=t}}}async function VR(){await Promise.resolve(),e$()}function ee(n){var e=n.f,t=(e&_o)!==0;if(Dn!==null&&!nu){var i=ir!==null&&(ir.f&fh)!==0;if(!i&&!mh?.includes(n)){var r=Dn.deps;if((Dn.f&FT)!==0)n.rv<uy&&(n.rv=uy,Yo===null&&r!==null&&r[Wa]===n?Wa++:Yo===null?Yo=[n]:Yo.includes(n)||Yo.push(n));else{(Dn.deps??=[]).push(n);var o=n.reactions;o===null?n.reactions=[Dn]:o.includes(Dn)||o.push(Dn)}}}if(gp){if(Cd.has(n))return Cd.get(n);if(t){var c=n,s=c.v;return((c.f&Lo)===0&&c.reactions!==null||jR(c))&&(s=ZM(c)),Cd.set(c,s),s}}else t&&(!kl?.has(n)||Bn?.is_fork&&!cy())&&(c=n,qy(c)&&yR(c),Yf&&cy()&&(c.f&wc)===0&&UR(c));if(kl?.has(n))return kl.get(n);if((n.f&Md)!==0)throw n.v;return n.v}function UR(n){if(n.deps!==null){n.f^=wc;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&_o)!==0&&(e.f&wc)===0&&UR(e)}}function jR(n){if(n.v===Ao)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Cd.has(e)||(e.f&_o)!==0&&jR(e))return!0;return!1}function ys(n){var e=nu;try{return nu=!0,n()}finally{nu=e}}const x$=-7169;function ko(n,e){n.f=n.f&x$|e}function w$(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(ph in n)BT(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&ph in t&&BT(t)}}}function BT(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let i in n)try{BT(n[i],e)}catch{}const t=VM(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=sR(t);for(let r in i){const o=i[r].get;if(o)try{o.call(n)}catch{}}}}}const S$=["touchstart","touchmove"];function T$(n){return S$.includes(n)}const GR=new Set,NT=new Set;function M$(n,e,t,i={}){function r(o){if(i.capture||Mv.call(e,o),!o.cancelBubble)return ww(()=>t?.call(this,o))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Rd(()=>{e.addEventListener(n,r,i)}):e.addEventListener(n,r,i),r}function JM(n,e,t,i,r){var o={capture:i,passive:r},c=M$(n,e,t,o);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&jy(()=>{e.removeEventListener(n,c,o)})}function ps(n){for(var e=0;e<n.length;e++)GR.add(n[e]);for(var t of NT)t(n)}let NA=null;function Mv(n){var e=this,t=e.ownerDocument,i=n.type,r=n.composedPath?.()||[],o=r[0]||n.target;NA=n;var c=0,s=NA===n&&n.__root;if(s){var f=r.indexOf(s);if(f!==-1&&(e===document||e===window)){n.__root=e;return}var p=r.indexOf(e);if(p===-1)return;f<=p&&(c=f)}if(o=r[c]||n.target,o!==e){rR(n,"currentTarget",{configurable:!0,get(){return o||t}});var g=Dn,_=ir;va(null),fu(null);try{for(var x,b=[];o!==null;){var M=o.assignedSlot||o.parentNode||o.host||null;try{var P=o["__"+i];P!=null&&(!o.disabled||n.target===o)&&P.call(o,n)}catch(k){x?b.push(k):x=k}if(n.cancelBubble||M===e||M===null)break;o=M}if(x){for(let k of b)queueMicrotask(()=>{throw k});throw x}}finally{n.__root=e,delete n.currentTarget,va(g),fu(_)}}}function C$(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function kx(n,e){var t=ir;t.nodes===null&&(t.nodes={start:n,end:e,a:null,t:null})}function Xt(n,e){var t=(e&q4)!==0,i=(e&H4)!==0,r,o=!n.startsWith("<!>");return()=>{r===void 0&&(r=C$(o?n:"<!>"+n),t||(r=Ix(r)));var c=i||TR?document.importNode(r,!0):r.cloneNode(!0);if(t){var s=Ix(c),f=c.lastChild;kx(s,f)}else kx(c,c);return c}}function Hn(n=""){{var e=au(n+"");return kx(e,e),e}}function tr(){var n=document.createDocumentFragment(),e=document.createComment(""),t=au();return n.append(e,t),kx(e,t),n}function pt(n,e){n!==null&&n.before(e)}function ln(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function E$(n,e){return A$(n,e)}const Rm=new Map;function A$(n,{target:e,anchor:t,props:i={},events:r,context:o,intro:c=!0}){h$();var s=new Set,f=_=>{for(var x=0;x<_.length;x++){var b=_[x];if(!s.has(b)){s.add(b);var M=T$(b);e.addEventListener(b,Mv,{passive:M});var P=Rm.get(b);P===void 0?(document.addEventListener(b,Mv,{passive:M}),Rm.set(b,1)):Rm.set(b,P+1)}}};f(vw(GR)),NT.add(f);var p=void 0,g=m$(()=>{var _=t??e.appendChild(au());return r$(_,{pending:()=>{}},x=>{if(o){en({});var b=Ur;b.c=o}r&&(i.$$events=r),p=n(x,i)||{},o&&tn()}),()=>{for(var x of s){e.removeEventListener(x,Mv);var b=Rm.get(x);--b===0?(document.removeEventListener(x,Mv),Rm.delete(x)):Rm.set(x,b)}NT.delete(f),_!==t&&_.parentNode?.removeChild(_)}});return P$.set(p,g),p}let P$=new WeakMap;class QM{anchor;#t=new Map;#e=new Map;#i=new Map;#n=new Set;#s=!0;constructor(e,t=!0){this.anchor=e,this.#s=t}#r=()=>{var e=Bn;if(this.#t.has(e)){var t=this.#t.get(e),i=this.#e.get(t);if(i)KM(i),this.#n.delete(t);else{var r=this.#i.get(t);r&&(this.#e.set(t,r.effect),this.#i.delete(t),r.fragment.lastChild.remove(),this.anchor.before(r.fragment),i=r.effect)}for(const[o,c]of this.#t){if(this.#t.delete(o),o===e)break;const s=this.#i.get(c);s&&(ya(s.effect),this.#i.delete(c))}for(const[o,c]of this.#e){if(o===t||this.#n.has(o))continue;const s=()=>{if(Array.from(this.#t.values()).includes(o)){var p=document.createDocumentFragment();FR(c,p),p.append(au()),this.#i.set(o,{effect:c,fragment:p})}else ya(c);this.#n.delete(o),this.#e.delete(o)};this.#s||!i?(this.#n.add(o),Xf(c,s,!1)):s()}}};#o=e=>{this.#t.delete(e);const t=Array.from(this.#t.values());for(const[i,r]of this.#i)t.includes(i)||(ya(r.effect),this.#i.delete(i))};ensure(e,t){var i=Bn,r=ER();if(t&&!this.#e.has(e)&&!this.#i.has(e))if(r){var o=document.createDocumentFragment(),c=au();o.append(c),this.#i.set(e,{effect:Ll(()=>t(c)),fragment:o})}else this.#e.set(e,Ll(()=>t(this.anchor)));if(this.#t.set(i,e),r){for(const[s,f]of this.#e)s===e?i.skipped_effects.delete(f):i.skipped_effects.add(f);for(const[s,f]of this.#i)s===e?i.skipped_effects.delete(f.effect):i.skipped_effects.add(f.effect);i.oncommit(this.#r),i.ondiscard(this.#o)}else this.#r()}}function Ki(n,e,t=!1){var i=new QM(n),r=t?sp:0;function o(c,s){i.ensure(c,s)}Kg(()=>{var c=!1;e((s,f=!0)=>{c=!0,o(f,s)}),c||o(!1,null)},r)}function Hy(n,e,t){var i=new QM(n),r=!Yg();Kg(()=>{var o=e();r&&o!==null&&typeof o=="object"&&(o={}),i.ensure(o,t)})}function Fs(n,e){return e}function I$(n,e,t){for(var i=[],r=e.length,o,c=e.length,s=0;s<r;s++){let _=e[s];Xf(_,()=>{if(o){if(o.pending.delete(_),o.done.add(_),o.pending.size===0){var x=n.outrogroups;$T(vw(o.done)),x.delete(o),x.size===0&&(n.outrogroups=null)}}else c-=1},!1)}if(c===0){var f=i.length===0&&t!==null;if(f){var p=t,g=p.parentNode;d$(g),g.append(p),n.items.clear()}$T(e,!f)}else o={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(o)}function $T(n,e=!0){for(var t=0;t<n.length;t++)ya(n[t],e)}var $A;function Os(n,e,t,i,r,o=null){var c=n,s=new Map,f=(e&lR)!==0;if(f){var p=n;c=p.appendChild(au())}var g=null,_=WM(()=>{var L=t();return $M(L)?L:L==null?[]:vw(L)}),x,b=!0;function M(){k.fallback=g,L$(k,x,c,e,i),g!==null&&(x.length===0?(g.f&hh)===0?KM(g):(g.f^=hh,Cv(g,null,c)):Xf(g,()=>{g=null}))}var P=Kg(()=>{x=ee(_);for(var L=x.length,I=new Set,F=Bn,N=ER(),H=0;H<L;H+=1){var Y=x[H],q=i(Y,H),U=b?null:s.get(q);U?(U.v&&Pg(U.v,Y),U.i&&Pg(U.i,H),N&&F.skipped_effects.delete(U.e)):(U=R$(s,b?c:$A??=au(),Y,q,H,r,e,t),b||(U.e.f|=hh),s.set(q,U)),I.add(q)}if(L===0&&o&&!g&&(b?g=Ll(()=>o(c)):(g=Ll(()=>o($A??=au())),g.f|=hh)),!b)if(N){for(const[G,j]of s)I.has(G)||F.skipped_effects.add(j.e);F.oncommit(M),F.ondiscard(()=>{})}else M();ee(_)}),k={effect:P,items:s,outrogroups:null,fallback:g};b=!1}function L$(n,e,t,i,r){var o=(i&B4)!==0,c=e.length,s=n.items,f=n.effect.first,p,g=null,_,x=[],b=[],M,P,k,L;if(o)for(L=0;L<c;L+=1)M=e[L],P=r(M,L),k=s.get(P).e,(k.f&hh)===0&&(k.nodes?.a?.measure(),(_??=new Set).add(k));for(L=0;L<c;L+=1){if(M=e[L],P=r(M,L),k=s.get(P).e,n.outrogroups!==null)for(const j of n.outrogroups)j.pending.delete(k),j.done.delete(k);if((k.f&hh)!==0)if(k.f^=hh,k===f)Cv(k,null,t);else{var I=g?g.next:f;k===n.effect.last&&(n.effect.last=k.prev),k.prev&&(k.prev.next=k.next),k.next&&(k.next.prev=k.prev),ad(n,g,k),ad(n,k,I),Cv(k,I,t),g=k,x=[],b=[],f=g.next;continue}if((k.f&nl)!==0&&(KM(k),o&&(k.nodes?.a?.unfix(),(_??=new Set).delete(k))),k!==f){if(p!==void 0&&p.has(k)){if(x.length<b.length){var F=b[0],N;g=F.prev;var H=x[0],Y=x[x.length-1];for(N=0;N<x.length;N+=1)Cv(x[N],F,t);for(N=0;N<b.length;N+=1)p.delete(b[N]);ad(n,H.prev,Y.next),ad(n,g,H),ad(n,Y,F),f=F,g=Y,L-=1,x=[],b=[]}else p.delete(k),Cv(k,f,t),ad(n,k.prev,k.next),ad(n,k,g===null?n.effect.first:g.next),ad(n,g,k),g=k;continue}for(x=[],b=[];f!==null&&f!==k;)(p??=new Set).add(f),b.push(f),f=f.next;if(f===null)continue}(k.f&hh)===0&&x.push(k),g=k,f=k.next}if(n.outrogroups!==null){for(const j of n.outrogroups)j.pending.size===0&&($T(vw(j.done)),n.outrogroups?.delete(j));n.outrogroups.size===0&&(n.outrogroups=null)}if(f!==null||p!==void 0){var q=[];if(p!==void 0)for(k of p)(k.f&nl)===0&&q.push(k);for(;f!==null;)(f.f&nl)===0&&f!==n.fallback&&q.push(f),f=f.next;var U=q.length;if(U>0){var G=(i&lR)!==0&&c===0?t:null;if(o){for(L=0;L<U;L+=1)q[L].nodes?.a?.measure();for(L=0;L<U;L+=1)q[L].nodes?.a?.fix()}I$(n,q,G)}}o&&Rd(()=>{if(_!==void 0)for(k of _)k.nodes?.a?.apply()})}function R$(n,e,t,i,r,o,c,s){var f=(c&O4)!==0?(c&N4)===0?xR(t,!1,!1):xh(t):null,p=(c&z4)!==0?xh(r):null;return{v:f,i:p,e:Ll(()=>(o(e,f??t,p??r,s),()=>{n.delete(i)}))}}function Cv(n,e,t){if(n.nodes)for(var i=n.nodes.start,r=n.nodes.end,o=e&&(e.f&hh)===0?e.nodes.start:t;i!==null;){var c=Uy(i);if(o.before(i),i===r)return;i=c}}function ad(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function xs(n,e,...t){var i=new QM(n);Kg(()=>{const r=e()??null;i.ensure(r,r&&(o=>r(o,...t)))},sp)}function k$(n,e){var t;t=document.head.appendChild(au()),Kg(()=>e(t),GM)}function D$(n,e,t){YM(()=>{var i=ys(()=>e(n,t?.())||{});if(i?.destroy)return()=>i.destroy()})}function qR(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=qR(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function F$(){for(var n,e,t=0,i="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=qR(n))&&(i&&(i+=" "),i+=e);return i}function HR(n){return typeof n=="object"?F$(n):n??""}const VA=[...` 	
\r\fÂ \v\uFEFF`];function O$(n,e,t){var i=n==null?"":""+n;if(e&&(i=i?i+" "+e:e),t){for(var r in t)if(t[r])i=i?i+" "+r:r;else if(i.length)for(var o=r.length,c=0;(c=i.indexOf(r,c))>=0;){var s=c+o;(c===0||VA.includes(i[c-1]))&&(s===i.length||VA.includes(i[s]))?i=(c===0?"":i.substring(0,c))+i.substring(s+1):c=s}}return i===""?null:i}function UA(n,e=!1){var t=e?" !important;":";",i="";for(var r in n){var o=n[r];o!=null&&o!==""&&(i+=" "+r+": "+o+t)}return i}function lS(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function z$(n,e){if(e){var t="",i,r;if(Array.isArray(e)?(i=e[0],r=e[1]):i=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,c=0,s=!1,f=[];i&&f.push(...Object.keys(i).map(lS)),r&&f.push(...Object.keys(r).map(lS));var p=0,g=-1;const P=n.length;for(var _=0;_<P;_++){var x=n[_];if(s?x==="/"&&n[_-1]==="*"&&(s=!1):o?o===x&&(o=!1):x==="/"&&n[_+1]==="*"?s=!0:x==='"'||x==="'"?o=x:x==="("?c++:x===")"&&c--,!s&&o===!1&&c===0){if(x===":"&&g===-1)g=_;else if(x===";"||_===P-1){if(g!==-1){var b=lS(n.substring(p,g).trim());if(!f.includes(b)){x!==";"&&_++;var M=n.substring(p,_).trim();t+=" "+M+";"}}p=_+1,g=-1}}}}return i&&(t+=UA(i)),r&&(t+=UA(r,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function lp(n,e,t,i,r,o){var c=n.__className;if(c!==t||c===void 0){var s=O$(t,i,o);s==null?n.removeAttribute("class"):n.className=s,n.__className=t}else if(o&&r!==o)for(var f in o){var p=!!o[f];(r==null||p!==!!r[f])&&n.classList.toggle(f,p)}return o}function cS(n,e={},t,i){for(var r in t){var o=t[r];e[r]!==o&&(t[r]==null?n.style.removeProperty(r):n.style.setProperty(r,o,i))}}function gh(n,e,t,i){var r=n.__style;if(r!==e){var o=z$(e,i);o==null?n.removeAttribute("style"):n.style.cssText=o,n.__style=e}else i&&(Array.isArray(i)?(cS(n,t?.[0],i[0]),cS(n,t?.[1],i[1],"important")):cS(n,t,i));return i}function WR(n,e,t=!1){if(n.multiple){if(e==null)return;if(!$M(e))return Z4();for(var i of n.options)i.selected=e.includes(Gv(i));return}for(i of n.options){var r=Gv(i);if(SR(r,e)){i.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function B$(n){var e=new MutationObserver(()=>{WR(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),jy(()=>{e.disconnect()})}function N$(n,e,t=e){var i=new WeakSet,r=!0;Sw(n,"change",o=>{var c=o?"[selected]":":checked",s;if(n.multiple)s=[].map.call(n.querySelectorAll(c),Gv);else{var f=n.querySelector(c)??n.querySelector("option:not([disabled])");s=f&&Gv(f)}t(s),Bn!==null&&i.add(Bn)}),YM(()=>{var o=e();if(n===document.activeElement){var c=Uv??Bn;if(i.has(c))return}if(WR(n,o,r),r&&o===void 0){var s=n.querySelector(":checked");s!==null&&(o=Gv(s),t(o))}n.__value=o,r=!1}),B$(n)}function Gv(n){return"__value"in n?n.__value:n.value}const $$=Symbol("is custom element"),V$=Symbol("is html");function U$(n,e){var t=ZR(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function lu(n,e,t,i){var r=ZR(n);r[e]!==(r[e]=t)&&(e==="loading"&&(n[M4]=t),t==null?n.removeAttribute(e):typeof t!="string"&&j$(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function ZR(n){return n.__attributes??={[$$]:n.nodeName.includes("-"),[V$]:n.namespaceURI===W4}}var jA=new Map;function j$(n){var e=n.getAttribute("is")||n.nodeName,t=jA.get(e);if(t)return t;jA.set(e,t=[]);for(var i,r=n,o=Element.prototype;o!==r;){i=sR(r);for(var c in i)i[c].set&&t.push(c);r=VM(r)}return t}function qv(n,e,t=e){var i=new WeakSet;Sw(n,"input",async r=>{var o=r?n.defaultValue:n.value;if(o=dS(n)?fS(o):o,t(o),Bn!==null&&i.add(Bn),await VR(),o!==(o=e())){var c=n.selectionStart,s=n.selectionEnd,f=n.value.length;if(n.value=o??"",s!==null){var p=n.value.length;c===s&&s===f&&p>f?(n.selectionStart=p,n.selectionEnd=p):(n.selectionStart=c,n.selectionEnd=Math.min(s,p))}}}),ys(e)==null&&n.value&&(t(dS(n)?fS(n.value):n.value),Bn!==null&&i.add(Bn)),Gy(()=>{var r=e();if(n===document.activeElement){var o=Uv??Bn;if(i.has(o))return}dS(n)&&r===fS(n.value)||n.type==="date"&&!r&&!n.value||r!==n.value&&(n.value=r??"")})}const uS=new Set;function hS(n,e,t,i,r=i){var o=t.getAttribute("type")==="checkbox",c=n;if(e!==null)for(var s of e)c=c[s]??=[];c.push(t),Sw(t,"change",()=>{var f=t.__value;o&&(f=q$(c,f,t.checked)),r(f)},()=>r(o?[]:null)),Gy(()=>{var f=i();o?(f=f||[],t.checked=f.includes(t.__value)):t.checked=SR(t.__value,f)}),jy(()=>{var f=c.indexOf(t);f!==-1&&c.splice(f,1)}),uS.has(c)||(uS.add(c),Rd(()=>{c.sort((f,p)=>f.compareDocumentPosition(p)===4?-1:1),uS.delete(c)})),Rd(()=>{})}function G$(n,e,t=e){Sw(n,"change",i=>{var r=i?n.defaultChecked:n.checked;t(r)}),ys(e)==null&&t(n.checked),Gy(()=>{var i=e();n.checked=!!i})}function q$(n,e,t){for(var i=new Set,r=0;r<n.length;r+=1)n[r].checked&&i.add(n[r].__value);return t||i.delete(e),Array.from(i)}function dS(n){var e=n.type;return e==="number"||e==="range"}function fS(n){return n===""?null:+n}function GA(n,e){return n===e||n?.[ph]===e}function vc(n={},e,t,i){return YM(()=>{var r,o;return Gy(()=>{r=o,o=[],ys(()=>{n!==t(...o)&&(e(n,...o),r&&GA(t(...r),n)&&e(null,...r))})}),()=>{Rd(()=>{o&&GA(t(...o),n)&&e(null,...o)})}}),n}function Tw(n=!1){const e=Ur,t=e.l.u;if(!t)return;let i=()=>w$(e.s);if(n){let r=0,o={};const c=Vy(()=>{let s=!1;const f=e.s;for(const p in f)f[p]!==o[p]&&(o[p]=f[p],s=!0);return s&&r++,r});i=()=>ee(c)}t.b.length&&XM(()=>{qA(e,i),DT(t.b)}),cn(()=>{const r=ys(()=>t.m.map(w4));return()=>{for(const o of r)typeof o=="function"&&o()}}),t.a.length&&cn(()=>{qA(e,i),DT(t.a)})}function qA(n,e){if(n.l.s)for(const t of n.l.s)ee(t);e()}function XR(n,e,t){if(n==null)return e(void 0),ls;const i=ys(()=>n.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const km=[];function Mc(n,e=ls){let t=null;const i=new Set;function r(s){if(uR(n,s)&&(n=s,t)){const f=!km.length;for(const p of i)p[1](),km.push(p,n);if(f){for(let p=0;p<km.length;p+=2)km[p][0](km[p+1]);km.length=0}}}function o(s){r(s(n))}function c(s,f=ls){const p=[s,f];return i.add(p),i.size===1&&(t=e(r,o)||ls),s(n),()=>{i.delete(p),i.size===0&&t&&(t(),t=null)}}return{set:r,update:o,subscribe:c}}function H$(n){let e;return XR(n,t=>e=t)(),e}let Ev=!1,VT=Symbol();function on(n,e,t){const i=t[e]??={store:null,source:xR(void 0),unsubscribe:ls};if(i.store!==n&&!(VT in t))if(i.unsubscribe(),i.store=n??null,n==null)i.source.v=void 0,i.unsubscribe=ls;else{var r=!0;i.unsubscribe=XR(n,o=>{r?i.source.v=o:yt(i.source,o)}),r=!1}return n&&VT in t?H$(n):ee(i.source)}function rl(n,e){return n.set(e),e}function cs(){const n={};function e(){jy(()=>{for(var t in n)n[t].unsubscribe();rR(n,VT,{enumerable:!1,value:!0})})}return[n,e]}function ub(n,e,t){return n.set(t),e}function Kf(n,e,t=1){return n.set(e+t),e}function W$(){Ev=!0}function Z$(n){var e=Ev;try{return Ev=!1,[n(),Ev]}finally{Ev=e}}const X$={get(n,e){if(!n.exclude.includes(e))return n.props[e]},set(n,e){return!1},getOwnPropertyDescriptor(n,e){if(!n.exclude.includes(e)&&e in n.props)return{enumerable:!0,configurable:!0,value:n.props[e]}},has(n,e){return n.exclude.includes(e)?!1:e in n.props},ownKeys(n){return Reflect.ownKeys(n.props).filter(e=>!n.exclude.includes(e))}};function Y$(n,e,t){return new Proxy({props:n,exclude:e},X$)}function st(n,e,t,i){var r=!Wg||(t&V4)!==0,o=(t&j4)!==0,c=(t&G4)!==0,s=i,f=!0,p=()=>(f&&(f=!1,s=c?ys(i):i),s),g;if(o){var _=ph in n||T4 in n;g=_g(n,e)?.set??(_&&e in n?F=>n[e]=F:void 0)}var x,b=!1;o?[x,b]=Z$(()=>n[e]):x=n[e],x===void 0&&i!==void 0&&(x=p(),g&&(r&&L4(),g(x)));var M;if(r?M=()=>{var F=n[e];return F===void 0?p():(f=!0,F)}:M=()=>{var F=n[e];return F!==void 0&&(s=void 0),F===void 0?s:F},r&&(t&U4)===0)return M;if(g){var P=n.$$legacy;return(function(F,N){return arguments.length>0?((!r||!N||P||b)&&g(N?M():F),F):M()})}var k=!1,L=((t&$4)!==0?Vy:WM)(()=>(k=!1,M()));o&&ee(L);var I=ir;return(function(F,N){if(arguments.length>0){const H=N?ee(L):r&&o?bs(F):F;return yt(L,H),k=!0,s!==void 0&&(s=H),F}return gp&&k||(I.f&fh)!==0?L.v:ee(L)})}function e2(n){Ur===null&&HM(),Wg&&Ur.l!==null?K$(Ur).m.push(n):cn(()=>{const e=ys(n);if(typeof e=="function")return e})}function xa(n){Ur===null&&HM(),e2(()=>()=>ys(n))}function K$(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}const J$="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(J$);function Q$(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function e5(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){var r=!1;try{r=this instanceof i}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var mx={exports:{}},ra="top",sl="bottom",ol="right",sa="left",Mw="auto",Jg=[ra,sl,ol,sa],cp="start",Ig="end",YR="clippingParents",t2="viewport",og="popper",KR="reference",UT=Jg.reduce(function(n,e){return n.concat([e+"-"+cp,e+"-"+Ig])},[]),i2=[].concat(Jg,[Mw]).reduce(function(n,e){return n.concat([e,e+"-"+cp,e+"-"+Ig])},[]),JR="beforeRead",QR="read",ek="afterRead",tk="beforeMain",ik="main",nk="afterMain",rk="beforeWrite",sk="write",ok="afterWrite",ak=[JR,QR,ek,tk,ik,nk,rk,sk,ok];function pu(n){return n?(n.nodeName||"").toLowerCase():null}function al(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function up(n){var e=al(n).Element;return n instanceof e||n instanceof Element}function Ol(n){var e=al(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function n2(n){if(typeof ShadowRoot>"u")return!1;var e=al(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function t5(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];!Ol(o)||!pu(o)||(Object.assign(o.style,i),Object.keys(r).forEach(function(c){var s=r[c];s===!1?o.removeAttribute(c):o.setAttribute(c,s===!0?"":s)}))})}function i5(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var r=e.elements[i],o=e.attributes[i]||{},c=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),s=c.reduce(function(f,p){return f[p]="",f},{});!Ol(r)||!pu(r)||(Object.assign(r.style,s),Object.keys(o).forEach(function(f){r.removeAttribute(f)}))})}}const r2={name:"applyStyles",enabled:!0,phase:"write",fn:t5,effect:i5,requires:["computeStyles"]};function cu(n){return n.split("-")[0]}var Jf=Math.max,Dx=Math.min,Lg=Math.round;function jT(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function lk(){return!/^((?!chrome|android).)*safari/i.test(jT())}function Rg(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=n.getBoundingClientRect(),r=1,o=1;e&&Ol(n)&&(r=n.offsetWidth>0&&Lg(i.width)/n.offsetWidth||1,o=n.offsetHeight>0&&Lg(i.height)/n.offsetHeight||1);var c=up(n)?al(n):window,s=c.visualViewport,f=!lk()&&t,p=(i.left+(f&&s?s.offsetLeft:0))/r,g=(i.top+(f&&s?s.offsetTop:0))/o,_=i.width/r,x=i.height/o;return{width:_,height:x,top:g,right:p+_,bottom:g+x,left:p,x:p,y:g}}function s2(n){var e=Rg(n),t=n.offsetWidth,i=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:i}}function ck(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&n2(t)){var i=e;do{if(i&&n.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function wh(n){return al(n).getComputedStyle(n)}function n5(n){return["table","td","th"].indexOf(pu(n))>=0}function Gd(n){return((up(n)?n.ownerDocument:n.document)||window.document).documentElement}function Cw(n){return pu(n)==="html"?n:n.assignedSlot||n.parentNode||(n2(n)?n.host:null)||Gd(n)}function HA(n){return!Ol(n)||wh(n).position==="fixed"?null:n.offsetParent}function r5(n){var e=/firefox/i.test(jT()),t=/Trident/i.test(jT());if(t&&Ol(n)){var i=wh(n);if(i.position==="fixed")return null}var r=Cw(n);for(n2(r)&&(r=r.host);Ol(r)&&["html","body"].indexOf(pu(r))<0;){var o=wh(r);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return r;r=r.parentNode}return null}function Wy(n){for(var e=al(n),t=HA(n);t&&n5(t)&&wh(t).position==="static";)t=HA(t);return t&&(pu(t)==="html"||pu(t)==="body"&&wh(t).position==="static")?e:t||r5(n)||e}function o2(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function Hv(n,e,t){return Jf(n,Dx(e,t))}function s5(n,e,t){var i=Hv(n,e,t);return i>t?t:i}function uk(){return{top:0,right:0,bottom:0,left:0}}function hk(n){return Object.assign({},uk(),n)}function dk(n,e){return e.reduce(function(t,i){return t[i]=n,t},{})}var o5=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,hk(typeof e!="number"?e:dk(e,Jg))};function a5(n){var e,t=n.state,i=n.name,r=n.options,o=t.elements.arrow,c=t.modifiersData.popperOffsets,s=cu(t.placement),f=o2(s),p=[sa,ol].indexOf(s)>=0,g=p?"height":"width";if(!(!o||!c)){var _=o5(r.padding,t),x=s2(o),b=f==="y"?ra:sa,M=f==="y"?sl:ol,P=t.rects.reference[g]+t.rects.reference[f]-c[f]-t.rects.popper[g],k=c[f]-t.rects.reference[f],L=Wy(o),I=L?f==="y"?L.clientHeight||0:L.clientWidth||0:0,F=P/2-k/2,N=_[b],H=I-x[g]-_[M],Y=I/2-x[g]/2+F,q=Hv(N,Y,H),U=f;t.modifiersData[i]=(e={},e[U]=q,e.centerOffset=q-Y,e)}}function l5(n){var e=n.state,t=n.options,i=t.element,r=i===void 0?"[data-popper-arrow]":i;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||ck(e.elements.popper,r)&&(e.elements.arrow=r))}const fk={name:"arrow",enabled:!0,phase:"main",fn:a5,effect:l5,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function kg(n){return n.split("-")[1]}var c5={top:"auto",right:"auto",bottom:"auto",left:"auto"};function u5(n,e){var t=n.x,i=n.y,r=e.devicePixelRatio||1;return{x:Lg(t*r)/r||0,y:Lg(i*r)/r||0}}function WA(n){var e,t=n.popper,i=n.popperRect,r=n.placement,o=n.variation,c=n.offsets,s=n.position,f=n.gpuAcceleration,p=n.adaptive,g=n.roundOffsets,_=n.isFixed,x=c.x,b=x===void 0?0:x,M=c.y,P=M===void 0?0:M,k=typeof g=="function"?g({x:b,y:P}):{x:b,y:P};b=k.x,P=k.y;var L=c.hasOwnProperty("x"),I=c.hasOwnProperty("y"),F=sa,N=ra,H=window;if(p){var Y=Wy(t),q="clientHeight",U="clientWidth";if(Y===al(t)&&(Y=Gd(t),wh(Y).position!=="static"&&s==="absolute"&&(q="scrollHeight",U="scrollWidth")),Y=Y,r===ra||(r===sa||r===ol)&&o===Ig){N=sl;var G=_&&Y===H&&H.visualViewport?H.visualViewport.height:Y[q];P-=G-i.height,P*=f?1:-1}if(r===sa||(r===ra||r===sl)&&o===Ig){F=ol;var j=_&&Y===H&&H.visualViewport?H.visualViewport.width:Y[U];b-=j-i.width,b*=f?1:-1}}var B=Object.assign({position:s},p&&c5),ne=g===!0?u5({x:b,y:P},al(t)):{x:b,y:P};if(b=ne.x,P=ne.y,f){var J;return Object.assign({},B,(J={},J[N]=I?"0":"",J[F]=L?"0":"",J.transform=(H.devicePixelRatio||1)<=1?"translate("+b+"px, "+P+"px)":"translate3d("+b+"px, "+P+"px, 0)",J))}return Object.assign({},B,(e={},e[N]=I?P+"px":"",e[F]=L?b+"px":"",e.transform="",e))}function h5(n){var e=n.state,t=n.options,i=t.gpuAcceleration,r=i===void 0?!0:i,o=t.adaptive,c=o===void 0?!0:o,s=t.roundOffsets,f=s===void 0?!0:s,p={placement:cu(e.placement),variation:kg(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,WA(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:c,roundOffsets:f})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,WA(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:f})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const a2={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:h5,data:{}};var hb={passive:!0};function d5(n){var e=n.state,t=n.instance,i=n.options,r=i.scroll,o=r===void 0?!0:r,c=i.resize,s=c===void 0?!0:c,f=al(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&p.forEach(function(g){g.addEventListener("scroll",t.update,hb)}),s&&f.addEventListener("resize",t.update,hb),function(){o&&p.forEach(function(g){g.removeEventListener("scroll",t.update,hb)}),s&&f.removeEventListener("resize",t.update,hb)}}const l2={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:d5,data:{}};var f5={left:"right",right:"left",bottom:"top",top:"bottom"};function gx(n){return n.replace(/left|right|bottom|top/g,function(e){return f5[e]})}var p5={start:"end",end:"start"};function ZA(n){return n.replace(/start|end/g,function(e){return p5[e]})}function c2(n){var e=al(n),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function u2(n){return Rg(Gd(n)).left+c2(n).scrollLeft}function m5(n,e){var t=al(n),i=Gd(n),r=t.visualViewport,o=i.clientWidth,c=i.clientHeight,s=0,f=0;if(r){o=r.width,c=r.height;var p=lk();(p||!p&&e==="fixed")&&(s=r.offsetLeft,f=r.offsetTop)}return{width:o,height:c,x:s+u2(n),y:f}}function g5(n){var e,t=Gd(n),i=c2(n),r=(e=n.ownerDocument)==null?void 0:e.body,o=Jf(t.scrollWidth,t.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),c=Jf(t.scrollHeight,t.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-i.scrollLeft+u2(n),f=-i.scrollTop;return wh(r||t).direction==="rtl"&&(s+=Jf(t.clientWidth,r?r.clientWidth:0)-o),{width:o,height:c,x:s,y:f}}function h2(n){var e=wh(n),t=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+i)}function pk(n){return["html","body","#document"].indexOf(pu(n))>=0?n.ownerDocument.body:Ol(n)&&h2(n)?n:pk(Cw(n))}function Wv(n,e){var t;e===void 0&&(e=[]);var i=pk(n),r=i===((t=n.ownerDocument)==null?void 0:t.body),o=al(i),c=r?[o].concat(o.visualViewport||[],h2(i)?i:[]):i,s=e.concat(c);return r?s:s.concat(Wv(Cw(c)))}function GT(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function _5(n,e){var t=Rg(n,!1,e==="fixed");return t.top=t.top+n.clientTop,t.left=t.left+n.clientLeft,t.bottom=t.top+n.clientHeight,t.right=t.left+n.clientWidth,t.width=n.clientWidth,t.height=n.clientHeight,t.x=t.left,t.y=t.top,t}function XA(n,e,t){return e===t2?GT(m5(n,t)):up(e)?_5(e,t):GT(g5(Gd(n)))}function v5(n){var e=Wv(Cw(n)),t=["absolute","fixed"].indexOf(wh(n).position)>=0,i=t&&Ol(n)?Wy(n):n;return up(i)?e.filter(function(r){return up(r)&&ck(r,i)&&pu(r)!=="body"}):[]}function y5(n,e,t,i){var r=e==="clippingParents"?v5(n):[].concat(e),o=[].concat(r,[t]),c=o[0],s=o.reduce(function(f,p){var g=XA(n,p,i);return f.top=Jf(g.top,f.top),f.right=Dx(g.right,f.right),f.bottom=Dx(g.bottom,f.bottom),f.left=Jf(g.left,f.left),f},XA(n,c,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function mk(n){var e=n.reference,t=n.element,i=n.placement,r=i?cu(i):null,o=i?kg(i):null,c=e.x+e.width/2-t.width/2,s=e.y+e.height/2-t.height/2,f;switch(r){case ra:f={x:c,y:e.y-t.height};break;case sl:f={x:c,y:e.y+e.height};break;case ol:f={x:e.x+e.width,y:s};break;case sa:f={x:e.x-t.width,y:s};break;default:f={x:e.x,y:e.y}}var p=r?o2(r):null;if(p!=null){var g=p==="y"?"height":"width";switch(o){case cp:f[p]=f[p]-(e[g]/2-t[g]/2);break;case Ig:f[p]=f[p]+(e[g]/2-t[g]/2);break}}return f}function Dg(n,e){e===void 0&&(e={});var t=e,i=t.placement,r=i===void 0?n.placement:i,o=t.strategy,c=o===void 0?n.strategy:o,s=t.boundary,f=s===void 0?YR:s,p=t.rootBoundary,g=p===void 0?t2:p,_=t.elementContext,x=_===void 0?og:_,b=t.altBoundary,M=b===void 0?!1:b,P=t.padding,k=P===void 0?0:P,L=hk(typeof k!="number"?k:dk(k,Jg)),I=x===og?KR:og,F=n.rects.popper,N=n.elements[M?I:x],H=y5(up(N)?N:N.contextElement||Gd(n.elements.popper),f,g,c),Y=Rg(n.elements.reference),q=mk({reference:Y,element:F,placement:r}),U=GT(Object.assign({},F,q)),G=x===og?U:Y,j={top:H.top-G.top+L.top,bottom:G.bottom-H.bottom+L.bottom,left:H.left-G.left+L.left,right:G.right-H.right+L.right},B=n.modifiersData.offset;if(x===og&&B){var ne=B[r];Object.keys(j).forEach(function(J){var le=[ol,sl].indexOf(J)>=0?1:-1,ae=[ra,sl].indexOf(J)>=0?"y":"x";j[J]+=ne[ae]*le})}return j}function b5(n,e){e===void 0&&(e={});var t=e,i=t.placement,r=t.boundary,o=t.rootBoundary,c=t.padding,s=t.flipVariations,f=t.allowedAutoPlacements,p=f===void 0?i2:f,g=kg(i),_=g?s?UT:UT.filter(function(M){return kg(M)===g}):Jg,x=_.filter(function(M){return p.indexOf(M)>=0});x.length===0&&(x=_);var b=x.reduce(function(M,P){return M[P]=Dg(n,{placement:P,boundary:r,rootBoundary:o,padding:c})[cu(P)],M},{});return Object.keys(b).sort(function(M,P){return b[M]-b[P]})}function x5(n){if(cu(n)===Mw)return[];var e=gx(n);return[ZA(n),e,ZA(e)]}function w5(n){var e=n.state,t=n.options,i=n.name;if(!e.modifiersData[i]._skip){for(var r=t.mainAxis,o=r===void 0?!0:r,c=t.altAxis,s=c===void 0?!0:c,f=t.fallbackPlacements,p=t.padding,g=t.boundary,_=t.rootBoundary,x=t.altBoundary,b=t.flipVariations,M=b===void 0?!0:b,P=t.allowedAutoPlacements,k=e.options.placement,L=cu(k),I=L===k,F=f||(I||!M?[gx(k)]:x5(k)),N=[k].concat(F).reduce(function(Oe,lt){return Oe.concat(cu(lt)===Mw?b5(e,{placement:lt,boundary:g,rootBoundary:_,padding:p,flipVariations:M,allowedAutoPlacements:P}):lt)},[]),H=e.rects.reference,Y=e.rects.popper,q=new Map,U=!0,G=N[0],j=0;j<N.length;j++){var B=N[j],ne=cu(B),J=kg(B)===cp,le=[ra,sl].indexOf(ne)>=0,ae=le?"width":"height",pe=Dg(e,{placement:B,boundary:g,rootBoundary:_,altBoundary:x,padding:p}),fe=le?J?ol:sa:J?sl:ra;H[ae]>Y[ae]&&(fe=gx(fe));var Te=gx(fe),Ce=[];if(o&&Ce.push(pe[ne]<=0),s&&Ce.push(pe[fe]<=0,pe[Te]<=0),Ce.every(function(Oe){return Oe})){G=B,U=!1;break}q.set(B,Ce)}if(U)for(var tt=M?3:1,Ke=function(lt){var Ye=N.find(function(zt){var Lt=q.get(zt);if(Lt)return Lt.slice(0,lt).every(function(At){return At})});if(Ye)return G=Ye,"break"},dt=tt;dt>0;dt--){var et=Ke(dt);if(et==="break")break}e.placement!==G&&(e.modifiersData[i]._skip=!0,e.placement=G,e.reset=!0)}}const gk={name:"flip",enabled:!0,phase:"main",fn:w5,requiresIfExists:["offset"],data:{_skip:!1}};function YA(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function KA(n){return[ra,ol,sl,sa].some(function(e){return n[e]>=0})}function S5(n){var e=n.state,t=n.name,i=e.rects.reference,r=e.rects.popper,o=e.modifiersData.preventOverflow,c=Dg(e,{elementContext:"reference"}),s=Dg(e,{altBoundary:!0}),f=YA(c,i),p=YA(s,r,o),g=KA(f),_=KA(p);e.modifiersData[t]={referenceClippingOffsets:f,popperEscapeOffsets:p,isReferenceHidden:g,hasPopperEscaped:_},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":g,"data-popper-escaped":_})}const _k={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:S5};function T5(n,e,t){var i=cu(n),r=[sa,ra].indexOf(i)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,c=o[0],s=o[1];return c=c||0,s=(s||0)*r,[sa,ol].indexOf(i)>=0?{x:s,y:c}:{x:c,y:s}}function M5(n){var e=n.state,t=n.options,i=n.name,r=t.offset,o=r===void 0?[0,0]:r,c=i2.reduce(function(g,_){return g[_]=T5(_,e.rects,o),g},{}),s=c[e.placement],f=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=f,e.modifiersData.popperOffsets.y+=p),e.modifiersData[i]=c}const vk={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:M5};function C5(n){var e=n.state,t=n.name;e.modifiersData[t]=mk({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const d2={name:"popperOffsets",enabled:!0,phase:"read",fn:C5,data:{}};function E5(n){return n==="x"?"y":"x"}function A5(n){var e=n.state,t=n.options,i=n.name,r=t.mainAxis,o=r===void 0?!0:r,c=t.altAxis,s=c===void 0?!1:c,f=t.boundary,p=t.rootBoundary,g=t.altBoundary,_=t.padding,x=t.tether,b=x===void 0?!0:x,M=t.tetherOffset,P=M===void 0?0:M,k=Dg(e,{boundary:f,rootBoundary:p,padding:_,altBoundary:g}),L=cu(e.placement),I=kg(e.placement),F=!I,N=o2(L),H=E5(N),Y=e.modifiersData.popperOffsets,q=e.rects.reference,U=e.rects.popper,G=typeof P=="function"?P(Object.assign({},e.rects,{placement:e.placement})):P,j=typeof G=="number"?{mainAxis:G,altAxis:G}:Object.assign({mainAxis:0,altAxis:0},G),B=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ne={x:0,y:0};if(Y){if(o){var J,le=N==="y"?ra:sa,ae=N==="y"?sl:ol,pe=N==="y"?"height":"width",fe=Y[N],Te=fe+k[le],Ce=fe-k[ae],tt=b?-U[pe]/2:0,Ke=I===cp?q[pe]:U[pe],dt=I===cp?-U[pe]:-q[pe],et=e.elements.arrow,Oe=b&&et?s2(et):{width:0,height:0},lt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:uk(),Ye=lt[le],zt=lt[ae],Lt=Hv(0,q[pe],Oe[pe]),At=F?q[pe]/2-tt-Lt-Ye-j.mainAxis:Ke-Lt-Ye-j.mainAxis,Nt=F?-q[pe]/2+tt+Lt+zt+j.mainAxis:dt+Lt+zt+j.mainAxis,$t=e.elements.arrow&&Wy(e.elements.arrow),Ze=$t?N==="y"?$t.clientTop||0:$t.clientLeft||0:0,bt=(J=B?.[N])!=null?J:0,Mt=fe+At-bt-Ze,Zt=fe+Nt-bt,Pt=Hv(b?Dx(Te,Mt):Te,fe,b?Jf(Ce,Zt):Ce);Y[N]=Pt,ne[N]=Pt-fe}if(s){var Ee,xe=N==="x"?ra:sa,ft=N==="x"?sl:ol,ve=Y[H],te=H==="y"?"height":"width",se=ve+k[xe],Ie=ve-k[ft],Ue=[ra,sa].indexOf(L)!==-1,ct=(Ee=B?.[H])!=null?Ee:0,we=Ue?se:ve-q[te]-U[te]-ct+j.altAxis,Q=Ue?ve+q[te]+U[te]-ct-j.altAxis:Ie,ue=b&&Ue?s5(we,ve,Q):Hv(b?we:se,ve,b?Q:Ie);Y[H]=ue,ne[H]=ue-ve}e.modifiersData[i]=ne}}const yk={name:"preventOverflow",enabled:!0,phase:"main",fn:A5,requiresIfExists:["offset"]};function P5(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function I5(n){return n===al(n)||!Ol(n)?c2(n):P5(n)}function L5(n){var e=n.getBoundingClientRect(),t=Lg(e.width)/n.offsetWidth||1,i=Lg(e.height)/n.offsetHeight||1;return t!==1||i!==1}function R5(n,e,t){t===void 0&&(t=!1);var i=Ol(e),r=Ol(e)&&L5(e),o=Gd(e),c=Rg(n,r,t),s={scrollLeft:0,scrollTop:0},f={x:0,y:0};return(i||!i&&!t)&&((pu(e)!=="body"||h2(o))&&(s=I5(e)),Ol(e)?(f=Rg(e,!0),f.x+=e.clientLeft,f.y+=e.clientTop):o&&(f.x=u2(o))),{x:c.left+s.scrollLeft-f.x,y:c.top+s.scrollTop-f.y,width:c.width,height:c.height}}function k5(n){var e=new Map,t=new Set,i=[];n.forEach(function(o){e.set(o.name,o)});function r(o){t.add(o.name);var c=[].concat(o.requires||[],o.requiresIfExists||[]);c.forEach(function(s){if(!t.has(s)){var f=e.get(s);f&&r(f)}}),i.push(o)}return n.forEach(function(o){t.has(o.name)||r(o)}),i}function D5(n){var e=k5(n);return ak.reduce(function(t,i){return t.concat(e.filter(function(r){return r.phase===i}))},[])}function F5(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function O5(n){var e=n.reduce(function(t,i){var r=t[i.name];return t[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var JA={placement:"bottom",modifiers:[],strategy:"absolute"};function QA(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Ew(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,i=t===void 0?[]:t,r=e.defaultOptions,o=r===void 0?JA:r;return function(s,f,p){p===void 0&&(p=o);var g={placement:"bottom",orderedModifiers:[],options:Object.assign({},JA,o),modifiersData:{},elements:{reference:s,popper:f},attributes:{},styles:{}},_=[],x=!1,b={state:g,setOptions:function(L){var I=typeof L=="function"?L(g.options):L;P(),g.options=Object.assign({},o,g.options,I),g.scrollParents={reference:up(s)?Wv(s):s.contextElement?Wv(s.contextElement):[],popper:Wv(f)};var F=D5(O5([].concat(i,g.options.modifiers)));return g.orderedModifiers=F.filter(function(N){return N.enabled}),M(),b.update()},forceUpdate:function(){if(!x){var L=g.elements,I=L.reference,F=L.popper;if(QA(I,F)){g.rects={reference:R5(I,Wy(F),g.options.strategy==="fixed"),popper:s2(F)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(j){return g.modifiersData[j.name]=Object.assign({},j.data)});for(var N=0;N<g.orderedModifiers.length;N++){if(g.reset===!0){g.reset=!1,N=-1;continue}var H=g.orderedModifiers[N],Y=H.fn,q=H.options,U=q===void 0?{}:q,G=H.name;typeof Y=="function"&&(g=Y({state:g,options:U,name:G,instance:b})||g)}}}},update:F5(function(){return new Promise(function(k){b.forceUpdate(),k(g)})}),destroy:function(){P(),x=!0}};if(!QA(s,f))return b;b.setOptions(p).then(function(k){!x&&p.onFirstUpdate&&p.onFirstUpdate(k)});function M(){g.orderedModifiers.forEach(function(k){var L=k.name,I=k.options,F=I===void 0?{}:I,N=k.effect;if(typeof N=="function"){var H=N({state:g,name:L,instance:b,options:F}),Y=function(){};_.push(H||Y)}})}function P(){_.forEach(function(k){return k()}),_=[]}return b}}var z5=Ew(),B5=[l2,d2,a2,r2],N5=Ew({defaultModifiers:B5}),$5=[l2,d2,a2,r2,vk,gk,yk,fk,_k],V5=Ew({defaultModifiers:$5});const U5=Object.freeze(Object.defineProperty({__proto__:null,afterMain:nk,afterRead:ek,afterWrite:ok,applyStyles:r2,arrow:fk,auto:Mw,basePlacements:Jg,beforeMain:tk,beforeRead:JR,beforeWrite:rk,bottom:sl,clippingParents:YR,computeStyles:a2,createPopper:V5,createPopperBase:z5,createPopperLite:N5,detectOverflow:Dg,end:Ig,eventListeners:l2,flip:gk,hide:_k,left:sa,main:ik,modifierPhases:ak,offset:vk,placements:i2,popper:og,popperGenerator:Ew,popperOffsets:d2,preventOverflow:yk,read:QR,reference:KR,right:ol,start:cp,top:ra,variationPlacements:UT,viewport:t2,write:sk},Symbol.toStringTag,{value:"Module"})),j5=e5(U5);var G5=mx.exports,eP;function q5(){return eP||(eP=1,(function(n,e){(function(t,i){n.exports=i(j5)})(G5,function(t){function i(it){const Z=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(it){for(const ye in it)if(ye!=="default"){const nt=Object.getOwnPropertyDescriptor(it,ye);Object.defineProperty(Z,ye,nt.get?nt:{enumerable:!0,get:()=>it[ye]})}}return Z.default=it,Object.freeze(Z)}const r=i(t),o=new Map,c={set(it,Z,ye){o.has(it)||o.set(it,new Map);const nt=o.get(it);nt.has(Z)||nt.size===0?nt.set(Z,ye):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(nt.keys())[0]}.`)},get:(it,Z)=>o.has(it)&&o.get(it).get(Z)||null,remove(it,Z){if(!o.has(it))return;const ye=o.get(it);ye.delete(Z),ye.size===0&&o.delete(it)}},s="transitionend",f=it=>(it&&window.CSS&&window.CSS.escape&&(it=it.replace(/#([^\s"#']+)/g,(Z,ye)=>`#${CSS.escape(ye)}`)),it),p=it=>it==null?`${it}`:Object.prototype.toString.call(it).match(/\s([a-z]+)/i)[1].toLowerCase(),g=it=>{it.dispatchEvent(new Event(s))},_=it=>!(!it||typeof it!="object")&&(it.jquery!==void 0&&(it=it[0]),it.nodeType!==void 0),x=it=>_(it)?it.jquery?it[0]:it:typeof it=="string"&&it.length>0?document.querySelector(f(it)):null,b=it=>{if(!_(it)||it.getClientRects().length===0)return!1;const Z=getComputedStyle(it).getPropertyValue("visibility")==="visible",ye=it.closest("details:not([open])");if(!ye)return Z;if(ye!==it){const nt=it.closest("summary");if(nt&&nt.parentNode!==ye||nt===null)return!1}return Z},M=it=>!it||it.nodeType!==Node.ELEMENT_NODE||!!it.classList.contains("disabled")||(it.disabled!==void 0?it.disabled:it.hasAttribute("disabled")&&it.getAttribute("disabled")!=="false"),P=it=>{if(!document.documentElement.attachShadow)return null;if(typeof it.getRootNode=="function"){const Z=it.getRootNode();return Z instanceof ShadowRoot?Z:null}return it instanceof ShadowRoot?it:it.parentNode?P(it.parentNode):null},k=()=>{},L=it=>{it.offsetHeight},I=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,F=[],N=()=>document.documentElement.dir==="rtl",H=it=>{var Z;Z=()=>{const ye=I();if(ye){const nt=it.NAME,qt=ye.fn[nt];ye.fn[nt]=it.jQueryInterface,ye.fn[nt].Constructor=it,ye.fn[nt].noConflict=()=>(ye.fn[nt]=qt,it.jQueryInterface)}},document.readyState==="loading"?(F.length||document.addEventListener("DOMContentLoaded",()=>{for(const ye of F)ye()}),F.push(Z)):Z()},Y=(it,Z=[],ye=it)=>typeof it=="function"?it.call(...Z):ye,q=(it,Z,ye=!0)=>{if(!ye)return void Y(it);const nt=(Ti=>{if(!Ti)return 0;let{transitionDuration:_n,transitionDelay:fr}=window.getComputedStyle(Ti);const Ms=Number.parseFloat(_n),ji=Number.parseFloat(fr);return Ms||ji?(_n=_n.split(",")[0],fr=fr.split(",")[0],1e3*(Number.parseFloat(_n)+Number.parseFloat(fr))):0})(Z)+5;let qt=!1;const di=({target:Ti})=>{Ti===Z&&(qt=!0,Z.removeEventListener(s,di),Y(it))};Z.addEventListener(s,di),setTimeout(()=>{qt||g(Z)},nt)},U=(it,Z,ye,nt)=>{const qt=it.length;let di=it.indexOf(Z);return di===-1?!ye&&nt?it[qt-1]:it[0]:(di+=ye?1:-1,nt&&(di=(di+qt)%qt),it[Math.max(0,Math.min(di,qt-1))])},G=/[^.]*(?=\..*)\.|.*/,j=/\..*/,B=/::\d+$/,ne={};let J=1;const le={mouseenter:"mouseover",mouseleave:"mouseout"},ae=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function pe(it,Z){return Z&&`${Z}::${J++}`||it.uidEvent||J++}function fe(it){const Z=pe(it);return it.uidEvent=Z,ne[Z]=ne[Z]||{},ne[Z]}function Te(it,Z,ye=null){return Object.values(it).find(nt=>nt.callable===Z&&nt.delegationSelector===ye)}function Ce(it,Z,ye){const nt=typeof Z=="string",qt=nt?ye:Z||ye;let di=et(it);return ae.has(di)||(di=it),[nt,qt,di]}function tt(it,Z,ye,nt,qt){if(typeof Z!="string"||!it)return;let[di,Ti,_n]=Ce(Z,ye,nt);Z in le&&(Ti=(jo=>function(Go){if(!Go.relatedTarget||Go.relatedTarget!==Go.delegateTarget&&!Go.delegateTarget.contains(Go.relatedTarget))return jo.call(this,Go)})(Ti));const fr=fe(it),Ms=fr[_n]||(fr[_n]={}),ji=Te(Ms,Ti,di?ye:null);if(ji)return void(ji.oneOff=ji.oneOff&&qt);const Ks=pe(Ti,Z.replace(G,"")),Ra=di?(function(la,jo,Go){return function Ou(zu){const p_=la.querySelectorAll(jo);for(let{target:ka}=zu;ka&&ka!==this;ka=ka.parentNode)for(const zc of p_)if(zc===ka)return lt(zu,{delegateTarget:ka}),Ou.oneOff&&Oe.off(la,zu.type,jo,Go),Go.apply(ka,[zu])}})(it,ye,Ti):(function(la,jo){return function Go(Ou){return lt(Ou,{delegateTarget:la}),Go.oneOff&&Oe.off(la,Ou.type,jo),jo.apply(la,[Ou])}})(it,Ti);Ra.delegationSelector=di?ye:null,Ra.callable=Ti,Ra.oneOff=qt,Ra.uidEvent=Ks,Ms[Ks]=Ra,it.addEventListener(_n,Ra,di)}function Ke(it,Z,ye,nt,qt){const di=Te(Z[ye],nt,qt);di&&(it.removeEventListener(ye,di,!!qt),delete Z[ye][di.uidEvent])}function dt(it,Z,ye,nt){const qt=Z[ye]||{};for(const[di,Ti]of Object.entries(qt))di.includes(nt)&&Ke(it,Z,ye,Ti.callable,Ti.delegationSelector)}function et(it){return it=it.replace(j,""),le[it]||it}const Oe={on(it,Z,ye,nt){tt(it,Z,ye,nt,!1)},one(it,Z,ye,nt){tt(it,Z,ye,nt,!0)},off(it,Z,ye,nt){if(typeof Z!="string"||!it)return;const[qt,di,Ti]=Ce(Z,ye,nt),_n=Ti!==Z,fr=fe(it),Ms=fr[Ti]||{},ji=Z.startsWith(".");if(di===void 0){if(ji)for(const Ks of Object.keys(fr))dt(it,fr,Ks,Z.slice(1));for(const[Ks,Ra]of Object.entries(Ms)){const la=Ks.replace(B,"");_n&&!Z.includes(la)||Ke(it,fr,Ti,Ra.callable,Ra.delegationSelector)}}else{if(!Object.keys(Ms).length)return;Ke(it,fr,Ti,di,qt?ye:null)}},trigger(it,Z,ye){if(typeof Z!="string"||!it)return null;const nt=I();let qt=null,di=!0,Ti=!0,_n=!1;Z!==et(Z)&&nt&&(qt=nt.Event(Z,ye),nt(it).trigger(qt),di=!qt.isPropagationStopped(),Ti=!qt.isImmediatePropagationStopped(),_n=qt.isDefaultPrevented());const fr=lt(new Event(Z,{bubbles:di,cancelable:!0}),ye);return _n&&fr.preventDefault(),Ti&&it.dispatchEvent(fr),fr.defaultPrevented&&qt&&qt.preventDefault(),fr}};function lt(it,Z={}){for(const[ye,nt]of Object.entries(Z))try{it[ye]=nt}catch{Object.defineProperty(it,ye,{configurable:!0,get:()=>nt})}return it}function Ye(it){if(it==="true")return!0;if(it==="false")return!1;if(it===Number(it).toString())return Number(it);if(it===""||it==="null")return null;if(typeof it!="string")return it;try{return JSON.parse(decodeURIComponent(it))}catch{return it}}function zt(it){return it.replace(/[A-Z]/g,Z=>`-${Z.toLowerCase()}`)}const Lt={setDataAttribute(it,Z,ye){it.setAttribute(`data-bs-${zt(Z)}`,ye)},removeDataAttribute(it,Z){it.removeAttribute(`data-bs-${zt(Z)}`)},getDataAttributes(it){if(!it)return{};const Z={},ye=Object.keys(it.dataset).filter(nt=>nt.startsWith("bs")&&!nt.startsWith("bsConfig"));for(const nt of ye){let qt=nt.replace(/^bs/,"");qt=qt.charAt(0).toLowerCase()+qt.slice(1),Z[qt]=Ye(it.dataset[nt])}return Z},getDataAttribute:(it,Z)=>Ye(it.getAttribute(`data-bs-${zt(Z)}`))};class At{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(Z){return Z=this._mergeConfigObj(Z),Z=this._configAfterMerge(Z),this._typeCheckConfig(Z),Z}_configAfterMerge(Z){return Z}_mergeConfigObj(Z,ye){const nt=_(ye)?Lt.getDataAttribute(ye,"config"):{};return{...this.constructor.Default,...typeof nt=="object"?nt:{},..._(ye)?Lt.getDataAttributes(ye):{},...typeof Z=="object"?Z:{}}}_typeCheckConfig(Z,ye=this.constructor.DefaultType){for(const[nt,qt]of Object.entries(ye)){const di=Z[nt],Ti=_(di)?"element":p(di);if(!new RegExp(qt).test(Ti))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${nt}" provided type "${Ti}" but expected type "${qt}".`)}}}class Nt extends At{constructor(Z,ye){super(),(Z=x(Z))&&(this._element=Z,this._config=this._getConfig(ye),c.set(this._element,this.constructor.DATA_KEY,this))}dispose(){c.remove(this._element,this.constructor.DATA_KEY),Oe.off(this._element,this.constructor.EVENT_KEY);for(const Z of Object.getOwnPropertyNames(this))this[Z]=null}_queueCallback(Z,ye,nt=!0){q(Z,ye,nt)}_getConfig(Z){return Z=this._mergeConfigObj(Z,this._element),Z=this._configAfterMerge(Z),this._typeCheckConfig(Z),Z}static getInstance(Z){return c.get(x(Z),this.DATA_KEY)}static getOrCreateInstance(Z,ye={}){return this.getInstance(Z)||new this(Z,typeof ye=="object"?ye:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(Z){return`${Z}${this.EVENT_KEY}`}}const $t=it=>{let Z=it.getAttribute("data-bs-target");if(!Z||Z==="#"){let ye=it.getAttribute("href");if(!ye||!ye.includes("#")&&!ye.startsWith("."))return null;ye.includes("#")&&!ye.startsWith("#")&&(ye=`#${ye.split("#")[1]}`),Z=ye&&ye!=="#"?ye.trim():null}return Z?Z.split(",").map(ye=>f(ye)).join(","):null},Ze={find:(it,Z=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(Z,it)),findOne:(it,Z=document.documentElement)=>Element.prototype.querySelector.call(Z,it),children:(it,Z)=>[].concat(...it.children).filter(ye=>ye.matches(Z)),parents(it,Z){const ye=[];let nt=it.parentNode.closest(Z);for(;nt;)ye.push(nt),nt=nt.parentNode.closest(Z);return ye},prev(it,Z){let ye=it.previousElementSibling;for(;ye;){if(ye.matches(Z))return[ye];ye=ye.previousElementSibling}return[]},next(it,Z){let ye=it.nextElementSibling;for(;ye;){if(ye.matches(Z))return[ye];ye=ye.nextElementSibling}return[]},focusableChildren(it){const Z=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(ye=>`${ye}:not([tabindex^="-"])`).join(",");return this.find(Z,it).filter(ye=>!M(ye)&&b(ye))},getSelectorFromElement(it){const Z=$t(it);return Z&&Ze.findOne(Z)?Z:null},getElementFromSelector(it){const Z=$t(it);return Z?Ze.findOne(Z):null},getMultipleElementsFromSelector(it){const Z=$t(it);return Z?Ze.find(Z):[]}},bt=(it,Z="hide")=>{const ye=`click.dismiss${it.EVENT_KEY}`,nt=it.NAME;Oe.on(document,ye,`[data-bs-dismiss="${nt}"]`,function(qt){if(["A","AREA"].includes(this.tagName)&&qt.preventDefault(),M(this))return;const di=Ze.getElementFromSelector(this)||this.closest(`.${nt}`);it.getOrCreateInstance(di)[Z]()})},Mt=".bs.alert",Zt=`close${Mt}`,Pt=`closed${Mt}`;class Ee extends Nt{static get NAME(){return"alert"}close(){if(Oe.trigger(this._element,Zt).defaultPrevented)return;this._element.classList.remove("show");const Z=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,Z)}_destroyElement(){this._element.remove(),Oe.trigger(this._element,Pt),this.dispose()}static jQueryInterface(Z){return this.each(function(){const ye=Ee.getOrCreateInstance(this);if(typeof Z=="string"){if(ye[Z]===void 0||Z.startsWith("_")||Z==="constructor")throw new TypeError(`No method named "${Z}"`);ye[Z](this)}})}}bt(Ee,"close"),H(Ee);const xe='[data-bs-toggle="button"]';class ft extends Nt{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(Z){return this.each(function(){const ye=ft.getOrCreateInstance(this);Z==="toggle"&&ye[Z]()})}}Oe.on(document,"click.bs.button.data-api",xe,it=>{it.preventDefault();const Z=it.target.closest(xe);ft.getOrCreateInstance(Z).toggle()}),H(ft);const ve=".bs.swipe",te=`touchstart${ve}`,se=`touchmove${ve}`,Ie=`touchend${ve}`,Ue=`pointerdown${ve}`,ct=`pointerup${ve}`,we={endCallback:null,leftCallback:null,rightCallback:null},Q={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class ue extends At{constructor(Z,ye){super(),this._element=Z,Z&&ue.isSupported()&&(this._config=this._getConfig(ye),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return we}static get DefaultType(){return Q}static get NAME(){return"swipe"}dispose(){Oe.off(this._element,ve)}_start(Z){this._supportPointerEvents?this._eventIsPointerPenTouch(Z)&&(this._deltaX=Z.clientX):this._deltaX=Z.touches[0].clientX}_end(Z){this._eventIsPointerPenTouch(Z)&&(this._deltaX=Z.clientX-this._deltaX),this._handleSwipe(),Y(this._config.endCallback)}_move(Z){this._deltaX=Z.touches&&Z.touches.length>1?0:Z.touches[0].clientX-this._deltaX}_handleSwipe(){const Z=Math.abs(this._deltaX);if(Z<=40)return;const ye=Z/this._deltaX;this._deltaX=0,ye&&Y(ye>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Oe.on(this._element,Ue,Z=>this._start(Z)),Oe.on(this._element,ct,Z=>this._end(Z)),this._element.classList.add("pointer-event")):(Oe.on(this._element,te,Z=>this._start(Z)),Oe.on(this._element,se,Z=>this._move(Z)),Oe.on(this._element,Ie,Z=>this._end(Z)))}_eventIsPointerPenTouch(Z){return this._supportPointerEvents&&(Z.pointerType==="pen"||Z.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const de=".bs.carousel",Pe=".data-api",Re="ArrowLeft",rt="ArrowRight",ot="next",Xe="prev",mt="left",Et="right",kt=`slide${de}`,Jt=`slid${de}`,vi=`keydown${de}`,$i=`mouseenter${de}`,vn=`mouseleave${de}`,rn=`dragstart${de}`,gt=`load${de}${Pe}`,gn=`click${de}${Pe}`,Er="carousel",Di="active",yn=".active",Yn=".carousel-item",Cn=yn+Yn,Vn={[Re]:Et,[rt]:mt},En={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},dr={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class $e extends Nt{constructor(Z,ye){super(Z,ye),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Ze.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===Er&&this.cycle()}static get Default(){return En}static get DefaultType(){return dr}static get NAME(){return"carousel"}next(){this._slide(ot)}nextWhenVisible(){!document.hidden&&b(this._element)&&this.next()}prev(){this._slide(Xe)}pause(){this._isSliding&&g(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?Oe.one(this._element,Jt,()=>this.cycle()):this.cycle())}to(Z){const ye=this._getItems();if(Z>ye.length-1||Z<0)return;if(this._isSliding)return void Oe.one(this._element,Jt,()=>this.to(Z));const nt=this._getItemIndex(this._getActive());if(nt===Z)return;const qt=Z>nt?ot:Xe;this._slide(qt,ye[Z])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(Z){return Z.defaultInterval=Z.interval,Z}_addEventListeners(){this._config.keyboard&&Oe.on(this._element,vi,Z=>this._keydown(Z)),this._config.pause==="hover"&&(Oe.on(this._element,$i,()=>this.pause()),Oe.on(this._element,vn,()=>this._maybeEnableCycle())),this._config.touch&&ue.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const ye of Ze.find(".carousel-item img",this._element))Oe.on(ye,rn,nt=>nt.preventDefault());const Z={leftCallback:()=>this._slide(this._directionToOrder(mt)),rightCallback:()=>this._slide(this._directionToOrder(Et)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new ue(this._element,Z)}_keydown(Z){if(/input|textarea/i.test(Z.target.tagName))return;const ye=Vn[Z.key];ye&&(Z.preventDefault(),this._slide(this._directionToOrder(ye)))}_getItemIndex(Z){return this._getItems().indexOf(Z)}_setActiveIndicatorElement(Z){if(!this._indicatorsElement)return;const ye=Ze.findOne(yn,this._indicatorsElement);ye.classList.remove(Di),ye.removeAttribute("aria-current");const nt=Ze.findOne(`[data-bs-slide-to="${Z}"]`,this._indicatorsElement);nt&&(nt.classList.add(Di),nt.setAttribute("aria-current","true"))}_updateInterval(){const Z=this._activeElement||this._getActive();if(!Z)return;const ye=Number.parseInt(Z.getAttribute("data-bs-interval"),10);this._config.interval=ye||this._config.defaultInterval}_slide(Z,ye=null){if(this._isSliding)return;const nt=this._getActive(),qt=Z===ot,di=ye||U(this._getItems(),nt,qt,this._config.wrap);if(di===nt)return;const Ti=this._getItemIndex(di),_n=Ks=>Oe.trigger(this._element,Ks,{relatedTarget:di,direction:this._orderToDirection(Z),from:this._getItemIndex(nt),to:Ti});if(_n(kt).defaultPrevented||!nt||!di)return;const fr=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Ti),this._activeElement=di;const Ms=qt?"carousel-item-start":"carousel-item-end",ji=qt?"carousel-item-next":"carousel-item-prev";di.classList.add(ji),L(di),nt.classList.add(Ms),di.classList.add(Ms),this._queueCallback(()=>{di.classList.remove(Ms,ji),di.classList.add(Di),nt.classList.remove(Di,ji,Ms),this._isSliding=!1,_n(Jt)},nt,this._isAnimated()),fr&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Ze.findOne(Cn,this._element)}_getItems(){return Ze.find(Yn,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(Z){return N()?Z===mt?Xe:ot:Z===mt?ot:Xe}_orderToDirection(Z){return N()?Z===Xe?mt:Et:Z===Xe?Et:mt}static jQueryInterface(Z){return this.each(function(){const ye=$e.getOrCreateInstance(this,Z);if(typeof Z!="number"){if(typeof Z=="string"){if(ye[Z]===void 0||Z.startsWith("_")||Z==="constructor")throw new TypeError(`No method named "${Z}"`);ye[Z]()}}else ye.to(Z)})}}Oe.on(document,gn,"[data-bs-slide], [data-bs-slide-to]",function(it){const Z=Ze.getElementFromSelector(this);if(!Z||!Z.classList.contains(Er))return;it.preventDefault();const ye=$e.getOrCreateInstance(Z),nt=this.getAttribute("data-bs-slide-to");return nt?(ye.to(nt),void ye._maybeEnableCycle()):Lt.getDataAttribute(this,"slide")==="next"?(ye.next(),void ye._maybeEnableCycle()):(ye.prev(),void ye._maybeEnableCycle())}),Oe.on(window,gt,()=>{const it=Ze.find('[data-bs-ride="carousel"]');for(const Z of it)$e.getOrCreateInstance(Z)}),H($e);const Ct=".bs.collapse",Qe=`show${Ct}`,It=`shown${Ct}`,Gt=`hide${Ct}`,qi=`hidden${Ct}`,Ii=`click${Ct}.data-api`,Dt="show",ai="collapse",pi="collapsing",Hi=`:scope .${ai} .${ai}`,ut='[data-bs-toggle="collapse"]',Li={parent:null,toggle:!0},bi={parent:"(null|element)",toggle:"boolean"};class Ni extends Nt{constructor(Z,ye){super(Z,ye),this._isTransitioning=!1,this._triggerArray=[];const nt=Ze.find(ut);for(const qt of nt){const di=Ze.getSelectorFromElement(qt),Ti=Ze.find(di).filter(_n=>_n===this._element);di!==null&&Ti.length&&this._triggerArray.push(qt)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Li}static get DefaultType(){return bi}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let Z=[];if(this._config.parent&&(Z=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(qt=>qt!==this._element).map(qt=>Ni.getOrCreateInstance(qt,{toggle:!1}))),Z.length&&Z[0]._isTransitioning||Oe.trigger(this._element,Qe).defaultPrevented)return;for(const qt of Z)qt.hide();const ye=this._getDimension();this._element.classList.remove(ai),this._element.classList.add(pi),this._element.style[ye]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const nt=`scroll${ye[0].toUpperCase()+ye.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(pi),this._element.classList.add(ai,Dt),this._element.style[ye]="",Oe.trigger(this._element,It)},this._element,!0),this._element.style[ye]=`${this._element[nt]}px`}hide(){if(this._isTransitioning||!this._isShown()||Oe.trigger(this._element,Gt).defaultPrevented)return;const Z=this._getDimension();this._element.style[Z]=`${this._element.getBoundingClientRect()[Z]}px`,L(this._element),this._element.classList.add(pi),this._element.classList.remove(ai,Dt);for(const ye of this._triggerArray){const nt=Ze.getElementFromSelector(ye);nt&&!this._isShown(nt)&&this._addAriaAndCollapsedClass([ye],!1)}this._isTransitioning=!0,this._element.style[Z]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(pi),this._element.classList.add(ai),Oe.trigger(this._element,qi)},this._element,!0)}_isShown(Z=this._element){return Z.classList.contains(Dt)}_configAfterMerge(Z){return Z.toggle=!!Z.toggle,Z.parent=x(Z.parent),Z}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const Z=this._getFirstLevelChildren(ut);for(const ye of Z){const nt=Ze.getElementFromSelector(ye);nt&&this._addAriaAndCollapsedClass([ye],this._isShown(nt))}}_getFirstLevelChildren(Z){const ye=Ze.find(Hi,this._config.parent);return Ze.find(Z,this._config.parent).filter(nt=>!ye.includes(nt))}_addAriaAndCollapsedClass(Z,ye){if(Z.length)for(const nt of Z)nt.classList.toggle("collapsed",!ye),nt.setAttribute("aria-expanded",ye)}static jQueryInterface(Z){const ye={};return typeof Z=="string"&&/show|hide/.test(Z)&&(ye.toggle=!1),this.each(function(){const nt=Ni.getOrCreateInstance(this,ye);if(typeof Z=="string"){if(nt[Z]===void 0)throw new TypeError(`No method named "${Z}"`);nt[Z]()}})}}Oe.on(document,Ii,ut,function(it){(it.target.tagName==="A"||it.delegateTarget&&it.delegateTarget.tagName==="A")&&it.preventDefault();for(const Z of Ze.getMultipleElementsFromSelector(this))Ni.getOrCreateInstance(Z,{toggle:!1}).toggle()}),H(Ni);const Kn="dropdown",Zi=".bs.dropdown",Un=".data-api",sn="ArrowUp",zr="ArrowDown",jn=`hide${Zi}`,an=`hidden${Zi}`,Qi=`show${Zi}`,ts=`shown${Zi}`,ro=`click${Zi}${Un}`,hl=`keydown${Zi}${Un}`,xo=`keyup${Zi}${Un}`,Ar="show",nr='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',jl=`${nr}.${Ar}`,Gl=".dropdown-menu",_r=N()?"top-end":"top-start",Mp=N()?"top-start":"top-end",Cp=N()?"bottom-end":"bottom-start",wu=N()?"bottom-start":"bottom-end",Ep=N()?"left-start":"right-start",Ap=N()?"right-start":"left-start",Pp={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Dh={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class so extends Nt{constructor(Z,ye){super(Z,ye),this._popper=null,this._parent=this._element.parentNode,this._menu=Ze.next(this._element,Gl)[0]||Ze.prev(this._element,Gl)[0]||Ze.findOne(Gl,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Pp}static get DefaultType(){return Dh}static get NAME(){return Kn}toggle(){return this._isShown()?this.hide():this.show()}show(){if(M(this._element)||this._isShown())return;const Z={relatedTarget:this._element};if(!Oe.trigger(this._element,Qi,Z).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const ye of[].concat(...document.body.children))Oe.on(ye,"mouseover",k);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Ar),this._element.classList.add(Ar),Oe.trigger(this._element,ts,Z)}}hide(){if(M(this._element)||!this._isShown())return;const Z={relatedTarget:this._element};this._completeHide(Z)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(Z){if(!Oe.trigger(this._element,jn,Z).defaultPrevented){if("ontouchstart"in document.documentElement)for(const ye of[].concat(...document.body.children))Oe.off(ye,"mouseover",k);this._popper&&this._popper.destroy(),this._menu.classList.remove(Ar),this._element.classList.remove(Ar),this._element.setAttribute("aria-expanded","false"),Lt.removeDataAttribute(this._menu,"popper"),Oe.trigger(this._element,an,Z)}}_getConfig(Z){if(typeof(Z=super._getConfig(Z)).reference=="object"&&!_(Z.reference)&&typeof Z.reference.getBoundingClientRect!="function")throw new TypeError(`${Kn.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return Z}_createPopper(){if(r===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let Z=this._element;this._config.reference==="parent"?Z=this._parent:_(this._config.reference)?Z=x(this._config.reference):typeof this._config.reference=="object"&&(Z=this._config.reference);const ye=this._getPopperConfig();this._popper=r.createPopper(Z,this._menu,ye)}_isShown(){return this._menu.classList.contains(Ar)}_getPlacement(){const Z=this._parent;if(Z.classList.contains("dropend"))return Ep;if(Z.classList.contains("dropstart"))return Ap;if(Z.classList.contains("dropup-center"))return"top";if(Z.classList.contains("dropdown-center"))return"bottom";const ye=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return Z.classList.contains("dropup")?ye?Mp:_r:ye?wu:Cp}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:Z}=this._config;return typeof Z=="string"?Z.split(",").map(ye=>Number.parseInt(ye,10)):typeof Z=="function"?ye=>Z(ye,this._element):Z}_getPopperConfig(){const Z={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Lt.setDataAttribute(this._menu,"popper","static"),Z.modifiers=[{name:"applyStyles",enabled:!1}]),{...Z,...Y(this._config.popperConfig,[void 0,Z])}}_selectMenuItem({key:Z,target:ye}){const nt=Ze.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(qt=>b(qt));nt.length&&U(nt,ye,Z===zr,!nt.includes(ye)).focus()}static jQueryInterface(Z){return this.each(function(){const ye=so.getOrCreateInstance(this,Z);if(typeof Z=="string"){if(ye[Z]===void 0)throw new TypeError(`No method named "${Z}"`);ye[Z]()}})}static clearMenus(Z){if(Z.button===2||Z.type==="keyup"&&Z.key!=="Tab")return;const ye=Ze.find(jl);for(const nt of ye){const qt=so.getInstance(nt);if(!qt||qt._config.autoClose===!1)continue;const di=Z.composedPath(),Ti=di.includes(qt._menu);if(di.includes(qt._element)||qt._config.autoClose==="inside"&&!Ti||qt._config.autoClose==="outside"&&Ti||qt._menu.contains(Z.target)&&(Z.type==="keyup"&&Z.key==="Tab"||/input|select|option|textarea|form/i.test(Z.target.tagName)))continue;const _n={relatedTarget:qt._element};Z.type==="click"&&(_n.clickEvent=Z),qt._completeHide(_n)}}static dataApiKeydownHandler(Z){const ye=/input|textarea/i.test(Z.target.tagName),nt=Z.key==="Escape",qt=[sn,zr].includes(Z.key);if(!qt&&!nt||ye&&!nt)return;Z.preventDefault();const di=this.matches(nr)?this:Ze.prev(this,nr)[0]||Ze.next(this,nr)[0]||Ze.findOne(nr,Z.delegateTarget.parentNode),Ti=so.getOrCreateInstance(di);if(qt)return Z.stopPropagation(),Ti.show(),void Ti._selectMenuItem(Z);Ti._isShown()&&(Z.stopPropagation(),Ti.hide(),di.focus())}}Oe.on(document,hl,nr,so.dataApiKeydownHandler),Oe.on(document,hl,Gl,so.dataApiKeydownHandler),Oe.on(document,ro,so.clearMenus),Oe.on(document,xo,so.clearMenus),Oe.on(document,ro,nr,function(it){it.preventDefault(),so.getOrCreateInstance(this).toggle()}),H(so);const Fh="backdrop",Oh="show",zh=`mousedown.bs.${Fh}`,a_={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Su={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Tu extends At{constructor(Z){super(),this._config=this._getConfig(Z),this._isAppended=!1,this._element=null}static get Default(){return a_}static get DefaultType(){return Su}static get NAME(){return Fh}show(Z){if(!this._config.isVisible)return void Y(Z);this._append();const ye=this._getElement();this._config.isAnimated&&L(ye),ye.classList.add(Oh),this._emulateAnimation(()=>{Y(Z)})}hide(Z){this._config.isVisible?(this._getElement().classList.remove(Oh),this._emulateAnimation(()=>{this.dispose(),Y(Z)})):Y(Z)}dispose(){this._isAppended&&(Oe.off(this._element,zh),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const Z=document.createElement("div");Z.className=this._config.className,this._config.isAnimated&&Z.classList.add("fade"),this._element=Z}return this._element}_configAfterMerge(Z){return Z.rootElement=x(Z.rootElement),Z}_append(){if(this._isAppended)return;const Z=this._getElement();this._config.rootElement.append(Z),Oe.on(Z,zh,()=>{Y(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(Z){q(Z,this._getElement(),this._config.isAnimated)}}const Mu=".bs.focustrap",Ec=`focusin${Mu}`,Xd=`keydown.tab${Mu}`,Ac="backward",dl={autofocus:!0,trapElement:null},Pc={autofocus:"boolean",trapElement:"element"};class nn extends At{constructor(Z){super(),this._config=this._getConfig(Z),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return dl}static get DefaultType(){return Pc}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Oe.off(document,Mu),Oe.on(document,Ec,Z=>this._handleFocusin(Z)),Oe.on(document,Xd,Z=>this._handleKeydown(Z)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Oe.off(document,Mu))}_handleFocusin(Z){const{trapElement:ye}=this._config;if(Z.target===document||Z.target===ye||ye.contains(Z.target))return;const nt=Ze.focusableChildren(ye);nt.length===0?ye.focus():this._lastTabNavDirection===Ac?nt[nt.length-1].focus():nt[0].focus()}_handleKeydown(Z){Z.key==="Tab"&&(this._lastTabNavDirection=Z.shiftKey?Ac:"forward")}}const Bh=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Ip=".sticky-top",Ic="padding-right",Bs="margin-right";class us{constructor(){this._element=document.body}getWidth(){const Z=document.documentElement.clientWidth;return Math.abs(window.innerWidth-Z)}hide(){const Z=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Ic,ye=>ye+Z),this._setElementAttributes(Bh,Ic,ye=>ye+Z),this._setElementAttributes(Ip,Bs,ye=>ye-Z)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Ic),this._resetElementAttributes(Bh,Ic),this._resetElementAttributes(Ip,Bs)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(Z,ye,nt){const qt=this.getWidth();this._applyManipulationCallback(Z,di=>{if(di!==this._element&&window.innerWidth>di.clientWidth+qt)return;this._saveInitialAttribute(di,ye);const Ti=window.getComputedStyle(di).getPropertyValue(ye);di.style.setProperty(ye,`${nt(Number.parseFloat(Ti))}px`)})}_saveInitialAttribute(Z,ye){const nt=Z.style.getPropertyValue(ye);nt&&Lt.setDataAttribute(Z,ye,nt)}_resetElementAttributes(Z,ye){this._applyManipulationCallback(Z,nt=>{const qt=Lt.getDataAttribute(nt,ye);qt!==null?(Lt.removeDataAttribute(nt,ye),nt.style.setProperty(ye,qt)):nt.style.removeProperty(ye)})}_applyManipulationCallback(Z,ye){if(_(Z))ye(Z);else for(const nt of Ze.find(Z,this._element))ye(nt)}}const xn=".bs.modal",Gi=`hide${xn}`,On=`hidePrevented${xn}`,wa=`hidden${xn}`,Ss=`show${xn}`,oo=`shown${xn}`,Ns=`resize${xn}`,Lc=`click.dismiss${xn}`,fl=`mousedown.dismiss${xn}`,Pr=`keydown.dismiss${xn}`,ql=`click${xn}.data-api`,No="modal-open",Cu="show",Ts="modal-static",Hl={backdrop:!0,focus:!0,keyboard:!0},Sa={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class pl extends Nt{constructor(Z,ye){super(Z,ye),this._dialog=Ze.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new us,this._addEventListeners()}static get Default(){return Hl}static get DefaultType(){return Sa}static get NAME(){return"modal"}toggle(Z){return this._isShown?this.hide():this.show(Z)}show(Z){this._isShown||this._isTransitioning||Oe.trigger(this._element,Ss,{relatedTarget:Z}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(No),this._adjustDialog(),this._backdrop.show(()=>this._showElement(Z)))}hide(){this._isShown&&!this._isTransitioning&&(Oe.trigger(this._element,Gi).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Cu),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){Oe.off(window,xn),Oe.off(this._dialog,xn),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Tu({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new nn({trapElement:this._element})}_showElement(Z){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const ye=Ze.findOne(".modal-body",this._dialog);ye&&(ye.scrollTop=0),L(this._element),this._element.classList.add(Cu),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Oe.trigger(this._element,oo,{relatedTarget:Z})},this._dialog,this._isAnimated())}_addEventListeners(){Oe.on(this._element,Pr,Z=>{Z.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),Oe.on(window,Ns,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Oe.on(this._element,fl,Z=>{Oe.one(this._element,Lc,ye=>{this._element===Z.target&&this._element===ye.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(No),this._resetAdjustments(),this._scrollBar.reset(),Oe.trigger(this._element,wa)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(Oe.trigger(this._element,On).defaultPrevented)return;const Z=this._element.scrollHeight>document.documentElement.clientHeight,ye=this._element.style.overflowY;ye==="hidden"||this._element.classList.contains(Ts)||(Z||(this._element.style.overflowY="hidden"),this._element.classList.add(Ts),this._queueCallback(()=>{this._element.classList.remove(Ts),this._queueCallback(()=>{this._element.style.overflowY=ye},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const Z=this._element.scrollHeight>document.documentElement.clientHeight,ye=this._scrollBar.getWidth(),nt=ye>0;if(nt&&!Z){const qt=N()?"paddingLeft":"paddingRight";this._element.style[qt]=`${ye}px`}if(!nt&&Z){const qt=N()?"paddingRight":"paddingLeft";this._element.style[qt]=`${ye}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(Z,ye){return this.each(function(){const nt=pl.getOrCreateInstance(this,Z);if(typeof Z=="string"){if(nt[Z]===void 0)throw new TypeError(`No method named "${Z}"`);nt[Z](ye)}})}}Oe.on(document,ql,'[data-bs-toggle="modal"]',function(it){const Z=Ze.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&it.preventDefault(),Oe.one(Z,Ss,nt=>{nt.defaultPrevented||Oe.one(Z,wa,()=>{b(this)&&this.focus()})});const ye=Ze.findOne(".modal.show");ye&&pl.getInstance(ye).hide(),pl.getOrCreateInstance(Z).toggle(this)}),bt(pl),H(pl);const $o=".bs.offcanvas",ml=".data-api",zn=`load${$o}${ml}`,Wl="show",pn="showing",Yi="hiding",Zl=".offcanvas.show",bn=`show${$o}`,Eu=`shown${$o}`,wo=`hide${$o}`,Xl=`hidePrevented${$o}`,Ta=`hidden${$o}`,Lp=`resize${$o}`,Au=`click${$o}${ml}`,Yd=`keydown.dismiss${$o}`,l_={backdrop:!0,keyboard:!0,scroll:!1},Rp={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class vr extends Nt{constructor(Z,ye){super(Z,ye),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return l_}static get DefaultType(){return Rp}static get NAME(){return"offcanvas"}toggle(Z){return this._isShown?this.hide():this.show(Z)}show(Z){this._isShown||Oe.trigger(this._element,bn,{relatedTarget:Z}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new us().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(pn),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Wl),this._element.classList.remove(pn),Oe.trigger(this._element,Eu,{relatedTarget:Z})},this._element,!0))}hide(){this._isShown&&(Oe.trigger(this._element,wo).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Yi),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Wl,Yi),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new us().reset(),Oe.trigger(this._element,Ta)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const Z=!!this._config.backdrop;return new Tu({className:"offcanvas-backdrop",isVisible:Z,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:Z?()=>{this._config.backdrop!=="static"?this.hide():Oe.trigger(this._element,Xl)}:null})}_initializeFocusTrap(){return new nn({trapElement:this._element})}_addEventListeners(){Oe.on(this._element,Yd,Z=>{Z.key==="Escape"&&(this._config.keyboard?this.hide():Oe.trigger(this._element,Xl))})}static jQueryInterface(Z){return this.each(function(){const ye=vr.getOrCreateInstance(this,Z);if(typeof Z=="string"){if(ye[Z]===void 0||Z.startsWith("_")||Z==="constructor")throw new TypeError(`No method named "${Z}"`);ye[Z](this)}})}}Oe.on(document,Au,'[data-bs-toggle="offcanvas"]',function(it){const Z=Ze.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&it.preventDefault(),M(this))return;Oe.one(Z,Ta,()=>{b(this)&&this.focus()});const ye=Ze.findOne(Zl);ye&&ye!==Z&&vr.getInstance(ye).hide(),vr.getOrCreateInstance(Z).toggle(this)}),Oe.on(window,zn,()=>{for(const it of Ze.find(Zl))vr.getOrCreateInstance(it).show()}),Oe.on(window,Lp,()=>{for(const it of Ze.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(it).position!=="fixed"&&vr.getOrCreateInstance(it).hide()}),bt(vr),H(vr);const Vo={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},rr=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Yl=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Kd=(it,Z)=>{const ye=it.nodeName.toLowerCase();return Z.includes(ye)?!rr.has(ye)||!!Yl.test(it.nodeValue):Z.filter(nt=>nt instanceof RegExp).some(nt=>nt.test(ye))},Pu={allowList:Vo,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},yr={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},kp={entry:"(string|element|function|null)",selector:"(string|element)"};class Jd extends At{constructor(Z){super(),this._config=this._getConfig(Z)}static get Default(){return Pu}static get DefaultType(){return yr}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(Z=>this._resolvePossibleFunction(Z)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(Z){return this._checkContent(Z),this._config.content={...this._config.content,...Z},this}toHtml(){const Z=document.createElement("div");Z.innerHTML=this._maybeSanitize(this._config.template);for(const[qt,di]of Object.entries(this._config.content))this._setContent(Z,di,qt);const ye=Z.children[0],nt=this._resolvePossibleFunction(this._config.extraClass);return nt&&ye.classList.add(...nt.split(" ")),ye}_typeCheckConfig(Z){super._typeCheckConfig(Z),this._checkContent(Z.content)}_checkContent(Z){for(const[ye,nt]of Object.entries(Z))super._typeCheckConfig({selector:ye,entry:nt},kp)}_setContent(Z,ye,nt){const qt=Ze.findOne(nt,Z);qt&&((ye=this._resolvePossibleFunction(ye))?_(ye)?this._putElementInTemplate(x(ye),qt):this._config.html?qt.innerHTML=this._maybeSanitize(ye):qt.textContent=ye:qt.remove())}_maybeSanitize(Z){return this._config.sanitize?(function(ye,nt,qt){if(!ye.length)return ye;if(qt&&typeof qt=="function")return qt(ye);const di=new window.DOMParser().parseFromString(ye,"text/html"),Ti=[].concat(...di.body.querySelectorAll("*"));for(const _n of Ti){const fr=_n.nodeName.toLowerCase();if(!Object.keys(nt).includes(fr)){_n.remove();continue}const Ms=[].concat(..._n.attributes),ji=[].concat(nt["*"]||[],nt[fr]||[]);for(const Ks of Ms)Kd(Ks,ji)||_n.removeAttribute(Ks.nodeName)}return di.body.innerHTML})(Z,this._config.allowList,this._config.sanitizeFn):Z}_resolvePossibleFunction(Z){return Y(Z,[void 0,this])}_putElementInTemplate(Z,ye){if(this._config.html)return ye.innerHTML="",void ye.append(Z);ye.textContent=Z.textContent}}const Dp=new Set(["sanitize","allowList","sanitizeFn"]),Qd="fade",Ma="show",Nh=".tooltip-inner",Kl=".modal",$h="hide.bs.modal",Ca="hover",gl="focus",_l="click",qr={AUTO:"auto",TOP:"top",RIGHT:N()?"left":"right",BOTTOM:"bottom",LEFT:N()?"right":"left"},Fp={allowList:Vo,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Rc={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Uo extends Nt{constructor(Z,ye){if(r===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(Z,ye),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Fp}static get DefaultType(){return Rc}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),Oe.off(this._element.closest(Kl),$h,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const Z=Oe.trigger(this._element,this.constructor.eventName("show")),ye=(P(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(Z.defaultPrevented||!ye)return;this._disposePopper();const nt=this._getTipElement();this._element.setAttribute("aria-describedby",nt.getAttribute("id"));const{container:qt}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(qt.append(nt),Oe.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(nt),nt.classList.add(Ma),"ontouchstart"in document.documentElement)for(const di of[].concat(...document.body.children))Oe.on(di,"mouseover",k);this._queueCallback(()=>{Oe.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!Oe.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Ma),"ontouchstart"in document.documentElement)for(const Z of[].concat(...document.body.children))Oe.off(Z,"mouseover",k);this._activeTrigger[_l]=!1,this._activeTrigger[gl]=!1,this._activeTrigger[Ca]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Oe.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(Z){const ye=this._getTemplateFactory(Z).toHtml();if(!ye)return null;ye.classList.remove(Qd,Ma),ye.classList.add(`bs-${this.constructor.NAME}-auto`);const nt=(qt=>{do qt+=Math.floor(1e6*Math.random());while(document.getElementById(qt));return qt})(this.constructor.NAME).toString();return ye.setAttribute("id",nt),this._isAnimated()&&ye.classList.add(Qd),ye}setContent(Z){this._newContent=Z,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(Z){return this._templateFactory?this._templateFactory.changeContent(Z):this._templateFactory=new Jd({...this._config,content:Z,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[Nh]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(Z){return this.constructor.getOrCreateInstance(Z.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Qd)}_isShown(){return this.tip&&this.tip.classList.contains(Ma)}_createPopper(Z){const ye=Y(this._config.placement,[this,Z,this._element]),nt=qr[ye.toUpperCase()];return r.createPopper(this._element,Z,this._getPopperConfig(nt))}_getOffset(){const{offset:Z}=this._config;return typeof Z=="string"?Z.split(",").map(ye=>Number.parseInt(ye,10)):typeof Z=="function"?ye=>Z(ye,this._element):Z}_resolvePossibleFunction(Z){return Y(Z,[this._element,this._element])}_getPopperConfig(Z){const ye={placement:Z,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:nt=>{this._getTipElement().setAttribute("data-popper-placement",nt.state.placement)}}]};return{...ye,...Y(this._config.popperConfig,[void 0,ye])}}_setListeners(){const Z=this._config.trigger.split(" ");for(const ye of Z)if(ye==="click")Oe.on(this._element,this.constructor.eventName("click"),this._config.selector,nt=>{const qt=this._initializeOnDelegatedTarget(nt);qt._activeTrigger[_l]=!(qt._isShown()&&qt._activeTrigger[_l]),qt.toggle()});else if(ye!=="manual"){const nt=ye===Ca?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),qt=ye===Ca?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");Oe.on(this._element,nt,this._config.selector,di=>{const Ti=this._initializeOnDelegatedTarget(di);Ti._activeTrigger[di.type==="focusin"?gl:Ca]=!0,Ti._enter()}),Oe.on(this._element,qt,this._config.selector,di=>{const Ti=this._initializeOnDelegatedTarget(di);Ti._activeTrigger[di.type==="focusout"?gl:Ca]=Ti._element.contains(di.relatedTarget),Ti._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Oe.on(this._element.closest(Kl),$h,this._hideModalHandler)}_fixTitle(){const Z=this._element.getAttribute("title");Z&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",Z),this._element.setAttribute("data-bs-original-title",Z),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(Z,ye){clearTimeout(this._timeout),this._timeout=setTimeout(Z,ye)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(Z){const ye=Lt.getDataAttributes(this._element);for(const nt of Object.keys(ye))Dp.has(nt)&&delete ye[nt];return Z={...ye,...typeof Z=="object"&&Z?Z:{}},Z=this._mergeConfigObj(Z),Z=this._configAfterMerge(Z),this._typeCheckConfig(Z),Z}_configAfterMerge(Z){return Z.container=Z.container===!1?document.body:x(Z.container),typeof Z.delay=="number"&&(Z.delay={show:Z.delay,hide:Z.delay}),typeof Z.title=="number"&&(Z.title=Z.title.toString()),typeof Z.content=="number"&&(Z.content=Z.content.toString()),Z}_getDelegateConfig(){const Z={};for(const[ye,nt]of Object.entries(this._config))this.constructor.Default[ye]!==nt&&(Z[ye]=nt);return Z.selector=!1,Z.trigger="manual",Z}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(Z){return this.each(function(){const ye=Uo.getOrCreateInstance(this,Z);if(typeof Z=="string"){if(ye[Z]===void 0)throw new TypeError(`No method named "${Z}"`);ye[Z]()}})}}H(Uo);const Jl=".popover-header",c_=".popover-body",Vh={...Uo.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},u_={...Uo.DefaultType,content:"(null|string|element|function)"};class Ea extends Uo{static get Default(){return Vh}static get DefaultType(){return u_}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Jl]:this._getTitle(),[c_]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(Z){return this.each(function(){const ye=Ea.getOrCreateInstance(this,Z);if(typeof Z=="string"){if(ye[Z]===void 0)throw new TypeError(`No method named "${Z}"`);ye[Z]()}})}}H(Ea);const kc=".bs.scrollspy",Op=`activate${kc}`,ef=`click${kc}`,tf=`load${kc}.data-api`,vl="active",Iu="[href]",nf=".nav-link",zp=`${nf}, .nav-item > ${nf}, .list-group-item`,Bp={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Ql={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Dc extends Nt{constructor(Z,ye){super(Z,ye),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Bp}static get DefaultType(){return Ql}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const Z of this._observableSections.values())this._observer.observe(Z)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(Z){return Z.target=x(Z.target)||document.body,Z.rootMargin=Z.offset?`${Z.offset}px 0px -30%`:Z.rootMargin,typeof Z.threshold=="string"&&(Z.threshold=Z.threshold.split(",").map(ye=>Number.parseFloat(ye))),Z}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Oe.off(this._config.target,ef),Oe.on(this._config.target,ef,Iu,Z=>{const ye=this._observableSections.get(Z.target.hash);if(ye){Z.preventDefault();const nt=this._rootElement||window,qt=ye.offsetTop-this._element.offsetTop;if(nt.scrollTo)return void nt.scrollTo({top:qt,behavior:"smooth"});nt.scrollTop=qt}}))}_getNewObserver(){const Z={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(ye=>this._observerCallback(ye),Z)}_observerCallback(Z){const ye=Ti=>this._targetLinks.get(`#${Ti.target.id}`),nt=Ti=>{this._previousScrollData.visibleEntryTop=Ti.target.offsetTop,this._process(ye(Ti))},qt=(this._rootElement||document.documentElement).scrollTop,di=qt>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=qt;for(const Ti of Z){if(!Ti.isIntersecting){this._activeTarget=null,this._clearActiveClass(ye(Ti));continue}const _n=Ti.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(di&&_n){if(nt(Ti),!qt)return}else di||_n||nt(Ti)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const Z=Ze.find(Iu,this._config.target);for(const ye of Z){if(!ye.hash||M(ye))continue;const nt=Ze.findOne(decodeURI(ye.hash),this._element);b(nt)&&(this._targetLinks.set(decodeURI(ye.hash),ye),this._observableSections.set(ye.hash,nt))}}_process(Z){this._activeTarget!==Z&&(this._clearActiveClass(this._config.target),this._activeTarget=Z,Z.classList.add(vl),this._activateParents(Z),Oe.trigger(this._element,Op,{relatedTarget:Z}))}_activateParents(Z){if(Z.classList.contains("dropdown-item"))Ze.findOne(".dropdown-toggle",Z.closest(".dropdown")).classList.add(vl);else for(const ye of Ze.parents(Z,".nav, .list-group"))for(const nt of Ze.prev(ye,zp))nt.classList.add(vl)}_clearActiveClass(Z){Z.classList.remove(vl);const ye=Ze.find(`${Iu}.${vl}`,Z);for(const nt of ye)nt.classList.remove(vl)}static jQueryInterface(Z){return this.each(function(){const ye=Dc.getOrCreateInstance(this,Z);if(typeof Z=="string"){if(ye[Z]===void 0||Z.startsWith("_")||Z==="constructor")throw new TypeError(`No method named "${Z}"`);ye[Z]()}})}}Oe.on(window,tf,()=>{for(const it of Ze.find('[data-bs-spy="scroll"]'))Dc.getOrCreateInstance(it)}),H(Dc);const Aa=".bs.tab",Fc=`hide${Aa}`,Np=`hidden${Aa}`,Uh=`show${Aa}`,h_=`shown${Aa}`,d_=`click${Aa}`,$p=`keydown${Aa}`,Lu=`load${Aa}`,Vp="ArrowLeft",jh="ArrowRight",Up="ArrowUp",Ru="ArrowDown",ao="Home",ku="End",Pa="active",Gh="fade",Du="show",Fu=".dropdown-toggle",Ia=`:not(${Fu})`,qh='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',rf=`.nav-link${Ia}, .list-group-item${Ia}, [role="tab"]${Ia}, ${qh}`,jp=`.${Pa}[data-bs-toggle="tab"], .${Pa}[data-bs-toggle="pill"], .${Pa}[data-bs-toggle="list"]`;class ec extends Nt{constructor(Z){super(Z),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Oe.on(this._element,$p,ye=>this._keydown(ye)))}static get NAME(){return"tab"}show(){const Z=this._element;if(this._elemIsActive(Z))return;const ye=this._getActiveElem(),nt=ye?Oe.trigger(ye,Fc,{relatedTarget:Z}):null;Oe.trigger(Z,Uh,{relatedTarget:ye}).defaultPrevented||nt&&nt.defaultPrevented||(this._deactivate(ye,Z),this._activate(Z,ye))}_activate(Z,ye){Z&&(Z.classList.add(Pa),this._activate(Ze.getElementFromSelector(Z)),this._queueCallback(()=>{Z.getAttribute("role")==="tab"?(Z.removeAttribute("tabindex"),Z.setAttribute("aria-selected",!0),this._toggleDropDown(Z,!0),Oe.trigger(Z,h_,{relatedTarget:ye})):Z.classList.add(Du)},Z,Z.classList.contains(Gh)))}_deactivate(Z,ye){Z&&(Z.classList.remove(Pa),Z.blur(),this._deactivate(Ze.getElementFromSelector(Z)),this._queueCallback(()=>{Z.getAttribute("role")==="tab"?(Z.setAttribute("aria-selected",!1),Z.setAttribute("tabindex","-1"),this._toggleDropDown(Z,!1),Oe.trigger(Z,Np,{relatedTarget:ye})):Z.classList.remove(Du)},Z,Z.classList.contains(Gh)))}_keydown(Z){if(![Vp,jh,Up,Ru,ao,ku].includes(Z.key))return;Z.stopPropagation(),Z.preventDefault();const ye=this._getChildren().filter(qt=>!M(qt));let nt;if([ao,ku].includes(Z.key))nt=ye[Z.key===ao?0:ye.length-1];else{const qt=[jh,Ru].includes(Z.key);nt=U(ye,Z.target,qt,!0)}nt&&(nt.focus({preventScroll:!0}),ec.getOrCreateInstance(nt).show())}_getChildren(){return Ze.find(rf,this._parent)}_getActiveElem(){return this._getChildren().find(Z=>this._elemIsActive(Z))||null}_setInitialAttributes(Z,ye){this._setAttributeIfNotExists(Z,"role","tablist");for(const nt of ye)this._setInitialAttributesOnChild(nt)}_setInitialAttributesOnChild(Z){Z=this._getInnerElement(Z);const ye=this._elemIsActive(Z),nt=this._getOuterElement(Z);Z.setAttribute("aria-selected",ye),nt!==Z&&this._setAttributeIfNotExists(nt,"role","presentation"),ye||Z.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(Z,"role","tab"),this._setInitialAttributesOnTargetPanel(Z)}_setInitialAttributesOnTargetPanel(Z){const ye=Ze.getElementFromSelector(Z);ye&&(this._setAttributeIfNotExists(ye,"role","tabpanel"),Z.id&&this._setAttributeIfNotExists(ye,"aria-labelledby",`${Z.id}`))}_toggleDropDown(Z,ye){const nt=this._getOuterElement(Z);if(!nt.classList.contains("dropdown"))return;const qt=(di,Ti)=>{const _n=Ze.findOne(di,nt);_n&&_n.classList.toggle(Ti,ye)};qt(Fu,Pa),qt(".dropdown-menu",Du),nt.setAttribute("aria-expanded",ye)}_setAttributeIfNotExists(Z,ye,nt){Z.hasAttribute(ye)||Z.setAttribute(ye,nt)}_elemIsActive(Z){return Z.classList.contains(Pa)}_getInnerElement(Z){return Z.matches(rf)?Z:Ze.findOne(rf,Z)}_getOuterElement(Z){return Z.closest(".nav-item, .list-group-item")||Z}static jQueryInterface(Z){return this.each(function(){const ye=ec.getOrCreateInstance(this);if(typeof Z=="string"){if(ye[Z]===void 0||Z.startsWith("_")||Z==="constructor")throw new TypeError(`No method named "${Z}"`);ye[Z]()}})}}Oe.on(document,d_,qh,function(it){["A","AREA"].includes(this.tagName)&&it.preventDefault(),M(this)||ec.getOrCreateInstance(this).show()}),Oe.on(window,Lu,()=>{for(const it of Ze.find(jp))ec.getOrCreateInstance(it)}),H(ec);const yl=".bs.toast",Gp=`mouseover${yl}`,f_=`mouseout${yl}`,Sn=`focusin${yl}`,Hh=`focusout${yl}`,Wh=`hide${yl}`,Zh=`hidden${yl}`,sf=`show${yl}`,tc=`shown${yl}`,Oc="hide",La="show",$s="showing",qp={animation:"boolean",autohide:"boolean",delay:"number"},Hp={animation:!0,autohide:!0,delay:5e3};class ic extends Nt{constructor(Z,ye){super(Z,ye),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Hp}static get DefaultType(){return qp}static get NAME(){return"toast"}show(){Oe.trigger(this._element,sf).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Oc),L(this._element),this._element.classList.add(La,$s),this._queueCallback(()=>{this._element.classList.remove($s),Oe.trigger(this._element,tc),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(Oe.trigger(this._element,Wh).defaultPrevented||(this._element.classList.add($s),this._queueCallback(()=>{this._element.classList.add(Oc),this._element.classList.remove($s,La),Oe.trigger(this._element,Zh)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(La),super.dispose()}isShown(){return this._element.classList.contains(La)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(Z,ye){switch(Z.type){case"mouseover":case"mouseout":this._hasMouseInteraction=ye;break;case"focusin":case"focusout":this._hasKeyboardInteraction=ye}if(ye)return void this._clearTimeout();const nt=Z.relatedTarget;this._element===nt||this._element.contains(nt)||this._maybeScheduleHide()}_setListeners(){Oe.on(this._element,Gp,Z=>this._onInteraction(Z,!0)),Oe.on(this._element,f_,Z=>this._onInteraction(Z,!1)),Oe.on(this._element,Sn,Z=>this._onInteraction(Z,!0)),Oe.on(this._element,Hh,Z=>this._onInteraction(Z,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(Z){return this.each(function(){const ye=ic.getOrCreateInstance(this,Z);if(typeof Z=="string"){if(ye[Z]===void 0)throw new TypeError(`No method named "${Z}"`);ye[Z](this)}})}}return bt(ic),H(ic),{Alert:Ee,Button:ft,Carousel:$e,Collapse:Ni,Dropdown:so,Modal:pl,Offcanvas:vr,Popover:Ea,ScrollSpy:Dc,Tab:ec,Toast:ic,Tooltip:Uo}})})(mx)),mx.exports}q5();var ja=63710088e-1,bk={centimeters:ja*100,centimetres:ja*100,degrees:360/(2*Math.PI),feet:ja*3.28084,inches:ja*39.37,kilometers:ja/1e3,kilometres:ja/1e3,meters:ja,metres:ja,miles:ja/1609.344,millimeters:ja*1e3,millimetres:ja*1e3,nauticalmiles:ja/1852,radians:1,yards:ja*1.0936};function dy(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function Hf(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!iP(n[0])||!iP(n[1]))throw new Error("coordinates must contain numbers");return dy({type:"Point",coordinates:n},e,t)}function H5(n,e,t={}){for(const r of n){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let o=0;o<r[r.length-1].length;o++)if(r[r.length-1][o]!==r[0][o])throw new Error("First and last Position are not equivalent.")}return dy({type:"Polygon",coordinates:n},e,t)}function tP(n,e,t={}){if(n.length<2)throw new Error("coordinates must be an array of two or more positions");return dy({type:"LineString",coordinates:n},e,t)}function W5(n,e="kilometers"){const t=bk[e];if(!t)throw new Error(e+" units is invalid");return n*t}function Z5(n,e="kilometers"){const t=bk[e];if(!t)throw new Error(e+" units is invalid");return n/t}function Fx(n){return n%(2*Math.PI)*180/Math.PI}function dh(n){return n%360*Math.PI/180}function iP(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function vg(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function X5(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function pS(n,e,t={}){var i=vg(n),r=vg(e),o=dh(r[1]-i[1]),c=dh(r[0]-i[0]),s=dh(i[1]),f=dh(r[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(s)*Math.cos(f);return W5(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function xk(n,e,t){if(n!==null)for(var i,r,o,c,s,f,p,g=0,_=0,x,b=n.type,M=b==="FeatureCollection",P=b==="Feature",k=M?n.features.length:1,L=0;L<k;L++){p=M?n.features[L].geometry:P?n.geometry:n,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var F=0,N=0;if(c=x?p.geometries[I]:p,c!==null){f=c.coordinates;var H=c.type;switch(g=0,H){case null:break;case"Point":if(e(f,_,L,F,N)===!1)return!1;_++,F++;break;case"LineString":case"MultiPoint":for(i=0;i<f.length;i++){if(e(f[i],_,L,F,N)===!1)return!1;_++,H==="MultiPoint"&&F++}H==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(i=0;i<f.length;i++){for(r=0;r<f[i].length-g;r++){if(e(f[i][r],_,L,F,N)===!1)return!1;_++}H==="MultiLineString"&&F++,H==="Polygon"&&N++}H==="Polygon"&&F++;break;case"MultiPolygon":for(i=0;i<f.length;i++){for(N=0,r=0;r<f[i].length;r++){for(o=0;o<f[i][r].length-g;o++){if(e(f[i][r][o],_,L,F,N)===!1)return!1;_++}N++}F++}break;case"GeometryCollection":for(i=0;i<c.geometries.length;i++)if(xk(c.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Y5(n,e){var t,i,r,o,c,s,f,p,g,_,x=0,b=n.type==="FeatureCollection",M=n.type==="Feature",P=b?n.features.length:1;for(t=0;t<P;t++){for(s=b?n.features[t].geometry:M?n.geometry:n,p=b?n.features[t].properties:M?n.properties:{},g=b?n.features[t].bbox:M?n.bbox:void 0,_=b?n.features[t].id:M?n.id:void 0,f=s?s.type==="GeometryCollection":!1,c=f?s.geometries.length:1,r=0;r<c;r++){if(o=f?s.geometries[r]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(e(o.geometries[i],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function K5(n,e){Y5(n,function(t,i,r,o,c){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(dy(t,r,{bbox:o,id:c}),i,0)===!1?!1:void 0}var f;switch(s){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:f,coordinates:g};if(e(dy(_,r),i,p)===!1)return!1}})}var J5=Object.defineProperty,Q5=Object.defineProperties,e6=Object.getOwnPropertyDescriptors,nP=Object.getOwnPropertySymbols,t6=Object.prototype.hasOwnProperty,i6=Object.prototype.propertyIsEnumerable,rP=(n,e,t)=>e in n?J5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,sP=(n,e)=>{for(var t in e||(e={}))t6.call(e,t)&&rP(n,t,e[t]);if(nP)for(var t of nP(e))i6.call(e,t)&&rP(n,t,e[t]);return n},oP=(n,e)=>Q5(n,e6(e));function n6(n,e,t={}){if(!n||!e)throw new Error("lines and pt are required arguments");const i=vg(e);let r=Hf([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),o=0;return K5(n,function(c,s,f){const p=X5(c);for(let g=0;g<p.length-1;g++){const _=Hf(p[g]),x=vg(_),b=Hf(p[g+1]),M=vg(b),P=pS(_,b,t);let k,L;M[0]===i[0]&&M[1]===i[1]?[k,L]=[M,!0]:x[0]===i[0]&&x[1]===i[1]?[k,L]=[x,!1]:[k,L]=o6(x,M,i);const I=Hf(k,{dist:pS(e,k,t),multiFeatureIndex:f,location:o+pS(_,k,t)});I.properties.dist<r.properties.dist&&(r=oP(sP({},I),{properties:oP(sP({},I.properties),{index:L?g+1:g})})),o+=P}}),r}function zf(n,e){const[t,i,r]=n,[o,c,s]=e;return t*o+i*c+r*s}function sv(n,e){const[t,i,r]=n,[o,c,s]=e;return[i*s-r*c,r*o-t*s,t*c-i*o]}function r6(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2))}function aP(n){const e=r6(n);return[n[0]/e,n[1]/e,n[2]/e]}function mS(n){const e=dh(n[1]),t=dh(n[0]);return[Math.cos(e)*Math.cos(t),Math.cos(e)*Math.sin(t),Math.sin(e)]}function s6(n){const[e,t,i]=n,r=Math.min(Math.max(i,-1),1),o=Fx(Math.asin(r));return[Fx(Math.atan2(t,e)),o]}function o6(n,e,t){const i=mS(n),r=mS(e),o=mS(t),c=sv(i,r);if(c[0]===0&&c[1]===0&&c[2]===0)return zf(i,r)>0?[[...e],!0]:[[...t],!1];const s=sv(c,o);if(s[0]===0&&s[1]===0&&s[2]===0)return[[...e],!0];const f=sv(s,c),p=aP(f),g=[-p[0],-p[1],-p[2]],_=zf(o,p)>zf(o,g)?p:g,x=aP(c),b=zf(sv(i,_),x),M=zf(sv(_,r),x);return b>=0&&M>=0?[s6(_),!1]:zf(i,o)>zf(r,o)?[[...n],!1]:[[...e],!0]}var a6=n6;const l6=["==",["geometry-type"],"Polygon"],c6=["==",["geometry-type"],"LineString"],u6=["==",["geometry-type"],"Point"];function wk(){return{type:"FeatureCollection",features:[]}}function gS(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Sk(n)}}}function Sk(n){return[Math.round(n[0]*1e7)/1e7,Math.round(n[1]*1e7)/1e7]}const Tk=Mc(wk()),Mk=Mc(0),h6=100;class d6{map;active;eventListenersSuccess;eventListenersUpdated;eventListenersFailure;points;cursor;hover;dragFrom;previousStates;constructor(e){this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}onMouseMove=e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,i=this.dragFrom[1]-e.lngLat.lat;for(let r of this.points)r[0]-=t,r[1]-=i}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}};onClick=e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(lP(this.points).forEach((i,r)=>{t.push([r+1,a6(i,this.cursor).properties.dist])}),t.sort((i,r)=>i[1]-r[1]),t.length>0){let i=t[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hover=i}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))};onDoubleClick=e=>{this.active&&(e.preventDefault(),this.cursor=gS(e.lngLat.toArray()),this.onClick(e),this.finish())};onMouseDown=e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())};onMouseUp=()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())};onKeypress=e=>{if(!this.active)return;let t=e.target.tagName;t=="INPUT"||t=="TEXTAREA"||(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())};onKeyDown=e=>{if(!this.active)return;let t=e.target.tagName;t=="INPUT"||t=="TEXTAREA"||e.key=="Escape"&&(e.stopPropagation(),this.cancel())};addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=wk();this.points.forEach((r,o)=>{let c=gS(r);c.properties.hover=this.hover==o,c.properties.idx=o,e.features.push(c)}),e.features=e.features.concat(lP(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Tk.set(e);let i="crosshair";this.hover!=null&&(i=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=i,Mk.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=gS(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Sk),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>h6&&this.previousStates.shift()}}function lP(n){let e=[];for(let t=0;t<n.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[t],n[t+1]]},properties:{}});return n.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[n[n.length-1],n[0]]},properties:{}}),e}var f6=Xt('<div style="display: flex; justify-content: space-between;"><button>Finish</button> <button>Cancel</button> <button><!></button></div> <ul><li><b>Click</b> the map to add a vertex</li> <li><b>Click</b> a vertex to delete it</li> <li><b>Drag</b> a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b> to undo your last change</li> <li>Press <b>Enter</b> or <b>double click</b> to finish</li> <li>Press <b>Escape</b> to cancel</li></ul>',1);function p6(n,e){en(e,!0);const t=()=>on(Mk,"$undoLength",i),[i,r]=cs();var o=f6(),c=ui(o),s=Bt(c);s.__click=()=>e.polygonTool.finish();var f=ht(s,2);f.__click=()=>e.polygonTool.cancel();var p=ht(f,2);p.__click=()=>e.polygonTool.undo();var g=Bt(p);{var _=b=>{var M=Hn("Undo");pt(b,M)},x=b=>{var M=Hn();Ji(()=>ln(M,`Undo (${t()??""})`)),pt(b,M)};Ki(g,b=>{t()==0?b(_):b(x,!1)})}Ji(()=>p.disabled=t()==0),pt(n,o),tn(),r()}ps(["click"]);K4();var m6=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],g6=["difference","intersection","symmetricDifference","union"],cP=!1;class Ox extends Set{#t=new Map;#e=ii(0);#i=ii(0);#n=_c||-1;constructor(e){if(super(),e){for(var t of e)super.add(t);this.#i.v=super.size}cP||this.#r()}#s(e){return _c===this.#n?ii(e):xh(e)}#r(){cP=!0;var e=Ox.prototype,t=Set.prototype;for(const i of m6)e[i]=function(...r){return ee(this.#e),t[i].apply(this,r)};for(const i of g6)e[i]=function(...r){ee(this.#e);var o=t[i].apply(this,r);return new Ox(o)}}has(e){var t=super.has(e),i=this.#t,r=i.get(e);if(r===void 0){if(!t)return ee(this.#e),!1;r=this.#s(!0),i.set(e,r)}return ee(r),t}add(e){return super.has(e)||(super.add(e),yt(this.#i,super.size),Ka(this.#e)),this}delete(e){var t=super.delete(e),i=this.#t,r=i.get(e);return r!==void 0&&(i.delete(e),yt(r,!1)),t&&(yt(this.#i,super.size),Ka(this.#e)),t}clear(){if(super.size!==0){super.clear();var e=this.#t;for(var t of e.values())yt(t,!1);e.clear(),yt(this.#i,0),Ka(this.#e)}}keys(){return this.values()}values(){return ee(this.#e),super.values()}entries(){return ee(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return ee(this.#i)}}class _6 extends Map{#t=new Map;#e=ii(0);#i=ii(0);#n=_c||-1;constructor(e){if(super(),e){for(var[t,i]of e)super.set(t,i);this.#i.v=super.size}}#s(e){return _c===this.#n?ii(e):xh(e)}has(e){var t=this.#t,i=t.get(e);if(i===void 0){var r=super.get(e);if(r!==void 0)i=this.#s(0),t.set(e,i);else return ee(this.#e),!1}return ee(i),!0}forEach(e,t){this.#r(),super.forEach(e,t)}get(e){var t=this.#t,i=t.get(e);if(i===void 0){var r=super.get(e);if(r!==void 0)i=this.#s(0),t.set(e,i);else{ee(this.#e);return}}return ee(i),super.get(e)}set(e,t){var i=this.#t,r=i.get(e),o=super.get(e),c=super.set(e,t),s=this.#e;if(r===void 0)r=this.#s(0),i.set(e,r),yt(this.#i,super.size),Ka(s);else if(o!==t){Ka(r);var f=s.reactions===null?null:new Set(s.reactions),p=f===null||!r.reactions?.every(g=>f.has(g));p&&Ka(s)}return c}delete(e){var t=this.#t,i=t.get(e),r=super.delete(e);return i!==void 0&&(t.delete(e),yt(this.#i,super.size),yt(i,-1),Ka(this.#e)),r}clear(){if(super.size!==0){super.clear();var e=this.#t;yt(this.#i,0);for(var t of e.values())yt(t,-1);Ka(this.#e),e.clear()}}#r(){ee(this.#e);var e=this.#t;if(this.#i.v!==e.size){for(var t of super.keys())if(!e.has(t)){var i=this.#s(0);e.set(t,i)}}for([,i]of this.#t)ee(i)}keys(){return ee(this.#e),super.keys()}values(){return this.#r(),super.values()}entries(){return this.#r(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return ee(this.#i),super.size}}let v6=Date.now();function _p(n){return`${n}-${v6++}`}class fy{#t=ii();get value(){return ee(this.#t)}set value(e){yt(this.#t,e,!0)}constructor(e){this.value=e}}class y6{#t=ii();get map(){return ee(this.#t)}set map(e){yt(this.#t,e,!0)}#e=ii(!1);get loaded(){return ee(this.#e)}set loaded(e){yt(this.#e,e,!0)}loadedImages=new Ox;#i=ii(0);get minzoom(){return ee(this.#i)}set minzoom(e){yt(this.#i,e,!0)}#n=ii(24);get maxzoom(){return ee(this.#n)}set maxzoom(e){yt(this.#n,e,!0)}layerInfo=new Map;eventTracker=new WeakMap;_eventTopMost(e){let t=this.eventTracker.get(e.originalEvent);if(t!==void 0)return t;let r=e.target.queryRenderedFeatures(e.point).find(o=>this.layerInfo.get(o.layer.id)?.interactive)?.layer.id;return this.eventTracker.set(e.originalEvent,r),r}eventTopMost;markerClickManager=new D6;constructor(){this.eventTopMost=this._eventTopMost.bind(this)}}function b6(n){Xg(Pk,n)}function x6(){return Zg(Pk)}function w6(n){Xg(Ik,n)}function S6(){return Zg(Ik)}function T6(n){Xg(Ak,n)}function M6(){return Zg(Ak)}function C6(n){Xg(P6,n)}function E6(){return Zg(Lk)}function Ck(n){Xg(Lk,n)}function A6(){return Zg(I6)}const Ek=Symbol.for("svelte-maplibre"),Ak=Symbol.for("svelte-maplibre.popup-target"),Pk=Symbol.for("svelte-maplibre.layer"),Ik=Symbol.for("svelte-maplibre.source"),P6=Symbol.for("svelte-maplibre.cluster"),Lk=Symbol.for("svelte-maplibre.layer-event"),I6=Symbol.for("svelte-maplibre.lng-lat");function Sc(){return Zg(Ek)}function L6(){return Xg(Ek,new y6)}function Rk(){const n=new fy(void 0),e=new fy(void 0);return w6(n),C6(e),{source:n,cluster:e}}function R6(n=!0){const e=new fy(void 0),t=new fy(void 0);return b6(e),n&&(T6(e),Ck(t)),{layer:e,layerEvent:t}}function k6(n){return"layerType"in n&&n.layerType==="deckgl"}class D6{_handlers=new Set;add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}var _x={exports:{}};var F6=_x.exports,uP;function O6(){return uP||(uP=1,(function(n,e){(function(t,i){n.exports=i()})(F6,(function(){var t={},i={};function r(c,s,f){if(i[c]=f,c==="index"){var p="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",g={};return i.shared(g),i.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}r("shared",["exports"],(function(c){function s(h,a,u,m){return new(u||(u=Promise))((function(y,S){function T(z){try{D(m.next(z))}catch(V){S(V)}}function A(z){try{D(m.throw(z))}catch(V){S(V)}}function D(z){var V;z.done?y(z.value):(V=z.value,V instanceof u?V:new u((function(X){X(V)}))).then(T,A)}D((m=m.apply(h,a||[])).next())}))}function f(h,a){this.x=h,this.y=a}function p(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var g,_;typeof SuppressedError=="function"&&SuppressedError,f.prototype={clone(){return new f(this.x,this.y)},add(h){return this.clone()._add(h)},sub(h){return this.clone()._sub(h)},multByPoint(h){return this.clone()._multByPoint(h)},divByPoint(h){return this.clone()._divByPoint(h)},mult(h){return this.clone()._mult(h)},div(h){return this.clone()._div(h)},rotate(h){return this.clone()._rotate(h)},rotateAround(h,a){return this.clone()._rotateAround(h,a)},matMult(h){return this.clone()._matMult(h)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(h){return this.x===h.x&&this.y===h.y},dist(h){return Math.sqrt(this.distSqr(h))},distSqr(h){const a=h.x-this.x,u=h.y-this.y;return a*a+u*u},angle(){return Math.atan2(this.y,this.x)},angleTo(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith(h){return this.angleWithSep(h.x,h.y)},angleWithSep(h,a){return Math.atan2(this.x*a-this.y*h,this.x*h+this.y*a)},_matMult(h){const a=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=a,this},_add(h){return this.x+=h.x,this.y+=h.y,this},_sub(h){return this.x-=h.x,this.y-=h.y,this},_mult(h){return this.x*=h,this.y*=h,this},_div(h){return this.x/=h,this.y/=h,this},_multByPoint(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint(h){return this.x/=h.x,this.y/=h.y,this},_unit(){return this._div(this.mag()),this},_perp(){const h=this.y;return this.y=this.x,this.x=-h,this},_rotate(h){const a=Math.cos(h),u=Math.sin(h),m=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=m,this},_rotateAround(h,a){const u=Math.cos(h),m=Math.sin(h),y=a.y+m*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-m*(this.y-a.y),this.y=y,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:f},f.convert=function(h){if(h instanceof f)return h;if(Array.isArray(h))return new f(+h[0],+h[1]);if(h.x!==void 0&&h.y!==void 0)return new f(+h.x,+h.y);throw new Error("Expected [x, y] or {x, y} point format")};var x=(function(){if(_)return g;function h(a,u,m,y){this.cx=3*a,this.bx=3*(m-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(y-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=m,this.p2y=y}return _=1,g=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var m=a,y=0;y<8;y++){var S=this.sampleCurveX(m)-a;if(Math.abs(S)<u)return m;var T=this.sampleCurveDerivativeX(m);if(Math.abs(T)<1e-6)break;m-=S/T}var A=0,D=1;for(m=a,y=0;y<20&&(S=this.sampleCurveX(m),!(Math.abs(S-a)<u));y++)a>S?A=m:D=m,m=.5*(D-A)+A;return m},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},g})(),b=p(x);let M,P;function k(){return M==null&&(M=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),M}function L(){if(P==null&&(P=!1,k())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let m=0;m<25;m++){const y=4*m;a.fillStyle=`rgb(${y},${y+1},${y+2})`,a.fillRect(m%5,Math.floor(m/5),1,1)}const u=a.getImageData(0,0,5,5).data;for(let m=0;m<100;m++)if(m%4!=3&&u[m]!==m){P=!0;break}}}return P||!1}var I=1e-6,F=typeof Float32Array<"u"?Float32Array:Array;function N(){var h=new F(9);return F!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h}function H(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function Y(){var h=new F(3);return F!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function q(h){var a=h[0],u=h[1],m=h[2];return Math.sqrt(a*a+u*u+m*m)}function U(h,a,u){var m=new F(3);return m[0]=h,m[1]=a,m[2]=u,m}function G(h,a,u){return h[0]=a[0]+u[0],h[1]=a[1]+u[1],h[2]=a[2]+u[2],h}function j(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h[2]=a[2]*u,h}function B(h,a,u){var m=a[0],y=a[1],S=a[2],T=u[0],A=u[1],D=u[2];return h[0]=y*D-S*A,h[1]=S*T-m*D,h[2]=m*A-y*T,h}var ne,J=q;function le(h,a,u){var m=a[0],y=a[1],S=a[2],T=a[3];return h[0]=u[0]*m+u[4]*y+u[8]*S+u[12]*T,h[1]=u[1]*m+u[5]*y+u[9]*S+u[13]*T,h[2]=u[2]*m+u[6]*y+u[10]*S+u[14]*T,h[3]=u[3]*m+u[7]*y+u[11]*S+u[15]*T,h}function ae(){var h=new F(4);return F!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h[3]=1,h}function pe(h,a,u,m){var y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",S=Math.PI/360;a*=S,m*=S,u*=S;var T=Math.sin(a),A=Math.cos(a),D=Math.sin(u),z=Math.cos(u),V=Math.sin(m),X=Math.cos(m);switch(y){case"xyz":h[0]=T*z*X+A*D*V,h[1]=A*D*X-T*z*V,h[2]=A*z*V+T*D*X,h[3]=A*z*X-T*D*V;break;case"xzy":h[0]=T*z*X-A*D*V,h[1]=A*D*X-T*z*V,h[2]=A*z*V+T*D*X,h[3]=A*z*X+T*D*V;break;case"yxz":h[0]=T*z*X+A*D*V,h[1]=A*D*X-T*z*V,h[2]=A*z*V-T*D*X,h[3]=A*z*X+T*D*V;break;case"yzx":h[0]=T*z*X+A*D*V,h[1]=A*D*X+T*z*V,h[2]=A*z*V-T*D*X,h[3]=A*z*X-T*D*V;break;case"zxy":h[0]=T*z*X-A*D*V,h[1]=A*D*X+T*z*V,h[2]=A*z*V+T*D*X,h[3]=A*z*X-T*D*V;break;case"zyx":h[0]=T*z*X-A*D*V,h[1]=A*D*X+T*z*V,h[2]=A*z*V-T*D*X,h[3]=A*z*X+T*D*V;break;default:throw new Error("Unknown angle order "+y)}return h}function fe(){var h=new F(2);return F!=Float32Array&&(h[0]=0,h[1]=0),h}function Te(h,a){var u=new F(2);return u[0]=h,u[1]=a,u}Y(),ne=new F(4),F!=Float32Array&&(ne[0]=0,ne[1]=0,ne[2]=0,ne[3]=0),Y(),U(1,0,0),U(0,1,0),ae(),ae(),N(),fe();const Ce=8192;function tt(h,a,u){return a*(Ce/(h.tileSize*Math.pow(2,u-h.tileID.overscaledZ)))}function Ke(h,a){return(h%a+a)%a}function dt(h,a,u){return h*(1-u)+a*u}function et(h){if(h<=0)return 0;if(h>=1)return 1;const a=h*h,u=a*h;return 4*(h<.5?u:3*(h-a)+u-.75)}function Oe(h,a,u,m){const y=new b(h,a,u,m);return S=>y.solve(S)}const lt=Oe(.25,.1,.25,1);function Ye(h,a,u){return Math.min(u,Math.max(a,h))}function zt(h,a,u){const m=u-a,y=((h-a)%m+m)%m+a;return y===a?u:y}function Lt(h,...a){for(const u of a)for(const m in u)h[m]=u[m];return h}let At=1;function Nt(h,a,u){const m={};for(const y in h)m[y]=a.call(this,h[y],y,h);return m}function $t(h,a,u){const m={};for(const y in h)a.call(this,h[y],y,h)&&(m[y]=h[y]);return m}function Ze(h){return Array.isArray(h)?h.map(Ze):typeof h=="object"&&h?Nt(h,Ze):h}const bt={};function Mt(h){bt[h]||(typeof console<"u"&&console.warn(h),bt[h]=!0)}function Zt(h,a,u){return(u.y-h.y)*(a.x-h.x)>(a.y-h.y)*(u.x-h.x)}function Pt(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let Ee=null;function xe(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ve(h,a,u,m,y){return s(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(h,{timestamp:0});try{const T=S?.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const A=T.startsWith("BGR"),D=new Uint8ClampedArray(m*y*4);if(yield S.copyTo(D,(function(z,V,X,ie,re){const he=4*Math.max(-V,0),me=(Math.max(0,X)-X)*ie*4+he,_e=4*ie,Se=Math.max(0,V),Be=Math.max(0,X);return{rect:{x:Se,y:Be,width:Math.min(z.width,V+ie)-Se,height:Math.min(z.height,X+re)-Be},layout:[{offset:me,stride:_e}]}})(h,a,u,m,y)),A)for(let z=0;z<D.length;z+=4){const V=D[z];D[z]=D[z+2],D[z+2]=V}return D}finally{S.close()}}))}let te,se;function Ie(h,a,u,m){return h.addEventListener(a,u,m),{unsubscribe:()=>{h.removeEventListener(a,u,m)}}}function Ue(h){return h*Math.PI/180}function ct(h){return h/Math.PI*180}const we={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Q={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ue="AbortError";class de extends Error{constructor(a=ue){super(a instanceof Error?a.message:a),this.name=ue,a instanceof Error&&a.stack&&(this.stack=a.stack)}}function Pe(h){return h.name===ue}const Re={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function rt(h){return Re.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const ot="global-dispatcher";class Xe extends Error{constructor(a,u,m,y){super(`AJAXError: ${u} (${a}): ${m}`),this.status=a,this.statusText=u,this.url=m,this.body=y}}const mt=()=>Pt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Et=function(h,a){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const m=rt(h.url);if(m)return m(h,a);if(Pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:ot},a)}if(!(/^file:/.test(u=h.url)||/^file:/.test(mt())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(m,y){return s(this,void 0,void 0,(function*(){const S=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:mt(),signal:y.signal});let T,A;m.type!=="json"||S.headers.has("Accept")||S.headers.set("Accept","application/json");try{T=yield fetch(S)}catch(z){throw Pe(z)?z:new Xe(0,z.message,m.url,new Blob)}if(!T.ok){const z=yield T.blob();throw new Xe(T.status,T.statusText,m.url,z)}A=m.type==="arrayBuffer"||m.type==="image"?T.arrayBuffer():m.type==="json"?T.json():T.text();const D=yield A;return y.signal.throwIfAborted(),{data:D,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}}))})(h,a);if(Pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:ot},a)}var u;return(function(m,y){return new Promise(((S,T)=>{var A;const D=new XMLHttpRequest;D.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(D.responseType="arraybuffer");for(const z in m.headers)D.setRequestHeader(z,m.headers[z]);m.type==="json"&&(D.responseType="text",!((A=m.headers)===null||A===void 0)&&A.Accept||D.setRequestHeader("Accept","application/json")),D.withCredentials=m.credentials==="include",D.onerror=()=>{T(new Error(D.statusText))},D.onload=()=>{if(!y.signal.aborted)if((D.status>=200&&D.status<300||D.status===0)&&D.response!==null){let z=D.response;if(m.type==="json")try{z=JSON.parse(D.response)}catch(V){return void T(V)}S({data:z,cacheControl:D.getResponseHeader("Cache-Control"),expires:D.getResponseHeader("Expires")})}else{const z=new Blob([D.response],{type:D.getResponseHeader("Content-Type")});T(new Xe(D.status,D.statusText,m.url,z))}},y.signal.addEventListener("abort",(()=>{D.abort(),T(new de(y.signal.reason))})),D.send(m.body)}))})(h,a)};function kt(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const a=new URL(h),u=window.location;return a.protocol===u.protocol&&a.host===u.host}function Jt(h,a,u){u[h]&&u[h].indexOf(a)!==-1||(u[h]=u[h]||[],u[h].push(a))}function vi(h,a,u){if(u&&u[h]){const m=u[h].indexOf(a);m!==-1&&u[h].splice(m,1)}}class $i{constructor(a,u={}){Lt(this,u),this.type=a}}class vn extends $i{constructor(a,u={}){super("error",Lt({error:a},u))}}class rn{on(a,u){return this._listeners=this._listeners||{},Jt(a,u,this._listeners),{unsubscribe:()=>{this.off(a,u)}}}off(a,u){return vi(a,u,this._listeners),vi(a,u,this._oneTimeListeners),this}once(a,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(a,u,this._oneTimeListeners),this):new Promise((m=>this.once(a,m)))}fire(a,u){typeof a=="string"&&(a=new $i(a,u||{}));const m=a.type;if(this.listens(m)){a.target=this;const y=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const A of y)A.call(this,a);const S=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const A of S)vi(m,A,this._oneTimeListeners),A.call(this,a);const T=this._eventedParent;T&&(Lt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(a))}else a instanceof vn&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,u){return this._eventedParent=a,this._eventedParentData=u,this}}var gt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const gn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Er(h,a){const u={};for(const m in h)m!=="ref"&&(u[m]=h[m]);return gn.forEach((m=>{m in a&&(u[m]=a[m])})),u}function Di(h,a){if(Array.isArray(h)){if(!Array.isArray(a)||h.length!==a.length)return!1;for(let u=0;u<h.length;u++)if(!Di(h[u],a[u]))return!1;return!0}if(typeof h=="object"&&h!==null&&a!==null){if(typeof a!="object"||Object.keys(h).length!==Object.keys(a).length)return!1;for(const u in h)if(!Di(h[u],a[u]))return!1;return!0}return h===a}function yn(h,a){h.push(a)}function Yn(h,a,u){yn(u,{command:"addSource",args:[h,a[h]]})}function Cn(h,a,u){yn(a,{command:"removeSource",args:[h]}),u[h]=!0}function Vn(h,a,u,m){Cn(h,u,m),Yn(h,a,u)}function En(h,a,u){let m;for(m in h[u])if(Object.prototype.hasOwnProperty.call(h[u],m)&&m!=="data"&&!Di(h[u][m],a[u][m]))return!1;for(m in a[u])if(Object.prototype.hasOwnProperty.call(a[u],m)&&m!=="data"&&!Di(h[u][m],a[u][m]))return!1;return!0}function dr(h,a,u,m,y,S){h=h||{},a=a||{};for(const T in h)Object.prototype.hasOwnProperty.call(h,T)&&(Di(h[T],a[T])||u.push({command:S,args:[m,T,a[T],y]}));for(const T in a)Object.prototype.hasOwnProperty.call(a,T)&&!Object.prototype.hasOwnProperty.call(h,T)&&(Di(h[T],a[T])||u.push({command:S,args:[m,T,a[T],y]}))}function $e(h){return h.id}function Ct(h,a){return h[a.id]=a,h}class Qe{constructor(a,u,m,y){this.message=(a?`${a}: `:"")+m,y&&(this.identifier=y),u!=null&&u.__line__&&(this.line=u.__line__)}}function It(h,...a){for(const u of a)for(const m in u)h[m]=u[m];return h}class Gt extends Error{constructor(a,u){super(u),this.message=u,this.key=a}}class qi{constructor(a,u=[]){this.parent=a,this.bindings={};for(const[m,y]of u)this.bindings[m]=y}concat(a){return new qi(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Ii={kind:"null"},Dt={kind:"number"},ai={kind:"string"},pi={kind:"boolean"},Hi={kind:"color"},ut={kind:"projectionDefinition"},Li={kind:"object"},bi={kind:"value"},Ni={kind:"collator"},Kn={kind:"formatted"},Zi={kind:"padding"},Un={kind:"colorArray"},sn={kind:"numberArray"},zr={kind:"resolvedImage"},jn={kind:"variableAnchorOffsetCollection"};function an(h,a){return{kind:"array",itemType:h,N:a}}function Qi(h){if(h.kind==="array"){const a=Qi(h.itemType);return typeof h.N=="number"?`array<${a}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${a}>`}return h.kind}const ts=[Ii,Dt,ai,pi,Hi,ut,Kn,Li,an(bi),Zi,sn,Un,zr,jn];function ro(h,a){if(a.kind==="error")return null;if(h.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!ro(h.itemType,a.itemType))&&(typeof h.N!="number"||h.N===a.N))return null}else{if(h.kind===a.kind)return null;if(h.kind==="value"){for(const u of ts)if(!ro(u,a))return null}}return`Expected ${Qi(h)} but found ${Qi(a)} instead.`}function hl(h,a){return a.some((u=>u.kind===h.kind))}function xo(h,a){return a.some((u=>u==="null"?h===null:u==="array"?Array.isArray(h):u==="object"?h&&!Array.isArray(h)&&typeof h=="object":u===typeof h))}function Ar(h,a){return h.kind==="array"&&a.kind==="array"?h.itemType.kind===a.itemType.kind&&typeof h.N=="number":h.kind===a.kind}const nr=.96422,jl=.82521,Gl=4/29,_r=6/29,Mp=3*_r*_r,Cp=_r*_r*_r,wu=Math.PI/180,Ep=180/Math.PI;function Ap(h){return(h%=360)<0&&(h+=360),h}function Pp([h,a,u,m]){let y,S;const T=so((.2225045*(h=Dh(h))+.7168786*(a=Dh(a))+.0606169*(u=Dh(u)))/1);h===a&&a===u?y=S=T:(y=so((.4360747*h+.3850649*a+.1430804*u)/nr),S=so((.0139322*h+.0971045*a+.7141733*u)/jl));const A=116*T-16;return[A<0?0:A,500*(y-T),200*(T-S),m]}function Dh(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function so(h){return h>Cp?Math.pow(h,1/3):h/Mp+Gl}function Fh([h,a,u,m]){let y=(h+16)/116,S=isNaN(a)?y:y+a/500,T=isNaN(u)?y:y-u/200;return y=1*zh(y),S=nr*zh(S),T=jl*zh(T),[Oh(3.1338561*S-1.6168667*y-.4906146*T),Oh(-.9787684*S+1.9161415*y+.033454*T),Oh(.0719453*S-.2289914*y+1.4052427*T),m]}function Oh(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function zh(h){return h>_r?h*h*h:Mp*(h-Gl)}const a_=Object.hasOwn||function(h,a){return Object.prototype.hasOwnProperty.call(h,a)};function Su(h,a){return a_(h,a)?h[a]:void 0}function Tu(h){return parseInt(h.padEnd(2,h),16)/255}function Mu(h,a){return Ec(a?h/100:h,0,1)}function Ec(h,a,u){return Math.min(Math.max(a,h),u)}function Xd(h){return!h.some(Number.isNaN)}const Ac={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function dl(h,a,u){return h+u*(a-h)}function Pc(h,a,u){return h.map(((m,y)=>dl(m,a[y],u)))}class nn{constructor(a,u,m,y=1,S=!0){this.r=a,this.g=u,this.b=m,this.a=y,S||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[a,u,m,y]))}static parse(a){if(a instanceof nn)return a;if(typeof a!="string")return;const u=(function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=Su(Ac,m);if(y){const[T,A,D]=y;return[T/255,A/255,D/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const T=m.length<6?1:2;let A=1;return[Tu(m.slice(A,A+=T)),Tu(m.slice(A,A+=T)),Tu(m.slice(A,A+=T)),Tu(m.slice(A,A+T)||"ff")]}if(m.startsWith("rgb")){const T=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[A,D,z,V,X,ie,re,he,me,_e,Se,Be]=T,Me=[V||" ",re||" ",_e].join("");if(Me==="  "||Me==="  /"||Me===",,"||Me===",,,"){const Ae=[z,ie,me].join(""),Ve=Ae==="%%%"?100:Ae===""?255:0;if(Ve){const qe=[Ec(+D/Ve,0,1),Ec(+X/Ve,0,1),Ec(+he/Ve,0,1),Se?Mu(+Se,Be):1];if(Xd(qe))return qe}}return}}const S=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[T,A,D,z,V,X,ie,re,he]=S,me=[D||" ",V||" ",ie].join("");if(me==="  "||me==="  /"||me===",,"||me===",,,"){const _e=[+A,Ec(+z,0,100),Ec(+X,0,100),re?Mu(+re,he):1];if(Xd(_e))return(function([Se,Be,Me,Ae]){function Ve(qe){const _t=(qe+Se/30)%12,Vt=Be*Math.min(Me,1-Me);return Me-Vt*Math.max(-1,Math.min(_t-3,9-_t,1))}return Se=Ap(Se),Be/=100,Me/=100,[Ve(0),Ve(8),Ve(4),Ae]})(_e)}}})(a);return u?new nn(...u,!1):void 0}get rgb(){const{r:a,g:u,b:m,a:y}=this,S=y||1/0;return this.overwriteGetter("rgb",[a/S,u/S,m/S,y])}get hcl(){return this.overwriteGetter("hcl",(function(a){const[u,m,y,S]=Pp(a),T=Math.sqrt(m*m+y*y);return[Math.round(1e4*T)?Ap(Math.atan2(y,m)*Ep):NaN,T,u,S]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Pp(this.rgb))}overwriteGetter(a,u){return Object.defineProperty(this,a,{value:u}),u}toString(){const[a,u,m,y]=this.rgb;return`rgba(${[a,u,m].map((S=>Math.round(255*S))).join(",")},${y})`}static interpolate(a,u,m,y="rgb"){switch(y){case"rgb":{const[S,T,A,D]=Pc(a.rgb,u.rgb,m);return new nn(S,T,A,D,!1)}case"hcl":{const[S,T,A,D]=a.hcl,[z,V,X,ie]=u.hcl;let re,he;if(isNaN(S)||isNaN(z))isNaN(S)?isNaN(z)?re=NaN:(re=z,A!==1&&A!==0||(he=V)):(re=S,X!==1&&X!==0||(he=T));else{let Me=z-S;z>S&&Me>180?Me-=360:z<S&&S-z>180&&(Me+=360),re=S+m*Me}const[me,_e,Se,Be]=(function([Me,Ae,Ve,qe]){return Me=isNaN(Me)?0:Me*wu,Fh([Ve,Math.cos(Me)*Ae,Math.sin(Me)*Ae,qe])})([re,he??dl(T,V,m),dl(A,X,m),dl(D,ie,m)]);return new nn(me,_e,Se,Be,!1)}case"lab":{const[S,T,A,D]=Fh(Pc(a.lab,u.lab,m));return new nn(S,T,A,D,!1)}}}}nn.black=new nn(0,0,0,1),nn.white=new nn(1,1,1,1),nn.transparent=new nn(0,0,0,0),nn.red=new nn(1,0,0,1);class Bh{constructor(a,u,m){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,u){return this.collator.compare(a,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ip=["bottom","center","top"];class Ic{constructor(a,u,m,y,S,T){this.text=a,this.image=u,this.scale=m,this.fontStack=y,this.textColor=S,this.verticalAlign=T}}class Bs{constructor(a){this.sections=a}static fromString(a){return new Bs([new Ic(a,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((a=>a.text.length!==0||a.image&&a.image.name.length!==0))}static factory(a){return a instanceof Bs?a:Bs.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map((a=>a.text)).join("")}}class us{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof us)return a;if(typeof a=="number")return new us([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const u of a)if(typeof u!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new us(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,m){return new us(Pc(a.values,u.values,m))}}class xn{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof xn)return a;if(typeof a=="number")return new xn([a]);if(Array.isArray(a)){for(const u of a)if(typeof u!="number")return;return new xn(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,m){return new xn(Pc(a.values,u.values,m))}}class Gi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Gi)return a;if(typeof a=="string"){const m=nn.parse(a);return m?new Gi([m]):void 0}if(!Array.isArray(a))return;const u=[];for(const m of a){if(typeof m!="string")return;const y=nn.parse(m);if(!y)return;u.push(y)}return new Gi(u)}toString(){return JSON.stringify(this.values)}static interpolate(a,u,m,y="rgb"){const S=[];if(a.values.length!=u.values.length)throw new Error(`colorArray: Arrays have mismatched length (${a.values.length} vs. ${u.values.length}), cannot interpolate.`);for(let T=0;T<a.values.length;T++)S.push(nn.interpolate(a.values[T],u.values[T],m,y));return new Gi(S)}}class On extends Error{constructor(a){super(a),this.name="RuntimeError"}toJSON(){return this.message}}const wa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ss{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Ss)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let u=0;u<a.length;u+=2){const m=a[u],y=a[u+1];if(typeof m!="string"||!wa.has(m)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new Ss(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,u,m){const y=a.values,S=u.values;if(y.length!==S.length)throw new On(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${u.toString()}`);const T=[];for(let A=0;A<y.length;A+=2){if(y[A]!==S[A])throw new On(`Cannot interpolate values containing mismatched anchors. from[${A}]: ${y[A]}, to[${A}]: ${S[A]}`);T.push(y[A]);const[D,z]=y[A+1],[V,X]=S[A+1];T.push([dl(D,V,m),dl(z,X,m)])}return new Ss(T)}}class oo{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new oo({name:a,available:!1}):null}}class Ns{constructor(a,u,m){this.from=a,this.to=u,this.transition=m}static interpolate(a,u,m){return new Ns(a,u,m)}static parse(a){return a instanceof Ns?a:Array.isArray(a)&&a.length===3&&typeof a[0]=="string"&&typeof a[1]=="string"&&typeof a[2]=="number"?new Ns(a[0],a[1],a[2]):typeof a=="object"&&typeof a.from=="string"&&typeof a.to=="string"&&typeof a.transition=="number"?new Ns(a.from,a.to,a.transition):typeof a=="string"?new Ns(a,a,1):void 0}}function Lc(h,a,u,m){return typeof h=="number"&&h>=0&&h<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[h,a,u,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[h,a,u,m]:[h,a,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fl(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof Ns||h instanceof nn||h instanceof Bh||h instanceof Bs||h instanceof us||h instanceof xn||h instanceof Gi||h instanceof Ss||h instanceof oo)return!0;if(Array.isArray(h)){for(const a of h)if(!fl(a))return!1;return!0}if(typeof h=="object"){for(const a in h)if(!fl(h[a]))return!1;return!0}return!1}function Pr(h){if(h===null)return Ii;if(typeof h=="string")return ai;if(typeof h=="boolean")return pi;if(typeof h=="number")return Dt;if(h instanceof nn)return Hi;if(h instanceof Ns)return ut;if(h instanceof Bh)return Ni;if(h instanceof Bs)return Kn;if(h instanceof us)return Zi;if(h instanceof xn)return sn;if(h instanceof Gi)return Un;if(h instanceof Ss)return jn;if(h instanceof oo)return zr;if(Array.isArray(h)){const a=h.length;let u;for(const m of h){const y=Pr(m);if(u){if(u===y)continue;u=bi;break}u=y}return an(u||bi,a)}return Li}function ql(h){const a=typeof h;return h===null?"":a==="string"||a==="number"||a==="boolean"?String(h):h instanceof nn||h instanceof Ns||h instanceof Bs||h instanceof us||h instanceof xn||h instanceof Gi||h instanceof Ss||h instanceof oo?h.toString():JSON.stringify(h)}class No{constructor(a,u){this.type=a,this.value=u}static parse(a,u){if(a.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!fl(a[1]))return u.error("invalid value");const m=a[1];let y=Pr(m);const S=u.expectedType;return y.kind!=="array"||y.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(y=S),new No(y,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Cu={string:ai,number:Dt,boolean:pi,object:Li};class Ts{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let m,y=1;const S=a[0];if(S==="array"){let A,D;if(a.length>2){const z=a[1];if(typeof z!="string"||!(z in Cu)||z==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=Cu[z],y++}else A=bi;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);D=a[2],y++}m=an(A,D)}else{if(!Cu[S])throw new Error(`Types doesn't contain name = ${S}`);m=Cu[S]}const T=[];for(;y<a.length;y++){const A=u.parse(a[y],y,bi);if(!A)return null;T.push(A)}return new Ts(m,T)}evaluate(a){for(let u=0;u<this.args.length;u++){const m=this.args[u].evaluate(a);if(!ro(this.type,Pr(m)))return m;if(u===this.args.length-1)throw new On(`Expected value to be of type ${Qi(this.type)}, but found ${Qi(Pr(m))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const Hl={"to-boolean":pi,"to-color":Hi,"to-number":Dt,"to-string":ai};class Sa{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const m=a[0];if(!Hl[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&a.length!==2)return u.error("Expected one argument.");const y=Hl[m],S=[];for(let T=1;T<a.length;T++){const A=u.parse(a[T],T,bi);if(!A)return null;S.push(A)}return new Sa(y,S)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let u,m;for(const y of this.args){if(u=y.evaluate(a),m=null,u instanceof nn)return u;if(typeof u=="string"){const S=a.parseColor(u);if(S)return S}else if(Array.isArray(u)&&(m=u.length<3||u.length>4?`Invalid rgba value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Lc(u[0],u[1],u[2],u[3]),!m))return new nn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new On(m||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const m of this.args){u=m.evaluate(a);const y=us.parse(u);if(y)return y}throw new On(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"numberArray":{let u;for(const m of this.args){u=m.evaluate(a);const y=xn.parse(u);if(y)return y}throw new On(`Could not parse numberArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"colorArray":{let u;for(const m of this.args){u=m.evaluate(a);const y=Gi.parse(u);if(y)return y}throw new On(`Could not parse colorArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const m of this.args){u=m.evaluate(a);const y=Ss.parse(u);if(y)return y}throw new On(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const m of this.args){if(u=m.evaluate(a),u===null)return 0;const y=Number(u);if(!isNaN(y))return y}throw new On(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Bs.fromString(ql(this.args[0].evaluate(a)));case"resolvedImage":return oo.fromString(ql(this.args[0].evaluate(a)));case"projectionDefinition":return this.args[0].evaluate(a);default:return ql(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const pl=["Unknown","Point","LineString","Polygon"];class $o{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let u=this._parseColorCache.get(a);return u||(u=nn.parse(a),this._parseColorCache.set(a,u)),u}}class ml{constructor(a,u,m=[],y,S=new qi,T=[]){this.registry=a,this.path=m,this.key=m.map((A=>`[${A}]`)).join(""),this.scope=S,this.errors=T,this.expectedType=y,this._isConstant=u}parse(a,u,m,y,S={}){return u?this.concat(u,m,y)._parse(a,S):this._parse(a,S)}_parse(a,u){function m(y,S,T){return T==="assert"?new Ts(S,[y]):T==="coerce"?new Sa(S,[y]):y}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=a[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[y];if(S){let T=S.parse(a,this);if(!T)return null;if(this.expectedType){const A=this.expectedType,D=T.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||D.kind!=="value"){if(A.kind==="projectionDefinition"&&["string","array"].includes(D.kind)||["color","formatted","resolvedImage"].includes(A.kind)&&["value","string"].includes(D.kind)||["padding","numberArray"].includes(A.kind)&&["value","number","array"].includes(D.kind)||A.kind==="colorArray"&&["value","string","array"].includes(D.kind)||A.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(D.kind))T=m(T,A,u.typeAnnotation||"coerce");else if(this.checkSubtype(A,D))return null}else T=m(T,A,u.typeAnnotation||"assert")}if(!(T instanceof No)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const A=new $o;try{T=new No(T.type,T.evaluate(A))}catch(D){return this.error(D.message),null}}return T}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,u,m){const y=typeof a=="number"?this.path.concat(a):this.path,S=m?this.scope.concat(m):this.scope;return new ml(this.registry,this._isConstant,y,u||null,S,this.errors)}error(a,...u){const m=`${this.key}${u.map((y=>`[${y}]`)).join("")}`;this.errors.push(new Gt(m,a))}checkSubtype(a,u){const m=ro(a,u);return m&&this.error(m),m}}class zn{constructor(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const u of this.bindings)a(u[1]);a(this.result)}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const m=[];for(let S=1;S<a.length-1;S+=2){const T=a[S];if(typeof T!="string")return u.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",S);const A=u.parse(a[S+1],S+1);if(!A)return null;m.push([T,A])}const y=u.parse(a[a.length-1],a.length-1,u.expectedType,m);return y?new zn(m,y):null}outputDefined(){return this.result.outputDefined()}}class Wl{constructor(a,u){this.type=u.type,this.name=a,this.boundExpression=u}static parse(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const m=a[1];return u.scope.has(m)?new Wl(m,u.scope.get(m)):u.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class pn{constructor(a,u,m){this.type=a,this.index=u,this.input=m}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=u.parse(a[1],1,Dt),y=u.parse(a[2],2,an(u.expectedType||bi));return m&&y?new pn(y.type.itemType,m,y):null}evaluate(a){const u=this.index.evaluate(a),m=this.input.evaluate(a);if(u<0)throw new On(`Array index out of bounds: ${u} < 0.`);if(u>=m.length)throw new On(`Array index out of bounds: ${u} > ${m.length-1}.`);if(u!==Math.floor(u))throw new On(`Array index must be an integer, but found ${u} instead.`);return m[u]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class Yi{constructor(a,u){this.type=pi,this.needle=a,this.haystack=u}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=u.parse(a[1],1,bi),y=u.parse(a[2],2,bi);return m&&y?hl(m.type,[pi,ai,Dt,Ii,bi])?new Yi(m,y):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(m.type)} instead`):null}evaluate(a){const u=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!m)return!1;if(!xo(u,["boolean","string","number","null"]))throw new On(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(Pr(u))} instead.`);if(!xo(m,["string","array"]))throw new On(`Expected second argument to be of type array or string, but found ${Qi(Pr(m))} instead.`);return m.indexOf(u)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class Zl{constructor(a,u,m){this.type=Dt,this.needle=a,this.haystack=u,this.fromIndex=m}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const m=u.parse(a[1],1,bi),y=u.parse(a[2],2,bi);if(!m||!y)return null;if(!hl(m.type,[pi,ai,Dt,Ii,bi]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(m.type)} instead`);if(a.length===4){const S=u.parse(a[3],3,Dt);return S?new Zl(m,y,S):null}return new Zl(m,y)}evaluate(a){const u=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!xo(u,["boolean","string","number","null"]))throw new On(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(Pr(u))} instead.`);let y;if(this.fromIndex&&(y=this.fromIndex.evaluate(a)),xo(m,["string"])){const S=m.indexOf(u,y);return S===-1?-1:[...m.slice(0,S)].length}if(xo(m,["array"]))return m.indexOf(u,y);throw new On(`Expected second argument to be of type array or string, but found ${Qi(Pr(m))} instead.`)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class bn{constructor(a,u,m,y,S,T){this.inputType=a,this.type=u,this.input=m,this.cases=y,this.outputs=S,this.otherwise=T}static parse(a,u){if(a.length<5)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return u.error("Expected an even number of arguments.");let m,y;u.expectedType&&u.expectedType.kind!=="value"&&(y=u.expectedType);const S={},T=[];for(let z=2;z<a.length-1;z+=2){let V=a[z];const X=a[z+1];Array.isArray(V)||(V=[V]);const ie=u.concat(z);if(V.length===0)return ie.error("Expected at least one branch label.");for(const he of V){if(typeof he!="number"&&typeof he!="string")return ie.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return ie.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof he=="number"&&Math.floor(he)!==he)return ie.error("Numeric branch labels must be integer values.");if(m){if(ie.checkSubtype(m,Pr(he)))return null}else m=Pr(he);if(S[String(he)]!==void 0)return ie.error("Branch labels must be unique.");S[String(he)]=T.length}const re=u.parse(X,z,y);if(!re)return null;y=y||re.type,T.push(re)}const A=u.parse(a[1],1,bi);if(!A)return null;const D=u.parse(a[a.length-1],a.length-1,y);return D?A.type.kind!=="value"&&u.concat(1).checkSubtype(m,A.type)?null:new bn(m,y,A,S,T,D):null}evaluate(a){const u=this.input.evaluate(a);return(Pr(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))&&this.otherwise.outputDefined()}}class Eu{constructor(a,u,m){this.type=a,this.branches=u,this.otherwise=m}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return u.error("Expected an odd number of arguments.");let m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);const y=[];for(let T=1;T<a.length-1;T+=2){const A=u.parse(a[T],T,pi);if(!A)return null;const D=u.parse(a[T+1],T+1,m);if(!D)return null;y.push([A,D]),m=m||D.type}const S=u.parse(a[a.length-1],a.length-1,m);if(!S)return null;if(!m)throw new Error("Can't infer output type");return new Eu(m,y,S)}evaluate(a){for(const[u,m]of this.branches)if(u.evaluate(a))return m.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[u,m]of this.branches)a(u),a(m);a(this.otherwise)}outputDefined(){return this.branches.every((([a,u])=>u.outputDefined()))&&this.otherwise.outputDefined()}}class wo{constructor(a,u,m,y){this.type=a,this.input=u,this.beginIndex=m,this.endIndex=y}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const m=u.parse(a[1],1,bi),y=u.parse(a[2],2,Dt);if(!m||!y)return null;if(!hl(m.type,[an(bi),ai,bi]))return u.error(`Expected first argument to be of type array or string, but found ${Qi(m.type)} instead`);if(a.length===4){const S=u.parse(a[3],3,Dt);return S?new wo(m.type,m,y,S):null}return new wo(m.type,m,y)}evaluate(a){const u=this.input.evaluate(a),m=this.beginIndex.evaluate(a);let y;if(this.endIndex&&(y=this.endIndex.evaluate(a)),xo(u,["string"]))return[...u].slice(m,y).join("");if(xo(u,["array"]))return u.slice(m,y);throw new On(`Expected first argument to be of type array or string, but found ${Qi(Pr(u))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function Xl(h,a){const u=h.length-1;let m,y,S=0,T=u,A=0;for(;S<=T;)if(A=Math.floor((S+T)/2),m=h[A],y=h[A+1],m<=a){if(A===u||a<y)return A;S=A+1}else{if(!(m>a))throw new On("Input is not a number.");T=A-1}return 0}class Ta{constructor(a,u,m){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(const[y,S]of m)this.labels.push(y),this.outputs.push(S)}static parse(a,u){if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");const m=u.parse(a[1],1,Dt);if(!m)return null;const y=[];let S=null;u.expectedType&&u.expectedType.kind!=="value"&&(S=u.expectedType);for(let T=1;T<a.length;T+=2){const A=T===1?-1/0:a[T],D=a[T+1],z=T,V=T+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const X=u.parse(D,V,S);if(!X)return null;S=S||X.type,y.push([A,X])}return new Ta(S,m,y)}evaluate(a){const u=this.labels,m=this.outputs;if(u.length===1)return m[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return m[0].evaluate(a);const S=u.length;return y>=u[S-1]?m[S-1].evaluate(a):m[Xl(u,y)].evaluate(a)}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Lp(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Au,Yd,l_=(function(){if(Yd)return Au;function h(a,u,m,y){this.cx=3*a,this.bx=3*(m-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(y-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=m,this.p2y=y}return Yd=1,Au=h,h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,u){if(u===void 0&&(u=1e-6),a<0)return 0;if(a>1)return 1;for(var m=a,y=0;y<8;y++){var S=this.sampleCurveX(m)-a;if(Math.abs(S)<u)return m;var T=this.sampleCurveDerivativeX(m);if(Math.abs(T)<1e-6)break;m-=S/T}var A=0,D=1;for(m=a,y=0;y<20&&(S=this.sampleCurveX(m),!(Math.abs(S-a)<u));y++)a>S?A=m:D=m,m=.5*(D-A)+A;return m},solve:function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))}},Au})(),Rp=Lp(l_);class vr{constructor(a,u,m,y,S){this.type=a,this.operator=u,this.interpolation=m,this.input=y,this.labels=[],this.outputs=[];for(const[T,A]of S)this.labels.push(T),this.outputs.push(A)}static interpolationFactor(a,u,m,y){let S=0;if(a.name==="exponential")S=Vo(u,a.base,m,y);else if(a.name==="linear")S=Vo(u,1,m,y);else if(a.name==="cubic-bezier"){const T=a.controlPoints;S=new Rp(T[0],T[1],T[2],T[3]).solve(Vo(u,1,m,y))}return S}static parse(a,u){let[m,y,S,...T]=a;if(!Array.isArray(y)||y.length===0)return u.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const z=y[1];if(typeof z!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:z}}else{if(y[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const z=y.slice(1);if(z.length!==4||z.some((V=>typeof V!="number"||V<0||V>1)))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:z}}}if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(S=u.parse(S,2,Dt),!S)return null;const A=[];let D=null;m!=="interpolate-hcl"&&m!=="interpolate-lab"||u.expectedType==Un?u.expectedType&&u.expectedType.kind!=="value"&&(D=u.expectedType):D=Hi;for(let z=0;z<T.length;z+=2){const V=T[z],X=T[z+1],ie=z+3,re=z+4;if(typeof V!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ie);if(A.length&&A[A.length-1][0]>=V)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ie);const he=u.parse(X,re,D);if(!he)return null;D=D||he.type,A.push([V,he])}return Ar(D,Dt)||Ar(D,ut)||Ar(D,Hi)||Ar(D,Zi)||Ar(D,sn)||Ar(D,Un)||Ar(D,jn)||Ar(D,an(Dt))?new vr(D,m,y,S,A):u.error(`Type ${Qi(D)} is not interpolatable.`)}evaluate(a){const u=this.labels,m=this.outputs;if(u.length===1)return m[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return m[0].evaluate(a);const S=u.length;if(y>=u[S-1])return m[S-1].evaluate(a);const T=Xl(u,y),A=vr.interpolationFactor(this.interpolation,y,u[T],u[T+1]),D=m[T].evaluate(a),z=m[T+1].evaluate(a);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return dl(D,z,A);case"color":return nn.interpolate(D,z,A);case"padding":return us.interpolate(D,z,A);case"colorArray":return Gi.interpolate(D,z,A);case"numberArray":return xn.interpolate(D,z,A);case"variableAnchorOffsetCollection":return Ss.interpolate(D,z,A);case"array":return Pc(D,z,A);case"projectionDefinition":return Ns.interpolate(D,z,A)}case"interpolate-hcl":switch(this.type.kind){case"color":return nn.interpolate(D,z,A,"hcl");case"colorArray":return Gi.interpolate(D,z,A,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return nn.interpolate(D,z,A,"lab");case"colorArray":return Gi.interpolate(D,z,A,"lab")}}}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Vo(h,a,u,m){const y=m-u,S=h-u;return y===0?0:a===1?S/y:(Math.pow(a,S)-1)/(Math.pow(a,y)-1)}const rr={color:nn.interpolate,number:dl,padding:us.interpolate,numberArray:xn.interpolate,colorArray:Gi.interpolate,variableAnchorOffsetCollection:Ss.interpolate,array:Pc};class Yl{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let m=null;const y=u.expectedType;y&&y.kind!=="value"&&(m=y);const S=[];for(const A of a.slice(1)){const D=u.parse(A,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!D)return null;m=m||D.type,S.push(D)}if(!m)throw new Error("No output type");const T=y&&S.some((A=>ro(y,A.type)));return new Yl(T?bi:m,S)}evaluate(a){let u,m=null,y=0;for(const S of this.args)if(y++,m=S.evaluate(a),m&&m instanceof oo&&!m.available&&(u||(u=m.name),m=null,y===this.args.length&&(m=u)),m!==null)break;return m}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}function Kd(h,a){return h==="=="||h==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Pu(h,a,u,m){return m.compare(a,u)===0}function yr(h,a,u){const m=h!=="=="&&h!=="!=";return class kk{constructor(S,T,A){this.type=pi,this.lhs=S,this.rhs=T,this.collator=A,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const A=S[0];let D=T.parse(S[1],1,bi);if(!D)return null;if(!Kd(A,D.type))return T.concat(1).error(`"${A}" comparisons are not supported for type '${Qi(D.type)}'.`);let z=T.parse(S[2],2,bi);if(!z)return null;if(!Kd(A,z.type))return T.concat(2).error(`"${A}" comparisons are not supported for type '${Qi(z.type)}'.`);if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return T.error(`Cannot compare types '${Qi(D.type)}' and '${Qi(z.type)}'.`);m&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new Ts(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new Ts(D.type,[z])));let V=null;if(S.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(V=T.parse(S[3],3,Ni),!V)return null}return new kk(D,z,V)}evaluate(S){const T=this.lhs.evaluate(S),A=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const D=Pr(T),z=Pr(A);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new On(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${D.kind}, ${z.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const D=Pr(T),z=Pr(A);if(D.kind!=="string"||z.kind!=="string")return a(S,T,A)}return this.collator?u(S,T,A,this.collator.evaluate(S)):a(S,T,A)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const kp=yr("==",(function(h,a,u){return a===u}),Pu),Jd=yr("!=",(function(h,a,u){return a!==u}),(function(h,a,u,m){return!Pu(0,a,u,m)})),Dp=yr("<",(function(h,a,u){return a<u}),(function(h,a,u,m){return m.compare(a,u)<0})),Qd=yr(">",(function(h,a,u){return a>u}),(function(h,a,u,m){return m.compare(a,u)>0})),Ma=yr("<=",(function(h,a,u){return a<=u}),(function(h,a,u,m){return m.compare(a,u)<=0})),Nh=yr(">=",(function(h,a,u){return a>=u}),(function(h,a,u,m){return m.compare(a,u)>=0}));class Kl{constructor(a,u,m){this.type=Ni,this.locale=m,this.caseSensitive=a,this.diacriticSensitive=u}static parse(a,u){if(a.length!==2)return u.error("Expected one argument.");const m=a[1];if(typeof m!="object"||Array.isArray(m))return u.error("Collator options argument must be an object.");const y=u.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,pi);if(!y)return null;const S=u.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,pi);if(!S)return null;let T=null;return m.locale&&(T=u.parse(m.locale,1,ai),!T)?null:new Kl(y,S,T)}evaluate(a){return new Bh(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class $h{constructor(a,u,m,y,S){this.type=ai,this.number=a,this.locale=u,this.currency=m,this.minFractionDigits=y,this.maxFractionDigits=S}static parse(a,u){if(a.length!==3)return u.error("Expected two arguments.");const m=u.parse(a[1],1,Dt);if(!m)return null;const y=a[2];if(typeof y!="object"||Array.isArray(y))return u.error("NumberFormat options argument must be an object.");let S=null;if(y.locale&&(S=u.parse(y.locale,1,ai),!S))return null;let T=null;if(y.currency&&(T=u.parse(y.currency,1,ai),!T))return null;let A=null;if(y["min-fraction-digits"]&&(A=u.parse(y["min-fraction-digits"],1,Dt),!A))return null;let D=null;return y["max-fraction-digits"]&&(D=u.parse(y["max-fraction-digits"],1,Dt),!D)?null:new $h(m,S,T,A,D)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Ca{constructor(a){this.type=Kn,this.sections=a}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const m=a[1];if(!Array.isArray(m)&&typeof m=="object")return u.error("First argument must be an image or text section.");const y=[];let S=!1;for(let T=1;T<=a.length-1;++T){const A=a[T];if(S&&typeof A=="object"&&!Array.isArray(A)){S=!1;let D=null;if(A["font-scale"]&&(D=u.parse(A["font-scale"],1,Dt),!D))return null;let z=null;if(A["text-font"]&&(z=u.parse(A["text-font"],1,an(ai)),!z))return null;let V=null;if(A["text-color"]&&(V=u.parse(A["text-color"],1,Hi),!V))return null;let X=null;if(A["vertical-align"]){if(typeof A["vertical-align"]=="string"&&!Ip.includes(A["vertical-align"]))return u.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${A["vertical-align"]}' instead.`);if(X=u.parse(A["vertical-align"],1,ai),!X)return null}const ie=y[y.length-1];ie.scale=D,ie.font=z,ie.textColor=V,ie.verticalAlign=X}else{const D=u.parse(a[T],1,bi);if(!D)return null;const z=D.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,y.push({content:D,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ca(y)}evaluate(a){return new Bs(this.sections.map((u=>{const m=u.content.evaluate(a);return Pr(m)===zr?new Ic("",m,null,null,null,u.verticalAlign?u.verticalAlign.evaluate(a):null):new Ic(ql(m),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null,u.verticalAlign?u.verticalAlign.evaluate(a):null)})))}eachChild(a){for(const u of this.sections)a(u.content),u.scale&&a(u.scale),u.font&&a(u.font),u.textColor&&a(u.textColor),u.verticalAlign&&a(u.verticalAlign)}outputDefined(){return!1}}class gl{constructor(a){this.type=zr,this.input=a}static parse(a,u){if(a.length!==2)return u.error("Expected two arguments.");const m=u.parse(a[1],1,ai);return m?new gl(m):u.error("No image name provided.")}evaluate(a){const u=this.input.evaluate(a),m=oo.fromString(u);return m&&a.availableImages&&(m.available=a.availableImages.indexOf(u)>-1),m}eachChild(a){a(this.input)}outputDefined(){return!1}}class _l{constructor(a){this.type=Dt,this.input=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=u.parse(a[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Qi(m.type)} instead.`):new _l(m):null}evaluate(a){const u=this.input.evaluate(a);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new On(`Expected value to be of type string or array, but found ${Qi(Pr(u))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const qr=8192;function Fp(h,a){const u=(180+h[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,y=Math.pow(2,a.z);return[Math.round(u*y*qr),Math.round(m*y*qr)]}function Rc(h,a){const u=Math.pow(2,a.z);return[(y=(h[0]/qr+a.x)/u,360*y-180),(m=(h[1]/qr+a.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,y}function Uo(h,a){h[0]=Math.min(h[0],a[0]),h[1]=Math.min(h[1],a[1]),h[2]=Math.max(h[2],a[0]),h[3]=Math.max(h[3],a[1])}function Jl(h,a){return!(h[0]<=a[0]||h[2]>=a[2]||h[1]<=a[1]||h[3]>=a[3])}function c_(h,a,u){const m=h[0]-a[0],y=h[1]-a[1],S=h[0]-u[0],T=h[1]-u[1];return m*T-S*y==0&&m*S<=0&&y*T<=0}function Vh(h,a,u,m){return(y=[m[0]-u[0],m[1]-u[1]])[0]*(S=[a[0]-h[0],a[1]-h[1]])[1]-y[1]*S[0]!=0&&!(!tf(h,a,u,m)||!tf(u,m,h,a));var y,S}function u_(h,a,u){for(const m of u)for(let y=0;y<m.length-1;++y)if(Vh(h,a,m[y],m[y+1]))return!0;return!1}function Ea(h,a,u=!1){let m=!1;for(const A of a)for(let D=0;D<A.length-1;D++){if(c_(h,A[D],A[D+1]))return u;(S=A[D])[1]>(y=h)[1]!=(T=A[D+1])[1]>y[1]&&y[0]<(T[0]-S[0])*(y[1]-S[1])/(T[1]-S[1])+S[0]&&(m=!m)}var y,S,T;return m}function kc(h,a){for(const u of a)if(Ea(h,u))return!0;return!1}function Op(h,a){for(const u of h)if(!Ea(u,a))return!1;for(let u=0;u<h.length-1;++u)if(u_(h[u],h[u+1],a))return!1;return!0}function ef(h,a){for(const u of a)if(Op(h,u))return!0;return!1}function tf(h,a,u,m){const y=m[0]-u[0],S=m[1]-u[1],T=(h[0]-u[0])*S-y*(h[1]-u[1]),A=(a[0]-u[0])*S-y*(a[1]-u[1]);return T>0&&A<0||T<0&&A>0}function vl(h,a,u){const m=[];for(let y=0;y<h.length;y++){const S=[];for(let T=0;T<h[y].length;T++){const A=Fp(h[y][T],u);Uo(a,A),S.push(A)}m.push(S)}return m}function Iu(h,a,u){const m=[];for(let y=0;y<h.length;y++){const S=vl(h[y],a,u);m.push(S)}return m}function nf(h,a,u,m){if(h[0]<u[0]||h[0]>u[2]){const y=.5*m;let S=h[0]-u[0]>y?-m:u[0]-h[0]>y?m:0;S===0&&(S=h[0]-u[2]>y?-m:u[2]-h[0]>y?m:0),h[0]+=S}Uo(a,h)}function zp(h,a,u,m){const y=Math.pow(2,m.z)*qr,S=[m.x*qr,m.y*qr],T=[];for(const A of h)for(const D of A){const z=[D.x+S[0],D.y+S[1]];nf(z,a,u,y),T.push(z)}return T}function Bp(h,a,u,m){const y=Math.pow(2,m.z)*qr,S=[m.x*qr,m.y*qr],T=[];for(const D of h){const z=[];for(const V of D){const X=[V.x+S[0],V.y+S[1]];Uo(a,X),z.push(X)}T.push(z)}if(a[2]-a[0]<=y/2){(A=a)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const D of T)for(const z of D)nf(z,a,u,y)}var A;return T}class Ql{constructor(a,u){this.type=pi,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(fl(a[1])){const m=a[1];if(m.type==="FeatureCollection"){const y=[];for(const S of m.features){const{type:T,coordinates:A}=S.geometry;T==="Polygon"&&y.push(A),T==="MultiPolygon"&&y.push(...A)}if(y.length)return new Ql(m,{type:"MultiPolygon",coordinates:y})}else if(m.type==="Feature"){const y=m.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ql(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Ql(m,m)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,m){const y=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(m.type==="Polygon"){const A=vl(m.coordinates,S,T),D=zp(u.geometry(),y,S,T);if(!Jl(y,S))return!1;for(const z of D)if(!Ea(z,A))return!1}if(m.type==="MultiPolygon"){const A=Iu(m.coordinates,S,T),D=zp(u.geometry(),y,S,T);if(!Jl(y,S))return!1;for(const z of D)if(!kc(z,A))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,m){const y=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(m.type==="Polygon"){const A=vl(m.coordinates,S,T),D=Bp(u.geometry(),y,S,T);if(!Jl(y,S))return!1;for(const z of D)if(!Op(z,A))return!1}if(m.type==="MultiPolygon"){const A=Iu(m.coordinates,S,T),D=Bp(u.geometry(),y,S,T);if(!Jl(y,S))return!1;for(const z of D)if(!ef(z,A))return!1}return!0})(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Dc=class{constructor(h=[],a=(u,m)=>u<m?-1:u>m?1:0){if(this.data=h,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:a,compare:u}=this,m=a[h];for(;h>0;){const y=h-1>>1,S=a[y];if(u(m,S)>=0)break;a[h]=S,h=y}a[h]=m}_down(h){const{data:a,compare:u}=this,m=this.length>>1,y=a[h];for(;h<m;){let S=1+(h<<1);const T=S+1;if(T<this.length&&u(a[T],a[S])<0&&(S=T),u(a[S],y)>=0)break;a[h]=a[S],h=S}a[h]=y}};function Aa(h,a,u=0,m=h.length-1,y=Np){for(;m>u;){if(m-u>600){const D=m-u+1,z=a-u+1,V=Math.log(D),X=.5*Math.exp(2*V/3),ie=.5*Math.sqrt(V*X*(D-X)/D)*(z-D/2<0?-1:1);Aa(h,a,Math.max(u,Math.floor(a-z*X/D+ie)),Math.min(m,Math.floor(a+(D-z)*X/D+ie)),y)}const S=h[a];let T=u,A=m;for(Fc(h,u,a),y(h[m],S)>0&&Fc(h,u,m);T<A;){for(Fc(h,T,A),T++,A--;y(h[T],S)<0;)T++;for(;y(h[A],S)>0;)A--}y(h[u],S)===0?Fc(h,u,A):(A++,Fc(h,A,m)),A<=a&&(u=A+1),a<=A&&(m=A-1)}}function Fc(h,a,u){const m=h[a];h[a]=h[u],h[u]=m}function Np(h,a){return h<a?-1:h>a?1:0}function Uh(h,a){if(h.length<=1)return[h];const u=[];let m,y;for(const S of h){const T=d_(S);T!==0&&(S.area=Math.abs(T),y===void 0&&(y=T<0),y===T<0?(m&&u.push(m),m=[S]):m.push(S))}if(m&&u.push(m),a>1)for(let S=0;S<u.length;S++)u[S].length<=a||(Aa(u[S],a,1,u[S].length-1,h_),u[S]=u[S].slice(0,a));return u}function h_(h,a){return a.area-h.area}function d_(h){let a=0;for(let u,m,y=0,S=h.length,T=S-1;y<S;T=y++)u=h[y],m=h[T],a+=(m.x-u.x)*(u.y+m.y);return a}const $p=1/298.257223563,Lu=$p*(2-$p),Vp=Math.PI/180;class jh{constructor(a){const u=6378.137*Vp*1e3,m=Math.cos(a*Vp),y=1/(1-Lu*(1-m*m)),S=Math.sqrt(y);this.kx=u*S*m,this.ky=u*S*y*(1-Lu)}distance(a,u){const m=this.wrap(a[0]-u[0])*this.kx,y=(a[1]-u[1])*this.ky;return Math.sqrt(m*m+y*y)}pointOnLine(a,u){let m,y,S,T,A=1/0;for(let D=0;D<a.length-1;D++){let z=a[D][0],V=a[D][1],X=this.wrap(a[D+1][0]-z)*this.kx,ie=(a[D+1][1]-V)*this.ky,re=0;X===0&&ie===0||(re=(this.wrap(u[0]-z)*this.kx*X+(u[1]-V)*this.ky*ie)/(X*X+ie*ie),re>1?(z=a[D+1][0],V=a[D+1][1]):re>0&&(z+=X/this.kx*re,V+=ie/this.ky*re)),X=this.wrap(u[0]-z)*this.kx,ie=(u[1]-V)*this.ky;const he=X*X+ie*ie;he<A&&(A=he,m=z,y=V,S=D,T=re)}return{point:[m,y],index:S,t:Math.max(0,Math.min(1,T))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}function Up(h,a){return a[0]-h[0]}function Ru(h){return h[1]-h[0]+1}function ao(h,a){return h[1]>=h[0]&&h[1]<a}function ku(h,a){if(h[0]>h[1])return[null,null];const u=Ru(h);if(a){if(u===2)return[h,null];const y=Math.floor(u/2);return[[h[0],h[0]+y],[h[0]+y,h[1]]]}if(u===1)return[h,null];const m=Math.floor(u/2)-1;return[[h[0],h[0]+m],[h[0]+m+1,h[1]]]}function Pa(h,a){if(!ao(a,h.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let m=a[0];m<=a[1];++m)Uo(u,h[m]);return u}function Gh(h){const a=[1/0,1/0,-1/0,-1/0];for(const u of h)for(const m of u)Uo(a,m);return a}function Du(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function Fu(h,a,u){if(!Du(h)||!Du(a))return NaN;let m=0,y=0;return h[2]<a[0]&&(m=a[0]-h[2]),h[0]>a[2]&&(m=h[0]-a[2]),h[1]>a[3]&&(y=h[1]-a[3]),h[3]<a[1]&&(y=a[1]-h[3]),u.distance([0,0],[m,y])}function Ia(h,a,u){const m=u.pointOnLine(a,h);return u.distance(h,m.point)}function qh(h,a,u,m,y){const S=Math.min(Ia(h,[u,m],y),Ia(a,[u,m],y)),T=Math.min(Ia(u,[h,a],y),Ia(m,[h,a],y));return Math.min(S,T)}function rf(h,a,u,m,y){if(!ao(a,h.length)||!ao(m,u.length))return 1/0;let S=1/0;for(let T=a[0];T<a[1];++T){const A=h[T],D=h[T+1];for(let z=m[0];z<m[1];++z){const V=u[z],X=u[z+1];if(Vh(A,D,V,X))return 0;S=Math.min(S,qh(A,D,V,X,y))}}return S}function jp(h,a,u,m,y){if(!ao(a,h.length)||!ao(m,u.length))return NaN;let S=1/0;for(let T=a[0];T<=a[1];++T)for(let A=m[0];A<=m[1];++A)if(S=Math.min(S,y.distance(h[T],u[A])),S===0)return S;return S}function ec(h,a,u){if(Ea(h,a,!0))return 0;let m=1/0;for(const y of a){const S=y[0],T=y[y.length-1];if(S!==T&&(m=Math.min(m,Ia(h,[T,S],u)),m===0))return m;const A=u.pointOnLine(y,h);if(m=Math.min(m,u.distance(h,A.point)),m===0)return m}return m}function yl(h,a,u,m){if(!ao(a,h.length))return NaN;for(let S=a[0];S<=a[1];++S)if(Ea(h[S],u,!0))return 0;let y=1/0;for(let S=a[0];S<a[1];++S){const T=h[S],A=h[S+1];for(const D of u)for(let z=0,V=D.length,X=V-1;z<V;X=z++){const ie=D[X],re=D[z];if(Vh(T,A,ie,re))return 0;y=Math.min(y,qh(T,A,ie,re,m))}}return y}function Gp(h,a){for(const u of h)for(const m of u)if(Ea(m,a,!0))return!0;return!1}function f_(h,a,u,m=1/0){const y=Gh(h),S=Gh(a);if(m!==1/0&&Fu(y,S,u)>=m)return m;if(Jl(y,S)){if(Gp(h,a))return 0}else if(Gp(a,h))return 0;let T=1/0;for(const A of h)for(let D=0,z=A.length,V=z-1;D<z;V=D++){const X=A[V],ie=A[D];for(const re of a)for(let he=0,me=re.length,_e=me-1;he<me;_e=he++){const Se=re[_e],Be=re[he];if(Vh(X,ie,Se,Be))return 0;T=Math.min(T,qh(X,ie,Se,Be,u))}}return T}function Sn(h,a,u,m,y,S){if(!S)return;const T=Fu(Pa(m,S),y,u);T<a&&h.push([T,S,[0,0]])}function Hh(h,a,u,m,y,S,T){if(!S||!T)return;const A=Fu(Pa(m,S),Pa(y,T),u);A<a&&h.push([A,S,T])}function Wh(h,a,u,m,y=1/0){let S=Math.min(m.distance(h[0],u[0][0]),y);if(S===0)return S;const T=new Dc([[0,[0,h.length-1],[0,0]]],Up),A=Gh(u);for(;T.length>0;){const D=T.pop();if(D[0]>=S)continue;const z=D[1],V=a?50:100;if(Ru(z)<=V){if(!ao(z,h.length))return NaN;if(a){const X=yl(h,z,u,m);if(isNaN(X)||X===0)return X;S=Math.min(S,X)}else for(let X=z[0];X<=z[1];++X){const ie=ec(h[X],u,m);if(S=Math.min(S,ie),S===0)return 0}}else{const X=ku(z,a);Sn(T,S,m,h,A,X[0]),Sn(T,S,m,h,A,X[1])}}return S}function Zh(h,a,u,m,y,S=1/0){let T=Math.min(S,y.distance(h[0],u[0]));if(T===0)return T;const A=new Dc([[0,[0,h.length-1],[0,u.length-1]]],Up);for(;A.length>0;){const D=A.pop();if(D[0]>=T)continue;const z=D[1],V=D[2],X=a?50:100,ie=m?50:100;if(Ru(z)<=X&&Ru(V)<=ie){if(!ao(z,h.length)&&ao(V,u.length))return NaN;let re;if(a&&m)re=rf(h,z,u,V,y),T=Math.min(T,re);else if(a&&!m){const he=h.slice(z[0],z[1]+1);for(let me=V[0];me<=V[1];++me)if(re=Ia(u[me],he,y),T=Math.min(T,re),T===0)return T}else if(!a&&m){const he=u.slice(V[0],V[1]+1);for(let me=z[0];me<=z[1];++me)if(re=Ia(h[me],he,y),T=Math.min(T,re),T===0)return T}else re=jp(h,z,u,V,y),T=Math.min(T,re)}else{const re=ku(z,a),he=ku(V,m);Hh(A,T,y,h,u,re[0],he[0]),Hh(A,T,y,h,u,re[0],he[1]),Hh(A,T,y,h,u,re[1],he[0]),Hh(A,T,y,h,u,re[1],he[1])}}return T}function sf(h){return h.type==="MultiPolygon"?h.coordinates.map((a=>({type:"Polygon",coordinates:a}))):h.type==="MultiLineString"?h.coordinates.map((a=>({type:"LineString",coordinates:a}))):h.type==="MultiPoint"?h.coordinates.map((a=>({type:"Point",coordinates:a}))):[h]}class tc{constructor(a,u){this.type=Dt,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(fl(a[1])){const m=a[1];if(m.type==="FeatureCollection")return new tc(m,m.features.map((y=>sf(y.geometry))).flat());if(m.type==="Feature")return new tc(m,sf(m.geometry));if("type"in m&&"coordinates"in m)return new tc(m,sf(m))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(u,m){const y=u.geometry(),S=y.flat().map((D=>Rc([D.x,D.y],u.canonical)));if(y.length===0)return NaN;const T=new jh(S[0][1]);let A=1/0;for(const D of m){switch(D.type){case"Point":A=Math.min(A,Zh(S,!1,[D.coordinates],!1,T,A));break;case"LineString":A=Math.min(A,Zh(S,!1,D.coordinates,!0,T,A));break;case"Polygon":A=Math.min(A,Wh(S,!1,D.coordinates,T,A))}if(A===0)return A}return A})(a,this.geometries);if(a.geometryType()==="LineString")return(function(u,m){const y=u.geometry(),S=y.flat().map((D=>Rc([D.x,D.y],u.canonical)));if(y.length===0)return NaN;const T=new jh(S[0][1]);let A=1/0;for(const D of m){switch(D.type){case"Point":A=Math.min(A,Zh(S,!0,[D.coordinates],!1,T,A));break;case"LineString":A=Math.min(A,Zh(S,!0,D.coordinates,!0,T,A));break;case"Polygon":A=Math.min(A,Wh(S,!0,D.coordinates,T,A))}if(A===0)return A}return A})(a,this.geometries);if(a.geometryType()==="Polygon")return(function(u,m){const y=u.geometry();if(y.length===0||y[0].length===0)return NaN;const S=Uh(y,0).map((D=>D.map((z=>z.map((V=>Rc([V.x,V.y],u.canonical))))))),T=new jh(S[0][0][0][1]);let A=1/0;for(const D of m)for(const z of S){switch(D.type){case"Point":A=Math.min(A,Wh([D.coordinates],!1,z,T,A));break;case"LineString":A=Math.min(A,Wh(D.coordinates,!0,z,T,A));break;case"Polygon":A=Math.min(A,f_(z,D.coordinates,T,A))}if(A===0)return A}return A})(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Oc{constructor(a){this.type=bi,this.key=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=a[1];return m==null?u.error("Global state property must be defined."):typeof m!="string"?u.error(`Global state property must be string, but found ${typeof a[1]} instead.`):new Oc(m)}evaluate(a){var u;const m=(u=a.globals)===null||u===void 0?void 0:u.globalState;return m&&Object.keys(m).length!==0?Su(m,this.key):null}eachChild(){}outputDefined(){return!1}}const La={"==":kp,"!=":Jd,">":Qd,"<":Dp,">=":Nh,"<=":Ma,array:Ts,at:pn,boolean:Ts,case:Eu,coalesce:Yl,collator:Kl,format:Ca,image:gl,in:Yi,"index-of":Zl,interpolate:vr,"interpolate-hcl":vr,"interpolate-lab":vr,length:_l,let:zn,literal:No,match:bn,number:Ts,"number-format":$h,object:Ts,slice:wo,step:Ta,string:Ts,"to-boolean":Sa,"to-color":Sa,"to-number":Sa,"to-string":Sa,var:Wl,within:Ql,distance:tc,"global-state":Oc};class $s{constructor(a,u,m,y){this.name=a,this.type=u,this._evaluate=m,this.args=y}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,u){const m=a[0],y=$s.definitions[m];if(!y)return u.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(y)?y[0]:y.type,T=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,A=T.filter((([z])=>!Array.isArray(z)||z.length===a.length-1));let D=null;for(const[z,V]of A){D=new ml(u.registry,Z,u.path,null,u.scope);const X=[];let ie=!1;for(let re=1;re<a.length;re++){const he=a[re],me=Array.isArray(z)?z[re-1]:z.type,_e=D.parse(he,1+X.length,me);if(!_e){ie=!0;break}X.push(_e)}if(!ie)if(Array.isArray(z)&&z.length!==X.length)D.error(`Expected ${z.length} arguments, but found ${X.length} instead.`);else{for(let re=0;re<X.length;re++){const he=Array.isArray(z)?z[re]:z.type,me=X[re];D.concat(re+1).checkSubtype(he,me.type)}if(D.errors.length===0)return new $s(m,S,V,X)}}if(A.length===1)u.errors.push(...D.errors);else{const z=(A.length?A:T).map((([X])=>{return ie=X,Array.isArray(ie)?`(${ie.map(Qi).join(", ")})`:`(${Qi(ie.type)}...)`;var ie})).join(" | "),V=[];for(let X=1;X<a.length;X++){const ie=u.parse(a[X],1+V.length);if(!ie)return null;V.push(Qi(ie.type))}u.error(`Expected arguments of type ${z}, but found (${V.join(", ")}) instead.`)}return null}static register(a,u){$s.definitions=u;for(const m in u)a[m]=$s}}function qp(h,[a,u,m,y]){a=a.evaluate(h),u=u.evaluate(h),m=m.evaluate(h);const S=y?y.evaluate(h):1,T=Lc(a,u,m,S);if(T)throw new On(T);return new nn(a/255,u/255,m/255,S,!1)}function Hp(h,a){return h in a}function ic(h,a){const u=a[h];return u===void 0?null:u}function it(h){return{type:h}}function Z(h){if(h instanceof Wl)return Z(h.boundExpression);if(h instanceof $s&&h.name==="error"||h instanceof Kl||h instanceof Ql||h instanceof tc||h instanceof Oc)return!1;const a=h instanceof Sa||h instanceof Ts;let u=!0;return h.eachChild((m=>{u=a?u&&Z(m):u&&m instanceof No})),!!u&&ye(h)&&qt(h,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ye(h){if(h instanceof $s&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Ql||h instanceof tc)return!1;let a=!0;return h.eachChild((u=>{a&&!ye(u)&&(a=!1)})),a}function nt(h){if(h instanceof $s&&h.name==="feature-state")return!1;let a=!0;return h.eachChild((u=>{a&&!nt(u)&&(a=!1)})),a}function qt(h,a){if(h instanceof $s&&a.indexOf(h.name)>=0)return!1;let u=!0;return h.eachChild((m=>{u&&!qt(m,a)&&(u=!1)})),u}function di(h){return{result:"success",value:h}}function Ti(h){return{result:"error",value:h}}function _n(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function fr(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Ms(h){return!!h.expression&&h.expression.interpolated}function ji(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Ks(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)&&Pr(h)===Li}function Ra(h){return h}function la(h,a){const u=h.stops&&typeof h.stops[0][0]=="object",m=u||!(u||h.property!==void 0),y=h.type||(Ms(a)?"exponential":"interval"),S=(function(V){switch(V.type){case"color":return nn.parse;case"padding":return us.parse;case"numberArray":return xn.parse;case"colorArray":return Gi.parse;default:return null}})(a);if(S&&((h=It({},h)).stops&&(h.stops=h.stops.map((V=>[V[0],S(V[1])]))),h.default=S(h.default?h.default:a.default)),h.colorSpace&&(T=h.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var T;const A=(function(V){switch(V){case"exponential":return zu;case"interval":return Ou;case"categorical":return Go;case"identity":return p_;default:throw new Error(`Unknown function type "${V}"`)}})(y);let D,z;if(y==="categorical"){D=Object.create(null);for(const V of h.stops)D[V[0]]=V[1];z=typeof h.stops[0][0]}if(u){const V={},X=[];for(let he=0;he<h.stops.length;he++){const me=h.stops[he],_e=me[0].zoom;V[_e]===void 0&&(V[_e]={zoom:_e,type:h.type,property:h.property,default:h.default,stops:[]},X.push(_e)),V[_e].stops.push([me[0].value,me[1]])}const ie=[];for(const he of X)ie.push([V[he].zoom,la(V[he],a)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:vr.interpolationFactor.bind(void 0,re),zoomStops:ie.map((he=>he[0])),evaluate:({zoom:he},me)=>zu({stops:ie,base:h.base},a,he).evaluate(he,me)}}if(m){const V=y==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:V,interpolationFactor:vr.interpolationFactor.bind(void 0,V),zoomStops:h.stops.map((X=>X[0])),evaluate:({zoom:X})=>A(h,a,X,D,z)}}return{kind:"source",evaluate(V,X){const ie=X&&X.properties?X.properties[h.property]:void 0;return ie===void 0?jo(h.default,a.default):A(h,a,ie,D,z)}}}function jo(h,a,u){return h!==void 0?h:a!==void 0?a:u!==void 0?u:void 0}function Go(h,a,u,m,y){return jo(typeof u===y?m[u]:void 0,h.default,a.default)}function Ou(h,a,u){if(ji(u)!=="number")return jo(h.default,a.default);const m=h.stops.length;if(m===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[m-1][0])return h.stops[m-1][1];const y=Xl(h.stops.map((S=>S[0])),u);return h.stops[y][1]}function zu(h,a,u){const m=h.base!==void 0?h.base:1;if(ji(u)!=="number")return jo(h.default,a.default);const y=h.stops.length;if(y===1||u<=h.stops[0][0])return h.stops[0][1];if(u>=h.stops[y-1][0])return h.stops[y-1][1];const S=Xl(h.stops.map((V=>V[0])),u),T=(function(V,X,ie,re){const he=re-ie,me=V-ie;return he===0?0:X===1?me/he:(Math.pow(X,me)-1)/(Math.pow(X,he)-1)})(u,m,h.stops[S][0],h.stops[S+1][0]),A=h.stops[S][1],D=h.stops[S+1][1],z=rr[a.type]||Ra;return typeof A.evaluate=="function"?{evaluate(...V){const X=A.evaluate.apply(void 0,V),ie=D.evaluate.apply(void 0,V);if(X!==void 0&&ie!==void 0)return z(X,ie,T,h.colorSpace)}}:z(A,D,T,h.colorSpace)}function p_(h,a,u){switch(a.type){case"color":u=nn.parse(u);break;case"formatted":u=Bs.fromString(u.toString());break;case"resolvedImage":u=oo.fromString(u.toString());break;case"padding":u=us.parse(u);break;case"colorArray":u=Gi.parse(u);break;case"numberArray":u=xn.parse(u);break;default:ji(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0)}return jo(u,h.default,a.default)}$s.register(La,{error:[{kind:"error"},[ai],(h,[a])=>{throw new On(a.evaluate(h))}],typeof:[ai,[bi],(h,[a])=>Qi(Pr(a.evaluate(h)))],"to-rgba":[an(Dt,4),[Hi],(h,[a])=>{const[u,m,y,S]=a.evaluate(h).rgb;return[255*u,255*m,255*y,S]}],rgb:[Hi,[Dt,Dt,Dt],qp],rgba:[Hi,[Dt,Dt,Dt,Dt],qp],has:{type:pi,overloads:[[[ai],(h,[a])=>Hp(a.evaluate(h),h.properties())],[[ai,Li],(h,[a,u])=>Hp(a.evaluate(h),u.evaluate(h))]]},get:{type:bi,overloads:[[[ai],(h,[a])=>ic(a.evaluate(h),h.properties())],[[ai,Li],(h,[a,u])=>ic(a.evaluate(h),u.evaluate(h))]]},"feature-state":[bi,[ai],(h,[a])=>ic(a.evaluate(h),h.featureState||{})],properties:[Li,[],h=>h.properties()],"geometry-type":[ai,[],h=>h.geometryType()],id:[bi,[],h=>h.id()],zoom:[Dt,[],h=>h.globals.zoom],"heatmap-density":[Dt,[],h=>h.globals.heatmapDensity||0],elevation:[Dt,[],h=>h.globals.elevation||0],"line-progress":[Dt,[],h=>h.globals.lineProgress||0],accumulated:[bi,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Dt,it(Dt),(h,a)=>{let u=0;for(const m of a)u+=m.evaluate(h);return u}],"*":[Dt,it(Dt),(h,a)=>{let u=1;for(const m of a)u*=m.evaluate(h);return u}],"-":{type:Dt,overloads:[[[Dt,Dt],(h,[a,u])=>a.evaluate(h)-u.evaluate(h)],[[Dt],(h,[a])=>-a.evaluate(h)]]},"/":[Dt,[Dt,Dt],(h,[a,u])=>a.evaluate(h)/u.evaluate(h)],"%":[Dt,[Dt,Dt],(h,[a,u])=>a.evaluate(h)%u.evaluate(h)],ln2:[Dt,[],()=>Math.LN2],pi:[Dt,[],()=>Math.PI],e:[Dt,[],()=>Math.E],"^":[Dt,[Dt,Dt],(h,[a,u])=>Math.pow(a.evaluate(h),u.evaluate(h))],sqrt:[Dt,[Dt],(h,[a])=>Math.sqrt(a.evaluate(h))],log10:[Dt,[Dt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN10],ln:[Dt,[Dt],(h,[a])=>Math.log(a.evaluate(h))],log2:[Dt,[Dt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN2],sin:[Dt,[Dt],(h,[a])=>Math.sin(a.evaluate(h))],cos:[Dt,[Dt],(h,[a])=>Math.cos(a.evaluate(h))],tan:[Dt,[Dt],(h,[a])=>Math.tan(a.evaluate(h))],asin:[Dt,[Dt],(h,[a])=>Math.asin(a.evaluate(h))],acos:[Dt,[Dt],(h,[a])=>Math.acos(a.evaluate(h))],atan:[Dt,[Dt],(h,[a])=>Math.atan(a.evaluate(h))],min:[Dt,it(Dt),(h,a)=>Math.min(...a.map((u=>u.evaluate(h))))],max:[Dt,it(Dt),(h,a)=>Math.max(...a.map((u=>u.evaluate(h))))],abs:[Dt,[Dt],(h,[a])=>Math.abs(a.evaluate(h))],round:[Dt,[Dt],(h,[a])=>{const u=a.evaluate(h);return u<0?-Math.round(-u):Math.round(u)}],floor:[Dt,[Dt],(h,[a])=>Math.floor(a.evaluate(h))],ceil:[Dt,[Dt],(h,[a])=>Math.ceil(a.evaluate(h))],"filter-==":[pi,[ai,bi],(h,[a,u])=>h.properties()[a.value]===u.value],"filter-id-==":[pi,[bi],(h,[a])=>h.id()===a.value],"filter-type-==":[pi,[ai],(h,[a])=>h.geometryType()===a.value],"filter-<":[pi,[ai,bi],(h,[a,u])=>{const m=h.properties()[a.value],y=u.value;return typeof m==typeof y&&m<y}],"filter-id-<":[pi,[bi],(h,[a])=>{const u=h.id(),m=a.value;return typeof u==typeof m&&u<m}],"filter->":[pi,[ai,bi],(h,[a,u])=>{const m=h.properties()[a.value],y=u.value;return typeof m==typeof y&&m>y}],"filter-id->":[pi,[bi],(h,[a])=>{const u=h.id(),m=a.value;return typeof u==typeof m&&u>m}],"filter-<=":[pi,[ai,bi],(h,[a,u])=>{const m=h.properties()[a.value],y=u.value;return typeof m==typeof y&&m<=y}],"filter-id-<=":[pi,[bi],(h,[a])=>{const u=h.id(),m=a.value;return typeof u==typeof m&&u<=m}],"filter->=":[pi,[ai,bi],(h,[a,u])=>{const m=h.properties()[a.value],y=u.value;return typeof m==typeof y&&m>=y}],"filter-id->=":[pi,[bi],(h,[a])=>{const u=h.id(),m=a.value;return typeof u==typeof m&&u>=m}],"filter-has":[pi,[bi],(h,[a])=>a.value in h.properties()],"filter-has-id":[pi,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[pi,[an(ai)],(h,[a])=>a.value.indexOf(h.geometryType())>=0],"filter-id-in":[pi,[an(bi)],(h,[a])=>a.value.indexOf(h.id())>=0],"filter-in-small":[pi,[ai,an(bi)],(h,[a,u])=>u.value.indexOf(h.properties()[a.value])>=0],"filter-in-large":[pi,[ai,an(bi)],(h,[a,u])=>(function(m,y,S,T){for(;S<=T;){const A=S+T>>1;if(y[A]===m)return!0;y[A]>m?T=A-1:S=A+1}return!1})(h.properties()[a.value],u.value,0,u.value.length-1)],all:{type:pi,overloads:[[[pi,pi],(h,[a,u])=>a.evaluate(h)&&u.evaluate(h)],[it(pi),(h,a)=>{for(const u of a)if(!u.evaluate(h))return!1;return!0}]]},any:{type:pi,overloads:[[[pi,pi],(h,[a,u])=>a.evaluate(h)||u.evaluate(h)],[it(pi),(h,a)=>{for(const u of a)if(u.evaluate(h))return!0;return!1}]]},"!":[pi,[pi],(h,[a])=>!a.evaluate(h)],"is-supported-script":[pi,[ai],(h,[a])=>{const u=h.globals&&h.globals.isSupportedScript;return!u||u(a.evaluate(h))}],upcase:[ai,[ai],(h,[a])=>a.evaluate(h).toUpperCase()],downcase:[ai,[ai],(h,[a])=>a.evaluate(h).toLowerCase()],concat:[ai,it(bi),(h,a)=>a.map((u=>ql(u.evaluate(h)))).join("")],"resolved-locale":[ai,[Ni],(h,[a])=>a.evaluate(h).resolvedLocale()]});class ka{constructor(a,u,m){this.expression=a,this._warningHistory={},this._evaluator=new $o,this._defaultValue=u?(function(y){if(y.type==="color"&&Ks(y.default))return new nn(0,0,0,0);switch(y.type){case"color":return nn.parse(y.default)||null;case"padding":return us.parse(y.default)||null;case"numberArray":return xn.parse(y.default)||null;case"colorArray":return Gi.parse(y.default)||null;case"variableAnchorOffsetCollection":return Ss.parse(y.default)||null;case"projectionDefinition":return Ns.parse(y.default)||null;default:return y.default===void 0?null:y.default}})(u):null,this._enumValues=u&&u.type==="enum"?u.values:null,this._globalState=m}evaluateWithoutErrorHandling(a,u,m,y,S,T){return this._globalState&&(a=Bu(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=m,this._evaluator.canonical=y,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(a,u,m,y,S,T){this._globalState&&(a=Bu(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=m||null,this._evaluator.canonical=y,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new On(`Expected value to be one of ${Object.keys(this._enumValues).map((D=>JSON.stringify(D))).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function zc(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in La}function of(h,a,u){const m=new ml(La,Z,[],a?(function(S){const T={color:Hi,string:ai,number:Dt,enum:ai,boolean:pi,formatted:Kn,padding:Zi,numberArray:sn,colorArray:Un,projectionDefinition:ut,resolvedImage:zr,variableAnchorOffsetCollection:jn};return S.type==="array"?an(T[S.value]||bi,S.length):T[S.type]})(a):void 0),y=m.parse(h,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?di(new ka(y,a,u)):Ti(m.errors)}class Wp{constructor(a,u,m){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!nt(u.expression),this.globalStateRefs=Bc(u.expression),this._globalState=m}evaluateWithoutErrorHandling(a,u,m,y,S,T){return this._globalState&&(a=Bu(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,u,m,y,S,T)}evaluate(a,u,m,y,S,T){return this._globalState&&(a=Bu(a,this._globalState)),this._styleExpression.evaluate(a,u,m,y,S,T)}}class m_{constructor(a,u,m,y,S){this.kind=a,this.zoomStops=m,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!nt(u.expression),this.globalStateRefs=Bc(u.expression),this.interpolationType=y,this._globalState=S}evaluateWithoutErrorHandling(a,u,m,y,S,T){return this._globalState&&(a=Bu(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,u,m,y,S,T)}evaluate(a,u,m,y,S,T){return this._globalState&&(a=Bu(a,this._globalState)),this._styleExpression.evaluate(a,u,m,y,S,T)}interpolationFactor(a,u,m){return this.interpolationType?vr.interpolationFactor(this.interpolationType,a,u,m):0}}function g_(h,a,u){const m=of(h,a,u);if(m.result==="error")return m;const y=m.value.expression,S=ye(y);if(!S&&!_n(a))return Ti([new Gt("","data expressions not supported")]);const T=qt(y,["zoom"]);if(!T&&!fr(a))return Ti([new Gt("","zoom expressions not supported")]);const A=Xp(y);return A||T?A instanceof Gt?Ti([A]):A instanceof vr&&!Ms(a)?Ti([new Gt("",'"interpolate" expressions cannot be used with this property')]):di(A?new m_(S?"camera":"composite",m.value,A.labels,A instanceof vr?A.interpolation:void 0,u):new Wp(S?"constant":"source",m.value,u)):Ti([new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zp{constructor(a,u){this._parameters=a,this._specification=u,It(this,la(this._parameters,this._specification))}static deserialize(a){return new Zp(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function Xp(h){let a=null;if(h instanceof zn)a=Xp(h.result);else if(h instanceof Yl){for(const u of h.args)if(a=Xp(u),a)break}else(h instanceof Ta||h instanceof vr)&&h.input instanceof $s&&h.input.name==="zoom"&&(a=h);return a instanceof Gt||h.eachChild((u=>{const m=Xp(u);m instanceof Gt?a=m:!a&&m?a=new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&m&&a!==m&&(a=new Gt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),a}function Bc(h,a=new Set){return h instanceof Oc&&a.add(h.key),h.eachChild((u=>{Bc(u,a)})),a}function Bu(h,a){const{zoom:u,heatmapDensity:m,elevation:y,lineProgress:S,isSupportedScript:T,accumulated:A}=h??{};return{zoom:u,heatmapDensity:m,elevation:y,lineProgress:S,isSupportedScript:T,accumulated:A,globalState:a}}function __(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const a of h.slice(1))if(!__(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const e1={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function af(h,a){if(h==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};__(h)||(h=lf(h));const u=of(h,e1,a);if(u.result==="error")throw new Error(u.value.map((m=>`${m.key}: ${m.message}`)).join(", "));return{filter:(m,y,S)=>u.value.evaluate(m,y,{},S),needGeometry:h0(h),getGlobalStateRefs:()=>Bc(u.value.expression)}}function t1(h,a){return h<a?-1:h>a?1:0}function h0(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let a=1;a<h.length;a++)if(h0(h[a]))return!0;return!1}function lf(h){if(!h)return!0;const a=h[0];return h.length<=1?a!=="any":a==="=="?Yp(h[1],h[2],"=="):a==="!="?cf(Yp(h[1],h[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Yp(h[1],h[2],a):a==="any"?(u=h.slice(1),["any"].concat(u.map(lf))):a==="all"?["all"].concat(h.slice(1).map(lf)):a==="none"?["all"].concat(h.slice(1).map(lf).map(cf)):a==="in"?d0(h[1],h.slice(2)):a==="!in"?cf(d0(h[1],h.slice(2))):a==="has"?f0(h[1]):a!=="!has"||cf(f0(h[1]));var u}function Yp(h,a,u){switch(h){case"$type":return[`filter-type-${u}`,a];case"$id":return[`filter-id-${u}`,a];default:return[`filter-${u}`,h,a]}}function d0(h,a){if(a.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some((u=>typeof u!=typeof a[0]))?["filter-in-large",h,["literal",a.sort(t1)]]:["filter-in-small",h,["literal",a]]}}function f0(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function cf(h){return["!",h]}function Kp(h){const a=typeof h;if(a==="number"||a==="boolean"||a==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let y="[";for(const S of h)y+=`${Kp(S)},`;return`${y}]`}const u=Object.keys(h).sort();let m="{";for(let y=0;y<u.length;y++)m+=`${JSON.stringify(u[y])}:${Kp(h[u[y]])},`;return`${m}}`}function p0(h){let a="";for(const u of gn)a+=`/${Kp(h[u])}`;return a}function m0(h){const a=h.value;return a?[new Qe(h.key,a,"constants have been deprecated as of v8")]:[]}function Hr(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Nu(h){if(Array.isArray(h))return h.map(Nu);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const a={};for(const u in h)a[u]=Nu(h[u]);return a}return Hr(h)}function qo(h){const a=h.key,u=h.value,m=h.valueSpec||{},y=h.objectElementValidators||{},S=h.style,T=h.styleSpec,A=h.validateSpec;let D=[];const z=ji(u);if(z!=="object")return[new Qe(a,u,`object expected, ${z} found`)];for(const V in u){const X=V.split(".")[0],ie=Su(m,X)||m["*"];let re;if(Su(y,X))re=y[X];else if(Su(m,X)){if(u[V]===void 0)continue;re=A}else if(y["*"])re=y["*"];else{if(!m["*"]){D.push(new Qe(a,u[V],`unknown property "${V}"`));continue}re=A}D=D.concat(re({key:(a&&`${a}.`)+V,value:u[V],valueSpec:ie,style:S,styleSpec:T,object:u,objectKey:V,validateSpec:A},u))}for(const V in m)y[V]||m[V].required&&m[V].default===void 0&&u[V]===void 0&&D.push(new Qe(a,u,`missing required property "${V}"`));return D}function Jp(h){const a=h.value,u=h.valueSpec,m=h.style,y=h.styleSpec,S=h.key,T=h.arrayElementValidator||h.validateSpec;if(ji(a)!=="array")return[new Qe(S,a,`array expected, ${ji(a)} found`)];if(u.length&&a.length!==u.length)return[new Qe(S,a,`array length ${u.length} expected, length ${a.length} found`)];let A={type:u.value,values:u.values};y.$version<7&&(A.function=u.function),ji(u.value)==="object"&&(A=u.value);let D=[];for(let z=0;z<a.length;z++)D=D.concat(T({array:a,arrayIndex:z,value:a[z],valueSpec:A,validateSpec:h.validateSpec,style:m,styleSpec:y,key:`${S}[${z}]`}));return D}function uf(h){const a=h.key,u=h.value,m=h.valueSpec;let y=ji(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Qe(a,u,`number expected, ${y} found`)]:"minimum"in m&&u<m.minimum?[new Qe(a,u,`${u} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&u>m.maximum?[new Qe(a,u,`${u} is greater than the maximum value ${m.maximum}`)]:[]}function Qp(h){const a=h.valueSpec,u=Hr(h.value.type);let m,y,S,T={};const A=u!=="categorical"&&h.value.property===void 0,D=!A,z=ji(h.value.stops)==="array"&&ji(h.value.stops[0])==="array"&&ji(h.value.stops[0][0])==="object",V=qo({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(re){if(u==="identity")return[new Qe(re.key,re.value,'identity function may not have a "stops" property')];let he=[];const me=re.value;return he=he.concat(Jp({key:re.key,value:me,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:X})),ji(me)==="array"&&me.length===0&&he.push(new Qe(re.key,me,"array must have at least one stop")),he},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:a,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return u==="identity"&&A&&V.push(new Qe(h.key,h.value,'missing required property "property"')),u==="identity"||h.value.stops||V.push(new Qe(h.key,h.value,'missing required property "stops"')),u==="exponential"&&h.valueSpec.expression&&!Ms(h.valueSpec)&&V.push(new Qe(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(D&&!_n(h.valueSpec)?V.push(new Qe(h.key,h.value,"property functions not supported")):A&&!fr(h.valueSpec)&&V.push(new Qe(h.key,h.value,"zoom functions not supported"))),u!=="categorical"&&!z||h.value.property!==void 0||V.push(new Qe(h.key,h.value,'"property" property is required')),V;function X(re){let he=[];const me=re.value,_e=re.key;if(ji(me)!=="array")return[new Qe(_e,me,`array expected, ${ji(me)} found`)];if(me.length!==2)return[new Qe(_e,me,`array length 2 expected, length ${me.length} found`)];if(z){if(ji(me[0])!=="object")return[new Qe(_e,me,`object expected, ${ji(me[0])} found`)];if(me[0].zoom===void 0)return[new Qe(_e,me,"object stop key must have zoom")];if(me[0].value===void 0)return[new Qe(_e,me,"object stop key must have value")];if(S&&S>Hr(me[0].zoom))return[new Qe(_e,me[0].zoom,"stop zoom values must appear in ascending order")];Hr(me[0].zoom)!==S&&(S=Hr(me[0].zoom),y=void 0,T={}),he=he.concat(qo({key:`${_e}[0]`,value:me[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:uf,value:ie}}))}else he=he.concat(ie({key:`${_e}[0]`,value:me[0],validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},me));return zc(Nu(me[1]))?he.concat([new Qe(`${_e}[1]`,me[1],"expressions are not allowed in function stops.")]):he.concat(re.validateSpec({key:`${_e}[1]`,value:me[1],valueSpec:a,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function ie(re,he){const me=ji(re.value),_e=Hr(re.value),Se=re.value!==null?re.value:he;if(m){if(me!==m)return[new Qe(re.key,Se,`${me} stop domain type must match previous stop domain type ${m}`)]}else m=me;if(me!=="number"&&me!=="string"&&me!=="boolean")return[new Qe(re.key,Se,"stop domain value must be a number, string, or boolean")];if(me!=="number"&&u!=="categorical"){let Be=`number expected, ${me} found`;return _n(a)&&u===void 0&&(Be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(re.key,Se,Be)]}return u!=="categorical"||me!=="number"||isFinite(_e)&&Math.floor(_e)===_e?u!=="categorical"&&me==="number"&&y!==void 0&&_e<y?[new Qe(re.key,Se,"stop domain values must appear in ascending order")]:(y=_e,u==="categorical"&&_e in T?[new Qe(re.key,Se,"stop domain values must be unique")]:(T[_e]=!0,[])):[new Qe(re.key,Se,`integer expected, found ${_e}`)]}}function Nc(h){const a=(h.expressionContext==="property"?g_:of)(Nu(h.value),h.valueSpec);if(a.result==="error")return a.value.map((m=>new Qe(`${h.key}${m.key}`,h.value,m.message)));const u=a.value.expression||a.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!u.outputDefined())return[new Qe(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!nt(u))return[new Qe(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!nt(u))return[new Qe(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!qt(u,["zoom","feature-state"]))return[new Qe(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!ye(u))return[new Qe(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hf(h){const a=h.key,u=h.value,m=ji(u);return m!=="string"?[new Qe(a,u,`color expected, ${m} found`)]:nn.parse(String(u))?[]:[new Qe(a,u,`color expected, "${u}" found`)]}function $u(h){const a=h.key,u=h.value,m=h.valueSpec,y=[];return Array.isArray(m.values)?m.values.indexOf(Hr(u))===-1&&y.push(new Qe(a,u,`expected one of [${m.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(m.values).indexOf(Hr(u))===-1&&y.push(new Qe(a,u,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function Xh(h){return __(Nu(h.value))?Nc(It({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):g0(h)}function g0(h){const a=h.value,u=h.key;if(ji(a)!=="array")return[new Qe(u,a,`array expected, ${ji(a)} found`)];const m=h.styleSpec;let y,S=[];if(a.length<1)return[new Qe(u,a,"filter array must have at least 1 element")];switch(S=S.concat($u({key:`${u}[0]`,value:a[0],valueSpec:m.filter_operator,style:h.style,styleSpec:h.styleSpec})),Hr(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Hr(a[1])==="$type"&&S.push(new Qe(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&S.push(new Qe(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(y=ji(a[1]),y!=="string"&&S.push(new Qe(`${u}[1]`,a[1],`string expected, ${y} found`)));for(let T=2;T<a.length;T++)y=ji(a[T]),Hr(a[1])==="$type"?S=S.concat($u({key:`${u}[${T}]`,value:a[T],valueSpec:m.geometry_type,style:h.style,styleSpec:h.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&S.push(new Qe(`${u}[${T}]`,a[T],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let T=1;T<a.length;T++)S=S.concat(g0({key:`${u}[${T}]`,value:a[T],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":y=ji(a[1]),a.length!==2?S.push(new Qe(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="string"&&S.push(new Qe(`${u}[1]`,a[1],`string expected, ${y} found`))}return S}function _0(h,a){const u=h.key,m=h.validateSpec,y=h.style,S=h.styleSpec,T=h.value,A=h.objectKey,D=S[`${a}_${h.layerType}`];if(!D)return[];const z=A.match(/^(.*)-transition$/);if(a==="paint"&&z&&D[z[1]]&&D[z[1]].transition)return m({key:u,value:T,valueSpec:S.transition,style:y,styleSpec:S});const V=h.valueSpec||D[A];if(!V)return[new Qe(u,T,`unknown property "${A}"`)];let X;if(ji(T)==="string"&&_n(V)&&!V.tokens&&(X=/^{([^}]+)}$/.exec(T)))return[new Qe(u,T,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(X[1])} }\`.`)];const ie=[];return h.layerType==="symbol"&&A==="text-font"&&Ks(Nu(T))&&Hr(T.type)==="identity"&&ie.push(new Qe(u,T,'"text-font" does not support identity functions')),ie.concat(m({key:h.key,value:T,valueSpec:V,style:y,styleSpec:S,expressionContext:"property",propertyType:a,propertyKey:A}))}function v0(h){return _0(h,"paint")}function y0(h){return _0(h,"layout")}function b0(h){let a=[];const u=h.value,m=h.key,y=h.style,S=h.styleSpec;if(ji(u)!=="object")return[new Qe(m,u,`object expected, ${ji(u)} found`)];u.type||u.ref||a.push(new Qe(m,u,'either "type" or "ref" is required'));let T=Hr(u.type);const A=Hr(u.ref);if(u.id){const D=Hr(u.id);for(let z=0;z<h.arrayIndex;z++){const V=y.layers[z];Hr(V.id)===D&&a.push(new Qe(m,u.id,`duplicate layer id "${u.id}", previously used at line ${V.id.__line__}`))}}if("ref"in u){let D;["type","source","source-layer","filter","layout"].forEach((z=>{z in u&&a.push(new Qe(m,u[z],`"${z}" is prohibited for ref layers`))})),y.layers.forEach((z=>{Hr(z.id)===A&&(D=z)})),D?D.ref?a.push(new Qe(m,u.ref,"ref cannot reference another ref layer")):T=Hr(D.type):a.push(new Qe(m,u.ref,`ref layer "${A}" not found`))}else if(T!=="background")if(u.source){const D=y.sources&&y.sources[u.source],z=D&&Hr(D.type);D?z==="vector"&&T==="raster"?a.push(new Qe(m,u.source,`layer "${u.id}" requires a raster source`)):z!=="raster-dem"&&T==="hillshade"||z!=="raster-dem"&&T==="color-relief"?a.push(new Qe(m,u.source,`layer "${u.id}" requires a raster-dem source`)):z==="raster"&&T!=="raster"?a.push(new Qe(m,u.source,`layer "${u.id}" requires a vector source`)):z!=="vector"||u["source-layer"]?z==="raster-dem"&&T!=="hillshade"&&T!=="color-relief"?a.push(new Qe(m,u.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||z==="geojson"&&D.lineMetrics||a.push(new Qe(m,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new Qe(m,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new Qe(m,u.source,`source "${u.source}" not found`))}else a.push(new Qe(m,u,'missing required property "source"'));return a=a.concat(qo({key:m,value:u,valueSpec:S.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${m}.type`,value:u.type,valueSpec:S.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:u,objectKey:"type"}),filter:Xh,layout:D=>qo({layer:u,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":z=>y0(It({layerType:T},z))}}),paint:D=>qo({layer:u,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":z=>v0(It({layerType:T},z))}})}})),a}function $c(h){const a=h.value,u=h.key,m=ji(a);return m!=="string"?[new Qe(u,a,`string expected, ${m} found`)]:[]}const v_={promoteId:function({key:h,value:a}){if(ji(a)==="string")return $c({key:h,value:a});{const u=[];for(const m in a)u.push(...$c({key:`${h}.${m}`,value:a[m]}));return u}}};function y_(h){const a=h.value,u=h.key,m=h.styleSpec,y=h.style,S=h.validateSpec;if(!a.type)return[new Qe(u,a,'"type" is required')];const T=Hr(a.type);let A;switch(T){case"vector":case"raster":return A=qo({key:u,value:a,valueSpec:m[`source_${T.replace("-","_")}`],style:h.style,styleSpec:m,objectElementValidators:v_,validateSpec:S}),A;case"raster-dem":return A=(function(D){var z;const V=(z=D.sourceName)!==null&&z!==void 0?z:"",X=D.value,ie=D.styleSpec,re=ie.source_raster_dem,he=D.style;let me=[];const _e=ji(X);if(X===void 0)return me;if(_e!=="object")return me.push(new Qe("source_raster_dem",X,`object expected, ${_e} found`)),me;const Se=Hr(X.encoding)==="custom",Be=["redFactor","greenFactor","blueFactor","baseShift"],Me=D.value.encoding?`"${D.value.encoding}"`:"Default";for(const Ae in X)!Se&&Be.includes(Ae)?me.push(new Qe(Ae,X[Ae],`In "${V}": "${Ae}" is only valid when "encoding" is set to "custom". ${Me} encoding found`)):re[Ae]?me=me.concat(D.validateSpec({key:Ae,value:X[Ae],valueSpec:re[Ae],validateSpec:D.validateSpec,style:he,styleSpec:ie})):me.push(new Qe(Ae,X[Ae],`unknown property "${Ae}"`));return me})({sourceName:u,value:a,style:h.style,styleSpec:m,validateSpec:S}),A;case"geojson":if(A=qo({key:u,value:a,valueSpec:m.source_geojson,style:y,styleSpec:m,validateSpec:S,objectElementValidators:v_}),a.cluster)for(const D in a.clusterProperties){const[z,V]=a.clusterProperties[D],X=typeof z=="string"?[z,["accumulated"],["get",D]]:z;A.push(...Nc({key:`${u}.${D}.map`,value:V,expressionContext:"cluster-map"})),A.push(...Nc({key:`${u}.${D}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return A;case"video":return qo({key:u,value:a,valueSpec:m.source_video,style:y,validateSpec:S,styleSpec:m});case"image":return qo({key:u,value:a,valueSpec:m.source_image,style:y,validateSpec:S,styleSpec:m});case"canvas":return[new Qe(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $u({key:`${u}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function df(h){const a=h.value,u=h.styleSpec,m=u.light,y=h.style;let S=[];const T=ji(a);if(a===void 0)return S;if(T!=="object")return S=S.concat([new Qe("light",a,`object expected, ${T} found`)]),S;for(const A in a){const D=A.match(/^(.*)-transition$/);S=S.concat(D&&m[D[1]]&&m[D[1]].transition?h.validateSpec({key:A,value:a[A],valueSpec:u.transition,validateSpec:h.validateSpec,style:y,styleSpec:u}):m[A]?h.validateSpec({key:A,value:a[A],valueSpec:m[A],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new Qe(A,a[A],`unknown property "${A}"`)])}return S}function x0(h){const a=h.value,u=h.styleSpec,m=u.sky,y=h.style,S=ji(a);if(a===void 0)return[];if(S!=="object")return[new Qe("sky",a,`object expected, ${S} found`)];let T=[];for(const A in a)T=T.concat(m[A]?h.validateSpec({key:A,value:a[A],valueSpec:m[A],style:y,styleSpec:u}):[new Qe(A,a[A],`unknown property "${A}"`)]);return T}function b_(h){const a=h.value,u=h.styleSpec,m=u.terrain,y=h.style;let S=[];const T=ji(a);if(a===void 0)return S;if(T!=="object")return S=S.concat([new Qe("terrain",a,`object expected, ${T} found`)]),S;for(const A in a)S=S.concat(m[A]?h.validateSpec({key:A,value:a[A],valueSpec:m[A],validateSpec:h.validateSpec,style:y,styleSpec:u}):[new Qe(A,a[A],`unknown property "${A}"`)]);return S}function x_(h){let a=[];const u=h.value,m=h.key;if(Array.isArray(u)){const y=[],S=[];for(const T in u)u[T].id&&y.includes(u[T].id)&&a.push(new Qe(m,u,`all the sprites' ids must be unique, but ${u[T].id} is duplicated`)),y.push(u[T].id),u[T].url&&S.includes(u[T].url)&&a.push(new Qe(m,u,`all the sprites' URLs must be unique, but ${u[T].url} is duplicated`)),S.push(u[T].url),a=a.concat(qo({key:`${m}[${T}]`,value:u[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return a}return $c({key:m,value:u})}function w0(h){return!!h&&h.constructor===Object}function w_(h){return w0(h.value)?[]:[new Qe(h.key,h.value,`object expected, ${ji(h.value)} found`)]}const S_={"*":()=>[],array:Jp,boolean:function(h){const a=h.value,u=h.key,m=ji(a);return m!=="boolean"?[new Qe(u,a,`boolean expected, ${m} found`)]:[]},number:uf,color:hf,constants:m0,enum:$u,filter:Xh,function:Qp,layer:b0,object:qo,source:y_,light:df,sky:x0,terrain:b_,projection:function(h){const a=h.value,u=h.styleSpec,m=u.projection,y=h.style,S=ji(a);if(a===void 0)return[];if(S!=="object")return[new Qe("projection",a,`object expected, ${S} found`)];let T=[];for(const A in a)T=T.concat(m[A]?h.validateSpec({key:A,value:a[A],valueSpec:m[A],style:y,styleSpec:u}):[new Qe(A,a[A],`unknown property "${A}"`)]);return T},projectionDefinition:function(h){const a=h.key;let u=h.value;u=u instanceof String?u.valueOf():u;const m=ji(u);return m!=="array"||(function(y){return Array.isArray(y)&&y.length===3&&typeof y[0]=="string"&&typeof y[1]=="string"&&typeof y[2]=="number"})(u)||(function(y){return!!["interpolate","step","literal"].includes(y[0])})(u)?["array","string"].includes(m)?[]:[new Qe(a,u,`projection expected, invalid type "${m}" found`)]:[new Qe(a,u,`projection expected, invalid array ${JSON.stringify(u)} found`)]},string:$c,formatted:function(h){return $c(h).length===0?[]:Nc(h)},resolvedImage:function(h){return $c(h).length===0?[]:Nc(h)},padding:function(h){const a=h.key,u=h.value;if(ji(u)==="array"){if(u.length<1||u.length>4)return[new Qe(a,u,`padding requires 1 to 4 values; ${u.length} values found`)];const m={type:"number"};let y=[];for(let S=0;S<u.length;S++)y=y.concat(h.validateSpec({key:`${a}[${S}]`,value:u[S],validateSpec:h.validateSpec,valueSpec:m}));return y}return uf({key:a,value:u,valueSpec:{}})},numberArray:function(h){const a=h.key,u=h.value;if(ji(u)==="array"){const m={type:"number"};if(u.length<1)return[new Qe(a,u,"array length at least 1 expected, length 0 found")];let y=[];for(let S=0;S<u.length;S++)y=y.concat(h.validateSpec({key:`${a}[${S}]`,value:u[S],validateSpec:h.validateSpec,valueSpec:m}));return y}return uf({key:a,value:u,valueSpec:{}})},colorArray:function(h){const a=h.key,u=h.value;if(ji(u)==="array"){if(u.length<1)return[new Qe(a,u,"array length at least 1 expected, length 0 found")];let m=[];for(let y=0;y<u.length;y++)m=m.concat(hf({key:`${a}[${y}]`,value:u[y]}));return m}return hf({key:a,value:u})},variableAnchorOffsetCollection:function(h){const a=h.key,u=h.value,m=ji(u),y=h.styleSpec;if(m!=="array"||u.length<1||u.length%2!=0)return[new Qe(a,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let T=0;T<u.length;T+=2)S=S.concat($u({key:`${a}[${T}]`,value:u[T],valueSpec:y.layout_symbol["text-anchor"]})),S=S.concat(Jp({key:`${a}[${T+1}]`,value:u[T+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:y}));return S},sprite:x_,state:w_,fontFaces:function(h){const a=h.key,u=h.value,m=h.validateSpec,y=h.styleSpec,S=h.style;if(!w0(u))return[new Qe(a,u,`object expected, ${ji(u)} found`)];const T=[];for(const A in u){const D=u[A],z=ji(D);if(z==="string")T.push(...$c({key:`${a}.${A}`,value:D}));else if(z==="array"){const V={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[X,ie]of D.entries())T.push(...qo({key:`${a}.${A}[${X}]`,value:ie,valueSpec:V,styleSpec:y,style:S,validateSpec:m}))}else T.push(new Qe(`${a}.${A}`,D,`string or array expected, ${z} found`))}return T}};function Vc(h){const a=h.value,u=h.valueSpec,m=h.styleSpec;return h.validateSpec=Vc,u.expression&&Ks(Hr(a))?Qp(h):u.expression&&zc(Nu(a))?Nc(h):u.type&&S_[u.type]?S_[u.type](h):qo(It({},h,{valueSpec:u.type?m[u.type]:u}))}function S0(h){const a=h.value,u=h.key,m=$c(h);return m.length||(a.indexOf("{fontstack}")===-1&&m.push(new Qe(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&m.push(new Qe(u,a,'"glyphs" url must include a "{range}" token'))),m}function ca(h,a=gt){let u=[];return u=u.concat(Vc({key:"",value:h,valueSpec:a.$root,styleSpec:a,style:h,validateSpec:Vc,objectElementValidators:{glyphs:S0,"*":()=>[]}})),h.constants&&(u=u.concat(m0({key:"constants",value:h.constants}))),T0(u)}function Da(h){return function(a){return h(Object.assign({},a,{validateSpec:Vc}))}}function T0(h){return[].concat(h).sort(((a,u)=>a.line-u.line))}function Fa(h){return function(...a){return T0(h.apply(this,a))}}ca.source=Fa(Da(y_)),ca.sprite=Fa(Da(x_)),ca.glyphs=Fa(Da(S0)),ca.light=Fa(Da(df)),ca.sky=Fa(Da(x0)),ca.terrain=Fa(Da(b_)),ca.state=Fa(Da(w_)),ca.layer=Fa(Da(b0)),ca.filter=Fa(Da(Xh)),ca.paintProperty=Fa(Da(v0)),ca.layoutProperty=Fa(Da(y0));const i1={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class ff{constructor(a,u){this._globalState=u,this.setValue(a)}evaluate(){var a;return(a=this._literalValue)!==null&&a!==void 0?a:this._compiledValue.evaluate({})}setValue(a){if(a==null||a==="visible"||a==="none")return this._literalValue=a==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const u=of(a,i1,this._globalState);if(u.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(u.value.map((m=>`${m.key}: ${m.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=u.value,this._globalStateRefs=Bc(u.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const pf=gt,Cs=ca,mf=Cs.light,M0=Cs.sky,n1=Cs.paintProperty,r1=Cs.layoutProperty;function Yh(h,a){let u=!1;if(a&&a.length)for(const m of a)h.fire(new vn(new Error(m.message))),u=!0;return u}class Kh{constructor(a,u,m){const y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const T=new Int32Array(this.arrayBuffer);a=T[0],this.d=(u=T[1])+2*(m=T[2]);for(let D=0;D<this.d*this.d;D++){const z=T[3+D],V=T[3+D+1];y.push(z===V?null:T.subarray(z,V))}const A=T[3+y.length+1];this.keys=T.subarray(T[3+y.length],A),this.bboxes=T.subarray(A),this.insert=this._insertReadonly}else{this.d=u+2*m;for(let T=0;T<this.d*this.d;T++)y.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=m,this.scale=u/a,this.uid=0;const S=m/u*a;this.min=-S,this.max=a+S}insert(a,u,m,y,S){this._forEachCell(u,m,y,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,u,m,y,S,T){this.cells[S].push(T)}query(a,u,m,y,S){const T=this.min,A=this.max;if(a<=T&&u<=T&&A<=m&&A<=y&&!S)return Array.prototype.slice.call(this.keys);{const D=[];return this._forEachCell(a,u,m,y,this._queryCell,D,{},S),D}}_queryCell(a,u,m,y,S,T,A,D){const z=this.cells[S];if(z!==null){const V=this.keys,X=this.bboxes;for(let ie=0;ie<z.length;ie++){const re=z[ie];if(A[re]===void 0){const he=4*re;(D?D(X[he+0],X[he+1],X[he+2],X[he+3]):a<=X[he+2]&&u<=X[he+3]&&m>=X[he+0]&&y>=X[he+1])?(A[re]=!0,T.push(V[re])):A[re]=!1}}}}_forEachCell(a,u,m,y,S,T,A,D){const z=this._convertToCellCoord(a),V=this._convertToCellCoord(u),X=this._convertToCellCoord(m),ie=this._convertToCellCoord(y);for(let re=z;re<=X;re++)for(let he=V;he<=ie;he++){const me=this.d*he+re;if((!D||D(this._convertFromCellCoord(re),this._convertFromCellCoord(he),this._convertFromCellCoord(re+1),this._convertFromCellCoord(he+1)))&&S.call(this,a,u,m,y,me,T,A,D))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,u=3+this.cells.length+1+1;let m=0;for(let T=0;T<this.cells.length;T++)m+=this.cells[T].length;const y=new Int32Array(u+m+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let S=u;for(let T=0;T<a.length;T++){const A=a[T];y[3+T]=S,y.set(A,S),S+=A.length}return y[3+a.length]=S,y.set(this.keys,S),S+=this.keys.length,y[3+a.length+1]=S,y.set(this.bboxes,S),S+=this.bboxes.length,y.buffer}static serialize(a,u){const m=a.toArrayBuffer();return u&&u.push(m),{buffer:m}}static deserialize(a){return new Kh(a.buffer)}}const Oa={};function mi(h,a,u={}){if(Oa[h])throw new Error(`${h} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:h,writeable:!1}),Oa[h]={klass:a,omit:u.omit||[],shallow:u.shallow||[]}}mi("Object",Object),mi("Set",Set),mi("TransferableGridIndex",Kh),mi("Color",nn),mi("Error",Error),mi("AJAXError",Xe),mi("ResolvedImage",oo),mi("StylePropertyFunction",Zp),mi("StyleExpression",ka,{omit:["_evaluator"]}),mi("ZoomDependentExpression",m_),mi("ZoomConstantExpression",Wp),mi("CompoundExpression",$s,{omit:["_evaluate"]});for(const h in La)La[h]._classRegistryKey||mi(`Expression_${h}`,La[h]);function em(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function T_(h){return h.$name||h.constructor._classRegistryKey}function Jh(h){return!(function(a){if(a===null||typeof a!="object")return!1;const u=T_(a);return!(!u||u==="Object")})(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||em(h)||xe(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function gf(h,a){if(Jh(h))return(em(h)||xe(h))&&a&&a.push(h),ArrayBuffer.isView(h)&&a&&a.push(h.buffer),h instanceof ImageData&&a&&a.push(h.data.buffer),h;if(Array.isArray(h)){const S=[];for(const T of h)S.push(gf(T,a));return S}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);const u=T_(h);if(!u)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!Oa[u])throw new Error(`${u} is not registered.`);const{klass:m}=Oa[u],y=m.serialize?m.serialize(h,a):{};if(m.serialize){if(a&&y===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in h){if(!h.hasOwnProperty(S)||Oa[u].omit.indexOf(S)>=0)continue;const T=h[S];y[S]=Oa[u].shallow.indexOf(S)>=0?T:gf(T,a)}h instanceof Error&&(y.message=h.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(y.$name=u),y}function _f(h){if(Jh(h))return h;if(Array.isArray(h))return h.map(_f);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);const a=T_(h)||"Object";if(!Oa[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:u}=Oa[a];if(!u)throw new Error(`can't deserialize unregistered class ${a}`);if(u.deserialize)return u.deserialize(h);const m=Object.create(u.prototype);for(const y of Object.keys(h)){if(y==="$name")continue;const S=h[y];m[y]=Oa[a].shallow.indexOf(y)>=0?S:_f(S)}return m}class M_{constructor(){this.first=!0}update(a,u){const m=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=m,!0))}}function vf(h){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))}function C_(h){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))}function C0(h){return/\s/u.test(String.fromCodePoint(h))}function Qh(h){for(const a of h)if(C_(a.codePointAt(0)))return!0;return!1}function s1(h){for(const a of h)if(!E0(a.codePointAt(0)))return!1;return!0}function tm(h){const a=h.map((u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}})).filter((u=>u));return new RegExp(a.join("|"),"u")}const im=tm(["Arab","Dupl","Mong","Ougr","Syrc"]);function E0(h){return!im.test(String.fromCodePoint(h))}function E_(h){return!(C_(h)||(a=h,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(a))));var a}const A0=tm(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function A_(h){return A0.test(String.fromCodePoint(h))}function P_(h,a){return!(!a&&A_(h)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(h)))}function P0(h){for(const a of h)if(A_(a.codePointAt(0)))return!0;return!1}const Uc=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){if(Uc.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(h,a){return s(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(h.pluginStatus!=="loading")return this.setState(h),h;const u=h.pluginURL,m=new Promise((S=>{this.loadScriptResolve=S}));a(u);const y=new Promise((S=>setTimeout((()=>S()),this.TIMEOUT)));if(yield Promise.race([m,y]),this.isParsed()){const S={pluginStatus:"loaded",pluginURL:u};return this.setState(S),S}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${u}`)}))}};class Gn{constructor(a,u){this.isSupportedScript=o1,this.zoom=a,u?(this.now=u.now||0,this.fadeDuration=u.fadeDuration||0,this.zoomHistory=u.zoomHistory||new M_,this.transition=u.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new M_,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,u=a-Math.floor(a),m=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*u}}}function o1(h){return(function(a,u){for(const m of a)if(!P_(m.codePointAt(0),u))return!1;return!0})(h,Uc.getRTLTextPluginStatus()==="loaded")}const yf="-transition";class nm{constructor(a,u,m){this.property=a,this.value=u,this.expression=(function(y,S,T){if(Ks(y))return new Zp(y,S);if(zc(y)){const A=g_(y,S,T);if(A.result==="error")throw new Error(A.value.map((D=>`${D.key}: ${D.message}`)).join(", "));return A.value}{let A=y;return S.type==="color"&&typeof y=="string"?A=nn.parse(y):S.type!=="padding"||typeof y!="number"&&!Array.isArray(y)?S.type!=="numberArray"||typeof y!="number"&&!Array.isArray(y)?S.type!=="colorArray"||typeof y!="string"&&!Array.isArray(y)?S.type==="variableAnchorOffsetCollection"&&Array.isArray(y)?A=Ss.parse(y):S.type==="projectionDefinition"&&typeof y=="string"&&(A=Ns.parse(y)):A=Gi.parse(y):A=xn.parse(y):A=us.parse(y),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>A}}})(u===void 0?a.specification.default:u,a.specification,m)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(a,u,m){return this.property.possiblyEvaluate(this,a,u,m)}}class rm{constructor(a,u){this.property=a,this.value=new nm(a,void 0,u)}transitioned(a,u){return new I0(this.property,this.value,u,Lt({},a.transition,this.transition),a.now)}untransitioned(){return new I0(this.property,this.value,null,{},0)}}class I_{constructor(a,u){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._globalState=u}getValue(a){return Ze(this._values[a].value.value)}setValue(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new rm(this._values[a].property,this._globalState)),this._values[a].value=new nm(this._values[a].property,u===null?void 0:Ze(u),this._globalState)}getTransition(a){return Ze(this._values[a].transition)}setTransition(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new rm(this._values[a].property,this._globalState)),this._values[a].transition=Ze(u)||void 0}serialize(){const a={};for(const u of Object.keys(this._values)){const m=this.getValue(u);m!==void 0&&(a[u]=m);const y=this.getTransition(u);y!==void 0&&(a[`${u}${yf}`]=y)}return a}transitioned(a,u){const m=new L0(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].transitioned(a,u._values[y]);return m}untransitioned(){const a=new L0(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].untransitioned();return a}}class I0{constructor(a,u,m,y,S){this.property=a,this.value=u,this.begin=S+y.delay||0,this.end=this.begin+y.duration||0,a.specification.transition&&(y.delay||y.duration)&&(this.prior=m)}possiblyEvaluate(a,u,m){const y=a.now||0,S=this.value.possiblyEvaluate(a,u,m),T=this.prior;if(T){if(y>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(y<this.begin)return T.possiblyEvaluate(a,u,m);{const A=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(a,u,m),S,et(A))}}return S}}class L0{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,u,m){const y=new bf(this._properties);for(const S of Object.keys(this._values))y._values[S]=this._values[S].possiblyEvaluate(a,u,m);return y}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class R0{constructor(a,u){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._globalState=u}hasValue(a){return this._values[a].value!==void 0}getValue(a){return Ze(this._values[a].value)}setValue(a,u){this._values[a]=new nm(this._values[a].property,u===null?void 0:Ze(u),this._globalState)}serialize(){const a={};for(const u of Object.keys(this._values)){const m=this.getValue(u);m!==void 0&&(a[u]=m)}return a}possiblyEvaluate(a,u,m){const y=new bf(this._properties);for(const S of Object.keys(this._values))y._values[S]=this._values[S].possiblyEvaluate(a,u,m);return y}}class za{constructor(a,u,m){this.property=a,this.value=u,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,u,m,y){return this.property.evaluate(this.value,this.parameters,a,u,m,y)}}class bf{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class Mi{constructor(a){this.specification=a}possiblyEvaluate(a,u){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(u)}interpolate(a,u,m){const y=rr[this.specification.type];return y?y(a,u,m):a}}class Fi{constructor(a,u){this.specification=a,this.overrides=u}possiblyEvaluate(a,u,m,y){return new za(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},m,y)}:a.expression,u)}interpolate(a,u,m){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new za(this,{kind:"constant",value:void 0},a.parameters);const y=rr[this.specification.type];if(y){const S=y(a.value.value,u.value.value,m);return new za(this,{kind:"constant",value:S},a.parameters)}return a}evaluate(a,u,m,y,S,T){return a.kind==="constant"?a.value:a.evaluate(u,m,y,S,T)}}class xf extends Fi{possiblyEvaluate(a,u,m,y){if(a.value===void 0)return new za(this,{kind:"constant",value:void 0},u);if(a.expression.kind==="constant"){const S=a.expression.evaluate(u,null,{},m,y),T=a.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,A=this._calculate(T,T,T,u);return new za(this,{kind:"constant",value:A},u)}if(a.expression.kind==="camera"){const S=this._calculate(a.expression.evaluate({zoom:u.zoom-1}),a.expression.evaluate({zoom:u.zoom}),a.expression.evaluate({zoom:u.zoom+1}),u);return new za(this,{kind:"constant",value:S},u)}return new za(this,a.expression,u)}evaluate(a,u,m,y,S,T){if(a.kind==="source"){const A=a.evaluate(u,m,y,S,T);return this._calculate(A,A,A,u)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(u.zoom)-1},m,y),a.evaluate({zoom:Math.floor(u.zoom)},m,y),a.evaluate({zoom:Math.floor(u.zoom)+1},m,y),u):a.value}_calculate(a,u,m,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:m,to:u}}interpolate(a){return a}}class sm{constructor(a){this.specification=a}possiblyEvaluate(a,u,m,y){if(a.value!==void 0){if(a.expression.kind==="constant"){const S=a.expression.evaluate(u,null,{},m,y);return this._calculate(S,S,S,u)}return this._calculate(a.expression.evaluate(new Gn(Math.floor(u.zoom-1),u)),a.expression.evaluate(new Gn(Math.floor(u.zoom),u)),a.expression.evaluate(new Gn(Math.floor(u.zoom+1),u)),u)}}_calculate(a,u,m,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:m,to:u}}interpolate(a){return a}}class om{constructor(a){this.specification=a}possiblyEvaluate(a,u,m,y){return!!a.expression.evaluate(u,null,{},m,y)}interpolate(){return!1}}class lo{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in a){const m=a[u];m.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new nm(m,void 0,void 0),S=this.defaultTransitionablePropertyValues[u]=new rm(m,void 0);this.defaultTransitioningPropertyValues[u]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate({})}}}mi("DataDrivenProperty",Fi),mi("DataConstantProperty",Mi),mi("CrossFadedDataDrivenProperty",xf),mi("CrossFadedProperty",sm),mi("ColorRampProperty",om);class ua extends rn{constructor(a,u,m){if(super(),this.id=a.id,this.type=a.type,this._globalState=m,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,this._visibilityExpression=(function(y,S){return new ff(y,S)})(this.visibility,m),a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter,this._featureFilter=af(a.filter,m)),u.layout&&(this._unevaluatedLayout=new R0(u.layout,m)),u.paint)){this._transitionablePaint=new I_(u.paint,m);for(const y in a.paint)this.setPaintProperty(y,a.paint[y],{validate:!1});for(const y in a.layout)this.setLayoutProperty(y,a.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new bf(u.paint)}}setFilter(a){this.filter=a,this._featureFilter=af(a,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}getLayoutAffectingGlobalStateRefs(){const a=new Set;for(const u of this._visibilityExpression.getGlobalStateRefs())a.add(u);if(this._unevaluatedLayout)for(const u in this._unevaluatedLayout._values){const m=this._unevaluatedLayout._values[u];for(const y of m.getGlobalStateRefs())a.add(y)}for(const u of this._featureFilter.getGlobalStateRefs())a.add(u);return a}getPaintAffectingGlobalStateRefs(){var a;const u=new globalThis.Map;if(this._transitionablePaint)for(const m in this._transitionablePaint._values){const y=this._transitionablePaint._values[m].value;for(const S of y.getGlobalStateRefs()){const T=(a=u.get(S))!==null&&a!==void 0?a:[];T.push({name:m,value:y.value}),u.set(S,T)}}return u}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(a,u,m={}){if(u==null||!this._validate(r1,`layers.${this.id}.layout.${a}`,a,u,m))return a==="visibility"?(this.visibility=u,this._visibilityExpression.setValue(u),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(a,u)}getPaintProperty(a){return a.endsWith(yf)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,u,m={}){if(u!=null&&this._validate(n1,`layers.${this.id}.paint.${a}`,a,u,m))return!1;if(a.endsWith(yf))return this._transitionablePaint.setTransition(a.slice(0,-11),u||void 0),!1;{const y=this._transitionablePaint._values[a],S=y.property.specification["property-type"]==="cross-faded-data-driven",T=y.value.isDataDriven(),A=y.value;this._transitionablePaint.setValue(a,u),this._handleSpecialPaintPropertyUpdate(a);const D=this._transitionablePaint._values[a].value;return D.isDataDriven()||T||S||this._handleOverridablePaintPropertyUpdate(a,A,D)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,u,m){return!1}isHidden(a=this.minzoom,u=!1){return!!(this.minzoom&&a<(u?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&a>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(a,u){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,u)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),$t(a,((u,m)=>!(u===void 0||m==="layout"&&!Object.keys(u).length||m==="paint"&&!Object.keys(u).length)))}_validate(a,u,m,y,S={}){return(!S||S.validate!==!1)&&Yh(this,a.call(Cs,{key:u,layerType:this.type,objectKey:m,value:y,styleSpec:gt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const u=this.paint.get(a);if(u instanceof za&&_n(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}let L_;var k0={get paint(){return L_=L_||new lo({"raster-opacity":new Mi(gt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Mi(gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mi(gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mi(gt.paint_raster["raster-brightness-max"]),"raster-saturation":new Mi(gt.paint_raster["raster-saturation"]),"raster-contrast":new Mi(gt.paint_raster["raster-contrast"]),"raster-resampling":new Mi(gt.paint_raster["raster-resampling"]),"raster-fade-duration":new Mi(gt.paint_raster["raster-fade-duration"])})}};class a1 extends ua{constructor(a,u){super(a,k0,u)}}const l1={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wf{constructor(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ir{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wr(h,a=1){let u=0,m=0;return{members:h.map((y=>{const S=l1[y.type].BYTES_PER_ELEMENT,T=u=Vu(u,Math.max(a,S)),A=y.components||1;return m=Math.max(m,S),u+=S*A,{name:y.name,type:y.type,components:A,offset:T}})),size:Vu(u,Math.max(m,a)),alignment:a}}function Vu(h,a){return Math.ceil(h/a)*a}class Sf extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u){const m=this.length;return this.resize(m+1),this.emplace(m,a,u)}emplace(a,u,m){const y=2*a;return this.int16[y+0]=u,this.int16[y+1]=m,a}}Sf.prototype.bytesPerElement=4,mi("StructArrayLayout2i4",Sf);class am extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const S=3*a;return this.int16[S+0]=u,this.int16[S+1]=m,this.int16[S+2]=y,a}}am.prototype.bytesPerElement=6,mi("StructArrayLayout3i6",am);class R_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y){const S=this.length;return this.resize(S+1),this.emplace(S,a,u,m,y)}emplace(a,u,m,y,S){const T=4*a;return this.int16[T+0]=u,this.int16[T+1]=m,this.int16[T+2]=y,this.int16[T+3]=S,a}}R_.prototype.bytesPerElement=8,mi("StructArrayLayout4i8",R_);class lm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,a,u,m,y,S,T)}emplace(a,u,m,y,S,T,A){const D=6*a;return this.int16[D+0]=u,this.int16[D+1]=m,this.int16[D+2]=y,this.int16[D+3]=S,this.int16[D+4]=T,this.int16[D+5]=A,a}}lm.prototype.bytesPerElement=12,mi("StructArrayLayout2i4i12",lm);class k_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,a,u,m,y,S,T)}emplace(a,u,m,y,S,T,A){const D=4*a,z=8*a;return this.int16[D+0]=u,this.int16[D+1]=m,this.uint8[z+4]=y,this.uint8[z+5]=S,this.uint8[z+6]=T,this.uint8[z+7]=A,a}}k_.prototype.bytesPerElement=8,mi("StructArrayLayout2i4ub8",k_);class Tf extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u){const m=this.length;return this.resize(m+1),this.emplace(m,a,u)}emplace(a,u,m){const y=2*a;return this.float32[y+0]=u,this.float32[y+1]=m,a}}Tf.prototype.bytesPerElement=8,mi("StructArrayLayout2f8",Tf);class nc extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T,A,D,z,V){const X=this.length;return this.resize(X+1),this.emplace(X,a,u,m,y,S,T,A,D,z,V)}emplace(a,u,m,y,S,T,A,D,z,V,X){const ie=10*a;return this.uint16[ie+0]=u,this.uint16[ie+1]=m,this.uint16[ie+2]=y,this.uint16[ie+3]=S,this.uint16[ie+4]=T,this.uint16[ie+5]=A,this.uint16[ie+6]=D,this.uint16[ie+7]=z,this.uint16[ie+8]=V,this.uint16[ie+9]=X,a}}nc.prototype.bytesPerElement=20,mi("StructArrayLayout10ui20",nc);class cm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T,A,D){const z=this.length;return this.resize(z+1),this.emplace(z,a,u,m,y,S,T,A,D)}emplace(a,u,m,y,S,T,A,D,z){const V=8*a;return this.uint16[V+0]=u,this.uint16[V+1]=m,this.uint16[V+2]=y,this.uint16[V+3]=S,this.uint16[V+4]=T,this.uint16[V+5]=A,this.uint16[V+6]=D,this.uint16[V+7]=z,a}}cm.prototype.bytesPerElement=16,mi("StructArrayLayout8ui16",cm);class Mf extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T,A,D,z,V,X,ie){const re=this.length;return this.resize(re+1),this.emplace(re,a,u,m,y,S,T,A,D,z,V,X,ie)}emplace(a,u,m,y,S,T,A,D,z,V,X,ie,re){const he=12*a;return this.int16[he+0]=u,this.int16[he+1]=m,this.int16[he+2]=y,this.int16[he+3]=S,this.uint16[he+4]=T,this.uint16[he+5]=A,this.uint16[he+6]=D,this.uint16[he+7]=z,this.int16[he+8]=V,this.int16[he+9]=X,this.int16[he+10]=ie,this.int16[he+11]=re,a}}Mf.prototype.bytesPerElement=24,mi("StructArrayLayout4i4ui4i24",Mf);class um extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const S=3*a;return this.float32[S+0]=u,this.float32[S+1]=m,this.float32[S+2]=y,a}}um.prototype.bytesPerElement=12,mi("StructArrayLayout3f12",um);class Cf extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint32[1*a+0]=u,a}}Cf.prototype.bytesPerElement=4,mi("StructArrayLayout1ul4",Cf);class D_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T,A,D,z){const V=this.length;return this.resize(V+1),this.emplace(V,a,u,m,y,S,T,A,D,z)}emplace(a,u,m,y,S,T,A,D,z,V){const X=10*a,ie=5*a;return this.int16[X+0]=u,this.int16[X+1]=m,this.int16[X+2]=y,this.int16[X+3]=S,this.int16[X+4]=T,this.int16[X+5]=A,this.uint32[ie+3]=D,this.uint16[X+8]=z,this.uint16[X+9]=V,a}}D_.prototype.bytesPerElement=20,mi("StructArrayLayout6i1ul2ui20",D_);class ed extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,a,u,m,y,S,T)}emplace(a,u,m,y,S,T,A){const D=6*a;return this.int16[D+0]=u,this.int16[D+1]=m,this.int16[D+2]=y,this.int16[D+3]=S,this.int16[D+4]=T,this.int16[D+5]=A,a}}ed.prototype.bytesPerElement=12,mi("StructArrayLayout2i2i2i12",ed);class Uu extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S){const T=this.length;return this.resize(T+1),this.emplace(T,a,u,m,y,S)}emplace(a,u,m,y,S,T){const A=4*a,D=8*a;return this.float32[A+0]=u,this.float32[A+1]=m,this.float32[A+2]=y,this.int16[D+6]=S,this.int16[D+7]=T,a}}Uu.prototype.bytesPerElement=16,mi("StructArrayLayout2f1f2i16",Uu);class F_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T){const A=this.length;return this.resize(A+1),this.emplace(A,a,u,m,y,S,T)}emplace(a,u,m,y,S,T,A){const D=16*a,z=4*a,V=8*a;return this.uint8[D+0]=u,this.uint8[D+1]=m,this.float32[z+1]=y,this.float32[z+2]=S,this.int16[V+6]=T,this.int16[V+7]=A,a}}F_.prototype.bytesPerElement=16,mi("StructArrayLayout2ub2f2i16",F_);class Ef extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const S=3*a;return this.uint16[S+0]=u,this.uint16[S+1]=m,this.uint16[S+2]=y,a}}Ef.prototype.bytesPerElement=6,mi("StructArrayLayout3ui6",Ef);class ju extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T,A,D,z,V,X,ie,re,he,me,_e,Se){const Be=this.length;return this.resize(Be+1),this.emplace(Be,a,u,m,y,S,T,A,D,z,V,X,ie,re,he,me,_e,Se)}emplace(a,u,m,y,S,T,A,D,z,V,X,ie,re,he,me,_e,Se,Be){const Me=24*a,Ae=12*a,Ve=48*a;return this.int16[Me+0]=u,this.int16[Me+1]=m,this.uint16[Me+2]=y,this.uint16[Me+3]=S,this.uint32[Ae+2]=T,this.uint32[Ae+3]=A,this.uint32[Ae+4]=D,this.uint16[Me+10]=z,this.uint16[Me+11]=V,this.uint16[Me+12]=X,this.float32[Ae+7]=ie,this.float32[Ae+8]=re,this.uint8[Ve+36]=he,this.uint8[Ve+37]=me,this.uint8[Ve+38]=_e,this.uint32[Ae+10]=Se,this.int16[Me+22]=Be,a}}ju.prototype.bytesPerElement=48,mi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ju);class O_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m,y,S,T,A,D,z,V,X,ie,re,he,me,_e,Se,Be,Me,Ae,Ve,qe,_t,Vt,Rt,Ht,ni,Yt){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,a,u,m,y,S,T,A,D,z,V,X,ie,re,he,me,_e,Se,Be,Me,Ae,Ve,qe,_t,Vt,Rt,Ht,ni,Yt)}emplace(a,u,m,y,S,T,A,D,z,V,X,ie,re,he,me,_e,Se,Be,Me,Ae,Ve,qe,_t,Vt,Rt,Ht,ni,Yt,Ft){const St=32*a,fi=16*a;return this.int16[St+0]=u,this.int16[St+1]=m,this.int16[St+2]=y,this.int16[St+3]=S,this.int16[St+4]=T,this.int16[St+5]=A,this.int16[St+6]=D,this.int16[St+7]=z,this.uint16[St+8]=V,this.uint16[St+9]=X,this.uint16[St+10]=ie,this.uint16[St+11]=re,this.uint16[St+12]=he,this.uint16[St+13]=me,this.uint16[St+14]=_e,this.uint16[St+15]=Se,this.uint16[St+16]=Be,this.uint16[St+17]=Me,this.uint16[St+18]=Ae,this.uint16[St+19]=Ve,this.uint16[St+20]=qe,this.uint16[St+21]=_t,this.uint16[St+22]=Vt,this.uint32[fi+12]=Rt,this.float32[fi+13]=Ht,this.float32[fi+14]=ni,this.uint16[St+30]=Yt,this.uint16[St+31]=Ft,a}}O_.prototype.bytesPerElement=64,mi("StructArrayLayout8i15ui1ul2f2ui64",O_);class hm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.float32[1*a+0]=u,a}}hm.prototype.bytesPerElement=4,mi("StructArrayLayout1f4",hm);class dm extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const S=3*a;return this.uint16[6*a+0]=u,this.float32[S+1]=m,this.float32[S+2]=y,a}}dm.prototype.bytesPerElement=12,mi("StructArrayLayout1ui2f12",dm);class z_ extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,m){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,m)}emplace(a,u,m,y){const S=4*a;return this.uint32[2*a+0]=u,this.uint16[S+2]=m,this.uint16[S+3]=y,a}}z_.prototype.bytesPerElement=8,mi("StructArrayLayout1ul2ui8",z_);class C extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u){const m=this.length;return this.resize(m+1),this.emplace(m,a,u)}emplace(a,u,m){const y=2*a;return this.uint16[y+0]=u,this.uint16[y+1]=m,a}}C.prototype.bytesPerElement=4,mi("StructArrayLayout2ui4",C);class l extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint16[1*a+0]=u,a}}l.prototype.bytesPerElement=2,mi("StructArrayLayout1ui2",l);class d extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,m,y){const S=this.length;return this.resize(S+1),this.emplace(S,a,u,m,y)}emplace(a,u,m,y,S){const T=4*a;return this.float32[T+0]=u,this.float32[T+1]=m,this.float32[T+2]=y,this.float32[T+3]=S,a}}d.prototype.bytesPerElement=16,mi("StructArrayLayout4f16",d);class v extends wf{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new f(this.anchorPointX,this.anchorPointY)}}v.prototype.size=20;class w extends D_{get(a){return new v(this,a)}}mi("CollisionBoxArray",w);class E extends wf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}E.prototype.size=48;class R extends ju{get(a){return new E(this,a)}}mi("PlacedSymbolArray",R);class O extends wf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}O.prototype.size=64;class $ extends O_{get(a){return new O(this,a)}}mi("SymbolInstanceArray",$);class W extends hm{getoffsetX(a){return this.float32[1*a+0]}}mi("GlyphOffsetArray",W);class K extends am{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}mi("SymbolLineVertexArray",K);class ce extends wf{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ce.prototype.size=12;class oe extends dm{get(a){return new ce(this,a)}}mi("TextAnchorOffsetArray",oe);class ge extends wf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ge.prototype.size=8;class be extends z_{get(a){return new ge(this,a)}}mi("FeatureIndexArray",be);class Le extends Sf{}class De extends Sf{}class ke extends Sf{}class Ne extends lm{}class He extends k_{}class ze extends Tf{}class Ge extends nc{}class Je extends cm{}class je extends Mf{}class at extends um{}class Tt extends Cf{}class vt extends ed{}class xt extends F_{}class wt extends Ef{}class Qt extends C{}const ti=Wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wt}=ti;class si{constructor(a=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=a}prepareSegment(a,u,m,y){const S=this.segments[this.segments.length-1];return a>si.MAX_VERTEX_ARRAY_LENGTH&&Mt(`Max vertices per segment is ${si.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${si.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!S||S.vertexLength+a>si.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==y?this.createNewSegment(u,m,y):S}createNewSegment(a,u,m){const y={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0,vaos:{}};return m!==void 0&&(y.sortKey=m),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(y),y}getOrCreateLatestSegment(a,u,m){return this.prepareSegment(0,a,u,m)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const a of this.segments)for(const u in a.vaos)a.vaos[u].destroy()}static simpleSegment(a,u,m,y){return new si([{vertexOffset:a,primitiveOffset:u,vertexLength:m,primitiveLength:y,vaos:{},sortKey:0}])}}function Xi(h,a){return 256*(h=Ye(Math.floor(h),0,255))+Ye(Math.floor(a),0,255)}si.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mi("SegmentVector",si);const kn=Wr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),pr=Wr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Jn,br,Qn,Br={exports:{}},xr={exports:{}},Es={exports:{}},is=(function(){if(Qn)return Br.exports;Qn=1;var h=(Jn||(Jn=1,xr.exports=function(u,m){var y,S,T,A,D,z,V,X;for(S=u.length-(y=3&u.length),T=m,D=3432918353,z=461845907,X=0;X<S;)V=255&u.charCodeAt(X)|(255&u.charCodeAt(++X))<<8|(255&u.charCodeAt(++X))<<16|(255&u.charCodeAt(++X))<<24,++X,T=27492+(65535&(A=5*(65535&(T=(T^=V=(65535&(V=(V=(65535&V)*D+(((V>>>16)*D&65535)<<16)&4294967295)<<15|V>>>17))*z+(((V>>>16)*z&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(V=0,y){case 3:V^=(255&u.charCodeAt(X+2))<<16;case 2:V^=(255&u.charCodeAt(X+1))<<8;case 1:T^=V=(65535&(V=(V=(65535&(V^=255&u.charCodeAt(X)))*D+(((V>>>16)*D&65535)<<16)&4294967295)<<15|V>>>17))*z+(((V>>>16)*z&65535)<<16)&4294967295}return T^=u.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),xr.exports),a=(br||(br=1,Es.exports=function(u,m){for(var y,S=u.length,T=m^S,A=0;S>=4;)y=1540483477*(65535&(y=255&u.charCodeAt(A)|(255&u.charCodeAt(++A))<<8|(255&u.charCodeAt(++A))<<16|(255&u.charCodeAt(++A))<<24))+((1540483477*(y>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),S-=4,++A;switch(S){case 3:T^=(255&u.charCodeAt(A+2))<<16;case 2:T^=(255&u.charCodeAt(A+1))<<8;case 1:T=1540483477*(65535&(T^=255&u.charCodeAt(A)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),Es.exports);return Br.exports=h,Br.exports.murmur3=h,Br.exports.murmur2=a,Br.exports})(),Zr=p(is);class Vs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,u,m,y){this.ids.push(jc(a)),this.positions.push(u,m,y)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=jc(a);let m=0,y=this.ids.length-1;for(;m<y;){const T=m+y>>1;this.ids[T]>=u?y=T:m=T+1}const S=[];for(;this.ids[m]===u;)S.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return S}static serialize(a,u){const m=new Float64Array(a.ids),y=new Uint32Array(a.positions);return rc(m,y,0,m.length-1),u&&u.push(m.buffer,y.buffer),{ids:m,positions:y}}static deserialize(a){const u=new Vs;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u}}function jc(h){const a=+h;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:Zr(String(h))}function rc(h,a,u,m){for(;u<m;){const y=h[u+m>>1];let S=u-1,T=m+1;for(;;){do S++;while(h[S]<y);do T--;while(h[T]>y);if(S>=T)break;bl(h,S,T),bl(a,3*S,3*T),bl(a,3*S+1,3*T+1),bl(a,3*S+2,3*T+2)}T-u<m-T?(rc(h,a,u,T),u=T+1):(rc(h,a,T+1,m),m=T)}}function bl(h,a,u){const m=h[a];h[a]=h[u],h[u]=m}mi("FeaturePositionMap",Vs);class So{constructor(a,u){this.gl=a.gl,this.location=u}}class Gu extends So{constructor(a,u){super(a,u),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Af extends So{constructor(a,u){super(a,u),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class qu extends So{constructor(a,u){super(a,u),this.current=nn.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const ha=new Float32Array(16);function xl(h){return[Xi(255*h.r,255*h.g),Xi(255*h.b,255*h.a)]}class Ba{constructor(a,u,m){this.value=a,this.uniformNames=u.map((y=>`u_${y}`)),this.type=m}setUniform(a,u,m){a.set(m.constantOr(this.value))}getBinding(a,u,m){return this.type==="color"?new qu(a,u):new Gu(a,u)}}class Na{constructor(a,u){this.uniformNames=u.map((m=>`u_${m}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr}setConstantDashPositions(a,u){this.dashTo=[0,a.y,a.height,a.width],this.dashFrom=[0,u.y,u.height,u.width]}setUniform(a,u,m,y){let S=null;y==="u_pattern_to"?S=this.patternTo:y==="u_pattern_from"?S=this.patternFrom:y==="u_dasharray_to"?S=this.dashTo:y==="u_dasharray_from"?S=this.dashFrom:y==="u_pixel_ratio_to"?S=this.pixelRatioTo:y==="u_pixel_ratio_from"&&(S=this.pixelRatioFrom),S!==null&&a.set(S)}getBinding(a,u,m){return m.substr(0,9)==="u_pattern"||m.substr(0,12)==="u_dasharray_"?new Af(a,u):new Gu(a,u)}}class sr{constructor(a,u,m,y){this.expression=a,this.type=m,this.maxValue=0,this.paintVertexAttributes=u.map((S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0}))),this.paintVertexArray=new y}populatePaintArray(a,u,m){const y=this.paintVertexArray.length,S=this.expression.evaluate(new Gn(0,m),u,{},m.canonical,[],m.formattedSection);this.paintVertexArray.resize(a),this._setPaintValue(y,a,S)}updatePaintArray(a,u,m,y,S){const T=this.expression.evaluate(new Gn(0,S),m,y);this._setPaintValue(a,u,T)}_setPaintValue(a,u,m){if(this.type==="color"){const y=xl(m);for(let S=a;S<u;S++)this.paintVertexArray.emplace(S,y[0],y[1])}else{for(let y=a;y<u;y++)this.paintVertexArray.emplace(y,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class er{constructor(a,u,m,y,S,T){this.expression=a,this.uniformNames=u.map((A=>`u_${A}_t`)),this.type=m,this.useIntegerZoom=y,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=u.map((A=>({name:`a_${A}`,type:"Float32",components:m==="color"?4:2,offset:0}))),this.paintVertexArray=new T}populatePaintArray(a,u,m){const y=this.expression.evaluate(new Gn(this.zoom,m),u,{},m.canonical,[],m.formattedSection),S=this.expression.evaluate(new Gn(this.zoom+1,m),u,{},m.canonical,[],m.formattedSection),T=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(T,a,y,S)}updatePaintArray(a,u,m,y,S){const T=this.expression.evaluate(new Gn(this.zoom,S),m,y),A=this.expression.evaluate(new Gn(this.zoom+1,S),m,y);this._setPaintValue(a,u,T,A)}_setPaintValue(a,u,m,y){if(this.type==="color"){const S=xl(m),T=xl(y);for(let A=a;A<u;A++)this.paintVertexArray.emplace(A,S[0],S[1],T[0],T[1])}else{for(let S=a;S<u;S++)this.paintVertexArray.emplace(S,m,y);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,u){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,y=Ye(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);a.set(y)}getBinding(a,u,m){return new Gu(a,u)}}class ms{constructor(a,u,m,y,S,T){this.expression=a,this.type=u,this.useIntegerZoom=m,this.zoom=y,this.layerId=T,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(a,u,m){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(y,a,this.getPositionIds(u),m)}updatePaintArray(a,u,m,y,S){this._setPaintValues(a,u,this.getPositionIds(m),S)}_setPaintValues(a,u,m,y){const S=this.getPositions(y);if(!S||!m)return;const T=S[m.min],A=S[m.mid],D=S[m.max];if(T&&A&&D)for(let z=a;z<u;z++)this.emplace(this.zoomInPaintVertexArray,z,A,T),this.emplace(this.zoomOutPaintVertexArray,z,A,D)}upload(a){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const u=this.getVertexAttributes();this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,u,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,u,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class gs extends ms{getPositions(a){return a.imagePositions}getPositionIds(a){return a.patterns&&a.patterns[this.layerId]}getVertexAttributes(){return kn.members}emplace(a,u,m,y){a.emplace(u,m.tlbr[0],m.tlbr[1],m.tlbr[2],m.tlbr[3],y.tlbr[0],y.tlbr[1],y.tlbr[2],y.tlbr[3],m.pixelRatio,y.pixelRatio)}}class D0 extends ms{getPositions(a){return a.dashPositions}getPositionIds(a){return a.dashes&&a.dashes[this.layerId]}getVertexAttributes(){return pr.members}emplace(a,u,m,y){a.emplace(u,0,m.y,m.height,m.width,0,y.y,y.height,y.width)}}class F0{constructor(a,u,m){this.binders={},this._buffers=[];const y=[];for(const S in a.paint._values){if(!m(S))continue;const T=a.paint.get(S);if(!(T instanceof za&&_n(T.property.specification)))continue;const A=c1(S,a.type),D=T.value,z=T.property.specification.type,V=T.property.useIntegerZoom,X=T.property.specification["property-type"],ie=X==="cross-faded"||X==="cross-faded-data-driven";if(D.kind==="constant")this.binders[S]=ie?new Na(D.value,A):new Ba(D.value,A,z),y.push(`/u_${S}`);else if(D.kind==="source"||ie){const re=O0(S,z,"source");this.binders[S]=ie?S==="line-dasharray"?new D0(D,z,V,u,re,a.id):new gs(D,z,V,u,re,a.id):new sr(D,A,z,re),y.push(`/a_${S}`)}else{const re=O0(S,z,"composite");this.binders[S]=new er(D,A,z,V,u,re),y.push(`/z_${S}`)}}this.cacheKey=y.sort().join("")}getMaxValue(a){const u=this.binders[a];return u instanceof sr||u instanceof er?u.maxValue:0}populatePaintArrays(a,u,m){for(const y in this.binders){const S=this.binders[y];(S instanceof sr||S instanceof er||S instanceof ms)&&S.populatePaintArray(a,u,m)}}setConstantPatternPositions(a,u){for(const m in this.binders){const y=this.binders[m];y instanceof Na&&y.setConstantPatternPositions(a,u)}}setConstantDashPositions(a,u){for(const m in this.binders){const y=this.binders[m];y instanceof Na&&y.setConstantDashPositions(a,u)}}updatePaintArrays(a,u,m,y,S){let T=!1;for(const A in a){const D=u.getPositions(A);for(const z of D){const V=m.feature(z.index);for(const X in this.binders){const ie=this.binders[X];if((ie instanceof sr||ie instanceof er||ie instanceof ms)&&ie.expression.isStateDependent===!0){const re=y.paint.get(X);ie.expression=re.value,ie.updatePaintArray(z.start,z.end,V,a[A],S),T=!0}}}}return T}defines(){const a=[];for(const u in this.binders){const m=this.binders[u];(m instanceof Ba||m instanceof Na)&&a.push(...m.uniformNames.map((y=>`#define HAS_UNIFORM_${y}`)))}return a}getBinderAttributes(){const a=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof sr||m instanceof er)for(let y=0;y<m.paintVertexAttributes.length;y++)a.push(m.paintVertexAttributes[y].name);else if(m instanceof ms){const y=m.getVertexAttributes();for(const S of y)a.push(S.name)}}return a}getBinderUniforms(){const a=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Ba||m instanceof Na||m instanceof er)for(const y of m.uniformNames)a.push(y)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,u){const m=[];for(const y in this.binders){const S=this.binders[y];if(S instanceof Ba||S instanceof Na||S instanceof er){for(const T of S.uniformNames)if(u[T]){const A=S.getBinding(a,u[T],T);m.push({name:T,property:y,binding:A})}}}return m}setUniforms(a,u,m,y){for(const{name:S,property:T,binding:A}of u)this.binders[T].setUniform(A,y,m.get(T),S)}updatePaintBuffers(a){this._buffers=[];for(const u in this.binders){const m=this.binders[u];if(a&&m instanceof ms){const y=a.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(m instanceof sr||m instanceof er)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(a){for(const u in this.binders){const m=this.binders[u];(m instanceof sr||m instanceof er||m instanceof ms)&&m.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const u=this.binders[a];(u instanceof sr||u instanceof er||u instanceof ms)&&u.destroy()}}}class Hu{constructor(a,u,m=()=>!0){this.programConfigurations={};for(const y of a)this.programConfigurations[y.id]=new F0(y,u,m);this.needsUpload=!1,this._featureMap=new Vs,this._bufferOffset=0}populatePaintArrays(a,u,m,y){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(a,u,y);u.id!==void 0&&this._featureMap.add(u.id,m,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,u,m,y){for(const S of m)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(a,this._featureMap,u,S,y)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function c1(h,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${a}-`,"").replace(/-/g,"_")]}function O0(h,a,u){const m={color:{source:Tf,composite:d},number:{source:hm,composite:Tf}},y=(function(S){return{"line-pattern":{source:Ge,composite:Ge},"fill-pattern":{source:Ge,composite:Ge},"fill-extrusion-pattern":{source:Ge,composite:Ge},"line-dasharray":{source:Je,composite:Je}}[S]})(h);return y&&y[u]||m[a][u]}mi("ConstantBinder",Ba),mi("CrossFadedConstantBinder",Na),mi("SourceExpressionBinder",sr),mi("CrossFadedPatternBinder",gs),mi("CrossFadedDasharrayBinder",D0),mi("CompositeExpressionBinder",er),mi("ProgramConfiguration",F0,{omit:["_buffers"]}),mi("ProgramConfigurationSet",Hu);const B_=Math.pow(2,14)-1,Gc=-B_-1;function qc(h){const a=Ce/h.extent,u=h.loadGeometry();for(let m=0;m<u.length;m++){const y=u[m];for(let S=0;S<y.length;S++){const T=y[S],A=Math.round(T.x*a),D=Math.round(T.y*a);T.x=Ye(A,Gc,B_),T.y=Ye(D,Gc,B_),(A<T.x||A>T.x+1||D<T.y||D>T.y+1)&&Mt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Hc(h,a){return{type:h.type,id:h.id,properties:h.properties,geometry:a?qc(h):[]}}const N_=-32768;function $_(h,a,u,m,y){h.emplaceBack(N_+8*a+m,N_+8*u+y)}class fm{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.layoutVertexArray=new De,this.indexArray=new wt,this.segments=new si,this.programConfigurations=new Hu(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,m){const y=this.layers[0],S=[];let T=null,A=!1,D=y.type==="heatmap";if(y.type==="circle"){const V=y;T=V.layout.get("circle-sort-key"),A=!T.isConstant(),D=D||V.paint.get("circle-pitch-alignment")==="map"}const z=D?u.subdivisionGranularity.circle:1;for(const{feature:V,id:X,index:ie,sourceLayerIndex:re}of a){const he=this.layers[0]._featureFilter.needGeometry,me=Hc(V,he);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),me,m))continue;const _e=A?T.evaluate(me,{},m):void 0,Se={id:X,properties:V.properties,type:V.type,sourceLayerIndex:re,index:ie,geometry:he?me.geometry:qc(V),patterns:{},sortKey:_e};S.push(Se)}A&&S.sort(((V,X)=>V.sortKey-X.sortKey));for(const V of S){const{geometry:X,index:ie,sourceLayerIndex:re}=V,he=a[ie].feature;this.addFeature(V,X,ie,m,z),u.featureIndex.insert(he,X,ie,re,this.index)}}update(a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:m})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Wt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,u,m,y,S=1){let T;switch(S){case 1:T=[0,7];break;case 3:T=[0,2,5,7];break;case 5:T=[0,1,3,4,6,7];break;case 7:T=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${S}; valid values are 1, 3, 5, 7.`)}const A=T.length;for(const D of u)for(const z of D){const V=z.x,X=z.y;if(V<0||V>=Ce||X<0||X>=Ce)continue;const ie=this.segments.prepareSegment(A*A,this.layoutVertexArray,this.indexArray,a.sortKey),re=ie.vertexLength;for(let he=0;he<A;he++)for(let me=0;me<A;me++)$_(this.layoutVertexArray,V,X,T[me],T[he]);for(let he=0;he<A-1;he++)for(let me=0;me<A-1;me++){const _e=re+he*A+me,Se=re+(he+1)*A+me;this.indexArray.emplaceBack(_e,Se+1,_e+1),this.indexArray.emplaceBack(_e,Se,Se+1)}ie.vertexLength+=A*A,ie.primitiveLength+=(A-1)*(A-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{imagePositions:{},canonical:y})}}function pm(h,a){for(let u=0;u<h.length;u++)if(mm(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(mm(h,a[u]))return!0;return!!u1(h,a)}function z0(h,a,u){return!!mm(h,a)||!!h1(a,h,u)}function xC(h,a){if(h.length===1)return SC(a,h[0]);for(let u=0;u<a.length;u++){const m=a[u];for(let y=0;y<m.length;y++)if(mm(h,m[y]))return!0}for(let u=0;u<h.length;u++)if(SC(a,h[u]))return!0;for(let u=0;u<a.length;u++)if(u1(h,a[u]))return!0;return!1}function Zz(h,a,u){if(h.length>1){if(u1(h,a))return!0;for(let m=0;m<a.length;m++)if(h1(a[m],h,u))return!0}for(let m=0;m<h.length;m++)if(h1(h[m],a,u))return!0;return!1}function u1(h,a){if(h.length===0||a.length===0)return!1;for(let u=0;u<h.length-1;u++){const m=h[u],y=h[u+1];for(let S=0;S<a.length-1;S++)if(Xz(m,y,a[S],a[S+1]))return!0}return!1}function Xz(h,a,u,m){return Zt(h,u,m)!==Zt(a,u,m)&&Zt(h,a,u)!==Zt(h,a,m)}function h1(h,a,u){const m=u*u;if(a.length===1)return h.distSqr(a[0])<m;for(let y=1;y<a.length;y++)if(wC(h,a[y-1],a[y])<m)return!0;return!1}function wC(h,a,u){const m=a.distSqr(u);if(m===0)return h.distSqr(a);const y=((h.x-a.x)*(u.x-a.x)+(h.y-a.y)*(u.y-a.y))/m;return h.distSqr(y<0?a:y>1?u:u.sub(a)._mult(y)._add(a))}function SC(h,a){let u,m,y,S=!1;for(let T=0;T<h.length;T++){u=h[T];for(let A=0,D=u.length-1;A<u.length;D=A++)m=u[A],y=u[D],m.y>a.y!=y.y>a.y&&a.x<(y.x-m.x)*(a.y-m.y)/(y.y-m.y)+m.x&&(S=!S)}return S}function mm(h,a){let u=!1;for(let m=0,y=h.length-1;m<h.length;y=m++){const S=h[m],T=h[y];S.y>a.y!=T.y>a.y&&a.x<(T.x-S.x)*(a.y-S.y)/(T.y-S.y)+S.x&&(u=!u)}return u}function Yz(h,a,u){const m=u[0],y=u[2];if(h.x<m.x&&a.x<m.x||h.x>y.x&&a.x>y.x||h.y<m.y&&a.y<m.y||h.y>y.y&&a.y>y.y)return!1;const S=Zt(h,a,u[0]);return S!==Zt(h,a,u[1])||S!==Zt(h,a,u[2])||S!==Zt(h,a,u[3])}function gm(h,a,u){const m=a.paint.get(h).value;return m.kind==="constant"?m.value:u.programConfigurations.get(a.id).getMaxValue(h)}function B0(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function N0(h,a,u,m,y){if(!a[0]&&!a[1])return h;const S=f.convert(a)._mult(y);u==="viewport"&&S._rotate(-m);const T=[];for(let A=0;A<h.length;A++)T.push(h[A].sub(S));return T}function Kz(h){const a=[];for(let u=0;u<h.length;u++){const m=h[u],y=a.at(-1);(u===0||y&&!m.equals(y))&&a.push(m)}return a}function Jz({queryGeometry:h,size:a},u){return z0(h,u,a)}function Qz({queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y},S){return z0(h,S,a*(u.projectTileCoordinates(S.x,S.y,m,y).signedDistanceFromCamera/u.cameraToCenterDistance))}function eB({queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y},S){const T=u.projectTileCoordinates(S.x,S.y,m,y).signedDistanceFromCamera,A=a*(u.cameraToCenterDistance/T);return z0(h,d1(S,u,m,y),A)}function tB({queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y},S){return z0(h,d1(S,u,m,y),a)}function TC({queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y,pitchAlignment:S="map",pitchScale:T="map"},A){const D=S==="map"?T==="map"?Jz:Qz:T==="map"?eB:tB,z={queryGeometry:h,size:a,transform:u,unwrappedTileID:m,getElevation:y};for(const V of A)for(const X of V)if(D(z,X))return!0;return!1}function d1(h,a,u,m){const y=a.projectTileCoordinates(h.x,h.y,u,m).point;return new f((.5*y.x+.5)*a.width,(.5*-y.y+.5)*a.height)}let MC,CC;mi("CircleBucket",fm,{omit:["layers"]});var iB={get paint(){return CC=CC||new lo({"circle-radius":new Fi(gt.paint_circle["circle-radius"]),"circle-color":new Fi(gt.paint_circle["circle-color"]),"circle-blur":new Fi(gt.paint_circle["circle-blur"]),"circle-opacity":new Fi(gt.paint_circle["circle-opacity"]),"circle-translate":new Mi(gt.paint_circle["circle-translate"]),"circle-translate-anchor":new Mi(gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mi(gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mi(gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fi(gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fi(gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fi(gt.paint_circle["circle-stroke-opacity"])})},get layout(){return MC=MC||new lo({"circle-sort-key":new Fi(gt.layout_circle["circle-sort-key"])})}};class nB extends ua{constructor(a,u){super(a,iB,u)}createBucket(a){return new fm(a)}queryRadius(a){const u=a;return gm("circle-radius",this,u)+gm("circle-stroke-width",this,u)+B0(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:m,geometry:y,transform:S,pixelsToTileUnits:T,unwrappedTileID:A,getElevation:D}){const z=N0(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-S.bearingInRadians,T),V=this.paint.get("circle-radius").evaluate(u,m)+this.paint.get("circle-stroke-width").evaluate(u,m),X=this.paint.get("circle-pitch-scale"),ie=this.paint.get("circle-pitch-alignment");let re,he;return ie==="map"?(re=z,he=V*T):(re=(function(me,_e,Se,Be){return me.map((Me=>d1(Me,_e,Se,Be)))})(z,S,A,D),he=V),TC({queryGeometry:re,size:he,transform:S,unwrappedTileID:A,getElevation:D,pitchAlignment:ie,pitchScale:X},y)}}class EC extends fm{}let AC;mi("HeatmapBucket",EC,{omit:["layers"]});var rB={get paint(){return AC=AC||new lo({"heatmap-radius":new Fi(gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fi(gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mi(gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new om(gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mi(gt.paint_heatmap["heatmap-opacity"])})}};function f1(h,{width:a,height:u},m,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==a*u*m)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${a*u*m}`)}else y=new Uint8Array(a*u*m);return h.width=a,h.height=u,h.data=y,h}function PC(h,{width:a,height:u},m){if(a===h.width&&u===h.height)return;const y=f1({},{width:a,height:u},m);p1(h,y,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,a),height:Math.min(h.height,u)},m),h.width=a,h.height=u,h.data=y.data}function p1(h,a,u,m,y,S){if(y.width===0||y.height===0)return a;if(y.width>h.width||y.height>h.height||u.x>h.width-y.width||u.y>h.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>a.width||y.height>a.height||m.x>a.width-y.width||m.y>a.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const T=h.data,A=a.data;if(T===A)throw new Error("srcData equals dstData, so image is already copied");for(let D=0;D<y.height;D++){const z=((u.y+D)*h.width+u.x)*S,V=((m.y+D)*a.width+m.x)*S;for(let X=0;X<y.width*S;X++)A[V+X]=T[z+X]}return a}class V_{constructor(a,u){f1(this,a,1,u)}resize(a){PC(this,a,1)}clone(){return new V_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,m,y,S){p1(a,u,m,y,S,1)}}class Ho{constructor(a,u){f1(this,a,4,u)}resize(a){PC(this,a,4)}replace(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,m,y,S){p1(a,u,m,y,S,4)}setPixel(a,u,m){const y=4*(a*this.width+u);this.data[y+0]=Math.round(255*m.r/m.a),this.data[y+1]=Math.round(255*m.g/m.a),this.data[y+2]=Math.round(255*m.b/m.a),this.data[y+3]=Math.round(255*m.a)}}function IC(h){const a={},u=h.resolution||256,m=h.clips?h.clips.length:1,y=h.image||new Ho({width:u,height:m});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const S=(T,A,D)=>{a[h.evaluationKey]=D;const z=h.expression.evaluate(a);y.setPixel(T/4/u,A/4,z)};if(h.clips)for(let T=0,A=0;T<m;++T,A+=4*u)for(let D=0,z=0;D<u;D++,z+=4){const V=D/(u-1),{start:X,end:ie}=h.clips[T];S(A,z,X*(1-V)+ie*V)}else for(let T=0,A=0;T<u;T++,A+=4)S(0,A,T/(u-1));return y}mi("AlphaImage",V_),mi("RGBAImage",Ho);const m1="big-fb";class sB extends ua{createBucket(a){return new EC(a)}constructor(a,u){super(a,rB,u),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=IC({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(m1)&&this.heatmapFbos.delete(m1)}queryRadius(a){return gm("heatmap-radius",this,a)}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:m,geometry:y,transform:S,pixelsToTileUnits:T,unwrappedTileID:A,getElevation:D}){return TC({queryGeometry:a,size:this.paint.get("heatmap-radius").evaluate(u,m)*T,transform:S,unwrappedTileID:A,getElevation:D},y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let LC;var oB={get paint(){return LC=LC||new lo({"hillshade-illumination-direction":new Mi(gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Mi(gt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Mi(gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mi(gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mi(gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mi(gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mi(gt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Mi(gt.paint_hillshade["hillshade-method"])})}};class aB extends ua{constructor(a,u){super(a,oB,u),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let a=this.paint.get("hillshade-illumination-direction").values,u=this.paint.get("hillshade-illumination-altitude").values,m=this.paint.get("hillshade-highlight-color").values,y=this.paint.get("hillshade-shadow-color").values;const S=Math.max(a.length,u.length,m.length,y.length);a=a.concat(Array(S-a.length).fill(a.at(-1))),u=u.concat(Array(S-u.length).fill(u.at(-1))),m=m.concat(Array(S-m.length).fill(m.at(-1))),y=y.concat(Array(S-y.length).fill(y.at(-1)));const T=u.map(Ue);return{directionRadians:a.map(Ue),altitudeRadians:T,shadowColor:y,highlightColor:m}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let RC;var lB={get paint(){return RC=RC||new lo({"color-relief-opacity":new Mi(gt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new om(gt["paint_color-relief"]["color-relief-color"])})}};class g1{constructor(a,u,m,y){this.context=a,this.format=m,this.texture=a.gl.createTexture(),this.update(u,y)}update(a,u,m){const{width:y,height:S}=a,T=!(this.size&&this.size[0]===y&&this.size[1]===S||m),{context:A}=this,{gl:D}=A;if(this.useMipmap=!!(u&&u.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!u||u.premultiply!==!1)),T)this.size=[y,S],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||xe(a)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,a):D.texImage2D(D.TEXTURE_2D,0,this.format,y,S,0,this.format,D.UNSIGNED_BYTE,a.data);else{const{x:z,y:V}=m||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||xe(a)?D.texSubImage2D(D.TEXTURE_2D,0,z,V,D.RGBA,D.UNSIGNED_BYTE,a):D.texSubImage2D(D.TEXTURE_2D,0,z,V,y,S,D.RGBA,D.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D),A.pixelStoreUnpackFlipY.setDefault(),A.pixelStoreUnpack.setDefault(),A.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(a,u,m){const{context:y}=this,{gl:S}=y;S.bindTexture(S.TEXTURE_2D,this.texture),m!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=S.LINEAR),a!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,m||a),this.filter=a),u!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,u),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class kC{constructor(a,u,m,y=1,S=1,T=1,A=0){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void Mt(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const D=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=S,this.blueFactor=T,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<D;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(D,z)]=this.data[this._idx(D-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,D)]=this.data[this._idx(z,D-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(D,-1)]=this.data[this._idx(D-1,0)],this.data[this._idx(-1,D)]=this.data[this._idx(0,D-1)],this.data[this._idx(D,D)]=this.data[this._idx(D-1,D-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<D;z++)for(let V=0;V<D;V++){const X=this.get(z,V);X>this.max&&(this.max=X),X<this.min&&(this.min=X)}}get(a,u){const m=new Uint8Array(this.data.buffer),y=4*this._idx(a,u);return this.unpack(m[y],m[y+1],m[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${a}, y: ${u}, dim: ${this.dim}`);return(u+1)*this.stride+(a+1)}unpack(a,u,m){return a*this.redFactor+u*this.greenFactor+m*this.blueFactor-this.baseShift}pack(a){return DC(a,this.getUnpackVector())}getPixels(){return new Ho({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,u,m){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let y=u*this.dim,S=u*this.dim+this.dim,T=m*this.dim,A=m*this.dim+this.dim;switch(u){case-1:y=S-1;break;case 1:S=y+1}switch(m){case-1:T=A-1;break;case 1:A=T+1}const D=-u*this.dim,z=-m*this.dim;for(let V=T;V<A;V++)for(let X=y;X<S;X++)this.data[this._idx(X,V)]=a.data[this._idx(X+D,V+z)]}}function DC(h,a){const u=a[0],m=a[1],y=a[2],S=a[3],T=Math.min(u,m,y),A=Math.round((h+S)/T);return{r:Math.floor(A*T/u)%256,g:Math.floor(A*T/m)%256,b:Math.floor(A*T/y)%256}}mi("DEMData",kC);class cB extends ua{constructor(a,u){super(a,lB,u)}_createColorRamp(a){const u={elevationStops:[],colorStops:[]},m=this._transitionablePaint._values["color-relief-color"].value.expression;if(m instanceof Wp&&m._styleExpression.expression instanceof vr){this.colorRampExpression=m;const T=m._styleExpression.expression;u.elevationStops=T.labels,u.colorStops=[];for(const A of u.elevationStops)u.colorStops.push(T.evaluate({globals:{elevation:A}}))}if(u.elevationStops.length<1&&(u.elevationStops=[0],u.colorStops=[nn.transparent]),u.elevationStops.length<2&&(u.elevationStops.push(u.elevationStops[0]+1),u.colorStops.push(u.colorStops[0])),u.elevationStops.length<=a)return u;const y={elevationStops:[],colorStops:[]},S=(u.elevationStops.length-1)/(a-1);for(let T=0;T<u.elevationStops.length-.5;T+=S)y.elevationStops.push(u.elevationStops[Math.round(T)]),y.colorStops.push(u.colorStops[Math.round(T)]);return Mt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${a}, provided: ${u.elevationStops.length}`),y}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(a,u,m){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const y=this._createColorRamp(u),S=new Ho({width:y.colorStops.length,height:1}),T=new Ho({width:y.colorStops.length,height:1});for(let A=0;A<y.elevationStops.length;A++){const D=DC(y.elevationStops[A],m);T.setPixel(0,A,new nn(D.r/255,D.g/255,D.b/255,1)),S.setPixel(0,A,y.colorStops[A])}return this.colorRampTextures={elevationTexture:new g1(a,T,a.gl.RGBA),colorTexture:new g1(a,S,a.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const uB=Wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:hB}=uB;function $0(h,a,u){const m=u.patternDependencies;let y=!1;for(const S of a){const T=S.paint.get(`${h}-pattern`);T.isConstant()||(y=!0);const A=T.constantOr(null);A&&(y=!0,m[A.to]=!0,m[A.from]=!0)}return y}function _1(h,a,u,m,y){const{zoom:S}=m,T=y.patternDependencies;for(const A of a){const D=A.paint.get(`${h}-pattern`).value;if(D.kind!=="constant"){let z=D.evaluate({zoom:S-1},u,{},y.availableImages),V=D.evaluate({zoom:S},u,{},y.availableImages),X=D.evaluate({zoom:S+1},u,{},y.availableImages);z=z&&z.name?z.name:z,V=V&&V.name?V.name:V,X=X&&X.name?X.name:X,T[z]=!0,T[V]=!0,T[X]=!0,u.patterns[A.id]={min:z,mid:V,max:X}}}return u}function FC(h,a,u,m,y){let S;if(y===(function(T,A,D,z){let V=0;for(let X=A,ie=D-z;X<D;X+=z)V+=(T[ie]-T[X])*(T[X+1]+T[ie+1]),ie=X;return V})(h,a,u,m)>0)for(let T=a;T<u;T+=m)S=NC(T/m|0,h[T],h[T+1],S);else for(let T=u-m;T>=a;T-=m)S=NC(T/m|0,h[T],h[T+1],S);return S&&_m(S,S.next)&&(q_(S),S=S.next),S}function Pf(h,a){if(!h)return h;a||(a=h);let u,m=h;do if(u=!1,m.steiner||!_m(m,m.next)&&ns(m.prev,m,m.next)!==0)m=m.next;else{if(q_(m),m=a=m.prev,m===m.next)break;u=!0}while(u||m!==a);return a}function U_(h,a,u,m,y,S,T){if(!h)return;!T&&S&&(function(D,z,V,X){let ie=D;do ie.z===0&&(ie.z=v1(ie.x,ie.y,z,V,X)),ie.prevZ=ie.prev,ie.nextZ=ie.next,ie=ie.next;while(ie!==D);ie.prevZ.nextZ=null,ie.prevZ=null,(function(re){let he,me=1;do{let _e,Se=re;re=null;let Be=null;for(he=0;Se;){he++;let Me=Se,Ae=0;for(let qe=0;qe<me&&(Ae++,Me=Me.nextZ,Me);qe++);let Ve=me;for(;Ae>0||Ve>0&&Me;)Ae!==0&&(Ve===0||!Me||Se.z<=Me.z)?(_e=Se,Se=Se.nextZ,Ae--):(_e=Me,Me=Me.nextZ,Ve--),Be?Be.nextZ=_e:re=_e,_e.prevZ=Be,Be=_e;Se=Me}Be.nextZ=null,me*=2}while(he>1)})(ie)})(h,m,y,S);let A=h;for(;h.prev!==h.next;){const D=h.prev,z=h.next;if(S?fB(h,m,y,S):dB(h))a.push(D.i,h.i,z.i),q_(h),h=z.next,A=z.next;else if((h=z)===A){T?T===1?U_(h=pB(Pf(h),a),a,u,m,y,S,2):T===2&&mB(h,a,u,m,y,S):U_(Pf(h),a,u,m,y,S,1);break}}}function dB(h){const a=h.prev,u=h,m=h.next;if(ns(a,u,m)>=0)return!1;const y=a.x,S=u.x,T=m.x,A=a.y,D=u.y,z=m.y,V=Math.min(y,S,T),X=Math.min(A,D,z),ie=Math.max(y,S,T),re=Math.max(A,D,z);let he=m.next;for(;he!==a;){if(he.x>=V&&he.x<=ie&&he.y>=X&&he.y<=re&&j_(y,A,S,D,T,z,he.x,he.y)&&ns(he.prev,he,he.next)>=0)return!1;he=he.next}return!0}function fB(h,a,u,m){const y=h.prev,S=h,T=h.next;if(ns(y,S,T)>=0)return!1;const A=y.x,D=S.x,z=T.x,V=y.y,X=S.y,ie=T.y,re=Math.min(A,D,z),he=Math.min(V,X,ie),me=Math.max(A,D,z),_e=Math.max(V,X,ie),Se=v1(re,he,a,u,m),Be=v1(me,_e,a,u,m);let Me=h.prevZ,Ae=h.nextZ;for(;Me&&Me.z>=Se&&Ae&&Ae.z<=Be;){if(Me.x>=re&&Me.x<=me&&Me.y>=he&&Me.y<=_e&&Me!==y&&Me!==T&&j_(A,V,D,X,z,ie,Me.x,Me.y)&&ns(Me.prev,Me,Me.next)>=0||(Me=Me.prevZ,Ae.x>=re&&Ae.x<=me&&Ae.y>=he&&Ae.y<=_e&&Ae!==y&&Ae!==T&&j_(A,V,D,X,z,ie,Ae.x,Ae.y)&&ns(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;Me&&Me.z>=Se;){if(Me.x>=re&&Me.x<=me&&Me.y>=he&&Me.y<=_e&&Me!==y&&Me!==T&&j_(A,V,D,X,z,ie,Me.x,Me.y)&&ns(Me.prev,Me,Me.next)>=0)return!1;Me=Me.prevZ}for(;Ae&&Ae.z<=Be;){if(Ae.x>=re&&Ae.x<=me&&Ae.y>=he&&Ae.y<=_e&&Ae!==y&&Ae!==T&&j_(A,V,D,X,z,ie,Ae.x,Ae.y)&&ns(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function pB(h,a){let u=h;do{const m=u.prev,y=u.next.next;!_m(m,y)&&zC(m,u,u.next,y)&&G_(m,y)&&G_(y,m)&&(a.push(m.i,u.i,y.i),q_(u),q_(u.next),u=h=y),u=u.next}while(u!==h);return Pf(u)}function mB(h,a,u,m,y,S){let T=h;do{let A=T.next.next;for(;A!==T.prev;){if(T.i!==A.i&&bB(T,A)){let D=BC(T,A);return T=Pf(T,T.next),D=Pf(D,D.next),U_(T,a,u,m,y,S,0),void U_(D,a,u,m,y,S,0)}A=A.next}T=T.next}while(T!==h)}function gB(h,a){let u=h.x-a.x;return u===0&&(u=h.y-a.y,u===0)&&(u=(h.next.y-h.y)/(h.next.x-h.x)-(a.next.y-a.y)/(a.next.x-a.x)),u}function _B(h,a){const u=(function(y,S){let T=S;const A=y.x,D=y.y;let z,V=-1/0;if(_m(y,T))return T;do{if(_m(y,T.next))return T.next;if(D<=T.y&&D>=T.next.y&&T.next.y!==T.y){const me=T.x+(D-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(me<=A&&me>V&&(V=me,z=T.x<T.next.x?T:T.next,me===A))return z}T=T.next}while(T!==S);if(!z)return null;const X=z,ie=z.x,re=z.y;let he=1/0;T=z;do{if(A>=T.x&&T.x>=ie&&A!==T.x&&OC(D<re?A:V,D,ie,re,D<re?V:A,D,T.x,T.y)){const me=Math.abs(D-T.y)/(A-T.x);G_(T,y)&&(me<he||me===he&&(T.x>z.x||T.x===z.x&&vB(z,T)))&&(z=T,he=me)}T=T.next}while(T!==X);return z})(h,a);if(!u)return a;const m=BC(u,h);return Pf(m,m.next),Pf(u,u.next)}function vB(h,a){return ns(h.prev,h,a.prev)<0&&ns(a.next,h,h.next)<0}function v1(h,a,u,m,y){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-u)*y|0)|h<<8))|h<<4))|h<<2))|h<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-m)*y|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function yB(h){let a=h,u=h;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==h);return u}function OC(h,a,u,m,y,S,T,A){return(y-T)*(a-A)>=(h-T)*(S-A)&&(h-T)*(m-A)>=(u-T)*(a-A)&&(u-T)*(S-A)>=(y-T)*(m-A)}function j_(h,a,u,m,y,S,T,A){return!(h===T&&a===A)&&OC(h,a,u,m,y,S,T,A)}function bB(h,a){return h.next.i!==a.i&&h.prev.i!==a.i&&!(function(u,m){let y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==m.i&&y.next.i!==m.i&&zC(y,y.next,u,m))return!0;y=y.next}while(y!==u);return!1})(h,a)&&(G_(h,a)&&G_(a,h)&&(function(u,m){let y=u,S=!1;const T=(u.x+m.x)/2,A=(u.y+m.y)/2;do y.y>A!=y.next.y>A&&y.next.y!==y.y&&T<(y.next.x-y.x)*(A-y.y)/(y.next.y-y.y)+y.x&&(S=!S),y=y.next;while(y!==u);return S})(h,a)&&(ns(h.prev,h,a.prev)||ns(h,a.prev,a))||_m(h,a)&&ns(h.prev,h,h.next)>0&&ns(a.prev,a,a.next)>0)}function ns(h,a,u){return(a.y-h.y)*(u.x-a.x)-(a.x-h.x)*(u.y-a.y)}function _m(h,a){return h.x===a.x&&h.y===a.y}function zC(h,a,u,m){const y=U0(ns(h,a,u)),S=U0(ns(h,a,m)),T=U0(ns(u,m,h)),A=U0(ns(u,m,a));return y!==S&&T!==A||!(y!==0||!V0(h,u,a))||!(S!==0||!V0(h,m,a))||!(T!==0||!V0(u,h,m))||!(A!==0||!V0(u,a,m))}function V0(h,a,u){return a.x<=Math.max(h.x,u.x)&&a.x>=Math.min(h.x,u.x)&&a.y<=Math.max(h.y,u.y)&&a.y>=Math.min(h.y,u.y)}function U0(h){return h>0?1:h<0?-1:0}function G_(h,a){return ns(h.prev,h,h.next)<0?ns(h,a,h.next)>=0&&ns(h,h.prev,a)>=0:ns(h,a,h.prev)<0||ns(h,h.next,a)<0}function BC(h,a){const u=y1(h.i,h.x,h.y),m=y1(a.i,a.x,a.y),y=h.next,S=a.prev;return h.next=a,a.prev=h,u.next=y,y.prev=u,m.next=u,u.prev=m,S.next=m,m.prev=S,m}function NC(h,a,u,m){const y=y1(h,a,u);return m?(y.next=m.next,y.prev=m,m.next.prev=y,m.next=y):(y.prev=y,y.next=y),y}function q_(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function y1(h,a,u){return{i:h,x:a,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class vm{constructor(a,u){if(u>a)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=a,this._minGranularity=u}getGranularityForZoomLevel(a){return Math.max(Math.floor(this._baseZoomGranularity/(1<<a)),this._minGranularity,1)}}class j0{constructor(a){this.fill=a.fill,this.line=a.line,this.tile=a.tile,this.stencil=a.stencil,this.circle=a.circle}}j0.noSubdivision=new j0({fill:new vm(0,0),line:new vm(0,0),tile:new vm(0,0),stencil:new vm(0,0),circle:1}),mi("SubdivisionGranularityExpression",vm),mi("SubdivisionGranularitySetting",j0);const ym=-32768,H_=32767;class xB{constructor(a,u){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=a,this._granularityCellSize=Ce/a,this._canonical=u}_getKey(a,u){return(a+=32768)<<16|u+32768}_vertexToIndex(a,u){if(a<-32768||u<-32768||a>32767||u>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const m=0|Math.round(a),y=0|Math.round(u),S=this._getKey(m,y);if(this._vertexDictionary.has(S))return this._vertexDictionary.get(S);const T=this._vertexBuffer.length/2;return this._vertexDictionary.set(S,T),this._vertexBuffer.push(m,y),T}_subdivideTrianglesScanline(a){if(this._granularity<2)return(function(y,S){const T=[];for(let A=0;A<S.length;A+=3){const D=S[A],z=S[A+1],V=S[A+2],X=y[2*D],ie=y[2*D+1];(y[2*z]-X)*(y[2*V+1]-ie)-(y[2*z+1]-ie)*(y[2*V]-X)>0?(T.push(D),T.push(V),T.push(z)):(T.push(D),T.push(z),T.push(V))}return T})(this._vertexBuffer,a);const u=[],m=a.length;for(let y=0;y<m;y+=3){const S=[a[y+0],a[y+1],a[y+2]],T=[this._vertexBuffer[2*a[y+0]+0],this._vertexBuffer[2*a[y+0]+1],this._vertexBuffer[2*a[y+1]+0],this._vertexBuffer[2*a[y+1]+1],this._vertexBuffer[2*a[y+2]+0],this._vertexBuffer[2*a[y+2]+1]];let A=1/0,D=1/0,z=-1/0,V=-1/0;for(let me=0;me<3;me++){const _e=T[2*me],Se=T[2*me+1];A=Math.min(A,_e),z=Math.max(z,_e),D=Math.min(D,Se),V=Math.max(V,Se)}if(A===z||D===V)continue;const X=Math.floor(A/this._granularityCellSize),ie=Math.ceil(z/this._granularityCellSize),re=Math.floor(D/this._granularityCellSize),he=Math.ceil(V/this._granularityCellSize);if(X!==ie||re!==he)for(let me=re;me<he;me++){const _e=this._scanlineGenerateVertexRingForCellRow(me,T,S);wB(this._vertexBuffer,_e,u)}else u.push(...S)}return u}_scanlineGenerateVertexRingForCellRow(a,u,m){const y=a*this._granularityCellSize,S=y+this._granularityCellSize,T=[];for(let A=0;A<3;A++){const D=u[2*A],z=u[2*A+1],V=u[2*(A+1)%6],X=u[(2*(A+1)+1)%6],ie=u[2*(A+2)%6],re=u[(2*(A+2)+1)%6],he=V-D,me=X-z,_e=he===0,Se=me===0,Be=(y-z)/me,Me=(S-z)/me,Ae=Math.min(Be,Me),Ve=Math.max(Be,Me);if(!Se&&(Ae>=1||Ve<=0)||Se&&(z<y||z>S)){X>=y&&X<=S&&T.push(m[(A+1)%3]);continue}!Se&&Ae>0&&T.push(this._vertexToIndex(D+he*Ae,z+me*Ae));const qe=D+he*Math.max(Ae,0),_t=D+he*Math.min(Ve,1);_e||this._generateIntraEdgeVertices(T,D,z,V,X,qe,_t),!Se&&Ve<1&&T.push(this._vertexToIndex(D+he*Ve,z+me*Ve)),(Se||X>=y&&X<=S)&&T.push(m[(A+1)%3]),!Se&&(X<=y||X>=S)&&this._generateInterEdgeVertices(T,D,z,V,X,ie,re,_t,y,S)}return T}_generateIntraEdgeVertices(a,u,m,y,S,T,A){const D=y-u,z=S-m,V=z===0,X=V?Math.min(u,y):Math.min(T,A),ie=V?Math.max(u,y):Math.max(T,A),re=Math.floor(X/this._granularityCellSize)+1,he=Math.ceil(ie/this._granularityCellSize)-1;if(V?u<y:T<A)for(let me=re;me<=he;me++){const _e=me*this._granularityCellSize;a.push(this._vertexToIndex(_e,m+z*(_e-u)/D))}else for(let me=he;me>=re;me--){const _e=me*this._granularityCellSize;a.push(this._vertexToIndex(_e,m+z*(_e-u)/D))}}_generateInterEdgeVertices(a,u,m,y,S,T,A,D,z,V){const X=S-m,ie=T-y,re=A-S,he=(z-S)/re,me=(V-S)/re,_e=Math.min(he,me),Se=Math.max(he,me),Be=y+ie*_e;let Me=Math.floor(Math.min(Be,D)/this._granularityCellSize)+1,Ae=Math.ceil(Math.max(Be,D)/this._granularityCellSize)-1,Ve=D<Be;const qe=re===0;if(qe&&(A===z||A===V))return;if(qe||_e>=1||Se<=0){const Vt=m-A,Rt=T+(u-T)*Math.min((z-A)/Vt,(V-A)/Vt);Me=Math.floor(Math.min(Rt,D)/this._granularityCellSize)+1,Ae=Math.ceil(Math.max(Rt,D)/this._granularityCellSize)-1,Ve=D<Rt}const _t=X>0?V:z;if(Ve)for(let Vt=Me;Vt<=Ae;Vt++)a.push(this._vertexToIndex(Vt*this._granularityCellSize,_t));else for(let Vt=Ae;Vt>=Me;Vt--)a.push(this._vertexToIndex(Vt*this._granularityCellSize,_t))}_generateOutline(a){const u=[];for(const m of a){const y=If(m,this._granularity,!0),S=this._pointArrayToIndices(y),T=[];for(let A=1;A<S.length;A++)T.push(S[A-1]),T.push(S[A]);u.push(T)}return u}_handlePoles(a){let u=!1,m=!1;this._canonical&&(this._canonical.y===0&&(u=!0),this._canonical.y===(1<<this._canonical.z)-1&&(m=!0)),(u||m)&&this._fillPoles(a,u,m)}_ensureNoPoleVertices(){const a=this._vertexBuffer;for(let u=0;u<a.length;u+=2){const m=a[u+1];m===ym&&(a[u+1]=-32767),m===H_&&(a[u+1]=32766)}}_generatePoleQuad(a,u,m,y,S,T){y>S!=(T===ym)?(a.push(u),a.push(m),a.push(this._vertexToIndex(y,T)),a.push(m),a.push(this._vertexToIndex(S,T)),a.push(this._vertexToIndex(y,T))):(a.push(m),a.push(u),a.push(this._vertexToIndex(y,T)),a.push(this._vertexToIndex(S,T)),a.push(m),a.push(this._vertexToIndex(y,T)))}_fillPoles(a,u,m){const y=this._vertexBuffer,S=Ce,T=a.length;for(let A=2;A<T;A+=3){const D=a[A-2],z=a[A-1],V=a[A],X=y[2*D],ie=y[2*D+1],re=y[2*z],he=y[2*z+1],me=y[2*V],_e=y[2*V+1];u&&(ie===0&&he===0&&this._generatePoleQuad(a,D,z,X,re,ym),he===0&&_e===0&&this._generatePoleQuad(a,z,V,re,me,ym),_e===0&&ie===0&&this._generatePoleQuad(a,V,D,me,X,ym)),m&&(ie===S&&he===S&&this._generatePoleQuad(a,D,z,X,re,H_),he===S&&_e===S&&this._generatePoleQuad(a,z,V,re,me,H_),_e===S&&ie===S&&this._generatePoleQuad(a,V,D,me,X,H_))}}_initializeVertices(a){for(let u=0;u<a.length;u+=2)this._vertexToIndex(a[u],a[u+1])}subdividePolygonInternal(a,u){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:m,holeIndices:y}=(function(A){const D=[],z=[];for(const V of A)if(V.length!==0){V!==A[0]&&D.push(z.length/2);for(let X=0;X<V.length;X++)z.push(V[X].x),z.push(V[X].y)}return{flattened:z,holeIndices:D}})(a);let S;this._initializeVertices(m);try{const A=(function(z,V,X=2){const ie=V&&V.length,re=ie?V[0]*X:z.length;let he=FC(z,0,re,X,!0);const me=[];if(!he||he.next===he.prev)return me;let _e,Se,Be;if(ie&&(he=(function(Me,Ae,Ve,qe){const _t=[];for(let Vt=0,Rt=Ae.length;Vt<Rt;Vt++){const Ht=FC(Me,Ae[Vt]*qe,Vt<Rt-1?Ae[Vt+1]*qe:Me.length,qe,!1);Ht===Ht.next&&(Ht.steiner=!0),_t.push(yB(Ht))}_t.sort(gB);for(let Vt=0;Vt<_t.length;Vt++)Ve=_B(_t[Vt],Ve);return Ve})(z,V,he,X)),z.length>80*X){_e=z[0],Se=z[1];let Me=_e,Ae=Se;for(let Ve=X;Ve<re;Ve+=X){const qe=z[Ve],_t=z[Ve+1];qe<_e&&(_e=qe),_t<Se&&(Se=_t),qe>Me&&(Me=qe),_t>Ae&&(Ae=_t)}Be=Math.max(Me-_e,Ae-Se),Be=Be!==0?32767/Be:0}return U_(he,me,X,_e,Se,Be,0),me})(m,y),D=this._convertIndices(m,A);S=this._subdivideTrianglesScanline(D)}catch(A){console.error(A)}let T=[];return u&&(T=this._generateOutline(a)),this._ensureNoPoleVertices(),this._handlePoles(S),{verticesFlattened:this._vertexBuffer,indicesTriangles:S,indicesLineList:T}}_convertIndices(a,u){const m=[];for(let y=0;y<u.length;y++)m.push(this._vertexToIndex(a[2*u[y]],a[2*u[y]+1]));return m}_pointArrayToIndices(a){const u=[];for(let m=0;m<a.length;m++){const y=a[m];u.push(this._vertexToIndex(y.x,y.y))}return u}}function $C(h,a,u,m=!0){return new xB(u,a).subdividePolygonInternal(h,m)}function If(h,a,u=!1){if(!h||h.length<1)return[];if(h.length<2)return[];const m=h[0],y=h[h.length-1],S=u&&(m.x!==y.x||m.y!==y.y);if(a<2)return S?[...h,h[0]]:[...h];const T=Math.floor(Ce/a),A=[];A.push(new f(h[0].x,h[0].y));const D=h.length,z=S?D:D-1;for(let V=0;V<z;V++){const X=h[V],ie=V<D-1?h[V+1]:h[0],re=X.x,he=X.y,me=ie.x,_e=ie.y,Se=re!==me,Be=he!==_e;if(!Se&&!Be)continue;const Me=me-re,Ae=_e-he,Ve=Math.abs(Me),qe=Math.abs(Ae);let _t=re,Vt=he;for(;;){const Ht=Me>0?(Math.floor(_t/T)+1)*T:(Math.ceil(_t/T)-1)*T,ni=Ae>0?(Math.floor(Vt/T)+1)*T:(Math.ceil(Vt/T)-1)*T,Yt=Math.abs(_t-Ht),Ft=Math.abs(Vt-ni),St=Math.abs(_t-me),fi=Math.abs(Vt-_e),hi=Se?Yt/Ve:Number.POSITIVE_INFINITY,_i=Be?Ft/qe:Number.POSITIVE_INFINITY;if((St<=Yt||!Se)&&(fi<=Ft||!Be))break;if(hi<_i&&Se||!Be){_t=Ht,Vt+=Ae*hi;const ci=new f(_t,Math.round(Vt));A[A.length-1].x===ci.x&&A[A.length-1].y===ci.y||A.push(ci)}else{_t+=Me*_i,Vt=ni;const ci=new f(Math.round(_t),Vt);A[A.length-1].x===ci.x&&A[A.length-1].y===ci.y||A.push(ci)}}const Rt=new f(me,_e);A[A.length-1].x===Rt.x&&A[A.length-1].y===Rt.y||A.push(Rt)}return A}function wB(h,a,u){if(a.length===0)throw new Error("Subdivision vertex ring is empty.");let m=0,y=h[2*a[0]];for(let D=1;D<a.length;D++){const z=h[2*a[D]];z<y&&(y=z,m=D)}const S=a.length;let T=m,A=(T+1)%S;for(;;){const D=T-1>=0?T-1:S-1,z=(A+1)%S,V=h[2*a[D]],X=h[2*a[z]],ie=h[2*a[T]],re=h[2*a[T]+1],he=h[2*a[A]+1];let me=!1;if(V<X)me=!0;else if(V>X)me=!1;else{const _e=he-re,Se=-(h[2*a[A]]-ie),Be=re<he?1:-1;((V-ie)*_e+(h[2*a[D]+1]-re)*Se)*Be>((X-ie)*_e+(h[2*a[z]+1]-re)*Se)*Be&&(me=!0)}if(me){const _e=a[D],Se=a[T],Be=a[A];_e!==Se&&_e!==Be&&Se!==Be&&u.push(Be,Se,_e),T--,T<0&&(T=S-1)}else{const _e=a[z],Se=a[T],Be=a[A];_e!==Se&&_e!==Be&&Se!==Be&&u.push(Be,Se,_e),A++,A>=S&&(A=0)}if(D===z)break}}function VC(h,a,u,m,y,S,T,A,D){const z=y.length/2,V=T&&A&&D;if(z<si.MAX_VERTEX_ARRAY_LENGTH){const X=a.prepareSegment(z,u,m),ie=X.vertexLength;for(let me=0;me<S.length;me+=3)m.emplaceBack(ie+S[me],ie+S[me+1],ie+S[me+2]);let re,he;X.vertexLength+=z,X.primitiveLength+=S.length/3,V&&(he=T.prepareSegment(z,u,A),re=he.vertexLength,he.vertexLength+=z);for(let me=0;me<y.length;me+=2)h(y[me],y[me+1]);if(V)for(let me=0;me<D.length;me++){const _e=D[me];for(let Se=1;Se<_e.length;Se+=2)A.emplaceBack(re+_e[Se-1],re+_e[Se]);he.primitiveLength+=_e.length/2}}else(function(X,ie,re,he,me,_e){const Se=[];for(let qe=0;qe<he.length/2;qe++)Se.push(-1);const Be={count:0};let Me=0,Ae=X.getOrCreateLatestSegment(ie,re),Ve=Ae.vertexLength;for(let qe=2;qe<me.length;qe+=3){const _t=me[qe-2],Vt=me[qe-1],Rt=me[qe];let Ht=Se[_t]<Me,ni=Se[Vt]<Me,Yt=Se[Rt]<Me;Ae.vertexLength+((Ht?1:0)+(ni?1:0)+(Yt?1:0))>si.MAX_VERTEX_ARRAY_LENGTH&&(Ae=X.createNewSegment(ie,re),Me=Be.count,Ht=!0,ni=!0,Yt=!0,Ve=0);const Ft=W_(Se,he,_e,Be,_t,Ht,Ae),St=W_(Se,he,_e,Be,Vt,ni,Ae),fi=W_(Se,he,_e,Be,Rt,Yt,Ae);re.emplaceBack(Ve+Ft-Me,Ve+St-Me,Ve+fi-Me),Ae.primitiveLength++}})(a,u,m,y,S,h),V&&(function(X,ie,re,he,me,_e){const Se=[];for(let qe=0;qe<he.length/2;qe++)Se.push(-1);const Be={count:0};let Me=0,Ae=X.getOrCreateLatestSegment(ie,re),Ve=Ae.vertexLength;for(let qe=0;qe<me.length;qe++){const _t=me[qe];for(let Vt=1;Vt<me[qe].length;Vt+=2){const Rt=_t[Vt-1],Ht=_t[Vt];let ni=Se[Rt]<Me,Yt=Se[Ht]<Me;Ae.vertexLength+((ni?1:0)+(Yt?1:0))>si.MAX_VERTEX_ARRAY_LENGTH&&(Ae=X.createNewSegment(ie,re),Me=Be.count,ni=!0,Yt=!0,Ve=0);const Ft=W_(Se,he,_e,Be,Rt,ni,Ae),St=W_(Se,he,_e,Be,Ht,Yt,Ae);re.emplaceBack(Ve+Ft-Me,Ve+St-Me),Ae.primitiveLength++}}})(T,u,A,y,D,h),a.forceNewSegmentOnNextPrepare(),T?.forceNewSegmentOnNextPrepare()}function W_(h,a,u,m,y,S,T){if(S){const A=m.count;return u(a[2*y],a[2*y+1]),h[y]=m.count,m.count++,T.vertexLength++,A}return h[y]}class b1{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ke,this.indexArray=new wt,this.indexArray2=new Qt,this.programConfigurations=new Hu(a.layers,a.zoom),this.segments=new si,this.segments2=new si,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,m){this.hasDependencies=$0("fill",this.layers,u);const y=this.layers[0].layout.get("fill-sort-key"),S=!y.isConstant(),T=[];for(const{feature:A,id:D,index:z,sourceLayerIndex:V}of a){const X=this.layers[0]._featureFilter.needGeometry,ie=Hc(A,X);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),ie,m))continue;const re=S?y.evaluate(ie,{},m,u.availableImages):void 0,he={id:D,properties:A.properties,type:A.type,sourceLayerIndex:V,index:z,geometry:X?ie.geometry:qc(A),patterns:{},sortKey:re};T.push(he)}S&&T.sort(((A,D)=>A.sortKey-D.sortKey));for(const A of T){const{geometry:D,index:z,sourceLayerIndex:V}=A;if(this.hasDependencies){const X=_1("fill",this.layers,A,{zoom:this.zoom},u);this.patternFeatures.push(X)}else this.addFeature(A,D,z,m,{},u.subdivisionGranularity);u.featureIndex.insert(a[z].feature,D,z,V,this.index)}}update(a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:m})}addFeatures(a,u,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,m,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,hB),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,u,m,y,S,T){for(const A of Uh(u,500)){const D=$C(A,y,T.fill.getGranularityForZoomLevel(y.z)),z=this.layoutVertexArray;VC(((V,X)=>{z.emplaceBack(V,X)}),this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles,this.segments2,this.indexArray2,D.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{imagePositions:S,canonical:y})}}let UC,jC;mi("FillBucket",b1,{omit:["layers","patternFeatures"]});var SB={get paint(){return jC=jC||new lo({"fill-antialias":new Mi(gt.paint_fill["fill-antialias"]),"fill-opacity":new Fi(gt.paint_fill["fill-opacity"]),"fill-color":new Fi(gt.paint_fill["fill-color"]),"fill-outline-color":new Fi(gt.paint_fill["fill-outline-color"]),"fill-translate":new Mi(gt.paint_fill["fill-translate"]),"fill-translate-anchor":new Mi(gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new xf(gt.paint_fill["fill-pattern"])})},get layout(){return UC=UC||new lo({"fill-sort-key":new Fi(gt.layout_fill["fill-sort-key"])})}};class TB extends ua{constructor(a,u){super(a,SB,u)}recalculate(a,u){super.recalculate(a,u);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new b1(a)}queryRadius(){return B0(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:a,geometry:u,transform:m,pixelsToTileUnits:y}){return xC(N0(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-m.bearingInRadians,y),u)}isTileClipped(){return!0}}const MB=Wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),CB=Wr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:EB}=MB;class Z_{constructor(a,u,m,y,S){this.properties={},this.extent=m,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=y,this._values=S,a.readFields(AB,this,u)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const u=a.readVarint()+a.pos,m=[];let y,S=1,T=0,A=0,D=0;for(;a.pos<u;){if(T<=0){const z=a.readVarint();S=7&z,T=z>>3}if(T--,S===1||S===2)A+=a.readSVarint(),D+=a.readSVarint(),S===1&&(y&&m.push(y),y=[]),y&&y.push(new f(A,D));else{if(S!==7)throw new Error(`unknown command ${S}`);y&&y.push(y[0].clone())}}return y&&m.push(y),m}bbox(){const a=this._pbf;a.pos=this._geometry;const u=a.readVarint()+a.pos;let m=1,y=0,S=0,T=0,A=1/0,D=-1/0,z=1/0,V=-1/0;for(;a.pos<u;){if(y<=0){const X=a.readVarint();m=7&X,y=X>>3}if(y--,m===1||m===2)S+=a.readSVarint(),T+=a.readSVarint(),S<A&&(A=S),S>D&&(D=S),T<z&&(z=T),T>V&&(V=T);else if(m!==7)throw new Error(`unknown command ${m}`)}return[A,z,D,V]}toGeoJSON(a,u,m){const y=this.extent*Math.pow(2,m),S=this.extent*a,T=this.extent*u,A=this.loadGeometry();function D(ie){return[360*(ie.x+S)/y-180,360/Math.PI*Math.atan(Math.exp((1-2*(ie.y+T)/y)*Math.PI))-90]}function z(ie){return ie.map(D)}let V;if(this.type===1){const ie=[];for(const he of A)ie.push(he[0]);const re=z(ie);V=ie.length===1?{type:"Point",coordinates:re[0]}:{type:"MultiPoint",coordinates:re}}else if(this.type===2){const ie=A.map(z);V=ie.length===1?{type:"LineString",coordinates:ie[0]}:{type:"MultiLineString",coordinates:ie}}else{if(this.type!==3)throw new Error("unknown feature type");{const ie=GC(A),re=[];for(const he of ie)re.push(he.map(z));V=re.length===1?{type:"Polygon",coordinates:re[0]}:{type:"MultiPolygon",coordinates:re}}}const X={type:"Feature",geometry:V,properties:this.properties};return this.id!=null&&(X.id=this.id),X}}function AB(h,a,u){h===1?a.id=u.readVarint():h===2?(function(m,y){const S=m.readVarint()+m.pos;for(;m.pos<S;){const T=y._keys[m.readVarint()],A=y._values[m.readVarint()];y.properties[T]=A}})(u,a):h===3?a.type=u.readVarint():h===4&&(a._geometry=u.pos)}function GC(h){const a=h.length;if(a<=1)return[h];const u=[];let m,y;for(let S=0;S<a;S++){const T=PB(h[S]);T!==0&&(y===void 0&&(y=T<0),y===T<0?(m&&u.push(m),m=[h[S]]):m&&m.push(h[S]))}return m&&u.push(m),u}function PB(h){let a=0;for(let u,m,y=0,S=h.length,T=S-1;y<S;T=y++)u=h[y],m=h[T],a+=(m.x-u.x)*(u.y+m.y);return a}Z_.types=["Unknown","Point","LineString","Polygon"];class IB{constructor(a,u){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(LB,this,u),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const u=this._pbf.readVarint()+this._pbf.pos;return new Z_(this._pbf,u,this.extent,this._keys,this._values)}}function LB(h,a,u){h===15?a.version=u.readVarint():h===1?a.name=u.readString():h===5?a.extent=u.readVarint():h===2?a._features.push(u.pos):h===3?a._keys.push(u.readString()):h===4&&a._values.push((function(m){let y=null;const S=m.readVarint()+m.pos;for(;m.pos<S;){const T=m.readVarint()>>3;y=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}if(y==null)throw new Error("unknown feature value");return y})(u))}class qC{constructor(a,u){this.layers=a.readFields(RB,{},u)}}function RB(h,a,u){if(h===3){const m=new IB(u,u.readVarint()+u.pos);m.length&&(a[m.name]=m)}}const x1=Math.pow(2,13);function X_(h,a,u,m,y,S,T,A){h.emplaceBack(a,u,2*Math.floor(m*x1)+T,y*x1*2,S*x1*2,Math.round(A))}class w1{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.layoutVertexArray=new Ne,this.centroidVertexArray=new Le,this.indexArray=new wt,this.programConfigurations=new Hu(a.layers,a.zoom),this.segments=new si,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,m){this.features=[],this.hasDependencies=$0("fill-extrusion",this.layers,u);for(const{feature:y,id:S,index:T,sourceLayerIndex:A}of a){const D=this.layers[0]._featureFilter.needGeometry,z=Hc(y,D);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),z,m))continue;const V={id:S,sourceLayerIndex:A,index:T,geometry:D?z.geometry:qc(y),properties:y.properties,type:y.type,patterns:{}};this.hasDependencies?this.features.push(_1("fill-extrusion",this.layers,V,{zoom:this.zoom},u)):this.addFeature(V,V.geometry,T,m,{},u.subdivisionGranularity),u.featureIndex.insert(y,V.geometry,T,A,this.index,!0)}}addFeatures(a,u,m){for(const y of this.features){const{geometry:S}=y;this.addFeature(y,S,y.index,u,m,a.subdivisionGranularity)}}update(a,u,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:m})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,EB),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,CB.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,u,m,y,S,T){for(const A of Uh(u,500)){const D={x:0,y:0,sampleCount:0},z=this.layoutVertexArray.length;this.processPolygon(D,y,a,A,T);const V=this.layoutVertexArray.length-z,X=Math.floor(D.x/D.sampleCount),ie=Math.floor(D.y/D.sampleCount);for(let re=0;re<V;re++)this.centroidVertexArray.emplaceBack(X,ie)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{imagePositions:S,canonical:y})}processPolygon(a,u,m,y,S){if(y.length<1||HC(y[0]))return;for(const X of y)X.length!==0&&kB(a,X);const T={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},A=S.fill.getGranularityForZoomLevel(u.z),D=Z_.types[m.type]==="Polygon";for(const X of y){if(X.length===0||HC(X))continue;const ie=If(X,A,D);this._generateSideFaces(ie,T)}if(!D)return;const z=$C(y,u,A,!1),V=this.layoutVertexArray;VC(((X,ie)=>{X_(V,X,ie,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles)}_generateSideFaces(a,u){let m=0;for(let y=1;y<a.length;y++){const S=a[y],T=a[y-1];if(DB(S,T))continue;u.segment.vertexLength+4>si.MAX_VERTEX_ARRAY_LENGTH&&(u.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const A=S.sub(T)._perp()._unit(),D=T.dist(S);m+D>32768&&(m=0),X_(this.layoutVertexArray,S.x,S.y,A.x,A.y,0,0,m),X_(this.layoutVertexArray,S.x,S.y,A.x,A.y,0,1,m),m+=D,X_(this.layoutVertexArray,T.x,T.y,A.x,A.y,0,0,m),X_(this.layoutVertexArray,T.x,T.y,A.x,A.y,0,1,m);const z=u.segment.vertexLength;this.indexArray.emplaceBack(z,z+2,z+1),this.indexArray.emplaceBack(z+1,z+2,z+3),u.segment.vertexLength+=4,u.segment.primitiveLength+=2}}}function kB(h,a){for(let u=0;u<a.length;u++){const m=a[u];u===a.length-1&&a[0].x===m.x&&a[0].y===m.y||(h.x+=m.x,h.y+=m.y,h.sampleCount++)}}function DB(h,a){return h.x===a.x&&(h.x<0||h.x>Ce)||h.y===a.y&&(h.y<0||h.y>Ce)}function HC(h){return h.every((a=>a.x<0))||h.every((a=>a.x>Ce))||h.every((a=>a.y<0))||h.every((a=>a.y>Ce))}let WC;mi("FillExtrusionBucket",w1,{omit:["layers","features"]});var FB={get paint(){return WC=WC||new lo({"fill-extrusion-opacity":new Mi(gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fi(gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mi(gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mi(gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xf(gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fi(gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fi(gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Mi(gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class OB extends ua{constructor(a,u){super(a,FB,u)}createBucket(a){return new w1(a)}queryRadius(){return B0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:m,geometry:y,transform:S,pixelsToTileUnits:T,pixelPosMatrix:A}){const D=N0(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-S.bearingInRadians,T),z=this.paint.get("fill-extrusion-height").evaluate(u,m),V=this.paint.get("fill-extrusion-base").evaluate(u,m),X=(function(re,he){const me=[];for(const _e of re){const Se=[_e.x,_e.y,0,1];le(Se,Se,he),me.push(new f(Se[0]/Se[3],Se[1]/Se[3]))}return me})(D,A),ie=(function(re,he,me,_e){const Se=[],Be=[],Me=_e[8]*he,Ae=_e[9]*he,Ve=_e[10]*he,qe=_e[11]*he,_t=_e[8]*me,Vt=_e[9]*me,Rt=_e[10]*me,Ht=_e[11]*me;for(const ni of re){const Yt=[],Ft=[];for(const St of ni){const fi=St.x,hi=St.y,_i=_e[0]*fi+_e[4]*hi+_e[12],ci=_e[1]*fi+_e[5]*hi+_e[13],Ci=_e[2]*fi+_e[6]*hi+_e[14],wn=_e[3]*fi+_e[7]*hi+_e[15],un=Ci+Ve,wr=wn+qe,eo=_i+_t,hs=ci+Vt,Sr=Ci+Rt,mr=wn+Ht,In=new f((_i+Me)/wr,(ci+Ae)/wr);In.z=un/wr,Yt.push(In);const Nr=new f(eo/mr,hs/mr);Nr.z=Sr/mr,Ft.push(Nr)}Se.push(Yt),Be.push(Ft)}return[Se,Be]})(y,V,z,A);return(function(re,he,me){let _e=1/0;xC(me,he)&&(_e=ZC(me,he[0]));for(let Se=0;Se<he.length;Se++){const Be=he[Se],Me=re[Se];for(let Ae=0;Ae<Be.length-1;Ae++){const Ve=Be[Ae],qe=[Ve,Be[Ae+1],Me[Ae+1],Me[Ae],Ve];pm(me,qe)&&(_e=Math.min(_e,ZC(me,qe)))}}return _e!==1/0&&_e})(ie[0],ie[1],X)}}function Y_(h,a){return h.x*a.x+h.y*a.y}function ZC(h,a){if(h.length===1){let u=0;const m=a[u++];let y;for(;!y||m.equals(y);)if(y=a[u++],!y)return 1/0;for(;u<a.length;u++){const S=a[u],T=h[0],A=y.sub(m),D=S.sub(m),z=T.sub(m),V=Y_(A,A),X=Y_(A,D),ie=Y_(D,D),re=Y_(z,A),he=Y_(z,D),me=V*ie-X*X,_e=(ie*re-X*he)/me,Se=(V*he-X*re)/me,Be=m.z*(1-_e-Se)+y.z*_e+S.z*Se;if(isFinite(Be))return Be}return 1/0}{let u=1/0;for(const m of a)u=Math.min(u,m.z);return u}}const zB=Wr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:BB}=zB,NB=Wr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:$B}=NB,VB=Math.cos(Math.PI/180*37.5),XC=Math.pow(2,14)/.5;class S1{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((u=>u.id)),this.index=a.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((u=>{this.gradients[u.id]={}})),this.layoutVertexArray=new He,this.layoutVertexArray2=new ze,this.indexArray=new wt,this.programConfigurations=new Hu(a.layers,a.zoom),this.segments=new si,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((u=>u.isStateDependent())).map((u=>u.id))}populate(a,u,m){this.hasDependencies=$0("line",this.layers,u)||this.hasLineDasharray(this.layers);const y=this.layers[0].layout.get("line-sort-key"),S=!y.isConstant(),T=[];for(const{feature:A,id:D,index:z,sourceLayerIndex:V}of a){const X=this.layers[0]._featureFilter.needGeometry,ie=Hc(A,X);if(!this.layers[0]._featureFilter.filter(new Gn(this.zoom),ie,m))continue;const re=S?y.evaluate(ie,{},m):void 0,he={id:D,properties:A.properties,type:A.type,sourceLayerIndex:V,index:z,geometry:X?ie.geometry:qc(A),patterns:{},dashes:{},sortKey:re};T.push(he)}S&&T.sort(((A,D)=>A.sortKey-D.sortKey));for(const A of T){const{geometry:D,index:z,sourceLayerIndex:V}=A;this.hasDependencies?($0("line",this.layers,u)?_1("line",this.layers,A,{zoom:this.zoom},u):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,A,this.zoom,u),this.patternFeatures.push(A)):this.addFeature(A,D,z,m,{},{},u.subdivisionGranularity),u.featureIndex.insert(a[z].feature,D,z,V,this.index)}}update(a,u,m,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,{imagePositions:m,dashPositions:y})}addFeatures(a,u,m,y){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,u,m,y,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,$B)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,BB),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,u,m,y,S,T,A){const D=this.layers[0].layout,z=D.get("line-join").evaluate(a,{}),V=D.get("line-cap"),X=D.get("line-miter-limit"),ie=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const re of u)this.addLine(re,a,z,V,X,ie,y,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{imagePositions:S,dashPositions:T,canonical:y})}addLine(a,u,m,y,S,T,A,D){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,a=If(a,A?D.line.getGranularityForZoomLevel(A.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Me=0;Me<a.length-1;Me++)this.totalDistance+=a[Me].dist(a[Me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=Z_.types[u.type]==="Polygon";let V=a.length;for(;V>=2&&a[V-1].equals(a[V-2]);)V--;let X=0;for(;X<V-1&&a[X].equals(a[X+1]);)X++;if(V<(z?3:2))return;m==="bevel"&&(S=1.05);const ie=this.overscaling<=16?122880/(512*this.overscaling):0,re=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let he,me,_e,Se,Be;this.e1=this.e2=-1,z&&(he=a[V-2],Be=a[X].sub(he)._unit()._perp());for(let Me=X;Me<V;Me++){if(_e=Me===V-1?z?a[X+1]:void 0:a[Me+1],_e&&a[Me].equals(_e))continue;Be&&(Se=Be),he&&(me=he),he=a[Me],Be=_e?_e.sub(he)._unit()._perp():Se,Se=Se||Be;let Ae=Se.add(Be);Ae.x===0&&Ae.y===0||Ae._unit();const Ve=Se.x*Be.x+Se.y*Be.y,qe=Ae.x*Be.x+Ae.y*Be.y,_t=qe!==0?1/qe:1/0,Vt=2*Math.sqrt(2-2*qe),Rt=qe<VB&&me&&_e,Ht=Se.x*Be.y-Se.y*Be.x>0;if(Rt&&Me>X){const Ft=he.dist(me);if(Ft>2*ie){const St=he.sub(he.sub(me)._mult(ie/Ft)._round());this.updateDistance(me,St),this.addCurrentVertex(St,Se,0,0,re),me=St}}const ni=me&&_e;let Yt=ni?m:z?"butt":y;if(ni&&Yt==="round"&&(_t<T?Yt="miter":_t<=2&&(Yt="fakeround")),Yt==="miter"&&_t>S&&(Yt="bevel"),Yt==="bevel"&&(_t>2&&(Yt="flipbevel"),_t<S&&(Yt="miter")),me&&this.updateDistance(me,he),Yt==="miter")Ae._mult(_t),this.addCurrentVertex(he,Ae,0,0,re);else if(Yt==="flipbevel"){if(_t>100)Ae=Be.mult(-1);else{const Ft=_t*Se.add(Be).mag()/Se.sub(Be).mag();Ae._perp()._mult(Ft*(Ht?-1:1))}this.addCurrentVertex(he,Ae,0,0,re),this.addCurrentVertex(he,Ae.mult(-1),0,0,re)}else if(Yt==="bevel"||Yt==="fakeround"){const Ft=-Math.sqrt(_t*_t-1),St=Ht?Ft:0,fi=Ht?0:Ft;if(me&&this.addCurrentVertex(he,Se,St,fi,re),Yt==="fakeround"){const hi=Math.round(180*Vt/Math.PI/20);for(let _i=1;_i<hi;_i++){let ci=_i/hi;if(ci!==.5){const wn=ci-.5;ci+=ci*wn*(ci-1)*((1.0904+Ve*(Ve*(3.55645-1.43519*Ve)-3.2452))*wn*wn+(.848013+Ve*(.215638*Ve-1.06021)))}const Ci=Be.sub(Se)._mult(ci)._add(Se)._unit()._mult(Ht?-1:1);this.addHalfVertex(he,Ci.x,Ci.y,!1,Ht,0,re)}}_e&&this.addCurrentVertex(he,Be,-St,-fi,re)}else if(Yt==="butt")this.addCurrentVertex(he,Ae,0,0,re);else if(Yt==="square"){const Ft=me?1:-1;this.addCurrentVertex(he,Ae,Ft,Ft,re)}else Yt==="round"&&(me&&(this.addCurrentVertex(he,Se,0,0,re),this.addCurrentVertex(he,Se,1,1,re,!0)),_e&&(this.addCurrentVertex(he,Be,-1,-1,re,!0),this.addCurrentVertex(he,Be,0,0,re)));if(Rt&&Me<V-1){const Ft=he.dist(_e);if(Ft>2*ie){const St=he.add(_e.sub(he)._mult(ie/Ft)._round());this.updateDistance(he,St),this.addCurrentVertex(St,Be,0,0,re),he=St}}}}addCurrentVertex(a,u,m,y,S,T=!1){const A=u.y*y-u.x,D=-u.y-u.x*y;this.addHalfVertex(a,u.x+u.y*m,u.y-u.x*m,T,!1,m,S),this.addHalfVertex(a,A,D,T,!0,-y,S),this.distance>XC/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,u,m,y,S,T))}addHalfVertex({x:a,y:u},m,y,S,T,A,D){const z=.5*(this.lineClips?this.scaledDistance*(XC-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(S?1:0),(u<<1)+(T?1:0),Math.round(63*m)+128,Math.round(63*y)+128,1+(A===0?0:A<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const V=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,V,this.e2),D.primitiveLength++),T?this.e2=V:this.e1=V}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,u){this.distance+=a.dist(u),this.updateScaledDistance()}hasLineDasharray(a){for(const u of a){const m=u.paint.get("line-dasharray");if(m&&!m.isConstant())return!0}return!1}addLineDashDependencies(a,u,m,y){for(const S of a){const T=S.paint.get("line-dasharray");if(!T||T.value.kind==="constant")continue;const A=S.layout.get("line-cap")==="round",D={dasharray:T.value.evaluate({zoom:m-1},u,{}),round:A},z={dasharray:T.value.evaluate({zoom:m},u,{}),round:A},V={dasharray:T.value.evaluate({zoom:m+1},u,{}),round:A},X=`${D.dasharray.join(",")},${D.round}`,ie=`${z.dasharray.join(",")},${z.round}`,re=`${V.dasharray.join(",")},${V.round}`;y.dashDependencies[X]=D,y.dashDependencies[ie]=z,y.dashDependencies[re]=V,u.dashes[S.id]={min:X,mid:ie,max:re}}}}let YC,KC;mi("LineBucket",S1,{omit:["layers","patternFeatures"]});var JC={get paint(){return KC=KC||new lo({"line-opacity":new Fi(gt.paint_line["line-opacity"]),"line-color":new Fi(gt.paint_line["line-color"]),"line-translate":new Mi(gt.paint_line["line-translate"]),"line-translate-anchor":new Mi(gt.paint_line["line-translate-anchor"]),"line-width":new Fi(gt.paint_line["line-width"]),"line-gap-width":new Fi(gt.paint_line["line-gap-width"]),"line-offset":new Fi(gt.paint_line["line-offset"]),"line-blur":new Fi(gt.paint_line["line-blur"]),"line-dasharray":new xf(gt.paint_line["line-dasharray"]),"line-pattern":new xf(gt.paint_line["line-pattern"]),"line-gradient":new om(gt.paint_line["line-gradient"])})},get layout(){return YC=YC||new lo({"line-cap":new Mi(gt.layout_line["line-cap"]),"line-join":new Fi(gt.layout_line["line-join"]),"line-miter-limit":new Mi(gt.layout_line["line-miter-limit"]),"line-round-limit":new Mi(gt.layout_line["line-round-limit"]),"line-sort-key":new Fi(gt.layout_line["line-sort-key"])})}};class UB extends Fi{possiblyEvaluate(a,u){return u=new Gn(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(a,u)}evaluate(a,u,m,y){return u=Lt({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(a,u,m,y)}}let G0;class jB extends ua{constructor(a,u){super(a,JC,u),this.gradientVersion=0,G0||(G0=new UB(JC.paint.properties["line-width"].specification),G0.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!(function(m){return m._styleExpression!==void 0})(u)&&u._styleExpression.expression instanceof Ta,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,u){super.recalculate(a,u),this.paint._values["line-floorwidth"]=G0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new S1(a)}queryRadius(a){const u=a,m=QC(gm("line-width",this,u),gm("line-gap-width",this,u)),y=gm("line-offset",this,u);return m/2+Math.abs(y)+B0(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:a,feature:u,featureState:m,geometry:y,transform:S,pixelsToTileUnits:T}){const A=N0(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-S.bearingInRadians,T),D=T/2*QC(this.paint.get("line-width").evaluate(u,m),this.paint.get("line-gap-width").evaluate(u,m)),z=this.paint.get("line-offset").evaluate(u,m);return z&&(y=(function(V,X){const ie=[];for(let re=0;re<V.length;re++){const he=Kz(V[re]),me=[];for(let _e=0;_e<he.length;_e++){const Se=he[_e],Be=he[_e-1],Me=he[_e+1],Ae=_e===0?new f(0,0):Se.sub(Be)._unit()._perp(),Ve=_e===he.length-1?new f(0,0):Me.sub(Se)._unit()._perp(),qe=Ae._add(Ve)._unit(),_t=qe.x*Ve.x+qe.y*Ve.y;_t!==0&&qe._mult(1/_t),me.push(qe._mult(X)._add(Se))}ie.push(me)}return ie})(y,z*T)),(function(V,X,ie){for(let re=0;re<X.length;re++){const he=X[re];if(V.length>=3){for(let me=0;me<he.length;me++)if(mm(V,he[me]))return!0}if(Zz(V,he,ie))return!0}return!1})(A,y,D)}isTileClipped(){return!0}}function QC(h,a){return a>0?a+2*h:h}const GB=Wr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qB=Wr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const HB=Wr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Wr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const eE=Wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WB=Wr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ZB(h,a,u){return h.sections.forEach((m=>{m.text=(function(y,S,T){const A=S.layout.get("text-transform").evaluate(T,{});return A==="uppercase"?y=y.toLocaleUpperCase():A==="lowercase"&&(y=y.toLocaleLowerCase()),Uc.applyArabicShaping&&(y=Uc.applyArabicShaping(y)),y})(m.text,a,u)})),h}Wr([{name:"triangle",components:3,type:"Uint16"}]),Wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wr([{type:"Float32",name:"offsetX"}]),Wr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var As=24;const K_={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â¯":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"},XB={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},YB={40:!0};function tE(h,a,u,m,y,S){if("fontStack"in a){const T=u[a.fontStack],A=T&&T[h];return A?A.metrics.advance*a.scale+y:0}{const T=m[a.imageName];return T?T.displaySize[0]*a.scale*As/S+y:0}}function iE(h,a,u,m){const y=Math.pow(h-a,2);return m?h<a?y/2:2*y:y+Math.abs(u)*u}function KB(h,a,u){let m=0;return h===10&&(m-=1e4),u&&(m+=150),h!==40&&h!==65288||(m+=50),a!==41&&a!==65289||(m+=50),m}function nE(h,a,u,m,y,S){let T=null,A=iE(a,u,y,S);for(const D of m){const z=iE(a-D.x,u,y,S)+D.badness;z<=A&&(T=D,A=z)}return{index:h,x:a,priorBreak:T,badness:A}}function rE(h){return h?rE(h.priorBreak).concat(h.index):[]}class bm{constructor(a="",u=[],m=[]){this.text=a,this.sections=u,this.sectionIndex=m,this.imageSectionID=null}static fromFeature(a,u){const m=new bm;for(let y=0;y<a.sections.length;y++){const S=a.sections[y];S.image?m.addImageSection(S):m.addTextSection(S,u)}return m}length(){return[...this.text].length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}verticalizePunctuation(){this.text=(function(a){let u="",m={premature:!0,value:void 0};const y=a[Symbol.iterator]();let S=y.next();const T=a[Symbol.iterator]();T.next();let A=T.next();for(;!S.done;)u+=!A.done&&E_(A.value.codePointAt(0))&&!K_[A.value]||!m.premature&&E_(m.value.codePointAt(0))&&!K_[m.value]||!K_[S.value]?S.value:K_[S.value],m={value:S.value,premature:!1},S=y.next(),A=T.next();return u})(this.text)}hasZeroWidthSpaces(){return this.text.includes("â")}trim(){const a=this.text.match(/^\s*/),u=a?a[0].length:0,m=this.text.match(/\S\s*$/),y=m?m[0].length-1:0;this.text=this.text.substring(u,this.text.length-y),this.sectionIndex=this.sectionIndex.slice(u,this.sectionIndex.length-y)}substring(a,u){const m=[...this.text].slice(a,u).join(""),y=this.sectionIndex.slice(a,u);return new bm(m,this.sections,y)}toCodeUnitIndex(a){return[...this.text].slice(0,a).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((a,u)=>Math.max(a,this.sections[u].scale)),0)}getMaxImageSize(a){let u=0,m=0;for(let y=0;y<this.length();y++){const S=this.getSection(y);if("imageName"in S){const T=a[S.imageName];if(!T)continue;const A=T.displaySize;u=Math.max(u,A[0]),m=Math.max(m,A[1])}}return{maxImageWidth:u,maxImageHeight:m}}addTextSection(a,u){this.text+=a.text,this.sections.push({scale:a.scale||1,verticalAlign:a.verticalAlign||"bottom",fontStack:a.fontStack||u});const m=this.sections.length-1;this.sectionIndex.push(...[...a.text].map((()=>m)))}addImageSection(a){const u=a.image?a.image.name:"";if(u.length===0)return void Mt("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push({scale:1,verticalAlign:a.verticalAlign||"bottom",imageName:u}),this.sectionIndex.push(this.sections.length-1)):Mt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(a,u,m,y,S){const T=[],A=this.determineAverageLineWidth(a,u,m,y,S),D=this.hasZeroWidthSpaces();let z=0,V=0;const X=this.text[Symbol.iterator]();let ie=X.next();const re=this.text[Symbol.iterator]();re.next();let he=re.next();const me=this.text[Symbol.iterator]();me.next(),me.next();let _e=me.next();for(;!ie.done;){const Se=this.getSection(V),Be=ie.value.codePointAt(0);if(C0(Be)||(z+=tE(Be,Se,m,y,a,S)),!he.done){const Me=vf(Be),Ae=he.value.codePointAt(0);(XB[Be]||Me||"imageName"in Se||!_e.done&&YB[Ae])&&T.push(nE(V+1,z,A,T,KB(Be,Ae,Me&&D),!1))}V++,ie=X.next(),he=re.next(),_e=me.next()}return rE(nE(this.length(),z,A,T,0,!0))}determineAverageLineWidth(a,u,m,y,S){let T=0,A=0;for(const D of this.text){const z=this.getSection(A);T+=tE(D.codePointAt(0),z,m,y,a,S),A++}return T/Math.max(1,Math.ceil(T/u))}}const T1=4294967296,sE=1/T1,oE=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class q0{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,u,m=this.length){for(;this.pos<m;){const y=this.readVarint(),S=y>>3,T=this.pos;this.type=7&y,a(S,u,this),this.pos===T&&this.skip(y)}return u}readMessage(a,u){return this.readFields(a,u,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*T1;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*T1;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const u=this.buf;let m,y;return y=u[this.pos++],m=127&y,y<128?m:(y=u[this.pos++],m|=(127&y)<<7,y<128?m:(y=u[this.pos++],m|=(127&y)<<14,y<128?m:(y=u[this.pos++],m|=(127&y)<<21,y<128?m:(y=u[this.pos],m|=(15&y)<<28,(function(S,T,A){const D=A.buf;let z,V;if(V=D[A.pos++],z=(112&V)>>4,V<128||(V=D[A.pos++],z|=(127&V)<<3,V<128)||(V=D[A.pos++],z|=(127&V)<<10,V<128)||(V=D[A.pos++],z|=(127&V)<<17,V<128)||(V=D[A.pos++],z|=(127&V)<<24,V<128)||(V=D[A.pos++],z|=(1&V)<<31,V<128))return xm(S,z,T);throw new Error("Expected varint not more than 10 bytes")})(m,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&oE?oE.decode(this.buf.subarray(u,a)):(function(m,y,S){let T="",A=y;for(;A<S;){const D=m[A];let z,V,X,ie=null,re=D>239?4:D>223?3:D>191?2:1;if(A+re>S)break;re===1?D<128&&(ie=D):re===2?(z=m[A+1],(192&z)==128&&(ie=(31&D)<<6|63&z,ie<=127&&(ie=null))):re===3?(z=m[A+1],V=m[A+2],(192&z)==128&&(192&V)==128&&(ie=(15&D)<<12|(63&z)<<6|63&V,(ie<=2047||ie>=55296&&ie<=57343)&&(ie=null))):re===4&&(z=m[A+1],V=m[A+2],X=m[A+3],(192&z)==128&&(192&V)==128&&(192&X)==128&&(ie=(15&D)<<18|(63&z)<<12|(63&V)<<6|63&X,(ie<=65535||ie>=1114112)&&(ie=null))),ie===null?(ie=65533,re=1):ie>65535&&(ie-=65536,T+=String.fromCharCode(ie>>>10&1023|55296),ie=56320|1023&ie),T+=String.fromCharCode(ie),A+=re}return T})(this.buf,u,a)}readBytes(){const a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u}readPackedVarint(a=[],u){const m=this.readPackedEnd();for(;this.pos<m;)a.push(this.readVarint(u));return a}readPackedSVarint(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const u=this.readPackedEnd();for(;this.pos<u;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const u=7&a;if(u===0)for(;this.buf[this.pos++]>127;);else if(u===2)this.pos=this.readVarint()+this.pos;else if(u===5)this.pos+=4;else{if(u!==1)throw new Error(`Unimplemented type: ${u}`);this.pos+=8}}writeTag(a,u){this.writeVarint(a<<3|u)}realloc(a){let u=this.length||16;for(;u<this.pos+a;)u*=2;if(u!==this.length){const m=new Uint8Array(u);m.set(this.buf),this.buf=m,this.dataView=new DataView(m.buffer),this.length=u}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*sE),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*sE),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(u,m){let y,S;if(u>=0?(y=u%4294967296|0,S=u/4294967296|0):(y=~(-u%4294967296),S=~(-u/4294967296),4294967295^y?y=y+1|0:(y=0,S=S+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),(function(T,A,D){D.buf[D.pos++]=127&T|128,T>>>=7,D.buf[D.pos++]=127&T|128,T>>>=7,D.buf[D.pos++]=127&T|128,T>>>=7,D.buf[D.pos++]=127&T|128,D.buf[D.pos]=127&(T>>>=7)})(y,0,m),(function(T,A){const D=(7&T)<<4;A.buf[A.pos++]|=D|((T>>>=3)?128:0),T&&(A.buf[A.pos++]=127&T|((T>>>=7)?128:0),T&&(A.buf[A.pos++]=127&T|((T>>>=7)?128:0),T&&(A.buf[A.pos++]=127&T|((T>>>=7)?128:0),T&&(A.buf[A.pos++]=127&T|((T>>>=7)?128:0),T&&(A.buf[A.pos++]=127&T)))))})(S,m)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const u=this.pos;this.pos=(function(y,S,T){for(let A,D,z=0;z<S.length;z++){if(A=S.charCodeAt(z),A>55295&&A<57344){if(!D){A>56319||z+1===S.length?(y[T++]=239,y[T++]=191,y[T++]=189):D=A;continue}if(A<56320){y[T++]=239,y[T++]=191,y[T++]=189,D=A;continue}A=D-55296<<10|A-56320|65536,D=null}else D&&(y[T++]=239,y[T++]=191,y[T++]=189,D=null);A<128?y[T++]=A:(A<2048?y[T++]=A>>6|192:(A<65536?y[T++]=A>>12|224:(y[T++]=A>>18|240,y[T++]=A>>12&63|128),y[T++]=A>>6&63|128),y[T++]=63&A|128)}return T})(this.buf,a,this.pos);const m=this.pos-u;m>=128&&aE(u,m,this),this.pos=u-1,this.writeVarint(m),this.pos+=m}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const u=a.length;this.writeVarint(u),this.realloc(u);for(let m=0;m<u;m++)this.buf[this.pos++]=a[m]}writeRawMessage(a,u){this.pos++;const m=this.pos;a(u,this);const y=this.pos-m;y>=128&&aE(m,y,this),this.pos=m-1,this.writeVarint(y),this.pos+=y}writeMessage(a,u,m){this.writeTag(a,2),this.writeRawMessage(u,m)}writePackedVarint(a,u){u.length&&this.writeMessage(a,JB,u)}writePackedSVarint(a,u){u.length&&this.writeMessage(a,QB,u)}writePackedBoolean(a,u){u.length&&this.writeMessage(a,iN,u)}writePackedFloat(a,u){u.length&&this.writeMessage(a,eN,u)}writePackedDouble(a,u){u.length&&this.writeMessage(a,tN,u)}writePackedFixed32(a,u){u.length&&this.writeMessage(a,nN,u)}writePackedSFixed32(a,u){u.length&&this.writeMessage(a,rN,u)}writePackedFixed64(a,u){u.length&&this.writeMessage(a,sN,u)}writePackedSFixed64(a,u){u.length&&this.writeMessage(a,oN,u)}writeBytesField(a,u){this.writeTag(a,2),this.writeBytes(u)}writeFixed32Field(a,u){this.writeTag(a,5),this.writeFixed32(u)}writeSFixed32Field(a,u){this.writeTag(a,5),this.writeSFixed32(u)}writeFixed64Field(a,u){this.writeTag(a,1),this.writeFixed64(u)}writeSFixed64Field(a,u){this.writeTag(a,1),this.writeSFixed64(u)}writeVarintField(a,u){this.writeTag(a,0),this.writeVarint(u)}writeSVarintField(a,u){this.writeTag(a,0),this.writeSVarint(u)}writeStringField(a,u){this.writeTag(a,2),this.writeString(u)}writeFloatField(a,u){this.writeTag(a,5),this.writeFloat(u)}writeDoubleField(a,u){this.writeTag(a,1),this.writeDouble(u)}writeBooleanField(a,u){this.writeVarintField(a,+u)}}function xm(h,a,u){return u?4294967296*a+(h>>>0):4294967296*(a>>>0)+(h>>>0)}function aE(h,a,u){const m=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));u.realloc(m);for(let y=u.pos-1;y>=h;y--)u.buf[y+m]=u.buf[y]}function JB(h,a){for(let u=0;u<h.length;u++)a.writeVarint(h[u])}function QB(h,a){for(let u=0;u<h.length;u++)a.writeSVarint(h[u])}function eN(h,a){for(let u=0;u<h.length;u++)a.writeFloat(h[u])}function tN(h,a){for(let u=0;u<h.length;u++)a.writeDouble(h[u])}function iN(h,a){for(let u=0;u<h.length;u++)a.writeBoolean(h[u])}function nN(h,a){for(let u=0;u<h.length;u++)a.writeFixed32(h[u])}function rN(h,a){for(let u=0;u<h.length;u++)a.writeSFixed32(h[u])}function sN(h,a){for(let u=0;u<h.length;u++)a.writeFixed64(h[u])}function oN(h,a){for(let u=0;u<h.length;u++)a.writeSFixed64(h[u])}function aN(h,a,u){h===1&&u.readMessage(lN,a)}function lN(h,a,u){if(h===3){const{id:m,bitmap:y,width:S,height:T,left:A,top:D,advance:z}=u.readMessage(cN,{});a.push({id:m,bitmap:new V_({width:S+6,height:T+6},y),metrics:{width:S,height:T,left:A,top:D,advance:z}})}}function cN(h,a,u){h===1?a.id=u.readVarint():h===2?a.bitmap=u.readBytes():h===3?a.width=u.readVarint():h===4?a.height=u.readVarint():h===5?a.left=u.readSVarint():h===6?a.top=u.readSVarint():h===7&&(a.advance=u.readVarint())}function lE(h){let a=0,u=0;for(const T of h)a+=T.w*T.h,u=Math.max(u,T.w);h.sort(((T,A)=>A.h-T.h));const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}];let y=0,S=0;for(const T of h)for(let A=m.length-1;A>=0;A--){const D=m[A];if(!(T.w>D.w||T.h>D.h)){if(T.x=D.x,T.y=D.y,S=Math.max(S,T.y+T.h),y=Math.max(y,T.x+T.w),T.w===D.w&&T.h===D.h){const z=m.pop();z&&A<m.length&&(m[A]=z)}else T.h===D.h?(D.x+=T.w,D.w-=T.w):T.w===D.w?(D.y+=T.h,D.h-=T.h):(m.push({x:D.x+T.w,y:D.y,w:D.w-T.w,h:T.h}),D.y+=T.h,D.h-=T.h);break}}return{w:y,h:S,fill:a/(y*S)||0}}class M1{constructor(a,{pixelRatio:u,version:m,stretchX:y,stretchY:S,content:T,textFitWidth:A,textFitHeight:D}){this.paddedRect=a,this.pixelRatio=u,this.stretchX=y,this.stretchY=S,this.content=T,this.version=m,this.textFitWidth=A,this.textFitHeight=D}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class cE{constructor(a,u){const m={},y={};this.haveRenderCallbacks=[];const S=[];this.addImages(a,m,S),this.addImages(u,y,S);const{w:T,h:A}=lE(S),D=new Ho({width:T||1,height:A||1});for(const z in a){const V=a[z],X=m[z].paddedRect;Ho.copy(V.data,D,{x:0,y:0},{x:X.x+1,y:X.y+1},V.data)}for(const z in u){const V=u[z],X=y[z].paddedRect,ie=X.x+1,re=X.y+1,he=V.data.width,me=V.data.height;Ho.copy(V.data,D,{x:0,y:0},{x:ie,y:re},V.data),Ho.copy(V.data,D,{x:0,y:me-1},{x:ie,y:re-1},{width:he,height:1}),Ho.copy(V.data,D,{x:0,y:0},{x:ie,y:re+me},{width:he,height:1}),Ho.copy(V.data,D,{x:he-1,y:0},{x:ie-1,y:re},{width:1,height:me}),Ho.copy(V.data,D,{x:0,y:0},{x:ie+he,y:re},{width:1,height:me})}this.image=D,this.iconPositions=m,this.patternPositions=y}addImages(a,u,m){for(const y in a){const S=a[y],T={x:0,y:0,w:S.data.width+2,h:S.data.height+2};m.push(T),u[y]=new M1(T,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(a,u){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in a.updatedImages)this.patchUpdatedImage(this.iconPositions[m],a.getImage(m),u),this.patchUpdatedImage(this.patternPositions[m],a.getImage(m),u)}patchUpdatedImage(a,u,m){if(!a||!u||a.version===u.version)return;a.version=u.version;const[y,S]=a.tl;m.update(u.data,void 0,{x:y,y:S})}}var td;function H0(h,a,u,m,y,S,T,A,D,z,V,X,ie,re,he){const me=bm.fromFeature(h,y);let _e;X===c.az.vertical&&me.verticalizePunctuation();let Se=me.determineLineBreaks(z,S,a,m,re);const{processBidirectionalText:Be,processStyledBidirectionalText:Me}=Uc;if(Be&&me.sections.length===1){_e=[],Se=Se.map((_t=>me.toCodeUnitIndex(_t)));const qe=Be(me.toString(),Se);for(const _t of qe){const Vt=[..._t].map((()=>0));_e.push(new bm(_t,me.sections,Vt))}}else if(Me){_e=[],Se=Se.map((Rt=>me.toCodeUnitIndex(Rt)));let qe=0;const _t=[];for(const Rt of me.text)_t.push(...Array(Rt.length).fill(me.sectionIndex[qe])),qe++;const Vt=Me(me.text,_t,Se);for(const Rt of Vt){const Ht=[];let ni="";for(const Yt of Rt[0])Ht.push(Rt[1][ni.length]),ni+=Yt;_e.push(new bm(Rt[0],me.sections,Ht))}}else _e=(function(qe,_t){const Vt=[];let Rt=0;for(const Ht of _t)Vt.push(qe.substring(Rt,Ht)),Rt=Ht;return Rt<qe.length()&&Vt.push(qe.substring(Rt,qe.length())),Vt})(me,Se);const Ae=[],Ve={positionedLines:Ae,text:me.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:X,iconsInText:!1,verticalizable:!1};return(function(qe,_t,Vt,Rt,Ht,ni,Yt,Ft,St,fi,hi,_i){let ci=0,Ci=0,wn=0,un=0;const wr=Ft==="right"?1:Ft==="left"?0:.5,eo=As/_i;let hs=0;for(const In of Ht){In.trim();const Nr=In.getMaxScale(),Xr={positionedGlyphs:[],lineOffset:0};qe.positionedLines[hs]=Xr;const or=Xr.positionedGlyphs;let Wo=0;if(!In.length()){Ci+=ni,++hs;continue}const to=uN(Rt,In,eo);let Zo=0;for(const Ls of In.text){const Lr=In.getSection(Zo),ds=Ls.codePointAt(0),$r=hN(St,hi,ds),Rs={glyph:ds,imageName:null,x:ci,y:Ci+-17,vertical:$r,scale:1,fontStack:"",sectionIndex:In.getSectionIndex(Zo),metrics:null,rect:null};let Xu;if("fontStack"in Lr){if(Xu=dN(Lr,ds,$r,to,_t,Vt),!Xu)continue;Rs.fontStack=Lr.fontStack}else{if(qe.iconsInText=!0,Lr.scale*=eo,Xu=fN(Lr,$r,Nr,to,Rt),!Xu)continue;Wo=Math.max(Wo,Xu.imageOffset),Rs.imageName=Lr.imageName}const{rect:ac,metrics:rv,baselineOffset:od}=Xu;Rs.y+=od,Rs.scale=Lr.scale,Rs.metrics=rv,Rs.rect=ac,or.push(Rs),$r?(qe.verticalizable=!0,ci+=("imageName"in Lr?rv.advance:As)*Lr.scale+fi):ci+=rv.advance*Lr.scale+fi,Zo++}or.length!==0&&(wn=Math.max(ci-fi,wn),pN(or,0,or.length-1,wr)),ci=0,Xr.lineOffset=Math.max(Wo,(Nr-1)*As);const wl=ni*Nr+Wo;Ci+=wl,un=Math.max(wl,un),++hs}const{horizontalAlign:Sr,verticalAlign:mr}=C1(Yt);(function(In,Nr,Xr,or,Wo,to,Zo,wl,Ls){const Lr=(Nr-Xr)*Wo;let ds=0;ds=to!==Zo?-wl*or- -17:-or*Ls*Zo+.5*Zo;for(const $r of In)for(const Rs of $r.positionedGlyphs)Rs.x+=Lr,Rs.y+=ds})(qe.positionedLines,wr,Sr,mr,wn,un,ni,Ci,Ht.length),qe.top+=-mr*Ci,qe.bottom=qe.top+Ci,qe.left+=-Sr*wn,qe.right=qe.left+wn})(Ve,a,u,m,_e,T,A,D,X,z,ie,he),!(function(qe){for(const _t of qe)if(_t.positionedGlyphs.length!==0)return!1;return!0})(Ae)&&Ve}function C1(h){let a=.5,u=.5;switch(h){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function uN(h,a,u){const m=a.getMaxScale()*As,{maxImageWidth:y,maxImageHeight:S}=a.getMaxImageSize(h),T=Math.max(m,S*u);return{verticalLineContentWidth:Math.max(m,y*u),horizontalLineContentHeight:T}}function uE(h){switch(h){case"top":return 0;case"center":return .5;default:return 1}}function hN(h,a,u){return!(h===c.az.horizontal||!a&&!C_(u)||a&&(C0(u)||(m=u,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(m)))));var m}function dN(h,a,u,m,y,S){const T=S[h.fontStack],A=(function(z,V,X,ie){if(z&&z.rect)return z;const re=V[X.fontStack],he=re&&re[ie];return he?{rect:null,metrics:he.metrics}:null})(T&&T[a],y,h,a);if(A===null)return null;let D;if(u)D=m.verticalLineContentWidth-h.scale*As;else{const z=uE(h.verticalAlign);D=(m.horizontalLineContentHeight-h.scale*As)*z}return{rect:A.rect,metrics:A.metrics,baselineOffset:D}}function fN(h,a,u,m,y){const S=y[h.imageName];if(!S)return null;const T=S.paddedRect,A=S.displaySize,D={width:A[0],height:A[1],left:1,top:-3,advance:a?A[1]:A[0]};let z;if(a)z=m.verticalLineContentWidth-A[1]*h.scale;else{const V=uE(h.verticalAlign);z=(m.horizontalLineContentHeight-A[1]*h.scale)*V}return{rect:T,metrics:D,baselineOffset:z,imageOffset:(a?A[0]:A[1])*h.scale-As*u}}function pN(h,a,u,m){if(m===0)return;const y=h[u],S=(h[u].x+y.metrics.advance*y.scale)*m;for(let T=a;T<=u;T++)h[T].x-=S}function mN(h,a,u){const{horizontalAlign:m,verticalAlign:y}=C1(u),S=a[0]-h.displaySize[0]*m,T=a[1]-h.displaySize[1]*y;return{image:h,top:T,bottom:T+h.displaySize[1],left:S,right:S+h.displaySize[0]}}function hE(h){var a,u;let m=h.left,y=h.top,S=h.right-m,T=h.bottom-y;const A=(a=h.image.textFitWidth)!==null&&a!==void 0?a:"stretchOrShrink",D=(u=h.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",z=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(D==="proportional"){if(A==="stretchOnly"&&S/T<z||A==="proportional"){const V=Math.ceil(T*z);m*=V/S,S=V}}else if(A==="proportional"&&D==="stretchOnly"&&z!==0&&S/T>z){const V=Math.ceil(S/z);y*=V/T,T=V}return{x1:m,y1:y,x2:m+S,y2:y+T}}function dE(h,a,u,m,y,S){const T=h.image;let A;if(T.content){const _e=T.content,Se=T.pixelRatio||1;A=[_e[0]/Se,_e[1]/Se,T.displaySize[0]-_e[2]/Se,T.displaySize[1]-_e[3]/Se]}const D=a.left*S,z=a.right*S;let V,X,ie,re;u==="width"||u==="both"?(re=y[0]+D-m[3],X=y[0]+z+m[1]):(re=y[0]+(D+z-T.displaySize[0])/2,X=re+T.displaySize[0]);const he=a.top*S,me=a.bottom*S;return u==="height"||u==="both"?(V=y[1]+he-m[0],ie=y[1]+me+m[2]):(V=y[1]+(he+me-T.displaySize[1])/2,ie=V+T.displaySize[1]),{image:T,top:V,right:X,bottom:ie,left:re,collisionPadding:A}}mi("ImagePosition",M1),mi("ImageAtlas",cE),c.az=void 0,(td=c.az||(c.az={}))[td.none=0]="none",td[td.horizontal=1]="horizontal",td[td.vertical=2]="vertical",td[td.horizontalOnly=3]="horizontalOnly";const Wu=128,id=32640;function fE(h,a){const{expression:u}=a;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Gn(h+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:y}=u;let S=0;for(;S<m.length&&m[S]<=h;)S++;S=Math.max(0,S-1);let T=S;for(;T<m.length&&m[T]<h+1;)T++;T=Math.min(m.length-1,T);const A=m[S],D=m[T];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:A,maxZoom:D,minSize:u.evaluate(new Gn(A)),maxSize:u.evaluate(new Gn(D)),interpolationType:y}}}function E1(h,a,u){let m="never";const y=h.get(a);return y?m=y:h.get(u)&&(m="always"),m}const gN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function W0(h,a,u,m,y,S,T,A,D,z,V,X,ie){const re=A?Math.min(id,Math.round(A[0])):0,he=A?Math.min(id,Math.round(A[1])):0;h.emplaceBack(a,u,Math.round(32*m),Math.round(32*y),S,T,(re<<1)+(D?1:0),he,16*z,16*V,256*X,256*ie)}function A1(h,a,u){h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u),h.emplaceBack(a.x,a.y,u)}function _N(h){for(const a of h.sections)if(P0(a.text))return!0;return!1}class P1{constructor(a){this.layoutVertexArray=new je,this.indexArray=new wt,this.programConfigurations=a,this.segments=new si,this.dynamicLayoutVertexArray=new at,this.opacityVertexArray=new Tt,this.hasVisibleVertices=!1,this.placedSymbolArray=new R}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,u,m,y){this.isEmpty()||(m&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,GB.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,qB.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,gN,!0),this.opacityVertexBuffer.itemSize=1),(m||y)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}mi("SymbolBuffers",P1);class I1{constructor(a,u,m){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new m,this.segments=new si,this.collisionVertexArray=new xt}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,HB.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}mi("CollisionBuffers",I1);class wm{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((T=>T.id)),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fE(this.zoom,u["text-size"]),this.iconSizeData=fE(this.zoom,u["icon-size"]);const m=this.layers[0].layout,y=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.canOverlap=E1(m,"text-overlap","text-allow-overlap")!=="never"||E1(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map((T=>c.az[T]))),this.stateDependentLayerIds=this.layers.filter((T=>T.isStateDependent())).map((T=>T.id)),this.sourceID=a.sourceID}createArrays(){this.text=new P1(new Hu(this.layers,this.zoom,(a=>/^text/.test(a)))),this.icon=new P1(new Hu(this.layers,this.zoom,(a=>/^icon/.test(a)))),this.glyphOffsetArray=new W,this.lineVertexArray=new K,this.symbolInstances=new $,this.textAnchorOffsets=new oe}calculateGlyphDependencies(a,u,m,y,S){for(const T of a)if(u[T.codePointAt(0)]=!0,(m||y)&&S){const A=K_[T];A&&(u[A.codePointAt(0)]=!0)}}populate(a,u,m){const y=this.layers[0],S=y.layout,T=S.get("text-font"),A=S.get("text-field"),D=S.get("icon-image"),z=(A.value.kind!=="constant"||A.value.value instanceof Bs&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),V=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,X=S.get("symbol-sort-key");if(this.features=[],!z&&!V)return;const ie=u.iconDependencies,re=u.glyphDependencies,he=u.availableImages,me=new Gn(this.zoom);for(const{feature:_e,id:Se,index:Be,sourceLayerIndex:Me}of a){const Ae=y._featureFilter.needGeometry,Ve=Hc(_e,Ae);if(!y._featureFilter.filter(me,Ve,m))continue;let qe,_t;if(Ae||(Ve.geometry=qc(_e)),z){const Rt=y.getValueAndResolveTokens("text-field",Ve,m,he),Ht=Bs.factory(Rt),ni=this.hasRTLText=this.hasRTLText||_N(Ht);(!ni||Uc.getRTLTextPluginStatus()==="unavailable"||ni&&Uc.isParsed())&&(qe=ZB(Ht,y,Ve))}if(V){const Rt=y.getValueAndResolveTokens("icon-image",Ve,m,he);_t=Rt instanceof oo?Rt:oo.fromString(Rt)}if(!qe&&!_t)continue;const Vt=this.sortFeaturesByKey?X.evaluate(Ve,{},m):void 0;if(this.features.push({id:Se,text:qe,icon:_t,index:Be,sourceLayerIndex:Me,geometry:Ve.geometry,properties:_e.properties,type:Z_.types[_e.type],sortKey:Vt}),_t&&(ie[_t.name]=!0),qe){const Rt=T.evaluate(Ve,{},m).join(","),Ht=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.az.vertical)>=0;for(const ni of qe.sections)if(ni.image)ie[ni.image.name]=!0;else{const Yt=Qh(qe.toString()),Ft=ni.fontStack||Rt,St=re[Ft]=re[Ft]||{};this.calculateGlyphDependencies(ni.text,St,Ht,this.allowVerticalPlacement,Yt)}}}S.get("symbol-placement")==="line"&&(this.features=(function(_e){const Se={},Be={},Me=[];let Ae=0;function Ve(Rt){Me.push(_e[Rt]),Ae++}function qe(Rt,Ht,ni){const Yt=Be[Rt];return delete Be[Rt],Be[Ht]=Yt,Me[Yt].geometry[0].pop(),Me[Yt].geometry[0]=Me[Yt].geometry[0].concat(ni[0]),Yt}function _t(Rt,Ht,ni){const Yt=Se[Ht];return delete Se[Ht],Se[Rt]=Yt,Me[Yt].geometry[0].shift(),Me[Yt].geometry[0]=ni[0].concat(Me[Yt].geometry[0]),Yt}function Vt(Rt,Ht,ni){const Yt=ni?Ht[0][Ht[0].length-1]:Ht[0][0];return`${Rt}:${Yt.x}:${Yt.y}`}for(let Rt=0;Rt<_e.length;Rt++){const Ht=_e[Rt],ni=Ht.geometry,Yt=Ht.text?Ht.text.toString():null;if(!Yt){Ve(Rt);continue}const Ft=Vt(Yt,ni),St=Vt(Yt,ni,!0);if(Ft in Be&&St in Se&&Be[Ft]!==Se[St]){const fi=_t(Ft,St,ni),hi=qe(Ft,St,Me[fi].geometry);delete Se[Ft],delete Be[St],Be[Vt(Yt,Me[hi].geometry,!0)]=hi,Me[fi].geometry=null}else Ft in Be?qe(Ft,St,ni):St in Se?_t(Ft,St,ni):(Ve(Rt),Se[Ft]=Ae-1,Be[St]=Ae-1)}return Me.filter((Rt=>Rt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((_e,Se)=>_e.sortKey-Se.sortKey))}update(a,u,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,{imagePositions:m}),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,{imagePositions:m}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,u){const m=this.lineVertexArray.length;if(a.segment!==void 0){let y=a.dist(u[a.segment+1]),S=a.dist(u[a.segment]);const T={};for(let A=a.segment+1;A<u.length;A++)T[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:y},A<u.length-1&&(y+=u[A+1].dist(u[A]));for(let A=a.segment||0;A>=0;A--)T[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:S},A>0&&(S+=u[A-1].dist(u[A]));for(let A=0;A<u.length;A++){const D=T[A];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(a,u,m,y,S,T,A,D,z,V,X,ie){const re=a.indexArray,he=a.layoutVertexArray,me=a.segments.prepareSegment(4*u.length,he,re,this.canOverlap?T.sortKey:void 0),_e=this.glyphOffsetArray.length,Se=me.vertexLength,Be=this.allowVerticalPlacement&&A===c.az.vertical?Math.PI/2:0,Me=T.text&&T.text.sections;for(let Ae=0;Ae<u.length;Ae++){const{tl:Ve,tr:qe,bl:_t,br:Vt,tex:Rt,pixelOffsetTL:Ht,pixelOffsetBR:ni,minFontScaleX:Yt,minFontScaleY:Ft,glyphOffset:St,isSDF:fi,sectionIndex:hi}=u[Ae],_i=me.vertexLength,ci=St[1];W0(he,D.x,D.y,Ve.x,ci+Ve.y,Rt.x,Rt.y,m,fi,Ht.x,Ht.y,Yt,Ft),W0(he,D.x,D.y,qe.x,ci+qe.y,Rt.x+Rt.w,Rt.y,m,fi,ni.x,Ht.y,Yt,Ft),W0(he,D.x,D.y,_t.x,ci+_t.y,Rt.x,Rt.y+Rt.h,m,fi,Ht.x,ni.y,Yt,Ft),W0(he,D.x,D.y,Vt.x,ci+Vt.y,Rt.x+Rt.w,Rt.y+Rt.h,m,fi,ni.x,ni.y,Yt,Ft),A1(a.dynamicLayoutVertexArray,D,Be),re.emplaceBack(_i,_i+2,_i+1),re.emplaceBack(_i+1,_i+2,_i+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Ae!==u.length-1&&hi===u[Ae+1].sectionIndex||a.programConfigurations.populatePaintArrays(he.length,T,T.index,{imagePositions:{},canonical:ie,formattedSection:Me&&Me[hi]})}a.placedSymbolArray.emplaceBack(D.x,D.y,_e,this.glyphOffsetArray.length-_e,Se,z,V,D.segment,m?m[0]:0,m?m[1]:0,y[0],y[1],A,0,!1,0,X)}_addCollisionDebugVertex(a,u,m,y,S,T){return u.emplaceBack(0,0),a.emplaceBack(m.x,m.y,y,S,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(a,u,m,y,S,T,A){const D=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),z=D.vertexLength,V=S.layoutVertexArray,X=S.collisionVertexArray,ie=A.anchorX,re=A.anchorY;this._addCollisionDebugVertex(V,X,T,ie,re,new f(a,u)),this._addCollisionDebugVertex(V,X,T,ie,re,new f(m,u)),this._addCollisionDebugVertex(V,X,T,ie,re,new f(m,y)),this._addCollisionDebugVertex(V,X,T,ie,re,new f(a,y)),D.vertexLength+=4;const he=S.indexArray;he.emplaceBack(z,z+1),he.emplaceBack(z+1,z+2),he.emplaceBack(z+2,z+3),he.emplaceBack(z+3,z),D.primitiveLength+=4}addDebugCollisionBoxes(a,u,m,y){for(let S=a;S<u;S++){const T=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,y?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new I1(vt,eE.members,Qt),this.iconCollisionBox=new I1(vt,eE.members,Qt);for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(a,u,m,y,S,T,A,D,z){const V={};for(let X=u;X<m;X++){const ie=a.get(X);V.textBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},V.textFeatureIndex=ie.featureIndex;break}for(let X=y;X<S;X++){const ie=a.get(X);V.verticalTextBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},V.verticalTextFeatureIndex=ie.featureIndex;break}for(let X=T;X<A;X++){const ie=a.get(X);V.iconBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},V.iconFeatureIndex=ie.featureIndex;break}for(let X=D;X<z;X++){const ie=a.get(X);V.verticalIconBox={x1:ie.x1,y1:ie.y1,x2:ie.x2,y2:ie.y2,anchorPointX:ie.anchorPointX,anchorPointY:ie.anchorPointY},V.verticalIconFeatureIndex=ie.featureIndex;break}return V}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,u){const m=a.placedSymbolArray.get(u),y=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<y;S+=4)a.indexArray.emplaceBack(S,S+2,S+1),a.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(a),m=Math.cos(a),y=[],S=[],T=[];for(let A=0;A<this.symbolInstances.length;++A){T.push(A);const D=this.symbolInstances.get(A);y.push(0|Math.round(u*D.anchorX+m*D.anchorY)),S.push(D.featureIndex)}return T.sort(((A,D)=>y[A]-y[D]||S[D]-S[A])),T}addToSortKeyRanges(a,u){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===u?m.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const m=this.symbolInstances.get(u);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(((y,S,T)=>{y>=0&&T.indexOf(y)===S&&this.addIndicesForPlacedSymbol(this.text,y)})),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let pE,mE;mi("SymbolBucket",wm,{omit:["layers","collisionBoxArray","features","compareText"]}),wm.MAX_GLYPHS=65535,wm.addDynamicAttributes=A1;var L1={get paint(){return mE=mE||new lo({"icon-opacity":new Fi(gt.paint_symbol["icon-opacity"]),"icon-color":new Fi(gt.paint_symbol["icon-color"]),"icon-halo-color":new Fi(gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fi(gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fi(gt.paint_symbol["icon-halo-blur"]),"icon-translate":new Mi(gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mi(gt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fi(gt.paint_symbol["text-opacity"]),"text-color":new Fi(gt.paint_symbol["text-color"],{runtimeType:Hi,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Fi(gt.paint_symbol["text-halo-color"]),"text-halo-width":new Fi(gt.paint_symbol["text-halo-width"]),"text-halo-blur":new Fi(gt.paint_symbol["text-halo-blur"]),"text-translate":new Mi(gt.paint_symbol["text-translate"]),"text-translate-anchor":new Mi(gt.paint_symbol["text-translate-anchor"])})},get layout(){return pE=pE||new lo({"symbol-placement":new Mi(gt.layout_symbol["symbol-placement"]),"symbol-spacing":new Mi(gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mi(gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fi(gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mi(gt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Mi(gt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Mi(gt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Mi(gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mi(gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mi(gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fi(gt.layout_symbol["icon-size"]),"icon-text-fit":new Mi(gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mi(gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fi(gt.layout_symbol["icon-image"]),"icon-rotate":new Fi(gt.layout_symbol["icon-rotate"]),"icon-padding":new Fi(gt.layout_symbol["icon-padding"]),"icon-keep-upright":new Mi(gt.layout_symbol["icon-keep-upright"]),"icon-offset":new Fi(gt.layout_symbol["icon-offset"]),"icon-anchor":new Fi(gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mi(gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mi(gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mi(gt.layout_symbol["text-rotation-alignment"]),"text-field":new Fi(gt.layout_symbol["text-field"]),"text-font":new Fi(gt.layout_symbol["text-font"]),"text-size":new Fi(gt.layout_symbol["text-size"]),"text-max-width":new Fi(gt.layout_symbol["text-max-width"]),"text-line-height":new Mi(gt.layout_symbol["text-line-height"]),"text-letter-spacing":new Fi(gt.layout_symbol["text-letter-spacing"]),"text-justify":new Fi(gt.layout_symbol["text-justify"]),"text-radial-offset":new Fi(gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mi(gt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Fi(gt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Fi(gt.layout_symbol["text-anchor"]),"text-max-angle":new Mi(gt.layout_symbol["text-max-angle"]),"text-writing-mode":new Mi(gt.layout_symbol["text-writing-mode"]),"text-rotate":new Fi(gt.layout_symbol["text-rotate"]),"text-padding":new Mi(gt.layout_symbol["text-padding"]),"text-keep-upright":new Mi(gt.layout_symbol["text-keep-upright"]),"text-transform":new Fi(gt.layout_symbol["text-transform"]),"text-offset":new Fi(gt.layout_symbol["text-offset"]),"text-allow-overlap":new Mi(gt.layout_symbol["text-allow-overlap"]),"text-overlap":new Mi(gt.layout_symbol["text-overlap"]),"text-ignore-placement":new Mi(gt.layout_symbol["text-ignore-placement"]),"text-optional":new Mi(gt.layout_symbol["text-optional"])})}};class gE{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Ii,this.defaultValue=a}evaluate(a){if(a.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mi("FormatSectionOverride",gE,{omit:["defaultValue"]});class Z0 extends ua{constructor(a,u){super(a,L1,u)}recalculate(a,u){if(super.recalculate(a,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const y=[];for(const S of m)y.indexOf(S)<0&&y.push(S);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,u,m,y){const S=this.layout.get(a).evaluate(u,{},m,y),T=this._unevaluatedLayout._values[a];return T.isDataDriven()||zc(T.value)||!S?S:(function(A,D){return D.replace(/{([^{}]+)}/g,((z,V)=>A&&V in A?String(A[V]):""))})(u.properties,S)}createBucket(a){return new wm(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of L1.paint.overridableProperties){if(!Z0.hasPaintOverride(this.layout,a))continue;const u=this.paint.get(a),m=new gE(u),y=new ka(m,u.property.specification);let S=null;S=u.value.kind==="constant"||u.value.kind==="source"?new Wp("source",y):new m_("composite",y,u.value.zoomStops),this.paint._values[a]=new za(u.property,S,u.parameters)}}_handleOverridablePaintPropertyUpdate(a,u,m){return!(!this.layout||u.isDataDriven()||m.isDataDriven())&&Z0.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,u){const m=a.get("text-field"),y=L1.paint.properties[u];let S=!1;const T=A=>{for(const D of A)if(y.overrides&&y.overrides.hasOverride(D))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Bs)T(m.value.value.sections);else if(m.value.kind==="source"||m.value.kind==="composite"){const A=z=>{S||(z instanceof No&&Pr(z.value)===Kn?T(z.value.sections):z instanceof Ca?T(z.sections):z.eachChild(A))},D=m.value;D._styleExpression&&A(D._styleExpression.expression)}return S}}let _E;var vN={get paint(){return _E=_E||new lo({"background-color":new Mi(gt.paint_background["background-color"]),"background-pattern":new sm(gt.paint_background["background-pattern"]),"background-opacity":new Mi(gt.paint_background["background-opacity"])})}};class yN extends ua{constructor(a,u){super(a,vN,u)}}class bN extends ua{constructor(a,u){super(a,{},u),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class xN{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const wN={once:!0},R1=63710088e-1;class nd{constructor(a,u){if(isNaN(a)||isNaN(u))throw new Error(`Invalid LngLat object: (${a}, ${u})`);if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new nd(zt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const u=Math.PI/180,m=this.lat*u,y=a.lat*u,S=Math.sin(m)*Math.sin(y)+Math.cos(m)*Math.cos(y)*Math.cos((a.lng-this.lng)*u);return R1*Math.acos(Math.min(S,1))}static convert(a){if(a instanceof nd)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new nd(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new nd(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vE=2*Math.PI*R1;function yE(h){return vE*Math.cos(h*Math.PI/180)}function bE(h){return(180+h)/360}function xE(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function wE(h,a){return h/yE(a)}function SE(h){return 360*h-180}function X0(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function TE(h,a){return h*yE(X0(a))}class J_{constructor(a,u,m=0){this.x=+a,this.y=+u,this.z=+m}static fromLngLat(a,u=0){const m=nd.convert(a);return new J_(bE(m.lng),xE(m.lat),wE(u,m.lat))}toLngLat(){return new nd(SE(this.x),X0(this.y))}toAltitude(){return TE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vE*(a=X0(this.y),1/Math.cos(a*Math.PI/180));var a}}function ME(h,a,u){var m=2*Math.PI*6378137/256/Math.pow(2,u);return[h*m-2*Math.PI*6378137/2,a*m-2*Math.PI*6378137/2]}class k1{constructor(a,u,m){if(!(function(y,S,T){return!(y<0||y>25||T<0||T>=Math.pow(2,y)||S<0||S>=Math.pow(2,y))})(a,u,m))throw new Error(`x=${u}, y=${m}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=u,this.y=m,this.key=Sm(0,a,a,u,m)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,u,m){const y=(function(T,A,D){var z=ME(256*T,256*(A=Math.pow(2,D)-A-1),D),V=ME(256*(T+1),256*(A+1),D);return z[0]+","+z[1]+","+V[0]+","+V[1]})(this.x,this.y,this.z),S=(function(T,A,D){let z,V="";for(let X=T;X>0;X--)z=1<<X-1,V+=(A&z?1:0)+(D&z?2:0);return V})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,S).replace(/{bbox-epsg-3857}/g,y)}isChildOf(a){const u=this.z-a.z;return u>0&&a.x===this.x>>u&&a.y===this.y>>u}getTilePoint(a){const u=Math.pow(2,this.z);return new f((a.x*u-this.x)*Ce,(a.y*u-this.y)*Ce)}toString(){return`${this.z}/${this.x}/${this.y}`}}class CE{constructor(a,u){this.wrap=a,this.canonical=u,this.key=Sm(a,u.z,u.z,u.x,u.y)}}class $a{constructor(a,u,m,y,S){if(this.terrainRttPosMatrix32f=null,a<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${m}`);this.overscaledZ=a,this.wrap=u,this.canonical=new k1(m,+y,+S),this.key=Sm(u,a,m,y,S)}clone(){return new $a(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-a;return a>this.canonical.z?new $a(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $a(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(a,u){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-a;return a>this.canonical.z?Sm(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):Sm(this.wrap*+u,a,a,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(a){if(a.wrap!==this.wrap||this.overscaledZ-a.overscaledZ<=0)return!1;if(a.overscaledZ===0)return this.overscaledZ>0;const u=this.canonical.z-a.canonical.z;return!(u<0)&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u}children(a){if(this.overscaledZ>=a)return[new $a(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,m=2*this.canonical.x,y=2*this.canonical.y;return[new $a(u,this.wrap,u,m,y),new $a(u,this.wrap,u,m+1,y),new $a(u,this.wrap,u,m,y+1),new $a(u,this.wrap,u,m+1,y+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new $a(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new $a(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new CE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new J_(a.x-this.wrap,a.y))}}function Sm(h,a,u,m,y){(h*=2)<0&&(h=-1*h-1);const S=1<<u;return(S*S*h+S*y+m).toString(36)+u.toString(36)+a.toString(36)}function D1(h,a){return a?h.properties[a]:h.id}function SN(h,a){const u={id:h.id};if(a.removeAllProperties&&(delete h.removeProperties,delete h.addOrUpdateProperties,delete a.removeProperties),a.removeProperties)for(const m of a.removeProperties){const y=h.addOrUpdateProperties.findIndex((S=>S.key===m));y>-1&&h.addOrUpdateProperties.splice(y,1)}return(h.removeAllProperties||a.removeAllProperties)&&(u.removeAllProperties=!0),(h.removeProperties||a.removeProperties)&&(u.removeProperties=[...h.removeProperties||[],...a.removeProperties||[]]),(h.addOrUpdateProperties||a.addOrUpdateProperties)&&(u.addOrUpdateProperties=[...h.addOrUpdateProperties||[],...a.addOrUpdateProperties||[]]),(h.newGeometry||a.newGeometry)&&(u.newGeometry=a.newGeometry||h.newGeometry),u}function EE(h){var a,u;if(!h)return{};const m={};return m.removeAll=h.removeAll,m.remove=new Set(h.remove||[]),m.add=new Map((a=h.add)===null||a===void 0?void 0:a.map((y=>[y.id,y]))),m.update=new Map((u=h.update)===null||u===void 0?void 0:u.map((y=>[y.id,y]))),m}mi("CanonicalTileID",k1),mi("OverscaledTileID",$a,{omit:["terrainRttPosMatrix32f"]});class Lf{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(a){return this.minX=Math.min(this.minX,a.x),this.minY=Math.min(this.minY,a.y),this.maxX=Math.max(this.maxX,a.x),this.maxY=Math.max(this.maxY,a.y),this}expandBy(a){return this.minX-=a,this.minY-=a,this.maxX+=a,this.maxY+=a,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(a){return this.expandBy(-a)}map(a){const u=new Lf;return u.extend(a(new f(this.minX,this.minY))),u.extend(a(new f(this.maxX,this.minY))),u.extend(a(new f(this.minX,this.maxY))),u.extend(a(new f(this.maxX,this.maxY))),u}static fromPoints(a){const u=new Lf;for(const m of a)u.extend(m);return u}contains(a){return a.x>=this.minX&&a.x<=this.maxX&&a.y>=this.minY&&a.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(a){return!this.empty()&&!a.empty()&&a.minX>=this.minX&&a.maxX<=this.maxX&&a.minY>=this.minY&&a.maxY<=this.maxY}intersects(a){return!this.empty()&&!a.empty()&&a.minX<=this.maxX&&a.maxX>=this.minX&&a.minY<=this.maxY&&a.maxY>=this.minY}}class AE{constructor(a){this._stringToNumber={},this._numberToString=[];for(let u=0;u<a.length;u++){const m=a[u];this._stringToNumber[m]=u,this._numberToString[u]=m}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class PE{constructor(a,u,m,y,S){this.type="Feature",this._vectorTileFeature=a,this._x=m,this._y=y,this._z=u,this.properties=a.properties,this.id=S}projectPoint(a,u,m,y){return[360*(a.x+u)/y-180,360/Math.PI*Math.atan(Math.exp((1-2*(a.y+m)/y)*Math.PI))-90]}projectLine(a,u,m,y){return a.map((S=>this.projectPoint(S,u,m,y)))}get geometry(){if(this._geometry)return this._geometry;const a=this._vectorTileFeature,u=a.extent*Math.pow(2,this._z),m=a.extent*this._x,y=a.extent*this._y,S=a.loadGeometry();switch(a.type){case 1:{const T=[];for(const D of S)T.push(D[0]);const A=this.projectLine(T,m,y,u);this._geometry=T.length===1?{type:"Point",coordinates:A[0]}:{type:"MultiPoint",coordinates:A};break}case 2:{const T=S.map((A=>this.projectLine(A,m,y,u)));this._geometry=T.length===1?{type:"LineString",coordinates:T[0]}:{type:"MultiLineString",coordinates:T};break}case 3:{const T=GC(S),A=[];for(const D of T)A.push(D.map((z=>this.projectLine(z,m,y,u))));this._geometry=A.length===1?{type:"Polygon",coordinates:A[0]}:{type:"MultiPolygon",coordinates:A};break}default:throw new Error(`unknown feature type: ${a.type}`)}return this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&u!=="_x"&&u!=="_y"&&u!=="_z"&&(a[u]=this[u]);return a}}class Tm{_name;dataBuffer;nullabilityBuffer;_size;constructor(a,u,m){this._name=a,this.dataBuffer=u,typeof m=="number"?this._size=m:(this.nullabilityBuffer=m,this._size=m.size())}getValue(a){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(a)?null:this.getValueFromBuffer(a)}has(a){return this.nullabilityBuffer&&this.nullabilityBuffer.get(a)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Y0 extends Tm{}class F1 extends Y0{getValueFromBuffer(a){return this.dataBuffer[a]}}class O1 extends Y0{getValueFromBuffer(a){return this.dataBuffer[a]}}class IE extends Tm{delta;constructor(a,u,m,y){super(a,u,y),this.delta=m}}class z1 extends IE{constructor(a,u,m,y){super(a,Int32Array.of(u),m,y)}getValueFromBuffer(a){return this.dataBuffer[0]+a*this.delta}}class B1 extends Tm{constructor(a,u,m){super(a,Int32Array.of(u),m)}getValueFromBuffer(a){return this.dataBuffer[0]}}class TN{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(a,u,m,y,S=4096){this._name=a,this._geometryVector=u,this._idVector=m,this._propertyVectors=y,this._extent=S}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(a){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((u=>[u.name,u])))),this.propertyVectorsMap.get(a)}*[Symbol.iterator](){const a=this.geometryVector[Symbol.iterator]();let u=0;for(;u<this.numFeatures;){let m;this.idVector&&(m=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(u)):this.idVector.getValue(u));const y=a?.next().value,S={};for(const T of this.propertyVectors){if(!T)continue;const A=T.name,D=T.getValue(u);D!==null&&(S[A]=D)}u++,yield{id:m,geometry:y,properties:S}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const a=[],u=this.geometryVector.getGeometries();for(let m=0;m<this.numFeatures;m++){let y;this.idVector&&(y=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(m)):this.idVector.getValue(m));const S={coordinates:u[m],type:this.geometryVector.geometryType(m)},T={};for(const A of this.propertyVectors){if(!A)continue;const D=A.name,z=A.getValue(m);z!==null&&(T[D]=z)}a.push({id:y,geometry:S,properties:T})}return a}containsMaxSaveIntegerValues(a){return a instanceof F1||a instanceof B1&&a instanceof z1||a instanceof O1}}class MN{value;constructor(a){this.value=a}get(){return this.value}set(a){this.value=a}increment(){return this.value++}add(a){this.value+=a}}var mn,Zu,Js,sc,Rf,da,Ps,Is,LE,Va;function Us(h,a,u){const m=new Int32Array(u);let y=0,S=a.get();for(let T=0;T<m.length;T++){let A=h[S++],D=127&A;A<128||(A=h[S++],D|=(127&A)<<7,A<128||(A=h[S++],D|=(127&A)<<14,A<128||(A=h[S++],D|=(127&A)<<21,A<128||(A=h[S++],D|=(15&A)<<28)))),m[y++]=D}return a.set(S),m}function K0(h,a,u){const m=new BigInt64Array(u);for(let y=0;y<m.length;y++)m[y]=EN(h,a);return m}function CN(h,a){let u,m;return m=h[a.get()],a.increment(),u=127&m,m<128?u:(m=h[a.get()],a.increment(),u|=(127&m)<<7,m<128?u:(m=h[a.get()],a.increment(),u|=(127&m)<<14,m<128?u:(m=h[a.get()],a.increment(),u|=(127&m)<<21,m<128?u:(m=h[a.get()],u|=(15&m)<<28,(function(y,S,T){let A,D;if(D=S[T.get()],T.increment(),A=(112&D)>>4,D<128||(D=S[T.get()],T.increment(),A|=(127&D)<<3,D<128)||(D=S[T.get()],T.increment(),A|=(127&D)<<10,D<128)||(D=S[T.get()],T.increment(),A|=(127&D)<<17,D<128)||(D=S[T.get()],T.increment(),A|=(127&D)<<24,D<128)||(D=S[T.get()],T.increment(),A|=(1&D)<<31,D<128))return 4294967296*A+(y>>>0);throw new Error("Expected varint not more than 10 bytes")})(u,h,a)))))}function RE(h,a,u,m){throw new Error("FastPFor is not implemented yet.")}function kf(h){return h>>>1^-(1&h)}function Mm(h){return h>>1n^-(1n&h)}function EN(h,a){let u=0n,m=0,y=a.get();for(;y<h.length;){const S=h[y++];if(u|=BigInt(127&S)<<BigInt(m),!(128&S))break;if(m+=7,m>=64)throw new Error("Varint too long")}return a.set(y),u}function kE(h,a,u){const m=new Int32Array(u);let y=0;for(let S=0;S<a;S++){const T=h[S];m.fill(h[S+a],y,y+T),y+=T}return m}function DE(h,a,u){const m=new BigInt64Array(u);let y=0;for(let S=0;S<a;S++){const T=Number(h[S]);m.fill(h[S+a],y,y+T),y+=T}return m}function FE(h,a,u){const m=new Float64Array(u);let y=0;for(let S=0;S<a;S++){const T=h[S];m.fill(h[S+a],y,y+T),y+=T}return m}function N1(h){const a=h.length/4*4;let u=1;if(a>=4)for(let m=h[0];u<a-4;u+=4)m=h[u]+=m,m=h[u+1]+=m,m=h[u+2]+=m,m=h[u+3]+=m;for(;u!=h.length;)h[u]+=h[u-1],++u}function OE(h){h[0]=h[0]>>>1^-(1&h[0]),h[1]=h[1]>>>1^-(1&h[1]);const a=h.length/4*4;let u=2;if(a>=4)for(;u<a-4;u+=4){const m=h[u],y=h[u+1],S=h[u+2],T=h[u+3];h[u]=(m>>>1^-(1&m))+h[u-2],h[u+1]=(y>>>1^-(1&y))+h[u-1],h[u+2]=(S>>>1^-(1&S))+h[u],h[u+3]=(T>>>1^-(1&T))+h[u+1]}for(;u!=h.length;u+=2)h[u]=(h[u]>>>1^-(1&h[u]))+h[u-2],h[u+1]=(h[u+1]>>>1^-(1&h[u+1]))+h[u-1]}(function(h){h.NONE="NONE",h.DELTA="DELTA",h.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",h.RLE="RLE",h.MORTON="MORTON",h.PDE="PDE"})(mn||(mn={})),(function(h){h.NONE="NONE",h.FAST_PFOR="FAST_PFOR",h.VARINT="VARINT",h.ALP="ALP"})(Zu||(Zu={})),(function(h){h.PRESENT="PRESENT",h.DATA="DATA",h.OFFSET="OFFSET",h.LENGTH="LENGTH"})(Js||(Js={}));class $1{_dictionaryType;_offsetType;_lengthType;constructor(a,u,m){this._dictionaryType=a,this._offsetType=u,this._lengthType=m}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function To(h,a){const u=(function(m,y){const S=m[y.get()],T=Object.values(Js)[S>>4];let A=null;switch(T){case Js.DATA:A=new $1(Object.values(sc)[15&S]);break;case Js.OFFSET:A=new $1(null,Object.values(Rf)[15&S]);break;case Js.LENGTH:A=new $1(null,null,Object.values(da)[15&S])}y.increment();const D=m[y.get()],z=Object.values(mn)[D>>5],V=Object.values(mn)[D>>2&7],X=Object.values(Zu)[3&D];y.increment();const ie=Us(m,y,2),re=ie[0];return{physicalStreamType:T,logicalStreamType:A,logicalLevelTechnique1:z,logicalLevelTechnique2:V,physicalLevelTechnique:X,numValues:re,byteLength:ie[1],decompressedCount:re}})(h,a);return u.logicalLevelTechnique1===mn.MORTON?(function(m,y,S){const T=Us(y,S,2);return{physicalStreamType:m.physicalStreamType,logicalStreamType:m.logicalStreamType,logicalLevelTechnique1:m.logicalLevelTechnique1,logicalLevelTechnique2:m.logicalLevelTechnique2,physicalLevelTechnique:m.physicalLevelTechnique,numValues:m.numValues,byteLength:m.byteLength,decompressedCount:m.decompressedCount,numBits:T[0],coordinateShift:T[1]}})(u,h,a):mn.RLE!==u.logicalLevelTechnique1&&mn.RLE!==u.logicalLevelTechnique2||Zu.NONE===u.physicalLevelTechnique?u:(function(m,y,S){const T=Us(y,S,2);return{physicalStreamType:m.physicalStreamType,logicalStreamType:m.logicalStreamType,logicalLevelTechnique1:m.logicalLevelTechnique1,logicalLevelTechnique2:m.logicalLevelTechnique2,physicalLevelTechnique:m.physicalLevelTechnique,numValues:m.numValues,byteLength:m.byteLength,decompressedCount:T[1],runs:T[0],numRleValues:T[1]}})(u,h,a)}(function(h){h.NONE="NONE",h.SINGLE="SINGLE",h.SHARED="SHARED",h.VERTEX="VERTEX",h.MORTON="MORTON",h.FSST="FSST"})(sc||(sc={})),(function(h){h.VERTEX="VERTEX",h.INDEX="INDEX",h.STRING="STRING",h.KEY="KEY"})(Rf||(Rf={})),(function(h){h.VAR_BINARY="VAR_BINARY",h.GEOMETRIES="GEOMETRIES",h.PARTS="PARTS",h.RINGS="RINGS",h.TRIANGLES="TRIANGLES",h.SYMBOL="SYMBOL",h.DICTIONARY="DICTIONARY"})(da||(da={})),(function(h){h[h.FLAT=0]="FLAT",h[h.CONST=1]="CONST",h[h.SEQUENCE=2]="SEQUENCE",h[h.DICTIONARY=3]="DICTIONARY",h[h.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Ps||(Ps={}));class oc{values;_size;constructor(a,u){this.values=a,this._size=u}get(a){const u=Math.floor(a/8);return(this.values[u]>>a%8&1)==1}set(a,u){const m=Math.floor(a/8);this.values[m]=this.values[m]|(u?1:0)<<a%8}getInt(a){const u=Math.floor(a/8);return this.values[u]>>a%8&1}size(){return this._size}getBuffer(){return this.values}}function Mo(h,a,u,m,y){return(function(S,T,A){switch(T.logicalLevelTechnique1){case mn.DELTA:return T.logicalLevelTechnique2===mn.RLE?(function(D,z,V){const X=new Int32Array(V);let ie=0,re=0;for(let he=0;he<z;he++){const me=D[he],_e=kf(D[he+z]);for(let Se=0;Se<me;Se++)re+=_e,X[ie++]=re}return X})(S,T.runs,T.numRleValues):((function(D){D[0]=D[0]>>>1^-(1&D[0]);const z=D.length/4*4;let V=1;if(z>=4)for(;V<z-4;V+=4){const X=D[V],ie=D[V+1],re=D[V+2],he=D[V+3];D[V]=(X>>>1^-(1&X))+D[V-1],D[V+1]=(ie>>>1^-(1&ie))+D[V],D[V+2]=(re>>>1^-(1&re))+D[V+1],D[V+3]=(he>>>1^-(1&he))+D[V+2]}for(;V!=D.length;++V)D[V]=(D[V]>>>1^-(1&D[V]))+D[V-1]})(S),S);case mn.RLE:return(function(D,z,V){return V?(function(X,ie,re){const he=new Int32Array(re);let me=0;for(let _e=0;_e<ie;_e++){const Se=X[_e];let Be=X[_e+ie];Be=Be>>>1^-(1&Be),he.fill(Be,me,me+Se),me+=Se}return he})(D,z.runs,z.numRleValues):kE(D,z.runs,z.numRleValues)})(S,T,A);case mn.MORTON:return N1(S),S;case mn.COMPONENTWISE_DELTA:return OE(S),S;case mn.NONE:return A&&(function(D){for(let z=0;z<D.length;z++){const V=D[z];D[z]=V>>>1^-(1&V)}})(S),S;default:throw new Error(`The specified Logical level technique is not supported: ${T.logicalLevelTechnique1}`)}})(J0(h,a,u),u,m)}function rd(h,a,u){return(function(m,y){if(y.logicalLevelTechnique1===mn.DELTA&&y.logicalLevelTechnique2===mn.NONE)return(function(T){const A=new Int32Array(T.length+1);A[0]=0,A[1]=kf(T[0]);let D=A[1],z=2;for(;z!=A.length;++z){const V=T[z-1];D+=V>>>1^-(1&V),A[z]=A[z-1]+D}return A})(m);if(y.logicalLevelTechnique1===mn.RLE&&y.logicalLevelTechnique2===mn.NONE)return(function(T,A,D){const z=new Int32Array(D+1);z[0]=0;let V=1,X=z[0];for(let ie=0;ie<A;ie++){const re=T[ie],he=T[ie+A];for(let me=V;me<V+re;me++)z[me]=he+X,X=z[me];V+=re}return z})(m,y.runs,y.numRleValues);if(y.logicalLevelTechnique1===mn.NONE&&y.logicalLevelTechnique2===mn.NONE){(function(T){let A=0;for(let D=0;D<T.length;D++)T[D]+=A,A=T[D]})(m);const S=new Int32Array(y.numValues+1);return S[0]=0,S.set(m,1),S}if(y.logicalLevelTechnique1===mn.DELTA&&y.logicalLevelTechnique2===mn.RLE){const S=(function(T,A,D){const z=new Int32Array(D+1);z[0]=0;let V=1,X=z[0];for(let ie=0;ie<A;ie++){const re=T[ie];let he=T[ie+A];he=he>>>1^-(1&he);for(let me=V;me<V+re;me++)z[me]=he+X,X=z[me];V+=re}return z})(m,y.runs,y.numRleValues);return N1(S),S}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(J0(h,a,u),u)}function J0(h,a,u){const m=u.physicalLevelTechnique;if(m===Zu.FAST_PFOR)return RE();if(m===Zu.VARINT)return Us(h,a,u.numValues);if(m===Zu.NONE){const y=a.get();a.add(u.byteLength);const S=h.subarray(y,a.get());return new Int32Array(S)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function V1(h,a,u,m){const y=J0(h,a,u);if(y.length===1){const S=y[0];return m?kf(S):S}return m?(function(S){return kf(S[1])})(y):(function(S){return S[1]})(y)}function zE(h,a,u){return(function(m){if(m.length==2){const y=kf(m[1]);return[y,y]}return[kf(m[2]),kf(m[3])]})(J0(h,a,u))}function BE(h,a,u){return(function(m){if(m.length==2){const y=Mm(m[1]);return[y,y]}return[Mm(m[2]),Mm(m[3])]})(K0(h,a,u.numValues))}function NE(h,a,u,m){return(function(y,S,T){switch(S.logicalLevelTechnique1){case mn.DELTA:return S.logicalLevelTechnique2===mn.RLE?(function(A,D,z){const V=new BigInt64Array(z);let X=0,ie=0n;for(let re=0;re<D;re++){const he=Number(A[re]),me=Mm(A[re+D]);for(let _e=0;_e<he;_e++)ie+=me,V[X++]=ie}return V})(y,S.runs,S.numRleValues):((function(A){A[0]=A[0]>>1n^-(1n&A[0]);const D=A.length/4*4;let z=1;if(D>=4)for(;z<D-4;z+=4){const V=A[z],X=A[z+1],ie=A[z+2],re=A[z+3];A[z]=(V>>1n^-(1n&V))+A[z-1],A[z+1]=(X>>1n^-(1n&X))+A[z],A[z+2]=(ie>>1n^-(1n&ie))+A[z+1],A[z+3]=(re>>1n^-(1n&re))+A[z+2]}for(;z!=A.length;++z)A[z]=(A[z]>>1n^-(1n&A[z]))+A[z-1]})(y),y);case mn.RLE:return(function(A,D,z){return z?(function(V,X,ie){const re=new BigInt64Array(ie);let he=0;for(let me=0;me<X;me++){const _e=Number(V[me]);let Se=V[me+X];Se=Se>>1n^-(1n&Se),re.fill(Se,he,he+_e),he+=_e}return re})(A,D.runs,D.numRleValues):DE(A,D.runs,D.numRleValues)})(y,S,T);case mn.NONE:return T&&(function(A){for(let D=0;D<A.length;D++){const z=A[D];A[D]=z>>1n^-(1n&z)}})(y),y;default:throw new Error(`The specified Logical level technique is not supported: ${S.logicalLevelTechnique1}`)}})(K0(h,a,u.numValues),u,m)}function $E(h,a,u,m){const y=K0(h,a,u.numValues);if(y.length===1){const S=y[0];return m?Mm(S):S}return m?(function(S){return Mm(S[1])})(y):(function(S){return S[1]})(y)}function U1(h,a,u,m,y){return(function(S,T,A,D){switch(T.logicalLevelTechnique1){case mn.DELTA:return T.logicalLevelTechnique2===mn.RLE&&(S=kE(S,T.runs,T.numRleValues)),(function(z,V){const X=new Int32Array(z.size());let ie=0;z.get(0)?(X[0]=z.get(0)?V[0]>>>1^-(1&V[0]):0,ie=1):X[0]=0;let re=1;for(;re!=X.length;++re)X[re]=z.get(re)?X[re-1]+(V[ie]>>>1^-(1&V[ie++])):X[re-1];return X})(D,S);case mn.RLE:return(function(z,V,X,ie){const re=V;return X?(function(he,me,_e){const Se=new Int32Array(he.size());let Be=0;for(let Me=0;Me<_e;Me++){const Ae=me[Me];let Ve=me[Me+_e];Ve=Ve>>>1^-(1&Ve);for(let qe=Be;qe<Be+Ae;qe++)he.get(qe)?Se[qe]=Ve:(Se[qe]=0,Be++);Be+=Ae}return Se})(ie,z,re.runs):(function(he,me,_e){const Se=new Int32Array(he.size());let Be=0;for(let Me=0;Me<_e;Me++){const Ae=me[Me],Ve=me[Me+_e];for(let qe=Be;qe<Be+Ae;qe++)he.get(qe)?Se[qe]=Ve:(Se[qe]=0,Be++);Be+=Ae}return Se})(ie,z,re.runs)})(S,T,A,D);case mn.MORTON:return N1(S),S;case mn.COMPONENTWISE_DELTA:return OE(S),S;case mn.NONE:return S=A?(function(z,V){const X=new Int32Array(z.size());let ie=0,re=0;for(;re!=X.length;++re)if(z.get(re)){const he=V[ie++];X[re]=he>>>1^-(1&he)}else X[re]=0;return X})(D,S):(function(z,V){const X=new Int32Array(z.size());let ie=0,re=0;for(;re!=X.length;++re)X[re]=z.get(re)?V[ie++]:0;return X})(D,S),S;default:throw new Error("The specified Logical level technique is not supported")}})(u.physicalLevelTechnique===Zu.FAST_PFOR?RE():Us(h,a,u.numValues),u,m,y)}function Q0(h,a,u,m){const y=h.logicalLevelTechnique1;if(y===mn.RLE)return h.runs===1?Ps.CONST:Ps.FLAT;const S=a instanceof oc?a.size():a;if(y===mn.DELTA&&h.logicalLevelTechnique2===mn.RLE){const T=h.runs,A=2;if(h.numRleValues!==S)return Ps.FLAT;if(T===1)return Ps.SEQUENCE;if(T===2){const D=m.get();let z;if(h.physicalLevelTechnique===Zu.VARINT)z=Us(u,m,4);else{const V=m.get();z=new Int32Array(u.buffer,u.byteOffset+V,4)}if(m.set(D),z[2]===A&&z[3]===A)return Ps.SEQUENCE}}return h.numValues===1?Ps.CONST:Ps.FLAT}class VE extends Y0{getValueFromBuffer(a){return this.dataBuffer[a]}}class UE extends IE{constructor(a,u,m,y){super(a,BigInt64Array.of(u),m,y)}getValueFromBuffer(a){return this.dataBuffer[0]+BigInt(a)*this.delta}}class Cm{_geometryOffsets;_partOffsets;_ringOffsets;constructor(a,u,m){this._geometryOffsets=a,this._partOffsets=u,this._ringOffsets=m}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function j1(h,a,u){return{x:jE(h,a)-u,y:jE(h>>1,a)-u}}function jE(h,a){let u=0;for(let m=0;m<a;m++)u|=(h&1<<2*m)>>m;return u}(function(h){h[h.POINT=0]="POINT",h[h.LINESTRING=1]="LINESTRING",h[h.POLYGON=2]="POLYGON",h[h.MULTIPOINT=3]="MULTIPOINT",h[h.MULTILINESTRING=4]="MULTILINESTRING",h[h.MULTIPOLYGON=5]="MULTIPOLYGON"})(Is||(Is={})),(function(h){h[h.POINT=0]="POINT",h[h.LINESTRING=1]="LINESTRING",h[h.POLYGON=2]="POLYGON"})(LE||(LE={})),(function(h){h[h.MORTON=0]="MORTON",h[h.VEC_2=1]="VEC_2",h[h.VEC_3=2]="VEC_3"})(Va||(Va={}));class AN{createPoint(a){return[[a]]}createMultiPoint(a){return a.map((u=>[u]))}createLineString(a){return[a]}createMultiLineString(a){return a}createPolygon(a,u){return[a].concat(u)}createMultiPolygon(a){return a.flat()}}function GE(h){const a=new Array(h.numGeometries);let u=1,m=1,y=1,S=0;const T=new AN;let A=0,D=0;const z=h.mortonSettings,V=h.topologyVector,X=V.geometryOffsets,ie=V.partOffsets,re=V.ringOffsets,he=h.vertexOffsets,me=h.containsPolygonGeometry(),_e=h.vertexBuffer;for(let Se=0;Se<h.numGeometries;Se++){const Be=h.geometryType(Se);if(Be===Is.POINT){if(he&&he.length!==0)if(h.vertexBufferType===Va.VEC_2){const Me=2*he[D++],Ae=new f(_e[Me],_e[Me+1]);a[S++]=T.createPoint(Ae)}else{const Me=j1(_e[he[D++]],z.numBits,z.coordinateShift),Ae=new f(Me.x,Me.y);a[S++]=T.createPoint(Ae)}else{const Me=new f(_e[A++],_e[A++]);a[S++]=T.createPoint(Me)}X&&y++,ie&&u++,re&&m++}else if(Be===Is.MULTIPOINT){const Me=X[y]-X[y-1];y++;const Ae=new Array(Me);if(he&&he.length!==0){for(let Ve=0;Ve<Me;Ve++){const qe=2*he[D++];Ae[Ve]=new f(_e[qe],_e[qe+1])}a[S++]=T.createMultiPoint(Ae)}else{for(let Ve=0;Ve<Me;Ve++){const qe=_e[A++],_t=_e[A++];Ae[Ve]=new f(qe,_t)}a[S++]=T.createMultiPoint(Ae)}}else if(Be===Is.LINESTRING){let Me,Ae=0;me?(Ae=re[m]-re[m-1],m++):Ae=ie[u]-ie[u-1],u++,he&&he.length!==0?(Me=h.vertexBufferType===Va.VEC_2?q1(_e,he,D,Ae,!1):H1(_e,he,D,Ae,!1,z),D+=Ae):(Me=G1(_e,A,Ae,!1),A+=2*Ae),a[S++]=T.createLineString(Me),X&&y++}else if(Be===Is.POLYGON){const Me=ie[u]-ie[u-1];u++;const Ae=new Array(Me-1);let Ve=re[m]-re[m-1];if(m++,he&&he.length!==0){const qe=h.vertexBufferType===Va.VEC_2?tb(_e,he,D,Ve):ib(_e,he,D,Ve,0,z);D+=Ve;for(let _t=0;_t<Ae.length;_t++)Ve=re[m]-re[m-1],m++,Ae[_t]=h.vertexBufferType===Va.VEC_2?tb(_e,he,D,Ve):ib(_e,he,D,Ve,0,z),D+=Ve;a[S++]=T.createPolygon(qe,Ae)}else{const qe=eb(_e,A,Ve);A+=2*Ve;for(let _t=0;_t<Ae.length;_t++)Ve=re[m]-re[m-1],m++,Ae[_t]=eb(_e,A,Ve),A+=2*Ve;a[S++]=T.createPolygon(qe,Ae)}X&&y++}else if(Be===Is.MULTILINESTRING){const Me=X[y]-X[y-1];y++;const Ae=new Array(Me);if(he&&he.length!==0){for(let Ve=0;Ve<Me;Ve++){let qe=0;me?(qe=re[m]-re[m-1],m++):qe=ie[u]-ie[u-1],u++;const _t=h.vertexBufferType===Va.VEC_2?q1(_e,he,D,qe,!1):H1(_e,he,D,qe,!1,z);Ae[Ve]=_t,D+=qe}a[S++]=T.createMultiLineString(Ae)}else{for(let Ve=0;Ve<Me;Ve++){let qe=0;me?(qe=re[m]-re[m-1],m++):qe=ie[u]-ie[u-1],u++,Ae[Ve]=G1(_e,A,qe,!1),A+=2*qe}a[S++]=T.createMultiLineString(Ae)}}else{if(Be!==Is.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const Me=X[y]-X[y-1];y++;const Ae=new Array(Me);let Ve=0;if(he&&he.length!==0){for(let qe=0;qe<Me;qe++){const _t=ie[u]-ie[u-1];u++;const Vt=new Array(_t-1);Ve=re[m]-re[m-1],m++;const Rt=h.vertexBufferType===Va.VEC_2?tb(_e,he,D,Ve):ib(_e,he,D,Ve,0,z);D+=Ve;for(let Ht=0;Ht<Vt.length;Ht++)Ve=re[m]-re[m-1],m++,Vt[Ht]=h.vertexBufferType===Va.VEC_2?tb(_e,he,D,Ve):ib(_e,he,D,Ve,0,z),D+=Ve;Ae[qe]=T.createPolygon(Rt,Vt)}a[S++]=T.createMultiPolygon(Ae)}else{for(let qe=0;qe<Me;qe++){const _t=ie[u]-ie[u-1];u++;const Vt=new Array(_t-1);Ve=re[m]-re[m-1],m++;const Rt=eb(_e,A,Ve);A+=2*Ve;for(let Ht=0;Ht<Vt.length;Ht++){const ni=re[m]-re[m-1];m++,Vt[Ht]=eb(_e,A,ni),A+=2*ni}Ae[qe]=T.createPolygon(Rt,Vt)}a[S++]=T.createMultiPolygon(Ae)}}}}return a}function eb(h,a,u){return G1(h,a,u,!0)}function tb(h,a,u,m){return q1(h,a,u,m,!0)}function ib(h,a,u,m,y,S){return H1(h,a,u,m,!0,S)}function G1(h,a,u,m){const y=new Array(m?u+1:u);for(let S=0;S<2*u;S+=2)y[S/2]=new f(h[a+S],h[a+S+1]);return m&&(y[y.length-1]=y[0]),y}function q1(h,a,u,m,y){const S=new Array(y?m+1:m);for(let T=0;T<2*m;T+=2){const A=2*a[u+T/2];S[T/2]=new f(h[A],h[A+1])}return y&&(S[S.length-1]=S[0]),S}function H1(h,a,u,m,y,S){const T=new Array(y?m+1:m);for(let A=0;A<m;A++){const D=j1(h[a[u+A]],S.numBits,S.coordinateShift);T[A]=new f(D.x,D.y)}return y&&(T[T.length-1]=T[0]),T}class qE{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(a,u,m,y,S){this._vertexBufferType=a,this._topologyVector=u,this._vertexOffsets=m,this._vertexBuffer=y,this._mortonSettings=S}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const a=GE(this);let u=0;for(;u<this.numGeometries;)yield{coordinates:a[u],type:this.geometryType(u)},u++}getSimpleEncodedVertex(a){const u=this.vertexOffsets?2*this.vertexOffsets[a]:2*a;return[this.vertexBuffer[u],this.vertexBuffer[u+1]]}getVertex(a){if(this.vertexOffsets&&this.mortonSettings){const m=j1(this.vertexBuffer[this.vertexOffsets[a]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[m.x,m.y]}const u=this.vertexOffsets?2*this.vertexOffsets[a]:2*a;return[this.vertexBuffer[u],this.vertexBuffer[u+1]]}getGeometries(){return GE(this)}get mortonSettings(){return this._mortonSettings}}class HE extends qE{_numGeometries;_geometryType;constructor(a,u,m,y,S,T,A){super(m,y,S,T,A),this._numGeometries=a,this._geometryType=u}geometryType(a){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Is.POLYGON||this._geometryType===Is.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class WE extends qE{_geometryTypes;constructor(a,u,m,y,S,T){super(a,m,y,S,T),this._geometryTypes=u}geometryType(a){return this._geometryTypes[a]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let a=0;a<this.numGeometries;a++)if(this.geometryType(a)===Is.POLYGON||this.geometryType(a)===Is.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class ZE{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(a,u,m,y){this._triangleOffsets=a,this._indexBuffer=u,this._vertexBuffer=m,this._topologyVector=y}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const a=new Array(this.numGeometries),u=this._topologyVector,m=u.partOffsets,y=u.ringOffsets,S=u.geometryOffsets;let T=0,A=1,D=1,z=1;for(let V=0;V<this.numGeometries;V++)switch(this.geometryType(V)){case Is.POLYGON:{const X=m[A]-m[A-1];A++;const ie=[];for(let re=0;re<X;re++){const he=y[D]-y[D-1];D++;const me=[];for(let _e=0;_e<he;_e++){const Se=this._vertexBuffer[T++],Be=this._vertexBuffer[T++];me.push(new f(Se,Be))}me.length>0&&me.push(me[0]),ie.push(me)}a[V]=ie,S&&z++}break;case Is.MULTIPOLYGON:{const X=S[z]-S[z-1];z++;const ie=[];for(let re=0;re<X;re++){const he=m[A]-m[A-1];A++;for(let me=0;me<he;me++){const _e=y[D]-y[D-1];D++;const Se=[];for(let Be=0;Be<_e;Be++){const Me=this._vertexBuffer[T++],Ae=this._vertexBuffer[T++];Se.push(new f(Me,Ae))}Se.length>0&&Se.push(Se[0]),ie.push(Se)}}a[V]=ie}}return a}[Symbol.iterator](){return null}}function XE(h,a,u,m,y,S){return new PN(h,a,u,m,y,S)}class PN extends ZE{_numGeometries;_geometryType;constructor(a,u,m,y,S,T){super(m,y,S,T),this._numGeometries=a,this._geometryType=u}geometryType(a){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function YE(h,a,u,m,y){return new IN(h,a,u,m,y)}class IN extends ZE{_geometryTypes;constructor(a,u,m,y,S){super(u,m,y,S),this._geometryTypes=a}geometryType(a){return this._geometryTypes[a]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function LN(h,a,u,m,y){const S=To(h,u);let T=null,A=null,D=null,z=null,V=null,X=null,ie=null,re=null;if(Q0(S,m,h,u)===Ps.CONST){const me=V1(h,u,S,!1);for(let _e=0;_e<a-1;_e++){const Se=To(h,u);switch(Se.physicalStreamType){case Js.LENGTH:switch(Se.logicalStreamType.lengthType){case da.GEOMETRIES:T=rd(h,u,Se);break;case da.PARTS:A=rd(h,u,Se);break;case da.RINGS:D=rd(h,u,Se);break;case da.TRIANGLES:ie=rd(h,u,Se)}break;case Js.OFFSET:switch(Se.logicalStreamType.offsetType){case Rf.VERTEX:z=Mo(h,u,Se,!1);break;case Rf.INDEX:re=Mo(h,u,Se,!1)}break;case Js.DATA:sc.VERTEX===Se.logicalStreamType.dictionaryType?V=Mo(h,u,Se,!0):(X={numBits:Se.numBits,coordinateShift:Se.coordinateShift},V=Mo(h,u,Se,!1))}}return re!==null?T!=null||A!=null?XE(m,me,ie,re,V,new Cm(T,A,D)):XE(m,me,ie,re,V):X===null?(function(_e,Se,Be,Me,Ae){return new HE(_e,Se,Va.VEC_2,Be,Me,Ae)})(m,me,new Cm(T,A,D),z,V):(function(_e,Se,Be,Me,Ae,Ve){return new HE(_e,Se,Va.MORTON,Be,Me,Ae,Ve)})(m,me,new Cm(T,A,D),z,V,X)}const he=Mo(h,u,S,!1);for(let me=0;me<a-1;me++){const _e=To(h,u);switch(_e.physicalStreamType){case Js.LENGTH:switch(_e.logicalStreamType.lengthType){case da.GEOMETRIES:T=Mo(h,u,_e,!1);break;case da.PARTS:A=Mo(h,u,_e,!1);break;case da.RINGS:D=Mo(h,u,_e,!1);break;case da.TRIANGLES:ie=rd(h,u,_e)}break;case Js.OFFSET:switch(_e.logicalStreamType.offsetType){case Rf.VERTEX:z=Mo(h,u,_e,!1);break;case Rf.INDEX:re=Mo(h,u,_e,!1)}break;case Js.DATA:sc.VERTEX===_e.logicalStreamType.dictionaryType?V=Mo(h,u,_e,!0):(X={numBits:_e.numBits,coordinateShift:_e.coordinateShift},V=Mo(h,u,_e,!1))}}return re!==null&&A===null?YE(he,ie,re,V):(T!==null?(T=W1(he,T,2),A!==null&&D!==null?(A=KE(he,T,A,!1),D=(function(me,_e,Se,Be){const Me=new Int32Array(Se[Se.length-1]+1);let Ae=0;Me[0]=Ae;let Ve=1,qe=1,_t=0;for(let Vt=0;Vt<me.length;Vt++){const Rt=me[Vt],Ht=_e[Vt+1]-_e[Vt];if(Rt!==0&&Rt!==3)for(let ni=0;ni<Ht;ni++){const Yt=Se[Ve]-Se[Ve-1];Ve++;for(let Ft=0;Ft<Yt;Ft++)Ae=Me[qe++]=Ae+Be[_t++]}else for(let ni=0;ni<Ht;ni++)Me[qe++]=++Ae,Ve++}return Me})(he,T,A,D)):A!==null&&(A=(function(me,_e,Se){const Be=new Int32Array(_e[_e.length-1]+1);let Me=0;Be[0]=Me;let Ae=1,Ve=0;for(let qe=0;qe<me.length;qe++){const _t=me[qe],Vt=_e[qe+1]-_e[qe];if(_t===4||_t===1)for(let Rt=0;Rt<Vt;Rt++)Me=Be[Ae++]=Me+Se[Ve++];else for(let Rt=0;Rt<Vt;Rt++)Be[Ae++]=++Me}return Be})(he,T,A))):A!==null&&D!==null?(A=W1(he,A,1),D=KE(he,A,D,!0)):A!==null&&(A=W1(he,A,0)),re!==null?YE(he,ie,re,V,new Cm(T,A,D)):X===null?(function(me,_e,Se,Be){return new WE(Va.VEC_2,me,_e,Se,Be)})(he,new Cm(T,A,D),z,V):(function(me,_e,Se,Be,Me){return new WE(Va.MORTON,me,_e,Se,Be,Me)})(he,new Cm(T,A,D),z,V,X))}function W1(h,a,u){const m=new Int32Array(h.length+1);let y=0;m[0]=y;let S=0;for(let T=0;T<h.length;T++)y=m[T+1]=y+(h[T]>u?a[S++]:1);return m}function KE(h,a,u,m){const y=new Int32Array(a[a.length-1]+1);let S=0;y[0]=S;let T=1,A=0;for(let D=0;D<h.length;D++){const z=h[D],V=a[D+1]-a[D];if(z===5||z===2||m&&(z===4||z===1))for(let X=0;X<V;X++)S=y[T++]=S+u[A++];else for(let X=0;X<V;X++)y[T++]=++S}return y}class RN extends Tm{dataVector;constructor(a,u,m){super(a,u.getBuffer(),m),this.dataVector=u}getValueFromBuffer(a){return this.dataVector.get(a)}}class kN extends Y0{getValueFromBuffer(a){return this.dataBuffer[a]}}class JE extends Tm{constructor(a,u,m){super(a,BigInt64Array.of(u),m)}getValueFromBuffer(a){return this.dataBuffer[0]}}function Q_(h,a,u){return QE(h,Math.ceil(a/8),u)}function QE(h,a,u){const m=new Uint8Array(a);let y=0;for(;y<a;){const S=h[u.increment()];if(S<=127){const T=S+3,A=h[u.increment()],D=y+T;m.fill(A,y,D),y=D}else{const T=256-S;for(let A=0;A<T;A++)m[y++]=h[u.increment()]}}return m}const DN=new TextDecoder;function Z1(h,a,u){return u-a>=12?DN.decode(h.subarray(a,u)):(function(m,y,S){let T="",A=y;for(;A<S;){const D=m[A];let z,V,X,ie=null,re=D>239?4:D>223?3:D>191?2:1;if(A+re>S)break;re===1?D<128&&(ie=D):re===2?(z=m[A+1],(192&z)==128&&(ie=(31&D)<<6|63&z,ie<=127&&(ie=null))):re===3?(z=m[A+1],V=m[A+2],(192&z)==128&&(192&V)==128&&(ie=(15&D)<<12|(63&z)<<6|63&V,(ie<=2047||ie>=55296&&ie<=57343)&&(ie=null))):re===4&&(z=m[A+1],V=m[A+2],X=m[A+3],(192&z)==128&&(192&V)==128&&(192&X)==128&&(ie=(15&D)<<18|(63&z)<<12|(63&V)<<6|63&X,(ie<=65535||ie>=1114112)&&(ie=null))),ie===null?(ie=65533,re=1):ie>65535&&(ie-=65536,T+=String.fromCharCode(ie>>>10&1023|55296),ie=56320|1023&ie),T+=String.fromCharCode(ie),A+=re}return T})(h,a,u)}class X1 extends Tm{offsetBuffer;constructor(a,u,m,y){super(a,m,y),this.offsetBuffer=u}}class eA extends X1{textEncoder;constructor(a,u,m,y){super(a,u,m,y??u.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(a){return Z1(this.dataBuffer,this.offsetBuffer[a],this.offsetBuffer[a+1])}}class Em extends X1{indexBuffer;textEncoder;constructor(a,u,m,y,S){super(a,m,y,S??u.length),this.indexBuffer=u,this.indexBuffer=u,this.textEncoder=new TextEncoder}getValueFromBuffer(a){const u=this.indexBuffer[a];return Z1(this.dataBuffer,this.offsetBuffer[u],this.offsetBuffer[u+1])}}class tA extends X1{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(a,u,m,y,S,T,A){super(a,m,y,A),this.indexBuffer=u,this.symbolOffsetBuffer=S,this.symbolTableBuffer=T,this.textEncoder=new TextEncoder}getValueFromBuffer(a){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(m,y,S){const T=[],A=new Array(y.length).fill(0);for(let D=1;D<y.length;D++)A[D]=A[D-1]+y[D-1];for(let D=0;D<S.length;D++)if(S[D]===255)T.push(S[++D]);else{const z=y[S[D]],V=A[S[D]];for(let X=0;X<z;X++)T.push(m[V+X])}return new Uint8Array(T)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const u=this.indexBuffer[a];return Z1(this.decodedDictionary,this.offsetBuffer[u],this.offsetBuffer[u+1])}offsetToLengthBuffer(a){const u=new Uint32Array(a.length-1);let m=a[0];for(let y=1;y<a.length;y++){const S=a[y];u[y-1]=S-m,m=S}return u}}function FN(h,a,u,m,y,S){return u.type==="scalarType"?(function(T,A,D,z,V,X){let ie=null,re=0;if(T===0)return null;if(X.nullable){const me=To(A,D);re=me.numValues;const _e=D.get(),Se=Q_(A,re,D);D.set(_e+me.byteLength),ie=new oc(Se,me.numValues)}const he=ie??z;switch(V.physicalType){case 4:case 3:return(function(me,_e,Se,Be,Me){const Ae=To(me,_e),Ve=Q0(Ae,Me,me,_e),qe=Be.physicalType===3;if(Ve===Ps.FLAT){const _t=ev(Me)?U1(me,_e,Ae,qe,Me):Mo(me,_e,Ae,qe);return new F1(Se.name,_t,Me)}if(Ve===Ps.SEQUENCE){const _t=zE(me,_e,Ae);return new z1(Se.name,_t[0],_t[1],Ae.numRleValues)}{const _t=V1(me,_e,Ae,qe);return new B1(Se.name,_t,Me)}})(A,D,X,V,he);case 9:return(function(me,_e,Se,Be,Me){let Ae=null,Ve=null,qe=null,_t=null,Vt=null,Rt=null,Ht=null,ni=null;for(let Yt=0;Yt<Be;Yt++){const Ft=To(_e,Se);if(Ft.byteLength!==0)switch(Ft.physicalStreamType){case Js.PRESENT:{const St=Q_(_e,Ft.numValues,Se);Rt=new oc(St,Ft.numValues);break}case Js.OFFSET:Ve=Me!=null||Rt!=null?U1(_e,Se,Ft,!1,Me??Rt):Mo(_e,Se,Ft,!1);break;case Js.LENGTH:{const St=rd(_e,Se,Ft);da.DICTIONARY===Ft.logicalStreamType.lengthType?Ae=St:da.SYMBOL===Ft.logicalStreamType.lengthType?_t=St:Ht=St;break}case Js.DATA:{const St=_e.subarray(Se.get(),Se.get()+Ft.byteLength);Se.add(Ft.byteLength);const fi=Ft.logicalStreamType.dictionaryType;sc.FSST===fi?Vt=St:sc.SINGLE===fi||sc.SHARED===fi?qe=St:sc.NONE===fi&&(ni=St);break}}}return(function(Yt,Ft,St,fi,hi,_i,ci){return Ft?new tA(Yt,St,fi,hi,_i,Ft,ci):null})(me,Vt,Ve,Ae,qe,_t,Me??Rt)??(function(Yt,Ft,St,fi,hi){return Ft?hi?new Em(Yt,St,fi,Ft,hi):new Em(Yt,St,fi,Ft):null})(me,qe,Ve,Ae,Me??Rt)??(function(Yt,Ft,St,fi,hi){if(!Ft||!St)return null;if(fi)return hi?new Em(Yt,fi,Ft,St,hi):new Em(Yt,fi,Ft,St);if(hi&&hi.size()!==Ft.length-1){const _i=new Int32Array(hi.size());let ci=0;for(let Ci=0;Ci<hi.size();Ci++)_i[Ci]=hi.get(Ci)?ci++:0;return new Em(Yt,_i,Ft,St,hi)}return hi?new eA(Yt,Ft,St,hi):new eA(Yt,Ft,St)})(me,Ht,ni,Ve,Me??Rt)})(X.name,A,D,X.nullable?T-1:T,ie);case 0:return(function(me,_e,Se,Be,Me){const Ae=To(me,_e),Ve=Ae.numValues,qe=_e.get(),_t=ev(Me)?(function(Rt,Ht,ni,Yt){const Ft=QE(Rt,Math.ceil(Ht/8),ni),St=new oc(Ft,Ht),fi=Yt.size(),hi=new oc(new Uint8Array(fi),fi);let _i=0;for(let ci=0;ci<Yt.size();ci++){const Ci=!!Yt.get(ci)&&St.get(_i++);hi.set(ci,Ci)}return hi.getBuffer()})(me,Ve,_e,Me):Q_(me,Ve,_e);_e.set(qe+Ae.byteLength);const Vt=new oc(_t,Ve);return new RN(Se.name,Vt,Me)})(A,D,X,0,he);case 6:case 5:return(function(me,_e,Se,Be,Me){const Ae=To(me,_e),Ve=Q0(Ae,Be,me,_e),qe=Me.physicalType===5;if(Ve===Ps.FLAT){const _t=ev(Be)?(function(Vt,Rt,Ht,ni,Yt){return(function(Ft,St,fi,hi){switch(St.logicalLevelTechnique1){case mn.DELTA:return St.logicalLevelTechnique2===mn.RLE&&(Ft=DE(Ft,St.runs,St.numRleValues)),(function(_i,ci){const Ci=new BigInt64Array(_i.size());let wn=0;_i.get(0)?(Ci[0]=_i.get(0)?ci[0]>>1n^-(1n&ci[0]):0n,wn=1):Ci[0]=0n;let un=1;for(;un!=Ci.length;++un)Ci[un]=_i.get(un)?Ci[un-1]+(ci[wn]>>1n^-(1n&ci[wn++])):Ci[un-1];return Ci})(hi,Ft);case mn.RLE:return(function(_i,ci,Ci,wn){const un=ci;return Ci?(function(wr,eo,hs){const Sr=new BigInt64Array(wr.size());let mr=0;for(let In=0;In<hs;In++){const Nr=Number(eo[In]);let Xr=eo[In+hs];Xr=Xr>>1n^-(1n&Xr);for(let or=mr;or<mr+Nr;or++)wr.get(or)?Sr[or]=Xr:(Sr[or]=0n,mr++);mr+=Nr}return Sr})(wn,_i,un.runs):(function(wr,eo,hs){const Sr=new BigInt64Array(wr.size());let mr=0;for(let In=0;In<hs;In++){const Nr=Number(eo[In]),Xr=eo[In+hs];for(let or=mr;or<mr+Nr;or++)wr.get(or)?Sr[or]=Xr:(Sr[or]=0n,mr++);mr+=Nr}return Sr})(wn,_i,un.runs)})(Ft,St,fi,hi);case mn.NONE:return Ft=fi?(function(_i,ci){const Ci=new BigInt64Array(_i.size());let wn=0,un=0;for(;un!=Ci.length;++un)if(_i.get(un)){const wr=ci[wn++];Ci[un]=wr>>1n^-(1n&wr)}else Ci[un]=0n;return Ci})(hi,Ft):(function(_i,ci){const Ci=new BigInt64Array(_i.size());let wn=0,un=0;for(;un!=Ci.length;++un)Ci[un]=_i.get(un)?ci[wn++]:0n;return Ci})(hi,Ft),Ft;default:throw new Error("The specified Logical level technique is not supported")}})(K0(Vt,Rt,Ht.numValues),Ht,ni,Yt)})(me,_e,Ae,qe,Be):NE(me,_e,Ae,qe);return new VE(Se.name,_t,Be)}if(Ve===Ps.SEQUENCE){const _t=BE(me,_e,Ae);return new UE(Se.name,_t[0],_t[1],Ae.numRleValues)}{const _t=$E(me,_e,Ae,qe);return new JE(Se.name,_t,Be)}})(A,D,X,he,V);case 7:return(function(me,_e,Se,Be){const Me=To(me,_e),Ae=ev(Be)?(function(Ve,qe,_t,Vt){const Rt=qe.get(),Ht=Rt+Vt*Float32Array.BYTES_PER_ELEMENT,ni=new Uint8Array(Ve.subarray(Rt,Ht)).buffer,Yt=new Float32Array(ni);qe.set(Ht);const Ft=_t.size(),St=new Float32Array(Ft);let fi=0;for(let hi=0;hi<Ft;hi++)St[hi]=_t.get(hi)?Yt[fi++]:0;return St})(me,_e,Be,Me.numValues):(function(Ve,qe,_t){const Vt=qe.get(),Rt=Vt+_t*Float32Array.BYTES_PER_ELEMENT,Ht=new Uint8Array(Ve.subarray(Vt,Rt)).buffer,ni=new Float32Array(Ht);return qe.set(Rt),ni})(me,_e,Me.numValues);return new kN(Se.name,Ae,Be)})(A,D,X,he);case 8:return(function(me,_e,Se,Be){const Me=To(me,_e),Ae=ev(Be)?(function(Ve,qe,_t,Vt){const Rt=qe.get(),Ht=Rt+Vt*Float64Array.BYTES_PER_ELEMENT,ni=new Uint8Array(Ve.subarray(Rt,Ht)).buffer,Yt=new Float64Array(ni);qe.set(Ht);const Ft=_t.size(),St=new Float64Array(Ft);let fi=0;for(let hi=0;hi<Ft;hi++)St[hi]=_t.get(hi)?Yt[fi++]:0;return St})(me,_e,Be,Me.numValues):(function(Ve,qe,_t){const Vt=qe.get(),Rt=Vt+_t*Float64Array.BYTES_PER_ELEMENT,Ht=new Uint8Array(Ve.subarray(Vt,Rt)).buffer,ni=new Float64Array(Ht);return qe.set(Rt),ni})(me,_e,Me.numValues);return new O1(Se.name,Ae,Be)})(A,D,X,he);default:throw new Error(`The specified data type for the field is currently not supported: ${V}`)}})(m,h,a,y,u.scalarType,u):m!=1?null:(function(T,A,D,z){let V=null,X=null,ie=null,re=null,he=!1;for(;!he;){const Be=To(T,A);switch(Be.physicalStreamType){case Js.LENGTH:da.DICTIONARY===Be.logicalStreamType.lengthType?V=rd(T,A,Be):ie=rd(T,A,Be);break;case Js.DATA:sc.SINGLE===Be.logicalStreamType.dictionaryType||sc.SHARED===Be.logicalStreamType.dictionaryType?(X=T.subarray(A.get(),A.get()+Be.byteLength),he=!0):re=T.subarray(A.get(),A.get()+Be.byteLength),A.add(Be.byteLength)}}const me=D.complexType.children,_e=[];let Se=0;for(const Be of me){const Me=Us(T,A,1)[0];if(Me==0)continue;const Ae=`${D.name}${Be.name==="default"?"":":"+Be.name}`;if(Me!==2||Be.type!=="scalarField"||Be.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Ve=To(T,A),qe=Q_(T,Ve.numValues,A),_t=To(T,A),Vt=_t.decompressedCount!==z?U1(T,A,_t,!1,new oc(qe,Ve.numValues)):Mo(T,A,_t,!1);_e[Se++]=re?new tA(Ae,Vt,V,X,ie,re,new oc(qe,Ve.numValues)):new Em(Ae,Vt,V,X,new oc(qe,Ve.numValues))}return _e})(h,a,u,y)}function ev(h){return h instanceof oc}function ON(h){if(h.name==="id")return!1;if(h.type==="scalarType"){const a=h.scalarType;if(a.type==="physicalType")switch(a.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(a.type==="logicalType")return!1}else if(h.type==="complexType"){const a=h.complexType;if(a.type==="physicalType")switch(a.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",h),!1}const zN=new TextDecoder;function iA(h,a){const u=Us(h,a,1)[0];if(u===0)return"";const m=a.get(),y=h.subarray(m,m+u);return a.add(u),zN.decode(y)}function nA(h,a){const u=Us(h,a,1)[0]>>>0,m=!!(4&u),y=!!(2&u),S=Us(h,a,1)[0]>>>0,T={};if(1&u&&(T.nullable=!0),y){const A={};if(m?(A.type="logicalType",A.logicalType=S):(A.type="physicalType",A.physicalType=S),8&u){const D=Us(h,a,1)[0]>>>0;A.children=new Array(D);for(let z=0;z<D;z++)A.children[z]=nA(h,a)}T.type="complexField",T.complexField=A}else{const A={};m?(A.type="logicalType",A.logicalType=S):(A.type="physicalType",A.physicalType=S),T.type="scalarField",T.scalarField=A}return T}function BN(h,a){const u=Us(h,a,1)[0]>>>0,m=(function(y){switch(y){case 0:case 1:case 2:case 3:{const S={};S.nullable=!!(1&y),S.columnScope=0;const T={};return T.physicalType=y>1?6:4,T.type="physicalType",S.scalarType=T,S.type="scalarType",S}case 4:{const S={nullable:!1,columnScope:0},T={type:"physicalType",physicalType:0};return S.type="complexType",S.complexType=T,S}case 30:{const S={nullable:!1,columnScope:0},T={type:"physicalType",physicalType:1};return S.type="complexType",S.complexType=T,S}default:return(function(S){let T=null;switch(S){case 10:case 11:T=0;break;case 12:case 13:T=1;break;case 14:case 15:T=2;break;case 16:case 17:T=3;break;case 18:case 19:T=4;break;case 20:case 21:T=5;break;case 22:case 23:T=6;break;case 24:case 25:T=7;break;case 26:case 27:T=8;break;case 28:case 29:T=9;break;default:return null}const A={};A.nullable=!!(1&S),A.columnScope=0;const D={type:"physicalType"};return D.physicalType=T,A.type="scalarType",A.scalarType=D,A})(y)}})(u);if(!m)throw new Error(`Unsupported column type code: ${u}`);if((function(y){return y>=10})(u)?m.name=iA(h,a):u>=0&&u<=3?m.name="id":u===4&&(m.name="geometry"),(function(y){return y===30})(u)){const y=Us(h,a,1)[0]>>>0,S=m.complexType;S.children=new Array(y);for(let T=0;T<y;T++)S.children[T]=nA(h,a)}return m}function NN(h,a){const u={featureTables:[]},m={};m.name=iA(h,a);const y=Us(h,a,1)[0]>>>0,S=Us(h,a,1)[0]>>>0;m.columns=new Array(S);for(let T=0;T<S;T++)m.columns[T]=BN(h,a);return u.featureTables.push(m),[u,y]}function $N(h,a,u,m,y,S,T=!1){const A=a.scalarType.physicalType,D=Q0(y,S,h,u);if(A===4)switch(D){case Ps.FLAT:{const z=Mo(h,u,y,!1);return new F1(m,z,S)}case Ps.SEQUENCE:{const z=zE(h,u,y);return new z1(m,z[0],z[1],y.numRleValues)}case Ps.CONST:{const z=V1(h,u,y,!1);return new B1(m,z,S)}}else switch(D){case Ps.FLAT:{if(T){const V=(function(X,ie,re,he){const me=(function(_e,Se,Be){const Me=new Float64Array(Se);for(let Ae=0;Ae<Se;Ae++)Me[Ae]=CN(_e,Be);return Me})(X,re.numValues,ie);return(function(_e,Se,Be){switch(Se.logicalLevelTechnique1){case mn.DELTA:return Se.logicalLevelTechnique2===mn.RLE&&(_e=FE(_e,Se.runs,Se.numRleValues)),(function(Me){Me[0]=Me[0]%2==1?(Me[0]+1)/-2:Me[0]/2;const Ae=Me.length/4*4;let Ve=1;if(Ae>=4)for(;Ve<Ae-4;Ve+=4){const qe=Me[Ve],_t=Me[Ve+1],Vt=Me[Ve+2],Rt=Me[Ve+3];Me[Ve]=(qe%2==1?(qe+1)/-2:qe/2)+Me[Ve-1],Me[Ve+1]=(_t%2==1?(_t+1)/-2:_t/2)+Me[Ve],Me[Ve+2]=(Vt%2==1?(Vt+1)/-2:Vt/2)+Me[Ve+1],Me[Ve+3]=(Rt%2==1?(Rt+1)/-2:Rt/2)+Me[Ve+2]}for(;Ve!=Me.length;++Ve)Me[Ve]=(Me[Ve]%2==1?(Me[Ve]+1)/-2:Me[Ve]/2)+Me[Ve-1]})(_e),_e;case mn.RLE:return(function(Me,Ae,Ve){return FE(Me,Ae.runs,Ae.numRleValues)})(_e,Se);case mn.NONE:return _e;default:throw new Error(`The specified Logical level technique is not supported: ${Se.logicalLevelTechnique1}`)}})(me,re)})(h,u,y);return new O1(m,V,S)}const z=NE(h,u,y,!1);return new VE(m,z,S)}case Ps.SEQUENCE:{const z=BE(h,u,y);return new UE(m,z[0],z[1],y.numRleValues)}case Ps.CONST:{const z=$E(h,u,y,!1);return new JE(m,z,S)}}throw new Error("Vector type not supported for id column.")}class VN{constructor(a,u){var m;switch(this._featureData=a,this.properties=this._featureData.properties||{},(m=this._featureData.geometry)===null||m===void 0?void 0:m.type){case Is.POINT:case Is.MULTIPOINT:this.type=1;break;case Is.LINESTRING:case Is.MULTILINESTRING:this.type=2;break;case Is.POLYGON:case Is.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=u,this.id=Number(this._featureData.id)}loadGeometry(){const a=[];for(const u of this._featureData.geometry.coordinates){const m=[];for(const y of u)m.push(new f(y.x,y.y));a.push(m)}return a}}class UN{constructor(a){this.features=[],this.featureTable=a,this.name=a.name,this.extent=a.extent,this.version=2,this.features=a.getFeatures(),this.length=this.features.length}feature(a){return new VN(this.features[a],this.extent)}}class rA{constructor(a){this.layers={};const u=(function(m,y,S=!0){const T=new MN(0),A=[];for(;T.get()<m.length;){const D=Us(m,T,1)[0]>>>0,z=T.get()+D;if(z>m.length)throw new Error(`Block overruns tile: ${z} > ${m.length}`);if(Us(m,T,1)[0]>>>0!=1){T.set(z);continue}const V=NN(m,T),X=V[1],ie=V[0].featureTables[0];let re=null,he=null;const me=[];let _e=0;for(const Be of ie.columns){const Me=Be.name;if(Me==="id"){let Ae=null;if(Be.nullable){const qe=To(m,T),_t=T.get(),Vt=Q_(m,qe.numValues,T);T.set(_t+qe.byteLength),Ae=new oc(Vt,qe.numValues)}const Ve=To(m,T);_e=Ve.decompressedCount,re=$N(m,Be,T,Me,Ve,Ae??_e,S)}else if(Me==="geometry"){const Ae=Us(m,T,1)[0];if(_e===0){const Ve=T.get();_e=To(m,T).decompressedCount,T.set(Ve)}he=LN(m,Ae,T,_e)}else{const Ae=ON(Be)?Us(m,T,1)[0]:1;if(Ae===0&&Be.type==="scalarType")continue;const Ve=FN(m,T,Be,Ae,_e);if(Ve)if(Array.isArray(Ve))for(const qe of Ve)me.push(qe);else me.push(Ve)}}const Se=new TN(ie.name,he,re,me,X);A.push(Se),T.set(z)}return A})(new Uint8Array(a));this.layers=u.reduce(((m,y)=>Object.assign(Object.assign({},m),{[y.name]:new UN(y)})),{})}}class jN{constructor(a,u){this.feature=a,this.type=a.type,this.properties=a.tags?a.tags:{},this.extent=u,"id"in a&&(typeof a.id=="string"?this.id=parseInt(a.id,10):typeof a.id!="number"||isNaN(a.id)||(this.id=a.id))}loadGeometry(){const a=[],u=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const m of u){const y=[];for(const S of m)y.push(new f(S[0],S[1]));a.push(y)}return a}}const tv="_geojsonTileLayer";function GN(h,a){a.writeVarintField(15,h.version||1),a.writeStringField(1,h.name||""),a.writeVarintField(5,h.extent||4096);const u={keys:[],values:[],keycache:{},valuecache:{}};for(let S=0;S<h.length;S++)u.feature=h.feature(S),a.writeMessage(2,qN,u);const m=u.keys;for(const S of m)a.writeStringField(3,S);const y=u.values;for(const S of y)a.writeMessage(4,ZN,S)}function qN(h,a){if(!h.feature)return;const u=h.feature;u.id!==void 0&&a.writeVarintField(1,u.id),a.writeMessage(2,HN,h),a.writeVarintField(3,u.type),a.writeMessage(4,WN,u)}function HN(h,a){for(const u in h.feature?.properties){let m=h.feature.properties[u],y=h.keycache[u];if(m==null)continue;y===void 0&&(h.keys.push(u),y=h.keys.length-1,h.keycache[u]=y),a.writeVarint(y),typeof m!="string"&&typeof m!="boolean"&&typeof m!="number"&&(m=JSON.stringify(m));const S=typeof m+":"+m;let T=h.valuecache[S];T===void 0&&(h.values.push(m),T=h.values.length-1,h.valuecache[S]=T),a.writeVarint(T)}}function Y1(h,a){return(a<<3)+(7&h)}function sA(h){return h<<1^h>>31}function WN(h,a){const u=h.loadGeometry(),m=h.type;let y=0,S=0;for(const T of u){let A=1;m===1&&(A=T.length),a.writeVarint(Y1(1,A));const D=m===3?T.length-1:T.length;for(let z=0;z<D;z++){z===1&&m!==1&&a.writeVarint(Y1(2,D-1));const V=T[z].x-y,X=T[z].y-S;a.writeVarint(sA(V)),a.writeVarint(sA(X)),y+=V,S+=X}h.type===3&&a.writeVarint(Y1(7,1))}}function ZN(h,a){const u=typeof h;u==="string"?a.writeStringField(1,h):u==="boolean"?a.writeBooleanField(7,h):u==="number"&&(h%1!=0?a.writeDoubleField(3,h):h<0?a.writeSVarintField(6,h):a.writeVarintField(5,h))}class oA{constructor(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Kh(Ce,16,0),this.grid3D=new Kh(Ce,16,0),this.featureIndexArray=new be,this.promoteId=u}insert(a,u,m,y,S,T){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,y,S);const D=T?this.grid3D:this.grid;for(let z=0;z<u.length;z++){const V=u[z],X=[1/0,1/0,-1/0,-1/0];for(let ie=0;ie<V.length;ie++){const re=V[ie];X[0]=Math.min(X[0],re.x),X[1]=Math.min(X[1],re.y),X[2]=Math.max(X[2],re.x),X[3]=Math.max(X[3],re.y)}X[0]<Ce&&X[1]<Ce&&X[2]>=0&&X[3]>=0&&D.insert(A,X[0],X[1],X[2],X[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new qC(new q0(this.rawTileData)).layers:new rA(this.rawTileData).layers,this.sourceLayerCoder=new AE(this.vtLayers?Object.keys(this.vtLayers).sort():[tv])),this.vtLayers}query(a,u,m,y){this.loadVTLayers();const S=a.params,T=Ce/a.tileSize/a.scale,A=af(S.filter,S.globalState),D=a.queryGeometry,z=a.queryPadding*T,V=Lf.fromPoints(D),X=this.grid.query(V.minX-z,V.minY-z,V.maxX+z,V.maxY+z),ie=Lf.fromPoints(a.cameraQueryGeometry).expandBy(z),re=this.grid3D.query(ie.minX,ie.minY,ie.maxX,ie.maxY,((_e,Se,Be,Me)=>(function(Ae,Ve,qe,_t,Vt){for(const Ht of Ae)if(Ve<=Ht.x&&qe<=Ht.y&&_t>=Ht.x&&Vt>=Ht.y)return!0;const Rt=[new f(Ve,qe),new f(Ve,Vt),new f(_t,Vt),new f(_t,qe)];if(Ae.length>2){for(const Ht of Rt)if(mm(Ae,Ht))return!0}for(let Ht=0;Ht<Ae.length-1;Ht++)if(Yz(Ae[Ht],Ae[Ht+1],Rt))return!0;return!1})(a.cameraQueryGeometry,_e-z,Se-z,Be+z,Me+z)));for(const _e of re)X.push(_e);X.sort(XN);const he={};let me;for(let _e=0;_e<X.length;_e++){const Se=X[_e];if(Se===me)continue;me=Se;const Be=this.featureIndexArray.get(Se);let Me=null;this.loadMatchingFeature(he,Be.bucketIndex,Be.sourceLayerIndex,Be.featureIndex,A,S.layers,S.availableImages,u,m,y,((Ae,Ve,qe)=>(Me||(Me=qc(Ae)),Ve.queryIntersectsFeature({queryGeometry:D,feature:Ae,featureState:qe,geometry:Me,zoom:this.z,transform:a.transform,pixelsToTileUnits:T,pixelPosMatrix:a.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:a.getElevation}))))}return he}loadMatchingFeature(a,u,m,y,S,T,A,D,z,V,X){const ie=this.bucketLayerIDs[u];if(T&&!ie.some((_e=>T.has(_e))))return;const re=this.sourceLayerCoder.decode(m),he=this.vtLayers[re].feature(y);if(S.needGeometry){const _e=Hc(he,!0);if(!S.filter(new Gn(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!S.filter(new Gn(this.tileID.overscaledZ),he))return;const me=this.getId(he,re);for(let _e=0;_e<ie.length;_e++){const Se=ie[_e];if(T&&!T.has(Se))continue;const Be=D[Se];if(!Be)continue;let Me={};me&&V&&(Me=V.getState(Be.sourceLayer||tv,me));const Ae=Lt({},z[Se]);Ae.paint=aA(Ae.paint,Be.paint,he,Me,A),Ae.layout=aA(Ae.layout,Be.layout,he,Me,A);const Ve=!X||X(he,Be,Me);if(!Ve)continue;const qe=new PE(he,this.z,this.x,this.y,me);qe.layer=Ae;let _t=a[Se];_t===void 0&&(_t=a[Se]=[]),_t.push({featureIndex:y,feature:qe,intersectionZ:Ve})}}lookupSymbolFeatures(a,u,m,y,S,T,A,D){const z={};this.loadVTLayers();const V=af(S.filterSpec,S.globalState);for(const X of a)this.loadMatchingFeature(z,m,y,X,V,T,A,D,u);return z}hasLayer(a){for(const u of this.bucketLayerIDs)for(const m of u)if(a===m)return!0;return!1}getId(a,u){var m;let y=a.id;return this.promoteId&&(y=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof y=="boolean"&&(y=Number(y)),y===void 0&&(!((m=a.properties)===null||m===void 0)&&m.cluster)&&this.promoteId&&(y=Number(a.properties.cluster_id))),y}}function aA(h,a,u,m,y){return Nt(h,((S,T)=>{const A=a instanceof bf?a.get(T):null;return A&&A.evaluate?A.evaluate(u,m,y):A}))}function XN(h,a){return a-h}function lA(h,a,u,m,y){const S=[];for(let T=0;T<h.length;T++){const A=h[T];let D;for(let z=0;z<A.length-1;z++){let V=A[z],X=A[z+1];V.x<a&&X.x<a||(V.x<a?V=new f(a,V.y+(a-V.x)/(X.x-V.x)*(X.y-V.y))._round():X.x<a&&(X=new f(a,V.y+(a-V.x)/(X.x-V.x)*(X.y-V.y))._round()),V.y<u&&X.y<u||(V.y<u?V=new f(V.x+(u-V.y)/(X.y-V.y)*(X.x-V.x),u)._round():X.y<u&&(X=new f(V.x+(u-V.y)/(X.y-V.y)*(X.x-V.x),u)._round()),V.x>=m&&X.x>=m||(V.x>=m?V=new f(m,V.y+(m-V.x)/(X.x-V.x)*(X.y-V.y))._round():X.x>=m&&(X=new f(m,V.y+(m-V.x)/(X.x-V.x)*(X.y-V.y))._round()),V.y>=y&&X.y>=y||(V.y>=y?V=new f(V.x+(y-V.y)/(X.y-V.y)*(X.x-V.x),y)._round():X.y>=y&&(X=new f(V.x+(y-V.y)/(X.y-V.y)*(X.x-V.x),y)._round()),D&&V.equals(D[D.length-1])||(D=[V],S.push(D)),D.push(X)))))}}return S}function cA(h,a,u,m,y){switch(a){case 1:return(function(S,T,A,D){const z=[];for(const V of S)for(const X of V){const ie=D===0?X.x:X.y;ie>=T&&ie<=A&&z.push([X])}return z})(h,u,m,y);case 2:return uA(h,u,m,y,!1);case 3:return uA(h,u,m,y,!0)}return[]}function YN(h,a,u,m,y){const S=m===0?KN:JN;let T=[];const A=[];for(let V=0;V<h.length-1;V++){const X=h[V],ie=h[V+1],re=m===0?X.x:X.y,he=m===0?ie.x:ie.y;let me=!1;re<a?he>a&&T.push(S(X,ie,a)):re>u?he<u&&T.push(S(X,ie,u)):T.push(X),he<a&&re>=a&&(T.push(S(X,ie,a)),me=!0),he>u&&re<=u&&(T.push(S(X,ie,u)),me=!0),!y&&me&&(A.push(T),T=[])}const D=h.length-1,z=m===0?h[D].x:h[D].y;return z>=a&&z<=u&&T.push(h[D]),y&&T.length>0&&!T[0].equals(T[T.length-1])&&T.push(new f(T[0].x,T[0].y)),T.length>0&&A.push(T),A}function uA(h,a,u,m,y){const S=[];for(const T of h){const A=YN(T,a,u,m,y);A.length>0&&S.push(...A)}return S}function KN(h,a,u){return new f(u,h.y+(u-h.x)/(a.x-h.x)*(a.y-h.y))}function JN(h,a,u){return new f(h.x+(u-h.y)/(a.y-h.y)*(a.x-h.x),u)}mi("FeatureIndex",oA,{omit:["rawTileData","sourceLayerCoder"]});class sd extends f{constructor(a,u,m,y){super(a,u),this.angle=m,y!==void 0&&(this.segment=y)}clone(){return new sd(this.x,this.y,this.angle,this.segment)}}function hA(h,a,u,m,y){if(a.segment===void 0||u===0)return!0;let S=a,T=a.segment+1,A=0;for(;A>-u/2;){if(T--,T<0)return!1;A-=h[T].dist(S),S=h[T]}A+=h[T].dist(h[T+1]),T++;const D=[];let z=0;for(;A<u/2;){const V=h[T],X=h[T+1];if(!X)return!1;let ie=h[T-1].angleTo(V)-V.angleTo(X);for(ie=Math.abs((ie+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:A,angleDelta:ie}),z+=ie;A-D[0].distance>m;)z-=D.shift().angleDelta;if(z>y)return!1;T++,A+=V.dist(X)}return!0}function dA(h){let a=0;for(let u=0;u<h.length-1;u++)a+=h[u].dist(h[u+1]);return a}function fA(h,a,u){return h?.6*a*u:0}function pA(h,a){return Math.max(h?h.right-h.left:0,a?a.right-a.left:0)}function QN(h,a,u,m,y,S){const T=fA(u,y,S),A=pA(u,m)*S;let D=0;const z=dA(h)/2;for(let V=0;V<h.length-1;V++){const X=h[V],ie=h[V+1],re=X.dist(ie);if(D+re>z){const he=(z-D)/re,me=rr.number(X.x,ie.x,he),_e=rr.number(X.y,ie.y,he),Se=new sd(me,_e,ie.angleTo(X),V);return Se._round(),!T||hA(h,Se,A,T,a)?Se:void 0}D+=re}}function e4(h,a,u,m,y,S,T,A,D){const z=fA(m,S,T),V=pA(m,y),X=V*T,ie=h[0].x===0||h[0].x===D||h[0].y===0||h[0].y===D;return a-X<a/4&&(a=X+a/4),mA(h,ie?a/2*A%a:(V/2+2*S)*T*A%a,a,z,u,X,ie,!1,D)}function mA(h,a,u,m,y,S,T,A,D){const z=S/2,V=dA(h);let X=0,ie=a-u,re=[];for(let he=0;he<h.length-1;he++){const me=h[he],_e=h[he+1],Se=me.dist(_e),Be=_e.angleTo(me);for(;ie+u<X+Se;){ie+=u;const Me=(ie-X)/Se,Ae=rr.number(me.x,_e.x,Me),Ve=rr.number(me.y,_e.y,Me);if(Ae>=0&&Ae<D&&Ve>=0&&Ve<D&&ie-z>=0&&ie+z<=V){const qe=new sd(Ae,Ve,Be,he);qe._round(),m&&!hA(h,qe,S,m,y)||re.push(qe)}}X+=Se}return A||re.length||T||(re=mA(h,X/2,u,m,y,S,T,!0,D)),re}function gA(h,a,u,m){const y=[],S=h.image,T=S.pixelRatio,A=S.paddedRect.w-2,D=S.paddedRect.h-2;let z={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const V=S.stretchX||[[0,A]],X=S.stretchY||[[0,D]],ie=(St,fi)=>St+fi[1]-fi[0],re=V.reduce(ie,0),he=X.reduce(ie,0),me=A-re,_e=D-he;let Se=0,Be=re,Me=0,Ae=he,Ve=0,qe=me,_t=0,Vt=_e;if(S.content&&m){const St=S.content,fi=St[2]-St[0],hi=St[3]-St[1];(S.textFitWidth||S.textFitHeight)&&(z=hE(h)),Se=nb(V,0,St[0]),Me=nb(X,0,St[1]),Be=nb(V,St[0],St[2]),Ae=nb(X,St[1],St[3]),Ve=St[0]-Se,_t=St[1]-Me,qe=fi-Be,Vt=hi-Ae}const Rt=z.x1,Ht=z.y1,ni=z.x2-Rt,Yt=z.y2-Ht,Ft=(St,fi,hi,_i)=>{const ci=rb(St.stretch-Se,Be,ni,Rt),Ci=sb(St.fixed-Ve,qe,St.stretch,re),wn=rb(fi.stretch-Me,Ae,Yt,Ht),un=sb(fi.fixed-_t,Vt,fi.stretch,he),wr=rb(hi.stretch-Se,Be,ni,Rt),eo=sb(hi.fixed-Ve,qe,hi.stretch,re),hs=rb(_i.stretch-Me,Ae,Yt,Ht),Sr=sb(_i.fixed-_t,Vt,_i.stretch,he),mr=new f(ci,wn),In=new f(wr,wn),Nr=new f(wr,hs),Xr=new f(ci,hs),or=new f(Ci/T,un/T),Wo=new f(eo/T,Sr/T),to=a*Math.PI/180;if(to){const Ls=Math.sin(to),Lr=Math.cos(to),ds=[Lr,-Ls,Ls,Lr];mr._matMult(ds),In._matMult(ds),Xr._matMult(ds),Nr._matMult(ds)}const Zo=St.stretch+St.fixed,wl=fi.stretch+fi.fixed;return{tl:mr,tr:In,bl:Xr,br:Nr,tex:{x:S.paddedRect.x+1+Zo,y:S.paddedRect.y+1+wl,w:hi.stretch+hi.fixed-Zo,h:_i.stretch+_i.fixed-wl},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:or,pixelOffsetBR:Wo,minFontScaleX:qe/T/ni,minFontScaleY:Vt/T/Yt,isSDF:u}};if(m&&(S.stretchX||S.stretchY)){const St=_A(V,me,re),fi=_A(X,_e,he);for(let hi=0;hi<St.length-1;hi++){const _i=St[hi],ci=St[hi+1];for(let Ci=0;Ci<fi.length-1;Ci++)y.push(Ft(_i,fi[Ci],ci,fi[Ci+1]))}}else y.push(Ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:D+1}));return y}function nb(h,a,u){let m=0;for(const y of h)m+=Math.max(a,Math.min(u,y[1]))-Math.max(a,Math.min(u,y[0]));return m}function _A(h,a,u){const m=[{fixed:-1,stretch:0}];for(const[y,S]of h){const T=m[m.length-1];m.push({fixed:y-T.stretch,stretch:T.stretch}),m.push({fixed:y-T.stretch,stretch:T.stretch+(S-y)})}return m.push({fixed:a+1,stretch:u}),m}function rb(h,a,u,m){return h/a*u+m}function sb(h,a,u,m){return h-a*u/m}mi("Anchor",sd);class ob{constructor(a,u,m,y,S,T,A,D,z,V){var X;if(this.boxStartIndex=a.length,z){let ie=T.top,re=T.bottom;const he=T.collisionPadding;he&&(ie-=he[1],re+=he[3]);let me=re-ie;me>0&&(me=Math.max(10,me),this.circleDiameter=me)}else{const ie=!((X=T.image)===null||X===void 0)&&X.content&&(T.image.textFitWidth||T.image.textFitHeight)?hE(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};ie.y1=ie.y1*A-D[0],ie.y2=ie.y2*A+D[2],ie.x1=ie.x1*A-D[3],ie.x2=ie.x2*A+D[1];const re=T.collisionPadding;if(re&&(ie.x1-=re[0]*A,ie.y1-=re[1]*A,ie.x2+=re[2]*A,ie.y2+=re[3]*A),V){const he=new f(ie.x1,ie.y1),me=new f(ie.x2,ie.y1),_e=new f(ie.x1,ie.y2),Se=new f(ie.x2,ie.y2),Be=V*Math.PI/180;he._rotate(Be),me._rotate(Be),_e._rotate(Be),Se._rotate(Be),ie.x1=Math.min(he.x,me.x,_e.x,Se.x),ie.x2=Math.max(he.x,me.x,_e.x,Se.x),ie.y1=Math.min(he.y,me.y,_e.y,Se.y),ie.y2=Math.max(he.y,me.y,_e.y,Se.y)}a.emplaceBack(u.x,u.y,ie.x1,ie.y1,ie.x2,ie.y2,m,y,S)}this.boxEndIndex=a.length}}class t4{constructor(a=[],u=(m,y)=>m<y?-1:m>y?1:0){if(this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:u,compare:m}=this,y=u[a];for(;a>0;){const S=a-1>>1,T=u[S];if(m(y,T)>=0)break;u[a]=T,a=S}u[a]=y}_down(a){const{data:u,compare:m}=this,y=this.length>>1,S=u[a];for(;a<y;){let T=1+(a<<1);const A=T+1;if(A<this.length&&m(u[A],u[T])<0&&(T=A),m(u[T],S)>=0)break;u[a]=u[T],a=T}u[a]=S}}function i4(h,a=1,u=!1){const m=Lf.fromPoints(h[0]),y=Math.min(m.width(),m.height());let S=y/2;const T=new t4([],n4),{minX:A,minY:D,maxX:z,maxY:V}=m;if(y===0)return new f(A,D);for(let re=A;re<z;re+=y)for(let he=D;he<V;he+=y)T.push(new Am(re+S,he+S,S,h));let X=(function(re){let he=0,me=0,_e=0;const Se=re[0];for(let Be=0,Me=Se.length,Ae=Me-1;Be<Me;Ae=Be++){const Ve=Se[Be],qe=Se[Ae],_t=Ve.x*qe.y-qe.x*Ve.y;me+=(Ve.x+qe.x)*_t,_e+=(Ve.y+qe.y)*_t,he+=3*_t}return new Am(me/he,_e/he,0,re)})(h),ie=T.length;for(;T.length;){const re=T.pop();(re.d>X.d||!X.d)&&(X=re,u&&console.log("found best %d after %d probes",Math.round(1e4*re.d)/1e4,ie)),re.max-X.d<=a||(S=re.h/2,T.push(new Am(re.p.x-S,re.p.y-S,S,h)),T.push(new Am(re.p.x+S,re.p.y-S,S,h)),T.push(new Am(re.p.x-S,re.p.y+S,S,h)),T.push(new Am(re.p.x+S,re.p.y+S,S,h)),ie+=4)}return u&&(console.log(`num probes: ${ie}`),console.log(`best distance: ${X.d}`)),X.p}function n4(h,a){return a.max-h.max}function Am(h,a,u,m){this.p=new f(h,a),this.h=u,this.d=(function(y,S){let T=!1,A=1/0;for(let D=0;D<S.length;D++){const z=S[D];for(let V=0,X=z.length,ie=X-1;V<X;ie=V++){const re=z[V],he=z[ie];re.y>y.y!=he.y>y.y&&y.x<(he.x-re.x)*(y.y-re.y)/(he.y-re.y)+re.x&&(T=!T),A=Math.min(A,wC(y,re,he))}}return(T?1:-1)*Math.sqrt(A)})(this.p,m),this.max=this.d+this.h*Math.SQRT2}var Qs;c.aP=void 0,(Qs=c.aP||(c.aP={}))[Qs.center=1]="center",Qs[Qs.left=2]="left",Qs[Qs.right=3]="right",Qs[Qs.top=4]="top",Qs[Qs.bottom=5]="bottom",Qs[Qs["top-left"]=6]="top-left",Qs[Qs["top-right"]=7]="top-right",Qs[Qs["bottom-left"]=8]="bottom-left",Qs[Qs["bottom-right"]=9]="bottom-right";const K1=Number.POSITIVE_INFINITY;function vA(h,a){return a[1]!==K1?(function(u,m,y){let S=0,T=0;switch(m=Math.abs(m),y=Math.abs(y),u){case"top-right":case"top-left":case"top":T=y-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-y}switch(u){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,T]})(h,a[0],a[1]):(function(u,m){let y=0,S=0;m<0&&(m=0);const T=m/Math.SQRT2;switch(u){case"top-right":case"top-left":S=T-7;break;case"bottom-right":case"bottom-left":S=7-T;break;case"bottom":S=7-m;break;case"top":S=m-7}switch(u){case"top-right":case"bottom-right":y=-T;break;case"top-left":case"bottom-left":y=T;break;case"left":y=m;break;case"right":y=-m}return[y,S]})(h,a[0])}function yA(h,a,u){var m;const y=h.layout,S=(m=y.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(a,{},u);if(S){const A=S.values,D=[];for(let z=0;z<A.length;z+=2){const V=D[z]=A[z],X=A[z+1].map((ie=>ie*As));V.startsWith("top")?X[1]-=7:V.startsWith("bottom")&&(X[1]+=7),D[z+1]=X}return new Ss(D)}const T=y.get("text-variable-anchor");if(T){let A;A=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(a,{},u)*As,K1]:y.get("text-offset").evaluate(a,{},u).map((z=>z*As));const D=[];for(const z of T)D.push(z,vA(z,A));return new Ss(D)}return null}function J1(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function r4(h,a,u,m,y,S,T,A,D,z,V,X){let ie=S.textMaxSize.evaluate(a,{});ie===void 0&&(ie=T);const re=h.layers[0].layout,he=re.get("icon-offset").evaluate(a,{},V),me=xA(u.horizontal),_e=T/24,Se=h.tilePixelRatio*_e,Be=h.tilePixelRatio*ie/24,Me=h.tilePixelRatio*A,Ae=h.tilePixelRatio*re.get("symbol-spacing"),Ve=re.get("text-padding")*h.tilePixelRatio,qe=(function(hi,_i,ci,Ci=1){const wn=hi.get("icon-padding").evaluate(_i,{},ci),un=wn&&wn.values;return[un[0]*Ci,un[1]*Ci,un[2]*Ci,un[3]*Ci]})(re,a,V,h.tilePixelRatio),_t=re.get("text-max-angle")/180*Math.PI,Vt=re.get("text-rotation-alignment")!=="viewport"&&re.get("symbol-placement")!=="point",Rt=re.get("icon-rotation-alignment")==="map"&&re.get("symbol-placement")!=="point",Ht=re.get("symbol-placement"),ni=Ae/2,Yt=re.get("icon-text-fit");let Ft;m&&Yt!=="none"&&(h.allowVerticalPlacement&&u.vertical&&(Ft=dE(m,u.vertical,Yt,re.get("icon-text-fit-padding"),he,_e)),me&&(m=dE(m,me,Yt,re.get("icon-text-fit-padding"),he,_e)));const St=V?X.line.getGranularityForZoomLevel(V.z):1,fi=(hi,_i)=>{_i.x<0||_i.x>=Ce||_i.y<0||_i.y>=Ce||(function(ci,Ci,wn,un,wr,eo,hs,Sr,mr,In,Nr,Xr,or,Wo,to,Zo,wl,Ls,Lr,ds,$r,Rs,Xu,ac,rv){const od=ci.addToLineVertexArray(Ci,wn);let Df,Pm,Im,Lm,MA=0,CA=0,EA=0,AA=0,oS=-1,aS=-1;const Yu={};let PA=Zr("");if(ci.allowVerticalPlacement&&un.vertical){const co=Sr.layout.get("text-rotate").evaluate($r,{},ac)+90;Im=new ob(mr,Ci,In,Nr,Xr,un.vertical,or,Wo,to,co),hs&&(Lm=new ob(mr,Ci,In,Nr,Xr,hs,wl,Ls,to,co))}if(wr){const co=Sr.layout.get("icon-rotate").evaluate($r,{}),Ua=Sr.layout.get("icon-text-fit")!=="none",Ff=gA(wr,co,Xu,Ua),cc=hs?gA(hs,co,Xu,Ua):void 0;Pm=new ob(mr,Ci,In,Nr,Xr,wr,wl,Ls,!1,co),MA=4*Ff.length;const Of=ci.iconSizeData;let Wc=null;Of.kind==="source"?(Wc=[Wu*Sr.layout.get("icon-size").evaluate($r,{})],Wc[0]>id&&Mt(`${ci.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Of.kind==="composite"&&(Wc=[Wu*Rs.compositeIconSizes[0].evaluate($r,{},ac),Wu*Rs.compositeIconSizes[1].evaluate($r,{},ac)],(Wc[0]>id||Wc[1]>id)&&Mt(`${ci.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ci.addSymbols(ci.icon,Ff,Wc,ds,Lr,$r,c.az.none,Ci,od.lineStartIndex,od.lineLength,-1,ac),oS=ci.icon.placedSymbolArray.length-1,cc&&(CA=4*cc.length,ci.addSymbols(ci.icon,cc,Wc,ds,Lr,$r,c.az.vertical,Ci,od.lineStartIndex,od.lineLength,-1,ac),aS=ci.icon.placedSymbolArray.length-1)}const IA=Object.keys(un.horizontal);for(const co of IA){const Ua=un.horizontal[co];if(!Df){PA=Zr(Ua.text);const cc=Sr.layout.get("text-rotate").evaluate($r,{},ac);Df=new ob(mr,Ci,In,Nr,Xr,Ua,or,Wo,to,cc)}const Ff=Ua.positionedLines.length===1;if(EA+=bA(ci,Ci,Ua,eo,Sr,to,$r,Zo,od,un.vertical?c.az.horizontal:c.az.horizontalOnly,Ff?IA:[co],Yu,oS,Rs,ac),Ff)break}un.vertical&&(AA+=bA(ci,Ci,un.vertical,eo,Sr,to,$r,Zo,od,c.az.vertical,["vertical"],Yu,aS,Rs,ac));const a4=Df?Df.boxStartIndex:ci.collisionBoxArray.length,l4=Df?Df.boxEndIndex:ci.collisionBoxArray.length,c4=Im?Im.boxStartIndex:ci.collisionBoxArray.length,u4=Im?Im.boxEndIndex:ci.collisionBoxArray.length,h4=Pm?Pm.boxStartIndex:ci.collisionBoxArray.length,d4=Pm?Pm.boxEndIndex:ci.collisionBoxArray.length,f4=Lm?Lm.boxStartIndex:ci.collisionBoxArray.length,p4=Lm?Lm.boxEndIndex:ci.collisionBoxArray.length;let lc=-1;const lb=(co,Ua)=>co&&co.circleDiameter?Math.max(co.circleDiameter,Ua):Ua;lc=lb(Df,lc),lc=lb(Im,lc),lc=lb(Pm,lc),lc=lb(Lm,lc);const LA=lc>-1?1:0;LA&&(lc*=rv/As),ci.glyphOffsetArray.length>=wm.MAX_GLYPHS&&Mt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$r.sortKey!==void 0&&ci.addToSortKeyRanges(ci.symbolInstances.length,$r.sortKey);const m4=yA(Sr,$r,ac),[g4,_4]=(function(co,Ua){const Ff=co.length,cc=Ua?.values;if(cc?.length>0)for(let Of=0;Of<cc.length;Of+=2){const Wc=cc[Of+1];co.emplaceBack(c.aP[cc[Of]],Wc[0],Wc[1])}return[Ff,co.length]})(ci.textAnchorOffsets,m4);ci.symbolInstances.emplaceBack(Ci.x,Ci.y,Yu.right>=0?Yu.right:-1,Yu.center>=0?Yu.center:-1,Yu.left>=0?Yu.left:-1,Yu.vertical||-1,oS,aS,PA,a4,l4,c4,u4,h4,d4,f4,p4,In,EA,AA,MA,CA,LA,0,or,lc,g4,_4)})(h,_i,hi,u,m,y,Ft,h.layers[0],h.collisionBoxArray,a.index,a.sourceLayerIndex,h.index,Se,[Ve,Ve,Ve,Ve],Vt,D,Me,qe,Rt,he,a,S,z,V,T)};if(Ht==="line")for(const hi of lA(a.geometry,0,0,Ce,Ce)){const _i=If(hi,St),ci=e4(_i,Ae,_t,u.vertical||me,m,24,Be,h.overscaling,Ce);for(const Ci of ci)me&&s4(h,me.text,ni,Ci)||fi(_i,Ci)}else if(Ht==="line-center"){for(const hi of a.geometry)if(hi.length>1){const _i=If(hi,St),ci=QN(_i,_t,u.vertical||me,m,24,Be);ci&&fi(_i,ci)}}else if(a.type==="Polygon")for(const hi of Uh(a.geometry,0)){const _i=i4(hi,16);fi(If(hi[0],St,!0),new sd(_i.x,_i.y,0))}else if(a.type==="LineString")for(const hi of a.geometry){const _i=If(hi,St);fi(_i,new sd(_i[0].x,_i[0].y,0))}else if(a.type==="Point")for(const hi of a.geometry)for(const _i of hi)fi([_i],new sd(_i.x,_i.y,0))}function bA(h,a,u,m,y,S,T,A,D,z,V,X,ie,re,he){const me=(function(Be,Me,Ae,Ve,qe,_t,Vt,Rt){const Ht=Ve.layout.get("text-rotate").evaluate(_t,{})*Math.PI/180,ni=[];for(const Yt of Me.positionedLines)for(const Ft of Yt.positionedGlyphs){if(!Ft.rect)continue;const St=Ft.rect||{};let fi=4,hi=!0,_i=1,ci=0;const Ci=(qe||Rt)&&Ft.vertical,wn=Ft.metrics.advance*Ft.scale/2;if(Rt&&Me.verticalizable&&(ci=Yt.lineOffset/2-(Ft.imageName?-(As-Ft.metrics.width*Ft.scale)/2:(Ft.scale-1)*As)),Ft.imageName){const Ls=Vt[Ft.imageName];hi=Ls.sdf,_i=Ls.pixelRatio,fi=1/_i}const un=qe?[Ft.x+wn,Ft.y]:[0,0];let wr=qe?[0,0]:[Ft.x+wn+Ae[0],Ft.y+Ae[1]-ci],eo=[0,0];Ci&&(eo=wr,wr=[0,0]);const hs=Ft.metrics.isDoubleResolution?2:1,Sr=(Ft.metrics.left-fi)*Ft.scale-wn+wr[0],mr=(-Ft.metrics.top-fi)*Ft.scale+wr[1],In=Sr+St.w/hs*Ft.scale/_i,Nr=mr+St.h/hs*Ft.scale/_i,Xr=new f(Sr,mr),or=new f(In,mr),Wo=new f(Sr,Nr),to=new f(In,Nr);if(Ci){const Ls=new f(-wn,wn- -17),Lr=-Math.PI/2,ds=12-wn,$r=new f(22-ds,-(Ft.imageName?ds:0)),Rs=new f(...eo);Xr._rotateAround(Lr,Ls)._add($r)._add(Rs),or._rotateAround(Lr,Ls)._add($r)._add(Rs),Wo._rotateAround(Lr,Ls)._add($r)._add(Rs),to._rotateAround(Lr,Ls)._add($r)._add(Rs)}if(Ht){const Ls=Math.sin(Ht),Lr=Math.cos(Ht),ds=[Lr,-Ls,Ls,Lr];Xr._matMult(ds),or._matMult(ds),Wo._matMult(ds),to._matMult(ds)}const Zo=new f(0,0),wl=new f(0,0);ni.push({tl:Xr,tr:or,bl:Wo,br:to,tex:St,writingMode:Me.writingMode,glyphOffset:un,sectionIndex:Ft.sectionIndex,isSDF:hi,pixelOffsetTL:Zo,pixelOffsetBR:wl,minFontScaleX:0,minFontScaleY:0})}return ni})(0,u,A,y,S,T,m,h.allowVerticalPlacement),_e=h.textSizeData;let Se=null;_e.kind==="source"?(Se=[Wu*y.layout.get("text-size").evaluate(T,{})],Se[0]>id&&Mt(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):_e.kind==="composite"&&(Se=[Wu*re.compositeTextSizes[0].evaluate(T,{},he),Wu*re.compositeTextSizes[1].evaluate(T,{},he)],(Se[0]>id||Se[1]>id)&&Mt(`${h.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),h.addSymbols(h.text,me,Se,A,S,T,z,a,D.lineStartIndex,D.lineLength,ie,he);for(const Be of V)X[Be]=h.text.placedSymbolArray.length-1;return 4*me.length}function xA(h){for(const a in h)return h[a];return null}function s4(h,a,u,m){const y=h.compareText;if(a in y){const S=y[a];for(let T=S.length-1;T>=0;T--)if(m.dist(S[T])<u)return!0}else y[a]=[];return y[a].push(m),!1}const wA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Q1{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,m]=new Uint8Array(a,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=m>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const S=wA[15&m];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(a,2,1),[A]=new Uint32Array(a,4,1);return new Q1(A,T,S,a)}constructor(a,u=64,m=Float64Array,y){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=m,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const S=wA.indexOf(this.ArrayType),T=2*a*this.ArrayType.BYTES_PER_ELEMENT,A=a*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-A%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+A+D,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+T+A+D),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+A+D,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=a)}add(a,u){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=a,this.coords[this._pos++]=u,m}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return eS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,u,m,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:A}=this,D=[0,S.length-1,0],z=[];for(;D.length;){const V=D.pop()||0,X=D.pop()||0,ie=D.pop()||0;if(X-ie<=A){for(let _e=ie;_e<=X;_e++){const Se=T[2*_e],Be=T[2*_e+1];Se>=a&&Se<=m&&Be>=u&&Be<=y&&z.push(S[_e])}continue}const re=ie+X>>1,he=T[2*re],me=T[2*re+1];he>=a&&he<=m&&me>=u&&me<=y&&z.push(S[re]),(V===0?a<=he:u<=me)&&(D.push(ie),D.push(re-1),D.push(1-V)),(V===0?m>=he:y>=me)&&(D.push(re+1),D.push(X),D.push(1-V))}return z}within(a,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:S,nodeSize:T}=this,A=[0,y.length-1,0],D=[],z=m*m;for(;A.length;){const V=A.pop()||0,X=A.pop()||0,ie=A.pop()||0;if(X-ie<=T){for(let _e=ie;_e<=X;_e++)TA(S[2*_e],S[2*_e+1],a,u)<=z&&D.push(y[_e]);continue}const re=ie+X>>1,he=S[2*re],me=S[2*re+1];TA(he,me,a,u)<=z&&D.push(y[re]),(V===0?a-m<=he:u-m<=me)&&(A.push(ie),A.push(re-1),A.push(1-V)),(V===0?a+m>=he:u+m>=me)&&(A.push(re+1),A.push(X),A.push(1-V))}return D}}function eS(h,a,u,m,y,S){if(y-m<=u)return;const T=m+y>>1;SA(h,a,T,m,y,S),eS(h,a,u,m,T-1,1-S),eS(h,a,u,T+1,y,1-S)}function SA(h,a,u,m,y,S){for(;y>m;){if(y-m>600){const z=y-m+1,V=u-m+1,X=Math.log(z),ie=.5*Math.exp(2*X/3),re=.5*Math.sqrt(X*ie*(z-ie)/z)*(V-z/2<0?-1:1);SA(h,a,u,Math.max(m,Math.floor(u-V*ie/z+re)),Math.min(y,Math.floor(u+(z-V)*ie/z+re)),S)}const T=a[2*u+S];let A=m,D=y;for(iv(h,a,m,u),a[2*y+S]>T&&iv(h,a,m,y);A<D;){for(iv(h,a,A,D),A++,D--;a[2*A+S]<T;)A++;for(;a[2*D+S]>T;)D--}a[2*m+S]===T?iv(h,a,m,D):(D++,iv(h,a,D,y)),D<=u&&(m=D+1),u<=D&&(y=D-1)}}function iv(h,a,u,m){tS(h,u,m),tS(a,2*u,2*m),tS(a,2*u+1,2*m+1)}function tS(h,a,u){const m=h[a];h[a]=h[u],h[u]=m}function TA(h,a,u,m){const y=h-u,S=a-m;return y*y+S*S}var iS;c.cH=void 0,(iS=c.cH||(c.cH={})).create="create",iS.load="load",iS.fullLoad="fullLoad";let ab=null,nv=[];const nS=1e3/60,rS="loadTime",sS="fullLoadTime",o4={mark(h){performance.mark(h)},frame(h){const a=h;ab!=null&&nv.push(a-ab),ab=a},clearMetrics(){ab=null,nv=[],performance.clearMeasures(rS),performance.clearMeasures(sS);for(const h in c.cH)performance.clearMarks(c.cH[h])},getPerformanceMetrics(){performance.measure(rS,c.cH.create,c.cH.load),performance.measure(sS,c.cH.create,c.cH.fullLoad);const h=performance.getEntriesByName(rS)[0].duration,a=performance.getEntriesByName(sS)[0].duration,u=nv.length,m=1/(nv.reduce(((S,T)=>S+T),0)/u/1e3),y=nv.filter((S=>S>nS)).reduce(((S,T)=>S+(T-nS)/nS),0);return{loadTime:h,fullLoadTime:a,fps:m,percentDroppedFrames:y/(u+y)*100,totalFrames:u}}};c.$=k,c.A=F,c.B=Yh,c.C=Cs,c.D=Mi,c.E=rn,c.F=function([h,a,u]){return a+=90,a*=Math.PI/180,u*=Math.PI/180,{x:h*Math.cos(a)*Math.sin(u),y:h*Math.sin(a)*Math.sin(u),z:h*Math.cos(u)}},c.G=rr,c.H=Gn,c.I=M1,c.J=M0,c.K=function(h){if(Ee==null){const a=h.navigator?h.navigator.userAgent:null;Ee=!!h.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ee},c.L=class{constructor(h,a){this.target=h,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new xN((()=>this.process())),this.subscription=Ie(this.target,"message",(u=>this.receive(u)),!1),this.globalScope=Pt(self)?h:window}registerMessageHandler(h,a){this.messageHandlers[h]=a}unregisterMessageHandler(h){delete this.messageHandlers[h]}sendAsync(h,a){return new Promise(((u,m)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10),S=a?Ie(a.signal,"abort",(()=>{S?.unsubscribe(),delete this.resolveRejects[y];const D={id:y,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(D)}),wN):null;this.resolveRejects[y]={resolve:D=>{S?.unsubscribe(),u(D)},reject:D=>{S?.unsubscribe(),m(D)}};const T=[],A=Object.assign(Object.assign({},h),{id:y,sourceMapId:this.mapId,origin:location.origin,data:gf(h.data,T)});this.target.postMessage(A,{transfer:T})}))}receive(h){const a=h.data,u=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!=="resource://android"&&location.origin!=="resource://android"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[u];const m=this.abortControllers[u];return delete this.abortControllers[u],void(m&&m.abort())}if(Pt(self)||a.mustQueue)return this.tasks[u]=a,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,a)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),a=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(h,a)}processTask(h,a){return s(this,void 0,void 0,(function*(){if(a.type==="<response>"){const y=this.resolveRejects[h];return delete this.resolveRejects[h],y?void(a.error?y.reject(_f(a.error)):y.resolve(_f(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=_f(a.data),m=new AbortController;this.abortControllers[h]=m;try{const y=yield this.messageHandlers[a.type](a.sourceMapId,u,m);this.completeTask(h,null,y)}catch(y){this.completeTask(h,y)}}))}completeTask(h,a,u){const m=[];delete this.abortControllers[h];const y={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?gf(a):null,data:gf(u,m)};this.target.postMessage(y,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.M=ot,c.N=function(){var h=new F(16);return F!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.O=function(h,a,u){var m,y,S,T,A,D,z,V,X,ie,re,he,me=u[0],_e=u[1],Se=u[2];return a===h?(h[12]=a[0]*me+a[4]*_e+a[8]*Se+a[12],h[13]=a[1]*me+a[5]*_e+a[9]*Se+a[13],h[14]=a[2]*me+a[6]*_e+a[10]*Se+a[14],h[15]=a[3]*me+a[7]*_e+a[11]*Se+a[15]):(y=a[1],S=a[2],T=a[3],A=a[4],D=a[5],z=a[6],V=a[7],X=a[8],ie=a[9],re=a[10],he=a[11],h[0]=m=a[0],h[1]=y,h[2]=S,h[3]=T,h[4]=A,h[5]=D,h[6]=z,h[7]=V,h[8]=X,h[9]=ie,h[10]=re,h[11]=he,h[12]=m*me+A*_e+X*Se+a[12],h[13]=y*me+D*_e+ie*Se+a[13],h[14]=S*me+z*_e+re*Se+a[14],h[15]=T*me+V*_e+he*Se+a[15]),h},c.P=f,c.Q=function(h,a,u){var m=u[0],y=u[1],S=u[2];return h[0]=a[0]*m,h[1]=a[1]*m,h[2]=a[2]*m,h[3]=a[3]*m,h[4]=a[4]*y,h[5]=a[5]*y,h[6]=a[6]*y,h[7]=a[7]*y,h[8]=a[8]*S,h[9]=a[9]*S,h[10]=a[10]*S,h[11]=a[11]*S,h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.R=Ho,c.S=function(h,a,u){var m=a[0],y=a[1],S=a[2],T=a[3],A=a[4],D=a[5],z=a[6],V=a[7],X=a[8],ie=a[9],re=a[10],he=a[11],me=a[12],_e=a[13],Se=a[14],Be=a[15],Me=u[0],Ae=u[1],Ve=u[2],qe=u[3];return h[0]=Me*m+Ae*A+Ve*X+qe*me,h[1]=Me*y+Ae*D+Ve*ie+qe*_e,h[2]=Me*S+Ae*z+Ve*re+qe*Se,h[3]=Me*T+Ae*V+Ve*he+qe*Be,h[4]=(Me=u[4])*m+(Ae=u[5])*A+(Ve=u[6])*X+(qe=u[7])*me,h[5]=Me*y+Ae*D+Ve*ie+qe*_e,h[6]=Me*S+Ae*z+Ve*re+qe*Se,h[7]=Me*T+Ae*V+Ve*he+qe*Be,h[8]=(Me=u[8])*m+(Ae=u[9])*A+(Ve=u[10])*X+(qe=u[11])*me,h[9]=Me*y+Ae*D+Ve*ie+qe*_e,h[10]=Me*S+Ae*z+Ve*re+qe*Se,h[11]=Me*T+Ae*V+Ve*he+qe*Be,h[12]=(Me=u[12])*m+(Ae=u[13])*A+(Ve=u[14])*X+(qe=u[15])*me,h[13]=Me*y+Ae*D+Ve*ie+qe*_e,h[14]=Me*S+Ae*z+Ve*re+qe*Se,h[15]=Me*T+Ae*V+Ve*he+qe*Be,h},c.T=g1,c.U=function(h,a){const u={};for(let m=0;m<a.length;m++){const y=a[m];y in h&&(u[y]=h[y])}return u},c.V=nd,c.W=zt,c.X=xE,c.Y=bE,c.Z=Pe,c._=s,c.a=de,c.a$=j,c.a0=L,c.a1=ve,c.a2=$a,c.a3=SE,c.a4=X0,c.a5=Ce,c.a6=function(h,a,u){if(!h)return a||{};if(!a)return h||{};const m=EE(h),y=EE(a);(function(T,A){A.removeAll&&(T.add.clear(),T.update.clear(),T.remove.clear(),A.remove.clear());for(const D of A.remove)T.add.delete(D),T.update.delete(D);for(const[D,z]of A.update){const V=T.update.get(D);V&&(A.update.set(D,SN(V,z)),T.update.delete(D))}})(m,y);const S={};if((m.removeAll||y.removeAll)&&(S.removeAll=!0),S.remove=new Set([...m.remove,...y.remove]),S.add=new Map([...m.add,...y.add]),S.update=new Map([...m.update,...y.update]),S.remove.size&&S.add.size)for(const T of S.add.keys())S.remove.delete(T);return(function(T){const A={};return T.removeAll&&(A.removeAll=T.removeAll),T.remove&&(A.remove=Array.from(T.remove)),T.add&&(A.add=Array.from(T.add.values())),T.update&&(A.update=Array.from(T.update.values())),A})(S)},c.a7=function(h,a){const u=new Map;if(h==null||h.type==null)return u;if(h.type==="Feature"){const m=D1(h,a);return m==null?void 0:(u.set(m,h),u)}if(h.type==="FeatureCollection"){const m=new Set;for(const y of h.features){const S=D1(y,a);if(S==null||m.has(S))return;m.add(S),u.set(S,y)}return u}},c.a8=function(h,a,u){var m,y;const S=[];if(a.removeAll)h.clear();else if(a.remove)for(const T of a.remove){const A=h.get(T);A&&(S.push(A.geometry),h.delete(T))}if(a.add)for(const T of a.add){const A=D1(T,u);if(A==null)continue;const D=h.get(A);D&&S.push(D.geometry),S.push(T.geometry),h.set(A,T)}if(a.update)for(const T of a.update){const A=h.get(T.id);if(!A)continue;const D=!!T.newGeometry,z=T.removeAllProperties||((m=T.removeProperties)===null||m===void 0?void 0:m.length)>0||((y=T.addOrUpdateProperties)===null||y===void 0?void 0:y.length)>0;if(!D&&!z)continue;S.push(A.geometry);const V=Object.assign({},A);if(h.set(T.id,V),D&&(S.push(T.newGeometry),V.geometry=T.newGeometry),z){if(V.properties=T.removeAllProperties?{}:Object.assign({},V.properties||{}),T.removeProperties)for(const X of T.removeProperties)delete V.properties[X];if(T.addOrUpdateProperties)for(const{key:X,value:ie}of T.addOrUpdateProperties)V.properties[X]=ie}}return S},c.a9=J_,c.aA=function(h,{uSize:a,uSizeT:u},{lowerSize:m,upperSize:y}){return h.kind==="source"?m/Wu:h.kind==="composite"?rr.number(m/Wu,y/Wu,u):a},c.aB=function(h,a){var u=a[0],m=a[1],y=a[2],S=a[3],T=a[4],A=a[5],D=a[6],z=a[7],V=a[8],X=a[9],ie=a[10],re=a[11],he=a[12],me=a[13],_e=a[14],Se=a[15],Be=u*A-m*T,Me=u*D-y*T,Ae=u*z-S*T,Ve=m*D-y*A,qe=m*z-S*A,_t=y*z-S*D,Vt=V*me-X*he,Rt=V*_e-ie*he,Ht=V*Se-re*he,ni=X*_e-ie*me,Yt=X*Se-re*me,Ft=ie*Se-re*_e,St=Be*Ft-Me*Yt+Ae*ni+Ve*Ht-qe*Rt+_t*Vt;return St?(h[0]=(A*Ft-D*Yt+z*ni)*(St=1/St),h[1]=(y*Yt-m*Ft-S*ni)*St,h[2]=(me*_t-_e*qe+Se*Ve)*St,h[3]=(ie*qe-X*_t-re*Ve)*St,h[4]=(D*Ht-T*Ft-z*Rt)*St,h[5]=(u*Ft-y*Ht+S*Rt)*St,h[6]=(_e*Ae-he*_t-Se*Me)*St,h[7]=(V*_t-ie*Ae+re*Me)*St,h[8]=(T*Yt-A*Ht+z*Vt)*St,h[9]=(m*Ht-u*Yt-S*Vt)*St,h[10]=(he*qe-me*Ae+Se*Be)*St,h[11]=(X*Ae-V*qe-re*Be)*St,h[12]=(A*Rt-T*ni-D*Vt)*St,h[13]=(u*ni-m*Rt+y*Vt)*St,h[14]=(me*Me-he*Ve-_e*Be)*St,h[15]=(V*Ve-X*Me+ie*Be)*St,h):null},c.aC=fe,c.aD=function(h){var a=h[0],u=h[1];return Math.sqrt(a*a+u*u)},c.aE=function(h){return h[0]=0,h[1]=0,h},c.aF=function(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h},c.aG=A1,c.aH=le,c.aI=function(h,a,u,m){const y=a.y-h.y,S=a.x-h.x,T=m.y-u.y,A=m.x-u.x,D=T*S-A*y;if(D===0)return null;const z=(A*(h.y-u.y)-T*(h.x-u.x))/D;return new f(h.x+z*S,h.y+z*y)},c.aJ=lA,c.aK=pm,c.aL=function(h){let a=1/0,u=1/0,m=-1/0,y=-1/0;for(const S of h)a=Math.min(a,S.x),u=Math.min(u,S.y),m=Math.max(m,S.x),y=Math.max(y,S.y);return[a,u,m,y]},c.aM=As,c.aN=tt,c.aO=function(h,a,u,m,y=!1){if(!u[0]&&!u[1])return[0,0];const S=y?m==="map"?-h.bearingInRadians:0:m==="viewport"?h.bearingInRadians:0;if(S){const T=Math.sin(S),A=Math.cos(S);u=[u[0]*A-u[1]*T,u[0]*T+u[1]*A]}return[y?u[0]:tt(a,u[0],h.zoom),y?u[1]:tt(a,u[1],h.zoom)]},c.aQ=E1,c.aR=J1,c.aS=C1,c.aT=Q1,c.aU=Wr,c.aV=j0,c.aW=Le,c.aX=si,c.aY=wt,c.aZ=ct,c.a_=TE,c.aa=Lf,c.ab=25,c.ac=k1,c.ad=h=>{const a=window.document.createElement("video");return a.muted=!0,new Promise((u=>{a.onloadstart=()=>{u(a)};for(const m of h){const y=window.document.createElement("source");kt(m)||(a.crossOrigin="Anonymous"),y.src=m,a.appendChild(y)}}))},c.ae=Qe,c.af=function(){return At++},c.ag=w,c.ah=wm,c.ai=tv,c.aj=af,c.ak=Hc,c.al=PE,c.am=function(h){const a={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((u,m,y,S)=>{const T=y||S;return a[m]=!T||T.toLowerCase(),""})),a["max-age"]){const u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a},c.an=Ye,c.ao=85.051129,c.ap=Ue,c.aq=function(h){return Math.pow(2,h)},c.ar=H,c.as=wE,c.at=function(h){return Math.log(h)/Math.LN2},c.au=function(h){var a=h[0],u=h[1];return a*a+u*u},c.av=function(h){if(!h.length)return new Set;const a=Math.max(...h.map((D=>D.canonical.z)));let u=1/0,m=-1/0,y=1/0,S=-1/0;const T=[];for(const D of h){const{x:z,y:V,z:X}=D.canonical,ie=Math.pow(2,a-X),re=z*ie,he=V*ie;T.push({id:D,x:re,y:he}),re<u&&(u=re),re>m&&(m=re),he<y&&(y=he),he>S&&(S=he)}const A=new Set;for(const D of T)D.x!==u&&D.x!==m&&D.y!==y&&D.y!==S||A.add(D.id);return A},c.aw=function(h,a){const u=Math.abs(2*h.wrap)-+(h.wrap<0),m=Math.abs(2*a.wrap)-+(a.wrap<0);return h.overscaledZ-a.overscaledZ||m-u||a.canonical.y-h.canonical.y||a.canonical.x-h.canonical.x},c.ax=class{constructor(h,a){this.max=h,this.onRemove=a,this.reset()}reset(){for(const h in this.data)for(const a of this.data[h])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(h,a,u){const m=h.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:a,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout((()=>{this.remove(h,y)}),u)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(h){return h.wrapped().key in this.data}getAndRemove(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null}_getAndRemoveByKey(h){const a=this.data[h].shift();return a.timeout&&clearTimeout(a.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),a.value}getByKey(h){const a=this.data[h];return a?a[0].value:null}get(h){return this.has(h)?this.data[h.wrapped().key][0].value:null}remove(h,a){if(!this.has(h))return this;const u=h.wrapped().key,m=a===void 0?0:this.data[u].indexOf(a),y=this.data[u][m];return this.data[u].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(h){for(this.max=h;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(h){const a=[];for(const u in this.data)for(const m of this.data[u])h(m.value)||a.push(m);for(const u of a)this.remove(u.value.tileID,u)}},c.ay=function(h,a){let u=0,m=0;if(h.kind==="constant")m=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:y,minZoom:S,maxZoom:T}=h,A=y?Ye(vr.interpolationFactor(y,a,S,T),0,1):0;h.kind==="camera"?m=rr.number(h.minSize,h.maxSize,A):u=A}return{uSizeT:u,uSize:m}},c.b=xe,c.b$=qu,c.b0=G,c.b1=function(h){var a=new F(3);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a},c.b2=function(h,a,u){return h[0]=a[0]-u[0],h[1]=a[1]-u[1],h[2]=a[2]-u[2],h},c.b3=function(h,a){var u=a[0],m=a[1],y=a[2],S=u*u+m*m+y*y;return S>0&&(S=1/Math.sqrt(S)),h[0]=a[0]*S,h[1]=a[1]*S,h[2]=a[2]*S,h},c.b4=B,c.b5=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]},c.b6=function(h,a,u){return h[0]=a[0]*u[0],h[1]=a[1]*u[1],h[2]=a[2]*u[2],h[3]=a[3]*u[3],h},c.b7=q,c.b8=function(h,a,u){const m=a[0]*u[0]+a[1]*u[1]+a[2]*u[2];return m===0?null:(-(h[0]*u[0]+h[1]*u[1]+h[2]*u[2])-u[3])/m},c.b9=J,c.bA=function(h,a,u,m){return h[0]=a[0]+u[0]*m,h[1]=a[1]+u[1]*m,h[2]=a[2]+u[2]*m,h},c.bB=pe,c.bC=function(h,a,u){var m=u[0],y=u[1],S=u[2],T=u[3],A=a[0],D=a[1],z=a[2],V=y*z-S*D,X=S*A-m*z,ie=m*D-y*A;return h[0]=A+T*(V+=V)+y*(ie+=ie)-S*(X+=X),h[1]=D+T*X+S*V-m*ie,h[2]=z+T*ie+m*X-y*V,h},c.bD=function(h,a,u){const m=(function(D){var z=D[3],V=D[4],X=D[5],ie=D[6],re=D[7],he=D[8];return D[0]*(he*V-X*re)+D[1]*(-he*z+X*ie)+D[2]*(re*z-V*ie)})([h[0],h[1],h[2],a[0],a[1],a[2],u[0],u[1],u[2]]);if(m===0)return null;const y=B([],[a[0],a[1],a[2]],[u[0],u[1],u[2]]),S=B([],[u[0],u[1],u[2]],[h[0],h[1],h[2]]),T=B([],[h[0],h[1],h[2]],[a[0],a[1],a[2]]),A=j([],y,-h[3]);return G(A,A,j([],S,-a[3])),G(A,A,j([],T,-u[3])),j(A,A,1/m),A},c.bE=R1,c.bF=function(){return new Float64Array(4)},c.bG=function(h,a,u,m){var y=[],S=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],S[0]=y[0]*Math.cos(m)-y[1]*Math.sin(m),S[1]=y[0]*Math.sin(m)+y[1]*Math.cos(m),S[2]=y[2],h[0]=S[0]+u[0],h[1]=S[1]+u[1],h[2]=S[2]+u[2],h},c.bH=function(h,a,u,m){var y=[],S=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],S[0]=y[0],S[1]=y[1]*Math.cos(m)-y[2]*Math.sin(m),S[2]=y[1]*Math.sin(m)+y[2]*Math.cos(m),h[0]=S[0]+u[0],h[1]=S[1]+u[1],h[2]=S[2]+u[2],h},c.bI=function(h,a,u,m){var y=[],S=[];return y[0]=a[0]-u[0],y[1]=a[1]-u[1],y[2]=a[2]-u[2],S[0]=y[2]*Math.sin(m)+y[0]*Math.cos(m),S[1]=y[1],S[2]=y[2]*Math.cos(m)-y[0]*Math.sin(m),h[0]=S[0]+u[0],h[1]=S[1]+u[1],h[2]=S[2]+u[2],h},c.bJ=function(h,a,u){var m=Math.sin(u),y=Math.cos(u),S=a[0],T=a[1],A=a[2],D=a[3],z=a[8],V=a[9],X=a[10],ie=a[11];return a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=S*y-z*m,h[1]=T*y-V*m,h[2]=A*y-X*m,h[3]=D*y-ie*m,h[8]=S*m+z*y,h[9]=T*m+V*y,h[10]=A*m+X*y,h[11]=D*m+ie*y,h},c.bK=function(h,a){const u=Ke(h,360),m=Ke(a,360),y=m-u,S=m>u?y-360:y+360;return Math.abs(y)<Math.abs(S)?y:S},c.bL=function(h){return h[0]=0,h[1]=0,h[2]=0,h},c.bM=function(h,a,u,m){const y=Math.sqrt(h*h+a*a),S=Math.sqrt(u*u+m*m);h/=y,a/=y,u/=S,m/=S;const T=Math.acos(h*u+a*m);return-a*u+h*m>0?T:-T},c.bN=function(h,a){const u=Ke(h,2*Math.PI),m=Ke(a,2*Math.PI);return Math.min(Math.abs(u-m),Math.abs(u-m+2*Math.PI),Math.abs(u-m-2*Math.PI))},c.bO=function(){const h={},a=gt.$version;for(const u in gt.$root){const m=gt.$root[u];if(m.required){let y=null;y=u==="version"?a:m.type==="array"?[]:{},y!=null&&(h[u]=y)}}return h},c.bP=mt,c.bQ=M_,c.bR=function h(a,u){if(Array.isArray(a)){if(!Array.isArray(u)||a.length!==u.length)return!1;for(let m=0;m<a.length;m++)if(!h(a[m],u[m]))return!1;return!0}if(typeof a=="object"&&a!==null&&u!==null){if(typeof u!="object"||Object.keys(a).length!==Object.keys(u).length)return!1;for(const m in a)if(!h(a[m],u[m]))return!1;return!0}return a===u},c.bS=function(h){h=h.slice();const a=Object.create(null);for(let u=0;u<h.length;u++)a[h[u].id]=h[u];for(let u=0;u<h.length;u++)"ref"in h[u]&&(h[u]=Er(h[u],a[h[u].ref]));return h},c.bT=function(h,a){if(h.type==="custom")return new bN(h,a);switch(h.type){case"background":return new yN(h,a);case"circle":return new nB(h,a);case"color-relief":return new cB(h,a);case"fill":return new TB(h,a);case"fill-extrusion":return new OB(h,a);case"heatmap":return new sB(h,a);case"hillshade":return new aB(h,a);case"line":return new jB(h,a);case"raster":return new a1(h,a);case"symbol":return new Z0(h,a)}},c.bU=h=>h.type==="raster",c.bV=Ze,c.bW=function(h,a){if(!h)return[{command:"setStyle",args:[a]}];let u=[];try{if(!Di(h.version,a.version))return[{command:"setStyle",args:[a]}];Di(h.center,a.center)||u.push({command:"setCenter",args:[a.center]}),Di(h.state,a.state)||u.push({command:"setGlobalState",args:[a.state]}),Di(h.centerAltitude,a.centerAltitude)||u.push({command:"setCenterAltitude",args:[a.centerAltitude]}),Di(h.zoom,a.zoom)||u.push({command:"setZoom",args:[a.zoom]}),Di(h.bearing,a.bearing)||u.push({command:"setBearing",args:[a.bearing]}),Di(h.pitch,a.pitch)||u.push({command:"setPitch",args:[a.pitch]}),Di(h.roll,a.roll)||u.push({command:"setRoll",args:[a.roll]}),Di(h.sprite,a.sprite)||u.push({command:"setSprite",args:[a.sprite]}),Di(h.glyphs,a.glyphs)||u.push({command:"setGlyphs",args:[a.glyphs]}),Di(h.transition,a.transition)||u.push({command:"setTransition",args:[a.transition]}),Di(h.light,a.light)||u.push({command:"setLight",args:[a.light]}),Di(h.terrain,a.terrain)||u.push({command:"setTerrain",args:[a.terrain]}),Di(h.sky,a.sky)||u.push({command:"setSky",args:[a.sky]}),Di(h.projection,a.projection)||u.push({command:"setProjection",args:[a.projection]});const m={},y=[];(function(T,A,D,z){let V;for(V in A=A||{},T=T||{})Object.prototype.hasOwnProperty.call(T,V)&&(Object.prototype.hasOwnProperty.call(A,V)||Cn(V,D,z));for(V in A)Object.prototype.hasOwnProperty.call(A,V)&&(Object.prototype.hasOwnProperty.call(T,V)?Di(T[V],A[V])||(T[V].type==="geojson"&&A[V].type==="geojson"&&En(T,A,V)?yn(D,{command:"setGeoJSONSourceData",args:[V,A[V].data]}):Vn(V,A,D,z)):Yn(V,A,D))})(h.sources,a.sources,y,m);const S=[];h.layers&&h.layers.forEach((T=>{"source"in T&&m[T.source]?u.push({command:"removeLayer",args:[T.id]}):S.push(T)})),u=u.concat(y),(function(T,A,D){A=A||[];const z=(T=T||[]).map($e),V=A.map($e),X=T.reduce(Ct,{}),ie=A.reduce(Ct,{}),re=z.slice(),he=Object.create(null);let me,_e,Se,Be,Me;for(let Ae=0,Ve=0;Ae<z.length;Ae++)me=z[Ae],Object.prototype.hasOwnProperty.call(ie,me)?Ve++:(yn(D,{command:"removeLayer",args:[me]}),re.splice(re.indexOf(me,Ve),1));for(let Ae=0,Ve=0;Ae<V.length;Ae++)me=V[V.length-1-Ae],re[re.length-1-Ae]!==me&&(Object.prototype.hasOwnProperty.call(X,me)?(yn(D,{command:"removeLayer",args:[me]}),re.splice(re.lastIndexOf(me,re.length-Ve),1)):Ve++,Be=re[re.length-Ae],yn(D,{command:"addLayer",args:[ie[me],Be]}),re.splice(re.length-Ae,0,me),he[me]=!0);for(let Ae=0;Ae<V.length;Ae++)if(me=V[Ae],_e=X[me],Se=ie[me],!he[me]&&!Di(_e,Se))if(Di(_e.source,Se.source)&&Di(_e["source-layer"],Se["source-layer"])&&Di(_e.type,Se.type)){for(Me in dr(_e.layout,Se.layout,D,me,null,"setLayoutProperty"),dr(_e.paint,Se.paint,D,me,null,"setPaintProperty"),Di(_e.filter,Se.filter)||yn(D,{command:"setFilter",args:[me,Se.filter]}),Di(_e.minzoom,Se.minzoom)&&Di(_e.maxzoom,Se.maxzoom)||yn(D,{command:"setLayerZoomRange",args:[me,Se.minzoom,Se.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?dr(_e[Me],Se[Me],D,me,Me.slice(6),"setPaintProperty"):Di(_e[Me],Se[Me])||yn(D,{command:"setLayerProperty",args:[me,Me,Se[Me]]}));for(Me in Se)Object.prototype.hasOwnProperty.call(Se,Me)&&!Object.prototype.hasOwnProperty.call(_e,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?dr(_e[Me],Se[Me],D,me,Me.slice(6),"setPaintProperty"):Di(_e[Me],Se[Me])||yn(D,{command:"setLayerProperty",args:[me,Me,Se[Me]]}))}else yn(D,{command:"removeLayer",args:[me]}),Be=re[re.lastIndexOf(me)+1],yn(D,{command:"addLayer",args:[Se,Be]})})(S,a.layers,u)}catch(m){console.warn("Unable to compute style diff:",m),u=[{command:"setStyle",args:[a]}]}return u},c.bX=function(h){const a=[],u=h.id;return u===void 0&&a.push({message:`layers.${u}: missing required property "id"`}),h.render===void 0&&a.push({message:`layers.${u}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&a.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),a},c.bY=Nt,c.bZ=$t,c.b_=class extends So{constructor(h,a){super(h,a),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.ba=function(h,a,u){return h[0]=a[0]*u,h[1]=a[1]*u,h[2]=a[2]*u,h[3]=a[3]*u,h},c.bb=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]+h[3]},c.bc=CE,c.bd=Sm,c.be=function(h,a,u,m,y){var S=1/Math.tan(a/2);if(h[0]=S/u,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=S,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,y!=null&&y!==1/0){var T=1/(m-y);h[10]=(y+m)*T,h[14]=2*y*m*T}else h[10]=-1,h[14]=-2*m;return h},c.bf=function(h){var a=new F(16);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a[9]=h[9],a[10]=h[10],a[11]=h[11],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15],a},c.bg=function(h,a,u){var m=Math.sin(u),y=Math.cos(u),S=a[0],T=a[1],A=a[2],D=a[3],z=a[4],V=a[5],X=a[6],ie=a[7];return a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=S*y+z*m,h[1]=T*y+V*m,h[2]=A*y+X*m,h[3]=D*y+ie*m,h[4]=z*y-S*m,h[5]=V*y-T*m,h[6]=X*y-A*m,h[7]=ie*y-D*m,h},c.bh=function(h,a,u){var m=Math.sin(u),y=Math.cos(u),S=a[4],T=a[5],A=a[6],D=a[7],z=a[8],V=a[9],X=a[10],ie=a[11];return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[4]=S*y+z*m,h[5]=T*y+V*m,h[6]=A*y+X*m,h[7]=D*y+ie*m,h[8]=z*y-S*m,h[9]=V*y-T*m,h[10]=X*y-A*m,h[11]=ie*y-D*m,h},c.bi=function(){const h=new Float32Array(16);return H(h),h},c.bj=function(){const h=new Float64Array(16);return H(h),h},c.bk=function(){return new Float64Array(16)},c.bl=function(h,a,u){const m=new Float64Array(4);return pe(m,h,a-90,u),m},c.bm=function(h,a,u,m){var y,S,T,A,D,z=a[0],V=a[1],X=a[2],ie=a[3],re=u[0],he=u[1],me=u[2],_e=u[3];return(S=z*re+V*he+X*me+ie*_e)<0&&(S=-S,re=-re,he=-he,me=-me,_e=-_e),1-S>I?(y=Math.acos(S),T=Math.sin(y),A=Math.sin((1-m)*y)/T,D=Math.sin(m*y)/T):(A=1-m,D=m),h[0]=A*z+D*re,h[1]=A*V+D*he,h[2]=A*X+D*me,h[3]=A*ie+D*_e,h},c.bn=function(h){const a=new Float64Array(9);(function(S,T){var A=T[0],D=T[1],z=T[2],V=T[3],X=A+A,ie=D+D,re=z+z,he=A*X,me=D*X,_e=D*ie,Se=z*X,Be=z*ie,Me=z*re,Ae=V*X,Ve=V*ie,qe=V*re;S[0]=1-_e-Me,S[3]=me-qe,S[6]=Se+Ve,S[1]=me+qe,S[4]=1-he-Me,S[7]=Be-Ae,S[2]=Se-Ve,S[5]=Be+Ae,S[8]=1-he-_e})(a,h);const u=ct(-Math.asin(Ye(a[2],-1,1)));let m,y;return Math.hypot(a[5],a[8])<.001?(m=0,y=-ct(Math.atan2(a[3],a[4]))):(m=ct(a[5]===0&&a[8]===0?0:Math.atan2(a[5],a[8])),y=ct(a[1]===0&&a[0]===0?0:Math.atan2(a[1],a[0]))),{roll:m,pitch:u+90,bearing:y}},c.bo=function(h,a){return h.roll==a.roll&&h.pitch==a.pitch&&h.bearing==a.bearing},c.bp=nn,c.bq=Gu,c.br=ym,c.bs=H_,c.bt=vm,c.bu=dt,c.bv=et,c.bw=Ns,c.bx=function(h,a,u,m,y){return dt(m,y,Ye((h-a)/(u-a),0,1))},c.by=Ke,c.bz=function(){return new Float64Array(3)},c.c=Re,c.c$=function(h,a,u,m,y){return s(this,void 0,void 0,(function*(){if(L())try{return yield ve(h,a,u,m,y)}catch{}return(function(S,T,A,D,z){const V=S.width,X=S.height;te&&se||(te=new OffscreenCanvas(V,X),se=te.getContext("2d",{willReadFrequently:!0})),te.width=V,te.height=X,se.drawImage(S,0,0,V,X);const ie=se.getImageData(T,A,D,z);return se.clearRect(0,0,V,X),ie.data})(h,a,u,m,y)}))},c.c0=class extends So{constructor(h,a){super(h,a),this.current=ha}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let a=1;a<16;a++)if(h[a]!==this.current[a]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.c1=Af,c.c2=class extends So{constructor(h,a){super(h,a),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.c3=class extends So{constructor(h,a){super(h,a),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.c4=N,c.c5=function(h,a){var u=Math.sin(a),m=Math.cos(a);return h[0]=m,h[1]=u,h[2]=0,h[3]=-u,h[4]=m,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},c.c6=function(h,a,u){var m=a[0],y=a[1],S=a[2];return h[0]=m*u[0]+y*u[3]+S*u[6],h[1]=m*u[1]+y*u[4]+S*u[7],h[2]=m*u[2]+y*u[5]+S*u[8],h},c.c7=function(h,a,u,m,y,S,T){var A=1/(a-u),D=1/(m-y),z=1/(S-T);return h[0]=-2*A,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*D,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*z,h[11]=0,h[12]=(a+u)*A,h[13]=(y+m)*D,h[14]=(T+S)*z,h[15]=1,h},c.c8=class extends So{constructor(h,a){super(h,a),this.current=new Array}set(h){if(h!=this.current){this.current=h;const a=new Float32Array(4*h.length);for(let u=0;u<h.length;u++)a[4*u]=h[u].r,a[4*u+1]=h[u].g,a[4*u+2]=h[u].b,a[4*u+3]=h[u].a;this.gl.uniform4fv(this.location,a)}}},c.c9=class extends So{constructor(h,a){super(h,a),this.current=new Array}set(h){if(h!=this.current){this.current=h;const a=new Float32Array(h);this.gl.uniform1fv(this.location,a)}}},c.cA=function(h,a){return we[a]&&"touches"in h},c.cB=function(h){return we[h]||Q[h]},c.cC=function(h,a,u){var m=a[0],y=a[1];return h[0]=u[0]*m+u[4]*y+u[12],h[1]=u[1]*m+u[5]*y+u[13],h},c.cD=function(h,a){const{x:u,y:m}=J_.fromLngLat(a);return!(h<0||h>25||m<0||m>=1||u<0||u>=1)},c.cE=function(h,a){return h[0]=a[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=a[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=a[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.cF=class extends am{},c.cG=o4,c.cI=Xe,c.cJ=function(h,a){Re.REGISTERED_PROTOCOLS[h]=a},c.cK=function(h){delete Re.REGISTERED_PROTOCOLS[h]},c.cL=function(h,a){const u={};for(let y=0;y<h.length;y++){const S=a&&a[h[y].id]||p0(h[y]);a&&(a[h[y].id]=S);let T=u[S];T||(T=u[S]=[]),T.push(h[y])}const m=[];for(const y in u)m.push(u[y]);return m},c.cM=mi,c.cN=AE,c.cO=oA,c.cP=cE,c.cQ=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=Ce/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const a=h.bucket.layers[0],u=a.layout,m=a._unevaluatedLayout._values,y={layoutIconSize:m["icon-size"].possiblyEvaluate(new Gn(h.bucket.zoom+1),h.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Gn(h.bucket.zoom+1),h.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Gn(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:V}=h.bucket.textSizeData;y.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Gn(z),h.canonical),m["text-size"].possiblyEvaluate(new Gn(V),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:V}=h.bucket.iconSizeData;y.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Gn(z),h.canonical),m["icon-size"].possiblyEvaluate(new Gn(V),h.canonical)]}const S=u.get("text-line-height")*As,T=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",A=u.get("text-keep-upright"),D=u.get("text-size");for(const z of h.bucket.features){const V=u.get("text-font").evaluate(z,{},h.canonical).join(","),X=D.evaluate(z,{},h.canonical),ie=y.layoutTextSize.evaluate(z,{},h.canonical),re=y.layoutIconSize.evaluate(z,{},h.canonical),he={horizontal:{},vertical:void 0},me=z.text;let _e,Se=[0,0];if(me){const Ae=me.toString(),Ve=u.get("text-letter-spacing").evaluate(z,{},h.canonical)*As,qe=s1(Ae)?Ve:0,_t=u.get("text-anchor").evaluate(z,{},h.canonical),Vt=yA(a,z,h.canonical);if(!Vt){const Yt=u.get("text-radial-offset").evaluate(z,{},h.canonical);Se=Yt?vA(_t,[Yt*As,K1]):u.get("text-offset").evaluate(z,{},h.canonical).map((Ft=>Ft*As))}let Rt=T?"center":u.get("text-justify").evaluate(z,{},h.canonical);const Ht=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(z,{},h.canonical)*As:1/0,ni=()=>{h.bucket.allowVerticalPlacement&&Qh(Ae)&&(he.vertical=H0(me,h.glyphMap,h.glyphPositions,h.imagePositions,V,Ht,S,_t,"left",qe,Se,c.az.vertical,!0,ie,X))};if(!T&&Vt){const Yt=new Set;if(Rt==="auto")for(let St=0;St<Vt.values.length;St+=2)Yt.add(J1(Vt.values[St]));else Yt.add(Rt);let Ft=!1;for(const St of Yt)if(!he.horizontal[St])if(Ft)he.horizontal[St]=he.horizontal[0];else{const fi=H0(me,h.glyphMap,h.glyphPositions,h.imagePositions,V,Ht,S,"center",St,qe,Se,c.az.horizontal,!1,ie,X);fi&&(he.horizontal[St]=fi,Ft=fi.positionedLines.length===1)}ni()}else{Rt==="auto"&&(Rt=J1(_t));const Yt=H0(me,h.glyphMap,h.glyphPositions,h.imagePositions,V,Ht,S,_t,Rt,qe,Se,c.az.horizontal,!1,ie,X);Yt&&(he.horizontal[Rt]=Yt),ni(),Qh(Ae)&&T&&A&&(he.vertical=H0(me,h.glyphMap,h.glyphPositions,h.imagePositions,V,Ht,S,_t,Rt,qe,Se,c.az.vertical,!1,ie,X))}}let Be=!1;if(z.icon&&z.icon.name){const Ae=h.imageMap[z.icon.name];Ae&&(_e=mN(h.imagePositions[z.icon.name],u.get("icon-offset").evaluate(z,{},h.canonical),u.get("icon-anchor").evaluate(z,{},h.canonical)),Be=!!Ae.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=Be:h.bucket.sdfIcons!==Be&&Mt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==h.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Me=xA(he.horizontal)||he.vertical;h.bucket.iconsInText=!!Me&&Me.iconsInText,(Me||_e)&&r4(h.bucket,z,he,_e,h.imageMap,y,ie,re,Se,Be,h.canonical,h.subdivisionGranularity)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.cR=b1,c.cS=w1,c.cT=S1,c.cU=function(h){const a=new q0;return(function(u,m){for(const y in u.layers)m.writeMessage(3,GN,u.layers[y])})(h,a),a.finish()},c.cV=function(h,a,u,m,y,S){let T=cA(h,a,u,y,0);return T=cA(T,a,m,S,1),T},c.cW=class{constructor(h){this.maxEntries=h,this.map=new Map}get(h){const a=this.map.get(h);return a!==void 0&&(this.map.delete(h),this.map.set(h,a)),a}set(h,a){if(this.map.has(h))this.map.delete(h);else if(this.map.size>=this.maxEntries){const u=this.map.keys().next().value;this.map.delete(u)}this.map.set(h,a)}clear(){this.map.clear()}},c.cX=qC,c.cY=q0,c.cZ=rA,c.c_=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},c.ca=class extends Uu{},c.cb=WB,c.cc=class extends Ef{},c.cd=m1,c.ce=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.cf=IC,c.cg=function(h,a,u){var m=a[0],y=a[1],S=a[2],T=u[3]*m+u[7]*y+u[11]*S+u[15];return h[0]=(u[0]*m+u[4]*y+u[8]*S+u[12])/(T=T||1),h[1]=(u[1]*m+u[5]*y+u[9]*S+u[13])/T,h[2]=(u[2]*m+u[6]*y+u[10]*S+u[14])/T,h},c.ch=class extends R_{},c.ci=class extends l{},c.cj=function(h,a){return h[0]===a[0]&&h[1]===a[1]&&h[2]===a[2]&&h[3]===a[3]&&h[4]===a[4]&&h[5]===a[5]&&h[6]===a[6]&&h[7]===a[7]&&h[8]===a[8]&&h[9]===a[9]&&h[10]===a[10]&&h[11]===a[11]&&h[12]===a[12]&&h[13]===a[13]&&h[14]===a[14]&&h[15]===a[15]},c.ck=function(h,a){var u=h[0],m=h[1],y=h[2],S=h[3],T=h[4],A=h[5],D=h[6],z=h[7],V=h[8],X=h[9],ie=h[10],re=h[11],he=h[12],me=h[13],_e=h[14],Se=h[15],Be=a[0],Me=a[1],Ae=a[2],Ve=a[3],qe=a[4],_t=a[5],Vt=a[6],Rt=a[7],Ht=a[8],ni=a[9],Yt=a[10],Ft=a[11],St=a[12],fi=a[13],hi=a[14],_i=a[15];return Math.abs(u-Be)<=I*Math.max(1,Math.abs(u),Math.abs(Be))&&Math.abs(m-Me)<=I*Math.max(1,Math.abs(m),Math.abs(Me))&&Math.abs(y-Ae)<=I*Math.max(1,Math.abs(y),Math.abs(Ae))&&Math.abs(S-Ve)<=I*Math.max(1,Math.abs(S),Math.abs(Ve))&&Math.abs(T-qe)<=I*Math.max(1,Math.abs(T),Math.abs(qe))&&Math.abs(A-_t)<=I*Math.max(1,Math.abs(A),Math.abs(_t))&&Math.abs(D-Vt)<=I*Math.max(1,Math.abs(D),Math.abs(Vt))&&Math.abs(z-Rt)<=I*Math.max(1,Math.abs(z),Math.abs(Rt))&&Math.abs(V-Ht)<=I*Math.max(1,Math.abs(V),Math.abs(Ht))&&Math.abs(X-ni)<=I*Math.max(1,Math.abs(X),Math.abs(ni))&&Math.abs(ie-Yt)<=I*Math.max(1,Math.abs(ie),Math.abs(Yt))&&Math.abs(re-Ft)<=I*Math.max(1,Math.abs(re),Math.abs(Ft))&&Math.abs(he-St)<=I*Math.max(1,Math.abs(he),Math.abs(St))&&Math.abs(me-fi)<=I*Math.max(1,Math.abs(me),Math.abs(fi))&&Math.abs(_e-hi)<=I*Math.max(1,Math.abs(_e),Math.abs(hi))&&Math.abs(Se-_i)<=I*Math.max(1,Math.abs(Se),Math.abs(_i))},c.cl=function(h,a){return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.cm=h=>h.type==="symbol",c.cn=h=>h.type==="circle",c.co=h=>h.type==="heatmap",c.cp=h=>h.type==="line",c.cq=h=>h.type==="fill",c.cr=h=>h.type==="fill-extrusion",c.cs=h=>h.type==="hillshade",c.ct=h=>h.type==="color-relief",c.cu=h=>h.type==="background",c.cv=h=>h.type==="custom",c.cw=Oe,c.cx=function(h,a,u){const m=Te(a.x-u.x,a.y-u.y),y=Te(h.x-u.x,h.y-u.y),S=Math.atan2(m[0]*y[1]-m[1]*y[0],(function(T,A){return T[0]*A[0]+T[1]*A[1]})(m,y));return ct(S)},c.cy=lt,c.cz=function(h,a){return Q[a]&&(h instanceof MouseEvent||h instanceof WheelEvent)},c.d=kt,c.d0=kC,c.d1=p,c.d2=class{constructor(h,a){this.layers={[tv]:this},this.name=tv,this.version=a?a.version:1,this.extent=a?a.extent:4096,this.length=h.length,this.features=h}feature(h){return new jN(this.features[h],this.extent)}},c.d3=of,c.d4=Uc,c.e=Lt,c.f=h=>s(void 0,void 0,void 0,(function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(a)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),c.g=rt,c.h=h=>new Promise(((a,u)=>{const m=new Image;m.onload=()=>{a(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame((()=>{m.src=ft}))},m.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(h)],{type:"image/png"});m.src=h.byteLength?URL.createObjectURL(y):ft})),c.i=Pt,c.j=(h,a)=>Et(Lt(h,{type:"json"}),a),c.k=vn,c.l=$i,c.m=Et,c.n=(h,a)=>Et(Lt(h,{type:"arrayBuffer"}),a),c.o=function(h){return new q0(h).readFields(aN,[])},c.p=lE,c.q=function(h){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(h))},c.r=V_,c.s=Ie,c.t=lo,c.u=gt,c.v=pf,c.w=Mt,c.x=I_,c.y=mf,c.z=yf})),r("worker",["./shared"],(function(c){class s{constructor(Q,ue){this.keyCache={},Q&&this.replace(Q,ue)}replace(Q,ue){this._layerConfigs={},this._layers={},this.update(Q,[],ue)}update(Q,ue,de){for(const Re of Q){this._layerConfigs[Re.id]=Re;const rt=this._layers[Re.id]=c.bT(Re,de);rt._featureFilter=c.aj(rt.filter,de),this.keyCache[Re.id]&&delete this.keyCache[Re.id]}for(const Re of ue)delete this.keyCache[Re],delete this._layerConfigs[Re],delete this._layers[Re];this.familiesBySource={};const Pe=c.cL(Object.values(this._layerConfigs),this.keyCache);for(const Re of Pe){const rt=Re.map((Jt=>this._layers[Jt.id])),ot=rt[0];if(ot.isHidden())continue;const Xe=ot.source||"";let mt=this.familiesBySource[Xe];mt||(mt=this.familiesBySource[Xe]={});const Et=ot.sourceLayer||c.ai;let kt=mt[Et];kt||(kt=mt[Et]=[]),kt.push(rt)}}}class f{constructor(Q){const ue={},de=[];for(const ot in Q){const Xe=Q[ot],mt=ue[ot]={};for(const Et in Xe){const kt=Xe[+Et];if(!kt||kt.bitmap.width===0||kt.bitmap.height===0)continue;const Jt={x:0,y:0,w:kt.bitmap.width+2,h:kt.bitmap.height+2};de.push(Jt),mt[Et]={rect:Jt,metrics:kt.metrics}}}const{w:Pe,h:Re}=c.p(de),rt=new c.r({width:Pe||1,height:Re||1});for(const ot in Q){const Xe=Q[ot];for(const mt in Xe){const Et=Xe[+mt];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;const kt=ue[ot][mt].rect;c.r.copy(Et.bitmap,rt,{x:0,y:0},{x:kt.x+1,y:kt.y+1},Et.bitmap)}}this.image=rt,this.positions=ue}}c.cM("GlyphAtlas",f);class p{constructor(Q){this.tileID=new c.a2(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId,this.inFlightDependencies=[]}parse(Q,ue,de,Pe,Re){return c._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Q,this.collisionBoxArray=new c.ag;const rt=new c.cN(Object.keys(Q.layers).sort()),ot=new c.cO(this.tileID,this.promoteId);ot.bucketLayerIDs=[];const Xe={},mt={featureIndex:ot,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:de,subdivisionGranularity:Re},Et=ue.familiesBySource[this.source];for(const En in Et){const dr=Q.layers[En];if(!dr)continue;dr.version===1&&c.w(`Vector tile source "${this.source}" layer "${En}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $e=rt.encode(En),Ct=[];for(let Qe=0;Qe<dr.length;Qe++){const It=dr.feature(Qe),Gt=ot.getId(It,En);Ct.push({feature:It,id:Gt,index:Qe,sourceLayerIndex:$e})}for(const Qe of Et[En]){const It=Qe[0];It.source!==this.source&&c.w(`layer.source = ${It.source} does not equal this.source = ${this.source}`),It.isHidden(this.zoom,!0)||(g(Qe,this.zoom,de),(Xe[It.id]=It.createBucket({index:ot.bucketLayerIDs.length,layers:Qe,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$e,sourceID:this.source})).populate(Ct,mt,this.tileID.canonical),ot.bucketLayerIDs.push(Qe.map((Gt=>Gt.id))))}}const kt=c.bY(mt.glyphDependencies,(En=>Object.keys(En).map(Number)));this.inFlightDependencies.forEach((En=>En?.abort())),this.inFlightDependencies=[];let Jt=Promise.resolve({});if(Object.keys(kt).length){const En=new AbortController;this.inFlightDependencies.push(En),Jt=Pe.sendAsync({type:"GG",data:{stacks:kt,source:this.source,tileID:this.tileID,type:"glyphs"}},En)}const vi=Object.keys(mt.iconDependencies);let $i=Promise.resolve({});if(vi.length){const En=new AbortController;this.inFlightDependencies.push(En),$i=Pe.sendAsync({type:"GI",data:{icons:vi,source:this.source,tileID:this.tileID,type:"icons"}},En)}const vn=Object.keys(mt.patternDependencies);let rn=Promise.resolve({});if(vn.length){const En=new AbortController;this.inFlightDependencies.push(En),rn=Pe.sendAsync({type:"GI",data:{icons:vn,source:this.source,tileID:this.tileID,type:"patterns"}},En)}const gt=mt.dashDependencies;let gn=Promise.resolve({});if(Object.keys(gt).length){const En=new AbortController;this.inFlightDependencies.push(En),gn=Pe.sendAsync({type:"GDA",data:{dashes:gt}},En)}const[Er,Di,yn,Yn]=yield Promise.all([Jt,$i,rn,gn]),Cn=new f(Er),Vn=new c.cP(Di,yn);for(const En in Xe){const dr=Xe[En];dr instanceof c.ah?(g(dr.layers,this.zoom,de),c.cQ({bucket:dr,glyphMap:Er,glyphPositions:Cn.positions,imageMap:Di,imagePositions:Vn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:mt.subdivisionGranularity})):dr.hasDependencies&&(dr instanceof c.cR||dr instanceof c.cS||dr instanceof c.cT)&&(g(dr.layers,this.zoom,de),dr.addFeatures(mt,this.tileID.canonical,Vn.patternPositions,Yn))}return this.status="done",{buckets:Object.values(Xe).filter((En=>!En.isEmpty())),featureIndex:ot,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cn.image,imageAtlas:Vn,dashPositions:Yn,glyphMap:this.returnDependencies?Er:null,iconMap:this.returnDependencies?Di:null,glyphPositions:this.returnDependencies?Cn.positions:null}}))}}function g(we,Q,ue){const de=new c.H(Q);for(const Pe of we)Pe.recalculate(de,ue)}class _{constructor(Q,ue,de,Pe,Re){this.type=Q,this.properties=de||{},this.extent=Re,this.pointsArray=ue,this.id=Pe}loadGeometry(){return this.pointsArray.map((Q=>Q.map((ue=>new c.P(ue.x,ue.y)))))}}class x{constructor(Q,ue,de){this.version=2,this._myFeatures=Q,this.name=ue,this.length=Q.length,this.extent=de}feature(Q){return this._myFeatures[Q]}}class b{constructor(){this.layers={}}addLayer(Q){this.layers[Q.name]=Q}}function M(we){let Q=c.cU(we);return Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),{vectorTile:we,rawData:Q.buffer}}function P(we,Q,ue){const{extent:de}=we,Pe=Math.pow(2,ue.z-Q.z),Re=(ue.x-Q.x*Pe)*de,rt=(ue.y-Q.y*Pe)*de,ot=[];for(let Xe=0;Xe<we.length;Xe++){const mt=we.feature(Xe);let Et=mt.loadGeometry();for(const Jt of Et)for(const vi of Jt)vi.x=vi.x*Pe-Re,vi.y=vi.y*Pe-rt;const kt=128;Et=c.cV(Et,mt.type,-kt,-kt,de+kt,de+kt),Et.length!==0&&ot.push(new _(mt.type,Et,mt.properties,mt.id,de))}return new x(ot,we.name,de)}class k{constructor(Q,ue,de){this.actor=Q,this.layerIndex=ue,this.availableImages=de,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new c.cW(1e3)}loadVectorTile(Q,ue){return c._(this,void 0,void 0,(function*(){const de=yield c.n(Q.request,ue);try{return{vectorTile:Q.encoding!=="mlt"?new c.cX(new c.cY(de.data)):new c.cZ(de.data),rawData:de.data,cacheControl:de.cacheControl,expires:de.expires}}catch(Pe){const Re=new Uint8Array(de.data);let rt=`Unable to parse the tile at ${Q.request.url}, `;throw rt+=Re[0]===31&&Re[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Pe.message}`,new Error(rt)}}))}loadTile(Q){return c._(this,void 0,void 0,(function*(){const{uid:ue,overzoomParameters:de}=Q;de&&(Q.request=de.overzoomRequest);const Pe=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new c.c_(Q.request),Re=new p(Q);this.loading[ue]=Re;const rt=new AbortController;Re.abort=rt;try{const ot=yield this.loadVectorTile(Q,rt);if(delete this.loading[ue],!ot)return null;if(de){const Jt=this._getOverzoomTile(Q,ot.vectorTile);ot.rawData=Jt.rawData,ot.vectorTile=Jt.vectorTile}const Xe=ot.rawData,mt={};ot.expires&&(mt.expires=ot.expires),ot.cacheControl&&(mt.cacheControl=ot.cacheControl);const Et={};if(Pe){const Jt=Pe.finish();Jt&&(Et.resourceTiming=JSON.parse(JSON.stringify(Jt)))}Re.vectorTile=ot.vectorTile;const kt=Re.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);this.loaded[ue]=Re,this.fetching[ue]={rawTileData:Xe,cacheControl:mt,resourceTiming:Et};try{const Jt=yield kt;return c.e({rawTileData:Xe.slice(0),encoding:Q.encoding},Jt,mt,Et)}finally{delete this.fetching[ue]}}catch(ot){throw delete this.loading[ue],Re.status="done",this.loaded[ue]=Re,ot}}))}_getOverzoomTile(Q,ue){const{tileID:de,source:Pe,overzoomParameters:Re}=Q,{maxZoomTileID:rt}=Re,ot=`${rt.key}_${de.key}`,Xe=this.overzoomedTileResultCache.get(ot);if(Xe)return Xe;const mt=new b,Et=this.layerIndex.familiesBySource[Pe];for(const Jt in Et){const vi=ue.layers[Jt];if(!vi)continue;const $i=P(vi,rt,de.canonical);$i.length>0&&mt.addLayer($i)}const kt=M(mt);return this.overzoomedTileResultCache.set(ot,kt),kt}reloadTile(Q){return c._(this,void 0,void 0,(function*(){const ue=Q.uid;if(!this.loaded||!this.loaded[ue])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const de=this.loaded[ue];if(de.showCollisionBoxes=Q.showCollisionBoxes,de.status==="parsing"){const Pe=yield de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);let Re;if(this.fetching[ue]){const{rawTileData:rt,cacheControl:ot,resourceTiming:Xe}=this.fetching[ue];delete this.fetching[ue],Re=c.e({rawTileData:rt.slice(0),encoding:Q.encoding},Pe,ot,Xe)}else Re=Pe;return Re}if(de.status==="done"&&de.vectorTile)return de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity)}))}abortTile(Q){return c._(this,void 0,void 0,(function*(){const ue=this.loading,de=Q.uid;ue&&ue[de]&&ue[de].abort&&(ue[de].abort.abort(),delete ue[de])}))}removeTile(Q){return c._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Q.uid]&&delete this.loaded[Q.uid]}))}}class L{constructor(){this.loaded={}}loadTile(Q){return c._(this,void 0,void 0,(function*(){const{uid:ue,encoding:de,rawImageData:Pe,redFactor:Re,greenFactor:rt,blueFactor:ot,baseShift:Xe}=Q,mt=Pe.width+2,Et=Pe.height+2,kt=c.b(Pe)?new c.R({width:mt,height:Et},yield c.c$(Pe,-1,-1,mt,Et)):Pe,Jt=new c.d0(ue,kt,de,Re,rt,ot,Xe);return this.loaded=this.loaded||{},this.loaded[ue]=Jt,Jt}))}removeTile(Q){const ue=this.loaded,de=Q.uid;ue&&ue[de]&&delete ue[de]}}var I,F,N=(function(){if(F)return I;function we(ue,de){if(ue.length!==0){Q(ue[0],de);for(var Pe=1;Pe<ue.length;Pe++)Q(ue[Pe],!de)}}function Q(ue,de){for(var Pe=0,Re=0,rt=0,ot=ue.length,Xe=ot-1;rt<ot;Xe=rt++){var mt=(ue[rt][0]-ue[Xe][0])*(ue[Xe][1]+ue[rt][1]),Et=Pe+mt;Re+=Math.abs(Pe)>=Math.abs(mt)?Pe-Et+mt:mt-Et+Pe,Pe=Et}Pe+Re>=0!=!!de&&ue.reverse()}return F=1,I=function ue(de,Pe){var Re,rt=de&&de.type;if(rt==="FeatureCollection")for(Re=0;Re<de.features.length;Re++)ue(de.features[Re],Pe);else if(rt==="GeometryCollection")for(Re=0;Re<de.geometries.length;Re++)ue(de.geometries[Re],Pe);else if(rt==="Feature")ue(de.geometry,Pe);else if(rt==="Polygon")we(de.coordinates,Pe);else if(rt==="MultiPolygon")for(Re=0;Re<de.coordinates.length;Re++)we(de.coordinates[Re],Pe);return de}})(),H=c.d1(N);const Y={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:we=>we},q=Math.fround||(U=new Float32Array(1),we=>(U[0]=+we,U[0]));var U;class G{constructor(Q){this.options=Object.assign(Object.create(Y),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ue,minZoom:de,maxZoom:Pe}=this.options;ue&&console.time("total time");const Re=`prepare ${Q.length} points`;ue&&console.time(Re),this.points=Q;const rt=[];for(let Xe=0;Xe<Q.length;Xe++){const mt=Q[Xe];if(!mt.geometry)continue;const[Et,kt]=mt.geometry.coordinates,Jt=q(ne(Et)),vi=q(J(kt));rt.push(Jt,vi,1/0,Xe,-1,1),this.options.reduce&&rt.push(0)}let ot=this.trees[Pe+1]=this._createTree(rt);ue&&console.timeEnd(Re);for(let Xe=Pe;Xe>=de;Xe--){const mt=+Date.now();ot=this.trees[Xe]=this._createTree(this._cluster(ot,Xe)),ue&&console.log("z%d: %d clusters in %dms",Xe,ot.numItems,+Date.now()-mt)}return ue&&console.timeEnd("total time"),this}getClusters(Q,ue){let de=((Q[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,Q[1]));let Re=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const rt=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)de=-180,Re=180;else if(de>Re){const kt=this.getClusters([de,Pe,180,rt],ue),Jt=this.getClusters([-180,Pe,Re,rt],ue);return kt.concat(Jt)}const ot=this.trees[this._limitZoom(ue)],Xe=ot.range(ne(de),J(rt),ne(Re),J(Pe)),mt=ot.data,Et=[];for(const kt of Xe){const Jt=this.stride*kt;Et.push(mt[Jt+5]>1?j(mt,Jt,this.clusterProps):this.points[mt[Jt+3]])}return Et}getChildren(Q){const ue=this._getOriginId(Q),de=this._getOriginZoom(Q),Pe="No cluster with the specified id.",Re=this.trees[de];if(!Re)throw new Error(Pe);const rt=Re.data;if(ue*this.stride>=rt.length)throw new Error(Pe);const ot=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Xe=Re.within(rt[ue*this.stride],rt[ue*this.stride+1],ot),mt=[];for(const Et of Xe){const kt=Et*this.stride;rt[kt+4]===Q&&mt.push(rt[kt+5]>1?j(rt,kt,this.clusterProps):this.points[rt[kt+3]])}if(mt.length===0)throw new Error(Pe);return mt}getLeaves(Q,ue,de){const Pe=[];return this._appendLeaves(Pe,Q,ue=ue||10,de=de||0,0),Pe}getTile(Q,ue,de){const Pe=this.trees[this._limitZoom(Q)],Re=Math.pow(2,Q),{extent:rt,radius:ot}=this.options,Xe=ot/rt,mt=(de-Xe)/Re,Et=(de+1+Xe)/Re,kt={features:[]};return this._addTileFeatures(Pe.range((ue-Xe)/Re,mt,(ue+1+Xe)/Re,Et),Pe.data,ue,de,Re,kt),ue===0&&this._addTileFeatures(Pe.range(1-Xe/Re,mt,1,Et),Pe.data,Re,de,Re,kt),ue===Re-1&&this._addTileFeatures(Pe.range(0,mt,Xe/Re,Et),Pe.data,-1,de,Re,kt),kt.features.length?kt:null}getClusterExpansionZoom(Q){let ue=this._getOriginZoom(Q)-1;for(;ue<=this.options.maxZoom;){const de=this.getChildren(Q);if(ue++,de.length!==1)break;Q=de[0].properties.cluster_id}return ue}_appendLeaves(Q,ue,de,Pe,Re){const rt=this.getChildren(ue);for(const ot of rt){const Xe=ot.properties;if(Xe&&Xe.cluster?Re+Xe.point_count<=Pe?Re+=Xe.point_count:Re=this._appendLeaves(Q,Xe.cluster_id,de,Pe,Re):Re<Pe?Re++:Q.push(ot),Q.length===de)break}return Re}_createTree(Q){const ue=new c.aT(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<Q.length;de+=this.stride)ue.add(Q[de],Q[de+1]);return ue.finish(),ue.data=Q,ue}_addTileFeatures(Q,ue,de,Pe,Re,rt){for(const ot of Q){const Xe=ot*this.stride,mt=ue[Xe+5]>1;let Et,kt,Jt;if(mt)Et=B(ue,Xe,this.clusterProps),kt=ue[Xe],Jt=ue[Xe+1];else{const vn=this.points[ue[Xe+3]];Et=vn.properties;const[rn,gt]=vn.geometry.coordinates;kt=ne(rn),Jt=J(gt)}const vi={type:1,geometry:[[Math.round(this.options.extent*(kt*Re-de)),Math.round(this.options.extent*(Jt*Re-Pe))]],tags:Et};let $i;$i=mt||this.options.generateId?ue[Xe+3]:this.points[ue[Xe+3]].id,$i!==void 0&&(vi.id=$i),rt.features.push(vi)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ue){const{radius:de,extent:Pe,reduce:Re,minPoints:rt}=this.options,ot=de/(Pe*Math.pow(2,ue)),Xe=Q.data,mt=[],Et=this.stride;for(let kt=0;kt<Xe.length;kt+=Et){if(Xe[kt+2]<=ue)continue;Xe[kt+2]=ue;const Jt=Xe[kt],vi=Xe[kt+1],$i=Q.within(Xe[kt],Xe[kt+1],ot),vn=Xe[kt+5];let rn=vn;for(const gt of $i){const gn=gt*Et;Xe[gn+2]>ue&&(rn+=Xe[gn+5])}if(rn>vn&&rn>=rt){let gt,gn=Jt*vn,Er=vi*vn,Di=-1;const yn=(kt/Et<<5)+(ue+1)+this.points.length;for(const Yn of $i){const Cn=Yn*Et;if(Xe[Cn+2]<=ue)continue;Xe[Cn+2]=ue;const Vn=Xe[Cn+5];gn+=Xe[Cn]*Vn,Er+=Xe[Cn+1]*Vn,Xe[Cn+4]=yn,Re&&(gt||(gt=this._map(Xe,kt,!0),Di=this.clusterProps.length,this.clusterProps.push(gt)),Re(gt,this._map(Xe,Cn)))}Xe[kt+4]=yn,mt.push(gn/rn,Er/rn,1/0,yn,-1,rn),Re&&mt.push(Di)}else{for(let gt=0;gt<Et;gt++)mt.push(Xe[kt+gt]);if(rn>1)for(const gt of $i){const gn=gt*Et;if(!(Xe[gn+2]<=ue)){Xe[gn+2]=ue;for(let Er=0;Er<Et;Er++)mt.push(Xe[gn+Er])}}}}return mt}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ue,de){if(Q[ue+5]>1){const rt=this.clusterProps[Q[ue+6]];return de?Object.assign({},rt):rt}const Pe=this.points[Q[ue+3]].properties,Re=this.options.map(Pe);return de&&Re===Pe?Object.assign({},Re):Re}}function j(we,Q,ue){return{type:"Feature",id:we[Q+3],properties:B(we,Q,ue),geometry:{type:"Point",coordinates:[(de=we[Q],360*(de-.5)),le(we[Q+1])]}};var de}function B(we,Q,ue){const de=we[Q+5],Pe=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Re=we[Q+6],rt=Re===-1?{}:Object.assign({},ue[Re]);return Object.assign(rt,{cluster:!0,cluster_id:we[Q+3],point_count:de,point_count_abbreviated:Pe})}function ne(we){return we/360+.5}function J(we){const Q=Math.sin(we*Math.PI/180),ue=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ue<0?0:ue>1?1:ue}function le(we){const Q=(180-360*we)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function ae(we,Q,ue,de){let Pe=de;const Re=Q+(ue-Q>>1);let rt,ot=ue-Q;const Xe=we[Q],mt=we[Q+1],Et=we[ue],kt=we[ue+1];for(let Jt=Q+3;Jt<ue;Jt+=3){const vi=pe(we[Jt],we[Jt+1],Xe,mt,Et,kt);if(vi>Pe)rt=Jt,Pe=vi;else if(vi===Pe){const $i=Math.abs(Jt-Re);$i<ot&&(rt=Jt,ot=$i)}}Pe>de&&(rt-Q>3&&ae(we,Q,rt,de),we[rt+2]=Pe,ue-rt>3&&ae(we,rt,ue,de))}function pe(we,Q,ue,de,Pe,Re){let rt=Pe-ue,ot=Re-de;if(rt!==0||ot!==0){const Xe=((we-ue)*rt+(Q-de)*ot)/(rt*rt+ot*ot);Xe>1?(ue=Pe,de=Re):Xe>0&&(ue+=rt*Xe,de+=ot*Xe)}return rt=we-ue,ot=Q-de,rt*rt+ot*ot}function fe(we,Q,ue,de){const Pe={id:we??null,type:Q,geometry:ue,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")Te(Pe,ue);else if(Q==="Polygon")Te(Pe,ue[0]);else if(Q==="MultiLineString")for(const Re of ue)Te(Pe,Re);else if(Q==="MultiPolygon")for(const Re of ue)Te(Pe,Re[0]);return Pe}function Te(we,Q){for(let ue=0;ue<Q.length;ue+=3)we.minX=Math.min(we.minX,Q[ue]),we.minY=Math.min(we.minY,Q[ue+1]),we.maxX=Math.max(we.maxX,Q[ue]),we.maxY=Math.max(we.maxY,Q[ue+1])}function Ce(we,Q,ue,de){if(!Q.geometry)return;const Pe=Q.geometry.coordinates;if(Pe&&Pe.length===0)return;const Re=Q.geometry.type,rt=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let ot=[],Xe=Q.id;if(ue.promoteId?Xe=Q.properties[ue.promoteId]:ue.generateId&&(Xe=de||0),Re==="Point")tt(Pe,ot);else if(Re==="MultiPoint")for(const mt of Pe)tt(mt,ot);else if(Re==="LineString")Ke(Pe,ot,rt,!1);else if(Re==="MultiLineString"){if(ue.lineMetrics){for(const mt of Pe)ot=[],Ke(mt,ot,rt,!1),we.push(fe(Xe,"LineString",ot,Q.properties));return}dt(Pe,ot,rt,!1)}else if(Re==="Polygon")dt(Pe,ot,rt,!0);else{if(Re!=="MultiPolygon"){if(Re==="GeometryCollection"){for(const mt of Q.geometry.geometries)Ce(we,{id:Xe,geometry:mt,properties:Q.properties},ue,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const mt of Pe){const Et=[];dt(mt,Et,rt,!0),ot.push(Et)}}we.push(fe(Xe,Re,ot,Q.properties))}function tt(we,Q){Q.push(et(we[0]),Oe(we[1]),0)}function Ke(we,Q,ue,de){let Pe,Re,rt=0;for(let Xe=0;Xe<we.length;Xe++){const mt=et(we[Xe][0]),Et=Oe(we[Xe][1]);Q.push(mt,Et,0),Xe>0&&(rt+=de?(Pe*Et-mt*Re)/2:Math.sqrt(Math.pow(mt-Pe,2)+Math.pow(Et-Re,2))),Pe=mt,Re=Et}const ot=Q.length-3;Q[2]=1,ae(Q,0,ot,ue),Q[ot+2]=1,Q.size=Math.abs(rt),Q.start=0,Q.end=Q.size}function dt(we,Q,ue,de){for(let Pe=0;Pe<we.length;Pe++){const Re=[];Ke(we[Pe],Re,ue,de),Q.push(Re)}}function et(we){return we/360+.5}function Oe(we){const Q=Math.sin(we*Math.PI/180),ue=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ue<0?0:ue>1?1:ue}function lt(we,Q,ue,de,Pe,Re,rt,ot){if(de/=Q,Re>=(ue/=Q)&&rt<de)return we;if(rt<ue||Re>=de)return null;const Xe=[];for(const mt of we){const Et=mt.geometry;let kt=mt.type;const Jt=Pe===0?mt.minX:mt.minY,vi=Pe===0?mt.maxX:mt.maxY;if(Jt>=ue&&vi<de){Xe.push(mt);continue}if(vi<ue||Jt>=de)continue;let $i=[];if(kt==="Point"||kt==="MultiPoint")Ye(Et,$i,ue,de,Pe);else if(kt==="LineString")zt(Et,$i,ue,de,Pe,!1,ot.lineMetrics);else if(kt==="MultiLineString")At(Et,$i,ue,de,Pe,!1);else if(kt==="Polygon")At(Et,$i,ue,de,Pe,!0);else if(kt==="MultiPolygon")for(const vn of Et){const rn=[];At(vn,rn,ue,de,Pe,!0),rn.length&&$i.push(rn)}if($i.length){if(ot.lineMetrics&&kt==="LineString"){for(const vn of $i)Xe.push(fe(mt.id,kt,vn,mt.tags));continue}kt!=="LineString"&&kt!=="MultiLineString"||($i.length===1?(kt="LineString",$i=$i[0]):kt="MultiLineString"),kt!=="Point"&&kt!=="MultiPoint"||(kt=$i.length===3?"Point":"MultiPoint"),Xe.push(fe(mt.id,kt,$i,mt.tags))}}return Xe.length?Xe:null}function Ye(we,Q,ue,de,Pe){for(let Re=0;Re<we.length;Re+=3){const rt=we[Re+Pe];rt>=ue&&rt<=de&&Nt(Q,we[Re],we[Re+1],we[Re+2])}}function zt(we,Q,ue,de,Pe,Re,rt){let ot=Lt(we);const Xe=Pe===0?$t:Ze;let mt,Et,kt=we.start;for(let rn=0;rn<we.length-3;rn+=3){const gt=we[rn],gn=we[rn+1],Er=we[rn+2],Di=we[rn+3],yn=we[rn+4],Yn=Pe===0?gt:gn,Cn=Pe===0?Di:yn;let Vn=!1;rt&&(mt=Math.sqrt(Math.pow(gt-Di,2)+Math.pow(gn-yn,2))),Yn<ue?Cn>ue&&(Et=Xe(ot,gt,gn,Di,yn,ue),rt&&(ot.start=kt+mt*Et)):Yn>de?Cn<de&&(Et=Xe(ot,gt,gn,Di,yn,de),rt&&(ot.start=kt+mt*Et)):Nt(ot,gt,gn,Er),Cn<ue&&Yn>=ue&&(Et=Xe(ot,gt,gn,Di,yn,ue),Vn=!0),Cn>de&&Yn<=de&&(Et=Xe(ot,gt,gn,Di,yn,de),Vn=!0),!Re&&Vn&&(rt&&(ot.end=kt+mt*Et),Q.push(ot),ot=Lt(we)),rt&&(kt+=mt)}let Jt=we.length-3;const vi=we[Jt],$i=we[Jt+1],vn=Pe===0?vi:$i;vn>=ue&&vn<=de&&Nt(ot,vi,$i,we[Jt+2]),Jt=ot.length-3,Re&&Jt>=3&&(ot[Jt]!==ot[0]||ot[Jt+1]!==ot[1])&&Nt(ot,ot[0],ot[1],ot[2]),ot.length&&Q.push(ot)}function Lt(we){const Q=[];return Q.size=we.size,Q.start=we.start,Q.end=we.end,Q}function At(we,Q,ue,de,Pe,Re){for(const rt of we)zt(rt,Q,ue,de,Pe,Re,!1)}function Nt(we,Q,ue,de){we.push(Q,ue,de)}function $t(we,Q,ue,de,Pe,Re){const rt=(Re-Q)/(de-Q);return Nt(we,Re,ue+(Pe-ue)*rt,1),rt}function Ze(we,Q,ue,de,Pe,Re){const rt=(Re-ue)/(Pe-ue);return Nt(we,Q+(de-Q)*rt,Re,1),rt}function bt(we,Q){const ue=[];for(let de=0;de<we.length;de++){const Pe=we[de],Re=Pe.type;let rt;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")rt=Mt(Pe.geometry,Q);else if(Re==="MultiLineString"||Re==="Polygon"){rt=[];for(const ot of Pe.geometry)rt.push(Mt(ot,Q))}else if(Re==="MultiPolygon"){rt=[];for(const ot of Pe.geometry){const Xe=[];for(const mt of ot)Xe.push(Mt(mt,Q));rt.push(Xe)}}ue.push(fe(Pe.id,Re,rt,Pe.tags))}return ue}function Mt(we,Q){const ue=[];ue.size=we.size,we.start!==void 0&&(ue.start=we.start,ue.end=we.end);for(let de=0;de<we.length;de+=3)ue.push(we[de]+Q,we[de+1],we[de+2]);return ue}function Zt(we,Q){if(we.transformed)return we;const ue=1<<we.z,de=we.x,Pe=we.y;for(const Re of we.features){const rt=Re.geometry,ot=Re.type;if(Re.geometry=[],ot===1)for(let Xe=0;Xe<rt.length;Xe+=2)Re.geometry.push(Pt(rt[Xe],rt[Xe+1],Q,ue,de,Pe));else for(let Xe=0;Xe<rt.length;Xe++){const mt=[];for(let Et=0;Et<rt[Xe].length;Et+=2)mt.push(Pt(rt[Xe][Et],rt[Xe][Et+1],Q,ue,de,Pe));Re.geometry.push(mt)}}return we.transformed=!0,we}function Pt(we,Q,ue,de,Pe,Re){return[Math.round(ue*(we*de-Pe)),Math.round(ue*(Q*de-Re))]}function Ee(we,Q,ue,de,Pe){const Re=Q===Pe.maxZoom?0:Pe.tolerance/((1<<Q)*Pe.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:we.length,source:null,x:ue,y:de,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ot of we)xe(rt,ot,Re,Pe);return rt}function xe(we,Q,ue,de){const Pe=Q.geometry,Re=Q.type,rt=[];if(we.minX=Math.min(we.minX,Q.minX),we.minY=Math.min(we.minY,Q.minY),we.maxX=Math.max(we.maxX,Q.maxX),we.maxY=Math.max(we.maxY,Q.maxY),Re==="Point"||Re==="MultiPoint")for(let ot=0;ot<Pe.length;ot+=3)rt.push(Pe[ot],Pe[ot+1]),we.numPoints++,we.numSimplified++;else if(Re==="LineString")ft(rt,Pe,we,ue,!1,!1);else if(Re==="MultiLineString"||Re==="Polygon")for(let ot=0;ot<Pe.length;ot++)ft(rt,Pe[ot],we,ue,Re==="Polygon",ot===0);else if(Re==="MultiPolygon")for(let ot=0;ot<Pe.length;ot++){const Xe=Pe[ot];for(let mt=0;mt<Xe.length;mt++)ft(rt,Xe[mt],we,ue,!0,mt===0)}if(rt.length){let ot=Q.tags||null;if(Re==="LineString"&&de.lineMetrics){ot={};for(const mt in Q.tags)ot[mt]=Q.tags[mt];ot.mapbox_clip_start=Pe.start/Pe.size,ot.mapbox_clip_end=Pe.end/Pe.size}const Xe={geometry:rt,type:Re==="Polygon"||Re==="MultiPolygon"?3:Re==="LineString"||Re==="MultiLineString"?2:1,tags:ot};Q.id!==null&&(Xe.id=Q.id),we.features.push(Xe)}}function ft(we,Q,ue,de,Pe,Re){const rt=de*de;if(de>0&&Q.size<(Pe?rt:de))return void(ue.numPoints+=Q.length/3);const ot=[];for(let Xe=0;Xe<Q.length;Xe+=3)(de===0||Q[Xe+2]>rt)&&(ue.numSimplified++,ot.push(Q[Xe],Q[Xe+1])),ue.numPoints++;Pe&&(function(Xe,mt){let Et=0;for(let kt=0,Jt=Xe.length,vi=Jt-2;kt<Jt;vi=kt,kt+=2)Et+=(Xe[kt]-Xe[vi])*(Xe[kt+1]+Xe[vi+1]);if(Et>0===mt)for(let kt=0,Jt=Xe.length;kt<Jt/2;kt+=2){const vi=Xe[kt],$i=Xe[kt+1];Xe[kt]=Xe[Jt-2-kt],Xe[kt+1]=Xe[Jt-1-kt],Xe[Jt-2-kt]=vi,Xe[Jt-1-kt]=$i}})(ot,Re),we.push(ot)}const ve={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class te{constructor(Q,ue){const de=(ue=this.options=(function(Re,rt){for(const ot in rt)Re[ot]=rt[ot];return Re})(Object.create(ve),ue)).debug;if(de&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=(function(Re,rt){const ot=[];if(Re.type==="FeatureCollection")for(let Xe=0;Xe<Re.features.length;Xe++)Ce(ot,Re.features[Xe],rt,Xe);else Ce(ot,Re.type==="Feature"?Re:{geometry:Re},rt);return ot})(Q,ue);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=(function(Re,rt){const ot=rt.buffer/rt.extent;let Xe=Re;const mt=lt(Re,1,-1-ot,ot,0,-1,2,rt),Et=lt(Re,1,1-ot,2+ot,0,-1,2,rt);return(mt||Et)&&(Xe=lt(Re,1,-ot,1+ot,0,-1,2,rt)||[],mt&&(Xe=bt(mt,1).concat(Xe)),Et&&(Xe=Xe.concat(bt(Et,-1)))),Xe})(Pe,ue),Pe.length&&this.splitTile(Pe,0,0,0),de&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,ue,de,Pe,Re,rt,ot){const Xe=[Q,ue,de,Pe],mt=this.options,Et=mt.debug;for(;Xe.length;){Pe=Xe.pop(),de=Xe.pop(),ue=Xe.pop(),Q=Xe.pop();const kt=1<<ue,Jt=se(ue,de,Pe);let vi=this.tiles[Jt];if(!vi&&(Et>1&&console.time("creation"),vi=this.tiles[Jt]=Ee(Q,ue,de,Pe,mt),this.tileCoords.push({z:ue,x:de,y:Pe}),Et)){Et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,de,Pe,vi.numFeatures,vi.numPoints,vi.numSimplified),console.timeEnd("creation"));const Vn=`z${ue}`;this.stats[Vn]=(this.stats[Vn]||0)+1,this.total++}if(vi.source=Q,Re==null){if(ue===mt.indexMaxZoom||vi.numPoints<=mt.indexMaxPoints)continue}else{if(ue===mt.maxZoom||ue===Re)continue;if(Re!=null){const Vn=Re-ue;if(de!==rt>>Vn||Pe!==ot>>Vn)continue}}if(vi.source=null,Q.length===0)continue;Et>1&&console.time("clipping");const $i=.5*mt.buffer/mt.extent,vn=.5-$i,rn=.5+$i,gt=1+$i;let gn=null,Er=null,Di=null,yn=null,Yn=lt(Q,kt,de-$i,de+rn,0,vi.minX,vi.maxX,mt),Cn=lt(Q,kt,de+vn,de+gt,0,vi.minX,vi.maxX,mt);Q=null,Yn&&(gn=lt(Yn,kt,Pe-$i,Pe+rn,1,vi.minY,vi.maxY,mt),Er=lt(Yn,kt,Pe+vn,Pe+gt,1,vi.minY,vi.maxY,mt),Yn=null),Cn&&(Di=lt(Cn,kt,Pe-$i,Pe+rn,1,vi.minY,vi.maxY,mt),yn=lt(Cn,kt,Pe+vn,Pe+gt,1,vi.minY,vi.maxY,mt),Cn=null),Et>1&&console.timeEnd("clipping"),Xe.push(gn||[],ue+1,2*de,2*Pe),Xe.push(Er||[],ue+1,2*de,2*Pe+1),Xe.push(Di||[],ue+1,2*de+1,2*Pe),Xe.push(yn||[],ue+1,2*de+1,2*Pe+1)}}getTile(Q,ue,de){Q=+Q,ue=+ue,de=+de;const Pe=this.options,{extent:Re,debug:rt}=Pe;if(Q<0||Q>24)return null;const ot=1<<Q,Xe=se(Q,ue=ue+ot&ot-1,de);if(this.tiles[Xe])return Zt(this.tiles[Xe],Re);rt>1&&console.log("drilling down to z%d-%d-%d",Q,ue,de);let mt,Et=Q,kt=ue,Jt=de;for(;!mt&&Et>0;)Et--,kt>>=1,Jt>>=1,mt=this.tiles[se(Et,kt,Jt)];return mt&&mt.source?(rt>1&&(console.log("found parent tile z%d-%d-%d",Et,kt,Jt),console.time("drilling down")),this.splitTile(mt.source,Et,kt,Jt,Q,ue,de),rt>1&&console.timeEnd("drilling down"),this.tiles[Xe]?Zt(this.tiles[Xe],Re):null):null}}function se(we,Q,ue){return 32*((1<<we)*ue+Q)+we}class Ie extends k{constructor(Q,ue,de,Pe=Ue){super(Q,ue,de),this._dataUpdateable=new Map,this._createGeoJSONIndex=Pe}loadVectorTile(Q,ue){return c._(this,void 0,void 0,(function*(){const de=Q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Pe=this._geoJSONIndex.getTile(de.z,de.x,de.y);return Pe?M(new c.d2(Pe.features,{version:2,extent:c.a5})):null}))}loadData(Q){return c._(this,void 0,void 0,(function*(){var ue;(ue=this._pendingRequest)===null||ue===void 0||ue.abort();const de=this._startPerformance(Q);this._pendingRequest=new AbortController;try{(!this._pendingData||Q.request||Q.data||Q.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Q,this._pendingRequest));const Pe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Pe,Q),this.loaded={};const Re={};return Q.request&&(Re.data=Pe),this._finishPerformance(de,Q,Re),Re}catch(Pe){if(delete this._pendingRequest,c.Z(Pe))return{abandoned:!0};throw Pe}}))}_startPerformance(Q){var ue;if(!((ue=Q?.request)===null||ue===void 0)&&ue.collectResourceTiming)return new c.c_(Q.request)}_finishPerformance(Q,ue,de){if(!Q)return;const Pe=Q.finish();Pe&&(de.resourceTiming={},de.resourceTiming[ue.source]=JSON.parse(JSON.stringify(Pe)))}getData(){return c._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Q){const ue=this.loaded;return ue&&ue[Q.uid]?super.reloadTile(Q):this.loadTile(Q)}loadAndProcessGeoJSON(Q,ue){return c._(this,void 0,void 0,(function*(){let de;if(Q.request?de=yield this.loadGeoJSONFromUrl(Q.request,Q.promoteId,ue):Q.data?de=this._loadGeoJSONFromObject(Q.data,Q.promoteId):Q.dataDiff&&(de=this._loadGeoJSONFromDiff(Q.dataDiff,Q.promoteId,Q.source)),delete this._pendingRequest,typeof de!="object")throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);return H(de,!0),Q.filter&&(de=this._filterGeoJSON(de,Q.filter)),de}))}loadGeoJSONFromUrl(Q,ue,de){return c._(this,void 0,void 0,(function*(){const Pe=yield c.j(Q,de);return this._dataUpdateable=c.a7(Pe.data,ue),Pe.data}))}_loadGeoJSONFromObject(Q,ue){return this._dataUpdateable=c.a7(Q,ue),Q}_loadGeoJSONFromDiff(Q,ue,de){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${de}`);c.a8(this._dataUpdateable,Q,ue);const Pe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Pe)}_filterGeoJSON(Q,ue){const de=c.d3(ue,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(de.result==="error")throw new Error(de.value.map((Re=>`${Re.key}: ${Re.message}`)).join(", "));const Pe=Q.features.filter((Re=>de.value.evaluate({zoom:0},Re)));return this._toFeatureCollection(Pe)}_toFeatureCollection(Q){return{type:"FeatureCollection",features:Q}}removeSource(Q){return c._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Q){return this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId)}getClusterChildren(Q){return this._geoJSONIndex.getChildren(Q.clusterId)}getClusterLeaves(Q){return this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset)}}function Ue(we,Q){return Q.cluster?new G((function({superclusterOptions:ue,clusterProperties:de}){if(!de||!ue)return ue;const Pe={},Re={},rt={accumulated:null,zoom:0},ot={properties:null},Xe=Object.keys(de);for(const mt of Xe){const[Et,kt]=de[mt],Jt=c.d3(kt),vi=c.d3(typeof Et=="string"?[Et,["accumulated"],["get",mt]]:Et);Pe[mt]=Jt.value,Re[mt]=vi.value}return ue.map=mt=>{ot.properties=mt;const Et={};for(const kt of Xe)Et[kt]=Pe[kt].evaluate(rt,ot);return Et},ue.reduce=(mt,Et)=>{ot.properties=Et;for(const kt of Xe)rt.accumulated=mt[kt],mt[kt]=Re[kt].evaluate(rt,ot)},ue})(Q)).load(we.features):(function(ue,de){return new te(ue,de)})(we,Q.geojsonVtOptions)}class ct{constructor(Q){this.self=Q,this.actor=new c.L(Q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(ue,de)=>{if(this.externalWorkerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.externalWorkerSourceTypes[ue]=de},this.self.addProtocol=c.cJ,this.self.removeProtocol=c.cK,this.self.registerRTLTextPlugin=ue=>{c.d4.setMethods(ue)},this.actor.registerMessageHandler("LDT",((ue,de)=>this._getDEMWorkerSource(ue,de.source).loadTile(de))),this.actor.registerMessageHandler("RDT",((ue,de)=>c._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(ue,de.source).removeTile(de)})))),this.actor.registerMessageHandler("GCEZ",((ue,de)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ue,de.type,de.source).getClusterExpansionZoom(de)})))),this.actor.registerMessageHandler("GCC",((ue,de)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ue,de.type,de.source).getClusterChildren(de)})))),this.actor.registerMessageHandler("GCL",((ue,de)=>c._(this,void 0,void 0,(function*(){return this._getWorkerSource(ue,de.type,de.source).getClusterLeaves(de)})))),this.actor.registerMessageHandler("LD",((ue,de)=>this._getWorkerSource(ue,de.type,de.source).loadData(de))),this.actor.registerMessageHandler("GD",((ue,de)=>this._getWorkerSource(ue,de.type,de.source).getData())),this.actor.registerMessageHandler("LT",((ue,de)=>this._getWorkerSource(ue,de.type,de.source).loadTile(de))),this.actor.registerMessageHandler("RT",((ue,de)=>this._getWorkerSource(ue,de.type,de.source).reloadTile(de))),this.actor.registerMessageHandler("AT",((ue,de)=>this._getWorkerSource(ue,de.type,de.source).abortTile(de))),this.actor.registerMessageHandler("RMT",((ue,de)=>this._getWorkerSource(ue,de.type,de.source).removeTile(de))),this.actor.registerMessageHandler("RS",((ue,de)=>c._(this,void 0,void 0,(function*(){if(!this.workerSources[ue]||!this.workerSources[ue][de.type]||!this.workerSources[ue][de.type][de.source])return;const Pe=this.workerSources[ue][de.type][de.source];delete this.workerSources[ue][de.type][de.source],Pe.removeSource!==void 0&&Pe.removeSource(de)})))),this.actor.registerMessageHandler("RM",(ue=>c._(this,void 0,void 0,(function*(){delete this.layerIndexes[ue],delete this.availableImages[ue],delete this.workerSources[ue],delete this.demWorkerSources[ue],this.globalStates.delete(ue)})))),this.actor.registerMessageHandler("SR",((ue,de)=>c._(this,void 0,void 0,(function*(){this.referrer=de})))),this.actor.registerMessageHandler("SRPS",((ue,de)=>this._syncRTLPluginState(ue,de))),this.actor.registerMessageHandler("IS",((ue,de)=>c._(this,void 0,void 0,(function*(){this.self.importScripts(de)})))),this.actor.registerMessageHandler("SI",((ue,de)=>this._setImages(ue,de))),this.actor.registerMessageHandler("UL",((ue,de)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(ue).update(de.layers,de.removedIds,this._getGlobalState(ue))})))),this.actor.registerMessageHandler("UGS",((ue,de)=>c._(this,void 0,void 0,(function*(){const Pe=this._getGlobalState(ue);for(const Re in de)Pe[Re]=de[Re]})))),this.actor.registerMessageHandler("SL",((ue,de)=>c._(this,void 0,void 0,(function*(){this._getLayerIndex(ue).replace(de,this._getGlobalState(ue))}))))}_getGlobalState(Q){let ue=this.globalStates.get(Q);return ue||(ue={},this.globalStates.set(Q,ue)),ue}_setImages(Q,ue){return c._(this,void 0,void 0,(function*(){this.availableImages[Q]=ue;for(const de in this.workerSources[Q]){const Pe=this.workerSources[Q][de];for(const Re in Pe)Pe[Re].availableImages=ue}}))}_syncRTLPluginState(Q,ue){return c._(this,void 0,void 0,(function*(){return yield c.d4.syncState(ue,this.self.importScripts)}))}_getAvailableImages(Q){let ue=this.availableImages[Q];return ue||(ue=[]),ue}_getLayerIndex(Q){let ue=this.layerIndexes[Q];return ue||(ue=this.layerIndexes[Q]=new s),ue}_getWorkerSource(Q,ue,de){if(this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ue]||(this.workerSources[Q][ue]={}),!this.workerSources[Q][ue][de]){const Pe={sendAsync:(Re,rt)=>(Re.targetMapId=Q,this.actor.sendAsync(Re,rt))};switch(ue){case"vector":this.workerSources[Q][ue][de]=new k(Pe,this._getLayerIndex(Q),this._getAvailableImages(Q));break;case"geojson":this.workerSources[Q][ue][de]=new Ie(Pe,this._getLayerIndex(Q),this._getAvailableImages(Q));break;default:this.workerSources[Q][ue][de]=new this.externalWorkerSourceTypes[ue](Pe,this._getLayerIndex(Q),this._getAvailableImages(Q))}}return this.workerSources[Q][ue][de]}_getDEMWorkerSource(Q,ue){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][ue]||(this.demWorkerSources[Q][ue]=new L),this.demWorkerSources[Q][ue]}}return c.i(self)&&(self.worker=new ct(self)),ct})),r("index",["exports","./shared"],(function(c,s){var f="5.15.0";function p(){var C=new s.A(4);return s.A!=Float32Array&&(C[1]=0,C[2]=0),C[0]=1,C[3]=1,C}let g,_,x;const b={frame(C,l,d){const v=requestAnimationFrame((E=>{w(),l(E)})),{unsubscribe:w}=s.s(C.signal,"abort",(()=>{w(),cancelAnimationFrame(v),d(new s.a(C.signal.reason))}),!1)},frameAsync(C){return new Promise(((l,d)=>{this.frame(C,l,d)}))},getImageData(C,l=0){return this.getImageCanvasContext(C).getImageData(-l,-l,C.width+2*l,C.height+2*l)},getImageCanvasContext(C){const l=window.document.createElement("canvas"),d=l.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return l.width=C.width,l.height=C.height,d.drawImage(C,0,0,C.width,C.height),d},resolveURL:C=>(g||(g=document.createElement("a")),g.href=C,g.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return x!==void 0?x:!!matchMedia&&(_==null&&(_=matchMedia("(prefers-reduced-motion: reduce)")),_.matches)},set prefersReducedMotion(C){x=C}},M=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(C){this._frozenAt=C}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function P(){return M.getCurrentTime()}class k{static testProp(l){if(!k.docStyle)return l[0];for(let d=0;d<l.length;d++)if(l[d]in k.docStyle)return l[d];return l[0]}static create(l,d,v){const w=window.document.createElement(l);return d!==void 0&&(w.className=d),v&&v.appendChild(w),w}static createNS(l,d){return window.document.createElementNS(l,d)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(l,d){l.style[k.transformProp]=d}static addEventListener(l,d,v,w={}){l.addEventListener(d,v,"passive"in w?w:w.capture)}static removeEventListener(l,d,v,w={}){l.removeEventListener(d,v,"passive"in w?w:w.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",k.suppressClickInternal,!0)}),0)}static getScale(l){const d=l.getBoundingClientRect();return{x:d.width/l.offsetWidth||1,y:d.height/l.offsetHeight||1,boundingClientRect:d}}static getPoint(l,d,v){const w=d.boundingClientRect;return new s.P((v.clientX-w.left)/d.x-l.clientLeft,(v.clientY-w.top)/d.y-l.clientTop)}static mousePos(l,d){const v=k.getScale(l);return k.getPoint(l,v,d)}static touchPos(l,d){const v=[],w=k.getScale(l);for(let E=0;E<d.length;E++)v.push(k.getPoint(l,w,d[E]));return v}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}static sanitize(l){const d=new DOMParser().parseFromString(l,"text/html").body||document.createElement("body"),v=d.querySelectorAll("script");for(const w of v)w.remove();return k.clean(d),d.innerHTML}static isPossiblyDangerous(l,d){const v=d.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(l)||!v.includes("javascript:")&&!v.includes("data:"))||!!l.startsWith("on")||void 0}static clean(l){const d=l.children;for(const v of d)k.removeAttributes(v),k.clean(v)}static removeAttributes(l){for(const{name:d,value:v}of l.attributes)k.isPossiblyDangerous(d,v)&&l.removeAttribute(d)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);const L={supported:!1,testSupport:function(C){!N&&F&&(H?Y(C):I=C)}};let I,F,N=!1,H=!1;function Y(C){const l=C.createTexture();C.bindTexture(C.TEXTURE_2D,l);try{if(C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,F),C.isContextLost())return;L.supported=!0}catch{}C.deleteTexture(l),N=!0}var q;typeof document<"u"&&(F=document.createElement("img"),F.onload=()=>{I&&Y(I),I=null,H=!0},F.onerror=()=>{N=!0,I=null},F.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(C){let l,d,v,w;C.resetRequestQueue=()=>{l=[],d=0,v=0,w={}},C.addThrottleControl=$=>{const W=v++;return w[W]=$,W},C.removeThrottleControl=$=>{delete w[$],R()},C.getImage=($,W,K=!0)=>new Promise(((ce,oe)=>{L.supported&&($.headers||($.headers={}),$.headers.accept="image/webp,*/*"),s.e($,{type:"image"}),l.push({abortController:W,requestParameters:$,supportImageRefresh:K,state:"queued",onError:ge=>{oe(ge)},onSuccess:ge=>{ce(ge)}}),R()}));const E=$=>s._(this,void 0,void 0,(function*(){$.state="running";const{requestParameters:W,supportImageRefresh:K,onError:ce,onSuccess:oe,abortController:ge}=$,be=K===!1&&!s.i(self)&&!s.g(W.url)&&(!W.headers||Object.keys(W.headers).reduce(((ke,Ne)=>ke&&Ne==="accept"),!0));d++;const Le=be?O(W,ge):s.m(W,ge);try{const ke=yield Le;delete $.abortController,$.state="completed",ke.data instanceof HTMLImageElement||s.b(ke.data)?oe(ke):ke.data&&oe({data:yield(De=ke.data,typeof createImageBitmap=="function"?s.f(De):s.h(De)),cacheControl:ke.cacheControl,expires:ke.expires})}catch(ke){delete $.abortController,ce(ke)}finally{d--,R()}var De})),R=()=>{const $=(()=>{for(const W of Object.keys(w))if(w[W]())return!0;return!1})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let W=d;W<$&&l.length>0;W++){const K=l.shift();K.abortController.signal.aborted?W--:E(K)}},O=($,W)=>new Promise(((K,ce)=>{const oe=new Image,ge=$.url,be=$.credentials;be&&be==="include"?oe.crossOrigin="use-credentials":(be&&be==="same-origin"||!s.d(ge))&&(oe.crossOrigin="anonymous"),W.signal.addEventListener("abort",(()=>{oe.src="",ce(new s.a(W.signal.reason))})),oe.fetchPriority="high",oe.onload=()=>{oe.onerror=oe.onload=null,K({data:oe})},oe.onerror=()=>{oe.onerror=oe.onload=null,W.signal.aborted||ce(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},oe.src=ge}))})(q||(q={})),q.resetRequestQueue();class U{constructor(l){this._transformRequestFn=l??null}transformRequest(l,d){return this._transformRequestFn&&this._transformRequestFn(l,d)||{url:l}}setTransformRequest(l){this._transformRequestFn=l}}function G(C){const l=[];if(typeof C=="string")l.push({id:"default",url:C});else if(C&&C.length>0){const d=[];for(const{id:v,url:w}of C){const E=`${v}${w}`;d.indexOf(E)===-1&&(d.push(E),l.push({id:v,url:w}))}}return l}function j(C,l,d){try{const v=new URL(C);return v.pathname+=`${l}${d}`,v.toString()}catch{throw new Error(`Invalid sprite URL "${C}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function B(C){const{userImage:l}=C;return!!(l&&l.render&&l.render())&&(C.data.replace(new Uint8Array(l.data.buffer)),!0)}class ne extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const l of Object.keys(this.images))this.removeImage(l);this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:d,promiseResolve:v}of this.requestors)v(this._getImagesForIds(d));this.requestors=[]}}getImage(l){const d=this.images[l];if(d&&!d.data&&d.spriteData){const v=d.spriteData;d.data=new s.R({width:v.width,height:v.height},v.context.getImageData(v.x,v.y,v.width,v.height).data),d.spriteData=null}return d}addImage(l,d){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let v=!0;const w=d.data||d.spriteData;return this._validateStretch(d.stretchX,w&&w.width)||(this.fire(new s.k(new Error(`Image "${l}" has invalid "stretchX" value`))),v=!1),this._validateStretch(d.stretchY,w&&w.height)||(this.fire(new s.k(new Error(`Image "${l}" has invalid "stretchY" value`))),v=!1),this._validateContent(d.content,d)||(this.fire(new s.k(new Error(`Image "${l}" has invalid "content" value`))),v=!1),v}_validateStretch(l,d){if(!l)return!0;let v=0;for(const w of l){if(w[0]<v||w[1]<w[0]||d<w[1])return!1;v=w[1]}return!0}_validateContent(l,d){if(!l)return!0;if(l.length!==4)return!1;const v=d.spriteData,w=v&&v.width||d.data.width,E=v&&v.height||d.data.height;return!(l[0]<0||w<l[0]||l[1]<0||E<l[1]||l[2]<0||w<l[2]||l[3]<0||E<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,d,v=!0){const w=this.getImage(l);if(v&&(w.data.width!==d.data.width||w.data.height!==d.data.height))throw new Error(`size mismatch between old image (${w.data.width}x${w.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=w.version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){const d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise(((d,v)=>{let w=!0;if(!this.isLoaded())for(const E of l)this.images[E]||(w=!1);this.isLoaded()||w?d(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:d})}))}_getImagesForIds(l){const d={};for(const v of l){let w=this.getImage(v);w||(this.fire(new s.l("styleimagemissing",{id:v})),w=this.getImage(v)),w?d[v]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,textFitWidth:w.textFitWidth,textFitHeight:w.textFitHeight,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:s.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){const d=this.patterns[l],v=this.getImage(l);if(!v)return null;if(d&&d.position.version===v.version)return d.position;if(d)d.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},E=new s.I(w,v);this.patterns[l]={bin:w,position:E}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(l,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const E in this.patterns)l.push(this.patterns[E].bin);const{w:d,h:v}=s.p(l),w=this.atlasImage;w.resize({width:d||1,height:v||1});for(const E in this.patterns){const{bin:R}=this.patterns[E],O=R.x+1,$=R.y+1,W=this.getImage(E).data,K=W.width,ce=W.height;s.R.copy(W,w,{x:0,y:0},{x:O,y:$},{width:K,height:ce}),s.R.copy(W,w,{x:0,y:ce-1},{x:O,y:$-1},{width:K,height:1}),s.R.copy(W,w,{x:0,y:0},{x:O,y:$+ce},{width:K,height:1}),s.R.copy(W,w,{x:K-1,y:0},{x:O-1,y:$},{width:1,height:ce}),s.R.copy(W,w,{x:0,y:0},{x:O+K,y:$},{width:1,height:ce})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const v=this.getImage(d);v||s.w(`Image with ID: "${d}" was not found`),B(v)&&this.updateImage(d,v)}}cloneImages(){const l={};for(const d in this.images){const v=this.images[d];l[d]=Object.assign(Object.assign({},v),{data:v.data?v.data.clone():null})}return l}}const J=1e20;function le(C,l,d,v,w,E,R,O,$){for(let W=l;W<l+v;W++)ae(C,d*E+W,E,w,R,O,$);for(let W=d;W<d+w;W++)ae(C,W*E+l,1,v,R,O,$)}function ae(C,l,d,v,w,E,R){E[0]=0,R[0]=-J,R[1]=J,w[0]=C[l];for(let O=1,$=0,W=0;O<v;O++){w[O]=C[l+O*d];const K=O*O;do{const ce=E[$];W=(w[O]-w[ce]+K-ce*ce)/(O-ce)/2}while(W<=R[$]&&--$>-1);$++,E[$]=O,R[$]=W,R[$+1]=J}for(let O=0,$=0;O<v;O++){for(;R[$+1]<O;)$++;const W=E[$],K=O-W;C[l+O*d]=w[W]+K*K}}const pe=s.v.layout_symbol["text-font"].default.join(",");class fe{constructor(l,d,v){this.requestManager=l,this.localIdeographFontFamily=d,this.entries={},this.lang=v}setURL(l){this.url=l}getGlyphs(l){return s._(this,void 0,void 0,(function*(){const d=[];for(const E in l)for(const R of l[E])d.push(this._getAndCacheGlyphsPromise(E,R));const v=yield Promise.all(d),w={};for(const{stack:E,id:R,glyph:O}of v)w[E]||(w[E]={}),w[E][R]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};return w}))}_getAndCacheGlyphsPromise(l,d){return s._(this,void 0,void 0,(function*(){let v=this.entries[l];v||(v=this.entries[l]={glyphs:{},requests:{},ranges:{}});let w=v.glyphs[d];return w!==void 0?{stack:l,id:d,glyph:w}:!this.url||this._charUsesLocalIdeographFontFamily(d)?(w=v.glyphs[d]=this._drawGlyph(v,l,d),{stack:l,id:d,glyph:w}):yield this._downloadAndCacheRangePromise(l,d)}))}_downloadAndCacheRangePromise(l,d){return s._(this,void 0,void 0,(function*(){const v=this.entries[l],w=Math.floor(d/256);if(v.ranges[w])return{stack:l,id:d,glyph:null};if(!v.requests[w]){const E=fe.loadGlyphRange(l,w,this.url,this.requestManager);v.requests[w]=E}try{const E=yield v.requests[w];for(const R in E)v.glyphs[+R]=E[+R];return v.ranges[w]=!0,{stack:l,id:d,glyph:E[d]||null}}catch(E){const R=v.glyphs[d]=this._drawGlyph(v,l,d);return this._warnOnMissingGlyphRange(R,w,d,E),{stack:l,id:d,glyph:R}}}))}_warnOnMissingGlyphRange(l,d,v,w){const E=256*d,R=E+255,O=v.toString(16).padStart(4,"0").toUpperCase();s.w(`Unable to load glyph range ${d}, ${E}-${R}. Rendering codepoint U+${O} locally instead. ${w}`)}_charUsesLocalIdeographFontFamily(l){return!!this.localIdeographFontFamily&&s.q(l)}_drawGlyph(l,d,v){const w=d===pe&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(v),E=w?"ideographTinySDF":"tinySDF";l[E]||(l[E]=this._createTinySDF(w?this.localIdeographFontFamily:d));const R=l[E].draw(String.fromCodePoint(v));return{id:v,bitmap:new s.r({width:R.width||60,height:R.height||60},R.data),metrics:{width:R.glyphWidth/2||24,height:R.glyphHeight/2||24,left:R.glyphLeft/2+.5||0,top:R.glyphTop/2-27.5||-8,advance:R.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(l){const d=l?l.split(","):[];d.push("sans-serif");const v=d.map((w=>/[-\w]+/.test(w)?w:`'${CSS.escape(w)}'`)).join(",");return new fe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:this._fontWeight(d[0]),fontStyle:this._fontStyle(d[0]),lang:this.lang})}_fontStyle(l){return/italic/i.test(l)?"italic":/oblique/i.test(l)?"oblique":"normal"}_fontWeight(l){const d={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let v;for(const[w,E]of Object.entries(d))new RegExp(`\\b${w}\\b`,"i").test(l)&&(v=`${E}`);return v}destroy(){for(const l in this.entries){const d=this.entries[l];d.tinySDF&&(d.tinySDF=null),d.ideographTinySDF&&(d.ideographTinySDF=null),d.glyphs={},d.requests={},d.ranges={}}this.entries={}}}fe.loadGlyphRange=function(C,l,d,v){return s._(this,void 0,void 0,(function*(){const w=256*l,E=w+255,R=v.transformRequest(d.replace("{fontstack}",C).replace("{range}",`${w}-${E}`),"Glyphs"),O=yield s.n(R,new AbortController);if(!O||!O.data)throw new Error(`Could not load glyph range. range: ${l}, ${w}-${E}`);const $={};for(const W of s.o(O.data))$[W.id]=W;return $}))},fe.TinySDF=class{constructor({fontSize:C=24,buffer:l=3,radius:d=8,cutoff:v=.25,fontFamily:w="sans-serif",fontWeight:E="normal",fontStyle:R="normal",lang:O=null}={}){this.buffer=l,this.cutoff=v,this.radius=d,this.lang=O;const $=this.size=C+4*l,W=this._createCanvas($),K=this.ctx=W.getContext("2d",{willReadFrequently:!0});K.font=`${R} ${E} ${C}px ${w}`,K.textBaseline="alphabetic",K.textAlign="left",K.fillStyle="black",this.gridOuter=new Float64Array($*$),this.gridInner=new Float64Array($*$),this.f=new Float64Array($),this.z=new Float64Array($+1),this.v=new Uint16Array($)}_createCanvas(C){const l=document.createElement("canvas");return l.width=l.height=C,l}draw(C){const{width:l,actualBoundingBoxAscent:d,actualBoundingBoxDescent:v,actualBoundingBoxLeft:w,actualBoundingBoxRight:E}=this.ctx.measureText(C),R=Math.ceil(d),O=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-w))),$=Math.min(this.size-this.buffer,R+Math.ceil(v)),W=O+2*this.buffer,K=$+2*this.buffer,ce=Math.max(W*K,0),oe=new Uint8ClampedArray(ce),ge={data:oe,width:W,height:K,glyphWidth:O,glyphHeight:$,glyphTop:R,glyphLeft:0,glyphAdvance:l};if(O===0||$===0)return ge;const{ctx:be,buffer:Le,gridInner:De,gridOuter:ke}=this;this.lang&&(be.lang=this.lang),be.clearRect(Le,Le,O,$),be.fillText(C,Le,Le+R);const Ne=be.getImageData(Le,Le,O,$);ke.fill(J,0,ce),De.fill(0,0,ce);for(let He=0;He<$;He++)for(let ze=0;ze<O;ze++){const Ge=Ne.data[4*(He*O+ze)+3]/255;if(Ge===0)continue;const Je=(He+Le)*W+ze+Le;if(Ge===1)ke[Je]=0,De[Je]=J;else{const je=.5-Ge;ke[Je]=je>0?je*je:0,De[Je]=je<0?je*je:0}}le(ke,0,0,W,K,W,this.f,this.v,this.z),le(De,Le,Le,O,$,W,this.f,this.v,this.z);for(let He=0;He<ce;He++){const ze=Math.sqrt(ke[He])-Math.sqrt(De[He]);oe[He]=Math.round(255-255*(ze/this.radius+this.cutoff))}return ge}};class Te{constructor(){this.specification=s.u.light.position}possiblyEvaluate(l,d){return s.F(l.expression.evaluate(d))}interpolate(l,d,v){return{x:s.G.number(l.x,d.x,v),y:s.G.number(l.y,d.y,v),z:s.G.number(l.z,d.z,v)}}}let Ce;class tt extends s.E{constructor(l){super(),Ce=Ce||new s.t({anchor:new s.D(s.u.light.anchor),position:new Te,color:new s.D(s.u.light.color),intensity:new s.D(s.u.light.intensity)}),this._transitionable=new s.x(Ce,void 0),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d={}){if(!this._validate(s.y,l,d))for(const v in l){const w=l[v];v.endsWith(s.z)?this._transitionable.setTransition(v.slice(0,-s.z.length),w):this._transitionable.setValue(v,w)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,v){return(!v||v.validate!==!1)&&s.B(this,l.call(s.C,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.u}))}}const Ke=new s.t({"sky-color":new s.D(s.u.sky["sky-color"]),"horizon-color":new s.D(s.u.sky["horizon-color"]),"fog-color":new s.D(s.u.sky["fog-color"]),"fog-ground-blend":new s.D(s.u.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.u.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.u.sky["atmosphere-blend"])});class dt extends s.E{constructor(l){super(),this._transitionable=new s.x(Ke,void 0),this.setSky(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0))}setSky(l,d={}){if(!this._validate(s.J,l,d)){l||(l={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const v in l){const w=l[v];v.endsWith(s.z)?this._transitionable.setTransition(v.slice(0,-s.z.length),w):this._transitionable.setValue(v,w)}}}getSky(){return this._transitionable.serialize()}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,v={}){return v?.validate!==!1&&s.B(this,l.call(s.C,s.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.u})))}calculateFogBlendOpacity(l){return l<60?0:l<70?(l-60)/10:1}}class et{constructor(l,d){this.width=l,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,d){const v=l.join(",")+String(d);return this.dashEntry[v]||(this.dashEntry[v]=this.addDash(l,d)),this.dashEntry[v]}getDashRanges(l,d,v){const w=[];let E=l.length%2==1?-l[l.length-1]*v:0,R=l[0]*v,O=!0;w.push({left:E,right:R,isDash:O,zeroLength:l[0]===0});let $=l[0];for(let W=1;W<l.length;W++){O=!O;const K=l[W];E=$*v,$+=K,R=$*v,w.push({left:E,right:R,isDash:O,zeroLength:K===0})}return w}addRoundDash(l,d,v){const w=d/2;for(let E=-v;E<=v;E++){const R=this.width*(this.nextRow+v+E);let O=0,$=l[O];for(let W=0;W<this.width;W++){W/$.right>1&&($=l[++O]);const K=Math.abs(W-$.left),ce=Math.abs(W-$.right),oe=Math.min(K,ce);let ge;const be=E/v*(w+1);if($.isDash){const Le=w-Math.abs(be);ge=Math.sqrt(oe*oe+Le*Le)}else ge=w-Math.sqrt(oe*oe+be*be);this.data[R+W]=Math.max(0,Math.min(255,ge+128))}}}addRegularDash(l){for(let O=l.length-1;O>=0;--O){const $=l[O],W=l[O+1];$.zeroLength?l.splice(O,1):W&&W.isDash===$.isDash&&(W.left=$.left,l.splice(O,1))}const d=l[0],v=l[l.length-1];d.isDash===v.isDash&&(d.left=v.left-this.width,v.right=d.right+this.width);const w=this.width*this.nextRow;let E=0,R=l[E];for(let O=0;O<this.width;O++){O/R.right>1&&(R=l[++E]);const $=Math.abs(O-R.left),W=Math.abs(O-R.right),K=Math.min($,W);this.data[w+O]=Math.max(0,Math.min(255,(R.isDash?K:-K)+128))}}addDash(l,d){const v=d?7:0,w=2*v+1;if(this.nextRow+w>this.height)return s.w("LineAtlas out of space"),null;let E=0;for(let O=0;O<l.length;O++)E+=l[O];if(E!==0){const O=this.width/E,$=this.getDashRanges(l,this.width,O);d?this.addRoundDash($,O,v):this.addRegularDash($)}const R={y:this.nextRow+v,height:2*v,width:E};return this.nextRow+=w,this.dirty=!0,R}bind(l){const d=l.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Oe="maplibre_preloaded_worker_pool";class lt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<lt.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach((d=>{d.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Oe]}numActive(){return Object.keys(this.active).length}}const Ye=Math.floor(b.hardwareConcurrency/2);let zt,Lt;function At(){return zt||(zt=new lt),zt}lt.workerCount=s.K(globalThis)?Math.max(Math.min(Ye,3),1):1;class Nt{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=d;const v=this.workerPool.acquire(d);for(let w=0;w<v.length;w++){const E=new s.L(v[w],d);E.name=`Worker ${w}`,this.actors.push(E)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,d){const v=[];for(const w of this.actors)v.push(w.sendAsync({type:l,data:d}));return Promise.all(v)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach((d=>{d.remove()})),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,d){for(const v of this.actors)v.registerMessageHandler(l,d)}unregisterMessageHandler(l){for(const d of this.actors)d.unregisterMessageHandler(l)}}function $t(){return Lt||(Lt=new Nt(At(),s.M),Lt.registerMessageHandler("GR",((C,l,d)=>s.m(l,d)))),Lt}function Ze(C,l){const d=s.N();return s.O(d,d,[1,1,0]),s.Q(d,d,[.5*C.width,.5*C.height,1]),C.calculatePosMatrix?s.S(d,d,C.calculatePosMatrix(l.toUnwrapped())):d}function bt(C,l,d,v,w,E,R){var O;const $=(function(oe,ge,be){if(oe)for(const Le of oe){const De=ge[Le];if(De&&De.source===be&&De.type==="fill-extrusion")return!0}else for(const Le in ge){const De=ge[Le];if(De.source===be&&De.type==="fill-extrusion")return!0}return!1})((O=w?.layers)!==null&&O!==void 0?O:null,l,C.id),W=E.maxPitchScaleFactor(),K=C.tilesIn(v,W,$);K.sort(Mt);const ce=[];for(const oe of K)ce.push({wrappedTileID:oe.tileID.wrapped().key,queryResults:oe.tile.queryRenderedFeatures(l,d,C.getState(),oe.queryGeometry,oe.cameraQueryGeometry,oe.scale,w,E,W,Ze(E,oe.tileID),R?(ge,be)=>R(oe.tileID,ge,be):void 0)});return(function(oe,ge){for(const be in oe)for(const Le of oe[be])Zt(Le,ge);return oe})((function(oe){const ge={},be={};for(const Le of oe){const De=Le.queryResults,ke=Le.wrappedTileID,Ne=be[ke]=be[ke]||{};for(const He in De){const ze=De[He],Ge=Ne[He]=Ne[He]||{},Je=ge[He]=ge[He]||[];for(const je of ze)Ge[je.featureIndex]||(Ge[je.featureIndex]=!0,Je.push(je))}}return ge})(ce),C)}function Mt(C,l){const d=C.tileID,v=l.tileID;return d.overscaledZ-v.overscaledZ||d.canonical.y-v.canonical.y||d.wrap-v.wrap||d.canonical.x-v.canonical.x}function Zt(C,l){const d=C.feature,v=l.getFeatureState(d.layer["source-layer"],d.id);d.source=d.layer.source,d.layer["source-layer"]&&(d.sourceLayer=d.layer["source-layer"]),d.state=v}function Pt(C,l,d){return s._(this,void 0,void 0,(function*(){let v=C;if(C.url?v=(yield s.j(l.transformRequest(C.url,"Source"),d)).data:yield b.frameAsync(d),!v)return null;const w=s.U(s.e(v,C),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in v&&v.vector_layers&&(w.vectorLayerIds=v.vector_layers.map((E=>E.id))),w}))}class Ee{constructor(l,d){l&&(d?this.setSouthWest(l).setNorthEast(d):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof s.V?new s.V(l.lng,l.lat):s.V.convert(l),this}setSouthWest(l){return this._sw=l instanceof s.V?new s.V(l.lng,l.lat):s.V.convert(l),this}extend(l){const d=this._sw,v=this._ne;let w,E;if(l instanceof s.V)w=l,E=l;else{if(!(l instanceof Ee))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ee.convert(l)):this.extend(s.V.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(s.V.convert(l)):this;if(w=l._sw,E=l._ne,!w||!E)return this}return d||v?(d.lng=Math.min(w.lng,d.lng),d.lat=Math.min(w.lat,d.lat),v.lng=Math.max(E.lng,v.lng),v.lat=Math.max(E.lat,v.lat)):(this._sw=new s.V(w.lng,w.lat),this._ne=new s.V(E.lng,E.lat)),this}getCenter(){return new s.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.V(this.getWest(),this.getNorth())}getSouthEast(){return new s.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:d,lat:v}=s.V.convert(l);let w=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(w=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&w}intersects(l){if(!((l=Ee.convert(l)).getNorth()>=this.getSouth()&&l.getSouth()<=this.getNorth()))return!1;const d=Math.abs(this.getEast()-this.getWest()),v=Math.abs(l.getEast()-l.getWest());if(d>=360||v>=360)return!0;const w=s.W(this.getWest(),-180,180),E=s.W(this.getEast(),-180,180),R=s.W(l.getWest(),-180,180),O=s.W(l.getEast(),-180,180),$=w>=E,W=R>=O;return!(!$||!W)||($?O>=w||R<=E:W?E>=R||w<=O:R<=E&&O>=w)}static convert(l){return l instanceof Ee?l:l&&new Ee(l)}static fromLngLat(l,d=0){const v=360*d/40075017,w=v/Math.cos(Math.PI/180*l.lat);return new Ee(new s.V(l.lng-w,l.lat-v),new s.V(l.lng+w,l.lat+v))}adjustAntiMeridian(){const l=new s.V(this._sw.lng,this._sw.lat),d=new s.V(this._ne.lng,this._ne.lat);return new Ee(l,l.lng>d.lng?new s.V(d.lng+360,d.lat):d)}}class xe{constructor(l,d,v){this.bounds=Ee.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=v||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),v=Math.floor(s.Y(this.bounds.getWest())*d),w=Math.floor(s.X(this.bounds.getNorth())*d),E=Math.ceil(s.Y(this.bounds.getEast())*d),R=Math.ceil(s.X(this.bounds.getSouth())*d);return l.x>=v&&l.x<E&&l.y>=w&&l.y<R}}class ft extends s.E{constructor(l,d,v,w){if(super(),this.id=l,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.U(d,["url","scheme","tileSize","promoteId","encoding"])),this._options=s.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield Pt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),l&&(s.e(this,l),l.bounds&&(this.tileBounds=new xe(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this._loaded=!0,s.Z(l)||this.fire(new s.k(l))}}))}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty((()=>{this._options.tiles=l})),this}setUrl(l){return this.setSourceProperty((()=>{this.url=l,this._options.url=l})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(l){return s._(this,void 0,void 0,(function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v={request:this.map._requestManager.transformRequest(d,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(l)};v.request.collectResourceTiming=this._collectResourceTiming;let w="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise(((E,R)=>{l.reloadPromise={resolve:E,reject:R}}))}else l.actor=this.dispatcher.getActor(),w="LT";l.abortController=new AbortController;try{const E=yield l.actor.sendAsync({type:w,data:v},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,E)}catch(E){if(delete l.abortController,l.aborted)return;if(E&&E.status!==404)throw E;this._afterTileLoadWorkerResponse(l,null)}}))}_getOverzoomParameters(l){if(l.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const d=l.tileID.scaledTo(this.maxzoom).canonical,v=d.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:d,overzoomRequest:this.map._requestManager.transformRequest(v,"Tile")}}_afterTileLoadWorkerResponse(l,d){if(d&&d.resourceTiming&&(l.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&l.setExpiryData(d),l.loadVectorData(d,this.map.painter),l.reloadPromise){const v=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(v.resolve).catch(v.reject)}}abortTile(l){return s._(this,void 0,void 0,(function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))}))}unloadTile(l){return s._(this,void 0,void 0,(function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ve extends s.E{constructor(l,d,v,w){super(),this.id=l,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},d),s.e(this,s.U(d,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,(function*(l=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const d=yield Pt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,d&&(s.e(this,d),d.bounds&&(this.tileBounds=new xe(d.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:l})))}catch(d){this._tileJSONRequest=null,this._loaded=!0,s.Z(d)||this.fire(new s.k(d))}}))}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load(!0)}setTiles(l){return this.setSourceProperty((()=>{this._options.tiles=l})),this}setUrl(l){return this.setSourceProperty((()=>{this.url=l,this._options.url=l})),this}serialize(){return s.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return s._(this,void 0,void 0,(function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const v=yield q.getImage(this.map._requestManager.transformRequest(d,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(v&&v.data){this.map._refreshExpiredTiles&&(v.cacheControl||v.expires)&&l.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const w=this.map.painter.context,E=w.gl,R=v.data;l.texture=this.map.painter.getTileTexture(R.width),l.texture?l.texture.update(R,{useMipmap:!0}):(l.texture=new s.T(w,R,E.RGBA,{useMipmap:!0}),l.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST)),l.state="loaded"}}catch(v){if(delete l.abortController,l.aborted)l.state="unloaded";else if(v)throw l.state="errored",v}}))}abortTile(l){return s._(this,void 0,void 0,(function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)}))}unloadTile(l){return s._(this,void 0,void 0,(function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)}))}hasTransition(){return!1}}class te extends ve{constructor(l,d,v,w){super(l,d,v,w),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(l){return s._(this,void 0,void 0,(function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v=this.map._requestManager.transformRequest(d,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const w=yield q.getImage(v,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(w&&w.data){const E=w.data;this.map._refreshExpiredTiles&&(w.cacheControl||w.expires)&&l.setExpiryData({cacheControl:w.cacheControl,expires:w.expires});const R=s.b(E)&&s.$()?E:yield this.readImageNow(E),O={type:this.type,uid:l.uid,source:this.id,rawImageData:R,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const $=yield l.actor.sendAsync({type:"LDT",data:O});l.dem=$,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(w){if(delete l.abortController,l.aborted)l.state="unloaded";else if(w)throw l.state="errored",w}}))}readImageNow(l){return s._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&s.a0()){const d=l.width+2,v=l.height+2;try{return new s.R({width:d,height:v},yield s.a1(l,-1,-1,d,v))}catch{}}return b.getImageData(l,1)}))}_getNeighboringTiles(l){const d=l.canonical,v=Math.pow(2,d.z),w=(d.x-1+v)%v,E=d.x===0?l.wrap-1:l.wrap,R=(d.x+1+v)%v,O=d.x+1===v?l.wrap+1:l.wrap,$={};return $[new s.a2(l.overscaledZ,E,d.z,w,d.y).key]={backfilled:!1},$[new s.a2(l.overscaledZ,O,d.z,R,d.y).key]={backfilled:!1},d.y>0&&($[new s.a2(l.overscaledZ,E,d.z,w,d.y-1).key]={backfilled:!1},$[new s.a2(l.overscaledZ,l.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},$[new s.a2(l.overscaledZ,O,d.z,R,d.y-1).key]={backfilled:!1}),d.y+1<v&&($[new s.a2(l.overscaledZ,E,d.z,w,d.y+1).key]={backfilled:!1},$[new s.a2(l.overscaledZ,l.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},$[new s.a2(l.overscaledZ,O,d.z,R,d.y+1).key]={backfilled:!1}),$}unloadTile(l){return s._(this,void 0,void 0,(function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))}))}}function se(C){return C.type==="GeometryCollection"?C.geometries.map((l=>l.coordinates)).flat(1/0):C.coordinates.flat(1/0)}function Ie(C){const l=new Ee;let d;switch(C.type){case"FeatureCollection":d=C.features.map((v=>se(v.geometry))).flat(1/0);break;case"Feature":d=se(C.geometry);break;default:d=se(C)}if(d.length==0)return l;for(let v=0;v<d.length-1;v+=2)l.extend([d[v],d[v+1]]);return l}class Ue extends s.E{constructor(l,d,v,w){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:d.data},this.actor=v.getActor(),this.setEventedParent(w),this._data=typeof d.data=="string"?{url:d.data}:{geojson:d.data},this._options=s.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId,d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(d.buffer!==void 0?d.buffer:128),tolerance:this._pixelsToTileUnits(d.tolerance!==void 0?d.tolerance:.375),extent:s.a5,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(d.clusterMaxZoom),minPoints:Math.max(2,d.clusterMinPoints||2),extent:s.a5,radius:this._pixelsToTileUnits(d.clusterRadius||50),log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(l){return l*(s.a5/this.tileSize)}_getClusterMaxZoom(l){const d=l?Math.round(l):this.maxzoom-1;return Number.isInteger(l)||l===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${l}" rounded to "${d}"`),d}load(){return s._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(l){this.map=l,this.load()}setData(l,d){this._data=typeof l=="string"?{url:l}:{geojson:l},this._pendingWorkerUpdate={data:l};const v=this._updateWorkerData();return d?v:this}updateData(l,d){this._pendingWorkerUpdate.diff=s.a6(this._pendingWorkerUpdate.diff,l);const v=this._updateWorkerData();return d?v:this}getData(){return s._(this,void 0,void 0,(function*(){const l=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:l})}))}getBounds(){return s._(this,void 0,void 0,(function*(){return Ie(yield this.getData())}))}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(l.clusterRadius)),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(l.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,d,v){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:d,offset:v}})}_updateWorkerData(){return s._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void s.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:l,diff:d}=this._pendingWorkerUpdate,v=s.e({type:this.type},this.workerOptions);l!==void 0?(typeof l=="string"?(v.request=this.map._requestManager.transformRequest(b.resolveURL(l),"Source"),v.request.collectResourceTiming=this._collectResourceTiming):v.data=l,this._pendingWorkerUpdate.data=void 0):d&&(v.dataDiff=d,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{const w=yield this.actor.sendAsync({type:"LD",data:v});if(this._isUpdatingWorker=!1,this._removed||w.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));w.data&&(this._data={geojson:w.data});const E=this._applyDiffToSource(d),R=this._getShouldReloadTileOptions(E);let O=null;w.resourceTiming&&w.resourceTiming[this.id]&&(O=w.resourceTiming[this.id].slice(0));const $={dataType:"source"};this._collectResourceTiming&&O&&O.length>0&&s.e($,{resourceTiming:O}),this.fire(new s.l("data",Object.assign(Object.assign({},$),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},$),{sourceDataType:"content",shouldReloadTileOptions:R})))}catch(w){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(w))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(l){if(!l)return;const d=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const w=s.a7(this._data.geojson,d);if(!w)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:w}}if(!this._data.updateable)return;const v=s.a8(this._data.updateable,l,d);return l.removeAll||this._options.cluster?void 0:v}_getShouldReloadTileOptions(l){if(l)return{affectedBounds:l.filter(Boolean).map((d=>Ie(d)))}}shouldReloadTile(l,{affectedBounds:d}){if(l.state==="loading")return!0;if(l.state==="unloaded")return!1;const{buffer:v,extent:w}=this.workerOptions.geojsonVtOptions,E=(function({x:R,y:O,z:$},W=0){const K=s.a3((R-W)/Math.pow(2,$)),ce=s.a4((O+1+W)/Math.pow(2,$)),oe=s.a3((R+1+W)/Math.pow(2,$)),ge=s.a4((O-W)/Math.pow(2,$));return new Ee([K,ce],[oe,ge])})(l.tileID.canonical,v/w);for(const R of d)if(E.intersects(R))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(l){return s._(this,void 0,void 0,(function*(){const d=l.actor?"RT":"LT";l.actor=this.actor;const v={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.abortController=new AbortController;const w=yield this.actor.sendAsync({type:d,data:v},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(w,this.map.painter,d==="RT")}))}abortTile(l){return s._(this,void 0,void 0,(function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0}))}unloadTile(l){return s._(this,void 0,void 0,(function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class ct extends s.E{constructor(l,d,v,w){super(),this.flippedWindingOrder=!1,this.id=l,this.dispatcher=v,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}load(l){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield q.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,l&&(this.coordinates=l),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,s.Z(d)||this.fire(new s.k(d))}}))}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const d=l.map(s.a9.fromLngLat);var v;return this.tileID=(function(w){const E=s.aa.fromPoints(w),R=E.width(),O=E.height(),$=Math.max(R,O),W=Math.max(0,Math.floor(-Math.log($)/Math.LN2)),K=Math.pow(2,W);return new s.ac(W,Math.floor((E.minX+E.maxX)/2*K),Math.floor((E.minY+E.maxY)/2*K))})(d),this.terrainTileRanges=this._getOverlappingTileRanges(d),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=d.map((w=>this.tileID.getTilePoint(w)._round())),this.flippedWindingOrder=((v=this.tileCoords)[1].x-v[0].x)*(v[2].y-v[0].y)-(v[1].y-v[0].y)*(v[2].x-v[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,d=l.gl;this.texture||(this.texture=new s.T(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let v=!1;for(const w in this.tiles){const E=this.tiles[w];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,v=!0)}v&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return s._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(l){const{minX:d,minY:v,maxX:w,maxY:E}=s.aa.fromPoints(l),R={};for(let O=0;O<=s.ab;O++){const $=Math.pow(2,O),W=Math.floor(d*$),K=Math.floor(v*$),ce=Math.floor(w*$),oe=Math.floor(E*$);R[O]={minTileX:W,minTileY:K,maxTileX:ce,maxTileY:oe}}return R}}class we extends ct{constructor(l,d,v,w){super(l,d,v,w),this.roundZoom=!0,this.type="video",this.options=d}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const d of l.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield s.ad(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new s.k(d))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const d=this.video.seekable;l<d.start(0)||l>d.end(0)?this.fire(new s.k(new s.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,d=l.gl;this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(l,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let v=!1;for(const w in this.tiles){const E=this.tiles[w];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,v=!0)}v&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Q extends ct{constructor(l,d,v,w){super(l,d,v,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some((E=>!Array.isArray(E)||E.length!==2||E.some((R=>typeof R!="number"))))||this.fire(new s.k(new s.ae(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.ae(`sources.${l}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new s.k(new s.ae(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.ae(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.ae(`sources.${l}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,v=d.gl;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new s.T(d,this.canvas,v.RGBA,{premultiply:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let w=!1;for(const E in this.tiles){const R=this.tiles[E];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,w=!0)}w&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const ue={},de=C=>{switch(C){case"geojson":return Ue;case"image":return ct;case"raster":return ve;case"raster-dem":return te;case"vector":return ft;case"video":return we;case"canvas":return Q}return ue[C]},Pe="RTLPluginLoaded";class Re extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=$t()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch((d=>{throw this.status="error",d}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return s._(this,arguments,void 0,(function*(d,v=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=b.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!v)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return s._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(Pe))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let rt=null;function ot(){return rt||(rt=new Re),rt}var Xe,mt;(function(C){C[C.Base=0]="Base",C[C.Parent=1]="Parent"})(Xe||(Xe={})),(function(C){C[C.Departing=0]="Departing",C[C.Incoming=1]="Incoming"})(mt||(mt={}));class Et{constructor(l,d){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=l,this.uid=s.af(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(l){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(l||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:l,fadingDirection:d,fadingParentID:v,fadeEndTime:w}){this.resetFadeLogic(),this.fadingRole=l,this.fadingDirection=d,this.fadingParentID=v,this.fadeEndTime=w}setSelfFadeLogic(l){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=l}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=P(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,d,v){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData,this.latestFeatureIndex.encoding=l.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=(function(w,E){const R={};if(!E)return R;for(const O of w){const $=O.layerIds.map((W=>E.getLayer(W))).filter(Boolean);if($.length!==0){O.layers=$,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map((W=>$.filter((K=>K.id===W))[0])));for(const W of $)R[W.id]=O}}return R})(l.buckets,d?.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const E=this.buckets[w];if(E instanceof s.ah){if(this.hasSymbolBuckets=!0,!v)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const E=this.buckets[w];if(E instanceof s.ah&&E.hasRTLText){this.hasRTLText=!0,ot().lazyLoad();break}}this.queryPadding=0;for(const w in this.buckets){const E=this.buckets[w];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(w).queryRadius(E))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),this.dashPositions=l.dashPositions}else this.collisionBoxArray=new s.ag}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const v in this.buckets){const w=this.buckets[v];w.uploadPending()&&w.upload(l)}const d=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(l,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(l,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,d,v,w,E,R,O,$,W,K,ce){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:w,cameraQueryGeometry:E,scale:R,tileSize:this.tileSize,pixelPosMatrix:K,transform:$,params:O,queryPadding:this.queryPadding*W,getElevation:ce},l,d,v):{}}querySourceFeatures(l,d){const v=this.latestFeatureIndex;if(!v||!v.rawTileData)return;const w=v.loadVTLayers(),E=d&&d.sourceLayer?d.sourceLayer:"",R=w[s.ai]||w[E];if(!R)return;const O=s.aj(d?.filter,d?.globalState),{z:$,x:W,y:K}=this.tileID.canonical,ce={z:$,x:W,y:K};for(let oe=0;oe<R.length;oe++){const ge=R.feature(oe);if(O.needGeometry){const De=s.ak(ge,!0);if(!O.filter(new s.H(this.tileID.overscaledZ),De,this.tileID.canonical))continue}else if(!O.filter(new s.H(this.tileID.overscaledZ),ge))continue;const be=v.getId(ge,E),Le=new s.al(ge,$,W,K,be);Le.tile=ce,l.push(Le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const d=this.expirationTime;if(l.cacheControl){const v=s.am(l.cacheControl);v["max-age"]&&(this.expirationTime=Date.now()+1e3*v["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const v=Date.now();let w=!1;if(this.expirationTime>v)w=!1;else if(d)if(this.expirationTime<d)w=!0;else{const E=this.expirationTime-d;E?this.expirationTime=v+Math.max(E,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const v=this.latestFeatureIndex.loadVTLayers();for(const w in this.buckets){if(!d.style.hasLayer(w))continue;const E=this.buckets[w],R=E.layers[0].sourceLayer||s.ai,O=v[R],$=l[R];if(!O||!$||Object.keys($).length===0)continue;E.update($,O,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const W=d&&d.style&&d.style.getLayer(w);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(E)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(l){this.symbolFadeHoldUntil=P()+l}setDependencies(l,d){const v={};for(const w of d)v[w]=!0;this.dependencies[l]=v}hasDependency(l,d){for(const v of l){const w=this.dependencies[v];if(w){for(const E of d)if(w[E])return!0}}return!1}}class kt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,d,v){const w=String(d);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][w]=this.stateChanges[l][w]||{},s.e(this.stateChanges[l][w],v),this.deletedStates[l]===null){this.deletedStates[l]={};for(const E in this.state[l])E!==w&&(this.deletedStates[l][E]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][w]===null){this.deletedStates[l][w]={};for(const E in this.state[l][w])v[E]||(this.deletedStates[l][w][E]=null)}else for(const E in v)this.deletedStates[l]&&this.deletedStates[l][w]&&this.deletedStates[l][w][E]===null&&delete this.deletedStates[l][w][E]}removeFeatureState(l,d,v){if(this.deletedStates[l]===null)return;const w=String(d);if(this.deletedStates[l]=this.deletedStates[l]||{},v&&d!==void 0)this.deletedStates[l][w]!==null&&(this.deletedStates[l][w]=this.deletedStates[l][w]||{},this.deletedStates[l][w][v]=null);else if(d!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][w])for(v in this.deletedStates[l][w]={},this.stateChanges[l][w])this.deletedStates[l][w][v]=null;else this.deletedStates[l][w]=null;else this.deletedStates[l]=null}getState(l,d){const v=String(d),w=s.e({},(this.state[l]||{})[v],(this.stateChanges[l]||{})[v]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const E=this.deletedStates[l][d];if(E===null)return{};for(const R in E)delete w[R]}return w}initializeTileState(l,d){l.setFeatureState(this.state,d)}coalesceChanges(l,d){const v={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const E={};for(const R in this.stateChanges[w])this.state[w][R]||(this.state[w][R]={}),s.e(this.state[w][R],this.stateChanges[w][R]),E[R]=this.state[w][R];v[w]=E}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const E={};if(this.deletedStates[w]===null)for(const R in this.state[w])E[R]={},this.state[w][R]={};else for(const R in this.deletedStates[w]){if(this.deletedStates[w][R]===null)this.state[w][R]={};else for(const O of Object.keys(this.deletedStates[w][R]))delete this.state[w][R][O];E[R]=this.state[w][R]}v[w]=v[w]||{},s.e(v[w],E)}this.stateChanges={},this.deletedStates={},Object.keys(v).length!==0&&l.setFeatureState(v,d)}}const Jt=89.25;function vi(C,l){const d=s.an(l.lat,-s.ao,s.ao);return new s.P(s.Y(l.lng)*C,s.X(d)*C)}function $i(C,l){return new s.a9(l.x/C,l.y/C).toLngLat()}function vn(C){return C.cameraToCenterDistance*Math.min(.85*Math.tan(s.ap(90-C.pitch)),Math.tan(s.ap(Jt-C.pitch)))}function rn(C,l){const d=C.canonical,v=l/s.aq(d.z),w=d.x+Math.pow(2,d.z)*C.wrap,E=s.ar(new Float64Array(16));return s.O(E,E,[w*v,d.y*v,0]),s.Q(E,E,[v/s.a5,v/s.a5,1]),E}function gt(C,l,d,v,w){const E=s.a9.fromLngLat(C,l),R=w*s.as(1,C.lat),{x:O,y:$,z:W}=gn(d,v);return new s.a9(E.x+R*-O,E.y+R*-$,E.z+R*-W)}function gn(C,l){const d=s.ap(C),v=s.ap(l),w=Math.cos(-d),E=Math.sin(d);return{x:E*Math.sin(v),y:-E*Math.cos(v),z:w}}function Er(C,l,d){const v=l.intersectsFrustum(C);if(!d||v===0)return v;const w=l.intersectsPlane(d);return w===0?0:v===2&&w===2?2:1}function Di(C,l,d){let v=0;const w=(d-l)/10;for(let E=0;E<10;E++)v+=w*Math.pow(Math.cos(l+(E+.5)/10*(d-l)),C);return v}function yn(C,l){return function(d,v,w,E,R){const O=2*((C-1)/s.at(Math.cos(s.ap(Jt-R))/Math.cos(s.ap(Jt)))-1),$=Math.acos(w/E),W=2*Di(O-1,0,s.ap(R/2)),K=Math.min(s.ap(Jt),$+s.ap(R/2)),ce=Di(O-1,Math.min(K,$-s.ap(R/2)),K),oe=Math.atan(v/w),ge=Math.hypot(v,w);let be=d;return be+=s.at(E/ge/Math.max(.5,Math.cos(s.ap(R/2)))),be+=O*s.at(Math.cos(oe))/2,be-=s.at(Math.max(1,ce/W/l))/2,be}}const Yn=yn(9.314,3);function Cn(C,l){const d=(l.roundZoom?Math.round:Math.floor)(C.zoom+s.at(C.tileSize/l.tileSize));return Math.max(0,d)}function Vn(C,l){const d=C.getCameraFrustum(),v=C.getClippingPlane(),w=C.screenPointToMercatorCoordinate(C.getCameraPoint()),E=s.a9.fromLngLat(C.center,C.elevation);w.z=E.z+Math.cos(C.pitchInRadians)*C.cameraToCenterDistance/C.worldSize;const R=C.getCoveringTilesDetailsProvider(),O=R.allowVariableZoom(C,l),$=Cn(C,l),W=l.minzoom||0,K=l.maxzoom!==void 0?l.maxzoom:C.maxZoom,ce=Math.min(Math.max(0,$),K),oe=Math.pow(2,ce),ge=[oe*w.x,oe*w.y,0],be=[oe*E.x,oe*E.y,0],Le=Math.hypot(E.x-w.x,E.y-w.y),De=Math.abs(E.z-w.z),ke=Math.hypot(Le,De),Ne=Ge=>({zoom:0,x:0,y:0,wrap:Ge,fullyVisible:!1}),He=[],ze=[];if(C.renderWorldCopies&&R.allowWorldCopies())for(let Ge=1;Ge<=3;Ge++)He.push(Ne(-Ge)),He.push(Ne(Ge));for(He.push(Ne(0));He.length>0;){const Ge=He.pop(),Je=Ge.x,je=Ge.y;let at=Ge.fullyVisible;const Tt={x:Je,y:je,z:Ge.zoom},vt=R.getTileBoundingVolume(Tt,Ge.wrap,C.elevation,l);if(!at){const ti=Er(d,vt,v);if(ti===0)continue;at=ti===2}const xt=R.distanceToTile2d(w.x,w.y,Tt,vt);let wt=$;O&&(wt=(l.calculateTileZoom||Yn)(C.zoom+s.at(C.tileSize/l.tileSize),xt,De,ke,C.fov)),wt=(l.roundZoom?Math.round:Math.floor)(wt),wt=Math.max(0,wt);const Qt=Math.min(wt,K);if(Ge.wrap=R.getWrap(E,Tt,Ge.wrap),Ge.zoom>=Qt){if(Ge.zoom<W)continue;const ti=ce-Ge.zoom,Wt=ge[0]-.5-(Je<<ti),si=ge[1]-.5-(je<<ti),Xi=l.reparseOverscaled?Math.max(Ge.zoom,wt):Ge.zoom;ze.push({tileID:new s.a2(Ge.zoom===K?Xi:Ge.zoom,Ge.wrap,Ge.zoom,Je,je),distanceSq:s.au([be[0]-.5-Je,be[1]-.5-je]),tileDistanceToCamera:Math.sqrt(Wt*Wt+si*si)})}else for(let ti=0;ti<4;ti++)He.push({zoom:Ge.zoom+1,x:(Je<<1)+ti%2,y:(je<<1)+(ti>>1),wrap:Ge.wrap,fullyVisible:at})}return ze.sort(((Ge,Je)=>Ge.distanceSq-Je.distanceSq)).map((Ge=>Ge.tileID))}const En=s.aa.fromPoints([new s.P(0,0),new s.P(s.a5,s.a5)]);function dr(C){return C==="raster"||C==="image"||C==="video"}function $e(C,l,d,v,w,E,R){if(!l.hasData())return!1;const{tileID:O,fadingRole:$,fadingDirection:W,fadingParentID:K}=l;if($===Xe.Base&&W===mt.Incoming&&K)return d[K.key]=K,!0;const ce=Math.max(O.overscaledZ-w,E);for(let oe=O.overscaledZ-1;oe>=ce;oe--){const ge=O.scaledTo(oe),be=C.getLoadedTile(ge);if(be)return l.setCrossFadeLogic({fadingRole:Xe.Base,fadingDirection:mt.Incoming,fadingParentID:be.tileID,fadeEndTime:v+R}),be.setCrossFadeLogic({fadingRole:Xe.Parent,fadingDirection:mt.Departing,fadeEndTime:v+R}),d[ge.key]=ge,!0}return!1}function Ct(C,l,d,v,w,E){if(!l.hasData())return!1;const R=l.tileID.children(w);let O=Qe(C,l,R,d,v,w,E);if(O)return!0;for(const $ of R)Qe(C,l,$.children(w),d,v,w,E)&&(O=!0);return O}function Qe(C,l,d,v,w,E,R){if(d[0].overscaledZ>=E)return!1;let O=!1;for(const $ of d){const W=C.getLoadedTile($);if(!W)continue;const{fadingRole:K,fadingDirection:ce,fadingParentID:oe}=W;K===Xe.Base&&ce===mt.Departing&&oe||(W.setCrossFadeLogic({fadingRole:Xe.Base,fadingDirection:mt.Departing,fadingParentID:l.tileID,fadeEndTime:w+R}),l.setCrossFadeLogic({fadingRole:Xe.Parent,fadingDirection:mt.Incoming,fadeEndTime:w+R})),v[$.key]=$,O=!0}return O}function It(C,l,d,v){const w=C.tileID;return!!C.selfFading||!C.hasData()&&!!l.has(w)&&(C.setSelfFadeLogic(d+v),!0)}function Gt(C,l){var d;C.needsHillshadePrepare=!0,C.needsTerrainPrepare=!0;let v=l.tileID.canonical.x-C.tileID.canonical.x;const w=l.tileID.canonical.y-C.tileID.canonical.y,E=Math.pow(2,C.tileID.canonical.z),R=l.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+E)===1?v+=E:Math.abs(v-E)===1&&(v-=E)),l.dem&&C.dem&&(C.dem.backfillBorder(l.dem,v,w),!((d=C.neighboringTiles)===null||d===void 0)&&d[R]&&(C.neighboringTiles[R].backfilled=!0)))}class qi{constructor(){this._tiles={}}handleWrapJump(l){const d={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+l),d[w.tileID.key]=w}this._tiles=d}setFeatureState(l,d){for(const v in this._tiles)this._tiles[v].setFeatureState(l,d)}getAllTiles(){return Object.values(this._tiles)}getAllIds(l=!1){return l?Object.values(this._tiles).map((d=>d.tileID)).sort(s.aw).map((d=>d.key)):Object.keys(this._tiles)}getTileById(l){return this._tiles[l]}setTile(l,d){this._tiles[l]=d}deleteTileById(l){delete this._tiles[l]}getLoadedTile(l){const d=this.getTileById(l.key);return d?.hasData()?d:null}isIdRenderable(l,d=!1){var v;return(v=this.getTileById(l))===null||v===void 0?void 0:v.isRenderable(d)}getRenderableIds(l=0,d){const v=[];for(const w of this.getAllIds())this.isIdRenderable(w,d)&&v.push(this.getTileById(w));return d?v.sort(((w,E)=>{const R=w.tileID,O=E.tileID,$=new s.P(R.canonical.x,R.canonical.y)._rotate(-l),W=new s.P(O.canonical.x,O.canonical.y)._rotate(-l);return R.overscaledZ-O.overscaledZ||W.y-$.y||W.x-$.x})).map((w=>w.tileID.key)):v.map((w=>w.tileID)).sort(s.aw).map((w=>w.key))}}class Ii extends s.E{constructor(l,d,v){super(),this.id=l,this.dispatcher=v,this.on("data",(w=>this._dataHandler(w))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((w,E,R,O)=>{const $=new(de(E.type))(w,E,R,O);if($.id!==w)throw new Error(`Expected Source id to be ${w} instead of ${$.id}`);return $})(l,d,v,this),this._inViewTiles=new qi,this._outOfViewCache=new s.ax(0,(w=>this._unloadTile(w))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new kt,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){for(const d of this._inViewTiles.getAllTiles())d.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l),this._inViewTiles=new qi}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l of this._inViewTiles.getAllTiles())if(l.state!=="loaded"&&l.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,d,v){return s._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,d,v)}catch(w){l.state="errored",w.status!==404?this._source.fire(new s.k(w,{tile:l})):this.update(this.transform,this.terrain)}}))}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new s.l("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const d of this._inViewTiles.getAllTiles())d.upload(l),d.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(l){var d;return this._inViewTiles.getRenderableIds((d=this.transform)===null||d===void 0?void 0:d.bearingInRadians,l)}hasRenderableParent(l){const d=l.overscaledZ-1;if(d>=this._source.minzoom){const v=this.getLoadedTile(l.scaledTo(d));if(v)return this._inViewTiles.isIdRenderable(v.tileID.key)}return!1}reload(l,d=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const v of this._inViewTiles.getAllIds()){const w=this._inViewTiles.getTileById(v);d&&!this._source.shouldReloadTile(w,d)||(l?this._reloadTile(v,"expired"):w.state!=="errored"&&this._reloadTile(v,"reloading"))}}}_reloadTile(l,d){return s._(this,void 0,void 0,(function*(){const v=this._inViewTiles.getTileById(l);v&&(v.state!=="loading"&&(v.state=d),yield this._loadTile(v,l,d))}))}_tileLoaded(l,d,v){l.timeAdded=P(),l.selfFading&&(l.fadeEndTime=l.timeAdded+this._rasterFadeDuration),v==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(d,l),this.getSource().type==="raster-dem"&&l.dem&&(function(w,E){var R,O;const $=E.getRenderableIds();for(const W of $){if(!w.neighboringTiles||!w.neighboringTiles[W])continue;const K=E.getTileById(W);w.neighboringTiles[W].backfilled||Gt(w,K),!((O=(R=K.neighboringTiles)===null||R===void 0?void 0:R[w.tileID.key])===null||O===void 0)&&O.backfilled||Gt(K,w)}})(l,this._inViewTiles),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:l,coord:l.tileID}))}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._inViewTiles.getTileById(l)}_retainLoadedChildren(l,d){const v=this._getLoadedDescendents(d),w=new Set;for(const E of d){const R=v[E.key];if(!R?.length){w.add(E);continue}const O=E.overscaledZ+Ii.maxOverzooming,$=R.filter((ce=>ce.tileID.overscaledZ<=O));if(!$.length){w.add(E);continue}const W=Math.min(...$.map((ce=>ce.tileID.overscaledZ))),K=$.filter((ce=>ce.tileID.overscaledZ===W)).map((ce=>ce.tileID));for(const ce of K)l[ce.key]=ce;this._areDescendentsComplete(K,W,E.overscaledZ)||w.add(E)}return w}_getLoadedDescendents(l){var d;const v={};for(const w of this._inViewTiles.getAllTiles().filter((E=>E.hasData())))for(const E of l)w.tileID.isChildOf(E)&&(v[d=E.key]||(v[d]=[])).push(w);return v}_areDescendentsComplete(l,d,v){return l.length===1&&l[0].isOverscaled()?l[0].overscaledZ===d:Math.pow(4,d-v)===l.length}getLoadedTile(l){return this._inViewTiles.getLoadedTile(l)}updateCacheSize(l){const d=Math.ceil(l.width/this._source.tileSize)+1,v=Math.ceil(l.height/this._source.tileSize)+1,w=Math.floor(d*v*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._outOfViewCache.setMaxSize(E)}handleWrapJump(l){const d=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);this._prevLng=l,d&&(this._inViewTiles.handleWrapJump(d),this._resetTileReloadTimers())}update(l,d){if(!this._sourceLoaded||this._paused)return;let v;this.transform=l,this.terrain=d,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?v=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(($=>new s.a2($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y))):(v=Vn(l,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?l.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(v=v.filter(($=>this._source.hasTile($))))):v=[],this.usedForTerrain&&(v=this._addTerrainIdealTiles(v));const w=v.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=Cn(l,this._source),R=this._updateRetainedTiles(v,E),O=dr(this._source.type);O&&this._rasterFadeDuration>0&&!d&&(function($,W,K,ce,oe,ge,be){const Le=P(),De=s.av(W);for(const ke of W){const Ne=$.getTileById(ke.key);Ne.fadingDirection!==mt.Departing&&Ne.fadeOpacity!==0||Ne.resetFadeLogic(),$e($,Ne,K,Le,ce,oe,be)||Ct($,Ne,K,Le,ge,be)||It(Ne,De,Le,be)||Ne.resetFadeLogic()}})(this._inViewTiles,v,R,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),O?this._cleanUpRasterTiles(R):this._cleanUpVectorTiles(R)}_cleanUpRasterTiles(l){for(const d of this._inViewTiles.getAllIds())l[d]||this._removeTile(d)}_cleanUpVectorTiles(l){for(const d of this._inViewTiles.getAllIds()){const v=this._inViewTiles.getTileById(d);l[d]?v.clearSymbolFadeHold():v.hasSymbolBuckets?v.holdingForSymbolFade()?v.symbolFadeFinished()&&this._removeTile(d):v.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(d)}}_addTerrainIdealTiles(l){const d=[];for(const v of l)if(v.canonical.z>this._source.minzoom){const w=v.scaledTo(v.canonical.z-1);d.push(w);const E=v.scaledTo(Math.max(this._source.minzoom,Math.min(v.canonical.z,5)));d.push(E)}return l.concat(d)}releaseSymbolFadeTiles(){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).holdingForSymbolFade()&&this._removeTile(l)}_updateRetainedTiles(l,d){var v;const w=new Set;for(const W of l)this._addTile(W).hasData()||w.add(W);const E=l.reduce(((W,K)=>(W[K.key]=K,W)),{}),R=this._retainLoadedChildren(E,w),O={},$=Math.max(d-Ii.maxUnderzooming,this._source.minzoom);for(const W of R){let K=this._inViewTiles.getTileById(W.key),ce=K?.wasRequested();for(let oe=W.overscaledZ-1;oe>=$;--oe){const ge=W.scaledTo(oe);if(O[ge.key])break;if(O[ge.key]=!0,K=this.getTile(ge),!K&&ce&&(K=this._addTile(ge)),K){const be=K.hasData();if((be||!(!((v=this.map)===null||v===void 0)&&v.cancelPendingTileRequestsWhileZooming)||ce)&&(E[ge.key]=ge),ce=K.wasRequested(),be)break}}}return E}_addTile(l){let d=this._inViewTiles.getTileById(l.key);if(d)return d;d=this._outOfViewCache.getAndRemove(l),d&&(d.resetFadeLogic(),this._setTileReloadTimer(l.key,d),d.tileID=l,this._state.initializeTileState(d,this.map?this.map.painter:null));const v=d;return d||(d=new Et(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(d,l.key,d.state)),d.uses++,this._inViewTiles.setTile(l.key,d),v||this._source.fire(new s.l("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(l,d){this._clearTileReloadTimer(l);const v=d.getExpiryTimeout();v&&(this._timers[l]=setTimeout((()=>{this._reloadTile(l,"expired"),delete this._timers[l]}),v))}_clearTileReloadTimer(l){const d=this._timers[l];d&&(clearTimeout(d),delete this._timers[l])}_resetTileReloadTimers(){for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(l);this._setTileReloadTimer(l,d)}}refreshTiles(l){for(const d of this._inViewTiles.getAllIds()){const v=this._inViewTiles.getTileById(d);(this._inViewTiles.isIdRenderable(d)||v.state=="errored")&&l.some((w=>w.equals(v.tileID.canonical)))&&this._reloadTile(d,"expired")}}_removeTile(l){const d=this._inViewTiles.getTileById(l);d&&(d.uses--,this._inViewTiles.deleteTileById(l),this._clearTileReloadTimer(l),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._outOfViewCache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(l){l.dataType==="source"&&(l.sourceDataType!=="metadata"?l.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(l.sourceDataChanged,l.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l of this._inViewTiles.getAllIds())this._removeTile(l);this._outOfViewCache.reset()}tilesIn(l,d,v){const w=[],E=this.transform;if(!E)return w;const R=E.getCoveringTilesDetailsProvider().allowWorldCopies(),O=v?E.getCameraQueryGeometry(l):l,$=ge=>E.screenPointToMercatorCoordinate(ge,this.terrain),W=this.transformBbox(l,$,!R),K=this.transformBbox(O,$,!R),ce=this.getIds(),oe=s.aa.fromPoints(K);for(let ge=0;ge<ce.length;ge++){const be=this._inViewTiles.getTileById(ce[ge]);if(be.holdingForSymbolFade())continue;const Le=R?[be.tileID]:[be.tileID.unwrapTo(-1),be.tileID.unwrapTo(0)],De=Math.pow(2,E.zoom-be.tileID.overscaledZ),ke=d*be.queryPadding*s.a5/be.tileSize/De;for(const Ne of Le){const He=oe.map((ze=>Ne.getTilePoint(new s.a9(ze.x,ze.y))));if(He.expandBy(ke),He.intersects(En)){const ze=W.map((Je=>Ne.getTilePoint(Je))),Ge=K.map((Je=>Ne.getTilePoint(Je)));w.push({tile:be,tileID:R?Ne:Ne.unwrapTo(0),queryGeometry:ze,cameraQueryGeometry:Ge,scale:De})}}}return w}transformBbox(l,d,v){let w=l.map(d);if(v){const E=s.aa.fromPoints(l);E.shrinkBy(.001*Math.min(E.width(),E.height()));const R=E.map(d);s.aa.fromPoints(w).covers(R)||(w=w.map((O=>O.x>.5?new s.a9(O.x-1,O.y,O.z):O)))}return w}getVisibleCoordinates(l){const d=this.getRenderableIds(l).map((v=>this._inViewTiles.getTileById(v).tileID));return this.transform&&this.transform.populateCache(d),d}hasTransition(){return!!this._source.hasTransition()||!(!dr(this._source.type)||!(function(l,d){if(d<=0)return!1;const v=P();for(const w of l.getAllTiles())if(w.fadeEndTime>=v)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(l){this._rasterFadeDuration=l}setFeatureState(l,d,v){this._state.updateState(l=l||s.ai,d,v)}removeFeatureState(l,d,v){this._state.removeFeatureState(l=l||s.ai,d,v)}getFeatureState(l,d){return this._state.getState(l=l||s.ai,d)}setDependencies(l,d,v){const w=this._inViewTiles.getTileById(l);w&&w.setDependencies(d,v)}reloadTilesForDependencies(l,d){for(const v of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(v).hasDependency(l,d)&&this._reloadTile(v,"reloading");this._outOfViewCache.filter((v=>!v.hasDependency(l,d)))}areTilesLoaded(){for(const l of this._inViewTiles.getAllTiles())if(l.state!=="loaded"&&l.state!=="errored")return!1;return!0}}Ii.maxUnderzooming=10,Ii.maxOverzooming=3;class Dt{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.an(l,0,1);let d=1,v=this._distances[d];const w=l*this.paddedLength+this.padding;for(;v<w&&d<this._distances.length;)v=this._distances[++d];const E=d-1,R=this._distances[E],O=v-R,$=O>0?(w-R)/O:0;return this.points[E].mult(1-$).add(this.points[d].mult($))}}function ai(C,l){let d=!0;return C==="always"||C!=="never"&&l!=="never"||(d=!1),d}class pi{constructor(l,d,v){const w=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/v),this.yCellCount=Math.ceil(d/v);for(let R=0;R<this.xCellCount*this.yCellCount;R++)w.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,v,w,E){this._forEachCell(d,v,w,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(E)}insertCircle(l,d,v,w){this._forEachCell(d-w,v-w,d+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(v),this.circles.push(w)}_insertBoxCell(l,d,v,w,E,R){this.boxCells[E].push(R)}_insertCircleCell(l,d,v,w,E,R){this.circleCells[E].push(R)}_query(l,d,v,w,E,R,O){if(v<0||l>this.width||w<0||d>this.height)return[];const $=[];if(l<=0&&d<=0&&this.width<=v&&this.height<=w){if(E)return[{key:null,x1:l,y1:d,x2:v,y2:w}];for(let W=0;W<this.boxKeys.length;W++)$.push({key:this.boxKeys[W],x1:this.bboxes[4*W],y1:this.bboxes[4*W+1],x2:this.bboxes[4*W+2],y2:this.bboxes[4*W+3]});for(let W=0;W<this.circleKeys.length;W++){const K=this.circles[3*W],ce=this.circles[3*W+1],oe=this.circles[3*W+2];$.push({key:this.circleKeys[W],x1:K-oe,y1:ce-oe,x2:K+oe,y2:ce+oe})}}else this._forEachCell(l,d,v,w,this._queryCell,$,{hitTest:E,overlapMode:R,seenUids:{box:{},circle:{}}},O);return $}query(l,d,v,w){return this._query(l,d,v,w,!1,null)}hitTest(l,d,v,w,E,R){return this._query(l,d,v,w,!0,E,R).length>0}hitTestCircle(l,d,v,w,E){const R=l-v,O=l+v,$=d-v,W=d+v;if(O<0||R>this.width||W<0||$>this.height)return!1;const K=[];return this._forEachCell(R,$,O,W,this._queryCellCircle,K,{hitTest:!0,overlapMode:w,circle:{x:l,y:d,radius:v},seenUids:{box:{},circle:{}}},E),K.length>0}_queryCell(l,d,v,w,E,R,O,$){const{seenUids:W,hitTest:K,overlapMode:ce}=O,oe=this.boxCells[E];if(oe!==null){const be=this.bboxes;for(const Le of oe)if(!W.box[Le]){W.box[Le]=!0;const De=4*Le,ke=this.boxKeys[Le];if(l<=be[De+2]&&d<=be[De+3]&&v>=be[De+0]&&w>=be[De+1]&&(!$||$(ke))&&(!K||!ai(ce,ke.overlapMode))&&(R.push({key:ke,x1:be[De],y1:be[De+1],x2:be[De+2],y2:be[De+3]}),K))return!0}}const ge=this.circleCells[E];if(ge!==null){const be=this.circles;for(const Le of ge)if(!W.circle[Le]){W.circle[Le]=!0;const De=3*Le,ke=this.circleKeys[Le];if(this._circleAndRectCollide(be[De],be[De+1],be[De+2],l,d,v,w)&&(!$||$(ke))&&(!K||!ai(ce,ke.overlapMode))){const Ne=be[De],He=be[De+1],ze=be[De+2];if(R.push({key:ke,x1:Ne-ze,y1:He-ze,x2:Ne+ze,y2:He+ze}),K)return!0}}}return!1}_queryCellCircle(l,d,v,w,E,R,O,$){const{circle:W,seenUids:K,overlapMode:ce}=O,oe=this.boxCells[E];if(oe!==null){const be=this.bboxes;for(const Le of oe)if(!K.box[Le]){K.box[Le]=!0;const De=4*Le,ke=this.boxKeys[Le];if(this._circleAndRectCollide(W.x,W.y,W.radius,be[De+0],be[De+1],be[De+2],be[De+3])&&(!$||$(ke))&&!ai(ce,ke.overlapMode))return R.push(!0),!0}}const ge=this.circleCells[E];if(ge!==null){const be=this.circles;for(const Le of ge)if(!K.circle[Le]){K.circle[Le]=!0;const De=3*Le,ke=this.circleKeys[Le];if(this._circlesCollide(be[De],be[De+1],be[De+2],W.x,W.y,W.radius)&&(!$||$(ke))&&!ai(ce,ke.overlapMode))return R.push(!0),!0}}}_forEachCell(l,d,v,w,E,R,O,$){const W=this._convertToXCellCoord(l),K=this._convertToYCellCoord(d),ce=this._convertToXCellCoord(v),oe=this._convertToYCellCoord(w);for(let ge=W;ge<=ce;ge++)for(let be=K;be<=oe;be++)if(E.call(this,l,d,v,w,this.xCellCount*be+ge,R,O,$))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,v,w,E,R){const O=w-l,$=E-d,W=v+R;return W*W>O*O+$*$}_circleAndRectCollide(l,d,v,w,E,R,O){const $=(R-w)/2,W=Math.abs(l-(w+$));if(W>$+v)return!1;const K=(O-E)/2,ce=Math.abs(d-(E+K));if(ce>K+v)return!1;if(W<=$||ce<=K)return!0;const oe=W-$,ge=ce-K;return oe*oe+ge*ge<=v*v}}function Hi(C,l,d){const v=s.N();if(!C){const{vecSouth:ce,vecEast:oe}=Li(l),ge=p();ge[0]=oe[0],ge[1]=oe[1],ge[2]=ce[0],ge[3]=ce[1],w=ge,(K=(R=(E=ge)[0])*(W=E[3])-($=E[2])*(O=E[1]))&&(w[0]=W*(K=1/K),w[1]=-O*K,w[2]=-$*K,w[3]=R*K),v[0]=ge[0],v[1]=ge[1],v[4]=ge[2],v[5]=ge[3]}var w,E,R,O,$,W,K;return s.Q(v,v,[1/d,1/d,1]),v}function ut(C,l,d,v){if(C){const w=s.N();if(!l){const{vecSouth:E,vecEast:R}=Li(d);w[0]=R[0],w[1]=R[1],w[4]=E[0],w[5]=E[1]}return s.Q(w,w,[v,v,1]),w}return d.pixelsToClipSpaceMatrix}function Li(C){const l=Math.cos(C.rollInRadians),d=Math.sin(C.rollInRadians),v=Math.cos(C.pitchInRadians),w=Math.cos(C.bearingInRadians),E=Math.sin(C.bearingInRadians),R=s.aC();R[0]=-w*v*d-E*l,R[1]=-E*v*d+w*l;const O=s.aD(R);O<1e-9?s.aE(R):s.aF(R,R,1/O);const $=s.aC();$[0]=w*v*l-E*d,$[1]=E*v*l+w*d;const W=s.aD($);return W<1e-9?s.aE($):s.aF($,$,1/W),{vecEast:$,vecSouth:R}}function bi(C,l,d,v){let w;v?(w=[C,l,v(C,l),1],s.aH(w,w,d)):(w=[C,l,0,1],Gl(w,w,d));const E=w[3];return{point:new s.P(w[0]/E,w[1]/E),signedDistanceFromCamera:E,isOccluded:!1}}function Ni(C,l){return .5+C/l*.5}function Kn(C,l){return C.x>=-l[0]&&C.x<=l[0]&&C.y>=-l[1]&&C.y<=l[1]}function Zi(C,l,d,v,w,E,R,O,$,W,K,ce,oe){const ge=d?C.textSizeData:C.iconSizeData,be=s.ay(ge,l.transform.zoom),Le=[256/l.width*2+1,256/l.height*2+1],De=d?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;De.clear();const ke=C.lineVertexArray,Ne=d?C.text.placedSymbolArray:C.icon.placedSymbolArray,He=l.transform.width/l.transform.height;let ze=!1;for(let Ge=0;Ge<Ne.length;Ge++){const Je=Ne.get(Ge);if(Je.hidden||Je.writingMode===s.az.vertical&&!ze){jl(Je.numGlyphs,De);continue}ze=!1;const je=new s.P(Je.anchorX,Je.anchorY),at={getElevation:oe,pitchedLabelPlaneMatrix:v,lineVertexArray:ke,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:l.transform,tileAnchorPoint:je,unwrappedTileID:$,width:W,height:K,translation:ce},Tt=ro(Je.anchorX,Je.anchorY,at);if(!Kn(Tt.point,Le)){jl(Je.numGlyphs,De);continue}const vt=Ni(l.transform.cameraToCenterDistance,Tt.signedDistanceFromCamera),xt=s.aA(ge,be,Je),wt=E?xt*l.transform.getPitchedTextCorrection(Je.anchorX,Je.anchorY,$)/vt:xt*vt,Qt=zr({projectionContext:at,pitchedLabelPlaneMatrixInverse:w,symbol:Je,fontSize:wt,flip:!1,keepUpright:R,glyphOffsetArray:C.glyphOffsetArray,dynamicLayoutVertexArray:De,aspectRatio:He,rotateToLine:O});ze=Qt.useVertical,(Qt.notEnoughRoom||ze||Qt.needsFlipping&&zr({projectionContext:at,pitchedLabelPlaneMatrixInverse:w,symbol:Je,fontSize:wt,flip:!0,keepUpright:R,glyphOffsetArray:C.glyphOffsetArray,dynamicLayoutVertexArray:De,aspectRatio:He,rotateToLine:O}).notEnoughRoom)&&jl(Je.numGlyphs,De)}d?C.text.dynamicLayoutVertexBuffer.updateData(De):C.icon.dynamicLayoutVertexBuffer.updateData(De)}function Un(C,l,d,v,w,E,R,O){const $=E.glyphStartIndex+E.numGlyphs,W=E.lineStartIndex,K=E.lineStartIndex+E.lineLength,ce=l.getoffsetX(E.glyphStartIndex),oe=l.getoffsetX($-1),ge=Ar(C*ce,d,v,w,E.segment,W,K,O,R);if(!ge)return null;const be=Ar(C*oe,d,v,w,E.segment,W,K,O,R);return be?O.projectionCache.anyProjectionOccluded?null:{first:ge,last:be}:null}function sn(C,l,d,v){return C===s.az.horizontal&&Math.abs(d.y-l.y)>Math.abs(d.x-l.x)*v?{useVertical:!0}:(C===s.az.vertical?l.y<d.y:l.x>d.x)?{needsFlipping:!0}:null}function zr(C){const{projectionContext:l,pitchedLabelPlaneMatrixInverse:d,symbol:v,fontSize:w,flip:E,keepUpright:R,glyphOffsetArray:O,dynamicLayoutVertexArray:$,aspectRatio:W,rotateToLine:K}=C,ce=w/24,oe=v.lineOffsetX*ce,ge=v.lineOffsetY*ce;let be;if(v.numGlyphs>1){const Le=v.glyphStartIndex+v.numGlyphs,De=v.lineStartIndex,ke=v.lineStartIndex+v.lineLength,Ne=Un(ce,O,oe,ge,E,v,K,l);if(!Ne)return{notEnoughRoom:!0};const He=ts(Ne.first.point.x,Ne.first.point.y,l,d),ze=ts(Ne.last.point.x,Ne.last.point.y,l,d);if(R&&!E){const Ge=sn(v.writingMode,He,ze,W);if(Ge)return Ge}be=[Ne.first];for(let Ge=v.glyphStartIndex+1;Ge<Le-1;Ge++){const Je=Ar(ce*O.getoffsetX(Ge),oe,ge,E,v.segment,De,ke,l,K);if(!Je)return{notEnoughRoom:!0};be.push(Je)}be.push(Ne.last)}else{if(R&&!E){const De=Qi(l.tileAnchorPoint.x,l.tileAnchorPoint.y,l).point,ke=v.lineStartIndex+v.segment+1,Ne=new s.P(l.lineVertexArray.getx(ke),l.lineVertexArray.gety(ke)),He=Qi(Ne.x,Ne.y,l),ze=He.signedDistanceFromCamera>0?He.point:jn(l.tileAnchorPoint,Ne,De,1,l),Ge=ts(De.x,De.y,l,d),Je=ts(ze.x,ze.y,l,d),je=sn(v.writingMode,Ge,Je,W);if(je)return je}const Le=Ar(ce*O.getoffsetX(v.glyphStartIndex),oe,ge,E,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,l,K);if(!Le||l.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};be=[Le]}for(const Le of be)s.aG($,Le.point,Le.angle);return{}}function jn(C,l,d,v,w){const E=C.add(C.sub(l)._unit()),R=Qi(E.x,E.y,w).point,O=d.sub(R);return d.add(O._mult(v/O.mag()))}function an(C,l,d){const v=l.projectionCache;if(v.projections[C])return v.projections[C];const w=new s.P(l.lineVertexArray.getx(C),l.lineVertexArray.gety(C)),E=Qi(w.x,w.y,l);if(E.signedDistanceFromCamera>0)return v.projections[C]=E.point,v.anyProjectionOccluded=v.anyProjectionOccluded||E.isOccluded,E.point;const R=C-d.direction;return jn(d.distanceFromAnchor===0?l.tileAnchorPoint:new s.P(l.lineVertexArray.getx(R),l.lineVertexArray.gety(R)),w,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,l)}function Qi(C,l,d){const v=C+d.translation[0],w=l+d.translation[1];let E;return d.pitchWithMap?(E=bi(v,w,d.pitchedLabelPlaneMatrix,d.getElevation),E.isOccluded=!1):(E=d.transform.projectTileCoordinates(v,w,d.unwrappedTileID,d.getElevation),E.point.x=(.5*E.point.x+.5)*d.width,E.point.y=(.5*-E.point.y+.5)*d.height),E}function ts(C,l,d,v){if(d.pitchWithMap){const w=[C,l,0,1];return s.aH(w,w,v),d.transform.projectTileCoordinates(w[0]/w[3],w[1]/w[3],d.unwrappedTileID,d.getElevation).point}return{x:C/d.width*2-1,y:1-l/d.height*2}}function ro(C,l,d){return d.transform.projectTileCoordinates(C,l,d.unwrappedTileID,d.getElevation)}function hl(C,l,d){return C._unit()._perp()._mult(l*d)}function xo(C,l,d,v,w,E,R,O,$){if(O.projectionCache.offsets[C])return O.projectionCache.offsets[C];const W=d.add(l);if(C+$.direction<v||C+$.direction>=w)return O.projectionCache.offsets[C]=W,W;const K=an(C+$.direction,O,$),ce=hl(K.sub(d),R,$.direction),oe=d.add(ce),ge=K.add(ce);return O.projectionCache.offsets[C]=s.aI(E,W,oe,ge)||W,O.projectionCache.offsets[C]}function Ar(C,l,d,v,w,E,R,O,$){const W=v?C-l:C+l;let K=W>0?1:-1,ce=0;v&&(K*=-1,ce=Math.PI),K<0&&(ce+=Math.PI);let oe,ge=K>0?E+w:E+w+1;O.projectionCache.cachedAnchorPoint?oe=O.projectionCache.cachedAnchorPoint:(oe=Qi(O.tileAnchorPoint.x,O.tileAnchorPoint.y,O).point,O.projectionCache.cachedAnchorPoint=oe);let be,Le,De=oe,ke=oe,Ne=0,He=0;const ze=Math.abs(W),Ge=[];let Je;for(;Ne+He<=ze;){if(ge+=K,ge<E||ge>=R)return null;Ne+=He,ke=De,Le=be;const Tt={absOffsetX:ze,direction:K,distanceFromAnchor:Ne,previousVertex:ke};if(De=an(ge,O,Tt),d===0)Ge.push(ke),Je=De.sub(ke);else{let vt;const xt=De.sub(ke);vt=xt.mag()===0?hl(an(ge+K,O,Tt).sub(De),d,K):hl(xt,d,K),Le||(Le=ke.add(vt)),be=xo(ge,vt,De,E,R,Le,d,O,Tt),Ge.push(Le),Je=be.sub(Le)}He=Je.mag()}const je=Je._mult((ze-Ne)/He)._add(Le||ke),at=ce+Math.atan2(De.y-ke.y,De.x-ke.x);return Ge.push(je),{point:je,angle:$?at:0,path:Ge}}const nr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function jl(C,l){for(let d=0;d<C;d++){const v=l.length;l.resize(v+4),l.float32.set(nr,3*v)}}function Gl(C,l,d){const v=l[0],w=l[1];return C[0]=d[0]*v+d[4]*w+d[12],C[1]=d[1]*v+d[5]*w+d[13],C[3]=d[3]*v+d[7]*w+d[15],C}const _r=100;class Mp{constructor(l,d=new pi(l.width+200,l.height+200,25),v=new pi(l.width+200,l.height+200,25)){this.transform=l,this.grid=d,this.ignoredGrid=v,this.pitchFactor=Math.cos(l.pitch*Math.PI/180)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+_r,this.screenBottomBoundary=l.height+_r,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,d,v,w,E,R,O,$,W,K,ce,oe){const ge=this.projectAndGetPerspectiveRatio(l.anchorPointX+$[0],l.anchorPointY+$[1],E,K,oe),be=v*ge.perspectiveRatio;let Le;if(R||O)Le=this._projectCollisionBox(l,be,w,E,R,O,$,ge,K,ce,oe);else{const Je=ge.x+(ce?ce.x*be:0),je=ge.y+(ce?ce.y*be:0);Le={allPointsOccluded:!1,box:[Je+l.x1*be,je+l.y1*be,Je+l.x2*be,je+l.y2*be]}}const[De,ke,Ne,He]=Le.box,ze=R?Le.allPointsOccluded:ge.isOccluded;let Ge=ze;return Ge||(Ge=ge.perspectiveRatio<this.perspectiveRatioCutoff),Ge||(Ge=!this.isInsideGrid(De,ke,Ne,He)),Ge||d!=="always"&&this.grid.hitTest(De,ke,Ne,He,d,W)?{box:[De,ke,Ne,He],placeable:!1,offscreen:!1,occluded:ze}:{box:[De,ke,Ne,He],placeable:!0,offscreen:this.isOffscreen(De,ke,Ne,He),occluded:ze}}placeCollisionCircles(l,d,v,w,E,R,O,$,W,K,ce,oe,ge,be){const Le=[],De=new s.P(d.anchorX,d.anchorY),ke=this.getPerspectiveRatio(De.x,De.y,R,be),Ne=(W?E*this.transform.getPitchedTextCorrection(d.anchorX,d.anchorY,R)/ke:E*ke)/s.aM,He={getElevation:be,pitchedLabelPlaneMatrix:O,lineVertexArray:v,pitchWithMap:W,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:De,unwrappedTileID:R,width:this.transform.width,height:this.transform.height,translation:ge},ze=Un(Ne,w,d.lineOffsetX*Ne,d.lineOffsetY*Ne,!1,d,!1,He);let Ge=!1,Je=!1,je=!0;if(ze){const at=.5*ce*ke+oe,Tt=new s.P(-100,-100),vt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),xt=new Dt,wt=ze.first,Qt=ze.last;let ti=[];for(let Xi=wt.path.length-1;Xi>=1;Xi--)ti.push(wt.path[Xi]);for(let Xi=1;Xi<Qt.path.length;Xi++)ti.push(Qt.path[Xi]);const Wt=2.5*at;if(W){const Xi=this.projectPathToScreenSpace(ti,He);ti=Xi.some((kn=>kn.signedDistanceFromCamera<=0))?[]:Xi.map((kn=>kn.point))}let si=[];if(ti.length>0){const Xi=ti[0].clone(),kn=ti[0].clone();for(let pr=1;pr<ti.length;pr++)Xi.x=Math.min(Xi.x,ti[pr].x),Xi.y=Math.min(Xi.y,ti[pr].y),kn.x=Math.max(kn.x,ti[pr].x),kn.y=Math.max(kn.y,ti[pr].y);si=Xi.x>=Tt.x&&kn.x<=vt.x&&Xi.y>=Tt.y&&kn.y<=vt.y?[ti]:kn.x<Tt.x||Xi.x>vt.x||kn.y<Tt.y||Xi.y>vt.y?[]:s.aJ([ti],Tt.x,Tt.y,vt.x,vt.y)}for(const Xi of si){xt.reset(Xi,.25*at);let kn=0;kn=xt.length<=.5*at?1:Math.ceil(xt.paddedLength/Wt)+1;for(let pr=0;pr<kn;pr++){const Jn=pr/Math.max(kn-1,1),br=xt.lerp(Jn),Qn=br.x+_r,Br=br.y+_r;Le.push(Qn,Br,at,0);const xr=Qn-at,Es=Br-at,is=Qn+at,Zr=Br+at;if(je=je&&this.isOffscreen(xr,Es,is,Zr),Je=Je||this.isInsideGrid(xr,Es,is,Zr),l!=="always"&&this.grid.hitTestCircle(Qn,Br,at,l,K)&&(Ge=!0,!$))return{circles:[],offscreen:!1,collisionDetected:Ge}}}}return{circles:!$&&Ge||!Je||ke<this.perspectiveRatioCutoff?[]:Le,offscreen:je,collisionDetected:Ge}}projectPathToScreenSpace(l,d){const v=(function(w,E){const R=s.N();return s.aB(R,E.pitchedLabelPlaneMatrix),w.map((O=>{const $=bi(O.x,O.y,R,E.getElevation),W=E.transform.projectTileCoordinates($.point.x,$.point.y,E.unwrappedTileID,E.getElevation);return W.point.x=(.5*W.point.x+.5)*E.width,W.point.y=(.5*-W.point.y+.5)*E.height,W}))})(l,d);return(function(w){let E=0,R=0,O=0,$=0;for(let W=0;W<w.length;W++)w[W].isOccluded?(O=W+1,$=0):($++,$>R&&(R=$,E=O));return w.slice(E,E+R)})(v)}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[],v=new s.aa;for(const ce of l){const oe=new s.P(ce.x+_r,ce.y+_r);v.extend(oe),d.push(oe)}const{minX:w,minY:E,maxX:R,maxY:O}=v,$=this.grid.query(w,E,R,O).concat(this.ignoredGrid.query(w,E,R,O)),W={},K={};for(const ce of $){const oe=ce.key;if(W[oe.bucketInstanceId]===void 0&&(W[oe.bucketInstanceId]={}),W[oe.bucketInstanceId][oe.featureIndex])continue;const ge=[new s.P(ce.x1,ce.y1),new s.P(ce.x2,ce.y1),new s.P(ce.x2,ce.y2),new s.P(ce.x1,ce.y2)];s.aK(d,ge)&&(W[oe.bucketInstanceId][oe.featureIndex]=!0,K[oe.bucketInstanceId]===void 0&&(K[oe.bucketInstanceId]=[]),K[oe.bucketInstanceId].push(oe.featureIndex))}return K}insertCollisionBox(l,d,v,w,E,R){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:E,collisionGroupID:R,overlapMode:d},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,v,w,E,R){const O=v?this.ignoredGrid:this.grid,$={bucketInstanceId:w,featureIndex:E,collisionGroupID:R,overlapMode:d};for(let W=0;W<l.length;W+=4)O.insertCircle($,l[W],l[W+1],l[W+2])}projectAndGetPerspectiveRatio(l,d,v,w,E){if(E){let R;w?(R=[l,d,w(l,d),1],s.aH(R,R,E)):(R=[l,d,0,1],Gl(R,R,E));const O=R[3];return{x:(R[0]/O+1)/2*this.transform.width+_r,y:(-R[1]/O+1)/2*this.transform.height+_r,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O*.5,isOccluded:!1,signedDistanceFromCamera:O}}{const R=this.transform.projectTileCoordinates(l,d,v,w);return{x:(R.point.x+1)/2*this.transform.width+_r,y:(1-R.point.y)/2*this.transform.height+_r,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R.signedDistanceFromCamera*.5,isOccluded:R.isOccluded,signedDistanceFromCamera:R.signedDistanceFromCamera}}}getPerspectiveRatio(l,d,v,w){const E=this.transform.projectTileCoordinates(l,d,v,w);return .5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5}isOffscreen(l,d,v,w){return v<_r||l>=this.screenRightBoundary||w<_r||d>this.screenBottomBoundary}isInsideGrid(l,d,v,w){return v>=0&&l<this.gridRightBoundary&&w>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=s.ar([]);return s.O(l,l,[-100,-100,0]),l}_projectCollisionBox(l,d,v,w,E,R,O,$,W,K,ce){let oe=1,ge=0,be=0,Le=1;const De=l.anchorPointX+O[0],ke=l.anchorPointY+O[1];if(R&&!E){const ti=this.projectAndGetPerspectiveRatio(De+1,ke,w,W,ce),Wt=ti.x-$.x,si=Math.atan((ti.y-$.y)/Wt)+(Wt<0?Math.PI:0),Xi=Math.sin(si),kn=Math.cos(si);oe=kn,ge=Xi,be=-Xi,Le=kn}else if(!R&&E){const ti=Li(this.transform);oe=ti.vecEast[0],ge=ti.vecEast[1],be=ti.vecSouth[0],Le=ti.vecSouth[1]}let Ne=$.x,He=$.y,ze=d;E&&(Ne=De,He=ke,ze=Math.pow(2,-(this.transform.zoom-v.overscaledZ)),ze*=this.transform.getPitchedTextCorrection(De,ke,w),K||(ze*=s.an(.5+$.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),K&&(Ne+=oe*K.x*ze+be*K.y*ze,He+=ge*K.x*ze+Le*K.y*ze);const Ge=l.x1*ze,Je=l.x2*ze,je=(Ge+Je)/2,at=l.y1*ze,Tt=l.y2*ze,vt=(at+Tt)/2,xt=[{offsetX:Ge,offsetY:at},{offsetX:je,offsetY:at},{offsetX:Je,offsetY:at},{offsetX:Je,offsetY:vt},{offsetX:Je,offsetY:Tt},{offsetX:je,offsetY:Tt},{offsetX:Ge,offsetY:Tt},{offsetX:Ge,offsetY:vt}];let wt=[];for(const{offsetX:ti,offsetY:Wt}of xt)wt.push(new s.P(Ne+oe*ti+be*Wt,He+ge*ti+Le*Wt));let Qt=!1;if(E){const ti=wt.map((Wt=>this.projectAndGetPerspectiveRatio(Wt.x,Wt.y,w,W,ce)));Qt=ti.some((Wt=>!Wt.isOccluded)),wt=ti.map((Wt=>new s.P(Wt.x,Wt.y)))}else Qt=!0;return{box:s.aL(wt),allPointsOccluded:!Qt}}}class Cp{constructor(l,d,v,w){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class wu{constructor(l,d,v,w,E){this.text=new Cp(l?l.text:null,d,v,E),this.icon=new Cp(l?l.icon:null,d,w,E)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ep{constructor(l,d,v){this.text=l,this.icon=d,this.skipFade=v}}class Ap{constructor(l,d,v,w,E){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=E}}class Pp{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:v=>v.collisionGroupID===d}}return this.collisionGroups[l]}}function Dh(C,l,d,v,w){const{horizontalAlign:E,verticalAlign:R}=s.aS(C);return new s.P(-(E-.5)*l+v[0]*w,-(R-.5)*d+v[1]*w)}class so{constructor(l,d,v,w,E){this.transform=l.clone(),this.terrain=d,this.collisionIndex=new Mp(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new Pp(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(l){const d=this.terrain;return d?(v,w)=>d.getElevation(l,v,w):null}getBucketParts(l,d,v,w){const E=v.getBucket(d),R=v.latestFeatureIndex;if(!E||!R||d.id!==E.layerIds[0])return;const O=v.collisionBoxArray,$=E.layers[0].layout,W=E.layers[0].paint,K=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),ce=v.tileSize/s.a5,oe=v.tileID.toUnwrapped(),ge=$.get("text-rotation-alignment")==="map",be=s.aN(v,1,this.transform.zoom),Le=s.aO(this.collisionIndex.transform,v,W.get("text-translate"),W.get("text-translate-anchor")),De=s.aO(this.collisionIndex.transform,v,W.get("icon-translate"),W.get("icon-translate-anchor")),ke=Hi(ge,this.transform,be);this.retainedQueryData[E.bucketInstanceId]=new Ap(E.bucketInstanceId,R,E.sourceLayerIndex,E.index,v.tileID);const Ne={bucket:E,layout:$,translationText:Le,translationIcon:De,unwrappedTileID:oe,pitchedLabelPlaneMatrix:ke,scale:K,textPixelRatio:ce,holdingForFade:v.holdingForSymbolFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:s.ay(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(w)for(const He of E.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:Ge,symbolInstanceEnd:Je}=He;l.push({sortKey:ze,symbolInstanceStart:Ge,symbolInstanceEnd:Je,parameters:Ne})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(l,d,v,w,E,R,O,$,W,K,ce,oe,ge,be,Le,De,ke,Ne,He,ze){const Ge=s.aP[l.textAnchor],Je=[l.textOffset0,l.textOffset1],je=Dh(Ge,v,w,Je,E),at=this.collisionIndex.placeCollisionBox(d,oe,$,W,K,O,R,De,ce.predicate,He,je,ze);if((!Ne||this.collisionIndex.placeCollisionBox(Ne,oe,$,W,K,O,R,ke,ce.predicate,He,je,ze).placeable)&&at.placeable){let Tt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID].text&&(Tt=this.prevPlacement.variableOffsets[ge.crossTileID].anchor),ge.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ge.crossTileID]={textOffset:Je,width:v,height:w,anchor:Ge,textBoxScale:E,prevAnchor:Tt},this.markUsedJustification(be,Ge,ge,Le),be.allowVerticalPlacement&&(this.markUsedOrientation(be,Le,ge),this.placedOrientations[ge.crossTileID]=Le),{shift:je,placedGlyphBoxes:at}}}placeLayerBucketPart(l,d,v){const{bucket:w,layout:E,translationText:R,translationIcon:O,unwrappedTileID:$,pitchedLabelPlaneMatrix:W,textPixelRatio:K,holdingForFade:ce,collisionBoxArray:oe,partiallyEvaluatedTextSize:ge,collisionGroup:be}=l.parameters,Le=E.get("text-optional"),De=E.get("icon-optional"),ke=s.aQ(E,"text-overlap","text-allow-overlap"),Ne=ke==="always",He=s.aQ(E,"icon-overlap","icon-allow-overlap"),ze=He==="always",Ge=E.get("text-rotation-alignment")==="map",Je=E.get("text-pitch-alignment")==="map",je=E.get("icon-text-fit")!=="none",at=E.get("symbol-z-order")==="viewport-y",Tt=Ne&&(ze||!w.hasIconData()||De),vt=ze&&(Ne||!w.hasTextData()||Le);!w.collisionArrays&&oe&&w.deserializeCollisionBoxes(oe);const xt=this.retainedQueryData[w.bucketInstanceId].tileID,wt=this._getTerrainElevationFunc(xt),Qt=this.transform.getFastPathSimpleProjectionMatrix(xt),ti=(Wt,si,Xi)=>{var kn,pr;if(d[Wt.crossTileID])return;if(ce)return void(this.placements[Wt.crossTileID]=new Ep(!1,!1,!1));let Jn=!1,br=!1,Qn=!0,Br=null,xr={box:null,placeable:!1,offscreen:null,occluded:!1},Es={placeable:!1},is=null,Zr=null,Vs=null,jc=0,rc=0,bl=0;si.textFeatureIndex?jc=si.textFeatureIndex:Wt.useRuntimeCollisionCircles&&(jc=Wt.featureIndex),si.verticalTextFeatureIndex&&(rc=si.verticalTextFeatureIndex);const So=si.textBox;if(So){const ha=sr=>{let er=s.az.horizontal;if(w.allowVerticalPlacement&&!sr&&this.prevPlacement){const ms=this.prevPlacement.placedOrientations[Wt.crossTileID];ms&&(this.placedOrientations[Wt.crossTileID]=ms,er=ms,this.markUsedOrientation(w,er,Wt))}return er},xl=(sr,er)=>{if(w.allowVerticalPlacement&&Wt.numVerticalGlyphVertices>0&&si.verticalTextBox){for(const ms of w.writingModes)if(ms===s.az.vertical?(xr=er(),Es=xr):xr=sr(),xr&&xr.placeable)break}else xr=sr()},Ba=Wt.textAnchorOffsetStartIndex,Na=Wt.textAnchorOffsetEndIndex;if(Na===Ba){const sr=(er,ms)=>{const gs=this.collisionIndex.placeCollisionBox(er,ke,K,xt,$,Je,Ge,R,be.predicate,wt,void 0,Qt);return gs&&gs.placeable&&(this.markUsedOrientation(w,ms,Wt),this.placedOrientations[Wt.crossTileID]=ms),gs};xl((()=>sr(So,s.az.horizontal)),(()=>{const er=si.verticalTextBox;return w.allowVerticalPlacement&&Wt.numVerticalGlyphVertices>0&&er?sr(er,s.az.vertical):{box:null,offscreen:null}})),ha(xr&&xr.placeable)}else{let sr=s.aP[(pr=(kn=this.prevPlacement)===null||kn===void 0?void 0:kn.variableOffsets[Wt.crossTileID])===null||pr===void 0?void 0:pr.anchor];const er=(gs,D0,F0)=>{const Hu=gs.x2-gs.x1,c1=gs.y2-gs.y1,O0=Wt.textBoxScale,B_=je&&He==="never"?D0:null;let Gc=null,qc=ke==="never"?1:2,Hc="never";sr&&qc++;for(let N_=0;N_<qc;N_++){for(let $_=Ba;$_<Na;$_++){const fm=w.textAnchorOffsets.get($_);if(sr&&fm.textAnchor!==sr)continue;const pm=this.attemptAnchorPlacement(fm,gs,Hu,c1,O0,Ge,Je,K,xt,$,be,Hc,Wt,w,F0,R,O,B_,wt);if(pm&&(Gc=pm.placedGlyphBoxes,Gc&&Gc.placeable))return Jn=!0,Br=pm.shift,Gc}sr?sr=null:Hc=ke}return v&&!Gc&&(Gc={box:this.collisionIndex.placeCollisionBox(So,"always",K,xt,$,Je,Ge,R,be.predicate,wt,void 0,Qt).box,offscreen:!1,placeable:!1,occluded:!1}),Gc};xl((()=>er(So,si.iconBox,s.az.horizontal)),(()=>{const gs=si.verticalTextBox;return w.allowVerticalPlacement&&(!xr||!xr.placeable)&&Wt.numVerticalGlyphVertices>0&&gs?er(gs,si.verticalIconBox,s.az.vertical):{box:null,occluded:!0,offscreen:null}})),xr&&(Jn=xr.placeable,Qn=xr.offscreen);const ms=ha(xr&&xr.placeable);if(!Jn&&this.prevPlacement){const gs=this.prevPlacement.variableOffsets[Wt.crossTileID];gs&&(this.variableOffsets[Wt.crossTileID]=gs,this.markUsedJustification(w,gs.anchor,Wt,ms))}}}if(is=xr,Jn=is&&is.placeable,Qn=is&&is.offscreen,Wt.useRuntimeCollisionCircles&&Wt.centerJustifiedTextSymbolIndex>=0){const ha=w.text.placedSymbolArray.get(Wt.centerJustifiedTextSymbolIndex),xl=s.aA(w.textSizeData,ge,ha),Ba=E.get("text-padding");Zr=this.collisionIndex.placeCollisionCircles(ke,ha,w.lineVertexArray,w.glyphOffsetArray,xl,$,W,v,Je,be.predicate,Wt.collisionCircleDiameter,Ba,R,wt),Zr.circles.length&&Zr.collisionDetected&&!v&&s.w("Collisions detected, but collision boxes are not shown"),Jn=Ne||Zr.circles.length>0&&!Zr.collisionDetected,Qn=Qn&&Zr.offscreen}if(si.iconFeatureIndex&&(bl=si.iconFeatureIndex),si.iconBox){const ha=xl=>this.collisionIndex.placeCollisionBox(xl,He,K,xt,$,Je,Ge,O,be.predicate,wt,je&&Br?Br:void 0,Qt);Es&&Es.placeable&&si.verticalIconBox?(Vs=ha(si.verticalIconBox),br=Vs.placeable):(Vs=ha(si.iconBox),br=Vs.placeable),Qn=Qn&&Vs.offscreen}const Gu=Le||Wt.numHorizontalGlyphVertices===0&&Wt.numVerticalGlyphVertices===0,Af=De||Wt.numIconVertices===0;Gu||Af?Af?Gu||(br=br&&Jn):Jn=br&&Jn:br=Jn=br&&Jn;const qu=br&&Vs.placeable;if(Jn&&is.placeable&&this.collisionIndex.insertCollisionBox(is.box,ke,E.get("text-ignore-placement"),w.bucketInstanceId,Es&&Es.placeable&&rc?rc:jc,be.ID),qu&&this.collisionIndex.insertCollisionBox(Vs.box,He,E.get("icon-ignore-placement"),w.bucketInstanceId,bl,be.ID),Zr&&Jn&&this.collisionIndex.insertCollisionCircles(Zr.circles,ke,E.get("text-ignore-placement"),w.bucketInstanceId,jc,be.ID),v&&this.storeCollisionData(w.bucketInstanceId,Xi,si,is,Vs,Zr),Wt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(w.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Wt.crossTileID]=new Ep((Jn||Tt)&&!is?.occluded,(br||vt)&&!Vs?.occluded,Qn||w.justReloaded),d[Wt.crossTileID]=!0};if(at){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Wt=w.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let si=Wt.length-1;si>=0;--si){const Xi=Wt[si];ti(w.symbolInstances.get(Xi),w.collisionArrays[Xi],Xi)}}else for(let Wt=l.symbolInstanceStart;Wt<l.symbolInstanceEnd;Wt++)ti(w.symbolInstances.get(Wt),w.collisionArrays[Wt],Wt);w.justReloaded=!1}storeCollisionData(l,d,v,w,E,R){if(v.textBox||v.iconBox){let O,$;this.collisionBoxArrays.has(l)?O=this.collisionBoxArrays.get(l):(O=new Map,this.collisionBoxArrays.set(l,O)),O.has(d)?$=O.get(d):($={text:null,icon:null},O.set(d,$)),v.textBox&&($.text=w.box),v.iconBox&&($.icon=E.box)}if(R){let O=this.collisionCircleArrays[l];O===void 0&&(O=this.collisionCircleArrays[l]=[]);for(let $=0;$<R.circles.length;$+=4)O.push(R.circles[$+0]-_r),O.push(R.circles[$+1]-_r),O.push(R.circles[$+2]),O.push(R.collisionDetected?1:0)}}markUsedJustification(l,d,v,w){let E;E=w===s.az.vertical?v.verticalPlacedTextSymbolIndex:{left:v.leftJustifiedTextSymbolIndex,center:v.centerJustifiedTextSymbolIndex,right:v.rightJustifiedTextSymbolIndex}[s.aR(d)];const R=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex,v.verticalPlacedTextSymbolIndex];for(const O of R)O>=0&&(l.text.placedSymbolArray.get(O).crossTileID=E>=0&&O!==E?0:v.crossTileID)}markUsedOrientation(l,d,v){const w=d===s.az.horizontal||d===s.az.horizontalOnly?d:0,E=d===s.az.vertical?d:0,R=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex];for(const O of R)l.text.placedSymbolArray.get(O).placedOrientation=w;v.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).placedOrientation=E)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let v=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const w=d?d.symbolFadeChange(l):1,E=d?d.opacities:{},R=d?d.variableOffsets:{},O=d?d.placedOrientations:{};for(const $ in this.placements){const W=this.placements[$],K=E[$];K?(this.opacities[$]=new wu(K,w,W.text,W.icon),v=v||W.text!==K.text.placed||W.icon!==K.icon.placed):(this.opacities[$]=new wu(null,w,W.text,W.icon,W.skipFade),v=v||W.text||W.icon)}for(const $ in E){const W=E[$];if(!this.opacities[$]){const K=new wu(W,w,!1,!1);K.isHidden()||(this.opacities[$]=K,v=v||W.text.placed||W.icon.placed)}}for(const $ in R)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=R[$]);for(const $ in O)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=O[$]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");v?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){const v={};for(const w of d){const E=w.getBucket(l);E&&w.latestFeatureIndex&&l.id===E.layerIds[0]&&this.updateBucketOpacities(E,w.tileID,v,w.collisionBoxArray)}}updateBucketOpacities(l,d,v,w){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const E=l.layers[0],R=E.layout,O=new wu(null,0,!1,!1,!0),$=R.get("text-allow-overlap"),W=R.get("icon-allow-overlap"),K=E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ce=R.get("text-rotation-alignment")==="map",oe=R.get("text-pitch-alignment")==="map",ge=R.get("icon-text-fit")!=="none",be=new wu(null,0,$&&(W||!l.hasIconData()||R.get("icon-optional")),W&&($||!l.hasTextData()||R.get("text-optional")),!0);!l.collisionArrays&&w&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(w);const Le=(ke,Ne,He)=>{for(let ze=0;ze<Ne/4;ze++)ke.opacityVertexArray.emplaceBack(He);ke.hasVisibleVertices=ke.hasVisibleVertices||He!==Ac},De=this.collisionBoxArrays.get(l.bucketInstanceId);for(let ke=0;ke<l.symbolInstances.length;ke++){const Ne=l.symbolInstances.get(ke),{numHorizontalGlyphVertices:He,numVerticalGlyphVertices:ze,crossTileID:Ge}=Ne;let Je=this.opacities[Ge];v[Ge]?Je=O:Je||(Je=be,this.opacities[Ge]=Je),v[Ge]=!0;const je=Ne.numIconVertices>0,at=this.placedOrientations[Ne.crossTileID],Tt=at===s.az.vertical,vt=at===s.az.horizontal||at===s.az.horizontalOnly;if(He>0||ze>0){const wt=Xd(Je.text);Le(l.text,He,Tt?Ac:wt),Le(l.text,ze,vt?Ac:wt);const Qt=Je.text.isHidden();[Ne.rightJustifiedTextSymbolIndex,Ne.centerJustifiedTextSymbolIndex,Ne.leftJustifiedTextSymbolIndex].forEach((si=>{si>=0&&(l.text.placedSymbolArray.get(si).hidden=Qt||Tt?1:0)})),Ne.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Ne.verticalPlacedTextSymbolIndex).hidden=Qt||vt?1:0);const ti=this.variableOffsets[Ne.crossTileID];ti&&this.markUsedJustification(l,ti.anchor,Ne,at);const Wt=this.placedOrientations[Ne.crossTileID];Wt&&(this.markUsedJustification(l,"left",Ne,Wt),this.markUsedOrientation(l,Wt,Ne))}if(je){const wt=Xd(Je.icon),Qt=!(ge&&Ne.verticalPlacedIconSymbolIndex&&Tt);Ne.placedIconSymbolIndex>=0&&(Le(l.icon,Ne.numIconVertices,Qt?wt:Ac),l.icon.placedSymbolArray.get(Ne.placedIconSymbolIndex).hidden=Je.icon.isHidden()),Ne.verticalPlacedIconSymbolIndex>=0&&(Le(l.icon,Ne.numVerticalIconVertices,Qt?Ac:wt),l.icon.placedSymbolArray.get(Ne.verticalPlacedIconSymbolIndex).hidden=Je.icon.isHidden())}const xt=De&&De.has(ke)?De.get(ke):{text:null,icon:null};if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const wt=l.collisionArrays[ke];if(wt){let Qt=new s.P(0,0);if(wt.textBox||wt.verticalTextBox){let ti=!0;if(K){const Wt=this.variableOffsets[Ge];Wt?(Qt=Dh(Wt.anchor,Wt.width,Wt.height,Wt.textOffset,Wt.textBoxScale),ce&&Qt._rotate(oe?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ti=!1}if(wt.textBox||wt.verticalTextBox){let Wt;wt.textBox&&(Wt=Tt),wt.verticalTextBox&&(Wt=vt),Fh(l.textCollisionBox.collisionVertexArray,Je.text.placed,!ti||Wt,xt.text,Qt.x,Qt.y)}}if(wt.iconBox||wt.verticalIconBox){const ti=!!(!vt&&wt.verticalIconBox);let Wt;wt.iconBox&&(Wt=ti),wt.verticalIconBox&&(Wt=!ti),Fh(l.iconCollisionBox.collisionVertexArray,Je.icon.placed,Wt,xt.icon,ge?Qt.x:0,ge?Qt.y:0)}}}}if(l.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);l.bucketInstanceId in this.collisionCircleArrays&&(l.collisionCircleArray=this.collisionCircleArrays[l.bucketInstanceId],delete this.collisionCircleArrays[l.bucketInstanceId])}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const v=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*v>l}setStale(){this.stale=!0}}function Fh(C,l,d,v,w,E){v&&v.length!==0||(v=[0,0,0,0]);const R=v[0]-_r,O=v[1]-_r,$=v[2]-_r,W=v[3]-_r;C.emplaceBack(l?1:0,d?1:0,w||0,E||0,R,O),C.emplaceBack(l?1:0,d?1:0,w||0,E||0,$,O),C.emplaceBack(l?1:0,d?1:0,w||0,E||0,$,W),C.emplaceBack(l?1:0,d?1:0,w||0,E||0,R,W)}const Oh=Math.pow(2,25),zh=Math.pow(2,24),a_=Math.pow(2,17),Su=Math.pow(2,16),Tu=Math.pow(2,9),Mu=Math.pow(2,8),Ec=Math.pow(2,1);function Xd(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;const l=C.placed?1:0,d=Math.floor(127*C.opacity);return d*Oh+l*zh+d*a_+l*Su+d*Tu+l*Mu+d*Ec+l}const Ac=0;class dl{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,d,v,w,E){const R=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(R,w,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort(((O,$)=>O.sortKey-$.sortKey)));this._currentPartIndex<R.length;)if(d.placeLayerBucketPart(R[this._currentPartIndex],this._seenCrossTileIDs,v),this._currentPartIndex++,E())return!0;return!1}}class Pc{constructor(l,d,v,w,E,R,O,$){this.placement=new so(l,d,R,O,$),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(l,d,v){const w=P(),E=()=>!this._forceFullPlacement&&P()-w>2;for(;this._currentPlacementIndex>=0;){const R=d[l[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=O)&&(!R.maxzoom||R.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new dl(R)),this._inProgressLayer.continuePlacement(v[R.source],this.placement,this._showCollisionBoxes,R,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const nn=512/s.a5/2;class Bh{constructor(l,d,v){this.tileID=l,this.bucketInstanceId=v,this._symbolsByKey={};const w=new Map;for(let E=0;E<d.length;E++){const R=d.get(E),O=R.key,$=w.get(O);$?$.push(R):w.set(O,[R])}for(const[E,R]of w){const O={positions:R.map(($=>({x:Math.floor($.anchorX*nn),y:Math.floor($.anchorY*nn)}))),crossTileIDs:R.map(($=>$.crossTileID))};if(O.positions.length>128){const $=new s.aT(O.positions.length,16,Uint16Array);for(const{x:W,y:K}of O.positions)$.add(W,K);$.finish(),delete O.positions,O.index=$}this._symbolsByKey[E]=O}}getScaledCoordinates(l,d){const{x:v,y:w,z:E}=this.tileID.canonical,{x:R,y:O,z:$}=d.canonical,W=nn/Math.pow(2,$-E),K=(O*s.a5+l.anchorY)*W,ce=w*s.a5*nn;return{x:Math.floor((R*s.a5+l.anchorX)*W-v*s.a5*nn),y:Math.floor(K-ce)}}findMatches(l,d,v){const w=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let E=0;E<l.length;E++){const R=l.get(E);if(R.crossTileID)continue;const O=this._symbolsByKey[R.key];if(!O)continue;const $=this.getScaledCoordinates(R,d);if(O.index){const W=O.index.range($.x-w,$.y-w,$.x+w,$.y+w).sort();for(const K of W){const ce=O.crossTileIDs[K];if(!v[ce]){v[ce]=!0,R.crossTileID=ce;break}}}else if(O.positions)for(let W=0;W<O.positions.length;W++){const K=O.positions[W],ce=O.crossTileIDs[W];if(Math.abs(K.x-$.x)<=w&&Math.abs(K.y-$.y)<=w&&!v[ce]){v[ce]=!0,R.crossTileID=ce;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:l})=>l))}}class Ip{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ic{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const v in this.indexes){const w=this.indexes[v],E={};for(const R in w){const O=w[R];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+d),E[O.tileID.key]=O}this.indexes[v]=E}this.lng=l}addBucket(l,d,v){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const w=this.usedCrossTileIDs[l.overscaledZ];for(const E in this.indexes){const R=this.indexes[E];if(Number(E)>l.overscaledZ)for(const O in R){const $=R[O];$.tileID.isChildOf(l)&&$.findMatches(d.symbolInstances,l,w)}else{const O=R[l.scaledTo(Number(E)).key];O&&O.findMatches(d.symbolInstances,l,w)}}for(let E=0;E<d.symbolInstances.length;E++){const R=d.symbolInstances.get(E);R.crossTileID||(R.crossTileID=v.generate(),w[R.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Bh(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const v of d.getCrossTileIDsLists())for(const w of v)delete this.usedCrossTileIDs[l][w]}removeStaleBuckets(l){let d=!1;for(const v in this.indexes){const w=this.indexes[v];for(const E in w)l[w[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[E]),delete w[E],d=!0)}return d}}class Bs{constructor(){this.layerIndexes={},this.crossTileIDs=new Ip,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,v){let w=this.layerIndexes[l.id];w===void 0&&(w=this.layerIndexes[l.id]=new Ic);let E=!1;const R={};w.handleWrapJump(v);for(const O of d){const $=O.getBucket(l);$&&l.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,$,this.crossTileIDs)&&(E=!0),R[$.bucketInstanceId]=!0)}return w.removeStaleBuckets(R)&&(E=!0),E}pruneUnusedLayers(l){const d={};l.forEach((v=>{d[v]=!0}));for(const v in this.layerIndexes)d[v]||delete this.layerIndexes[v]}}var us="void main() {fragColor=vec4(1.0);}";const xn={prelude:Gi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Gi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Gi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Gi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gi(us,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Gi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Gi(us,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Gi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Gi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gi(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Gi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Gi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Gi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Gi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Gi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Gi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Gi(C,l){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=l.match(/in ([\w]+) ([\w]+)/g),w=C.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=E?E.concat(w):w,O={};return{fragmentSource:C=C.replace(d,(($,W,K,ce,oe)=>(O[oe]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
in ${K} ${ce} ${oe};
#else
uniform ${K} ${ce} u_${oe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${oe}
    ${K} ${ce} ${oe} = u_${oe};
#endif
`))),vertexSource:l=l.replace(d,(($,W,K,ce,oe)=>{const ge=ce==="float"?"vec2":"vec4",be=oe.match(/color/)?"color":ge;return O[oe]?W==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
in ${K} ${ge} a_${oe};
out ${K} ${ce} ${oe};
#else
uniform ${K} ${ce} u_${oe};
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = a_${oe};
#else
    ${K} ${ce} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = unpack_mix_${be}(a_${oe}, u_${oe}_t);
#else
    ${K} ${ce} ${oe} = u_${oe};
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
in ${K} ${ge} a_${oe};
#else
uniform ${K} ${ce} u_${oe};
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${K} ${ce} ${oe} = a_${oe};
#else
    ${K} ${ce} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${K} ${ce} ${oe} = unpack_mix_${be}(a_${oe}, u_${oe}_t);
#else
    ${K} ${ce} ${oe} = u_${oe};
#endif
`})),staticAttributes:v,staticUniforms:R}}class On{constructor(l,d,v){this.vertexBuffer=l,this.indexBuffer=d,this.segments=v}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var wa=s.aU([{name:"a_pos",type:"Int16",components:2}]);const Ss="#define PROJECTION_MERCATOR",oo="mercator";class Ns{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return oo}get shaderDefine(){return Ss}get shaderPreludeCode(){return xn.projectionMercator}get vertexShaderPreludeCode(){return xn.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(l){}getMeshFromTileID(l,d,v,w,E){if(this._cachedMesh)return this._cachedMesh;const R=new s.aW;R.emplaceBack(0,0),R.emplaceBack(s.a5,0),R.emplaceBack(0,s.a5),R.emplaceBack(s.a5,s.a5);const O=l.createVertexBuffer(R,wa.members),$=s.aX.simpleSegment(0,0,4,2),W=new s.aY;W.emplaceBack(1,0,2),W.emplaceBack(1,2,3);const K=l.createIndexBuffer(W);return this._cachedMesh=new On(O,K,$),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(l){}}class Lc{constructor(l=0,d=0,v=0,w=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=v,this.right=w}interpolate(l,d,v){return d.top!=null&&l.top!=null&&(this.top=s.G.number(l.top,d.top,v)),d.bottom!=null&&l.bottom!=null&&(this.bottom=s.G.number(l.bottom,d.bottom,v)),d.left!=null&&l.left!=null&&(this.left=s.G.number(l.left,d.left,v)),d.right!=null&&l.right!=null&&(this.right=s.G.number(l.right,d.right,v)),this}getCenter(l,d){const v=s.an((this.left+l-this.right)/2,0,l),w=s.an((this.top+d-this.bottom)/2,0,d);return new s.P(v,w)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Lc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function fl(C,l){if(!C.renderWorldCopies||C.lngRange)return;const d=l.lng-C.center.lng;l.lng+=d>180?-360:d<-180?360:0}function Pr(C){return Math.max(0,Math.floor(C))}class ql{constructor(l,d){var v;this.applyConstrain=(w,E)=>this._constrainOverride!==null?this._constrainOverride(w,E):this._callbacks.defaultConstrain(w,E),this._callbacks=l,this._tileSize=512,this._renderWorldCopies=d?.renderWorldCopies===void 0||!!d?.renderWorldCopies,this._minZoom=d?.minZoom||0,this._maxZoom=d?.maxZoom||22,this._minPitch=d?.minPitch==null?0:d?.minPitch,this._maxPitch=d?.maxPitch==null?60:d?.maxPitch,this._constrainOverride=(v=d?.constrainOverride)!==null&&v!==void 0?v:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Pr(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Lc,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(l,d,v){this._constrainOverride=l.constrainOverride,this._latRange=l.latRange,this._lngRange=l.lngRange,this._width=l.width,this._height=l.height,this._center=l.center,this._elevation=l.elevation,this._minElevationForCurrentTile=l.minElevationForCurrentTile,this._zoom=l.zoom,this._tileZoom=Pr(this._zoom),this._scale=s.aq(this._zoom),this._bearingInRadians=l.bearingInRadians,this._fovInRadians=l.fovInRadians,this._pitchInRadians=l.pitchInRadians,this._rollInRadians=l.rollInRadians,this._unmodified=l.unmodified,this._edgeInsets=new Lc(l.padding.top,l.padding.bottom,l.padding.left,l.padding.right),this._minZoom=l.minZoom,this._maxZoom=l.maxZoom,this._minPitch=l.minPitch,this._maxPitch=l.maxPitch,this._renderWorldCopies=l.renderWorldCopies,this._cameraToCenterDistance=l.cameraToCenterDistance,this._nearZ=l.nearZ,this._farZ=l.farZ,this._autoCalculateNearFarZ=!v&&l.autoCalculateNearFarZ,d&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(l){this._minElevationForCurrentTile=l}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(l){this._minZoom!==l&&(this._minZoom=l,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(l){this._minPitch!==l&&(this._minPitch=l,this.setPitch(Math.max(this.pitch,l)))}get maxPitch(){return this._maxPitch}setMaxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.setPitch(Math.min(this.pitch,l)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get constrainOverride(){return this._constrainOverride}setConstrainOverride(l){l===void 0&&(l=null),this._constrainOverride!==l&&(this._constrainOverride=l,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(l){const d=s.W(l,-180,180)*Math.PI/180;var v,w,E,R,O,$,W,K,ce;this._bearingInRadians!==d&&(this._unmodified=!1,this._bearingInRadians=d,this._calcMatrices(),this._rotationMatrix=p(),v=this._rotationMatrix,E=-this._bearingInRadians,R=(w=this._rotationMatrix)[0],O=w[1],$=w[2],W=w[3],K=Math.sin(E),ce=Math.cos(E),v[0]=R*ce+$*K,v[1]=O*ce+W*K,v[2]=R*-K+$*ce,v[3]=O*-K+W*ce)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(l){const d=s.an(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==d&&(this._unmodified=!1,this._pitchInRadians=d,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(l){const d=l/180*Math.PI;this._rollInRadians!==d&&(this._unmodified=!1,this._rollInRadians=d,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aZ(this._fovInRadians)}setFov(l){l=s.an(l,.1,150),this.fov!==l&&(this._unmodified=!1,this._fovInRadians=s.ap(l),this._calcMatrices())}get zoom(){return this._zoom}setZoom(l){const d=this.applyConstrain(this._center,l).zoom;this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this._tileZoom=Math.max(0,Math.floor(d)),this._scale=s.aq(d),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(l){l!==this._elevation&&(this._elevation=l,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(l,d){this._autoCalculateNearFarZ=!1,this._nearZ=l,this._farZ=d,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,v){this._unmodified=!1,this._edgeInsets.interpolate(l,d,v),this.constrainInternal(),this._calcMatrices()}resize(l,d,v=!0){this._width=l,this._height=d,v&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ee([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(l){l?(this._lngRange=[l.getWest(),l.getEast()],this._latRange=[l.getSouth(),l.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-s.ao,s.ao])}getCameraQueryGeometry(l,d){if(d.length===1)return[d[0],l];{const{minX:v,minY:w,maxX:E,maxY:R}=s.aa.fromPoints(d).extend(l);return[new s.P(v,w),new s.P(E,w),new s.P(E,R),new s.P(v,R),new s.P(v,w)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:d,zoom:v}=this.applyConstrain(this.center,this.zoom);this.setCenter(d),this.setZoom(v),this._unmodified=l,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let l=s.ar(new Float64Array(16));s.Q(l,l,[this._width/2,-this._height/2,1]),s.O(l,l,[1,-1,0]),this._clipSpaceToPixelsMatrix=l,l=s.ar(new Float64Array(16)),s.Q(l,l,[1,-1,1]),s.O(l,l,[-1,-1,0]),s.Q(l,l,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=l,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(l,d,v,w){const E=v!==void 0?v:this.bearing,R=w=w!==void 0?w:this.pitch,{distanceToCenter:O,clampedElevation:$}=this._distanceToCenterFromAltElevationPitch(d,this.elevation,R),{x:W,y:K}=gn(R,E),ce=s.a9.fromLngLat(l,d);let oe,ge,be=s.a_(1,ce.y),Le=0;do{if(Le+=1,Le>10)break;ge=O/be,oe=new s.a9(ce.x+W*ge,ce.y+K*ge),be=1/oe.meterInMercatorCoordinateUnits()}while(Math.abs(O-ge*be)>1e-12);return{center:oe.toLngLat(),elevation:$,zoom:s.at(this.height/2/Math.tan(this.fovInRadians/2)/ge/this.tileSize)}}recalculateZoomAndCenter(l){if(this.elevation-l==0)return;const d=1/this.worldSize,v=s.as(1,this.center.lat)*this.worldSize,w=s.a9.fromLngLat(this.center,this.elevation),E=w.x/d,R=w.y/d,O=w.z/d,$=this.pitch,W=this.bearing,{x:K,y:ce,z:oe}=gn($,W),ge=this.cameraToCenterDistance,be=E+ge*-K,Le=R+ge*-ce,De=O+ge*oe,{distanceToCenter:ke,clampedElevation:Ne}=this._distanceToCenterFromAltElevationPitch(De/v,l,$),He=ke*v,ze=new s.a9((be+K*He)*d,(Le+ce*He)*d,0).toLngLat(),Ge=s.as(1,ze.lat),Je=s.at(this.height/2/Math.tan(this.fovInRadians/2)/ke/Ge/this.tileSize);this._elevation=Ne,this._center=ze,this.setZoom(Je)}_distanceToCenterFromAltElevationPitch(l,d,v){const w=-Math.cos(s.ap(v)),E=l-d;let R,O=d;return w*E>=0||Math.abs(w)<.1?(R=1e4,O=l+R*w):R=-E/w,{distanceToCenter:R,clampedElevation:O}}getCameraPoint(){const l=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(l*Math.sin(this.rollInRadians),l*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const l=s.as(1,this.center.lat)*this.worldSize;return gt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/l).toLngLat()}getMercatorTileCoordinates(l){if(!l)return[0,0,1,1];const d=l.canonical.z>=0?1<<l.canonical.z:Math.pow(2,l.canonical.z);return[l.canonical.x/d,l.canonical.y/d,1/d/s.a5,1/d/s.a5]}}class No{constructor(l,d){this.min=l,this.max=d,this.center=s.a$([],s.b0([],this.min,this.max),.5)}quadrant(l){const d=[l%2==0,l<2],v=s.b1(this.min),w=s.b1(this.max);for(let E=0;E<d.length;E++)v[E]=d[E]?this.min[E]:this.center[E],w[E]=d[E]?this.center[E]:this.max[E];return w[2]=this.max[2],new No(v,w)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersectsFrustum(l){let d=!0;for(let v=0;v<l.planes.length;v++){const w=this.intersectsPlane(l.planes[v]);if(w===0)return 0;w===1&&(d=!1)}return d?2:l.aabb.min[0]>this.max[0]||l.aabb.min[1]>this.max[1]||l.aabb.min[2]>this.max[2]||l.aabb.max[0]<this.min[0]||l.aabb.max[1]<this.min[1]||l.aabb.max[2]<this.min[2]?0:1}intersectsPlane(l){let d=l[3],v=l[3];for(let w=0;w<3;w++)l[w]>0?(d+=l[w]*this.min[w],v+=l[w]*this.max[w]):(v+=l[w]*this.min[w],d+=l[w]*this.max[w]);return d>=0?2:v<0?0:1}}class Cu{distanceToTile2d(l,d,v,w){const E=w.distanceX([l,d]),R=w.distanceY([l,d]);return Math.hypot(E,R)}getWrap(l,d,v){return v}getTileBoundingVolume(l,d,v,w){var E,R;let O=0,$=0;if(w?.terrain){const K=new s.a2(l.z,d,l.z,l.x,l.y),ce=w.terrain.getMinMaxElevation(K);O=(E=ce.minElevation)!==null&&E!==void 0?E:Math.min(0,v),$=(R=ce.maxElevation)!==null&&R!==void 0?R:Math.max(0,v)}const W=1<<l.z;return new No([d+l.x/W,l.y/W,O],[d+(l.x+1)/W,(l.y+1)/W,$])}allowVariableZoom(l,d){const v=l.fov*(Math.abs(Math.cos(l.rollInRadians))*l.height+Math.abs(Math.sin(l.rollInRadians))*l.width)/l.height,w=s.an(78.5-v/2,0,60);return!!d.terrain||l.pitch>w}allowWorldCopies(){return!0}prepareNextFrame(){}}class Ts{constructor(l,d,v){this.points=l,this.planes=d,this.aabb=v}static fromInvProjectionMatrix(l,d=1,v=0,w,E){const R=E?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],O=Math.pow(2,v),$=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((oe=>(function(ge,be,Le,De){const ke=s.aH([],ge,be),Ne=1/ke[3]/Le*De;return s.b6(ke,ke,[Ne,Ne,1/ke[3],Ne])})(oe,l,d,O)));w&&(function(oe,ge,be,Le){const De=Le?4:0,ke=Le?0:4;let Ne=0;const He=[],ze=[];for(let je=0;je<4;je++){const at=s.b2([],oe[je+ke],oe[je+De]),Tt=s.b7(at);s.a$(at,at,1/Tt),He.push(Tt),ze.push(at)}for(let je=0;je<4;je++){const at=s.b8(oe[je+De],ze[je],be);Ne=at!==null&&at>=0?Math.max(Ne,at):Math.max(Ne,He[je])}const Ge=(function(je,at){const Tt=s.b2([],je[at[0]],je[at[1]]),vt=s.b2([],je[at[2]],je[at[1]]),xt=[0,0,0,0];return s.b3(xt,s.b4([],Tt,vt)),xt[3]=-s.b5(xt,je[at[0]]),xt})(oe,ge),Je=(function(je,at){const Tt=s.b9(je),vt=s.ba([],je,1/Tt),xt=s.b2([],at,s.a$([],vt,s.b5(at,vt))),wt=s.b9(xt);if(wt>0){const Qt=Math.sqrt(1-vt[3]*vt[3]),ti=s.a$([],vt,-vt[3]),Wt=s.b0([],ti,s.a$([],xt,Qt/wt));return s.bb(at,Wt)}return null})(be,Ge);if(Je!==null){const je=Je/s.b5(ze[0],Ge);Ne=Math.min(Ne,je)}for(let je=0;je<4;je++){const at=Math.min(Ne,He[je]);oe[je+ke]=[oe[je+De][0]+ze[je][0]*at,oe[je+De][1]+ze[je][1]*at,oe[je+De][2]+ze[je][2]*at,1]}})($,R[0],w,E);const W=R.map((oe=>{const ge=s.b2([],$[oe[0]],$[oe[1]]),be=s.b2([],$[oe[2]],$[oe[1]]),Le=s.b3([],s.b4([],ge,be)),De=-s.b5(Le,$[oe[1]]);return Le.concat(De)})),K=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],ce=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const oe of $)for(let ge=0;ge<3;ge++)K[ge]=Math.min(K[ge],oe[ge]),ce[ge]=Math.max(ce[ge],oe[ge]);return new Ts($,W,new No(K,ce))}}class Hl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,d,v){return this._helper.interpolatePadding(l,d,v)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,d,v=!0){this._helper.resize(l,d,v)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrainOverride(l){this._helper.setConstrainOverride(l)}overrideNearFarZ(l,d){this._helper.overrideNearFarZ(l,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l,d){}constructor(l){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(d,v)=>{v=s.an(+v,this.minZoom,this.maxZoom);const w={center:new s.V(d.lng,d.lat),zoom:v};let E=this._helper._lngRange;if(!this._helper._renderWorldCopies&&E===null){const ze=179.9999999999;E=[-ze,ze]}const R=this.tileSize*s.aq(w.zoom);let O=0,$=R,W=0,K=R,ce=0,oe=0;const{x:ge,y:be}=this.size;if(this._helper._latRange){const ze=this._helper._latRange;O=s.X(ze[1])*R,$=s.X(ze[0])*R,$-O<be&&(ce=be/($-O))}E&&(W=s.W(s.Y(E[0])*R,0,R),K=s.W(s.Y(E[1])*R,0,R),K<W&&(K+=R),K-W<ge&&(oe=ge/(K-W)));const{x:Le,y:De}=vi(R,d);let ke,Ne;const He=Math.max(oe||0,ce||0);if(He){const ze=new s.P(oe?(K+W)/2:Le,ce?($+O)/2:De);return w.center=$i(R,ze).wrap(),w.zoom+=s.at(He),w}if(this._helper._latRange){const ze=be/2;De-ze<O&&(Ne=O+ze),De+ze>$&&(Ne=$-ze)}if(E){const ze=(W+K)/2;let Ge=Le;this._helper._renderWorldCopies&&(Ge=s.W(Le,ze-R/2,ze+R/2));const Je=ge/2;Ge-Je<W&&(ke=W+Je),Ge+Je>K&&(ke=K-Je)}if(ke!==void 0||Ne!==void 0){const ze=new s.P(ke??Le,Ne??De);w.center=$i(R,ze).wrap()}return w},this.applyConstrain=(d,v)=>this._helper.applyConstrain(d,v),this._helper=new ql({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(d,v)=>this.defaultConstrain(d,v)},l),this._coveringTilesDetailsProvider=new Cu}clone(){const l=new Hl;return l.apply(this),l}apply(l,d,v){this._helper.apply(l,d,v)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(l){const d=[new s.bc(0,l)];if(this._helper._renderWorldCopies){const v=this.screenPointToMercatorCoordinate(new s.P(0,0)),w=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),E=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),R=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),O=Math.floor(Math.min(v.x,w.x,E.x,R.x)),$=Math.floor(Math.max(v.x,w.x,E.x,R.x)),W=1;for(let K=O-W;K<=$+W;K++)K!==0&&d.push(new s.bc(K,l))}return d}getCameraFrustum(){return Ts.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){const d=this.screenPointToLocation(this.centerPoint,l),v=l?l.getElevationForLngLatZoom(d,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(v)}setLocationAtPoint(l,d){const v=s.as(this.elevation,this.center.lat),w=this.screenPointToMercatorCoordinateAtZ(d,v),E=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,v),R=s.a9.fromLngLat(l),O=new s.a9(R.x-(w.x-E.x),R.y-(w.y-E.y));this.setCenter(O?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(l,d){return d?this.coordinatePoint(s.a9.fromLngLat(l),d.getElevationForLngLat(l,this),this._pixelMatrix3D):this.coordinatePoint(s.a9.fromLngLat(l))}screenPointToLocation(l,d){var v;return(v=this.screenPointToMercatorCoordinate(l,d))===null||v===void 0?void 0:v.toLngLat()}screenPointToMercatorCoordinate(l,d){if(d){const v=d.pointCoordinate(l);if(v!=null)return v}return this.screenPointToMercatorCoordinateAtZ(l)}screenPointToMercatorCoordinateAtZ(l,d){const v=d||0,w=[l.x,l.y,0,1],E=[l.x,l.y,1,1];s.aH(w,w,this._pixelMatrixInverse),s.aH(E,E,this._pixelMatrixInverse);const R=w[3],O=E[3],$=w[1]/R,W=E[1]/O,K=w[2]/R,ce=E[2]/O,oe=K===ce?0:(v-K)/(ce-K);return new s.a9(s.G.number(w[0]/R,E[0]/O,oe)/this.worldSize,s.G.number($,W,oe)/this.worldSize,v)}coordinatePoint(l,d=0,v=this._pixelMatrix){const w=[l.x*this.worldSize,l.y*this.worldSize,d,1];return s.aH(w,w,v),new s.P(w[0]/w[3],w[1]/w[3])}getBounds(){const l=Math.max(0,this._helper._height/2-vn(this));return new Ee().extend(this.screenPointToLocation(new s.P(0,l))).extend(this.screenPointToLocation(new s.P(this._helper._width,l))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(l,d){return d?d.pointCoordinate(l)!=null:l.y>this.height/2-vn(this)}calculatePosMatrix(l,d=!1,v){var w;const E=(w=l.key)!==null&&w!==void 0?w:s.bd(l.wrap,l.canonical.z,l.canonical.z,l.canonical.x,l.canonical.y),R=d?this._alignedPosMatrixCache:this._posMatrixCache;if(R.has(E)){const W=R.get(E);return v?W.f32:W.f64}const O=rn(l,this.worldSize);s.S(O,d?this._alignedProjMatrix:this._viewProjMatrix,O);const $={f64:O,f32:new Float32Array(O)};return R.set(E,$),v?$.f32:$.f64}calculateFogMatrix(l){const d=l.key,v=this._fogMatrixCacheF32;if(v.has(d))return v.get(d);const w=rn(l,this.worldSize);return s.S(w,this._fogMatrix,w),v.set(d,new Float32Array(w)),v.get(d)}calculateCenterFromCameraLngLatAlt(l,d,v,w){return this._helper.calculateCenterFromCameraLngLatAlt(l,d,v,w)}_calculateNearFarZIfNeeded(l,d,v){if(!this._helper.autoCalculateNearFarZ)return;const w=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),E=l-w*this._helper._pixelPerMeter/Math.cos(d),R=w<0?E:l,O=Math.PI/2+this.pitchInRadians,$=s.ap(this.fov)*(Math.abs(Math.cos(s.ap(this.roll)))*this.height+Math.abs(Math.sin(s.ap(this.roll)))*this.width)/this.height*(.5+v.y/this.height),W=Math.sin($)*R/Math.sin(s.an(Math.PI-O-$,.01,Math.PI-.01)),K=vn(this),ce=Math.atan(K/this._helper.cameraToCenterDistance),oe=s.ap(.75),ge=ce>oe?2*ce*(.5+v.y/(2*K)):oe,be=Math.sin(ge)*R/Math.sin(s.an(Math.PI-O-ge,.01,Math.PI-.01)),Le=Math.min(W,be);this._helper._farZ=1.01*(Math.cos(Math.PI/2-d)*Le+R),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const l=this.centerOffset,d=vi(this.worldSize,this.center),v=d.x,w=d.y;this._helper._pixelPerMeter=s.as(1,this.center.lat)*this.worldSize;const E=s.ap(Math.min(this.pitch,Jt)),R=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(E));let O;this._calculateNearFarZIfNeeded(R,E,l),O=new Float64Array(16),s.be(O,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aB(this._invProjMatrix,O),O[8]=2*-l.x/this._helper._width,O[9]=2*l.y/this._helper._height,this._projectionMatrix=s.bf(O),s.Q(O,O,[1,-1,1]),s.O(O,O,[0,0,-this._helper.cameraToCenterDistance]),s.bg(O,O,-this.rollInRadians),s.bh(O,O,this.pitchInRadians),s.bg(O,O,-this.bearingInRadians),s.O(O,O,[-v,-w,0]),this._mercatorMatrix=s.Q([],O,[this.worldSize,this.worldSize,this.worldSize]),s.Q(O,O,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,O),s.O(O,O,[0,0,-this.elevation]),this._viewProjMatrix=O,this._invViewProjMatrix=s.aB([],O);const $=[0,0,-1,1];s.aH($,$,this._invViewProjMatrix),this._cameraPosition=[$[0]/$[3],$[1]/$[3],$[2]/$[3]],this._fogMatrix=new Float64Array(16),s.be(this._fogMatrix,this.fovInRadians,this.width/this.height,R,this._helper._farZ),this._fogMatrix[8]=2*-l.x/this.width,this._fogMatrix[9]=2*l.y/this.height,s.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.O(this._fogMatrix,this._fogMatrix,[-v,-w,0]),s.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,O);const W=this._helper._width%2/2,K=this._helper._height%2/2,ce=Math.cos(this.bearingInRadians),oe=Math.sin(-this.bearingInRadians),ge=v-Math.round(v)+ce*W+oe*K,be=w-Math.round(w)+ce*K+oe*W,Le=new Float64Array(O);if(s.O(Le,Le,[ge>.5?ge-1:ge,be>.5?be-1:be,0]),this._alignedProjMatrix=Le,O=s.aB(new Float64Array(16),this._pixelMatrix),!O)throw new Error("failed to invert matrix");this._pixelMatrixInverse=O,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const l=this.screenPointToMercatorCoordinate(new s.P(0,0)),d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.aH(d,d,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const l=s.as(1,this.center.lat)*this.worldSize;return gt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/l).toLngLat()}lngLatToCameraDepth(l,d){const v=s.a9.fromLngLat(l),w=[v.x*this.worldSize,v.y*this.worldSize,d,1];return s.aH(w,w,this._viewProjMatrix),w[2]/w[3]}getProjectionData(l){const{overscaledTileID:d,aligned:v,applyTerrainMatrix:w}=l,E=this._helper.getMercatorTileCoordinates(d),R=d?this.calculatePosMatrix(d,v,!0):null;let O;return O=d&&d.terrainRttPosMatrix32f&&w?d.terrainRttPosMatrix32f:R||s.bi(),{mainMatrix:O,tileMercatorCoords:E,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:O}}isLocationOccluded(l){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(l,d,v){return 1}transformLightDirection(l){return s.b1(l)}getRayDirectionFromPixel(l){throw new Error("Not implemented.")}projectTileCoordinates(l,d,v,w){const E=this.calculatePosMatrix(v);let R;w?(R=[l,d,w(l,d),1],s.aH(R,R,E)):(R=[l,d,0,1],Gl(R,R,E));const O=R[3];return{point:new s.P(R[0]/O,R[1]/O),signedDistanceFromCamera:O,isOccluded:!1}}populateCache(l){for(const d of l)this.calculatePosMatrix(d)}getMatrixForModel(l,d){const v=s.a9.fromLngLat(l,d),w=v.meterInMercatorCoordinateUnits(),E=s.bj();return s.O(E,E,[v.x,v.y,v.z]),s.bg(E,E,Math.PI),s.bh(E,E,Math.PI/2),s.Q(E,E,[-w,w,w]),E}getProjectionDataForCustomLayer(l=!0){const d=new s.a2(0,0,0,0,0),v=this.getProjectionData({overscaledTileID:d,applyGlobeMatrix:l}),w=rn(d,this.worldSize);s.S(w,this._viewProjMatrix,w),v.tileMercatorCoords=[0,0,1,1];const E=[s.a5,s.a5,this.worldSize/this._helper.pixelsPerMeter],R=s.bk();return s.Q(R,w,E),v.fallbackMatrix=R,v.mainMatrix=R,v}getFastPathSimpleProjectionMatrix(l){return this.calculatePosMatrix(l)}}function Sa(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function pl(C){if(C.useSlerp)if(C.k<1){const l=s.bl(C.startEulerAngles.roll,C.startEulerAngles.pitch,C.startEulerAngles.bearing),d=s.bl(C.endEulerAngles.roll,C.endEulerAngles.pitch,C.endEulerAngles.bearing),v=new Float64Array(4);s.bm(v,l,d,C.k);const w=s.bn(v);C.tr.setRoll(w.roll),C.tr.setPitch(w.pitch),C.tr.setBearing(w.bearing)}else C.tr.setRoll(C.endEulerAngles.roll),C.tr.setPitch(C.endEulerAngles.pitch),C.tr.setBearing(C.endEulerAngles.bearing);else C.tr.setRoll(s.G.number(C.startEulerAngles.roll,C.endEulerAngles.roll,C.k)),C.tr.setPitch(s.G.number(C.startEulerAngles.pitch,C.endEulerAngles.pitch,C.k)),C.tr.setBearing(s.G.number(C.startEulerAngles.bearing,C.endEulerAngles.bearing,C.k))}function $o(C,l,d,v,w){const E=w.padding,R=vi(w.worldSize,d.getNorthWest()),O=vi(w.worldSize,d.getNorthEast()),$=vi(w.worldSize,d.getSouthEast()),W=vi(w.worldSize,d.getSouthWest()),K=s.ap(-v),ce=R.rotate(K),oe=O.rotate(K),ge=$.rotate(K),be=W.rotate(K),Le=new s.P(Math.max(ce.x,oe.x,be.x,ge.x),Math.max(ce.y,oe.y,be.y,ge.y)),De=new s.P(Math.min(ce.x,oe.x,be.x,ge.x),Math.min(ce.y,oe.y,be.y,ge.y)),ke=Le.sub(De),Ne=(w.width-(E.left+E.right+l.left+l.right))/ke.x,He=(w.height-(E.top+E.bottom+l.top+l.bottom))/ke.y;if(He<0||Ne<0)return void Sa();const ze=Math.min(s.at(w.scale*Math.min(Ne,He)),C.maxZoom),Ge=s.P.convert(C.offset),Je=new s.P((l.left-l.right)/2,(l.top-l.bottom)/2).rotate(s.ap(v)),je=Ge.add(Je).mult(w.scale/s.aq(ze));return{center:$i(w.worldSize,R.add($).div(2).sub(je)),zoom:ze,bearing:v}}class ml{get useGlobeControls(){return!1}handlePanInertia(l,d){const v=l.mag(),w=Math.abs(vn(d));return{easingOffset:l.mult(Math.min(.75*w/v,1)),easingCenter:d.center}}handleMapControlsRollPitchBearingZoom(l,d){l.bearingDelta&&d.setBearing(d.bearing+l.bearingDelta),l.pitchDelta&&d.setPitch(d.pitch+l.pitchDelta),l.rollDelta&&d.setRoll(d.roll+l.rollDelta),l.zoomDelta&&d.setZoom(d.zoom+l.zoomDelta)}handleMapControlsPan(l,d,v){l.around.distSqr(d.centerPoint)<.01||d.setLocationAtPoint(v,l.around)}cameraForBoxAndBearing(l,d,v,w,E){return $o(l,d,v,w,E)}handleJumpToCenterZoom(l,d){l.zoom!==(d.zoom!==void 0?+d.zoom:l.zoom)&&l.setZoom(+d.zoom),d.center!==void 0&&l.setCenter(s.V.convert(d.center))}handleEaseTo(l,d){const v=l.zoom,w=l.padding,E={roll:l.roll,pitch:l.pitch,bearing:l.bearing},R={roll:d.roll===void 0?l.roll:d.roll,pitch:d.pitch===void 0?l.pitch:d.pitch,bearing:d.bearing===void 0?l.bearing:d.bearing},O=d.zoom!==void 0,$=!l.isPaddingEqual(d.padding);let W=!1;const K=O?+d.zoom:l.zoom;let ce=l.centerPoint.add(d.offsetAsPoint);const oe=l.screenPointToLocation(ce),{center:ge,zoom:be}=l.applyConstrain(s.V.convert(d.center||oe),K??v);fl(l,ge);const Le=vi(l.worldSize,oe),De=vi(l.worldSize,ge).sub(Le),ke=s.aq(be-v);return W=be!==v,{easeFunc:Ne=>{if(W&&l.setZoom(s.G.number(v,be,Ne)),s.bo(E,R)||pl({startEulerAngles:E,endEulerAngles:R,tr:l,k:Ne,useSlerp:E.roll!=R.roll}),$&&(l.interpolatePadding(w,d.padding,Ne),ce=l.centerPoint.add(d.offsetAsPoint)),d.around)l.setLocationAtPoint(d.around,d.aroundPoint);else{const He=s.aq(l.zoom-v),ze=be>v?Math.min(2,ke):Math.max(.5,ke),Ge=Math.pow(ze,1-Ne),Je=$i(l.worldSize,Le.add(De.mult(Ne*Ge)).mult(He));l.setLocationAtPoint(l.renderWorldCopies?Je.wrap():Je,ce)}},isZooming:W,elevationCenter:ge}}handleFlyTo(l,d){const v=d.zoom!==void 0,w=l.zoom,E=l.applyConstrain(s.V.convert(d.center||d.locationAtOffset),v?+d.zoom:w),R=E.center,O=E.zoom;fl(l,R);const $=vi(l.worldSize,d.locationAtOffset),W=vi(l.worldSize,R).sub($),K=W.mag(),ce=s.aq(O-w);let oe;if(d.minZoom!==void 0){const ge=Math.min(+d.minZoom,w,O),be=l.applyConstrain(R,ge).zoom;oe=s.aq(be-w)}return{easeFunc:(ge,be,Le,De)=>{l.setZoom(ge===1?O:w+s.at(be));const ke=ge===1?R:$i(l.worldSize,$.add(W.mult(Le)).mult(be));l.setLocationAtPoint(l.renderWorldCopies?ke.wrap():ke,De)},scaleOfZoom:ce,targetCenter:R,scaleOfMinZoom:oe,pixelPathLength:K}}}class zn{constructor(l,d,v){this.blendFunction=l,this.blendColor=d,this.mask=v}}zn.Replace=[1,0],zn.disabled=new zn(zn.Replace,s.bp.transparent,[!1,!1,!1,!1]),zn.unblended=new zn(zn.Replace,s.bp.transparent,[!0,!0,!0,!0]),zn.alphaBlended=new zn([1,771],s.bp.transparent,[!0,!0,!0,!0]);const Wl=2305;class pn{constructor(l,d,v){this.enable=l,this.mode=d,this.frontFace=v}}pn.disabled=new pn(!1,1029,Wl),pn.backCCW=new pn(!0,1029,Wl),pn.frontCCW=new pn(!0,1028,Wl);class Yi{constructor(l,d,v){this.func=l,this.mask=d,this.range=v}}Yi.ReadOnly=!1,Yi.ReadWrite=!0,Yi.disabled=new Yi(519,Yi.ReadOnly,[0,1]);const Zl=7680;class bn{constructor(l,d,v,w,E,R){this.test=l,this.ref=d,this.mask=v,this.fail=w,this.depthFail=E,this.pass=R}}bn.disabled=new bn({func:519,mask:0},0,0,Zl,Zl,Zl);const Eu=new WeakMap;function wo(C){var l;if(Eu.has(C))return Eu.get(C);{const d=(l=C.getParameter(C.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Eu.set(C,d),d}}class Xl{get awaitingQuery(){return!!this._readbackQueue}constructor(l){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=l;const d=l.context,v=d.gl;this._texFormat=v.RGBA,this._texType=v.UNSIGNED_BYTE;const w=new s.aW;w.emplaceBack(-1,-1),w.emplaceBack(2,-1),w.emplaceBack(-1,2);const E=new s.aY;E.emplaceBack(0,1,2),this._fullscreenTriangle=new On(d.createVertexBuffer(w,wa.members),d.createIndexBuffer(E),s.aX.simpleSegment(0,0,w.length,E.length)),this._resultBuffer=new Uint8Array(4),d.activeTexture.set(v.TEXTURE1);const R=v.createTexture();v.bindTexture(v.TEXTURE_2D,R),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST),v.texImage2D(v.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=d.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(R),wo(v)&&(this._pbo=v.createBuffer(),v.bindBuffer(v.PIXEL_PACK_BUFFER,this._pbo),v.bufferData(v.PIXEL_PACK_BUFFER,4,v.STREAM_READ),v.bindBuffer(v.PIXEL_PACK_BUFFER,null))}destroy(){const l=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),l.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(l,d){const v=this._updateCount;return this._readbackQueue?v>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():v>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(l,d),this._updateCount++,this._measuredError}_bindFramebuffer(){const l=this._cachedRenderContext.context,d=l.gl;l.activeTexture.set(d.TEXTURE1),d.bindTexture(d.TEXTURE_2D,this._fbo.colorAttachment.get()),l.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(l,d){const v=this._cachedRenderContext.context,w=v.gl;if(this._bindFramebuffer(),v.viewport.set([0,0,this._texWidth,this._texHeight]),v.clear({color:s.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(v,w.TRIANGLES,Yi.disabled,bn.disabled,zn.unblended,pn.disabled,((E,R)=>({u_input:E,u_output_expected:R}))(l,d),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&wo(w)){w.bindBuffer(w.PIXEL_PACK_BUFFER,this._pbo),w.readBuffer(w.COLOR_ATTACHMENT0),w.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),w.bindBuffer(w.PIXEL_PACK_BUFFER,null);const E=w.fenceSync(w.SYNC_GPU_COMMANDS_COMPLETE,0);w.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:E}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const l=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&wo(l)){const d=l.clientWaitSync(this._readbackQueue.sync,0,0);if(d===l.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(d===l.TIMEOUT_EXPIRED)return;l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),l.bindBuffer(l.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),l.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Xl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(l){let d=0;return d+=l[0]/256,d+=l[1]/65536,d+=l[2]/16777216,l[3]<127&&(d=-d),d/128}}const Ta=s.a5/128;function Lp(C,l){const d=C.granularity!==void 0?Math.max(C.granularity,1):1,v=d+(C.generateBorders?2:0),w=d+(C.extendToNorthPole||C.generateBorders?1:0)+(C.extendToSouthPole||C.generateBorders?1:0),E=v+1,R=w+1,O=C.generateBorders?-1:0,$=C.generateBorders||C.extendToNorthPole?-1:0,W=d+(C.generateBorders?1:0),K=d+(C.generateBorders||C.extendToSouthPole?1:0),ce=E*R,oe=v*w*6,ge=E*R>65536;if(ge&&l==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const be=ge||l==="32bit",Le=new Int16Array(2*ce);let De=0;for(let He=$;He<=K;He++)for(let ze=O;ze<=W;ze++){let Ge=ze/d*s.a5;ze===-1&&(Ge=-Ta),ze===d+1&&(Ge=s.a5+Ta);let Je=He/d*s.a5;He===-1&&(Je=C.extendToNorthPole?s.br:-Ta),He===d+1&&(Je=C.extendToSouthPole?s.bs:s.a5+Ta),Le[De++]=Ge,Le[De++]=Je}const ke=be?new Uint32Array(oe):new Uint16Array(oe);let Ne=0;for(let He=0;He<w;He++)for(let ze=0;ze<v;ze++){const Ge=ze+1+He*E,Je=ze+(He+1)*E,je=ze+1+(He+1)*E;ke[Ne++]=ze+He*E,ke[Ne++]=Je,ke[Ne++]=Ge,ke[Ne++]=Ge,ke[Ne++]=Je,ke[Ne++]=je}return{vertices:Le.buffer.slice(0),indices:ke.buffer.slice(0),uses32bitIndices:be}}const Au=new s.aV({fill:new s.bt(128,2),line:new s.bt(512,0),tile:new s.bt(128,32),stencil:new s.bt(128,1),circle:3});class Yd{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return xn.projectionGlobe}get vertexShaderPreludeCode(){return xn.projectionMercator.vertexSource}get subdivisionGranularity(){return Au}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(l){this._errorMeasurement||(this._errorMeasurement=new Xl(l));const d=s.X(this._errorQueryLatitudeDegrees),v=2*Math.atan(Math.exp(Math.PI-d*Math.PI*2))-.5*Math.PI,w=this._errorMeasurement.updateErrorLoop(d,v),E=P();w!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=w,this._errorMeasurementLastChangeTime=E);const R=Math.min(Math.max((E-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bv(R))}_getMeshKey(l){return`${l.granularity.toString(36)}_${l.generateBorders?"b":""}${l.extendToNorthPole?"n":""}${l.extendToSouthPole?"s":""}`}getMeshFromTileID(l,d,v,w,E){const R=(E==="stencil"?Au.stencil:Au.tile).getGranularityForZoomLevel(d.z);return this._getMesh(l,{granularity:R,generateBorders:v,extendToNorthPole:d.y===0&&w,extendToSouthPole:d.y===(1<<d.z)-1&&w})}_getMesh(l,d){const v=this._getMeshKey(d);if(v in this._tileMeshCache)return this._tileMeshCache[v];const w=(function(E,R){const O=Lp(R,"16bit"),$=s.aW.deserialize({arrayBuffer:O.vertices,length:O.vertices.byteLength/2/2}),W=s.aY.deserialize({arrayBuffer:O.indices,length:O.indices.byteLength/2/3});return new On(E.createVertexBuffer($,wa.members),E.createIndexBuffer(W),s.aX.simpleSegment(0,0,$.length,W.length))})(l,d);return this._tileMeshCache[v]=w,w}recalculate(l){}hasTransition(){const l=P();let d=!1;return d=d||(l-this._errorMeasurementLastChangeTime)/1e3<.7,d=d||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,d}setErrorQueryLatitudeDegrees(l){this._errorQueryLatitudeDegrees=l}}const l_=new s.t({type:new s.D(s.u.projection.type)});class Rp extends s.E{constructor(l){super(),this._transitionable=new s.x(l_,void 0),this.setProjection(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0)),this._mercatorProjection=new Ns,this._verticalPerspectiveProjection=new Yd}get transitionState(){const l=this.properties.get("type");if(typeof l=="string"&&l==="mercator")return 0;if(typeof l=="string"&&l==="vertical-perspective")return 1;if(l instanceof s.bw){if(l.from==="vertical-perspective"&&l.to==="mercator")return 1-l.transition;if(l.from==="mercator"&&l.to==="vertical-perspective")return l.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(l){this._mercatorProjection.updateGPUdependent(l),this._verticalPerspectiveProjection.updateGPUdependent(l)}getMeshFromTileID(l,d,v,w,E){return this.currentProjection.getMeshFromTileID(l,d,v,w,E)}setProjection(l){this._transitionable.setValue("type",l?.type||"mercator")}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}setErrorQueryLatitudeDegrees(l){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(l),this._mercatorProjection.setErrorQueryLatitudeDegrees(l)}}function vr(C){const l=Yl(C.worldSize,C.center.lat);return 2*Math.PI*l}function Vo(C,l,d,v,w){const E=1/(1<<w),R=l/s.a5*E+v*E,O=s.by((C/s.a5*E+d*E)*Math.PI*2+Math.PI,2*Math.PI),$=2*Math.atan(Math.exp(Math.PI-R*Math.PI*2))-.5*Math.PI,W=Math.cos($),K=new Float64Array(3);return K[0]=Math.sin(O)*W,K[1]=Math.sin($),K[2]=Math.cos(O)*W,K}function rr(C){return(function(l,d){const v=Math.cos(d),w=new Float64Array(3);return w[0]=Math.sin(l)*v,w[1]=Math.sin(d),w[2]=Math.cos(l)*v,w})(C.lng*Math.PI/180,C.lat*Math.PI/180)}function Yl(C,l){return C/(2*Math.PI)/Math.cos(l*Math.PI/180)}function Kd(C){const l=Math.asin(C[1])/Math.PI*180,d=Math.sqrt(C[0]*C[0]+C[2]*C[2]);if(d>1e-6){const v=C[0]/d,w=Math.acos(C[2]/d),E=(v>0?w:-w)/Math.PI*180;return new s.V(s.W(E,-180,180),l)}return new s.V(0,l)}function Pu(C){return Math.cos(C*Math.PI/180)}function yr(C,l){const d=Pu(C),v=Pu(l);return s.at(v/d)}function kp(C,l){const d=C.rotate(l.bearingInRadians),v=l.zoom+yr(l.center.lat,0),w=s.bu(1/Pu(l.center.lat),1/Pu(Math.min(Math.abs(l.center.lat),60)),s.bx(v,7,3,0,1)),E=360/vr({worldSize:l.worldSize,center:{lat:l.center.lat}});return new s.V(l.center.lng-d.x*E*w,s.an(l.center.lat+d.y*E,-s.ao,s.ao))}function Jd(C){const l=.5*C,d=Math.sin(l),v=Math.cos(l);return Math.log(d+v)-Math.log(v-d)}function Dp(C,l,d,v){const w=C.lat+d*v;if(Math.abs(d)>1){const E=(Math.sign(C.lat+d)!==Math.sign(C.lat)?-Math.abs(C.lat):Math.abs(C.lat))*Math.PI/180,R=Math.abs(C.lat+d)*Math.PI/180,O=Jd(E+v*(R-E)),$=Jd(E),W=Jd(R);return new s.V(C.lng+l*((O-$)/(W-$)),w)}return new s.V(C.lng+l*v,w)}class Qd{constructor(l){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=l}swapBuffers(){if(!this._hadAnyChanges)return;const l=this._cachePrevious;this._cachePrevious=this._cache,this._cache=l,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(l,d,v,w){const E=`${l.z}_${l.x}_${l.y}_${w?.terrain?"t":""}`,R=this._cache.get(E);if(R)return R;const O=this._cachePrevious.get(E);if(O)return this._cache.set(E,O),O;const $=this._boundingVolumeFactory(l,d,v,w);return this._cache.set(E,$),this._hadAnyChanges=!0,$}}class Ma{constructor(l,d,v,w){this.min=v,this.max=w,this.points=l,this.planes=d}static fromAabb(l,d){const v=[];for(let w=0;w<8;w++)v.push([1&~w?l[0]:d[0],(w>>1&1)==1?d[1]:l[1],(w>>2&1)==1?d[2]:l[2]]);return new Ma(v,[[-1,0,0,d[0]],[1,0,0,-l[0]],[0,-1,0,d[1]],[0,1,0,-l[1]],[0,0,-1,d[2]],[0,0,1,-l[2]]],l,d)}static fromCenterSizeAngles(l,d,v){const w=s.bB([],v[0],v[1],v[2]),E=s.bC([],[d[0],0,0],w),R=s.bC([],[0,d[1],0],w),O=s.bC([],[0,0,d[2]],w),$=[...l],W=[...l];for(let ce=0;ce<8;ce++)for(let oe=0;oe<3;oe++){const ge=l[oe]+E[oe]*(1&~ce?-1:1)+R[oe]*((ce>>1&1)==1?1:-1)+O[oe]*((ce>>2&1)==1?1:-1);$[oe]=Math.min($[oe],ge),W[oe]=Math.max(W[oe],ge)}const K=[];for(let ce=0;ce<8;ce++){const oe=[...l];s.b0(oe,oe,s.a$([],E,1&~ce?-1:1)),s.b0(oe,oe,s.a$([],R,(ce>>1&1)==1?1:-1)),s.b0(oe,oe,s.a$([],O,(ce>>2&1)==1?1:-1)),K.push(oe)}return new Ma(K,[[...E,-s.b5(E,K[0])],[...R,-s.b5(R,K[0])],[...O,-s.b5(O,K[0])],[-E[0],-E[1],-E[2],-s.b5(E,K[7])],[-R[0],-R[1],-R[2],-s.b5(R,K[7])],[-O[0],-O[1],-O[2],-s.b5(O,K[7])]],$,W)}intersectsFrustum(l){let d=!0;const v=this.points.length,w=this.planes.length,E=l.planes.length,R=l.points.length;for(let O=0;O<E;O++){const $=l.planes[O];let W=0;for(let K=0;K<v;K++){const ce=this.points[K];$[0]*ce[0]+$[1]*ce[1]+$[2]*ce[2]+$[3]>=0&&W++}if(W===0)return 0;W<v&&(d=!1)}if(d)return 2;for(let O=0;O<w;O++){const $=this.planes[O];let W=0;for(let K=0;K<R;K++){const ce=l.points[K];$[0]*ce[0]+$[1]*ce[1]+$[2]*ce[2]+$[3]>=0&&W++}if(W===0)return 0}return 1}intersectsPlane(l){const d=this.points.length;let v=0;for(let w=0;w<d;w++){const E=this.points[w];l[0]*E[0]+l[1]*E[1]+l[2]*E[2]+l[3]>=0&&v++}return v===d?2:v===0?0:1}}function Nh(C,l,d){const v=C-l;return v<0?-v:Math.max(0,v-d)}function Kl(C,l,d,v,w){const E=C-d;let R;return R=E<0?Math.min(-E,1+E-w):E>1?Math.min(Math.max(E-w,0),1-E):0,Math.max(R,Nh(l,v,w))}class $h{constructor(){this._boundingVolumeCache=new Qd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(l,d,v,w){const E=1<<v.z,R=1/E,O=v.x/E,$=v.y/E;let W=2;return W=Math.min(W,Kl(l,d,O,$,R)),W=Math.min(W,Kl(l,d,O+.5,-$-R,R)),W=Math.min(W,Kl(l,d,O+.5,2-$-R,R)),W}getWrap(l,d,v){const w=1<<d.z,E=1/w,R=d.x/w,O=Nh(l.x,R,E),$=Nh(l.x,R-1,E),W=Nh(l.x,R+1,E),K=Math.min(O,$,W);return K===W?1:K===$?-1:0}allowVariableZoom(l,d){return Cn(l,d)>4}allowWorldCopies(){return!1}getTileBoundingVolume(l,d,v,w){return this._boundingVolumeCache.getTileBoundingVolume(l,d,v,w)}_computeTileBoundingVolume(l,d,v,w){var E,R;let O=0,$=0;if(w?.terrain){const W=new s.a2(l.z,d,l.z,l.x,l.y),K=w.terrain.getMinMaxElevation(W);O=(E=K.minElevation)!==null&&E!==void 0?E:Math.min(0,v),$=(R=K.maxElevation)!==null&&R!==void 0?R:Math.max(0,v)}if(O/=s.bE,$/=s.bE,O+=1,$+=1,l.z<=0)return Ma.fromAabb([-$,-$,-$],[$,$,$]);if(l.z===1)return Ma.fromAabb([l.x===0?-$:0,l.y===0?0:-$,-$],[l.x===0?0:$,l.y===0?$:0,$]);{const W=[Vo(0,0,l.x,l.y,l.z),Vo(s.a5,0,l.x,l.y,l.z),Vo(s.a5,s.a5,l.x,l.y,l.z),Vo(0,s.a5,l.x,l.y,l.z)],K=[];for(const xt of W)K.push(s.a$([],xt,$));if($!==O)for(const xt of W)K.push(s.a$([],xt,O));l.y===0&&K.push([0,1,0]),l.y===(1<<l.z)-1&&K.push([0,-1,0]);const ce=[1,1,1],oe=[-1,-1,-1];for(const xt of K)for(let wt=0;wt<3;wt++)ce[wt]=Math.min(ce[wt],xt[wt]),oe[wt]=Math.max(oe[wt],xt[wt]);const ge=Vo(s.a5/2,s.a5/2,l.x,l.y,l.z),be=s.b4([],[0,1,0],ge);s.b3(be,be);const Le=s.b4([],ge,be);s.b3(Le,Le);const De=s.b4([],W[2],W[1]);s.b3(De,De);const ke=s.b4([],W[0],W[3]);s.b3(ke,ke),K.push(s.a$([],ge,$)),l.y>=(1<<l.z)/2&&K.push(s.a$([],Vo(s.a5/2,0,l.x,l.y,l.z),$)),l.y<(1<<l.z)/2&&K.push(s.a$([],Vo(s.a5/2,s.a5,l.x,l.y,l.z),$));const Ne=Ca(ge,K),He=Ca(Le,K),ze=[-ge[0],-ge[1],-ge[2],Ne.max],Ge=[ge[0],ge[1],ge[2],-Ne.min],Je=[-Le[0],-Le[1],-Le[2],He.max],je=[Le[0],Le[1],Le[2],-He.min],at=[...De,0],Tt=[...ke,0],vt=[];return l.y===0?vt.push(s.bD(Tt,at,ze),s.bD(Tt,at,Ge)):vt.push(s.bD(Je,at,ze),s.bD(Je,at,Ge),s.bD(Je,Tt,ze),s.bD(Je,Tt,Ge)),l.y===(1<<l.z)-1?vt.push(s.bD(Tt,at,ze),s.bD(Tt,at,Ge)):vt.push(s.bD(je,at,ze),s.bD(je,at,Ge),s.bD(je,Tt,ze),s.bD(je,Tt,Ge)),new Ma(vt,[ze,Ge,Je,je,at,Tt],ce,oe)}}}function Ca(C,l){let d=1/0,v=-1/0;for(const w of l){const E=s.b5(C,w);d=Math.min(d,E),v=Math.max(v,E)}return{min:d,max:v}}class gl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,d,v){return this._helper.interpolatePadding(l,d,v)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,d){this._helper.resize(l,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrainOverride(l){this._helper.setConstrainOverride(l)}overrideNearFarZ(l,d){this._helper.overrideNearFarZ(l,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l){}constructor(l){this._cachedClippingPlane=s.bF(),this._projectionMatrix=s.bj(),this._globeViewProjMatrix32f=s.bi(),this._globeViewProjMatrixNoCorrection=s.bj(),this._globeViewProjMatrixNoCorrectionInverted=s.bj(),this._globeProjMatrixInverted=s.bj(),this._cameraPosition=s.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(d,v)=>{const w=s.an(d.lat,-s.ao,s.ao),E=s.an(+v,this.minZoom+yr(0,w),this.maxZoom);return{center:new s.V(d.lng,w),zoom:E}},this.applyConstrain=(d,v)=>this._helper.applyConstrain(d,v),this._helper=new ql({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(d,v)=>this.defaultConstrain(d,v)},l),this._coveringTilesDetailsProvider=new $h}clone(){const l=new gl;return l.apply(this),l}apply(l,d){this._globeLatitudeErrorCorrectionRadians=d||0,this._helper.apply(l)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const l=s.bz();return l[0]=this._cameraPosition[0],l[1]=this._cameraPosition[1],l[2]=this._cameraPosition[2],l}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(l){const{overscaledTileID:d,applyGlobeMatrix:v}=l,w=this._helper.getMercatorTileCoordinates(d);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:w,clippingPlane:this._cachedClippingPlane,projectionTransition:v?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(l){const d=this.pitchInRadians,v=this.cameraToCenterDistance/l,w=Math.sin(d)*v,E=Math.cos(d)*v+1,R=1/Math.sqrt(w*w+E*E)*1;let O=-w,$=E;const W=Math.sqrt(O*O+$*$);O/=W,$/=W;const K=[0,O,$];s.bG(K,K,[0,0,0],-this.bearingInRadians),s.bH(K,K,[0,0,0],-1*this.center.lat*Math.PI/180),s.bI(K,K,[0,0,0],this.center.lng*Math.PI/180);const ce=1/s.b7(K);return s.a$(K,K,ce),[...K,-R*ce]}isLocationOccluded(l){return!this.isSurfacePointVisible(rr(l))}transformLightDirection(l){const d=this._helper._center.lng*Math.PI/180,v=this._helper._center.lat*Math.PI/180,w=Math.cos(v),E=[Math.sin(d)*w,Math.sin(v),Math.cos(d)*w],R=[E[2],0,-E[0]],O=[0,0,0];s.b4(O,R,E),s.b3(R,R),s.b3(O,O);const $=[0,0,0];return s.b3($,[R[0]*l[0]+O[0]*l[1]+E[0]*l[2],R[1]*l[0]+O[1]*l[1]+E[1]*l[2],R[2]*l[0]+O[2]*l[1]+E[2]*l[2]]),$}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(l,d,v){const w=(function(O,$,W){const K=1/(1<<W.z);return new s.a9(O/s.a5*K+W.x*K,$/s.a5*K+W.y*K)})(l,d,v.canonical),E=(R=w.y,[s.by(w.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-R*Math.PI*2))-.5*Math.PI]);var R;return this.getCircleRadiusCorrection()/Math.cos(E[1])}projectTileCoordinates(l,d,v,w){const E=v.canonical,R=Vo(l,d,E.x,E.y,E.z),O=1+(w?w(l,d):0)/s.bE,$=[R[0]*O,R[1]*O,R[2]*O,1];s.aH($,$,this._globeViewProjMatrixNoCorrection);const W=this._cachedClippingPlane,K=W[0]*R[0]+W[1]*R[1]+W[2]*R[2]+W[3]<0;return{point:new s.P($[0]/$[3],$[1]/$[3]),signedDistanceFromCamera:$[3],isOccluded:K}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const l=Yl(this.worldSize,this.center.lat),d=s.bk(),v=s.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*l),s.be(d,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const w=this.centerOffset;d[8]=2*-w.x/this._helper._width,d[9]=2*w.y/this._helper._height,this._projectionMatrix=s.bf(d),this._globeProjMatrixInverted=s.bk(),s.aB(this._globeProjMatrixInverted,d),s.O(d,d,[0,0,-this.cameraToCenterDistance]),s.bg(d,d,this.rollInRadians),s.bh(d,d,-this.pitchInRadians),s.bg(d,d,this.bearingInRadians),s.O(d,d,[0,0,-l]);const E=s.bz();E[0]=l,E[1]=l,E[2]=l,s.bh(v,d,this.center.lat*Math.PI/180),s.bJ(v,v,-this.center.lng*Math.PI/180),s.Q(v,v,E),this._globeViewProjMatrixNoCorrection=v,s.bh(d,d,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bJ(d,d,-this.center.lng*Math.PI/180),s.Q(d,d,E),this._globeViewProjMatrix32f=new Float32Array(d),this._globeViewProjMatrixNoCorrectionInverted=s.bk(),s.aB(this._globeViewProjMatrixNoCorrectionInverted,v);const R=s.bz();this._cameraPosition=s.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/l,s.bG(this._cameraPosition,this._cameraPosition,R,-this.rollInRadians),s.bH(this._cameraPosition,this._cameraPosition,R,this.pitchInRadians),s.bG(this._cameraPosition,this._cameraPosition,R,-this.bearingInRadians),s.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bH(this._cameraPosition,this._cameraPosition,R,-this.center.lat*Math.PI/180),s.bI(this._cameraPosition,this._cameraPosition,R,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(l);const O=s.bf(this._globeViewProjMatrixNoCorrectionInverted);s.Q(O,O,[1,1,-1]),this._cachedFrustum=Ts.fromInvProjectionMatrix(O,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(l){s.w("calculateFogMatrix is not supported on globe projection.");const d=s.bk();return s.ar(d),d}getVisibleUnwrappedCoordinates(l){return[new s.bc(0,l)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){l&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,d){if(!this._globeViewProjMatrixNoCorrection)return 1;const v=rr(l);s.a$(v,v,1+d/s.bE);const w=s.bF();return s.aH(w,[v[0],v[1],v[2],1],this._globeViewProjMatrixNoCorrection),w[2]/w[3]}populateCache(l){}getBounds(){const l=.5*this.width,d=.5*this.height,v=[new s.P(0,0),new s.P(l,0),new s.P(this.width,0),new s.P(this.width,d),new s.P(this.width,this.height),new s.P(l,this.height),new s.P(0,this.height),new s.P(0,d)],w=[];for(const ce of v)w.push(this.unprojectScreenPoint(ce));let E=0,R=0,O=0,$=0;const W=this.center;for(const ce of w){const oe=s.bK(W.lng,ce.lng),ge=s.bK(W.lat,ce.lat);oe<R&&(R=oe),oe>E&&(E=oe),ge<$&&($=ge),ge>O&&(O=ge)}const K=[W.lng+R,W.lat+$,W.lng+E,W.lat+O];return this.isSurfacePointOnScreen([0,1,0])&&(K[3]=90,K[0]=-180,K[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(K[1]=-90,K[0]=-180,K[2]=180),new Ee(K)}calculateCenterFromCameraLngLatAlt(l,d,v,w){return this._helper.calculateCenterFromCameraLngLatAlt(l,d,v,w)}setLocationAtPoint(l,d){const v=rr(this.unprojectScreenPoint(d)),w=rr(l),E=s.bz();s.bL(E);const R=s.bz();s.bI(R,v,E,-this.center.lng*Math.PI/180),s.bH(R,R,E,this.center.lat*Math.PI/180);const O=w[0]*w[0]+w[2]*w[2],$=R[0]*R[0];if(O<$)return;const W=Math.sqrt(O-$),K=-W,ce=s.bM(w[0],w[2],R[0],W),oe=s.bM(w[0],w[2],R[0],K),ge=s.bz();s.bI(ge,w,E,-ce);const be=s.bM(ge[1],ge[2],R[1],R[2]),Le=s.bz();s.bI(Le,w,E,-oe);const De=s.bM(Le[1],Le[2],R[1],R[2]),ke=.5*Math.PI,Ne=be>=-ke&&be<=ke,He=De>=-ke&&De<=ke;let ze,Ge;if(Ne&&He){const Tt=this.center.lng*Math.PI/180,vt=this.center.lat*Math.PI/180;s.bN(ce,Tt)+s.bN(be,vt)<s.bN(oe,Tt)+s.bN(De,vt)?(ze=ce,Ge=be):(ze=oe,Ge=De)}else if(Ne)ze=ce,Ge=be;else{if(!He)return;ze=oe,Ge=De}const Je=ze/Math.PI*180,je=Ge/Math.PI*180,at=this.center.lat;this.setCenter(new s.V(Je,s.an(je,-90,90))),this.setZoom(this.zoom+yr(at,this.center.lat))}locationToScreenPoint(l,d){const v=rr(l);if(d){const w=d.getElevationForLngLatZoom(l,this._helper._tileZoom);s.a$(v,v,1+w/s.bE)}return this._projectSurfacePointToScreen(v)}_projectSurfacePointToScreen(l){const d=s.bF();return s.aH(d,[...l,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],new s.P((.5*d[0]+.5)*this.width,(.5*-d[1]+.5)*this.height)}screenPointToMercatorCoordinate(l,d){if(d){const v=d.pointCoordinate(l);if(v)return v}return s.a9.fromLngLat(this.unprojectScreenPoint(l))}screenPointToLocation(l,d){var v;return(v=this.screenPointToMercatorCoordinate(l,d))===null||v===void 0?void 0:v.toLngLat()}isPointOnMapSurface(l,d){const v=this._cameraPosition,w=this.getRayDirectionFromPixel(l);return!!this.rayPlanetIntersection(v,w)}getRayDirectionFromPixel(l){const d=s.bF();d[0]=l.x/this.width*2-1,d[1]=-1*(l.y/this.height*2-1),d[2]=1,d[3]=1,s.aH(d,d,this._globeViewProjMatrixNoCorrectionInverted),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3];const v=s.bz();v[0]=d[0]-this._cameraPosition[0],v[1]=d[1]-this._cameraPosition[1],v[2]=d[2]-this._cameraPosition[2];const w=s.bz();return s.b3(w,v),w}isSurfacePointVisible(l){const d=this._cachedClippingPlane;return d[0]*l[0]+d[1]*l[1]+d[2]*l[2]+d[3]>=0}isSurfacePointOnScreen(l){if(!this.isSurfacePointVisible(l))return!1;const d=s.bF();return s.aH(d,[...l,1],this._globeViewProjMatrixNoCorrection),d[0]/=d[3],d[1]/=d[3],d[2]/=d[3],d[0]>-1&&d[0]<1&&d[1]>-1&&d[1]<1&&d[2]>-1&&d[2]<1}rayPlanetIntersection(l,d){const v=s.b5(l,d),w=s.bz(),E=s.bz();s.a$(E,d,v),s.b2(w,l,E);const R=1-s.b5(w,w);if(R<0)return null;const O=s.b5(l,l)-1,$=-v+(v<0?1:-1)*Math.sqrt(R),W=O/$,K=$;return{tMin:Math.min(W,K),tMax:Math.max(W,K)}}unprojectScreenPoint(l){const d=this._cameraPosition,v=this.getRayDirectionFromPixel(l),w=this.rayPlanetIntersection(d,v);if(w){const K=s.bz();s.b0(K,d,[v[0]*w.tMin,v[1]*w.tMin,v[2]*w.tMin]);const ce=s.bz();return s.b3(ce,K),Kd(ce)}const E=this._cachedClippingPlane,R=E[0]*v[0]+E[1]*v[1]+E[2]*v[2],O=-s.bb(E,d)/R,$=s.bz();if(O>0)s.b0($,d,[v[0]*O,v[1]*O,v[2]*O]);else{const K=s.bz();s.b0(K,d,[2*v[0],2*v[1],2*v[2]]);const ce=s.bb(this._cachedClippingPlane,K);s.b2($,K,[this._cachedClippingPlane[0]*ce,this._cachedClippingPlane[1]*ce,this._cachedClippingPlane[2]*ce])}const W=(function(K){const ce=s.bz();return ce[0]=K[0]*-K[3],ce[1]=K[1]*-K[3],ce[2]=K[2]*-K[3],{center:ce,radius:Math.sqrt(1-K[3]*K[3])}})(E);return Kd((function(K,ce,oe){const ge=s.bz();s.b2(ge,oe,K);const be=s.bz();return s.bA(be,K,ge,ce/s.b9(ge)),be})(W.center,W.radius,$))}getMatrixForModel(l,d){const v=s.V.convert(l),w=1/s.bE,E=s.bj();return s.bJ(E,E,v.lng/180*Math.PI),s.bh(E,E,-v.lat/180*Math.PI),s.O(E,E,[0,0,1+d/s.bE]),s.bh(E,E,.5*Math.PI),s.Q(E,E,[w,w,w]),E}getProjectionDataForCustomLayer(l=!0){const d=this.getProjectionData({overscaledTileID:new s.a2(0,0,0,0,0),applyGlobeMatrix:l});return d.tileMercatorCoords=[0,0,1,1],d}getFastPathSimpleProjectionMatrix(l){}}class _l{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,d,v){return this._helper.interpolatePadding(l,d,v)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,d,v=!0){this._helper.resize(l,d,v)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrainOverride(l){this._helper.setConstrainOverride(l)}overrideNearFarZ(l,d){this._helper.overrideNearFarZ(l,d)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(l,d){this._globeness=l,this._globeLatitudeErrorCorrectionRadians=d,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(l){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(d,v)=>this.currentTransform.defaultConstrain(d,v),this.applyConstrain=(d,v)=>this._helper.applyConstrain(d,v),this._helper=new ql({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(d,v)=>this.defaultConstrain(d,v)},l),this._globeness=1,this._mercatorTransform=new Hl,this._verticalPerspectiveTransform=new gl}clone(){const l=new _l;return l._globeness=this._globeness,l._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,l.apply(this),l}apply(l){this._helper.apply(l),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(l){const d=this._mercatorTransform.getProjectionData(l),v=this._verticalPerspectiveTransform.getProjectionData(l);return{mainMatrix:this.isGlobeRendering?v.mainMatrix:d.mainMatrix,clippingPlane:v.clippingPlane,tileMercatorCoords:v.tileMercatorCoords,projectionTransition:l.applyGlobeMatrix?this._globeness:0,fallbackMatrix:d.fallbackMatrix}}isLocationOccluded(l){return this.currentTransform.isLocationOccluded(l)}transformLightDirection(l){return this.currentTransform.transformLightDirection(l)}getPixelScale(){return s.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(l,d,v){const w=this._mercatorTransform.getPitchedTextCorrection(l,d,v),E=this._verticalPerspectiveTransform.getPitchedTextCorrection(l,d,v);return s.bu(w,E,this._globeness)}projectTileCoordinates(l,d,v,w){return this.currentTransform.projectTileCoordinates(l,d,v,w)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(l){return this.currentTransform.calculateFogMatrix(l)}getVisibleUnwrappedCoordinates(l){return this.currentTransform.getVisibleUnwrappedCoordinates(l)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(l){this._mercatorTransform.recalculateZoomAndCenter(l),this._verticalPerspectiveTransform.recalculateZoomAndCenter(l)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,d){return this.currentTransform.lngLatToCameraDepth(l,d)}populateCache(l){this._mercatorTransform.populateCache(l),this._verticalPerspectiveTransform.populateCache(l)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(l,d,v,w){return this._helper.calculateCenterFromCameraLngLatAlt(l,d,v,w)}setLocationAtPoint(l,d){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(l,d),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(l,d),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(l,d){return this.currentTransform.locationToScreenPoint(l,d)}screenPointToMercatorCoordinate(l,d){return this.currentTransform.screenPointToMercatorCoordinate(l,d)}screenPointToLocation(l,d){return this.currentTransform.screenPointToLocation(l,d)}isPointOnMapSurface(l,d){return this.currentTransform.isPointOnMapSurface(l,d)}getRayDirectionFromPixel(l){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(l)}getMatrixForModel(l,d){return this.currentTransform.getMatrixForModel(l,d)}getProjectionDataForCustomLayer(l=!0){const d=this._mercatorTransform.getProjectionDataForCustomLayer(l);if(!this.isGlobeRendering)return d;const v=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(l);return v.fallbackMatrix=d.mainMatrix,v}getFastPathSimpleProjectionMatrix(l){return this.currentTransform.getFastPathSimpleProjectionMatrix(l)}}class qr{get useGlobeControls(){return!0}handlePanInertia(l,d){const v=kp(l,d);return Math.abs(v.lng-d.center.lng)>180&&(v.lng=d.center.lng+179.5*Math.sign(v.lng-d.center.lng)),{easingCenter:v,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(l,d){const v=l.around,w=d.screenPointToLocation(v);l.bearingDelta&&d.setBearing(d.bearing+l.bearingDelta),l.pitchDelta&&d.setPitch(d.pitch+l.pitchDelta),l.rollDelta&&d.setRoll(d.roll+l.rollDelta);const E=d.zoom;l.zoomDelta&&d.setZoom(d.zoom+l.zoomDelta);const R=d.zoom-E;if(R===0)return;const O=s.bK(d.center.lng,w.lng),$=O/(Math.abs(O/180)+1),W=s.bK(d.center.lat,w.lat),K=d.getRayDirectionFromPixel(v),ce=d.cameraPosition,oe=-1*s.b5(ce,K),ge=s.bz();s.b0(ge,ce,[K[0]*oe,K[1]*oe,K[2]*oe]);const be=s.b7(ge)-1,Le=Math.exp(.5*-Math.max(be-.3,0)),De=Yl(d.worldSize,d.center.lat)/Math.min(d.width,d.height),ke=s.bx(De,.9,.5,1,.25),Ne=(1-s.aq(-R))*Math.min(Le,ke),He=d.center.lat,ze=d.zoom,Ge=new s.V(d.center.lng+$*Ne,s.an(d.center.lat+W*Ne,-s.ao,s.ao));d.setLocationAtPoint(w,v);const Je=d.center,je=s.bx(Math.abs(O),45,85,0,1),at=s.bx(De,.75,.35,0,1),Tt=Math.pow(Math.max(je,at),.25),vt=s.bK(Je.lng,Ge.lng),xt=s.bK(Je.lat,Ge.lat);d.setCenter(new s.V(Je.lng+vt*Tt,Je.lat+xt*Tt).wrap()),d.setZoom(ze+yr(He,d.center.lat))}handleMapControlsPan(l,d,v){if(!l.panDelta)return;const w=d.center.lat,E=d.zoom;d.setCenter(kp(l.panDelta,d).wrap()),d.setZoom(E+yr(w,d.center.lat))}cameraForBoxAndBearing(l,d,v,w,E){const R=$o(l,d,v,w,E),O=d.left/E.width*2-1,$=(E.width-d.right)/E.width*2-1,W=d.top/E.height*-2+1,K=(E.height-d.bottom)/E.height*-2+1,ce=s.bK(v.getWest(),v.getEast())<0,oe=ce?v.getEast():v.getWest(),ge=ce?v.getWest():v.getEast(),be=Math.max(v.getNorth(),v.getSouth()),Le=Math.min(v.getNorth(),v.getSouth()),De=oe+.5*s.bK(oe,ge),ke=be+.5*s.bK(be,Le),Ne=E.clone();Ne.setCenter(R.center),Ne.setBearing(R.bearing),Ne.setPitch(0),Ne.setRoll(0),Ne.setZoom(R.zoom);const He=Ne.modelViewProjectionMatrix,ze=[rr(v.getNorthWest()),rr(v.getNorthEast()),rr(v.getSouthWest()),rr(v.getSouthEast()),rr(new s.V(ge,ke)),rr(new s.V(oe,ke)),rr(new s.V(De,be)),rr(new s.V(De,Le))],Ge=rr(R.center);let Je=Number.POSITIVE_INFINITY;for(const je of ze)O<0&&(Je=qr.getLesserNonNegativeNonNull(Je,qr.solveVectorScale(je,Ge,He,"x",O))),$>0&&(Je=qr.getLesserNonNegativeNonNull(Je,qr.solveVectorScale(je,Ge,He,"x",$))),W>0&&(Je=qr.getLesserNonNegativeNonNull(Je,qr.solveVectorScale(je,Ge,He,"y",W))),K<0&&(Je=qr.getLesserNonNegativeNonNull(Je,qr.solveVectorScale(je,Ge,He,"y",K)));if(Number.isFinite(Je)&&Je!==0)return R.zoom=Ne.zoom+s.at(Je),R;Sa()}handleJumpToCenterZoom(l,d){const v=l.center.lat,w=l.applyConstrain(d.center?s.V.convert(d.center):l.center,l.zoom).center;l.setCenter(w.wrap());const E=d.zoom!==void 0?+d.zoom:l.zoom+yr(v,w.lat);l.zoom!==E&&l.setZoom(E)}handleEaseTo(l,d){const v=l.zoom,w=l.center,E=l.padding,R={roll:l.roll,pitch:l.pitch,bearing:l.bearing},O={roll:d.roll===void 0?l.roll:d.roll,pitch:d.pitch===void 0?l.pitch:d.pitch,bearing:d.bearing===void 0?l.bearing:d.bearing},$=d.zoom!==void 0,W=!l.isPaddingEqual(d.padding);let K=!1;const ce=d.center?s.V.convert(d.center):w,oe=l.applyConstrain(ce,v).center;fl(l,oe);const ge=l.clone();ge.setCenter(oe),ge.setZoom($?+d.zoom:v+yr(w.lat,ce.lat)),ge.setBearing(d.bearing);const be=new s.P(s.an(l.centerPoint.x+d.offsetAsPoint.x,0,l.width),s.an(l.centerPoint.y+d.offsetAsPoint.y,0,l.height));ge.setLocationAtPoint(oe,be);const Le=(d.offset&&d.offsetAsPoint.mag())>0?ge.center:oe,De=$?+d.zoom:v+yr(w.lat,Le.lat),ke=v+yr(w.lat,0),Ne=De+yr(Le.lat,0),He=s.bK(w.lng,Le.lng),ze=s.bK(w.lat,Le.lat),Ge=s.aq(Ne-ke);return K=De!==v,{easeFunc:Je=>{if(s.bo(R,O)||pl({startEulerAngles:R,endEulerAngles:O,tr:l,k:Je,useSlerp:R.roll!=O.roll}),W&&l.interpolatePadding(E,d.padding,Je),d.around)s.w("Easing around a point is not supported under globe projection."),l.setLocationAtPoint(d.around,d.aroundPoint);else{const je=Ne>ke?Math.min(2,Ge):Math.max(.5,Ge),at=Math.pow(je,1-Je),Tt=Dp(w,He,ze,Je*at);l.setCenter(Tt.wrap())}if(K){const je=s.G.number(ke,Ne,Je)+yr(0,l.center.lat);l.setZoom(je)}},isZooming:K,elevationCenter:Le}}handleFlyTo(l,d){const v=d.zoom!==void 0,w=l.center,E=l.zoom,R=l.padding,O=!l.isPaddingEqual(d.padding),$=l.applyConstrain(s.V.convert(d.center||d.locationAtOffset),E).center,W=v?+d.zoom:l.zoom+yr(l.center.lat,$.lat),K=l.clone();K.setCenter($),K.setZoom(W),K.setBearing(d.bearing);const ce=new s.P(s.an(l.centerPoint.x+d.offsetAsPoint.x,0,l.width),s.an(l.centerPoint.y+d.offsetAsPoint.y,0,l.height));K.setLocationAtPoint($,ce);const oe=K.center;fl(l,oe);const ge=(function(ze,Ge,Je){const je=rr(Ge),at=rr(Je),Tt=s.b5(je,at),vt=Math.acos(Tt),xt=vr(ze);return vt/(2*Math.PI)*xt})(l,w,oe),be=E+yr(w.lat,0),Le=W+yr(oe.lat,0),De=s.aq(Le-be);let ke;if(typeof d.minZoom=="number"){const ze=+d.minZoom+yr(oe.lat,0),Ge=Math.min(ze,be,Le)+yr(0,oe.lat),Je=l.applyConstrain(oe,Ge).zoom+yr(oe.lat,0);ke=s.aq(Je-be)}const Ne=s.bK(w.lng,oe.lng),He=s.bK(w.lat,oe.lat);return{easeFunc:(ze,Ge,Je,je)=>{const at=Dp(w,Ne,He,Je);O&&l.interpolatePadding(R,d.padding,ze);const Tt=ze===1?oe:at;l.setCenter(Tt.wrap());const vt=be+s.at(Ge);l.setZoom(ze===1?W:vt+yr(0,Tt.lat))},scaleOfZoom:De,targetCenter:oe,scaleOfMinZoom:ke,pixelPathLength:ge}}static solveVectorScale(l,d,v,w,E){const R=w==="x"?[v[0],v[4],v[8],v[12]]:[v[1],v[5],v[9],v[13]],O=[v[3],v[7],v[11],v[15]],$=l[0]*R[0]+l[1]*R[1]+l[2]*R[2],W=l[0]*O[0]+l[1]*O[1]+l[2]*O[2],K=d[0]*R[0]+d[1]*R[1]+d[2]*R[2],ce=d[0]*O[0]+d[1]*O[1]+d[2]*O[2];return K+E*W===$+E*ce||O[3]*($-K)+R[3]*(ce-W)+$*ce==K*W?null:(K+R[3]-E*ce-E*O[3])/(K-$-E*ce+E*W)}static getLesserNonNegativeNonNull(l,d){return d!==null&&d>=0&&d<l?d:l}}class Fp{constructor(l){this._globe=l,this._mercatorCameraHelper=new ml,this._verticalPerspectiveCameraHelper=new qr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(l,d){return this.currentHelper.handlePanInertia(l,d)}handleMapControlsRollPitchBearingZoom(l,d){return this.currentHelper.handleMapControlsRollPitchBearingZoom(l,d)}handleMapControlsPan(l,d,v){this.currentHelper.handleMapControlsPan(l,d,v)}cameraForBoxAndBearing(l,d,v,w,E){return this.currentHelper.cameraForBoxAndBearing(l,d,v,w,E)}handleJumpToCenterZoom(l,d){this.currentHelper.handleJumpToCenterZoom(l,d)}handleEaseTo(l,d){return this.currentHelper.handleEaseTo(l,d)}handleFlyTo(l,d){return this.currentHelper.handleFlyTo(l,d)}}const Rc=(C,l)=>s.B(C,l&&l.filter((d=>d.identifier!=="source.canvas"))),Uo=s.bO();class Jl extends s.E{constructor(l,d={}){var v,w;super(),this._rtlPluginLoaded=()=>{for(const R in this.tileManagers){const O=this.tileManagers[R].getSource().type;O!=="vector"&&O!=="geojson"||this.tileManagers[R].reload()}},this.map=l,this.dispatcher=new Nt(At(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",((R,O)=>this.getGlyphs(R,O))),this.dispatcher.registerMessageHandler("GI",((R,O)=>this.getImages(R,O))),this.dispatcher.registerMessageHandler("GDA",((R,O)=>this.getDashes(R,O))),this.imageManager=new ne,this.imageManager.setEventedParent(this);const E=((v=l._container)===null||v===void 0?void 0:v.lang)||typeof document<"u"&&((w=document.documentElement)===null||w===void 0?void 0:w.lang)||void 0;this.glyphManager=new fe(l._requestManager,d.localIdeographFontFamily,E),this.lineAtlas=new et(256,512),this.crossTileSymbolIndex=new Bs,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",s.bP()),ot().on(Pe,this._rtlPluginLoaded),this.on("data",(R=>{if(R.dataType!=="source"||R.sourceDataType!=="metadata")return;const O=this.tileManagers[R.sourceId];if(!O)return;const $=O.getSource();if($&&$.vectorLayerIds)for(const W in this._layers){const K=this._layers[W];K.source===$.id&&this._validateLayer(K)}}))}_setInitialValues(){var l;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new s.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((l=this.crossTileSymbolIndex)===null||l===void 0?void 0:l.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(l,d){var v,w,E;this._checkLoaded();const R=d===null?(E=(w=(v=this.stylesheet.state)===null||v===void 0?void 0:v[l])===null||w===void 0?void 0:w.default)!==null&&E!==void 0?E:null:d;if(s.bR(R,this._globalState[l]))return this;this._globalState[l]=R,this._applyGlobalStateChanges([l])}getGlobalState(){return this._globalState}setGlobalState(l){this._checkLoaded();const d=[];for(const v in l)!s.bR(this._globalState[v],l[v].default)&&(d.push(v),this._globalState[v]=l[v].default);this._applyGlobalStateChanges(d)}_applyGlobalStateChanges(l){if(l.length===0)return;const d=new Set,v={};for(const w of l){v[w]=this._globalState[w];for(const E in this._layers){const R=this._layers[E],O=R.getLayoutAffectingGlobalStateRefs(),$=R.getPaintAffectingGlobalStateRefs(),W=R.getVisibilityAffectingGlobalStateRefs();if(O.has(w)&&d.add(R.source),$.has(w))for(const{name:K,value:ce}of $.get(w))this._updatePaintProperty(R,K,ce);W?.has(w)&&(R.recalculateVisibility(),this._updateLayer(R))}}this.dispatcher.broadcast("UGS",v);for(const w in this.tileManagers)d.has(w)&&(this._reloadSource(w),this._changed=!0)}loadURL(l,d={},v){this.fire(new s.l("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const w=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController;const E=this._loadStyleRequest;s.j(w,this._loadStyleRequest).then((R=>{this._loadStyleRequest=null,this._load(R.data,d,v)})).catch((R=>{this._loadStyleRequest=null,R&&!E.signal.aborted&&this.fire(new s.k(R))}))}loadJSON(l,d={},v){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,b.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(l,d,v)})).catch((()=>{}))}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(Uo,{validate:!1})}_load(l,d,v){var w,E;let R=d.transformStyle?d.transformStyle(v,l):l;if(!d.validate||!Rc(this,s.C(R))){R=Object.assign({},R),this._loaded=!0,this.stylesheet=R;for(const O in R.sources)this.addSource(O,R.sources[O],{validate:!1});R.sprite?this._loadSprite(R.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(R.glyphs),this._createLayers(),this.light=new tt(this.stylesheet.light),this._setProjectionInternal(((w=this.stylesheet.projection)===null||w===void 0?void 0:w.type)||"mercator"),this.sky=new dt(this.stylesheet.sky),this.map.setTerrain((E=this.stylesheet.terrain)!==null&&E!==void 0?E:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){var l,d,v;const w=s.bS(this.stylesheet.layers);this.setGlobalState((l=this.stylesheet.state)!==null&&l!==void 0?l:null),this.dispatcher.broadcast("SL",w),this._order=w.map((E=>E.id)),this._layers={},this._serializedLayers=null;for(const E of w){const R=s.bT(E,this._globalState);if(R.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=R,s.bU(R)&&this.tileManagers[R.source]){const O=(v=(d=E.paint)===null||d===void 0?void 0:d["raster-fade-duration"])!==null&&v!==void 0?v:R.paint.get("raster-fade-duration");this.tileManagers[R.source].setRasterFadeDuration(O)}}}_loadSprite(l,d=!1,v=void 0){this.imageManager.setLoaded(!1);const w=new AbortController;let E;this._spriteRequest=w,(function(R,O,$,W){return s._(this,void 0,void 0,(function*(){const K=G(R),ce=$>1?"@2x":"",oe={},ge={};for(const{id:be,url:Le}of K){const De=O.transformRequest(j(Le,ce,".json"),"SpriteJSON");oe[be]=s.j(De,W);const ke=O.transformRequest(j(Le,ce,".png"),"SpriteImage");ge[be]=q.getImage(ke,W)}return yield Promise.all([...Object.values(oe),...Object.values(ge)]),(function(be,Le){return s._(this,void 0,void 0,(function*(){const De={};for(const ke in be){De[ke]={};const Ne=b.getImageCanvasContext((yield Le[ke]).data),He=(yield be[ke]).data;for(const ze in He){const{width:Ge,height:Je,x:je,y:at,sdf:Tt,pixelRatio:vt,stretchX:xt,stretchY:wt,content:Qt,textFitWidth:ti,textFitHeight:Wt}=He[ze];De[ke][ze]={data:null,pixelRatio:vt,sdf:Tt,stretchX:xt,stretchY:wt,content:Qt,textFitWidth:ti,textFitHeight:Wt,spriteData:{width:Ge,height:Je,x:je,y:at,context:Ne}}}}return De}))})(oe,ge)}))})(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((R=>{if(this._spriteRequest=null,R)for(const O in R){this._spritesImagesIds[O]=[];const $=this._spritesImagesIds[O]?this._spritesImagesIds[O].filter((W=>!(W in R))):[];for(const W of $)this.imageManager.removeImage(W),this._changedImages[W]=!0;for(const W in R[O]){const K=O==="default"?W:`${O}:${W}`;this._spritesImagesIds[O].push(K),K in this.imageManager.images?this.imageManager.updateImage(K,R[O][W],!1):this.imageManager.addImage(K,R[O][W]),d&&(this._changedImages[K]=!0)}}})).catch((R=>{this._spriteRequest=null,E=R,w.signal.aborted||this.fire(new s.k(E))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),v&&v(E)}))}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(l){const d=this.tileManagers[l.source];if(!d)return;const v=l.sourceLayer;if(!v)return;const w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(v)===-1)&&this.fire(new s.k(new Error(`Source layer "${v}" does not exist on source "${w.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.tileManagers)if(!this.tileManagers[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l,d=!1){const v=this._serializedAllLayers();if(!l||l.length===0)return Object.values(d?s.bV(v):v);const w=[];for(const E of l)if(v[E]){const R=d?s.bV(v[E]):v[E];w.push(R)}return w}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const d=Object.keys(this._layers);for(const v of d){const w=this._layers[v];w.type!=="custom"&&(l[v]=w.serialize())}return l}hasTransitions(){var l,d,v;if(!((l=this.light)===null||l===void 0)&&l.hasTransition()||!((d=this.sky)===null||d===void 0)&&d.hasTransition()||!((v=this.projection)===null||v===void 0)&&v.hasTransition())return!0;for(const w in this.tileManagers)if(this.tileManagers[w].hasTransition())return!0;for(const w in this._layers)if(this._layers[w].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const d=this._changed;if(d){const w=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(w.length||E.length)&&this._updateWorkerLayers(w,E);for(const R in this._updatedSources){const O=this._updatedSources[R];if(O==="reload")this._reloadSource(R);else{if(O!=="clear")throw new Error(`Invalid action ${O}`);this._clearSource(R)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(l);this.light.updateTransitions(l),this.sky.updateTransitions(l),this._resetUpdates()}const v={};for(const w in this.tileManagers){const E=this.tileManagers[w];v[w]=E.used,E.used=!1}for(const w of this._order){const E=this._layers[w];E.recalculate(l,this._availableImages),!E.isHidden(l.zoom)&&E.source&&(this.tileManagers[E.source].used=!0)}for(const w in v){const E=this.tileManagers[w];!!v[w]!=!!E.used&&E.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:w}))}this.light.recalculate(l),this.sky.recalculate(l),this.projection.recalculate(l),this.z=l.zoom,d&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const d in this.tileManagers)this.tileManagers[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.tileManagers)this.tileManagers[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,d={}){var v;this._checkLoaded();const w=this.serialize();if(l=d.transformStyle?d.transformStyle(w,l):l,((v=d.validate)===null||v===void 0||v)&&Rc(this,s.C(l)))return!1;(l=s.bV(l)).layers=s.bS(l.layers);const E=s.bW(w,l),R=this._getOperationsToPerform(E);if(R.unimplemented.length>0)throw new Error(`Unimplemented: ${R.unimplemented.join(", ")}.`);if(R.operations.length===0)return!1;for(const O of R.operations)O();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const d=[],v=[];for(const w of l)switch(w.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":d.push((()=>this.addLayer.apply(this,w.args)));break;case"removeLayer":d.push((()=>this.removeLayer.apply(this,w.args)));break;case"setPaintProperty":d.push((()=>this.setPaintProperty.apply(this,w.args)));break;case"setLayoutProperty":d.push((()=>this.setLayoutProperty.apply(this,w.args)));break;case"setFilter":d.push((()=>this.setFilter.apply(this,w.args)));break;case"addSource":d.push((()=>this.addSource.apply(this,w.args)));break;case"removeSource":d.push((()=>this.removeSource.apply(this,w.args)));break;case"setLayerZoomRange":d.push((()=>this.setLayerZoomRange.apply(this,w.args)));break;case"setLight":d.push((()=>this.setLight.apply(this,w.args)));break;case"setGeoJSONSourceData":d.push((()=>this.setGeoJSONSourceData.apply(this,w.args)));break;case"setGlyphs":d.push((()=>this.setGlyphs.apply(this,w.args)));break;case"setSprite":d.push((()=>this.setSprite.apply(this,w.args)));break;case"setTerrain":d.push((()=>this.map.setTerrain.apply(this,w.args)));break;case"setSky":d.push((()=>this.setSky.apply(this,w.args)));break;case"setProjection":this.setProjection.apply(this,w.args);break;case"setGlobalState":d.push((()=>this.setGlobalState.apply(this,w.args)));break;case"setTransition":d.push((()=>{}));break;default:v.push(w.command)}return{operations:d,unimplemented:v}}addImage(l,d){if(this.getImage(l))return this.fire(new s.k(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,d),this._afterImageUpdated(l)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new s.k(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,d,v={}){if(this._checkLoaded(),this.tileManagers[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.C.source,`sources.${l}`,d,null,v))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const w=this.tileManagers[l]=new Ii(l,d,this.dispatcher);w.style=this,w.setEventedParent(this,(()=>({isSourceLoaded:w.loaded(),source:w.serialize(),sourceId:l}))),w.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.tileManagers[l]===void 0)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===l)return this.fire(new s.k(new Error(`Source "${l}" cannot be removed while layer "${v}" is using it.`)));const d=this.tileManagers[l];delete this.tileManagers[l],delete this._updatedSources[l],d.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,d){if(this._checkLoaded(),this.tileManagers[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const v=this.tileManagers[l].getSource();if(v.type!=="geojson")throw new Error(`geojsonSource.type is ${v.type}, which is !== 'geojson`);v.setData(d),this._changed=!0}getSource(l){return this.tileManagers[l]&&this.tileManagers[l].getSource()}addLayer(l,d,v={}){this._checkLoaded();const w=l.id;if(this.getLayer(w))return void this.fire(new s.k(new Error(`Layer "${w}" already exists on this map.`)));let E;if(l.type==="custom"){if(Rc(this,s.bX(l)))return;E=s.bT(l,this._globalState)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(w,l.source),l=s.bV(l),l=s.e(l,{source:w})),this._validate(s.C.layer,`layers.${w}`,l,{arrayIndex:-1},v))return;E=s.bT(l,this._globalState),this._validateLayer(E),E.setEventedParent(this,{layer:{id:w}})}const R=d?this._order.indexOf(d):this._order.length;if(d&&R===-1)this.fire(new s.k(new Error(`Cannot add layer "${w}" before non-existing layer "${d}".`)));else{if(this._order.splice(R,0,w),this._layerOrderChanged=!0,this._layers[w]=E,this._removedLayers[w]&&E.source&&E.type!=="custom"){const O=this._removedLayers[w];delete this._removedLayers[w],O.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.tileManagers[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.k(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;const v=this._order.indexOf(l);this._order.splice(v,1);const w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new s.k(new Error(`Cannot move layer "${l}" before non-existing layer "${d}".`))):(this._order.splice(w,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const d=this._layers[l];if(!d)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${l}".`)));d.setEventedParent(null);const v=this._order.indexOf(l);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,d,v){this._checkLoaded();const w=this.getLayer(l);w?w.minzoom===d&&w.maxzoom===v||(d!=null&&(w.minzoom=d),v!=null&&(w.maxzoom=v),this._updateLayer(w)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,d,v={}){this._checkLoaded();const w=this.getLayer(l);if(w){if(!s.bR(w.filter,d))return d==null?(w.setFilter(void 0),void this._updateLayer(w)):void(this._validate(s.C.filter,`layers.${w.id}.filter`,d,null,v)||(w.setFilter(s.bV(d)),this._updateLayer(w)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return s.bV(this.getLayer(l).filter)}setLayoutProperty(l,d,v,w={}){this._checkLoaded();const E=this.getLayer(l);E?s.bR(E.getLayoutProperty(d),v)||(E.setLayoutProperty(d,v,w),this._updateLayer(E)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,d){const v=this.getLayer(l);if(v)return v.getLayoutProperty(d);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,d,v,w={}){this._checkLoaded();const E=this.getLayer(l);E?s.bR(E.getPaintProperty(d),v)||this._updatePaintProperty(E,d,v,w):this.fire(new s.k(new Error(`Cannot style non-existing layer "${l}".`)))}_updatePaintProperty(l,d,v,w={}){l.setPaintProperty(d,v,w)&&this._updateLayer(l),s.bU(l)&&d==="raster-fade-duration"&&this.tileManagers[l.source].setRasterFadeDuration(v),this._changed=!0,this._updatedPaintProps[l.id]=!0,this._serializedLayers=null}getPaintProperty(l,d){return this.getLayer(l).getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const v=l.source,w=l.sourceLayer,E=this.tileManagers[v];if(E===void 0)return void this.fire(new s.k(new Error(`The source '${v}' does not exist in the map's style.`)));const R=E.getSource().type;R==="geojson"&&w?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||w?(l.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),E.setFeatureState(w,l.id,d)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,d){this._checkLoaded();const v=l.source,w=this.tileManagers[v];if(w===void 0)return void this.fire(new s.k(new Error(`The source '${v}' does not exist in the map's style.`)));const E=w.getSource().type,R=E==="vector"?l.sourceLayer:void 0;E!=="vector"||R?d&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(R,l.id,d):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const d=l.source,v=l.sourceLayer,w=this.tileManagers[d];if(w!==void 0)return w.getSource().type!=="vector"||v?(l.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),w.getFeatureState(v,l.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=s.bY(this.tileManagers,(E=>E.serialize())),d=this._serializeByIds(this._order,!0),v=this.map.getTerrain()||void 0,w=this.stylesheet;return s.bZ({version:w.version,name:w.name,metadata:w.metadata,light:w.light,sky:w.sky,center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch,sprite:w.sprite,glyphs:w.glyphs,transition:w.transition,projection:w.projection,sources:l,layers:d,terrain:v},(E=>E!==void 0))}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.tileManagers[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.tileManagers[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const d=R=>this._layers[R].type==="fill-extrusion",v={},w=[];for(let R=this._order.length-1;R>=0;R--){const O=this._order[R];if(d(O)){v[O]=R;for(const $ of l){const W=$[O];if(W)for(const K of W)w.push(K)}}}w.sort(((R,O)=>O.intersectionZ-R.intersectionZ));const E=[];for(let R=this._order.length-1;R>=0;R--){const O=this._order[R];if(d(O))for(let $=w.length-1;$>=0;$--){const W=w[$].feature;if(v[W.layer.id]<R)break;E.push(W),w.pop()}else for(const $ of l){const W=$[O];if(W)for(const K of W)E.push(K.feature)}}return E}queryRenderedFeatures(l,d,v){d&&d.filter&&this._validate(s.C.filter,"queryRenderedFeatures.filter",d.filter,null,d);const w={};if(d&&d.layers){if(!(Array.isArray(d.layers)||d.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const W of d.layers){const K=this._layers[W];if(!K)return this.fire(new s.k(new Error(`The layer '${W}' does not exist in the map's style and cannot be queried for features.`))),[];w[K.source]=!0}}const E=[];d.availableImages=this._availableImages;const R=this._serializedAllLayers(),O=d.layers instanceof Set?d.layers:Array.isArray(d.layers)?new Set(d.layers):null,$=Object.assign(Object.assign({},d),{layers:O,globalState:this._globalState});for(const W in this.tileManagers)d.layers&&!w[W]||E.push(bt(this.tileManagers[W],this._layers,R,l,$,v,this.map.terrain?(K,ce,oe)=>this.map.terrain.getElevation(K,ce,oe):void 0));return this.placement&&E.push((function(W,K,ce,oe,ge,be,Le){const De={},ke=be.queryRenderedSymbols(oe),Ne=[];for(const He of Object.keys(ke).map(Number))Ne.push(Le[He]);Ne.sort(Mt);for(const He of Ne){const ze=He.featureIndex.lookupSymbolFeatures(ke[He.bucketInstanceId],K,He.bucketIndex,He.sourceLayerIndex,{filterSpec:ge.filter,globalState:ge.globalState},ge.layers,ge.availableImages,W);for(const Ge in ze){const Je=De[Ge]=De[Ge]||[],je=ze[Ge];je.sort(((at,Tt)=>{const vt=He.featureSortOrder;if(vt){const xt=vt.indexOf(at.featureIndex);return vt.indexOf(Tt.featureIndex)-xt}return Tt.featureIndex-at.featureIndex}));for(const at of je)Je.push(at)}}return(function(He,ze,Ge){for(const Je in He)for(const je of He[Je])Zt(je,Ge[ze[Je].source]);return He})(De,W,ce)})(this._layers,R,this.tileManagers,l,$,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(l,d){d?.filter&&this._validate(s.C.filter,"querySourceFeatures.filter",d.filter,null,d);const v=this.tileManagers[l];return v?(function(w,E){const R=w.getRenderableIds().map((W=>w.getTileByID(W))),O=[],$={};for(let W=0;W<R.length;W++){const K=R[W],ce=K.tileID.canonical.key;$[ce]||($[ce]=!0,K.querySourceFeatures(O,E))}return O})(v,d?Object.assign(Object.assign({},d),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(l,d={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const R in l)if(!s.bR(l[R],v[R])){w=!0;break}if(!w)return;const E={now:P(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,d),this.light.updateTransitions(E)}getProjection(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.projection}setProjection(l){if(this._checkLoaded(),this.projection){if(this.projection.name===l.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=l,this._setProjectionInternal(l.type)}getSky(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.sky}setSky(l,d={}){this._checkLoaded();const v=this.getSky();let w=!1;if(!l&&!v)return;if(l&&!v)w=!0;else if(!l&&v)w=!0;else for(const R in l)if(!s.bR(l[R],v[R])){w=!0;break}if(!w)return;const E={now:P(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=l,this.sky.setSky(l,d),this.sky.updateTransitions(E)}_setProjectionInternal(l){const d=(function(v,w){const E={constrainOverride:w};if(Array.isArray(v)){const R=new Rp({type:v});return{projection:R,transform:new _l(E),cameraHelper:new Fp(R)}}switch(v){case"mercator":return{projection:new Ns,transform:new Hl(E),cameraHelper:new ml};case"globe":{const R=new Rp({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:R,transform:new _l(E),cameraHelper:new Fp(R)}}case"vertical-perspective":return{projection:new Yd,transform:new gl(E),cameraHelper:new qr};default:return s.w(`Unknown projection name: ${v}. Falling back to mercator projection.`),{projection:new Ns,transform:new Hl(E),cameraHelper:new ml}}})(l,this.map.transformConstrain);this.projection=d.projection,this.map.migrateProjection(d.transform,d.cameraHelper);for(const v in this.tileManagers)this.tileManagers[v].reload()}_validate(l,d,v,w,E={}){return(!E||E.validate!==!1)&&Rc(this,l.call(s.C,s.e({key:d,style:this.serialize(),value:v,styleSpec:s.u},w)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ot().off(Pe,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.tileManagers){const v=this.tileManagers[d];v.setEventedParent(null),v.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.tileManagers[l].clearTiles()}_reloadSource(l){this.tileManagers[l].resume(),this.tileManagers[l].reload()}_updateSources(l){for(const d in this.tileManagers)this.tileManagers[d].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.tileManagers)this._reloadSource(l)}_updatePlacement(l,d,v,w,E=!1){let R=!1,O=!1;const $={};for(const W of this._order){const K=this._layers[W];if(K.type!=="symbol")continue;if(!$[K.source]){const oe=this.tileManagers[K.source];$[K.source]=oe.getRenderableIds(!0).map((ge=>oe.getTileByID(ge))).sort(((ge,be)=>be.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(be.tileID)?-1:1)))}const ce=this.crossTileSymbolIndex.addLayer(K,$[K.source],l.center.lng);R=R||ce}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||v===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P(),l.zoom))&&(this.pauseablePlacement=new Pc(l,this.map.terrain,this._order,E,d,v,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P()),O=!0),R&&this.pauseablePlacement.placement.setStale()),O||R)for(const W of this._order){const K=this._layers[W];K.type==="symbol"&&this.placement.updateLayerOpacities(K,$[K.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P())}_releaseSymbolFadeTiles(){for(const l in this.tileManagers)this.tileManagers[l].releaseSymbolFadeTiles()}getImages(l,d){return s._(this,void 0,void 0,(function*(){const v=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const w=this.tileManagers[d.source];return w&&w.setDependencies(d.tileID.key,d.type,d.icons),v}))}getGlyphs(l,d){return s._(this,void 0,void 0,(function*(){const v=yield this.glyphManager.getGlyphs(d.stacks),w=this.tileManagers[d.source];return w&&w.setDependencies(d.tileID.key,d.type,[""]),v}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,d={}){this._checkLoaded(),l&&this._validate(s.C.glyphs,"glyphs",l,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}getDashes(l,d){return s._(this,void 0,void 0,(function*(){const v={};for(const[w,E]of Object.entries(d.dashes))v[w]=this.lineAtlas.getDash(E.dasharray,E.round);return v}))}addSprite(l,d,v={},w){this._checkLoaded();const E=[{id:l,url:d}],R=[...G(this.stylesheet.sprite),...E];this._validate(s.C.sprite,"sprite",R,null,v)||(this.stylesheet.sprite=R,this._loadSprite(E,!0,w))}removeSprite(l){this._checkLoaded();const d=G(this.stylesheet.sprite);if(d.find((v=>v.id===l))){if(this._spritesImagesIds[l])for(const v of this._spritesImagesIds[l])this.imageManager.removeImage(v),this._changedImages[v]=!0;d.splice(d.findIndex((v=>v.id===l)),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return G(this.stylesheet.sprite)}setSprite(l,d={},v){this._checkLoaded(),l&&this._validate(s.C.sprite,"sprite",l,null,d)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,v):(this._unloadSprite(),v&&v(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const l in this.tileManagers){const d=this.tileManagers[l];d.setEventedParent(null),d.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const l in this._layers){const d=this._layers[l];d.setEventedParent(null),d.onRemove&&d.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var c_=s.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,d,v,w,E,R,O,$,W){this.context=l;let K=this.boundPaintVertexBuffers.length!==w.length;for(let ce=0;!K&&ce<w.length;ce++)this.boundPaintVertexBuffers[ce]!==w[ce]&&(K=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==v||K||this.boundIndexBuffer!==E||this.boundVertexOffset!==R||this.boundDynamicVertexBuffer!==O||this.boundDynamicVertexBuffer2!==$||this.boundDynamicVertexBuffer3!==W?this.freshBind(d,v,w,E,R,O,$,W):(l.bindVertexArray.set(this.vao),O&&O.bind(),E&&E.dynamicDraw&&E.bind(),$&&$.bind(),W&&W.bind())}freshBind(l,d,v,w,E,R,O,$){const W=l.numAttributes,K=this.context,ce=K.gl;this.vao&&this.destroy(),this.vao=K.createVertexArray(),K.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=O,this.boundDynamicVertexBuffer3=$,d.enableAttributes(ce,l);for(const oe of v)oe.enableAttributes(ce,l);R&&R.enableAttributes(ce,l),O&&O.enableAttributes(ce,l),$&&$.enableAttributes(ce,l),d.bind(),d.setVertexAttribPointers(ce,l,E);for(const oe of v)oe.bind(),oe.setVertexAttribPointers(ce,l,E);R&&(R.bind(),R.setVertexAttribPointers(ce,l,E)),w&&w.bind(),O&&(O.bind(),O.setVertexAttribPointers(ce,l,E)),$&&($.bind(),$.setVertexAttribPointers(ce,l,E)),K.currentNumAttributes=W}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const u_=(C,l,d,v,w)=>({u_texture:0,u_ele_delta:C,u_fog_matrix:l,u_fog_color:d?d.properties.get("fog-color"):s.bp.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:w?0:d?d.calculateFogBlendOpacity(v):0,u_horizon_color:d?d.properties.get("horizon-color"):s.bp.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1,u_is_globe_mode:w?1:0}),Ea={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function kc(C){const l=[];for(let d=0;d<C.length;d++){if(C[d]===null)continue;const v=C[d].split(" ");l.push(v.pop())}return l}class Op{constructor(l,d,v,w,E,R,O,$,W=[]){const K=l.gl;this.program=K.createProgram();const ce=kc(d.staticAttributes),oe=v?v.getBinderAttributes():[],ge=ce.concat(oe),be=xn.prelude.staticUniforms?kc(xn.prelude.staticUniforms):[],Le=O.staticUniforms?kc(O.staticUniforms):[],De=d.staticUniforms?kc(d.staticUniforms):[],ke=v?v.getBinderUniforms():[],Ne=be.concat(Le).concat(De).concat(ke),He=[];for(const vt of Ne)He.indexOf(vt)<0&&He.push(vt);const ze=v?v.defines():[];wo(K)&&ze.unshift("#version 300 es"),E&&ze.push("#define OVERDRAW_INSPECTOR;"),R&&ze.push("#define TERRAIN3D;"),$&&ze.push($),W&&ze.push(...W);let Ge=ze.concat(xn.prelude.fragmentSource,O.fragmentSource,d.fragmentSource).join(`
`),Je=ze.concat(xn.prelude.vertexSource,O.vertexSource,d.vertexSource).join(`
`);wo(K)||(Ge=(function(vt){return vt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Ge),Je=(function(vt){return vt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Je));const je=K.createShader(K.FRAGMENT_SHADER);if(K.isContextLost())return void(this.failedToCreate=!0);if(K.shaderSource(je,Ge),K.compileShader(je),!K.getShaderParameter(je,K.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${K.getShaderInfoLog(je)}`);K.attachShader(this.program,je);const at=K.createShader(K.VERTEX_SHADER);if(K.isContextLost())return void(this.failedToCreate=!0);if(K.shaderSource(at,Je),K.compileShader(at),!K.getShaderParameter(at,K.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${K.getShaderInfoLog(at)}`);K.attachShader(this.program,at),this.attributes={};const Tt={};this.numAttributes=ge.length;for(let vt=0;vt<this.numAttributes;vt++)ge[vt]&&(K.bindAttribLocation(this.program,vt,ge[vt]),this.attributes[ge[vt]]=vt);if(K.linkProgram(this.program),!K.getProgramParameter(this.program,K.LINK_STATUS))throw new Error(`Program failed to link: ${K.getProgramInfoLog(this.program)}`);K.deleteShader(at),K.deleteShader(je);for(let vt=0;vt<He.length;vt++){const xt=He[vt];if(xt&&!Tt[xt]){const wt=K.getUniformLocation(this.program,xt);wt&&(Tt[xt]=wt)}}this.fixedUniforms=w(l,Tt),this.terrainUniforms=((vt,xt)=>({u_depth:new s.b_(vt,xt.u_depth),u_terrain:new s.b_(vt,xt.u_terrain),u_terrain_dim:new s.bq(vt,xt.u_terrain_dim),u_terrain_matrix:new s.c0(vt,xt.u_terrain_matrix),u_terrain_unpack:new s.c1(vt,xt.u_terrain_unpack),u_terrain_exaggeration:new s.bq(vt,xt.u_terrain_exaggeration)}))(l,Tt),this.projectionUniforms=((vt,xt)=>({u_projection_matrix:new s.c0(vt,xt.u_projection_matrix),u_projection_tile_mercator_coords:new s.c1(vt,xt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.c1(vt,xt.u_projection_clipping_plane),u_projection_transition:new s.bq(vt,xt.u_projection_transition),u_projection_fallback_matrix:new s.c0(vt,xt.u_projection_fallback_matrix)}))(l,Tt),this.binderUniforms=v?v.getUniforms(l,Tt):[]}draw(l,d,v,w,E,R,O,$,W,K,ce,oe,ge,be,Le,De,ke,Ne,He){const ze=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(v),l.setStencilMode(w),l.setColorMode(E),l.setCullFace(R),$){l.activeTexture.set(ze.TEXTURE2),ze.bindTexture(ze.TEXTURE_2D,$.depthTexture),l.activeTexture.set(ze.TEXTURE3),ze.bindTexture(ze.TEXTURE_2D,$.texture);for(const Je in this.terrainUniforms)this.terrainUniforms[Je].set($[Je])}if(W)for(const Je in W)this.projectionUniforms[Ea[Je]].set(W[Je]);if(O)for(const Je in this.fixedUniforms)this.fixedUniforms[Je].set(O[Je]);De&&De.setUniforms(l,this.binderUniforms,be,{zoom:Le});let Ge=0;switch(d){case ze.LINES:Ge=2;break;case ze.TRIANGLES:Ge=3;break;case ze.LINE_STRIP:Ge=1}for(const Je of ge.get()){const je=Je.vaos||(Je.vaos={});(je[K]||(je[K]=new Vh)).bind(l,this,ce,De?De.getPaintVertexBuffers():[],oe,Je.vertexOffset,ke,Ne,He),ze.drawElements(d,Je.primitiveLength*Ge,ze.UNSIGNED_SHORT,Je.primitiveOffset*Ge*2)}}}function ef(C,l,d){const v=1/s.aN(d,1,l.transform.tileZoom),w=Math.pow(2,d.tileID.overscaledZ),E=d.tileSize*Math.pow(2,l.transform.tileZoom)/w,R=E*(d.tileID.canonical.x+d.tileID.wrap*w),O=E*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[v,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[R>>16,O>>16],u_pixel_coord_lower:[65535&R,65535&O]}}const tf=(C,l,d,v)=>{const w=C.style.light,E=w.properties.get("position"),R=[E.x,E.y,E.z],O=s.c4();w.properties.get("anchor")==="viewport"&&s.c5(O,C.transform.bearingInRadians),s.c6(R,R,O);const $=C.transform.transformLightDirection(R),W=w.properties.get("color");return{u_lightpos:R,u_lightpos_globe:$,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+l,u_opacity:d,u_fill_translate:v}},vl=(C,l,d,v,w,E,R)=>s.e(tf(C,l,d,v),ef(E,C,R),{u_height_factor:-Math.pow(2,w.overscaledZ)/R.tileSize/8}),Iu=(C,l,d,v)=>s.e(ef(l,C,d),{u_fill_translate:v}),nf=(C,l)=>({u_world:C,u_fill_translate:l}),zp=(C,l,d,v,w)=>s.e(Iu(C,l,d,w),{u_world:v}),Bp=(C,l,d,v,w)=>{const E=C.transform;let R,O,$=0;if(d.paint.get("circle-pitch-alignment")==="map"){const W=s.aN(l,1,E.zoom);R=!0,O=[W,W],$=W/(s.a5*Math.pow(2,l.tileID.overscaledZ))*2*Math.PI*w}else R=!1,O=E.pixelsToGLUnits;return{u_camera_to_center_distance:E.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+R,u_device_pixel_ratio:C.pixelRatio,u_extrude_scale:O,u_globe_extrude_scale:$,u_translate:v}},Ql=C=>({u_pixel_extrude_scale:[1/C.width,1/C.height]}),Dc=C=>({u_viewport_size:[C.width,C.height]}),Aa=(C,l=1)=>({u_color:C,u_overlay:0,u_overlay_scale:l}),Fc=(C,l,d,v)=>{const w=s.aN(C,1,l)/(s.a5*Math.pow(2,C.tileID.overscaledZ))*2*Math.PI*v;return{u_extrude_scale:s.aN(C,1,l),u_intensity:d,u_globe_extrude_scale:w}},Np=(C,l,d,v)=>{const w=s.N();s.c7(w,0,C.width,C.height,0,0,1);const E=C.context.gl;return{u_matrix:w,u_world:[E.drawingBufferWidth,E.drawingBufferHeight],u_image:d,u_color_ramp:v,u_opacity:l.paint.get("heatmap-opacity")}},Uh=(C,l,d)=>{const v=d.paint.get("hillshade-accent-color");let w;switch(d.paint.get("hillshade-method")){case"basic":w=4;break;case"combined":w=1;break;case"igor":w=2;break;case"multidirectional":w=3;break;default:w=0}const E=d.getIlluminationProperties();for(let R=0;R<E.directionRadians.length;R++)d.paint.get("hillshade-illumination-anchor")==="viewport"&&(E.directionRadians[R]+=C.transform.bearingInRadians);return{u_image:0,u_latrange:d_(0,l.tileID),u_exaggeration:d.paint.get("hillshade-exaggeration"),u_altitudes:E.altitudeRadians,u_azimuths:E.directionRadians,u_accent:v,u_method:w,u_highlights:E.highlightColor,u_shadows:E.shadowColor}},h_=(C,l)=>{const d=l.stride,v=s.N();return s.c7(v,0,s.a5,-s.a5,0,0,1),s.O(v,v,[0,-s.a5,0]),{u_matrix:v,u_image:1,u_dimension:[d,d],u_zoom:C.overscaledZ,u_unpack:l.getUnpackVector()}};function d_(C,l){const d=Math.pow(2,l.canonical.z),v=l.canonical.y;return[new s.a9(0,v/d).toLngLat().lat,new s.a9(0,(v+1)/d).toLngLat().lat]}const $p=(C,l,d=0)=>({u_image:0,u_unpack:l.getUnpackVector(),u_dimension:[l.stride,l.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:d,u_opacity:C.paint.get("color-relief-opacity")}),Lu=(C,l,d,v)=>{const w=C.transform;return{u_translation:ku(C,l,d),u_ratio:v/s.aN(l,1,w.zoom),u_device_pixel_ratio:C.pixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},Vp=(C,l,d,v,w)=>s.e(Lu(C,l,d,v),{u_image:0,u_image_height:w}),jh=(C,l,d,v,w)=>{const E=C.transform,R=ao(l,E);return{u_translation:ku(C,l,d),u_texsize:l.imageAtlasTexture.size,u_ratio:v/s.aN(l,1,E.zoom),u_device_pixel_ratio:C.pixelRatio,u_image:0,u_scale:[R,w.fromScale,w.toScale],u_fade:w.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Up=(C,l,d,v,w)=>{const E=ao(l,C.transform);return s.e(Lu(C,l,d,v),{u_tileratio:E,u_crossfade_from:w.fromScale,u_crossfade_to:w.toScale,u_image:0,u_mix:w.t,u_lineatlas_width:C.lineAtlas.width,u_lineatlas_height:C.lineAtlas.height})},Ru=(C,l,d,v,w,E)=>{const R=ao(l,C.transform);return s.e(Lu(C,l,d,v),{u_image:0,u_image_height:E,u_tileratio:R,u_crossfade_from:w.fromScale,u_crossfade_to:w.toScale,u_image_dash:1,u_mix:w.t,u_lineatlas_width:C.lineAtlas.width,u_lineatlas_height:C.lineAtlas.height})};function ao(C,l){return 1/s.aN(C,1,l.tileZoom)}function ku(C,l,d){return s.aO(C.transform,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Pa=(C,l,d,v,w)=>{return{u_tl_parent:C,u_scale_parent:l,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(R=v.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(E=v.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Gh(v.paint.get("raster-hue-rotate")),u_coords_top:[w[0].x,w[0].y,w[1].x,w[1].y],u_coords_bottom:[w[3].x,w[3].y,w[2].x,w[2].y]};var E,R};function Gh(C){C*=Math.PI/180;const l=Math.sin(C),d=Math.cos(C);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const Du=(C,l,d,v,w,E,R,O,$,W,K,ce,oe)=>{const ge=R.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ge.cameraToCenterDistance,u_pitch:ge.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ge.width/ge.height,u_fade_change:R.options.fadeDuration?R.symbolFadeChange:1,u_label_plane_matrix:O,u_coord_matrix:$,u_is_text:+K,u_pitch_with_map:+v,u_is_along_line:w,u_is_variable_anchor:E,u_texsize:ce,u_texture:0,u_translation:W,u_pitched_scale:oe}},Fu=(C,l,d,v,w,E,R,O,$,W,K,ce,oe,ge)=>{const be=R.transform;return s.e(Du(C,l,d,v,w,E,R,O,$,W,K,ce,ge),{u_gamma_scale:v?Math.cos(be.pitch*Math.PI/180)*be.cameraToCenterDistance:1,u_device_pixel_ratio:R.pixelRatio,u_is_halo:1})},Ia=(C,l,d,v,w,E,R,O,$,W,K,ce,oe)=>s.e(Fu(C,l,d,v,w,E,R,O,$,W,!0,K,0,oe),{u_texsize_icon:ce,u_texture_icon:1}),qh=(C,l)=>({u_opacity:C,u_color:l}),rf=(C,l,d,v,w)=>s.e((function(E,R,O,$){const W=O.imageManager.getPattern(E.from.toString()),K=O.imageManager.getPattern(E.to.toString()),{width:ce,height:oe}=O.imageManager.getPixelSize(),ge=Math.pow(2,$.tileID.overscaledZ),be=$.tileSize*Math.pow(2,O.transform.tileZoom)/ge,Le=be*($.tileID.canonical.x+$.tileID.wrap*ge),De=be*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:W.tl,u_pattern_br_a:W.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[ce,oe],u_mix:R.t,u_pattern_size_a:W.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/s.aN($,1,O.transform.tileZoom),u_pixel_coord_upper:[Le>>16,De>>16],u_pixel_coord_lower:[65535&Le,65535&De]}})(d,w,l,v),{u_opacity:C}),jp=(C,l)=>{},ec={fillExtrusion:(C,l)=>({u_lightpos:new s.c2(C,l.u_lightpos),u_lightpos_globe:new s.c2(C,l.u_lightpos_globe),u_lightintensity:new s.bq(C,l.u_lightintensity),u_lightcolor:new s.c2(C,l.u_lightcolor),u_vertical_gradient:new s.bq(C,l.u_vertical_gradient),u_opacity:new s.bq(C,l.u_opacity),u_fill_translate:new s.c3(C,l.u_fill_translate)}),fillExtrusionPattern:(C,l)=>({u_lightpos:new s.c2(C,l.u_lightpos),u_lightpos_globe:new s.c2(C,l.u_lightpos_globe),u_lightintensity:new s.bq(C,l.u_lightintensity),u_lightcolor:new s.c2(C,l.u_lightcolor),u_vertical_gradient:new s.bq(C,l.u_vertical_gradient),u_height_factor:new s.bq(C,l.u_height_factor),u_opacity:new s.bq(C,l.u_opacity),u_fill_translate:new s.c3(C,l.u_fill_translate),u_image:new s.b_(C,l.u_image),u_texsize:new s.c3(C,l.u_texsize),u_pixel_coord_upper:new s.c3(C,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(C,l.u_pixel_coord_lower),u_scale:new s.c2(C,l.u_scale),u_fade:new s.bq(C,l.u_fade)}),fill:(C,l)=>({u_fill_translate:new s.c3(C,l.u_fill_translate)}),fillPattern:(C,l)=>({u_image:new s.b_(C,l.u_image),u_texsize:new s.c3(C,l.u_texsize),u_pixel_coord_upper:new s.c3(C,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(C,l.u_pixel_coord_lower),u_scale:new s.c2(C,l.u_scale),u_fade:new s.bq(C,l.u_fade),u_fill_translate:new s.c3(C,l.u_fill_translate)}),fillOutline:(C,l)=>({u_world:new s.c3(C,l.u_world),u_fill_translate:new s.c3(C,l.u_fill_translate)}),fillOutlinePattern:(C,l)=>({u_world:new s.c3(C,l.u_world),u_image:new s.b_(C,l.u_image),u_texsize:new s.c3(C,l.u_texsize),u_pixel_coord_upper:new s.c3(C,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(C,l.u_pixel_coord_lower),u_scale:new s.c2(C,l.u_scale),u_fade:new s.bq(C,l.u_fade),u_fill_translate:new s.c3(C,l.u_fill_translate)}),circle:(C,l)=>({u_camera_to_center_distance:new s.bq(C,l.u_camera_to_center_distance),u_scale_with_map:new s.b_(C,l.u_scale_with_map),u_pitch_with_map:new s.b_(C,l.u_pitch_with_map),u_extrude_scale:new s.c3(C,l.u_extrude_scale),u_device_pixel_ratio:new s.bq(C,l.u_device_pixel_ratio),u_globe_extrude_scale:new s.bq(C,l.u_globe_extrude_scale),u_translate:new s.c3(C,l.u_translate)}),collisionBox:(C,l)=>({u_pixel_extrude_scale:new s.c3(C,l.u_pixel_extrude_scale)}),collisionCircle:(C,l)=>({u_viewport_size:new s.c3(C,l.u_viewport_size)}),debug:(C,l)=>({u_color:new s.b$(C,l.u_color),u_overlay:new s.b_(C,l.u_overlay),u_overlay_scale:new s.bq(C,l.u_overlay_scale)}),depth:jp,clippingMask:jp,heatmap:(C,l)=>({u_extrude_scale:new s.bq(C,l.u_extrude_scale),u_intensity:new s.bq(C,l.u_intensity),u_globe_extrude_scale:new s.bq(C,l.u_globe_extrude_scale)}),heatmapTexture:(C,l)=>({u_matrix:new s.c0(C,l.u_matrix),u_world:new s.c3(C,l.u_world),u_image:new s.b_(C,l.u_image),u_color_ramp:new s.b_(C,l.u_color_ramp),u_opacity:new s.bq(C,l.u_opacity)}),hillshade:(C,l)=>({u_image:new s.b_(C,l.u_image),u_latrange:new s.c3(C,l.u_latrange),u_exaggeration:new s.bq(C,l.u_exaggeration),u_altitudes:new s.c9(C,l.u_altitudes),u_azimuths:new s.c9(C,l.u_azimuths),u_accent:new s.b$(C,l.u_accent),u_method:new s.b_(C,l.u_method),u_shadows:new s.c8(C,l.u_shadows),u_highlights:new s.c8(C,l.u_highlights)}),hillshadePrepare:(C,l)=>({u_matrix:new s.c0(C,l.u_matrix),u_image:new s.b_(C,l.u_image),u_dimension:new s.c3(C,l.u_dimension),u_zoom:new s.bq(C,l.u_zoom),u_unpack:new s.c1(C,l.u_unpack)}),colorRelief:(C,l)=>({u_image:new s.b_(C,l.u_image),u_unpack:new s.c1(C,l.u_unpack),u_dimension:new s.c3(C,l.u_dimension),u_elevation_stops:new s.b_(C,l.u_elevation_stops),u_color_stops:new s.b_(C,l.u_color_stops),u_color_ramp_size:new s.b_(C,l.u_color_ramp_size),u_opacity:new s.bq(C,l.u_opacity)}),line:(C,l)=>({u_translation:new s.c3(C,l.u_translation),u_ratio:new s.bq(C,l.u_ratio),u_device_pixel_ratio:new s.bq(C,l.u_device_pixel_ratio),u_units_to_pixels:new s.c3(C,l.u_units_to_pixels)}),lineGradient:(C,l)=>({u_translation:new s.c3(C,l.u_translation),u_ratio:new s.bq(C,l.u_ratio),u_device_pixel_ratio:new s.bq(C,l.u_device_pixel_ratio),u_units_to_pixels:new s.c3(C,l.u_units_to_pixels),u_image:new s.b_(C,l.u_image),u_image_height:new s.bq(C,l.u_image_height)}),linePattern:(C,l)=>({u_translation:new s.c3(C,l.u_translation),u_texsize:new s.c3(C,l.u_texsize),u_ratio:new s.bq(C,l.u_ratio),u_device_pixel_ratio:new s.bq(C,l.u_device_pixel_ratio),u_image:new s.b_(C,l.u_image),u_units_to_pixels:new s.c3(C,l.u_units_to_pixels),u_scale:new s.c2(C,l.u_scale),u_fade:new s.bq(C,l.u_fade)}),lineSDF:(C,l)=>({u_translation:new s.c3(C,l.u_translation),u_ratio:new s.bq(C,l.u_ratio),u_device_pixel_ratio:new s.bq(C,l.u_device_pixel_ratio),u_units_to_pixels:new s.c3(C,l.u_units_to_pixels),u_image:new s.b_(C,l.u_image),u_mix:new s.bq(C,l.u_mix),u_tileratio:new s.bq(C,l.u_tileratio),u_crossfade_from:new s.bq(C,l.u_crossfade_from),u_crossfade_to:new s.bq(C,l.u_crossfade_to),u_lineatlas_width:new s.bq(C,l.u_lineatlas_width),u_lineatlas_height:new s.bq(C,l.u_lineatlas_height)}),lineGradientSDF:(C,l)=>({u_translation:new s.c3(C,l.u_translation),u_ratio:new s.bq(C,l.u_ratio),u_device_pixel_ratio:new s.bq(C,l.u_device_pixel_ratio),u_units_to_pixels:new s.c3(C,l.u_units_to_pixels),u_image:new s.b_(C,l.u_image),u_image_height:new s.bq(C,l.u_image_height),u_tileratio:new s.bq(C,l.u_tileratio),u_crossfade_from:new s.bq(C,l.u_crossfade_from),u_crossfade_to:new s.bq(C,l.u_crossfade_to),u_image_dash:new s.b_(C,l.u_image_dash),u_mix:new s.bq(C,l.u_mix),u_lineatlas_width:new s.bq(C,l.u_lineatlas_width),u_lineatlas_height:new s.bq(C,l.u_lineatlas_height)}),raster:(C,l)=>({u_tl_parent:new s.c3(C,l.u_tl_parent),u_scale_parent:new s.bq(C,l.u_scale_parent),u_buffer_scale:new s.bq(C,l.u_buffer_scale),u_fade_t:new s.bq(C,l.u_fade_t),u_opacity:new s.bq(C,l.u_opacity),u_image0:new s.b_(C,l.u_image0),u_image1:new s.b_(C,l.u_image1),u_brightness_low:new s.bq(C,l.u_brightness_low),u_brightness_high:new s.bq(C,l.u_brightness_high),u_saturation_factor:new s.bq(C,l.u_saturation_factor),u_contrast_factor:new s.bq(C,l.u_contrast_factor),u_spin_weights:new s.c2(C,l.u_spin_weights),u_coords_top:new s.c1(C,l.u_coords_top),u_coords_bottom:new s.c1(C,l.u_coords_bottom)}),symbolIcon:(C,l)=>({u_is_size_zoom_constant:new s.b_(C,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(C,l.u_is_size_feature_constant),u_size_t:new s.bq(C,l.u_size_t),u_size:new s.bq(C,l.u_size),u_camera_to_center_distance:new s.bq(C,l.u_camera_to_center_distance),u_pitch:new s.bq(C,l.u_pitch),u_rotate_symbol:new s.b_(C,l.u_rotate_symbol),u_aspect_ratio:new s.bq(C,l.u_aspect_ratio),u_fade_change:new s.bq(C,l.u_fade_change),u_label_plane_matrix:new s.c0(C,l.u_label_plane_matrix),u_coord_matrix:new s.c0(C,l.u_coord_matrix),u_is_text:new s.b_(C,l.u_is_text),u_pitch_with_map:new s.b_(C,l.u_pitch_with_map),u_is_along_line:new s.b_(C,l.u_is_along_line),u_is_variable_anchor:new s.b_(C,l.u_is_variable_anchor),u_texsize:new s.c3(C,l.u_texsize),u_texture:new s.b_(C,l.u_texture),u_translation:new s.c3(C,l.u_translation),u_pitched_scale:new s.bq(C,l.u_pitched_scale)}),symbolSDF:(C,l)=>({u_is_size_zoom_constant:new s.b_(C,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(C,l.u_is_size_feature_constant),u_size_t:new s.bq(C,l.u_size_t),u_size:new s.bq(C,l.u_size),u_camera_to_center_distance:new s.bq(C,l.u_camera_to_center_distance),u_pitch:new s.bq(C,l.u_pitch),u_rotate_symbol:new s.b_(C,l.u_rotate_symbol),u_aspect_ratio:new s.bq(C,l.u_aspect_ratio),u_fade_change:new s.bq(C,l.u_fade_change),u_label_plane_matrix:new s.c0(C,l.u_label_plane_matrix),u_coord_matrix:new s.c0(C,l.u_coord_matrix),u_is_text:new s.b_(C,l.u_is_text),u_pitch_with_map:new s.b_(C,l.u_pitch_with_map),u_is_along_line:new s.b_(C,l.u_is_along_line),u_is_variable_anchor:new s.b_(C,l.u_is_variable_anchor),u_texsize:new s.c3(C,l.u_texsize),u_texture:new s.b_(C,l.u_texture),u_gamma_scale:new s.bq(C,l.u_gamma_scale),u_device_pixel_ratio:new s.bq(C,l.u_device_pixel_ratio),u_is_halo:new s.b_(C,l.u_is_halo),u_translation:new s.c3(C,l.u_translation),u_pitched_scale:new s.bq(C,l.u_pitched_scale)}),symbolTextAndIcon:(C,l)=>({u_is_size_zoom_constant:new s.b_(C,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b_(C,l.u_is_size_feature_constant),u_size_t:new s.bq(C,l.u_size_t),u_size:new s.bq(C,l.u_size),u_camera_to_center_distance:new s.bq(C,l.u_camera_to_center_distance),u_pitch:new s.bq(C,l.u_pitch),u_rotate_symbol:new s.b_(C,l.u_rotate_symbol),u_aspect_ratio:new s.bq(C,l.u_aspect_ratio),u_fade_change:new s.bq(C,l.u_fade_change),u_label_plane_matrix:new s.c0(C,l.u_label_plane_matrix),u_coord_matrix:new s.c0(C,l.u_coord_matrix),u_is_text:new s.b_(C,l.u_is_text),u_pitch_with_map:new s.b_(C,l.u_pitch_with_map),u_is_along_line:new s.b_(C,l.u_is_along_line),u_is_variable_anchor:new s.b_(C,l.u_is_variable_anchor),u_texsize:new s.c3(C,l.u_texsize),u_texsize_icon:new s.c3(C,l.u_texsize_icon),u_texture:new s.b_(C,l.u_texture),u_texture_icon:new s.b_(C,l.u_texture_icon),u_gamma_scale:new s.bq(C,l.u_gamma_scale),u_device_pixel_ratio:new s.bq(C,l.u_device_pixel_ratio),u_is_halo:new s.b_(C,l.u_is_halo),u_translation:new s.c3(C,l.u_translation),u_pitched_scale:new s.bq(C,l.u_pitched_scale)}),background:(C,l)=>({u_opacity:new s.bq(C,l.u_opacity),u_color:new s.b$(C,l.u_color)}),backgroundPattern:(C,l)=>({u_opacity:new s.bq(C,l.u_opacity),u_image:new s.b_(C,l.u_image),u_pattern_tl_a:new s.c3(C,l.u_pattern_tl_a),u_pattern_br_a:new s.c3(C,l.u_pattern_br_a),u_pattern_tl_b:new s.c3(C,l.u_pattern_tl_b),u_pattern_br_b:new s.c3(C,l.u_pattern_br_b),u_texsize:new s.c3(C,l.u_texsize),u_mix:new s.bq(C,l.u_mix),u_pattern_size_a:new s.c3(C,l.u_pattern_size_a),u_pattern_size_b:new s.c3(C,l.u_pattern_size_b),u_scale_a:new s.bq(C,l.u_scale_a),u_scale_b:new s.bq(C,l.u_scale_b),u_pixel_coord_upper:new s.c3(C,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.c3(C,l.u_pixel_coord_lower),u_tile_units_to_pixels:new s.bq(C,l.u_tile_units_to_pixels)}),terrain:(C,l)=>({u_texture:new s.b_(C,l.u_texture),u_ele_delta:new s.bq(C,l.u_ele_delta),u_fog_matrix:new s.c0(C,l.u_fog_matrix),u_fog_color:new s.b$(C,l.u_fog_color),u_fog_ground_blend:new s.bq(C,l.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.bq(C,l.u_fog_ground_blend_opacity),u_horizon_color:new s.b$(C,l.u_horizon_color),u_horizon_fog_blend:new s.bq(C,l.u_horizon_fog_blend),u_is_globe_mode:new s.bq(C,l.u_is_globe_mode)}),terrainDepth:(C,l)=>({u_ele_delta:new s.bq(C,l.u_ele_delta)}),terrainCoords:(C,l)=>({u_texture:new s.b_(C,l.u_texture),u_terrain_coords_id:new s.bq(C,l.u_terrain_coords_id),u_ele_delta:new s.bq(C,l.u_ele_delta)}),projectionErrorMeasurement:(C,l)=>({u_input:new s.bq(C,l.u_input),u_output_expected:new s.bq(C,l.u_output_expected)}),atmosphere:(C,l)=>({u_sun_pos:new s.c2(C,l.u_sun_pos),u_atmosphere_blend:new s.bq(C,l.u_atmosphere_blend),u_globe_position:new s.c2(C,l.u_globe_position),u_globe_radius:new s.bq(C,l.u_globe_radius),u_inv_proj_matrix:new s.c0(C,l.u_inv_proj_matrix)}),sky:(C,l)=>({u_sky_color:new s.b$(C,l.u_sky_color),u_horizon_color:new s.b$(C,l.u_horizon_color),u_horizon:new s.c3(C,l.u_horizon),u_horizon_normal:new s.c3(C,l.u_horizon_normal),u_sky_horizon_blend:new s.bq(C,l.u_sky_horizon_blend),u_sky_blend:new s.bq(C,l.u_sky_blend)})};class yl{constructor(l,d,v){this.context=l;const w=l.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Gp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class f_{constructor(l,d,v,w){this.length=d.length,this.attributes=v,this.itemSize=d.bytesPerElement,this.dynamicDraw=w,this.context=l;const E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let v=0;v<this.attributes.length;v++){const w=d.attributes[this.attributes[v].name];w!==void 0&&l.enableVertexAttribArray(w)}}setVertexAttribPointers(l,d,v){for(let w=0;w<this.attributes.length;w++){const E=this.attributes[w],R=d.attributes[E.name];R!==void 0&&l.vertexAttribPointer(R,E.components,l[Gp[E.type]],!1,this.itemSize,E.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Sn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hh extends Sn{getDefault(){return s.bp.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Wh extends Sn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Zh extends Sn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class sf extends Sn{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class tc extends Sn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Oc extends Sn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class La extends Sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class $s extends Sn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class qp extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class Hp extends Sn{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class ic extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class it extends Sn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Z extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class ye extends Sn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class nt extends Sn{getDefault(){return s.bp.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class qt extends Sn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class di extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class Ti extends Sn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class _n extends Sn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class fr extends Sn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Ms extends Sn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class ji extends Sn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ks extends Sn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Ra extends Sn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class la extends Sn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class jo extends Sn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Go extends Sn{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ou extends Sn{getDefault(){return null}set(l){var d;if(l===this.current&&!this.dirty)return;const v=this.gl;wo(v)?v.bindVertexArray(l):(d=v.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class zu extends Sn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class p_ extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class ka extends Sn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class zc extends Sn{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class of extends zc{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Wp extends zc{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class m_ extends zc{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}const g_="Framebuffer is not complete";class Zp{constructor(l,d,v,w,E){this.context=l,this.width=d,this.height=v;const R=l.gl,O=this.framebuffer=R.createFramebuffer();if(this.colorAttachment=new of(l,O),w)this.depthAttachment=E?new m_(l,O):new Wp(l,O);else if(E)throw new Error("Stencil cannot be set without depth");if(R.checkFramebufferStatus(R.FRAMEBUFFER)!==R.FRAMEBUFFER_COMPLETE)throw new Error(g_)}destroy(){const l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){const v=this.depthAttachment.get();v&&l.deleteRenderbuffer(v)}l.deleteFramebuffer(this.framebuffer)}}class Xp{constructor(l){var d,v;if(this.gl=l,this.clearColor=new Hh(this),this.clearDepth=new Wh(this),this.clearStencil=new Zh(this),this.colorMask=new sf(this),this.depthMask=new tc(this),this.stencilMask=new Oc(this),this.stencilFunc=new La(this),this.stencilOp=new $s(this),this.stencilTest=new qp(this),this.depthRange=new Hp(this),this.depthTest=new ic(this),this.depthFunc=new it(this),this.blend=new Z(this),this.blendFunc=new ye(this),this.blendColor=new nt(this),this.blendEquation=new qt(this),this.cullFace=new di(this),this.cullFaceSide=new Ti(this),this.frontFace=new _n(this),this.program=new fr(this),this.activeTexture=new Ms(this),this.viewport=new ji(this),this.bindFramebuffer=new Ks(this),this.bindRenderbuffer=new Ra(this),this.bindTexture=new la(this),this.bindVertexBuffer=new jo(this),this.bindElementBuffer=new Go(this),this.bindVertexArray=new Ou(this),this.pixelStoreUnpack=new zu(this),this.pixelStoreUnpackPremultiplyAlpha=new p_(this),this.pixelStoreUnpackFlipY=new ka(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),wo(l)){this.HALF_FLOAT=l.HALF_FLOAT;const w=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=l.RGBA16F)!==null&&d!==void 0?d:w?.RGBA16F_EXT,this.RGB16F=(v=l.RGB16F)!==null&&v!==void 0?v:w?.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const w=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=w?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new yl(this,l,d)}createVertexBuffer(l,d,v){return new f_(this,l,d,v)}createRenderbuffer(l,d,v){const w=this.gl,E=w.createRenderbuffer();return this.bindRenderbuffer.set(E),w.renderbufferStorage(w.RENDERBUFFER,l,d,v),this.bindRenderbuffer.set(null),E}createFramebuffer(l,d,v,w){return new Zp(this,l,d,v,w)}clear({color:l,depth:d,stencil:v}){const w=this.gl;let E=0;l&&(E|=w.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(E|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),v!==void 0&&(E|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),w.clear(E)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.bR(l.blendFunction,zn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return wo(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var d;return wo(this.gl)?this.gl.deleteVertexArray(l):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}let Bc;function Bu(C,l,d,v,w){const E=C.context,R=C.transform,O=E.gl,$=C.useProgram("collisionBox"),W=[];let K=0,ce=0;for(let ke=0;ke<v.length;ke++){const Ne=v[ke],He=l.getTile(Ne).getBucket(d);if(!He)continue;const ze=w?He.textCollisionBox:He.iconCollisionBox,Ge=He.collisionCircleArray;Ge.length>0&&(W.push({circleArray:Ge,circleOffset:ce,coord:Ne}),K+=Ge.length/4,ce=K),ze&&$.draw(E,O.LINES,Yi.disabled,bn.disabled,C.colorModeForRenderPass(),pn.disabled,Ql(C.transform),C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ne),R.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),d.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,C.transform.zoom,null,null,ze.collisionVertexBuffer)}if(!w||!W.length)return;const oe=C.useProgram("collisionCircle"),ge=new s.ca;ge.resize(4*K),ge._trim();let be=0;for(const ke of W)for(let Ne=0;Ne<ke.circleArray.length/4;Ne++){const He=4*Ne,ze=ke.circleArray[He+0],Ge=ke.circleArray[He+1],Je=ke.circleArray[He+2],je=ke.circleArray[He+3];ge.emplace(be++,ze,Ge,Je,je,0),ge.emplace(be++,ze,Ge,Je,je,1),ge.emplace(be++,ze,Ge,Je,je,2),ge.emplace(be++,ze,Ge,Je,je,3)}(!Bc||Bc.length<2*K)&&(Bc=(function(ke){const Ne=2*ke,He=new s.cc;He.resize(Ne),He._trim();for(let ze=0;ze<Ne;ze++){const Ge=6*ze;He.uint16[Ge+0]=4*ze+0,He.uint16[Ge+1]=4*ze+1,He.uint16[Ge+2]=4*ze+2,He.uint16[Ge+3]=4*ze+2,He.uint16[Ge+4]=4*ze+3,He.uint16[Ge+5]=4*ze+0}return He})(K));const Le=E.createIndexBuffer(Bc,!0),De=E.createVertexBuffer(ge,s.cb.members,!0);for(const ke of W){const Ne=Dc(C.transform);oe.draw(E,O.TRIANGLES,Yi.disabled,bn.disabled,C.colorModeForRenderPass(),pn.disabled,Ne,C.style.map.terrain&&C.style.map.terrain.getTerrainData(ke.coord),null,d.id,De,Le,s.aX.simpleSegment(0,2*ke.circleOffset,ke.circleArray.length,ke.circleArray.length/2),null,C.transform.zoom,null,null,null)}De.destroy(),Le.destroy()}const __=s.ar(new Float32Array(16));function e1(C,l,d,v,w,E){const{horizontalAlign:R,verticalAlign:O}=s.aS(C);return new s.P((-(R-.5)*l/w+v[0])*E,(-(O-.5)*d/w+v[1])*E)}function af(C,l,d,v,w,E){const R=l.tileAnchorPoint.add(new s.P(l.translation[0],l.translation[1]));if(l.pitchWithMap){let O=v.mult(E);d||(O=O.rotate(-w));const $=R.add(O);return bi($.x,$.y,l.pitchedLabelPlaneMatrix,l.getElevation).point}if(d){const O=Qi(l.tileAnchorPoint.x+1,l.tileAnchorPoint.y,l).point.sub(C),$=Math.atan(O.y/O.x)+(O.x<0?Math.PI:0);return C.add(v.rotate($))}return C.add(v)}function t1(C,l,d,v,w,E,R,O,$,W,K,ce){const oe=C.text.placedSymbolArray,ge=C.text.dynamicLayoutVertexArray,be=C.icon.dynamicLayoutVertexArray,Le={};ge.clear();for(let De=0;De<oe.length;De++){const ke=oe.get(De),Ne=ke.hidden||!ke.crossTileID||C.allowVerticalPlacement&&!ke.placedOrientation?null:v[ke.crossTileID];if(Ne){const He=new s.P(ke.anchorX,ke.anchorY),ze={getElevation:ce,width:w.width,height:w.height,pitchedLabelPlaneMatrix:E,pitchWithMap:d,transform:w,tileAnchorPoint:He,translation:W,unwrappedTileID:K},Ge=d?ro(He.x,He.y,ze):Qi(He.x,He.y,ze),Je=Ni(w.cameraToCenterDistance,Ge.signedDistanceFromCamera);let je=s.aA(C.textSizeData,O,ke)*Je/s.aM;d&&(je*=C.tilePixelRatio/R);const{width:at,height:Tt,anchor:vt,textOffset:xt,textBoxScale:wt}=Ne,Qt=e1(vt,at,Tt,xt,wt,je),ti=w.getPitchedTextCorrection(He.x+W[0],He.y+W[1],K),Wt=af(Ge.point,ze,l,Qt,-w.bearingInRadians,ti),si=C.allowVerticalPlacement&&ke.placedOrientation===s.az.vertical?Math.PI/2:0;for(let Xi=0;Xi<ke.numGlyphs;Xi++)s.aG(ge,Wt,si);$&&ke.associatedIconIndex>=0&&(Le[ke.associatedIconIndex]={shiftedAnchor:Wt,angle:si})}else jl(ke.numGlyphs,ge)}if($){be.clear();const De=C.icon.placedSymbolArray;for(let ke=0;ke<De.length;ke++){const Ne=De.get(ke);if(Ne.hidden)jl(Ne.numGlyphs,be);else{const He=Le[ke];if(He)for(let ze=0;ze<Ne.numGlyphs;ze++)s.aG(be,He.shiftedAnchor,He.angle);else jl(Ne.numGlyphs,be)}}C.icon.dynamicLayoutVertexBuffer.updateData(be)}C.text.dynamicLayoutVertexBuffer.updateData(ge)}function h0(C,l,d){return d.iconsInText&&l?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function lf(C,l,d,v,w,E,R,O,$,W,K,ce,oe){const ge=C.context,be=ge.gl,Le=C.transform,De=O==="map",ke=$==="map",Ne=O!=="viewport"&&d.layout.get("symbol-placement")!=="point",He=De&&!ke&&!Ne,ze=!d.layout.get("symbol-sort-key").isConstant();let Ge=!1;const Je=C.getDepthModeForSublayer(0,Yi.ReadOnly),je=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),at=[],Tt=Le.getCircleRadiusCorrection();for(const vt of v){const xt=l.getTile(vt),wt=xt.getBucket(d);if(!wt)continue;const Qt=w?wt.text:wt.icon;if(!Qt||!Qt.segments.get().length||!Qt.hasVisibleVertices)continue;const ti=Qt.programConfigurations.get(d.id),Wt=w||wt.sdfIcons,si=w?wt.textSizeData:wt.iconSizeData,Xi=ke||Le.pitch!==0,kn=C.useProgram(h0(Wt,w,wt),ti),pr=s.ay(si,Le.zoom),Jn=C.style.map.terrain&&C.style.map.terrain.getTerrainData(vt);let br,Qn,Br,xr,Es=[0,0],is=null;if(w)Qn=xt.glyphAtlasTexture,Br=be.LINEAR,br=xt.glyphAtlasTexture.size,wt.iconsInText&&(Es=xt.imageAtlasTexture.size,is=xt.imageAtlasTexture,xr=Xi||C.options.rotating||C.options.zooming||si.kind==="composite"||si.kind==="camera"?be.LINEAR:be.NEAREST);else{const sr=d.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear;Qn=xt.imageAtlasTexture,Br=Wt||C.options.rotating||C.options.zooming||sr||Xi?be.LINEAR:be.NEAREST,br=xt.imageAtlasTexture.size}const Zr=s.aN(xt,1,C.transform.zoom),Vs=Hi(De,C.transform,Zr),jc=s.N();s.aB(jc,Vs);const rc=ut(ke,De,C.transform,Zr),bl=s.aO(Le,xt,E,R),So=Le.getProjectionData({overscaledTileID:vt,applyGlobeMatrix:!oe,applyTerrainMatrix:!0}),Gu=je&&wt.hasTextData(),Af=d.layout.get("icon-text-fit")!=="none"&&Gu&&wt.hasIconData();if(Ne){const sr=C.style.map.terrain?(ms,gs)=>C.style.map.terrain.getElevation(vt,ms,gs):null,er=d.layout.get("text-rotation-alignment")==="map";Zi(wt,C,w,Vs,jc,ke,W,er,vt.toUnwrapped(),Le.width,Le.height,bl,sr)}const qu=w&&je||Af,ha=Ne||qu?__:ke?Vs:C.transform.clipSpaceToPixelsMatrix,xl=Wt&&d.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ba;Ba=Wt?wt.iconsInText?Ia(si.kind,pr,He,ke,Ne,qu,C,ha,rc,bl,br,Es,Tt):Fu(si.kind,pr,He,ke,Ne,qu,C,ha,rc,bl,w,br,0,Tt):Du(si.kind,pr,He,ke,Ne,qu,C,ha,rc,bl,w,br,Tt);const Na={program:kn,buffers:Qt,uniformValues:Ba,projectionData:So,atlasTexture:Qn,atlasTextureIcon:is,atlasInterpolation:Br,atlasInterpolationIcon:xr,isSDF:Wt,hasHalo:xl};if(ze&&wt.canOverlap){Ge=!0;const sr=Qt.segments.get();for(const er of sr)at.push({segments:new s.aX([er]),sortKey:er.sortKey,state:Na,terrainData:Jn})}else at.push({segments:Qt.segments,sortKey:0,state:Na,terrainData:Jn})}Ge&&at.sort(((vt,xt)=>vt.sortKey-xt.sortKey));for(const vt of at){const xt=vt.state;if(ge.activeTexture.set(be.TEXTURE0),xt.atlasTexture.bind(xt.atlasInterpolation,be.CLAMP_TO_EDGE),xt.atlasTextureIcon&&(ge.activeTexture.set(be.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,be.CLAMP_TO_EDGE)),xt.isSDF){const wt=xt.uniformValues;xt.hasHalo&&(wt.u_is_halo=1,Yp(xt.buffers,vt.segments,d,C,xt.program,Je,K,ce,wt,xt.projectionData,vt.terrainData)),wt.u_is_halo=0}Yp(xt.buffers,vt.segments,d,C,xt.program,Je,K,ce,xt.uniformValues,xt.projectionData,vt.terrainData)}}function Yp(C,l,d,v,w,E,R,O,$,W,K){const ce=v.context;w.draw(ce,ce.gl.TRIANGLES,E,R,O,pn.backCCW,$,K,W,d.id,C.layoutVertexBuffer,C.indexBuffer,l,d.paint,v.transform.zoom,C.programConfigurations.get(d.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function d0(C,l,d,v,w){const E=C.context,R=E.gl,O=bn.disabled,$=new zn([R.ONE,R.ONE],s.bp.transparent,[!0,!0,!0,!0]),W=l.getBucket(d);if(!W)return;const K=v.key;let ce=d.heatmapFbos.get(K);ce||(ce=cf(E,l.tileSize,l.tileSize),d.heatmapFbos.set(K,ce)),E.bindFramebuffer.set(ce.framebuffer),E.viewport.set([0,0,l.tileSize,l.tileSize]),E.clear({color:s.bp.transparent});const oe=W.programConfigurations.get(d.id),ge=C.useProgram("heatmap",oe,!w),be=C.transform.getProjectionData({overscaledTileID:l.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Le=C.style.map.terrain.getTerrainData(v);ge.draw(E,R.TRIANGLES,Yi.disabled,O,$,pn.disabled,Fc(l,C.transform.zoom,d.paint.get("heatmap-intensity"),1),Le,be,d.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,d.paint,C.transform.zoom,oe)}function f0(C,l,d,v,w){const E=C.context,R=E.gl,O=C.transform;E.setColorMode(C.colorModeForRenderPass());const $=Kp(E,l),W=d.key,K=l.heatmapFbos.get(W);if(!K)return;E.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,K.colorAttachment.get()),E.activeTexture.set(R.TEXTURE1),$.bind(R.LINEAR,R.CLAMP_TO_EDGE);const ce=O.getProjectionData({overscaledTileID:d,applyTerrainMatrix:w,applyGlobeMatrix:!v});C.useProgram("heatmapTexture").draw(E,R.TRIANGLES,Yi.disabled,bn.disabled,C.colorModeForRenderPass(),pn.disabled,Np(C,l,0,1),null,ce,l.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments,l.paint,O.zoom),K.destroy(),l.heatmapFbos.delete(W)}function cf(C,l,d){var v,w;const E=C.gl,R=E.createTexture();E.bindTexture(E.TEXTURE_2D,R),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR);const O=(v=C.HALF_FLOAT)!==null&&v!==void 0?v:E.UNSIGNED_BYTE,$=(w=C.RGBA16F)!==null&&w!==void 0?w:E.RGBA;E.texImage2D(E.TEXTURE_2D,0,$,l,d,0,E.RGBA,O,null);const W=C.createFramebuffer(l,d,!1,!1);return W.colorAttachment.set(R),W}function Kp(C,l){return l.colorRampTexture||(l.colorRampTexture=new s.T(C,l.colorRamp,C.gl.RGBA)),l.colorRampTexture}function p0(C,l,d,v,w,E,R,O){let $=256;if(w.stepInterpolant){const W=l.getSource().maxzoom,K=R.canonical.z===W?Math.ceil(1<<C.transform.maxZoom-R.canonical.z):1;$=s.an(s.ce(E.maxLineLength/s.a5*1024*K),256,d.maxTextureSize)}return O.gradient=s.cf({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:$,image:O.gradient||void 0,clips:E.lineClipsArray}),O.texture?O.texture.update(O.gradient):O.texture=new s.T(d,O.gradient,v.RGBA),O.version=w.gradientVersion,O.texture}function m0(C,l,d,v,w){C.activeTexture.set(l.TEXTURE0),d.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(w)}function Hr(C,l,d,v,w,E){(w||C.lineAtlas.dirty)&&(l.activeTexture.set(d.TEXTURE0),C.lineAtlas.bind(l)),v.updatePaintBuffers(E)}function Nu(C,l,d,v,w,E,R){const O=E.gradients[w.id];let $=O.texture;w.gradientVersion!==O.version&&($=p0(C,l,d,v,w,E,R,O)),d.activeTexture.set(v.TEXTURE0),$.bind(w.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}function qo(C,l,d,v,w,E,R,O,$){const W=E.gradients[w.id];let K=W.texture;w.gradientVersion!==W.version&&(K=p0(C,l,d,v,w,E,R,W)),d.activeTexture.set(v.TEXTURE0),K.bind(w.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE),d.activeTexture.set(v.TEXTURE1),C.lineAtlas.bind(d),O.updatePaintBuffers($)}function Jp(C,l,d,v,w){if(!d||!v||!v.imageAtlas)return;const E=v.imageAtlas.patternPositions;let R=E[d.to.toString()],O=E[d.from.toString()];if(!R&&O&&(R=O),!O&&R&&(O=R),!R||!O){const $=w.getPaintProperty(l);R=E[$],O=E[$]}R&&O&&C.setConstantPatternPositions(R,O)}function uf(C,l,d,v,w,E,R,O){const $=C.context.gl,W="fill-pattern",K=d.paint.get(W),ce=K&&K.constantOr(1),oe=d.getCrossfadeParameters();let ge,be,Le,De,ke;const Ne=C.transform,He=d.paint.get("fill-translate"),ze=d.paint.get("fill-translate-anchor");R?(be=ce&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ge=$.LINES):(be=ce?"fillPattern":"fill",ge=$.TRIANGLES);const Ge=K.constantOr(null);for(const Je of v){const je=l.getTile(Je);if(ce&&!je.patternsLoaded())continue;const at=je.getBucket(d);if(!at)continue;const Tt=at.programConfigurations.get(d.id),vt=C.useProgram(be,Tt),xt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Je);ce&&(C.context.activeTexture.set($.TEXTURE0),je.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Tt.updatePaintBuffers(oe)),Jp(Tt,W,Ge,je,d);const wt=Ne.getProjectionData({overscaledTileID:Je,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Qt=s.aO(Ne,je,He,ze);if(R){De=at.indexBuffer2,ke=at.segments2;const Wt=[$.drawingBufferWidth,$.drawingBufferHeight];Le=be==="fillOutlinePattern"&&ce?zp(C,oe,je,Wt,Qt):nf(Wt,Qt)}else De=at.indexBuffer,ke=at.segments,Le=ce?Iu(C,oe,je,Qt):{u_fill_translate:Qt};const ti=C.stencilModeForClipping(Je);vt.draw(C.context,ge,w,ti,E,pn.backCCW,Le,xt,wt,d.id,at.layoutVertexBuffer,De,ke,d.paint,C.transform.zoom,Tt)}}function Qp(C,l,d,v,w,E,R,O){const $=C.context,W=$.gl,K="fill-extrusion-pattern",ce=d.paint.get(K),oe=ce.constantOr(1),ge=d.getCrossfadeParameters(),be=d.paint.get("fill-extrusion-opacity"),Le=ce.constantOr(null),De=C.transform;for(const ke of v){const Ne=l.getTile(ke),He=Ne.getBucket(d);if(!He)continue;const ze=C.style.map.terrain&&C.style.map.terrain.getTerrainData(ke),Ge=He.programConfigurations.get(d.id),Je=C.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",Ge);oe&&(C.context.activeTexture.set(W.TEXTURE0),Ne.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Ge.updatePaintBuffers(ge));const je=De.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!O,applyTerrainMatrix:!0});Jp(Ge,K,Le,Ne,d);const at=s.aO(De,Ne,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Tt=d.paint.get("fill-extrusion-vertical-gradient"),vt=oe?vl(C,Tt,be,at,ke,ge,Ne):tf(C,Tt,be,at);Je.draw($,$.gl.TRIANGLES,w,E,R,pn.backCCW,vt,ze,je,d.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,d.paint,C.transform.zoom,Ge,C.style.map.terrain&&He.centroidVertexBuffer)}}function Nc(C,l,d,v,w,E,R,O,$){var W;const K=C.style.projection,ce=C.context,oe=C.transform,ge=ce.gl,be=[`#define NUM_ILLUMINATION_SOURCES ${d.paint.get("hillshade-highlight-color").values.length}`],Le=C.useProgram("hillshade",null,!1,be),De=!C.options.moving;for(const ke of v){const Ne=l.getTile(ke),He=Ne.fbo;if(!He)continue;const ze=K.getMeshFromTileID(ce,ke.canonical,O,!0,"raster"),Ge=(W=C.style.map.terrain)===null||W===void 0?void 0:W.getTerrainData(ke);ce.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,He.colorAttachment.get());const Je=oe.getProjectionData({overscaledTileID:ke,aligned:De,applyGlobeMatrix:!$,applyTerrainMatrix:!0});Le.draw(ce,ge.TRIANGLES,E,w[ke.overscaledZ],R,pn.backCCW,Uh(C,Ne,d),Ge,Je,d.id,ze.vertexBuffer,ze.indexBuffer,ze.segments)}}function hf(C,l,d,v,w,E,R,O,$){var W;const K=C.style.projection,ce=C.context,oe=C.transform,ge=ce.gl,be=C.useProgram("colorRelief"),Le=!C.options.moving;let De=!0,ke=0;for(const Ne of v){const He=l.getTile(Ne),ze=He.dem;if(De){const vt=ge.getParameter(ge.MAX_TEXTURE_SIZE),{elevationTexture:xt,colorTexture:wt}=d.getColorRampTextures(ce,vt,ze.getUnpackVector());ce.activeTexture.set(ge.TEXTURE1),xt.bind(ge.NEAREST,ge.CLAMP_TO_EDGE),ce.activeTexture.set(ge.TEXTURE4),wt.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),De=!1,ke=xt.size[0]}if(!ze||!ze.data)continue;const Ge=ze.stride,Je=ze.getPixels();if(ce.activeTexture.set(ge.TEXTURE0),ce.pixelStoreUnpackPremultiplyAlpha.set(!1),He.demTexture=He.demTexture||C.getTileTexture(Ge),He.demTexture){const vt=He.demTexture;vt.update(Je,{premultiply:!1}),vt.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}else He.demTexture=new s.T(ce,Je,ge.RGBA,{premultiply:!1}),He.demTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const je=K.getMeshFromTileID(ce,Ne.canonical,O,!0,"raster"),at=(W=C.style.map.terrain)===null||W===void 0?void 0:W.getTerrainData(Ne),Tt=oe.getProjectionData({overscaledTileID:Ne,aligned:Le,applyGlobeMatrix:!$,applyTerrainMatrix:!0});be.draw(ce,ge.TRIANGLES,E,w[Ne.overscaledZ],R,pn.backCCW,$p(d,He.dem,ke),at,Tt,d.id,je.vertexBuffer,je.indexBuffer,je.segments)}}const $u=[new s.P(0,0),new s.P(s.a5,0),new s.P(s.a5,s.a5),new s.P(0,s.a5)];function Xh(C,l,d,v,w,E,R,O,$=!1,W=!1){const K=v[v.length-1].overscaledZ,ce=C.context,oe=ce.gl,ge=C.useProgram("raster"),be=C.transform,Le=C.style.projection,De=C.colorModeForRenderPass(),ke=!C.options.moving,Ne=d.paint.get("raster-opacity"),He=d.paint.get("raster-resampling"),ze=d.paint.get("raster-fade-duration"),Ge=!!C.style.map.terrain;for(const Je of v){const je=C.getDepthModeForSublayer(Je.overscaledZ-K,Ne===1?Yi.ReadWrite:Yi.ReadOnly,oe.LESS),at=l.getTile(Je),Tt=He==="nearest"?oe.NEAREST:oe.LINEAR;ce.activeTexture.set(oe.TEXTURE0),at.texture.bind(Tt,oe.CLAMP_TO_EDGE,oe.LINEAR_MIPMAP_NEAREST),ce.activeTexture.set(oe.TEXTURE1);const{parentTile:vt,parentScaleBy:xt,parentTopLeft:wt,fadeValues:Qt}=g0(at,l,ze,Ge);at.fadeOpacity=Qt.tileOpacity,vt?(vt.fadeOpacity=Qt.parentTileOpacity,vt.texture.bind(Tt,oe.CLAMP_TO_EDGE,oe.LINEAR_MIPMAP_NEAREST)):at.texture.bind(Tt,oe.CLAMP_TO_EDGE,oe.LINEAR_MIPMAP_NEAREST),at.texture.useMipmap&&ce.extTextureFilterAnisotropic&&C.transform.pitch>20&&oe.texParameterf(oe.TEXTURE_2D,ce.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ce.extTextureFilterAnisotropicMax);const ti=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Je),Wt=be.getProjectionData({overscaledTileID:Je,aligned:ke,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),si=Pa(wt,xt,Qt.fadeMix,d,O),Xi=Le.getMeshFromTileID(ce,Je.canonical,E,R,"raster");ge.draw(ce,oe.TRIANGLES,je,w?w[Je.overscaledZ]:bn.disabled,De,$?pn.frontCCW:pn.backCCW,si,ti,Wt,d.id,Xi.vertexBuffer,Xi.indexBuffer,Xi.segments)}}function g0(C,l,d,v){const w={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(d===0||v)return w;if(C.fadingParentID){const E=l.getLoadedTile(C.fadingParentID);if(!E)return w;const R=Math.pow(2,E.tileID.overscaledZ-C.tileID.overscaledZ),O=[C.tileID.canonical.x*R%1,C.tileID.canonical.y*R%1],$=(function(W,K,ce){const oe=P(),ge=(oe-K.timeAdded)/ce,be=W.fadingDirection===mt.Incoming,Le=s.an((oe-W.timeAdded)/ce,0,1),De=s.an(1-ge,0,1),ke=be?Le:De;return{tileOpacity:ke,parentTileOpacity:be?De:Le,fadeMix:{opacity:1,mix:1-ke}}})(C,E,d);return{parentTile:E,parentScaleBy:R,parentTopLeft:O,fadeValues:$}}if(C.selfFading){const E=(function(R,O){const $=(P()-R.timeAdded)/O,W=s.an($,0,1);return{tileOpacity:W,fadeMix:{opacity:W,mix:0}}})(C,d);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:E}}return w}const _0=new s.bp(1,0,0,1),v0=new s.bp(0,1,0,1),y0=new s.bp(0,0,1,1),b0=new s.bp(1,0,1,1),$c=new s.bp(0,1,1,1);function v_(C,l,d,v){df(C,0,l+d/2,C.transform.width,d,v)}function y_(C,l,d,v){df(C,l-d/2,0,d,C.transform.height,v)}function df(C,l,d,v,w,E){const R=C.context,O=R.gl;O.enable(O.SCISSOR_TEST),O.scissor(l*C.pixelRatio,d*C.pixelRatio,v*C.pixelRatio,w*C.pixelRatio),R.clear({color:E}),O.disable(O.SCISSOR_TEST)}function x0(C,l,d){const v=C.context,w=v.gl,E=C.useProgram("debug"),R=Yi.disabled,O=bn.disabled,$=C.colorModeForRenderPass(),W="$debug",K=C.style.map.terrain&&C.style.map.terrain.getTerrainData(d);v.activeTexture.set(w.TEXTURE0);const ce=l.getTileByID(d.key).latestRawTileData,oe=Math.floor((ce&&ce.byteLength||0)/1024),ge=l.getTile(d).tileSize,be=512/Math.min(ge,512)*(d.overscaledZ/C.transform.zoom)*.5;let Le=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Le+=` => ${d.overscaledZ}`),(function(ke,Ne){ke.initDebugOverlayCanvas();const He=ke.debugOverlayCanvas,ze=ke.context.gl,Ge=ke.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,He.width,He.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(Ne,5,5),Ge.strokeText(Ne,5,5),ke.debugOverlayTexture.update(He),ke.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)})(C,`${Le} ${oe}kB`);const De=C.transform.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!0,applyTerrainMatrix:!0});E.draw(v,w.TRIANGLES,R,O,zn.alphaBlended,pn.disabled,Aa(s.bp.transparent,be),null,De,W,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments),E.draw(v,w.LINE_STRIP,R,O,$,pn.disabled,Aa(s.bp.red),K,De,W,C.debugBuffer,C.tileBorderIndexBuffer,C.debugSegments)}function b_(C,l,d,v){const{isRenderingGlobe:w}=v,E=C.context,R=E.gl,O=C.transform,$=C.colorModeForRenderPass(),W=C.getDepthModeFor3D(),K=C.useProgram("terrain");E.bindFramebuffer.set(null),E.viewport.set([0,0,C.width,C.height]);for(const ce of d){const oe=l.getTerrainMesh(ce.tileID),ge=C.renderToTexture.getTexture(ce),be=l.getTerrainData(ce.tileID);E.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,ge.texture);const Le=l.getMeshFrameDelta(O.zoom),De=O.calculateFogMatrix(ce.tileID.toUnwrapped()),ke=u_(Le,De,C.style.sky,O.pitch,w),Ne=O.getProjectionData({overscaledTileID:ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(E,R.TRIANGLES,W,bn.disabled,$,pn.backCCW,ke,be,Ne,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments)}}function x_(C,l){if(!l.mesh){const d=new s.aW;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(1,1),d.emplaceBack(-1,1);const v=new s.aY;v.emplaceBack(0,1,2),v.emplaceBack(0,2,3),l.mesh=new On(C.createVertexBuffer(d,wa.members),C.createIndexBuffer(v),s.aX.simpleSegment(0,0,d.length,v.length))}return l.mesh}class w0{constructor(l,d){this.context=new Xp(l),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ii.maxOverzooming+Ii.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bs}resize(l,d,v){if(this.width=Math.floor(l*v),this.height=Math.floor(d*v),this.pixelRatio=v,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style._order)this.style._layers[w].resize()}setup(){const l=this.context,d=new s.aW;d.emplaceBack(0,0),d.emplaceBack(s.a5,0),d.emplaceBack(0,s.a5),d.emplaceBack(s.a5,s.a5),this.tileExtentBuffer=l.createVertexBuffer(d,wa.members),this.tileExtentSegments=s.aX.simpleSegment(0,0,4,2);const v=new s.aW;v.emplaceBack(0,0),v.emplaceBack(s.a5,0),v.emplaceBack(0,s.a5),v.emplaceBack(s.a5,s.a5),this.debugBuffer=l.createVertexBuffer(v,wa.members),this.debugSegments=s.aX.simpleSegment(0,0,4,5);const w=new s.ch;w.emplaceBack(0,0,0,0),w.emplaceBack(s.a5,0,s.a5,0),w.emplaceBack(0,s.a5,0,s.a5),w.emplaceBack(s.a5,s.a5,s.a5,s.a5),this.rasterBoundsBuffer=l.createVertexBuffer(w,c_.members),this.rasterBoundsSegments=s.aX.simpleSegment(0,0,4,2);const E=new s.aW;E.emplaceBack(0,0),E.emplaceBack(s.a5,0),E.emplaceBack(0,s.a5),E.emplaceBack(s.a5,s.a5),this.rasterBoundsBufferPosOnly=l.createVertexBuffer(E,wa.members),this.rasterBoundsSegmentsPosOnly=s.aX.simpleSegment(0,0,4,5);const R=new s.aW;R.emplaceBack(0,0),R.emplaceBack(1,0),R.emplaceBack(0,1),R.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(R,wa.members),this.viewportSegments=s.aX.simpleSegment(0,0,4,2);const O=new s.ci;O.emplaceBack(0),O.emplaceBack(1),O.emplaceBack(3),O.emplaceBack(2),O.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(O);const $=new s.aY;$.emplaceBack(1,0,2),$.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=l.createIndexBuffer($);const W=this.context.gl;this.stencilClearMode=new bn({func:W.ALWAYS,mask:0},0,255,W.ZERO,W.ZERO,W.ZERO),this.tileExtentMesh=new On(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const v=s.N();s.c7(v,0,this.width,this.height,0,0,1),s.Q(v,v,[d.drawingBufferWidth,d.drawingBufferHeight,0]);const w={mainMatrix:v,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:v};this.useProgram("clippingMask",null,!0).draw(l,d.TRIANGLES,Yi.disabled,this.stencilClearMode,zn.disabled,pn.disabled,null,null,w,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,d,v){if(this.currentStencilSource===l.source||!l.isTileClipped()||!d||!d.length)return;this.currentStencilSource=l.source,this.nextStencilID+d.length>256&&this.clearStencil();const w=this.context;w.setColorMode(zn.disabled),w.setDepthMode(Yi.disabled);const E={};for(const R of d)E[R.key]=this.nextStencilID++;this._renderTileMasks(E,d,v,!0),this._renderTileMasks(E,d,v,!1),this._tileClippingMaskIDs=E}_renderTileMasks(l,d,v,w){const E=this.context,R=E.gl,O=this.style.projection,$=this.transform,W=this.useProgram("clippingMask");for(const K of d){const ce=l[K.key],oe=this.style.map.terrain&&this.style.map.terrain.getTerrainData(K),ge=O.getMeshFromTileID(this.context,K.canonical,w,!0,"stencil"),be=$.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!v,applyTerrainMatrix:!0});W.draw(E,R.TRIANGLES,Yi.disabled,new bn({func:R.ALWAYS,mask:0},ce,255,R.KEEP,R.KEEP,R.REPLACE),zn.disabled,v?pn.disabled:pn.backCCW,null,oe,be,"$clipping",ge.vertexBuffer,ge.indexBuffer,ge.segments)}}_renderTilesDepthBuffer(){const l=this.context,d=l.gl,v=this.style.projection,w=this.transform,E=this.useProgram("depth"),R=this.getDepthModeFor3D(),O=Vn(w,{tileSize:w.tileSize});for(const $ of O){const W=this.style.map.terrain&&this.style.map.terrain.getTerrainData($),K=v.getMeshFromTileID(this.context,$.canonical,!0,!0,"raster"),ce=w.getProjectionData({overscaledTileID:$,applyGlobeMatrix:!0,applyTerrainMatrix:!0});E.draw(l,d.TRIANGLES,R,bn.disabled,zn.disabled,pn.backCCW,null,W,ce,"$clipping",K.vertexBuffer,K.indexBuffer,K.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new bn({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){const d=this.context.gl;return new bn({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(l){const d=this.context.gl,v=l.sort(((R,O)=>O.overscaledZ-R.overscaledZ)),w=v[v.length-1].overscaledZ,E=v[0].overscaledZ-w+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const R={};for(let O=0;O<E;O++)R[O+w]=new bn({func:d.GEQUAL,mask:255},O+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[R,v]}return[{[w]:bn.disabled},v]}stencilConfigForOverlapTwoPass(l){const d=this.context.gl,v=l.sort(((R,O)=>O.overscaledZ-R.overscaledZ)),w=v[v.length-1].overscaledZ,E=v[0].overscaledZ-w+1;if(this.clearStencil(),E>1){const R={},O={};for(let $=0;$<E;$++)R[$+w]=new bn({func:d.GREATER,mask:255},E+1+$,255,d.KEEP,d.KEEP,d.REPLACE),O[$+w]=new bn({func:d.GREATER,mask:255},1+$,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID=2*E+1,[R,O,v]}return this.nextStencilID=3,[{[w]:new bn({func:d.GREATER,mask:255},2,255,d.KEEP,d.KEEP,d.REPLACE)},{[w]:new bn({func:d.GREATER,mask:255},1,255,d.KEEP,d.KEEP,d.REPLACE)},v]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new zn([l.CONSTANT_COLOR,l.ONE],new s.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zn.unblended:zn.alphaBlended}getDepthModeForSublayer(l,d,v){if(!this.opaquePassEnabledForLayer())return Yi.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Yi(v||this.context.gl.LEQUAL,d,[w,w])}getDepthModeFor3D(){return new Yi(this.context.gl.LEQUAL,Yi.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){var v,w;this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(P()),this.imageManager.beginFrame();const E=this.style._order,R=this.style.tileManagers,O={},$={},W={},K={isRenderingToTexture:!1,isRenderingGlobe:((v=l.projection)===null||v===void 0?void 0:v.transitionState)>0};for(const oe in R){const ge=R[oe];ge.used&&ge.prepare(this.context),O[oe]=ge.getVisibleCoordinates(!1),$[oe]=O[oe].slice().reverse(),W[oe]=ge.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let oe=0;oe<E.length;oe++)if(this.style._layers[E[oe]].is3D()){this.opaquePassCutoff=oe;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const oe of E){const ge=this.style._layers[oe];if(!ge.hasOffscreenPass()||ge.isHidden(this.transform.zoom))continue;const be=$[ge.source];(ge.type==="custom"||be.length)&&this.renderLayer(this,R[ge.source],ge,be,K)}if((w=this.style.projection)===null||w===void 0||w.updateGPUdependent({context:this.context,useProgram:oe=>this.useProgram(oe)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.bp.black:s.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(oe,ge){const be=oe.context,Le=be.gl,De=((Je,je,at)=>{const Tt=Math.cos(je.rollInRadians),vt=Math.sin(je.rollInRadians),xt=vn(je),wt=je.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Je.properties.get("sky-color"),u_horizon_color:Je.properties.get("horizon-color"),u_horizon:[(je.width/2-xt*vt)*at,(je.height/2+xt*Tt)*at],u_horizon_normal:[-vt,Tt],u_sky_horizon_blend:Je.properties.get("sky-horizon-blend")*je.height/2*at,u_sky_blend:wt}})(ge,oe.style.map.transform,oe.pixelRatio),ke=new Yi(Le.LEQUAL,Yi.ReadWrite,[0,1]),Ne=bn.disabled,He=oe.colorModeForRenderPass(),ze=oe.useProgram("sky"),Ge=x_(be,ge);ze.draw(be,Le.TRIANGLES,ke,Ne,He,pn.disabled,De,null,void 0,"sky",Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)})(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const oe=this.style._layers[E[this.currentLayer]],ge=R[oe.source],be=O[oe.source];this._renderTileClippingMasks(oe,be,!1),this.renderLayer(this,ge,oe,be,K)}this.renderPass="translucent";let ce=!1;for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const oe=this.style._layers[E[this.currentLayer]],ge=R[oe.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(oe,K))continue;this.opaquePassEnabledForLayer()||ce||(ce=!0,K.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const be=(oe.type==="symbol"?W:$)[oe.source];this._renderTileClippingMasks(oe,O[oe.source],!!this.renderToTexture),this.renderLayer(this,ge,oe,be,K)}if(K.isRenderingGlobe&&(function(oe,ge,be){const Le=oe.context,De=Le.gl,ke=oe.useProgram("atmosphere"),Ne=new Yi(De.LEQUAL,Yi.ReadOnly,[0,1]),He=oe.transform,ze=(function(wt,Qt){const ti=wt.properties.get("position"),Wt=[-ti.x,-ti.y,-ti.z],si=s.ar(new Float64Array(16));return wt.properties.get("anchor")==="map"&&(s.bg(si,si,Qt.rollInRadians),s.bh(si,si,-Qt.pitchInRadians),s.bg(si,si,Qt.bearingInRadians),s.bh(si,si,Qt.center.lat*Math.PI/180),s.bJ(si,si,-Qt.center.lng*Math.PI/180)),s.cg(Wt,Wt,si),Wt})(be,oe.transform),Ge=He.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Je=ge.properties.get("atmosphere-blend")*Ge.projectionTransition;if(Je===0)return;const je=Yl(He.worldSize,He.center.lat),at=He.inverseProjectionMatrix,Tt=new Float64Array(4);Tt[3]=1,s.aH(Tt,Tt,He.modelViewProjectionMatrix),Tt[0]/=Tt[3],Tt[1]/=Tt[3],Tt[2]/=Tt[3],Tt[3]=1,s.aH(Tt,Tt,at),Tt[0]/=Tt[3],Tt[1]/=Tt[3],Tt[2]/=Tt[3],Tt[3]=1;const vt=((wt,Qt,ti,Wt,si)=>({u_sun_pos:wt,u_atmosphere_blend:Qt,u_globe_position:ti,u_globe_radius:Wt,u_inv_proj_matrix:si}))(ze,Je,[Tt[0],Tt[1],Tt[2]],je,at),xt=x_(Le,ge);ke.draw(Le,De.TRIANGLES,Ne,bn.disabled,zn.alphaBlended,pn.disabled,vt,null,null,"atmosphere",xt.vertexBuffer,xt.indexBuffer,xt.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const oe=(function(ge,be){let Le=null;const De=Object.values(ge._layers).flatMap((ze=>ze.source&&!ze.isHidden(be)?[ge.tileManagers[ze.source]]:[])),ke=De.filter((ze=>ze.getSource().type==="vector")),Ne=De.filter((ze=>ze.getSource().type!=="vector")),He=ze=>{(!Le||Le.getSource().maxzoom<ze.getSource().maxzoom)&&(Le=ze)};return ke.forEach((ze=>He(ze))),Le||Ne.forEach((ze=>He(ze))),Le})(this.style,this.transform.zoom);oe&&(function(ge,be,Le){for(let De=0;De<Le.length;De++)x0(ge,be,Le[De])})(this,oe,oe.getVisibleCoordinates())}this.options.showPadding&&(function(oe){const ge=oe.transform.padding;v_(oe,oe.transform.height-(ge.top||0),3,_0),v_(oe,ge.bottom||0,3,v0),y_(oe,ge.left||0,3,y0),y_(oe,oe.transform.width-(ge.right||0),3,b0);const be=oe.transform.centerPoint;(function(Le,De,ke,Ne){df(Le,De-1,ke-10,2,20,Ne),df(Le,De-10,ke-1,20,2,Ne)})(oe,be.x,oe.transform.height-be.y,$c)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,v=this.transform.modelViewProjectionMatrix;let w=this.terrainFacilitator.dirty;w||(w=l?!s.cj(d,v):!s.ck(d,v)),w||(w=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),w&&(s.cl(d,v),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(E,R){const O=E.context,$=O.gl,W=E.transform,K=zn.unblended,ce=new Yi($.LEQUAL,Yi.ReadWrite,[0,1]),oe=R.tileManager.getRenderableTiles(),ge=E.useProgram("terrainDepth");O.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),O.clear({color:s.bp.transparent,depth:1});for(const be of oe){const Le=R.getTerrainMesh(be.tileID),De=R.getTerrainData(be.tileID),ke=W.getProjectionData({overscaledTileID:be.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ne={u_ele_delta:R.getMeshFrameDelta(W.zoom)};ge.draw(O,$.TRIANGLES,ce,bn.disabled,K,pn.backCCW,Ne,De,ke,"terrain",Le.vertexBuffer,Le.indexBuffer,Le.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,E.width,E.height])})(this,this.style.map.terrain),(function(E,R){const O=E.context,$=O.gl,W=E.transform,K=zn.unblended,ce=new Yi($.LEQUAL,Yi.ReadWrite,[0,1]),oe=R.getCoordsTexture(),ge=R.tileManager.getRenderableTiles(),be=E.useProgram("terrainCoords");O.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),O.clear({color:s.bp.transparent,depth:1}),R.coordsIndex=[];for(const Le of ge){const De=R.getTerrainMesh(Le.tileID),ke=R.getTerrainData(Le.tileID);O.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,oe.texture);const Ne={u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(W.zoom)},He=W.getProjectionData({overscaledTileID:Le.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});be.draw(O,$.TRIANGLES,ce,bn.disabled,K,pn.backCCW,Ne,ke,He,"terrain",De.vertexBuffer,De.indexBuffer,De.segments),R.coordsIndex.push(Le.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,E.width,E.height])})(this,this.style.map.terrain))}renderLayer(l,d,v,w,E){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="custom"||(w||[]).length)&&(this.id=v.id,s.cm(v)?(function(R,O,$,W,K,ce){if(R.renderPass!=="translucent")return;const{isRenderingToTexture:oe}=ce,ge=bn.disabled,be=R.colorModeForRenderPass();($._unevaluatedLayout.hasValue("text-variable-anchor")||$._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Le,De,ke,Ne,He,ze,Ge,Je,je){const at=De.transform,Tt=De.style.map.terrain,vt=He==="map",xt=ze==="map";for(const wt of Le){const Qt=Ne.getTile(wt),ti=Qt.getBucket(ke);if(!ti||!ti.text||!ti.text.segments.get().length)continue;const Wt=s.ay(ti.textSizeData,at.zoom),si=s.aN(Qt,1,De.transform.zoom),Xi=Hi(vt,De.transform,si),kn=ke.layout.get("icon-text-fit")!=="none"&&ti.hasIconData();if(Wt){const pr=Math.pow(2,at.zoom-Qt.tileID.overscaledZ),Jn=Tt?(br,Qn)=>Tt.getElevation(wt,br,Qn):null;t1(ti,vt,xt,je,at,Xi,pr,Wt,kn,s.aO(at,Qt,Ge,Je),wt.toUnwrapped(),Jn)}}})(W,R,$,O,$.layout.get("text-rotation-alignment"),$.layout.get("text-pitch-alignment"),$.paint.get("text-translate"),$.paint.get("text-translate-anchor"),K),$.paint.get("icon-opacity").constantOr(1)!==0&&lf(R,O,$,W,!1,$.paint.get("icon-translate"),$.paint.get("icon-translate-anchor"),$.layout.get("icon-rotation-alignment"),$.layout.get("icon-pitch-alignment"),$.layout.get("icon-keep-upright"),ge,be,oe),$.paint.get("text-opacity").constantOr(1)!==0&&lf(R,O,$,W,!0,$.paint.get("text-translate"),$.paint.get("text-translate-anchor"),$.layout.get("text-rotation-alignment"),$.layout.get("text-pitch-alignment"),$.layout.get("text-keep-upright"),ge,be,oe),O.map.showCollisionBoxes&&(Bu(R,O,$,W,!0),Bu(R,O,$,W,!1))})(l,d,v,w,this.style.placement.variableOffsets,E):s.cn(v)?(function(R,O,$,W,K){if(R.renderPass!=="translucent")return;const{isRenderingToTexture:ce}=K,oe=$.paint.get("circle-opacity"),ge=$.paint.get("circle-stroke-width"),be=$.paint.get("circle-stroke-opacity"),Le=!$.layout.get("circle-sort-key").isConstant();if(oe.constantOr(1)===0&&(ge.constantOr(1)===0||be.constantOr(1)===0))return;const De=R.context,ke=De.gl,Ne=R.transform,He=R.getDepthModeForSublayer(0,Yi.ReadOnly),ze=bn.disabled,Ge=R.colorModeForRenderPass(),Je=[],je=Ne.getCircleRadiusCorrection();for(let at=0;at<W.length;at++){const Tt=W[at],vt=O.getTile(Tt),xt=vt.getBucket($);if(!xt)continue;const wt=$.paint.get("circle-translate"),Qt=$.paint.get("circle-translate-anchor"),ti=s.aO(Ne,vt,wt,Qt),Wt=xt.programConfigurations.get($.id),si=R.useProgram("circle",Wt),Xi=xt.layoutVertexBuffer,kn=xt.indexBuffer,pr=R.style.map.terrain&&R.style.map.terrain.getTerrainData(Tt),Jn={programConfiguration:Wt,program:si,layoutVertexBuffer:Xi,indexBuffer:kn,uniformValues:Bp(R,vt,$,ti,je),terrainData:pr,projectionData:Ne.getProjectionData({overscaledTileID:Tt,applyGlobeMatrix:!ce,applyTerrainMatrix:!0})};if(Le){const br=xt.segments.get();for(const Qn of br)Je.push({segments:new s.aX([Qn]),sortKey:Qn.sortKey,state:Jn})}else Je.push({segments:xt.segments,sortKey:0,state:Jn})}Le&&Je.sort(((at,Tt)=>at.sortKey-Tt.sortKey));for(const at of Je){const{programConfiguration:Tt,program:vt,layoutVertexBuffer:xt,indexBuffer:wt,uniformValues:Qt,terrainData:ti,projectionData:Wt}=at.state;vt.draw(De,ke.TRIANGLES,He,ze,Ge,pn.backCCW,Qt,ti,Wt,$.id,xt,wt,at.segments,$.paint,R.transform.zoom,Tt)}})(l,d,v,w,E):s.co(v)?(function(R,O,$,W,K){if($.paint.get("heatmap-opacity")===0)return;const ce=R.context,{isRenderingToTexture:oe,isRenderingGlobe:ge}=K;if(R.style.map.terrain){for(const be of W){const Le=O.getTile(be);O.hasRenderableParent(be)||(R.renderPass==="offscreen"?d0(R,Le,$,be,ge):R.renderPass==="translucent"&&f0(R,$,be,oe,ge))}ce.viewport.set([0,0,R.width,R.height])}else R.renderPass==="offscreen"?(function(be,Le,De,ke){const Ne=be.context,He=Ne.gl,ze=be.transform,Ge=bn.disabled,Je=new zn([He.ONE,He.ONE],s.bp.transparent,[!0,!0,!0,!0]);(function(je,at,Tt){const vt=je.gl;je.activeTexture.set(vt.TEXTURE1),je.viewport.set([0,0,at.width/4,at.height/4]);let xt=Tt.heatmapFbos.get(s.cd);xt?(vt.bindTexture(vt.TEXTURE_2D,xt.colorAttachment.get()),je.bindFramebuffer.set(xt.framebuffer)):(xt=cf(je,at.width/4,at.height/4),Tt.heatmapFbos.set(s.cd,xt))})(Ne,be,De),Ne.clear({color:s.bp.transparent});for(let je=0;je<ke.length;je++){const at=ke[je];if(Le.hasRenderableParent(at))continue;const Tt=Le.getTile(at),vt=Tt.getBucket(De);if(!vt)continue;const xt=vt.programConfigurations.get(De.id),wt=be.useProgram("heatmap",xt),Qt=ze.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ti=ze.getCircleRadiusCorrection();wt.draw(Ne,He.TRIANGLES,Yi.disabled,Ge,Je,pn.backCCW,Fc(Tt,ze.zoom,De.paint.get("heatmap-intensity"),ti),null,Qt,De.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,De.paint,ze.zoom,xt)}Ne.viewport.set([0,0,be.width,be.height])})(R,O,$,W):R.renderPass==="translucent"&&(function(be,Le){const De=be.context,ke=De.gl;De.setColorMode(be.colorModeForRenderPass());const Ne=Le.heatmapFbos.get(s.cd);Ne&&(De.activeTexture.set(ke.TEXTURE0),ke.bindTexture(ke.TEXTURE_2D,Ne.colorAttachment.get()),De.activeTexture.set(ke.TEXTURE1),Kp(De,Le).bind(ke.LINEAR,ke.CLAMP_TO_EDGE),be.useProgram("heatmapTexture").draw(De,ke.TRIANGLES,Yi.disabled,bn.disabled,be.colorModeForRenderPass(),pn.disabled,Np(be,Le,0,1),null,null,Le.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments,Le.paint,be.transform.zoom))})(R,$)})(l,d,v,w,E):s.cp(v)?(function(R,O,$,W,K){if(R.renderPass!=="translucent")return;const{isRenderingToTexture:ce}=K,oe=$.paint.get("line-opacity"),ge=$.paint.get("line-width");if(oe.constantOr(1)===0||ge.constantOr(1)===0)return;const be=R.getDepthModeForSublayer(0,Yi.ReadOnly),Le=R.colorModeForRenderPass(),De=$.paint.get("line-dasharray"),ke=De.constantOr(1),Ne=$.paint.get("line-pattern"),He=Ne.constantOr(1),ze=$.paint.get("line-gradient"),Ge=$.getCrossfadeParameters();let Je;Je=He?"linePattern":ke&&ze?"lineGradientSDF":ke?"lineSDF":ze?"lineGradient":"line";const je=R.context,at=je.gl,Tt=R.transform;let vt=!0;for(const xt of W){const wt=O.getTile(xt);if(He&&!wt.patternsLoaded())continue;const Qt=wt.getBucket($);if(!Qt)continue;const ti=Qt.programConfigurations.get($.id),Wt=R.context.program.get(),si=R.useProgram(Je,ti),Xi=vt||si.program!==Wt,kn=R.style.map.terrain&&R.style.map.terrain.getTerrainData(xt),pr=Ne.constantOr(null),Jn=De&&De.constantOr(null);if(pr&&wt.imageAtlas){const Es=wt.imageAtlas,is=Es.patternPositions[pr.to.toString()],Zr=Es.patternPositions[pr.from.toString()];is&&Zr&&ti.setConstantPatternPositions(is,Zr)}else if(Jn){const Es=$.layout.get("line-cap")==="round",is=R.lineAtlas.getDash(Jn.to,Es),Zr=R.lineAtlas.getDash(Jn.from,Es);ti.setConstantDashPositions(is,Zr)}const br=Tt.getProjectionData({overscaledTileID:xt,applyGlobeMatrix:!ce,applyTerrainMatrix:!0}),Qn=Tt.getPixelScale();let Br;He?(Br=jh(R,wt,$,Qn,Ge),m0(je,at,wt,ti,Ge)):ke&&ze?(Br=Ru(R,wt,$,Qn,Ge,Qt.lineClipsArray.length),qo(R,O,je,at,$,Qt,xt,ti,Ge)):ke?(Br=Up(R,wt,$,Qn,Ge),Hr(R,je,at,ti,Xi,Ge)):ze?(Br=Vp(R,wt,$,Qn,Qt.lineClipsArray.length),Nu(R,O,je,at,$,Qt,xt)):Br=Lu(R,wt,$,Qn);const xr=R.stencilModeForClipping(xt);si.draw(je,at.TRIANGLES,be,xr,Le,pn.disabled,Br,kn,br,$.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Qt.segments,$.paint,R.transform.zoom,ti,Qt.layoutVertexBuffer2),vt=!1}})(l,d,v,w,E):s.cq(v)?(function(R,O,$,W,K){const ce=$.paint.get("fill-color"),oe=$.paint.get("fill-opacity");if(oe.constantOr(1)===0)return;const{isRenderingToTexture:ge}=K,be=R.colorModeForRenderPass(),Le=$.paint.get("fill-pattern"),De=R.opaquePassEnabledForLayer()&&!Le.constantOr(1)&&ce.constantOr(s.bp.transparent).a===1&&oe.constantOr(0)===1?"opaque":"translucent";if(R.renderPass===De){const ke=R.getDepthModeForSublayer(1,R.renderPass==="opaque"?Yi.ReadWrite:Yi.ReadOnly);uf(R,O,$,W,ke,be,!1,ge)}if(R.renderPass==="translucent"&&$.paint.get("fill-antialias")){const ke=R.getDepthModeForSublayer($.getPaintProperty("fill-outline-color")?2:0,Yi.ReadOnly);uf(R,O,$,W,ke,be,!0,ge)}})(l,d,v,w,E):s.cr(v)?(function(R,O,$,W,K){const ce=$.paint.get("fill-extrusion-opacity");if(ce===0)return;const{isRenderingToTexture:oe}=K;if(R.renderPass==="translucent"){const ge=new Yi(R.context.gl.LEQUAL,Yi.ReadWrite,R.depthRangeFor3D);if(ce!==1||$.paint.get("fill-extrusion-pattern").constantOr(1))Qp(R,O,$,W,ge,bn.disabled,zn.disabled,oe),Qp(R,O,$,W,ge,R.stencilModeFor3D(),R.colorModeForRenderPass(),oe);else{const be=R.colorModeForRenderPass();Qp(R,O,$,W,ge,bn.disabled,be,oe)}}})(l,d,v,w,E):s.cs(v)?(function(R,O,$,W,K){if(R.renderPass!=="offscreen"&&R.renderPass!=="translucent")return;const{isRenderingToTexture:ce}=K,oe=R.context,ge=R.style.projection.useSubdivision,be=R.getDepthModeForSublayer(0,Yi.ReadOnly),Le=R.colorModeForRenderPass();if(R.renderPass==="offscreen")(function(De,ke,Ne,He,ze,Ge,Je){const je=De.context,at=je.gl;for(const Tt of Ne){const vt=ke.getTile(Tt),xt=vt.dem;if(!xt||!xt.data||!vt.needsHillshadePrepare)continue;const wt=xt.dim,Qt=xt.stride,ti=xt.getPixels();if(je.activeTexture.set(at.TEXTURE1),je.pixelStoreUnpackPremultiplyAlpha.set(!1),vt.demTexture=vt.demTexture||De.getTileTexture(Qt),vt.demTexture){const si=vt.demTexture;si.update(ti,{premultiply:!1}),si.bind(at.NEAREST,at.CLAMP_TO_EDGE)}else vt.demTexture=new s.T(je,ti,at.RGBA,{premultiply:!1}),vt.demTexture.bind(at.NEAREST,at.CLAMP_TO_EDGE);je.activeTexture.set(at.TEXTURE0);let Wt=vt.fbo;if(!Wt){const si=new s.T(je,{width:wt,height:wt,data:null},at.RGBA);si.bind(at.LINEAR,at.CLAMP_TO_EDGE),Wt=vt.fbo=je.createFramebuffer(wt,wt,!0,!1),Wt.colorAttachment.set(si.texture)}je.bindFramebuffer.set(Wt.framebuffer),je.viewport.set([0,0,wt,wt]),De.useProgram("hillshadePrepare").draw(je,at.TRIANGLES,ze,Ge,Je,pn.disabled,h_(vt.tileID,xt),null,null,He.id,De.rasterBoundsBuffer,De.quadTriangleIndexBuffer,De.rasterBoundsSegments),vt.needsHillshadePrepare=!1}})(R,O,W,$,be,bn.disabled,Le),oe.viewport.set([0,0,R.width,R.height]);else if(R.renderPass==="translucent")if(ge){const[De,ke,Ne]=R.stencilConfigForOverlapTwoPass(W);Nc(R,O,$,Ne,De,be,Le,!1,ce),Nc(R,O,$,Ne,ke,be,Le,!0,ce)}else{const[De,ke]=R.getStencilConfigForOverlapAndUpdateStencilID(W);Nc(R,O,$,ke,De,be,Le,!1,ce)}})(l,d,v,w,E):s.ct(v)?(function(R,O,$,W,K){if(R.renderPass!=="translucent"||!W.length)return;const{isRenderingToTexture:ce}=K,oe=R.style.projection.useSubdivision,ge=R.getDepthModeForSublayer(0,Yi.ReadOnly),be=R.colorModeForRenderPass();if(oe){const[Le,De,ke]=R.stencilConfigForOverlapTwoPass(W);hf(R,O,$,ke,Le,ge,be,!1,ce),hf(R,O,$,ke,De,ge,be,!0,ce)}else{const[Le,De]=R.getStencilConfigForOverlapAndUpdateStencilID(W);hf(R,O,$,De,Le,ge,be,!1,ce)}})(l,d,v,w,E):s.bU(v)?(function(R,O,$,W,K){if(R.renderPass!=="translucent"||$.paint.get("raster-opacity")===0||!W.length)return;const{isRenderingToTexture:ce}=K,oe=O.getSource(),ge=R.style.projection.useSubdivision;if(oe instanceof ct)Xh(R,O,$,W,null,!1,!1,oe.tileCoords,oe.flippedWindingOrder,ce);else if(ge){const[be,Le,De]=R.stencilConfigForOverlapTwoPass(W);Xh(R,O,$,De,be,!1,!0,$u,!1,ce),Xh(R,O,$,De,Le,!0,!0,$u,!1,ce)}else{const[be,Le]=R.getStencilConfigForOverlapAndUpdateStencilID(W);Xh(R,O,$,Le,be,!1,!0,$u,!1,ce)}})(l,d,v,w,E):s.cu(v)?(function(R,O,$,W,K){const ce=$.paint.get("background-color"),oe=$.paint.get("background-opacity");if(oe===0)return;const{isRenderingToTexture:ge}=K,be=R.context,Le=be.gl,De=R.style.projection,ke=R.transform,Ne=ke.tileSize,He=$.paint.get("background-pattern");if(R.isPatternMissing(He))return;const ze=!He&&ce.a===1&&oe===1&&R.opaquePassEnabledForLayer()?"opaque":"translucent";if(R.renderPass!==ze)return;const Ge=bn.disabled,Je=R.getDepthModeForSublayer(0,ze==="opaque"?Yi.ReadWrite:Yi.ReadOnly),je=R.colorModeForRenderPass(),at=R.useProgram(He?"backgroundPattern":"background"),Tt=W||Vn(ke,{tileSize:Ne,terrain:R.style.map.terrain});He&&(be.activeTexture.set(Le.TEXTURE0),R.imageManager.bind(R.context));const vt=$.getCrossfadeParameters();for(const xt of Tt){const wt=ke.getProjectionData({overscaledTileID:xt,applyGlobeMatrix:!ge,applyTerrainMatrix:!0}),Qt=He?rf(oe,R,He,{tileID:xt,tileSize:Ne},vt):qh(oe,ce),ti=R.style.map.terrain&&R.style.map.terrain.getTerrainData(xt),Wt=De.getMeshFromTileID(be,xt.canonical,!1,!0,"raster");at.draw(be,Le.TRIANGLES,Je,Ge,je,pn.backCCW,Qt,ti,wt,$.id,Wt.vertexBuffer,Wt.indexBuffer,Wt.segments)}})(l,0,v,w,E):s.cv(v)&&(function(R,O,$,W){const{isRenderingGlobe:K}=W,ce=R.context,oe=$.implementation,ge=R.style.projection,be=R.transform,Le=be.getProjectionDataForCustomLayer(K),De={farZ:be.farZ,nearZ:be.nearZ,fov:be.fov*Math.PI/180,modelViewProjectionMatrix:be.modelViewProjectionMatrix,projectionMatrix:be.projectionMatrix,shaderData:{variantName:ge.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ge.shaderPreludeCode.vertexSource}`,define:ge.shaderDefine},defaultProjectionData:Le},ke=oe.renderingMode?oe.renderingMode:"2d";if(R.renderPass==="offscreen"){const Ne=oe.prerender;Ne&&(R.setCustomLayerDefaults(),ce.setColorMode(R.colorModeForRenderPass()),Ne.call(oe,ce.gl,De),ce.setDirty(),R.setBaseState())}else if(R.renderPass==="translucent"){R.setCustomLayerDefaults(),ce.setColorMode(R.colorModeForRenderPass()),ce.setStencilMode(bn.disabled);const Ne=ke==="3d"?R.getDepthModeFor3D():R.getDepthModeForSublayer(0,Yi.ReadOnly);ce.setDepthMode(Ne),oe.render(ce.gl,De),ce.setDirty(),R.setBaseState(),ce.bindFramebuffer.set(null)}})(l,0,v,E))}saveTileTexture(l){const d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const d=this.imageManager.getPattern(l.from.toString()),v=this.imageManager.getPattern(l.to.toString());return!d||!v}useProgram(l,d,v=!1,w=[]){this.cache=this.cache||{};const E=!!this.style.map.terrain,R=this.style.projection,O=v?xn.projectionMercator:R.shaderPreludeCode,$=v?Ss:R.shaderDefine,W=l+(d?d.cacheKey:"")+`/${v?oo:R.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(E?"/terrain":"")+(w?`/${w.join("/")}`:"");return this.cache[W]||(this.cache[W]=new Op(this.context,xn[l],d,ec[l],this._showOverdrawInspector,E,O,$,w)),this.cache[W]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var l,d;if(this._tileTextures){for(const v in this._tileTextures){const w=this._tileTextures[v];if(w)for(const E of w)E.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((l=this.tileExtentMesh.vertexBuffer)===null||l===void 0||l.destroy()),this.tileExtentMesh&&((d=this.tileExtentMesh.indexBuffer)===null||d===void 0||d.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const v in this.cache){const w=this.cache[v];w&&w.program&&this.context.gl.deleteProgram(w.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:d}=this.context.gl;return this.width!==l||this.height!==d}}function w_(C,l){let d,v=!1,w=null,E=null;const R=()=>{w=null,v&&(C.apply(E,d),w=setTimeout(R,l),v=!1)};return(...O)=>(v=!0,E=this,d=O,w||R(),w)}class S_{constructor(l){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let v;return d.split("&").map((w=>w.split("="))).forEach((w=>{w[0]===this._hashName&&(v=w)})),(v&&v[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(!this._isValidHash(d))return!1;const v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:v,pitch:+(d[4]||0)}),!0},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const v=d.join("/");let w=v;w.split("&").length>0&&(w=w.split("&")[0]),this._hashName&&(w=`${this._hashName}=${v}`);let E=window.location.hash.replace(w,"");E.startsWith("#&")?E=E.slice(0,1)+E.slice(2):E==="#"&&(E="");let R=window.location.href.replace(/(#.+)?$/,E);R=R.replace("&&","&"),window.history.replaceState(window.history.state,null,R)},this._updateHash=w_(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(l){const d=this._map.getCenter(),v=Math.round(100*this._map.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,w),R=Math.round(d.lng*E)/E,O=Math.round(d.lat*E)/E,$=this._map.getBearing(),W=this._map.getPitch();let K="";if(K+=l?`/${R}/${O}/${v}`:`${v}/${O}/${R}`,($||W)&&(K+="/"+Math.round(10*$)/10),W&&(K+=`/${Math.round(W)}`),this._hashName){const ce=this._hashName;let oe=!1;const ge=window.location.hash.slice(1).split("&").map((be=>{const Le=be.split("=")[0];return Le===ce?(oe=!0,`${Le}=${K}`):be})).filter((be=>be));return oe||ge.push(`${ce}=${K}`),`#${ge.join("&")}`}return`#${K}`}_isValidHash(l){if(l.length<3||l.some(isNaN))return!1;try{new s.V(+l[2],+l[1])}catch{return!1}const d=+l[0],v=+(l[3]||0),w=+(l[4]||0);return d>=this._map.getMinZoom()&&d<=this._map.getMaxZoom()&&v>=-180&&v<=180&&w>=this._map.getMinPitch()&&w<=this._map.getMaxPitch()}}const Vc={linearity:.3,easing:s.cw(0,0,.3,1)},S0=s.e({deceleration:2500,maxSpeed:1400},Vc),ca=s.e({deceleration:20,maxSpeed:1400},Vc),Da=s.e({deceleration:1e3,maxSpeed:360},Vc),T0=s.e({deceleration:1e3,maxSpeed:90},Vc),Fa=s.e({deceleration:1e3,maxSpeed:360},Vc);class i1{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=P();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,d.roll+=E.rollDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(d.pan.mag()){const E=pf(d.pan.mag(),v,s.e({},S0,l||{})),R=d.pan.mult(E.amount/d.pan.mag()),O=this._map.cameraHelper.handlePanInertia(R,this._map.transform);w.center=O.easingCenter,w.offset=O.easingOffset,ff(w,E)}if(d.zoom){const E=pf(d.zoom,v,ca);w.zoom=this._map.transform.zoom+E.amount,ff(w,E)}if(d.bearing){const E=pf(d.bearing,v,Da);w.bearing=this._map.transform.bearing+s.an(E.amount,-179,179),ff(w,E)}if(d.pitch){const E=pf(d.pitch,v,T0);w.pitch=this._map.transform.pitch+E.amount,ff(w,E)}if(d.roll){const E=pf(d.roll,v,Fa);w.roll=this._map.transform.roll+s.an(E.amount,-179,179),ff(w,E)}if(w.zoom||w.bearing){const E=d.pinchAround===void 0?d.around:d.pinchAround;w.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),s.e(w,{noMoveStart:!0})}}function ff(C,l){(!C.duration||C.duration<l.duration)&&(C.duration=l.duration,C.easing=l.easing)}function pf(C,l,d){const{maxSpeed:v,linearity:w,deceleration:E}=d,R=s.an(C*w/(l/1e3),-v,v),O=Math.abs(R)/(E*w);return{easing:d.easing,duration:1e3*O,amount:R*(O/2)}}class Cs extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,v,w={}){v=v instanceof MouseEvent?v:new MouseEvent(l,v);const E=k.mousePos(d.getCanvas(),v),R=d.unproject(E);super(l,s.e({point:E,lngLat:R,originalEvent:v},w)),this._defaultPrevented=!1,this.target=d}}class mf extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,v){const w=l==="touchend"?v.changedTouches:v.touches,E=k.touchPos(d.getCanvasContainer(),w),R=E.map(($=>d.unproject($))),O=E.reduce((($,W,K,ce)=>$.add(W.div(ce.length))),new s.P(0,0));super(l,{points:E,point:O,lngLats:R,lngLat:d.unproject(O),originalEvent:v}),this._defaultPrevented=!1}}class M0 extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,v){super(l,{originalEvent:v}),this._defaultPrevented=!1}}class n1{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new M0(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new Cs(l.type,this._map,l))}mouseup(l){this._map.fire(new Cs(l.type,this._map,l))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Cs(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Cs(l.type,this._map,l))}mouseover(l){this._map.fire(new Cs(l.type,this._map,l))}mouseout(l){this._map.fire(new Cs(l.type,this._map,l))}touchstart(l){return this._firePreventable(new mf(l.type,this._map,l))}touchmove(l){this._map.fire(new mf(l.type,this._map,l))}touchend(l){this._map.fire(new mf(l.type,this._map,l))}touchcancel(l){this._map.fire(new mf(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class r1{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Cs(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Cs(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yh{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.screenPointToLocation(s.P.convert(l),this._map.terrain)}}class Kh{constructor(l,d){this._map=l,this._tr=new Yh(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(k.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const v=d;if(this._lastPos.equals(v)||!this._box&&v.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=v,this._box||(this._box=k.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const E=Math.min(w.x,v.x),R=Math.max(w.x,v.x),O=Math.min(w.y,v.y),$=Math.max(w.y,v.y);k.setTransform(this._box,`translate(${E}px,${O}px)`),this._box.style.width=R-E+"px",this._box.style.height=$-O+"px"}mouseupWindow(l,d){if(!this._active||l.button!==0)return;const v=this._startPos,w=d;if(this.reset(),k.suppressClick(),v.x!==w.x||v.y!==w.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:l})),{cameraAnimation:E=>E.fitScreenCoordinates(v,w,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new s.l(l,{originalEvent:d}))}}function Oa(C,l){if(C.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${C.length}, points ${l.length}`);const d={};for(let v=0;v<C.length;v++)d[C[v].identifier]=l[v];return d}class mi{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,d,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),v.length===this.numTouches&&(this.centroid=(function(w){const E=new s.P(0,0);for(const R of w)E._add(R);return E.div(w.length)})(d),this.touches=Oa(v,d)))}touchmove(l,d,v){if(this.aborted||!this.centroid)return;const w=Oa(v,d);for(const E in this.touches){const R=w[E];(!R||R.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(l,d,v){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class em{constructor(l){this.singleTap=new mi(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,d,v){this.singleTap.touchstart(l,d,v)}touchmove(l,d,v){this.singleTap.touchmove(l,d,v)}touchend(l,d,v){const w=this.singleTap.touchend(l,d,v);if(w){const E=l.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(w)<30;if(E&&R||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class T_{constructor(l){this._tr=new Yh(l),this._zoomIn=new em({numTouches:1,numTaps:2}),this._zoomOut=new em({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,v){this._zoomIn.touchstart(l,d,v),this._zoomOut.touchstart(l,d,v)}touchmove(l,d,v){this._zoomIn.touchmove(l,d,v),this._zoomOut.touchmove(l,d,v)}touchend(l,d,v){const w=this._zoomIn.touchend(l,d,v),E=this._zoomOut.touchend(l,d,v),R=this._tr;return w?(this._active=!0,l.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:R.zoom+1,around:R.unproject(w)},{originalEvent:l})}):E?(this._active=!0,l.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:R.zoom-1,around:R.unproject(E)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jh{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const d=this._moveFunction(...l);if(d.bearingDelta||d.pitchDelta||d.rollDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(l,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=Array.isArray(d)?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,d){if(!this.isEnabled())return;const v=this._lastPoint;if(!v)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const w=Array.isArray(d)?d[0]:d;return!this._moved&&w.dist(v)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=w,this._move(v,w))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&k.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gf=0,_f=2,M_={[gf]:1,[_f]:2};class vf{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const d=k.mouseButton(l);this._eventButton=d}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!(function(d,v){const w=M_[v];return d.buttons===void 0||(d.buttons&w)!==w})(l,this._eventButton)}isValidEndEvent(l){return k.mouseButton(l)===this._eventButton}}class C_{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}class C0{constructor(l=new vf({checkCorrectEvent:()=>!0}),d=new C_){this.mouseMoveStateManager=l,this.oneFingerTouchMoveStateManager=d}_executeRelevantHandler(l,d,v){return l instanceof MouseEvent?d(l):typeof TouchEvent<"u"&&l instanceof TouchEvent?v(l):void 0}startMove(l){this._executeRelevantHandler(l,(d=>this.mouseMoveStateManager.startMove(d)),(d=>this.oneFingerTouchMoveStateManager.startMove(d)))}endMove(l){this._executeRelevantHandler(l,(d=>this.mouseMoveStateManager.endMove(d)),(d=>this.oneFingerTouchMoveStateManager.endMove(d)))}isValidStartEvent(l){return this._executeRelevantHandler(l,(d=>this.mouseMoveStateManager.isValidStartEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidStartEvent(d)))}isValidMoveEvent(l){return this._executeRelevantHandler(l,(d=>this.mouseMoveStateManager.isValidMoveEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(d)))}isValidEndEvent(l){return this._executeRelevantHandler(l,(d=>this.mouseMoveStateManager.isValidEndEvent(d)),(d=>this.oneFingerTouchMoveStateManager.isValidEndEvent(d)))}}const Qh=C=>{C.mousedown=C.dragStart,C.mousemoveWindow=C.dragMove,C.mouseup=C.dragEnd,C.contextmenu=l=>{l.preventDefault()}};class s1{constructor(l,d){this._clickTolerance=l.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(l){return l<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(l,d,v){return this._calculateTransform(l,d,v)}touchmove(l,d,v){if(this._active){if(!this._shouldBePrevented(v.length))return l.preventDefault(),this._calculateTransform(l,d,v);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",l)}}touchend(l,d,v){this._calculateTransform(l,d,v),this._active&&this._shouldBePrevented(v.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,v){v.length>0&&(this._active=!0);const w=Oa(v,d),E=new s.P(0,0),R=new s.P(0,0);let O=0;for(const W in w){const K=w[W],ce=this._touches[W];ce&&(E._add(K),R._add(K.sub(ce)),O++,w[W]=K)}if(this._touches=w,this._shouldBePrevented(O)||!R.mag())return;const $=R.div(O);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(O),panDelta:$}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tm{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,d,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,v){if(!this._firstTwoTouches)return;l.preventDefault();const[w,E]=this._firstTwoTouches,R=im(v,d,w),O=im(v,d,E);if(!R||!O)return;const $=this._aroundCenter?null:R.add(O).div(2);return this._move([R,O],$,l)}touchend(l,d,v){if(!this._firstTwoTouches)return;const[w,E]=this._firstTwoTouches,R=im(v,d,w),O=im(v,d,E);R&&O||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function im(C,l,d){for(let v=0;v<C.length;v++)if(C[v].identifier===d)return l[v]}function E0(C,l){return Math.log(C/l)/Math.LN2}class E_ extends tm{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const v=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(E0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:E0(this._distance,v),pinchAround:d}}}function A0(C,l){return 180*C.angleWith(l)/Math.PI}class A_ extends tm{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d,v){const w=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:A0(this._vector,w),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,v=A0(l,this._startVector);return Math.abs(v)<d}}function P_(C){return Math.abs(C.y)>Math.abs(C.x)}class P0 extends tm{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,d,v){super.touchstart(l,d,v),this._currentTouchCount=v.length}_start(l){this._lastPoints=l,P_(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,v){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const w=l[0].sub(this._lastPoints[0]),E=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(w,E,v.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(w.y+E.y)/2*-.5}):void 0}gestureBeginsVertically(l,d,v){if(this._valid!==void 0)return this._valid;const w=l.mag()>=2,E=d.mag()>=2;if(!w&&!E)return;if(!w||!E)return this._firstMove===void 0&&(this._firstMove=v),v-this._firstMove<100&&void 0;const R=l.y>0==d.y>0;return P_(l)&&P_(d)&&R}}const Uc={panStep:100,bearingStep:15,pitchStep:10};class Gn{constructor(l){this._tr=new Yh(l);const d=Uc;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,v=0,w=0,E=0,R=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?v=-1:(l.preventDefault(),E=-1);break;case 39:l.shiftKey?v=1:(l.preventDefault(),E=1);break;case 38:l.shiftKey?w=1:(l.preventDefault(),R=-1);break;case 40:l.shiftKey?w=-1:(l.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:O=>{const $=this._tr;O.easeTo({duration:300,easeId:"keyboardHandler",easing:o1,zoom:d?Math.round($.zoom)+d*(l.shiftKey?2:1):$.zoom,bearing:$.bearing+v*this._bearingStep,pitch:$.pitch+w*this._pitchStep,offset:[-E*this._panStep,-R*this._panStep],center:$.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function o1(C){return C*(2-C)}const yf=4.000244140625,nm=1/450;class rm{constructor(l,d){this._onTimeout=v=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(v)},this._map=l,this._tr=new Yh(l),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=nm}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(l){return!!this._map.cooperativeGestures.isEnabled()&&!(l.ctrlKey||this._map.cooperativeGestures.isBypassed(l))}wheel(l){if(!this.isEnabled())return;if(this._shouldBePrevented(l))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",l);let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const v=P(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,d!==0&&d%yf==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(w*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=k.mousePos(this._map.getCanvas(),l),v=this._tr;this._aroundPoint=this._aroundCenter?v.transform.locationToScreenPoint(s.V.convert(v.center)):d,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const O=l.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=O),typeof this._targetZoom=="number"&&(this._targetZoom+=O)}if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>yf?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&$!==0&&($=1/$);const W=typeof this._targetZoom!="number"?l.scale:s.aq(this._targetZoom);this._targetZoom=l.applyConstrain(l.getCameraLngLat(),s.at(W*$)).zoom,this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom!="number"?l.zoom:this._targetZoom,v=this._startZoom,w=this._easing;let E,R=!1;if(this._type==="wheel"&&v&&w){const O=P()-this._lastWheelEventTime,$=Math.min((O+5)/200,1),W=w($);E=s.G.number(v,d,W),$<1?this._frameId||(this._frameId=!0):R=!0}else E=d,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=E,{noInertia:!0,needsRenderFrame:!R,zoomDelta:E-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=s.cy;if(this._prevEase){const v=this._prevEase,w=(P()-v.start)/v.duration,E=v.easing(w+.01)-v.easing(w),R=.27/Math.sqrt(E*E+1e-4)*.01,O=Math.sqrt(.0729-R*R);d=s.cw(R,O,.25,1)}return this._prevEase={start:P(),duration:l,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class I_{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class I0{constructor(l){this._tr=new Yh(l),this.reset()}reset(){this._active=!1}dblclick(l,d){return l.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class L0{constructor(){this._tap=new em({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,d,v){if(!this._swipePoint)if(this._tapTime){const w=d[0],E=l.timeStamp-this._tapTime<500,R=this._tapPoint.dist(w)<30;E&&R?v.length>0&&(this._swipePoint=w,this._swipeTouch=v[0].identifier):this.reset()}else this._tap.touchstart(l,d,v)}touchmove(l,d,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=d[0],E=w.y-this._swipePoint.y;return this._swipePoint=w,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,d,v)}touchend(l,d,v){if(this._tapTime)this._swipePoint&&v.length===0&&this.reset();else{const w=this._tap.touchend(l,d,v);w&&(this._tapTime=l.timeStamp,this._tapPoint=w)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class R0{constructor(l,d,v){this._el=l,this._mousePan=d,this._touchPan=v}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class za{constructor(l,d,v,w){this._pitchWithRotate=l.pitchWithRotate,this._rollEnabled=l.rollEnabled,this._mouseRotate=d,this._mousePitch=v,this._mouseRoll=w}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class bf{constructor(l,d,v,w){this._el=l,this._touchZoom=d,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Mi{constructor(l,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=k.create("div","maplibregl-cooperative-gesture-screen",l);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const v=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),w=document.createElement("div");w.className="maplibregl-desktop-message",w.textContent=d,this._container.appendChild(w);const E=document.createElement("div");E.className="maplibregl-mobile-message",E.textContent=v,this._container.appendChild(E),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(k.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(l){return l[this._bypassKey]}notifyGestureBlocked(l,d){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:l,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Fi=C=>C.zoom||C.drag||C.roll||C.pitch||C.rotate;class xf extends s.l{}function sm(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta||C.rollDelta}class om{constructor(l,d){this.handleWindowEvent=w=>{this.handleEvent(w,`${w.type}Window`)},this.handleEvent=(w,E)=>{if(w.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const R=w.type==="renderFrame"?void 0:w,O={needsRenderFrame:!1},$={},W={};for(const{handlerName:oe,handler:ge,allowed:be}of this._handlers){if(!ge.isEnabled())continue;let Le;if(this._blockedByActive(W,be,oe))ge.reset();else if(ge[E||w.type]){if(s.cz(w,E||w.type)){const De=k.mousePos(this._map.getCanvas(),w);Le=ge[E||w.type](w,De)}else if(s.cA(w,E||w.type)){const De=this._getMapTouches(w.touches),ke=k.touchPos(this._map.getCanvas(),De);Le=ge[E||w.type](w,ke,De)}else s.cB(E||w.type)||(Le=ge[E||w.type](w));this.mergeHandlerResult(O,$,Le,oe,R),Le&&Le.needsRenderFrame&&this._triggerRenderFrame()}(Le||ge.isActive())&&(W[oe]=ge)}const K={};for(const oe in this._previousActiveHandlers)W[oe]||(K[oe]=R);this._previousActiveHandlers=W,(Object.keys(K).length||sm(O))&&(this._changes.push([O,$,K]),this._triggerRenderFrame()),(Object.keys(W).length||sm(O))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ce}=O;ce&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ce(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new i1(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,E,R]of this._listeners)k.addEventListener(w,E,w===document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[l,d,v]of this._listeners)k.removeEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(l){const d=this._map,v=d.getCanvasContainer();this._add("mapEvent",new n1(d,l));const w=d.boxZoom=new Kh(d,l);this._add("boxZoom",w),l.interactive&&l.boxZoom&&w.enable();const E=d.cooperativeGestures=new Mi(d,l.cooperativeGestures);this._add("cooperativeGestures",E),l.cooperativeGestures&&E.enable();const R=new T_(d),O=new I0(d);d.doubleClickZoom=new I_(O,R),this._add("tapZoom",R),this._add("clickZoom",O),l.interactive&&l.doubleClickZoom&&d.doubleClickZoom.enable();const $=new L0;this._add("tapDragZoom",$);const W=d.touchPitch=new P0(d);this._add("touchPitch",W),l.interactive&&l.touchPitch&&d.touchPitch.enable(l.touchPitch);const K=()=>d.project(d.getCenter()),ce=(function({enable:ze,clickTolerance:Ge,aroundCenter:Je=!0,minPixelCenterThreshold:je=100,rotateDegreesPerPixelMoved:at=.8},Tt){const vt=new vf({checkCorrectEvent:xt=>k.mouseButton(xt)===0&&xt.ctrlKey||k.mouseButton(xt)===2&&!xt.ctrlKey});return new Jh({clickTolerance:Ge,move:(xt,wt)=>{const Qt=Tt();if(Je&&Math.abs(Qt.y-xt.y)>je)return{bearingDelta:s.cx(new s.P(xt.x,wt.y),wt,Qt)};let ti=(wt.x-xt.x)*at;return Je&&wt.y<Qt.y&&(ti=-ti),{bearingDelta:ti}},moveStateManager:vt,enable:ze,assignEvents:Qh})})(l,K),oe=(function({enable:ze,clickTolerance:Ge,pitchDegreesPerPixelMoved:Je=-.5}){const je=new vf({checkCorrectEvent:at=>k.mouseButton(at)===0&&at.ctrlKey||k.mouseButton(at)===2});return new Jh({clickTolerance:Ge,move:(at,Tt)=>({pitchDelta:(Tt.y-at.y)*Je}),moveStateManager:je,enable:ze,assignEvents:Qh})})(l),ge=(function({enable:ze,clickTolerance:Ge,rollDegreesPerPixelMoved:Je=.3},je){const at=new vf({checkCorrectEvent:Tt=>k.mouseButton(Tt)===2&&Tt.ctrlKey});return new Jh({clickTolerance:Ge,move:(Tt,vt)=>{const xt=je();let wt=(vt.x-Tt.x)*Je;return vt.y<xt.y&&(wt=-wt),{rollDelta:wt}},moveStateManager:at,enable:ze,assignEvents:Qh})})(l,K);d.dragRotate=new za(l,ce,oe,ge),this._add("mouseRotate",ce,["mousePitch"]),this._add("mousePitch",oe,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ge,["mousePitch"]),l.interactive&&l.dragRotate&&d.dragRotate.enable();const be=(function({enable:ze,clickTolerance:Ge}){const Je=new vf({checkCorrectEvent:je=>k.mouseButton(je)===0&&!je.ctrlKey});return new Jh({clickTolerance:Ge,move:(je,at)=>({around:at,panDelta:at.sub(je)}),activateOnStart:!0,moveStateManager:Je,enable:ze,assignEvents:Qh})})(l),Le=new s1(l,d);d.dragPan=new R0(v,be,Le),this._add("mousePan",be),this._add("touchPan",Le,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&d.dragPan.enable(l.dragPan);const De=new A_,ke=new E_;d.touchZoomRotate=new bf(v,ke,De,$),this._add("touchRotate",De,["touchPan","touchZoom"]),this._add("touchZoom",ke,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&d.touchZoomRotate.enable(l.touchZoomRotate),this._add("blockableMapEvent",new r1(d));const Ne=d.scrollZoom=new rm(d,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Ne,["mousePan"]),l.interactive&&l.scrollZoom&&d.scrollZoom.enable(l.scrollZoom);const He=d.keyboard=new Gn(d);this._add("keyboard",He),l.interactive&&l.keyboard&&d.keyboard.enable()}_add(l,d,v){this._handlers.push({handlerName:l,handler:d,allowed:v}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fi(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,d,v){for(const w in l)if(w!==v&&(!d||d.indexOf(w)<0))return!0;return!1}_getMapTouches(l){const d=[];for(const v of l)this._el.contains(v.target)&&d.push(v);return d}mergeHandlerResult(l,d,v,w,E){if(!v)return;s.e(l,v);const R={handlerName:w,originalEvent:v.originalEvent||E};v.zoomDelta!==void 0&&(d.zoom=R),v.panDelta!==void 0&&(d.drag=R),v.rollDelta!==void 0&&(d.roll=R),v.pitchDelta!==void 0&&(d.pitch=R),v.bearingDelta!==void 0&&(d.rotate=R)}_applyChanges(){const l={},d={},v={};for(const[w,E,R]of this._changes)w.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(w.panDelta)),w.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+w.pitchDelta),w.rollDelta&&(l.rollDelta=(l.rollDelta||0)+w.rollDelta),w.around!==void 0&&(l.around=w.around),w.pinchAround!==void 0&&(l.pinchAround=w.pinchAround),w.noInertia&&(l.noInertia=w.noInertia),s.e(d,E),s.e(v,R);this._updateMapTransform(l,d,v),this._changes=[]}_updateMapTransform(l,d,v){const w=this._map,E=w._getTransformForUpdate(),R=w.terrain;if(!(sm(l)||R&&this._terrainMovement))return this._fireEvents(d,v,!0);w._stop(!0);let{panDelta:O,zoomDelta:$,bearingDelta:W,pitchDelta:K,rollDelta:ce,around:oe,pinchAround:ge}=l;ge!==void 0&&(oe=ge),oe=oe||w.transform.centerPoint,R&&!E.isPointOnMapSurface(oe)&&(oe=E.centerPoint);const be={panDelta:O,zoomDelta:$,rollDelta:ce,pitchDelta:K,bearingDelta:W,around:oe};this._map.cameraHelper.useGlobeControls&&!E.isPointOnMapSurface(oe)&&(oe=E.centerPoint);const Le=oe.distSqr(E.centerPoint)<.01?E.center:E.screenPointToLocation(O?oe.sub(O):oe);this._handleMapControls({terrain:R,tr:E,deltasForHelper:be,preZoomAroundLoc:Le,combinedEventsInProgress:d,panDelta:O}),w._applyUpdatedTransform(E),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,v,!0)}_handleMapControls({terrain:l,tr:d,deltasForHelper:v,preZoomAroundLoc:w,combinedEventsInProgress:E,panDelta:R}){const O=this._map.cameraHelper;if(O.handleMapControlsRollPitchBearingZoom(v,d),l)return O.useGlobeControls?(this._terrainMovement||!E.drag&&!E.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void O.handleMapControlsPan(v,d,w)):this._terrainMovement||!E.drag&&!E.zoom?void(E.drag&&this._terrainMovement&&R?d.setCenter(d.screenPointToLocation(d.centerPoint.sub(R))):O.handleMapControlsPan(v,d,w)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void O.handleMapControlsPan(v,d,w));O.handleMapControlsPan(v,d,w)}_fireEvents(l,d,v){const w=Fi(this._eventsInProgress),E=Fi(l),R={};for(const ce in l){const{originalEvent:oe}=l[ce];this._eventsInProgress[ce]||(R[`${ce}start`]=oe),this._eventsInProgress[ce]=l[ce]}!w&&E&&this._fireEvent("movestart",E.originalEvent);for(const ce in R)this._fireEvent(ce,R[ce]);E&&this._fireEvent("move",E.originalEvent);for(const ce in l){const{originalEvent:oe}=l[ce];this._fireEvent(ce,oe)}const O={};let $;for(const ce in this._eventsInProgress){const{handlerName:oe,originalEvent:ge}=this._eventsInProgress[ce];this._handlersById[oe].isActive()||(delete this._eventsInProgress[ce],$=d[oe]||ge,O[`${ce}end`]=$)}for(const ce in O)this._fireEvent(ce,O[ce]);const W=Fi(this._eventsInProgress),K=(w||E)&&!W;if(K&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const ce=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&ce.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(ce)}if(v&&K){this._updatingCamera=!0;const ce=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),oe=ge=>ge!==0&&-this._bearingSnap<ge&&ge<this._bearingSnap;!ce||!ce.essential&&b.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:$})),oe(this._map.getBearing())&&this._map.resetNorth()):(oe(ce.bearing||this._map.getBearing())&&(ce.bearing=0),ce.freezeElevation=!0,this._map.easeTo(ce,{originalEvent:$})),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new s.l(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((l=>{delete this._frameId,this.handleEvent(new xf("renderFrame",{timeStamp:l})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class lo extends s.E{constructor(l,d,v){super(),this._renderFrameCallback=()=>{const w=Math.min((P()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(w)),w<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=v.bearingSnap,this.cameraHelper=d,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(l,d){l.apply(this.transform),this.transform=l,this.cameraHelper=d}getCenter(){return new s.V(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}getCenterElevation(){return this.transform.elevation}setCenterElevation(l,d){return this.jumpTo({elevation:l},d),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(l){this._centerClampedToGround=l}panBy(l,d,v){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.e({offset:l},d),v)}panTo(l,d,v){return this.easeTo(s.e({center:l},d),v)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,v){return this.easeTo(s.e({zoom:l},d),v)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(l,d){return l!=this.transform.fov&&(this.transform.setFov(l),this.fire(new s.l("movestart",d)).fire(new s.l("move",d)).fire(new s.l("moveend",d))),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,v){return this.easeTo(s.e({bearing:l},d),v)}resetNorth(l,d){return this.rotateTo(0,s.e({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}getRoll(){return this.transform.roll}setRoll(l,d){return this.jumpTo({roll:l},d),this}cameraForBounds(l,d){l=Ee.convert(l).adjustAntiMeridian();const v=d&&d.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),v,d)}_cameraForBoxAndBearing(l,d,v,w){const E={top:0,bottom:0,right:0,left:0};if(typeof(w=s.e({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){const W=w.padding;w.padding={top:W,bottom:W,right:W,left:W}}const R=s.e(E,w.padding);w.padding=R;const O=this.transform,$=new Ee(l,d);return this.cameraHelper.cameraForBoxAndBearing(w,R,$,v,O)}fitBounds(l,d,v){return this._fitInternal(this.cameraForBounds(l,d),d,v)}fitScreenCoordinates(l,d,v,w,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(l)),this.transform.screenPointToLocation(s.P.convert(d)),v,w),w,E)}_fitInternal(l,d,v){return l?(delete(d=s.e(l,d)).padding,d.linear?this.easeTo(d,v):this.flyTo(d,v)):this}jumpTo(l,d){this.stop();const v=this._getTransformForUpdate();let w=!1,E=!1,R=!1;const O=v.zoom;this.cameraHelper.handleJumpToCenterZoom(v,l);const $=v.zoom!==O;return"elevation"in l&&v.elevation!==+l.elevation&&v.setElevation(+l.elevation),"bearing"in l&&v.bearing!==+l.bearing&&(w=!0,v.setBearing(+l.bearing)),"pitch"in l&&v.pitch!==+l.pitch&&(E=!0,v.setPitch(+l.pitch)),"roll"in l&&v.roll!==+l.roll&&(R=!0,v.setRoll(+l.roll)),l.padding==null||v.isPaddingEqual(l.padding)||v.setPadding(l.padding),this._applyUpdatedTransform(v),this.fire(new s.l("movestart",d)).fire(new s.l("move",d)),$&&this.fire(new s.l("zoomstart",d)).fire(new s.l("zoom",d)).fire(new s.l("zoomend",d)),w&&this.fire(new s.l("rotatestart",d)).fire(new s.l("rotate",d)).fire(new s.l("rotateend",d)),E&&this.fire(new s.l("pitchstart",d)).fire(new s.l("pitch",d)).fire(new s.l("pitchend",d)),R&&this.fire(new s.l("rollstart",d)).fire(new s.l("roll",d)).fire(new s.l("rollend",d)),this.fire(new s.l("moveend",d))}calculateCameraOptionsFromTo(l,d,v,w=0){const E=s.a9.fromLngLat(l,d),R=s.a9.fromLngLat(v,w),O=R.x-E.x,$=R.y-E.y,W=R.z-E.z,K=Math.hypot(O,$,W);if(K===0)throw new Error("Can't calculate camera options with same From and To");const ce=Math.hypot(O,$),oe=s.at(this.transform.cameraToCenterDistance/K/this.transform.tileSize),ge=180*Math.atan2(O,-$)/Math.PI;let be=180*Math.acos(ce/K)/Math.PI;return be=W<0?90-be:90+be,{center:R.toLngLat(),elevation:w,zoom:oe,pitch:be,bearing:ge}}calculateCameraOptionsFromCameraLngLatAltRotation(l,d,v,w,E){const R=this.transform.calculateCenterFromCameraLngLatAlt(l,d,v,w);return{center:R.center,elevation:R.elevation,zoom:R.zoom,bearing:v,pitch:w,roll:E}}easeTo(l,d){this._stop(!1,l.easeId),((l=s.e({offset:[0,0],duration:500,easing:s.cy},l)).animate===!1||!l.essential&&b.prefersReducedMotion)&&(l.duration=0);const v=this._getTransformForUpdate(),w=this.getBearing(),E=v.pitch,R=v.roll,O="bearing"in l?this._normalizeBearing(l.bearing,w):w,$="pitch"in l?+l.pitch:E,W="roll"in l?this._normalizeBearing(l.roll,R):R,K="padding"in l?l.padding:v.padding,ce=s.P.convert(l.offset);let oe,ge;l.around&&(oe=s.V.convert(l.around),ge=v.locationToScreenPoint(oe));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Le=this.cameraHelper.handleEaseTo(v,{bearing:O,pitch:$,roll:W,padding:K,around:oe,aroundPoint:ge,offsetAsPoint:ce,offset:l.offset,zoom:l.zoom,center:l.center});return this._rotating=this._rotating||w!==O,this._pitching=this._pitching||$!==E,this._rolling=this._rolling||W!==R,this._padding=!v.isPaddingEqual(K),this._zooming=this._zooming||Le.isZooming,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,be),this.terrain&&this._prepareElevation(Le.elevationCenter),this._ease((De=>{Le.easeFunc(De),this.terrain&&!l.freezeElevation&&this._updateElevation(De),this._applyUpdatedTransform(v),this._fireMoveEvents(d)}),(De=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(d,De)}),l),this}_prepareEase(l,d,v={}){this._moving=!0,d||v.moving||this.fire(new s.l("movestart",l)),this._zooming&&!v.zooming&&this.fire(new s.l("zoomstart",l)),this._rotating&&!v.rotating&&this.fire(new s.l("rotatestart",l)),this._pitching&&!v.pitching&&this.fire(new s.l("pitchstart",l)),this._rolling&&!v.rolling&&this.fire(new s.l("rollstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&d!==this._elevationTarget){const v=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(v-(d-(v*l+this._elevationStart))/(1-l)),this._elevationTarget=d}this.transform.setElevation(s.G.number(this._elevationStart,this._elevationTarget,l))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(l){if(!this.terrain&&l.elevation>=0&&l.pitch<=90)return{};const d=l.getCameraLngLat(),v=l.getCameraAltitude(),w=this.terrain?this.terrain.getElevationForLngLatZoom(d,l.zoom):0;if(v<w){const E=this.calculateCameraOptionsFromTo(d,w,l.center,l.elevation);return{pitch:E.pitch,zoom:E.zoom}}return{}}_applyUpdatedTransform(l){const d=[];if(d.push((w=>this._elevateCameraIfInsideTerrain(w))),this.transformCameraUpdate&&d.push((w=>this.transformCameraUpdate(w))),!d.length)return;const v=l.clone();for(const w of d){const E=v.clone(),{center:R,zoom:O,roll:$,pitch:W,bearing:K,elevation:ce}=w(E);R&&E.setCenter(R),ce!==void 0&&E.setElevation(ce),O!==void 0&&E.setZoom(O),$!==void 0&&E.setRoll($),W!==void 0&&E.setPitch(W),K!==void 0&&E.setBearing(K),v.apply(E)}this.transform.apply(v)}_fireMoveEvents(l){this.fire(new s.l("move",l)),this._zooming&&this.fire(new s.l("zoom",l)),this._rotating&&this.fire(new s.l("rotate",l)),this._pitching&&this.fire(new s.l("pitch",l)),this._rolling&&this.fire(new s.l("roll",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const v=this._zooming,w=this._rotating,E=this._pitching,R=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,v&&this.fire(new s.l("zoomend",l)),w&&this.fire(new s.l("rotateend",l)),E&&this.fire(new s.l("pitchend",l)),R&&this.fire(new s.l("rollend",l)),this.fire(new s.l("moveend",l))}flyTo(l,d){if(!l.essential&&b.prefersReducedMotion){const wt=s.U(l,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(wt,d)}this.stop(),l=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cy},l);const v=this._getTransformForUpdate(),w=v.bearing,E=v.pitch,R=v.roll,O=v.padding,$="bearing"in l?this._normalizeBearing(l.bearing,w):w,W="pitch"in l?+l.pitch:E,K="roll"in l?this._normalizeBearing(l.roll,R):R,ce="padding"in l?l.padding:v.padding,oe=s.P.convert(l.offset);let ge=v.centerPoint.add(oe);const be=v.screenPointToLocation(ge),Le=this.cameraHelper.handleFlyTo(v,{bearing:$,pitch:W,roll:K,padding:ce,locationAtOffset:be,offsetAsPoint:oe,center:l.center,minZoom:l.minZoom,zoom:l.zoom});let De=l.curve;const ke=Math.max(v.width,v.height),Ne=ke/Le.scaleOfZoom,He=Le.pixelPathLength;typeof Le.scaleOfMinZoom=="number"&&(De=Math.sqrt(ke/Le.scaleOfMinZoom/He*2));const ze=De*De;function Ge(wt){const Qt=(Ne*Ne-ke*ke+(wt?-1:1)*ze*ze*He*He)/(2*(wt?Ne:ke)*ze*He);return Math.log(Math.sqrt(Qt*Qt+1)-Qt)}function Je(wt){return(Math.exp(wt)-Math.exp(-wt))/2}function je(wt){return(Math.exp(wt)+Math.exp(-wt))/2}const at=Ge(!1);let Tt=function(wt){return je(at)/je(at+De*wt)},vt=function(wt){return ke*((je(at)*(Je(Qt=at+De*wt)/je(Qt))-Je(at))/ze)/He;var Qt},xt=(Ge(!0)-at)/De;if(Math.abs(He)<2e-6||!isFinite(xt)){if(Math.abs(ke-Ne)<1e-6)return this.easeTo(l,d);const wt=Ne<ke?-1:1;xt=Math.abs(Math.log(Ne/ke))/De,vt=()=>0,Tt=Qt=>Math.exp(wt*De*Qt)}return l.duration="duration"in l?+l.duration:1e3*xt/("screenSpeed"in l?+l.screenSpeed/De:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=w!==$,this._pitching=W!==E,this._rolling=K!==R,this._padding=!v.isPaddingEqual(ce),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(Le.targetCenter),this._ease((wt=>{const Qt=wt*xt,ti=1/Tt(Qt),Wt=vt(Qt);this._rotating&&v.setBearing(s.G.number(w,$,wt)),this._pitching&&v.setPitch(s.G.number(E,W,wt)),this._rolling&&v.setRoll(s.G.number(R,K,wt)),this._padding&&(v.interpolatePadding(O,ce,wt),ge=v.centerPoint.add(oe)),Le.easeFunc(wt,ti,Wt,ge),this.terrain&&!l.freezeElevation&&this._updateElevation(wt),this._applyUpdatedTransform(v),this._fireMoveEvents(d)}),(()=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(d)}),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){var v;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const w=this._onEaseEnd;delete this._onEaseEnd,w.call(this,d)}return l||(v=this.handlers)===null||v===void 0||v.stop(!1),this}_ease(l,d,v){v.animate===!1||v.duration===0?(l(1),d()):(this._easeStart=P(),this._easeOptions=v,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,d){l=s.W(l,-180,180);const v=Math.abs(l-d);return Math.abs(l-360-d)<v&&(l-=360),Math.abs(l+360-d)<v&&(l+=360),l}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLat(s.V.convert(l),this.transform):null}}const ua={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class L_{constructor(l=ua){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,d){const v=this._map._getUIString(`AttributionControl.${d}`);l.title=v,l.setAttribute("aria-label",v)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map((w=>typeof w!="string"?"":w))):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const d=this._map.style.tileManagers;for(const w in d){const E=d[w];if(E.used||E.usedForTerrain){const R=E.getSource();R.attribution&&l.indexOf(R.attribution)<0&&l.push(R.attribution)}}l=l.filter((w=>String(w).trim())),l.sort(((w,E)=>w.length-E.length)),l=l.filter(((w,E)=>{for(let R=E+1;R<l.length;R++)if(l[R].indexOf(w)>=0)return!1;return!0}));const v=l.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,l.length?(this._innerContainer.innerHTML=k.sanitize(v),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class k0{constructor(l={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const v=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&v.classList.add("maplibregl-compact"):v.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl");const d=k.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class a1{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,v=d?this._queue.concat(d):this._queue;for(const w of v)if(w.id===l)return void(w.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const v of d)if(!v.cancelled&&(v.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var l1=s.aU([{name:"a_pos3d",type:"Int16",components:3}]);class wf extends s.E{constructor(l){super(),this._lastTilesetChange=P(),this.tileManager=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=l._source.tileSize*2**this.deltaZoom,l.usedForTerrain=!0,l.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(l,d){this.tileManager.update(l,d),this._renderableTilesKeys=[];const v={};for(const w of Vn(l,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d,calculateTileZoom:this.tileManager._source.calculateTileZoom}))v[w.key]=!0,this._renderableTilesKeys.push(w.key),this._tiles[w.key]||(w.terrainRttPosMatrix32f=new Float64Array(16),s.c7(w.terrainRttPosMatrix32f,0,s.a5,s.a5,0,0,1),this._tiles[w.key]=new Et(w,this.tileSize),this._lastTilesetChange=P());for(const w in this._tiles)v[w]||delete this._tiles[w]}freeRtt(l){for(const d in this._tiles){const v=this._tiles[d];(!l||v.tileID.equals(l)||v.tileID.isChildOf(l)||l.isChildOf(v.tileID))&&(v.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((l=>this.getTileByID(l)))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l,d){return d?this._getTerrainCoordsForTileRanges(l,d):this._getTerrainCoordsForRegularTile(l)}_getTerrainCoordsForRegularTile(l){const d={};for(const v of this._renderableTilesKeys){const w=this._tiles[v].tileID,E=l.clone(),R=s.bk();if(w.canonical.equals(l.canonical))s.c7(R,0,s.a5,s.a5,0,0,1);else if(w.canonical.isChildOf(l.canonical)){const O=w.canonical.z-l.canonical.z,$=w.canonical.x-(w.canonical.x>>O<<O),W=w.canonical.y-(w.canonical.y>>O<<O),K=s.a5>>O;s.c7(R,0,K,K,0,0,1),s.O(R,R,[-$*K,-W*K,0])}else{if(!l.canonical.isChildOf(w.canonical))continue;{const O=l.canonical.z-w.canonical.z,$=l.canonical.x-(l.canonical.x>>O<<O),W=l.canonical.y-(l.canonical.y>>O<<O),K=s.a5>>O;s.c7(R,0,s.a5,s.a5,0,0,1),s.O(R,R,[$*K,W*K,0]),s.Q(R,R,[1/2**O,1/2**O,0])}}E.terrainRttPosMatrix32f=new Float32Array(R),d[v]=E}return d}_getTerrainCoordsForTileRanges(l,d){const v={};for(const w of this._renderableTilesKeys){const E=this._tiles[w].tileID;if(!this._isWithinTileRanges(E,d))continue;const R=l.clone(),O=s.bk();if(E.canonical.z===l.canonical.z){const $=l.canonical.x-E.canonical.x,W=l.canonical.y-E.canonical.y;s.c7(O,0,s.a5,s.a5,0,0,1),s.O(O,O,[$*s.a5,W*s.a5,0])}else if(E.canonical.z>l.canonical.z){const $=E.canonical.z-l.canonical.z,W=E.canonical.x-(E.canonical.x>>$<<$),K=E.canonical.y-(E.canonical.y>>$<<$),ce=l.canonical.x-(E.canonical.x>>$),oe=l.canonical.y-(E.canonical.y>>$),ge=s.a5>>$;s.c7(O,0,ge,ge,0,0,1),s.O(O,O,[-W*ge+ce*s.a5,-K*ge+oe*s.a5,0])}else{const $=l.canonical.z-E.canonical.z,W=l.canonical.x-(l.canonical.x>>$<<$),K=l.canonical.y-(l.canonical.y>>$<<$),ce=(l.canonical.x>>$)-E.canonical.x,oe=(l.canonical.y>>$)-E.canonical.y,ge=s.a5<<$;s.c7(O,0,ge,ge,0,0,1),s.O(O,O,[W*s.a5+ce*ge,K*s.a5+oe*ge,0])}R.terrainRttPosMatrix32f=new Float32Array(O),v[w]=R}return v}getSourceTile(l,d){const v=this.tileManager._source;let w=l.overscaledZ-this.deltaZoom;if(w>v.maxzoom&&(w=v.maxzoom),w<v.minzoom)return;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(w).key);let E=this.findTileInCaches(this._sourceTileCache[l.key]);if(!E?.dem&&d)for(;w>=v.minzoom&&!E?.dem;)E=this.findTileInCaches(l.scaledTo(w--).key);return E}findTileInCaches(l){let d=this.tileManager.getTileByID(l);return d||(d=this.tileManager._outOfViewCache.getByKey(l),d)}anyTilesAfterTime(l=Date.now()){return this._lastTilesetChange>=l}_isWithinTileRanges(l,d){return d[l.canonical.z]&&l.canonical.x>=d[l.canonical.z].minTileX&&l.canonical.x<=d[l.canonical.z].maxTileX&&l.canonical.y>=d[l.canonical.z].minTileY&&l.canonical.y<=d[l.canonical.z].maxTileY}}class Ir{constructor(l,d,v){this._meshCache={},this.painter=l,this.tileManager=new wf(d),this.options=v,this.exaggeration=typeof v.exaggeration=="number"?v.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,d,v,w=s.a5){var E;if(!(d>=0&&d<w&&v>=0&&v<w))return 0;const R=this.getTerrainData(l),O=(E=R.tile)===null||E===void 0?void 0:E.dem;if(!O)return 0;const $=s.cC([],[d/w*s.a5,v/w*s.a5],R.u_terrain_matrix),W=[$[0]*O.dim,$[1]*O.dim],K=Math.floor(W[0]),ce=Math.floor(W[1]),oe=W[0]-K,ge=W[1]-ce;return O.get(K,ce)*(1-oe)*(1-ge)+O.get(K+1,ce)*oe*(1-ge)+O.get(K,ce+1)*(1-oe)*ge+O.get(K+1,ce+1)*oe*ge}getElevationForLngLatZoom(l,d){if(!s.cD(d,l.wrap()))return 0;const{tileID:v,mercatorX:w,mercatorY:E}=this._getOverscaledTileIDFromLngLatZoom(l,d);return this.getElevation(v,w%s.a5,E%s.a5,s.a5)}getElevationForLngLat(l,d){const v=Vn(d,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let w=0;for(const E of v)E.canonical.z>w&&(w=Math.min(E.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(l,w)}getElevation(l,d,v,w=s.a5){return this.getDEMElevation(l,d,v,w)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const w=this.painter.context,E=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(w,E,w.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(w,new s.R({width:1,height:1}),w.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ar([])}const d=this.tileManager.getSourceTile(l,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const w=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new s.T(w,d.dem.getPixels(),w.gl.RGBA,{premultiply:!1}),d.demTexture.bind(w.gl.NEAREST,w.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const v=d&&d.toString()+d.tileID.key+l.key;if(v&&!this._demMatrixCache[v]){const w=this.tileManager.getSource().maxzoom;let E=l.canonical.z-d.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=w?E=l.canonical.z-w:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const R=l.canonical.x-(l.canonical.x>>E<<E),O=l.canonical.y-(l.canonical.y>>E<<E),$=s.cE(new Float64Array(16),[1/(s.a5<<E),1/(s.a5<<E),0]);s.O($,$,[R*s.a5,O*s.a5,0]),this._demMatrixCache[l.key]={matrix:$,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:v?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(l){const d=this.painter,v=d.width/devicePixelRatio,w=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===v&&this._fbo.height===w||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(d.context,{width:v,height:w,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(d.context,{width:v,height:w,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(v,w,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,v,w))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let E=0,R=0;E<this._coordsTextureSize;E++)for(let O=0;O<this._coordsTextureSize;O++,R+=4)d[R+0]=255&O,d[R+1]=255&E,d[R+2]=O>>8<<4|E>>8,d[R+3]=0;const v=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),w=new s.T(l,v,l.gl.RGBA,{premultiply:!1});return w.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=w,w}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),v=this.painter.context,w=v.gl,E=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),R=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),O=Math.round(this.painter.height/devicePixelRatio);v.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),w.readPixels(E,O-R-1,1,1,w.RGBA,w.UNSIGNED_BYTE,d),v.bindFramebuffer.set(null);const $=d[0]+(d[2]>>4<<8),W=d[1]+((15&d[2])<<8),K=this.coordsIndex[255-d[3]],ce=K&&this.tileManager.getTileByID(K);if(!ce)return null;const oe=this._coordsTextureSize,ge=(1<<ce.tileID.canonical.z)*oe;return new s.a9((ce.tileID.canonical.x*oe+$)/ge+ce.tileID.wrap,(ce.tileID.canonical.y*oe+W)/ge,this.getElevation(ce.tileID,$,W,oe))}depthAtPoint(l){const d=new Uint8Array(4),v=this.painter.context,w=v.gl;return v.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),w.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,w.RGBA,w.UNSIGNED_BYTE,d),v.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(l){var d;const v=((d=this.painter.style.projection)===null||d===void 0?void 0:d.transitionState)>0,w=v&&l.canonical.y===0,E=v&&l.canonical.y===(1<<l.canonical.z)-1,R=`m_${w?"n":""}_${E?"s":""}`;if(this._meshCache[R])return this._meshCache[R];const O=this.painter.context,$=new s.cF,W=new s.aY,K=this.meshSize,ce=s.a5/K,oe=K*K;for(let je=0;je<=K;je++)for(let at=0;at<=K;at++)$.emplaceBack(at*ce,je*ce,0);for(let je=0;je<oe;je+=K+1)for(let at=0;at<K;at++)W.emplaceBack(at+je,K+at+je+1,K+at+je+2),W.emplaceBack(at+je,K+at+je+2,at+je+1);const ge=$.length,be=ge+(K+1),Le=(K+1)*K,De=w?s.br:0,ke=w?0:1,Ne=E?s.bs:s.a5,He=E?0:1;for(let je=0;je<=K;je++)$.emplaceBack(je*ce,De,ke);for(let je=0;je<=K;je++)$.emplaceBack(je*ce,Ne,He);for(let je=0;je<K;je++)W.emplaceBack(Le+je,be+je,be+je+1),W.emplaceBack(Le+je,be+je+1,Le+je+1),W.emplaceBack(0+je,ge+je+1,ge+je),W.emplaceBack(0+je,0+je+1,ge+je+1);const ze=$.length,Ge=ze+2*(K+1);for(const je of[0,1])for(let at=0;at<=K;at++)for(const Tt of[0,1])$.emplaceBack(je*s.a5,at*ce,Tt);for(let je=0;je<2*K;je+=2)W.emplaceBack(ze+je,ze+je+1,ze+je+3),W.emplaceBack(ze+je,ze+je+3,ze+je+2),W.emplaceBack(Ge+je,Ge+je+3,Ge+je+1),W.emplaceBack(Ge+je,Ge+je+2,Ge+je+3);const Je=new On(O.createVertexBuffer($,l1.members),O.createIndexBuffer(W),s.aX.simpleSegment(0,0,$.length,W.length));return this._meshCache[R]=Je,Je}getMeshFrameDelta(l){return 2*Math.PI*s.bE/Math.pow(2,Math.max(l,0))/5}getMinTileElevationForLngLatZoom(l,d){var v;if(!s.cD(d,l.wrap()))return 0;const{tileID:w}=this._getOverscaledTileIDFromLngLatZoom(l,d);return(v=this.getMinMaxElevation(w).minElevation)!==null&&v!==void 0?v:0}getMinMaxElevation(l){const d=this.getTerrainData(l).tile,v={minElevation:null,maxElevation:null};return d&&d.dem&&(v.minElevation=d.dem.min*this.exaggeration,v.maxElevation=d.dem.max*this.exaggeration),v}_getOverscaledTileIDFromLngLatZoom(l,d){const v=s.a9.fromLngLat(l.wrap()),w=(1<<d)*s.a5,E=v.x*w,R=v.y*w,O=Math.floor(E/s.a5),$=Math.floor(R/s.a5);return{tileID:new s.a2(d,0,d,O,$),mercatorX:E,mercatorY:R}}}class Wr{constructor(l,d,v){this._context=l,this._size=d,this._tileSize=v,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),v=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return v.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(v.texture),{id:l,fbo:d,texture:v,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((d=>l.id!==d)),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((l=>!l.inUse))===!1}}const Vu={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Sf{constructor(l,d){this.painter=l,this.terrain=d,this.pool=new Wr(l.context,30,d.tileManager.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=l._order.filter((v=>!l._layers[v].isHidden(d))),this._coordsAscending={};for(const v in l.tileManagers){this._coordsAscending[v]={};const w=l.tileManagers[v].getVisibleCoordinates(),E=l.tileManagers[v].getSource(),R=E instanceof ct?E.terrainTileRanges:null;for(const O of w){const $=this.terrain.tileManager.getTerrainCoords(O,R);for(const W in $)this._coordsAscending[v][W]||(this._coordsAscending[v][W]=[]),this._coordsAscending[v][W].push($[W])}}this._coordsAscendingStr={};for(const v of l._order){const w=l._layers[v],E=w.source;if(Vu[w.type]&&!this._coordsAscendingStr[E]){this._coordsAscendingStr[E]={};for(const R in this._coordsAscending[E])this._coordsAscendingStr[E][R]=this._coordsAscending[E][R].map((O=>O.key)).sort().join()}}for(const v of this._renderableTiles)for(const w in this._coordsAscendingStr){const E=this._coordsAscendingStr[w][v.tileID.key];E&&E!==v.rttCoords[w]&&(v.rtt=[])}}renderLayer(l,d){if(l.isHidden(this.painter.transform.zoom))return!1;const v=Object.assign(Object.assign({},d),{isRenderingToTexture:!0}),w=l.type,E=this.painter,R=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(Vu[w]&&(this._prevType&&Vu[this._prevType]||this._stacks.push([]),this._prevType=w,this._stacks[this._stacks.length-1].push(l.id),!R))return!0;if(Vu[this._prevType]||Vu[w]&&R){this._prevType=w;const O=this._stacks.length-1,$=this._stacks[O]||[];for(const W of this._renderableTiles){if(this.pool.isFull()&&(b_(this.painter,this.terrain,this._rttTiles,v),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(W),W.rtt[O]){const ce=this.pool.getObjectForId(W.rtt[O].id);if(ce.stamp===W.rtt[O].stamp){this.pool.useObject(ce);continue}}const K=this.pool.getOrCreateFreeObject();this.pool.useObject(K),this.pool.stampObject(K),W.rtt[O]={id:K.id,stamp:K.stamp},E.context.bindFramebuffer.set(K.fbo.framebuffer),E.context.clear({color:s.bp.transparent,stencil:0}),E.currentStencilSource=void 0;for(let ce=0;ce<$.length;ce++){const oe=E.style._layers[$[ce]],ge=oe.source?this._coordsAscending[oe.source][W.tileID.key]:[W.tileID];E.context.viewport.set([0,0,K.fbo.width,K.fbo.height]),E._renderTileClippingMasks(oe,ge,!0),E.renderLayer(E,E.style.tileManagers[oe.source],oe,ge,v),oe.source&&(W.rttCoords[oe.source]=this._coordsAscendingStr[oe.source][W.tileID.key])}}return b_(this.painter,this.terrain,this._rttTiles,v),this._rttTiles=[],this.pool.freeAllObjects(),Vu[w]}return!1}}const am={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},R_=f,lm={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ua,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},k_={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Tf{constructor(l,d,v=!1){this.mousedown=E=>{this.startMove(E,k.mousePos(this.element,E)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.move(E,k.mousePos(this.element,E))},this.mouseup=E=>{this._rotatePitchHandler.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,E.targetTouches)[0],this.startMove(E,this._startPos),k.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,E.targetTouches)[0],this.move(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=d;const w=new C0;this._rotatePitchHandler=new Jh({clickTolerance:3,move:(E,R)=>{const O=d.getBoundingClientRect(),$=new s.P((O.bottom-O.top)/2,(O.right-O.left)/2);return{bearingDelta:s.cx(new s.P(E.x,R.y),R,$),pitchDelta:v?-.5*(R.y-E.y):void 0}},moveStateManager:w,enable:!0,assignEvents:()=>{}}),this.map=l,k.addEventListener(d,"mousedown",this.mousedown),k.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(d,"touchcancel",this.reset)}startMove(l,d){this._rotatePitchHandler.dragStart(l,d),k.disableDrag()}move(l,d){const v=this.map,{bearingDelta:w,pitchDelta:E}=this._rotatePitchHandler.dragMove(l,d)||{};w&&v.setBearing(v.getBearing()+w),E&&v.setPitch(v.getPitch()+E)}off(){const l=this.element;k.removeEventListener(l,"mousedown",this.mousedown),k.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend),k.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend)}}let nc;function cm(C,l,d,v=!1){if(v||!d.getCoveringTilesDetailsProvider().allowWorldCopies())return C?.wrap();const w=new s.V(C.lng,C.lat);if(C=new s.V(C.lng,C.lat),l){const E=new s.V(C.lng-360,C.lat),R=new s.V(C.lng+360,C.lat),O=d.locationToScreenPoint(C).distSqr(l);d.locationToScreenPoint(E).distSqr(l)<O?C=E:d.locationToScreenPoint(R).distSqr(l)<O&&(C=R)}for(;Math.abs(C.lng-d.center.lng)>180;){const E=d.locationToScreenPoint(C);if(E.x>=0&&E.y>=0&&E.x<=d.width&&E.y<=d.height)break;C.lng>d.center.lng?C.lng-=360:C.lng+=360}return C.lng!==w.lng&&d.isPointOnMapSurface(d.locationToScreenPoint(C))?C:w}const Mf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function um(C,l,d){const v=C.classList;for(const w in Mf)v.remove(`maplibregl-${d}-anchor-${w}`);v.add(`maplibregl-${d}-anchor-${l}`)}class Cf extends s.E{constructor(l){if(super(),this._onKeyPress=d=>{const v=d.code,w=d.charCode||d.keyCode;v!=="Space"&&v!=="Enter"&&w!==32&&w!==13||this.togglePopup()},this._onMapClick=d=>{const v=d.originalEvent.target,w=this._element;this._popup&&(v===w||w.contains(v))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();(d?.type==="terrain"||d?.type==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=cm(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${Mf[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${w}`),b.frameAsync(new AbortController).then((()=>{this._updateOpacity(d&&d.type==="moveend")})).catch((()=>{}))},this._onMove=d=>{if(!this._isDragging){const v=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=v}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._subpixelPositioning=l&&l.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(l?.opacity,l?.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div");const d=k.createNS("http://www.w3.org/2000/svg","svg"),v=41,w=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${v}px`),d.setAttributeNS(null,"width",`${w}px`),d.setAttributeNS(null,"viewBox",`0 0 ${w} ${v}`);const E=k.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const R=k.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const O=k.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");const $=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ke of $){const Ne=k.createNS("http://www.w3.org/2000/svg","ellipse");Ne.setAttributeNS(null,"opacity","0.04"),Ne.setAttributeNS(null,"cx","10.5"),Ne.setAttributeNS(null,"cy","5.80029008"),Ne.setAttributeNS(null,"rx",ke.rx),Ne.setAttributeNS(null,"ry",ke.ry),O.appendChild(Ne)}const W=k.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"fill",this._color);const K=k.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),W.appendChild(K);const ce=k.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"opacity","0.25"),ce.setAttributeNS(null,"fill","#000000");const oe=k.createNS("http://www.w3.org/2000/svg","path");oe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ce.appendChild(oe);const ge=k.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");const be=k.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Le=k.createNS("http://www.w3.org/2000/svg","circle");Le.setAttributeNS(null,"fill","#000000"),Le.setAttributeNS(null,"opacity","0.25"),Le.setAttributeNS(null,"cx","5.5"),Le.setAttributeNS(null,"cy","5.5"),Le.setAttributeNS(null,"r","5.4999962");const De=k.createNS("http://www.w3.org/2000/svg","circle");De.setAttributeNS(null,"fill","#FFFFFF"),De.setAttributeNS(null,"cx","5.5"),De.setAttributeNS(null,"cy","5.5"),De.setAttributeNS(null,"r","5.4999962"),be.appendChild(Le),be.appendChild(De),R.appendChild(O),R.appendChild(W),R.appendChild(ce),R.appendChild(ge),R.appendChild(be),d.appendChild(R),d.setAttributeNS(null,"height",v*this._scale+"px"),d.setAttributeNS(null,"width",w*this._scale+"px"),this._element.appendChild(d),this._offset=s.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(d=>{d.preventDefault()})),this._element.addEventListener("mousedown",(d=>{d.preventDefault()})),um(this._element,this._anchor,"marker"),l&&l.className)for(const d of l.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(l){return this.remove(),this._map=l,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",l._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),l.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.V.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const w=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(l){return this._subpixelPositioning=l,this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var d,v;const w=(d=this._map)===null||d===void 0?void 0:d.terrain,E=this._map.transform.isLocationOccluded(this._lngLat);if(!w||E){const ge=E?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ge&&(this._element.style.opacity=ge))}if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const R=this._map,O=R.terrain.depthAtPoint(this._pos),$=R.terrain.getElevationForLngLat(this._lngLat,R.transform);if(R.transform.lngLatToCameraDepth(this._lngLat,$)-O<.006)return void(this._element.style.opacity=this._opacity);const W=-this._offset.y/R.transform.pixelsPerMeter,K=Math.sin(R.getPitch()*Math.PI/180)*W,ce=R.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),oe=R.transform.lngLatToCameraDepth(this._lngLat,$+K)-ce>.006;!((v=this._popup)===null||v===void 0)&&v.isOpen()&&oe&&this._popup.remove(),this._element.style.opacity=oe?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,d){return(this._opacity===void 0||l===void 0&&d===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const D_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ed=0,Uu=!1;const F_={maxWidth:100,unit:"metric"};function Ef(C,l,d){const v=d&&d.maxWidth||100,w=C._container.clientHeight/2,E=C._container.clientWidth/2,R=C.unproject([E-v/2,w]),O=C.unproject([E+v/2,w]),$=Math.round(C.project(O).x-C.project(R).x),W=Math.min(v,$,C._container.clientWidth),K=R.distanceTo(O);if(d&&d.unit==="imperial"){const ce=3.2808*K;ce>5280?ju(l,W,ce/5280,C._getUIString("ScaleControl.Miles")):ju(l,W,ce,C._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?ju(l,W,K/1852,C._getUIString("ScaleControl.NauticalMiles")):K>=1e3?ju(l,W,K/1e3,C._getUIString("ScaleControl.Kilometers")):ju(l,W,K,C._getUIString("ScaleControl.Meters"))}function ju(C,l,d,v){const w=(function(E){const R=Math.pow(10,`${Math.floor(E)}`.length-1);let O=E/R;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:(function($){const W=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*W)/W})(O),R*O})(d);C.style.width=l*(w/d)+"px",C.innerHTML=`${w}&nbsp;${v}`}const O_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},hm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dm(C){if(C){if(typeof C=="number"){const l=Math.round(Math.abs(C)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,C),"top-left":new s.P(l,l),"top-right":new s.P(-l,l),bottom:new s.P(0,-C),"bottom-left":new s.P(l,-l),"bottom-right":new s.P(-l,-l),left:new s.P(C,0),right:new s.P(-C,0)}}if(C instanceof s.P||Array.isArray(C)){const l=s.P.convert(C);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:s.P.convert(C.center||[0,0]),top:s.P.convert(C.top||[0,0]),"top-left":s.P.convert(C["top-left"]||[0,0]),"top-right":s.P.convert(C["top-right"]||[0,0]),bottom:s.P.convert(C.bottom||[0,0]),"bottom-left":s.P.convert(C["bottom-left"]||[0,0]),"bottom-right":s.P.convert(C["bottom-right"]||[0,0]),left:s.P.convert(C.left||[0,0]),right:s.P.convert(C.right||[0,0])}}return dm(new s.P(0,0))}const z_=f;c.AJAXError=s.cI,c.Event=s.l,c.Evented=s.E,c.LngLat=s.V,c.MercatorCoordinate=s.a9,c.Point=s.P,c.addProtocol=s.cJ,c.config=s.c,c.removeProtocol=s.cK,c.AttributionControl=L_,c.BoxZoomHandler=Kh,c.CanvasSource=Q,c.CooperativeGesturesHandler=Mi,c.DoubleClickZoomHandler=I_,c.DragPanHandler=R0,c.DragRotateHandler=za,c.EdgeInsets=Lc,c.FullscreenControl=class extends s.E{constructor(C={}){super(),this._onFullscreenChange=()=>{var l;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=d?.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,C&&C.container&&(C.container instanceof HTMLElement?this._container=C.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const C=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon",C).setAttribute("aria-hidden","true"),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.title=C}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Ue,c.GeolocateControl=class extends s.E{constructor(C){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",l)),this._finish()}},this._updateCamera=l=>{const d=new s.V(l.coords.longitude,l.coords.latitude),v=l.coords.accuracy,w=this._map.getBearing(),E=s.e({bearing:w},this.options.fitBoundsOptions),R=Ee.fromLngLat(d,v);this._map.fitBounds(R,E,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const d=new s.V(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=l.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=l=>{if(this._map){if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Uu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(l=>l.preventDefault())),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=l=>{if(this._map){if(l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cf({element:this._dotElement}),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(d=>{const v=d?.[0]instanceof ResizeObserverEntry;d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||v||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))}))}},this.options=s.e({},D_,C)}onAdd(C){return this._map=C,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,(function*(l=!1){if(nc!==void 0&&!l)return nc;if(window.navigator.permissions===void 0)return nc=!!window.navigator.geolocation,nc;try{nc=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{nc=!!window.navigator.geolocation}return nc}))})().then((l=>this._finishSetupUI(l))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,ed=0,Uu=!1}_isOutOfMapMaxBounds(C){const l=this._map.getMaxBounds(),d=C.coords;return l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const C=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&C))return;const l=this._map.project(C),d=this._map.unproject([l.x+100,l.y]),v=C.distanceTo(d)/100,w=2*this._accuracy/v;this._circleElement.style.width=`${w.toFixed(2)}px`,this._circleElement.style.height=`${w.toFixed(2)}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ed--,Uu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ed++,ed>1?(C={maximumAge:6e5,timeout:0},Uu=!0):(C=this.options.positionOptions,Uu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.GlobeControl=class{constructor(){this._toggleProjection=()=>{var C;const l=(C=this._map.getProjection())===null||C===void 0?void 0:C.type;this._map.setProjection(l!=="mercator"&&l?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var C;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((C=this._map.getProjection())===null||C===void 0?void 0:C.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(C){return this._map=C,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=k.create("button","maplibregl-ctrl-globe",this._container),k.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},c.Hash=S_,c.ImageSource=ct,c.KeyboardHandler=Gn,c.LngLatBounds=Ee,c.LogoControl=k0,c.Map=class extends lo{constructor(C){var l,d;s.cG.mark(s.cH.create);const v=Object.assign(Object.assign(Object.assign({},lm),C),{canvasContextAttributes:Object.assign(Object.assign({},lm.canvasContextAttributes),C.canvasContextAttributes)});if(v.minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const w=new Hl,E=new ml;if(v.minZoom!==void 0&&w.setMinZoom(v.minZoom),v.maxZoom!==void 0&&w.setMaxZoom(v.maxZoom),v.minPitch!==void 0&&w.setMinPitch(v.minPitch),v.maxPitch!==void 0&&w.setMaxPitch(v.maxPitch),v.renderWorldCopies!==void 0&&w.setRenderWorldCopies(v.renderWorldCopies),v.transformConstrain!==null&&w.setConstrainOverride(v.transformConstrain),super(w,E,{bearingSnap:v.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new a1,this._controls=[],this._mapId=s.af(),this._lostContextStyle={style:null,images:null},this._contextLost=O=>{O.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const $ of Object.values(this.style._layers))if($.type==="custom"&&console.warn(`Custom layer with id '${$.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),$._listeners)for(const[W]of Object.entries($._listeners))console.warn(`Custom layer with id '${$.id}' had event listeners for event '${W}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new s.l("webglcontextlost",{originalEvent:O}))},this._contextRestored=O=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:O}))},this._onMapScroll=O=>{if(O.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=v.interactive,this._maxTileCacheSize=v.maxTileCacheSize,this._maxTileCacheZoomLevels=v.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},v.canvasContextAttributes),this._trackResize=v.trackResize===!0,this._bearingSnap=v.bearingSnap,this._centerClampedToGround=v.centerClampedToGround,this._refreshExpiredTiles=v.refreshExpiredTiles===!0,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions===!0,this._collectResourceTiming=v.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},am),v.locale),this._clickTolerance=v.clickTolerance,this._overridePixelRatio=v.pixelRatio,this._maxCanvasSize=v.maxCanvasSize,this._zoomLevelsToOverscale=v.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=v.transformCameraUpdate,this.transformConstrain=v.transformConstrain,this.cancelPendingTileRequestsWhileZooming=v.cancelPendingTileRequestsWhileZooming===!0,v.reduceMotion!==void 0&&(b.prefersReducedMotion=v.reduceMotion),this._imageQueueHandle=q.addThrottleControl((()=>this.isMoving())),this._requestManager=new U(v.transformRequest),typeof v.container=="string"){if(this._container=document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let O=!1;const $=w_((W=>{this._trackResize&&!this._removed&&(this.resize(W),this.redraw())}),50);this._resizeObserver=new ResizeObserver((W=>{O?$(W):O=!0})),this._resizeObserver.observe(this._container)}this.handlers=new om(this,v),this._hash=v.hash&&new S_(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,roll:v.roll}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,s.e({},v.fitBoundsOptions,{duration:0}))));const R=typeof v.style=="string"||((d=(l=v.style)===null||l===void 0?void 0:l.projection)===null||d===void 0?void 0:d.type)!=="globe";this.resize(null,R),this._localIdeographFontFamily=v.localIdeographFontFamily,this._validateStyle=v.validateStyle,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new L_(typeof v.attributionControl=="boolean"?void 0:v.attributionControl)),v.maplibreLogo&&this.addControl(new k0,v.logoPosition),this.on("style.load",(()=>{if(R||this._resizeTransform(),this.transform.unmodified){const O=s.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(O)}})),this.on("data",(O=>{this._update(O.dataType==="style"),this.fire(new s.l(`${O.dataType}data`,O))})),this.on("dataloading",(O=>{this.fire(new s.l(`${O.dataType}dataloading`,O))})),this.on("dataabort",(O=>{this.fire(new s.l("sourcedataabort",O))}))}_getMapId(){return this._mapId}setGlobalStateProperty(C,l){return this.style.setGlobalStateProperty(C,l),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(C,l){if(l===void 0&&(l=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=C.onAdd(this);this._controls.push(C);const v=this._controlPositions[l];return l.indexOf("bottom")!==-1?v.insertBefore(d,v.firstChild):v.appendChild(d),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(C);return l>-1&&this._controls.splice(l,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}coveringTiles(C){return Vn(this.transform,C)}calculateCameraOptionsFromTo(C,l,d,v){return v==null&&this.terrain&&(v=this.terrain.getElevationForLngLat(d,this.transform)),super.calculateCameraOptionsFromTo(C,l,d,v)}resize(C,l=!0){const[d,v]=this._containerDimensions(),w=this._getClampedPixelRatio(d,v);if(this._resizeCanvas(d,v,w),this.painter.resize(d,v,w),this.painter.overLimit()){const R=this.painter.context.gl;this._maxCanvasSize=[R.drawingBufferWidth,R.drawingBufferHeight];const O=this._getClampedPixelRatio(d,v);this._resizeCanvas(d,v,O),this.painter.resize(d,v,O)}this._resizeTransform(l);const E=!this._moving;return E&&(this.stop(),this.fire(new s.l("movestart",C)).fire(new s.l("move",C))),this.fire(new s.l("resize",C)),E&&this.fire(new s.l("moveend",C)),this}_resizeTransform(C=!0){var l;const[d,v]=this._containerDimensions();this.transform.resize(d,v,C),(l=this._requestedCameraState)===null||l===void 0||l.resize(d,v,C)}_getClampedPixelRatio(C,l){const{0:d,1:v}=this._maxCanvasSize,w=this.getPixelRatio(),E=C*w,R=l*w;return Math.min(E>d?d/E:1,R>v?v/R:1)*w}getPixelRatio(){var C;return(C=this._overridePixelRatio)!==null&&C!==void 0?C:devicePixelRatio}setPixelRatio(C){this._overridePixelRatio=C,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(C){return this.transform.setMaxBounds(Ee.convert(C)),this._update()}setMinZoom(C){if((C=C??-2)>=-2&&C<=this.transform.maxZoom){const l=this._getTransformForUpdate();return l.setMinZoom(C),this._applyUpdatedTransform(l),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C??22)>=this.transform.minZoom){const l=this._getTransformForUpdate();return l.setMaxZoom(C),this._applyUpdatedTransform(l),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.setMinPitch(C),this._update(),this.getPitch()<C&&this.setPitch(C),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(C>=this.transform.minPitch)return this.transform.setMaxPitch(C),this._update(),this.getPitch()>C&&this.setPitch(C),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.setRenderWorldCopies(C),this._update()}setTransformConstrain(C){return this.transform.setConstrainOverride(C),this._update()}project(C){return this.transform.locationToScreenPoint(s.V.convert(C),this.style&&this.terrain)}unproject(C){return this.transform.screenPointToLocation(s.P.convert(C),this.terrain)}isMoving(){var C;return this._moving||((C=this.handlers)===null||C===void 0?void 0:C.isMoving())}isZooming(){var C;return this._zooming||((C=this.handlers)===null||C===void 0?void 0:C.isZooming())}isRotating(){var C;return this._rotating||((C=this.handlers)===null||C===void 0?void 0:C.isRotating())}_createDelegatedListener(C,l,d){if(C==="mouseenter"||C==="mouseover"){let v=!1;return{layers:l,listener:d,delegates:{mousemove:E=>{const R=l.filter(($=>this.getLayer($))),O=R.length!==0?this.queryRenderedFeatures(E.point,{layers:R}):[];O.length?v||(v=!0,d.call(this,new Cs(C,this,E.originalEvent,{features:O}))):v=!1},mouseout:()=>{v=!1}}}}if(C==="mouseleave"||C==="mouseout"){let v=!1;return{layers:l,listener:d,delegates:{mousemove:R=>{const O=l.filter(($=>this.getLayer($)));(O.length!==0?this.queryRenderedFeatures(R.point,{layers:O}):[]).length?v=!0:v&&(v=!1,d.call(this,new Cs(C,this,R.originalEvent)))},mouseout:R=>{v&&(v=!1,d.call(this,new Cs(C,this,R.originalEvent)))}}}}{const v=w=>{const E=l.filter((O=>this.getLayer(O))),R=E.length!==0?this.queryRenderedFeatures(w.point,{layers:E}):[];R.length&&(w.features=R,d.call(this,w),delete w.features)};return{layers:l,listener:d,delegates:{[C]:v}}}}_saveDelegatedListener(C,l){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(l)}_removeDelegatedListener(C,l,d){if(!this._delegatedListeners||!this._delegatedListeners[C])return;const v=this._delegatedListeners[C];for(let w=0;w<v.length;w++){const E=v[w];if(E.listener===d&&E.layers.length===l.length&&E.layers.every((R=>l.includes(R)))){for(const R in E.delegates)this.off(R,E.delegates[R]);return void v.splice(w,1)}}}on(C,l,d){if(d===void 0)return super.on(C,l);const v=typeof l=="string"?[l]:l,w=this._createDelegatedListener(C,v,d);this._saveDelegatedListener(C,w);for(const E in w.delegates)this.on(E,w.delegates[E]);return{unsubscribe:()=>{this._removeDelegatedListener(C,v,d)}}}once(C,l,d){if(d===void 0)return super.once(C,l);const v=typeof l=="string"?[l]:l,w=this._createDelegatedListener(C,v,d);for(const E in w.delegates){const R=w.delegates[E];w.delegates[E]=(...O)=>{this._removeDelegatedListener(C,v,d),R(...O)}}this._saveDelegatedListener(C,w);for(const E in w.delegates)this.once(E,w.delegates[E]);return this}off(C,l,d){return d===void 0?super.off(C,l):(this._removeDelegatedListener(C,typeof l=="string"?[l]:l,d),this)}queryRenderedFeatures(C,l){if(!this.style)return[];let d;const v=C instanceof s.P||Array.isArray(C),w=v?C:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(v?{}:C)||{},w instanceof s.P||typeof w[0]=="number")d=[s.P.convert(w)];else{const E=s.P.convert(w[0]),R=s.P.convert(w[1]);d=[E,new s.P(R.x,E.y),R,new s.P(E.x,R.y),E]}return this.style.queryRenderedFeatures(d,l,this.transform)}querySourceFeatures(C,l){return this.style.querySourceFeatures(C,l)}setStyle(C,l){return(l=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(C,l))}setTransformRequest(C){return this._requestManager.setTransformRequest(C),this}_getUIString(C){const l=this._locale[C];if(l==null)throw new Error(`Missing UI string '${C}'`);return l}_updateStyle(C,l){var d,v;if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(C,l)));const w=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!C)),C?(this.style=new Jl(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C,l,w):this.style.loadJSON(C,l,w),this):((v=(d=this.style)===null||d===void 0?void 0:d.projection)===null||v===void 0||v.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Jl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,l){if(typeof C=="string"){const d=this._requestManager.transformRequest(C,"Style");s.j(d,new AbortController).then((v=>{this._updateDiff(v.data,l)})).catch((v=>{v&&this.fire(new s.k(v))}))}else typeof C=="object"&&this._updateDiff(C,l)}_updateDiff(C,l){try{this.style.setState(C,l)&&this._update(!0)}catch(d){s.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(C,l)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(C,l){return this._lazyInitEmptyStyle(),this.style.addSource(C,l),this._update(!0)}isSourceLoaded(C){const l=this.style&&this.style.tileManagers[C];if(l!==void 0)return l.loaded();this.fire(new s.k(new Error(`There is no tile manager with ID '${C}'`)))}setTerrain(C){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),C){const l=this.style.tileManagers[C.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${C.source}`);this.terrain===null&&l.reload();for(const d in this.style._layers){const v=this.style._layers[d];v.type==="hillshade"&&v.source===C.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),v.type==="color-relief"&&v.source===C.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ir(this.painter,l,C),this.painter.renderToTexture=new Sf(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=d=>{var v;d.dataType==="style"?this.terrain.tileManager.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==C.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((v=d.source)===null||v===void 0?void 0:v.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:C})),this}getTerrain(){var C,l;return(l=(C=this.terrain)===null||C===void 0?void 0:C.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const C=this.style&&this.style.tileManagers;for(const l of Object.values(C))if(!l.areTilesLoaded())return!1;return!0}removeSource(C){return this.style.removeSource(C),this._update(!0)}getSource(C){return this.style.getSource(C)}setSourceTileLodParams(C,l,d){if(d){const v=this.getSource(d);if(!v)throw new Error(`There is no source with ID "${d}", cannot set LOD parameters`);v.calculateTileZoom=yn(Math.max(1,C),Math.max(1,l))}else for(const v in this.style.tileManagers)this.style.tileManagers[v].getSource().calculateTileZoom=yn(Math.max(1,C),Math.max(1,l));return this._update(!0),this}refreshTiles(C,l){const d=this.style.tileManagers[C];if(!d)throw new Error(`There is no tile manager with ID "${C}", cannot refresh tile`);l===void 0?d.reload(!0):d.refreshTiles(l.map((v=>new s.ac(v.z,v.x,v.y))))}addImage(C,l,d={}){const{pixelRatio:v=1,sdf:w=!1,stretchX:E,stretchY:R,content:O,textFitWidth:$,textFitHeight:W}=d;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||s.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:K,height:ce,data:oe}=l,ge=l;return this.style.addImage(C,{data:new s.R({width:K,height:ce},new Uint8Array(oe)),pixelRatio:v,stretchX:E,stretchY:R,content:O,textFitWidth:$,textFitHeight:W,sdf:w,version:0,userImage:ge}),ge.onAdd&&ge.onAdd(this,C),this}}{const{width:K,height:ce,data:oe}=b.getImageData(l);this.style.addImage(C,{data:new s.R({width:K,height:ce},oe),pixelRatio:v,stretchX:E,stretchY:R,content:O,textFitWidth:$,textFitHeight:W,sdf:w,version:0})}}updateImage(C,l){const d=this.style.getImage(C);if(!d)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=l instanceof HTMLImageElement||s.b(l)?b.getImageData(l):l,{width:w,height:E,data:R}=v;if(w===void 0||E===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==d.data.width||E!==d.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const O=!(l instanceof HTMLImageElement||s.b(l));return d.data.replace(R,O),this.style.updateImage(C,d),this}getImage(C){return this.style.getImage(C)}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C){return q.getImage(this._requestManager.transformRequest(C,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(C,l){return this._lazyInitEmptyStyle(),this.style.addLayer(C,l),this._update(!0)}moveLayer(C,l){return this.style.moveLayer(C,l),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(C,l,d){return this.style.setLayerZoomRange(C,l,d),this._update(!0)}setFilter(C,l,d={}){return this.style.setFilter(C,l,d),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,l,d,v={}){return this.style.setPaintProperty(C,l,d,v),this._update(!0)}getPaintProperty(C,l){return this.style.getPaintProperty(C,l)}setLayoutProperty(C,l,d,v={}){return this.style.setLayoutProperty(C,l,d,v),this._update(!0)}getLayoutProperty(C,l){return this.style.getLayoutProperty(C,l)}setGlyphs(C,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(C,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(C,l,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(C,l,d,(v=>{v||this._update(!0)})),this}removeSprite(C){return this._lazyInitEmptyStyle(),this.style.removeSprite(C),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(C,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(C,l,(d=>{d||this._update(!0)})),this}setLight(C,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(C,l),this._update(!0)}getLight(){return this.style.getLight()}setSky(C,l={}){return this._lazyInitEmptyStyle(),this.style.setSky(C,l),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(C,l){return this.style.setFeatureState(C,l),this._update()}removeFeatureState(C,l){return this.style.removeFeatureState(C,l),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let C=0,l=0;return this._container&&(C=this._container.clientWidth||400,l=this._container.clientHeight||300),[C,l]}_setupContainer(){const C=this._container;C.classList.add("maplibregl-map");const l=this._canvasContainer=k.create("div","maplibregl-canvas-container",C);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),v=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],v);const w=this._controlContainer=k.create("div","maplibregl-control-container",C),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((R=>{E[R]=k.create("div",`maplibregl-ctrl-${R} `,w)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(C,l,d){this._canvas.width=Math.floor(d*C),this._canvas.height=Math.floor(d*l),this._canvas.style.width=`${C}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const C=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let l=null;this._canvas.addEventListener("webglcontextcreationerror",(v=>{l={requestedAttributes:C},v&&(l.statusMessage=v.statusMessage,l.type=v.type)}),{once:!0});let d=null;if(d=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,C):this._canvas.getContext("webgl2",C)||this._canvas.getContext("webgl",C),!d){const v="Failed to initialize WebGL";throw l?(l.message=v,new Error(JSON.stringify(l))):new Error(v)}this.painter=new w0(d,this.transform),L.testSupport(d)}migrateProjection(C,l){super.migrateProjection(C,l),this.painter.transform=C,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_render(C){var l,d,v,w,E;const R=this._idleTriggered?this._fadeDuration:0,O=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._removed)return;let $=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const ce=this.transform.zoom,oe=P();this.style.zoomHistory.update(ce,oe);const ge=new s.H(ce,{now:oe,fadeDuration:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),be=ge.crossFadingFactor();be===1&&be===this._crossFadingFactor||($=!0,this._crossFadingFactor=be),this.style.update(ge)}const W=((d=this.style.projection)===null||d===void 0?void 0:d.transitionState)>0!==O;(v=this.style.projection)===null||v===void 0||v.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((w=this.style.projection)===null||w===void 0?void 0:w.transitionState,(E=this.style.projection)===null||E===void 0?void 0:E.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||W)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,R,this._crossSourceCollisions,W),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:R,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cG.mark(s.cH.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||$)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const K=this._sourcesDirty||this._styleDirty||this._placementDirty;return K||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||K||(this._fullyLoaded=!0,s.cG.mark(s.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var C;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),q.removeThrottleControl(this._imageQueueHandle),(C=this._resizeObserver)===null||C===void 0||C.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l?.loseContext&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cG.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,b.frame(this._frameRequest,(C=>{s.cG.frame(C),this._frameRequest=null;try{this._render(C)}catch(l){if(!s.Z(l)&&!(function(d){return d.message===g_})(l))throw l}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}get version(){return R_}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(C){return this._lazyInitEmptyStyle(),this.style.setProjection(C),this._update(!0)}},c.MapMouseEvent=Cs,c.MapTouchEvent=mf,c.MapWheelEvent=M0,c.Marker=Cf,c.NavigationControl=class{constructor(C){this._updateZoomButtons=()=>{const l=this._map.getZoom(),d=l===this._map.getMaxZoom(),v=l===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(l,d)=>{const v=this._map._getUIString(`NavigationControl.${d}`);l.title=v,l.setAttribute("aria-label",v)},this.options=s.e({},k_,C),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(l=>l.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(l=>this._map.zoomIn({},{originalEvent:l}))),k.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(l=>this._map.zoomOut({},{originalEvent:l}))),k.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})})),this._compassIcon=k.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,l){const d=k.create("button",C,this._container);return d.type="button",d.addEventListener("click",l),d}},c.Popup=class extends s.E{constructor(C){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=k.create("div","maplibregl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const R of this.options.className.split(" "))this._container.classList.add(R);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=cm(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!l)return;const d=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationToScreenPoint(this._lngLat));let v=this.options.anchor;const w=dm(this.options.offset);if(!v){const R=this._container.offsetWidth,O=this._container.offsetHeight;let $;$=d.y+w.bottom.y<O?["top"]:d.y>this._map.transform.height-O?["bottom"]:[],d.x<R/2?$.push("left"):d.x>this._map.transform.width-R/2&&$.push("right"),v=$.length===0?"bottom":$.join("-")}let E=d.add(w[v]);this.options.subpixelPositioning||(E=E.round()),k.setTransform(this._container,`${Mf[v]} translate(${E.x}px,${E.y}px)`),um(this._container,v,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(O_),C)}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=s.V.convert(C),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(document.createTextNode(C))}setHTML(C){const l=document.createDocumentFragment(),d=document.createElement("body");let v;for(d.innerHTML=C;v=d.firstChild,v;)l.appendChild(v);return this.setDOMContent(l)}getMaxWidth(){var C;return(C=this._container)===null||C===void 0?void 0:C.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){return this._container&&this._container.classList.add(C),this}removeClassName(C){return this._container&&this._container.classList.remove(C),this}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){if(this._container)return this._container.classList.toggle(C)}setSubpixelPositioning(C){this.options.subpixelPositioning=C}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const C=this._container.querySelector(hm);C&&C.focus()}},c.RasterDEMTileSource=te,c.RasterTileSource=ve,c.ScaleControl=class{constructor(C){this._onMove=()=>{Ef(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,Ef(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},F_),C)}getDefaultPosition(){return"bottom-left"}onAdd(C){return this._map=C,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=rm,c.Style=Jl,c.TerrainControl=class{constructor(C){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=C}onAdd(C){return this._map=C,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=P0,c.TwoFingersTouchRotateHandler=A_,c.TwoFingersTouchZoomHandler=E_,c.TwoFingersTouchZoomRotateHandler=bf,c.VectorTileSource=ft,c.VideoSource=we,c.addSourceType=(C,l)=>s._(void 0,void 0,void 0,(function*(){if(de(C))throw new Error(`A source type called "${C}" already exists.`);((d,v)=>{ue[d]=v})(C,l)})),c.clearPrewarmedResources=function(){const C=zt;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(Oe),zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.createTileMesh=Lp,c.getMaxParallelImageRequests=function(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return ot().getRTLTextPluginStatus()},c.getVersion=function(){return z_},c.getWorkerCount=function(){return lt.workerCount},c.getWorkerUrl=function(){return s.c.WORKER_URL},c.importScriptInWorkers=function(C){return $t().broadcast("IS",C)},c.isTimeFrozen=function(){return M.isFrozen()},c.now=P,c.prewarm=function(){At().acquire(Oe)},c.restoreNow=function(){M.restoreNow()},c.setMaxParallelImageRequests=function(C){s.c.MAX_PARALLEL_IMAGE_REQUESTS=C},c.setNow=function(C){M.setNow(C)},c.setRTLTextPlugin=function(C,l){return ot().setRTLTextPlugin(C,l)},c.setWorkerCount=function(C){lt.workerCount=C},c.setWorkerUrl=function(C){s.c.WORKER_URL=C}}));var o=t;return o}))})(_x)),_x.exports}var f2=O6();const Io=Q$(f2),z6=v4({__proto__:null,default:Io},[f2]);function py(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>t!=null))}function hP(n){let e;return t=>{if(t)for(let i in t){let r=e?.[i],o=t[i];r!==o&&n(i,o,r)}else if(e)for(let i in e)n(i,void 0,e[i]);e=t}}function B6(n,...e){let t=[n];for(let i of e)if(i)Array.isArray(i)&&i[0]===n?t.push(...i.slice(1)):t.push(i);else continue;if(t.length!==1)return t.length===2?t[1]:t}function N6(n){return n===!0?["has","point_count"]:n===!1?["!",["has","point_count"]]:void 0}function Fg(n,e){return["case",["boolean",["feature-state","hover"],!1],e,n]}function Aw(n,e){en(e,!0);let t=st(e,"id",19,()=>_p("layer")),i=st(e,"source",3,void 0),r=st(e,"sourceLayer",3,void 0),o=st(e,"beforeId",3,void 0),c=st(e,"beforeLayerType",3,void 0),s=st(e,"paint",3,void 0),f=st(e,"layout",3,void 0),p=st(e,"filter",3,void 0),g=st(e,"applyToClusters",3,void 0),_=st(e,"requireSource",3,!0),x=st(e,"minzoom",3,void 0),b=st(e,"maxzoom",3,void 0),M=st(e,"manageHoverState",3,!1),P=st(e,"hovered",15),k=st(e,"interactive",3,!0),L=st(e,"hoverCursor",3,void 0),I=st(e,"eventsIfTopMost",3,!1),F=st(e,"children",3,void 0),N=st(e,"onclick",3,void 0),H=st(e,"ondblclick",3,void 0),Y=st(e,"oncontextmenu",3,void 0),q=st(e,"onmouseenter",3,void 0),U=st(e,"onmousemove",3,void 0),G=st(e,"onmouseleave",3,void 0);const j=S6(),B=Kt(Sc),ne=Kt(()=>ee(B).loaded),{layer:J}=R6(),le=Kt(Sc),ae=Kt(()=>ee(le).map),pe=Kt(()=>ee(le).eventTopMost),fe=Kt(()=>ee(le).layerInfo),Te=Kt(()=>ee(le).minzoom),Ce=Kt(()=>ee(le).maxzoom);xa(()=>{J.value&&ee(ae)&&(ee(fe).delete(J.value),ee(ae).removeLayer(J.value))});let tt;function Ke(Ee){if(!k()||!J.value||!ee(ae)||I()&&ee(pe)(Ee)!==J.value)return;let xe=Ee.features??[],ft=xe[0]?.properties?.cluster_id,ve={event:Ee,map:ee(ae),clusterId:ft,layer:J.value,source:ee($t),features:xe};switch(Ee.type){case"click":N()?.(ve);break;case"dblclick":H()?.(ve);break;case"contextmenu":Y()?.(ve);break}}function dt(Ee){if(!k()||!J.value||!ee(ae)||I()&&ee(pe)(Ee)!==J.value)return;L()&&(ee(ae).getCanvas().style.cursor=L());let xe=Ee.features??[];P(xe[0]??void 0);let ft=xe[0]?.properties?.cluster_id,ve={event:Ee,map:ee(ae),clusterId:ft,layer:J.value,source:ee($t),features:xe};q()?.(ve)}function et(Ee){if(!k()||!ee(ae))return;if(I()&&ee(pe)(Ee)!==J.value){P(void 0),M()&&tt!==void 0&&(ee(ae).setFeatureState({source:ee($t),sourceLayer:r(),id:tt},{hover:!1}),tt=void 0);return}L()&&(ee(ae).getCanvas().style.cursor=L());let xe=Ee.features??[],ft=xe[0]?.properties?.cluster_id,ve=xe[0]?.id;ve!==tt&&(M()&&(tt!==void 0&&ee(ae).setFeatureState({source:ee($t),id:tt,sourceLayer:r()},{hover:!1}),ee(ae).setFeatureState({source:ee($t),id:ve,sourceLayer:r()},{hover:!0})),tt=ve,P(xe[0]??void 0)),U()?.({event:Ee,map:ee(ae),clusterId:ft,layer:J.value,source:ee($t),features:xe})}function Oe(Ee){if(!(!k()||!J.value||!ee(ae))){if(L()&&(ee(ae).getCanvas().style.cursor=""),P(void 0),M()&&tt!==void 0){const xe={source:ee($t),id:tt,sourceLayer:r()};ee(ae).setFeatureState(xe,{hover:!1}),tt=void 0}G()?.({map:ee(ae),layer:J.value,source:ee($t)})}}let lt=ii(!0);function Ye(Ee){ee(ae)&&(ee(ae).off("click",Ee,Ke),ee(ae).off("dblclick",Ee,Ke),ee(ae).off("contextmenu",Ee,Ke),ee(ae).off("mouseenter",Ee,dt),ee(ae).off("mousemove",Ee,et),ee(ae).off("mouseleave",Ee,Oe))}xa(()=>{J.value&&Ye(J.value)});let zt=Kt(()=>N6(g())),Lt=Kt(()=>B6("all",ee(zt),p())),At=Kt(()=>x()??ee(Te)),Nt=Kt(()=>b()??ee(Ce)),$t=Kt(()=>i()||j?.value);cn(()=>{if(ee(ae)&&J.value!==t()&&ee(ne)&&(ee($t)||!_())){J.value&&(Ye(J.value),ee(fe).delete(J.value));let Ee=o();if(!o()&&c()){let xe=ee(ae).getStyle().layers,ft=typeof c()=="function"?c():te=>te.type===c(),ve=xe?.find(ft);ve&&(Ee=ve.id)}J.value=t(),ee(ae).addLayer(py({id:J.value,type:e.type,source:ee($t),"source-layer":r(),filter:ee(Lt),paint:s(),layout:f(),minzoom:ee(At),maxzoom:ee(Nt)}),Ee),yt(lt,!0),ee(ae).on("click",J.value,Ke),ee(ae).on("dblclick",J.value,Ke),ee(ae).on("contextmenu",J.value,Ke),ee(ae).on("mouseenter",J.value,dt),ee(ae).on("mousemove",J.value,et),ee(ae).on("mouseleave",J.value,Oe)}}),cn(()=>{J.value&&ee(fe).set(J.value,{interactive:k()})});let Ze=Kt(()=>J.value?hP((Ee,xe)=>{ee(ae)&&(ee(ae).style._loaded?ee(ae).setPaintProperty(J.value,Ee,xe):ee(ae).once("styledata",()=>ee(ae).setPaintProperty(J.value,Ee,xe)))}):void 0),bt=Kt(()=>J.value?hP((Ee,xe)=>{ee(ae)&&(ee(ae).style._loaded?ee(ae).setLayoutProperty(J.value,Ee,xe):ee(ae).once("styledata",()=>ee(ae).setLayoutProperty(J.value,Ee,xe)))}):void 0);cn(()=>{ee(Ze)?.(s())}),cn(()=>{ee(bt)?.(f())}),cn(()=>{J.value&&ee(ae)&&ee(ae).setLayerZoomRange(J.value,ee(At),ee(Nt))}),cn(()=>{J.value&&ee(ae)&&(ee(lt)?yt(lt,!1):ee(ae).setFilter(J.value,ee(Lt)))});var Mt=tr(),Zt=ui(Mt);{var Pt=Ee=>{var xe=tr(),ft=ui(xe);Hy(ft,()=>J.value,ve=>{var te=tr(),se=ui(te);xs(se,()=>F()??ls),pt(ve,te)}),pt(Ee,xe)};Ki(Zt,Ee=>{J.value&&Ee(Pt)})}pt(n,Mt),tn()}function ru(n,e){en(e,!0);let t=st(e,"id",19,()=>_p("circle")),i=st(e,"source",3,void 0),r=st(e,"sourceLayer",3,void 0),o=st(e,"beforeId",3,void 0),c=st(e,"beforeLayerType",3,void 0),s=st(e,"layout",3,void 0),f=st(e,"filter",3,void 0),p=st(e,"applyToClusters",3,void 0),g=st(e,"minzoom",3,void 0),_=st(e,"maxzoom",3,void 0),x=st(e,"hoverCursor",3,void 0),b=st(e,"manageHoverState",3,!1),M=st(e,"hovered",15),P=st(e,"eventsIfTopMost",3,!1),k=st(e,"interactive",3,!0),L=st(e,"children",3,void 0),I=st(e,"onclick",3,void 0),F=st(e,"ondblclick",3,void 0),N=st(e,"oncontextmenu",3,void 0),H=st(e,"onmouseenter",3,void 0),Y=st(e,"onmousemove",3,void 0),q=st(e,"onmouseleave",3,void 0);Aw(n,{get id(){return t()},type:"circle",get source(){return i()},get sourceLayer(){return r()},get beforeId(){return o()},get beforeLayerType(){return c()},get paint(){return e.paint},get layout(){return s()},get filter(){return f()},get applyToClusters(){return p()},get minzoom(){return g()},get maxzoom(){return _()},get hoverCursor(){return x()},get manageHoverState(){return b()},get eventsIfTopMost(){return P()},get interactive(){return k()},get onclick(){return I()},get ondblclick(){return F()},get oncontextmenu(){return N()},get onmouseenter(){return H()},get onmousemove(){return Y()},get onmouseleave(){return q()},get hovered(){return M()},set hovered(U){M(U)},children:(U,G)=>{var j=tr(),B=ui(j);xs(B,()=>L()??ls),pt(U,j)},$$slots:{default:!0}}),tn()}var $6=Xt("<div><!></div>");function Dk(n,e){en(e,!0);let t=st(e,"defaultStyling",3,!0),i=st(e,"position",3,"top-right"),r=st(e,"class",3,void 0);const o=Kt(Sc),c=Kt(()=>ee(o).map);let s=ii(void 0),f={onAdd(){return ee(s)},onRemove(){ee(s)?.parentNode?.removeChild(ee(s))}};cn(()=>{ee(c)?.addControl(f,i())}),xa(()=>{ee(c)?.removeControl(f)});var p=$6();let g;var _=Bt(p);xs(_,()=>e.children??ls),vc(p,x=>yt(s,x),()=>ee(s)),Ji(()=>g=lp(p,1,HR(r()),null,g,{"maplibregl-ctrl":t()})),pt(n,p),tn()}ps(["click"]);function p2(n,e){en(e,!0);let t=st(e,"id",19,()=>_p("fill")),i=st(e,"source",3,void 0),r=st(e,"sourceLayer",3,void 0),o=st(e,"beforeId",3,void 0),c=st(e,"beforeLayerType",3,void 0),s=st(e,"layout",3,void 0),f=st(e,"filter",3,void 0),p=st(e,"minzoom",3,void 0),g=st(e,"maxzoom",3,void 0),_=st(e,"hoverCursor",3,void 0),x=st(e,"manageHoverState",3,!1),b=st(e,"hovered",15),M=st(e,"eventsIfTopMost",3,!1),P=st(e,"interactive",3,!0),k=st(e,"onclick",3,void 0),L=st(e,"ondblclick",3,void 0),I=st(e,"oncontextmenu",3,void 0),F=st(e,"onmouseenter",3,void 0),N=st(e,"onmousemove",3,void 0),H=st(e,"onmouseleave",3,void 0);Aw(n,{get id(){return t()},type:"fill",get source(){return i()},get sourceLayer(){return r()},get beforeId(){return o()},get beforeLayerType(){return c()},get paint(){return e.paint},get layout(){return s()},get filter(){return f()},get minzoom(){return p()},get maxzoom(){return g()},get hoverCursor(){return _()},get manageHoverState(){return x()},get eventsIfTopMost(){return M()},get interactive(){return P()},get onclick(){return k()},get ondblclick(){return L()},get oncontextmenu(){return I()},get onmouseenter(){return F()},get onmousemove(){return N()},get onmouseleave(){return H()},get hovered(){return b()},set hovered(Y){b(Y)},children:(Y,q)=>{var U=tr(),G=ui(U);xs(G,()=>e.children??ls),pt(Y,U)},$$slots:{default:!0}}),tn()}function V6(n,e){en(e,!0);const t=Kt(Sc),i=Kt(()=>ee(t).map),r=Kt(()=>ee(t).loaded);let o=st(e,"position",3,"top-left"),c=st(e,"container",3,void 0),s=ii(void 0),f=Kt(()=>typeof c()=="string"?document.querySelector(c())??void 0:c());cn(()=>{ee(i)&&!ee(s)&&(ee(f)?yt(s,new Io.FullscreenControl({container:ee(f)}),!0):yt(s,new Io.FullscreenControl,!0),ee(i).addControl(ee(s),o()))}),xa(()=>{ee(r)&&ee(s)&&ee(i)?.removeControl(ee(s))}),tn()}function Fk(n,e,t,i,r){let o=!1;n.getSource(e)&&(o=!0,n.removeSource(e));const c=()=>{i(e)&&(n.addSource(e,t),r())};if(o){const s=()=>{e&&(n.getSource(e)?setTimeout(s,1):c())};s()}else c()}function Ok(n,e,t){VR().then(()=>{if(!n.loaded())return;n.getSource(e)===t&&n.removeSource(e)})}function Hs(n,e){en(e,!0);let t=st(e,"id",19,()=>_p("geojson")),i=st(e,"generateId",3,!1),r=st(e,"promoteId",3,void 0),o=st(e,"filter",3,void 0),c=st(e,"lineMetrics",3,void 0),s=st(e,"cluster",3,void 0),f=st(e,"maxzoom",3,void 0),p=st(e,"attribution",3,void 0),g=st(e,"buffer",3,void 0),_=st(e,"tolerance",3,void 0);const x=Kt(Sc),b=Kt(()=>ee(x).map),M=Kt(()=>ee(x).loaded),{source:P}=Rk();let k=ii(void 0),L=ii(!0);cn(()=>{ee(b)&&ee(M)&&P.value!==t()&&(P.value=t(),Fk(ee(b),P.value,py({type:"geojson",data:e.data,filter:o(),lineMetrics:c(),generateId:i(),promoteId:r(),cluster:!!s(),clusterMinPoints:s()?.minPoints,clusterMaxZoom:s()?.maxZoom,clusterRadius:s()?.radius,clusterProperties:s()?.properties,maxzoom:f(),attribution:p(),buffer:g(),tolerance:_()}),Y=>ee(b)&&Y===P.value,()=>{P.value&&(yt(k,ee(b).getSource(P.value),!0),yt(L,!0))}),ee(k))}),cn(()=>{ee(k)&&(ee(L)?yt(L,!1):ee(k).setData(e.data))});function I(){ee(b)&&yt(k,ee(b).getSource(t()),!0)}cn(()=>{ee(b)?.on("style.load",I)}),cn(()=>{ee(k)?.setClusterOptions(py({cluster:!!s(),clusterMaxZoom:s()?.maxZoom,clusterRadius:s()?.radius}))}),xa(()=>{P.value&&ee(k)&&ee(b)&&(Ok(ee(b),P.value,ee(k)),P.value=void 0,yt(k,void 0))});var F=tr(),N=ui(F);{var H=Y=>{var q=tr(),U=ui(q);Hy(U,()=>P.value,G=>{var j=tr(),B=ui(j);xs(B,()=>e.children??ls),pt(G,j)}),pt(Y,q)};Ki(N,Y=>{P.value&&Y(H)})}pt(n,F),tn()}function U6(n,e){en(e,!0);const t=Kt(Sc),i=Kt(()=>ee(t).map),r=Kt(()=>ee(t).loaded);let o=st(e,"position",3,"top-left"),c=st(e,"positionOptions",3,void 0),s=st(e,"fitBoundsOptions",3,void 0),f=st(e,"trackUserLocation",3,!1),p=st(e,"showAccuracyCircle",3,!0),g=st(e,"showUserLocation",3,!0),_=st(e,"control",15);cn(()=>{ee(i)&&!_()&&(_(new Io.GeolocateControl({positionOptions:c(),fitBoundsOptions:s(),trackUserLocation:f(),showAccuracyCircle:p(),showUserLocation:g()})),ee(i).addControl(_(),o()))}),xa(()=>{ee(r)&&_()&&ee(i)?.removeControl(_())}),tn()}function Fl(n,e){en(e,!0);let t=st(e,"id",19,()=>_p("line")),i=st(e,"source",3,void 0),r=st(e,"sourceLayer",3,void 0),o=st(e,"beforeId",3,void 0),c=st(e,"beforeLayerType",3,void 0),s=st(e,"layout",3,void 0),f=st(e,"filter",3,void 0),p=st(e,"minzoom",3,void 0),g=st(e,"maxzoom",3,void 0),_=st(e,"hoverCursor",3,void 0),x=st(e,"manageHoverState",3,!1),b=st(e,"hovered",15),M=st(e,"eventsIfTopMost",3,!1),P=st(e,"interactive",3,!0),k=st(e,"children",3,void 0),L=st(e,"onclick",3,void 0),I=st(e,"ondblclick",3,void 0),F=st(e,"oncontextmenu",3,void 0),N=st(e,"onmouseenter",3,void 0),H=st(e,"onmousemove",3,void 0),Y=st(e,"onmouseleave",3,void 0);Aw(n,{get id(){return t()},type:"line",get source(){return i()},get sourceLayer(){return r()},get beforeId(){return o()},get beforeLayerType(){return c()},get paint(){return e.paint},get layout(){return s()},get filter(){return f()},get minzoom(){return p()},get maxzoom(){return g()},get hoverCursor(){return _()},get manageHoverState(){return x()},get eventsIfTopMost(){return M()},get interactive(){return P()},get onclick(){return L()},get ondblclick(){return I()},get oncontextmenu(){return F()},get onmouseenter(){return N()},get onmousemove(){return H()},get onmouseleave(){return Y()},get hovered(){return b()},set hovered(q){b(q)},children:(q,U)=>{var G=tr(),j=ui(G);xs(j,()=>k()??ls),pt(q,G)},$$slots:{default:!0}}),tn()}function zk(n,e){en(e,!0);let t=st(e,"layer",3,void 0),i=Y$(e,["$$slots","$$events","$$legacy","layer"]);const r=Kt(Sc),o=Kt(()=>ee(r).map);function c(g){return i["on"+g]}function s(g){c(g.type)?.(g)}const f=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend","pitch","rotate","wheel","data","styledata","idle"];cn(()=>{if(ee(o))if(t())for(const g of f)c(g)&&ee(o).on(g,t(),s);else for(const g of p)c(g)&&ee(o).on(g,s)}),xa(()=>{if(ee(o))if(t())for(const g of f)c(g)&&ee(o).off(g,t(),s);else for(const g of p)c(g)&&ee(o).off(g,s)}),tn()}function j6(n){let e=n.getCenter(),t=Math.round(n.getZoom()*100)/100,i=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),o=Math.round(e.lat*r)/r,c=Math.round(e.lng*r)/r,s=`${t}/${o}/${c}`,f=n.getBearing(),p=n.getPitch();return(f||p)&&(s+=`/${Math.round(f*10)/10}`),p&&(s+=`/${Math.round(p)}`),`#${s}`}function G6(n){const e=n.replace("#","").split("/").map(parseFloat);return e.some(isNaN)?[]:e}var ov=m2;function m2(n,e){return n===e||n!==n&&e!==e?!0:typeof n!=typeof e||{}.toString.call(n)!={}.toString.call(e)||n!==Object(n)||!n?!1:Array.isArray(n)?dP(n,e):{}.toString.call(n)=="[object Set]"?dP(Array.from(n),Array.from(e)):{}.toString.call(n)=="[object Object]"?H6(n,e):q6(n,e)}function q6(n,e){return n.toString()===e.toString()}function dP(n,e){var t=n.length;if(t!=e.length)return!1;for(var i=0;i<t;i++)if(!m2(n[i],e[i]))return!1;return!0}function H6(n,e){var t=Object.keys(n),i=t.length;if(i!=Object.keys(e).length)return!1;for(var r=0;r<i;r++){var o=t[r];if(!(e.hasOwnProperty(o)&&m2(n[o],e[o])))return!1}return!0}const{LngLatBounds:W6,LngLat:Z6}=Io;function db(n,e){return Math.abs(n-e)<1e-6}function X6(n,e){let t=W6.convert(n);if(!e)return{equal:!1,bounds:t};let i=t.getNorthEast(),r=e.getNorthEast();if(!db(i.lat,r.lat)||!db(i.wrap().lng,r.wrap().lng))return{equal:!1,bounds:t};let o=t.getSouthWest(),c=e.getSouthWest();return!db(o.lat,c.lat)||!db(o.wrap().lng,c.wrap().lng)?{equal:!1,bounds:t}:{equal:!0,bounds:t}}function Y6(n,e){const t=n.getSouthWest(),i=n.getNorthEast();if(Array.isArray(e)){if(e.length===4)return[t.lng,t.lat,i.lng,i.lat];if(e.length===2)return e[0]instanceof Z6?[t,i]:[[t.lng,t.lat],[i.lng,i.lat]]}return n}function Bk(n,e){en(e,!0);const t=Kt(Sc),i=Kt(()=>ee(t).map),r=Kt(()=>ee(t).loaded);let o=st(e,"position",3,"top-left"),c=st(e,"showCompass",3,!0),s=st(e,"showZoom",3,!0),f=st(e,"visualizePitch",3,!1),p=ii(void 0);XM(()=>{ee(i)&&!ee(p)&&(yt(p,new Io.NavigationControl({showCompass:c(),showZoom:s(),visualizePitch:f()}),!0),ee(i).addControl(ee(p),o()))}),xa(()=>{ee(r)&&ee(p)&&ee(i)?.removeControl(ee(p))}),tn()}function Nk(n,e){en(e,!0);const t=Kt(Sc),i=Kt(()=>ee(t).map),r=Kt(()=>ee(t).loaded);let o=st(e,"position",3,"bottom-left"),c=st(e,"maxWidth",3,void 0),s=st(e,"unit",3,"metric"),f=ii(void 0);cn(()=>{ee(i)&&!ee(f)&&(yt(f,new Io.ScaleControl({maxWidth:c(),unit:s()}),!0),ee(i).addControl(ee(f),o()))}),xa(()=>{ee(r)&&ee(f)&&ee(i)?.removeControl(ee(f))}),tn()}var K6=Xt("<!> <!> <!> <!>",1),J6=Xt("<!> <!>",1),Q6=Xt('<div data-testid="map-container"><!></div>');function eV(n,e){en(e,!0);let t=st(e,"map",15,void 0),i=st(e,"mapContainer",15,void 0),r=st(e,"class",3,void 0),o=st(e,"diffStyleUpdates",3,!1),c=st(e,"center",15,void 0),s=st(e,"zoom",15,void 0),f=st(e,"pitch",15,0),p=st(e,"bearing",15,0),g=st(e,"bearingSnap",3,7),_=st(e,"bounds",15,void 0),x=st(e,"fitBoundsOptions",19,()=>({})),b=st(e,"hash",3,!1),M=st(e,"projection",3,void 0),P=st(e,"updateHash",3,xe=>{window.history.replaceState(window.history.state,"",xe)}),k=st(e,"loaded",15,!1),L=st(e,"minZoom",3,0),I=st(e,"maxZoom",3,22),F=st(e,"minPitch",3,0),N=st(e,"maxPitch",3,60),H=st(e,"renderWorldCopies",3,void 0),Y=st(e,"dragPan",3,void 0),q=st(e,"dragRotate",3,void 0),U=st(e,"pitchWithRotate",3,void 0),G=st(e,"antialias",3,void 0),j=st(e,"zoomOnDoubleClick",3,!0),B=st(e,"locale",3,void 0),ne=st(e,"interactive",3,!0),J=st(e,"attributionControl",3,void 0),le=st(e,"cooperativeGestures",3,!1),ae=st(e,"preserveDrawingBuffer",3,!1),pe=st(e,"maxBounds",3,void 0),fe=st(e,"images",19,()=>[]),Te=st(e,"standardControls",3,!1),Ce=st(e,"filterLayers",3,void 0),tt=st(e,"transformRequest",3,void 0),Ke=Kt(()=>typeof Te()=="boolean"?void 0:Te());const dt=L6();Ck(new fy(void 0));let et=ii(bs(new Set));async function Oe(xe,ft=!1){if(t()&&!(!t()?.loaded()&&!ft))if("url"in xe){ee(et).add(xe.id);try{let ve=await t().loadImage(xe.url);t().addImage(xe.id,ve.data,xe.options),dt.loadedImages.add(xe.id)}catch(ve){e.onerror?e.onerror({error:ve}):console.error(ve)}finally{ee(et).delete(xe.id)}}else t().addImage(xe.id,xe.data,xe.options),dt.loadedImages.add(xe.id)}cn(()=>{if(k()&&t()?.loaded())for(let xe of fe())!dt.loadedImages.has(xe.id)&&!ee(et).has(xe.id)&&!t().hasImage(xe.id)&&Oe(xe)});let lt=Kt(()=>fe().every(xe=>dt.loadedImages.has(xe.id))),Ye=ii(void 0),zt=ii(void 0),Lt=ii(void 0),At=ii(void 0);function Nt(xe){e.onerror?e.onerror(xe):xe.error.name!=="AbortError"&&console.error(xe.error)}function $t(xe){return bt(),t(dt.map=new Io.Map(py({container:xe,style:e.style,locale:B(),center:c(),zoom:s(),pitch:f(),bearing:p(),bearingSnap:g(),minZoom:L(),maxZoom:I(),minPitch:F(),maxPitch:N(),renderWorldCopies:H(),dragPan:Y(),dragRotate:q(),pitchWithRotate:U(),antialias:G(),interactive:ne(),preserveDrawingBuffer:ae(),maxBounds:pe(),bounds:_(),attributionControl:J(),transformRequest:tt(),cooperativeGestures:le()}))),t().on("load",ft=>{ft.target.getContainer().setAttribute("data-testid","map"),ft.target.getCanvas().setAttribute("data-testid","map-canvas"),e.onload&&e.onload(t()),dt.loaded=!0,k(!0)}),t().on("error",Nt),e.onmovestart&&t().on("movestart",e.onmovestart),t().on("moveend",ft=>{if(c(ft.target.getCenter()),s(ft.target.getZoom()),f(ft.target.getPitch()),p(ft.target.getBearing()),_(Y6(ft.target.getBounds(),_())),e.onmoveend?.(ft),b()){let ve=new URL(window.location.href.replace(/(#.+)?$/,j6(ft.target)));P()(ve)}}),e.onclick&&t().on("click",e.onclick),e.ondblclick&&t().on("dblclick",e.ondblclick),e.oncontextmenu&&t().on("contextmenu",e.oncontextmenu),e.onmousemove&&t().on("mousemove",e.onmousemove),e.onzoomstart&&t().on("zoomstart",e.onzoomstart),e.onzoom&&t().on("zoom",e.onzoom),e.onzoomend&&t().on("zoomend",e.onzoomend),e.onpitch&&t().on("pitch",e.onpitch),e.onrotate&&t().on("rotate",e.onrotate),e.onwheel&&t().on("wheel",e.onwheel),e.ondata&&t().on("data",e.ondata),e.onidle&&t().on("idle",e.onidle),t().on("style.load",ft=>{if(t()){M()&&t().setProjection(M()),dt.loaded=!0,k(!0);const ve=t().getStyle();if(yt(Ye,ve.layers.map(te=>te.id),!0),yt(zt,Object.keys(ve.sources),!0),ee(At))for(const[te,se]of Object.entries(ee(At)))t().addSource(te,se);if(ee(Lt))for(const te of ee(Lt))t().addLayer(te);for(const te of fe())Oe(te,!0);e.onstyleload?.(ft)}}),t().on("styledata",ft=>{if(t()&&Ce()){const ve=t().getStyle().layers;if(ve)for(let te of ve)Ce()(te)||t().setLayoutProperty(te.id,"visibility","none")}e.onstyledata?.(ft)}),{destroy(){k(!1),dt.loaded=!1,t()?.remove()}}}let Ze=ii(bs(e.style));cn(()=>{if(t()&&!ov(e.style,ee(Ze))){const xe=t().getStyle();if(ee(Ye)&&yt(Lt,xe.layers.filter(ft=>!ee(Ye).includes(ft.id)),!0),ee(zt)){const ft=Object.keys(xe.sources).filter(ve=>!ee(zt).includes(ve));yt(At,{},!0);for(const ve of ft)ee(At)[ve]=xe.sources[ve]}yt(Ze,e.style,!0),t().setStyle(e.style,{diff:o()}),dt.loadedImages.clear(),yt(et,new Set,!0)}}),cn(()=>{if(t()){let xe={};c()!=null&&!ov(c(),t().getCenter())&&(xe.center=c()),s()!=null&&!ov(s(),t().getZoom())&&(xe.zoom=s()),p()!=null&&!ov(p(),t().getBearing())&&(xe.bearing=p()),f()!=null&&!ov(f(),t().getPitch())&&(xe.pitch=f()),Object.keys(xe).length&&t().easeTo(xe)}}),cn(()=>{M()&&k()&&t()?.setProjection(M())}),cn(()=>{if(_()){const{equal:xe,bounds:ft}=X6(_(),t()?.getBounds());xe||t()?.fitBounds(ft,x())}}),cn(()=>{j()?t()?.doubleClickZoom.enable():t()?.doubleClickZoom.disable()});function bt(){if(b()){let xe=G6(window.location.hash);xe.length>=3&&(s(xe[0]),c([xe[2],xe[1]])),xe.length==5&&(p(xe[3]),f(xe[4]))}}var Mt=Q6();JM("hashchange",ly,bt);let Zt;var Pt=Bt(Mt);{var Ee=xe=>{var ft=J6(),ve=ui(ft);{var te=Ie=>{var Ue=K6(),ct=ui(Ue);Bk(ct,{get position(){return ee(Ke)}});var we=ht(ct,2);{let de=Kt(()=>({...x(),maxZoom:12}));U6(we,{get position(){return ee(Ke)},get fitBoundsOptions(){return ee(de)}})}var Q=ht(we,2);V6(Q,{get position(){return ee(Ke)}});var ue=ht(Q,2);Nk(ue,{get position(){return ee(Ke)}}),pt(Ie,Ue)};Ki(ve,Ie=>{Te()&&Ie(te)})}var se=ht(ve,2);xs(se,()=>e.children??ls,()=>({map:t(),loaded:k(),loadedImages:dt.loadedImages,allImagesLoaded:ee(lt)})),pt(xe,ft)};Ki(Pt,xe=>{t()&&xe(Ee)})}vc(Mt,xe=>i(xe),()=>i()),D$(Mt,xe=>$t?.(xe)),Ji(()=>Zt=lp(Mt,1,HR(r()),"svelte-xbukvd",Zt,{"expand-map":!r()})),pt(n,Mt),tn()}ps(["click","dblclick","contextmenu","mousemove","keydown"]);var tV=Xt('<div class="sv-popup"><!></div>');function g2(n,e){en(e,!0);let t=st(e,"closeButton",3,void 0),i=st(e,"closeOnClickOutside",3,!0),r=st(e,"closeOnClickInside",3,!1),o=st(e,"closeOnMove",3,!1),c=st(e,"openOn",3,"click"),s=st(e,"openIfTopMost",3,!0),f=st(e,"focusAfterOpen",3,!0),p=st(e,"anchor",3,void 0),g=st(e,"offset",3,void 0),_=st(e,"popupClass",3,void 0),x=st(e,"maxWidth",3,void 0),b=st(e,"lngLat",15,void 0),M=st(e,"html",3,void 0),P=st(e,"open",15,!1),k=st(e,"onopen",3,void 0),L=st(e,"onclose",3,void 0),I=st(e,"onhover",3,void 0),F=A6();const N=Kt(Sc),H=Kt(()=>ee(N).map),Y=Kt(()=>ee(N).eventTopMost),q=Kt(()=>ee(N).markerClickManager),U=Kt(()=>ee(N).loaded),G=x6(),j=E6(),B=M6(),ne=["click","dblclick","contextmenu"];let J=ii(void 0),le=ii(!1),ae=ii(void 0);function pe(){if(!ee(J))return;let Pt=ee(J).getElement();!Pt||Pt===ee(ae)||(yt(ae,Pt,!0),c()==="hover"&&(ee(ae).style.pointerEvents="none"),ee(ae).addEventListener("mouseenter",()=>{yt(le,!0)},{passive:!0}),ee(ae).addEventListener("mouseleave",()=>{yt(le,!1)},{passive:!0}),ee(ae).addEventListener("click",()=>{r()&&P(!1)},{passive:!0}))}XM(()=>{ee(H)&&(ee(H).on("click",Lt),ee(H).on("contextmenu",Lt),ee(q).add(At),typeof B?.value=="string"&&(ee(H).on("click",B.value,dt),ee(H).on("dblclick",B.value,dt),ee(H).on("contextmenu",B.value,dt),ee(H).on("mousemove",B.value,zt),ee(H).on("mouseleave",B.value,Ye),ee(H).on("touchstart",B.value,Oe),ee(H).on("touchend",B.value,lt)))}),xa(()=>{ee(U)&&ee(H)&&(ee(J)?.remove(),ee(H).off("click",Lt),ee(H).off("contextmenu",Lt),ee(q).remove(At),B?.value instanceof Io.Marker?B.value.getPopup()===ee(J)&&B.value.setPopup(void 0):typeof B?.value=="string"&&(ee(H).off("click",B.value,dt),ee(H).off("dblclick",B.value,dt),ee(H).off("contextmenu",B.value,dt),ee(H).off("mousemove",B.value,zt),ee(H).off("mouseleave",B.value,Ye),ee(H).off("touchstart",B.value,Oe),ee(H).off("touchend",B.value,lt)))});function fe(){if(e.canOpen&&!e.canOpen(ee(Ce))){P(!1);return}P(!0)}function Te(Pt){return s()?!("marker"in Pt)&&!k6(Pt)&&ee(Y)(Pt)!==G?.value:!1}let Ce=ii(void 0),tt=ii("normal");function Ke(Pt){"layerType"in Pt&&Pt.layerType==="deckgl"?(b(Pt.coordinate),yt(Ce,Pt.object?[Pt.object]:void 0,!0)):(b(Pt.lngLat),yt(Ce,Pt.features??[],!0))}function dt(Pt){Pt.type!==c()||Te(Pt)||(Ke(Pt),setTimeout(fe))}let et;function Oe(Pt){et=Pt.point}function lt(Pt){if(!et||c()!=="hover")return;let Ee=et.dist(Pt.point);et=void 0,Ee<3&&(b(Pt.lngLat),yt(Ce,Pt.features??[],!0),ee(J)?.isOpen()?yt(tt,"justOpened"):(yt(tt,"opening"),fe()))}function Ye(Pt){c()!=="hover"||et||ee(tt)!=="normal"||(P(!1),yt(Ce,void 0))}function zt(Pt){if(!(c()!=="hover"||et||ee(tt)!=="normal")){if(Te(Pt)){P(!1),yt(Ce,void 0);return}yt(Ce,Pt.features??[],!0),b(Pt.lngLat),fe()}}function Lt(Pt){if(ee(tt)==="justOpened"){yt(tt,"normal");return}if(!i())return;let Ee=[ee(ae),B?.value instanceof Io.Marker?B.value?.getElement():void 0];P()&&ee(J)?.isOpen()&&!Ee.some(xe=>xe?.contains(Pt.originalEvent.target))&&(Pt.type==="contextmenu"&&c()==="contextmenu"||Pt.type!=="contextmenu")&&P(!1)}function At(Pt){i()&&P()&&ee(J)?.isOpen()&&Pt.marker!==B?.value&&P(!1)}xa(()=>{ee(U)&&ee(J)?.isOpen()&&ee(J).remove()});let Nt=ii(void 0),$t=Kt(()=>t()??(!i()&&!r()));cn(()=>{if(!ee(J)){let Pt=_()?`${_()} sv-maplibregl-popup`:"sv-maplibregl-popup";yt(J,new Io.Popup({closeButton:ee($t),closeOnClick:!1,closeOnMove:o(),focusAfterOpen:f(),maxWidth:x(),className:Pt,anchor:p(),offset:g()}),!0),yt(ae,ee(J).getElement(),!0),ee(J).on("open",()=>{fe(),P()&&(pe(),k()?.(ee(J)))}),ee(J).on("close",()=>{P(!1),L()?.(ee(J))}),I()&&ee(J).on("hover",()=>{I()?.(ee(J))})}}),cn(()=>{ee(J)&&B?.value instanceof Io.Marker&&(c()==="click"?B.value.setPopup(ee(J)):B.value.getPopup()===ee(J)&&B.value.setPopup(void 0))}),cn(()=>{ne.includes(c())&&j.value?.type===c()&&(dt(j.value),j.value=void 0)});let Ze=Kt(()=>c()==="hover"&&(j.value?.type==="mousemove"||j.value?.type==="mouseenter"));cn(()=>{c()==="hover"&&j&&(ee(Ze)&&j.value&&Ke(j.value),ee(Ze)||ee(le)?fe():P(!1))}),cn(()=>{ee(Nt)?ee(J)?.setDOMContent(ee(Nt)):M()&&ee(J)?.setHTML(M())}),cn(()=>{let Pt=b()??F?.value??void 0;Pt&&ee(J)?.setLngLat(Pt)}),cn(()=>{if(ee(H)&&ee(J)){let Pt=ee(J).isOpen();P()&&!Pt?(ee(J).addTo(ee(H)),ee(tt)==="opening"&&yt(tt,"justOpened")):!P()&&Pt&&ee(J).remove()}});var bt=tr(),Mt=ui(bt);{var Zt=Pt=>{var Ee=tV(),xe=Bt(Ee);{var ft=ve=>{var te=tr(),se=ui(te);xs(se,()=>e.children??ls,()=>({features:ee(Ce),data:ee(Ce)?.[0]??void 0,map:ee(H),close:()=>P(!1),isOpen:P()})),pt(ve,te)};Ki(xe,ve=>{(ee(Ce)?.length||B?.value instanceof Io.Marker||!B&&P())&&ve(ft)})}vc(Ee,ve=>yt(Nt,ve),()=>ee(Nt)),pt(Pt,Ee)};Ki(Mt,Pt=>{e.children&&Pt(Zt)})}pt(n,bt),tn()}var yg=Math.pow,po=(n,e,t)=>new Promise((i,r)=>{var o=f=>{try{s(t.next(f))}catch(p){r(p)}},c=f=>{try{s(t.throw(f))}catch(p){r(p)}},s=f=>f.done?i(f.value):Promise.resolve(f.value).then(o,c);s((t=t.apply(n,e)).next())}),Ja=Uint8Array,Zv=Uint16Array,iV=Int32Array,$k=new Ja([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vk=new Ja([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nV=new Ja([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Uk=function(n,e){for(var t=new Zv(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var r=new iV(t[30]),i=1;i<30;++i)for(var o=t[i];o<t[i+1];++o)r[o]=o-t[i]<<5|i;return{b:t,r}},jk=Uk($k,2),Gk=jk.b,rV=jk.r;Gk[28]=258,rV[258]=28;var sV=Uk(Vk,0),oV=sV.b,qk=new Zv(32768);for(Wn=0;Wn<32768;++Wn)Ku=(Wn&43690)>>1|(Wn&21845)<<1,Ku=(Ku&52428)>>2|(Ku&13107)<<2,Ku=(Ku&61680)>>4|(Ku&3855)<<4,qk[Wn]=((Ku&65280)>>8|(Ku&255)<<8)>>1;var Ku,Wn,Xv=function(n,e,t){for(var i=n.length,r=0,o=new Zv(e);r<i;++r)n[r]&&++o[n[r]-1];var c=new Zv(e);for(r=1;r<e;++r)c[r]=c[r-1]+o[r-1]<<1;var s;{s=new Zv(1<<e);var f=15-e;for(r=0;r<i;++r)if(n[r])for(var p=r<<4|n[r],g=e-n[r],_=c[n[r]-1]++<<g,x=_|(1<<g)-1;_<=x;++_)s[qk[_]>>f]=p}return s},Zy=new Ja(288);for(Wn=0;Wn<144;++Wn)Zy[Wn]=8;var Wn;for(Wn=144;Wn<256;++Wn)Zy[Wn]=9;var Wn;for(Wn=256;Wn<280;++Wn)Zy[Wn]=7;var Wn;for(Wn=280;Wn<288;++Wn)Zy[Wn]=8;var Wn,Hk=new Ja(32);for(Wn=0;Wn<32;++Wn)Hk[Wn]=5;var Wn,aV=Xv(Zy,9),lV=Xv(Hk,5),_S=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},uc=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},vS=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},cV=function(n){return(n+7)/8|0},uV=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var i=new Ja(t-e);return i.set(n.subarray(e,t)),i},hV=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Za=function(n,e,t){var i=new Error(e||hV[n]);if(i.code=n,Error.captureStackTrace&&Error.captureStackTrace(i,Za),!t)throw i;return i},_2=function(n,e,t,i){var r=n.length,o=0;if(!r||e.f&&!e.l)return t||new Ja(0);var c=!t||e.i!=2,s=e.i;t||(t=new Ja(r*3));var f=function(Nt){var $t=t.length;if(Nt>$t){var Ze=new Ja(Math.max($t*2,Nt));Ze.set(t),t=Ze}},p=e.f||0,g=e.p||0,_=e.b||0,x=e.l,b=e.d,M=e.m,P=e.n,k=r*8;do{if(!x){p=uc(n,g,1);var L=uc(n,g+1,3);if(g+=3,L)if(L==1)x=aV,b=lV,M=9,P=5;else if(L==2){var H=uc(n,g,31)+257,Y=uc(n,g+10,15)+4,q=H+uc(n,g+5,31)+1;g+=14;for(var U=new Ja(q),G=new Ja(19),j=0;j<Y;++j)G[nV[j]]=uc(n,g+j*3,7);g+=Y*3;for(var B=_S(G),ne=(1<<B)-1,J=Xv(G,B),j=0;j<q;){var le=J[uc(n,g,ne)];g+=le&15;var I=le>>4;if(I<16)U[j++]=I;else{var ae=0,pe=0;for(I==16?(pe=3+uc(n,g,3),g+=2,ae=U[j-1]):I==17?(pe=3+uc(n,g,7),g+=3):I==18&&(pe=11+uc(n,g,127),g+=7);pe--;)U[j++]=ae}}var fe=U.subarray(0,H),Te=U.subarray(H);M=_S(fe),P=_S(Te),x=Xv(fe,M),b=Xv(Te,P)}else Za(1);else{var I=cV(g)+4,F=n[I-4]|n[I-3]<<8,N=I+F;if(N>r){s&&Za(0);break}c&&f(_+F),t.set(n.subarray(I,N),_),e.b=_+=F,e.p=g=N*8,e.f=p;continue}if(g>k){s&&Za(0);break}}c&&f(_+131072);for(var Ce=(1<<M)-1,tt=(1<<P)-1,Ke=g;;Ke=g){var ae=x[vS(n,g)&Ce],dt=ae>>4;if(g+=ae&15,g>k){s&&Za(0);break}if(ae||Za(2),dt<256)t[_++]=dt;else if(dt==256){Ke=g,x=null;break}else{var et=dt-254;if(dt>264){var j=dt-257,Oe=$k[j];et=uc(n,g,(1<<Oe)-1)+Gk[j],g+=Oe}var lt=b[vS(n,g)&tt],Ye=lt>>4;lt||Za(3),g+=lt&15;var Te=oV[Ye];if(Ye>3){var Oe=Vk[Ye];Te+=vS(n,g)&(1<<Oe)-1,g+=Oe}if(g>k){s&&Za(0);break}c&&f(_+131072);var zt=_+et;if(_<Te){var Lt=o-Te,At=Math.min(Te,zt);for(Lt+_<0&&Za(3);_<At;++_)t[_]=i[Lt+_]}for(;_<zt;_+=4)t[_]=t[_-Te],t[_+1]=t[_+1-Te],t[_+2]=t[_+2-Te],t[_+3]=t[_+3-Te];_=zt}}e.l=x,e.p=Ke,e.b=_,e.f=p,x&&(p=1,e.m=M,e.d=b,e.n=P)}while(!p);return _==t.length?t:uV(t,0,_)},dV=new Ja(0),fV=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&Za(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!n[t++]);return t+(e&2)},pV=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},mV=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&Za(6,"invalid zlib data"),(n[1]>>5&1)==1&&Za(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function gV(n,e){return _2(n,{i:2},e,e)}function _V(n,e){var t=fV(n);return t+8>n.length&&Za(6,"invalid gzip data"),_2(n.subarray(t,-8),{i:2},new Ja(pV(n)),e)}function vV(n,e){return _2(n.subarray(mV(n),-4),{i:2},e,e)}function qT(n,e){return n[0]==31&&n[1]==139&&n[2]==8?_V(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?gV(n,e):vV(n,e)}var yV=typeof TextDecoder<"u"&&new TextDecoder,bV=0;try{yV.decode(dV,{stream:!0}),bV=1}catch{}var Wk=(n,e)=>n*yg(2,e),av=(n,e)=>Math.floor(n/yg(2,e)),zx=(n,e)=>Wk(n.getUint16(e+1,!0),8)+n.getUint8(e),Zk=(n,e)=>Wk(n.getUint32(e+2,!0),16)+n.getUint16(e,!0),xV=(n,e,t,i,r)=>{if(n!==i.getUint8(r))return n-i.getUint8(r);const o=zx(i,r+1);if(e!==o)return e-o;const c=zx(i,r+4);return t!==c?t-c:0},wV=(n,e,t,i)=>{const r=Xk(n,e|128,t,i);return r?{z:e,x:t,y:i,offset:r[0],length:r[1],isDir:!0}:null},fP=(n,e,t,i)=>{const r=Xk(n,e,t,i);return r?{z:e,x:t,y:i,offset:r[0],length:r[1],isDir:!1}:null},Xk=(n,e,t,i)=>{let r=0,o=n.byteLength/17-1;for(;r<=o;){const c=o+r>>1,s=xV(e,t,i,n,c*17);if(s>0)r=c+1;else if(s<0)o=c-1;else return[Zk(n,c*17+7),n.getUint32(c*17+13,!0)]}return null},SV=(n,e)=>n.isDir&&!e.isDir?1:!n.isDir&&e.isDir?-1:n.z!==e.z?n.z-e.z:n.x!==e.x?n.x-e.x:n.y-e.y,Yk=(n,e)=>{const t=n.getUint8(e*17);return{z:t&127,x:zx(n,e*17+1),y:zx(n,e*17+4),offset:Zk(n,e*17+7),length:n.getUint32(e*17+13,!0),isDir:t>>7===1}},pP=n=>{const e=[],t=new DataView(n);for(let i=0;i<t.byteLength/17;i++)e.push(Yk(t,i));return TV(e)},TV=n=>{n.sort(SV);const e=new ArrayBuffer(17*n.length),t=new Uint8Array(e);for(let i=0;i<n.length;i++){const r=n[i];let o=r.z;r.isDir&&(o=o|128),t[i*17]=o,t[i*17+1]=r.x&255,t[i*17+2]=r.x>>8&255,t[i*17+3]=r.x>>16&255,t[i*17+4]=r.y&255,t[i*17+5]=r.y>>8&255,t[i*17+6]=r.y>>16&255,t[i*17+7]=r.offset&255,t[i*17+8]=av(r.offset,8)&255,t[i*17+9]=av(r.offset,16)&255,t[i*17+10]=av(r.offset,24)&255,t[i*17+11]=av(r.offset,32)&255,t[i*17+12]=av(r.offset,48)&255,t[i*17+13]=r.length&255,t[i*17+14]=r.length>>8&255,t[i*17+15]=r.length>>16&255,t[i*17+16]=r.length>>24&255}return e},MV=(n,e)=>{if(n.byteLength<17)return null;const t=n.byteLength/17,i=Yk(n,t-1);if(i.isDir){const r=i.z,o=e.z-r,c=Math.trunc(e.x/(1<<o)),s=Math.trunc(e.y/(1<<o));return{z:r,x:c,y:s}}return null};function CV(n){return po(this,null,function*(){const e=yield n.getBytes(0,512e3),t=new DataView(e.data),i=t.getUint32(4,!0),r=t.getUint16(8,!0),o=new TextDecoder("utf-8"),c=JSON.parse(o.decode(new DataView(e.data,10,i)));let s=0;c.compression==="gzip"&&(s=2);let f=0;"minzoom"in c&&(f=+c.minzoom);let p=0;"maxzoom"in c&&(p=+c.maxzoom);let g=0,_=0,x=0,b=-180,M=-85,P=180,k=85;if(c.bounds){const I=c.bounds.split(",");b=+I[0],M=+I[1],P=+I[2],k=+I[3]}if(c.center){const I=c.center.split(",");g=+I[0],_=+I[1],x=+I[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:r*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:f,maxZoom:p,minLon:b,minLat:M,maxLon:P,maxLat:k,centerZoom:x,centerLon:g,centerLat:_,etag:e.etag}})}function EV(n,e,t,i,r,o,c){return po(this,null,function*(){let s=yield t.getArrayBuffer(e,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(s=pP(s));const f=fP(new DataView(s),i,r,o);if(f){let _=(yield e.getBytes(f.offset,f.length,c)).data;const x=new DataView(_);return x.getUint8(0)===31&&x.getUint8(1)===139&&(_=qT(new Uint8Array(_))),{data:_}}const p=MV(new DataView(s),{z:i,x:r,y:o});if(p){const g=wV(new DataView(s),p.z,p.x,p.y);if(g){let _=yield t.getArrayBuffer(e,g.offset,g.length,n);n.specVersion===1&&(_=pP(_));const x=fP(new DataView(_),i,r,o);if(x){let M=(yield e.getBytes(x.offset,x.length,c)).data;const P=new DataView(M);return P.getUint8(0)===31&&P.getUint8(1)===139&&(M=qT(new Uint8Array(M))),{data:M}}}}})}var Kk={getHeader:CV,getZxy:EV},AV=n=>(e,t)=>{if(t instanceof AbortController)return n(e,t);const i=new AbortController;return n(e,i).then(r=>t(void 0,r.data,r.cacheControl||"",r.expires||""),r=>t(r)).catch(r=>t(r)),{cancel:()=>i.abort()}},PV=class{constructor(n){this.tilev4=(e,t)=>po(this,null,function*(){if(e.type==="json"){const x=e.url.substr(10);let b=this.tiles.get(x);if(b||(b=new mP(x),this.tiles.set(x,b)),this.metadata)return{data:yield b.getTileJson(e.url)};const M=yield b.getHeader();return{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:M.minZoom,maxzoom:M.maxZoom,bounds:[M.minLon,M.minLat,M.maxLon,M.maxLat]}}}const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=e.url.match(i);if(!r)throw new Error("Invalid PMTiles protocol URL");const o=r[1];let c=this.tiles.get(o);c||(c=new mP(o),this.tiles.set(o,c));const s=r[2],f=r[3],p=r[4],g=yield c.getHeader(),_=yield c?.getZxy(+s,+f,+p,t.signal);return _?{data:new Uint8Array(_.data),cacheControl:_.cacheControl,expires:_.expires}:g.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=AV(this.tilev4),this.tiles=new Map,this.metadata=n?.metadata||!1}add(n){this.tiles.set(n.source.getKey(),n)}get(n){return this.tiles.get(n)}};function Dm(n,e){return(e>>>0)*4294967296+(n>>>0)}function IV(n,e){const t=e.buf;let i=t[e.pos++],r=(i&112)>>4;if(i<128||(i=t[e.pos++],r|=(i&127)<<3,i<128)||(i=t[e.pos++],r|=(i&127)<<10,i<128)||(i=t[e.pos++],r|=(i&127)<<17,i<128)||(i=t[e.pos++],r|=(i&127)<<24,i<128)||(i=t[e.pos++],r|=(i&1)<<31,i<128))return Dm(n,r);throw new Error("Expected varint not more than 10 bytes")}function lv(n){const e=n.buf;let t=e[n.pos++],i=t&127;return t<128||(t=e[n.pos++],i|=(t&127)<<7,t<128)||(t=e[n.pos++],i|=(t&127)<<14,t<128)||(t=e[n.pos++],i|=(t&127)<<21,t<128)?i:(t=e[n.pos],i|=(t&15)<<28,IV(i,n))}function LV(n,e,t,i){if(i===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}var RV=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function kV(n,e,t){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>yg(2,n)-1||t>yg(2,n)-1)throw Error("tile x/y outside zoom level bounds");const i=RV[n],r=yg(2,n);let o=0,c=0,s=0;const f=[e,t];let p=r/2;for(;p>0;)o=(f[0]&p)>0?1:0,c=(f[1]&p)>0?1:0,s+=p*p*(3*o^c),LV(p,f,o,c),p=p/2;return i+s}function Jk(n,e){return po(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return qT(new Uint8Array(n));const t=new Response(n).body;if(!t)throw Error("Failed to read response stream");const i=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}function DV(n){return n===1?".mvt":n===2?".png":n===3?".jpg":n===4?".webp":n===5?".avif":""}var FV=127;function OV(n,e){let t=0,i=n.length-1;for(;t<=i;){const r=i+t>>1,o=e-n[r].tileId;if(o>0)t=r+1;else if(o<0)i=r-1;else return n[r]}return i>=0&&(n[i].runLength===0||e-n[i].tileId<n[i].runLength)?n[i]:null}var zV=class{constructor(n,e=new Headers){this.url=n,this.customHeaders=e,this.mustReload=!1;let t="";"navigator"in globalThis&&(t=globalThis.navigator.userAgent||"");const i=t.indexOf("Windows")>-1,r=/Chrome|Chromium|Edg|OPR|Brave/.test(t);this.chromeWindowsNoCache=!1,i&&r&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(n){this.customHeaders=n}getBytes(n,e,t,i){return po(this,null,function*(){let r,o;t?o=t:(r=new AbortController,o=r.signal);const c=new Headers(this.customHeaders);c.set("range",`bytes=${n}-${n+e-1}`);let s;this.mustReload?s="reload":this.chromeWindowsNoCache&&(s="no-store");let f=yield fetch(this.url,{signal:o,cache:s,headers:c});if(n===0&&f.status===416){const x=f.headers.get("Content-Range");if(!x||!x.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const b=+x.substr(8);f=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${b-1}`}})}let p=f.headers.get("Etag");if(p?.startsWith("W/")&&(p=null),f.status===416||i&&p&&p!==i)throw this.mustReload=!0,new HT(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(f.status>=300)throw Error(`Bad response code: ${f.status}`);const g=f.headers.get("Content-Length");if(f.status===200&&(!g||+g>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield f.arrayBuffer(),etag:p||void 0,cacheControl:f.headers.get("Cache-Control")||void 0,expires:f.headers.get("Expires")||void 0}})}};function hc(n,e){const t=n.getUint32(e+4,!0),i=n.getUint32(e+0,!0);return t*yg(2,32)+i}function BV(n,e){const t=new DataView(n),i=t.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:hc(t,8),rootDirectoryLength:hc(t,16),jsonMetadataOffset:hc(t,24),jsonMetadataLength:hc(t,32),leafDirectoryOffset:hc(t,40),leafDirectoryLength:hc(t,48),tileDataOffset:hc(t,56),tileDataLength:hc(t,64),numAddressedTiles:hc(t,72),numTileEntries:hc(t,80),numTileContents:hc(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Qk(n){const e={buf:new Uint8Array(n),pos:0},t=lv(e),i=[];let r=0;for(let o=0;o<t;o++){const c=lv(e);i.push({tileId:r+c,offset:0,length:0,runLength:1}),r+=c}for(let o=0;o<t;o++)i[o].runLength=lv(e);for(let o=0;o<t;o++)i[o].length=lv(e);for(let o=0;o<t;o++){const c=lv(e);c===0&&o>0?i[o].offset=i[o-1].offset+i[o-1].length:i[o].offset=c-1}return i}function NV(n){const e=new DataView(n);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var HT=class extends Error{};function $V(n,e){return po(this,null,function*(){const t=yield n.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(NV(t.data)<3)return[yield Kk.getHeader(n)];const r=t.data.slice(0,FV),o=BV(r,t.etag),c=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),s=`${n.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,f=Qk(yield e(c,o.internalCompression));return[o,[s,f.length,f]]})}function VV(n,e,t,i,r){return po(this,null,function*(){const o=yield n.getBytes(t,i,void 0,r.etag),c=yield e(o.data,r.internalCompression),s=Qk(c);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var UV=class{constructor(n=100,e=!0,t=Jk){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=n,this.counter=1,this.decompress=t}getHeader(n){return po(this,null,function*(){const e=n.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const i=new Promise((r,o)=>{$V(n,this.decompress).then(c=>{c[1]&&this.cache.set(c[1][0],{lastUsed:this.counter++,data:Promise.resolve(c[1][2])}),r(c[0]),this.prune()}).catch(c=>{o(c)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(n,e,t,i){return po(this,null,function*(){const r=`${n.getKey()}|${i.etag||""}|${e}|${t}`,o=this.cache.get(r);if(o)return o.lastUsed=this.counter++,yield o.data;const c=new Promise((s,f)=>{VV(n,this.decompress,e,t,i).then(p=>{s(p),this.prune()}).catch(p=>{f(p)})});return this.cache.set(r,{lastUsed:this.counter++,data:c}),c})}getArrayBuffer(n,e,t,i){return po(this,null,function*(){const r=`${n.getKey()}|${i.etag||""}|${e}|${t}`,o=this.cache.get(r);if(o)return o.lastUsed=this.counter++,yield o.data;const c=new Promise((s,f)=>{n.getBytes(e,t,void 0,i.etag).then(p=>{s(p.data),this.cache.has(r),this.prune()}).catch(p=>{f(p)})});return this.cache.set(r,{lastUsed:this.counter++,data:c}),c})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,e;this.cache.forEach((t,i)=>{t.lastUsed<n&&(n=t.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(n){return po(this,null,function*(){const e=n.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(n.getKey());const t=new Promise((i,r)=>{this.getHeader(n).then(o=>{i(),this.invalidations.delete(e)}).catch(o=>{r(o)})});this.invalidations.set(e,t)})}},mP=class{constructor(n,e,t){typeof n=="string"?this.source=new zV(n):this.source=n,t?this.decompress=t:this.decompress=Jk,e?this.cache=e:this.cache=new UV}getHeader(){return po(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,e,t,i){return po(this,null,function*(){const r=kV(n,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Kk.getZxy(o,this.source,this.cache,n,e,t,i);if(n<o.minZoom||n>o.maxZoom)return;let c=o.rootDirectoryOffset,s=o.rootDirectoryLength;for(let f=0;f<=3;f++){const p=yield this.cache.getDirectory(this.source,c,s,o),g=OV(p,r);if(g){if(g.runLength>0){const _=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,i,o.etag);return{data:yield this.decompress(_.data,o.tileCompression),cacheControl:_.cacheControl,expires:_.expires}}c=o.leafDirectoryOffset+g.offset,s=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,e,t,i){return po(this,null,function*(){try{return yield this.getZxyAttempt(n,e,t,i)}catch(r){if(r instanceof HT)return this.cache.invalidate(this.source),yield this.getZxyAttempt(n,e,t,i);throw r}})}getMetadataAttempt(){return po(this,null,function*(){const n=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength,void 0,n.etag),t=yield this.decompress(e.data,n.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(t))})}getMetadata(){return po(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof HT)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw n}})}getTileJson(n){return po(this,null,function*(){const e=yield this.getHeader(),t=yield this.getMetadata(),i=DV(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${n}/{z}/{x}/{y}${i}`],vector_layers:t.vector_layers,attribution:t.attribution,description:t.description,name:t.name,version:t.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};function Av(n,e){en(e,!0);let t=st(e,"id",19,()=>_p("symbol")),i=st(e,"source",3,void 0),r=st(e,"sourceLayer",3,void 0),o=st(e,"beforeId",3,void 0),c=st(e,"beforeLayerType",3,void 0),s=st(e,"paint",3,void 0),f=st(e,"layout",3,void 0),p=st(e,"filter",3,void 0),g=st(e,"applyToClusters",3,void 0),_=st(e,"minzoom",3,void 0),x=st(e,"maxzoom",3,void 0),b=st(e,"hoverCursor",3,void 0),M=st(e,"manageHoverState",3,!1),P=st(e,"hovered",15),k=st(e,"eventsIfTopMost",3,!1),L=st(e,"interactive",3,!0),I=st(e,"children",3,void 0),F=st(e,"onclick",3,void 0),N=st(e,"ondblclick",3,void 0),H=st(e,"oncontextmenu",3,void 0),Y=st(e,"onmouseenter",3,void 0),q=st(e,"onmousemove",3,void 0),U=st(e,"onmouseleave",3,void 0);Aw(n,{get id(){return t()},type:"symbol",get source(){return i()},get sourceLayer(){return r()},get beforeId(){return o()},get beforeLayerType(){return c()},get paint(){return s()},get layout(){return f()},get filter(){return p()},get applyToClusters(){return g()},get minzoom(){return _()},get maxzoom(){return x()},get hoverCursor(){return b()},get manageHoverState(){return M()},get eventsIfTopMost(){return k()},get interactive(){return L()},get onclick(){return F()},get ondblclick(){return N()},get oncontextmenu(){return H()},get onmouseenter(){return Y()},get onmousemove(){return q()},get onmouseleave(){return U()},get hovered(){return P()},set hovered(G){P(G)},children:(G,j)=>{var B=tr(),ne=ui(B);xs(ne,()=>I()??ls),pt(G,B)},$$slots:{default:!0}}),tn()}function jV(n,e){en(e,!0);let t=st(e,"id",19,()=>_p("vector")),i=st(e,"url",3,void 0),r=st(e,"tiles",3,void 0),o=st(e,"promoteId",3,void 0),c=st(e,"bounds",3,void 0),s=st(e,"scheme",3,void 0),f=st(e,"attribution",3,void 0),p=st(e,"minzoom",3,void 0),g=st(e,"maxzoom",3,void 0),_=st(e,"volatile",3,void 0);if(i()&&i().includes("pmtiles://")&&!Object.hasOwn(Io.config.REGISTERED_PROTOCOLS,"pmtiles")){let H=new PV;Io.addProtocol("pmtiles",H.tile)}const x=Kt(Sc),b=Kt(()=>ee(x).map),M=Kt(()=>ee(x).loaded),{source:P}=Rk();let k=ii(void 0);cn(()=>{ee(b)&&ee(M)&&P.value!==t()&&(P.value=t(),Fk(ee(b),P.value,py({type:"vector",url:i(),tiles:r(),promoteId:o(),bounds:c(),scheme:s(),attribution:f(),minzoom:p(),maxzoom:g(),volatile:_()}),H=>ee(b)&&H===P.value,()=>{P.value&&yt(k,ee(b).getSource(P.value),!0)}))});function L(){ee(b)&&yt(k,ee(b).getSource(t()),!0)}cn(()=>{ee(b)&&ee(b).on("style.load",L)}),xa(()=>{ee(b)?.off("style.load",L),P.value&&ee(b)&&(Ok(ee(b),P.value,ee(k)),P.value=void 0,yt(k,void 0))});var I=tr(),F=ui(I);{var N=H=>{var Y=tr(),q=ui(Y);Hy(q,()=>P.value,U=>{var G=tr(),j=ui(G);xs(j,()=>e.children??ls),pt(U,G)}),pt(H,Y)};Ki(F,H=>{P.value&&H(N)})}pt(n,I),tn()}var GV=Xt("<!> <!> <!>",1);function qV(n){const e=()=>on(Tk,"$polygonToolGj",t),[t,i]=cs();Hs(n,{get data(){return e()},children:(r,o)=>{var c=GV(),s=ui(c);p2(s,{id:"edit-polygon-fill",get filter(){return l6},paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}});var f=ht(s,2);Fl(f,{id:"edit-polygon-lines",get filter(){return c6},paint:{"line-color":"black","line-width":8,"line-opacity":.5}});var p=ht(f,2);ru(p,{id:"edit-polygon-vertices",get filter(){return u6},paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}),pt(r,c)},$$slots:{default:!0}}),i()}var HV=Xt('<div class="flex-container svelte-eqsjzd"><div class="top svelte-eqsjzd"><!></div> <div class="content svelte-eqsjzd"><div class="left svelte-eqsjzd"><!></div> <div class="main svelte-eqsjzd"><!></div></div></div>');function WV(n,e){en(e,!0),cn(()=>{yS.value&&Bx.value&&(yS.value.innerHTML="",yS.value.appendChild(Bx.value))}),cn(()=>{Yv.value&&Nx.value&&(Yv.value.innerHTML="",Yv.value.appendChild(Nx.value))}),cn(()=>{bS.value&&$x.value&&(bS.value.innerHTML="",bS.value.appendChild($x.value))});var t=HV(),i=Bt(t),r=Bt(i);xs(r,()=>e.top??ls);var o=ht(i,2),c=Bt(o),s=Bt(c);xs(s,()=>e.left??ls);var f=ht(c,2),p=Bt(f);xs(p,()=>e.main??ls),pt(n,t),tn()}var ZV=Xt("<div><!></div> <div><!></div> <div><!></div>",1);function Xy(n,e){en(e,!0);var t=ZV(),i=ui(t),r=Bt(i);xs(r,()=>e.top??ls),vc(i,p=>Bx.value=p,()=>Bx?.value);var o=ht(i,2),c=Bt(o);xs(c,()=>e.left??ls),vc(o,p=>Nx.value=p,()=>Nx?.value);var s=ht(o,2),f=Bt(s);xs(f,()=>e.main??ls),vc(s,p=>$x.value=p,()=>$x?.value),pt(n,t),tn()}let Bx=bs({value:void 0}),Nx=bs({value:void 0}),$x=bs({value:void 0}),yS=bs({value:void 0}),Yv=bs({value:void 0}),bS=bs({value:void 0});function XV(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return xk(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var YV=XV,KV=Object.defineProperty,eD=n=>{throw TypeError(n)},JV=(n,e,t)=>e in n?KV(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ei=(n,e,t)=>JV(n,typeof e!="symbol"?e+"":e,t),tD=(n,e,t)=>e.has(n)||eD("Cannot "+t),_s=(n,e,t)=>(tD(n,e,"read from private field"),e.get(n)),xS=(n,e,t)=>e.has(n)?eD("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),fb=(n,e,t,i)=>(tD(n,e,"write to private field"),e.set(n,t),t);function jr(){}function QV(n,e){for(const t in e)n[t]=e[t];return n}function iD(n){return n()}function gP(){return Object.create(null)}function Rh(n){n.forEach(iD)}function nD(n){return typeof n=="function"}function qd(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let pb;function Do(n,e){return n===e?!0:(pb||(pb=document.createElement("a")),pb.href=e,n===pb.href)}function e8(n){return Object.keys(n).length===0}function t8(n,e,t,i){if(n){const r=rD(n,e,t,i);return n[0](r)}}function rD(n,e,t,i){return n[1]&&i?QV(t.ctx.slice(),n[1](i(e))):t.ctx}function i8(n,e,t,i){return n[2],e.dirty}function n8(n,e,t,i,r,o){if(r){const c=rD(e,t,i,o);n.p(c,r)}}function r8(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function Vx(n){return n??""}function Ln(n,e){n.appendChild(e)}function Or(n,e,t){n.insertBefore(e,t||null)}function Cr(n){n.parentNode&&n.parentNode.removeChild(n)}function ur(n){return document.createElement(n)}function yc(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function kd(n){return document.createTextNode(n)}function Xa(){return kd(" ")}function s8(){return kd("")}function qs(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function o8(n){return function(e){return e.preventDefault(),n.call(this,e)}}function Ut(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function a8(n){return Array.from(n.childNodes)}function my(n,e){e=""+e,n.data!==e&&(n.data=e)}function _P(n,e){n.value=e??""}function su(n,e,t){n.classList.toggle(e,!!t)}function l8(n,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:i})}let gy;function Kv(n){gy=n}function sD(){if(!gy)throw new Error("Function called outside component initialization");return gy}function c8(n){sD().$$.on_destroy.push(n)}function oD(){const n=sD();return(e,t,{cancelable:i=!1}={})=>{const r=n.$$.callbacks[e];if(r){const o=l8(e,t,{cancelable:i});return r.slice().forEach(c=>{c.call(n,o)}),!o.defaultPrevented}return!0}}function u8(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const ag=[],WT=[];let bg=[];const vP=[],h8=Promise.resolve();let ZT=!1;function d8(){ZT||(ZT=!0,h8.then(aD))}function XT(n){bg.push(n)}const wS=new Set;let Fm=0;function aD(){if(Fm!==0)return;const n=gy;do{try{for(;Fm<ag.length;){const e=ag[Fm];Fm++,Kv(e),f8(e.$$)}}catch(e){throw ag.length=0,Fm=0,e}for(Kv(null),ag.length=0,Fm=0;WT.length;)WT.pop()();for(let e=0;e<bg.length;e+=1){const t=bg[e];wS.has(t)||(wS.add(t),t())}bg.length=0}while(ag.length);for(;vP.length;)vP.pop()();ZT=!1,wS.clear(),Kv(n)}function f8(n){if(n.fragment!==null){n.update(),Rh(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(XT)}}function p8(n){const e=[],t=[];bg.forEach(i=>n.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),bg=e}const vx=new Set;let Wf;function Pv(){Wf={r:0,c:[],p:Wf}}function Iv(){Wf.r||Rh(Wf.c),Wf=Wf.p}function Jr(n,e){n&&n.i&&(vx.delete(n),n.i(e))}function ks(n,e,t,i){if(n&&n.o){if(vx.has(n))return;vx.add(n),Wf.c.push(()=>{vx.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}else i&&i()}function yP(n){return n?.length!==void 0?n:Array.from(n)}function m8(n,e){ks(n,1,1,()=>{e.delete(n.key)})}function g8(n,e,t,i,r,o,c,s,f,p,g,_){let x=n.length,b=o.length,M=x;const P={};for(;M--;)P[n[M].key]=M;const k=[],L=new Map,I=new Map,F=[];for(M=b;M--;){const q=_(r,o,M),U=t(q);let G=c.get(U);G?F.push(()=>G.p(q,e)):(G=p(U,q),G.c()),L.set(U,k[M]=G),U in P&&I.set(U,Math.abs(M-P[U]))}const N=new Set,H=new Set;function Y(q){Jr(q,1),q.m(s,g),c.set(q.key,q),g=q.first,b--}for(;x&&b;){const q=k[b-1],U=n[x-1],G=q.key,j=U.key;q===U?(g=q.first,x--,b--):L.has(j)?!c.has(G)||N.has(G)?Y(q):H.has(j)?x--:I.get(G)>I.get(j)?(H.add(G),Y(q)):(N.add(j),x--):(f(U,c),x--)}for(;x--;){const q=n[x];L.has(q.key)||f(q,c)}for(;b;)Y(k[b-1]);return Rh(F),k}function Dd(n){n&&n.c()}function Sh(n,e,t){const{fragment:i,after_update:r}=n.$$;i&&i.m(e,t),XT(()=>{const o=n.$$.on_mount.map(iD).filter(nD);n.$$.on_destroy?n.$$.on_destroy.push(...o):Rh(o),n.$$.on_mount=[]}),r.forEach(XT)}function Th(n,e){const t=n.$$;t.fragment!==null&&(p8(t.after_update),Rh(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function _8(n,e){n.$$.dirty[0]===-1&&(ag.push(n),d8(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Hd(n,e,t,i,r,o,c=null,s=[-1]){const f=gy;Kv(n);const p=n.$$={fragment:null,ctx:[],props:o,update:jr,not_equal:r,bound:gP(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:gP(),dirty:s,skip_bound:!1,root:e.target||f.$$.root};c&&c(p.root);let g=!1;if(p.ctx=t?t(n,e.props||{},(_,x,...b)=>{const M=b.length?b[0]:x;return p.ctx&&r(p.ctx[_],p.ctx[_]=M)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](M),g&&_8(n,_)),x}):[],p.update(),g=!0,Rh(p.before_update),p.fragment=i?i(p.ctx):!1,e.target){if(e.hydrate){const _=a8(e.target);p.fragment&&p.fragment.l(_),_.forEach(Cr)}else p.fragment&&p.fragment.c();e.intro&&Jr(n.$$.fragment),Sh(n,e.target,e.anchor),aD()}Kv(f)}class Wd{constructor(){Ei(this,"$$"),Ei(this,"$$set")}$destroy(){Th(this,1),this.$destroy=jr}$on(e,t){if(!nD(t))return jr;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!e8(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const v8="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(v8);function y8(n){let e,t;return{c(){e=yc("svg"),t=yc("path"),Ut(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ut(e,"viewBox","0 0 14 14"),Ut(e,"width","13"),Ut(e,"height","13"),Ut(e,"class","svelte-en2qvf")},m(i,r){Or(i,e,r),Ln(e,t)},p:jr,i:jr,o:jr,d(i){i&&Cr(e)}}}class lD extends Wd{constructor(e){super(),Hd(this,e,null,y8,qd,{})}}function b8(n){let e,t;return{c(){e=yc("svg"),t=yc("path"),Ut(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ut(e,"viewBox","0 0 30 30"),Ut(e,"fill","none"),Ut(e,"xmlns","http://www.w3.org/2000/svg"),Ut(e,"class","svelte-d2loi5")},m(i,r){Or(i,e,r),Ln(e,t)},p:jr,i:jr,o:jr,d(i){i&&Cr(e)}}}class cD extends Wd{constructor(e){super(),Hd(this,e,null,b8,qd,{})}}function x8(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"area.svg")||Ut(e,"src",t),Ut(e,"alt",n[7]),Ut(e,"title",n[7]),Ut(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"area.svg")&&Ut(e,"src",t),r&128&&Ut(e,"alt",i[7]),r&128&&Ut(e,"title",i[7])},d(i){i&&Cr(e)}}}function w8(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"reverse.svg")||Ut(e,"src",t),Ut(e,"alt",n[7]),Ut(e,"title",n[7]),Ut(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"reverse.svg")&&Ut(e,"src",t),r&128&&Ut(e,"alt",i[7]),r&128&&Ut(e,"title",i[7])},d(i){i&&Cr(e)}}}function S8(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"poi.svg")||Ut(e,"src",t),Ut(e,"alt",n[7]),Ut(e,"title",n[7]),Ut(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"poi.svg")&&Ut(e,"src",t),r&128&&Ut(e,"alt",i[7]),r&128&&Ut(e,"title",i[7])},d(i){i&&Cr(e)}}}function T8(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"postal_code.svg")||Ut(e,"src",t),Ut(e,"alt",n[7]),Ut(e,"title",n[7]),Ut(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"postal_code.svg")&&Ut(e,"src",t),r&128&&Ut(e,"alt",i[7]),r&128&&Ut(e,"title",i[7])},d(i){i&&Cr(e)}}}function M8(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"street.svg")||Ut(e,"src",t),Ut(e,"alt",n[7]),Ut(e,"title",n[7]),Ut(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"street.svg")&&Ut(e,"src",t),r&128&&Ut(e,"alt",i[7]),r&128&&Ut(e,"title",i[7])},d(i){i&&Cr(e)}}}function C8(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"road.svg")||Ut(e,"src",t),Ut(e,"alt",n[7]),Ut(e,"title",n[7]),Ut(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"road.svg")&&Ut(e,"src",t),r&128&&Ut(e,"alt",i[7]),r&128&&Ut(e,"title",i[7])},d(i){i&&Cr(e)}}}function E8(n){let e,t;return{c(){e=ur("img"),Do(e.src,t=n[3]+"housenumber.svg")||Ut(e,"src",t),Ut(e,"alt",n[7]),Ut(e,"title",n[7]),Ut(e,"class","svelte-w9y5n9")},m(i,r){Or(i,e,r)},p(i,r){r&8&&!Do(e.src,t=i[3]+"housenumber.svg")&&Ut(e,"src",t),r&128&&Ut(e,"alt",i[7]),r&128&&Ut(e,"title",i[7])},d(i){i&&Cr(e)}}}function A8(n){let e,t,i,r;return{c(){e=ur("img"),Do(e.src,t=n[5])||Ut(e,"src",t),Ut(e,"alt",n[4]),Ut(e,"title",n[7]),Ut(e,"class","svelte-w9y5n9")},m(o,c){Or(o,e,c),i||(r=qs(e,"error",n[14]),i=!0)},p(o,c){c&32&&!Do(e.src,t=o[5])&&Ut(e,"src",t),c&16&&Ut(e,"alt",o[4]),c&128&&Ut(e,"title",o[7])},d(o){o&&Cr(e),i=!1,r()}}}function P8(n){let e,t;return{c(){e=ur("div"),Ut(e,"class","sprite-icon svelte-w9y5n9"),Ut(e,"style",t=`
        width: ${n[6].width/Sl}px;
        height: ${n[6].height/Sl}px;
        background-image: url(${n[3]}sprite${YT}.png);
        background-position: -${n[6].x/Sl}px -${n[6].y/Sl}px;
        background-size: ${eu.width/Sl}px ${eu.height/Sl}px;
      `),Ut(e,"title",n[7])},m(i,r){Or(i,e,r)},p(i,r){r&72&&t!==(t=`
        width: ${i[6].width/Sl}px;
        height: ${i[6].height/Sl}px;
        background-image: url(${i[3]}sprite${YT}.png);
        background-position: -${i[6].x/Sl}px -${i[6].y/Sl}px;
        background-size: ${eu.width/Sl}px ${eu.height/Sl}px;
      `)&&Ut(e,"style",t),r&128&&Ut(e,"title",i[7])},d(i){i&&Cr(e)}}}function bP(n){let e,t;return{c(){e=ur("span"),t=kd(n[7]),Ut(e,"class","secondary svelte-w9y5n9")},m(i,r){Or(i,e,r),Ln(e,t)},p(i,r){r&128&&my(t,i[7])},d(i){i&&Cr(e)}}}function I8(n){let e,t,i,r,o,c,s,f,p,g=(n[8]?n[0].place_name:n[0].place_name.replace(/,.*/,""))+"",_,x,b=n[2]==="always"||n[2]!=="never"&&!n[0].address&&!n[0].id.startsWith("road.")&&!n[0].id.startsWith("address.")&&!n[0].id.startsWith("postal_code.")&&(!n[0].id.startsWith("poi.")||!n[5])&&!n[8],M,P,k=(n[8]?"":n[0].place_name.replace(/[^,]*,?\s*/,""))+"",L,I,F,N,H,Y;function q(B,ne){return ne&1&&(t=null),ne&1&&(i=null),ne&1&&(r=null),ne&1&&(o=null),eu&&B[6]?P8:B[5]?A8:B[0].address?E8:(t==null&&(t=!!B[0].id.startsWith("road.")),t?C8:(i==null&&(i=!!B[0].id.startsWith("address.")),i?M8:(r==null&&(r=!!B[0].id.startsWith("postal_code.")),r?T8:(o==null&&(o=!!B[0].id.startsWith("poi.")),o?S8:B[8]?w8:x8))))}let U=q(n,-1),G=U(n),j=b&&bP(n);return{c(){e=ur("li"),G.c(),c=Xa(),s=ur("span"),f=ur("span"),p=ur("span"),_=kd(g),x=Xa(),j&&j.c(),M=Xa(),P=ur("span"),L=kd(k),Ut(p,"class","primary svelte-w9y5n9"),Ut(f,"class","svelte-w9y5n9"),Ut(P,"class","line2 svelte-w9y5n9"),Ut(s,"class","texts svelte-w9y5n9"),Ut(e,"tabindex","-1"),Ut(e,"role","option"),Ut(e,"aria-selected",I=n[1]==="selected"),Ut(e,"aria-checked",F=n[1]==="picked"),Ut(e,"class",N=Vx(n[1])+" svelte-w9y5n9")},m(B,ne){Or(B,e,ne),G.m(e,null),Ln(e,c),Ln(e,s),Ln(s,f),Ln(f,p),Ln(p,_),Ln(f,x),j&&j.m(f,null),Ln(s,M),Ln(s,P),Ln(P,L),H||(Y=[qs(e,"mouseenter",n[13]),qs(e,"focus",n[15]),qs(e,"click",n[16])],H=!0)},p(B,[ne]){U===(U=q(B,ne))&&G?G.p(B,ne):(G.d(1),G=U(B),G&&(G.c(),G.m(e,c))),ne&257&&g!==(g=(B[8]?B[0].place_name:B[0].place_name.replace(/,.*/,""))+"")&&my(_,g),ne&293&&(b=B[2]==="always"||B[2]!=="never"&&!B[0].address&&!B[0].id.startsWith("road.")&&!B[0].id.startsWith("address.")&&!B[0].id.startsWith("postal_code.")&&(!B[0].id.startsWith("poi.")||!B[5])&&!B[8]),b?j?j.p(B,ne):(j=bP(B),j.c(),j.m(f,null)):j&&(j.d(1),j=null),ne&257&&k!==(k=(B[8]?"":B[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&my(L,k),ne&2&&I!==(I=B[1]==="selected")&&Ut(e,"aria-selected",I),ne&2&&F!==(F=B[1]==="picked")&&Ut(e,"aria-checked",F),ne&2&&N!==(N=Vx(B[1])+" svelte-w9y5n9")&&Ut(e,"class",N)},i:jr,o:jr,d(B){B&&Cr(e),G.d(),j&&j.d(),H=!1,Rh(Y)}}}const uD=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,YT=uD?"@2x":"",Sl=uD?2:1;let eu,mb;function L8(n,e,t){let i,r,o,{feature:c}=e,{style:s="default"}=e,{showPlaceType:f}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const _=oD();let x,b,M,P;function k(){mb??(mb=fetch(`${g}sprite${YT}.json`).then(U=>U.json()).then(U=>{eu=U}).catch(()=>{eu=null}))}function L(){b&&p.add(b),I()}function I(){eu!==void 0?F():(k(),mb?.then(F))}function F(){do{if(P--,t(4,x=i?.[P]),t(6,M=x?eu?.icons[x]:void 0),M)break;t(5,b=x?g+x.replace(/ /g,"_")+".svg":void 0)}while(P>-1&&(!b||p.has(b)))}function N(U){u8.call(this,n,U)}const H=()=>L(),Y=()=>_("select",void 0),q=U=>{document.activeElement!==U.target&&_("select",void 0)};return n.$$set=U=>{"feature"in U&&t(0,c=U.feature),"style"in U&&t(1,s=U.style),"showPlaceType"in U&&t(2,f=U.showPlaceType),"missingIconsCache"in U&&t(11,p=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,g=U.iconsBaseUrl)},n.$$.update=()=>{var U,G,j,B,ne;n.$$.dirty&1&&t(12,i=(U=c.properties)==null?void 0:U.categories),n.$$.dirty&1&&t(8,r=c.place_type[0]==="reverse"),n.$$.dirty&1&&t(7,o=((j=(G=c.properties)==null?void 0:G.categories)==null?void 0:j.join(", "))??((ne=(B=c.properties)==null?void 0:B.place_type_name)==null?void 0:ne[0])??c.place_type[0]),n.$$.dirty&4096&&(P=i?.length??0,I())},[c,s,f,g,x,b,M,o,r,_,L,p,i,N,H,Y,q]}class R8 extends Wd{constructor(e){super(),Hd(this,e,L8,I8,qd,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function k8(n){let e;return{c(){e=ur("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ut(e,"class","svelte-1ocfouu")},m(t,i){Or(t,e,i)},p:jr,i:jr,o:jr,d(t){t&&Cr(e)}}}class D8 extends Wd{constructor(e){super(),Hd(this,e,null,k8,qd,{})}}function F8(n){let e,t,i;return{c(){e=yc("svg"),t=yc("path"),Ut(t,"stroke-width","4"),Ut(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Ut(t,"class","svelte-gzo3ar"),Ut(e,"width",i=n[0]==="list"?20:void 0),Ut(e,"viewBox","0 0 70 85"),Ut(e,"fill","none"),Ut(e,"class","svelte-gzo3ar"),su(e,"in-map",n[0]!=="list"),su(e,"list-icon",n[0]==="list")},m(r,o){Or(r,e,o),Ln(e,t)},p(r,[o]){o&1&&i!==(i=r[0]==="list"?20:void 0)&&Ut(e,"width",i),o&1&&su(e,"in-map",r[0]!=="list"),o&1&&su(e,"list-icon",r[0]==="list")},i:jr,o:jr,d(r){r&&Cr(e)}}}function O8(n,e,t){let{displayIn:i}=e;return n.$$set=r=>{"displayIn"in r&&t(0,i=r.displayIn)},[i]}class z8 extends Wd{constructor(e){super(),Hd(this,e,O8,F8,qd,{displayIn:0})}}function B8(n){let e,t;return{c(){e=yc("svg"),t=yc("path"),Ut(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ut(e,"viewBox","0 0 60.006 21.412"),Ut(e,"width","14"),Ut(e,"height","20"),Ut(e,"class","svelte-en2qvf")},m(i,r){Or(i,e,r),Ln(e,t)},p:jr,i:jr,o:jr,d(i){i&&Cr(e)}}}class N8 extends Wd{constructor(e){super(),Hd(this,e,null,B8,qd,{})}}function $8(n){let e,t,i;return{c(){e=yc("svg"),t=yc("circle"),i=yc("path"),Ut(t,"cx","4.789"),Ut(t,"cy","4.787"),Ut(t,"r","3.85"),Ut(t,"class","svelte-1aq105l"),Ut(i,"d","M12.063 12.063 7.635 7.635"),Ut(i,"class","svelte-1aq105l"),Ut(e,"xmlns","http://www.w3.org/2000/svg"),Ut(e,"width","13"),Ut(e,"height","13"),Ut(e,"viewBox","0 0 13 13"),Ut(e,"class","svelte-1aq105l")},m(r,o){Or(r,e,o),Ln(e,t),Ln(e,i)},p:jr,i:jr,o:jr,d(r){r&&Cr(e)}}}class V8 extends Wd{constructor(e){super(),Hd(this,e,null,$8,qd,{})}}function U8(n,e,t){const i=e[1],r=e[0],o=i-r;return n===i&&t?n:((n-r)%o+o)%o+r}function Ux(n){const e=[...n];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let cv;async function j8(n,e,t){const i=n?.getCenterAndZoom();for(const r of e??[])if(!(i&&(r.minZoom!=null&&r.minZoom>i[0]||r.maxZoom!=null&&r.maxZoom<i[0]))){if(r.type==="fixed")return r.coordinates.join(",");e:if(r.type==="client-geolocation"){if(cv&&r.cachedLocationExpiry&&cv.time+r.cachedLocationExpiry>Date.now()){if(!cv.coords)break e;return cv.coords}let o;try{return o=await new Promise((c,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(f=>{c([f.coords.longitude,f.coords.latitude].map(p=>p.toFixed(6)).join(","))},f=>{s(f)},r)}),o}catch{}finally{r.cachedLocationExpiry&&(cv={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(r.type==="server-geolocation")return"ip";if(i&&r.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const G8=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,xP=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,wP=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(EAST|WEST|[EW])?$/i,SP=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,TP=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,MP=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|ââ|Â´Â´|["â³â\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|Â´Â´|ââ|["â³â\.])?\s*(EAST|WEST|[EW])?$/i;function q8(n){if(!["DMS","DM","DD"].includes(n))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(b=>Number(b.trim())),t=Number(e[0]),i=Number(e[1]),r=Math.abs(t),o=Math.abs(i),c=t>0?"N":"S",s=i>0?"E":"W";let f;n=="DD"&&(f=`${r}Â° ${c}, ${o}Â° ${s}`);const p=Math.floor(r),g=Math.floor(o),_=(r-p)*60,x=(o-g)*60;if(n=="DM"){let b=CP(_,3).toFixed(3).padStart(6,"0"),M=CP(x,3).toFixed(3).padStart(6,"0");b.endsWith(".000")&&M.endsWith(".000")&&(b=b.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),f=`${p}Â° ${b}' ${c}, ${g}Â° ${M}' ${s}`}if(n=="DMS"){const b=Math.floor(_),M=Math.floor(x);let P=((_-b)*60).toFixed(1).padStart(4,"0"),k=((x-M)*60).toFixed(1).padStart(4,"0");const L=b.toString().padStart(2,"0"),I=M.toString().padStart(2,"0");P.endsWith(".0")&&k.endsWith(".0")&&(P=P.replace(/\.0$/,""),k=k.replace(/\.0$/,"")),f=`${p}Â° ${L}' ${P}" ${c}, ${g}Â° ${I}' ${k}" ${s}`}return f}else throw new Error("no decimal coordinates to convert")}function CP(n,e){const t=Math.pow(10,e);return Math.round((n+Number.EPSILON)*t)/t}function v2(n,e){e||(e=5),n=n.replace(/\s+/g," ").trim();let t=null,i=null,r="",o="",c=null,s=[],f=!1;if(G8.test(n))throw new Error("invalid coordinate value");if(xP.test(n))if(s=xP.exec(n),f=uv(s),f)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),i=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(i*=-1),c="DM";else throw new Error("invalid coordinate format");else if(wP.test(n))if(s=wP.exec(n),f=uv(s),f){if(t=s[2],i=s[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),c="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");s[1]?(r=s[1],o=s[5]):s[4]&&(r=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(SP.test(n))if(s=SP.exec(n),f=uv(s),f)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,c="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,c="DMS"),parseInt(s[2])<0&&(t=-1*t),i=Math.abs(parseInt(s[9])),s[11]&&(i+=s[11]/60),s[13]&&(i+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(i=-1*i),s[1]?(r=s[1],o=s[8]):s[7]&&(r=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(TP.test(n))if(s=TP.exec(n),f=uv(s),f)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,c="DM"),s[6]&&(t+=s[6]/3600,c="DMS"),parseInt(s[2])<0&&(t=-1*t),i=Math.abs(parseInt(s[10])),s[12]&&(i+=s[12]/60),s[14]&&(i+=s[14]/3600),parseInt(s[10])<0&&(i=-1*i),s[1]?(r=s[1],o=s[9]):s[8]&&(r=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(MP.test(n)){if(s=MP.exec(n),f=uv(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(f)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,c="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,c="DMS"),parseInt(s[2])<0&&(t=-1*t),i=Math.abs(parseInt(s[10])),s[12]&&(i+=s[12].replace(",",".")/60),s[14]&&(i+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(i=-1*i),s[1]?(r=s[1],o=s[9]):s[8]&&(r=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(f){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(r&&!o||!r&&o)throw new Error("invalid coordinates value");if(r&&r==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let p=/S|SOUTH/i;p.test(r)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&i>0&&(i=-1*i);const g=s[0].trim();let _,x;const b=/[,/;\u0020]/g,M=g.match(b);if(M==null){const L=Math.floor(n.length/2);_=g.substring(0,L).trim(),x=g.substring(L).trim()}else{let L;M.length%2==1?L=Math.floor(M.length/2):L=M.length/2-1;let I=0;if(L==0)I=g.indexOf(M[0]),_=g.substring(0,I).trim(),x=g.substring(I+1).trim();else{let F=0,N=0;for(;F<=L;)I=g.indexOf(M[F],N),N=I+1,F++;_=g.substring(0,I).trim(),x=g.substring(I+1).trim()}}const P=_.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");const k=x.split(".");if(k.length==2&&k[1]==0&&k[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:c,closeEnough:H8,toCoordinateFormat:q8})}else throw new Error("coordinates pattern match failed")}function uv(n){if(!isNaN(n[0]))return!1;const e=[...n];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,r=e.length/2;for(let o=0;o<r;o++){const c=e[o],s=e[o+r],f=t.test(c)&&t.test(s),p=i.test(c)&&i.test(s),g=c==s;if(!(c==null&&s==null)){if(c==null||s==null)return!1;if(f||p||g)continue;return!1}}return!0}function EP(n,e){const t=Math.abs(n-e);return Number(t.toFixed(6))<=1e-5}function H8(n){if(!n)throw new Error("coords must be provided");if(n.includes(",")){const e=n.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return EP(this.decimalLatitude,Number(e[0]))&&EP(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const W8=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});v2.to=W8;const Z8=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:'40Â° 7Â´ 22.8" N 74Â° 7Â´ 22.8" W',verbatimLatitude:'40Â° 7Â´ 22.8" N',verbatimLongitude:'74Â° 7Â´ 22.8" W'},{verbatimCoordinates:"40Â° 7.38â , -74Â° 7.38â",verbatimLatitude:"40Â° 7.38â",verbatimLongitude:"-74Â° 7.38â"},{verbatimCoordinates:"N40Â°7â22.8ââ, W74Â°7â22.8ââ",verbatimLatitude:"N40Â°7â22.8ââ",verbatimLongitude:"W74Â°7â22.8ââ"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:`40Â°7'22.8"N, 74Â°7'22.8"W`,verbatimLatitude:`40Â°7'22.8"N`,verbatimLongitude:`74Â°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â°,-74.123Â°",verbatimLatitude:"40.123Â°",verbatimLongitude:"-74.123Â°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40Â°7â23"N 74Â°7â23"W',verbatimLatitude:'40Â°7â23"N',verbatimLongitude:'74Â°7â23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40Â°7â23"S 74Â°7â23"E',verbatimLatitude:'40Â°7â23"S',verbatimLongitude:'74Â°7â23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40Â°7â23" -74Â°7â23"',verbatimLatitude:'40Â°7â23"',verbatimLongitude:'-74Â°7â23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7â 23" N 74d 7â 23" W',verbatimLatitude:'40d 7â 23" N',verbatimLongitude:'74d 7â 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],X8={decimalLatitude:40.123,decimalLongitude:-74.123},Y8=[{verbatimCoordinates:`50Â°4'17.698"south, 14Â°24'2.826"east`,verbatimLatitude:`50Â°4'17.698"south`,verbatimLongitude:`14Â°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40Â°26â²47â³N 79Â°58â²36â³W",verbatimLatitude:"40Â°26â²47â³N",verbatimLongitude:"79Â°58â²36â³W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26â² 47â³ N 79d 58â² 36â³ W",verbatimLatitude:"40d 26â² 47â³ N",verbatimLongitude:"79d 58â² 36â³ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195Â° 79,948862Â°",verbatimLatitude:"40,446195Â°",verbatimLongitude:"79,948862Â°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40Â° 26.7717, -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18Â°24S 22Â°45E",verbatimLatitude:"18Â°24S",verbatimLongitude:"22Â°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],K8=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245Â° S / 28.2344Â° E",verbatimLatitude:"-23.3245Â° S",verbatimLongitude:"28.2344Â° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40Â° 26.7717 -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 Â°  E22.45634 Â°",verbatimLatitude:"S23.43563 Â°",verbatimLongitude:"E22.45634 Â°",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372Â° S 23,07771Â° E",verbatimLatitude:"27,71372Â° S",verbatimLongitude:"23,07771Â° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48Â° 30,6410', E 18Â° 57,4583'",verbatimLatitude:"N 48Â° 30,6410'",verbatimLongitude:"E 18Â° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function J8(){const n=[];return Z8.forEach(e=>{e.decimalLatitude?n.push(e):n.push({...e,...X8})}),[...n,...Y8,...K8]}const Q8=J8();v2.formats=Q8.map(n=>n.verbatimCoordinates);const eU=v2;function AP(n,e,t){const i=n.slice();return i[97]=e[t],i[99]=t,i}function PP(n){let e,t,i,r,o;return t=new lD({}),{c(){e=ur("button"),Dd(t.$$.fragment),Ut(e,"type","button"),Ut(e,"title",n[3]),Ut(e,"class","svelte-bz0zu3")},m(c,s){Or(c,e,s),Sh(t,e,null),i=!0,r||(o=qs(e,"click",n[78]),r=!0)},p(c,s){(!i||s[0]&8)&&Ut(e,"title",c[3])},i(c){i||(Jr(t.$$.fragment,c),i=!0)},o(c){ks(t.$$.fragment,c),i=!1},d(c){c&&Cr(e),Th(t),r=!1,o()}}}function IP(n){let e,t;return e=new D8({}),{c(){Dd(e.$$.fragment)},m(i,r){Sh(e,i,r),t=!0},i(i){t||(Jr(e.$$.fragment,i),t=!0)},o(i){ks(e.$$.fragment,i),t=!1},d(i){Th(e,i)}}}function LP(n){let e,t,i,r,o;return t=new N8({}),{c(){e=ur("button"),Dd(t.$$.fragment),Ut(e,"type","button"),Ut(e,"title",n[10]),Ut(e,"class","svelte-bz0zu3"),su(e,"active",n[0])},m(c,s){Or(c,e,s),Sh(t,e,null),i=!0,r||(o=qs(e,"click",n[79]),r=!0)},p(c,s){(!i||s[0]&1024)&&Ut(e,"title",c[10]),(!i||s[0]&1)&&su(e,"active",c[0])},i(c){i||(Jr(t.$$.fragment,c),i=!0)},o(c){ks(t.$$.fragment,c),i=!1},d(c){c&&Cr(e),Th(t),r=!1,o()}}}function tU(n){let e,t=[],i=new Map,r,o,c,s=yP(n[13]);const f=p=>p[97].id+(p[97].address?","+p[97].address:"");for(let p=0;p<s.length;p+=1){let g=AP(n,s,p),_=f(g);i.set(_,t[p]=RP(_,g))}return{c(){e=ur("ul");for(let p=0;p<t.length;p+=1)t[p].c();Ut(e,"class","options svelte-bz0zu3"),Ut(e,"role","listbox")},m(p,g){Or(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);r=!0,o||(c=[qs(e,"mouseleave",n[27]),qs(e,"blur",n[83]),qs(e,"keydown",n[23])],o=!0)},p(p,g){g[0]&102823936&&(s=yP(p[13]),Pv(),t=g8(t,g,f,1,p,s,i,e,m8,RP,null,AP),Iv())},i(p){if(!r){for(let g=0;g<s.length;g+=1)Jr(t[g]);r=!0}},o(p){for(let g=0;g<t.length;g+=1)ks(t[g]);r=!1},d(p){p&&Cr(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,Rh(c)}}}function iU(n){let e,t,i,r,o,c;return t=new cD({}),{c(){e=ur("div"),Dd(t.$$.fragment),i=Xa(),r=ur("div"),o=kd(n[8]),Ut(r,"class","svelte-bz0zu3"),Ut(e,"class","no-results svelte-bz0zu3")},m(s,f){Or(s,e,f),Sh(t,e,null),Ln(e,i),Ln(e,r),Ln(r,o),c=!0},p(s,f){(!c||f[0]&256)&&my(o,s[8])},i(s){c||(Jr(t.$$.fragment,s),c=!0)},o(s){ks(t.$$.fragment,s),c=!1},d(s){s&&Cr(e),Th(t)}}}function nU(n){let e="",t;return{c(){t=kd(e)},m(i,r){Or(i,t,r)},p:jr,i:jr,o:jr,d(i){i&&Cr(t)}}}function rU(n){let e,t,i,r,o,c,s,f,p,g,_;return t=new cD({}),f=new lD({}),{c(){e=ur("div"),Dd(t.$$.fragment),i=Xa(),r=ur("div"),o=kd(n[7]),c=Xa(),s=ur("button"),Dd(f.$$.fragment),Ut(r,"class","svelte-bz0zu3"),Ut(s,"class","svelte-bz0zu3"),Ut(e,"class","error svelte-bz0zu3")},m(x,b){Or(x,e,b),Sh(t,e,null),Ln(e,i),Ln(e,r),Ln(r,o),Ln(e,c),Ln(e,s),Sh(f,s,null),p=!0,g||(_=qs(s,"click",n[80]),g=!0)},p(x,b){(!p||b[0]&128)&&my(o,x[7])},i(x){p||(Jr(t.$$.fragment,x),Jr(f.$$.fragment,x),p=!0)},o(x){ks(t.$$.fragment,x),ks(f.$$.fragment,x),p=!1},d(x){x&&Cr(e),Th(t),Th(f),g=!1,_()}}}function RP(n,e){var t;let i,r,o;function c(){return e[81](e[99])}function s(){return e[82](e[97])}return r=new R8({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((t=e[14])==null?void 0:t.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),r.$on("mouseenter",c),r.$on("select",s),{key:n,first:null,c(){i=s8(),Dd(r.$$.fragment),this.first=i},m(f,p){Or(f,i,p),Sh(r,f,p),o=!0},p(f,p){var g;e=f;const _={};p[0]&8192&&(_.feature=e[97]),p[0]&2048&&(_.showPlaceType=e[11]),p[0]&57344&&(_.style=e[15]===e[99]?"selected":((g=e[14])==null?void 0:g.id)===e[97].id?"picked":"default"),p[0]&4096&&(_.iconsBaseUrl=e[12]),r.$set(_)},i(f){o||(Jr(r.$$.fragment,f),o=!0)},o(f){ks(r.$$.fragment,f),o=!1},d(f){f&&Cr(i),Th(r,f)}}}function sU(n){let e,t,i,r,o,c,s,f,p,g,_,x,b,M,P,k,L,I,F,N=!1;o=new V8({});let H=!n[20]&&PP(n),Y=n[20]&&IP(),q=n[6]==="button"&&LP(n);const U=n[70].default,G=t8(U,n,n[69],null),j=[rU,nU,iU,tU],B=[];function ne(J,le){var ae,pe;return J[19]?0:!J[16]&&!J[4]?1:((ae=J[13])==null?void 0:ae.length)===0?2:(pe=J[13])!=null&&pe.length&&(J[16]||J[4])?3:-1}return~(M=ne(n))&&(P=B[M]=j[M](n)),{c(){e=Xa(),t=ur("form"),i=ur("div"),r=ur("button"),Dd(o.$$.fragment),c=Xa(),s=ur("input"),f=Xa(),p=ur("div"),H&&H.c(),g=Xa(),Y&&Y.c(),_=Xa(),q&&q.c(),x=Xa(),G&&G.c(),b=Xa(),P&&P.c(),Ut(r,"class","search-button svelte-bz0zu3"),Ut(r,"type","button"),Ut(s,"placeholder",n[9]),Ut(s,"aria-label",n[9]),Ut(s,"class","svelte-bz0zu3"),Ut(p,"class","clear-button-container svelte-bz0zu3"),su(p,"displayable",n[1]!==""),Ut(i,"class","input-group svelte-bz0zu3"),Ut(t,"class",k=Vx(n[2])+" svelte-bz0zu3"),su(t,"can-collapse",n[5]&&n[1]==="")},m(J,le){Or(J,e,le),Or(J,t,le),Ln(t,i),Ln(i,r),Sh(o,r,null),Ln(i,c),Ln(i,s),n[72](s),_P(s,n[1]),Ln(i,f),Ln(i,p),H&&H.m(p,null),Ln(p,g),Y&&Y.m(p,null),Ln(i,_),q&&q.m(i,null),Ln(i,x),G&&G.m(i,null),Ln(t,b),~M&&B[M].m(t,null),L=!0,I||(F=[qs(r,"click",n[71]),qs(s,"input",n[73]),qs(s,"focus",n[74]),qs(s,"blur",n[75]),qs(s,"click",n[76]),qs(s,"keydown",n[23]),qs(s,"input",n[24]),qs(s,"change",n[77]),qs(t,"submit",o8(n[22]))],I=!0)},p(J,le){(!L||le[0]&512)&&Ut(s,"placeholder",J[9]),(!L||le[0]&512)&&Ut(s,"aria-label",J[9]),le[0]&2&&s.value!==J[1]&&_P(s,J[1]),J[20]?H&&(Pv(),ks(H,1,1,()=>{H=null}),Iv()):H?(H.p(J,le),le[0]&1048576&&Jr(H,1)):(H=PP(J),H.c(),Jr(H,1),H.m(p,g)),J[20]?Y?le[0]&1048576&&Jr(Y,1):(Y=IP(),Y.c(),Jr(Y,1),Y.m(p,null)):Y&&(Pv(),ks(Y,1,1,()=>{Y=null}),Iv()),(!L||le[0]&2)&&su(p,"displayable",J[1]!==""),J[6]==="button"?q?(q.p(J,le),le[0]&64&&Jr(q,1)):(q=LP(J),q.c(),Jr(q,1),q.m(i,x)):q&&(Pv(),ks(q,1,1,()=>{q=null}),Iv()),G&&G.p&&(!L||le[2]&128)&&n8(G,U,J,J[69],L?i8(U,J[69]):r8(J[69]),null);let ae=M;M=ne(J),M===ae?~M&&B[M].p(J,le):(P&&(Pv(),ks(B[ae],1,1,()=>{B[ae]=null}),Iv()),~M?(P=B[M],P?P.p(J,le):(P=B[M]=j[M](J),P.c()),Jr(P,1),P.m(t,null)):P=null),(!L||le[0]&4&&k!==(k=Vx(J[2])+" svelte-bz0zu3"))&&Ut(t,"class",k),(!L||le[0]&38)&&su(t,"can-collapse",J[5]&&J[1]==="")},i(J){L||(Jr(N),Jr(o.$$.fragment,J),Jr(H),Jr(Y),Jr(q),Jr(G,J),Jr(P),L=!0)},o(J){ks(N),ks(o.$$.fragment,J),ks(H),ks(Y),ks(q),ks(G,J),ks(P),L=!1},d(J){J&&(Cr(e),Cr(t)),Th(o),n[72](null),H&&H.d(),Y&&Y.d(),q&&q.d(),G&&G.d(J),~M&&B[M].d(),I=!1,Rh(F)}}}function oU(n,e,t){let i,r,o,{$$slots:c={},$$scope:s}=e;const f={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:p=void 0}=e,{apiKey:g=void 0}=e,{bbox:_=void 0}=e,{clearButtonTitle:x="clear"}=e,{clearOnBlur:b=!1}=e,{clearListOnPick:M=!1}=e,{keepListOpen:P=!1}=e,{collapsed:k=!1}=e,{country:L=void 0}=e,{debounceSearch:I=200}=e,{enableReverse:F="never"}=e,{errorMessage:N="Something went wrongâ¦"}=e,{filter:H=()=>!0}=e,{flyTo:Y=!0}=e,{fuzzyMatch:q=!0}=e,{language:U=void 0}=e,{limit:G=void 0}=e;const j=41415112612;let{reverseGeocodingLimit:B=j}=e,{mapController:ne=void 0}=e,{minLength:J=2}=e,{noResultsMessage:le="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ae="Search"}=e,{proximity:pe=[{type:"server-geolocation"}]}=e,{reverseActive:fe=F==="always"}=e,{reverseButtonTitle:Te="toggle reverse geocoding"}=e,{searchValue:Ce=""}=e,{pickedResultStyle:tt="full-geometry"}=e,{showPlaceType:Ke="if-needed"}=e,{showResultsWhileTyping:dt=!0}=e,{selectFirst:et=!0}=e,{flyToSelected:Oe=!1}=e,{markerOnSelected:lt=!0}=e,{types:Ye=void 0}=e;const zt=[];let{reverseGeocodingTypes:Lt=zt}=e,{exhaustiveReverseGeocoding:At=!1}=e,{excludeTypes:Nt=!1}=e;const $t=void 0;let{reverseGeocodingExcludeTypes:Ze=$t}=e,{zoom:bt=f}=e,{apiUrl:Mt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Zt={}}=e,{iconsBaseUrl:Pt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=e,{adjustUrlQuery:Ee=()=>{}}=e,{adjustUrl:xe=()=>{}}=e;function ft(ut){ue.focus(ut)}function ve(){ue.blur()}function te(ut,Li=!0,bi=!1){t(1,Ce=ut),Li?(t(15,de=-1),vi()):(yn(void 0,!bi,bi),setTimeout(()=>{ue.focus(),ue.select()}))}function se(){t(13,Ue=void 0),t(14,we=void 0),t(15,de=-1)}function Ie(){t(64,ct=[]),t(14,we=void 0)}let Ue,ct,we,Q="",ue,de=-1,Pe,Re=[],rt,ot,Xe,mt,Et=!1;const kt=new Set,Jt=oD();c8(()=>{ne&&(ne.setEventHandler(void 0),ne.indicateReverse(!1),ne.setSelectedMarker(-1),ne.setFeatures(void 0,void 0,!1))});function vi(ut){if(t(17,Et=!1),ot&&(clearTimeout(ot),ot=void 0),de>-1&&Ue)t(14,we=Ue[de]),t(1,Ce=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(19,Pe=void 0),t(64,ct=void 0),t(15,de=-1);else if(Ce){const Li=ut||!$i(Ce);vn(Ce,{exact:!0}).then(()=>{t(64,ct=Ue),t(14,we=void 0),Li&&rn()}).catch(bi=>t(19,Pe=bi))}}function $i(ut){try{return eU(ut,6)}catch{return!1}}async function vn(ut,{byId:Li=!1,exact:bi=!1}={}){var Ni,Kn,Zi;t(19,Pe=void 0),rt?.abort();const Un=new AbortController;t(20,rt=Un);try{const sn=$i(ut),zr=new URL(Mt+"/"+encodeURIComponent(sn?sn.decimalLongitude+","+sn.decimalLatitude:ut)+".json"),jn=zr.searchParams;U!==void 0&&jn.set("language",Array.isArray(U)?U.join(","):U??"");const[an]=ne?.getCenterAndZoom()??[];let Qi=(Ni=!sn||Lt===zt?Ye:Lt)==null?void 0:Ni.map(nr=>typeof nr=="string"?nr:an===void 0||(nr[0]??0)<=an&&an<(nr[1]??1/0)?nr[2]:void 0).filter(nr=>nr!==void 0);Qi&&(Qi=[...new Set(Qi)],jn.set("types",Qi.join(",")));const ts=!sn||Ze===$t?Nt:Ze;if(ts&&jn.set("excludeTypes",String(ts)),_&&jn.set("bbox",_.map(nr=>nr.toFixed(6)).join(",")),L&&jn.set("country",Array.isArray(L)?L.join(","):L),!Li&&!sn){const nr=await j8(ne,pe,Un);nr&&jn.set("proximity",nr),(bi||!dt)&&jn.set("autocomplete","false"),jn.set("fuzzyMatch",String(q))}const ro=B===j?G:B;ro!==void 0&&ro>1&&Qi?.length!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),sn?(ro===1||ro!==void 0&&(At||Qi?.length===1))&&jn.set("limit",String(ro)):G!==void 0&&jn.set("limit",String(G)),g&&jn.set("key",g),Ee(jn),xe(zr);const hl=zr.searchParams.get("types")===""&&zr.searchParams.get("excludeTypes")!=="true",xo=zr.toString();if(xo===Q){Li?(M&&t(13,Ue=void 0),t(14,we=Re[0])):(t(13,Ue=Re),((Kn=Ue[de])==null?void 0:Kn.id)!==r?.id&&t(15,de=-1));return}Q=xo;let Ar;if(hl)Ar={type:"FeatureCollection",features:[]};else{const nr=await fetch(xo,{signal:Un.signal,...Zt});if(!nr.ok)throw new Error(await nr.text());Ar=await nr.json()}Jt("response",{url:xo,featureCollection:Ar}),Li?(M&&t(13,Ue=void 0),t(14,we=Ar.features[0]),Re=[we]):(t(13,Ue=Ar.features.filter(H)),sn&&Ue.unshift({type:"Feature",properties:{},id:"reverse_"+sn.decimalLongitude+"_"+sn.decimalLatitude,text:sn.decimalLatitude+", "+sn.decimalLongitude,place_name:sn.decimalLatitude+", "+sn.decimalLongitude,place_type:["reverse"],center:[sn.decimalLongitude,sn.decimalLatitude],bbox:[sn.decimalLongitude,sn.decimalLatitude,sn.decimalLongitude,sn.decimalLatitude],geometry:{type:"Point",coordinates:[sn.decimalLongitude,sn.decimalLatitude]}}),Re=Ue,((Zi=Ue[de])==null?void 0:Zi.id)!==r?.id&&t(15,de=-1),sn&&ue.focus())}catch(sn){if(sn&&typeof sn=="object"&&"name"in sn&&sn.name==="AbortError")return;throw sn}finally{Un===rt&&t(20,rt=void 0)}}function rn(){var ut;if(!(ct!=null&&ct.length)||!Y)return;const Li=[180,90,-180,-90],bi=!ct.some(Kn=>!Kn.matching_text);let Ni;for(const Kn of ct){const Zi=gn(Kn);if(Ni=Ni===void 0?Zi:Zi===void 0?Ni:Math.max(Ni,Zi),bi||!Kn.matching_text)for(const Un of[0,1,2,3])Li[Un]=Math[Un<2?"min":"max"](Li[Un],((ut=Kn.bbox)==null?void 0:ut[Un])??Kn.center[Un%2])}ne&&ct.length>0&&(we&&Li[0]===Li[2]&&Li[1]===Li[3]?ne.flyTo(we.center,gn(we)):ne.fitBounds(Ux(Li),50,Ni))}function gt(){!we||!ne||(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?ne.flyTo(we.center,gn(we)):ne.fitBounds(Ux(we.bbox),50,gn(we)))}function gn(ut){var Li;if(!ut.bbox||ut.bbox[0]!==ut.bbox[2]&&ut.bbox[1]!==ut.bbox[3])return;const bi=ut.id.replace(/\..*/,"");return(Array.isArray((Li=ut.properties)==null?void 0:Li.categories)?ut.properties.categories.reduce((Ni,Kn)=>{const Zi=bt[bi+"."+Kn];return Ni===void 0?Zi:Zi===void 0?Ni:Math.max(Ni,Zi)},void 0):void 0)??bt[bi]}function Er(ut){t(0,fe=F==="always"),t(13,Ue=void 0),t(14,we=void 0),t(15,de=-1),te(ut[1].toFixed(6)+", "+U8(ut[0],[-180,180],!0).toFixed(6),!1,!0)}function Di(ut){if(!Ue)return;let Li=ut.key==="ArrowDown"?1:ut.key==="ArrowUp"?-1:0;Li&&(ue.focus(),t(17,Et=!0),ut.preventDefault(),we&&de===-1&&t(15,de=Ue.findIndex(bi=>bi.id===we?.id)),de===(we||et?0:-1)&&Li===-1&&t(15,de=Ue.length),t(15,de+=Li),de>=Ue.length&&t(15,de=-1),de<0&&(we||et)&&t(15,de=0))}function yn(ut,Li=!0,bi=!1){if(t(19,Pe=void 0),t(14,we=void 0),t(17,Et=!0),dt||bi){if(ot&&clearTimeout(ot),Ce.length<J)return;const Ni=Ce;ot=window.setTimeout(()=>{vn(Ni).catch(Kn=>t(19,Pe=Kn))},Li?I:0)}else t(13,Ue=void 0),t(19,Pe=void 0)}function Yn(ut){we&&we?.id===ut?.id?gt():(t(14,we=ut),t(1,Ce=ut.place_name))}function Cn(ut){t(15,de=ut)}function Vn(){(!et||we)&&t(15,de=-1),Oe&&gt()}const En=()=>ue.focus();function dr(ut){WT[ut?"unshift":"push"](()=>{ue=ut,t(18,ue)})}function $e(){Ce=this.value,t(1,Ce),t(17,Et),t(31,b),t(16,Xe)}const Ct=()=>t(17,Et=!0),Qe=()=>t(17,Et=!1),It=()=>t(17,Et=!0),Gt=()=>t(14,we=void 0),qi=()=>{t(1,Ce=""),t(14,we=void 0),ue.focus()},Ii=()=>t(0,fe=!fe),Dt=()=>t(19,Pe=void 0),ai=ut=>Cn(ut),pi=ut=>Yn(ut),Hi=()=>{};return n.$$set=ut=>{"class"in ut&&t(2,p=ut.class),"apiKey"in ut&&t(29,g=ut.apiKey),"bbox"in ut&&t(30,_=ut.bbox),"clearButtonTitle"in ut&&t(3,x=ut.clearButtonTitle),"clearOnBlur"in ut&&t(31,b=ut.clearOnBlur),"clearListOnPick"in ut&&t(32,M=ut.clearListOnPick),"keepListOpen"in ut&&t(4,P=ut.keepListOpen),"collapsed"in ut&&t(5,k=ut.collapsed),"country"in ut&&t(33,L=ut.country),"debounceSearch"in ut&&t(34,I=ut.debounceSearch),"enableReverse"in ut&&t(6,F=ut.enableReverse),"errorMessage"in ut&&t(7,N=ut.errorMessage),"filter"in ut&&t(35,H=ut.filter),"flyTo"in ut&&t(36,Y=ut.flyTo),"fuzzyMatch"in ut&&t(37,q=ut.fuzzyMatch),"language"in ut&&t(38,U=ut.language),"limit"in ut&&t(39,G=ut.limit),"reverseGeocodingLimit"in ut&&t(40,B=ut.reverseGeocodingLimit),"mapController"in ut&&t(41,ne=ut.mapController),"minLength"in ut&&t(42,J=ut.minLength),"noResultsMessage"in ut&&t(8,le=ut.noResultsMessage),"placeholder"in ut&&t(9,ae=ut.placeholder),"proximity"in ut&&t(43,pe=ut.proximity),"reverseActive"in ut&&t(0,fe=ut.reverseActive),"reverseButtonTitle"in ut&&t(10,Te=ut.reverseButtonTitle),"searchValue"in ut&&t(1,Ce=ut.searchValue),"pickedResultStyle"in ut&&t(44,tt=ut.pickedResultStyle),"showPlaceType"in ut&&t(11,Ke=ut.showPlaceType),"showResultsWhileTyping"in ut&&t(45,dt=ut.showResultsWhileTyping),"selectFirst"in ut&&t(46,et=ut.selectFirst),"flyToSelected"in ut&&t(47,Oe=ut.flyToSelected),"markerOnSelected"in ut&&t(48,lt=ut.markerOnSelected),"types"in ut&&t(49,Ye=ut.types),"reverseGeocodingTypes"in ut&&t(50,Lt=ut.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in ut&&t(51,At=ut.exhaustiveReverseGeocoding),"excludeTypes"in ut&&t(52,Nt=ut.excludeTypes),"reverseGeocodingExcludeTypes"in ut&&t(53,Ze=ut.reverseGeocodingExcludeTypes),"zoom"in ut&&t(54,bt=ut.zoom),"apiUrl"in ut&&t(55,Mt=ut.apiUrl),"fetchParameters"in ut&&t(56,Zt=ut.fetchParameters),"iconsBaseUrl"in ut&&t(12,Pt=ut.iconsBaseUrl),"adjustUrlQuery"in ut&&t(57,Ee=ut.adjustUrlQuery),"adjustUrl"in ut&&t(58,xe=ut.adjustUrl),"$$scope"in ut&&t(69,s=ut.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&64&&t(0,fe=F==="always"),n.$$.dirty[0]&16384|n.$$.dirty[1]&8192&&tt!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&vn(we.id,{byId:!0}).catch(ut=>t(19,Pe=ut)),n.$$.dirty[0]&16384|n.$$.dirty[1]&1058|n.$$.dirty[2]&8&&(ne&&we&&we.id!==mt&&Y&&(gt(),M&&t(13,Ue=void 0),t(64,ct=void 0),t(15,de=-1)),t(65,mt=we?.id)),n.$$.dirty[0]&196608|n.$$.dirty[1]&1&&setTimeout(()=>{t(16,Xe=Et),b&&!Xe&&t(1,Ce="")}),n.$$.dirty[0]&8194|n.$$.dirty[1]&2048&&Ce.length<J&&(t(13,Ue=void 0),t(19,Pe=void 0),t(64,ct=Ue)),n.$$.dirty[0]&57344|n.$$.dirty[1]&32768&&et&&Ue!=null&&Ue.length&&de==-1&&!we&&t(15,de=0),n.$$.dirty[0]&8192|n.$$.dirty[2]&4&&ct!==Ue&&t(64,ct=void 0),n.$$.dirty[0]&73729|n.$$.dirty[1]&1024|n.$$.dirty[2]&4&&ne&&ne.setEventHandler(ut=>{switch(ut.type){case"mapClick":fe&&Er(ut.coordinates);break;case"markerClick":{const Li=Ue?.find(bi=>bi.id===ut.id);Li&&Yn(Li)}break;case"markerMouseEnter":ct&&t(15,de=Xe?Ue?.findIndex(Li=>Li.id===ut.id)??-1:-1);break;case"markerMouseLeave":ct&&t(15,de=-1);break}}),n.$$.dirty[0]&40960&&t(66,r=Ue?.[de]),n.$$.dirty[1]&66592|n.$$.dirty[2]&16&&ne&&r&&Y&&Oe&&ne.flyTo(r.center,gn(r)),n.$$.dirty[1]&8192&&t(68,i=tt==="full-geometry-including-polygon-center-marker"),n.$$.dirty[1]&132096|n.$$.dirty[2]&64&&(lt||ne==null||ne.setFeatures(void 0,void 0,i)),n.$$.dirty[0]&16384|n.$$.dirty[1]&132096|n.$$.dirty[2]&84&&ne&&lt&&!ct&&(ne.setFeatures(r?[r]:void 0,we,i),ne.setSelectedMarker(r?0:-1)),n.$$.dirty[0]&16384|n.$$.dirty[1]&1024|n.$$.dirty[2]&68&&ne&&ne.setFeatures(ct,we,i),n.$$.dirty[0]&32768|n.$$.dirty[1]&1024|n.$$.dirty[2]&4&&ct&&ne&&ne.setSelectedMarker(de),n.$$.dirty[0]&2|n.$$.dirty[1]&1024&&ne){const ut=$i(Ce);ne.setReverseMarker(ut?[ut.decimalLongitude,ut.decimalLatitude]:void 0)}n.$$.dirty[2]&16&&Jt("select",{feature:r}),n.$$.dirty[0]&16384&&Jt("pick",{feature:we}),n.$$.dirty[0]&73744&&t(67,o=!!(Ue!=null&&Ue.length)&&(Xe||P)),n.$$.dirty[2]&32&&Jt("optionsvisibilitychange",{optionsVisible:o}),n.$$.dirty[0]&8192&&Jt("featureslisted",{features:Ue}),n.$$.dirty[2]&4&&Jt("featuresmarked",{features:ct}),n.$$.dirty[0]&1&&Jt("reversetoggle",{reverse:fe}),n.$$.dirty[0]&2&&Jt("querychange",{query:Ce}),n.$$.dirty[0]&1|n.$$.dirty[1]&1024&&ne&&ne.indicateReverse(fe)},[fe,Ce,p,x,P,k,F,N,le,ae,Te,Ke,Pt,Ue,we,de,Xe,Et,ue,Pe,rt,kt,vi,Di,yn,Yn,Cn,Vn,f,g,_,b,M,L,I,H,Y,q,U,G,B,ne,J,pe,tt,dt,et,Oe,lt,Ye,Lt,At,Nt,Ze,bt,Mt,Zt,Ee,xe,ft,ve,te,se,Ie,ct,mt,r,o,i,s,c,En,dr,$e,Ct,Qe,It,Gt,qi,Ii,Dt,ai,pi,Hi]}let aU=class extends Wd{constructor(n){super(),Hd(this,n,oU,sU,qd,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}};function _y(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}function y2(n,e,t={}){for(const i of n){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let r=0;r<i[i.length-1].length;r++)if(i[i.length-1][r]!==i[0][r])throw new Error("First and last Position are not equivalent.")}return _y({type:"Polygon",coordinates:n},e,t)}function vy(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}function hD(n,e,t={}){return _y({type:"MultiPolygon",coordinates:n},e,t)}var lU=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,SS=Math.ceil,Cl=Math.floor,fa="[BigNumber Error] ",kP=fa+"Number primitive has more than 15 significant digits: ",dc=1e14,hn=14,DP=9007199254740991,TS=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ld=1e7,Ga=1e9;function dD(n){var e,t,i,r=I.prototype={constructor:I,toString:null,valueOf:null},o=new I(1),c=20,s=4,f=-7,p=21,g=-1e7,_=1e7,x=!1,b=1,M=0,P={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},k="0123456789abcdefghijklmnopqrstuvwxyz",L=!0;function I(U,G){var j,B,ne,J,le,ae,pe,fe,Te=this;if(!(Te instanceof I))return new I(U,G);if(G==null){if(U&&U._isBigNumber===!0){Te.s=U.s,!U.c||U.e>_?Te.c=Te.e=null:U.e<g?Te.c=[Te.e=0]:(Te.e=U.e,Te.c=U.c.slice());return}if((ae=typeof U=="number")&&U*0==0){if(Te.s=1/U<0?(U=-U,-1):1,U===~~U){for(J=0,le=U;le>=10;le/=10,J++);J>_?Te.c=Te.e=null:(Te.e=J,Te.c=[U]);return}fe=String(U)}else{if(!lU.test(fe=String(U)))return i(Te,fe,ae);Te.s=fe.charCodeAt(0)==45?(fe=fe.slice(1),-1):1}(J=fe.indexOf("."))>-1&&(fe=fe.replace(".","")),(le=fe.search(/e/i))>0?(J<0&&(J=le),J+=+fe.slice(le+1),fe=fe.substring(0,le)):J<0&&(J=fe.length)}else{if(rs(G,2,k.length,"Base"),G==10&&L)return Te=new I(U),Y(Te,c+Te.e+1,s);if(fe=String(U),ae=typeof U=="number"){if(U*0!=0)return i(Te,fe,ae,G);if(Te.s=1/U<0?(fe=fe.slice(1),-1):1,I.DEBUG&&fe.replace(/^0\.0*|\./,"").length>15)throw Error(kP+U)}else Te.s=fe.charCodeAt(0)===45?(fe=fe.slice(1),-1):1;for(j=k.slice(0,G),J=le=0,pe=fe.length;le<pe;le++)if(j.indexOf(B=fe.charAt(le))<0){if(B=="."){if(le>J){J=pe;continue}}else if(!ne&&(fe==fe.toUpperCase()&&(fe=fe.toLowerCase())||fe==fe.toLowerCase()&&(fe=fe.toUpperCase()))){ne=!0,le=-1,J=0;continue}return i(Te,String(U),ae,G)}ae=!1,fe=t(fe,G,10,Te.s),(J=fe.indexOf("."))>-1?fe=fe.replace(".",""):J=fe.length}for(le=0;fe.charCodeAt(le)===48;le++);for(pe=fe.length;fe.charCodeAt(--pe)===48;);if(fe=fe.slice(le,++pe)){if(pe-=le,ae&&I.DEBUG&&pe>15&&(U>DP||U!==Cl(U)))throw Error(kP+Te.s*U);if((J=J-le-1)>_)Te.c=Te.e=null;else if(J<g)Te.c=[Te.e=0];else{if(Te.e=J,Te.c=[],le=(J+1)%hn,J<0&&(le+=hn),le<pe){for(le&&Te.c.push(+fe.slice(0,le)),pe-=hn;le<pe;)Te.c.push(+fe.slice(le,le+=hn));le=hn-(fe=fe.slice(le)).length}else le-=pe;for(;le--;fe+="0");Te.c.push(+fe)}}else Te.c=[Te.e=0]}I.clone=dD,I.ROUND_UP=0,I.ROUND_DOWN=1,I.ROUND_CEIL=2,I.ROUND_FLOOR=3,I.ROUND_HALF_UP=4,I.ROUND_HALF_DOWN=5,I.ROUND_HALF_EVEN=6,I.ROUND_HALF_CEIL=7,I.ROUND_HALF_FLOOR=8,I.EUCLID=9,I.config=I.set=function(U){var G,j;if(U!=null)if(typeof U=="object"){if(U.hasOwnProperty(G="DECIMAL_PLACES")&&(j=U[G],rs(j,0,Ga,G),c=j),U.hasOwnProperty(G="ROUNDING_MODE")&&(j=U[G],rs(j,0,8,G),s=j),U.hasOwnProperty(G="EXPONENTIAL_AT")&&(j=U[G],j&&j.pop?(rs(j[0],-1e9,0,G),rs(j[1],0,Ga,G),f=j[0],p=j[1]):(rs(j,-1e9,Ga,G),f=-(p=j<0?-j:j))),U.hasOwnProperty(G="RANGE"))if(j=U[G],j&&j.pop)rs(j[0],-1e9,-1,G),rs(j[1],1,Ga,G),g=j[0],_=j[1];else if(rs(j,-1e9,Ga,G),j)g=-(_=j<0?-j:j);else throw Error(fa+G+" cannot be zero: "+j);if(U.hasOwnProperty(G="CRYPTO"))if(j=U[G],j===!!j)if(j)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))x=j;else throw x=!j,Error(fa+"crypto unavailable");else x=j;else throw Error(fa+G+" not true or false: "+j);if(U.hasOwnProperty(G="MODULO_MODE")&&(j=U[G],rs(j,0,9,G),b=j),U.hasOwnProperty(G="POW_PRECISION")&&(j=U[G],rs(j,0,Ga,G),M=j),U.hasOwnProperty(G="FORMAT"))if(j=U[G],typeof j=="object")P=j;else throw Error(fa+G+" not an object: "+j);if(U.hasOwnProperty(G="ALPHABET"))if(j=U[G],typeof j=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(j))L=j.slice(0,10)=="0123456789",k=j;else throw Error(fa+G+" invalid: "+j)}else throw Error(fa+"Object expected: "+U);return{DECIMAL_PLACES:c,ROUNDING_MODE:s,EXPONENTIAL_AT:[f,p],RANGE:[g,_],CRYPTO:x,MODULO_MODE:b,POW_PRECISION:M,FORMAT:P,ALPHABET:k}},I.isBigNumber=function(U){if(!U||U._isBigNumber!==!0)return!1;if(!I.DEBUG)return!0;var G,j,B=U.c,ne=U.e,J=U.s;e:if({}.toString.call(B)=="[object Array]"){if((J===1||J===-1)&&ne>=-1e9&&ne<=Ga&&ne===Cl(ne)){if(B[0]===0){if(ne===0&&B.length===1)return!0;break e}if(G=(ne+1)%hn,G<1&&(G+=hn),String(B[0]).length==G){for(G=0;G<B.length;G++)if(j=B[G],j<0||j>=dc||j!==Cl(j))break e;if(j!==0)return!0}}}else if(B===null&&ne===null&&(J===null||J===1||J===-1))return!0;throw Error(fa+"Invalid BigNumber: "+U)},I.maximum=I.max=function(){return N(arguments,-1)},I.minimum=I.min=function(){return N(arguments,1)},I.random=(function(){var U=9007199254740992,G=Math.random()*U&2097151?function(){return Cl(Math.random()*U)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(j){var B,ne,J,le,ae,pe=0,fe=[],Te=new I(o);if(j==null?j=c:rs(j,0,Ga),le=SS(j/hn),x)if(crypto.getRandomValues){for(B=crypto.getRandomValues(new Uint32Array(le*=2));pe<le;)ae=B[pe]*131072+(B[pe+1]>>>11),ae>=9e15?(ne=crypto.getRandomValues(new Uint32Array(2)),B[pe]=ne[0],B[pe+1]=ne[1]):(fe.push(ae%1e14),pe+=2);pe=le/2}else if(crypto.randomBytes){for(B=crypto.randomBytes(le*=7);pe<le;)ae=(B[pe]&31)*281474976710656+B[pe+1]*1099511627776+B[pe+2]*4294967296+B[pe+3]*16777216+(B[pe+4]<<16)+(B[pe+5]<<8)+B[pe+6],ae>=9e15?crypto.randomBytes(7).copy(B,pe):(fe.push(ae%1e14),pe+=7);pe=le/7}else throw x=!1,Error(fa+"crypto unavailable");if(!x)for(;pe<le;)ae=G(),ae<9e15&&(fe[pe++]=ae%1e14);for(le=fe[--pe],j%=hn,le&&j&&(ae=TS[hn-j],fe[pe]=Cl(le/ae)*ae);fe[pe]===0;fe.pop(),pe--);if(pe<0)fe=[J=0];else{for(J=-1;fe[0]===0;fe.splice(0,1),J-=hn);for(pe=1,ae=fe[0];ae>=10;ae/=10,pe++);pe<hn&&(J-=hn-pe)}return Te.e=J,Te.c=fe,Te}})(),I.sum=function(){for(var U=1,G=arguments,j=new I(G[0]);U<G.length;)j=j.plus(G[U++]);return j},t=(function(){var U="0123456789";function G(j,B,ne,J){for(var le,ae=[0],pe,fe=0,Te=j.length;fe<Te;){for(pe=ae.length;pe--;ae[pe]*=B);for(ae[0]+=J.indexOf(j.charAt(fe++)),le=0;le<ae.length;le++)ae[le]>ne-1&&(ae[le+1]==null&&(ae[le+1]=0),ae[le+1]+=ae[le]/ne|0,ae[le]%=ne)}return ae.reverse()}return function(j,B,ne,J,le){var ae,pe,fe,Te,Ce,tt,Ke,dt,et=j.indexOf("."),Oe=c,lt=s;for(et>=0&&(Te=M,M=0,j=j.replace(".",""),dt=new I(B),tt=dt.pow(j.length-et),M=Te,dt.c=G(Ju(Tl(tt.c),tt.e,"0"),10,ne,U),dt.e=dt.c.length),Ke=G(j,B,ne,le?(ae=k,U):(ae=U,k)),fe=Te=Ke.length;Ke[--Te]==0;Ke.pop());if(!Ke[0])return ae.charAt(0);if(et<0?--fe:(tt.c=Ke,tt.e=fe,tt.s=J,tt=e(tt,dt,Oe,lt,ne),Ke=tt.c,Ce=tt.r,fe=tt.e),pe=fe+Oe+1,et=Ke[pe],Te=ne/2,Ce=Ce||pe<0||Ke[pe+1]!=null,Ce=lt<4?(et!=null||Ce)&&(lt==0||lt==(tt.s<0?3:2)):et>Te||et==Te&&(lt==4||Ce||lt==6&&Ke[pe-1]&1||lt==(tt.s<0?8:7)),pe<1||!Ke[0])j=Ce?Ju(ae.charAt(1),-Oe,ae.charAt(0)):ae.charAt(0);else{if(Ke.length=pe,Ce)for(--ne;++Ke[--pe]>ne;)Ke[pe]=0,pe||(++fe,Ke=[1].concat(Ke));for(Te=Ke.length;!Ke[--Te];);for(et=0,j="";et<=Te;j+=ae.charAt(Ke[et++]));j=Ju(j,fe,ae.charAt(0))}return j}})(),e=(function(){function U(B,ne,J){var le,ae,pe,fe,Te=0,Ce=B.length,tt=ne%ld,Ke=ne/ld|0;for(B=B.slice();Ce--;)pe=B[Ce]%ld,fe=B[Ce]/ld|0,le=Ke*pe+fe*tt,ae=tt*pe+le%ld*ld+Te,Te=(ae/J|0)+(le/ld|0)+Ke*fe,B[Ce]=ae%J;return Te&&(B=[Te].concat(B)),B}function G(B,ne,J,le){var ae,pe;if(J!=le)pe=J>le?1:-1;else for(ae=pe=0;ae<J;ae++)if(B[ae]!=ne[ae]){pe=B[ae]>ne[ae]?1:-1;break}return pe}function j(B,ne,J,le){for(var ae=0;J--;)B[J]-=ae,ae=B[J]<ne[J]?1:0,B[J]=ae*le+B[J]-ne[J];for(;!B[0]&&B.length>1;B.splice(0,1));}return function(B,ne,J,le,ae){var pe,fe,Te,Ce,tt,Ke,dt,et,Oe,lt,Ye,zt,Lt,At,Nt,$t,Ze,bt=B.s==ne.s?1:-1,Mt=B.c,Zt=ne.c;if(!Mt||!Mt[0]||!Zt||!Zt[0])return new I(!B.s||!ne.s||(Mt?Zt&&Mt[0]==Zt[0]:!Zt)?NaN:Mt&&Mt[0]==0||!Zt?bt*0:bt/0);for(et=new I(bt),Oe=et.c=[],fe=B.e-ne.e,bt=J+fe+1,ae||(ae=dc,fe=El(B.e/hn)-El(ne.e/hn),bt=bt/hn|0),Te=0;Zt[Te]==(Mt[Te]||0);Te++);if(Zt[Te]>(Mt[Te]||0)&&fe--,bt<0)Oe.push(1),Ce=!0;else{for(At=Mt.length,$t=Zt.length,Te=0,bt+=2,tt=Cl(ae/(Zt[0]+1)),tt>1&&(Zt=U(Zt,tt,ae),Mt=U(Mt,tt,ae),$t=Zt.length,At=Mt.length),Lt=$t,lt=Mt.slice(0,$t),Ye=lt.length;Ye<$t;lt[Ye++]=0);Ze=Zt.slice(),Ze=[0].concat(Ze),Nt=Zt[0],Zt[1]>=ae/2&&Nt++;do{if(tt=0,pe=G(Zt,lt,$t,Ye),pe<0){if(zt=lt[0],$t!=Ye&&(zt=zt*ae+(lt[1]||0)),tt=Cl(zt/Nt),tt>1)for(tt>=ae&&(tt=ae-1),Ke=U(Zt,tt,ae),dt=Ke.length,Ye=lt.length;G(Ke,lt,dt,Ye)==1;)tt--,j(Ke,$t<dt?Ze:Zt,dt,ae),dt=Ke.length,pe=1;else tt==0&&(pe=tt=1),Ke=Zt.slice(),dt=Ke.length;if(dt<Ye&&(Ke=[0].concat(Ke)),j(lt,Ke,Ye,ae),Ye=lt.length,pe==-1)for(;G(Zt,lt,$t,Ye)<1;)tt++,j(lt,$t<Ye?Ze:Zt,Ye,ae),Ye=lt.length}else pe===0&&(tt++,lt=[0]);Oe[Te++]=tt,lt[0]?lt[Ye++]=Mt[Lt]||0:(lt=[Mt[Lt]],Ye=1)}while((Lt++<At||lt[0]!=null)&&bt--);Ce=lt[0]!=null,Oe[0]||Oe.splice(0,1)}if(ae==dc){for(Te=1,bt=Oe[0];bt>=10;bt/=10,Te++);Y(et,J+(et.e=Te+fe*hn-1)+1,le,Ce)}else et.e=fe,et.r=+Ce;return et}})();function F(U,G,j,B){var ne,J,le,ae,pe;if(j==null?j=s:rs(j,0,8),!U.c)return U.toString();if(ne=U.c[0],le=U.e,G==null)pe=Tl(U.c),pe=B==1||B==2&&(le<=f||le>=p)?_b(pe,le):Ju(pe,le,"0");else if(U=Y(new I(U),G,j),J=U.e,pe=Tl(U.c),ae=pe.length,B==1||B==2&&(G<=J||J<=f)){for(;ae<G;pe+="0",ae++);pe=_b(pe,J)}else if(G-=le,pe=Ju(pe,J,"0"),J+1>ae){if(--G>0)for(pe+=".";G--;pe+="0");}else if(G+=J-ae,G>0)for(J+1==ae&&(pe+=".");G--;pe+="0");return U.s<0&&ne?"-"+pe:pe}function N(U,G){for(var j,B,ne=1,J=new I(U[0]);ne<U.length;ne++)B=new I(U[ne]),(!B.s||(j=Bf(J,B))===G||j===0&&J.s===G)&&(J=B);return J}function H(U,G,j){for(var B=1,ne=G.length;!G[--ne];G.pop());for(ne=G[0];ne>=10;ne/=10,B++);return(j=B+j*hn-1)>_?U.c=U.e=null:j<g?U.c=[U.e=0]:(U.e=j,U.c=G),U}i=(function(){var U=/^(-?)0([xbo])(?=\w[\w.]*$)/i,G=/^([^.]+)\.$/,j=/^\.([^.]+)$/,B=/^-?(Infinity|NaN)$/,ne=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(J,le,ae,pe){var fe,Te=ae?le:le.replace(ne,"");if(B.test(Te))J.s=isNaN(Te)?null:Te<0?-1:1;else{if(!ae&&(Te=Te.replace(U,function(Ce,tt,Ke){return fe=(Ke=Ke.toLowerCase())=="x"?16:Ke=="b"?2:8,!pe||pe==fe?tt:Ce}),pe&&(fe=pe,Te=Te.replace(G,"$1").replace(j,"0.$1")),le!=Te))return new I(Te,fe);if(I.DEBUG)throw Error(fa+"Not a"+(pe?" base "+pe:"")+" number: "+le);J.s=null}J.c=J.e=null}})();function Y(U,G,j,B){var ne,J,le,ae,pe,fe,Te,Ce=U.c,tt=TS;if(Ce){e:{for(ne=1,ae=Ce[0];ae>=10;ae/=10,ne++);if(J=G-ne,J<0)J+=hn,le=G,pe=Ce[fe=0],Te=Cl(pe/tt[ne-le-1]%10);else if(fe=SS((J+1)/hn),fe>=Ce.length)if(B){for(;Ce.length<=fe;Ce.push(0));pe=Te=0,ne=1,J%=hn,le=J-hn+1}else break e;else{for(pe=ae=Ce[fe],ne=1;ae>=10;ae/=10,ne++);J%=hn,le=J-hn+ne,Te=le<0?0:Cl(pe/tt[ne-le-1]%10)}if(B=B||G<0||Ce[fe+1]!=null||(le<0?pe:pe%tt[ne-le-1]),B=j<4?(Te||B)&&(j==0||j==(U.s<0?3:2)):Te>5||Te==5&&(j==4||B||j==6&&(J>0?le>0?pe/tt[ne-le]:0:Ce[fe-1])%10&1||j==(U.s<0?8:7)),G<1||!Ce[0])return Ce.length=0,B?(G-=U.e+1,Ce[0]=tt[(hn-G%hn)%hn],U.e=-G||0):Ce[0]=U.e=0,U;if(J==0?(Ce.length=fe,ae=1,fe--):(Ce.length=fe+1,ae=tt[hn-J],Ce[fe]=le>0?Cl(pe/tt[ne-le]%tt[le])*ae:0),B)for(;;)if(fe==0){for(J=1,le=Ce[0];le>=10;le/=10,J++);for(le=Ce[0]+=ae,ae=1;le>=10;le/=10,ae++);J!=ae&&(U.e++,Ce[0]==dc&&(Ce[0]=1));break}else{if(Ce[fe]+=ae,Ce[fe]!=dc)break;Ce[fe--]=0,ae=1}for(J=Ce.length;Ce[--J]===0;Ce.pop());}U.e>_?U.c=U.e=null:U.e<g&&(U.c=[U.e=0])}return U}function q(U){var G,j=U.e;return j===null?U.toString():(G=Tl(U.c),G=j<=f||j>=p?_b(G,j):Ju(G,j,"0"),U.s<0?"-"+G:G)}return r.absoluteValue=r.abs=function(){var U=new I(this);return U.s<0&&(U.s=1),U},r.comparedTo=function(U,G){return Bf(this,new I(U,G))},r.decimalPlaces=r.dp=function(U,G){var j,B,ne,J=this;if(U!=null)return rs(U,0,Ga),G==null?G=s:rs(G,0,8),Y(new I(J),U+J.e+1,G);if(!(j=J.c))return null;if(B=((ne=j.length-1)-El(this.e/hn))*hn,ne=j[ne])for(;ne%10==0;ne/=10,B--);return B<0&&(B=0),B},r.dividedBy=r.div=function(U,G){return e(this,new I(U,G),c,s)},r.dividedToIntegerBy=r.idiv=function(U,G){return e(this,new I(U,G),0,1)},r.exponentiatedBy=r.pow=function(U,G){var j,B,ne,J,le,ae,pe,fe,Te,Ce=this;if(U=new I(U),U.c&&!U.isInteger())throw Error(fa+"Exponent not an integer: "+q(U));if(G!=null&&(G=new I(G)),ae=U.e>14,!Ce.c||!Ce.c[0]||Ce.c[0]==1&&!Ce.e&&Ce.c.length==1||!U.c||!U.c[0])return Te=new I(Math.pow(+q(Ce),ae?U.s*(2-gb(U)):+q(U))),G?Te.mod(G):Te;if(pe=U.s<0,G){if(G.c?!G.c[0]:!G.s)return new I(NaN);B=!pe&&Ce.isInteger()&&G.isInteger(),B&&(Ce=Ce.mod(G))}else{if(U.e>9&&(Ce.e>0||Ce.e<-1||(Ce.e==0?Ce.c[0]>1||ae&&Ce.c[1]>=24e7:Ce.c[0]<8e13||ae&&Ce.c[0]<=9999975e7)))return J=Ce.s<0&&gb(U)?-0:0,Ce.e>-1&&(J=1/J),new I(pe?1/J:J);M&&(J=SS(M/hn+2))}for(ae?(j=new I(.5),pe&&(U.s=1),fe=gb(U)):(ne=Math.abs(+q(U)),fe=ne%2),Te=new I(o);;){if(fe){if(Te=Te.times(Ce),!Te.c)break;J?Te.c.length>J&&(Te.c.length=J):B&&(Te=Te.mod(G))}if(ne){if(ne=Cl(ne/2),ne===0)break;fe=ne%2}else if(U=U.times(j),Y(U,U.e+1,1),U.e>14)fe=gb(U);else{if(ne=+q(U),ne===0)break;fe=ne%2}Ce=Ce.times(Ce),J?Ce.c&&Ce.c.length>J&&(Ce.c.length=J):B&&(Ce=Ce.mod(G))}return B?Te:(pe&&(Te=o.div(Te)),G?Te.mod(G):J?Y(Te,M,s,le):Te)},r.integerValue=function(U){var G=new I(this);return U==null?U=s:rs(U,0,8),Y(G,G.e+1,U)},r.isEqualTo=r.eq=function(U,G){return Bf(this,new I(U,G))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(U,G){return Bf(this,new I(U,G))>0},r.isGreaterThanOrEqualTo=r.gte=function(U,G){return(G=Bf(this,new I(U,G)))===1||G===0},r.isInteger=function(){return!!this.c&&El(this.e/hn)>this.c.length-2},r.isLessThan=r.lt=function(U,G){return Bf(this,new I(U,G))<0},r.isLessThanOrEqualTo=r.lte=function(U,G){return(G=Bf(this,new I(U,G)))===-1||G===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(U,G){var j,B,ne,J,le=this,ae=le.s;if(U=new I(U,G),G=U.s,!ae||!G)return new I(NaN);if(ae!=G)return U.s=-G,le.plus(U);var pe=le.e/hn,fe=U.e/hn,Te=le.c,Ce=U.c;if(!pe||!fe){if(!Te||!Ce)return Te?(U.s=-G,U):new I(Ce?le:NaN);if(!Te[0]||!Ce[0])return Ce[0]?(U.s=-G,U):new I(Te[0]?le:s==3?-0:0)}if(pe=El(pe),fe=El(fe),Te=Te.slice(),ae=pe-fe){for((J=ae<0)?(ae=-ae,ne=Te):(fe=pe,ne=Ce),ne.reverse(),G=ae;G--;ne.push(0));ne.reverse()}else for(B=(J=(ae=Te.length)<(G=Ce.length))?ae:G,ae=G=0;G<B;G++)if(Te[G]!=Ce[G]){J=Te[G]<Ce[G];break}if(J&&(ne=Te,Te=Ce,Ce=ne,U.s=-U.s),G=(B=Ce.length)-(j=Te.length),G>0)for(;G--;Te[j++]=0);for(G=dc-1;B>ae;){if(Te[--B]<Ce[B]){for(j=B;j&&!Te[--j];Te[j]=G);--Te[j],Te[B]+=dc}Te[B]-=Ce[B]}for(;Te[0]==0;Te.splice(0,1),--fe);return Te[0]?H(U,Te,fe):(U.s=s==3?-1:1,U.c=[U.e=0],U)},r.modulo=r.mod=function(U,G){var j,B,ne=this;return U=new I(U,G),!ne.c||!U.s||U.c&&!U.c[0]?new I(NaN):!U.c||ne.c&&!ne.c[0]?new I(ne):(b==9?(B=U.s,U.s=1,j=e(ne,U,0,3),U.s=B,j.s*=B):j=e(ne,U,0,b),U=ne.minus(j.times(U)),!U.c[0]&&b==1&&(U.s=ne.s),U)},r.multipliedBy=r.times=function(U,G){var j,B,ne,J,le,ae,pe,fe,Te,Ce,tt,Ke,dt,et,Oe,lt=this,Ye=lt.c,zt=(U=new I(U,G)).c;if(!Ye||!zt||!Ye[0]||!zt[0])return!lt.s||!U.s||Ye&&!Ye[0]&&!zt||zt&&!zt[0]&&!Ye?U.c=U.e=U.s=null:(U.s*=lt.s,!Ye||!zt?U.c=U.e=null:(U.c=[0],U.e=0)),U;for(B=El(lt.e/hn)+El(U.e/hn),U.s*=lt.s,pe=Ye.length,Ce=zt.length,pe<Ce&&(dt=Ye,Ye=zt,zt=dt,ne=pe,pe=Ce,Ce=ne),ne=pe+Ce,dt=[];ne--;dt.push(0));for(et=dc,Oe=ld,ne=Ce;--ne>=0;){for(j=0,tt=zt[ne]%Oe,Ke=zt[ne]/Oe|0,le=pe,J=ne+le;J>ne;)fe=Ye[--le]%Oe,Te=Ye[le]/Oe|0,ae=Ke*fe+Te*tt,fe=tt*fe+ae%Oe*Oe+dt[J]+j,j=(fe/et|0)+(ae/Oe|0)+Ke*Te,dt[J--]=fe%et;dt[J]=j}return j?++B:dt.splice(0,1),H(U,dt,B)},r.negated=function(){var U=new I(this);return U.s=-U.s||null,U},r.plus=function(U,G){var j,B=this,ne=B.s;if(U=new I(U,G),G=U.s,!ne||!G)return new I(NaN);if(ne!=G)return U.s=-G,B.minus(U);var J=B.e/hn,le=U.e/hn,ae=B.c,pe=U.c;if(!J||!le){if(!ae||!pe)return new I(ne/0);if(!ae[0]||!pe[0])return pe[0]?U:new I(ae[0]?B:ne*0)}if(J=El(J),le=El(le),ae=ae.slice(),ne=J-le){for(ne>0?(le=J,j=pe):(ne=-ne,j=ae),j.reverse();ne--;j.push(0));j.reverse()}for(ne=ae.length,G=pe.length,ne-G<0&&(j=pe,pe=ae,ae=j,G=ne),ne=0;G;)ne=(ae[--G]=ae[G]+pe[G]+ne)/dc|0,ae[G]=dc===ae[G]?0:ae[G]%dc;return ne&&(ae=[ne].concat(ae),++le),H(U,ae,le)},r.precision=r.sd=function(U,G){var j,B,ne,J=this;if(U!=null&&U!==!!U)return rs(U,1,Ga),G==null?G=s:rs(G,0,8),Y(new I(J),U,G);if(!(j=J.c))return null;if(ne=j.length-1,B=ne*hn+1,ne=j[ne]){for(;ne%10==0;ne/=10,B--);for(ne=j[0];ne>=10;ne/=10,B++);}return U&&J.e+1>B&&(B=J.e+1),B},r.shiftedBy=function(U){return rs(U,-9007199254740991,DP),this.times("1e"+U)},r.squareRoot=r.sqrt=function(){var U,G,j,B,ne,J=this,le=J.c,ae=J.s,pe=J.e,fe=c+4,Te=new I("0.5");if(ae!==1||!le||!le[0])return new I(!ae||ae<0&&(!le||le[0])?NaN:le?J:1/0);if(ae=Math.sqrt(+q(J)),ae==0||ae==1/0?(G=Tl(le),(G.length+pe)%2==0&&(G+="0"),ae=Math.sqrt(+G),pe=El((pe+1)/2)-(pe<0||pe%2),ae==1/0?G="5e"+pe:(G=ae.toExponential(),G=G.slice(0,G.indexOf("e")+1)+pe),j=new I(G)):j=new I(ae+""),j.c[0]){for(pe=j.e,ae=pe+fe,ae<3&&(ae=0);;)if(ne=j,j=Te.times(ne.plus(e(J,ne,fe,1))),Tl(ne.c).slice(0,ae)===(G=Tl(j.c)).slice(0,ae))if(j.e<pe&&--ae,G=G.slice(ae-3,ae+1),G=="9999"||!B&&G=="4999"){if(!B&&(Y(ne,ne.e+c+2,0),ne.times(ne).eq(J))){j=ne;break}fe+=4,ae+=4,B=1}else{(!+G||!+G.slice(1)&&G.charAt(0)=="5")&&(Y(j,j.e+c+2,1),U=!j.times(j).eq(J));break}}return Y(j,j.e+c+1,s,U)},r.toExponential=function(U,G){return U!=null&&(rs(U,0,Ga),U++),F(this,U,G,1)},r.toFixed=function(U,G){return U!=null&&(rs(U,0,Ga),U=U+this.e+1),F(this,U,G)},r.toFormat=function(U,G,j){var B,ne=this;if(j==null)U!=null&&G&&typeof G=="object"?(j=G,G=null):U&&typeof U=="object"?(j=U,U=G=null):j=P;else if(typeof j!="object")throw Error(fa+"Argument not an object: "+j);if(B=ne.toFixed(U,G),ne.c){var J,le=B.split("."),ae=+j.groupSize,pe=+j.secondaryGroupSize,fe=j.groupSeparator||"",Te=le[0],Ce=le[1],tt=ne.s<0,Ke=tt?Te.slice(1):Te,dt=Ke.length;if(pe&&(J=ae,ae=pe,pe=J,dt-=J),ae>0&&dt>0){for(J=dt%ae||ae,Te=Ke.substr(0,J);J<dt;J+=ae)Te+=fe+Ke.substr(J,ae);pe>0&&(Te+=fe+Ke.slice(J)),tt&&(Te="-"+Te)}B=Ce?Te+(j.decimalSeparator||"")+((pe=+j.fractionGroupSize)?Ce.replace(new RegExp("\\d{"+pe+"}\\B","g"),"$&"+(j.fractionGroupSeparator||"")):Ce):Te}return(j.prefix||"")+B+(j.suffix||"")},r.toFraction=function(U){var G,j,B,ne,J,le,ae,pe,fe,Te,Ce,tt,Ke=this,dt=Ke.c;if(U!=null&&(ae=new I(U),!ae.isInteger()&&(ae.c||ae.s!==1)||ae.lt(o)))throw Error(fa+"Argument "+(ae.isInteger()?"out of range: ":"not an integer: ")+q(ae));if(!dt)return new I(Ke);for(G=new I(o),fe=j=new I(o),B=pe=new I(o),tt=Tl(dt),J=G.e=tt.length-Ke.e-1,G.c[0]=TS[(le=J%hn)<0?hn+le:le],U=!U||ae.comparedTo(G)>0?J>0?G:fe:ae,le=_,_=1/0,ae=new I(tt),pe.c[0]=0;Te=e(ae,G,0,1),ne=j.plus(Te.times(B)),ne.comparedTo(U)!=1;)j=B,B=ne,fe=pe.plus(Te.times(ne=fe)),pe=ne,G=ae.minus(Te.times(ne=G)),ae=ne;return ne=e(U.minus(j),B,0,1),pe=pe.plus(ne.times(fe)),j=j.plus(ne.times(B)),pe.s=fe.s=Ke.s,J=J*2,Ce=e(fe,B,J,s).minus(Ke).abs().comparedTo(e(pe,j,J,s).minus(Ke).abs())<1?[fe,B]:[pe,j],_=le,Ce},r.toNumber=function(){return+q(this)},r.toPrecision=function(U,G){return U!=null&&rs(U,1,Ga),F(this,U,G,2)},r.toString=function(U){var G,j=this,B=j.s,ne=j.e;return ne===null?B?(G="Infinity",B<0&&(G="-"+G)):G="NaN":(U==null?G=ne<=f||ne>=p?_b(Tl(j.c),ne):Ju(Tl(j.c),ne,"0"):U===10&&L?(j=Y(new I(j),c+ne+1,s),G=Ju(Tl(j.c),j.e,"0")):(rs(U,2,k.length,"Base"),G=t(Ju(Tl(j.c),ne,"0"),10,U,B,!0)),B<0&&j.c[0]&&(G="-"+G)),G},r.valueOf=r.toJSON=function(){return q(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,n!=null&&I.set(n),I}function El(n){var e=n|0;return n>0||n===e?e:e-1}function Tl(n){for(var e,t,i=1,r=n.length,o=n[0]+"";i<r;){for(e=n[i++]+"",t=hn-e.length;t--;e="0"+e);o+=e}for(r=o.length;o.charCodeAt(--r)===48;);return o.slice(0,r+1||1)}function Bf(n,e){var t,i,r=n.c,o=e.c,c=n.s,s=e.s,f=n.e,p=e.e;if(!c||!s)return null;if(t=r&&!r[0],i=o&&!o[0],t||i)return t?i?0:-s:c;if(c!=s)return c;if(t=c<0,i=f==p,!r||!o)return i?0:!r^t?1:-1;if(!i)return f>p^t?1:-1;for(s=(f=r.length)<(p=o.length)?f:p,c=0;c<s;c++)if(r[c]!=o[c])return r[c]>o[c]^t?1:-1;return f==p?0:f>p^t?1:-1}function rs(n,e,t,i){if(n<e||n>t||n!==Cl(n))throw Error(fa+(i||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function gb(n){var e=n.c.length-1;return El(n.e/hn)==e&&n.c[e]%2!=0}function _b(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function Ju(n,e,t){var i,r;if(e<0){for(r=t+".";++e;r+=t);n=r+n}else if(i=n.length,++e>i){for(r=t,e-=i;--e;r+=t);n+=r}else e<i&&(n=n.slice(0,e)+"."+n.slice(e));return n}var ou=dD(),cU=class{constructor(n){Ei(this,"key"),Ei(this,"left",null),Ei(this,"right",null),this.key=n}},hv=class extends cU{constructor(n){super(n)}},uU=class{constructor(){Ei(this,"size",0),Ei(this,"modificationCount",0),Ei(this,"splayCount",0)}splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,i=null,r=null,o=null,c=e;const s=this.compare;let f;for(;;)if(f=s(c.key,n),f>0){let p=c.left;if(p==null||(f=s(p.key,n),f>0&&(c.left=p.right,p.right=c,c=p,p=c.left,p==null)))break;t==null?i=c:t.left=c,t=c,c=p}else if(f<0){let p=c.right;if(p==null||(f=s(p.key,n),f<0&&(c.right=p.left,p.left=c,c=p,p=c.right,p==null)))break;r==null?o=c:r.right=c,r=c,c=p}else break;return r!=null&&(r.right=c.left,c.left=o),t!=null&&(t.left=c.right,c.right=i),this.root!==c&&(this.root=c,this.splayCount++),f}splayMin(n){let e=n,t=e.left;for(;t!=null;){const i=t;e.left=i.right,i.right=e,e=i,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const i=t;e.right=i.left,i.left=e,e=i,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let e=this.root;const t=e,i=e.left;if(this.size--,i==null)this.root=e.right;else{const r=e.right;e=this.splayMax(i),e.right=r,this.root=e}return this.modificationCount++,t}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},FP,OP,jx=class Lv extends uU{constructor(e,t){super(),Ei(this,"root",null),Ei(this,"compare"),Ei(this,"validKey"),Ei(this,FP,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=t??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let i;for(;i=t.next(),!i.done;)e(i.value,i.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new hv(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new hv(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let t=this.root.left;if(t==null)return null;let i=t.right;for(;i!=null;)t=i,i=t.right;return t.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let t=this.root.right;if(t==null)return null;let i=t.left;for(;i!=null;)t=i,i=t.left;return t.key}retainAll(e){const t=new Lv(this.compare,this.validKey),i=this.modificationCount;for(const r of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(r)&&this.splay(r)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new Lv(this.compare,this.validKey);for(const i of this)e.has(i)&&t.add(i);return t}difference(e){const t=new Lv(this.compare,this.validKey);for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new Lv(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(r,o){let c,s;do{if(c=r.left,s=r.right,c!=null){const f=new hv(c.key);o.left=f,t(c,f)}if(s!=null){const f=new hv(s.key);o.right=f,r=s,o=f}}while(s!=null)}const i=new hv(e.key);return t(e,i),i}toSet(){return this.clone()}entries(){return new dU(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(OP=Symbol.iterator,FP=Symbol.toStringTag,OP)](){return new hU(this.wrap())}},fD=class{constructor(n){Ei(this,"tree"),Ei(this,"path",new Array),Ei(this,"modificationCount",null),Ei(this,"splayCount"),this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},hU=class extends fD{getValue(n){return n.key}},dU=class extends fD{getValue(n){return[n.key,n.key]}},pD=n=>()=>n,KT=n=>{const e=n?(t,i)=>i.minus(t).abs().isLessThanOrEqualTo(n):pD(!1);return(t,i)=>e(t,i)?0:t.comparedTo(i)};function fU(n){const e=n?(t,i,r,o,c)=>t.exponentiatedBy(2).isLessThanOrEqualTo(o.minus(i).exponentiatedBy(2).plus(c.minus(r).exponentiatedBy(2)).times(n)):pD(!1);return(t,i,r)=>{const o=t.x,c=t.y,s=r.x,f=r.y,p=c.minus(f).times(i.x.minus(s)).minus(o.minus(s).times(i.y.minus(f)));return e(p,o,c,s,f)?0:p.comparedTo(0)}}var pU=n=>n,mU=n=>{if(n){const e=new jx(KT(n)),t=new jx(KT(n)),i=(o,c)=>c.addAndReturn(o),r=o=>({x:i(o.x,e),y:i(o.y,t)});return r({x:new ou(0),y:new ou(0)}),r}return pU},JT=n=>({set:e=>{Mh=JT(e)},reset:()=>JT(n),compare:KT(n),snap:mU(n),orient:fU(n)}),Mh=JT(),dv=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),QT=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,i=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,r=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,o=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:r},ur:{x:i,y:o}}},yx=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),mD=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),Gx=n=>mD(n,n).sqrt(),gU=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},r={x:t.x.minus(n.x),y:t.y.minus(n.y)};return yx(r,i).div(Gx(r)).div(Gx(i))},_U=(n,e,t)=>{const i={x:e.x.minus(n.x),y:e.y.minus(n.y)},r={x:t.x.minus(n.x),y:t.y.minus(n.y)};return mD(r,i).div(Gx(r)).div(Gx(i))},zP=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},BP=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},vU=(n,e,t,i)=>{if(e.x.isZero())return BP(t,i,n.x);if(i.x.isZero())return BP(n,e,t.x);if(e.y.isZero())return zP(t,i,n.y);if(i.y.isZero())return zP(n,e,t.y);const r=yx(e,i);if(r.isZero())return null;const o={x:t.x.minus(n.x),y:t.y.minus(n.y)},c=yx(o,e).div(r),s=yx(o,i).div(r),f=n.x.plus(s.times(e.x)),p=t.x.plus(c.times(i.x)),g=n.y.plus(s.times(e.y)),_=t.y.plus(c.times(i.y)),x=f.plus(p).div(2),b=g.plus(_).div(2);return{x,y:b}},Jc=class gD{constructor(e,t){Ei(this,"point"),Ei(this,"isLeft"),Ei(this,"segment"),Ei(this,"otherSE"),Ei(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}static compare(e,t){const i=gD.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Hx.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,r=t.length;i<r;i++){const o=t[i];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let r=t+1;r<e;r++){const o=this.point.events[r];o.consumedBy===void 0&&i.otherSE.point.events===o.otherSE.point.events&&i.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}getLeftmostComparator(e){const t=new Map,i=r=>{const o=r.otherSE;t.set(r,{sine:gU(this.point,e.point,o.point),cosine:_U(this.point,e.point,o.point)})};return(r,o)=>{t.has(r)||i(r),t.has(o)||i(o);const{sine:c,cosine:s}=t.get(r),{sine:f,cosine:p}=t.get(o);return c.isGreaterThanOrEqualTo(0)&&f.isGreaterThanOrEqualTo(0)?s.isLessThan(p)?1:s.isGreaterThan(p)?-1:0:c.isLessThan(0)&&f.isLessThan(0)?s.isLessThan(p)?-1:s.isGreaterThan(p)?1:0:f.isLessThan(c)?-1:f.isGreaterThan(c)?1:0}}},yU=class eM{constructor(e){Ei(this,"events"),Ei(this,"poly"),Ei(this,"_isExteriorRing"),Ei(this,"_enclosingRing"),this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}static factory(e){const t=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];if(!o.isInResult()||o.ringOut)continue;let c=null,s=o.leftSE,f=o.rightSE;const p=[s],g=s.point,_=[];for(;c=s,s=f,p.push(s),s.point!==g;)for(;;){const x=s.getAvailableLinkedEvents();if(x.length===0){const P=p[0].point,k=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${P.x}, ${P.y}]. Last matching segment found ends at [${k.x}, ${k.y}].`)}if(x.length===1){f=x[0].otherSE;break}let b=null;for(let P=0,k=_.length;P<k;P++)if(_[P].point===s.point){b=P;break}if(b!==null){const P=_.splice(b)[0],k=p.splice(P.index);k.unshift(k[0].otherSE),t.push(new eM(k.reverse()));continue}_.push({index:p.length,point:s.point});const M=s.getLeftmostComparator(c);f=x.sort(M)[0].otherSE;break}t.push(new eM(p))}return t}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const _=this.events[p].point,x=this.events[p+1].point;Mh.orient(_,e,x)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const i=t[0],r=t[1];Mh.orient(i,e,r)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,f=[];for(let p=c;p!=s;p+=o)f.push([t[p].x.toNumber(),t[p].y.toNumber()]);return f}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,t;let i=this.events[0];for(let c=1,s=this.events.length;c<s;c++){const f=this.events[c];Jc.compare(i,f)>0&&(i=f)}let r=i.segment.prevInResult(),o=r?r.prevInResult():null;for(;;){if(!r)return null;if(!o)return r.ringOut;if(o.ringOut!==r.ringOut)return((e=o.ringOut)==null?void 0:e.enclosingRing())!==r.ringOut?r.ringOut:(t=r.ringOut)==null?void 0:t.enclosingRing();r=o.prevInResult(),o=r?r.prevInResult():null}}},NP=class{constructor(n){Ei(this,"exteriorRing"),Ei(this,"interiorRings"),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,i=this.interiorRings.length;t<i;t++){const r=this.interiorRings[t].getGeom();r!==null&&e.push(r)}return e}},bU=class{constructor(n){Ei(this,"rings"),Ei(this,"polys"),this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){var e;const t=[];for(let i=0,r=n.length;i<r;i++){const o=n[i];if(!o.poly)if(o.isExteriorRing())t.push(new NP(o));else{const c=o.enclosingRing();c!=null&&c.poly||t.push(new NP(c)),(e=c?.poly)==null||e.addInterior(o)}}return t}},xU=class{constructor(n,e=Hx.compare){Ei(this,"queue"),Ei(this,"tree"),Ei(this,"segments"),this.queue=n,this.tree=new jx(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let i=e,r=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do r=this.tree.firstAfter(r);while(r!=null&&r.consumedBy!=null);if(n.isLeft){let o=null;if(i){const s=i.getIntersection(e);if(s!==null&&(e.isAnEndpoint(s)||(o=s),!i.isAnEndpoint(s))){const f=this._splitSafely(i,s);for(let p=0,g=f.length;p<g;p++)t.push(f[p])}}let c=null;if(r){const s=r.getIntersection(e);if(s!==null&&(e.isAnEndpoint(s)||(c=s),!r.isAnEndpoint(s))){const f=this._splitSafely(r,s);for(let p=0,g=f.length;p<g;p++)t.push(f[p])}}if(o!==null||c!==null){let s=null;o===null?s=c:c===null?s=o:s=Jc.comparePoints(o,c)<=0?o:c,this.queue.delete(e.rightSE),t.push(e.rightSE);const f=e.split(s);for(let p=0,g=f.length;p<g;p++)t.push(f[p])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=i)}else{if(i&&r){const o=i.getIntersection(r);if(o!==null){if(!i.isAnEndpoint(o)){const c=this._splitSafely(i,o);for(let s=0,f=c.length;s<f;s++)t.push(c[s])}if(!r.isAnEndpoint(o)){const c=this._splitSafely(r,o);for(let s=0,f=c.length;s<f;s++)t.push(c[s])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const i=n.split(e);return i.push(t),n.consumedBy===void 0&&this.tree.add(n),i}},wU=class{constructor(){Ei(this,"type"),Ei(this,"numMultiPolys")}run(n,e,t){Rv.type=n;const i=[new VP(e,!0)];for(let f=0,p=t.length;f<p;f++)i.push(new VP(t[f],!1));if(Rv.numMultiPolys=i.length,Rv.type==="difference"){const f=i[0];let p=1;for(;p<i.length;)QT(i[p].bbox,f.bbox)!==null?p++:i.splice(p,1)}if(Rv.type==="intersection")for(let f=0,p=i.length;f<p;f++){const g=i[f];for(let _=f+1,x=i.length;_<x;_++)if(QT(g.bbox,i[_].bbox)===null)return[]}const r=new jx(Jc.compare);for(let f=0,p=i.length;f<p;f++){const g=i[f].getSweepEvents();for(let _=0,x=g.length;_<x;_++)r.add(g[_])}const o=new xU(r);let c=null;for(r.size!=0&&(c=r.first(),r.delete(c));c;){const f=o.process(c);for(let p=0,g=f.length;p<g;p++){const _=f[p];_.consumedBy===void 0&&r.add(_)}r.size!=0?(c=r.first(),r.delete(c)):c=null}Mh.reset();const s=yU.factory(o.segments);return new bU(s).getGeom()}},Rv=new wU,qx=Rv,SU=0,Hx=class bx{constructor(e,t,i,r){Ei(this,"id"),Ei(this,"leftSE"),Ei(this,"rightSE"),Ei(this,"rings"),Ei(this,"windings"),Ei(this,"ringOut"),Ei(this,"consumedBy"),Ei(this,"prev"),Ei(this,"_prevInResult"),Ei(this,"_beforeState"),Ei(this,"_afterState"),Ei(this,"_isInResult"),this.id=++SU,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=r}static compare(e,t){const i=e.leftSE.point.x,r=t.leftSE.point.x,o=e.rightSE.point.x,c=t.rightSE.point.x;if(c.isLessThan(i))return 1;if(o.isLessThan(r))return-1;const s=e.leftSE.point.y,f=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(i.isLessThan(r)){if(f.isLessThan(s)&&f.isLessThan(p))return 1;if(f.isGreaterThan(s)&&f.isGreaterThan(p))return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const x=t.comparePoint(e.rightSE.point);return x!==0?x:-1}if(i.isGreaterThan(r)){if(s.isLessThan(f)&&s.isLessThan(g))return-1;if(s.isGreaterThan(f)&&s.isGreaterThan(g))return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const x=e.comparePoint(t.rightSE.point);return x<0?1:x>0?-1:1}if(s.isLessThan(f))return-1;if(s.isGreaterThan(f))return 1;if(o.isLessThan(c)){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(o.isGreaterThan(c)){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!o.eq(c)){const _=p.minus(s),x=o.minus(i),b=g.minus(f),M=c.minus(r);if(_.isGreaterThan(x)&&b.isLessThan(M))return 1;if(_.isLessThan(x)&&b.isGreaterThan(M))return-1}return o.isGreaterThan(c)?1:o.isLessThan(c)||p.isLessThan(g)?-1:p.isGreaterThan(g)?1:e.id<t.id?-1:e.id>t.id?1:0}static fromRing(e,t,i){let r,o,c;const s=Jc.comparePoints(e,t);if(s<0)r=e,o=t,c=1;else if(s>0)r=t,o=e,c=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const f=new Jc(r,!0),p=new Jc(o,!1);return new bx(f,p,[i],[c])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Mh.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),i=e.bbox(),r=QT(t,i);if(r===null)return null;const o=this.leftSE.point,c=this.rightSE.point,s=e.leftSE.point,f=e.rightSE.point,p=dv(t,s)&&this.comparePoint(s)===0,g=dv(i,o)&&e.comparePoint(o)===0,_=dv(t,f)&&this.comparePoint(f)===0,x=dv(i,c)&&e.comparePoint(c)===0;if(g&&p)return x&&!_?c:!x&&_?f:null;if(g)return _&&o.x.eq(f.x)&&o.y.eq(f.y)?null:o;if(p)return x&&c.x.eq(s.x)&&c.y.eq(s.y)?null:s;if(x&&_)return null;if(x)return c;if(_)return f;const b=vU(o,this.vector(),s,e.vector());return b===null||!dv(r,b)?null:Mh.snap(b)}split(e){const t=[],i=e.events!==void 0,r=new Jc(e,!0),o=new Jc(e,!1),c=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(r);const s=new bx(r,c,this.rings.slice(),this.windings.slice());return Jc.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),Jc.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const r=bx.compare(t,i);if(r!==0){if(r>0){const o=t;t=i,i=o}if(t.prev===i){const o=t;t=i,i=o}for(let o=0,c=i.rings.length;o<c;o++){const s=i.rings[o],f=i.windings[o],p=t.rings.indexOf(s);p===-1?(t.rings.push(s),t.windings.push(f)):t.windings[p]+=f}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys;for(let s=0,f=this.rings.length;s<f;s++){const p=this.rings[s],g=this.windings[s],_=t.indexOf(p);_===-1?(t.push(p),i.push(g)):i[_]+=g}const o=[],c=[];for(let s=0,f=t.length;s<f;s++){if(i[s]===0)continue;const p=t[s],g=p.poly;if(c.indexOf(g)===-1)if(p.isExterior)o.push(g);else{c.indexOf(g)===-1&&c.push(g);const _=o.indexOf(p.poly);_!==-1&&o.splice(_,1)}}for(let s=0,f=o.length;s<f;s++){const p=o[s].multiPoly;r.indexOf(p)===-1&&r.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(qx.type){case"union":{const i=e.length===0,r=t.length===0;this._isInResult=i!==r;break}case"intersection":{let i,r;e.length<t.length?(i=e.length,r=t.length):(i=t.length,r=e.length),this._isInResult=r===qx.numMultiPolys&&i<r;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=r=>r.length===1&&r[0].isSubject;this._isInResult=i(e)!==i(t);break}}return this._isInResult}},$P=class{constructor(n,e,t){if(Ei(this,"poly"),Ei(this,"isExterior"),Ei(this,"segments"),Ei(this,"bbox"),!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Mh.snap({x:new ou(n[0][0]),y:new ou(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let r=i;for(let o=1,c=n.length;o<c;o++){if(typeof n[o][0]!="number"||typeof n[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=Mh.snap({x:new ou(n[o][0]),y:new ou(n[o][1])});s.x.eq(r.x)&&s.y.eq(r.y)||(this.segments.push(Hx.fromRing(r,s,this)),s.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.x),s.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.y),s.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.x),s.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.y),r=s)}(!i.x.eq(r.x)||!i.y.eq(r.y))&&this.segments.push(Hx.fromRing(r,i,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const i=this.segments[e];n.push(i.leftSE),n.push(i.rightSE)}return n}},TU=class{constructor(n,e){if(Ei(this,"multiPoly"),Ei(this,"exteriorRing"),Ei(this,"interiorRings"),Ei(this,"bbox"),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new $P(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=n.length;t<i;t++){const r=new $P(n[t],this,!1);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const i=this.interiorRings[e].getSweepEvents();for(let r=0,o=i.length;r<o;r++)n.push(i[r])}return n}},VP=class{constructor(n,e){if(Ei(this,"isSubject"),Ei(this,"polys"),Ei(this,"bbox"),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new ou(Number.POSITIVE_INFINITY),y:new ou(Number.POSITIVE_INFINITY)},ur:{x:new ou(Number.NEGATIVE_INFINITY),y:new ou(Number.NEGATIVE_INFINITY)}};for(let t=0,i=n.length;t<i;t++){const r=new TU(n[t],this);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const i=this.polys[e].getSweepEvents();for(let r=0,o=i.length;r<o;r++)n.push(i[r])}return n}},MU=(n,...e)=>qx.run("union",n,e),CU=(n,...e)=>qx.run("difference",n,e);Mh.set;function _D(n,e,t){if(n!==null)for(var i,r,o,c,s,f,p,g=0,_=0,x,b=n.type,M=b==="FeatureCollection",P=b==="Feature",k=M?n.features.length:1,L=0;L<k;L++){p=M?n.features[L].geometry:P?n.geometry:n,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var F=0,N=0;if(c=x?p.geometries[I]:p,c!==null){f=c.coordinates;var H=c.type;switch(g=0,H){case null:break;case"Point":if(e(f,_,L,F,N)===!1)return!1;_++,F++;break;case"LineString":case"MultiPoint":for(i=0;i<f.length;i++){if(e(f[i],_,L,F,N)===!1)return!1;_++,H==="MultiPoint"&&F++}H==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(i=0;i<f.length;i++){for(r=0;r<f[i].length-g;r++){if(e(f[i][r],_,L,F,N)===!1)return!1;_++}H==="MultiLineString"&&F++,H==="Polygon"&&N++}H==="Polygon"&&F++;break;case"MultiPolygon":for(i=0;i<f.length;i++){for(N=0,r=0;r<f[i].length;r++){for(o=0;o<f[i][r].length-g;o++){if(e(f[i][r][o],_,L,F,N)===!1)return!1;_++}N++}F++}break;case"GeometryCollection":for(i=0;i<c.geometries.length;i++)if(_D(c.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function b2(n,e){var t,i,r,o,c,s,f,p,g,_,x=0,b=n.type==="FeatureCollection",M=n.type==="Feature",P=b?n.features.length:1;for(t=0;t<P;t++){for(s=b?n.features[t].geometry:M?n.geometry:n,p=b?n.features[t].properties:M?n.properties:{},g=b?n.features[t].bbox:M?n.bbox:void 0,_=b?n.features[t].id:M?n.id:void 0,f=s?s.type==="GeometryCollection":!1,c=f?s.geometries.length:1,r=0;r<c;r++){if(o=f?s.geometries[r]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(e(o.geometries[i],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function EU(n,e){b2(n,function(t,i,r,o,c){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(_y(t,r,{bbox:o,id:c}),i,0)===!1?!1:void 0}var f;switch(s){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:f,coordinates:g};if(e(_y(_,r),i,p)===!1)return!1}})}function AU(n,e={}){const t=[];if(b2(n,r=>{t.push(r.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const i=MU(t[0],...t.slice(1));return i.length===0?null:i.length===1?y2(i[0],e.properties):hD(i,e.properties)}var vD=AU;function PU(n,e={}){if(n.bbox!=null&&e.recompute!==!0)return n.bbox;const t=[1/0,1/0,-1/0,-1/0];return _D(n,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var UP=PU;function IU(n){const e=[];if(b2(n,r=>{e.push(r.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=n.features[0].properties||{},i=CU(e[0],...e.slice(1));return i.length===0?null:i.length===1?y2(i[0],t):hD(i,t)}var LU=IU;function RU(n){if(!n)throw new Error("geojson is required");var e=[];return EU(n,function(t){e.push(t)}),vy(e)}var kU=RU;function jP(n,e){const t=LU(vy([y2([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),n]));if(!t)return;t.properties={isMask:!0};const i=Ux(UP(n)),r=(i[2]-i[0])/360/1e3,o=i[0]<-180,c=i[2]>180,s=kU(n);if(s.features.length>1&&(o||c))for(const f of s.features){const p=Ux(UP(f));if(c&&p[0]<-180+r)for(const g of f.geometry.coordinates)for(const _ of g)_[0]+=360-r;if(o&&p[2]>180-r)for(const g of f.geometry.coordinates)for(const _ of g)_[0]-=360-r}e(vy([s.features.length<2?n:vD(s)??n,t]))}const GP={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},vb="mtlr-gc-full-geom",qP="mtlr-gc-full-geom-fill",HP="mtlr-gc-full-geom-line";function DU(n,e,t=!0,i=!0,r={},o={},c=GP){let s;const f=[];let p,g,_;function x(){if(!n.loaded){n.once("load",x);return}const k=c?c===!0?GP:c:void 0;if(!(k!=null&&k.fill)&&!(k!=null&&k.line))return;const L=n.getSource(vb);if(L)L.setData(_??vy([]));else if(_)n.addSource(vb,{type:"geojson",data:_});else return;!n.getLayer(qP)&&k!=null&&k.fill&&n.addLayer({...k?.fill,id:qP,type:"fill",source:vb}),!n.getLayer(HP)&&k!=null&&k.line&&n.addLayer({...k?.line,id:HP,type:"line",source:vb})}function b(k){_=k,x()}n.on("styledata",()=>{setTimeout(()=>{_&&x()})});const M=k=>{s?.({type:"mapClick",coordinates:[k.lngLat.lng,k.lngLat.lat]})};function P(k=!1){if(!e)throw new Error;const L=document.createElement("div");return k&&L.classList.add("marker-interactive"),new z8({props:{displayIn:"maplibre"},target:L}),new e.Marker({element:L,offset:[1,-13]})}return{setEventHandler(k){k?(s=k,n.on("click",M)):(s=void 0,n.off("click",M))},flyTo(k,L){n.flyTo({center:k,...L?{zoom:L}:{},...r})},fitBounds(k,L,I){n.fitBounds([[k[0],k[1]],[k[2],k[3]]],{padding:L,...I?{maxZoom:I}:{},...o})},indicateReverse(k){n.getCanvasContainer().style.cursor=k?"crosshair":""},setReverseMarker(k){!e||!t||(g?k?g.setLngLat(k):(g.remove(),g=void 0):k&&(t instanceof Function?g=t(n)??void 0:(g=(typeof t=="object"?new e.Marker(t):P()).setLngLat(k).addTo(n),g.getElement().classList.add("marker-reverse"))))},setFeatures(k,L,I){for(const F of f)F.remove();if(f.length=0,b(void 0),!!e){e:if(L){let F=!1;if(L.geometry.type==="GeometryCollection"){const N=L.geometry.geometries.filter(H=>H.type==="Polygon"||H.type==="MultiPolygon");t:if(N.length>0){const H=vD(vy(N.map(Y=>_y(Y))));if(!H)break t;jP({...L,geometry:H.geometry},b),F=!0}else{const H=L.geometry.geometries.filter(Y=>Y.type==="LineString"||Y.type==="MultiLineString");H.length>0&&(b({...L,geometry:{type:"GeometryCollection",geometries:H}}),F=!0)}}if(!F){if(L.geometry.type==="Polygon"||L.geometry.type==="MultiPolygon")jP(L,b);else if(L.geometry.type==="LineString"||L.geometry.type==="MultiLineString"){b(L);break e}}if(!I&&!L.geometry.type.endsWith("Point"))break e;if(t instanceof Function){const N=t(n,L);N&&f.push(N)}else t&&f.push(typeof t=="object"?new e.Marker(t):P().setLngLat(L.center).addTo(n))}if(i)for(const F of k??[]){if(F===L)continue;let N;if(i instanceof Function){if(N=i(n,F),!N)continue}else N=(typeof i=="object"?new e.Marker(i):P(!0)).setLngLat(F.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(F.place_type[0]==="reverse"?F.place_name:F.place_name.replace(/,.*/,""))).addTo(n);const H=N.getElement();H.addEventListener("click",Y=>{Y.stopPropagation(),s?.({type:"markerClick",id:F.id})}),H.addEventListener("mouseenter",()=>{s?.({type:"markerMouseEnter",id:F.id}),N.togglePopup()}),H.addEventListener("mouseleave",()=>{s?.({type:"markerMouseLeave",id:F.id}),N.togglePopup()}),f.push(N)}}},setSelectedMarker(k){p&&p.getElement().classList.toggle("marker-selected",!1),p=k>-1?f[k]:void 0,p?.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const k=n.getCenter();return[n.getZoom(),k.lng,k.lat]}}}function FU(n,e,t){var i,r,o;class c{constructor(L,I){Ei(this,"type"),Ei(this,"target"),this.type=I,this.target=L}}class s extends c{constructor(L,I){super(L,"select"),Ei(this,"feature"),Object.assign(this,I)}}class f extends c{constructor(L,I){super(L,"featureslisted"),Ei(this,"features"),this.features=I}}class p extends c{constructor(L,I){super(L,"featuresmarked"),Ei(this,"features"),this.features=I}}class g extends c{constructor(L,I){super(L,"optionsvisibilitychange"),Ei(this,"optionsVisible"),this.optionsVisible=I}}class _ extends c{constructor(L,I){super(L,"pick"),Ei(this,"feature"),this.feature=I}}class x extends c{constructor(L,I){super(L,"querychange"),Ei(this,"query"),this.query=I}}class b extends c{constructor(L,I,F){super(L,"response"),Ei(this,"url"),Ei(this,"featureCollection"),this.url=I,this.featureCollection=F}}class M extends c{constructor(L,I){super(L,"reversetoggle"),Ei(this,"reverse"),this.reverse=I}}class P extends n{constructor(L={}){super(),xS(this,i),xS(this,r),xS(this,o),fb(this,r,L)}onAddInt(L){const I=document.createElement("div");I.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:F,showResultMarkers:N,flyTo:H,fullGeometryStyle:Y,...q}=_s(this,r),U=typeof H=="boolean"?{}:H,G={mapController:DU(L,e,F,N,U,U,Y),flyTo:H===void 0?!0:!!H,apiKey:"",...q};return G.apiKey||console.warn("No MapTiler Cloud API key was provided, some or all geocoding requests may fail"),fb(this,i,new aU({target:I,props:G})),_s(this,i).$on("select",j=>{this.fire(new s(this,j.detail))}),_s(this,i).$on("pick",j=>{this.fire(new _(this,j.detail.feature))}),_s(this,i).$on("featureslisted",j=>{this.fire(new f(this,j.detail.features))}),_s(this,i).$on("featuresmarked",j=>{this.fire(new p(this,j.detail.features))}),_s(this,i).$on("response",j=>{this.fire(new b(this,j.detail.url,j.detail.featureCollection))}),_s(this,i).$on("optionsvisibilitychange",j=>{this.fire(new g(this,j.detail.optionsVisible))}),_s(this,i).$on("reversetoggle",j=>{this.fire(new M(this,j.detail.reverse))}),_s(this,i).$on("querychange",j=>{this.fire(new x(this,j.detail.query))}),fb(this,o,I),I}on(L,I){return super.on(L,I)}once(L,I){return super.once(L,I)}off(L,I){return super.off(L,I)}listens(L){return super.listens(L)}setOptions(L){var I;Object.assign(_s(this,r),L);const{marker:F,showResultMarkers:N,flyTo:H,fullGeometryStyle:Y,...q}=_s(this,r);(I=_s(this,i))==null||I.$set(q)}setQuery(L,I=!0){var F;(F=_s(this,i))==null||F.setQuery(L,I)}clearMap(){var L;(L=_s(this,i))==null||L.clearMap()}clearList(){var L;(L=_s(this,i))==null||L.clearList()}setReverseMode(L){var I;(I=_s(this,i))==null||I.$set({reverseActive:L})}focus(L){var I;(I=_s(this,i))==null||I.focus(L)}blur(){var L;(L=_s(this,i))==null||L.blur()}onRemove(){var L,I,F;(L=_s(this,i))==null||L.$destroy(),fb(this,i,void 0),(F=(I=_s(this,o))==null?void 0:I.parentNode)==null||F.removeChild(_s(this,o))}}return i=new WeakMap,r=new WeakMap,o=new WeakMap,{MapLibreBasedGeocodingControl:P,events:{SelectEvent:s,FeaturesListedEvent:f,FeaturesMarkedEvent:p,OptionsVisibilityChangeEvent:g,PickEvent:_,QueryChangeEvent:x,ResponseEvent:b,ReverseToggleEvent:M}}}const{MapLibreBasedGeocodingControl:OU}=FU(f2.Evented,z6);class zU extends OU{onAdd(e){return super.onAddInt(e)}}function BU(n,e){en(e,!0);let t=ii(void 0),i=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];xa(()=>{ee(t)&&(e.map?.removeControl(ee(t)),yt(t,void 0))}),cn(()=>{e.map&&e.loaded&&!ee(t)&&(yt(t,new zU({apiKey:yd,maplibregl:Io,proximity:[{type:"map-center"}],types:i,country:e.country,marker:!0,showResultMarkers:!0,flyToOptions:{duration:1e3},fitBoundsOptions:{duration:1e3}}),!0),e.map.addControl(ee(t),"top-left"))}),tn()}ps(["click"]);var NU=Xt("<!> <!>",1);function $U(n,e){en(e,!0),cn(()=>{e.map&&(e.map.keyboard.disableRotation(),e.map.dragRotate.disable(),e.map.touchZoomRotate.disableRotation())});var t=NU(),i=ui(t);Bk(i,{showCompass:!1});var r=ht(i,2);Nk(r,{}),pt(n,t),tn()}const tM=["==",["geometry-type"],"LineString"],yD=["==",["geometry-type"],"Point"];function yy(n,e,t){let i=["match",n];for(let[r,o]of Object.entries(e))i.push(r),i.push(o);return i.push(t),i}function no(){return{type:"FeatureCollection",features:[]}}function bD(n){return YV(n)}let yd="MZEJTanw3WpxRvt7qDfo",WP=`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${yd}`,Qf=new _6([["Blank",{version:8,sources:{},layers:[],glyphs:WP}],["Maptiler Streets",`https://api.maptiler.com/maps/streets-v2/style.json?key=${yd}`],["Maptiler Dataviz",`https://api.maptiler.com/maps/dataviz/style.json?key=${yd}`],["Maptiler Dark",`https://api.maptiler.com/maps/dataviz-dark/style.json?key=${yd}`],["Maptiler Hybrid",`https://api.maptiler.com/maps/hybrid/style.json?key=${yd}`],["Maptiler OpenStreetMap",`https://api.maptiler.com/maps/openstreetmap/style.json?key=${yd}`],["Maptiler OS Open Zoomstack",`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${yd}`],["ESRI World Imagery",{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"ESRI &copy; <a href='https://www.esri.com' target='_blank'>ESRI</a>",minzoom:0,maxzoom:18}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:WP}]]);var VU=Xt('<div class="form-check"><label class="form-check-label"><input class="form-check-input" type="checkbox"/> <!></label></div>');function fs(n,e){en(e,!0);let t=st(e,"checked",15);var i=VU(),r=Bt(i),o=Bt(r),c=ht(o,2);xs(c,()=>e.children??ls),G$(o,t),pt(n,i),tn()}var UU=Xt("<div><progress></progress></div>"),jU=Xt('<div class="cover svelte-ca01h2"> <!></div>');function vp(n,e){let t=st(e,"progress",3,null);var i=tr(),r=ui(i);{var o=c=>{var s=jU(),f=Bt(s),p=ht(f);{var g=_=>{var x=UU(),b=Bt(x);gh(b,"",{},{width:"100%"}),Ji(()=>U$(b,t())),pt(_,x)};Ki(p,_=>{t()!=null&&_(g)})}Ji(()=>ln(f,`${e.loading??""} `)),pt(c,s)};Ki(r,c=>{e.loading&&c(o)})}pt(n,i)}var GU=Xt('<dialog closedby="none" class="svelte-1f8bzsb"><div class="svelte-1f8bzsb"><!></div></dialog>');function hp(n,e){en(e,!0);let t=st(e,"show",15,!1),i=st(e,"closeable",3,!0),r=ii(void 0);cn(()=>{ee(r)&&(t()?ee(r).showModal():ee(r).close())});function o(g){g.target==ee(r)&&(g.stopPropagation(),i()&&t(!1))}function c(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),i()&&t(!1))}var s=GU();s.__click=o,s.__keydown=c;var f=Bt(s),p=Bt(f);xs(p,()=>e.children),vc(s,g=>yt(r,g),()=>ee(r)),pt(n,s),tn()}ps(["click","keydown"]);var qU=Xt('<div style="display: flex; align-items: center; gap: 6px;"><span></span> </div>'),HU=Xt("<div></div>");function x2(n,e){let t=st(e,"swatchClass",3,"rectangle"),i=st(e,"itemsPerRow",3,2),r=Kt(()=>`${100/i()}%`);var o=HU();Os(o,21,()=>Object.entries(e.labelColors),Fs,(c,s)=>{var f=Kt(()=>el(ee(s),2));let p=()=>ee(f)[0],g=()=>ee(f)[1];var _=qU(),x=Bt(_);let b;var M=ht(x);Ji(()=>{lp(x,1,`color-swatch ${t()??""}`,"svelte-kgsne0"),b=gh(x,"",b,{background:g()}),ln(M,` ${p()??""}`)}),pt(c,_)}),Ji(()=>gh(o,`display: grid; grid-template-columns: repeat(auto-fill, calc(${ee(r)??""} - 10px)); gap: 10px;`)),pt(n,o)}function Pw(n,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",n),document.body.appendChild(t),t.click(),document.body.removeChild(t)}var WU=Xt('<button class="btn btn-primary" type="button">Import current view</button> <p class="fst-italic my-3">or...</p> <button class="btn btn-primary" type="button">Draw an area to import on the map</button>',1),ZU=Xt('<div><label class="form-label">Load an osm.pbf or osm.xml file <input class="form-control" type="file"/></label></div> <p class="fst-italic my-3">or...</p> <!> <!>',1);function XU(n,e){en(e,!0);let t=ii(null),i=ii(!1),r=ii(void 0);async function o(F){try{e.onloading?.("Loading from file");let N=await ee(r).files[0].arrayBuffer();e.onload(new Uint8Array(N),null)}catch(N){e.onerror?.(`Bad input file: ${N}`)}}async function c(F){try{e.onloading?.("Loading from Overpass");let N=await fetch(xD(F));if(!N.ok)throw new Error(`Overpass response is not OK: ${N.status}. The API is often overloaded; try again in a few seconds.`);let H=await N.bytes();if(ee(i)){let Y=new TextDecoder().decode(H);Pw("osm.xml",Y)}e.onload(new Uint8Array(H),F)}catch(N){e.onerror?.(N.toString())}}function s(F){return[F.lng,F.lat]}function f(){let F=e.map.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[s(F.getSouthWest()),s(F.getNorthWest()),s(F.getNorthEast()),s(F.getSouthEast()),s(F.getSouthWest())]],type:"Polygon"}}}async function p(){if(e.map){if(e.map.getZoom()<13){e.onerror?.("Zoom in more to import");return}await c(f())}}function g(){e.map&&(yt(t,new d6(e.map),!0),ee(t).startNew(),ee(t).addEventListenerSuccess(async F=>{yt(t,null),await c(F)}),ee(t).addEventListenerFailure(()=>{yt(t,null)}))}var _=ZU(),x=ui(_),b=Bt(x),M=ht(Bt(b));M.__change=o,vc(M,F=>yt(r,F),()=>ee(r));var P=ht(x,4);{var k=F=>{p6(F,{get polygonTool(){return ee(t)}})},L=F=>{var N=WU(),H=ui(N);H.__click=p;var Y=ht(H,4);Y.__click=g,pt(F,N)};Ki(P,F=>{ee(t)?F(k):F(L,!1)})}var I=ht(P,2);fs(I,{get checked(){return ee(i)},set checked(F){yt(i,F,!0)},children:(F,N)=>{var H=Hn("Save a copy of the osm.xml after importing");pt(F,H)},$$slots:{default:!0}}),pt(n,_),tn()}ps(["change","click"]);function xD(n){let e='poly:"';if(n.geometry.type=="Polygon")for(let[i,r]of n.geometry.coordinates[0])e+=`${r} ${i} `;else if(n.geometry.type=="MultiPolygon")for(let[i,r]of n.geometry.coordinates[0][0])e+=`${r} ${i} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}let Vi,kv=null;function xg(){return(kv===null||kv.byteLength===0)&&(kv=new Uint8Array(Vi.memory.buffer)),kv}let xx=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});xx.decode();const YU=2146435072;let MS=0;function KU(n,e){return MS+=e,MS>=YU&&(xx=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),xx.decode(),MS=e),xx.decode(xg().subarray(n,n+e))}function Po(n,e){return n=n>>>0,KU(n,e)}function bd(n){return n==null}let Uf=null;function Zc(){return(Uf===null||Uf.buffer.detached===!0||Uf.buffer.detached===void 0&&Uf.buffer!==Vi.memory.buffer)&&(Uf=new DataView(Vi.memory.buffer)),Uf}function iM(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const r=n.description;return r==null?"Symbol":`Symbol(${r})`}if(e=="function"){const r=n.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(n)){const r=n.length;let o="[";r>0&&(o+=iM(n[0]));for(let c=1;c<r;c++)o+=", "+iM(n[c]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let i;if(t&&t.length>1)i=t[1];else return toString.call(n);if(i=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:i}let ep=0;const Jv=new TextEncoder;"encodeInto"in Jv||(Jv.encodeInto=function(n,e){const t=Jv.encode(n);return e.set(t),{read:n.length,written:t.length}});function CS(n,e,t){if(t===void 0){const s=Jv.encode(n),f=e(s.length,1)>>>0;return xg().subarray(f,f+s.length).set(s),ep=s.length,f}let i=n.length,r=e(i,1)>>>0;const o=xg();let c=0;for(;c<i;c++){const s=n.charCodeAt(c);if(s>127)break;o[r+c]=s}if(c!==i){c!==0&&(n=n.slice(c)),r=t(r,i,i=c+n.length*3,1)>>>0;const s=xg().subarray(r+c,r+i),f=Jv.encodeInto(n,s);c+=f.written,r=t(r,i,c,1)>>>0}return ep=c,r}function JU(n){const e=Vi.__externref_table_alloc();return Vi.__wbindgen_externrefs.set(e,n),e}function ES(n,e){try{return n.apply(this,e)}catch(t){const i=JU(t);Vi.__wbindgen_exn_store(i)}}function QU(n,e){return n=n>>>0,xg().subarray(n/1,n/1+e)}function js(n){const e=Vi.__wbindgen_externrefs.get(n);return Vi.__externref_table_dealloc(n),e}function ej(n,e){const t=e(n.length*1,1)>>>0;return xg().set(n,t/1),ep=n.length,t}const ZP=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>Vi.__wbg_speedwalk_free(n>>>0,1));class Wx{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ZP.unregister(this),e}free(){const e=this.__destroy_into_raw();Vi.__wbg_speedwalk_free(e,0)}editClear(){Vi.speedwalk_editClear(this.__wbg_ptr)}getMetrics(){let e,t;try{const o=Vi.speedwalk_getMetrics(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,js(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}getBoundary(){let e,t;try{const o=Vi.speedwalk_getBoundary(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,js(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}editSetTags(e,t){const i=Vi.speedwalk_editSetTags(this.__wbg_ptr,e,t);if(i[1])throw js(i[0])}getRoadSides(){let e,t;try{const o=Vi.speedwalk_getRoadSides(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,js(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}editAssumeTags(e){const t=Vi.speedwalk_editAssumeTags(this.__wbg_ptr,e);if(t[1])throw js(t[0])}getOsmTimestamp(){const e=Vi.speedwalk_getOsmTimestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}toOsmChangeJson(){let e,t;try{const o=Vi.speedwalk_toOsmChangeJson(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,js(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}getSideLocations(e){let t,i;try{const c=Vi.speedwalk_getSideLocations(this.__wbg_ptr,e);var r=c[0],o=c[1];if(c[3])throw r=0,o=0,js(c[2]);return t=r,i=o,Po(r,o)}finally{Vi.__wbindgen_free(t,i,1)}}exportNetwork(e){let t,i;try{const c=Vi.speedwalk_exportNetwork(this.__wbg_ptr,e);var r=c[0],o=c[1];if(c[3])throw r=0,o=0,js(c[2]);return t=r,i=o,Po(r,o)}finally{Vi.__wbindgen_free(t,i,1)}}auditCrossings(e){let t,i;try{const c=Vi.speedwalk_auditCrossings(this.__wbg_ptr,e);var r=c[0],o=c[1];if(c[3])throw r=0,o=0,js(c[2]);return t=r,i=o,Po(r,o)}finally{Vi.__wbindgen_free(t,i,1)}}editAddNewCrossing(e,t){const i=Vi.speedwalk_editAddNewCrossing(this.__wbg_ptr,e,t);if(i[1])throw js(i[0])}editMakeAllSidewalks(e){const t=Vi.speedwalk_editMakeAllSidewalks(this.__wbg_ptr,e);if(t[1])throw js(t[0])}editConnectAllCrossings(){const e=Vi.speedwalk_editConnectAllCrossings(this.__wbg_ptr);if(e[1])throw js(e[0])}findConnectedComponents(e){let t,i;try{const c=Vi.speedwalk_findConnectedComponents(this.__wbg_ptr,e);var r=c[0],o=c[1];if(c[3])throw r=0,o=0,js(c[2]);return t=r,i=o,Po(r,o)}finally{Vi.__wbindgen_free(t,i,1)}}editGenerateMissingCrossings(e){const t=Vi.speedwalk_editGenerateMissingCrossings(this.__wbg_ptr,e);if(t[1])throw js(t[0])}constructor(e,t){const i=ej(e,Vi.__wbindgen_malloc),r=ep,o=Vi.speedwalk_new(i,r,t);if(o[2])throw js(o[1]);return this.__wbg_ptr=o[0]>>>0,ZP.register(this,this.__wbg_ptr,this),this}toOsc(){let e,t;try{const i=Vi.speedwalk_toOsc(this.__wbg_ptr);return e=i[0],t=i[1],Po(i[0],i[1])}finally{Vi.__wbindgen_free(e,t,1)}}getWays(){let e,t;try{const o=Vi.speedwalk_getWays(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,js(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}editUndo(){const e=Vi.speedwalk_editUndo(this.__wbg_ptr);if(e[1])throw js(e[0])}getEdits(){let e,t;try{const o=Vi.speedwalk_getEdits(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,js(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}getNodes(){let e,t;try{const o=Vi.speedwalk_getNodes(this.__wbg_ptr);var i=o[0],r=o[1];if(o[3])throw i=0,r=0,js(o[2]);return e=i,t=r,Po(i,r)}finally{Vi.__wbindgen_free(e,t,1)}}get timestamp(){const e=Vi.__wbg_get_speedwalk_timestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}set timestamp(e){Vi.__wbg_set_speedwalk_timestamp(this.__wbg_ptr,!bd(e),bd(e)?BigInt(0):e)}}Symbol.dispose&&(Wx.prototype[Symbol.dispose]=Wx.prototype.free);const tj=new Set(["basic","cors","default"]);async function ij(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(i){if(n.ok&&tj.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function nj(){const n={};return n.wbg={},n.wbg.__wbg_Error_e83987f665cf5504=function(e,t){return Error(Po(e,t))},n.wbg.__wbg___wbindgen_bigint_get_as_i64_f3ebc5a755000afd=function(e,t){const i=t,r=typeof i=="bigint"?i:void 0;Zc().setBigInt64(e+8,bd(r)?BigInt(0):r,!0),Zc().setInt32(e+0,!bd(r),!0)},n.wbg.__wbg___wbindgen_boolean_get_6d5a1ee65bab5f68=function(e){const t=e,i=typeof t=="boolean"?t:void 0;return bd(i)?16777215:i?1:0},n.wbg.__wbg___wbindgen_debug_string_df47ffb5e35e6763=function(e,t){const i=iM(t),r=CS(i,Vi.__wbindgen_malloc,Vi.__wbindgen_realloc),o=ep;Zc().setInt32(e+4,o,!0),Zc().setInt32(e+0,r,!0)},n.wbg.__wbg___wbindgen_in_bb933bd9e1b3bc0f=function(e,t){return e in t},n.wbg.__wbg___wbindgen_is_bigint_cb320707dcd35f0b=function(e){return typeof e=="bigint"},n.wbg.__wbg___wbindgen_is_function_ee8a6c5833c90377=function(e){return typeof e=="function"},n.wbg.__wbg___wbindgen_is_object_c818261d21f283a4=function(e){const t=e;return typeof t=="object"&&t!==null},n.wbg.__wbg___wbindgen_is_string_fbb76cb2940daafd=function(e){return typeof e=="string"},n.wbg.__wbg___wbindgen_is_undefined_2d472862bd29a478=function(e){return e===void 0},n.wbg.__wbg___wbindgen_jsval_eq_6b13ab83478b1c50=function(e,t){return e===t},n.wbg.__wbg___wbindgen_jsval_loose_eq_b664b38a2f582147=function(e,t){return e==t},n.wbg.__wbg___wbindgen_number_get_a20bf9b85341449d=function(e,t){const i=t,r=typeof i=="number"?i:void 0;Zc().setFloat64(e+8,bd(r)?0:r,!0),Zc().setInt32(e+0,!bd(r),!0)},n.wbg.__wbg___wbindgen_string_get_e4f06c90489ad01b=function(e,t){const i=t,r=typeof i=="string"?i:void 0;var o=bd(r)?0:CS(r,Vi.__wbindgen_malloc,Vi.__wbindgen_realloc),c=ep;Zc().setInt32(e+4,c,!0),Zc().setInt32(e+0,o,!0)},n.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(e,t){throw new Error(Po(e,t))},n.wbg.__wbg_call_e762c39fa8ea36bf=function(){return ES(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_debug_f4b0c59db649db48=function(e){console.debug(e)},n.wbg.__wbg_done_2042aa2670fb1db1=function(e){return e.done},n.wbg.__wbg_entries_e171b586f8f6bdbf=function(e){return Object.entries(e)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let i,r;try{i=e,r=t,console.error(Po(e,t))}finally{Vi.__wbindgen_free(i,r,1)}},n.wbg.__wbg_error_a7f8fbb0523dae15=function(e){console.error(e)},n.wbg.__wbg_get_7bed016f185add81=function(e,t){return e[t>>>0]},n.wbg.__wbg_get_efcb449f58ec27c2=function(){return ES(function(e,t){return Reflect.get(e,t)},arguments)},n.wbg.__wbg_get_with_ref_key_1dc361bd10053bfe=function(e,t){return e[t]},n.wbg.__wbg_info_e674a11f4f50cc0c=function(e){console.info(e)},n.wbg.__wbg_instanceof_ArrayBuffer_70beb1189ca63b38=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Map_8579b5e2ab5437c7=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_20c8e73002f7af98=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_isArray_96e0af9891d0945d=function(e){return Array.isArray(e)},n.wbg.__wbg_isSafeInteger_d216eda7911dde36=function(e){return Number.isSafeInteger(e)},n.wbg.__wbg_iterator_e5822695327a3c39=function(){return Symbol.iterator},n.wbg.__wbg_length_69bca3cb64fc8748=function(e){return e.length},n.wbg.__wbg_length_cdd215e10d9dd507=function(e){return e.length},n.wbg.__wbg_log_8cec76766b8c0e33=function(e){console.log(e)},n.wbg.__wbg_new_5a79be3ab53b8aa5=function(e){return new Uint8Array(e)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},n.wbg.__wbg_next_020810e0ae8ebcb0=function(){return ES(function(e){return e.next()},arguments)},n.wbg.__wbg_next_2c826fe5dfec6b6a=function(e){return e.next},n.wbg.__wbg_prototypesetcall_2a6620b6922694b2=function(e,t,i){Uint8Array.prototype.set.call(QU(e,t),i)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const i=t.stack,r=CS(i,Vi.__wbindgen_malloc,Vi.__wbindgen_realloc),o=ep;Zc().setInt32(e+4,o,!0),Zc().setInt32(e+0,r,!0)},n.wbg.__wbg_value_692627309814bb8c=function(e){return e.value},n.wbg.__wbg_warn_1d74dddbe2fd1dbb=function(e){console.warn(e)},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){return Po(e,t)},n.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(e){return BigInt.asUintN(64,e)},n.wbg.__wbindgen_cast_9ae0607507abb057=function(e){return e},n.wbg.__wbindgen_init_externref_table=function(){const e=Vi.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n}function rj(n,e){return Vi=n.exports,wD.__wbindgen_wasm_module=e,Uf=null,kv=null,Vi.__wbindgen_start(),Vi}async function wD(n){if(Vi!==void 0)return Vi;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/speedwalk/assets/backend_bg-WFJVy_d6.wasm",import.meta.url));const e=nj();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:i}=await ij(await n,e);return rj(t,i)}let kh=Mc(null),Xs=Mc(null),ia=Mc(0),Zx=Mc(!1),Qv=Mc(),nM=Mc({kind:"sidewalks"}),Xx=Mc(!1),Yx=Mc(!1),Gf=Mc({include:"OnlyExplicitFootways",ignore_deadends:!1});function sj(n){return n.reduce((e,t)=>e+t,0)}function rM(n){return n<1e3?Math.round(n)+" m":(n/1e3).toFixed(1)+" km"}async function uu(){await new Promise(n=>{requestAnimationFrame(()=>{requestAnimationFrame(n)})})}let XP=new Set(Qf.keys());var oj=Xt("<!> <!>",1);function aj(n,e){en(e,!0);const t=()=>on(Xs,"$backend",r),i=()=>on(kh,"$map",r),[r,o]=cs();let c=ii("");async function s(x,b){try{yt(c,"Importing OSM data"),await uu(),rl(Xs,new Wx(x,b)),f()}catch(M){window.alert(`Bad OSM input: ${M}`)}finally{yt(c,"")}}function f(){i().fitBounds(bD(JSON.parse(t().getNodes())),{animate:!1,padding:10})}var p=oj(),g=ui(p);vp(g,{get loading(){return ee(c)}});var _=ht(g,2);Xy(_,{left:M=>{XU(M,{get map(){return i()},onloading:P=>yt(c,P,!0),onload:s,onerror:P=>{window.alert(P),yt(c,"")}})},main:M=>{qV(M)},$$slots:{left:!0,main:!0}}),pt(n,p),tn(),o()}const lj="/speedwalk/assets/favicon-DMAVMD4u.ico",cj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAApElEQVRIS+XUQQqAIBAFUOcgnaEIul/tO1kQdYau0AHsC64y4n9BIWozG/lPx0lzhT8rnO9+BnjvZ7T0NLOJbS3dIoQ3CD1i8MgiNBCCgbQou4JIQEQ61I1FZCAiPerKIFmAgmQDERlQl7eTJAAu0rMj+LAuma76gLJ7HFZvEQsgnJqkrEtmw8NmZQDh5X40NVw6Qa3HrtxzzU7XfZ18ySr0feACKA1QGcdX8MgAAAAASUVORK5CYII=",uj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAu0lEQVRIS2NkoDFgpLH5DKMWEAxhUoOoHmpiI0GToQpIsQBkeANUH4gmyhJiLUA2HOZ4oiwhxgJkw42gpp8j1ieELEA23ABo6EWowfpA+gIxluCzANlwPaBhl9EiVhfIv0TIEnwWlAM1dwCxJhDfgBqEnoq0gOJXgbgCiDuxpSxCQSQA1PQByXBsqQhZDYYdhCyAaRhNRVgz/oCkInSXUDUVYfUmUJAqqQiX4QTFiU2mBA3CpWDUAoJBBwDGtiwZhFZ9ZQAAAABJRU5ErkJggg==";var hj=Xt('<div><button class="btn btn-danger mb-3"> </button></div>'),dj=Xt(`<h1>Customize basemaps</h1> <!> <div class="card"><div class="card-header">Add a basemap</div> <div class="card-body"><p>You can add custom basemaps if you know a tile URL and that the imagery
        has a license allowing it to be used for editing OSM.</p> <ul><li><a href="https://github.com/osmlab/editor-layer-index" target="_blank">editor-layer-index</a> is a great reference, or you could check in iD or JOSM and figure out which
          one you like to use for your area.</li> <li>If you copy a URL from there, you may need to manually substitute some
          parts of the URL to make it work.</li> <li><b>&lbrace;zoom&rbrace;</b> &rarr; <b>&lbrace;z&rbrace;</b></li> <li><b>&lbrace;proj&rbrace;</b> &rarr; <b>&lbrace;EPSG:3857&rbrace;</b></li> <li><b>&lbrace;width&rbrace;</b> &rarr; <b>256</b></li> <li><b>&lbrace;height&rbrace;</b> &rarr; <b>256</b></li> <li><b>&lbrace;bbox&rbrace;</b> &rarr; <b>&lbrace;bbox-epsg-3857&rbrace;</b></li> <li>Some sources have CORS restrictions and won't work</li></ul> <div><label class="form-label">Name: <input class="form-control" type="text"/></label></div> <div><label class="form-label">Tile URL: <textarea class="form-control" rows="3" cols="80"></textarea></label></div> <div><label class="form-label">Attribution: <input class="form-control" type="text"/></label></div> <button class="btn btn-primary">Add basemap</button></div></div> <div class="mt-5"><button class="btn btn-primary">Done</button></div>`,1);function fj(n,e){en(e,!0);let t=st(e,"show",15),i="speedwalk-custom-basemaps",r=ii(bs(JSON.parse(window.localStorage.getItem(i)||"[]")));for(let _ of ee(r))Qf.set(_.name,f(_.tileURL,_.attribution));let o=ii(""),c=ii(""),s=ii("");function f(_,x){return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[_],tileSize:256,attribution:x}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"},{id:"Road labels",type:"background",layout:{visibility:"none"}}],glyphs:"https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=MZEJTanw3WpxRvt7qDfo"}}function p(){ee(r).push({name:ee(o),tileURL:ee(c),attribution:ee(s)}),window.localStorage.setItem(i,JSON.stringify(ee(r))),Qf.set(ee(o),f(ee(c),ee(s))),yt(o,""),yt(c,""),yt(s,"")}function g(_){yt(r,ee(r).filter(x=>x.name!=_),!0),window.localStorage.setItem(i,JSON.stringify(ee(r))),Qf.delete(_)}hp(n,{get show(){return t()},set show(_){t(_)},children:(_,x)=>{var b=dj(),M=ht(ui(b),2);Os(M,17,()=>ee(r),Fs,(J,le)=>{var ae=hj(),pe=Bt(ae);pe.__click=()=>g(ee(le).name);var fe=Bt(pe);Ji(()=>ln(fe,`Remove ${ee(le).name??""}`)),pt(J,ae)});var P=ht(M,2),k=ht(Bt(P),2),L=ht(Bt(k),4),I=Bt(L),F=ht(Bt(I)),N=ht(L,2),H=Bt(N),Y=ht(Bt(H)),q=ht(N,2),U=Bt(q),G=ht(Bt(U)),j=ht(q,2);j.__click=p;var B=ht(P,2),ne=Bt(B);ne.__click=()=>t(!1),Ji(()=>j.disabled=!ee(o)||!ee(c)||!ee(s)),qv(F,()=>ee(o),J=>yt(o,J)),qv(Y,()=>ee(c),J=>yt(c,J)),qv(G,()=>ee(s),J=>yt(s,J)),pt(_,b)},$$slots:{default:!0}}),tn()}ps(["click"]);var pj=Xt('<li><button type="button"> </button></li>'),mj=Xt('<li><button type="button"> </button></li>'),gj=Xt('<li><hr class="dropdown-divider"/></li> <!>',1),_j=Xt('<div class="basemap-selector svelte-1589rj1"><div class="btn-group"><button class="btn btn-outline-secondary dropdown-toggle basemap-button svelte-1589rj1" type="button" data-bs-toggle="dropdown" aria-expanded="false"> </button> <ul class="dropdown-menu"><!> <!> <li><hr class="dropdown-divider"/></li> <li><button class="dropdown-item" type="button"><i class="fa-solid fa-square-plus me-2"></i> Add custom basemap</button></li></ul></div></div> <!>',1);function vj(n,e){en(e,!0);let t=st(e,"basemap",15),i=ii(!1),r=Kt(()=>[...Qf.keys().filter(L=>!XP.has(L))]);var o=_j(),c=ui(o),s=Bt(c),f=Bt(s),p=Bt(f),g=ht(f,2),_=Bt(g);Os(_,17,()=>XP,Fs,(L,I)=>{var F=pj(),N=Bt(F);let H;N.__click=()=>t(ee(I));var Y=Bt(N);Ji(()=>{H=lp(N,1,"dropdown-item",null,H,{active:t()===ee(I)}),ln(Y,ee(I))}),pt(L,F)});var x=ht(_,2);{var b=L=>{var I=gj(),F=ht(ui(I),2);Os(F,17,()=>ee(r),Fs,(N,H)=>{var Y=mj(),q=Bt(Y);let U;q.__click=()=>t(ee(H));var G=Bt(q);Ji(()=>{U=lp(q,1,"dropdown-item",null,U,{active:t()===ee(H)}),ln(G,ee(H))}),pt(N,Y)}),pt(L,I)};Ki(x,L=>{ee(r).length>0&&L(b)})}var M=ht(x,4),P=Bt(M);P.__click=()=>yt(i,!0);var k=ht(c,2);fj(k,{get show(){return ee(i)},set show(L){yt(i,L,!0)}}),Ji(()=>ln(p,t())),pt(n,o),tn()}ps(["click"]);function SD(n){if(!n)return null;const e=n.getCenter();return{lat:e.lat,lng:e.lng,zoom:n.getZoom()}}function yj(n,e,t){const i=new URLSearchParams;return i.append("map",`${Math.round(n)}/${e.toFixed(6)}/${t.toFixed(6)}`),`https://www.openstreetmap.org/#${i.toString()}`}function TD(n,e,t){const i=new URLSearchParams;return i.append("map",`${Math.round(n)}/${e.toFixed(6)}/${t.toFixed(6)}`),`https://www.openstreetmap.org/edit?editor=id#${i.toString()}`}function bj(n,e,t){const i=new URLSearchParams;return i.append("map",`${Math.round(n)}/${e.toFixed(6)}/${t.toFixed(6)}`),i.append("disable_features","boundaries"),i.append("hashtags","Speedwalk"),`https://kyle.kiwi/iD/#${i.toString()}`}function xj(n,e,t){const i=new URLSearchParams;return i.append("map",`${Math.round(n)}/${e.toFixed(6)}/${t.toFixed(6)}`),i.append("disable_features","boundaries"),i.append("hashtags","Speedwalk"),`https://rapideditor.org/edit#${i.toString()}`}function wj(n,e,t,i){return`http://127.0.0.1:8111/load_and_zoom?left=${n.toFixed(6)}&right=${e.toFixed(6)}&top=${t.toFixed(6)}&bottom=${i.toFixed(6)}`}function Sj(n){const e=n.getBounds();return wj(e.getWest(),e.getEast(),e.getNorth(),e.getSouth())}function Tj(n,e,t){const i=new URL("https://www.mapillary.com/app/");return i.searchParams.set("lat",String(e)),i.searchParams.set("lng",String(t)),i.searchParams.set("z",String(Math.round(n))),i.toString()}var Mj=Xt('<li><a class="dropdown-item" href="#"> </a></li>'),Cj=Xt('<div class="btn-group"><button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" title="Open in OSM editors"><i class="fa-solid fa-pen"></i></button> <ul class="dropdown-menu"></ul></div>');function Ej(n,e){en(e,!1);const t=()=>on(kh,"$map",i),[i,r]=cs(),o=["OSM","iD","Kiwid","Rapid","JOSM","Mapillary"];function c(p){const g=SD(t());if(!(!t()||!g))return{OSM:yj(g.zoom,g.lat,g.lng),iD:TD(g.zoom,g.lat,g.lng),Kiwid:bj(g.zoom,g.lat,g.lng),Rapid:xj(g.zoom,g.lat,g.lng),JOSM:Sj(t()),Mapillary:Tj(g.zoom,g.lat,g.lng)}[p]}Tw();var s=Cj(),f=ht(Bt(s),2);Os(f,5,()=>o,Fs,(p,g)=>{var _=Mj(),x=Bt(_);x.__click=M=>{M.preventDefault(),window.open(c(ee(g)),"_blank","noopener,noreferrer")};var b=Bt(x);Ji(()=>ln(b,ee(g))),pt(p,_)}),pt(n,s),tn(),r()}ps(["click"]);var Aj=Xt('<h2>Report a problem</h2> <p>Done, thank you for submitting. <!></p> <button class="btn btn-primary">OK</button>',1),Pj=Xt('<img alt="Screenshot" class="svelte-10dd0dj"/>'),Ij=Xt("<p>Loading screenshot... (sometimes you have to cancel and try again)</p>"),Lj=Xt('<div class="img-container mb-3 svelte-10dd0dj"><!></div>'),Rj=Xt('<button class="btn btn-primary me-3" disabled><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div> Submit report</button>'),kj=Xt('<button class="btn btn-primary me-3">Submit report</button>'),Dj=Xt(`<div class="d-flex justify-content-between"><h2>Report a problem</h2> <button class="btn-close" aria-label="Close"></button></div> <p>You can report a problem with Speedwalk.</p> <fieldset class="mb-3"><legend>Please describe the problem <br/> (if it's not obvious from the screenshot below)</legend> <textarea class="form-control" rows="4" placeholder="Details"></textarea></fieldset> <!> <!> <!> <div class="d-flex"><!> <button class="btn btn-secondary">Cancel</button></div>`,1),Fj=Xt("<!> <!>",1);function Oj(n,e){en(e,!0);const t=()=>on(kh,"$map",r),i=()=>on(Qv,"$loggedInUser",r),[r,o]=cs();let c=ii(!1),s=ii(!1),f=ii(!1);function p(){t()&&L()}let g=ii(""),_=ii(bs({})),x=ii(!1),b=ii(!0),M=ii(void 0),P=ii(void 0),k=Kt(()=>ee(g)||ee(P));async function L(){yt(c,!0),yt(_,{url:window.location.toString(),viewport:Y(t())},!0),yt(M,await N(t()),!0),yt(P,URL.createObjectURL(ee(M)),!0)}async function I(){let ne=null;ee(x)&&i()&&(ne=i().name);let J=null;ee(b)&&ee(M)&&(J=await H(ee(M)));let le={...ee(_),details:ee(g),screenshot:J,username:ne};try{yt(s,!0);let ae=await fetch("https://walknet.abstreet.uk/problems/speedwalk_problems",{method:"POST",body:JSON.stringify(le),headers:{"Content-Type":"application/json"}});if(!ae.ok)throw new Error(`Bad response: ${ae.status}`)}catch(ae){window.alert(`Failed to report a problem: ${ae}`),yt(s,!1);return}yt(s,!1),F(),yt(f,!0)}function F(){yt(c,!1),yt(g,""),yt(_,{},!0),yt(M,void 0),ee(P)&&(URL.revokeObjectURL(ee(P)),yt(P,void 0))}function N(ne){return new Promise((J,le)=>{ne.redraw(),ne.once("idle",()=>{ne.getCanvas().toBlob(ae=>{ae?J(ae):le("no blob")})})})}function H(ne){return new Promise((J,le)=>{let ae=new FileReader;ae.readAsDataURL(ne),ae.onloadend=function(){ae.result?J(ae.result):le("base64 failed")}})}function Y(ne){let J=ne.getCenter(),le=Math.round(ne.getZoom()*100)/100,ae=Math.ceil((le*Math.LN2+Math.log(512/360/.5))/Math.LN10),pe=Math.pow(10,ae),fe=Math.round(J.lat*pe)/pe,Te=Math.round(J.lng*pe)/pe,Ce=`${le}/${fe}/${Te}`,tt=ne.getBearing(),Ke=ne.getPitch();return(tt||Ke)&&(Ce+=`/${Math.round(tt*10)/10}`),Ke&&(Ce+=`/${Math.round(Ke)}`),`#${Ce}`}var q={triggerStart:p},U=Fj(),G=ui(U);hp(G,{get show(){return ee(f)},set show(ne){yt(f,ne,!0)},children:(ne,J)=>{var le=Aj(),ae=ht(ui(le),2),pe=ht(Bt(ae));{var fe=Ce=>{var tt=Hn("You may be contacted later when this problem has been fixed.");pt(Ce,tt)};Ki(pe,Ce=>{ee(x)&&i()&&Ce(fe)})}var Te=ht(ae,2);Te.__click=()=>yt(f,!1),pt(ne,le)},$$slots:{default:!0}});var j=ht(G,2);hp(j,{closeable:!1,get show(){return ee(c)},set show(ne){yt(c,ne,!0)},children:(ne,J)=>{var le=Dj(),ae=ui(le),pe=ht(Bt(ae),2);pe.__click=F;var fe=ht(ae,4),Te=ht(Bt(fe),2),Ce=ht(fe,2);fs(Ce,{get checked(){return ee(b)},set checked(At){yt(b,At,!0)},children:(At,Nt)=>{var $t=Hn("Include screenshot");pt(At,$t)},$$slots:{default:!0}});var tt=ht(Ce,2);{var Ke=At=>{fs(At,{get checked(){return ee(x)},set checked(Nt){yt(x,Nt,!0)},children:(Nt,$t)=>{var Ze=Hn();Ji(()=>ln(Ze,`Include your OSM username (${i().name??""}) in the report and be
      contacted when the problem is fixed`)),pt(Nt,Ze)},$$slots:{default:!0}})};Ki(tt,At=>{i()&&At(Ke)})}var dt=ht(tt,2);{var et=At=>{var Nt=Lj(),$t=Bt(Nt);{var Ze=Mt=>{var Zt=Pj();Ji(()=>lu(Zt,"src",ee(P))),pt(Mt,Zt)},bt=Mt=>{var Zt=Ij();pt(Mt,Zt)};Ki($t,Mt=>{ee(P)?Mt(Ze):Mt(bt,!1)})}pt(At,Nt)};Ki(dt,At=>{ee(b)&&At(et)})}var Oe=ht(dt,2),lt=Bt(Oe);{var Ye=At=>{var Nt=Rj();pt(At,Nt)},zt=At=>{var Nt=kj();Nt.__click=I,Ji(()=>Nt.disabled=!ee(k)),pt(At,Nt)};Ki(lt,At=>{ee(s)?At(Ye):At(zt,!1)})}var Lt=ht(lt,2);Lt.__click=F,qv(Te,()=>ee(g),At=>yt(g,At)),pt(ne,le)},$$slots:{default:!0}}),pt(n,U);var B=tn(q);return o(),B}ps(["click"]);var zj=Xt('<div class="report-problem-wrapper svelte-1f4xae4"><button class="btn btn-secondary report-problem-btn svelte-1f4xae4"><i class="fa-solid fa-triangle-exclamation"></i> <span class="report-problem-text svelte-1f4xae4">Report problem</span></button></div>'),Bj=Xt("<!> <!>",1);function Nj(n){const e=()=>on(kh,"$map",t),[t,i]=cs();let r=ii(null);var o=Bj(),c=ui(o);{var s=p=>{var g=zj(),_=Bt(g);_.__click=()=>{ee(r)?.triggerStart()},pt(p,g)};Ki(c,p=>{e()&&p(s)})}var f=ht(c,2);vc(Oj(f,{}),p=>yt(r,p,!0),()=>ee(r)),pt(n,o),i()}ps(["click"]);var sM=function(n,e){return sM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])},sM(n,e)};function Cc(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");sM(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function $j(n,e,t,i){function r(o){return o instanceof t?o:new t(function(c){c(o)})}return new(t||(t=Promise))(function(o,c){function s(g){try{p(i.next(g))}catch(_){c(_)}}function f(g){try{p(i.throw(g))}catch(_){c(_)}}function p(g){g.done?o(g.value):r(g.value).then(s,f)}p((i=i.apply(n,[])).next())})}function MD(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,c;return c={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(p){return function(g){return f([p,g])}}function f(p){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=p[0]&2?r.return:p[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,p[1])).done)return o;switch(r=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,r=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(n,t)}catch(g){p=[6,g],r=0}finally{i=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function hu(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tc(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var i=t.call(n),r,o=[],c;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(s){c={error:s}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(c)throw c.error}}return o}function mu(n,e){for(var t=0,i=e.length,r=n.length;t<i;t++,r++)n[r]=e[t];return n}function wg(n){return this instanceof wg?(this.v=n,this):new wg(n)}function Vj(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),r,o=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(x){i[x]&&(r[x]=function(b){return new Promise(function(M,P){o.push([x,b,M,P])>1||s(x,b)})})}function s(x,b){try{f(i[x](b))}catch(M){_(o[0][3],M)}}function f(x){x.value instanceof wg?Promise.resolve(x.value.v).then(p,g):_(o[0][2],x)}function p(x){s("next",x)}function g(x){s("throw",x)}function _(x,b){x(b),o.shift(),o.length&&s(o[0][0],o[0][1])}}function Uj(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof hu=="function"?hu(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=n[o]&&function(c){return new Promise(function(s,f){c=n[o](c),r(s,f,c.done,c.value)})}}function r(o,c,s,f){Promise.resolve(f).then(function(p){o({value:p,done:s})},c)}}function Fn(n){return typeof n=="function"}function Iw(n){var e=function(i){Error.call(i),i.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var AS=Iw(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(i,r){return r+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function by(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Ch=(function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}return n.prototype.unsubscribe=function(){var e,t,i,r,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var s=hu(c),f=s.next();!f.done;f=s.next()){var p=f.value;p.remove(this)}}catch(P){e={error:P}}finally{try{f&&!f.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else c.remove(this);var g=this.initialTeardown;if(Fn(g))try{g()}catch(P){o=P instanceof AS?P.errors:[P]}var _=this._teardowns;if(_){this._teardowns=null;try{for(var x=hu(_),b=x.next();!b.done;b=x.next()){var M=b.value;try{YP(M)}catch(P){o=o??[],P instanceof AS?o=mu(mu([],Tc(o)),Tc(P.errors)):o.push(P)}}}catch(P){i={error:P}}finally{try{b&&!b.done&&(r=x.return)&&r.call(x)}finally{if(i)throw i.error}}}if(o)throw new AS(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)YP(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=(t=this._teardowns)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&by(t,e)},n.prototype.remove=function(e){var t=this._teardowns;t&&by(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=(function(){var e=new n;return e.closed=!0,e})(),n})(),CD=Ch.EMPTY;function ED(n){return n instanceof Ch||n&&"closed"in n&&Fn(n.remove)&&Fn(n.add)&&Fn(n.unsubscribe)}function YP(n){Fn(n)?n():n.unsubscribe()}var jj={Promise:void 0},Gj={setTimeout:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return setTimeout.apply(void 0,mu([],Tc(n)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function AD(n){Gj.setTimeout(function(){throw n})}function Fd(){}function wx(n){n()}var w2=(function(n){Cc(e,n);function e(t){var i=n.call(this)||this;return i.isStopped=!1,t?(i.destination=t,ED(t)&&t.add(i)):i.destination=qj,i}return e.create=function(t,i,r){return new S2(t,i,r)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Ch),S2=(function(n){Cc(e,n);function e(t,i,r){var o=n.call(this)||this,c;if(Fn(t))c=t;else if(t){c=t.next,i=t.error,r=t.complete;var s;s=t,c=c?.bind(s),i=i?.bind(s),r=r?.bind(s)}return o.destination={next:c?PS(c):Fd,error:PS(i??PD),complete:r?PS(r):Fd},o}return e})(w2);function PS(n,e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{n.apply(void 0,mu([],Tc(t)))}catch(r){AD(r)}}}function PD(n){throw n}var qj={closed:!0,next:Fd,error:PD,complete:Fd},Lw=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function yu(n){return n}function Hj(n){return n.length===0?yu:n.length===1?n[0]:function(t){return n.reduce(function(i,r){return r(i)},t)}}var gr=(function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,i){var r=this,o=Zj(e)?e:new S2(e,t,i);return wx(function(){var c=r,s=c.operator,f=c.source;o.add(s?s.call(o,f):f?r._subscribe(o):r._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var i=this;return t=KP(t),new t(function(r,o){var c;c=i.subscribe(function(s){try{e(s)}catch(f){o(f),c?.unsubscribe()}},o,r)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[Lw]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Hj(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=KP(e),new e(function(i,r){var o;t.subscribe(function(c){return o=c},function(c){return r(c)},function(){return i(o)})})},n.create=function(e){return new n(e)},n})();function KP(n){var e;return(e=n??jj.Promise)!==null&&e!==void 0?e:Promise}function Wj(n){return n&&Fn(n.next)&&Fn(n.error)&&Fn(n.complete)}function Zj(n){return n&&n instanceof w2||Wj(n)&&ED(n)}function ID(n){return Fn(n?.lift)}function Xn(n){return function(e){if(ID(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}var Pn=(function(n){Cc(e,n);function e(t,i,r,o,c){var s=n.call(this,t)||this;return s.onFinalize=c,s._next=i?function(f){try{i(f)}catch(p){t.error(p)}}:n.prototype._next,s._error=o?function(f){try{o(f)}catch(p){t.error(p)}finally{this.unsubscribe()}}:n.prototype._error,s._complete=r?function(){try{r()}catch(f){t.error(f)}finally{this.unsubscribe()}}:n.prototype._complete,s}return e.prototype.unsubscribe=function(){var t,i=this.closed;n.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))},e})(w2);function gi(){return Xn(function(n,e){var t=null;n._refCount++;var i=new Pn(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var r=n._connection,o=t;t=null,r&&(!o||r===o)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}var Xj=(function(n){Cc(e,n);function e(t,i){var r=n.call(this)||this;return r.source=t,r.subjectFactory=i,r._subject=null,r._refCount=0,r._connection=null,ID(t)&&(r.lift=t.lift),r}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t?.unsubscribe()},e.prototype.connect=function(){var t=this,i=this._connection;if(!i){i=this._connection=new Ch;var r=this.getSubject();i.add(this.source.subscribe(new Pn(r,void 0,function(){t._teardown(),r.complete()},function(o){t._teardown(),r.error(o)},function(){return t._teardown()}))),i.closed&&(this._connection=null,i=Ch.EMPTY)}return i},e.prototype.refCount=function(){return gi()(this)},e})(gr),Yj=Iw(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ri=(function(n){Cc(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new JP(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new Yj},e.prototype.next=function(t){var i=this;wx(function(){var r,o;if(i._throwIfClosed(),!i.isStopped){var c=i.observers.slice();try{for(var s=hu(c),f=s.next();!f.done;f=s.next()){var p=f.value;p.next(t)}}catch(g){r={error:g}}finally{try{f&&!f.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}}})},e.prototype.error=function(t){var i=this;wx(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var r=i.observers;r.length;)r.shift().error(t)}})},e.prototype.complete=function(){var t=this;wx(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,r=i.hasError,o=i.isStopped,c=i.observers;return r||o?CD:(c.push(t),new Ch(function(){return by(c,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,r=i.hasError,o=i.thrownError,c=i.isStopped;r?t.error(o):c&&t.complete()},e.prototype.asObservable=function(){var t=new gr;return t.source=this,t},e.create=function(t,i){return new JP(t,i)},e})(gr),JP=(function(n){Cc(e,n);function e(t,i){var r=n.call(this)||this;return r.destination=t,r.source=i,r}return e.prototype.next=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,t)},e.prototype.error=function(t){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&r!==void 0?r:CD},e})(ri),Eh=(function(n){Cc(e,n);function e(t){var i=n.call(this)||this;return i._value=t,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var i=n.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},e.prototype.getValue=function(){var t=this,i=t.hasError,r=t.thrownError,o=t._value;if(i)throw r;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e})(ri),T2={now:function(){return(T2.delegate||Date).now()},delegate:void 0},LD=(function(n){Cc(e,n);function e(t,i,r){t===void 0&&(t=1/0),i===void 0&&(i=1/0),r===void 0&&(r=T2);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=i,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=i===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,i),o}return e.prototype.next=function(t){var i=this,r=i.isStopped,o=i._buffer,c=i._infiniteTimeWindow,s=i._timestampProvider,f=i._windowTime;r||(o.push(t),!c&&o.push(s.now()+f)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var i=this._innerSubscribe(t),r=this,o=r._infiniteTimeWindow,c=r._buffer,s=c.slice(),f=0;f<s.length&&!t.closed;f+=o?1:2)t.next(s[f]);return this._checkFinalizedStatuses(t),i},e.prototype._trimBuffer=function(){var t=this,i=t._bufferSize,r=t._timestampProvider,o=t._buffer,c=t._infiniteTimeWindow,s=(c?1:2)*i;if(i<1/0&&s<o.length&&o.splice(0,o.length-s),!c){for(var f=r.now(),p=0,g=1;g<o.length&&o[g]<=f;g+=2)p=g;p&&o.splice(0,p+1)}},e})(ri),Kj=(function(n){Cc(e,n);function e(t,i){return n.call(this)||this}return e.prototype.schedule=function(t,i){return this},e})(Ch),oM={setInterval:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=oM.delegate;return(t?.setInterval||setInterval).apply(void 0,mu([],Tc(n)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},Jj=(function(n){Cc(e,n);function e(t,i){var r=n.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(t,i){if(i===void 0&&(i=0),this.closed)return this;this.state=t;var r=this.id,o=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(o,r,i)),this.pending=!0,this.delay=i,this.id=this.id||this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(t,i,r){return r===void 0&&(r=0),oM.setInterval(t.flush.bind(t,this),r)},e.prototype.recycleAsyncId=function(t,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;oM.clearInterval(i)},e.prototype.execute=function(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,i){var r=!1,o;try{this.work(t)}catch(c){r=!0,o=!!c&&c||new Error(c)}if(r)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,i=t.id,r=t.scheduler,o=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,by(o,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e})(Kj),QP=(function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,i){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(i,t)},n.now=T2.now,n})(),Qj=(function(n){Cc(e,n);function e(t,i){i===void 0&&(i=QP.now);var r=n.call(this,t,i)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return e.prototype.flush=function(t){var i=this.actions;if(this._active){i.push(t);return}var r;this._active=!0;do if(r=t.execute(t.state,t.delay))break;while(t=i.shift());if(this._active=!1,r){for(;t=i.shift();)t.unsubscribe();throw r}},e})(QP),M2=new Qj(Jj),RD=M2,Yy=new gr(function(n){return n.complete()});function zi(n){return n?eG(n):Yy}function eG(n){return new gr(function(e){return n.schedule(function(){return e.complete()})})}function C2(n,e){return new gr(function(t){var i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}var E2=(function(n){return n&&typeof n.length=="number"&&typeof n!="function"});function kD(n){return Fn(n?.then)}function tG(n,e){return new gr(function(t){var i=new Ch;return i.add(e.schedule(function(){var r=n[Lw]();i.add(r.subscribe({next:function(o){i.add(e.schedule(function(){return t.next(o)}))},error:function(o){i.add(e.schedule(function(){return t.error(o)}))},complete:function(){i.add(e.schedule(function(){return t.complete()}))}}))})),i})}function iG(n,e){return new gr(function(t){return e.schedule(function(){return n.then(function(i){t.add(e.schedule(function(){t.next(i),t.add(e.schedule(function(){return t.complete()}))}))},function(i){t.add(e.schedule(function(){return t.error(i)}))})})})}function nG(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var DD=nG();function FD(n,e,t,i){i===void 0&&(i=0);var r=e.schedule(function(){try{t.call(this)}catch(o){n.error(o)}},i);return n.add(r),r}function rG(n,e){return new gr(function(t){var i;return t.add(e.schedule(function(){i=n[DD](),FD(t,e,function(){var r=i.next(),o=r.value,c=r.done;c?t.complete():(t.next(o),this.schedule())})})),function(){return Fn(i?.return)&&i.return()}})}function OD(n,e){if(!n)throw new Error("Iterable cannot be null");return new gr(function(t){var i=new Ch;return i.add(e.schedule(function(){var r=n[Symbol.asyncIterator]();i.add(e.schedule(function(){var o=this;r.next().then(function(c){c.done?t.complete():(t.next(c.value),o.schedule())})}))})),i})}function zD(n){return Fn(n[Lw])}function BD(n){return Fn(n?.[DD])}function ND(n){return Symbol.asyncIterator&&Fn(n?.[Symbol.asyncIterator])}function $D(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function VD(n){return Vj(this,arguments,function(){var t,i,r,o;return MD(this,function(c){switch(c.label){case 0:t=n.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,wg(t.read())];case 3:return i=c.sent(),r=i.value,o=i.done,o?[4,wg(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,wg(r)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function UD(n){return Fn(n?.getReader)}function sG(n,e){return OD(VD(n),e)}function oG(n,e){if(n!=null){if(zD(n))return tG(n,e);if(E2(n))return C2(n,e);if(kD(n))return iG(n,e);if(ND(n))return OD(n,e);if(BD(n))return rG(n,e);if(UD(n))return sG(n,e)}throw $D(n)}function Fr(n,e){return e?oG(n,e):ll(n)}function ll(n){if(n instanceof gr)return n;if(n!=null){if(zD(n))return aG(n);if(E2(n))return jD(n);if(kD(n))return lG(n);if(ND(n))return GD(n);if(BD(n))return cG(n);if(UD(n))return uG(n)}throw $D(n)}function aG(n){return new gr(function(e){var t=n[Lw]();if(Fn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function jD(n){return new gr(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function lG(n){return new gr(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,AD)})}function cG(n){return new gr(function(e){var t,i;try{for(var r=hu(n),o=r.next();!o.done;o=r.next()){var c=o.value;if(e.next(c),e.closed)return}}catch(s){t={error:s}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}e.complete()})}function GD(n){return new gr(function(e){hG(n,e).catch(function(t){return e.error(t)})})}function uG(n){return GD(VD(n))}function hG(n,e){var t,i,r,o;return $j(this,void 0,void 0,function(){var c,s;return MD(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,11]),t=Uj(n),f.label=1;case 1:return[4,t.next()];case 2:if(i=f.sent(),!!i.done)return[3,4];if(c=i.value,e.next(c),e.closed)return[2];f.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=f.sent(),r={error:s},[3,11];case 6:return f.trys.push([6,,9,10]),i&&!i.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Rw(n,e){return e?C2(n,e):jD(n)}function qD(n){return n&&Fn(n.schedule)}function A2(n){return n[n.length-1]}function P2(n){return Fn(A2(n))?n.pop():void 0}function Ky(n){return qD(A2(n))?n.pop():void 0}function dG(n,e){return typeof A2(n)=="number"?n.pop():e}function Ai(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ky(n);return t?C2(n,t):Rw(n)}function Sx(n,e){var t=Fn(n)?n:function(){return n},i=function(r){return r.error(t())};return new gr(i)}var I2=Iw(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function HD(n){return n instanceof Date&&!isNaN(n)}var fG=Iw(function(n){return function(t){t===void 0&&(t=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function aM(n,e){var t=HD(n)?{first:n}:{each:n},i=t.first,r=t.each,o=t.with,c=o===void 0?pG:o,s=t.scheduler,f=s===void 0?M2:s,p=t.meta,g=p===void 0?null:p;if(i==null&&r==null)throw new TypeError("No timeout provided.");return Xn(function(_,x){var b,M,P=null,k=0,L=function(I){M=FD(x,f,function(){b.unsubscribe(),ll(c({meta:g,lastValue:P,seen:k})).subscribe(x)},I)};b=_.subscribe(new Pn(x,function(I){M?.unsubscribe(),k++,x.next(P=I),r>0&&L(r)},void 0,void 0,function(){M?.closed||M?.unsubscribe(),P=null})),L(i!=null?typeof i=="number"?i:+i-f.now():r)})}function pG(n){throw new fG(n)}function We(n,e){return Xn(function(t,i){var r=0;t.subscribe(new Pn(i,function(o){i.next(n.call(e,o,r++))}))})}var mG=Array.isArray;function gG(n,e){return mG(e)?n.apply(void 0,mu([],Tc(e))):n(e)}function WD(n){return We(function(e){return gG(n,e)})}var _G=Array.isArray,vG=Object.getPrototypeOf,yG=Object.prototype,bG=Object.keys;function xG(n){if(n.length===1){var e=n[0];if(_G(e))return{args:e,keys:null};if(wG(e)){var t=bG(e);return{args:t.map(function(i){return e[i]}),keys:t}}}return{args:n,keys:null}}function wG(n){return n&&typeof n=="object"&&vG(n)===yG}function SG(n,e){return n.reduce(function(t,i,r){return t[i]=e[r],t},{})}function Si(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ky(n),i=P2(n),r=xG(n),o=r.args,c=r.keys;if(o.length===0)return Fr([],t);var s=new gr(TG(o,t,c?function(f){return SG(c,f)}:yu));return i?s.pipe(WD(i)):s}function TG(n,e,t){return t===void 0&&(t=yu),function(i){eI(e,function(){for(var r=n.length,o=new Array(r),c=r,s=r,f=function(g){eI(e,function(){var _=Fr(n[g],e),x=!1;_.subscribe(new Pn(i,function(b){o[g]=b,x||(x=!0,s--),s||i.next(t(o.slice()))},function(){--c||i.complete()}))},i)},p=0;p<r;p++)f(p)},i)}}function eI(n,e,t){n?t.add(n.schedule(e)):e()}function ZD(n,e,t,i,r,o,c,s){var f=[],p=0,g=0,_=!1,x=function(){_&&!f.length&&!p&&e.complete()},b=function(P){return p<i?M(P):f.push(P)},M=function(P){o&&e.next(P),p++;var k=!1;ll(t(P,g++)).subscribe(new Pn(e,function(L){o?b(L):e.next(L)},function(){k=!0},void 0,function(){if(k)try{p--;for(var L=function(){var I=f.shift();c?e.add(c.schedule(function(){return M(I)})):M(I)};f.length&&p<i;)L();x()}catch(I){e.error(I)}}))};return n.subscribe(new Pn(e,b,function(){_=!0,x()})),function(){}}function Wi(n,e,t){return t===void 0&&(t=1/0),Fn(e)?Wi(function(i,r){return We(function(o,c){return e(i,o,r,c)})(ll(n(i,r)))},t):(typeof e=="number"&&(t=e),Xn(function(i,r){return ZD(i,r,n,t)}))}function tp(n){return n===void 0&&(n=1/0),Wi(yu,n)}function MG(){return tp(1)}function Nl(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return MG()(Rw(n,Ky(n)))}var CG=["addListener","removeListener"],EG=["addEventListener","removeEventListener"],AG=["on","off"];function Tr(n,e,t,i){if(Fn(t)&&(i=t,t=void 0),i)return Tr(n,e,t).pipe(WD(i));var r=Tc(LG(n)?EG.map(function(s){return function(f){return n[s](e,f,t)}}):PG(n)?CG.map(tI(n,e)):IG(n)?AG.map(tI(n,e)):[],2),o=r[0],c=r[1];if(!o&&E2(n))return Wi(function(s){return Tr(s,e,t)})(Rw(n));if(!o)throw new TypeError("Invalid event target");return new gr(function(s){var f=function(){for(var p=[],g=0;g<arguments.length;g++)p[g]=arguments[g];return s.next(1<p.length?p:p[0])};return o(f),function(){return c(f)}})}function tI(n,e){return function(t){return function(i){return n[t](e,i)}}}function PG(n){return Fn(n.addListener)&&Fn(n.removeListener)}function IG(n){return Fn(n.on)&&Fn(n.off)}function LG(n){return Fn(n.addEventListener)&&Fn(n.removeEventListener)}function L2(n,e,t){n===void 0&&(n=0),t===void 0&&(t=RD);var i=-1;return e!=null&&(qD(e)?t=e:i=e),new gr(function(r){var o=HD(n)?+n-t.now():n;o<0&&(o=0);var c=0;return t.schedule(function(){r.closed||(r.next(c++),0<=i?this.schedule(void 0,i):r.complete())},o)})}function fn(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ky(n),i=dG(n,1/0),r=n;return r.length?r.length===1?ll(r[0]):tp(i)(Rw(r,t)):Yy}var RG=Array.isArray;function kG(n){return n.length===1&&RG(n[0])?n[0]:n}function oi(n,e){return Xn(function(t,i){var r=0;t.subscribe(new Pn(i,function(o){return n.call(e,o,r++)&&i.next(o)}))})}function xy(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=P2(n),i=kG(n);return i.length?new gr(function(r){var o=i.map(function(){return[]}),c=i.map(function(){return!1});r.add(function(){o=c=null});for(var s=function(p){ll(i[p]).subscribe(new Pn(r,function(g){if(o[p].push(g),o.every(function(x){return x.length})){var _=o.map(function(x){return x.shift()});r.next(t?t.apply(void 0,mu([],Tc(_))):_),o.some(function(x,b){return!x.length&&c[b]})&&r.complete()}},function(){c[p]=!0,!o[p].length&&r.complete()}))},f=0;!r.closed&&f<i.length;f++)s(f);return function(){o=c=null}}):Yy}function DG(n){return Xn(function(e,t){var i=!1,r=null,o=null,c=!1,s=function(){if(o?.unsubscribe(),o=null,i){i=!1;var p=r;r=null,t.next(p)}c&&t.complete()},f=function(){o=null,c&&t.complete()};e.subscribe(new Pn(t,function(p){i=!0,r=p,o||ll(n(p)).subscribe(o=new Pn(t,s,f))},function(){c=!0,(!i||!o||o.closed)&&t.complete()}))})}function XD(n,e){return e===void 0&&(e=RD),DG(function(){return L2(n,e)})}function Kx(n,e){return e===void 0&&(e=null),e=e??n,Xn(function(t,i){var r=[],o=0;t.subscribe(new Pn(i,function(c){var s,f,p,g,_=null;o++%e===0&&r.push([]);try{for(var x=hu(r),b=x.next();!b.done;b=x.next()){var M=b.value;M.push(c),n<=M.length&&(_=_??[],_.push(M))}}catch(L){s={error:L}}finally{try{b&&!b.done&&(f=x.return)&&f.call(x)}finally{if(s)throw s.error}}if(_)try{for(var P=hu(_),k=P.next();!k.done;k=P.next()){var M=k.value;by(r,M),i.next(M)}}catch(L){p={error:L}}finally{try{k&&!k.done&&(g=P.return)&&g.call(P)}finally{if(p)throw p.error}}},function(){var c,s;try{for(var f=hu(r),p=f.next();!p.done;p=f.next()){var g=p.value;i.next(g)}}catch(_){c={error:_}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(c)throw c.error}}i.complete()},void 0,function(){r=null}))})}function FG(n){return Xn(function(e,t){var i=null,r=null,o=function(){r?.unsubscribe();var c=i;i=[],c&&t.next(c),ll(n()).subscribe(r=new Pn(t,o,Fd))};o(),e.subscribe(new Pn(t,function(c){return i?.push(c)},function(){i&&t.next(i),t.complete()},void 0,function(){return i=r=null}))})}function Nn(n){return Xn(function(e,t){var i=null,r=!1,o;i=e.subscribe(new Pn(t,void 0,void 0,function(c){o=ll(n(c,Nn(n)(e))),i?(i.unsubscribe(),i=null,o.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(t))})}function YD(n,e,t,i,r){return function(o,c){var s=t,f=e,p=0;o.subscribe(new Pn(c,function(g){var _=p++;f=s?n(f,g,_):(s=!0,g),i&&c.next(f)},r&&(function(){s&&c.next(f),c.complete()})))}}function iI(n,e){return Xn(YD(n,e,arguments.length>=2,!1,!0))}function IS(n,e){return Fn(e)?Wi(n,e,1):Wi(n,1)}function OG(n){return new gr(function(e){return n.subscribe(e)})}var zG={connector:function(){return new ri}};function KD(n,e){e===void 0&&(e=zG);var t=e.connector;return Xn(function(i,r){var o=t();Fr(n(OG(o))).subscribe(r),r.add(i.subscribe(o))})}function wy(n,e){return e===void 0&&(e=M2),Xn(function(t,i){var r=null,o=null,c=null,s=function(){if(r){r.unsubscribe(),r=null;var p=o;o=null,i.next(p)}};function f(){var p=c+n,g=e.now();if(g<p){r=this.schedule(void 0,p-g),i.add(r);return}s()}t.subscribe(new Pn(i,function(p){o=p,c=e.now(),r||(r=e.schedule(f,n),i.add(r))},function(){s(),i.complete()},void 0,function(){o=r=null}))})}function JD(n){return Xn(function(e,t){var i=!1;e.subscribe(new Pn(t,function(r){i=!0,t.next(r)},function(){i||t.next(n),t.complete()}))})}function zl(n){return n<=0?function(){return Yy}:Xn(function(e,t){var i=0;e.subscribe(new Pn(t,function(r){++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function yi(n,e){return e===void 0&&(e=yu),n=n??BG,Xn(function(t,i){var r,o=!0;t.subscribe(new Pn(i,function(c){var s=e(c);(o||!n(r,s))&&(o=!1,r=s,i.next(c))}))})}function BG(n,e){return n===e}function QD(n){return n===void 0&&(n=NG),Xn(function(e,t){var i=!1;e.subscribe(new Pn(t,function(r){i=!0,t.next(r)},function(){return i?t.complete():t.error(n())}))})}function NG(){return new I2}function eF(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,Xn(function(i,r){return ZD(i,r,n,e,void 0,!0,t)})}function ma(n){return Xn(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function wi(n,e){var t=arguments.length>=2;return function(i){return i.pipe(n?oi(function(r,o){return n(r,o,i)}):yu,zl(1),t?JD(e):QD(function(){return new I2}))}}function lM(n){return n<=0?function(){return Yy}:Xn(function(e,t){var i=[];e.subscribe(new Pn(t,function(r){i.push(r),n<i.length&&i.shift()},function(){var r,o;try{for(var c=hu(i),s=c.next();!s.done;s=c.next()){var f=s.value;t.next(f)}}catch(p){r={error:p}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}t.complete()},void 0,function(){i=null}))})}function Og(n,e){var t=arguments.length>=2;return function(i){return i.pipe(n?oi(function(r,o){return n(r,o,i)}):yu,lM(1),t?JD(e):QD(function(){return new I2}))}}function tF(n,e){var t=Fn(n)?n:function(){return n};return Fn(e)?KD(e,{connector:t}):function(i){return new Xj(i,t)}}function tl(){return Xn(function(n,e){var t,i=!1;n.subscribe(new Pn(e,function(r){var o=t;t=r,i&&e.next([o,r]),i=!0}))})}function $G(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return We(function(i){for(var r=i,o=0;o<t;o++){var c=r?.[n[o]];if(typeof c<"u")r=c;else return}return r})}function Ya(n){return n?function(e){return KD(n)(e)}:function(e){return tF(new ri)(e)}}function Pi(n,e,t,i){var r=Fn(t)?t:void 0;return function(o){return tF(new LD(n,e,i),r)(o)}}function cM(n){var e;e={count:n};var t=e.count,i=t===void 0?1/0:t,r=e.delay,o=e.resetOnSuccess,c=o===void 0?!1:o;return i<=0?yu:Xn(function(s,f){var p=0,g,_=function(){var x=!1;g=s.subscribe(new Pn(f,function(b){c&&(p=0),f.next(b)},void 0,function(b){if(p++<i){var M=function(){g?(g.unsubscribe(),g=null,_()):x=!0};if(r!=null){var P=typeof r=="number"?L2(r):ll(r(b,p)),k=new Pn(f,function(){k.unsubscribe(),M()},function(){f.complete()});P.subscribe(k)}else M()}else f.error(b)})),x&&(g.unsubscribe(),g=null,_())};_()})}function VG(n){return Xn(function(e,t){var i=!1,r=null;e.subscribe(new Pn(t,function(c){i=!0,r=c}));var o=function(){if(i){i=!1;var c=r;r=null,t.next(c)}};n.subscribe(new Pn(t,o,Fd))})}function Vr(n,e){return Xn(YD(n,e,arguments.length>=2,!0))}function dn(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new ri}:e,i=n.resetOnError,r=i===void 0?!0:i,o=n.resetOnComplete,c=o===void 0?!0:o,s=n.resetOnRefCountZero,f=s===void 0?!0:s;return function(p){var g=null,_=null,x=null,b=0,M=!1,P=!1,k=function(){_?.unsubscribe(),_=null},L=function(){k(),g=x=null,M=P=!1},I=function(){var F=g;L(),F?.unsubscribe()};return Xn(function(F,N){b++,!P&&!M&&k();var H=x=x??t();N.add(function(){b--,b===0&&!P&&!M&&(_=LS(I,f))}),H.subscribe(N),g||(g=new S2({next:function(Y){return H.next(Y)},error:function(Y){P=!0,k(),_=LS(L,r,Y),H.error(Y)},complete:function(){M=!0,k(),_=LS(L,c),H.complete()}}),Fr(F).subscribe(g))})(p)}}function LS(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return e===!0?(n(),null):e===!1?null:e.apply(void 0,mu([],Tc(t))).pipe(zl(1)).subscribe(function(){return n()})}function Ys(n){return oi(function(e,t){return n<=t})}function uM(n){return Xn(function(e,t){var i=!1,r=0;e.subscribe(new Pn(t,function(o){return(i||(i=!n(o,r++)))&&t.next(o)}))})}function An(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ky(n);return Xn(function(i,r){(t?Nl(n,i,t):Nl(n,i)).subscribe(r)})}function ei(n,e){return Xn(function(t,i){var r=null,o=0,c=!1,s=function(){return c&&!r&&i.complete()};t.subscribe(new Pn(i,function(f){r?.unsubscribe();var p=0,g=o++;ll(n(f,g)).subscribe(r=new Pn(i,function(_){return i.next(e?e(f,_,g,p++):_)},function(){r=null,s()}))},function(){c=!0,s()}))})}function Sd(n){return Xn(function(e,t){ll(n).subscribe(new Pn(t,function(){return t.complete()},Fd)),!t.closed&&e.subscribe(t)})}function iF(n,e){return e===void 0&&(e=!1),Xn(function(t,i){var r=0;t.subscribe(new Pn(i,function(o){var c=n(o,r++);(c||e)&&i.next(o),!c&&i.complete()}))})}function Dr(n,e,t){var i=Fn(n)||e||t?{next:n,error:e,complete:t}:n;return i?Xn(function(r,o){var c;(c=i.subscribe)===null||c===void 0||c.call(i);var s=!0;r.subscribe(new Pn(o,function(f){var p;(p=i.next)===null||p===void 0||p.call(i,f),o.next(f)},function(){var f;s=!1,(f=i.complete)===null||f===void 0||f.call(i),o.complete()},function(f){var p;s=!1,(p=i.error)===null||p===void 0||p.call(i,f),o.error(f)},function(){var f,p;s&&((f=i.unsubscribe)===null||f===void 0||f.call(i)),(p=i.finalize)===null||p===void 0||p.call(i)}))}):yu}function Ui(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=P2(n);return Xn(function(i,r){for(var o=n.length,c=new Array(o),s=n.map(function(){return!1}),f=!1,p=function(_){ll(n[_]).subscribe(new Pn(r,function(x){c[_]=x,!f&&!s[_]&&(s[_]=!0,(f=s.every(yu))&&(s=null))},Fd))},g=0;g<o;g++)p(g);i.subscribe(new Pn(r,function(_){if(f){var x=mu([_],Tc(c));r.next(t?t.apply(void 0,mu([],Tc(x))):x)}}))})}class UG{createFilter(e){return new Function("node","return "+this._compile(e)+";")}_compile(e){if(e==null||e.length<=1)return"true";const t=e[0];return"("+(t==="=="?this._compileComparisonOp("===",e[1],e[2],!1):t==="!="?this._compileComparisonOp("!==",e[1],e[2],!1):t===">"||t===">="||t==="<"||t==="<="?this._compileComparisonOp(t,e[1],e[2],!0):t==="in"?this._compileInOp(e[1],e.slice(2)):t==="!in"?this._compileNegation(this._compileInOp(e[1],e.slice(2))):t==="all"?this._compileLogicalOp(e.slice(1),"&&"):"true")+")"}_compare(e,t){return e<t?-1:e>t?1:0}_compileComparisonOp(e,t,i,r){const o=this._compilePropertyReference(t),c=JSON.stringify(i);return(r?"typeof "+o+"===typeof "+c+"&&":"")+o+e+c}_compileInOp(e,t){const i=this._compare,r=JSON.stringify(t.sort(i)),o=this._compilePropertyReference(e);return r+".indexOf("+o+")!==-1"}_compileLogicalOp(e,t){const i=this._compile.bind(this);return e.map(i).join(t)}_compileNegation(e){return"!("+e+")"}_compilePropertyReference(e){return"node["+JSON.stringify(e)+"]"}}const nF="134",jG=0,nI=1,GG=2,rF=1,qG=2,Dv=3,zg=0,Gs=1,Ko=2,sF=1,Ed=0,ey=1,rI=2,sI=3,oI=4,HG=5,lg=100,WG=101,ZG=102,aI=103,lI=104,XG=200,YG=201,KG=202,JG=203,oF=204,aF=205,QG=206,e7=207,t7=208,i7=209,n7=210,r7=0,s7=1,o7=2,hM=3,a7=4,l7=5,c7=6,u7=7,kw=0,h7=1,d7=2,ip=0,f7=1,p7=2,m7=3,g7=4,_7=5,lF=300,Jy=301,Qy=302,dM=303,fM=304,Dw=306,R2=307,pM=1e3,Qa=1001,mM=1002,Ws=1003,cI=1004,uI=1005,Ro=1006,v7=1007,Fw=1008,Od=1009,y7=1010,b7=1011,Jx=1012,x7=1013,Tx=1014,wd=1015,Sg=1016,w7=1017,S7=1018,T7=1019,ty=1020,M7=1021,np=1022,oa=1023,C7=1024,E7=1025,A7=oa,Tg=1026,Sy=1027,P7=1028,I7=1029,L7=1030,R7=1031,k7=1032,D7=1033,hI=33776,dI=33777,fI=33778,pI=33779,mI=35840,gI=35841,_I=35842,vI=35843,F7=36196,yI=37492,bI=37496,O7=37808,z7=37809,B7=37810,N7=37811,$7=37812,V7=37813,U7=37814,j7=37815,G7=37816,q7=37817,H7=37818,W7=37819,Z7=37820,X7=37821,Y7=36492,K7=37840,J7=37841,Q7=37842,eq=37843,tq=37844,iq=37845,nq=37846,rq=37847,sq=37848,oq=37849,aq=37850,lq=37851,cq=37852,uq=37853,hq=2200,dq=2201,fq=2202,Qx=2300,ew=2301,RS=2302,dg=2400,fg=2401,tw=2402,k2=2500,cF=2501,pq=0,Fo=3e3,yp=3001,D2=3007,F2=3002,mq=3003,uF=3004,hF=3005,dF=3006,gq=3200,_q=3201,Qg=0,vq=1,kS=7680,yq=519,Ty=35044,iw=35048,xI="300 es";class bp{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const o=r.indexOf(t);o!==-1&&r.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let o=0,c=r.length;o<c;o++)r[o].call(this,e);e.target=null}}}let yb=1234567;const iy=Math.PI/180,My=180/Math.PI,uo=[];for(let n=0;n<256;n++)uo[n]=(n<16?"0":"")+n.toString(16);const bq=typeof crypto<"u"&&"randomUUID"in crypto;function bc(){if(bq)return crypto.randomUUID().toUpperCase();const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(uo[n&255]+uo[n>>8&255]+uo[n>>16&255]+uo[n>>24&255]+"-"+uo[e&255]+uo[e>>8&255]+"-"+uo[e>>16&15|64]+uo[e>>24&255]+"-"+uo[t&63|128]+uo[t>>8&255]+"-"+uo[t>>16&255]+uo[t>>24&255]+uo[i&255]+uo[i>>8&255]+uo[i>>16&255]+uo[i>>24&255]).toUpperCase()}function ga(n,e,t){return Math.max(e,Math.min(t,n))}function O2(n,e){return(n%e+e)%e}function xq(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function wq(n,e,t){return n!==e?(t-n)/(e-n):0}function ny(n,e,t){return(1-t)*n+t*e}function Sq(n,e,t,i){return ny(n,e,1-Math.exp(-t*i))}function Tq(n,e=1){return e-Math.abs(O2(n,e*2)-e)}function Mq(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function Cq(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function Eq(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Aq(n,e){return n+Math.random()*(e-n)}function Pq(n){return n*(.5-Math.random())}function Iq(n){return n!==void 0&&(yb=n%2147483647),yb=yb*16807%2147483647,(yb-1)/2147483646}function Lq(n){return n*iy}function Rq(n){return n*My}function gM(n){return(n&n-1)===0&&n!==0}function kq(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function fF(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Dq(n,e,t,i,r){const o=Math.cos,c=Math.sin,s=o(t/2),f=c(t/2),p=o((e+i)/2),g=c((e+i)/2),_=o((e-i)/2),x=c((e-i)/2),b=o((i-e)/2),M=c((i-e)/2);switch(r){case"XYX":n.set(s*g,f*_,f*x,s*p);break;case"YZY":n.set(f*x,s*g,f*_,s*p);break;case"ZXZ":n.set(f*_,f*x,s*g,s*p);break;case"XZX":n.set(s*g,f*M,f*b,s*p);break;case"YXY":n.set(f*b,s*g,f*M,s*p);break;case"ZYZ":n.set(f*M,f*b,s*g,s*p);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}var Bg=Object.freeze({__proto__:null,DEG2RAD:iy,RAD2DEG:My,generateUUID:bc,clamp:ga,euclideanModulo:O2,mapLinear:xq,inverseLerp:wq,lerp:ny,damp:Sq,pingpong:Tq,smoothstep:Mq,smootherstep:Cq,randInt:Eq,randFloat:Aq,randFloatSpread:Pq,seededRandom:Iq,degToRad:Lq,radToDeg:Rq,isPowerOfTwo:gM,ceilPowerOfTwo:kq,floorPowerOfTwo:fF,setQuaternionFromProperEuler:Dq});class li{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),o=this.x-e.x,c=this.y-e.y;return this.x=o*i-c*r+e.x,this.y=o*r+c*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}li.prototype.isVector2=!0;class mo{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,o,c,s,f,p){const g=this.elements;return g[0]=e,g[1]=r,g[2]=s,g[3]=t,g[4]=o,g[5]=f,g[6]=i,g[7]=c,g[8]=p,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,o=this.elements,c=i[0],s=i[3],f=i[6],p=i[1],g=i[4],_=i[7],x=i[2],b=i[5],M=i[8],P=r[0],k=r[3],L=r[6],I=r[1],F=r[4],N=r[7],H=r[2],Y=r[5],q=r[8];return o[0]=c*P+s*I+f*H,o[3]=c*k+s*F+f*Y,o[6]=c*L+s*N+f*q,o[1]=p*P+g*I+_*H,o[4]=p*k+g*F+_*Y,o[7]=p*L+g*N+_*q,o[2]=x*P+b*I+M*H,o[5]=x*k+b*F+M*Y,o[8]=x*L+b*N+M*q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],f=e[6],p=e[7],g=e[8];return t*c*g-t*s*p-i*o*g+i*s*f+r*o*p-r*c*f}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],f=e[6],p=e[7],g=e[8],_=g*c-s*p,x=s*f-g*o,b=p*o-c*f,M=t*_+i*x+r*b;if(M===0)return this.set(0,0,0,0,0,0,0,0,0);const P=1/M;return e[0]=_*P,e[1]=(r*p-g*i)*P,e[2]=(s*i-r*c)*P,e[3]=x*P,e[4]=(g*t-r*f)*P,e[5]=(r*o-s*t)*P,e[6]=b*P,e[7]=(i*f-p*t)*P,e[8]=(c*t-i*o)*P,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,o,c,s){const f=Math.cos(o),p=Math.sin(o);return this.set(i*f,i*p,-i*(f*c+p*s)+c+e,-r*p,r*f,-r*(-p*c+f*s)+s+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),r=this.elements,o=r[0],c=r[3],s=r[6],f=r[1],p=r[4],g=r[7];return r[0]=t*o+i*f,r[3]=t*c+i*p,r[6]=t*s+i*g,r[1]=-i*o+t*f,r[4]=-i*c+t*p,r[7]=-i*s+t*g,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}mo.prototype.isMatrix3=!0;function pF(n){if(n.length===0)return-1/0;let e=n[0];for(let t=1,i=n.length;t<i;++t)n[t]>e&&(e=n[t]);return e}function Ow(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function wI(n,e=0){let t=3735928559^e,i=1103547991^e;for(let r=0,o;r<n.length;r++)o=n.charCodeAt(r),t=Math.imul(t^o,2654435761),i=Math.imul(i^o,1597334677);return t=Math.imul(t^t>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}let Om;class e_{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Om===void 0&&(Om=Ow("canvas")),Om.width=e.width,Om.height=e.height;const i=Om.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Om}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Fq=0;class zs extends bp{constructor(e=zs.DEFAULT_IMAGE,t=zs.DEFAULT_MAPPING,i=Qa,r=Qa,o=Ro,c=Fw,s=oa,f=Od,p=1,g=Fo){super(),Object.defineProperty(this,"id",{value:Fq++}),this.uuid=bc(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=o,this.minFilter=c,this.anisotropy=p,this.format=s,this.internalFormat=null,this.type=f,this.offset=new li(0,0),this.repeat=new li(1,1),this.center=new li(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new mo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=g,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const r=this.image;if(r.uuid===void 0&&(r.uuid=bc()),!t&&e.images[r.uuid]===void 0){let o;if(Array.isArray(r)){o=[];for(let c=0,s=r.length;c<s;c++)r[c].isDataTexture?o.push(DS(r[c].image)):o.push(DS(r[c]))}else o=DS(r);e.images[r.uuid]={uuid:r.uuid,url:o}}i.image=r.uuid}return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lF)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case pM:e.x=e.x-Math.floor(e.x);break;case Qa:e.x=e.x<0?0:1;break;case mM:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case pM:e.y=e.y-Math.floor(e.y);break;case Qa:e.y=e.y<0?0:1;break;case mM:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}zs.DEFAULT_IMAGE=void 0;zs.DEFAULT_MAPPING=lF;zs.prototype.isTexture=!0;function DS(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?e_.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Zn{constructor(e=0,t=0,i=0,r=1){this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,o=this.w,c=e.elements;return this.x=c[0]*t+c[4]*i+c[8]*r+c[12]*o,this.y=c[1]*t+c[5]*i+c[9]*r+c[13]*o,this.z=c[2]*t+c[6]*i+c[10]*r+c[14]*o,this.w=c[3]*t+c[7]*i+c[11]*r+c[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,o;const f=e.elements,p=f[0],g=f[4],_=f[8],x=f[1],b=f[5],M=f[9],P=f[2],k=f[6],L=f[10];if(Math.abs(g-x)<.01&&Math.abs(_-P)<.01&&Math.abs(M-k)<.01){if(Math.abs(g+x)<.1&&Math.abs(_+P)<.1&&Math.abs(M+k)<.1&&Math.abs(p+b+L-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const F=(p+1)/2,N=(b+1)/2,H=(L+1)/2,Y=(g+x)/4,q=(_+P)/4,U=(M+k)/4;return F>N&&F>H?F<.01?(i=0,r=.707106781,o=.707106781):(i=Math.sqrt(F),r=Y/i,o=q/i):N>H?N<.01?(i=.707106781,r=0,o=.707106781):(r=Math.sqrt(N),i=Y/r,o=U/r):H<.01?(i=.707106781,r=.707106781,o=0):(o=Math.sqrt(H),i=q/o,r=U/o),this.set(i,r,o,t),this}let I=Math.sqrt((k-M)*(k-M)+(_-P)*(_-P)+(x-g)*(x-g));return Math.abs(I)<.001&&(I=1),this.x=(k-M)/I,this.y=(_-P)/I,this.z=(x-g)/I,this.w=Math.acos((p+b+L-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Zn.prototype.isVector4=!0;class xc extends bp{constructor(e,t,i={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Zn(0,0,e,t),this.scissorTest=!1,this.viewport=new Zn(0,0,e,t),this.texture=new zs(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Ro,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}xc.prototype.isWebGLRenderTarget=!0;class Oq extends xc{constructor(e,t,i){super(e,t);const r=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=r.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,o=this.texture.length;r<o;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}Oq.prototype.isWebGLMultipleRenderTargets=!0;class mF extends xc{constructor(e,t,i){super(e,t,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}mF.prototype.isWebGLMultisampleRenderTarget=!0;class go{constructor(e=0,t=0,i=0,r=1){this._x=e,this._y=t,this._z=i,this._w=r}static slerp(e,t,i,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,r)}static slerpFlat(e,t,i,r,o,c,s){let f=i[r+0],p=i[r+1],g=i[r+2],_=i[r+3];const x=o[c+0],b=o[c+1],M=o[c+2],P=o[c+3];if(s===0){e[t+0]=f,e[t+1]=p,e[t+2]=g,e[t+3]=_;return}if(s===1){e[t+0]=x,e[t+1]=b,e[t+2]=M,e[t+3]=P;return}if(_!==P||f!==x||p!==b||g!==M){let k=1-s;const L=f*x+p*b+g*M+_*P,I=L>=0?1:-1,F=1-L*L;if(F>Number.EPSILON){const H=Math.sqrt(F),Y=Math.atan2(H,L*I);k=Math.sin(k*Y)/H,s=Math.sin(s*Y)/H}const N=s*I;if(f=f*k+x*N,p=p*k+b*N,g=g*k+M*N,_=_*k+P*N,k===1-s){const H=1/Math.sqrt(f*f+p*p+g*g+_*_);f*=H,p*=H,g*=H,_*=H}}e[t]=f,e[t+1]=p,e[t+2]=g,e[t+3]=_}static multiplyQuaternionsFlat(e,t,i,r,o,c){const s=i[r],f=i[r+1],p=i[r+2],g=i[r+3],_=o[c],x=o[c+1],b=o[c+2],M=o[c+3];return e[t]=s*M+g*_+f*b-p*x,e[t+1]=f*M+g*x+p*_-s*b,e[t+2]=p*M+g*b+s*x-f*_,e[t+3]=g*M-s*_-f*x-p*b,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,r=e._y,o=e._z,c=e._order,s=Math.cos,f=Math.sin,p=s(i/2),g=s(r/2),_=s(o/2),x=f(i/2),b=f(r/2),M=f(o/2);switch(c){case"XYZ":this._x=x*g*_+p*b*M,this._y=p*b*_-x*g*M,this._z=p*g*M+x*b*_,this._w=p*g*_-x*b*M;break;case"YXZ":this._x=x*g*_+p*b*M,this._y=p*b*_-x*g*M,this._z=p*g*M-x*b*_,this._w=p*g*_+x*b*M;break;case"ZXY":this._x=x*g*_-p*b*M,this._y=p*b*_+x*g*M,this._z=p*g*M+x*b*_,this._w=p*g*_-x*b*M;break;case"ZYX":this._x=x*g*_-p*b*M,this._y=p*b*_+x*g*M,this._z=p*g*M-x*b*_,this._w=p*g*_+x*b*M;break;case"YZX":this._x=x*g*_+p*b*M,this._y=p*b*_+x*g*M,this._z=p*g*M-x*b*_,this._w=p*g*_-x*b*M;break;case"XZY":this._x=x*g*_-p*b*M,this._y=p*b*_-x*g*M,this._z=p*g*M+x*b*_,this._w=p*g*_+x*b*M;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+c)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],o=t[8],c=t[1],s=t[5],f=t[9],p=t[2],g=t[6],_=t[10],x=i+s+_;if(x>0){const b=.5/Math.sqrt(x+1);this._w=.25/b,this._x=(g-f)*b,this._y=(o-p)*b,this._z=(c-r)*b}else if(i>s&&i>_){const b=2*Math.sqrt(1+i-s-_);this._w=(g-f)/b,this._x=.25*b,this._y=(r+c)/b,this._z=(o+p)/b}else if(s>_){const b=2*Math.sqrt(1+s-i-_);this._w=(o-p)/b,this._x=(r+c)/b,this._y=.25*b,this._z=(f+g)/b}else{const b=2*Math.sqrt(1+_-i-s);this._w=(c-r)/b,this._x=(o+p)/b,this._y=(f+g)/b,this._z=.25*b}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ga(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,o=e._z,c=e._w,s=t._x,f=t._y,p=t._z,g=t._w;return this._x=i*g+c*s+r*p-o*f,this._y=r*g+c*f+o*s-i*p,this._z=o*g+c*p+i*f-r*s,this._w=c*g-i*s-r*f-o*p,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,o=this._z,c=this._w;let s=c*e._w+i*e._x+r*e._y+o*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=c,this._x=i,this._y=r,this._z=o,this;const f=1-s*s;if(f<=Number.EPSILON){const b=1-t;return this._w=b*c+t*this._w,this._x=b*i+t*this._x,this._y=b*r+t*this._y,this._z=b*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const p=Math.sqrt(f),g=Math.atan2(p,s),_=Math.sin((1-t)*g)/p,x=Math.sin(t*g)/p;return this._w=c*_+this._w*x,this._x=i*_+this._x*x,this._y=r*_+this._y*x,this._z=o*_+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(o),i*Math.cos(o),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}go.prototype.isQuaternion=!0;class Fe{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(SI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(SI.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*r,this.y=o[1]*t+o[4]*i+o[7]*r,this.z=o[2]*t+o[5]*i+o[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,o=e.elements,c=1/(o[3]*t+o[7]*i+o[11]*r+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*r+o[12])*c,this.y=(o[1]*t+o[5]*i+o[9]*r+o[13])*c,this.z=(o[2]*t+o[6]*i+o[10]*r+o[14])*c,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,o=e.x,c=e.y,s=e.z,f=e.w,p=f*t+c*r-s*i,g=f*i+s*t-o*r,_=f*r+o*i-c*t,x=-o*t-c*i-s*r;return this.x=p*f+x*-o+g*-s-_*-c,this.y=g*f+x*-c+_*-o-p*-s,this.z=_*f+x*-s+p*-c-g*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r,this.y=o[1]*t+o[5]*i+o[9]*r,this.z=o[2]*t+o[6]*i+o[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,o=e.z,c=t.x,s=t.y,f=t.z;return this.x=r*f-o*s,this.y=o*c-i*f,this.z=i*s-r*c,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return FS.copy(this).projectOnVector(e),this.sub(FS)}reflect(e){return this.sub(FS.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ga(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Fe.prototype.isVector3=!0;const FS=new Fe,SI=new go;class cl{constructor(e=new Fe(1/0,1/0,1/0),t=new Fe(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,o=-1/0,c=-1/0,s=-1/0;for(let f=0,p=e.length;f<p;f+=3){const g=e[f],_=e[f+1],x=e[f+2];g<t&&(t=g),_<i&&(i=_),x<r&&(r=x),g>o&&(o=g),_>c&&(c=_),x>s&&(s=x)}return this.min.set(t,i,r),this.max.set(o,c,s),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,o=-1/0,c=-1/0,s=-1/0;for(let f=0,p=e.count;f<p;f++){const g=e.getX(f),_=e.getY(f),x=e.getZ(f);g<t&&(t=g),_<i&&(i=_),x<r&&(r=x),g>o&&(o=g),_>c&&(c=_),x>s&&(s=x)}return this.min.set(t,i,r),this.max.set(o,c,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=fv.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),OS.copy(t.boundingBox),OS.applyMatrix4(e.matrixWorld),this.union(OS));const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,fv),fv.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(pv),bb.subVectors(this.max,pv),zm.subVectors(e.a,pv),Bm.subVectors(e.b,pv),Nm.subVectors(e.c,pv),cd.subVectors(Bm,zm),ud.subVectors(Nm,Bm),Nf.subVectors(zm,Nm);let t=[0,-cd.z,cd.y,0,-ud.z,ud.y,0,-Nf.z,Nf.y,cd.z,0,-cd.x,ud.z,0,-ud.x,Nf.z,0,-Nf.x,-cd.y,cd.x,0,-ud.y,ud.x,0,-Nf.y,Nf.x,0];return!zS(t,zm,Bm,Nm,bb)||(t=[1,0,0,0,1,0,0,0,1],!zS(t,zm,Bm,Nm,bb))?!1:(xb.crossVectors(cd,ud),t=[xb.x,xb.y,xb.z],zS(t,zm,Bm,Nm,bb))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return fv.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(fv).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Qu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}cl.prototype.isBox3=!0;const Qu=[new Fe,new Fe,new Fe,new Fe,new Fe,new Fe,new Fe,new Fe],fv=new Fe,OS=new cl,zm=new Fe,Bm=new Fe,Nm=new Fe,cd=new Fe,ud=new Fe,Nf=new Fe,pv=new Fe,bb=new Fe,xb=new Fe,$f=new Fe;function zS(n,e,t,i,r){for(let o=0,c=n.length-3;o<=c;o+=3){$f.fromArray(n,o);const s=r.x*Math.abs($f.x)+r.y*Math.abs($f.y)+r.z*Math.abs($f.z),f=e.dot($f),p=t.dot($f),g=i.dot($f);if(Math.max(-Math.max(f,p,g),Math.min(f,p,g))>s)return!1}return!0}const zq=new cl,TI=new Fe,BS=new Fe,NS=new Fe;class t_{constructor(e=new Fe,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):zq.setFromPoints(e).getCenter(i);let r=0;for(let o=0,c=e.length;o<c;o++)r=Math.max(r,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){NS.subVectors(e,this.center);const t=NS.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.add(NS.multiplyScalar(r/i)),this.radius+=r}return this}union(e){return BS.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(TI.copy(e.center).add(BS)),this.expandByPoint(TI.copy(e.center).sub(BS)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const eh=new Fe,$S=new Fe,wb=new Fe,hd=new Fe,VS=new Fe,Sb=new Fe,US=new Fe;class xp{constructor(e=new Fe,t=new Fe(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,eh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=eh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(eh.copy(this.direction).multiplyScalar(t).add(this.origin),eh.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){$S.copy(e).add(t).multiplyScalar(.5),wb.copy(t).sub(e).normalize(),hd.copy(this.origin).sub($S);const o=e.distanceTo(t)*.5,c=-this.direction.dot(wb),s=hd.dot(this.direction),f=-hd.dot(wb),p=hd.lengthSq(),g=Math.abs(1-c*c);let _,x,b,M;if(g>0)if(_=c*f-s,x=c*s-f,M=o*g,_>=0)if(x>=-M)if(x<=M){const P=1/g;_*=P,x*=P,b=_*(_+c*x+2*s)+x*(c*_+x+2*f)+p}else x=o,_=Math.max(0,-(c*x+s)),b=-_*_+x*(x+2*f)+p;else x=-o,_=Math.max(0,-(c*x+s)),b=-_*_+x*(x+2*f)+p;else x<=-M?(_=Math.max(0,-(-c*o+s)),x=_>0?-o:Math.min(Math.max(-o,-f),o),b=-_*_+x*(x+2*f)+p):x<=M?(_=0,x=Math.min(Math.max(-o,-f),o),b=x*(x+2*f)+p):(_=Math.max(0,-(c*o+s)),x=_>0?o:Math.min(Math.max(-o,-f),o),b=-_*_+x*(x+2*f)+p);else x=c>0?-o:o,_=Math.max(0,-(c*x+s)),b=-_*_+x*(x+2*f)+p;return i&&i.copy(this.direction).multiplyScalar(_).add(this.origin),r&&r.copy(wb).multiplyScalar(x).add($S),b}intersectSphere(e,t){eh.subVectors(e.center,this.origin);const i=eh.dot(this.direction),r=eh.dot(eh)-i*i,o=e.radius*e.radius;if(r>o)return null;const c=Math.sqrt(o-r),s=i-c,f=i+c;return s<0&&f<0?null:s<0?this.at(f,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,o,c,s,f;const p=1/this.direction.x,g=1/this.direction.y,_=1/this.direction.z,x=this.origin;return p>=0?(i=(e.min.x-x.x)*p,r=(e.max.x-x.x)*p):(i=(e.max.x-x.x)*p,r=(e.min.x-x.x)*p),g>=0?(o=(e.min.y-x.y)*g,c=(e.max.y-x.y)*g):(o=(e.max.y-x.y)*g,c=(e.min.y-x.y)*g),i>c||o>r||((o>i||i!==i)&&(i=o),(c<r||r!==r)&&(r=c),_>=0?(s=(e.min.z-x.z)*_,f=(e.max.z-x.z)*_):(s=(e.max.z-x.z)*_,f=(e.min.z-x.z)*_),i>f||s>r)||((s>i||i!==i)&&(i=s),(f<r||r!==r)&&(r=f),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,eh)!==null}intersectTriangle(e,t,i,r,o){VS.subVectors(t,e),Sb.subVectors(i,e),US.crossVectors(VS,Sb);let c=this.direction.dot(US),s;if(c>0){if(r)return null;s=1}else if(c<0)s=-1,c=-c;else return null;hd.subVectors(this.origin,e);const f=s*this.direction.dot(Sb.crossVectors(hd,Sb));if(f<0)return null;const p=s*this.direction.dot(VS.cross(hd));if(p<0||f+p>c)return null;const g=-s*hd.dot(US);return g<0?null:this.at(g/c,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ri{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,o,c,s,f,p,g,_,x,b,M,P,k){const L=this.elements;return L[0]=e,L[4]=t,L[8]=i,L[12]=r,L[1]=o,L[5]=c,L[9]=s,L[13]=f,L[2]=p,L[6]=g,L[10]=_,L[14]=x,L[3]=b,L[7]=M,L[11]=P,L[15]=k,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ri().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/$m.setFromMatrixColumn(e,0).length(),o=1/$m.setFromMatrixColumn(e,1).length(),c=1/$m.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*o,t[5]=i[5]*o,t[6]=i[6]*o,t[7]=0,t[8]=i[8]*c,t[9]=i[9]*c,t[10]=i[10]*c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,r=e.y,o=e.z,c=Math.cos(i),s=Math.sin(i),f=Math.cos(r),p=Math.sin(r),g=Math.cos(o),_=Math.sin(o);if(e.order==="XYZ"){const x=c*g,b=c*_,M=s*g,P=s*_;t[0]=f*g,t[4]=-f*_,t[8]=p,t[1]=b+M*p,t[5]=x-P*p,t[9]=-s*f,t[2]=P-x*p,t[6]=M+b*p,t[10]=c*f}else if(e.order==="YXZ"){const x=f*g,b=f*_,M=p*g,P=p*_;t[0]=x+P*s,t[4]=M*s-b,t[8]=c*p,t[1]=c*_,t[5]=c*g,t[9]=-s,t[2]=b*s-M,t[6]=P+x*s,t[10]=c*f}else if(e.order==="ZXY"){const x=f*g,b=f*_,M=p*g,P=p*_;t[0]=x-P*s,t[4]=-c*_,t[8]=M+b*s,t[1]=b+M*s,t[5]=c*g,t[9]=P-x*s,t[2]=-c*p,t[6]=s,t[10]=c*f}else if(e.order==="ZYX"){const x=c*g,b=c*_,M=s*g,P=s*_;t[0]=f*g,t[4]=M*p-b,t[8]=x*p+P,t[1]=f*_,t[5]=P*p+x,t[9]=b*p-M,t[2]=-p,t[6]=s*f,t[10]=c*f}else if(e.order==="YZX"){const x=c*f,b=c*p,M=s*f,P=s*p;t[0]=f*g,t[4]=P-x*_,t[8]=M*_+b,t[1]=_,t[5]=c*g,t[9]=-s*g,t[2]=-p*g,t[6]=b*_+M,t[10]=x-P*_}else if(e.order==="XZY"){const x=c*f,b=c*p,M=s*f,P=s*p;t[0]=f*g,t[4]=-_,t[8]=p*g,t[1]=x*_+P,t[5]=c*g,t[9]=b*_-M,t[2]=M*_-b,t[6]=s*g,t[10]=P*_+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Bq,e,Nq)}lookAt(e,t,i){const r=this.elements;return qa.subVectors(e,t),qa.lengthSq()===0&&(qa.z=1),qa.normalize(),dd.crossVectors(i,qa),dd.lengthSq()===0&&(Math.abs(i.z)===1?qa.x+=1e-4:qa.z+=1e-4,qa.normalize(),dd.crossVectors(i,qa)),dd.normalize(),Tb.crossVectors(qa,dd),r[0]=dd.x,r[4]=Tb.x,r[8]=qa.x,r[1]=dd.y,r[5]=Tb.y,r[9]=qa.y,r[2]=dd.z,r[6]=Tb.z,r[10]=qa.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,o=this.elements,c=i[0],s=i[4],f=i[8],p=i[12],g=i[1],_=i[5],x=i[9],b=i[13],M=i[2],P=i[6],k=i[10],L=i[14],I=i[3],F=i[7],N=i[11],H=i[15],Y=r[0],q=r[4],U=r[8],G=r[12],j=r[1],B=r[5],ne=r[9],J=r[13],le=r[2],ae=r[6],pe=r[10],fe=r[14],Te=r[3],Ce=r[7],tt=r[11],Ke=r[15];return o[0]=c*Y+s*j+f*le+p*Te,o[4]=c*q+s*B+f*ae+p*Ce,o[8]=c*U+s*ne+f*pe+p*tt,o[12]=c*G+s*J+f*fe+p*Ke,o[1]=g*Y+_*j+x*le+b*Te,o[5]=g*q+_*B+x*ae+b*Ce,o[9]=g*U+_*ne+x*pe+b*tt,o[13]=g*G+_*J+x*fe+b*Ke,o[2]=M*Y+P*j+k*le+L*Te,o[6]=M*q+P*B+k*ae+L*Ce,o[10]=M*U+P*ne+k*pe+L*tt,o[14]=M*G+P*J+k*fe+L*Ke,o[3]=I*Y+F*j+N*le+H*Te,o[7]=I*q+F*B+N*ae+H*Ce,o[11]=I*U+F*ne+N*pe+H*tt,o[15]=I*G+F*J+N*fe+H*Ke,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],o=e[12],c=e[1],s=e[5],f=e[9],p=e[13],g=e[2],_=e[6],x=e[10],b=e[14],M=e[3],P=e[7],k=e[11],L=e[15];return M*(+o*f*_-r*p*_-o*s*x+i*p*x+r*s*b-i*f*b)+P*(+t*f*b-t*p*x+o*c*x-r*c*b+r*p*g-o*f*g)+k*(+t*p*_-t*s*b-o*c*_+i*c*b+o*s*g-i*p*g)+L*(-r*s*g-t*f*_+t*s*x+r*c*_-i*c*x+i*f*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],o=e[3],c=e[4],s=e[5],f=e[6],p=e[7],g=e[8],_=e[9],x=e[10],b=e[11],M=e[12],P=e[13],k=e[14],L=e[15],I=_*k*p-P*x*p+P*f*b-s*k*b-_*f*L+s*x*L,F=M*x*p-g*k*p-M*f*b+c*k*b+g*f*L-c*x*L,N=g*P*p-M*_*p+M*s*b-c*P*b-g*s*L+c*_*L,H=M*_*f-g*P*f-M*s*x+c*P*x+g*s*k-c*_*k,Y=t*I+i*F+r*N+o*H;if(Y===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const q=1/Y;return e[0]=I*q,e[1]=(P*x*o-_*k*o-P*r*b+i*k*b+_*r*L-i*x*L)*q,e[2]=(s*k*o-P*f*o+P*r*p-i*k*p-s*r*L+i*f*L)*q,e[3]=(_*f*o-s*x*o-_*r*p+i*x*p+s*r*b-i*f*b)*q,e[4]=F*q,e[5]=(g*k*o-M*x*o+M*r*b-t*k*b-g*r*L+t*x*L)*q,e[6]=(M*f*o-c*k*o-M*r*p+t*k*p+c*r*L-t*f*L)*q,e[7]=(c*x*o-g*f*o+g*r*p-t*x*p-c*r*b+t*f*b)*q,e[8]=N*q,e[9]=(M*_*o-g*P*o-M*i*b+t*P*b+g*i*L-t*_*L)*q,e[10]=(c*P*o-M*s*o+M*i*p-t*P*p-c*i*L+t*s*L)*q,e[11]=(g*s*o-c*_*o-g*i*p+t*_*p+c*i*b-t*s*b)*q,e[12]=H*q,e[13]=(g*P*r-M*_*r+M*i*x-t*P*x-g*i*k+t*_*k)*q,e[14]=(M*s*r-c*P*r-M*i*f+t*P*f+c*i*k-t*s*k)*q,e[15]=(c*_*r-g*s*r+g*i*f-t*_*f-c*i*x+t*s*x)*q,this}scale(e){const t=this.elements,i=e.x,r=e.y,o=e.z;return t[0]*=i,t[4]*=r,t[8]*=o,t[1]*=i,t[5]*=r,t[9]*=o,t[2]*=i,t[6]*=r,t[10]*=o,t[3]*=i,t[7]*=r,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),o=1-i,c=e.x,s=e.y,f=e.z,p=o*c,g=o*s;return this.set(p*c+i,p*s-r*f,p*f+r*s,0,p*s+r*f,g*s+i,g*f-r*c,0,p*f-r*s,g*f+r*c,o*f*f+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,o,c){return this.set(1,i,o,0,e,1,c,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,o=t._x,c=t._y,s=t._z,f=t._w,p=o+o,g=c+c,_=s+s,x=o*p,b=o*g,M=o*_,P=c*g,k=c*_,L=s*_,I=f*p,F=f*g,N=f*_,H=i.x,Y=i.y,q=i.z;return r[0]=(1-(P+L))*H,r[1]=(b+N)*H,r[2]=(M-F)*H,r[3]=0,r[4]=(b-N)*Y,r[5]=(1-(x+L))*Y,r[6]=(k+I)*Y,r[7]=0,r[8]=(M+F)*q,r[9]=(k-I)*q,r[10]=(1-(x+P))*q,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let o=$m.set(r[0],r[1],r[2]).length();const c=$m.set(r[4],r[5],r[6]).length(),s=$m.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],fc.copy(this);const p=1/o,g=1/c,_=1/s;return fc.elements[0]*=p,fc.elements[1]*=p,fc.elements[2]*=p,fc.elements[4]*=g,fc.elements[5]*=g,fc.elements[6]*=g,fc.elements[8]*=_,fc.elements[9]*=_,fc.elements[10]*=_,t.setFromRotationMatrix(fc),i.x=o,i.y=c,i.z=s,this}makePerspective(e,t,i,r,o,c){c===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,f=2*o/(t-e),p=2*o/(i-r),g=(t+e)/(t-e),_=(i+r)/(i-r),x=-(c+o)/(c-o),b=-2*c*o/(c-o);return s[0]=f,s[4]=0,s[8]=g,s[12]=0,s[1]=0,s[5]=p,s[9]=_,s[13]=0,s[2]=0,s[6]=0,s[10]=x,s[14]=b,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,i,r,o,c){const s=this.elements,f=1/(t-e),p=1/(i-r),g=1/(c-o),_=(t+e)*f,x=(i+r)*p,b=(c+o)*g;return s[0]=2*f,s[4]=0,s[8]=0,s[12]=-_,s[1]=0,s[5]=2*p,s[9]=0,s[13]=-x,s[2]=0,s[6]=0,s[10]=-2*g,s[14]=-b,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Ri.prototype.isMatrix4=!0;const $m=new Fe,fc=new Ri,Bq=new Fe(0,0,0),Nq=new Fe(1,1,1),dd=new Fe,Tb=new Fe,qa=new Fe,MI=new Ri,CI=new go;class wp{constructor(e=0,t=0,i=0,r=wp.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,o=r[0],c=r[4],s=r[8],f=r[1],p=r[5],g=r[9],_=r[2],x=r[6],b=r[10];switch(t){case"XYZ":this._y=Math.asin(ga(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-g,b),this._z=Math.atan2(-c,o)):(this._x=Math.atan2(x,p),this._z=0);break;case"YXZ":this._x=Math.asin(-ga(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(s,b),this._z=Math.atan2(f,p)):(this._y=Math.atan2(-_,o),this._z=0);break;case"ZXY":this._x=Math.asin(ga(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-_,b),this._z=Math.atan2(-c,p)):(this._y=0,this._z=Math.atan2(f,o));break;case"ZYX":this._y=Math.asin(-ga(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(x,b),this._z=Math.atan2(f,o)):(this._x=0,this._z=Math.atan2(-c,p));break;case"YZX":this._z=Math.asin(ga(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-g,p),this._y=Math.atan2(-_,o)):(this._x=0,this._y=Math.atan2(s,b));break;case"XZY":this._z=Math.asin(-ga(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(x,p),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-g,b),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return MI.makeRotationFromQuaternion(e),this.setFromRotationMatrix(MI,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return CI.setFromEuler(this),this.setFromQuaternion(CI,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Fe(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}wp.prototype.isEuler=!0;wp.DefaultOrder="XYZ";wp.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class gF{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}}let $q=0;const EI=new Fe,Vm=new go,th=new Ri,Mb=new Fe,mv=new Fe,Vq=new Fe,Uq=new go,AI=new Fe(1,0,0),PI=new Fe(0,1,0),II=new Fe(0,0,1),jq={type:"added"},LI={type:"removed"};class Rn extends bp{constructor(){super(),Object.defineProperty(this,"id",{value:$q++}),this.uuid=bc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Rn.DefaultUp.clone();const e=new Fe,t=new wp,i=new go,r=new Fe(1,1,1);function o(){i.setFromEuler(t,!1)}function c(){t.setFromQuaternion(i,void 0,!1)}t._onChange(o),i._onChange(c),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ri},normalMatrix:{value:new mo}}),this.matrix=new Ri,this.matrixWorld=new Ri,this.matrixAutoUpdate=Rn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new gF,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Vm.setFromAxisAngle(e,t),this.quaternion.multiply(Vm),this}rotateOnWorldAxis(e,t){return Vm.setFromAxisAngle(e,t),this.quaternion.premultiply(Vm),this}rotateX(e){return this.rotateOnAxis(AI,e)}rotateY(e){return this.rotateOnAxis(PI,e)}rotateZ(e){return this.rotateOnAxis(II,e)}translateOnAxis(e,t){return EI.copy(e).applyQuaternion(this.quaternion),this.position.add(EI.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(AI,e)}translateY(e){return this.translateOnAxis(PI,e)}translateZ(e){return this.translateOnAxis(II,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(th.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Mb.copy(e):Mb.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),mv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?th.lookAt(mv,Mb,this.up):th.lookAt(Mb,mv,this.up),this.quaternion.setFromRotationMatrix(th),r&&(th.extractRotation(r.matrixWorld),Vm.setFromRotationMatrix(th),this.quaternion.premultiply(Vm.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(jq)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(LI)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(LI)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),th.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),th.multiply(e.parent.matrixWorld)),e.applyMatrix4(th),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const c=this.children[i].getObjectByProperty(e,t);if(c!==void 0)return c}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mv,e,Vq),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mv,Uq,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let o=0,c=r.length;o<c;o++)r[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function o(s,f){return s[f.uuid]===void 0&&(s[f.uuid]=f.toJSON(e)),f.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=o(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const f=s.shapes;if(Array.isArray(f))for(let p=0,g=f.length;p<g;p++){const _=f[p];o(e.shapes,_)}else o(e.shapes,f)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let f=0,p=this.material.length;f<p;f++)s.push(o(e.materials,this.material[f]));r.material=s}else r.material=o(e.materials,this.material);if(this.children.length>0){r.children=[];for(let s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let s=0;s<this.animations.length;s++){const f=this.animations[s];r.animations.push(o(e.animations,f))}}if(t){const s=c(e.geometries),f=c(e.materials),p=c(e.textures),g=c(e.images),_=c(e.shapes),x=c(e.skeletons),b=c(e.animations);s.length>0&&(i.geometries=s),f.length>0&&(i.materials=f),p.length>0&&(i.textures=p),g.length>0&&(i.images=g),_.length>0&&(i.shapes=_),x.length>0&&(i.skeletons=x),b.length>0&&(i.animations=b)}return i.object=r,i;function c(s){const f=[];for(const p in s){const g=s[p];delete g.metadata,f.push(g)}return f}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Rn.DefaultUp=new Fe(0,1,0);Rn.DefaultMatrixAutoUpdate=!0;Rn.prototype.isObject3D=!0;const pc=new Fe,ih=new Fe,jS=new Fe,nh=new Fe,Um=new Fe,jm=new Fe,RI=new Fe,GS=new Fe,qS=new Fe,HS=new Fe;class Zs{constructor(e=new Fe,t=new Fe,i=new Fe){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),pc.subVectors(e,t),r.cross(pc);const o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}static getBarycoord(e,t,i,r,o){pc.subVectors(r,t),ih.subVectors(i,t),jS.subVectors(e,t);const c=pc.dot(pc),s=pc.dot(ih),f=pc.dot(jS),p=ih.dot(ih),g=ih.dot(jS),_=c*p-s*s;if(_===0)return o.set(-2,-1,-1);const x=1/_,b=(p*f-s*g)*x,M=(c*g-s*f)*x;return o.set(1-b-M,M,b)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,nh),nh.x>=0&&nh.y>=0&&nh.x+nh.y<=1}static getUV(e,t,i,r,o,c,s,f){return this.getBarycoord(e,t,i,r,nh),f.set(0,0),f.addScaledVector(o,nh.x),f.addScaledVector(c,nh.y),f.addScaledVector(s,nh.z),f}static isFrontFacing(e,t,i,r){return pc.subVectors(i,t),ih.subVectors(e,t),pc.cross(ih).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pc.subVectors(this.c,this.b),ih.subVectors(this.a,this.b),pc.cross(ih).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Zs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Zs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,o){return Zs.getUV(e,this.a,this.b,this.c,t,i,r,o)}containsPoint(e){return Zs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Zs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,o=this.c;let c,s;Um.subVectors(r,i),jm.subVectors(o,i),GS.subVectors(e,i);const f=Um.dot(GS),p=jm.dot(GS);if(f<=0&&p<=0)return t.copy(i);qS.subVectors(e,r);const g=Um.dot(qS),_=jm.dot(qS);if(g>=0&&_<=g)return t.copy(r);const x=f*_-g*p;if(x<=0&&f>=0&&g<=0)return c=f/(f-g),t.copy(i).addScaledVector(Um,c);HS.subVectors(e,o);const b=Um.dot(HS),M=jm.dot(HS);if(M>=0&&b<=M)return t.copy(o);const P=b*p-f*M;if(P<=0&&p>=0&&M<=0)return s=p/(p-M),t.copy(i).addScaledVector(jm,s);const k=g*M-b*_;if(k<=0&&_-g>=0&&b-M>=0)return RI.subVectors(o,r),s=(_-g)/(_-g+(b-M)),t.copy(r).addScaledVector(RI,s);const L=1/(k+P+x);return c=P*L,s=x*L,t.copy(i).addScaledVector(Um,c).addScaledVector(jm,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Gq=0;class Bo extends bp{constructor(){super(),Object.defineProperty(this,"id",{value:Gq++}),this.uuid=bc(),this.name="",this.type="Material",this.fog=!0,this.blending=ey,this.side=zg,this.vertexColors=!1,this.opacity=1,this.format=oa,this.transparent=!1,this.blendSrc=oF,this.blendDst=aF,this.blendEquation=lg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=hM,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=yq,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kS,this.stencilZFail=kS,this.stencilZPass=kS,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===sF;continue}const r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ey&&(i.blending=this.blending),this.side!==zg&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==oa&&(i.format=this.format),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function r(o){const c=[];for(const s in o){const f=o[s];delete f.metadata,c.push(f)}return c}if(t){const o=r(e.textures),c=r(e.images);o.length>0&&(i.textures=o),c.length>0&&(i.images=c)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let o=0;o!==r;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}Bo.prototype.isMaterial=!0;const _F={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},mc={h:0,s:0,l:0},Cb={h:0,s:0,l:0};function WS(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}function ZS(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function XS(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}class Bi{constructor(e,t,i){return t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=O2(e,1),t=ga(t,0,1),i=ga(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=WS(o,r,e+1/3),this.g=WS(o,r,e),this.b=WS(o,r,e-1/3)}return this}setStyle(e){function t(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],c=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c)){const s=parseFloat(r[1])/360,f=parseInt(r[2],10)/100,p=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(s,f,p)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=_F[e.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=ZS(e.r),this.g=ZS(e.g),this.b=ZS(e.b),this}copyLinearToSRGB(e){return this.r=XS(e.r),this.g=XS(e.g),this.b=XS(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,i=this.g,r=this.b,o=Math.max(t,i,r),c=Math.min(t,i,r);let s,f;const p=(c+o)/2;if(c===o)s=0,f=0;else{const g=o-c;switch(f=p<=.5?g/(o+c):g/(2-o-c),o){case t:s=(i-r)/g+(i<r?6:0);break;case i:s=(r-t)/g+2;break;case r:s=(t-i)/g+4;break}s/=6}return e.h=s,e.s=f,e.l=p,e}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(e,t,i){return this.getHSL(mc),mc.h+=e,mc.s+=t,mc.l+=i,this.setHSL(mc.h,mc.s,mc.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(mc),e.getHSL(Cb);const i=ny(mc.h,Cb.h,t),r=ny(mc.s,Cb.s,t),o=ny(mc.l,Cb.l,t);return this.setHSL(i,r,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Bi.NAMES=_F;Bi.prototype.isColor=!0;Bi.prototype.r=1;Bi.prototype.g=1;Bi.prototype.b=1;class e0 extends Bo{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=kw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}e0.prototype.isMeshBasicMaterial=!0;const Rr=new Fe,Eb=new li;class Mn{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=Ty,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let c=e[r];c===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),c=new Bi),t[i++]=c.r,t[i++]=c.g,t[i++]=c.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let c=e[r];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),c=new li),t[i++]=c.x,t[i++]=c.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let c=e[r];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),c=new Fe),t[i++]=c.x,t[i++]=c.y,t[i++]=c.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let r=0,o=e.length;r<o;r++){let c=e[r];c===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),c=new Zn),t[i++]=c.x,t[i++]=c.y,t[i++]=c.z,t[i++]=c.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Eb.fromBufferAttribute(this,t),Eb.applyMatrix3(e),this.setXY(t,Eb.x,Eb.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Rr.fromBufferAttribute(this,t),Rr.applyMatrix3(e),this.setXYZ(t,Rr.x,Rr.y,Rr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Rr.x=this.getX(t),Rr.y=this.getY(t),Rr.z=this.getZ(t),Rr.applyMatrix4(e),this.setXYZ(t,Rr.x,Rr.y,Rr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Rr.x=this.getX(t),Rr.y=this.getY(t),Rr.z=this.getZ(t),Rr.applyNormalMatrix(e),this.setXYZ(t,Rr.x,Rr.y,Rr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Rr.x=this.getX(t),Rr.y=this.getY(t),Rr.z=this.getZ(t),Rr.transformDirection(e),this.setXYZ(t,Rr.x,Rr.y,Rr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Ty&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}Mn.prototype.isBufferAttribute=!0;class vF extends Mn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class yF extends Mn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class qq extends Mn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}qq.prototype.isFloat16BufferAttribute=!0;class ws extends Mn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Hq=0;const Ml=new Ri,YS=new Rn,Gm=new Fe,Ha=new cl,gv=new cl,io=new Fe;class $n extends bp{constructor(){super(),Object.defineProperty(this,"id",{value:Hq++}),this.uuid=bc(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(pF(e)>65535?yF:vF)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const o=new mo().getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ml.makeRotationFromQuaternion(e),this.applyMatrix4(Ml),this}rotateX(e){return Ml.makeRotationX(e),this.applyMatrix4(Ml),this}rotateY(e){return Ml.makeRotationY(e),this.applyMatrix4(Ml),this}rotateZ(e){return Ml.makeRotationZ(e),this.applyMatrix4(Ml),this}translate(e,t,i){return Ml.makeTranslation(e,t,i),this.applyMatrix4(Ml),this}scale(e,t,i){return Ml.makeScale(e,t,i),this.applyMatrix4(Ml),this}lookAt(e){return YS.lookAt(e),YS.updateMatrix(),this.applyMatrix4(YS.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Gm).negate(),this.translate(Gm.x,Gm.y,Gm.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new ws(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new cl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Fe(-1/0,-1/0,-1/0),new Fe(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const o=t[i];Ha.setFromBufferAttribute(o),this.morphTargetsRelative?(io.addVectors(this.boundingBox.min,Ha.min),this.boundingBox.expandByPoint(io),io.addVectors(this.boundingBox.max,Ha.max),this.boundingBox.expandByPoint(io)):(this.boundingBox.expandByPoint(Ha.min),this.boundingBox.expandByPoint(Ha.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new t_);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Fe,1/0);return}if(e){const i=this.boundingSphere.center;if(Ha.setFromBufferAttribute(e),t)for(let o=0,c=t.length;o<c;o++){const s=t[o];gv.setFromBufferAttribute(s),this.morphTargetsRelative?(io.addVectors(Ha.min,gv.min),Ha.expandByPoint(io),io.addVectors(Ha.max,gv.max),Ha.expandByPoint(io)):(Ha.expandByPoint(gv.min),Ha.expandByPoint(gv.max))}Ha.getCenter(i);let r=0;for(let o=0,c=e.count;o<c;o++)io.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(io));if(t)for(let o=0,c=t.length;o<c;o++){const s=t[o],f=this.morphTargetsRelative;for(let p=0,g=s.count;p<g;p++)io.fromBufferAttribute(s,p),f&&(Gm.fromBufferAttribute(e,p),io.add(Gm)),r=Math.max(r,i.distanceToSquared(io))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,r=t.position.array,o=t.normal.array,c=t.uv.array,s=r.length/3;t.tangent===void 0&&this.setAttribute("tangent",new Mn(new Float32Array(4*s),4));const f=t.tangent.array,p=[],g=[];for(let j=0;j<s;j++)p[j]=new Fe,g[j]=new Fe;const _=new Fe,x=new Fe,b=new Fe,M=new li,P=new li,k=new li,L=new Fe,I=new Fe;function F(j,B,ne){_.fromArray(r,j*3),x.fromArray(r,B*3),b.fromArray(r,ne*3),M.fromArray(c,j*2),P.fromArray(c,B*2),k.fromArray(c,ne*2),x.sub(_),b.sub(_),P.sub(M),k.sub(M);const J=1/(P.x*k.y-k.x*P.y);isFinite(J)&&(L.copy(x).multiplyScalar(k.y).addScaledVector(b,-P.y).multiplyScalar(J),I.copy(b).multiplyScalar(P.x).addScaledVector(x,-k.x).multiplyScalar(J),p[j].add(L),p[B].add(L),p[ne].add(L),g[j].add(I),g[B].add(I),g[ne].add(I))}let N=this.groups;N.length===0&&(N=[{start:0,count:i.length}]);for(let j=0,B=N.length;j<B;++j){const ne=N[j],J=ne.start,le=ne.count;for(let ae=J,pe=J+le;ae<pe;ae+=3)F(i[ae+0],i[ae+1],i[ae+2])}const H=new Fe,Y=new Fe,q=new Fe,U=new Fe;function G(j){q.fromArray(o,j*3),U.copy(q);const B=p[j];H.copy(B),H.sub(q.multiplyScalar(q.dot(B))).normalize(),Y.crossVectors(U,B);const J=Y.dot(g[j])<0?-1:1;f[j*4]=H.x,f[j*4+1]=H.y,f[j*4+2]=H.z,f[j*4+3]=J}for(let j=0,B=N.length;j<B;++j){const ne=N[j],J=ne.start,le=ne.count;for(let ae=J,pe=J+le;ae<pe;ae+=3)G(i[ae+0]),G(i[ae+1]),G(i[ae+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Mn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let x=0,b=i.count;x<b;x++)i.setXYZ(x,0,0,0);const r=new Fe,o=new Fe,c=new Fe,s=new Fe,f=new Fe,p=new Fe,g=new Fe,_=new Fe;if(e)for(let x=0,b=e.count;x<b;x+=3){const M=e.getX(x+0),P=e.getX(x+1),k=e.getX(x+2);r.fromBufferAttribute(t,M),o.fromBufferAttribute(t,P),c.fromBufferAttribute(t,k),g.subVectors(c,o),_.subVectors(r,o),g.cross(_),s.fromBufferAttribute(i,M),f.fromBufferAttribute(i,P),p.fromBufferAttribute(i,k),s.add(g),f.add(g),p.add(g),i.setXYZ(M,s.x,s.y,s.z),i.setXYZ(P,f.x,f.y,f.z),i.setXYZ(k,p.x,p.y,p.z)}else for(let x=0,b=t.count;x<b;x+=3)r.fromBufferAttribute(t,x+0),o.fromBufferAttribute(t,x+1),c.fromBufferAttribute(t,x+2),g.subVectors(c,o),_.subVectors(r,o),g.cross(_),i.setXYZ(x+0,g.x,g.y,g.z),i.setXYZ(x+1,g.x,g.y,g.z),i.setXYZ(x+2,g.x,g.y,g.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const r in i){if(e.attributes[r]===void 0)continue;const c=i[r].array,s=e.attributes[r],f=s.array,p=s.itemSize*t,g=Math.min(f.length,c.length-p);for(let _=0,x=p;_<g;_++,x++)c[x]=f[_]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)io.fromBufferAttribute(e,t),io.normalize(),e.setXYZ(t,io.x,io.y,io.z)}toNonIndexed(){function e(s,f){const p=s.array,g=s.itemSize,_=s.normalized,x=new p.constructor(f.length*g);let b=0,M=0;for(let P=0,k=f.length;P<k;P++){s.isInterleavedBufferAttribute?b=f[P]*s.data.stride+s.offset:b=f[P]*g;for(let L=0;L<g;L++)x[M++]=p[b++]}return new Mn(x,g,_)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new $n,i=this.index.array,r=this.attributes;for(const s in r){const f=r[s],p=e(f,i);t.setAttribute(s,p)}const o=this.morphAttributes;for(const s in o){const f=[],p=o[s];for(let g=0,_=p.length;g<_;g++){const x=p[g],b=e(x,i);f.push(b)}t.morphAttributes[s]=f}t.morphTargetsRelative=this.morphTargetsRelative;const c=this.groups;for(let s=0,f=c.length;s<f;s++){const p=c[s];t.addGroup(p.start,p.count,p.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const f=this.parameters;for(const p in f)f[p]!==void 0&&(e[p]=f[p]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const f in i){const p=i[f];e.data.attributes[f]=p.toJSON(e.data)}const r={};let o=!1;for(const f in this.morphAttributes){const p=this.morphAttributes[f],g=[];for(let _=0,x=p.length;_<x;_++){const b=p[_];g.push(b.toJSON(e.data))}g.length>0&&(r[f]=g,o=!0)}o&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const c=this.groups;c.length>0&&(e.data.groups=JSON.parse(JSON.stringify(c)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const p in r){const g=r[p];this.setAttribute(p,g.clone(t))}const o=e.morphAttributes;for(const p in o){const g=[],_=o[p];for(let x=0,b=_.length;x<b;x++)g.push(_[x].clone(t));this.morphAttributes[p]=g}this.morphTargetsRelative=e.morphTargetsRelative;const c=e.groups;for(let p=0,g=c.length;p<g;p++){const _=c[p];this.addGroup(_.start,_.count,_.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const f=e.boundingSphere;return f!==null&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}$n.prototype.isBufferGeometry=!0;const kI=new Ri,qm=new xp,KS=new t_,fd=new Fe,pd=new Fe,md=new Fe,JS=new Fe,QS=new Fe,eT=new Fe,Ab=new Fe,Pb=new Fe,Ib=new Fe,Lb=new li,Rb=new li,kb=new li,tT=new Fe,Db=new Fe;class kr extends Rn{constructor(e=new $n,t=new e0){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,r=this.material,o=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),KS.copy(i.boundingSphere),KS.applyMatrix4(o),e.ray.intersectsSphere(KS)===!1)||(kI.copy(o).invert(),qm.copy(e.ray).applyMatrix4(kI),i.boundingBox!==null&&qm.intersectsBox(i.boundingBox)===!1))return;let c;if(i.isBufferGeometry){const s=i.index,f=i.attributes.position,p=i.morphAttributes.position,g=i.morphTargetsRelative,_=i.attributes.uv,x=i.attributes.uv2,b=i.groups,M=i.drawRange;if(s!==null)if(Array.isArray(r))for(let P=0,k=b.length;P<k;P++){const L=b[P],I=r[L.materialIndex],F=Math.max(L.start,M.start),N=Math.min(s.count,Math.min(L.start+L.count,M.start+M.count));for(let H=F,Y=N;H<Y;H+=3){const q=s.getX(H),U=s.getX(H+1),G=s.getX(H+2);c=Fb(this,I,e,qm,f,p,g,_,x,q,U,G),c&&(c.faceIndex=Math.floor(H/3),c.face.materialIndex=L.materialIndex,t.push(c))}}else{const P=Math.max(0,M.start),k=Math.min(s.count,M.start+M.count);for(let L=P,I=k;L<I;L+=3){const F=s.getX(L),N=s.getX(L+1),H=s.getX(L+2);c=Fb(this,r,e,qm,f,p,g,_,x,F,N,H),c&&(c.faceIndex=Math.floor(L/3),t.push(c))}}else if(f!==void 0)if(Array.isArray(r))for(let P=0,k=b.length;P<k;P++){const L=b[P],I=r[L.materialIndex],F=Math.max(L.start,M.start),N=Math.min(f.count,Math.min(L.start+L.count,M.start+M.count));for(let H=F,Y=N;H<Y;H+=3){const q=H,U=H+1,G=H+2;c=Fb(this,I,e,qm,f,p,g,_,x,q,U,G),c&&(c.faceIndex=Math.floor(H/3),c.face.materialIndex=L.materialIndex,t.push(c))}}else{const P=Math.max(0,M.start),k=Math.min(f.count,M.start+M.count);for(let L=P,I=k;L<I;L+=3){const F=L,N=L+1,H=L+2;c=Fb(this,r,e,qm,f,p,g,_,x,F,N,H),c&&(c.faceIndex=Math.floor(L/3),t.push(c))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}kr.prototype.isMesh=!0;function Wq(n,e,t,i,r,o,c,s){let f;if(e.side===Gs?f=i.intersectTriangle(c,o,r,!0,s):f=i.intersectTriangle(r,o,c,e.side!==Ko,s),f===null)return null;Db.copy(s),Db.applyMatrix4(n.matrixWorld);const p=t.ray.origin.distanceTo(Db);return p<t.near||p>t.far?null:{distance:p,point:Db.clone(),object:n}}function Fb(n,e,t,i,r,o,c,s,f,p,g,_){fd.fromBufferAttribute(r,p),pd.fromBufferAttribute(r,g),md.fromBufferAttribute(r,_);const x=n.morphTargetInfluences;if(o&&x){Ab.set(0,0,0),Pb.set(0,0,0),Ib.set(0,0,0);for(let M=0,P=o.length;M<P;M++){const k=x[M],L=o[M];k!==0&&(JS.fromBufferAttribute(L,p),QS.fromBufferAttribute(L,g),eT.fromBufferAttribute(L,_),c?(Ab.addScaledVector(JS,k),Pb.addScaledVector(QS,k),Ib.addScaledVector(eT,k)):(Ab.addScaledVector(JS.sub(fd),k),Pb.addScaledVector(QS.sub(pd),k),Ib.addScaledVector(eT.sub(md),k)))}fd.add(Ab),pd.add(Pb),md.add(Ib)}n.isSkinnedMesh&&(n.boneTransform(p,fd),n.boneTransform(g,pd),n.boneTransform(_,md));const b=Wq(n,e,t,i,fd,pd,md,tT);if(b){s&&(Lb.fromBufferAttribute(s,p),Rb.fromBufferAttribute(s,g),kb.fromBufferAttribute(s,_),b.uv=Zs.getUV(tT,fd,pd,md,Lb,Rb,kb,new li)),f&&(Lb.fromBufferAttribute(f,p),Rb.fromBufferAttribute(f,g),kb.fromBufferAttribute(f,_),b.uv2=Zs.getUV(tT,fd,pd,md,Lb,Rb,kb,new li));const M={a:p,b:g,c:_,normal:new Fe,materialIndex:0};Zs.getNormal(fd,pd,md,M.normal),b.face=M}return b}class t0 extends $n{constructor(e=1,t=1,i=1,r=1,o=1,c=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:o,depthSegments:c};const s=this;r=Math.floor(r),o=Math.floor(o),c=Math.floor(c);const f=[],p=[],g=[],_=[];let x=0,b=0;M("z","y","x",-1,-1,i,t,e,c,o,0),M("z","y","x",1,-1,i,t,-e,c,o,1),M("x","z","y",1,1,e,i,t,r,c,2),M("x","z","y",1,-1,e,i,-t,r,c,3),M("x","y","z",1,-1,e,t,i,r,o,4),M("x","y","z",-1,-1,e,t,-i,r,o,5),this.setIndex(f),this.setAttribute("position",new ws(p,3)),this.setAttribute("normal",new ws(g,3)),this.setAttribute("uv",new ws(_,2));function M(P,k,L,I,F,N,H,Y,q,U,G){const j=N/q,B=H/U,ne=N/2,J=H/2,le=Y/2,ae=q+1,pe=U+1;let fe=0,Te=0;const Ce=new Fe;for(let tt=0;tt<pe;tt++){const Ke=tt*B-J;for(let dt=0;dt<ae;dt++){const et=dt*j-ne;Ce[P]=et*I,Ce[k]=Ke*F,Ce[L]=le,p.push(Ce.x,Ce.y,Ce.z),Ce[P]=0,Ce[k]=0,Ce[L]=Y>0?1:-1,g.push(Ce.x,Ce.y,Ce.z),_.push(dt/q),_.push(1-tt/U),fe+=1}}for(let tt=0;tt<U;tt++)for(let Ke=0;Ke<q;Ke++){const dt=x+Ke+ae*tt,et=x+Ke+ae*(tt+1),Oe=x+(Ke+1)+ae*(tt+1),lt=x+(Ke+1)+ae*tt;f.push(dt,et,lt),f.push(et,Oe,lt),Te+=6}s.addGroup(b,Te,G),b+=Te,x+=fe}}static fromJSON(e){return new t0(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ng(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function Eo(n){const e={};for(let t=0;t<n.length;t++){const i=Ng(n[t]);for(const r in i)e[r]=i[r]}return e}const Zq={clone:Ng,merge:Eo};var Xq=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Yq=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Jo extends Bo{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Xq,this.fragmentShader=Yq,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ng(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const c=this.uniforms[r].value;c&&c.isTexture?t.uniforms[r]={type:"t",value:c.toJSON(e).uuid}:c&&c.isColor?t.uniforms[r]={type:"c",value:c.getHex()}:c&&c.isVector2?t.uniforms[r]={type:"v2",value:c.toArray()}:c&&c.isVector3?t.uniforms[r]={type:"v3",value:c.toArray()}:c&&c.isVector4?t.uniforms[r]={type:"v4",value:c.toArray()}:c&&c.isMatrix3?t.uniforms[r]={type:"m3",value:c.toArray()}:c&&c.isMatrix4?t.uniforms[r]={type:"m4",value:c.toArray()}:t.uniforms[r]={value:c}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}Jo.prototype.isShaderMaterial=!0;class i0 extends Rn{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Ri,this.projectionMatrix=new Ri,this.projectionMatrixInverse=new Ri}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}i0.prototype.isCamera=!0;class ea extends i0{constructor(e=50,t=1,i=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=My*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(iy*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return My*2*Math.atan(Math.tan(iy*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,o,c){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(iy*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,o=-.5*r;const c=this.view;if(this.view!==null&&this.view.enabled){const f=c.fullWidth,p=c.fullHeight;o+=c.offsetX*r/f,t-=c.offsetY*i/p,r*=c.width/f,i*=c.height/p}const s=this.filmOffset;s!==0&&(o+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}ea.prototype.isPerspectiveCamera=!0;const Hm=90,Wm=1;class z2 extends Rn{constructor(e,t,i){if(super(),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const r=new ea(Hm,Wm,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Fe(1,0,0)),this.add(r);const o=new ea(Hm,Wm,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Fe(-1,0,0)),this.add(o);const c=new ea(Hm,Wm,e,t);c.layers=this.layers,c.up.set(0,0,1),c.lookAt(new Fe(0,1,0)),this.add(c);const s=new ea(Hm,Wm,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Fe(0,-1,0)),this.add(s);const f=new ea(Hm,Wm,e,t);f.layers=this.layers,f.up.set(0,-1,0),f.lookAt(new Fe(0,0,1)),this.add(f);const p=new ea(Hm,Wm,e,t);p.layers=this.layers,p.up.set(0,-1,0),p.lookAt(new Fe(0,0,-1)),this.add(p)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[r,o,c,s,f,p]=this.children,g=e.xr.enabled,_=e.getRenderTarget();e.xr.enabled=!1;const x=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,o),e.setRenderTarget(i,2),e.render(t,c),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,f),i.texture.generateMipmaps=x,e.setRenderTarget(i,5),e.render(t,p),e.setRenderTarget(_),e.xr.enabled=g}}class zw extends zs{constructor(e,t,i,r,o,c,s,f,p,g){e=e!==void 0?e:[],t=t!==void 0?t:Jy,super(e,t,i,r,o,c,s,f,p,g),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}zw.prototype.isCubeTexture=!0;class bF extends xc{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new zw(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ro,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=oa,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new t0(5,5,5),o=new Jo({name:"CubemapFromEquirect",uniforms:Ng(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Gs,blending:Ed});o.uniforms.tEquirect.value=t;const c=new kr(r,o),s=t.minFilter;return t.minFilter===Fw&&(t.minFilter=Ro),new z2(1,10,this).update(e,c),t.minFilter=s,c.geometry.dispose(),c.material.dispose(),this}clear(e,t,i,r){const o=e.getRenderTarget();for(let c=0;c<6;c++)e.setRenderTarget(this,c),e.clear(t,i,r);e.setRenderTarget(o)}}bF.prototype.isWebGLCubeRenderTarget=!0;const iT=new Fe,Kq=new Fe,Jq=new mo;class ch{constructor(e=new Fe(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=iT.subVectors(i,t).cross(Kq.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(iT),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/r;return o<0||o>1?null:t.copy(i).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Jq.getNormalMatrix(e),r=this.coplanarPoint(iT).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}ch.prototype.isPlane=!0;const Zm=new t_,Ob=new Fe;class Bw{constructor(e=new ch,t=new ch,i=new ch,r=new ch,o=new ch,c=new ch){this.planes=[e,t,i,r,o,c]}set(e,t,i,r,o,c){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(r),s[4].copy(o),s[5].copy(c),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],o=i[1],c=i[2],s=i[3],f=i[4],p=i[5],g=i[6],_=i[7],x=i[8],b=i[9],M=i[10],P=i[11],k=i[12],L=i[13],I=i[14],F=i[15];return t[0].setComponents(s-r,_-f,P-x,F-k).normalize(),t[1].setComponents(s+r,_+f,P+x,F+k).normalize(),t[2].setComponents(s+o,_+p,P+b,F+L).normalize(),t[3].setComponents(s-o,_-p,P-b,F-L).normalize(),t[4].setComponents(s-c,_-g,P-M,F-I).normalize(),t[5].setComponents(s+c,_+g,P+M,F+I).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Zm.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Zm)}intersectsSprite(e){return Zm.center.set(0,0,0),Zm.radius=.7071067811865476,Zm.applyMatrix4(e.matrixWorld),this.intersectsSphere(Zm)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(Ob.x=r.normal.x>0?e.max.x:e.min.x,Ob.y=r.normal.y>0?e.max.y:e.min.y,Ob.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Ob)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function xF(){let n=null,e=!1,t=null,i=null;function r(o,c){t(o,c),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function Qq(n,e){const t=e.isWebGL2,i=new WeakMap;function r(p,g){const _=p.array,x=p.usage,b=n.createBuffer();n.bindBuffer(g,b),n.bufferData(g,_,x),p.onUploadCallback();let M=5126;return _ instanceof Float32Array?M=5126:_ instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):_ instanceof Uint16Array?p.isFloat16BufferAttribute?t?M=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):M=5123:_ instanceof Int16Array?M=5122:_ instanceof Uint32Array?M=5125:_ instanceof Int32Array?M=5124:_ instanceof Int8Array?M=5120:(_ instanceof Uint8Array||_ instanceof Uint8ClampedArray)&&(M=5121),{buffer:b,type:M,bytesPerElement:_.BYTES_PER_ELEMENT,version:p.version}}function o(p,g,_){const x=g.array,b=g.updateRange;n.bindBuffer(_,p),b.count===-1?n.bufferSubData(_,0,x):(t?n.bufferSubData(_,b.offset*x.BYTES_PER_ELEMENT,x,b.offset,b.count):n.bufferSubData(_,b.offset*x.BYTES_PER_ELEMENT,x.subarray(b.offset,b.offset+b.count)),b.count=-1)}function c(p){return p.isInterleavedBufferAttribute&&(p=p.data),i.get(p)}function s(p){p.isInterleavedBufferAttribute&&(p=p.data);const g=i.get(p);g&&(n.deleteBuffer(g.buffer),i.delete(p))}function f(p,g){if(p.isGLBufferAttribute){const x=i.get(p);(!x||x.version<p.version)&&i.set(p,{buffer:p.buffer,type:p.type,bytesPerElement:p.elementSize,version:p.version});return}p.isInterleavedBufferAttribute&&(p=p.data);const _=i.get(p);_===void 0?i.set(p,r(p,g)):_.version<p.version&&(o(_.buffer,p,g),_.version=p.version)}return{get:c,remove:s,update:f}}class Nw extends $n{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const o=e/2,c=t/2,s=Math.floor(i),f=Math.floor(r),p=s+1,g=f+1,_=e/s,x=t/f,b=[],M=[],P=[],k=[];for(let L=0;L<g;L++){const I=L*x-c;for(let F=0;F<p;F++){const N=F*_-o;M.push(N,-I,0),P.push(0,0,1),k.push(F/s),k.push(1-L/f)}}for(let L=0;L<f;L++)for(let I=0;I<s;I++){const F=I+p*L,N=I+p*(L+1),H=I+1+p*(L+1),Y=I+1+p*L;b.push(F,N,Y),b.push(N,H,Y)}this.setIndex(b),this.setAttribute("position",new ws(M,3)),this.setAttribute("normal",new ws(P,3)),this.setAttribute("uv",new ws(k,2))}static fromJSON(e){return new Nw(e.width,e.height,e.widthSegments,e.heightSegments)}}var eH=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,tH=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,iH=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,nH=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,rH=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,sH=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,oH="vec3 transformed = vec3( position );",aH=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,lH=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,cH=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,uH=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,hH=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,dH=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fH=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,pH=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,mH=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,gH=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,_H=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,vH=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,yH=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bH=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,xH=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,wH=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,SH=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,TH=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,MH="gl_FragColor = linearToOutputTexel( gl_FragColor );",CH=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,EH=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,AH=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,PH=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,IH=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,LH=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,RH=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,kH=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,DH=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,FH=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,OH=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,zH=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,BH=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,NH=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,$H=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,VH=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,UH=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,jH=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,GH=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,qH=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,HH=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,WH=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ZH=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,XH=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,YH=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,KH=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,JH=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,QH=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,eW=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,tW=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,iW=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,nW=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,rW=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,sW=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,oW=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,aW=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,lW=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform vec2 morphTargetsTextureSize;
		vec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {
			float texelIndex = float( vertexIndex * stride + offset );
			float y = floor( texelIndex / morphTargetsTextureSize.x );
			float x = texelIndex - y * morphTargetsTextureSize.x;
			vec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );
			return texture( morphTargetsTexture, morphUV ).xyz;
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,cW=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			#ifndef USE_MORPHNORMALS
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];
			#else
				if ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];
			#endif
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,uW=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,hW=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,dW=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,fW=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,pW=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,mW=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,gW=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,_W=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,vW=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,yW=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,bW=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,xW=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,wW=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,SW=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,TW=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,MW=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,CW=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,EW=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,AW=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,PW=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,IW=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,LW=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,RW=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,kW=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,DW=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,FW=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,OW=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,zW=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,BW=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,NW=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,$W=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,VW=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,UW=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,jW=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,GW=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,qW=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,HW=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,WW=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const ZW=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,XW=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,YW=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,KW=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,JW=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,QW=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,e9=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,t9=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,i9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,n9=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,r9=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,s9=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,o9=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,a9=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,l9=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,c9=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,u9=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,h9=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,d9=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,f9=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,p9=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,m9=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,g9=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_9=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,v9=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,y9=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,b9=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,x9=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,w9=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,S9=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,T9=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,M9=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Tn={alphamap_fragment:eH,alphamap_pars_fragment:tH,alphatest_fragment:iH,alphatest_pars_fragment:nH,aomap_fragment:rH,aomap_pars_fragment:sH,begin_vertex:oH,beginnormal_vertex:aH,bsdfs:lH,bumpmap_pars_fragment:cH,clipping_planes_fragment:uH,clipping_planes_pars_fragment:hH,clipping_planes_pars_vertex:dH,clipping_planes_vertex:fH,color_fragment:pH,color_pars_fragment:mH,color_pars_vertex:gH,color_vertex:_H,common:vH,cube_uv_reflection_fragment:yH,defaultnormal_vertex:bH,displacementmap_pars_vertex:xH,displacementmap_vertex:wH,emissivemap_fragment:SH,emissivemap_pars_fragment:TH,encodings_fragment:MH,encodings_pars_fragment:CH,envmap_fragment:EH,envmap_common_pars_fragment:AH,envmap_pars_fragment:PH,envmap_pars_vertex:IH,envmap_physical_pars_fragment:VH,envmap_vertex:LH,fog_vertex:RH,fog_pars_vertex:kH,fog_fragment:DH,fog_pars_fragment:FH,gradientmap_pars_fragment:OH,lightmap_fragment:zH,lightmap_pars_fragment:BH,lights_lambert_vertex:NH,lights_pars_begin:$H,lights_toon_fragment:UH,lights_toon_pars_fragment:jH,lights_phong_fragment:GH,lights_phong_pars_fragment:qH,lights_physical_fragment:HH,lights_physical_pars_fragment:WH,lights_fragment_begin:ZH,lights_fragment_maps:XH,lights_fragment_end:YH,logdepthbuf_fragment:KH,logdepthbuf_pars_fragment:JH,logdepthbuf_pars_vertex:QH,logdepthbuf_vertex:eW,map_fragment:tW,map_pars_fragment:iW,map_particle_fragment:nW,map_particle_pars_fragment:rW,metalnessmap_fragment:sW,metalnessmap_pars_fragment:oW,morphnormal_vertex:aW,morphtarget_pars_vertex:lW,morphtarget_vertex:cW,normal_fragment_begin:uW,normal_fragment_maps:hW,normal_pars_fragment:dW,normal_pars_vertex:fW,normal_vertex:pW,normalmap_pars_fragment:mW,clearcoat_normal_fragment_begin:gW,clearcoat_normal_fragment_maps:_W,clearcoat_pars_fragment:vW,output_fragment:yW,packing:bW,premultiplied_alpha_fragment:xW,project_vertex:wW,dithering_fragment:SW,dithering_pars_fragment:TW,roughnessmap_fragment:MW,roughnessmap_pars_fragment:CW,shadowmap_pars_fragment:EW,shadowmap_pars_vertex:AW,shadowmap_vertex:PW,shadowmask_pars_fragment:IW,skinbase_vertex:LW,skinning_pars_vertex:RW,skinning_vertex:kW,skinnormal_vertex:DW,specularmap_fragment:FW,specularmap_pars_fragment:OW,tonemapping_fragment:zW,tonemapping_pars_fragment:BW,transmission_fragment:NW,transmission_pars_fragment:$W,uv_pars_fragment:VW,uv_pars_vertex:UW,uv_vertex:jW,uv2_pars_fragment:GW,uv2_pars_vertex:qW,uv2_vertex:HW,worldpos_vertex:WW,background_vert:ZW,background_frag:XW,cube_vert:YW,cube_frag:KW,depth_vert:JW,depth_frag:QW,distanceRGBA_vert:e9,distanceRGBA_frag:t9,equirect_vert:i9,equirect_frag:n9,linedashed_vert:r9,linedashed_frag:s9,meshbasic_vert:o9,meshbasic_frag:a9,meshlambert_vert:l9,meshlambert_frag:c9,meshmatcap_vert:u9,meshmatcap_frag:h9,meshnormal_vert:d9,meshnormal_frag:f9,meshphong_vert:p9,meshphong_frag:m9,meshphysical_vert:g9,meshphysical_frag:_9,meshtoon_vert:v9,meshtoon_frag:y9,points_vert:b9,points_frag:x9,shadow_vert:w9,shadow_frag:S9,sprite_vert:T9,sprite_frag:M9},xi={common:{diffuse:{value:new Bi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new mo},uv2Transform:{value:new mo},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new li(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Bi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Bi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new mo}},sprite:{diffuse:{value:new Bi(16777215)},opacity:{value:1},center:{value:new li(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new mo}}},Qc={basic:{uniforms:Eo([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.fog]),vertexShader:Tn.meshbasic_vert,fragmentShader:Tn.meshbasic_frag},lambert:{uniforms:Eo([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.fog,xi.lights,{emissive:{value:new Bi(0)}}]),vertexShader:Tn.meshlambert_vert,fragmentShader:Tn.meshlambert_frag},phong:{uniforms:Eo([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.fog,xi.lights,{emissive:{value:new Bi(0)},specular:{value:new Bi(1118481)},shininess:{value:30}}]),vertexShader:Tn.meshphong_vert,fragmentShader:Tn.meshphong_frag},standard:{uniforms:Eo([xi.common,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.roughnessmap,xi.metalnessmap,xi.fog,xi.lights,{emissive:{value:new Bi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Tn.meshphysical_vert,fragmentShader:Tn.meshphysical_frag},toon:{uniforms:Eo([xi.common,xi.aomap,xi.lightmap,xi.emissivemap,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.gradientmap,xi.fog,xi.lights,{emissive:{value:new Bi(0)}}]),vertexShader:Tn.meshtoon_vert,fragmentShader:Tn.meshtoon_frag},matcap:{uniforms:Eo([xi.common,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.fog,{matcap:{value:null}}]),vertexShader:Tn.meshmatcap_vert,fragmentShader:Tn.meshmatcap_frag},points:{uniforms:Eo([xi.points,xi.fog]),vertexShader:Tn.points_vert,fragmentShader:Tn.points_frag},dashed:{uniforms:Eo([xi.common,xi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tn.linedashed_vert,fragmentShader:Tn.linedashed_frag},depth:{uniforms:Eo([xi.common,xi.displacementmap]),vertexShader:Tn.depth_vert,fragmentShader:Tn.depth_frag},normal:{uniforms:Eo([xi.common,xi.bumpmap,xi.normalmap,xi.displacementmap,{opacity:{value:1}}]),vertexShader:Tn.meshnormal_vert,fragmentShader:Tn.meshnormal_frag},sprite:{uniforms:Eo([xi.sprite,xi.fog]),vertexShader:Tn.sprite_vert,fragmentShader:Tn.sprite_frag},background:{uniforms:{uvTransform:{value:new mo},t2D:{value:null}},vertexShader:Tn.background_vert,fragmentShader:Tn.background_frag},cube:{uniforms:Eo([xi.envmap,{opacity:{value:1}}]),vertexShader:Tn.cube_vert,fragmentShader:Tn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tn.equirect_vert,fragmentShader:Tn.equirect_frag},distanceRGBA:{uniforms:Eo([xi.common,xi.displacementmap,{referencePosition:{value:new Fe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tn.distanceRGBA_vert,fragmentShader:Tn.distanceRGBA_frag},shadow:{uniforms:Eo([xi.lights,xi.fog,{color:{value:new Bi(0)},opacity:{value:1}}]),vertexShader:Tn.shadow_vert,fragmentShader:Tn.shadow_frag}};Qc.physical={uniforms:Eo([Qc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new li(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Bi(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new li},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Bi(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new Bi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Tn.meshphysical_vert,fragmentShader:Tn.meshphysical_frag};function C9(n,e,t,i,r){const o=new Bi(0);let c=0,s,f,p=null,g=0,_=null;function x(M,P){let k=!1,L=P.isScene===!0?P.background:null;L&&L.isTexture&&(L=e.get(L));const I=n.xr,F=I.getSession&&I.getSession();F&&F.environmentBlendMode==="additive"&&(L=null),L===null?b(o,c):L&&L.isColor&&(b(L,1),k=!0),(n.autoClear||k)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),L&&(L.isCubeTexture||L.mapping===Dw)?(f===void 0&&(f=new kr(new t0(1,1,1),new Jo({name:"BackgroundCubeMaterial",uniforms:Ng(Qc.cube.uniforms),vertexShader:Qc.cube.vertexShader,fragmentShader:Qc.cube.fragmentShader,side:Gs,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(N,H,Y){this.matrixWorld.copyPosition(Y.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(f)),f.material.uniforms.envMap.value=L,f.material.uniforms.flipEnvMap.value=L.isCubeTexture&&L.isRenderTargetTexture===!1?-1:1,(p!==L||g!==L.version||_!==n.toneMapping)&&(f.material.needsUpdate=!0,p=L,g=L.version,_=n.toneMapping),M.unshift(f,f.geometry,f.material,0,0,null)):L&&L.isTexture&&(s===void 0&&(s=new kr(new Nw(2,2),new Jo({name:"BackgroundMaterial",uniforms:Ng(Qc.background.uniforms),vertexShader:Qc.background.vertexShader,fragmentShader:Qc.background.fragmentShader,side:zg,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(s)),s.material.uniforms.t2D.value=L,L.matrixAutoUpdate===!0&&L.updateMatrix(),s.material.uniforms.uvTransform.value.copy(L.matrix),(p!==L||g!==L.version||_!==n.toneMapping)&&(s.material.needsUpdate=!0,p=L,g=L.version,_=n.toneMapping),M.unshift(s,s.geometry,s.material,0,0,null))}function b(M,P){t.buffers.color.setClear(M.r,M.g,M.b,P,r)}return{getClearColor:function(){return o},setClearColor:function(M,P=1){o.set(M),c=P,b(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(M){c=M,b(o,c)},render:x}}function E9(n,e,t,i){const r=n.getParameter(34921),o=i.isWebGL2?null:e.get("OES_vertex_array_object"),c=i.isWebGL2||o!==null,s={},f=P(null);let p=f;function g(J,le,ae,pe,fe){let Te=!1;if(c){const Ce=M(pe,ae,le);p!==Ce&&(p=Ce,x(p.object)),Te=k(pe,fe),Te&&L(pe,fe)}else{const Ce=le.wireframe===!0;(p.geometry!==pe.id||p.program!==ae.id||p.wireframe!==Ce)&&(p.geometry=pe.id,p.program=ae.id,p.wireframe=Ce,Te=!0)}J.isInstancedMesh===!0&&(Te=!0),fe!==null&&t.update(fe,34963),Te&&(q(J,le,ae,pe),fe!==null&&n.bindBuffer(34963,t.get(fe).buffer))}function _(){return i.isWebGL2?n.createVertexArray():o.createVertexArrayOES()}function x(J){return i.isWebGL2?n.bindVertexArray(J):o.bindVertexArrayOES(J)}function b(J){return i.isWebGL2?n.deleteVertexArray(J):o.deleteVertexArrayOES(J)}function M(J,le,ae){const pe=ae.wireframe===!0;let fe=s[J.id];fe===void 0&&(fe={},s[J.id]=fe);let Te=fe[le.id];Te===void 0&&(Te={},fe[le.id]=Te);let Ce=Te[pe];return Ce===void 0&&(Ce=P(_()),Te[pe]=Ce),Ce}function P(J){const le=[],ae=[],pe=[];for(let fe=0;fe<r;fe++)le[fe]=0,ae[fe]=0,pe[fe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:le,enabledAttributes:ae,attributeDivisors:pe,object:J,attributes:{},index:null}}function k(J,le){const ae=p.attributes,pe=J.attributes;let fe=0;for(const Te in pe){const Ce=ae[Te],tt=pe[Te];if(Ce===void 0||Ce.attribute!==tt||Ce.data!==tt.data)return!0;fe++}return p.attributesNum!==fe||p.index!==le}function L(J,le){const ae={},pe=J.attributes;let fe=0;for(const Te in pe){const Ce=pe[Te],tt={};tt.attribute=Ce,Ce.data&&(tt.data=Ce.data),ae[Te]=tt,fe++}p.attributes=ae,p.attributesNum=fe,p.index=le}function I(){const J=p.newAttributes;for(let le=0,ae=J.length;le<ae;le++)J[le]=0}function F(J){N(J,0)}function N(J,le){const ae=p.newAttributes,pe=p.enabledAttributes,fe=p.attributeDivisors;ae[J]=1,pe[J]===0&&(n.enableVertexAttribArray(J),pe[J]=1),fe[J]!==le&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](J,le),fe[J]=le)}function H(){const J=p.newAttributes,le=p.enabledAttributes;for(let ae=0,pe=le.length;ae<pe;ae++)le[ae]!==J[ae]&&(n.disableVertexAttribArray(ae),le[ae]=0)}function Y(J,le,ae,pe,fe,Te){i.isWebGL2===!0&&(ae===5124||ae===5125)?n.vertexAttribIPointer(J,le,ae,fe,Te):n.vertexAttribPointer(J,le,ae,pe,fe,Te)}function q(J,le,ae,pe){if(i.isWebGL2===!1&&(J.isInstancedMesh||pe.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;I();const fe=pe.attributes,Te=ae.getAttributes(),Ce=le.defaultAttributeValues;for(const tt in Te){const Ke=Te[tt];if(Ke.location>=0){let dt=fe[tt];if(dt===void 0&&(tt==="instanceMatrix"&&J.instanceMatrix&&(dt=J.instanceMatrix),tt==="instanceColor"&&J.instanceColor&&(dt=J.instanceColor)),dt!==void 0){const et=dt.normalized,Oe=dt.itemSize,lt=t.get(dt);if(lt===void 0)continue;const Ye=lt.buffer,zt=lt.type,Lt=lt.bytesPerElement;if(dt.isInterleavedBufferAttribute){const At=dt.data,Nt=At.stride,$t=dt.offset;if(At&&At.isInstancedInterleavedBuffer){for(let Ze=0;Ze<Ke.locationSize;Ze++)N(Ke.location+Ze,At.meshPerAttribute);J.isInstancedMesh!==!0&&pe._maxInstanceCount===void 0&&(pe._maxInstanceCount=At.meshPerAttribute*At.count)}else for(let Ze=0;Ze<Ke.locationSize;Ze++)F(Ke.location+Ze);n.bindBuffer(34962,Ye);for(let Ze=0;Ze<Ke.locationSize;Ze++)Y(Ke.location+Ze,Oe/Ke.locationSize,zt,et,Nt*Lt,($t+Oe/Ke.locationSize*Ze)*Lt)}else{if(dt.isInstancedBufferAttribute){for(let At=0;At<Ke.locationSize;At++)N(Ke.location+At,dt.meshPerAttribute);J.isInstancedMesh!==!0&&pe._maxInstanceCount===void 0&&(pe._maxInstanceCount=dt.meshPerAttribute*dt.count)}else for(let At=0;At<Ke.locationSize;At++)F(Ke.location+At);n.bindBuffer(34962,Ye);for(let At=0;At<Ke.locationSize;At++)Y(Ke.location+At,Oe/Ke.locationSize,zt,et,Oe*Lt,Oe/Ke.locationSize*At*Lt)}}else if(Ce!==void 0){const et=Ce[tt];if(et!==void 0)switch(et.length){case 2:n.vertexAttrib2fv(Ke.location,et);break;case 3:n.vertexAttrib3fv(Ke.location,et);break;case 4:n.vertexAttrib4fv(Ke.location,et);break;default:n.vertexAttrib1fv(Ke.location,et)}}}}H()}function U(){B();for(const J in s){const le=s[J];for(const ae in le){const pe=le[ae];for(const fe in pe)b(pe[fe].object),delete pe[fe];delete le[ae]}delete s[J]}}function G(J){if(s[J.id]===void 0)return;const le=s[J.id];for(const ae in le){const pe=le[ae];for(const fe in pe)b(pe[fe].object),delete pe[fe];delete le[ae]}delete s[J.id]}function j(J){for(const le in s){const ae=s[le];if(ae[J.id]===void 0)continue;const pe=ae[J.id];for(const fe in pe)b(pe[fe].object),delete pe[fe];delete ae[J.id]}}function B(){ne(),p!==f&&(p=f,x(p.object))}function ne(){f.geometry=null,f.program=null,f.wireframe=!1}return{setup:g,reset:B,resetDefaultState:ne,dispose:U,releaseStatesOfGeometry:G,releaseStatesOfProgram:j,initAttributes:I,enableAttribute:F,disableUnusedAttributes:H}}function A9(n,e,t,i){const r=i.isWebGL2;let o;function c(p){o=p}function s(p,g){n.drawArrays(o,p,g),t.update(g,o,1)}function f(p,g,_){if(_===0)return;let x,b;if(r)x=n,b="drawArraysInstanced";else if(x=e.get("ANGLE_instanced_arrays"),b="drawArraysInstancedANGLE",x===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}x[b](o,p,g,_),t.update(g,o,_)}this.setMode=c,this.render=s,this.renderInstances=f}function P9(n,e,t){let i;function r(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const q=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(q.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(q){if(q==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";q="mediump"}return q==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const c=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&n instanceof WebGL2ComputeRenderingContext;let s=t.precision!==void 0?t.precision:"highp";const f=o(s);f!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",f,"instead."),s=f);const p=c||e.has("WEBGL_draw_buffers"),g=t.logarithmicDepthBuffer===!0,_=n.getParameter(34930),x=n.getParameter(35660),b=n.getParameter(3379),M=n.getParameter(34076),P=n.getParameter(34921),k=n.getParameter(36347),L=n.getParameter(36348),I=n.getParameter(36349),F=x>0,N=c||e.has("OES_texture_float"),H=F&&N,Y=c?n.getParameter(36183):0;return{isWebGL2:c,drawBuffers:p,getMaxAnisotropy:r,getMaxPrecision:o,precision:s,logarithmicDepthBuffer:g,maxTextures:_,maxVertexTextures:x,maxTextureSize:b,maxCubemapSize:M,maxAttributes:P,maxVertexUniforms:k,maxVaryings:L,maxFragmentUniforms:I,vertexTextures:F,floatFragmentTextures:N,floatVertexTextures:H,maxSamples:Y}}function I9(n){const e=this;let t=null,i=0,r=!1,o=!1;const c=new ch,s=new mo,f={value:null,needsUpdate:!1};this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(_,x,b){const M=_.length!==0||x||i!==0||r;return r=x,t=g(_,b,0),i=_.length,M},this.beginShadows=function(){o=!0,g(null)},this.endShadows=function(){o=!1,p()},this.setState=function(_,x,b){const M=_.clippingPlanes,P=_.clipIntersection,k=_.clipShadows,L=n.get(_);if(!r||M===null||M.length===0||o&&!k)o?g(null):p();else{const I=o?0:i,F=I*4;let N=L.clippingState||null;f.value=N,N=g(M,x,F,b);for(let H=0;H!==F;++H)N[H]=t[H];L.clippingState=N,this.numIntersection=P?this.numPlanes:0,this.numPlanes+=I}};function p(){f.value!==t&&(f.value=t,f.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function g(_,x,b,M){const P=_!==null?_.length:0;let k=null;if(P!==0){if(k=f.value,M!==!0||k===null){const L=b+P*4,I=x.matrixWorldInverse;s.getNormalMatrix(I),(k===null||k.length<L)&&(k=new Float32Array(L));for(let F=0,N=b;F!==P;++F,N+=4)c.copy(_[F]).applyMatrix4(I,s),c.normal.toArray(k,N),k[N+3]=c.constant}f.value=k,f.needsUpdate=!0}return e.numPlanes=P,e.numIntersection=0,k}}function L9(n){let e=new WeakMap;function t(c,s){return s===dM?c.mapping=Jy:s===fM&&(c.mapping=Qy),c}function i(c){if(c&&c.isTexture&&c.isRenderTargetTexture===!1){const s=c.mapping;if(s===dM||s===fM)if(e.has(c)){const f=e.get(c).texture;return t(f,c.mapping)}else{const f=c.image;if(f&&f.height>0){const p=n.getRenderTarget(),g=new bF(f.height/2);return g.fromEquirectangularTexture(n,c),e.set(c,g),n.setRenderTarget(p),c.addEventListener("dispose",r),t(g.texture,c.mapping)}else return null}}return c}function r(c){const s=c.target;s.removeEventListener("dispose",r);const f=e.get(s);f!==void 0&&(e.delete(s),f.dispose())}function o(){e=new WeakMap}return{get:i,dispose:o}}class $w extends i0{constructor(e=-1,t=1,i=1,r=-1,o=.1,c=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=o,this.far=c,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,o,c){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=i-e,c=i+e,s=r+t,f=r-t;if(this.view!==null&&this.view.enabled){const p=(this.right-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=p*this.view.offsetX,c=o+p*this.view.width,s-=g*this.view.offsetY,f=s-g*this.view.height}this.projectionMatrix.makeOrthographic(o,c,s,f,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}$w.prototype.isOrthographicCamera=!0;class Vw extends Jo{constructor(e){super(e),this.type="RawShaderMaterial"}}Vw.prototype.isRawShaderMaterial=!0;const Mg=4,Ad=8,Yc=Math.pow(2,Ad),wF=[.125,.215,.35,.446,.526,.582],SF=Ad-Mg+1+wF.length,Xm=20,zd={[Fo]:0,[yp]:1,[F2]:2,[uF]:3,[hF]:4,[dF]:5,[D2]:6},nT=new $w,{_lodPlanes:_v,_sizeLods:DI,_sigmas:zb}=D9(),FI=new Bi;let rT=null;const jf=(1+Math.sqrt(5))/2,Ym=1/jf,OI=[new Fe(1,1,1),new Fe(-1,1,1),new Fe(1,1,-1),new Fe(-1,1,-1),new Fe(0,jf,Ym),new Fe(0,jf,-Ym),new Fe(Ym,0,jf),new Fe(-Ym,0,jf),new Fe(jf,Ym,0),new Fe(-jf,Ym,0)];class R9{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=F9(Xm),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){rT=this._renderer.getRenderTarget();const o=this._allocateTargets();return this._sceneToCubeUV(e,i,r,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=NI(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=BI(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<_v.length;e++)_v[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(rT),e.scissorTest=!1,Bb(e,0,0,e.width,e.height)}_fromTexture(e){rT=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:Ws,minFilter:Ws,generateMipmaps:!1,type:Od,format:A7,encoding:k9(e)?e.encoding:F2,depthBuffer:!1},i=zI(t);return i.depthBuffer=!e,this._pingPongRenderTarget=zI(t),i}_compileMaterial(e){const t=new kr(_v[0],e);this._renderer.compile(t,nT)}_sceneToCubeUV(e,t,i,r){const s=new ea(90,1,t,i),f=[1,-1,1,1,1,1],p=[1,1,1,-1,-1,-1],g=this._renderer,_=g.autoClear,x=g.outputEncoding,b=g.toneMapping;g.getClearColor(FI),g.toneMapping=ip,g.outputEncoding=Fo,g.autoClear=!1;const M=new e0({name:"PMREM.Background",side:Gs,depthWrite:!1,depthTest:!1}),P=new kr(new t0,M);let k=!1;const L=e.background;L?L.isColor&&(M.color.copy(L),e.background=null,k=!0):(M.color.copy(FI),k=!0);for(let I=0;I<6;I++){const F=I%3;F==0?(s.up.set(0,f[I],0),s.lookAt(p[I],0,0)):F==1?(s.up.set(0,0,f[I]),s.lookAt(0,p[I],0)):(s.up.set(0,f[I],0),s.lookAt(0,0,p[I])),Bb(r,F*Yc,I>2?Yc:0,Yc,Yc),g.setRenderTarget(r),k&&g.render(P,s),g.render(e,s)}P.geometry.dispose(),P.material.dispose(),g.toneMapping=b,g.outputEncoding=x,g.autoClear=_,e.background=L}_setEncoding(e,t){this._renderer.capabilities.isWebGL2===!0&&t.format===oa&&t.type===Od&&t.encoding===yp?e.value=zd[Fo]:e.value=zd[t.encoding]}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Jy||e.mapping===Qy;r?this._cubemapShader==null&&(this._cubemapShader=NI()):this._equirectShader==null&&(this._equirectShader=BI());const o=r?this._cubemapShader:this._equirectShader,c=new kr(_v[0],o),s=o.uniforms;s.envMap.value=e,r||s.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(s.inputEncoding,e),this._setEncoding(s.outputEncoding,t.texture),Bb(t,0,0,3*Yc,2*Yc),i.setRenderTarget(t),i.render(c,nT)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<SF;r++){const o=Math.sqrt(zb[r]*zb[r]-zb[r-1]*zb[r-1]),c=OI[(r-1)%OI.length];this._blur(e,r-1,r,o,c)}t.autoClear=i}_blur(e,t,i,r,o){const c=this._pingPongRenderTarget;this._halfBlur(e,c,t,i,r,"latitudinal",o),this._halfBlur(c,e,i,i,r,"longitudinal",o)}_halfBlur(e,t,i,r,o,c,s){const f=this._renderer,p=this._blurMaterial;c!=="latitudinal"&&c!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const g=3,_=new kr(_v[r],p),x=p.uniforms,b=DI[i]-1,M=isFinite(o)?Math.PI/(2*b):2*Math.PI/(2*Xm-1),P=o/M,k=isFinite(o)?1+Math.floor(g*P):Xm;k>Xm&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${k} samples when the maximum is set to ${Xm}`);const L=[];let I=0;for(let Y=0;Y<Xm;++Y){const q=Y/P,U=Math.exp(-q*q/2);L.push(U),Y==0?I+=U:Y<k&&(I+=2*U)}for(let Y=0;Y<L.length;Y++)L[Y]=L[Y]/I;x.envMap.value=e.texture,x.samples.value=k,x.weights.value=L,x.latitudinal.value=c==="latitudinal",s&&(x.poleAxis.value=s),x.dTheta.value=M,x.mipInt.value=Ad-i,this._setEncoding(x.inputEncoding,e.texture),this._setEncoding(x.outputEncoding,e.texture);const F=DI[r],N=3*Math.max(0,Yc-2*F),H=(r===0?0:2*Yc)+2*F*(r>Ad-Mg?r-Ad+Mg:0);Bb(t,N,H,3*F,2*F),f.setRenderTarget(t),f.render(_,nT)}}function k9(n){return n===void 0||n.type!==Od?!1:n.encoding===Fo||n.encoding===yp||n.encoding===D2}function D9(){const n=[],e=[],t=[];let i=Ad;for(let r=0;r<SF;r++){const o=Math.pow(2,i);e.push(o);let c=1/o;r>Ad-Mg?c=wF[r-Ad+Mg-1]:r==0&&(c=0),t.push(c);const s=1/(o-1),f=-s/2,p=1+s/2,g=[f,f,p,f,p,p,f,f,p,p,f,p],_=6,x=6,b=3,M=2,P=1,k=new Float32Array(b*x*_),L=new Float32Array(M*x*_),I=new Float32Array(P*x*_);for(let N=0;N<_;N++){const H=N%3*2/3-1,Y=N>2?0:-1,q=[H,Y,0,H+2/3,Y,0,H+2/3,Y+1,0,H,Y,0,H+2/3,Y+1,0,H,Y+1,0];k.set(q,b*x*N),L.set(g,M*x*N);const U=[N,N,N,N,N,N];I.set(U,P*x*N)}const F=new $n;F.setAttribute("position",new Mn(k,b)),F.setAttribute("uv",new Mn(L,M)),F.setAttribute("faceIndex",new Mn(I,P)),n.push(F),i>Mg&&i--}return{_lodPlanes:n,_sizeLods:e,_sigmas:t}}function zI(n){const e=new xc(3*Yc,3*Yc,n);return e.texture.mapping=Dw,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Bb(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function F9(n){const e=new Float32Array(n),t=new Fe(0,1,0);return new Vw({name:"SphericalGaussianBlur",defines:{n},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:zd[Fo]},outputEncoding:{value:zd[Fo]}},vertexShader:B2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${N2()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ed,depthTest:!1,depthWrite:!1})}function BI(){const n=new li(1,1);return new Vw({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:n},inputEncoding:{value:zd[Fo]},outputEncoding:{value:zd[Fo]}},vertexShader:B2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${N2()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ed,depthTest:!1,depthWrite:!1})}function NI(){return new Vw({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:zd[Fo]},outputEncoding:{value:zd[Fo]}},vertexShader:B2(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${N2()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Ed,depthTest:!1,depthWrite:!1})}function B2(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function N2(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function O9(n){let e=new WeakMap,t=null;function i(s){if(s&&s.isTexture&&s.isRenderTargetTexture===!1){const f=s.mapping,p=f===dM||f===fM,g=f===Jy||f===Qy;if(p||g){if(e.has(s))return e.get(s).texture;{const _=s.image;if(p&&_&&_.height>0||g&&_&&r(_)){const x=n.getRenderTarget();t===null&&(t=new R9(n));const b=p?t.fromEquirectangular(s):t.fromCubemap(s);return e.set(s,b),n.setRenderTarget(x),s.addEventListener("dispose",o),b.texture}else return null}}}return s}function r(s){let f=0;const p=6;for(let g=0;g<p;g++)s[g]!==void 0&&f++;return f===p}function o(s){const f=s.target;f.removeEventListener("dispose",o);const p=e.get(f);p!==void 0&&(e.delete(f),p.dispose())}function c(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:c}}function z9(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(i){const r=t(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function B9(n,e,t,i){const r={},o=new WeakMap;function c(_){const x=_.target;x.index!==null&&e.remove(x.index);for(const M in x.attributes)e.remove(x.attributes[M]);x.removeEventListener("dispose",c),delete r[x.id];const b=o.get(x);b&&(e.remove(b),o.delete(x)),i.releaseStatesOfGeometry(x),x.isInstancedBufferGeometry===!0&&delete x._maxInstanceCount,t.memory.geometries--}function s(_,x){return r[x.id]===!0||(x.addEventListener("dispose",c),r[x.id]=!0,t.memory.geometries++),x}function f(_){const x=_.attributes;for(const M in x)e.update(x[M],34962);const b=_.morphAttributes;for(const M in b){const P=b[M];for(let k=0,L=P.length;k<L;k++)e.update(P[k],34962)}}function p(_){const x=[],b=_.index,M=_.attributes.position;let P=0;if(b!==null){const I=b.array;P=b.version;for(let F=0,N=I.length;F<N;F+=3){const H=I[F+0],Y=I[F+1],q=I[F+2];x.push(H,Y,Y,q,q,H)}}else{const I=M.array;P=M.version;for(let F=0,N=I.length/3-1;F<N;F+=3){const H=F+0,Y=F+1,q=F+2;x.push(H,Y,Y,q,q,H)}}const k=new(pF(x)>65535?yF:vF)(x,1);k.version=P;const L=o.get(_);L&&e.remove(L),o.set(_,k)}function g(_){const x=o.get(_);if(x){const b=_.index;b!==null&&x.version<b.version&&p(_)}else p(_);return o.get(_)}return{get:s,update:f,getWireframeAttribute:g}}function N9(n,e,t,i){const r=i.isWebGL2;let o;function c(x){o=x}let s,f;function p(x){s=x.type,f=x.bytesPerElement}function g(x,b){n.drawElements(o,b,s,x*f),t.update(b,o,1)}function _(x,b,M){if(M===0)return;let P,k;if(r)P=n,k="drawElementsInstanced";else if(P=e.get("ANGLE_instanced_arrays"),k="drawElementsInstancedANGLE",P===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}P[k](o,b,s,x*f,M),t.update(b,o,M)}this.setMode=c,this.setIndex=p,this.render=g,this.renderInstances=_}function $9(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(o,c,s){switch(t.calls++,c){case 4:t.triangles+=s*(o/3);break;case 1:t.lines+=s*(o/2);break;case 3:t.lines+=s*(o-1);break;case 2:t.lines+=s*o;break;case 0:t.points+=s*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",c);break}}function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}class $2 extends zs{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ws,this.minFilter=Ws,this.wrapR=Qa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}$2.prototype.isDataTexture2DArray=!0;function V9(n,e){return n[0]-e[0]}function U9(n,e){return Math.abs(e[1])-Math.abs(n[1])}function $I(n,e){let t=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?t=127:i instanceof Int16Array?t=32767:i instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),n.divideScalar(t)}function j9(n,e,t){const i={},r=new Float32Array(8),o=new WeakMap,c=new Fe,s=[];for(let p=0;p<8;p++)s[p]=[p,0];function f(p,g,_,x){const b=p.morphTargetInfluences;if(e.isWebGL2===!0){const M=g.morphAttributes.position.length;let P=o.get(g);if(P===void 0||P.count!==M){P!==void 0&&P.texture.dispose();const I=g.morphAttributes.normal!==void 0,F=g.morphAttributes.position,N=g.morphAttributes.normal||[],H=g.attributes.position.count,Y=I===!0?2:1;let q=H*Y,U=1;q>e.maxTextureSize&&(U=Math.ceil(q/e.maxTextureSize),q=e.maxTextureSize);const G=new Float32Array(q*U*4*M),j=new $2(G,q,U,M);j.format=oa,j.type=wd;const B=Y*4;for(let ne=0;ne<M;ne++){const J=F[ne],le=N[ne],ae=q*U*4*ne;for(let pe=0;pe<J.count;pe++){c.fromBufferAttribute(J,pe),J.normalized===!0&&$I(c,J);const fe=pe*B;G[ae+fe+0]=c.x,G[ae+fe+1]=c.y,G[ae+fe+2]=c.z,G[ae+fe+3]=0,I===!0&&(c.fromBufferAttribute(le,pe),le.normalized===!0&&$I(c,le),G[ae+fe+4]=c.x,G[ae+fe+5]=c.y,G[ae+fe+6]=c.z,G[ae+fe+7]=0)}}P={count:M,texture:j,size:new li(q,U)},o.set(g,P)}let k=0;for(let I=0;I<b.length;I++)k+=b[I];const L=g.morphTargetsRelative?1:1-k;x.getUniforms().setValue(n,"morphTargetBaseInfluence",L),x.getUniforms().setValue(n,"morphTargetInfluences",b),x.getUniforms().setValue(n,"morphTargetsTexture",P.texture,t),x.getUniforms().setValue(n,"morphTargetsTextureSize",P.size)}else{const M=b===void 0?0:b.length;let P=i[g.id];if(P===void 0||P.length!==M){P=[];for(let N=0;N<M;N++)P[N]=[N,0];i[g.id]=P}for(let N=0;N<M;N++){const H=P[N];H[0]=N,H[1]=b[N]}P.sort(U9);for(let N=0;N<8;N++)N<M&&P[N][1]?(s[N][0]=P[N][0],s[N][1]=P[N][1]):(s[N][0]=Number.MAX_SAFE_INTEGER,s[N][1]=0);s.sort(V9);const k=g.morphAttributes.position,L=g.morphAttributes.normal;let I=0;for(let N=0;N<8;N++){const H=s[N],Y=H[0],q=H[1];Y!==Number.MAX_SAFE_INTEGER&&q?(k&&g.getAttribute("morphTarget"+N)!==k[Y]&&g.setAttribute("morphTarget"+N,k[Y]),L&&g.getAttribute("morphNormal"+N)!==L[Y]&&g.setAttribute("morphNormal"+N,L[Y]),r[N]=q,I+=q):(k&&g.hasAttribute("morphTarget"+N)===!0&&g.deleteAttribute("morphTarget"+N),L&&g.hasAttribute("morphNormal"+N)===!0&&g.deleteAttribute("morphNormal"+N),r[N]=0)}const F=g.morphTargetsRelative?1:1-I;x.getUniforms().setValue(n,"morphTargetBaseInfluence",F),x.getUniforms().setValue(n,"morphTargetInfluences",r)}}return{update:f}}function G9(n,e,t,i){let r=new WeakMap;function o(f){const p=i.render.frame,g=f.geometry,_=e.get(f,g);return r.get(_)!==p&&(e.update(_),r.set(_,p)),f.isInstancedMesh&&(f.hasEventListener("dispose",s)===!1&&f.addEventListener("dispose",s),t.update(f.instanceMatrix,34962),f.instanceColor!==null&&t.update(f.instanceColor,34962)),_}function c(){r=new WeakMap}function s(f){const p=f.target;p.removeEventListener("dispose",s),t.remove(p.instanceMatrix),p.instanceColor!==null&&t.remove(p.instanceColor)}return{update:o,dispose:c}}class TF extends zs{constructor(e=null,t=1,i=1,r=1){super(null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=Ws,this.minFilter=Ws,this.wrapR=Qa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}TF.prototype.isDataTexture3D=!0;const MF=new zs,q9=new $2,H9=new TF,CF=new zw,VI=[],UI=[],jI=new Float32Array(16),GI=new Float32Array(9),qI=new Float32Array(4);function i_(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let o=VI[r];if(o===void 0&&(o=new Float32Array(r),VI[r]=o),e!==0){i.toArray(o,0);for(let c=1,s=0;c!==e;++c)s+=t,n[c].toArray(o,s)}return o}function aa(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Oo(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function EF(n,e){let t=UI[e];t===void 0&&(t=new Int32Array(e),UI[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function W9(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Z9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(aa(t,e))return;n.uniform2fv(this.addr,e),Oo(t,e)}}function X9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(aa(t,e))return;n.uniform3fv(this.addr,e),Oo(t,e)}}function Y9(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(aa(t,e))return;n.uniform4fv(this.addr,e),Oo(t,e)}}function K9(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(aa(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Oo(t,e)}else{if(aa(t,i))return;qI.set(i),n.uniformMatrix2fv(this.addr,!1,qI),Oo(t,i)}}function J9(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(aa(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Oo(t,e)}else{if(aa(t,i))return;GI.set(i),n.uniformMatrix3fv(this.addr,!1,GI),Oo(t,i)}}function Q9(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(aa(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Oo(t,e)}else{if(aa(t,i))return;jI.set(i),n.uniformMatrix4fv(this.addr,!1,jI),Oo(t,i)}}function eZ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function tZ(n,e){const t=this.cache;aa(t,e)||(n.uniform2iv(this.addr,e),Oo(t,e))}function iZ(n,e){const t=this.cache;aa(t,e)||(n.uniform3iv(this.addr,e),Oo(t,e))}function nZ(n,e){const t=this.cache;aa(t,e)||(n.uniform4iv(this.addr,e),Oo(t,e))}function rZ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function sZ(n,e){const t=this.cache;aa(t,e)||(n.uniform2uiv(this.addr,e),Oo(t,e))}function oZ(n,e){const t=this.cache;aa(t,e)||(n.uniform3uiv(this.addr,e),Oo(t,e))}function aZ(n,e){const t=this.cache;aa(t,e)||(n.uniform4uiv(this.addr,e),Oo(t,e))}function lZ(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.safeSetTexture2D(e||MF,r)}function cZ(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||H9,r)}function uZ(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.safeSetTextureCube(e||CF,r)}function hZ(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||q9,r)}function dZ(n){switch(n){case 5126:return W9;case 35664:return Z9;case 35665:return X9;case 35666:return Y9;case 35674:return K9;case 35675:return J9;case 35676:return Q9;case 5124:case 35670:return eZ;case 35667:case 35671:return tZ;case 35668:case 35672:return iZ;case 35669:case 35673:return nZ;case 5125:return rZ;case 36294:return sZ;case 36295:return oZ;case 36296:return aZ;case 35678:case 36198:case 36298:case 36306:case 35682:return lZ;case 35679:case 36299:case 36307:return cZ;case 35680:case 36300:case 36308:case 36293:return uZ;case 36289:case 36303:case 36311:case 36292:return hZ}}function fZ(n,e){n.uniform1fv(this.addr,e)}function pZ(n,e){const t=i_(e,this.size,2);n.uniform2fv(this.addr,t)}function mZ(n,e){const t=i_(e,this.size,3);n.uniform3fv(this.addr,t)}function gZ(n,e){const t=i_(e,this.size,4);n.uniform4fv(this.addr,t)}function _Z(n,e){const t=i_(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function vZ(n,e){const t=i_(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function yZ(n,e){const t=i_(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function bZ(n,e){n.uniform1iv(this.addr,e)}function xZ(n,e){n.uniform2iv(this.addr,e)}function wZ(n,e){n.uniform3iv(this.addr,e)}function SZ(n,e){n.uniform4iv(this.addr,e)}function TZ(n,e){n.uniform1uiv(this.addr,e)}function MZ(n,e){n.uniform2uiv(this.addr,e)}function CZ(n,e){n.uniform3uiv(this.addr,e)}function EZ(n,e){n.uniform4uiv(this.addr,e)}function AZ(n,e,t){const i=e.length,r=EF(t,i);n.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)t.safeSetTexture2D(e[o]||MF,r[o])}function PZ(n,e,t){const i=e.length,r=EF(t,i);n.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)t.safeSetTextureCube(e[o]||CF,r[o])}function IZ(n){switch(n){case 5126:return fZ;case 35664:return pZ;case 35665:return mZ;case 35666:return gZ;case 35674:return _Z;case 35675:return vZ;case 35676:return yZ;case 5124:case 35670:return bZ;case 35667:case 35671:return xZ;case 35668:case 35672:return wZ;case 35669:case 35673:return SZ;case 5125:return TZ;case 36294:return MZ;case 36295:return CZ;case 36296:return EZ;case 35678:case 36198:case 36298:case 36306:case 35682:return AZ;case 35680:case 36300:case 36308:case 36293:return PZ}}function LZ(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=dZ(e.type)}function AF(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=IZ(e.type)}AF.prototype.updateCache=function(n){const e=this.cache;n instanceof Float32Array&&e.length!==n.length&&(this.cache=new Float32Array(n.length)),Oo(e,n)};function PF(n){this.id=n,this.seq=[],this.map={}}PF.prototype.setValue=function(n,e,t){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const c=i[r];c.setValue(n,e[c.id],t)}};const sT=/(\w+)(\])?(\[|\.)?/g;function HI(n,e){n.seq.push(e),n.map[e.id]=e}function RZ(n,e,t){const i=n.name,r=i.length;for(sT.lastIndex=0;;){const o=sT.exec(i),c=sT.lastIndex;let s=o[1];const f=o[2]==="]",p=o[3];if(f&&(s=s|0),p===void 0||p==="["&&c+2===r){HI(t,p===void 0?new LZ(s,n,e):new AF(s,n,e));break}else{let _=t.map[s];_===void 0&&(_=new PF(s),HI(t,_)),t=_}}}function Pd(n,e){this.seq=[],this.map={};const t=n.getProgramParameter(e,35718);for(let i=0;i<t;++i){const r=n.getActiveUniform(e,i),o=n.getUniformLocation(e,r.name);RZ(r,o,this)}}Pd.prototype.setValue=function(n,e,t,i){const r=this.map[e];r!==void 0&&r.setValue(n,t,i)};Pd.prototype.setOptional=function(n,e,t){const i=e[t];i!==void 0&&this.setValue(n,t,i)};Pd.upload=function(n,e,t,i){for(let r=0,o=e.length;r!==o;++r){const c=e[r],s=t[c.id];s.needsUpdate!==!1&&c.setValue(n,s.value,i)}};Pd.seqWithValue=function(n,e){const t=[];for(let i=0,r=n.length;i!==r;++i){const o=n[i];o.id in e&&t.push(o)}return t};function WI(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let kZ=0;function DZ(n){const e=n.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function IF(n){switch(n){case Fo:return["Linear","( value )"];case yp:return["sRGB","( value )"];case F2:return["RGBE","( value )"];case uF:return["RGBM","( value, 7.0 )"];case hF:return["RGBM","( value, 16.0 )"];case dF:return["RGBD","( value, 256.0 )"];case D2:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case mq:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function ZI(n,e,t){const i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();return i&&r===""?"":t.toUpperCase()+`

`+r+`

`+DZ(n.getShaderSource(e))}function Vf(n,e){const t=IF(e);return"vec4 "+n+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function FZ(n,e){const t=IF(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function OZ(n,e){let t;switch(e){case f7:t="Linear";break;case p7:t="Reinhard";break;case m7:t="OptimizedCineon";break;case g7:t="ACESFilmic";break;case _7:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function zZ(n){return[n.extensionDerivatives||n.envMapCubeUV||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fv).join(`
`)}function BZ(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function NZ(n,e){const t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){const o=n.getActiveAttrib(e,r),c=o.name;let s=1;o.type===35674&&(s=2),o.type===35675&&(s=3),o.type===35676&&(s=4),t[c]={type:o.type,location:n.getAttribLocation(e,c),locationSize:s}}return t}function Fv(n){return n!==""}function XI(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function YI(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const $Z=/^[ \t]*#include +<([\w\d./]+)>/gm;function _M(n){return n.replace($Z,VZ)}function VZ(n,e){const t=Tn[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return _M(t)}const UZ=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,jZ=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function KI(n){return n.replace(jZ,LF).replace(UZ,GZ)}function GZ(n,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),LF(n,e,t,i)}function LF(n,e,t,i){let r="";for(let o=parseInt(e);o<parseInt(t);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function JI(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function qZ(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===rF?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===qG?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Dv&&(e="SHADOWMAP_TYPE_VSM"),e}function HZ(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Jy:case Qy:e="ENVMAP_TYPE_CUBE";break;case Dw:case R2:e="ENVMAP_TYPE_CUBE_UV";break}return e}function WZ(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Qy:case R2:e="ENVMAP_MODE_REFRACTION";break}return e}function ZZ(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case kw:e="ENVMAP_BLENDING_MULTIPLY";break;case h7:e="ENVMAP_BLENDING_MIX";break;case d7:e="ENVMAP_BLENDING_ADD";break}return e}function XZ(n,e,t,i){const r=n.getContext(),o=t.defines;let c=t.vertexShader,s=t.fragmentShader;const f=qZ(t),p=HZ(t),g=WZ(t),_=ZZ(t),x=n.gammaFactor>0?n.gammaFactor:1,b=t.isWebGL2?"":zZ(t),M=BZ(o),P=r.createProgram();let k,L,I=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(k=[M].filter(Fv).join(`
`),k.length>0&&(k+=`
`),L=[b,M].filter(Fv).join(`
`),L.length>0&&(L+=`
`)):(k=[JI(t),"#define SHADER_NAME "+t.shaderName,M,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+x,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+f:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Fv).join(`
`),L=[b,JI(t),"#define SHADER_NAME "+t.shaderName,M,"#define GAMMA_FACTOR "+x,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+p:"",t.envMap?"#define "+g:"",t.envMap?"#define "+_:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+f:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ip?"#define TONE_MAPPING":"",t.toneMapping!==ip?Tn.tonemapping_pars_fragment:"",t.toneMapping!==ip?OZ("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===np?"#define OPAQUE":"",Tn.encodings_pars_fragment,t.map?Vf("mapTexelToLinear",t.mapEncoding):"",t.matcap?Vf("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?Vf("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?Vf("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularColorMap?Vf("specularColorMapTexelToLinear",t.specularColorMapEncoding):"",t.sheenColorMap?Vf("sheenColorMapTexelToLinear",t.sheenColorMapEncoding):"",t.lightMap?Vf("lightMapTexelToLinear",t.lightMapEncoding):"",FZ("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Fv).join(`
`)),c=_M(c),c=XI(c,t),c=YI(c,t),s=_M(s),s=XI(s,t),s=YI(s,t),c=KI(c),s=KI(s),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(I=`#version 300 es
`,k=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+k,L=["#define varying in",t.glslVersion===xI?"":"out highp vec4 pc_fragColor;",t.glslVersion===xI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+L);const F=I+k+c,N=I+L+s,H=WI(r,35633,F),Y=WI(r,35632,N);if(r.attachShader(P,H),r.attachShader(P,Y),t.index0AttributeName!==void 0?r.bindAttribLocation(P,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(P,0,"position"),r.linkProgram(P),n.debug.checkShaderErrors){const G=r.getProgramInfoLog(P).trim(),j=r.getShaderInfoLog(H).trim(),B=r.getShaderInfoLog(Y).trim();let ne=!0,J=!0;if(r.getProgramParameter(P,35714)===!1){ne=!1;const le=ZI(r,H,"vertex"),ae=ZI(r,Y,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(P,35715)+`

Program Info Log: `+G+`
`+le+`
`+ae)}else G!==""?console.warn("THREE.WebGLProgram: Program Info Log:",G):(j===""||B==="")&&(J=!1);J&&(this.diagnostics={runnable:ne,programLog:G,vertexShader:{log:j,prefix:k},fragmentShader:{log:B,prefix:L}})}r.deleteShader(H),r.deleteShader(Y);let q;this.getUniforms=function(){return q===void 0&&(q=new Pd(r,P)),q};let U;return this.getAttributes=function(){return U===void 0&&(U=NZ(r,P)),U},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(P),this.program=void 0},this.name=t.shaderName,this.id=kZ++,this.cacheKey=e,this.usedTimes=1,this.program=P,this.vertexShader=H,this.fragmentShader=Y,this}function YZ(n,e,t,i,r,o,c){const s=[],f=r.isWebGL2,p=r.logarithmicDepthBuffer,g=r.floatVertexTextures,_=r.maxVertexUniforms,x=r.vertexTextures;let b=r.precision;const M={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},P=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function k(q){const G=q.skeleton.bones;if(g)return 1024;{const B=Math.floor((_-20)/4),ne=Math.min(B,G.length);return ne<G.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+G.length+" bones. This GPU supports "+ne+"."),0):ne}}function L(q){let U;return q&&q.isTexture?U=q.encoding:q&&q.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),U=q.texture.encoding):U=Fo,f&&q&&q.isTexture&&q.format===oa&&q.type===Od&&q.encoding===yp&&(U=Fo),U}function I(q,U,G,j,B){const ne=j.fog,J=q.isMeshStandardMaterial?j.environment:null,le=(q.isMeshStandardMaterial?t:e).get(q.envMap||J),ae=M[q.type],pe=B.isSkinnedMesh?k(B):0;q.precision!==null&&(b=r.getMaxPrecision(q.precision),b!==q.precision&&console.warn("THREE.WebGLProgram.getParameters:",q.precision,"not supported, using",b,"instead."));let fe,Te;if(ae){const et=Qc[ae];fe=et.vertexShader,Te=et.fragmentShader}else fe=q.vertexShader,Te=q.fragmentShader;const Ce=n.getRenderTarget(),tt=q.alphaTest>0,Ke=q.clearcoat>0;return{isWebGL2:f,shaderID:ae,shaderName:q.type,vertexShader:fe,fragmentShader:Te,defines:q.defines,isRawShaderMaterial:q.isRawShaderMaterial===!0,glslVersion:q.glslVersion,precision:b,instancing:B.isInstancedMesh===!0,instancingColor:B.isInstancedMesh===!0&&B.instanceColor!==null,supportsVertexTextures:x,outputEncoding:Ce!==null?L(Ce.texture):n.outputEncoding,map:!!q.map,mapEncoding:L(q.map),matcap:!!q.matcap,matcapEncoding:L(q.matcap),envMap:!!le,envMapMode:le&&le.mapping,envMapEncoding:L(le),envMapCubeUV:!!le&&(le.mapping===Dw||le.mapping===R2),lightMap:!!q.lightMap,lightMapEncoding:L(q.lightMap),aoMap:!!q.aoMap,emissiveMap:!!q.emissiveMap,emissiveMapEncoding:L(q.emissiveMap),bumpMap:!!q.bumpMap,normalMap:!!q.normalMap,objectSpaceNormalMap:q.normalMapType===vq,tangentSpaceNormalMap:q.normalMapType===Qg,clearcoat:Ke,clearcoatMap:Ke&&!!q.clearcoatMap,clearcoatRoughnessMap:Ke&&!!q.clearcoatRoughnessMap,clearcoatNormalMap:Ke&&!!q.clearcoatNormalMap,displacementMap:!!q.displacementMap,roughnessMap:!!q.roughnessMap,metalnessMap:!!q.metalnessMap,specularMap:!!q.specularMap,specularIntensityMap:!!q.specularIntensityMap,specularColorMap:!!q.specularColorMap,specularColorMapEncoding:L(q.specularColorMap),alphaMap:!!q.alphaMap,alphaTest:tt,gradientMap:!!q.gradientMap,sheen:q.sheen>0,sheenColorMap:!!q.sheenColorMap,sheenColorMapEncoding:L(q.sheenColorMap),sheenRoughnessMap:!!q.sheenRoughnessMap,transmission:q.transmission>0,transmissionMap:!!q.transmissionMap,thicknessMap:!!q.thicknessMap,combine:q.combine,vertexTangents:!!q.normalMap&&!!B.geometry&&!!B.geometry.attributes.tangent,vertexColors:q.vertexColors,vertexAlphas:q.vertexColors===!0&&!!B.geometry&&!!B.geometry.attributes.color&&B.geometry.attributes.color.itemSize===4,vertexUvs:!!q.map||!!q.bumpMap||!!q.normalMap||!!q.specularMap||!!q.alphaMap||!!q.emissiveMap||!!q.roughnessMap||!!q.metalnessMap||!!q.clearcoatMap||!!q.clearcoatRoughnessMap||!!q.clearcoatNormalMap||!!q.displacementMap||!!q.transmissionMap||!!q.thicknessMap||!!q.specularIntensityMap||!!q.specularColorMap||!!q.sheenColorMap||q.sheenRoughnessMap,uvsVertexOnly:!(q.map||q.bumpMap||q.normalMap||q.specularMap||q.alphaMap||q.emissiveMap||q.roughnessMap||q.metalnessMap||q.clearcoatNormalMap||q.transmission>0||q.transmissionMap||q.thicknessMap||q.specularIntensityMap||q.specularColorMap||!!q.sheen>0||q.sheenColorMap||q.sheenRoughnessMap)&&!!q.displacementMap,fog:!!ne,useFog:q.fog,fogExp2:ne&&ne.isFogExp2,flatShading:!!q.flatShading,sizeAttenuation:q.sizeAttenuation,logarithmicDepthBuffer:p,skinning:B.isSkinnedMesh===!0&&pe>0,maxBones:pe,useVertexTexture:g,morphTargets:!!B.geometry&&!!B.geometry.morphAttributes.position,morphNormals:!!B.geometry&&!!B.geometry.morphAttributes.normal,morphTargetsCount:B.geometry&&B.geometry.morphAttributes.position?B.geometry.morphAttributes.position.length:0,numDirLights:U.directional.length,numPointLights:U.point.length,numSpotLights:U.spot.length,numRectAreaLights:U.rectArea.length,numHemiLights:U.hemi.length,numDirLightShadows:U.directionalShadowMap.length,numPointLightShadows:U.pointShadowMap.length,numSpotLightShadows:U.spotShadowMap.length,numClippingPlanes:c.numPlanes,numClipIntersection:c.numIntersection,format:q.format,dithering:q.dithering,shadowMapEnabled:n.shadowMap.enabled&&G.length>0,shadowMapType:n.shadowMap.type,toneMapping:q.toneMapped?n.toneMapping:ip,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:q.premultipliedAlpha,doubleSided:q.side===Ko,flipSided:q.side===Gs,depthPacking:q.depthPacking!==void 0?q.depthPacking:!1,index0AttributeName:q.index0AttributeName,extensionDerivatives:q.extensions&&q.extensions.derivatives,extensionFragDepth:q.extensions&&q.extensions.fragDepth,extensionDrawBuffers:q.extensions&&q.extensions.drawBuffers,extensionShaderTextureLOD:q.extensions&&q.extensions.shaderTextureLOD,rendererExtensionFragDepth:f||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:f||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:f||i.has("EXT_shader_texture_lod"),customProgramCacheKey:q.customProgramCacheKey()}}function F(q){const U=[];if(q.shaderID?U.push(q.shaderID):(U.push(wI(q.fragmentShader)),U.push(wI(q.vertexShader))),q.defines!==void 0)for(const G in q.defines)U.push(G),U.push(q.defines[G]);if(q.isRawShaderMaterial===!1){for(let G=0;G<P.length;G++)U.push(q[P[G]]);U.push(n.outputEncoding),U.push(n.gammaFactor)}return U.push(q.customProgramCacheKey),U.join()}function N(q){const U=M[q.type];let G;if(U){const j=Qc[U];G=Zq.clone(j.uniforms)}else G=q.uniforms;return G}function H(q,U){let G;for(let j=0,B=s.length;j<B;j++){const ne=s[j];if(ne.cacheKey===U){G=ne,++G.usedTimes;break}}return G===void 0&&(G=new XZ(n,U,q,o),s.push(G)),G}function Y(q){if(--q.usedTimes===0){const U=s.indexOf(q);s[U]=s[s.length-1],s.pop(),q.destroy()}}return{getParameters:I,getProgramCacheKey:F,getUniforms:N,acquireProgram:H,releaseProgram:Y,programs:s}}function KZ(){let n=new WeakMap;function e(o){let c=n.get(o);return c===void 0&&(c={},n.set(o,c)),c}function t(o){n.delete(o)}function i(o,c,s){n.get(o)[c]=s}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function JZ(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.program!==e.program?n.program.id-e.program.id:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function QI(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function e3(n){const e=[];let t=0;const i=[],r=[],o=[],c={id:-1};function s(){t=0,i.length=0,r.length=0,o.length=0}function f(b,M,P,k,L,I){let F=e[t];const N=n.get(P);return F===void 0?(F={id:b.id,object:b,geometry:M,material:P,program:N.program||c,groupOrder:k,renderOrder:b.renderOrder,z:L,group:I},e[t]=F):(F.id=b.id,F.object=b,F.geometry=M,F.material=P,F.program=N.program||c,F.groupOrder=k,F.renderOrder=b.renderOrder,F.z=L,F.group=I),t++,F}function p(b,M,P,k,L,I){const F=f(b,M,P,k,L,I);P.transmission>0?r.push(F):P.transparent===!0?o.push(F):i.push(F)}function g(b,M,P,k,L,I){const F=f(b,M,P,k,L,I);P.transmission>0?r.unshift(F):P.transparent===!0?o.unshift(F):i.unshift(F)}function _(b,M){i.length>1&&i.sort(b||JZ),r.length>1&&r.sort(M||QI),o.length>1&&o.sort(M||QI)}function x(){for(let b=t,M=e.length;b<M;b++){const P=e[b];if(P.id===null)break;P.id=null,P.object=null,P.geometry=null,P.material=null,P.program=null,P.group=null}}return{opaque:i,transmissive:r,transparent:o,init:s,push:p,unshift:g,finish:x,sort:_}}function QZ(n){let e=new WeakMap;function t(r,o){let c;return e.has(r)===!1?(c=new e3(n),e.set(r,[c])):o>=e.get(r).length?(c=new e3(n),e.get(r).push(c)):c=e.get(r)[o],c}function i(){e=new WeakMap}return{get:t,dispose:i}}function eX(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Fe,color:new Bi};break;case"SpotLight":t={position:new Fe,direction:new Fe,color:new Bi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Fe,color:new Bi,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Fe,skyColor:new Bi,groundColor:new Bi};break;case"RectAreaLight":t={color:new Bi,position:new Fe,halfWidth:new Fe,halfHeight:new Fe};break}return n[e.id]=t,t}}}function tX(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new li};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new li};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new li,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let iX=0;function nX(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function rX(n,e){const t=new eX,i=tX(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let g=0;g<9;g++)r.probe.push(new Fe);const o=new Fe,c=new Ri,s=new Ri;function f(g,_){let x=0,b=0,M=0;for(let G=0;G<9;G++)r.probe[G].set(0,0,0);let P=0,k=0,L=0,I=0,F=0,N=0,H=0,Y=0;g.sort(nX);const q=_!==!0?Math.PI:1;for(let G=0,j=g.length;G<j;G++){const B=g[G],ne=B.color,J=B.intensity,le=B.distance,ae=B.shadow&&B.shadow.map?B.shadow.map.texture:null;if(B.isAmbientLight)x+=ne.r*J*q,b+=ne.g*J*q,M+=ne.b*J*q;else if(B.isLightProbe)for(let pe=0;pe<9;pe++)r.probe[pe].addScaledVector(B.sh.coefficients[pe],J);else if(B.isDirectionalLight){const pe=t.get(B);if(pe.color.copy(B.color).multiplyScalar(B.intensity*q),B.castShadow){const fe=B.shadow,Te=i.get(B);Te.shadowBias=fe.bias,Te.shadowNormalBias=fe.normalBias,Te.shadowRadius=fe.radius,Te.shadowMapSize=fe.mapSize,r.directionalShadow[P]=Te,r.directionalShadowMap[P]=ae,r.directionalShadowMatrix[P]=B.shadow.matrix,N++}r.directional[P]=pe,P++}else if(B.isSpotLight){const pe=t.get(B);if(pe.position.setFromMatrixPosition(B.matrixWorld),pe.color.copy(ne).multiplyScalar(J*q),pe.distance=le,pe.coneCos=Math.cos(B.angle),pe.penumbraCos=Math.cos(B.angle*(1-B.penumbra)),pe.decay=B.decay,B.castShadow){const fe=B.shadow,Te=i.get(B);Te.shadowBias=fe.bias,Te.shadowNormalBias=fe.normalBias,Te.shadowRadius=fe.radius,Te.shadowMapSize=fe.mapSize,r.spotShadow[L]=Te,r.spotShadowMap[L]=ae,r.spotShadowMatrix[L]=B.shadow.matrix,Y++}r.spot[L]=pe,L++}else if(B.isRectAreaLight){const pe=t.get(B);pe.color.copy(ne).multiplyScalar(J),pe.halfWidth.set(B.width*.5,0,0),pe.halfHeight.set(0,B.height*.5,0),r.rectArea[I]=pe,I++}else if(B.isPointLight){const pe=t.get(B);if(pe.color.copy(B.color).multiplyScalar(B.intensity*q),pe.distance=B.distance,pe.decay=B.decay,B.castShadow){const fe=B.shadow,Te=i.get(B);Te.shadowBias=fe.bias,Te.shadowNormalBias=fe.normalBias,Te.shadowRadius=fe.radius,Te.shadowMapSize=fe.mapSize,Te.shadowCameraNear=fe.camera.near,Te.shadowCameraFar=fe.camera.far,r.pointShadow[k]=Te,r.pointShadowMap[k]=ae,r.pointShadowMatrix[k]=B.shadow.matrix,H++}r.point[k]=pe,k++}else if(B.isHemisphereLight){const pe=t.get(B);pe.skyColor.copy(B.color).multiplyScalar(J*q),pe.groundColor.copy(B.groundColor).multiplyScalar(J*q),r.hemi[F]=pe,F++}}I>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=xi.LTC_FLOAT_1,r.rectAreaLTC2=xi.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=xi.LTC_HALF_1,r.rectAreaLTC2=xi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=x,r.ambient[1]=b,r.ambient[2]=M;const U=r.hash;(U.directionalLength!==P||U.pointLength!==k||U.spotLength!==L||U.rectAreaLength!==I||U.hemiLength!==F||U.numDirectionalShadows!==N||U.numPointShadows!==H||U.numSpotShadows!==Y)&&(r.directional.length=P,r.spot.length=L,r.rectArea.length=I,r.point.length=k,r.hemi.length=F,r.directionalShadow.length=N,r.directionalShadowMap.length=N,r.pointShadow.length=H,r.pointShadowMap.length=H,r.spotShadow.length=Y,r.spotShadowMap.length=Y,r.directionalShadowMatrix.length=N,r.pointShadowMatrix.length=H,r.spotShadowMatrix.length=Y,U.directionalLength=P,U.pointLength=k,U.spotLength=L,U.rectAreaLength=I,U.hemiLength=F,U.numDirectionalShadows=N,U.numPointShadows=H,U.numSpotShadows=Y,r.version=iX++)}function p(g,_){let x=0,b=0,M=0,P=0,k=0;const L=_.matrixWorldInverse;for(let I=0,F=g.length;I<F;I++){const N=g[I];if(N.isDirectionalLight){const H=r.directional[x];H.direction.setFromMatrixPosition(N.matrixWorld),o.setFromMatrixPosition(N.target.matrixWorld),H.direction.sub(o),H.direction.transformDirection(L),x++}else if(N.isSpotLight){const H=r.spot[M];H.position.setFromMatrixPosition(N.matrixWorld),H.position.applyMatrix4(L),H.direction.setFromMatrixPosition(N.matrixWorld),o.setFromMatrixPosition(N.target.matrixWorld),H.direction.sub(o),H.direction.transformDirection(L),M++}else if(N.isRectAreaLight){const H=r.rectArea[P];H.position.setFromMatrixPosition(N.matrixWorld),H.position.applyMatrix4(L),s.identity(),c.copy(N.matrixWorld),c.premultiply(L),s.extractRotation(c),H.halfWidth.set(N.width*.5,0,0),H.halfHeight.set(0,N.height*.5,0),H.halfWidth.applyMatrix4(s),H.halfHeight.applyMatrix4(s),P++}else if(N.isPointLight){const H=r.point[b];H.position.setFromMatrixPosition(N.matrixWorld),H.position.applyMatrix4(L),b++}else if(N.isHemisphereLight){const H=r.hemi[k];H.direction.setFromMatrixPosition(N.matrixWorld),H.direction.transformDirection(L),H.direction.normalize(),k++}}}return{setup:f,setupView:p,state:r}}function t3(n,e){const t=new rX(n,e),i=[],r=[];function o(){i.length=0,r.length=0}function c(_){i.push(_)}function s(_){r.push(_)}function f(_){t.setup(i,_)}function p(_){t.setupView(i,_)}return{init:o,state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:f,setupLightsView:p,pushLight:c,pushShadow:s}}function sX(n,e){let t=new WeakMap;function i(o,c=0){let s;return t.has(o)===!1?(s=new t3(n,e),t.set(o,[s])):c>=t.get(o).length?(s=new t3(n,e),t.get(o).push(s)):s=t.get(o)[c],s}function r(){t=new WeakMap}return{get:i,dispose:r}}class RF extends Bo{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=gq,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}RF.prototype.isMeshDepthMaterial=!0;class kF extends Bo{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Fe,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}kF.prototype.isMeshDistanceMaterial=!0;const oX=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,aX=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function DF(n,e,t){let i=new Bw;const r=new li,o=new li,c=new Zn,s=new RF({depthPacking:_q}),f=new kF,p={},g=t.maxTextureSize,_={0:Gs,1:zg,2:Ko},x=new Jo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new li},radius:{value:4}},vertexShader:oX,fragmentShader:aX}),b=x.clone();b.defines.HORIZONTAL_PASS=1;const M=new $n;M.setAttribute("position",new Mn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const P=new kr(M,x),k=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=rF,this.render=function(N,H,Y){if(k.enabled===!1||k.autoUpdate===!1&&k.needsUpdate===!1||N.length===0)return;const q=n.getRenderTarget(),U=n.getActiveCubeFace(),G=n.getActiveMipmapLevel(),j=n.state;j.setBlending(Ed),j.buffers.color.setClear(1,1,1,1),j.buffers.depth.setTest(!0),j.setScissorTest(!1);for(let B=0,ne=N.length;B<ne;B++){const J=N[B],le=J.shadow;if(le===void 0){console.warn("THREE.WebGLShadowMap:",J,"has no shadow.");continue}if(le.autoUpdate===!1&&le.needsUpdate===!1)continue;r.copy(le.mapSize);const ae=le.getFrameExtents();if(r.multiply(ae),o.copy(le.mapSize),(r.x>g||r.y>g)&&(r.x>g&&(o.x=Math.floor(g/ae.x),r.x=o.x*ae.x,le.mapSize.x=o.x),r.y>g&&(o.y=Math.floor(g/ae.y),r.y=o.y*ae.y,le.mapSize.y=o.y)),le.map===null&&!le.isPointLightShadow&&this.type===Dv){const fe={minFilter:Ro,magFilter:Ro,format:oa};le.map=new xc(r.x,r.y,fe),le.map.texture.name=J.name+".shadowMap",le.mapPass=new xc(r.x,r.y,fe),le.camera.updateProjectionMatrix()}if(le.map===null){const fe={minFilter:Ws,magFilter:Ws,format:oa};le.map=new xc(r.x,r.y,fe),le.map.texture.name=J.name+".shadowMap",le.camera.updateProjectionMatrix()}n.setRenderTarget(le.map),n.clear();const pe=le.getViewportCount();for(let fe=0;fe<pe;fe++){const Te=le.getViewport(fe);c.set(o.x*Te.x,o.y*Te.y,o.x*Te.z,o.y*Te.w),j.viewport(c),le.updateMatrices(J,fe),i=le.getFrustum(),F(H,Y,le.camera,J,this.type)}!le.isPointLightShadow&&this.type===Dv&&L(le,Y),le.needsUpdate=!1}k.needsUpdate=!1,n.setRenderTarget(q,U,G)};function L(N,H){const Y=e.update(P);x.defines.VSM_SAMPLES!==N.blurSamples&&(x.defines.VSM_SAMPLES=N.blurSamples,b.defines.VSM_SAMPLES=N.blurSamples,x.needsUpdate=!0,b.needsUpdate=!0),x.uniforms.shadow_pass.value=N.map.texture,x.uniforms.resolution.value=N.mapSize,x.uniforms.radius.value=N.radius,n.setRenderTarget(N.mapPass),n.clear(),n.renderBufferDirect(H,null,Y,x,P,null),b.uniforms.shadow_pass.value=N.mapPass.texture,b.uniforms.resolution.value=N.mapSize,b.uniforms.radius.value=N.radius,n.setRenderTarget(N.map),n.clear(),n.renderBufferDirect(H,null,Y,b,P,null)}function I(N,H,Y,q,U,G,j){let B=null;const ne=q.isPointLight===!0?N.customDistanceMaterial:N.customDepthMaterial;if(ne!==void 0?B=ne:B=q.isPointLight===!0?f:s,n.localClippingEnabled&&Y.clipShadows===!0&&Y.clippingPlanes.length!==0||Y.displacementMap&&Y.displacementScale!==0||Y.alphaMap&&Y.alphaTest>0){const J=B.uuid,le=Y.uuid;let ae=p[J];ae===void 0&&(ae={},p[J]=ae);let pe=ae[le];pe===void 0&&(pe=B.clone(),ae[le]=pe),B=pe}return B.visible=Y.visible,B.wireframe=Y.wireframe,j===Dv?B.side=Y.shadowSide!==null?Y.shadowSide:Y.side:B.side=Y.shadowSide!==null?Y.shadowSide:_[Y.side],B.alphaMap=Y.alphaMap,B.alphaTest=Y.alphaTest,B.clipShadows=Y.clipShadows,B.clippingPlanes=Y.clippingPlanes,B.clipIntersection=Y.clipIntersection,B.displacementMap=Y.displacementMap,B.displacementScale=Y.displacementScale,B.displacementBias=Y.displacementBias,B.wireframeLinewidth=Y.wireframeLinewidth,B.linewidth=Y.linewidth,q.isPointLight===!0&&B.isMeshDistanceMaterial===!0&&(B.referencePosition.setFromMatrixPosition(q.matrixWorld),B.nearDistance=U,B.farDistance=G),B}function F(N,H,Y,q,U){if(N.visible===!1)return;if(N.layers.test(H.layers)&&(N.isMesh||N.isLine||N.isPoints)&&(N.castShadow||N.receiveShadow&&U===Dv)&&(!N.frustumCulled||i.intersectsObject(N))){N.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,N.matrixWorld);const B=e.update(N),ne=N.material;if(Array.isArray(ne)){const J=B.groups;for(let le=0,ae=J.length;le<ae;le++){const pe=J[le],fe=ne[pe.materialIndex];if(fe&&fe.visible){const Te=I(N,B,fe,q,Y.near,Y.far,U);n.renderBufferDirect(Y,null,B,Te,N,pe)}}}else if(ne.visible){const J=I(N,B,ne,q,Y.near,Y.far,U);n.renderBufferDirect(Y,null,B,J,N,null)}}const j=N.children;for(let B=0,ne=j.length;B<ne;B++)F(j[B],H,Y,q,U)}}function lX(n,e,t){const i=t.isWebGL2;function r(){let Q=!1;const ue=new Zn;let de=null;const Pe=new Zn(0,0,0,0);return{setMask:function(Re){de!==Re&&!Q&&(n.colorMask(Re,Re,Re,Re),de=Re)},setLocked:function(Re){Q=Re},setClear:function(Re,rt,ot,Xe,mt){mt===!0&&(Re*=Xe,rt*=Xe,ot*=Xe),ue.set(Re,rt,ot,Xe),Pe.equals(ue)===!1&&(n.clearColor(Re,rt,ot,Xe),Pe.copy(ue))},reset:function(){Q=!1,de=null,Pe.set(-1,0,0,0)}}}function o(){let Q=!1,ue=null,de=null,Pe=null;return{setTest:function(Re){Re?Oe(2929):lt(2929)},setMask:function(Re){ue!==Re&&!Q&&(n.depthMask(Re),ue=Re)},setFunc:function(Re){if(de!==Re){if(Re)switch(Re){case r7:n.depthFunc(512);break;case s7:n.depthFunc(519);break;case o7:n.depthFunc(513);break;case hM:n.depthFunc(515);break;case a7:n.depthFunc(514);break;case l7:n.depthFunc(518);break;case c7:n.depthFunc(516);break;case u7:n.depthFunc(517);break;default:n.depthFunc(515)}else n.depthFunc(515);de=Re}},setLocked:function(Re){Q=Re},setClear:function(Re){Pe!==Re&&(n.clearDepth(Re),Pe=Re)},reset:function(){Q=!1,ue=null,de=null,Pe=null}}}function c(){let Q=!1,ue=null,de=null,Pe=null,Re=null,rt=null,ot=null,Xe=null,mt=null;return{setTest:function(Et){Q||(Et?Oe(2960):lt(2960))},setMask:function(Et){ue!==Et&&!Q&&(n.stencilMask(Et),ue=Et)},setFunc:function(Et,kt,Jt){(de!==Et||Pe!==kt||Re!==Jt)&&(n.stencilFunc(Et,kt,Jt),de=Et,Pe=kt,Re=Jt)},setOp:function(Et,kt,Jt){(rt!==Et||ot!==kt||Xe!==Jt)&&(n.stencilOp(Et,kt,Jt),rt=Et,ot=kt,Xe=Jt)},setLocked:function(Et){Q=Et},setClear:function(Et){mt!==Et&&(n.clearStencil(Et),mt=Et)},reset:function(){Q=!1,ue=null,de=null,Pe=null,Re=null,rt=null,ot=null,Xe=null,mt=null}}}const s=new r,f=new o,p=new c;let g={},_=null,x={},b=null,M=!1,P=null,k=null,L=null,I=null,F=null,N=null,H=null,Y=!1,q=null,U=null,G=null,j=null,B=null;const ne=n.getParameter(35661);let J=!1,le=0;const ae=n.getParameter(7938);ae.indexOf("WebGL")!==-1?(le=parseFloat(/^WebGL (\d)/.exec(ae)[1]),J=le>=1):ae.indexOf("OpenGL ES")!==-1&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ae)[1]),J=le>=2);let pe=null,fe={};const Te=n.getParameter(3088),Ce=n.getParameter(2978),tt=new Zn().fromArray(Te),Ke=new Zn().fromArray(Ce);function dt(Q,ue,de){const Pe=new Uint8Array(4),Re=n.createTexture();n.bindTexture(Q,Re),n.texParameteri(Q,10241,9728),n.texParameteri(Q,10240,9728);for(let rt=0;rt<de;rt++)n.texImage2D(ue+rt,0,6408,1,1,0,6408,5121,Pe);return Re}const et={};et[3553]=dt(3553,3553,1),et[34067]=dt(34067,34069,6),s.setClear(0,0,0,1),f.setClear(1),p.setClear(0),Oe(2929),f.setFunc(hM),bt(!1),Mt(nI),Oe(2884),$t(Ed);function Oe(Q){g[Q]!==!0&&(n.enable(Q),g[Q]=!0)}function lt(Q){g[Q]!==!1&&(n.disable(Q),g[Q]=!1)}function Ye(Q){Q!==_&&(n.bindFramebuffer(36160,Q),_=Q)}function zt(Q,ue){return ue===null&&_!==null&&(ue=_),x[Q]!==ue?(n.bindFramebuffer(Q,ue),x[Q]=ue,i&&(Q===36009&&(x[36160]=ue),Q===36160&&(x[36009]=ue)),!0):!1}function Lt(Q){return b!==Q?(n.useProgram(Q),b=Q,!0):!1}const At={[lg]:32774,[WG]:32778,[ZG]:32779};if(i)At[aI]=32775,At[lI]=32776;else{const Q=e.get("EXT_blend_minmax");Q!==null&&(At[aI]=Q.MIN_EXT,At[lI]=Q.MAX_EXT)}const Nt={[XG]:0,[YG]:1,[KG]:768,[oF]:770,[n7]:776,[t7]:774,[QG]:772,[JG]:769,[aF]:771,[i7]:775,[e7]:773};function $t(Q,ue,de,Pe,Re,rt,ot,Xe){if(Q===Ed){M===!0&&(lt(3042),M=!1);return}if(M===!1&&(Oe(3042),M=!0),Q!==HG){if(Q!==P||Xe!==Y){if((k!==lg||F!==lg)&&(n.blendEquation(32774),k=lg,F=lg),Xe)switch(Q){case ey:n.blendFuncSeparate(1,771,1,771);break;case rI:n.blendFunc(1,1);break;case sI:n.blendFuncSeparate(0,0,769,771);break;case oI:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q);break}else switch(Q){case ey:n.blendFuncSeparate(770,771,1,771);break;case rI:n.blendFunc(770,1);break;case sI:n.blendFunc(0,769);break;case oI:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q);break}L=null,I=null,N=null,H=null,P=Q,Y=Xe}return}Re=Re||ue,rt=rt||de,ot=ot||Pe,(ue!==k||Re!==F)&&(n.blendEquationSeparate(At[ue],At[Re]),k=ue,F=Re),(de!==L||Pe!==I||rt!==N||ot!==H)&&(n.blendFuncSeparate(Nt[de],Nt[Pe],Nt[rt],Nt[ot]),L=de,I=Pe,N=rt,H=ot),P=Q,Y=null}function Ze(Q,ue){Q.side===Ko?lt(2884):Oe(2884);let de=Q.side===Gs;ue&&(de=!de),bt(de),Q.blending===ey&&Q.transparent===!1?$t(Ed):$t(Q.blending,Q.blendEquation,Q.blendSrc,Q.blendDst,Q.blendEquationAlpha,Q.blendSrcAlpha,Q.blendDstAlpha,Q.premultipliedAlpha),f.setFunc(Q.depthFunc),f.setTest(Q.depthTest),f.setMask(Q.depthWrite),s.setMask(Q.colorWrite);const Pe=Q.stencilWrite;p.setTest(Pe),Pe&&(p.setMask(Q.stencilWriteMask),p.setFunc(Q.stencilFunc,Q.stencilRef,Q.stencilFuncMask),p.setOp(Q.stencilFail,Q.stencilZFail,Q.stencilZPass)),Pt(Q.polygonOffset,Q.polygonOffsetFactor,Q.polygonOffsetUnits),Q.alphaToCoverage===!0?Oe(32926):lt(32926)}function bt(Q){q!==Q&&(Q?n.frontFace(2304):n.frontFace(2305),q=Q)}function Mt(Q){Q!==jG?(Oe(2884),Q!==U&&(Q===nI?n.cullFace(1029):Q===GG?n.cullFace(1028):n.cullFace(1032))):lt(2884),U=Q}function Zt(Q){Q!==G&&(J&&n.lineWidth(Q),G=Q)}function Pt(Q,ue,de){Q?(Oe(32823),(j!==ue||B!==de)&&(n.polygonOffset(ue,de),j=ue,B=de)):lt(32823)}function Ee(Q){Q?Oe(3089):lt(3089)}function xe(Q){Q===void 0&&(Q=33984+ne-1),pe!==Q&&(n.activeTexture(Q),pe=Q)}function ft(Q,ue){pe===null&&xe();let de=fe[pe];de===void 0&&(de={type:void 0,texture:void 0},fe[pe]=de),(de.type!==Q||de.texture!==ue)&&(n.bindTexture(Q,ue||et[Q]),de.type=Q,de.texture=ue)}function ve(){const Q=fe[pe];Q!==void 0&&Q.type!==void 0&&(n.bindTexture(Q.type,null),Q.type=void 0,Q.texture=void 0)}function te(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function se(){try{n.texImage2D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Ie(){try{n.texImage3D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Ue(Q){tt.equals(Q)===!1&&(n.scissor(Q.x,Q.y,Q.z,Q.w),tt.copy(Q))}function ct(Q){Ke.equals(Q)===!1&&(n.viewport(Q.x,Q.y,Q.z,Q.w),Ke.copy(Q))}function we(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),g={},pe=null,fe={},_=null,x={},b=null,M=!1,P=null,k=null,L=null,I=null,F=null,N=null,H=null,Y=!1,q=null,U=null,G=null,j=null,B=null,tt.set(0,0,n.canvas.width,n.canvas.height),Ke.set(0,0,n.canvas.width,n.canvas.height),s.reset(),f.reset(),p.reset()}return{buffers:{color:s,depth:f,stencil:p},enable:Oe,disable:lt,bindFramebuffer:zt,bindXRFramebuffer:Ye,useProgram:Lt,setBlending:$t,setMaterial:Ze,setFlipSided:bt,setCullFace:Mt,setLineWidth:Zt,setPolygonOffset:Pt,setScissorTest:Ee,activeTexture:xe,bindTexture:ft,unbindTexture:ve,compressedTexImage2D:te,texImage2D:se,texImage3D:Ie,scissor:Ue,viewport:ct,reset:we}}function cX(n,e,t,i,r,o,c){const s=r.isWebGL2,f=r.maxTextures,p=r.maxCubemapSize,g=r.maxTextureSize,_=r.maxSamples,x=new WeakMap;let b,M=!1;try{M=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function P(Ee,xe){return M?new OffscreenCanvas(Ee,xe):Ow("canvas")}function k(Ee,xe,ft,ve){let te=1;if((Ee.width>ve||Ee.height>ve)&&(te=ve/Math.max(Ee.width,Ee.height)),te<1||xe===!0)if(typeof HTMLImageElement<"u"&&Ee instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ee instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ee instanceof ImageBitmap){const se=xe?fF:Math.floor,Ie=se(te*Ee.width),Ue=se(te*Ee.height);b===void 0&&(b=P(Ie,Ue));const ct=ft?P(Ie,Ue):b;return ct.width=Ie,ct.height=Ue,ct.getContext("2d").drawImage(Ee,0,0,Ie,Ue),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ee.width+"x"+Ee.height+") to ("+Ie+"x"+Ue+")."),ct}else return"data"in Ee&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ee.width+"x"+Ee.height+")."),Ee;return Ee}function L(Ee){return gM(Ee.width)&&gM(Ee.height)}function I(Ee){return s?!1:Ee.wrapS!==Qa||Ee.wrapT!==Qa||Ee.minFilter!==Ws&&Ee.minFilter!==Ro}function F(Ee,xe){return Ee.generateMipmaps&&xe&&Ee.minFilter!==Ws&&Ee.minFilter!==Ro}function N(Ee,xe,ft,ve,te=1){n.generateMipmap(Ee);const se=i.get(xe);se.__maxMipLevel=Math.log2(Math.max(ft,ve,te))}function H(Ee,xe,ft,ve){if(s===!1)return xe;if(Ee!==null){if(n[Ee]!==void 0)return n[Ee];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ee+"'")}let te=xe;return xe===6403&&(ft===5126&&(te=33326),ft===5131&&(te=33325),ft===5121&&(te=33321)),xe===6407&&(ft===5126&&(te=34837),ft===5131&&(te=34843),ft===5121&&(te=32849)),xe===6408&&(ft===5126&&(te=34836),ft===5131&&(te=34842),ft===5121&&(te=ve===yp?35907:32856)),(te===33325||te===33326||te===34842||te===34836)&&e.get("EXT_color_buffer_float"),te}function Y(Ee){return Ee===Ws||Ee===cI||Ee===uI?9728:9729}function q(Ee){const xe=Ee.target;xe.removeEventListener("dispose",q),G(xe),xe.isVideoTexture&&x.delete(xe),c.memory.textures--}function U(Ee){const xe=Ee.target;xe.removeEventListener("dispose",U),j(xe)}function G(Ee){const xe=i.get(Ee);xe.__webglInit!==void 0&&(n.deleteTexture(xe.__webglTexture),i.remove(Ee))}function j(Ee){const xe=Ee.texture,ft=i.get(Ee),ve=i.get(xe);if(Ee){if(ve.__webglTexture!==void 0&&(n.deleteTexture(ve.__webglTexture),c.memory.textures--),Ee.depthTexture&&Ee.depthTexture.dispose(),Ee.isWebGLCubeRenderTarget)for(let te=0;te<6;te++)n.deleteFramebuffer(ft.__webglFramebuffer[te]),ft.__webglDepthbuffer&&n.deleteRenderbuffer(ft.__webglDepthbuffer[te]);else n.deleteFramebuffer(ft.__webglFramebuffer),ft.__webglDepthbuffer&&n.deleteRenderbuffer(ft.__webglDepthbuffer),ft.__webglMultisampledFramebuffer&&n.deleteFramebuffer(ft.__webglMultisampledFramebuffer),ft.__webglColorRenderbuffer&&n.deleteRenderbuffer(ft.__webglColorRenderbuffer),ft.__webglDepthRenderbuffer&&n.deleteRenderbuffer(ft.__webglDepthRenderbuffer);if(Ee.isWebGLMultipleRenderTargets)for(let te=0,se=xe.length;te<se;te++){const Ie=i.get(xe[te]);Ie.__webglTexture&&(n.deleteTexture(Ie.__webglTexture),c.memory.textures--),i.remove(xe[te])}i.remove(xe),i.remove(Ee)}}let B=0;function ne(){B=0}function J(){const Ee=B;return Ee>=f&&console.warn("THREE.WebGLTextures: Trying to use "+Ee+" texture units while this GPU supports only "+f),B+=1,Ee}function le(Ee,xe){const ft=i.get(Ee);if(Ee.isVideoTexture&&Ze(Ee),Ee.version>0&&ft.__version!==Ee.version){const ve=Ee.image;if(ve===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(ve.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{dt(ft,Ee,xe);return}}t.activeTexture(33984+xe),t.bindTexture(3553,ft.__webglTexture)}function ae(Ee,xe){const ft=i.get(Ee);if(Ee.version>0&&ft.__version!==Ee.version){dt(ft,Ee,xe);return}t.activeTexture(33984+xe),t.bindTexture(35866,ft.__webglTexture)}function pe(Ee,xe){const ft=i.get(Ee);if(Ee.version>0&&ft.__version!==Ee.version){dt(ft,Ee,xe);return}t.activeTexture(33984+xe),t.bindTexture(32879,ft.__webglTexture)}function fe(Ee,xe){const ft=i.get(Ee);if(Ee.version>0&&ft.__version!==Ee.version){et(ft,Ee,xe);return}t.activeTexture(33984+xe),t.bindTexture(34067,ft.__webglTexture)}const Te={[pM]:10497,[Qa]:33071,[mM]:33648},Ce={[Ws]:9728,[cI]:9984,[uI]:9986,[Ro]:9729,[v7]:9985,[Fw]:9987};function tt(Ee,xe,ft){if(ft?(n.texParameteri(Ee,10242,Te[xe.wrapS]),n.texParameteri(Ee,10243,Te[xe.wrapT]),(Ee===32879||Ee===35866)&&n.texParameteri(Ee,32882,Te[xe.wrapR]),n.texParameteri(Ee,10240,Ce[xe.magFilter]),n.texParameteri(Ee,10241,Ce[xe.minFilter])):(n.texParameteri(Ee,10242,33071),n.texParameteri(Ee,10243,33071),(Ee===32879||Ee===35866)&&n.texParameteri(Ee,32882,33071),(xe.wrapS!==Qa||xe.wrapT!==Qa)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(Ee,10240,Y(xe.magFilter)),n.texParameteri(Ee,10241,Y(xe.minFilter)),xe.minFilter!==Ws&&xe.minFilter!==Ro&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const ve=e.get("EXT_texture_filter_anisotropic");if(xe.type===wd&&e.has("OES_texture_float_linear")===!1||s===!1&&xe.type===Sg&&e.has("OES_texture_half_float_linear")===!1)return;(xe.anisotropy>1||i.get(xe).__currentAnisotropy)&&(n.texParameterf(Ee,ve.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(xe.anisotropy,r.getMaxAnisotropy())),i.get(xe).__currentAnisotropy=xe.anisotropy)}}function Ke(Ee,xe){Ee.__webglInit===void 0&&(Ee.__webglInit=!0,xe.addEventListener("dispose",q),Ee.__webglTexture=n.createTexture(),c.memory.textures++)}function dt(Ee,xe,ft){let ve=3553;xe.isDataTexture2DArray&&(ve=35866),xe.isDataTexture3D&&(ve=32879),Ke(Ee,xe),t.activeTexture(33984+ft),t.bindTexture(ve,Ee.__webglTexture),n.pixelStorei(37440,xe.flipY),n.pixelStorei(37441,xe.premultiplyAlpha),n.pixelStorei(3317,xe.unpackAlignment),n.pixelStorei(37443,0);const te=I(xe)&&L(xe.image)===!1,se=k(xe.image,te,!1,g),Ie=L(se)||s,Ue=o.convert(xe.format);let ct=o.convert(xe.type),we=H(xe.internalFormat,Ue,ct,xe.encoding);tt(ve,xe,Ie);let Q;const ue=xe.mipmaps;if(xe.isDepthTexture)we=6402,s?xe.type===wd?we=36012:xe.type===Tx?we=33190:xe.type===ty?we=35056:we=33189:xe.type===wd&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),xe.format===Tg&&we===6402&&xe.type!==Jx&&xe.type!==Tx&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),xe.type=Jx,ct=o.convert(xe.type)),xe.format===Sy&&we===6402&&(we=34041,xe.type!==ty&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),xe.type=ty,ct=o.convert(xe.type))),t.texImage2D(3553,0,we,se.width,se.height,0,Ue,ct,null);else if(xe.isDataTexture)if(ue.length>0&&Ie){for(let de=0,Pe=ue.length;de<Pe;de++)Q=ue[de],t.texImage2D(3553,de,we,Q.width,Q.height,0,Ue,ct,Q.data);xe.generateMipmaps=!1,Ee.__maxMipLevel=ue.length-1}else t.texImage2D(3553,0,we,se.width,se.height,0,Ue,ct,se.data),Ee.__maxMipLevel=0;else if(xe.isCompressedTexture){for(let de=0,Pe=ue.length;de<Pe;de++)Q=ue[de],xe.format!==oa&&xe.format!==np?Ue!==null?t.compressedTexImage2D(3553,de,we,Q.width,Q.height,0,Q.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,de,we,Q.width,Q.height,0,Ue,ct,Q.data);Ee.__maxMipLevel=ue.length-1}else if(xe.isDataTexture2DArray)t.texImage3D(35866,0,we,se.width,se.height,se.depth,0,Ue,ct,se.data),Ee.__maxMipLevel=0;else if(xe.isDataTexture3D)t.texImage3D(32879,0,we,se.width,se.height,se.depth,0,Ue,ct,se.data),Ee.__maxMipLevel=0;else if(ue.length>0&&Ie){for(let de=0,Pe=ue.length;de<Pe;de++)Q=ue[de],t.texImage2D(3553,de,we,Ue,ct,Q);xe.generateMipmaps=!1,Ee.__maxMipLevel=ue.length-1}else t.texImage2D(3553,0,we,Ue,ct,se),Ee.__maxMipLevel=0;F(xe,Ie)&&N(ve,xe,se.width,se.height),Ee.__version=xe.version,xe.onUpdate&&xe.onUpdate(xe)}function et(Ee,xe,ft){if(xe.image.length!==6)return;Ke(Ee,xe),t.activeTexture(33984+ft),t.bindTexture(34067,Ee.__webglTexture),n.pixelStorei(37440,xe.flipY),n.pixelStorei(37441,xe.premultiplyAlpha),n.pixelStorei(3317,xe.unpackAlignment),n.pixelStorei(37443,0);const ve=xe&&(xe.isCompressedTexture||xe.image[0].isCompressedTexture),te=xe.image[0]&&xe.image[0].isDataTexture,se=[];for(let de=0;de<6;de++)!ve&&!te?se[de]=k(xe.image[de],!1,!0,p):se[de]=te?xe.image[de].image:xe.image[de];const Ie=se[0],Ue=L(Ie)||s,ct=o.convert(xe.format),we=o.convert(xe.type),Q=H(xe.internalFormat,ct,we,xe.encoding);tt(34067,xe,Ue);let ue;if(ve){for(let de=0;de<6;de++){ue=se[de].mipmaps;for(let Pe=0;Pe<ue.length;Pe++){const Re=ue[Pe];xe.format!==oa&&xe.format!==np?ct!==null?t.compressedTexImage2D(34069+de,Pe,Q,Re.width,Re.height,0,Re.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+de,Pe,Q,Re.width,Re.height,0,ct,we,Re.data)}}Ee.__maxMipLevel=ue.length-1}else{ue=xe.mipmaps;for(let de=0;de<6;de++)if(te){t.texImage2D(34069+de,0,Q,se[de].width,se[de].height,0,ct,we,se[de].data);for(let Pe=0;Pe<ue.length;Pe++){const rt=ue[Pe].image[de].image;t.texImage2D(34069+de,Pe+1,Q,rt.width,rt.height,0,ct,we,rt.data)}}else{t.texImage2D(34069+de,0,Q,ct,we,se[de]);for(let Pe=0;Pe<ue.length;Pe++){const Re=ue[Pe];t.texImage2D(34069+de,Pe+1,Q,ct,we,Re.image[de])}}Ee.__maxMipLevel=ue.length}F(xe,Ue)&&N(34067,xe,Ie.width,Ie.height),Ee.__version=xe.version,xe.onUpdate&&xe.onUpdate(xe)}function Oe(Ee,xe,ft,ve,te){const se=o.convert(ft.format),Ie=o.convert(ft.type),Ue=H(ft.internalFormat,se,Ie,ft.encoding);te===32879||te===35866?t.texImage3D(te,0,Ue,xe.width,xe.height,xe.depth,0,se,Ie,null):t.texImage2D(te,0,Ue,xe.width,xe.height,0,se,Ie,null),t.bindFramebuffer(36160,Ee),n.framebufferTexture2D(36160,ve,te,i.get(ft).__webglTexture,0),t.bindFramebuffer(36160,null)}function lt(Ee,xe,ft){if(n.bindRenderbuffer(36161,Ee),xe.depthBuffer&&!xe.stencilBuffer){let ve=33189;if(ft){const te=xe.depthTexture;te&&te.isDepthTexture&&(te.type===wd?ve=36012:te.type===Tx&&(ve=33190));const se=$t(xe);n.renderbufferStorageMultisample(36161,se,ve,xe.width,xe.height)}else n.renderbufferStorage(36161,ve,xe.width,xe.height);n.framebufferRenderbuffer(36160,36096,36161,Ee)}else if(xe.depthBuffer&&xe.stencilBuffer){if(ft){const ve=$t(xe);n.renderbufferStorageMultisample(36161,ve,35056,xe.width,xe.height)}else n.renderbufferStorage(36161,34041,xe.width,xe.height);n.framebufferRenderbuffer(36160,33306,36161,Ee)}else{const ve=xe.isWebGLMultipleRenderTargets===!0?xe.texture[0]:xe.texture,te=o.convert(ve.format),se=o.convert(ve.type),Ie=H(ve.internalFormat,te,se,ve.encoding);if(ft){const Ue=$t(xe);n.renderbufferStorageMultisample(36161,Ue,Ie,xe.width,xe.height)}else n.renderbufferStorage(36161,Ie,xe.width,xe.height)}n.bindRenderbuffer(36161,null)}function Ye(Ee,xe){if(xe&&xe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,Ee),!(xe.depthTexture&&xe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(xe.depthTexture).__webglTexture||xe.depthTexture.image.width!==xe.width||xe.depthTexture.image.height!==xe.height)&&(xe.depthTexture.image.width=xe.width,xe.depthTexture.image.height=xe.height,xe.depthTexture.needsUpdate=!0),le(xe.depthTexture,0);const ve=i.get(xe.depthTexture).__webglTexture;if(xe.depthTexture.format===Tg)n.framebufferTexture2D(36160,36096,3553,ve,0);else if(xe.depthTexture.format===Sy)n.framebufferTexture2D(36160,33306,3553,ve,0);else throw new Error("Unknown depthTexture format")}function zt(Ee){const xe=i.get(Ee),ft=Ee.isWebGLCubeRenderTarget===!0;if(Ee.depthTexture){if(ft)throw new Error("target.depthTexture not supported in Cube render targets");Ye(xe.__webglFramebuffer,Ee)}else if(ft){xe.__webglDepthbuffer=[];for(let ve=0;ve<6;ve++)t.bindFramebuffer(36160,xe.__webglFramebuffer[ve]),xe.__webglDepthbuffer[ve]=n.createRenderbuffer(),lt(xe.__webglDepthbuffer[ve],Ee,!1)}else t.bindFramebuffer(36160,xe.__webglFramebuffer),xe.__webglDepthbuffer=n.createRenderbuffer(),lt(xe.__webglDepthbuffer,Ee,!1);t.bindFramebuffer(36160,null)}function Lt(Ee){const xe=Ee.texture,ft=i.get(Ee),ve=i.get(xe);Ee.addEventListener("dispose",U),Ee.isWebGLMultipleRenderTargets!==!0&&(ve.__webglTexture=n.createTexture(),ve.__version=xe.version,c.memory.textures++);const te=Ee.isWebGLCubeRenderTarget===!0,se=Ee.isWebGLMultipleRenderTargets===!0,Ie=Ee.isWebGLMultisampleRenderTarget===!0,Ue=xe.isDataTexture3D||xe.isDataTexture2DArray,ct=L(Ee)||s;if(s&&xe.format===np&&(xe.type===wd||xe.type===Sg)&&(xe.format=oa,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),te){ft.__webglFramebuffer=[];for(let we=0;we<6;we++)ft.__webglFramebuffer[we]=n.createFramebuffer()}else if(ft.__webglFramebuffer=n.createFramebuffer(),se)if(r.drawBuffers){const we=Ee.texture;for(let Q=0,ue=we.length;Q<ue;Q++){const de=i.get(we[Q]);de.__webglTexture===void 0&&(de.__webglTexture=n.createTexture(),c.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(Ie)if(s){ft.__webglMultisampledFramebuffer=n.createFramebuffer(),ft.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,ft.__webglColorRenderbuffer);const we=o.convert(xe.format),Q=o.convert(xe.type),ue=H(xe.internalFormat,we,Q,xe.encoding),de=$t(Ee);n.renderbufferStorageMultisample(36161,de,ue,Ee.width,Ee.height),t.bindFramebuffer(36160,ft.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,ft.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),Ee.depthBuffer&&(ft.__webglDepthRenderbuffer=n.createRenderbuffer(),lt(ft.__webglDepthRenderbuffer,Ee,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(te){t.bindTexture(34067,ve.__webglTexture),tt(34067,xe,ct);for(let we=0;we<6;we++)Oe(ft.__webglFramebuffer[we],Ee,xe,36064,34069+we);F(xe,ct)&&N(34067,xe,Ee.width,Ee.height),t.unbindTexture()}else if(se){const we=Ee.texture;for(let Q=0,ue=we.length;Q<ue;Q++){const de=we[Q],Pe=i.get(de);t.bindTexture(3553,Pe.__webglTexture),tt(3553,de,ct),Oe(ft.__webglFramebuffer,Ee,de,36064+Q,3553),F(de,ct)&&N(3553,de,Ee.width,Ee.height)}t.unbindTexture()}else{let we=3553;Ue&&(s?we=xe.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(we,ve.__webglTexture),tt(we,xe,ct),Oe(ft.__webglFramebuffer,Ee,xe,36064,we),F(xe,ct)&&N(we,xe,Ee.width,Ee.height,Ee.depth),t.unbindTexture()}Ee.depthBuffer&&zt(Ee)}function At(Ee){const xe=L(Ee)||s,ft=Ee.isWebGLMultipleRenderTargets===!0?Ee.texture:[Ee.texture];for(let ve=0,te=ft.length;ve<te;ve++){const se=ft[ve];if(F(se,xe)){const Ie=Ee.isWebGLCubeRenderTarget?34067:3553,Ue=i.get(se).__webglTexture;t.bindTexture(Ie,Ue),N(Ie,se,Ee.width,Ee.height),t.unbindTexture()}}}function Nt(Ee){if(Ee.isWebGLMultisampleRenderTarget)if(s){const xe=Ee.width,ft=Ee.height;let ve=16384;Ee.depthBuffer&&(ve|=256),Ee.stencilBuffer&&(ve|=1024);const te=i.get(Ee);t.bindFramebuffer(36008,te.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,te.__webglFramebuffer),n.blitFramebuffer(0,0,xe,ft,0,0,xe,ft,ve,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,te.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function $t(Ee){return s&&Ee.isWebGLMultisampleRenderTarget?Math.min(_,Ee.samples):0}function Ze(Ee){const xe=c.render.frame;x.get(Ee)!==xe&&(x.set(Ee,xe),Ee.update())}let bt=!1,Mt=!1;function Zt(Ee,xe){Ee&&Ee.isWebGLRenderTarget&&(bt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),bt=!0),Ee=Ee.texture),le(Ee,xe)}function Pt(Ee,xe){Ee&&Ee.isWebGLCubeRenderTarget&&(Mt===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Mt=!0),Ee=Ee.texture),fe(Ee,xe)}this.allocateTextureUnit=J,this.resetTextureUnits=ne,this.setTexture2D=le,this.setTexture2DArray=ae,this.setTexture3D=pe,this.setTextureCube=fe,this.setupRenderTarget=Lt,this.updateRenderTargetMipmap=At,this.updateMultisampleRenderTarget=Nt,this.safeSetTexture2D=Zt,this.safeSetTextureCube=Pt}function uX(n,e,t){const i=t.isWebGL2;function r(o){let c;if(o===Od)return 5121;if(o===w7)return 32819;if(o===S7)return 32820;if(o===T7)return 33635;if(o===y7)return 5120;if(o===b7)return 5122;if(o===Jx)return 5123;if(o===x7)return 5124;if(o===Tx)return 5125;if(o===wd)return 5126;if(o===Sg)return i?5131:(c=e.get("OES_texture_half_float"),c!==null?c.HALF_FLOAT_OES:null);if(o===M7)return 6406;if(o===np)return 6407;if(o===oa)return 6408;if(o===C7)return 6409;if(o===E7)return 6410;if(o===Tg)return 6402;if(o===Sy)return 34041;if(o===P7)return 6403;if(o===I7)return 36244;if(o===L7)return 33319;if(o===R7)return 33320;if(o===k7)return 36248;if(o===D7)return 36249;if(o===hI||o===dI||o===fI||o===pI)if(c=e.get("WEBGL_compressed_texture_s3tc"),c!==null){if(o===hI)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===dI)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===fI)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===pI)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===mI||o===gI||o===_I||o===vI)if(c=e.get("WEBGL_compressed_texture_pvrtc"),c!==null){if(o===mI)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===gI)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===_I)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===vI)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===F7)return c=e.get("WEBGL_compressed_texture_etc1"),c!==null?c.COMPRESSED_RGB_ETC1_WEBGL:null;if((o===yI||o===bI)&&(c=e.get("WEBGL_compressed_texture_etc"),c!==null)){if(o===yI)return c.COMPRESSED_RGB8_ETC2;if(o===bI)return c.COMPRESSED_RGBA8_ETC2_EAC}if(o===O7||o===z7||o===B7||o===N7||o===$7||o===V7||o===U7||o===j7||o===G7||o===q7||o===H7||o===W7||o===Z7||o===X7||o===K7||o===J7||o===Q7||o===eq||o===tq||o===iq||o===nq||o===rq||o===sq||o===oq||o===aq||o===lq||o===cq||o===uq)return c=e.get("WEBGL_compressed_texture_astc"),c!==null?o:null;if(o===Y7)return c=e.get("EXT_texture_compression_bptc"),c!==null?o:null;if(o===ty)return i?34042:(c=e.get("WEBGL_depth_texture"),c!==null?c.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:r}}class FF extends ea{constructor(e=[]){super(),this.cameras=e}}FF.prototype.isArrayCamera=!0;class Ov extends Rn{constructor(){super(),this.type="Group"}}Ov.prototype.isGroup=!0;const hX={type:"move"};class oT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ov,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ov,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Fe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Fe),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ov,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Fe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Fe),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,o=null,c=null;const s=this._targetRay,f=this._grip,p=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(s!==null&&(r=t.getPose(e.targetRaySpace,i),r!==null&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(hX))),p&&e.hand){c=!0;for(const P of e.hand.values()){const k=t.getJointPose(P,i);if(p.joints[P.jointName]===void 0){const I=new Ov;I.matrixAutoUpdate=!1,I.visible=!1,p.joints[P.jointName]=I,p.add(I)}const L=p.joints[P.jointName];k!==null&&(L.matrix.fromArray(k.transform.matrix),L.matrix.decompose(L.position,L.rotation,L.scale),L.jointRadius=k.radius),L.visible=k!==null}const g=p.joints["index-finger-tip"],_=p.joints["thumb-tip"],x=g.position.distanceTo(_.position),b=.02,M=.005;p.inputState.pinching&&x>b+M?(p.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!p.inputState.pinching&&x<=b-M&&(p.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else f!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),o!==null&&(f.matrix.fromArray(o.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),o.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(o.linearVelocity)):f.hasLinearVelocity=!1,o.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(o.angularVelocity)):f.hasAngularVelocity=!1));return s!==null&&(s.visible=r!==null),f!==null&&(f.visible=o!==null),p!==null&&(p.visible=c!==null),this}}class dX extends bp{constructor(e,t){super();const i=this,r=e.state;let o=null,c=1,s=null,f="local-floor",p=null,g=null,_=null,x=null,b=null,M=!1,P=null,k=null,L=null,I=null,F=null,N=null;const H=[],Y=new Map,q=new ea;q.layers.enable(1),q.viewport=new Zn;const U=new ea;U.layers.enable(2),U.viewport=new Zn;const G=[q,U],j=new FF;j.layers.enable(1),j.layers.enable(2);let B=null,ne=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(et){let Oe=H[et];return Oe===void 0&&(Oe=new oT,H[et]=Oe),Oe.getTargetRaySpace()},this.getControllerGrip=function(et){let Oe=H[et];return Oe===void 0&&(Oe=new oT,H[et]=Oe),Oe.getGripSpace()},this.getHand=function(et){let Oe=H[et];return Oe===void 0&&(Oe=new oT,H[et]=Oe),Oe.getHandSpace()};function J(et){const Oe=Y.get(et.inputSource);Oe&&Oe.dispatchEvent({type:et.type,data:et.inputSource})}function le(){Y.forEach(function(et,Oe){et.disconnect(Oe)}),Y.clear(),B=null,ne=null,r.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),_&&t.deleteFramebuffer(_),P&&t.deleteFramebuffer(P),k&&t.deleteRenderbuffer(k),L&&t.deleteRenderbuffer(L),_=null,P=null,k=null,L=null,b=null,x=null,g=null,o=null,dt.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(et){c=et,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(et){f=et,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return x!==null?x:b},this.getBinding=function(){return g},this.getFrame=function(){return I},this.getSession=function(){return o},this.setSession=async function(et){if(o=et,o!==null){o.addEventListener("select",J),o.addEventListener("selectstart",J),o.addEventListener("selectend",J),o.addEventListener("squeeze",J),o.addEventListener("squeezestart",J),o.addEventListener("squeezeend",J),o.addEventListener("end",le),o.addEventListener("inputsourceschange",ae);const Oe=t.getContextAttributes();if(Oe.xrCompatible!==!0&&await t.makeXRCompatible(),o.renderState.layers===void 0){const lt={antialias:Oe.antialias,alpha:Oe.alpha,depth:Oe.depth,stencil:Oe.stencil,framebufferScaleFactor:c};b=new XRWebGLLayer(o,t,lt),o.updateRenderState({baseLayer:b})}else if(t instanceof WebGLRenderingContext){const lt={antialias:!0,alpha:Oe.alpha,depth:Oe.depth,stencil:Oe.stencil,framebufferScaleFactor:c};b=new XRWebGLLayer(o,t,lt),o.updateRenderState({layers:[b]})}else{M=Oe.antialias;let lt=null;Oe.depth&&(N=256,Oe.stencil&&(N|=1024),F=Oe.stencil?33306:36096,lt=Oe.stencil?35056:33190);const Ye={colorFormat:Oe.alpha?32856:32849,depthFormat:lt,scaleFactor:c};g=new XRWebGLBinding(o,t),x=g.createProjectionLayer(Ye),_=t.createFramebuffer(),o.updateRenderState({layers:[x]}),M&&(P=t.createFramebuffer(),k=t.createRenderbuffer(),t.bindRenderbuffer(36161,k),t.renderbufferStorageMultisample(36161,4,32856,x.textureWidth,x.textureHeight),r.bindFramebuffer(36160,P),t.framebufferRenderbuffer(36160,36064,36161,k),t.bindRenderbuffer(36161,null),lt!==null&&(L=t.createRenderbuffer(),t.bindRenderbuffer(36161,L),t.renderbufferStorageMultisample(36161,4,lt,x.textureWidth,x.textureHeight),t.framebufferRenderbuffer(36160,F,36161,L),t.bindRenderbuffer(36161,null)),r.bindFramebuffer(36160,null))}s=await o.requestReferenceSpace(f),dt.setContext(o),dt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function ae(et){const Oe=o.inputSources;for(let lt=0;lt<H.length;lt++)Y.set(Oe[lt],H[lt]);for(let lt=0;lt<et.removed.length;lt++){const Ye=et.removed[lt],zt=Y.get(Ye);zt&&(zt.dispatchEvent({type:"disconnected",data:Ye}),Y.delete(Ye))}for(let lt=0;lt<et.added.length;lt++){const Ye=et.added[lt],zt=Y.get(Ye);zt&&zt.dispatchEvent({type:"connected",data:Ye})}}const pe=new Fe,fe=new Fe;function Te(et,Oe,lt){pe.setFromMatrixPosition(Oe.matrixWorld),fe.setFromMatrixPosition(lt.matrixWorld);const Ye=pe.distanceTo(fe),zt=Oe.projectionMatrix.elements,Lt=lt.projectionMatrix.elements,At=zt[14]/(zt[10]-1),Nt=zt[14]/(zt[10]+1),$t=(zt[9]+1)/zt[5],Ze=(zt[9]-1)/zt[5],bt=(zt[8]-1)/zt[0],Mt=(Lt[8]+1)/Lt[0],Zt=At*bt,Pt=At*Mt,Ee=Ye/(-bt+Mt),xe=Ee*-bt;Oe.matrixWorld.decompose(et.position,et.quaternion,et.scale),et.translateX(xe),et.translateZ(Ee),et.matrixWorld.compose(et.position,et.quaternion,et.scale),et.matrixWorldInverse.copy(et.matrixWorld).invert();const ft=At+Ee,ve=Nt+Ee,te=Zt-xe,se=Pt+(Ye-xe),Ie=$t*Nt/ve*ft,Ue=Ze*Nt/ve*ft;et.projectionMatrix.makePerspective(te,se,Ie,Ue,ft,ve)}function Ce(et,Oe){Oe===null?et.matrixWorld.copy(et.matrix):et.matrixWorld.multiplyMatrices(Oe.matrixWorld,et.matrix),et.matrixWorldInverse.copy(et.matrixWorld).invert()}this.updateCamera=function(et){if(o===null)return;j.near=U.near=q.near=et.near,j.far=U.far=q.far=et.far,(B!==j.near||ne!==j.far)&&(o.updateRenderState({depthNear:j.near,depthFar:j.far}),B=j.near,ne=j.far);const Oe=et.parent,lt=j.cameras;Ce(j,Oe);for(let zt=0;zt<lt.length;zt++)Ce(lt[zt],Oe);j.matrixWorld.decompose(j.position,j.quaternion,j.scale),et.position.copy(j.position),et.quaternion.copy(j.quaternion),et.scale.copy(j.scale),et.matrix.copy(j.matrix),et.matrixWorld.copy(j.matrixWorld);const Ye=et.children;for(let zt=0,Lt=Ye.length;zt<Lt;zt++)Ye[zt].updateMatrixWorld(!0);lt.length===2?Te(j,q,U):j.projectionMatrix.copy(q.projectionMatrix)},this.getCamera=function(){return j},this.getFoveation=function(){if(x!==null)return x.fixedFoveation;if(b!==null)return b.fixedFoveation},this.setFoveation=function(et){x!==null&&(x.fixedFoveation=et),b!==null&&b.fixedFoveation!==void 0&&(b.fixedFoveation=et)};let tt=null;function Ke(et,Oe){if(p=Oe.getViewerPose(s),I=Oe,p!==null){const Ye=p.views;b!==null&&r.bindXRFramebuffer(b.framebuffer);let zt=!1;Ye.length!==j.cameras.length&&(j.cameras.length=0,zt=!0);for(let Lt=0;Lt<Ye.length;Lt++){const At=Ye[Lt];let Nt=null;if(b!==null)Nt=b.getViewport(At);else{const Ze=g.getViewSubImage(x,At);r.bindXRFramebuffer(_),Ze.depthStencilTexture!==void 0&&t.framebufferTexture2D(36160,F,3553,Ze.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,Ze.colorTexture,0),Nt=Ze.viewport}const $t=G[Lt];$t.matrix.fromArray(At.transform.matrix),$t.projectionMatrix.fromArray(At.projectionMatrix),$t.viewport.set(Nt.x,Nt.y,Nt.width,Nt.height),Lt===0&&j.matrix.copy($t.matrix),zt===!0&&j.cameras.push($t)}M&&(r.bindXRFramebuffer(P),N!==null&&t.clear(N))}const lt=o.inputSources;for(let Ye=0;Ye<H.length;Ye++){const zt=H[Ye],Lt=lt[Ye];zt.update(Lt,Oe,s)}if(tt&&tt(et,Oe),M){const Ye=x.textureWidth,zt=x.textureHeight;r.bindFramebuffer(36008,P),r.bindFramebuffer(36009,_),t.invalidateFramebuffer(36008,[F]),t.invalidateFramebuffer(36009,[F]),t.blitFramebuffer(0,0,Ye,zt,0,0,Ye,zt,16384,9728),t.invalidateFramebuffer(36008,[36064]),r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,null),r.bindFramebuffer(36160,P)}I=null}const dt=new xF;dt.setAnimationLoop(Ke),this.setAnimationLoop=function(et){tt=et},this.dispose=function(){}}}function fX(n){function e(L,I){L.fogColor.value.copy(I.color),I.isFog?(L.fogNear.value=I.near,L.fogFar.value=I.far):I.isFogExp2&&(L.fogDensity.value=I.density)}function t(L,I,F,N,H){I.isMeshBasicMaterial?i(L,I):I.isMeshLambertMaterial?(i(L,I),f(L,I)):I.isMeshToonMaterial?(i(L,I),g(L,I)):I.isMeshPhongMaterial?(i(L,I),p(L,I)):I.isMeshStandardMaterial?(i(L,I),I.isMeshPhysicalMaterial?x(L,I,H):_(L,I)):I.isMeshMatcapMaterial?(i(L,I),b(L,I)):I.isMeshDepthMaterial?(i(L,I),M(L,I)):I.isMeshDistanceMaterial?(i(L,I),P(L,I)):I.isMeshNormalMaterial?(i(L,I),k(L,I)):I.isLineBasicMaterial?(r(L,I),I.isLineDashedMaterial&&o(L,I)):I.isPointsMaterial?c(L,I,F,N):I.isSpriteMaterial?s(L,I):I.isShadowMaterial?(L.color.value.copy(I.color),L.opacity.value=I.opacity):I.isShaderMaterial&&(I.uniformsNeedUpdate=!1)}function i(L,I){L.opacity.value=I.opacity,I.color&&L.diffuse.value.copy(I.color),I.emissive&&L.emissive.value.copy(I.emissive).multiplyScalar(I.emissiveIntensity),I.map&&(L.map.value=I.map),I.alphaMap&&(L.alphaMap.value=I.alphaMap),I.specularMap&&(L.specularMap.value=I.specularMap),I.alphaTest>0&&(L.alphaTest.value=I.alphaTest);const F=n.get(I).envMap;if(F){L.envMap.value=F,L.flipEnvMap.value=F.isCubeTexture&&F.isRenderTargetTexture===!1?-1:1,L.reflectivity.value=I.reflectivity,L.ior.value=I.ior,L.refractionRatio.value=I.refractionRatio;const Y=n.get(F).__maxMipLevel;Y!==void 0&&(L.maxMipLevel.value=Y)}I.lightMap&&(L.lightMap.value=I.lightMap,L.lightMapIntensity.value=I.lightMapIntensity),I.aoMap&&(L.aoMap.value=I.aoMap,L.aoMapIntensity.value=I.aoMapIntensity);let N;I.map?N=I.map:I.specularMap?N=I.specularMap:I.displacementMap?N=I.displacementMap:I.normalMap?N=I.normalMap:I.bumpMap?N=I.bumpMap:I.roughnessMap?N=I.roughnessMap:I.metalnessMap?N=I.metalnessMap:I.alphaMap?N=I.alphaMap:I.emissiveMap?N=I.emissiveMap:I.clearcoatMap?N=I.clearcoatMap:I.clearcoatNormalMap?N=I.clearcoatNormalMap:I.clearcoatRoughnessMap?N=I.clearcoatRoughnessMap:I.specularIntensityMap?N=I.specularIntensityMap:I.specularColorMap?N=I.specularColorMap:I.transmissionMap?N=I.transmissionMap:I.thicknessMap?N=I.thicknessMap:I.sheenColorMap?N=I.sheenColorMap:I.sheenRoughnessMap&&(N=I.sheenRoughnessMap),N!==void 0&&(N.isWebGLRenderTarget&&(N=N.texture),N.matrixAutoUpdate===!0&&N.updateMatrix(),L.uvTransform.value.copy(N.matrix));let H;I.aoMap?H=I.aoMap:I.lightMap&&(H=I.lightMap),H!==void 0&&(H.isWebGLRenderTarget&&(H=H.texture),H.matrixAutoUpdate===!0&&H.updateMatrix(),L.uv2Transform.value.copy(H.matrix))}function r(L,I){L.diffuse.value.copy(I.color),L.opacity.value=I.opacity}function o(L,I){L.dashSize.value=I.dashSize,L.totalSize.value=I.dashSize+I.gapSize,L.scale.value=I.scale}function c(L,I,F,N){L.diffuse.value.copy(I.color),L.opacity.value=I.opacity,L.size.value=I.size*F,L.scale.value=N*.5,I.map&&(L.map.value=I.map),I.alphaMap&&(L.alphaMap.value=I.alphaMap),I.alphaTest>0&&(L.alphaTest.value=I.alphaTest);let H;I.map?H=I.map:I.alphaMap&&(H=I.alphaMap),H!==void 0&&(H.matrixAutoUpdate===!0&&H.updateMatrix(),L.uvTransform.value.copy(H.matrix))}function s(L,I){L.diffuse.value.copy(I.color),L.opacity.value=I.opacity,L.rotation.value=I.rotation,I.map&&(L.map.value=I.map),I.alphaMap&&(L.alphaMap.value=I.alphaMap),I.alphaTest>0&&(L.alphaTest.value=I.alphaTest);let F;I.map?F=I.map:I.alphaMap&&(F=I.alphaMap),F!==void 0&&(F.matrixAutoUpdate===!0&&F.updateMatrix(),L.uvTransform.value.copy(F.matrix))}function f(L,I){I.emissiveMap&&(L.emissiveMap.value=I.emissiveMap)}function p(L,I){L.specular.value.copy(I.specular),L.shininess.value=Math.max(I.shininess,1e-4),I.emissiveMap&&(L.emissiveMap.value=I.emissiveMap),I.bumpMap&&(L.bumpMap.value=I.bumpMap,L.bumpScale.value=I.bumpScale,I.side===Gs&&(L.bumpScale.value*=-1)),I.normalMap&&(L.normalMap.value=I.normalMap,L.normalScale.value.copy(I.normalScale),I.side===Gs&&L.normalScale.value.negate()),I.displacementMap&&(L.displacementMap.value=I.displacementMap,L.displacementScale.value=I.displacementScale,L.displacementBias.value=I.displacementBias)}function g(L,I){I.gradientMap&&(L.gradientMap.value=I.gradientMap),I.emissiveMap&&(L.emissiveMap.value=I.emissiveMap),I.bumpMap&&(L.bumpMap.value=I.bumpMap,L.bumpScale.value=I.bumpScale,I.side===Gs&&(L.bumpScale.value*=-1)),I.normalMap&&(L.normalMap.value=I.normalMap,L.normalScale.value.copy(I.normalScale),I.side===Gs&&L.normalScale.value.negate()),I.displacementMap&&(L.displacementMap.value=I.displacementMap,L.displacementScale.value=I.displacementScale,L.displacementBias.value=I.displacementBias)}function _(L,I){L.roughness.value=I.roughness,L.metalness.value=I.metalness,I.roughnessMap&&(L.roughnessMap.value=I.roughnessMap),I.metalnessMap&&(L.metalnessMap.value=I.metalnessMap),I.emissiveMap&&(L.emissiveMap.value=I.emissiveMap),I.bumpMap&&(L.bumpMap.value=I.bumpMap,L.bumpScale.value=I.bumpScale,I.side===Gs&&(L.bumpScale.value*=-1)),I.normalMap&&(L.normalMap.value=I.normalMap,L.normalScale.value.copy(I.normalScale),I.side===Gs&&L.normalScale.value.negate()),I.displacementMap&&(L.displacementMap.value=I.displacementMap,L.displacementScale.value=I.displacementScale,L.displacementBias.value=I.displacementBias),n.get(I).envMap&&(L.envMapIntensity.value=I.envMapIntensity)}function x(L,I,F){_(L,I),L.ior.value=I.ior,I.sheen>0&&(L.sheenColor.value.copy(I.sheenColor).multiplyScalar(I.sheen),L.sheenRoughness.value=I.sheenRoughness,I.sheenColorMap&&(L.sheenColorMap.value=I.sheenColorMap),I.sheenRoughnessMap&&(L.sheenRoughnessMap.value=I.sheenRoughnessMap)),I.clearcoat>0&&(L.clearcoat.value=I.clearcoat,L.clearcoatRoughness.value=I.clearcoatRoughness,I.clearcoatMap&&(L.clearcoatMap.value=I.clearcoatMap),I.clearcoatRoughnessMap&&(L.clearcoatRoughnessMap.value=I.clearcoatRoughnessMap),I.clearcoatNormalMap&&(L.clearcoatNormalScale.value.copy(I.clearcoatNormalScale),L.clearcoatNormalMap.value=I.clearcoatNormalMap,I.side===Gs&&L.clearcoatNormalScale.value.negate())),I.transmission>0&&(L.transmission.value=I.transmission,L.transmissionSamplerMap.value=F.texture,L.transmissionSamplerSize.value.set(F.width,F.height),I.transmissionMap&&(L.transmissionMap.value=I.transmissionMap),L.thickness.value=I.thickness,I.thicknessMap&&(L.thicknessMap.value=I.thicknessMap),L.attenuationDistance.value=I.attenuationDistance,L.attenuationColor.value.copy(I.attenuationColor)),L.specularIntensity.value=I.specularIntensity,L.specularColor.value.copy(I.specularColor),I.specularIntensityMap&&(L.specularIntensityMap.value=I.specularIntensityMap),I.specularColorMap&&(L.specularColorMap.value=I.specularColorMap)}function b(L,I){I.matcap&&(L.matcap.value=I.matcap),I.bumpMap&&(L.bumpMap.value=I.bumpMap,L.bumpScale.value=I.bumpScale,I.side===Gs&&(L.bumpScale.value*=-1)),I.normalMap&&(L.normalMap.value=I.normalMap,L.normalScale.value.copy(I.normalScale),I.side===Gs&&L.normalScale.value.negate()),I.displacementMap&&(L.displacementMap.value=I.displacementMap,L.displacementScale.value=I.displacementScale,L.displacementBias.value=I.displacementBias)}function M(L,I){I.displacementMap&&(L.displacementMap.value=I.displacementMap,L.displacementScale.value=I.displacementScale,L.displacementBias.value=I.displacementBias)}function P(L,I){I.displacementMap&&(L.displacementMap.value=I.displacementMap,L.displacementScale.value=I.displacementScale,L.displacementBias.value=I.displacementBias),L.referencePosition.value.copy(I.referencePosition),L.nearDistance.value=I.nearDistance,L.farDistance.value=I.farDistance}function k(L,I){I.bumpMap&&(L.bumpMap.value=I.bumpMap,L.bumpScale.value=I.bumpScale,I.side===Gs&&(L.bumpScale.value*=-1)),I.normalMap&&(L.normalMap.value=I.normalMap,L.normalScale.value.copy(I.normalScale),I.side===Gs&&L.normalScale.value.negate()),I.displacementMap&&(L.displacementMap.value=I.displacementMap,L.displacementScale.value=I.displacementScale,L.displacementBias.value=I.displacementBias)}return{refreshFogUniforms:e,refreshMaterialUniforms:t}}function pX(){const n=Ow("canvas");return n.style.display="block",n}function hr(n={}){const e=n.canvas!==void 0?n.canvas:pX(),t=n.context!==void 0?n.context:null,i=n.alpha!==void 0?n.alpha:!1,r=n.depth!==void 0?n.depth:!0,o=n.stencil!==void 0?n.stencil:!0,c=n.antialias!==void 0?n.antialias:!1,s=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,f=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,p=n.powerPreference!==void 0?n.powerPreference:"default",g=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let _=null,x=null;const b=[],M=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Fo,this.physicallyCorrectLights=!1,this.toneMapping=ip,this.toneMappingExposure=1;const P=this;let k=!1,L=0,I=0,F=null,N=-1,H=null;const Y=new Zn,q=new Zn;let U=null,G=e.width,j=e.height,B=1,ne=null,J=null;const le=new Zn(0,0,G,j),ae=new Zn(0,0,G,j);let pe=!1;const fe=[],Te=new Bw;let Ce=!1,tt=!1,Ke=null;const dt=new Ri,et=new Fe,Oe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function lt(){return F===null?B:1}let Ye=t;function zt($e,Ct){for(let Qe=0;Qe<$e.length;Qe++){const It=$e[Qe],Gt=e.getContext(It,Ct);if(Gt!==null)return Gt}return null}try{const $e={alpha:i,depth:r,stencil:o,antialias:c,premultipliedAlpha:s,preserveDrawingBuffer:f,powerPreference:p,failIfMajorPerformanceCaveat:g};if(e.addEventListener("webglcontextlost",ot,!1),e.addEventListener("webglcontextrestored",Xe,!1),Ye===null){const Ct=["webgl2","webgl","experimental-webgl"];if(P.isWebGL1Renderer===!0&&Ct.shift(),Ye=zt(Ct,$e),Ye===null)throw zt(Ct)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Ye.getShaderPrecisionFormat===void 0&&(Ye.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch($e){throw console.error("THREE.WebGLRenderer: "+$e.message),$e}let Lt,At,Nt,$t,Ze,bt,Mt,Zt,Pt,Ee,xe,ft,ve,te,se,Ie,Ue,ct,we,Q,ue,de,Pe;function Re(){Lt=new z9(Ye),At=new P9(Ye,Lt,n),Lt.init(At),de=new uX(Ye,Lt,At),Nt=new lX(Ye,Lt,At),fe[0]=1029,$t=new $9,Ze=new KZ,bt=new cX(Ye,Lt,Nt,Ze,At,de,$t),Mt=new L9(P),Zt=new O9(P),Pt=new Qq(Ye,At),Pe=new E9(Ye,Lt,Pt,At),Ee=new B9(Ye,Pt,$t,Pe),xe=new G9(Ye,Ee,Pt,$t),we=new j9(Ye,At,bt),Ie=new I9(Ze),ft=new YZ(P,Mt,Zt,Lt,At,Pe,Ie),ve=new fX(Ze),te=new QZ(Ze),se=new sX(Lt,At),ct=new C9(P,Mt,Nt,xe,s),Ue=new DF(P,xe,At),Q=new A9(Ye,Lt,$t,At),ue=new N9(Ye,Lt,$t,At),$t.programs=ft.programs,P.capabilities=At,P.extensions=Lt,P.properties=Ze,P.renderLists=te,P.shadowMap=Ue,P.state=Nt,P.info=$t}Re();const rt=new dX(P,Ye);this.xr=rt,this.getContext=function(){return Ye},this.getContextAttributes=function(){return Ye.getContextAttributes()},this.forceContextLoss=function(){const $e=Lt.get("WEBGL_lose_context");$e&&$e.loseContext()},this.forceContextRestore=function(){const $e=Lt.get("WEBGL_lose_context");$e&&$e.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function($e){$e!==void 0&&(B=$e,this.setSize(G,j,!1))},this.getSize=function($e){return $e.set(G,j)},this.setSize=function($e,Ct,Qe){if(rt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}G=$e,j=Ct,e.width=Math.floor($e*B),e.height=Math.floor(Ct*B),Qe!==!1&&(e.style.width=$e+"px",e.style.height=Ct+"px"),this.setViewport(0,0,$e,Ct)},this.getDrawingBufferSize=function($e){return $e.set(G*B,j*B).floor()},this.setDrawingBufferSize=function($e,Ct,Qe){G=$e,j=Ct,B=Qe,e.width=Math.floor($e*Qe),e.height=Math.floor(Ct*Qe),this.setViewport(0,0,$e,Ct)},this.getCurrentViewport=function($e){return $e.copy(Y)},this.getViewport=function($e){return $e.copy(le)},this.setViewport=function($e,Ct,Qe,It){$e.isVector4?le.set($e.x,$e.y,$e.z,$e.w):le.set($e,Ct,Qe,It),Nt.viewport(Y.copy(le).multiplyScalar(B).floor())},this.getScissor=function($e){return $e.copy(ae)},this.setScissor=function($e,Ct,Qe,It){$e.isVector4?ae.set($e.x,$e.y,$e.z,$e.w):ae.set($e,Ct,Qe,It),Nt.scissor(q.copy(ae).multiplyScalar(B).floor())},this.getScissorTest=function(){return pe},this.setScissorTest=function($e){Nt.setScissorTest(pe=$e)},this.setOpaqueSort=function($e){ne=$e},this.setTransparentSort=function($e){J=$e},this.getClearColor=function($e){return $e.copy(ct.getClearColor())},this.setClearColor=function(){ct.setClearColor.apply(ct,arguments)},this.getClearAlpha=function(){return ct.getClearAlpha()},this.setClearAlpha=function(){ct.setClearAlpha.apply(ct,arguments)},this.clear=function($e,Ct,Qe){let It=0;($e===void 0||$e)&&(It|=16384),(Ct===void 0||Ct)&&(It|=256),(Qe===void 0||Qe)&&(It|=1024),Ye.clear(It)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ot,!1),e.removeEventListener("webglcontextrestored",Xe,!1),te.dispose(),se.dispose(),Ze.dispose(),Mt.dispose(),Zt.dispose(),xe.dispose(),Pe.dispose(),rt.dispose(),rt.removeEventListener("sessionstart",$i),rt.removeEventListener("sessionend",vn),Ke&&(Ke.dispose(),Ke=null),rn.stop()};function ot($e){$e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),k=!0}function Xe(){console.log("THREE.WebGLRenderer: Context Restored."),k=!1;const $e=$t.autoReset,Ct=Ue.enabled,Qe=Ue.autoUpdate,It=Ue.needsUpdate,Gt=Ue.type;Re(),$t.autoReset=$e,Ue.enabled=Ct,Ue.autoUpdate=Qe,Ue.needsUpdate=It,Ue.type=Gt}function mt($e){const Ct=$e.target;Ct.removeEventListener("dispose",mt),Et(Ct)}function Et($e){kt($e),Ze.remove($e)}function kt($e){const Ct=Ze.get($e).programs;Ct!==void 0&&Ct.forEach(function(Qe){ft.releaseProgram(Qe)})}this.renderBufferDirect=function($e,Ct,Qe,It,Gt,qi){Ct===null&&(Ct=Oe);const Ii=Gt.isMesh&&Gt.matrixWorld.determinant()<0,Dt=Vn($e,Ct,Qe,It,Gt);Nt.setMaterial(It,Ii);let ai=Qe.index;const pi=Qe.attributes.position;if(ai===null){if(pi===void 0||pi.count===0)return}else if(ai.count===0)return;let Hi=1;It.wireframe===!0&&(ai=Ee.getWireframeAttribute(Qe),Hi=2),Pe.setup(Gt,It,Dt,Qe,ai);let ut,Li=Q;ai!==null&&(ut=Pt.get(ai),Li=ue,Li.setIndex(ut));const bi=ai!==null?ai.count:pi.count,Ni=Qe.drawRange.start*Hi,Kn=Qe.drawRange.count*Hi,Zi=qi!==null?qi.start*Hi:0,Un=qi!==null?qi.count*Hi:1/0,sn=Math.max(Ni,Zi),zr=Math.min(bi,Ni+Kn,Zi+Un)-1,jn=Math.max(0,zr-sn+1);if(jn!==0){if(Gt.isMesh)It.wireframe===!0?(Nt.setLineWidth(It.wireframeLinewidth*lt()),Li.setMode(1)):Li.setMode(4);else if(Gt.isLine){let an=It.linewidth;an===void 0&&(an=1),Nt.setLineWidth(an*lt()),Gt.isLineSegments?Li.setMode(1):Gt.isLineLoop?Li.setMode(2):Li.setMode(3)}else Gt.isPoints?Li.setMode(0):Gt.isSprite&&Li.setMode(4);if(Gt.isInstancedMesh)Li.renderInstances(sn,jn,Gt.count);else if(Qe.isInstancedBufferGeometry){const an=Math.min(Qe.instanceCount,Qe._maxInstanceCount);Li.renderInstances(sn,jn,an)}else Li.render(sn,jn)}},this.compile=function($e,Ct){x=se.get($e),x.init(),M.push(x),$e.traverseVisible(function(Qe){Qe.isLight&&Qe.layers.test(Ct.layers)&&(x.pushLight(Qe),Qe.castShadow&&x.pushShadow(Qe))}),x.setupLights(P.physicallyCorrectLights),$e.traverse(function(Qe){const It=Qe.material;if(It)if(Array.isArray(It))for(let Gt=0;Gt<It.length;Gt++){const qi=It[Gt];Yn(qi,$e,Qe)}else Yn(It,$e,Qe)}),M.pop(),x=null};let Jt=null;function vi($e){Jt&&Jt($e)}function $i(){rn.stop()}function vn(){rn.start()}const rn=new xF;rn.setAnimationLoop(vi),typeof window<"u"&&rn.setContext(window),this.setAnimationLoop=function($e){Jt=$e,rt.setAnimationLoop($e),$e===null?rn.stop():rn.start()},rt.addEventListener("sessionstart",$i),rt.addEventListener("sessionend",vn),this.render=function($e,Ct){if(Ct!==void 0&&Ct.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(k===!0)return;$e.autoUpdate===!0&&$e.updateMatrixWorld(),Ct.parent===null&&Ct.updateMatrixWorld(),rt.enabled===!0&&rt.isPresenting===!0&&(rt.cameraAutoUpdate===!0&&rt.updateCamera(Ct),Ct=rt.getCamera()),$e.isScene===!0&&$e.onBeforeRender(P,$e,Ct,F),x=se.get($e,M.length),x.init(),M.push(x),dt.multiplyMatrices(Ct.projectionMatrix,Ct.matrixWorldInverse),Te.setFromProjectionMatrix(dt),tt=this.localClippingEnabled,Ce=Ie.init(this.clippingPlanes,tt,Ct),_=te.get($e,b.length),_.init(),b.push(_),gt($e,Ct,0,P.sortObjects),_.finish(),P.sortObjects===!0&&_.sort(ne,J),Ce===!0&&Ie.beginShadows();const Qe=x.state.shadowsArray;if(Ue.render(Qe,$e,Ct),Ce===!0&&Ie.endShadows(),this.info.autoReset===!0&&this.info.reset(),ct.render(_,$e),x.setupLights(P.physicallyCorrectLights),Ct.isArrayCamera){const It=Ct.cameras;for(let Gt=0,qi=It.length;Gt<qi;Gt++){const Ii=It[Gt];gn(_,$e,Ii,Ii.viewport)}}else gn(_,$e,Ct);F!==null&&(bt.updateMultisampleRenderTarget(F),bt.updateRenderTargetMipmap(F)),$e.isScene===!0&&$e.onAfterRender(P,$e,Ct),Nt.buffers.depth.setTest(!0),Nt.buffers.depth.setMask(!0),Nt.buffers.color.setMask(!0),Nt.setPolygonOffset(!1),Pe.resetDefaultState(),N=-1,H=null,M.pop(),M.length>0?x=M[M.length-1]:x=null,b.pop(),b.length>0?_=b[b.length-1]:_=null};function gt($e,Ct,Qe,It){if($e.visible===!1)return;if($e.layers.test(Ct.layers)){if($e.isGroup)Qe=$e.renderOrder;else if($e.isLOD)$e.autoUpdate===!0&&$e.update(Ct);else if($e.isLight)x.pushLight($e),$e.castShadow&&x.pushShadow($e);else if($e.isSprite){if(!$e.frustumCulled||Te.intersectsSprite($e)){It&&et.setFromMatrixPosition($e.matrixWorld).applyMatrix4(dt);const Ii=xe.update($e),Dt=$e.material;Dt.visible&&_.push($e,Ii,Dt,Qe,et.z,null)}}else if(($e.isMesh||$e.isLine||$e.isPoints)&&($e.isSkinnedMesh&&$e.skeleton.frame!==$t.render.frame&&($e.skeleton.update(),$e.skeleton.frame=$t.render.frame),!$e.frustumCulled||Te.intersectsObject($e))){It&&et.setFromMatrixPosition($e.matrixWorld).applyMatrix4(dt);const Ii=xe.update($e),Dt=$e.material;if(Array.isArray(Dt)){const ai=Ii.groups;for(let pi=0,Hi=ai.length;pi<Hi;pi++){const ut=ai[pi],Li=Dt[ut.materialIndex];Li&&Li.visible&&_.push($e,Ii,Li,Qe,et.z,ut)}}else Dt.visible&&_.push($e,Ii,Dt,Qe,et.z,null)}}const qi=$e.children;for(let Ii=0,Dt=qi.length;Ii<Dt;Ii++)gt(qi[Ii],Ct,Qe,It)}function gn($e,Ct,Qe,It){const Gt=$e.opaque,qi=$e.transmissive,Ii=$e.transparent;x.setupLightsView(Qe),qi.length>0&&Er(Gt,Ct,Qe),It&&Nt.viewport(Y.copy(It)),Gt.length>0&&Di(Gt,Ct,Qe),qi.length>0&&Di(qi,Ct,Qe),Ii.length>0&&Di(Ii,Ct,Qe)}function Er($e,Ct,Qe){if(Ke===null){const Ii=c===!0&&At.isWebGL2===!0?mF:xc;Ke=new Ii(1024,1024,{generateMipmaps:!0,type:de.convert(Sg)!==null?Sg:Od,minFilter:Fw,magFilter:Ws,wrapS:Qa,wrapT:Qa})}const It=P.getRenderTarget();P.setRenderTarget(Ke),P.clear();const Gt=P.toneMapping;P.toneMapping=ip,Di($e,Ct,Qe),P.toneMapping=Gt,bt.updateMultisampleRenderTarget(Ke),bt.updateRenderTargetMipmap(Ke),P.setRenderTarget(It)}function Di($e,Ct,Qe){const It=Ct.isScene===!0?Ct.overrideMaterial:null;for(let Gt=0,qi=$e.length;Gt<qi;Gt++){const Ii=$e[Gt],Dt=Ii.object,ai=Ii.geometry,pi=It===null?Ii.material:It,Hi=Ii.group;Dt.layers.test(Qe.layers)&&yn(Dt,Ct,Qe,ai,pi,Hi)}}function yn($e,Ct,Qe,It,Gt,qi){$e.onBeforeRender(P,Ct,Qe,It,Gt,qi),$e.modelViewMatrix.multiplyMatrices(Qe.matrixWorldInverse,$e.matrixWorld),$e.normalMatrix.getNormalMatrix($e.modelViewMatrix),Gt.onBeforeRender(P,Ct,Qe,It,$e,qi),Gt.transparent===!0&&Gt.side===Ko?(Gt.side=Gs,Gt.needsUpdate=!0,P.renderBufferDirect(Qe,Ct,It,Gt,$e,qi),Gt.side=zg,Gt.needsUpdate=!0,P.renderBufferDirect(Qe,Ct,It,Gt,$e,qi),Gt.side=Ko):P.renderBufferDirect(Qe,Ct,It,Gt,$e,qi),$e.onAfterRender(P,Ct,Qe,It,Gt,qi)}function Yn($e,Ct,Qe){Ct.isScene!==!0&&(Ct=Oe);const It=Ze.get($e),Gt=x.state.lights,qi=x.state.shadowsArray,Ii=Gt.state.version,Dt=ft.getParameters($e,Gt.state,qi,Ct,Qe),ai=ft.getProgramCacheKey(Dt);let pi=It.programs;It.environment=$e.isMeshStandardMaterial?Ct.environment:null,It.fog=Ct.fog,It.envMap=($e.isMeshStandardMaterial?Zt:Mt).get($e.envMap||It.environment),pi===void 0&&($e.addEventListener("dispose",mt),pi=new Map,It.programs=pi);let Hi=pi.get(ai);if(Hi!==void 0){if(It.currentProgram===Hi&&It.lightsStateVersion===Ii)return Cn($e,Dt),Hi}else Dt.uniforms=ft.getUniforms($e),$e.onBuild(Qe,Dt,P),$e.onBeforeCompile(Dt,P),Hi=ft.acquireProgram(Dt,ai),pi.set(ai,Hi),It.uniforms=Dt.uniforms;const ut=It.uniforms;(!$e.isShaderMaterial&&!$e.isRawShaderMaterial||$e.clipping===!0)&&(ut.clippingPlanes=Ie.uniform),Cn($e,Dt),It.needsLights=dr($e),It.lightsStateVersion=Ii,It.needsLights&&(ut.ambientLightColor.value=Gt.state.ambient,ut.lightProbe.value=Gt.state.probe,ut.directionalLights.value=Gt.state.directional,ut.directionalLightShadows.value=Gt.state.directionalShadow,ut.spotLights.value=Gt.state.spot,ut.spotLightShadows.value=Gt.state.spotShadow,ut.rectAreaLights.value=Gt.state.rectArea,ut.ltc_1.value=Gt.state.rectAreaLTC1,ut.ltc_2.value=Gt.state.rectAreaLTC2,ut.pointLights.value=Gt.state.point,ut.pointLightShadows.value=Gt.state.pointShadow,ut.hemisphereLights.value=Gt.state.hemi,ut.directionalShadowMap.value=Gt.state.directionalShadowMap,ut.directionalShadowMatrix.value=Gt.state.directionalShadowMatrix,ut.spotShadowMap.value=Gt.state.spotShadowMap,ut.spotShadowMatrix.value=Gt.state.spotShadowMatrix,ut.pointShadowMap.value=Gt.state.pointShadowMap,ut.pointShadowMatrix.value=Gt.state.pointShadowMatrix);const Li=Hi.getUniforms(),bi=Pd.seqWithValue(Li.seq,ut);return It.currentProgram=Hi,It.uniformsList=bi,Hi}function Cn($e,Ct){const Qe=Ze.get($e);Qe.outputEncoding=Ct.outputEncoding,Qe.instancing=Ct.instancing,Qe.skinning=Ct.skinning,Qe.morphTargets=Ct.morphTargets,Qe.morphNormals=Ct.morphNormals,Qe.morphTargetsCount=Ct.morphTargetsCount,Qe.numClippingPlanes=Ct.numClippingPlanes,Qe.numIntersection=Ct.numClipIntersection,Qe.vertexAlphas=Ct.vertexAlphas,Qe.vertexTangents=Ct.vertexTangents}function Vn($e,Ct,Qe,It,Gt){Ct.isScene!==!0&&(Ct=Oe),bt.resetTextureUnits();const qi=Ct.fog,Ii=It.isMeshStandardMaterial?Ct.environment:null,Dt=F===null?P.outputEncoding:F.texture.encoding,ai=(It.isMeshStandardMaterial?Zt:Mt).get(It.envMap||Ii),pi=It.vertexColors===!0&&!!Qe.attributes.color&&Qe.attributes.color.itemSize===4,Hi=!!It.normalMap&&!!Qe.attributes.tangent,ut=!!Qe.morphAttributes.position,Li=!!Qe.morphAttributes.normal,bi=Qe.morphAttributes.position?Qe.morphAttributes.position.length:0,Ni=Ze.get(It),Kn=x.state.lights;if(Ce===!0&&(tt===!0||$e!==H)){const ts=$e===H&&It.id===N;Ie.setState(It,$e,ts)}let Zi=!1;It.version===Ni.__version?(Ni.needsLights&&Ni.lightsStateVersion!==Kn.state.version||Ni.outputEncoding!==Dt||Gt.isInstancedMesh&&Ni.instancing===!1||!Gt.isInstancedMesh&&Ni.instancing===!0||Gt.isSkinnedMesh&&Ni.skinning===!1||!Gt.isSkinnedMesh&&Ni.skinning===!0||Ni.envMap!==ai||It.fog&&Ni.fog!==qi||Ni.numClippingPlanes!==void 0&&(Ni.numClippingPlanes!==Ie.numPlanes||Ni.numIntersection!==Ie.numIntersection)||Ni.vertexAlphas!==pi||Ni.vertexTangents!==Hi||Ni.morphTargets!==ut||Ni.morphNormals!==Li||At.isWebGL2===!0&&Ni.morphTargetsCount!==bi)&&(Zi=!0):(Zi=!0,Ni.__version=It.version);let Un=Ni.currentProgram;Zi===!0&&(Un=Yn(It,Ct,Gt));let sn=!1,zr=!1,jn=!1;const an=Un.getUniforms(),Qi=Ni.uniforms;if(Nt.useProgram(Un.program)&&(sn=!0,zr=!0,jn=!0),It.id!==N&&(N=It.id,zr=!0),sn||H!==$e){if(an.setValue(Ye,"projectionMatrix",$e.projectionMatrix),At.logarithmicDepthBuffer&&an.setValue(Ye,"logDepthBufFC",2/(Math.log($e.far+1)/Math.LN2)),H!==$e&&(H=$e,zr=!0,jn=!0),It.isShaderMaterial||It.isMeshPhongMaterial||It.isMeshToonMaterial||It.isMeshStandardMaterial||It.envMap){const ts=an.map.cameraPosition;ts!==void 0&&ts.setValue(Ye,et.setFromMatrixPosition($e.matrixWorld))}(It.isMeshPhongMaterial||It.isMeshToonMaterial||It.isMeshLambertMaterial||It.isMeshBasicMaterial||It.isMeshStandardMaterial||It.isShaderMaterial)&&an.setValue(Ye,"isOrthographic",$e.isOrthographicCamera===!0),(It.isMeshPhongMaterial||It.isMeshToonMaterial||It.isMeshLambertMaterial||It.isMeshBasicMaterial||It.isMeshStandardMaterial||It.isShaderMaterial||It.isShadowMaterial||Gt.isSkinnedMesh)&&an.setValue(Ye,"viewMatrix",$e.matrixWorldInverse)}if(Gt.isSkinnedMesh){an.setOptional(Ye,Gt,"bindMatrix"),an.setOptional(Ye,Gt,"bindMatrixInverse");const ts=Gt.skeleton;ts&&(At.floatVertexTextures?(ts.boneTexture===null&&ts.computeBoneTexture(),an.setValue(Ye,"boneTexture",ts.boneTexture,bt),an.setValue(Ye,"boneTextureSize",ts.boneTextureSize)):an.setOptional(Ye,ts,"boneMatrices"))}return Qe&&(Qe.morphAttributes.position!==void 0||Qe.morphAttributes.normal!==void 0)&&we.update(Gt,Qe,It,Un),(zr||Ni.receiveShadow!==Gt.receiveShadow)&&(Ni.receiveShadow=Gt.receiveShadow,an.setValue(Ye,"receiveShadow",Gt.receiveShadow)),zr&&(an.setValue(Ye,"toneMappingExposure",P.toneMappingExposure),Ni.needsLights&&En(Qi,jn),qi&&It.fog&&ve.refreshFogUniforms(Qi,qi),ve.refreshMaterialUniforms(Qi,It,B,j,Ke),Pd.upload(Ye,Ni.uniformsList,Qi,bt)),It.isShaderMaterial&&It.uniformsNeedUpdate===!0&&(Pd.upload(Ye,Ni.uniformsList,Qi,bt),It.uniformsNeedUpdate=!1),It.isSpriteMaterial&&an.setValue(Ye,"center",Gt.center),an.setValue(Ye,"modelViewMatrix",Gt.modelViewMatrix),an.setValue(Ye,"normalMatrix",Gt.normalMatrix),an.setValue(Ye,"modelMatrix",Gt.matrixWorld),Un}function En($e,Ct){$e.ambientLightColor.needsUpdate=Ct,$e.lightProbe.needsUpdate=Ct,$e.directionalLights.needsUpdate=Ct,$e.directionalLightShadows.needsUpdate=Ct,$e.pointLights.needsUpdate=Ct,$e.pointLightShadows.needsUpdate=Ct,$e.spotLights.needsUpdate=Ct,$e.spotLightShadows.needsUpdate=Ct,$e.rectAreaLights.needsUpdate=Ct,$e.hemisphereLights.needsUpdate=Ct}function dr($e){return $e.isMeshLambertMaterial||$e.isMeshToonMaterial||$e.isMeshPhongMaterial||$e.isMeshStandardMaterial||$e.isShadowMaterial||$e.isShaderMaterial&&$e.lights===!0}this.getActiveCubeFace=function(){return L},this.getActiveMipmapLevel=function(){return I},this.getRenderTarget=function(){return F},this.setRenderTarget=function($e,Ct=0,Qe=0){F=$e,L=Ct,I=Qe,$e&&Ze.get($e).__webglFramebuffer===void 0&&bt.setupRenderTarget($e);let It=null,Gt=!1,qi=!1;if($e){const Dt=$e.texture;(Dt.isDataTexture3D||Dt.isDataTexture2DArray)&&(qi=!0);const ai=Ze.get($e).__webglFramebuffer;$e.isWebGLCubeRenderTarget?(It=ai[Ct],Gt=!0):$e.isWebGLMultisampleRenderTarget?It=Ze.get($e).__webglMultisampledFramebuffer:It=ai,Y.copy($e.viewport),q.copy($e.scissor),U=$e.scissorTest}else Y.copy(le).multiplyScalar(B).floor(),q.copy(ae).multiplyScalar(B).floor(),U=pe;if(Nt.bindFramebuffer(36160,It)&&At.drawBuffers){let Dt=!1;if($e)if($e.isWebGLMultipleRenderTargets){const ai=$e.texture;if(fe.length!==ai.length||fe[0]!==36064){for(let pi=0,Hi=ai.length;pi<Hi;pi++)fe[pi]=36064+pi;fe.length=ai.length,Dt=!0}}else(fe.length!==1||fe[0]!==36064)&&(fe[0]=36064,fe.length=1,Dt=!0);else(fe.length!==1||fe[0]!==1029)&&(fe[0]=1029,fe.length=1,Dt=!0);Dt&&(At.isWebGL2?Ye.drawBuffers(fe):Lt.get("WEBGL_draw_buffers").drawBuffersWEBGL(fe))}if(Nt.viewport(Y),Nt.scissor(q),Nt.setScissorTest(U),Gt){const Dt=Ze.get($e.texture);Ye.framebufferTexture2D(36160,36064,34069+Ct,Dt.__webglTexture,Qe)}else if(qi){const Dt=Ze.get($e.texture),ai=Ct||0;Ye.framebufferTextureLayer(36160,36064,Dt.__webglTexture,Qe||0,ai)}N=-1},this.readRenderTargetPixels=function($e,Ct,Qe,It,Gt,qi,Ii){if(!($e&&$e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Dt=Ze.get($e).__webglFramebuffer;if($e.isWebGLCubeRenderTarget&&Ii!==void 0&&(Dt=Dt[Ii]),Dt){Nt.bindFramebuffer(36160,Dt);try{const ai=$e.texture,pi=ai.format,Hi=ai.type;if(pi!==oa&&de.convert(pi)!==Ye.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ut=Hi===Sg&&(Lt.has("EXT_color_buffer_half_float")||At.isWebGL2&&Lt.has("EXT_color_buffer_float"));if(Hi!==Od&&de.convert(Hi)!==Ye.getParameter(35738)&&!(Hi===wd&&(At.isWebGL2||Lt.has("OES_texture_float")||Lt.has("WEBGL_color_buffer_float")))&&!ut){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ye.checkFramebufferStatus(36160)===36053?Ct>=0&&Ct<=$e.width-It&&Qe>=0&&Qe<=$e.height-Gt&&Ye.readPixels(Ct,Qe,It,Gt,de.convert(pi),de.convert(Hi),qi):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const ai=F!==null?Ze.get(F).__webglFramebuffer:null;Nt.bindFramebuffer(36160,ai)}}},this.copyFramebufferToTexture=function($e,Ct,Qe=0){const It=Math.pow(2,-Qe),Gt=Math.floor(Ct.image.width*It),qi=Math.floor(Ct.image.height*It);let Ii=de.convert(Ct.format);At.isWebGL2&&(Ii===6407&&(Ii=32849),Ii===6408&&(Ii=32856)),bt.setTexture2D(Ct,0),Ye.copyTexImage2D(3553,Qe,Ii,$e.x,$e.y,Gt,qi,0),Nt.unbindTexture()},this.copyTextureToTexture=function($e,Ct,Qe,It=0){const Gt=Ct.image.width,qi=Ct.image.height,Ii=de.convert(Qe.format),Dt=de.convert(Qe.type);bt.setTexture2D(Qe,0),Ye.pixelStorei(37440,Qe.flipY),Ye.pixelStorei(37441,Qe.premultiplyAlpha),Ye.pixelStorei(3317,Qe.unpackAlignment),Ct.isDataTexture?Ye.texSubImage2D(3553,It,$e.x,$e.y,Gt,qi,Ii,Dt,Ct.image.data):Ct.isCompressedTexture?Ye.compressedTexSubImage2D(3553,It,$e.x,$e.y,Ct.mipmaps[0].width,Ct.mipmaps[0].height,Ii,Ct.mipmaps[0].data):Ye.texSubImage2D(3553,It,$e.x,$e.y,Ii,Dt,Ct.image),It===0&&Qe.generateMipmaps&&Ye.generateMipmap(3553),Nt.unbindTexture()},this.copyTextureToTexture3D=function($e,Ct,Qe,It,Gt=0){if(P.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const qi=$e.max.x-$e.min.x+1,Ii=$e.max.y-$e.min.y+1,Dt=$e.max.z-$e.min.z+1,ai=de.convert(It.format),pi=de.convert(It.type);let Hi;if(It.isDataTexture3D)bt.setTexture3D(It,0),Hi=32879;else if(It.isDataTexture2DArray)bt.setTexture2DArray(It,0),Hi=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Ye.pixelStorei(37440,It.flipY),Ye.pixelStorei(37441,It.premultiplyAlpha),Ye.pixelStorei(3317,It.unpackAlignment);const ut=Ye.getParameter(3314),Li=Ye.getParameter(32878),bi=Ye.getParameter(3316),Ni=Ye.getParameter(3315),Kn=Ye.getParameter(32877),Zi=Qe.isCompressedTexture?Qe.mipmaps[0]:Qe.image;Ye.pixelStorei(3314,Zi.width),Ye.pixelStorei(32878,Zi.height),Ye.pixelStorei(3316,$e.min.x),Ye.pixelStorei(3315,$e.min.y),Ye.pixelStorei(32877,$e.min.z),Qe.isDataTexture||Qe.isDataTexture3D?Ye.texSubImage3D(Hi,Gt,Ct.x,Ct.y,Ct.z,qi,Ii,Dt,ai,pi,Zi.data):Qe.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ye.compressedTexSubImage3D(Hi,Gt,Ct.x,Ct.y,Ct.z,qi,Ii,Dt,ai,Zi.data)):Ye.texSubImage3D(Hi,Gt,Ct.x,Ct.y,Ct.z,qi,Ii,Dt,ai,pi,Zi),Ye.pixelStorei(3314,ut),Ye.pixelStorei(32878,Li),Ye.pixelStorei(3316,bi),Ye.pixelStorei(3315,Ni),Ye.pixelStorei(32877,Kn),Gt===0&&It.generateMipmaps&&Ye.generateMipmap(Hi),Nt.unbindTexture()},this.initTexture=function($e){bt.setTexture2D($e,0),Nt.unbindTexture()},this.resetState=function(){L=0,I=0,F=null,Nt.reset(),Pe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}hr.prototype.isWebGLRenderer=!0;class mX extends hr{}mX.prototype.isWebGL1Renderer=!0;class _h extends Rn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}_h.prototype.isScene=!0;class n0{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Ty,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=bc()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,o=this.stride;r<o;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=bc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=bc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}n0.prototype.isInterleavedBuffer=!0;const vs=new Fe;class Cy{constructor(e,t,i,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)vs.x=this.getX(t),vs.y=this.getY(t),vs.z=this.getZ(t),vs.applyMatrix4(e),this.setXYZ(t,vs.x,vs.y,vs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)vs.x=this.getX(t),vs.y=this.getY(t),vs.z=this.getZ(t),vs.applyNormalMatrix(e),this.setXYZ(t,vs.x,vs.y,vs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)vs.x=this.getX(t),vs.y=this.getY(t),vs.z=this.getZ(t),vs.transformDirection(e),this.setXYZ(t,vs.x,vs.y,vs.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[r+o])}return new Mn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Cy(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[r+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Cy.prototype.isInterleavedBufferAttribute=!0;class V2 extends Bo{constructor(e){super(),this.type="SpriteMaterial",this.color=new Bi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}V2.prototype.isSpriteMaterial=!0;let Km;const vv=new Fe,Jm=new Fe,Qm=new Fe,eg=new li,yv=new li,OF=new Ri,Nb=new Fe,bv=new Fe,$b=new Fe,i3=new li,aT=new li,n3=new li;class zF extends Rn{constructor(e){if(super(),this.type="Sprite",Km===void 0){Km=new $n;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new n0(t,5);Km.setIndex([0,1,2,0,2,3]),Km.setAttribute("position",new Cy(i,3,0,!1)),Km.setAttribute("uv",new Cy(i,2,3,!1))}this.geometry=Km,this.material=e!==void 0?e:new V2,this.center=new li(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Jm.setFromMatrixScale(this.matrixWorld),OF.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Qm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Jm.multiplyScalar(-Qm.z);const i=this.material.rotation;let r,o;i!==0&&(o=Math.cos(i),r=Math.sin(i));const c=this.center;Vb(Nb.set(-.5,-.5,0),Qm,c,Jm,r,o),Vb(bv.set(.5,-.5,0),Qm,c,Jm,r,o),Vb($b.set(.5,.5,0),Qm,c,Jm,r,o),i3.set(0,0),aT.set(1,0),n3.set(1,1);let s=e.ray.intersectTriangle(Nb,bv,$b,!1,vv);if(s===null&&(Vb(bv.set(-.5,.5,0),Qm,c,Jm,r,o),aT.set(0,1),s=e.ray.intersectTriangle(Nb,$b,bv,!1,vv),s===null))return;const f=e.ray.origin.distanceTo(vv);f<e.near||f>e.far||t.push({distance:f,point:vv.clone(),uv:Zs.getUV(vv,Nb,bv,$b,i3,aT,n3,new li),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}zF.prototype.isSprite=!0;function Vb(n,e,t,i,r,o){eg.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(yv.x=o*eg.x-r*eg.y,yv.y=r*eg.x+o*eg.y):yv.copy(eg),n.copy(e),n.x+=yv.x,n.y+=yv.y,n.applyMatrix4(OF)}const r3=new Fe,s3=new Zn,o3=new Zn,gX=new Fe,a3=new Ri;class BF extends kr{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ri,this.bindMatrixInverse=new Ri}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Zn,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,r=this.geometry;s3.fromBufferAttribute(r.attributes.skinIndex,e),o3.fromBufferAttribute(r.attributes.skinWeight,e),r3.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const c=o3.getComponent(o);if(c!==0){const s=s3.getComponent(o);a3.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(gX.copy(r3).applyMatrix4(a3),c)}}return t.applyMatrix4(this.bindMatrixInverse)}}BF.prototype.isSkinnedMesh=!0;class _X extends Rn{constructor(){super(),this.type="Bone"}}_X.prototype.isBone=!0;class vX extends zs{constructor(e=null,t=1,i=1,r,o,c,s,f,p=Ws,g=Ws,_,x){super(null,c,s,f,p,g,r,o,_,x),this.image={data:e,width:t,height:i},this.magFilter=p,this.minFilter=g,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}vX.prototype.isDataTexture=!0;class vM extends Mn{constructor(e,t,i,r=1){typeof i=="number"&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}vM.prototype.isInstancedBufferAttribute=!0;const l3=new Ri,c3=new Ri,Ub=[],xv=new kr;class yX extends kr{constructor(e,t,i){super(e,t),this.instanceMatrix=new vM(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(xv.geometry=this.geometry,xv.material=this.material,xv.material!==void 0)for(let o=0;o<r;o++){this.getMatrixAt(o,l3),c3.multiplyMatrices(i,l3),xv.matrixWorld=c3,xv.raycast(e,Ub);for(let c=0,s=Ub.length;c<s;c++){const f=Ub[c];f.instanceId=o,f.object=this,t.push(f)}Ub.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new vM(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}yX.prototype.isInstancedMesh=!0;class Ah extends Bo{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Bi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Ah.prototype.isLineBasicMaterial=!0;const u3=new Fe,h3=new Fe,d3=new Ri,lT=new xp,jb=new t_;class Sp extends Rn{constructor(e=new $n,t=new Ah){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,o=t.count;r<o;r++)u3.fromBufferAttribute(t,r-1),h3.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=u3.distanceTo(h3);e.setAttribute("lineDistance",new ws(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,o=e.params.Line.threshold,c=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),jb.copy(i.boundingSphere),jb.applyMatrix4(r),jb.radius+=o,e.ray.intersectsSphere(jb)===!1)return;d3.copy(r).invert(),lT.copy(e.ray).applyMatrix4(d3);const s=o/((this.scale.x+this.scale.y+this.scale.z)/3),f=s*s,p=new Fe,g=new Fe,_=new Fe,x=new Fe,b=this.isLineSegments?2:1;if(i.isBufferGeometry){const M=i.index,k=i.attributes.position;if(M!==null){const L=Math.max(0,c.start),I=Math.min(M.count,c.start+c.count);for(let F=L,N=I-1;F<N;F+=b){const H=M.getX(F),Y=M.getX(F+1);if(p.fromBufferAttribute(k,H),g.fromBufferAttribute(k,Y),lT.distanceSqToSegment(p,g,x,_)>f)continue;x.applyMatrix4(this.matrixWorld);const U=e.ray.origin.distanceTo(x);U<e.near||U>e.far||t.push({distance:U,point:_.clone().applyMatrix4(this.matrixWorld),index:F,face:null,faceIndex:null,object:this})}}else{const L=Math.max(0,c.start),I=Math.min(k.count,c.start+c.count);for(let F=L,N=I-1;F<N;F+=b){if(p.fromBufferAttribute(k,F),g.fromBufferAttribute(k,F+1),lT.distanceSqToSegment(p,g,x,_)>f)continue;x.applyMatrix4(this.matrixWorld);const Y=e.ray.origin.distanceTo(x);Y<e.near||Y>e.far||t.push({distance:Y,point:_.clone().applyMatrix4(this.matrixWorld),index:F,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Sp.prototype.isLine=!0;const f3=new Fe,p3=new Fe;class Uw extends Sp{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,o=t.count;r<o;r+=2)f3.fromBufferAttribute(t,r),p3.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+f3.distanceTo(p3);e.setAttribute("lineDistance",new ws(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Uw.prototype.isLineSegments=!0;class bX extends Sp{constructor(e,t){super(e,t),this.type="LineLoop"}}bX.prototype.isLineLoop=!0;class NF extends Bo{constructor(e){super(),this.type="PointsMaterial",this.color=new Bi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}NF.prototype.isPointsMaterial=!0;const m3=new Ri,yM=new xp,Gb=new t_,qb=new Fe;class $F extends Rn{constructor(e=new $n,t=new NF){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,o=e.params.Points.threshold,c=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Gb.copy(i.boundingSphere),Gb.applyMatrix4(r),Gb.radius+=o,e.ray.intersectsSphere(Gb)===!1)return;m3.copy(r).invert(),yM.copy(e.ray).applyMatrix4(m3);const s=o/((this.scale.x+this.scale.y+this.scale.z)/3),f=s*s;if(i.isBufferGeometry){const p=i.index,_=i.attributes.position;if(p!==null){const x=Math.max(0,c.start),b=Math.min(p.count,c.start+c.count);for(let M=x,P=b;M<P;M++){const k=p.getX(M);qb.fromBufferAttribute(_,k),g3(qb,k,f,r,e,t,this)}}else{const x=Math.max(0,c.start),b=Math.min(_.count,c.start+c.count);for(let M=x,P=b;M<P;M++)qb.fromBufferAttribute(_,M),g3(qb,M,f,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,c=r.length;o<c;o++){const s=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}$F.prototype.isPoints=!0;function g3(n,e,t,i,r,o,c){const s=yM.distanceSqToPoint(n);if(s<t){const f=new Fe;yM.closestPointToPoint(n,f),f.applyMatrix4(i);const p=r.ray.origin.distanceTo(f);if(p<r.near||p>r.far)return;o.push({distance:p,distanceToRay:Math.sqrt(s),point:f,index:e,face:null,object:c})}}class xX extends zs{constructor(e,t,i,r,o,c,s,f,p){super(e,t,i,r,o,c,s,f,p),this.format=s!==void 0?s:np,this.minFilter=c!==void 0?c:Ro,this.magFilter=o!==void 0?o:Ro,this.generateMipmaps=!1;const g=this;function _(){g.needsUpdate=!0,e.requestVideoFrameCallback(_)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(_)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}xX.prototype.isVideoTexture=!0;class wX extends zs{constructor(e,t,i,r,o,c,s,f,p,g,_,x){super(null,c,s,f,p,g,r,o,_,x),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}wX.prototype.isCompressedTexture=!0;class SX extends zs{constructor(e,t,i,r,o,c,s,f,p){super(e,t,i,r,o,c,s,f,p),this.needsUpdate=!0}}SX.prototype.isCanvasTexture=!0;class TX extends zs{constructor(e,t,i,r,o,c,s,f,p,g){if(g=g!==void 0?g:Tg,g!==Tg&&g!==Sy)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&g===Tg&&(i=Jx),i===void 0&&g===Sy&&(i=ty),super(null,r,o,c,s,f,g,i,p),this.image={width:e,height:t},this.magFilter=s!==void 0?s:Ws,this.minFilter=f!==void 0?f:Ws,this.flipY=!1,this.generateMipmaps=!1}}TX.prototype.isDepthTexture=!0;class $l{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),o=0;t.push(0);for(let c=1;c<=e;c++)i=this.getPoint(c/e),o+=i.distanceTo(r),t.push(o),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const o=i.length;let c;t?c=t:c=e*i[o-1];let s=0,f=o-1,p;for(;s<=f;)if(r=Math.floor(s+(f-s)/2),p=i[r]-c,p<0)s=r+1;else if(p>0)f=r-1;else{f=r;break}if(r=f,i[r]===c)return r/(o-1);const g=i[r],x=i[r+1]-g,b=(c-g)/x;return(r+b)/(o-1)}getTangent(e,t){let r=e-1e-4,o=e+1e-4;r<0&&(r=0),o>1&&(o=1);const c=this.getPoint(r),s=this.getPoint(o),f=t||(c.isVector2?new li:new Fe);return f.copy(s).sub(c).normalize(),f}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new Fe,r=[],o=[],c=[],s=new Fe,f=new Ri;for(let b=0;b<=e;b++){const M=b/e;r[b]=this.getTangentAt(M,new Fe)}o[0]=new Fe,c[0]=new Fe;let p=Number.MAX_VALUE;const g=Math.abs(r[0].x),_=Math.abs(r[0].y),x=Math.abs(r[0].z);g<=p&&(p=g,i.set(1,0,0)),_<=p&&(p=_,i.set(0,1,0)),x<=p&&i.set(0,0,1),s.crossVectors(r[0],i).normalize(),o[0].crossVectors(r[0],s),c[0].crossVectors(r[0],o[0]);for(let b=1;b<=e;b++){if(o[b]=o[b-1].clone(),c[b]=c[b-1].clone(),s.crossVectors(r[b-1],r[b]),s.length()>Number.EPSILON){s.normalize();const M=Math.acos(ga(r[b-1].dot(r[b]),-1,1));o[b].applyMatrix4(f.makeRotationAxis(s,M))}c[b].crossVectors(r[b],o[b])}if(t===!0){let b=Math.acos(ga(o[0].dot(o[e]),-1,1));b/=e,r[0].dot(s.crossVectors(o[0],o[e]))>0&&(b=-b);for(let M=1;M<=e;M++)o[M].applyMatrix4(f.makeRotationAxis(r[M],b*M)),c[M].crossVectors(r[M],o[M])}return{tangents:r,normals:o,binormals:c}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class jw extends $l{constructor(e=0,t=0,i=1,r=1,o=0,c=Math.PI*2,s=!1,f=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=o,this.aEndAngle=c,this.aClockwise=s,this.aRotation=f}getPoint(e,t){const i=t||new li,r=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const c=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(c?o=0:o=r),this.aClockwise===!0&&!c&&(o===r?o=-r:o=o-r);const s=this.aStartAngle+e*o;let f=this.aX+this.xRadius*Math.cos(s),p=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const g=Math.cos(this.aRotation),_=Math.sin(this.aRotation),x=f-this.aX,b=p-this.aY;f=x*g-b*_+this.aX,p=x*_+b*g+this.aY}return i.set(f,p)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}jw.prototype.isEllipseCurve=!0;class VF extends jw{constructor(e,t,i,r,o,c){super(e,t,i,i,r,o,c),this.type="ArcCurve"}}VF.prototype.isArcCurve=!0;function U2(){let n=0,e=0,t=0,i=0;function r(o,c,s,f){n=o,e=s,t=-3*o+3*c-2*s-f,i=2*o-2*c+s+f}return{initCatmullRom:function(o,c,s,f,p){r(c,s,p*(s-o),p*(f-c))},initNonuniformCatmullRom:function(o,c,s,f,p,g,_){let x=(c-o)/p-(s-o)/(p+g)+(s-c)/g,b=(s-c)/g-(f-c)/(g+_)+(f-s)/_;x*=g,b*=g,r(c,s,x,b)},calc:function(o){const c=o*o,s=c*o;return n+e*o+t*c+i*s}}}const Hb=new Fe,cT=new U2,uT=new U2,hT=new U2;class ry extends $l{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new Fe){const i=t,r=this.points,o=r.length,c=(o-(this.closed?0:1))*e;let s=Math.floor(c),f=c-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/o)+1)*o:f===0&&s===o-1&&(s=o-2,f=1);let p,g;this.closed||s>0?p=r[(s-1)%o]:(Hb.subVectors(r[0],r[1]).add(r[0]),p=Hb);const _=r[s%o],x=r[(s+1)%o];if(this.closed||s+2<o?g=r[(s+2)%o]:(Hb.subVectors(r[o-1],r[o-2]).add(r[o-1]),g=Hb),this.curveType==="centripetal"||this.curveType==="chordal"){const b=this.curveType==="chordal"?.5:.25;let M=Math.pow(p.distanceToSquared(_),b),P=Math.pow(_.distanceToSquared(x),b),k=Math.pow(x.distanceToSquared(g),b);P<1e-4&&(P=1),M<1e-4&&(M=P),k<1e-4&&(k=P),cT.initNonuniformCatmullRom(p.x,_.x,x.x,g.x,M,P,k),uT.initNonuniformCatmullRom(p.y,_.y,x.y,g.y,M,P,k),hT.initNonuniformCatmullRom(p.z,_.z,x.z,g.z,M,P,k)}else this.curveType==="catmullrom"&&(cT.initCatmullRom(p.x,_.x,x.x,g.x,this.tension),uT.initCatmullRom(p.y,_.y,x.y,g.y,this.tension),hT.initCatmullRom(p.z,_.z,x.z,g.z,this.tension));return i.set(cT.calc(f),uT.calc(f),hT.calc(f)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new Fe().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}ry.prototype.isCatmullRomCurve3=!0;function _3(n,e,t,i,r){const o=(i-e)*.5,c=(r-t)*.5,s=n*n,f=n*s;return(2*t-2*i+o+c)*f+(-3*t+3*i-2*o-c)*s+o*n+t}function MX(n,e){const t=1-n;return t*t*e}function CX(n,e){return 2*(1-n)*n*e}function EX(n,e){return n*n*e}function sy(n,e,t,i){return MX(n,e)+CX(n,t)+EX(n,i)}function AX(n,e){const t=1-n;return t*t*t*e}function PX(n,e){const t=1-n;return 3*t*t*n*e}function IX(n,e){return 3*(1-n)*n*n*e}function LX(n,e){return n*n*n*e}function oy(n,e,t,i,r){return AX(n,e)+PX(n,t)+IX(n,i)+LX(n,r)}class j2 extends $l{constructor(e=new li,t=new li,i=new li,r=new li){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new li){const i=t,r=this.v0,o=this.v1,c=this.v2,s=this.v3;return i.set(oy(e,r.x,o.x,c.x,s.x),oy(e,r.y,o.y,c.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}j2.prototype.isCubicBezierCurve=!0;class UF extends $l{constructor(e=new Fe,t=new Fe,i=new Fe,r=new Fe){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Fe){const i=t,r=this.v0,o=this.v1,c=this.v2,s=this.v3;return i.set(oy(e,r.x,o.x,c.x,s.x),oy(e,r.y,o.y,c.y,s.y),oy(e,r.z,o.z,c.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}UF.prototype.isCubicBezierCurve3=!0;class Gw extends $l{constructor(e=new li,t=new li){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new li){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new li;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Gw.prototype.isLineCurve=!0;class RX extends $l{constructor(e=new Fe,t=new Fe){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Fe){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class G2 extends $l{constructor(e=new li,t=new li,i=new li){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new li){const i=t,r=this.v0,o=this.v1,c=this.v2;return i.set(sy(e,r.x,o.x,c.x),sy(e,r.y,o.y,c.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}G2.prototype.isQuadraticBezierCurve=!0;class jF extends $l{constructor(e=new Fe,t=new Fe,i=new Fe){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Fe){const i=t,r=this.v0,o=this.v1,c=this.v2;return i.set(sy(e,r.x,o.x,c.x),sy(e,r.y,o.y,c.y),sy(e,r.z,o.z,c.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}jF.prototype.isQuadraticBezierCurve3=!0;class q2 extends $l{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new li){const i=t,r=this.points,o=(r.length-1)*e,c=Math.floor(o),s=o-c,f=r[c===0?c:c-1],p=r[c],g=r[c>r.length-2?r.length-1:c+1],_=r[c>r.length-3?r.length-1:c+2];return i.set(_3(s,f.x,p.x,g.x,_.x),_3(s,f.y,p.y,g.y,_.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new li().fromArray(r))}return this}}q2.prototype.isSplineCurve=!0;var GF=Object.freeze({__proto__:null,ArcCurve:VF,CatmullRomCurve3:ry,CubicBezierCurve:j2,CubicBezierCurve3:UF,EllipseCurve:jw,LineCurve:Gw,LineCurve3:RX,QuadraticBezierCurve:G2,QuadraticBezierCurve3:jF,SplineCurve:q2});class kX extends $l{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Gw(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let o=0;for(;o<r.length;){if(r[o]>=i){const c=r[o]-i,s=this.curves[o],f=s.getLength(),p=f===0?0:1-c/f;return s.getPointAt(p,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,o=this.curves;r<o.length;r++){const c=o[r],s=c&&c.isEllipseCurve?e*2:c&&(c.isLineCurve||c.isLineCurve3)?1:c&&c.isSplineCurve?e*c.points.length:e,f=c.getPoints(s);for(let p=0;p<f.length;p++){const g=f[p];i&&i.equals(g)||(t.push(g),i=g)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new GF[r.type]().fromJSON(r))}return this}}class bM extends kX{constructor(e){super(),this.type="Path",this.currentPoint=new li,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Gw(this.currentPoint.clone(),new li(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const o=new G2(this.currentPoint.clone(),new li(e,t),new li(i,r));return this.curves.push(o),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,o,c){const s=new j2(this.currentPoint.clone(),new li(e,t),new li(i,r),new li(o,c));return this.curves.push(s),this.currentPoint.set(o,c),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new q2(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,o,c){const s=this.currentPoint.x,f=this.currentPoint.y;return this.absarc(e+s,t+f,i,r,o,c),this}absarc(e,t,i,r,o,c){return this.absellipse(e,t,i,i,r,o,c),this}ellipse(e,t,i,r,o,c,s,f){const p=this.currentPoint.x,g=this.currentPoint.y;return this.absellipse(e+p,t+g,i,r,o,c,s,f),this}absellipse(e,t,i,r,o,c,s,f){const p=new jw(e,t,i,r,o,c,s,f);if(this.curves.length>0){const _=p.getPoint(0);_.equals(this.currentPoint)||this.lineTo(_.x,_.y)}this.curves.push(p);const g=p.getPoint(1);return this.currentPoint.copy(g),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class r0 extends bM{constructor(e){super(e),this.uuid=bc(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new bM().fromJSON(r))}return this}}const DX={triangulate:function(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let o=qF(n,0,r,t,!0);const c=[];if(!o||o.next===o.prev)return c;let s,f,p,g,_,x,b;if(i&&(o=NX(n,e,o,t)),n.length>80*t){s=p=n[0],f=g=n[1];for(let M=t;M<r;M+=t)_=n[M],x=n[M+1],_<s&&(s=_),x<f&&(f=x),_>p&&(p=_),x>g&&(g=x);b=Math.max(p-s,g-f),b=b!==0?1/b:0}return Ey(o,c,t,s,f,b),c}};function qF(n,e,t,i,r){let o,c;if(r===YX(n,e,t,i)>0)for(o=e;o<t;o+=i)c=v3(o,n[o],n[o+1],c);else for(o=t-i;o>=e;o-=i)c=v3(o,n[o],n[o+1],c);return c&&qw(c,c.next)&&(Py(c),c=c.next),c}function Bd(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(qw(t,t.next)||os(t.prev,t,t.next)===0)){if(Py(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Ey(n,e,t,i,r,o,c){if(!n)return;!c&&o&&GX(n,i,r,o);let s=n,f,p;for(;n.prev!==n.next;){if(f=n.prev,p=n.next,o?OX(n,i,r,o):FX(n)){e.push(f.i/t),e.push(n.i/t),e.push(p.i/t),Py(n),n=p.next,s=p.next;continue}if(n=p,n===s){c?c===1?(n=zX(Bd(n),e,t),Ey(n,e,t,i,r,o,2)):c===2&&BX(n,e,t,i,r,o):Ey(Bd(n),e,t,i,r,o,1);break}}}function FX(n){const e=n.prev,t=n,i=n.next;if(os(e,t,i)>=0)return!1;let r=n.next.next;for(;r!==n.prev;){if(pg(e.x,e.y,t.x,t.y,i.x,i.y,r.x,r.y)&&os(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function OX(n,e,t,i){const r=n.prev,o=n,c=n.next;if(os(r,o,c)>=0)return!1;const s=r.x<o.x?r.x<c.x?r.x:c.x:o.x<c.x?o.x:c.x,f=r.y<o.y?r.y<c.y?r.y:c.y:o.y<c.y?o.y:c.y,p=r.x>o.x?r.x>c.x?r.x:c.x:o.x>c.x?o.x:c.x,g=r.y>o.y?r.y>c.y?r.y:c.y:o.y>c.y?o.y:c.y,_=xM(s,f,e,t,i),x=xM(p,g,e,t,i);let b=n.prevZ,M=n.nextZ;for(;b&&b.z>=_&&M&&M.z<=x;){if(b!==n.prev&&b!==n.next&&pg(r.x,r.y,o.x,o.y,c.x,c.y,b.x,b.y)&&os(b.prev,b,b.next)>=0||(b=b.prevZ,M!==n.prev&&M!==n.next&&pg(r.x,r.y,o.x,o.y,c.x,c.y,M.x,M.y)&&os(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;b&&b.z>=_;){if(b!==n.prev&&b!==n.next&&pg(r.x,r.y,o.x,o.y,c.x,c.y,b.x,b.y)&&os(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;M&&M.z<=x;){if(M!==n.prev&&M!==n.next&&pg(r.x,r.y,o.x,o.y,c.x,c.y,M.x,M.y)&&os(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function zX(n,e,t){let i=n;do{const r=i.prev,o=i.next.next;!qw(r,o)&&HF(r,i,i.next,o)&&Ay(r,o)&&Ay(o,r)&&(e.push(r.i/t),e.push(i.i/t),e.push(o.i/t),Py(i),Py(i.next),i=n=o),i=i.next}while(i!==n);return Bd(i)}function BX(n,e,t,i,r,o){let c=n;do{let s=c.next.next;for(;s!==c.prev;){if(c.i!==s.i&&WX(c,s)){let f=WF(c,s);c=Bd(c,c.next),f=Bd(f,f.next),Ey(c,e,t,i,r,o),Ey(f,e,t,i,r,o);return}s=s.next}c=c.next}while(c!==n)}function NX(n,e,t,i){const r=[];let o,c,s,f,p;for(o=0,c=e.length;o<c;o++)s=e[o]*i,f=o<c-1?e[o+1]*i:n.length,p=qF(n,s,f,i,!1),p===p.next&&(p.steiner=!0),r.push(HX(p));for(r.sort($X),o=0;o<r.length;o++)VX(r[o],t),t=Bd(t,t.next);return t}function $X(n,e){return n.x-e.x}function VX(n,e){if(e=UX(n,e),e){const t=WF(e,n);Bd(e,e.next),Bd(t,t.next)}}function UX(n,e){let t=e;const i=n.x,r=n.y;let o=-1/0,c;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const x=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(x<=i&&x>o){if(o=x,x===i){if(r===t.y)return t;if(r===t.next.y)return t.next}c=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!c)return null;if(i===o)return c;const s=c,f=c.x,p=c.y;let g=1/0,_;t=c;do i>=t.x&&t.x>=f&&i!==t.x&&pg(r<p?i:o,r,f,p,r<p?o:i,r,t.x,t.y)&&(_=Math.abs(r-t.y)/(i-t.x),Ay(t,n)&&(_<g||_===g&&(t.x>c.x||t.x===c.x&&jX(c,t)))&&(c=t,g=_)),t=t.next;while(t!==s);return c}function jX(n,e){return os(n.prev,n,e.prev)<0&&os(e.next,n,n.next)<0}function GX(n,e,t,i){let r=n;do r.z===null&&(r.z=xM(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,qX(r)}function qX(n){let e,t,i,r,o,c,s,f,p=1;do{for(t=n,n=null,o=null,c=0;t;){for(c++,i=t,s=0,e=0;e<p&&(s++,i=i.nextZ,!!i);e++);for(f=p;s>0||f>0&&i;)s!==0&&(f===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,s--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:n=r,r.prevZ=o,o=r;t=i}o.nextZ=null,p*=2}while(c>1);return n}function xM(n,e,t,i,r){return n=32767*(n-t)*r,e=32767*(e-i)*r,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function HX(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function pg(n,e,t,i,r,o,c,s){return(r-c)*(e-s)-(n-c)*(o-s)>=0&&(n-c)*(i-s)-(t-c)*(e-s)>=0&&(t-c)*(o-s)-(r-c)*(i-s)>=0}function WX(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!ZX(n,e)&&(Ay(n,e)&&Ay(e,n)&&XX(n,e)&&(os(n.prev,n,e.prev)||os(n,e.prev,e))||qw(n,e)&&os(n.prev,n,n.next)>0&&os(e.prev,e,e.next)>0)}function os(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function qw(n,e){return n.x===e.x&&n.y===e.y}function HF(n,e,t,i){const r=Zb(os(n,e,t)),o=Zb(os(n,e,i)),c=Zb(os(t,i,n)),s=Zb(os(t,i,e));return!!(r!==o&&c!==s||r===0&&Wb(n,t,e)||o===0&&Wb(n,i,e)||c===0&&Wb(t,n,i)||s===0&&Wb(t,e,i))}function Wb(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Zb(n){return n>0?1:n<0?-1:0}function ZX(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&HF(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Ay(n,e){return os(n.prev,n,n.next)<0?os(n,e,n.next)>=0&&os(n,n.prev,e)>=0:os(n,e,n.prev)<0||os(n,n.next,e)<0}function XX(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,o=(n.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&r<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function WF(n,e){const t=new wM(n.i,n.x,n.y),i=new wM(e.i,e.x,e.y),r=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function v3(n,e,t,i){const r=new wM(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Py(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function wM(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function YX(n,e,t,i){let r=0;for(let o=e,c=t-i;o<t;o+=i)r+=(n[c]-n[o])*(n[o+1]+n[c+1]),c=o;return r}class Id{static area(e){const t=e.length;let i=0;for(let r=t-1,o=0;o<t;r=o++)i+=e[r].x*e[o].y-e[o].x*e[r].y;return i*.5}static isClockWise(e){return Id.area(e)<0}static triangulateShape(e,t){const i=[],r=[],o=[];y3(e),b3(i,e);let c=e.length;t.forEach(y3);for(let f=0;f<t.length;f++)r.push(c),c+=t[f].length,b3(i,t[f]);const s=DX.triangulate(i,r);for(let f=0;f<s.length;f+=3)o.push(s.slice(f,f+3));return o}}function y3(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function b3(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class n_ extends $n{constructor(e=new r0([new li(.5,.5),new li(-.5,.5),new li(-.5,-.5),new li(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],o=[];for(let s=0,f=e.length;s<f;s++){const p=e[s];c(p)}this.setAttribute("position",new ws(r,3)),this.setAttribute("uv",new ws(o,2)),this.computeVertexNormals();function c(s){const f=[],p=t.curveSegments!==void 0?t.curveSegments:12,g=t.steps!==void 0?t.steps:1;let _=t.depth!==void 0?t.depth:1,x=t.bevelEnabled!==void 0?t.bevelEnabled:!0,b=t.bevelThickness!==void 0?t.bevelThickness:.2,M=t.bevelSize!==void 0?t.bevelSize:b-.1,P=t.bevelOffset!==void 0?t.bevelOffset:0,k=t.bevelSegments!==void 0?t.bevelSegments:3;const L=t.extrudePath,I=t.UVGenerator!==void 0?t.UVGenerator:KX;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),_=t.amount);let F,N=!1,H,Y,q,U;L&&(F=L.getSpacedPoints(g),N=!0,x=!1,H=L.computeFrenetFrames(g,!1),Y=new Fe,q=new Fe,U=new Fe),x||(k=0,b=0,M=0,P=0);const G=s.extractPoints(p);let j=G.shape;const B=G.holes;if(!Id.isClockWise(j)){j=j.reverse();for(let Ze=0,bt=B.length;Ze<bt;Ze++){const Mt=B[Ze];Id.isClockWise(Mt)&&(B[Ze]=Mt.reverse())}}const J=Id.triangulateShape(j,B),le=j;for(let Ze=0,bt=B.length;Ze<bt;Ze++){const Mt=B[Ze];j=j.concat(Mt)}function ae(Ze,bt,Mt){return bt||console.error("THREE.ExtrudeGeometry: vec does not exist"),bt.clone().multiplyScalar(Mt).add(Ze)}const pe=j.length,fe=J.length;function Te(Ze,bt,Mt){let Zt,Pt,Ee;const xe=Ze.x-bt.x,ft=Ze.y-bt.y,ve=Mt.x-Ze.x,te=Mt.y-Ze.y,se=xe*xe+ft*ft,Ie=xe*te-ft*ve;if(Math.abs(Ie)>Number.EPSILON){const Ue=Math.sqrt(se),ct=Math.sqrt(ve*ve+te*te),we=bt.x-ft/Ue,Q=bt.y+xe/Ue,ue=Mt.x-te/ct,de=Mt.y+ve/ct,Pe=((ue-we)*te-(de-Q)*ve)/(xe*te-ft*ve);Zt=we+xe*Pe-Ze.x,Pt=Q+ft*Pe-Ze.y;const Re=Zt*Zt+Pt*Pt;if(Re<=2)return new li(Zt,Pt);Ee=Math.sqrt(Re/2)}else{let Ue=!1;xe>Number.EPSILON?ve>Number.EPSILON&&(Ue=!0):xe<-Number.EPSILON?ve<-Number.EPSILON&&(Ue=!0):Math.sign(ft)===Math.sign(te)&&(Ue=!0),Ue?(Zt=-ft,Pt=xe,Ee=Math.sqrt(se)):(Zt=xe,Pt=ft,Ee=Math.sqrt(se/2))}return new li(Zt/Ee,Pt/Ee)}const Ce=[];for(let Ze=0,bt=le.length,Mt=bt-1,Zt=Ze+1;Ze<bt;Ze++,Mt++,Zt++)Mt===bt&&(Mt=0),Zt===bt&&(Zt=0),Ce[Ze]=Te(le[Ze],le[Mt],le[Zt]);const tt=[];let Ke,dt=Ce.concat();for(let Ze=0,bt=B.length;Ze<bt;Ze++){const Mt=B[Ze];Ke=[];for(let Zt=0,Pt=Mt.length,Ee=Pt-1,xe=Zt+1;Zt<Pt;Zt++,Ee++,xe++)Ee===Pt&&(Ee=0),xe===Pt&&(xe=0),Ke[Zt]=Te(Mt[Zt],Mt[Ee],Mt[xe]);tt.push(Ke),dt=dt.concat(Ke)}for(let Ze=0;Ze<k;Ze++){const bt=Ze/k,Mt=b*Math.cos(bt*Math.PI/2),Zt=M*Math.sin(bt*Math.PI/2)+P;for(let Pt=0,Ee=le.length;Pt<Ee;Pt++){const xe=ae(le[Pt],Ce[Pt],Zt);zt(xe.x,xe.y,-Mt)}for(let Pt=0,Ee=B.length;Pt<Ee;Pt++){const xe=B[Pt];Ke=tt[Pt];for(let ft=0,ve=xe.length;ft<ve;ft++){const te=ae(xe[ft],Ke[ft],Zt);zt(te.x,te.y,-Mt)}}}const et=M+P;for(let Ze=0;Ze<pe;Ze++){const bt=x?ae(j[Ze],dt[Ze],et):j[Ze];N?(q.copy(H.normals[0]).multiplyScalar(bt.x),Y.copy(H.binormals[0]).multiplyScalar(bt.y),U.copy(F[0]).add(q).add(Y),zt(U.x,U.y,U.z)):zt(bt.x,bt.y,0)}for(let Ze=1;Ze<=g;Ze++)for(let bt=0;bt<pe;bt++){const Mt=x?ae(j[bt],dt[bt],et):j[bt];N?(q.copy(H.normals[Ze]).multiplyScalar(Mt.x),Y.copy(H.binormals[Ze]).multiplyScalar(Mt.y),U.copy(F[Ze]).add(q).add(Y),zt(U.x,U.y,U.z)):zt(Mt.x,Mt.y,_/g*Ze)}for(let Ze=k-1;Ze>=0;Ze--){const bt=Ze/k,Mt=b*Math.cos(bt*Math.PI/2),Zt=M*Math.sin(bt*Math.PI/2)+P;for(let Pt=0,Ee=le.length;Pt<Ee;Pt++){const xe=ae(le[Pt],Ce[Pt],Zt);zt(xe.x,xe.y,_+Mt)}for(let Pt=0,Ee=B.length;Pt<Ee;Pt++){const xe=B[Pt];Ke=tt[Pt];for(let ft=0,ve=xe.length;ft<ve;ft++){const te=ae(xe[ft],Ke[ft],Zt);N?zt(te.x,te.y+F[g-1].y,F[g-1].x+Mt):zt(te.x,te.y,_+Mt)}}}Oe(),lt();function Oe(){const Ze=r.length/3;if(x){let bt=0,Mt=pe*bt;for(let Zt=0;Zt<fe;Zt++){const Pt=J[Zt];Lt(Pt[2]+Mt,Pt[1]+Mt,Pt[0]+Mt)}bt=g+k*2,Mt=pe*bt;for(let Zt=0;Zt<fe;Zt++){const Pt=J[Zt];Lt(Pt[0]+Mt,Pt[1]+Mt,Pt[2]+Mt)}}else{for(let bt=0;bt<fe;bt++){const Mt=J[bt];Lt(Mt[2],Mt[1],Mt[0])}for(let bt=0;bt<fe;bt++){const Mt=J[bt];Lt(Mt[0]+pe*g,Mt[1]+pe*g,Mt[2]+pe*g)}}i.addGroup(Ze,r.length/3-Ze,0)}function lt(){const Ze=r.length/3;let bt=0;Ye(le,bt),bt+=le.length;for(let Mt=0,Zt=B.length;Mt<Zt;Mt++){const Pt=B[Mt];Ye(Pt,bt),bt+=Pt.length}i.addGroup(Ze,r.length/3-Ze,1)}function Ye(Ze,bt){let Mt=Ze.length;for(;--Mt>=0;){const Zt=Mt;let Pt=Mt-1;Pt<0&&(Pt=Ze.length-1);for(let Ee=0,xe=g+k*2;Ee<xe;Ee++){const ft=pe*Ee,ve=pe*(Ee+1),te=bt+Zt+ft,se=bt+Pt+ft,Ie=bt+Pt+ve,Ue=bt+Zt+ve;At(te,se,Ie,Ue)}}}function zt(Ze,bt,Mt){f.push(Ze),f.push(bt),f.push(Mt)}function Lt(Ze,bt,Mt){Nt(Ze),Nt(bt),Nt(Mt);const Zt=r.length/3,Pt=I.generateTopUV(i,r,Zt-3,Zt-2,Zt-1);$t(Pt[0]),$t(Pt[1]),$t(Pt[2])}function At(Ze,bt,Mt,Zt){Nt(Ze),Nt(bt),Nt(Zt),Nt(bt),Nt(Mt),Nt(Zt);const Pt=r.length/3,Ee=I.generateSideWallUV(i,r,Pt-6,Pt-3,Pt-2,Pt-1);$t(Ee[0]),$t(Ee[1]),$t(Ee[3]),$t(Ee[1]),$t(Ee[2]),$t(Ee[3])}function Nt(Ze){r.push(f[Ze*3+0]),r.push(f[Ze*3+1]),r.push(f[Ze*3+2])}function $t(Ze){o.push(Ze.x),o.push(Ze.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return JX(t,i,e)}static fromJSON(e,t){const i=[];for(let o=0,c=e.shapes.length;o<c;o++){const s=t[e.shapes[o]];i.push(s)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new GF[r.type]().fromJSON(r)),new n_(i,e.options)}}const KX={generateTopUV:function(n,e,t,i,r){const o=e[t*3],c=e[t*3+1],s=e[i*3],f=e[i*3+1],p=e[r*3],g=e[r*3+1];return[new li(o,c),new li(s,f),new li(p,g)]},generateSideWallUV:function(n,e,t,i,r,o){const c=e[t*3],s=e[t*3+1],f=e[t*3+2],p=e[i*3],g=e[i*3+1],_=e[i*3+2],x=e[r*3],b=e[r*3+1],M=e[r*3+2],P=e[o*3],k=e[o*3+1],L=e[o*3+2];return Math.abs(s-g)<Math.abs(c-p)?[new li(c,1-f),new li(p,1-_),new li(x,1-M),new li(P,1-L)]:[new li(s,1-f),new li(g,1-_),new li(b,1-M),new li(k,1-L)]}};function JX(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const o=n[i];t.shapes.push(o.uuid)}else t.shapes.push(n.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class H2 extends $n{constructor(e=new r0([new li(0,.5),new li(-.5,-.5),new li(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],o=[],c=[];let s=0,f=0;if(Array.isArray(e)===!1)p(e);else for(let g=0;g<e.length;g++)p(e[g]),this.addGroup(s,f,g),s+=f,f=0;this.setIndex(i),this.setAttribute("position",new ws(r,3)),this.setAttribute("normal",new ws(o,3)),this.setAttribute("uv",new ws(c,2));function p(g){const _=r.length/3,x=g.extractPoints(t);let b=x.shape;const M=x.holes;Id.isClockWise(b)===!1&&(b=b.reverse());for(let k=0,L=M.length;k<L;k++){const I=M[k];Id.isClockWise(I)===!0&&(M[k]=I.reverse())}const P=Id.triangulateShape(b,M);for(let k=0,L=M.length;k<L;k++){const I=M[k];b=b.concat(I)}for(let k=0,L=b.length;k<L;k++){const I=b[k];r.push(I.x,I.y,0),o.push(0,0,1),c.push(I.x,I.y)}for(let k=0,L=P.length;k<L;k++){const I=P[k],F=I[0]+_,N=I[1]+_,H=I[2]+_;i.push(F,N,H),f+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return QX(t,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const c=t[e.shapes[r]];i.push(c)}return new H2(i,e.curveSegments)}}function QX(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}class W2 extends $n{constructor(e=1,t=32,i=16,r=0,o=Math.PI*2,c=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:o,thetaStart:c,thetaLength:s},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const f=Math.min(c+s,Math.PI);let p=0;const g=[],_=new Fe,x=new Fe,b=[],M=[],P=[],k=[];for(let L=0;L<=i;L++){const I=[],F=L/i;let N=0;L==0&&c==0?N=.5/t:L==i&&f==Math.PI&&(N=-.5/t);for(let H=0;H<=t;H++){const Y=H/t;_.x=-e*Math.cos(r+Y*o)*Math.sin(c+F*s),_.y=e*Math.cos(c+F*s),_.z=e*Math.sin(r+Y*o)*Math.sin(c+F*s),M.push(_.x,_.y,_.z),x.copy(_).normalize(),P.push(x.x,x.y,x.z),k.push(Y+N,1-F),I.push(p++)}g.push(I)}for(let L=0;L<i;L++)for(let I=0;I<t;I++){const F=g[L][I+1],N=g[L][I],H=g[L+1][I],Y=g[L+1][I+1];(L!==0||c>0)&&b.push(F,N,Y),(L!==i-1||f<Math.PI)&&b.push(N,H,Y)}this.setIndex(b),this.setAttribute("position",new ws(M,3)),this.setAttribute("normal",new ws(P,3)),this.setAttribute("uv",new ws(k,2))}static fromJSON(e){return new W2(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class eY extends Bo{constructor(e){super(),this.type="ShadowMaterial",this.color=new Bi(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}eY.prototype.isShadowMaterial=!0;class ZF extends Bo{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Bi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qg,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}ZF.prototype.isMeshStandardMaterial=!0;class tY extends ZF{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new li(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ga(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Bi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Bi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Bi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}tY.prototype.isMeshPhysicalMaterial=!0;class iY extends Bo{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Bi(16777215),this.specular=new Bi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qg,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=kw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}iY.prototype.isMeshPhongMaterial=!0;class nY extends Bo{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Bi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qg,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}nY.prototype.isMeshToonMaterial=!0;class rY extends Bo{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qg,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}rY.prototype.isMeshNormalMaterial=!0;class sY extends Bo{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=kw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}sY.prototype.isMeshLambertMaterial=!0;class oY extends Bo{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Bi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Qg,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}oY.prototype.isMeshMatcapMaterial=!0;class aY extends Ah{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}aY.prototype.isLineDashedMaterial=!0;const es={arraySlice:function(n,e,t){return es.isTypedArray(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){function e(r,o){return n[r]-n[o]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i},sortedArray:function(n,e,t){const i=n.length,r=new n.constructor(i);for(let o=0,c=0;c!==i;++o){const s=t[o]*e;for(let f=0;f!==e;++f)r[c++]=n[s+f]}return r},flattenJSON:function(n,e,t,i){let r=1,o=n[0];for(;o!==void 0&&o[i]===void 0;)o=n[r++];if(o===void 0)return;let c=o[i];if(c!==void 0)if(Array.isArray(c))do c=o[i],c!==void 0&&(e.push(o.time),t.push.apply(t,c)),o=n[r++];while(o!==void 0);else if(c.toArray!==void 0)do c=o[i],c!==void 0&&(e.push(o.time),c.toArray(t,t.length)),o=n[r++];while(o!==void 0);else do c=o[i],c!==void 0&&(e.push(o.time),t.push(c)),o=n[r++];while(o!==void 0)},subclip:function(n,e,t,i,r=30){const o=n.clone();o.name=e;const c=[];for(let f=0;f<o.tracks.length;++f){const p=o.tracks[f],g=p.getValueSize(),_=[],x=[];for(let b=0;b<p.times.length;++b){const M=p.times[b]*r;if(!(M<t||M>=i)){_.push(p.times[b]);for(let P=0;P<g;++P)x.push(p.values[b*g+P])}}_.length!==0&&(p.times=es.convertArray(_,p.times.constructor),p.values=es.convertArray(x,p.values.constructor),c.push(p))}o.tracks=c;let s=1/0;for(let f=0;f<o.tracks.length;++f)s>o.tracks[f].times[0]&&(s=o.tracks[f].times[0]);for(let f=0;f<o.tracks.length;++f)o.tracks[f].shift(-1*s);return o.resetDuration(),o},makeClipAdditive:function(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,o=e/i;for(let c=0;c<r;++c){const s=t.tracks[c],f=s.ValueTypeName;if(f==="bool"||f==="string")continue;const p=n.tracks.find(function(L){return L.name===s.name&&L.ValueTypeName===f});if(p===void 0)continue;let g=0;const _=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=_/3);let x=0;const b=p.getValueSize();p.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(x=b/3);const M=s.times.length-1;let P;if(o<=s.times[0]){const L=g,I=_-g;P=es.arraySlice(s.values,L,I)}else if(o>=s.times[M]){const L=M*_+g,I=L+_-g;P=es.arraySlice(s.values,L,I)}else{const L=s.createInterpolant(),I=g,F=_-g;L.evaluate(o),P=es.arraySlice(L.resultBuffer,I,F)}f==="quaternion"&&new go().fromArray(P).normalize().conjugate().toArray(P);const k=p.times.length;for(let L=0;L<k;++L){const I=L*b+x;if(f==="quaternion")go.multiplyQuaternionsFlat(p.values,I,P,0,p.values,I);else{const F=b-x*2;for(let N=0;N<F;++N)p.values[I+N]-=P[N]}}}return n.blendMode=cF,n}};class Nd{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],o=t[i-1];e:{t:{let c;i:{n:if(!(e<r)){for(let s=i+2;;){if(r===void 0){if(e<o)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,o)}if(i===s)break;if(o=r,r=t[++i],e<r)break t}c=t.length;break i}if(!(e>=o)){const s=t[1];e<s&&(i=2,o=s);for(let f=i-2;;){if(o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===f)break;if(r=o,o=t[--i-1],e>=o)break t}c=i,i=0;break i}break e}for(;i<c;){const s=i+c>>>1;e<t[s]?c=s:i=s+1}if(r=t[i],o=t[i-1],o===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(r===void 0)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,o,e)}this._cachedIndex=i,this.intervalChanged_(i,o,r)}return this.interpolate_(i,o,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,o=e*r;for(let c=0;c!==r;++c)t[c]=i[o+c];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Nd.prototype.beforeStart_=Nd.prototype.copySampleValue_;Nd.prototype.afterEnd_=Nd.prototype.copySampleValue_;class lY extends Nd{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:dg,endingEnd:dg}}intervalChanged_(e,t,i){const r=this.parameterPositions;let o=e-2,c=e+1,s=r[o],f=r[c];if(s===void 0)switch(this.getSettings_().endingStart){case fg:o=e,s=2*t-i;break;case tw:o=r.length-2,s=t+r[o]-r[o+1];break;default:o=e,s=i}if(f===void 0)switch(this.getSettings_().endingEnd){case fg:c=e,f=2*i-t;break;case tw:c=1,f=i+r[1]-r[0];break;default:c=e-1,f=t}const p=(i-t)*.5,g=this.valueSize;this._weightPrev=p/(t-s),this._weightNext=p/(f-i),this._offsetPrev=o*g,this._offsetNext=c*g}interpolate_(e,t,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,f=e*s,p=f-s,g=this._offsetPrev,_=this._offsetNext,x=this._weightPrev,b=this._weightNext,M=(i-t)/(r-t),P=M*M,k=P*M,L=-x*k+2*x*P-x*M,I=(1+x)*k+(-1.5-2*x)*P+(-.5+x)*M+1,F=(-1-b)*k+(1.5+b)*P+.5*M,N=b*k-b*P;for(let H=0;H!==s;++H)o[H]=L*c[g+H]+I*c[p+H]+F*c[f+H]+N*c[_+H];return o}}class XF extends Nd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,f=e*s,p=f-s,g=(i-t)/(r-t),_=1-g;for(let x=0;x!==s;++x)o[x]=c[p+x]*_+c[f+x]*g;return o}}class cY extends Nd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class bu{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=es.convertArray(t,this.TimeBufferType),this.values=es.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:es.convertArray(e.times,Array),values:es.convertArray(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new cY(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new XF(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new lY(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Qx:t=this.InterpolantFactoryMethodDiscrete;break;case ew:t=this.InterpolantFactoryMethodLinear;break;case RS:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Qx;case this.InterpolantFactoryMethodLinear:return ew;case this.InterpolantFactoryMethodSmooth:return RS}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let o=0,c=r-1;for(;o!==r&&i[o]<e;)++o;for(;c!==-1&&i[c]>t;)--c;if(++c,o!==0||c!==r){o>=c&&(c=Math.max(c,1),o=c-1);const s=this.getValueSize();this.times=es.arraySlice(i,o,c),this.values=es.arraySlice(this.values,o*s,c*s)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,o=i.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let c=null;for(let s=0;s!==o;s++){const f=i[s];if(typeof f=="number"&&isNaN(f)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,f),e=!1;break}if(c!==null&&c>f){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,f,c),e=!1;break}c=f}if(r!==void 0&&es.isTypedArray(r))for(let s=0,f=r.length;s!==f;++s){const p=r[s];if(isNaN(p)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,p),e=!1;break}}return e}optimize(){const e=es.arraySlice(this.times),t=es.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===RS,o=e.length-1;let c=1;for(let s=1;s<o;++s){let f=!1;const p=e[s],g=e[s+1];if(p!==g&&(s!==1||p!==e[0]))if(r)f=!0;else{const _=s*i,x=_-i,b=_+i;for(let M=0;M!==i;++M){const P=t[_+M];if(P!==t[x+M]||P!==t[b+M]){f=!0;break}}}if(f){if(s!==c){e[c]=e[s];const _=s*i,x=c*i;for(let b=0;b!==i;++b)t[x+b]=t[_+b]}++c}}if(o>0){e[c]=e[o];for(let s=o*i,f=c*i,p=0;p!==i;++p)t[f+p]=t[s+p];++c}return c!==e.length?(this.times=es.arraySlice(e,0,c),this.values=es.arraySlice(t,0,c*i)):(this.times=e,this.values=t),this}clone(){const e=es.arraySlice(this.times,0),t=es.arraySlice(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}bu.prototype.TimeBufferType=Float32Array;bu.prototype.ValueBufferType=Float32Array;bu.prototype.DefaultInterpolation=ew;class r_ extends bu{}r_.prototype.ValueTypeName="bool";r_.prototype.ValueBufferType=Array;r_.prototype.DefaultInterpolation=Qx;r_.prototype.InterpolantFactoryMethodLinear=void 0;r_.prototype.InterpolantFactoryMethodSmooth=void 0;class YF extends bu{}YF.prototype.ValueTypeName="color";class nw extends bu{}nw.prototype.ValueTypeName="number";class uY extends Nd{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const o=this.resultBuffer,c=this.sampleValues,s=this.valueSize,f=(i-t)/(r-t);let p=e*s;for(let g=p+s;p!==g;p+=4)go.slerpFlat(o,0,c,p-s,c,p,f);return o}}class s0 extends bu{InterpolantFactoryMethodLinear(e){return new uY(this.times,this.values,this.getValueSize(),e)}}s0.prototype.ValueTypeName="quaternion";s0.prototype.DefaultInterpolation=ew;s0.prototype.InterpolantFactoryMethodSmooth=void 0;class s_ extends bu{}s_.prototype.ValueTypeName="string";s_.prototype.ValueBufferType=Array;s_.prototype.DefaultInterpolation=Qx;s_.prototype.InterpolantFactoryMethodLinear=void 0;s_.prototype.InterpolantFactoryMethodSmooth=void 0;class rw extends bu{}rw.prototype.ValueTypeName="vector";class x3{constructor(e,t=-1,i,r=k2){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=bc(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let c=0,s=i.length;c!==s;++c)t.push(dY(i[c]).scale(r));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,c=i.length;o!==c;++o)t.push(bu.toJSON(i[o]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const o=t.length,c=[];for(let s=0;s<o;s++){let f=[],p=[];f.push((s+o-1)%o,s,(s+1)%o),p.push(0,1,0);const g=es.getKeyframeOrder(f);f=es.sortedArray(f,1,g),p=es.sortedArray(p,1,g),!r&&f[0]===0&&(f.push(o),p.push(p[0])),c.push(new nw(".morphTargetInfluences["+t[s].name+"]",f,p).scale(1/i))}return new this(e,-1,c)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},o=/^([\w-]*?)([\d]+)$/;for(let s=0,f=e.length;s<f;s++){const p=e[s],g=p.name.match(o);if(g&&g.length>1){const _=g[1];let x=r[_];x||(r[_]=x=[]),x.push(p)}}const c=[];for(const s in r)c.push(this.CreateFromMorphTargetSequence(s,r[s],t,i));return c}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(_,x,b,M,P){if(b.length!==0){const k=[],L=[];es.flattenJSON(b,k,L,M),k.length!==0&&P.push(new _(x,k,L))}},r=[],o=e.name||"default",c=e.fps||30,s=e.blendMode;let f=e.length||-1;const p=e.hierarchy||[];for(let _=0;_<p.length;_++){const x=p[_].keys;if(!(!x||x.length===0))if(x[0].morphTargets){const b={};let M;for(M=0;M<x.length;M++)if(x[M].morphTargets)for(let P=0;P<x[M].morphTargets.length;P++)b[x[M].morphTargets[P]]=-1;for(const P in b){const k=[],L=[];for(let I=0;I!==x[M].morphTargets.length;++I){const F=x[M];k.push(F.time),L.push(F.morphTarget===P?1:0)}r.push(new nw(".morphTargetInfluence["+P+"]",k,L))}f=b.length*c}else{const b=".bones["+t[_].name+"]";i(rw,b+".position",x,"pos",r),i(s0,b+".quaternion",x,"rot",r),i(rw,b+".scale",x,"scl",r)}}return r.length===0?null:new this(o,f,r,s)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const o=this.tracks[i];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function hY(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return nw;case"vector":case"vector2":case"vector3":case"vector4":return rw;case"color":return YF;case"quaternion":return s0;case"bool":case"boolean":return r_;case"string":return s_}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function dY(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=hY(n.type);if(n.times===void 0){const t=[],i=[];es.flattenJSON(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const $g={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class fY{constructor(e,t,i){const r=this;let o=!1,c=0,s=0,f;const p=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(g){s++,o===!1&&r.onStart!==void 0&&r.onStart(g,c,s),o=!0},this.itemEnd=function(g){c++,r.onProgress!==void 0&&r.onProgress(g,c,s),c===s&&(o=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(g){r.onError!==void 0&&r.onError(g)},this.resolveURL=function(g){return f?f(g):g},this.setURLModifier=function(g){return f=g,this},this.addHandler=function(g,_){return p.push(g,_),this},this.removeHandler=function(g){const _=p.indexOf(g);return _!==-1&&p.splice(_,2),this},this.getHandler=function(g){for(let _=0,x=p.length;_<x;_+=2){const b=p[_],M=p[_+1];if(b.global&&(b.lastIndex=0),b.test(g))return M}return null}}}const pY=new fY;class Zd{constructor(e){this.manager=e!==void 0?e:pY,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,o){i.load(e,r,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const rh={};class mY extends Zd{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=$g.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(rh[e]!==void 0){rh[e].push({onLoad:t,onProgress:i,onError:r});return}rh[e]=[],rh[e].push({onLoad:t,onProgress:i,onError:r});const c=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(c).then(s=>{if(s.status===200||s.status===0){s.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const f=rh[e],p=s.body.getReader(),g=s.headers.get("Content-Length"),_=g?parseInt(g):0,x=_!==0;let b=0;return new ReadableStream({start(M){P();function P(){p.read().then(({done:k,value:L})=>{if(k)M.close();else{b+=L.byteLength;const I=new ProgressEvent("progress",{lengthComputable:x,loaded:b,total:_});for(let F=0,N=f.length;F<N;F++){const H=f[F];H.onProgress&&H.onProgress(I)}M.enqueue(L),P()}})}}})}else throw Error(`fetch for "${s.url}" responded with ${s.status}: ${s.statusText}`)}).then(s=>{const f=new Response(s);switch(this.responseType){case"arraybuffer":return f.arrayBuffer();case"blob":return f.blob();case"document":return f.text().then(p=>new DOMParser().parseFromString(p,this.mimeType));case"json":return f.json();default:return f.text()}}).then(s=>{$g.add(e,s);const f=rh[e];delete rh[e];for(let p=0,g=f.length;p<g;p++){const _=f[p];_.onLoad&&_.onLoad(s)}this.manager.itemEnd(e)}).catch(s=>{const f=rh[e];delete rh[e];for(let p=0,g=f.length;p<g;p++){const _=f[p];_.onError&&_.onError(s)}this.manager.itemError(e),this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class KF extends Zd{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,c=$g.get(e);if(c!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(c),o.manager.itemEnd(e)},0),c;const s=Ow("img");function f(){g(),$g.add(e,this),t&&t(this),o.manager.itemEnd(e)}function p(_){g(),r&&r(_),o.manager.itemError(e),o.manager.itemEnd(e)}function g(){s.removeEventListener("load",f,!1),s.removeEventListener("error",p,!1)}return s.addEventListener("load",f,!1),s.addEventListener("error",p,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),o.manager.itemStart(e),s.src=e,s}}class gY extends Zd{constructor(e){super(e)}load(e,t,i,r){const o=new zw,c=new KF(this.manager);c.setCrossOrigin(this.crossOrigin),c.setPath(this.path);let s=0;function f(p){c.load(e[p],function(g){o.images[p]=g,s++,s===6&&(o.needsUpdate=!0,t&&t(o))},void 0,r)}for(let p=0;p<e.length;++p)f(p);return o}}class _Y extends Zd{constructor(e){super(e)}load(e,t,i,r){const o=new zs,c=new KF(this.manager);return c.setCrossOrigin(this.crossOrigin),c.setPath(this.path),c.load(e,function(s){o.image=s,o.needsUpdate=!0,t!==void 0&&t(o)},i,r),o}}class gu extends Rn{constructor(e,t=1){super(),this.type="Light",this.color=new Bi(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}gu.prototype.isLight=!0;class vY extends gu{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(Rn.DefaultUp),this.updateMatrix(),this.groundColor=new Bi(t)}copy(e){return gu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}vY.prototype.isHemisphereLight=!0;const w3=new Ri,S3=new Fe,T3=new Fe;class Z2{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new li(512,512),this.map=null,this.mapPass=null,this.matrix=new Ri,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Bw,this._frameExtents=new li(1,1),this._viewportCount=1,this._viewports=[new Zn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;S3.setFromMatrixPosition(e.matrixWorld),t.position.copy(S3),T3.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(T3),t.updateMatrixWorld(),w3.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(w3),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class JF extends Z2{constructor(){super(new ea(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=My*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(i!==t.fov||r!==t.aspect||o!==t.far)&&(t.fov=i,t.aspect=r,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}JF.prototype.isSpotLightShadow=!0;class yY extends gu{constructor(e,t,i=0,r=Math.PI/3,o=0,c=1){super(e,t),this.type="SpotLight",this.position.copy(Rn.DefaultUp),this.updateMatrix(),this.target=new Rn,this.distance=i,this.angle=r,this.penumbra=o,this.decay=c,this.shadow=new JF}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}yY.prototype.isSpotLight=!0;const M3=new Ri,wv=new Fe,dT=new Fe;class QF extends Z2{constructor(){super(new ea(90,1,.5,500)),this._frameExtents=new li(4,2),this._viewportCount=6,this._viewports=[new Zn(2,1,1,1),new Zn(0,1,1,1),new Zn(3,1,1,1),new Zn(1,1,1,1),new Zn(3,0,1,1),new Zn(1,0,1,1)],this._cubeDirections=[new Fe(1,0,0),new Fe(-1,0,0),new Fe(0,0,1),new Fe(0,0,-1),new Fe(0,1,0),new Fe(0,-1,0)],this._cubeUps=[new Fe(0,1,0),new Fe(0,1,0),new Fe(0,1,0),new Fe(0,1,0),new Fe(0,0,1),new Fe(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,o=e.distance||i.far;o!==i.far&&(i.far=o,i.updateProjectionMatrix()),wv.setFromMatrixPosition(e.matrixWorld),i.position.copy(wv),dT.copy(i.position),dT.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(dT),i.updateMatrixWorld(),r.makeTranslation(-wv.x,-wv.y,-wv.z),M3.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(M3)}}QF.prototype.isPointLightShadow=!0;class bY extends gu{constructor(e,t,i=0,r=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new QF}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}bY.prototype.isPointLight=!0;class eO extends Z2{constructor(){super(new $w(-5,5,5,-5,.5,500))}}eO.prototype.isDirectionalLightShadow=!0;class xY extends gu{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Rn.DefaultUp),this.updateMatrix(),this.target=new Rn,this.shadow=new eO}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}xY.prototype.isDirectionalLight=!0;class wY extends gu{constructor(e,t){super(e,t),this.type="AmbientLight"}}wY.prototype.isAmbientLight=!0;class SY extends gu{constructor(e,t,i=10,r=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}SY.prototype.isRectAreaLight=!0;class tO{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Fe)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,o=e.z,c=this.coefficients;return t.copy(c[0]).multiplyScalar(.282095),t.addScaledVector(c[1],.488603*r),t.addScaledVector(c[2],.488603*o),t.addScaledVector(c[3],.488603*i),t.addScaledVector(c[4],1.092548*(i*r)),t.addScaledVector(c[5],1.092548*(r*o)),t.addScaledVector(c[6],.315392*(3*o*o-1)),t.addScaledVector(c[7],1.092548*(i*o)),t.addScaledVector(c[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,o=e.z,c=this.coefficients;return t.copy(c[0]).multiplyScalar(.886227),t.addScaledVector(c[1],2*.511664*r),t.addScaledVector(c[2],2*.511664*o),t.addScaledVector(c[3],2*.511664*i),t.addScaledVector(c[4],2*.429043*i*r),t.addScaledVector(c[5],2*.429043*r*o),t.addScaledVector(c[6],.743125*o*o-.247708),t.addScaledVector(c[7],2*.429043*i*o),t.addScaledVector(c[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,o=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*o,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*i*o,t[8]=.546274*(i*i-r*r)}}tO.prototype.isSphericalHarmonics3=!0;class X2 extends gu{constructor(e=new tO,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}X2.prototype.isLightProbe=!0;class TY{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class MY extends $n{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}MY.prototype.isInstancedBufferGeometry=!0;class CY extends Zd{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,c=$g.get(e);if(c!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(c),o.manager.itemEnd(e)},0),c;const s={};s.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then(function(f){return f.blob()}).then(function(f){return createImageBitmap(f,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(f){$g.add(e,f),t&&t(f),o.manager.itemEnd(e)}).catch(function(f){r&&r(f),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}}CY.prototype.isImageBitmapLoader=!0;let Xb;const EY={getContext:function(){return Xb===void 0&&(Xb=new(window.AudioContext||window.webkitAudioContext)),Xb},setContext:function(n){Xb=n}};class AY extends Zd{constructor(e){super(e)}load(e,t,i,r){const o=this,c=new mY(this.manager);c.setResponseType("arraybuffer"),c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(s){try{const f=s.slice(0);EY.getContext().decodeAudioData(f,function(g){t(g)})}catch(f){r?r(f):console.error(f),o.manager.itemError(e)}},i,r)}}class PY extends X2{constructor(e,t,i=1){super(void 0,i);const r=new Bi().set(e),o=new Bi().set(t),c=new Fe(r.r,r.g,r.b),s=new Fe(o.r,o.g,o.b),f=Math.sqrt(Math.PI),p=f*Math.sqrt(.75);this.sh.coefficients[0].copy(c).add(s).multiplyScalar(f),this.sh.coefficients[1].copy(c).sub(s).multiplyScalar(p)}}PY.prototype.isHemisphereLightProbe=!0;class IY extends X2{constructor(e,t=1){super(void 0,t);const i=new Bi().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}IY.prototype.isAmbientLightProbe=!0;class LY{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=C3(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=C3();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function C3(){return(typeof performance>"u"?Date:performance).now()}class RY extends Rn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}class kY{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,o,c;switch(t){case"quaternion":r=this._slerp,o=this._slerpAdditive,c=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,o=this._select,c=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,o=this._lerpAdditive,c=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=o,this._setIdentity=c,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,o=e*r+r;let c=this.cumulativeWeight;if(c===0){for(let s=0;s!==r;++s)i[o+s]=i[s];c=t}else{c+=t;const s=t/c;this._mixBufferRegion(i,o,0,s,r)}this.cumulativeWeight=c}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,o=this.cumulativeWeight,c=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const f=t*this._origIndex;this._mixBufferRegion(i,r,f,1-o,t)}c>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let f=t,p=t+t;f!==p;++f)if(i[f]!==i[f+t]){s.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let o=i,c=r;o!==c;++o)t[o]=t[r+o%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,o){if(r>=.5)for(let c=0;c!==o;++c)e[t+c]=e[i+c]}_slerp(e,t,i,r){go.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,o){const c=this._workIndex*o;go.multiplyQuaternionsFlat(e,c,e,t,e,i),go.slerpFlat(e,t,e,t,e,c,r)}_lerp(e,t,i,r,o){const c=1-r;for(let s=0;s!==o;++s){const f=t+s;e[f]=e[f]*c+e[i+s]*r}}_lerpAdditive(e,t,i,r,o){for(let c=0;c!==o;++c){const s=t+c;e[s]=e[s]+e[i+c]*r}}}const Y2="\\[\\]\\.:\\/",DY=new RegExp("["+Y2+"]","g"),K2="[^"+Y2+"]",FY="[^"+Y2.replace("\\.","")+"]",OY=/((?:WC+[\/:])*)/.source.replace("WC",K2),zY=/(WCOD+)?/.source.replace("WCOD",FY),BY=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",K2),NY=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",K2),$Y=new RegExp("^"+OY+zY+BY+NY+"$"),VY=["material","materials","bones"];class UY{constructor(e,t,i){const r=i||lr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,o=i.length;r!==o;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class lr{constructor(e,t,i){this.path=t,this.parsedPath=i||lr.parseTrackName(t),this.node=lr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new lr.Composite(e,t,i):new lr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(DY,"")}static parseTrackName(e){const t=$Y.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const o=i.nodeName.substring(r+1);VY.indexOf(o)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=o)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(o){for(let c=0;c<o.length;c++){const s=o[c];if(s.name===t||s.uuid===t)return s;const f=i(s.children);if(f)return f}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let o=t.propertyIndex;if(e||(e=lr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let p=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let g=0;g<e.length;g++)if(e[g].name===p){p=g;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(p!==void 0){if(e[p]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[p]}}const c=e[r];if(c===void 0){const p=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+p+"."+r+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?s=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(s=this.Versioning.MatrixWorldNeedsUpdate);let f=this.BindingType.Direct;if(o!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}f=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=o}else c.fromArray!==void 0&&c.toArray!==void 0?(f=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(f=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=r;this.getValue=this.GetterByBindingType[f],this.setValue=this.SetterByBindingTypeAndVersioning[f][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}lr.Composite=UY;lr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};lr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};lr.prototype.GetterByBindingType=[lr.prototype._getValue_direct,lr.prototype._getValue_array,lr.prototype._getValue_arrayElement,lr.prototype._getValue_toArray];lr.prototype.SetterByBindingTypeAndVersioning=[[lr.prototype._setValue_direct,lr.prototype._setValue_direct_setNeedsUpdate,lr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_array,lr.prototype._setValue_array_setNeedsUpdate,lr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_arrayElement,lr.prototype._setValue_arrayElement_setNeedsUpdate,lr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_fromArray,lr.prototype._setValue_fromArray_setNeedsUpdate,lr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class jY{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const o=t.tracks,c=o.length,s=new Array(c),f={endingStart:dg,endingEnd:dg};for(let p=0;p!==c;++p){const g=o[p].createInterpolant(null);s[p]=g,g.settings=f}this._interpolantSettings=f,this._interpolants=s,this._propertyBindings=new Array(c),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=dq,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const r=this._clip.duration,o=e._clip.duration,c=o/r,s=r/o;e.warp(1,c,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,o=r.time,c=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const f=s.parameterPositions,p=s.sampleValues;return f[0]=o,f[1]=o+i,p[0]=e/c,p[1]=t/c,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const f=(e-o)*i;if(f<0||i===0)return;this._startTime=null,t=i*f}t*=this._updateTimeScale(e);const c=this._updateTime(t),s=this._updateWeight(e);if(s>0){const f=this._interpolants,p=this._propertyBindings;switch(this.blendMode){case cF:for(let g=0,_=f.length;g!==_;++g)f[g].evaluate(c),p[g].accumulateAdditive(s);break;case k2:default:for(let g=0,_=f.length;g!==_;++g)f[g].evaluate(c),p[g].accumulate(r,s)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,o=this._loopCount;const c=i===fq;if(e===0)return o===-1?r:c&&(o&1)===1?t-r:r;if(i===hq){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,c)):this._setEndings(this.repetitions===0,!0,c)),r>=t||r<0){const s=Math.floor(r/t);r-=t*s,o+=Math.abs(s);const f=this.repetitions-o;if(f<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(f===1){const p=e<0;this._setEndings(p,!p,c)}else this._setEndings(!1,!1,c);this._loopCount=o,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=r;if(c&&(o&1)===1)return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=fg,r.endingEnd=fg):(e?r.endingStart=this.zeroSlopeAtStart?fg:dg:r.endingStart=tw,t?r.endingEnd=this.zeroSlopeAtEnd?fg:dg:r.endingEnd=tw)}_scheduleFading(e,t,i){const r=this._mixer,o=r.time;let c=this._weightInterpolant;c===null&&(c=r._lendControlInterpolant(),this._weightInterpolant=c);const s=c.parameterPositions,f=c.sampleValues;return s[0]=o,f[0]=t,s[1]=o+e,f[1]=i,this}}class GY extends bp{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,o=r.length,c=e._propertyBindings,s=e._interpolants,f=i.uuid,p=this._bindingsByRootAndName;let g=p[f];g===void 0&&(g={},p[f]=g);for(let _=0;_!==o;++_){const x=r[_],b=x.name;let M=g[b];if(M!==void 0)c[_]=M;else{if(M=c[_],M!==void 0){M._cacheIndex===null&&(++M.referenceCount,this._addInactiveBinding(M,f,b));continue}const P=t&&t._propertyBindings[_].binding.parsedPath;M=new kY(lr.create(i,b,P),x.ValueTypeName,x.getValueSize()),++M.referenceCount,this._addInactiveBinding(M,f,b),c[_]=M}s[_].resultBuffer=M.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,o=this._actionsByClip[r];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,o=this._actionsByClip;let c=o[t];if(c===void 0)c={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=c;else{const s=c.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=r.length,r.push(e),c.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,c=this._actionsByClip,s=c[o],f=s.knownActions,p=f[f.length-1],g=e._byClipCacheIndex;p._byClipCacheIndex=g,f[g]=p,f.pop(),e._byClipCacheIndex=null;const _=s.actionByRoot,x=(e._localRoot||this._root).uuid;delete _[x],f.length===0&&delete c[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const o=t[i];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,o=this._bindings;let c=r[t];c===void 0&&(c={},r[t]=c),c[i]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,o=i.path,c=this._bindingsByRootAndName,s=c[r],f=t[t.length-1],p=e._cacheIndex;f._cacheIndex=p,t[p]=f,t.pop(),delete s[o],Object.keys(s).length===0&&delete c[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=i,t[i]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new XF(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=t[r];e.__cacheIndex=r,t[r]=e,o.__cacheIndex=i,t[i]=o}clipAction(e,t,i){const r=t||this._root,o=r.uuid;let c=typeof e=="string"?x3.findByName(r,e):e;const s=c!==null?c.uuid:e,f=this._actionsByClip[s];let p=null;if(i===void 0&&(c!==null?i=c.blendMode:i=k2),f!==void 0){const _=f.actionByRoot[o];if(_!==void 0&&_.blendMode===i)return _;p=f.knownActions[0],c===null&&(c=p._clip)}if(c===null)return null;const g=new jY(this,c,t,i);return this._bindAction(g,p),this._addInactiveAction(g,s,o),g}existingAction(e,t){const i=t||this._root,r=i.uuid,o=typeof e=="string"?x3.findByName(i,e):e,c=o?o.uuid:e,s=this._actionsByClip[c];return s!==void 0&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,o=Math.sign(e),c=this._accuIndex^=1;for(let p=0;p!==i;++p)t[p]._update(r,e,o,c);const s=this._bindings,f=this._nActiveBindings;for(let p=0;p!==f;++p)s[p].apply(c);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,o=r[i];if(o!==void 0){const c=o.knownActions;for(let s=0,f=c.length;s!==f;++s){const p=c[s];this._deactivateAction(p);const g=p._cacheIndex,_=t[t.length-1];p._cacheIndex=null,p._byClipCacheIndex=null,_._cacheIndex=g,t[g]=_,t.pop(),this._removeInactiveBindingsForAction(p)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const c in i){const s=i[c].actionByRoot,f=s[t];f!==void 0&&(this._deactivateAction(f),this._removeInactiveAction(f))}const r=this._bindingsByRootAndName,o=r[t];if(o!==void 0)for(const c in o){const s=o[c];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}GY.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class qY extends n0{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}qY.prototype.isInstancedInterleavedBuffer=!0;class sw{constructor(e,t,i=0,r=1/0){this.ray=new xp(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new gF,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return SM(e,this,i,t),i.sort(E3),i}intersectObjects(e,t=!0,i=[]){for(let r=0,o=e.length;r<o;r++)SM(e[r],this,i,t);return i.sort(E3),i}}function E3(n,e){return n.distance-e.distance}function SM(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const r=n.children;for(let o=0,c=r.length;o<c;o++)SM(r[o],e,t,!0)}}const gd=new Fe,Yb=new Ri,fT=new Ri;class HY extends Uw{constructor(e){const t=iO(e),i=new $n,r=[],o=[],c=new Bi(0,0,1),s=new Bi(0,1,0);for(let p=0;p<t.length;p++){const g=t[p];g.parent&&g.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(c.r,c.g,c.b),o.push(s.r,s.g,s.b))}i.setAttribute("position",new ws(r,3)),i.setAttribute("color",new ws(o,3));const f=new Ah({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,f),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");fT.copy(this.root.matrixWorld).invert();for(let o=0,c=0;o<t.length;o++){const s=t[o];s.parent&&s.parent.isBone&&(Yb.multiplyMatrices(fT,s.matrixWorld),gd.setFromMatrixPosition(Yb),r.setXYZ(c,gd.x,gd.y,gd.z),Yb.multiplyMatrices(fT,s.parent.matrixWorld),gd.setFromMatrixPosition(Yb),r.setXYZ(c+1,gd.x,gd.y,gd.z),c+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function iO(n){const e=[];n&&n.isBone&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,iO(n.children[t]));return e}class WY extends Uw{constructor(e=10,t=10,i=4473924,r=8947848){i=new Bi(i),r=new Bi(r);const o=t/2,c=e/t,s=e/2,f=[],p=[];for(let x=0,b=0,M=-s;x<=t;x++,M+=c){f.push(-s,0,M,s,0,M),f.push(M,0,-s,M,0,s);const P=x===o?i:r;P.toArray(p,b),b+=3,P.toArray(p,b),b+=3,P.toArray(p,b),b+=3,P.toArray(p,b),b+=3}const g=new $n;g.setAttribute("position",new ws(f,3)),g.setAttribute("color",new ws(p,3));const _=new Ah({vertexColors:!0,toneMapped:!1});super(g,_),this.type="GridHelper"}}const ZY=new Float32Array(1);new Int32Array(ZY.buffer);$l.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create($l.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n};bM.prototype.fromPoints=function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)};WY.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};HY.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Zd.prototype.extractUrlBase=function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),TY.extractUrlBase(n)};Zd.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};cl.prototype.center=function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)};cl.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};cl.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};cl.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};cl.prototype.size=function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)};t_.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Bw.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)};mo.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};mo.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};mo.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};mo.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)};mo.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};mo.prototype.getInverse=function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};Ri.prototype.extractPosition=function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)};Ri.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)};Ri.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Fe().setFromMatrixColumn(this,3)};Ri.prototype.setRotationFromQuaternion=function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)};Ri.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Ri.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};Ri.prototype.multiplyVector4=function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};Ri.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Ri.prototype.rotateAxis=function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)};Ri.prototype.crossVector=function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};Ri.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Ri.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Ri.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Ri.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Ri.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Ri.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)};Ri.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Ri.prototype.makeFrustum=function(n,e,t,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,i,t,r,o)};Ri.prototype.getInverse=function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()};ch.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)};go.prototype.multiplyVector3=function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)};go.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};xp.prototype.isIntersectionBox=function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)};xp.prototype.isIntersectionPlane=function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)};xp.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)};Zs.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Zs.prototype.barycoordFromPoint=function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)};Zs.prototype.midpoint=function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)};Zs.prototypenormal=function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)};Zs.prototype.plane=function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)};Zs.barycoordFromPoint=function(n,e,t,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Zs.getBarycoord(n,e,t,i,r)};Zs.normal=function(n,e,t,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Zs.getNormal(n,e,t,i)};r0.prototype.extractAllPoints=function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)};r0.prototype.extrude=function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new n_(this,n)};r0.prototype.makeGeometry=function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new H2(this,n)};li.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};li.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};li.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Fe.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};Fe.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};Fe.prototype.getPositionFromMatrix=function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)};Fe.prototype.getScaleFromMatrix=function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)};Fe.prototype.getColumnFromMatrix=function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)};Fe.prototype.applyProjection=function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)};Fe.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};Fe.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)};Fe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Zn.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)};Zn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Rn.prototype.getChildByName=function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)};Rn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Rn.prototype.translate=function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)};Rn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Rn.prototype.applyMatrix=function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties(Rn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});kr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(kr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),pq},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});BF.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};ea.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(n)};Object.defineProperties(gu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}});Object.defineProperties(Mn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===iw},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(iw)}}});Mn.prototype.setDynamic=function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?iw:Ty),this};Mn.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Mn.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};$n.prototype.addIndex=function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)};$n.prototype.addAttribute=function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new Mn(arguments[1],arguments[2]))):n==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e)};$n.prototype.addDrawCall=function(n,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)};$n.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};$n.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};$n.prototype.removeAttribute=function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)};$n.prototype.applyMatrix=function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)};Object.defineProperties($n.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});n0.prototype.setDynamic=function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(n===!0?iw:Ty),this};n0.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};n_.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};n_.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};n_.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};_h.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(Bo.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Bi}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===sF}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Jo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}});hr.prototype.clearTarget=function(n,e,t,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,i)};hr.prototype.animate=function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)};hr.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};hr.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};hr.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};hr.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};hr.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};hr.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};hr.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};hr.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};hr.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};hr.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};hr.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};hr.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};hr.prototype.enableScissorTest=function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)};hr.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};hr.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};hr.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};hr.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};hr.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};hr.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};hr.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};hr.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};hr.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};hr.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(hr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=n===!0?yp:Fo}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(DF.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(xc.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}});RY.prototype.load=function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new AY().load(n,function(i){e.setBuffer(i)}),this};z2.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)};z2.prototype.clear=function(n,e,t,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,i)};e_.crossOrigin=void 0;e_.loadTexture=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new _Y;r.setCrossOrigin(this.crossOrigin);const o=r.load(n,t,void 0,i);return e&&(o.mapping=e),o};e_.loadTextureCube=function(n,e,t,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new gY;r.setCrossOrigin(this.crossOrigin);const o=r.load(n,t,void 0,i);return e&&(o.mapping=e),o};e_.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};e_.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:nF}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=nF);const Vg=Math.PI/180,A3=180/Math.PI,nO=6378137,rO=635675231424518e-8;function ta(n,e,t,i,r,o){const c=J2(n,e,t);return XY(c[0],c[1],c[2],i,r,o)}function dp(n,e,t,i,r,o){const c=YY(n,e,t,i,r,o);return KY(c[0],c[1],c[2])}function XY(n,e,t,i,r,o){const c=J2(i,r,o),s=[n-c[0],e-c[1],t-c[2]];i=i*Vg,r=r*Vg;const f=Math.cos(i),p=Math.sin(i),g=Math.cos(r),_=Math.sin(r),x=-p*s[0]+f*s[1],b=-_*f*s[0]-_*p*s[1]+g*s[2],M=g*f*s[0]+g*p*s[1]+_*s[2];return[x,b,M]}function YY(n,e,t,i,r,o){const c=J2(i,r,o);i=i*Vg,r=r*Vg;const s=Math.cos(i),f=Math.sin(i),p=Math.cos(r),g=Math.sin(r),_=-f*n-g*s*e+p*s*t+c[0],x=s*n-g*f*e+p*f*t+c[1],b=p*e+g*t+c[2];return[_,x,b]}function J2(n,e,t){const i=nO,r=rO;n=n*Vg,e=e*Vg;const o=Math.cos(n),c=Math.sin(n),s=Math.cos(e),f=Math.sin(e),p=i*i,g=r*r,_=1/Math.sqrt(p*s*s+g*f*f),x=(p*_+t)*s,b=x*o,M=x*c,P=(g*_+t)*f;return[b,M,P]}function KY(n,e,t){const i=nO,r=rO,o=i*i,c=r*r,s=o-c,f=Math.sqrt(s/o),p=Math.sqrt(s/c),g=Math.sqrt(n*n+e*e),_=Math.atan2(t*i,g*r),x=Math.sin(_),b=Math.cos(_),M=Math.atan2(e,n),P=Math.atan2(t+p*p*r*x*x*x,g-f*f*i*b*b*b),k=Math.sin(P),L=Math.cos(P),I=i/Math.sqrt(1-f*f*k*k),F=g/L-I;return[M*A3,P*A3,F]}class Q2{boundingBoxCorners(e,t){const i=dp(-t,-t,0,e.lng,e.lat,0),r=dp(t,t,0,e.lng,e.lat,0);return[{lat:i[1],lng:i[0]},{lat:r[1],lng:r[0]}]}rotationFromCompass(e,t){let i=0,r=0,o=0;switch(t){case 1:i=Math.PI/2;break;case 3:i=-Math.PI/2,o=Math.PI;break;case 6:r=-Math.PI/2,o=-Math.PI/2;break;case 8:r=Math.PI/2,o=Math.PI/2;break}const c=new Ri().makeRotationZ(o),s=new wp(i,r,e*Math.PI/180,"XYZ"),f=new Ri().makeRotationFromEuler(s),p=new Zn().setAxisAngleFromRotationMatrix(f.multiply(c));return p.multiplyScalar(p.w).toArray().slice(0,3)}}class Kb{constructor(e){if(!e)throw new Error(`Incorrect core image data ${e}`);this._cache=null,this._core=e,this._spatial=null}get assetsCached(){return this._core!=null&&this._spatial!=null&&this._cache!=null&&this._cache.image!=null&&this._cache.mesh!=null}get cameraParameters(){return this._spatial.camera_parameters}get cameraType(){return this._spatial.camera_type}get capturedAt(){return this._spatial.captured_at}get clusterId(){return this._spatial.cluster?this._spatial.cluster.id:null}get clusterUrl(){return this._spatial.cluster?this._spatial.cluster.url:null}get compassAngle(){return this._spatial.computed_compass_angle!=null?this._spatial.computed_compass_angle:this._spatial.compass_angle}get complete(){return this._spatial!=null}get computedAltitude(){return this._spatial.computed_altitude}get computedCompassAngle(){return this._spatial.computed_compass_angle}get computedLngLat(){return this._core.computed_geometry}get creatorId(){return this._spatial.creator.id}get creatorUsername(){return this._spatial.creator.username}get exifOrientation(){return this._spatial.exif_orientation}get height(){return this._spatial.height}get image(){return this._cache.image}get image$(){return this._cache.image$}get id(){return this._core.id}get lngLat(){return this._core.computed_geometry!=null?this._core.computed_geometry:this._core.geometry}get merged(){return this._spatial!=null&&this._spatial.merge_id!=null}get mergeId(){return this._spatial.merge_id}get mesh(){return this._cache.mesh}get originalAltitude(){return this._spatial.altitude}get originalCompassAngle(){return this._spatial.compass_angle}get originalLngLat(){return this._core.geometry}get ownerId(){return this._spatial.owner?this._spatial.owner.id:null}get private(){return this._spatial.private}get qualityScore(){return this._spatial.quality_score}get rotation(){return this._spatial.computed_rotation}get scale(){return this._spatial.atomic_scale}get sequenceId(){return this._core.sequence?this._core.sequence.id:null}get sequenceEdges(){return this._cache.sequenceEdges}get sequenceEdges$(){return this._cache.sequenceEdges$}get spatialEdges(){return this._cache.spatialEdges}get spatialEdges$(){return this._cache.spatialEdges$}get width(){return this._spatial.width}cacheAssets$(){return this._cache.cacheAssets$(this._spatial,this.merged).pipe(We(()=>this))}cacheImage$(){return this._cache.cacheImage$(this._spatial).pipe(We(()=>this))}cacheSequenceEdges(e){this._cache.cacheSequenceEdges(e)}cacheSpatialEdges(e){this._cache.cacheSpatialEdges(e)}dispose(){this._cache!=null&&(this._cache.dispose(),this._cache=null),this._core=null,this._spatial=null}initializeCache(e){if(this._cache!=null)throw new Error(`Image cache already initialized (${this.id}).`);this._cache=e}makeComplete(e){if(e==null)throw new Error("Fill can not be null.");this._spatial=e}resetSequenceEdges(){this._cache.resetSequenceEdges()}resetSpatialEdges(){this._cache.resetSpatialEdges()}uncache(){this._cache!=null&&(this._cache.dispose(),this._cache=null)}}class JY{constructor(e){this._disposed=!1,this._provider=e,this._image=null,this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$=new ri,this._image$=this._imageChanged$.pipe(An(null),Pi(1),gi()),this._iamgeSubscription=this._image$.subscribe(),this._sequenceEdgesChanged$=new ri,this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(An(this._sequenceEdges),Pi(1),gi()),this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe(()=>{}),this._spatialEdgesChanged$=new ri,this._spatialEdges$=this._spatialEdgesChanged$.pipe(An(this._spatialEdges),Pi(1),gi()),this._spatialEdgesSubscription=this._spatialEdges$.subscribe(()=>{}),this._cachingAssets$=null}get image(){return this._image}get image$(){return this._image$}get mesh(){return this._mesh}get sequenceEdges(){return this._sequenceEdges}get sequenceEdges$(){return this._sequenceEdges$}get spatialEdges(){return this._spatialEdges}get spatialEdges$(){return this._spatialEdges$}cacheAssets$(e,t){return this._cachingAssets$!=null?this._cachingAssets$:(this._cachingAssets$=Si(this._cacheImage$(e),this._cacheMesh$(e,t)).pipe(We(([i,r])=>(this._image=i,this._mesh=r,this)),ma(()=>{this._cachingAssets$=null}),Pi(1),gi()),this._cachingAssets$.pipe(wi(i=>!!i._image)).subscribe(()=>{this._imageChanged$.next(this._image)},()=>{}),this._cachingAssets$)}cacheImage$(e){if(this._image!=null)return Ai(this);const t=this._cacheImage$(e).pipe(wi(i=>!!i),Dr(i=>{this._disposeImage(),this._image=i}),We(()=>this),Pi(1),gi());return t.subscribe(()=>{this._imageChanged$.next(this._image)},()=>{}),t}cacheSequenceEdges(e){this._sequenceEdges={cached:!0,edges:e},this._sequenceEdgesChanged$.next(this._sequenceEdges)}cacheSpatialEdges(e){this._spatialEdges={cached:!0,edges:e},this._spatialEdgesChanged$.next(this._spatialEdges)}dispose(){this._iamgeSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._disposeImage(),this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$.next(null),this._sequenceEdgesChanged$.next(this._sequenceEdges),this._spatialEdgesChanged$.next(this._spatialEdges),this._disposed=!0,this._imageAborter!=null&&(this._imageAborter(),this._imageAborter=null),this._meshAborter!=null&&(this._meshAborter(),this._meshAborter=null)}resetSequenceEdges(){this._sequenceEdges={cached:!1,edges:[]},this._sequenceEdgesChanged$.next(this._sequenceEdges)}resetSpatialEdges(){this._spatialEdges={cached:!1,edges:[]},this._spatialEdgesChanged$.next(this._spatialEdges)}_cacheImage$(e){return gr.create(t=>{const i=new Promise((o,c)=>{this._imageAborter=c}),r=e.thumb.url;if(!r){const o=e.thumb.id,c=`Incorrect thumb URL for ${e.id} (${o}, ${r})`;t.error(new Error(c));return}this._provider.getImageBuffer(r,i).then(o=>{this._imageAborter=null;const c=new Image;c.crossOrigin="Anonymous",c.onload=()=>{if(this._disposed){window.URL.revokeObjectURL(c.src);const f=`Image load was aborted (${r})`;t.error(new Error(f));return}t.next(c),t.complete()},c.onerror=()=>{this._imageAborter=null,t.error(new Error(`Failed to load image (${r})`))};const s=new Blob([o]);c.src=window.URL.createObjectURL(s)},o=>{this._imageAborter=null,t.error(o)})})}_cacheMesh$(e,t){return gr.create(i=>{if(!t){i.next(this._createEmptyMesh()),i.complete();return}const r=e.mesh.url;if(!r){const c=e.mesh.id,s=`Incorrect mesh URL for ${e.id} (${c}, ${r})`;console.warn(s),i.next(this._createEmptyMesh()),i.complete();return}const o=new Promise((c,s)=>{this._meshAborter=s});this._provider.getMesh(r,o).then(c=>{this._meshAborter=null,!this._disposed&&(i.next(c),i.complete())},c=>{this._meshAborter=null,console.error(c),i.next(this._createEmptyMesh()),i.complete()})})}_createEmptyMesh(){return{faces:[],vertices:[]}}_disposeImage(){this._image!=null&&window.URL.revokeObjectURL(this._image.src),this._image=null}}class QY{constructor(e){this._id=e.id,this._imageIds=e.image_ids}get id(){return this._id}get imageIds(){return this._imageIds}dispose(){this._id=null,this._imageIds=null}findNext(e){let t=this._imageIds.indexOf(e);return t+1>=this._imageIds.length||t===-1?null:this._imageIds[t+1]}findPrev(e){let t=this._imageIds.indexOf(e);return t===0||t===-1?null:this._imageIds[t-1]}}class eK{constructor(){this.sphericalPreferredDistance=2,this.sphericalMotion=2,this.sphericalSequencePenalty=1,this.sphericalMergeCCPenalty=4,this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCCPenalty=6,this.similarDistance=2,this.similarRotation=3,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCCPenalty=4}}var Ot;(function(n){n[n.Next=0]="Next",n[n.Prev=1]="Prev",n[n.StepLeft=2]="StepLeft",n[n.StepRight=3]="StepRight",n[n.StepForward=4]="StepForward",n[n.StepBackward=5]="StepBackward",n[n.TurnLeft=6]="TurnLeft",n[n.TurnRight=7]="TurnRight",n[n.TurnU=8]="TurnU",n[n.Spherical=9]="Spherical",n[n.Similar=10]="Similar"})(Ot||(Ot={}));class tK{constructor(){this.steps={},this.turns={},this.spherical={},this.steps[Ot.StepForward]={direction:Ot.StepForward,motionChange:0,useFallback:!0},this.steps[Ot.StepBackward]={direction:Ot.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[Ot.StepLeft]={direction:Ot.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[Ot.StepRight]={direction:Ot.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[Ot.TurnLeft]={direction:Ot.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[Ot.TurnRight]={direction:Ot.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[Ot.TurnU]={direction:Ot.TurnU,directionChange:Math.PI,motionChange:null},this.spherical[Ot.StepForward]={direction:Ot.StepForward,directionChange:0,next:Ot.StepLeft,prev:Ot.StepRight},this.spherical[Ot.StepBackward]={direction:Ot.StepBackward,directionChange:Math.PI,next:Ot.StepRight,prev:Ot.StepLeft},this.spherical[Ot.StepLeft]={direction:Ot.StepLeft,directionChange:Math.PI/2,next:Ot.StepBackward,prev:Ot.StepForward},this.spherical[Ot.StepRight]={direction:Ot.StepRight,directionChange:-Math.PI/2,next:Ot.StepForward,prev:Ot.StepBackward}}}class iK{constructor(){this.sphericalMinDistance=.1,this.sphericalMaxDistance=20,this.sphericalPreferredDistance=5,this.sphericalMaxItems=4,this.sphericalMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8,this.similarMaxDirectionChange=Math.PI/8,this.similarMaxDistance=12,this.similarMinTimeDifference=12*3600*1e3,this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6}get maxDistance(){return Math.max(this.sphericalMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)}}class cr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,cr.prototype),this.name="MapillaryError"}}class pa extends cr{constructor(e){super(e??"The argument is not valid."),Object.setPrototypeOf(this,pa.prototype),this.name="ArgumentMapillaryError"}}class vo{constructor(){this._epsilon=1e-9}azimuthalToBearing(e){return-e+Math.PI/2}degToRad(e){return Math.PI*e/180}radToDeg(e){return 180*e/Math.PI}rotationMatrix(e){let t=new Fe(e[0],e[1],e[2]),i=t.length();return i>0&&t.normalize(),new Ri().makeRotationAxis(t,i)}rotate(e,t){let i=new Fe(e[0],e[1],e[2]),r=this.rotationMatrix(t);return i.applyMatrix4(r),i}opticalCenter(e,t){let i=[-e[0],-e[1],-e[2]],r=[-t[0],-t[1],-t[2]];return this.rotate(r,i)}viewingDirection(e){let t=[-e[0],-e[1],-e[2]];return this.rotate([0,0,1],t)}wrap(e,t,i){if(i<t)throw new Error("Invalid arguments: max must be larger than min.");let r=i-t;for(;e>i||e<t;)e>i?e=e-r:e<t&&(e=e+r);return e}wrapAngle(e){return this.wrap(e,-Math.PI,Math.PI)}clamp(e,t,i){return e<t?t:e>i?i:e}angleBetweenVector2(e,t,i,r){let o=Math.atan2(r,i)-Math.atan2(t,e);return this.wrapAngle(o)}angleDifference(e,t){let i=t-e;return this.wrapAngle(i)}relativeRotationAngle(e,t){let i=this.rotationMatrix([-e[0],-e[1],-e[2]]),r=this.rotationMatrix(t),c=i.multiply(r).elements,s=c[0]+c[5]+c[10];return Math.acos(Math.max(Math.min((s-1)/2,1),-1))}angleToPlane(e,t){let i=new Fe().fromArray(e),r=i.length();if(r<this._epsilon)return 0;let o=i.dot(new Fe().fromArray(t));return Math.asin(o/r)}azimuthal(e,t){const i=new Fe().fromArray(e),r=new Fe().fromArray(t),o=i.clone().dot(r),c=i.clone().sub(r.clone().multiplyScalar(o));return Math.atan2(c.y,c.x)}distanceFromLngLat(e,t,i,r){let o=6371e3,c=this.degToRad(r-t),s=this.degToRad(i-e),f=Math.sin(c/2)*Math.sin(c/2)+Math.cos(this.degToRad(t))*Math.cos(this.degToRad(r))*Math.sin(s/2)*Math.sin(s/2);return 2*o*Math.atan2(Math.sqrt(f),Math.sqrt(1-f))}}const nK=new vo;function ki(n){return n==="spherical"}function ow(n){return n==="fisheye"}function aw(n,e,t){const i=ta(n.lng,n.lat,n.alt,t.lng,t.lat,t.alt),r=nK.rotate(i,e);return[-r.x,-r.y,-r.z]}function eC(n,e,t,i,r){const o=[];for(let f=0;f<e.length;++f){const p=e[f],g=t[f];for(let _=0;_<=i;++_)o.push([p[0]+g[0]*_/i,p[1]+g[1]*_/i])}const c=new i0;return c.up.copy(n.upVector()),c.position.copy(new Fe().fromArray(n.unprojectSfM([0,0],0))),c.lookAt(new Fe().fromArray(n.unprojectSfM([0,0],10))),c.updateMatrix(),c.updateMatrixWorld(!0),o.map(f=>{const p=n.unprojectBasic(f,1e4),g=r.worldToCamera(p,c);return[Math.abs(g[0]/g[2]),Math.abs(g[1]/g[2])]})}class rK{constructor(e,t,i){this._spatial=new vo,this._settings=e??new iK,this._directions=t??new tK,this._coefficients=i??new eK}getPotentialEdges(e,t,i){if(!e.complete)throw new pa("Image has to be full.");if(!e.merged)return[];let r=this._spatial.viewingDirection(e.rotation),o=this._spatial.angleToPlane(r.toArray(),[0,0,1]),c=[];for(let s of t){if(!s.merged||s.id===e.id)continue;let f=ta(s.lngLat.lng,s.lngLat.lat,s.computedAltitude,e.lngLat.lng,e.lngLat.lat,e.computedAltitude),p=new Fe(f[0],f[1],f[2]),g=p.length();if(g>this._settings.maxDistance&&i.indexOf(s.id)<0)continue;let _=this._spatial.angleBetweenVector2(r.x,r.y,p.x,p.y),x=this._spatial.angleToPlane(p.toArray(),[0,0,1]),b=this._spatial.viewingDirection(s.rotation),M=this._spatial.angleBetweenVector2(r.x,r.y,b.x,b.y),k=this._spatial.angleToPlane(b.toArray(),[0,0,1])-o,L=this._spatial.relativeRotationAngle(e.rotation,s.rotation),I=this._spatial.angleBetweenVector2(1,0,p.x,p.y),F=s.sequenceId!=null&&e.sequenceId!=null&&s.sequenceId===e.sequenceId,N=s.mergeId===e.mergeId,H=s.creatorId===e.creatorId,Y={capturedAt:s.capturedAt,directionChange:M,distance:g,spherical:ki(s.cameraType),id:s.id,motionChange:_,rotation:L,sameMergeCC:N,sameSequence:F,sameUser:H,sequenceId:s.sequenceId,verticalDirectionChange:k,verticalMotion:x,worldMotionAzimuth:I};c.push(Y)}return c}computeSequenceEdges(e,t){if(!e.complete)throw new pa("Image has to be full.");if(e.sequenceId!==t.id)throw new pa("Image and sequence does not correspond.");let i=[],r=t.findNext(e.id);r!=null&&i.push({data:{direction:Ot.Next,worldMotionAzimuth:Number.NaN},source:e.id,target:r});let o=t.findPrev(e.id);return o!=null&&i.push({data:{direction:Ot.Prev,worldMotionAzimuth:Number.NaN},source:e.id,target:o}),i}computeSimilarEdges(e,t){if(!e.complete)throw new pa("Image has to be full.");let i=ki(e.cameraType),r={};for(let s of t)if(s.sequenceId!=null&&!s.sameSequence){if(i){if(!s.spherical)continue}else if(!s.spherical&&Math.abs(s.directionChange)>this._settings.similarMaxDirectionChange)continue;s.distance>this._settings.similarMaxDistance||s.sameUser&&Math.abs(s.capturedAt-e.capturedAt)<this._settings.similarMinTimeDifference||(r[s.sequenceId]==null&&(r[s.sequenceId]=[]),r[s.sequenceId].push(s))}let o=[],c=ki(e.cameraType)?s=>s.distance:s=>this._coefficients.similarDistance*s.distance+this._coefficients.similarRotation*s.rotation;for(let s in r){if(!r.hasOwnProperty(s))continue;let f=Number.MAX_VALUE,p=null;for(let g of r[s]){let _=c(g);_<f&&(f=_,p=g)}p!=null&&o.push(p)}return o.map(s=>({data:{direction:Ot.Similar,worldMotionAzimuth:s.worldMotionAzimuth},source:e.id,target:s.id}))}computeStepEdges(e,t,i,r){if(!e.complete)throw new pa("Image has to be full.");let o=[];if(ki(e.cameraType))return o;for(let c in this._directions.steps){if(!this._directions.steps.hasOwnProperty(c))continue;let s=this._directions.steps[c],f=Number.MAX_VALUE,p=null,g=null;for(let _ of t){if(_.spherical||Math.abs(_.directionChange)>this._settings.stepMaxDirectionChange)continue;let x=this._spatial.angleDifference(s.motionChange,_.motionChange),b=this._spatial.angleDifference(_.directionChange,x),M=Math.max(Math.abs(x),Math.abs(b));if(Math.abs(M)>this._settings.stepMaxDrift)continue;let P=_.id;if(s.useFallback&&(P===i||P===r)&&(g=_),_.distance>this._settings.stepMaxDistance)continue;x=Math.sqrt(x*x+_.verticalMotion*_.verticalMotion);let k=this._coefficients.stepPreferredDistance*Math.abs(_.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*x/this._settings.stepMaxDrift+this._coefficients.stepRotation*_.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(_.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(_.sameMergeCC?0:1);k<f&&(f=k,p=_)}p=p??g,p!=null&&o.push({data:{direction:s.direction,worldMotionAzimuth:p.worldMotionAzimuth},source:e.id,target:p.id})}return o}computeTurnEdges(e,t){if(!e.complete)throw new pa("Image has to be full.");let i=[];if(ki(e.cameraType))return i;for(let r in this._directions.turns){if(!this._directions.turns.hasOwnProperty(r))continue;let o=this._directions.turns[r],c=Number.MAX_VALUE,s=null;for(let f of t){if(f.spherical||f.distance>this._settings.turnMaxDistance)continue;let p=o.direction!==Ot.TurnU&&f.distance<this._settings.turnMaxRigDistance&&Math.abs(f.directionChange)>this._settings.turnMinRigDirectionChange,g=this._spatial.angleDifference(o.directionChange,f.directionChange),_;if(p&&f.directionChange*o.directionChange>0&&Math.abs(f.directionChange)<Math.abs(o.directionChange))_=-Math.PI/2+Math.abs(f.directionChange);else{if(Math.abs(g)>this._settings.turnMaxDirectionChange)continue;let x=o.motionChange?this._spatial.angleDifference(o.motionChange,f.motionChange):0;x=Math.sqrt(x*x+f.verticalMotion*f.verticalMotion),_=this._coefficients.turnDistance*f.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*x/Math.PI+this._coefficients.turnSequencePenalty*(f.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(f.sameMergeCC?0:1)}_<c&&(c=_,s=f)}s!=null&&i.push({data:{direction:o.direction,worldMotionAzimuth:s.worldMotionAzimuth},source:e.id,target:s.id})}return i}computePerspectiveToSphericalEdges(e,t){if(!e.complete)throw new pa("Image has to be full.");if(ki(e.cameraType))return[];let i=Number.MAX_VALUE,r=null;for(let o of t){if(!o.spherical)continue;let c=this._coefficients.sphericalPreferredDistance*Math.abs(o.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(o.motionChange)/Math.PI+this._coefficients.sphericalMergeCCPenalty*(o.sameMergeCC?0:1);c<i&&(i=c,r=o)}return r==null?[]:[{data:{direction:Ot.Spherical,worldMotionAzimuth:r.worldMotionAzimuth},source:e.id,target:r.id}]}computeSphericalEdges(e,t){if(!e.complete)throw new pa("Image has to be full.");if(!ki(e.cameraType))return[];let i=[],r=[],o=[];for(let g of t)if(!(g.distance>this._settings.sphericalMaxDistance))if(g.spherical){if(g.distance<this._settings.sphericalMinDistance)continue;r.push(g)}else for(let _ in this._directions.spherical){if(!this._directions.spherical.hasOwnProperty(_))continue;let x=this._directions.spherical[_],b=this._spatial.angleDifference(g.directionChange,g.motionChange),M=this._spatial.angleDifference(x.directionChange,b);if(!(Math.abs(M)>this._settings.sphericalMaxStepTurnChange)){o.push([x.direction,g]);break}}let c=Math.PI/this._settings.sphericalMaxItems,s=[],f=[];for(let g=0;g<this._settings.sphericalMaxItems;g++){let _=g/this._settings.sphericalMaxItems*2*Math.PI,x=Number.MAX_VALUE,b=null;for(let M of r){let P=this._spatial.angleDifference(_,M.motionChange);if(Math.abs(P)>c)continue;let k=Number.MAX_VALUE;for(let I of s){let F=Math.abs(this._spatial.angleDifference(I,M.motionChange));F<k&&(k=F)}if(k<=c)continue;let L=this._coefficients.sphericalPreferredDistance*Math.abs(M.distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(P)/c+this._coefficients.sphericalSequencePenalty*(M.sameSequence?0:1)+this._coefficients.sphericalMergeCCPenalty*(M.sameMergeCC?0:1);L<x&&(x=L,b=M)}b!=null?(s.push(b.motionChange),i.push({data:{direction:Ot.Spherical,worldMotionAzimuth:b.worldMotionAzimuth},source:e.id,target:b.id})):f.push(_)}let p={};p[Ot.Spherical]=s,p[Ot.StepForward]=[],p[Ot.StepLeft]=[],p[Ot.StepBackward]=[],p[Ot.StepRight]=[];for(let g of f){let _=[];for(let x in this._directions.spherical){if(!this._directions.spherical.hasOwnProperty(x))continue;let b=this._directions.spherical[x],M=p[Ot.Spherical].concat(p[b.direction]).concat(p[b.prev]).concat(p[b.next]),P=Number.MAX_VALUE,k=null;for(let L of o){if(L[0]!==b.direction)continue;let I=this._spatial.angleDifference(g,L[1].motionChange);if(Math.abs(I)>c)continue;let F=Number.MAX_VALUE;for(let H of M){let Y=Math.abs(this._spatial.angleDifference(H,L[1].motionChange));Y<F&&(F=Y)}if(F<=c)continue;let N=this._coefficients.sphericalPreferredDistance*Math.abs(L[1].distance-this._settings.sphericalPreferredDistance)/this._settings.sphericalMaxDistance+this._coefficients.sphericalMotion*Math.abs(I)/c+this._coefficients.sphericalMergeCCPenalty*(L[1].sameMergeCC?0:1);N<P&&(P=N,k=L)}k!=null&&(_.push(k),i.push({data:{direction:k[0],worldMotionAzimuth:k[1].worldMotionAzimuth},source:e.id,target:k[1].id}))}for(let x of _)p[x[0]].push(x[1].motionChange)}return i}}class ar extends cr{constructor(e){super(e),Object.setPrototypeOf(this,ar.prototype),this.name="GraphMapillaryError"}}class Iy{constructor(e,t,i,r,o,c){this._api=e,this._cachedNodes={},this._cachedNodeTiles={},this._cachedSequenceNodes={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequenceNodes$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._changed$=new ri,this._filterCreator=o??new UG,this._filter=this._filterCreator.createFilter(void 0),this._filterSubject$=new ri,this._filter$=Nl(Ai(this._filter),this._filterSubject$).pipe(Pi(1),gi()),this._filterSubscription=this._filter$.subscribe(()=>{}),this._defaultAlt=2,this._edgeCalculator=r??new rK,this._graphCalculator=i??new Q2,this._configuration=c??{maxSequences:50,maxUnusedImages:100,maxUnusedPreStoredImages:30,maxUnusedTiles:20},this._nodes={},this._nodeIndex=t??new Iy._spatialIndex(16),this._nodeIndexTiles={},this._nodeToTile={},this._preStored={},this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._tileThreshold=20}static register(e){Iy._spatialIndex=e}get api(){return this._api}get changed$(){return this._changed$}get filter$(){return this._filter$}cacheBoundingBox$(e,t){const i=this._api.data.geometry.bboxToCellIds(e,t).filter(r=>!(r in this._cachedTiles)).map(r=>r in this._cachingTiles$?this._cachingTiles$[r]:this._cacheTile$(r));return i.length===0&&i.push(Ai(this)),Fr(i).pipe(tp(),Og(),Wi(()=>{const r=this._nodeIndex.search({maxX:t.lng,maxY:t.lat,minX:e.lng,minY:e.lat}).map(_=>_.node),o=[],c=[];for(const _ of r)_.complete?o.push(_):c.push(_.id);const s=[],f=200;for(;c.length>0;)s.push(c.splice(0,f));const p=Ai(o),g=s.map(_=>this._api.getSpatialImages$(_).pipe(We(x=>{const b=[];for(const M of x){if(!this.hasNode(M.node_id))continue;const k=this.getNode(M.node_id);k.complete||this._makeFull(k,M.node),b.push(k)}return b})));return fn(p,Fr(g).pipe(tp()))}),iI((r,o)=>r.concat(o)))}cacheCell$(e){return(e in this._cachedTiles?Ai(this):e in this._cachingTiles$?this._cachingTiles$[e]:this._cacheTile$(e)).pipe(Wi(()=>{const i=this._cachedTiles[e];i.accessed=new Date().getTime();const r=i.nodes,o=[],c=[];for(const _ of r)_.complete?o.push(_):c.push(_.id);const s=[],f=200;for(;c.length>0;)s.push(c.splice(0,f));const p=Ai(o),g=s.map(_=>this._api.getSpatialImages$(_).pipe(We(x=>{const b=[];for(const M of x){if(!M.node){console.warn(`Image is empty (${M.node})`);continue}const P=M.node_id;if(!this.hasNode(P))continue;const k=this.getNode(P);k.complete||this._makeFull(k,M.node),b.push(k)}return b})));return fn(p,Fr(g).pipe(tp()))}),iI((i,r)=>i.concat(r)))}cacheFill$(e){if(e in this._cachingFull$)throw new ar(`Cannot fill node while caching full (${e}).`);if(!this.hasNode(e))throw new ar(`Cannot fill node that does not exist in graph (${e}).`);if(e in this._cachingFill$)return this._cachingFill$[e];const t=this.getNode(e);if(t.complete)throw new ar(`Cannot fill node that is already full (${e}).`);return this._cachingFill$[e]=this._api.getSpatialImages$([e]).pipe(Dr(i=>{for(const r of i)r.node||console.warn(`Image is empty ${r.node_id}`),t.complete||this._makeFull(t,r.node),delete this._cachingFill$[r.node_id]}),We(()=>this),ma(()=>{e in this._cachingFill$&&delete this._cachingFill$[e],this._changed$.next(this)}),Ya(),gi()),this._cachingFill$[e]}cacheFull$(e){if(e in this._cachingFull$)return this._cachingFull$[e];if(this.hasNode(e))throw new ar(`Cannot cache full node that already exist in graph (${e}).`);return this._cachingFull$[e]=this._api.getImages$([e]).pipe(Dr(t=>{for(const i of t){if(!i.node)throw new ar(`Image does not exist (${e}, ${i.node}).`);const r=i.node_id;if(this.hasNode(r)){const o=this.getNode(e);o.complete||this._makeFull(o,i.node)}else{if(i.node.sequence.id==null)throw new ar(`Image has no sequence key (${e}).`);const o=new Kb(i.node);this._makeFull(o,i.node);const c=this._api.data.geometry.lngLatToCellId(o.originalLngLat);this._preStore(c,o),this._setNode(o),delete this._cachingFull$[r]}}}),We(()=>this),ma(()=>{e in this._cachingFull$&&delete this._cachingFull$[e],this._changed$.next(this)}),Ya(),gi()),this._cachingFull$[e]}cacheNodeSequence$(e){if(!this.hasNode(e))throw new ar(`Cannot cache sequence edges of node that does not exist in graph (${e}).`);let t=this.getNode(e);if(t.sequenceId in this._sequences)throw new ar(`Sequence already cached (${e}), (${t.sequenceId}).`);return this._cacheSequence$(t.sequenceId)}cacheSequence$(e){if(e in this._sequences)throw new ar(`Sequence already cached (${e})`);return this._cacheSequence$(e)}cacheSequenceEdges(e){let t=this.getNode(e);if(!(t.sequenceId in this._sequences))throw new ar(`Sequence is not cached (${e}), (${t.sequenceId})`);let i=this._sequences[t.sequenceId].sequence,r=this._edgeCalculator.computeSequenceEdges(t,i);t.cacheSequenceEdges(r)}cacheSequenceNodes$(e,t){if(!this.hasSequence(e))throw new ar(`Cannot cache sequence nodes of sequence that does not exist in graph (${e}).`);if(this.hasSequenceNodes(e))throw new ar(`Sequence nodes already cached (${e}).`);const i=this.getSequence(e);if(i.id in this._cachingSequenceNodes$)return this._cachingSequenceNodes$[i.id];const r=[],o=i.imageIds.slice(),c=50;if(t&&o.length>c){const g=o.indexOf(t),_=Math.max(0,Math.min(g-c/2,o.length-c));r.push(o.splice(_,c))}const s=200;for(;o.length>0;)r.push(o.splice(0,s));let f=r.length;const p=Fr(r).pipe(Wi(g=>this._api.getImages$(g).pipe(Dr(_=>{for(const x of _){if(!x.node){console.warn(`Image empty (${x.node_id})`);continue}const b=x.node_id;if(this.hasNode(b)){const M=this.getNode(b);M.complete||this._makeFull(M,x.node)}else{x.node.sequence.id==null&&console.warn(`Sequence missing, discarding node (${x.node_id})`);const M=new Kb(x.node);this._makeFull(M,x.node);const P=this._api.data.geometry.lngLatToCellId(M.originalLngLat);this._preStore(P,M),this._setNode(M)}}f--}),We(()=>this)),6),Og(),ma(()=>{delete this._cachingSequenceNodes$[i.id],f===0&&(this._cachedSequenceNodes[i.id]=!0)}),Ya(),gi());return this._cachingSequenceNodes$[i.id]=p,p}cacheSpatialArea$(e){if(!this.hasNode(e))throw new ar(`Cannot cache spatial area of node that does not exist in graph (${e}).`);if(e in this._cachedSpatialEdges)throw new ar(`Image already spatially cached (${e}).`);if(!(e in this._requiredSpatialArea))throw new ar(`Spatial area not determined (${e}).`);let t=this._requiredSpatialArea[e];if(Object.keys(t.cacheNodes).length===0)throw new ar(`Spatial nodes already cached (${e}).`);if(e in this._cachingSpatialArea$)return this._cachingSpatialArea$[e];let i=[];for(;t.cacheKeys.length>0;)i.push(t.cacheKeys.splice(0,200));let r=i.length,o=[];for(let c of i){let s=this._api.getSpatialImages$(c).pipe(Dr(f=>{for(const p of f){if(!p.node){console.warn(`Image is empty (${p.node_id})`);continue}const g=p.node_id,_=t.cacheNodes[g];if(_.complete){delete t.cacheNodes[g];continue}this._makeFull(_,p.node),delete t.cacheNodes[g]}--r===0&&delete this._cachingSpatialArea$[e]}),We(()=>this),Nn(f=>{for(let p of c)p in t.all&&delete t.all[p],p in t.cacheNodes&&delete t.cacheNodes[p];throw--r===0&&delete this._cachingSpatialArea$[e],f}),ma(()=>{Object.keys(t.cacheNodes).length===0&&this._changed$.next(this)}),Ya(),gi());o.push(s)}return this._cachingSpatialArea$[e]=o,o}cacheSpatialEdges(e){if(e in this._cachedSpatialEdges)throw new ar(`Spatial edges already cached (${e}).`);let t=this.getNode(e),i=this._sequences[t.sequenceId].sequence,r=[],o=i.findPrev(t.id);o!=null&&r.push(o);let c=i.findNext(t.id);c!=null&&r.push(c);let s=this._requiredSpatialArea[e].all,f=[],p=this._filter;for(let x in s){if(!s.hasOwnProperty(x))continue;let b=s[x];p(b)&&f.push(b)}let g=this._edgeCalculator.getPotentialEdges(t,f,r),_=this._edgeCalculator.computeStepEdges(t,g,o,c);_=_.concat(this._edgeCalculator.computeTurnEdges(t,g)),_=_.concat(this._edgeCalculator.computeSphericalEdges(t,g)),_=_.concat(this._edgeCalculator.computePerspectiveToSphericalEdges(t,g)),_=_.concat(this._edgeCalculator.computeSimilarEdges(t,g)),t.cacheSpatialEdges(_),this._cachedSpatialEdges[e]=t,delete this._requiredSpatialArea[e],delete this._cachedNodeTiles[e]}cacheTiles$(e){if(e in this._cachedNodeTiles)throw new ar(`Tiles already cached (${e}).`);if(e in this._cachedSpatialEdges)throw new ar(`Spatial edges already cached so tiles considered cached (${e}).`);if(!(e in this._requiredNodeTiles))throw new ar(`Tiles have not been determined (${e}).`);let t=this._requiredNodeTiles[e];if(t.cache.length===0&&t.caching.length===0)throw new ar(`Tiles already cached (${e}).`);if(!this.hasNode(e))throw new ar(`Cannot cache tiles of node that does not exist in graph (${e}).`);let i=t.cache.slice();t.caching=this._requiredNodeTiles[e].caching.concat(i),t.cache=[];let r=[];for(let o of t.caching){const c=o in this._cachingTiles$?this._cachingTiles$[o]:this._cacheTile$(o);r.push(c.pipe(Dr(s=>{let f=t.caching.indexOf(o);f>-1&&t.caching.splice(f,1),t.caching.length===0&&t.cache.length===0&&(delete this._requiredNodeTiles[e],this._cachedNodeTiles[e]=!0)}),Nn(s=>{let f=t.caching.indexOf(o);throw f>-1&&t.caching.splice(f,1),t.caching.length===0&&t.cache.length===0&&(delete this._requiredNodeTiles[e],this._cachedNodeTiles[e]=!0),s}),ma(()=>{this._changed$.next(this)}),Ya(),gi()))}return r}initializeCache(e){if(e in this._cachedNodes)throw new ar(`Image already in cache (${e}).`);const t=this.getNode(e),i=this._api.data;t.initializeCache(new JY(i));const r=new Date().getTime();this._cachedNodes[e]={accessed:r,node:t},this._updateCachedTileAccess(e,r)}isCachingFill(e){return e in this._cachingFill$}isCachingFull(e){return e in this._cachingFull$}isCachingNodeSequence(e){return this.getNode(e).sequenceId in this._cachingSequences$}isCachingSequence(e){return e in this._cachingSequences$}isCachingSequenceNodes(e){return e in this._cachingSequenceNodes$}isCachingTiles(e){return e in this._requiredNodeTiles&&this._requiredNodeTiles[e].cache.length===0&&this._requiredNodeTiles[e].caching.length>0}hasInitializedCache(e){return e in this._cachedNodes}hasNode(e){let t=new Date().getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),e in this._nodes}hasNodeSequence(e){let i=this.getNode(e).sequenceId,r=i in this._sequences;return r&&(this._sequences[i].accessed=new Date().getTime()),r}hasSequence(e){let t=e in this._sequences;return t&&(this._sequences[e].accessed=new Date().getTime()),t}hasSequenceNodes(e){return e in this._cachedSequenceNodes}hasSpatialArea(e){if(!this.hasNode(e))throw new ar(`Spatial area nodes cannot be determined if node not in graph (${e}).`);if(e in this._cachedSpatialEdges)return!0;if(e in this._requiredSpatialArea)return Object.keys(this._requiredSpatialArea[e].cacheNodes).length===0;let t=this.getNode(e),i=this._graphCalculator.boundingBoxCorners(t.lngLat,this._tileThreshold),r=this._nodeIndex.search({maxX:i[1].lng,maxY:i[1].lat,minX:i[0].lng,minY:i[0].lat}),o={all:{},cacheKeys:[],cacheNodes:{}};for(let c of r)o.all[c.node.id]=c.node,c.node.complete||(o.cacheKeys.push(c.node.id),o.cacheNodes[c.node.id]=c.node);return this._requiredSpatialArea[e]=o,o.cacheKeys.length===0}hasTiles(e){if(e in this._cachedNodeTiles||e in this._cachedSpatialEdges)return!0;if(!this.hasNode(e))throw new ar(`Image does not exist in graph (${e}).`);let t={cache:[],caching:[]};if(e in this._requiredNodeTiles)t=this._requiredNodeTiles[e];else{const i=this.getNode(e),[r,o]=this._graphCalculator.boundingBoxCorners(i.lngLat,this._tileThreshold);t.cache=this._api.data.geometry.bboxToCellIds(r,o).filter(c=>!(c in this._cachedTiles)),t.cache.length>0&&(this._requiredNodeTiles[e]=t)}return t.cache.length===0&&t.caching.length===0}getNode(e){let t=new Date().getTime();return this._updateCachedNodeAccess(e,t),this._updateCachedTileAccess(e,t),this._nodes[e]}getSequence(e){let t=this._sequences[e];return t.accessed=new Date().getTime(),t.sequence}resetSpatialEdges(){let e=Object.keys(this._cachedSpatialEdges);for(let t of e)this._cachedSpatialEdges[t].resetSpatialEdges(),delete this._cachedSpatialEdges[t]}reset(e){const t=[];for(const i of e){if(!this.hasNode(i))throw new Error(`Image does not exist ${i}`);const r=this.getNode(i);r.resetSequenceEdges(),r.resetSpatialEdges(),t.push(r)}for(let i of Object.keys(this._cachedNodes))e.indexOf(i)===-1&&(this._cachedNodes[i].node.dispose(),delete this._cachedNodes[i]);this._cachedNodeTiles={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._nodes={},this._nodeToTile={},this._preStored={};for(const i of t){this._nodes[i.id]=i;const r=this._api.data.geometry.lngLatToCellId(i.originalLngLat);this._preStore(r,i)}this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._nodeIndexTiles={},this._nodeIndex.clear()}setFilter(e){this._filter=this._filterCreator.createFilter(e),this._filterSubject$.next(this._filter)}uncache(e,t,i){const r={};this._addNewKeys(r,this._cachingFull$),this._addNewKeys(r,this._cachingFill$),this._addNewKeys(r,this._cachingSpatialArea$),this._addNewKeys(r,this._requiredNodeTiles),this._addNewKeys(r,this._requiredSpatialArea);for(const I of e)I in r||(r[I]=!0);const o=this._tileThreshold,c=this._graphCalculator,s=this._api.data.geometry,f=new Set(t);for(let I in r){if(!r.hasOwnProperty(I))continue;const F=this._nodes[I],[N,H]=c.boundingBoxCorners(F.lngLat,o),Y=s.bboxToCellIds(N,H);for(const q of Y)f.has(q)||f.add(q)}const p=[];for(let I in this._cachedTiles)!this._cachedTiles.hasOwnProperty(I)||f.has(I)||p.push([I,this._cachedTiles[I]]);const g=p.sort((I,F)=>F[1].accessed-I[1].accessed).slice(this._configuration.maxUnusedTiles).map(I=>I[0]);for(let I of g)this._uncacheTile(I,i);const _=[],x=[];for(let I in this._preStored){if(!this._preStored.hasOwnProperty(I)||I in this._cachingTiles$)continue;const F=this._preStored[I];for(let N in F)!F.hasOwnProperty(N)||N in r||F[N].sequenceId!==i&&(N in this._cachedNodes?_.push([this._cachedNodes[N],I]):x.push([N,I]))}const b=_.sort(([I],[F])=>F.accessed-I.accessed).slice(this._configuration.maxUnusedPreStoredImages).map(([I,F])=>[I.node.id,F]);this._uncachePreStored(x),this._uncachePreStored(b);const M=[];for(let I in this._cachedNodes)!this._cachedNodes.hasOwnProperty(I)||I in r||M.push(this._cachedNodes[I]);const P=M.sort((I,F)=>F.accessed-I.accessed).slice(this._configuration.maxUnusedImages);for(const I of P){I.node.uncache();const F=I.node.id;delete this._cachedNodes[F],F in this._cachedNodeTiles&&delete this._cachedNodeTiles[F],F in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[F]}const k=[];for(let I in this._sequences)!this._sequences.hasOwnProperty(I)||I in this._cachingSequences$||I===i||k.push(this._sequences[I]);const L=k.sort((I,F)=>F.accessed-I.accessed).slice(this._configuration.maxSequences);for(const I of L){const F=I.sequence.id;delete this._sequences[F],F in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[F],I.sequence.dispose()}}updateCells$(e){const t=this._cachedTiles,i=this._cachingTiles$;return Fr(e).pipe(Wi(r=>r in t?this._updateCell$(r):r in i?i[r].pipe(Nn(()=>Ai(this)),Wi(()=>this._updateCell$(r))):zi()))}unsubscribe(){this._filterSubscription.unsubscribe()}_addNewKeys(e,t){for(let i in t)!t.hasOwnProperty(i)||!this.hasNode(i)||i in e||(e[i]=!0)}_cacheSequence$(e){return e in this._cachingSequences$?this._cachingSequences$[e]:(this._cachingSequences$[e]=this._api.getSequence$(e).pipe(Dr(t=>{t?(t.id in this._sequences||(this._sequences[t.id]={accessed:new Date().getTime(),sequence:new QY(t)}),delete this._cachingSequences$[e]):console.warn(`Sequence does not exist (${e})`)}),We(()=>this),ma(()=>{e in this._cachingSequences$&&delete this._cachingSequences$[e],this._changed$.next(this)}),Ya(),gi()),this._cachingSequences$[e])}_cacheTile$(e){return this._cachingTiles$[e]=this._api.getCoreImages$(e).pipe(Dr(t=>{if(e in this._cachedTiles)return;const i=t.images;this._nodeIndexTiles[e]=[],this._cachedTiles[e]={accessed:new Date().getTime(),nodes:[]};const r=this._cachedTiles[e].nodes,o=this._removeFromPreStore(e);for(const c of i){if(!c)break;if(c.sequence.id==null){console.warn(`Sequence missing, discarding node (${c.id})`);continue}if(o!=null&&c.id in o){const p=o[c.id];delete o[c.id],r.push(p);const g={lat:p.lngLat.lat,lng:p.lngLat.lng,node:p};this._nodeIndex.insert(g),this._nodeIndexTiles[e].push(g),this._nodeToTile[p.id]=e;continue}const s=new Kb(c);r.push(s);const f={lat:s.lngLat.lat,lng:s.lngLat.lng,node:s};this._nodeIndex.insert(f),this._nodeIndexTiles[e].push(f),this._nodeToTile[s.id]=e,this._setNode(s)}delete this._cachingTiles$[e]}),We(()=>this),Nn(t=>{throw delete this._cachingTiles$[e],t}),Ya(),gi()),this._cachingTiles$[e]}_makeFull(e,t){t.computed_altitude==null&&(t.computed_altitude=this._defaultAlt),t.computed_rotation==null&&(t.computed_rotation=this._graphCalculator.rotationFromCompass(t.compass_angle,t.exif_orientation)),e.makeComplete(t)}_preStore(e,t){e in this._preStored||(this._preStored[e]={}),this._preStored[e][t.id]=t}_removeFromPreStore(e){let t=null;return e in this._preStored&&(t=this._preStored[e],delete this._preStored[e]),t}_setNode(e){let t=e.id;if(this.hasNode(t))throw new ar(`Image already exist (${t}).`);this._nodes[t]=e}_uncacheTile(e,t){for(let i of this._cachedTiles[e].nodes){let r=i.id;delete this._nodeToTile[r],r in this._cachedNodes&&delete this._cachedNodes[r],r in this._cachedNodeTiles&&delete this._cachedNodeTiles[r],r in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[r],i.sequenceId===t?(this._preStore(e,i),i.uncache()):(delete this._nodes[r],i.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[i.sequenceId],i.dispose())}for(let i of this._nodeIndexTiles[e])this._nodeIndex.remove(i);delete this._nodeIndexTiles[e],delete this._cachedTiles[e]}_uncachePreStored(e){let t={};for(let[i,r]of e){i in this._nodes&&delete this._nodes[i],i in this._cachedNodes&&delete this._cachedNodes[i];let o=this._preStored[r][i];o.sequenceId in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[o.sequenceId],delete this._preStored[r][i],o.dispose(),t[r]=!0}for(let i in t)t.hasOwnProperty(i)&&Object.keys(this._preStored[i]).length===0&&delete this._preStored[i]}_updateCachedTileAccess(e,t){e in this._nodeToTile&&(this._cachedTiles[this._nodeToTile[e]].accessed=t)}_updateCachedNodeAccess(e,t){e in this._cachedNodes&&(this._cachedNodes[e].accessed=t)}_updateCell$(e){return this._api.getCoreImages$(e).pipe(Wi(t=>{if(!(e in this._cachedTiles))return zi();const i=this._nodeIndex,r=this._nodeIndexTiles[e],o=this._nodeToTile,c=this._cachedTiles[e];c.accessed=new Date().getTime();const s=c.nodes,f=t.images;for(const p of f){if(p==null)break;if(this.hasNode(p.id))continue;if(p.sequence.id==null){console.warn(`Sequence missing, discarding node (${p.id})`);continue}const g=new Kb(p);s.push(g);const _={lat:g.lngLat.lat,lng:g.lngLat.lng,node:g};i.insert(_),r.push(_),o[g.id]=e,this._setNode(g)}return Ai(e)}),Nn(t=>(console.error(t),zi())))}}class Ly{constructor(){this._hash={},this._index=new Ly._spatialIndex(16),this._indexChanged$=new ri,this._updated$=new ri}static register(e){Ly._spatialIndex=e}get changed$(){return this._indexChanged$}get updated$(){return this._updated$}add(e){const t=[],i=this._hash,r=this._index;for(const o of e){const c=o.id;c in i&&(r.remove(i[c]),t.push(o));const s={lat:o.lngLat.lat,lng:o.lngLat.lng,marker:o};i[c]=s,r.insert(s)}t.length>0&&this._updated$.next(t),e.length>t.length&&this._indexChanged$.next(this)}has(e){return e in this._hash}get(e){return this.has(e)?this._hash[e].marker:void 0}getAll(){return this._index.all().map(e=>e.marker)}remove(e){const t=this._hash,i=this._index;let r=!1;for(const o of e){if(!(o in t))continue;const c=t[o];i.remove(c),delete t[o],r=!0}r&&this._indexChanged$.next(this)}removeAll(){this._hash={},this._index.clear(),this._indexChanged$.next(this)}search([e,t]){return this._index.search({maxX:t.lng,maxY:t.lat,minX:e.lng,minY:e.lat}).map(i=>i.marker)}update(e){const t=this._hash,i=this._index,r=e.id;if(!(r in t))return;i.remove(t[r]);const o={lat:e.lngLat.lat,lng:e.lngLat.lng,marker:e};t[r]=o,i.insert(o)}}function sK(n,e,t,i,r){sO(n,e,t||0,i||n.length-1,r||oK)}function sO(n,e,t,i,r){for(;i>t;){if(i-t>600){var o=i-t+1,c=e-t+1,s=Math.log(o),f=.5*Math.exp(2*s/3),p=.5*Math.sqrt(s*f*(o-f)/o)*(c-o/2<0?-1:1),g=Math.max(t,Math.floor(e-c*f/o+p)),_=Math.min(i,Math.floor(e+(o-c)*f/o+p));sO(n,e,g,_,r)}var x=n[e],b=t,M=i;for(Sv(n,t,e),r(n[i],x)>0&&Sv(n,t,i);b<M;){for(Sv(n,b,M),b++,M--;r(n[b],x)<0;)b++;for(;r(n[M],x)>0;)M--}r(n[t],x)===0?Sv(n,t,M):(M++,Sv(n,M,i)),M<=e&&(t=M+1),e<=M&&(i=M-1)}}function Sv(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function oK(n,e){return n<e?-1:n>e?1:0}class aK{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!Qb(e,t))return i;const r=this.toBBox,o=[];for(;t;){for(let c=0;c<t.children.length;c++){const s=t.children[c],f=t.leaf?r(s):s;Qb(e,f)&&(t.leaf?i.push(s):mT(e,f)?this._all(s,i):o.push(s))}t=o.pop()}return i}collides(e){let t=this.data;if(!Qb(e,t))return!1;const i=[];for(;t;){for(let r=0;r<t.children.length;r++){const o=t.children[r],c=t.leaf?this.toBBox(o):o;if(Qb(e,c)){if(t.leaf||mT(e,c))return!0;i.push(o)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=cg([]),this}remove(e,t){if(!e)return this;let i=this.data;const r=this.toBBox(e),o=[],c=[];let s,f,p;for(;i||o.length;){if(i||(i=o.pop(),f=o[o.length-1],s=c.pop(),p=!0),i.leaf){const g=lK(e,i.children,t);if(g!==-1)return i.children.splice(g,1),o.push(i),this._condense(o),this}!p&&!i.leaf&&mT(i,r)?(o.push(i),c.push(s),s=0,f=i,i=i.children[0]):f?(s++,i=f.children[s],p=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,r){const o=i-t+1;let c=this._maxEntries,s;if(o<=c)return s=cg(e.slice(t,i+1)),tg(s,this.toBBox),s;r||(r=Math.ceil(Math.log(o)/Math.log(c)),c=Math.ceil(o/Math.pow(c,r-1))),s=cg([]),s.leaf=!1,s.height=r;const f=Math.ceil(o/c),p=f*Math.ceil(Math.sqrt(c));P3(e,t,i,p,this.compareMinX);for(let g=t;g<=i;g+=p){const _=Math.min(g+p-1,i);P3(e,g,_,f,this.compareMinY);for(let x=g;x<=_;x+=f){const b=Math.min(x+f-1,_);s.children.push(this._build(e,x,b,r-1))}}return tg(s,this.toBBox),s}_chooseSubtree(e,t,i,r){for(;r.push(t),!(t.leaf||r.length-1===i);){let o=1/0,c=1/0,s;for(let f=0;f<t.children.length;f++){const p=t.children[f],g=pT(p),_=hK(e,p)-g;_<c?(c=_,o=g<o?g:o,s=p):_===c&&g<o&&(o=g,s=p)}t=s||t.children[0]}return t}_insert(e,t,i){const r=i?e:this.toBBox(e),o=[],c=this._chooseSubtree(r,this.data,t,o);for(c.children.push(e),Bv(c,r);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(r,o,t)}_split(e,t){const i=e[t],r=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,r);const c=this._chooseSplitIndex(i,o,r),s=cg(i.children.splice(c,i.children.length-c));s.height=i.height,s.leaf=i.leaf,tg(i,this.toBBox),tg(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(i,s)}_splitRoot(e,t){this.data=cg([e,t]),this.data.height=e.height+1,this.data.leaf=!1,tg(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let r,o=1/0,c=1/0;for(let s=t;s<=i-t;s++){const f=zv(e,0,s,this.toBBox),p=zv(e,s,i,this.toBBox),g=dK(f,p),_=pT(f)+pT(p);g<o?(o=g,r=s,c=_<c?_:c):g===o&&_<c&&(c=_,r=s)}return r||i-t}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:cK,o=e.leaf?this.compareMinY:uK,c=this._allDistMargin(e,t,i,r),s=this._allDistMargin(e,t,i,o);c<s&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const o=this.toBBox,c=zv(e,0,t,o),s=zv(e,i-t,i,o);let f=Jb(c)+Jb(s);for(let p=t;p<i-t;p++){const g=e.children[p];Bv(c,e.leaf?o(g):g),f+=Jb(c)}for(let p=i-t-1;p>=t;p--){const g=e.children[p];Bv(s,e.leaf?o(g):g),f+=Jb(s)}return f}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)Bv(t[r],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():tg(e[t],this.toBBox)}}function lK(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function tg(n,e){zv(n,0,n.children.length,e,n)}function zv(n,e,t,i,r){r||(r=cg(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<t;o++){const c=n.children[o];Bv(r,n.leaf?i(c):c)}return r}function Bv(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function cK(n,e){return n.minX-e.minX}function uK(n,e){return n.minY-e.minY}function pT(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Jb(n){return n.maxX-n.minX+(n.maxY-n.minY)}function hK(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function dK(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),r=Math.min(n.maxX,e.maxX),o=Math.min(n.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,o-i)}function mT(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function Qb(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function cg(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function P3(n,e,t,i,r){const o=[e,t];for(;o.length;){if(t=o.pop(),e=o.pop(),t-e<=i)continue;const c=e+Math.ceil((t-e)/i/2)*i;sK(n,c,e,t,r),o.push(e,c,c,t)}}class oO extends aK{compareMinX(e,t){return e.lng-t.lng}compareMinY(e,t){return e.lat-t.lat}toBBox(e){return{minX:e.lng,minY:e.lat,maxX:e.lng,maxY:e.lat}}}class Mr{constructor(e,t){this._components={};for(const i in Mr.registeredComponents){if(!Mr.registeredComponents.hasOwnProperty(i))continue;const r=Mr.registeredComponents[i];this._components[i]={active:!1,component:new r(i,e,t)}}this._coverComponent=new Mr.registeredCoverComponent("cover",e,t),this._coverComponent.activate(),this._coverActivated=!0}static register(e){Mr.registeredComponents[e.componentName]===void 0&&(Mr.registeredComponents[e.componentName]=e)}static registerCover(e){Mr.registeredCoverComponent=e}get coverActivated(){return this._coverActivated}activateCover(){if(!this._coverActivated){this._coverActivated=!0;for(const e in this._components){if(!this._components.hasOwnProperty(e))continue;const t=this._components[e];t.active&&t.component.deactivate()}}}deactivateCover(){if(this._coverActivated){this._coverActivated=!1;for(const e in this._components){if(!this._components.hasOwnProperty(e))continue;const t=this._components[e];t.active&&t.component.activate()}}}activate(e){this._checkName(e),this._components[e].active=!0,this._coverActivated||this.get(e).activate()}configure(e,t){this._checkName(e),this.get(e).configure(t)}deactivate(e){this._checkName(e),this._components[e].active=!1,this._coverActivated||this.get(e).deactivate()}get(e){return this._components[e].component}getCover(){return this._coverComponent}remove(){this._coverComponent.deactivate();for(const e in this._components)this._components.hasOwnProperty(e)&&this._components[e].component.deactivate()}_checkName(e){if(!(e in this._components))throw new pa(`Component does not exist: ${e}`)}}Mr.registeredComponents={};var Ry=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fK(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return n[t]}})}),e}function pK(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var mK=Array.isArray,gK=Object.prototype.toString,tC=mK||_K;function _K(n){return gK.call(n)==="[object Array]"}var o0="2",vK=o0;Ul.NONE=0;Ul.VTEXT=1;Ul.VNODE=2;Ul.WIDGET=3;Ul.PROPS=4;Ul.ORDER=5;Ul.INSERT=6;Ul.REMOVE=7;Ul.THUNK=8;var aO=Ul;function Ul(n,e,t){this.type=Number(n),this.vNode=e,this.patch=t}Ul.prototype.version=vK;Ul.prototype.type="VirtualPatch";var yK=o0,a0=bK;function bK(n){return n&&n.type==="VirtualNode"&&n.version===yK}var xK=o0,Hw=wK;function wK(n){return n&&n.type==="VirtualText"&&n.version===xK}var Tp=SK;function SK(n){return n&&n.type==="Widget"}var Ww=TK;function TK(n){return n&&n.type==="Thunk"}var MK=a0,CK=Hw,EK=Tp,I3=Ww,lO=AK;function AK(n,e){var t=n,i=e;return I3(e)&&(i=L3(e,n)),I3(n)&&(t=L3(n,null)),{a:t,b:i}}function L3(n,e){var t=n.vnode;if(t||(t=n.vnode=n.render(e)),!(MK(t)||CK(t)||EK(t)))throw new Error("thunk did not return a valid node");return t}var cO=function(e){return typeof e=="object"&&e!==null},Zw=PK;function PK(n){return n&&(typeof n.hook=="function"&&!n.hasOwnProperty("hook")||typeof n.unhook=="function"&&!n.hasOwnProperty("unhook"))}var R3=cO,IK=Zw,LK=uO;function uO(n,e){var t;for(var i in n){i in e||(t=t||{},t[i]=void 0);var r=n[i],o=e[i];if(r!==o)if(R3(r)&&R3(o))if(k3(o)!==k3(r))t=t||{},t[i]=o;else if(IK(o))t=t||{},t[i]=o;else{var c=uO(r,o);c&&(t=t||{},t[i]=c)}else t=t||{},t[i]=o}for(var s in e)s in n||(t=t||{},t[s]=e[s]);return t}function k3(n){if(Object.getPrototypeOf)return Object.getPrototypeOf(n);if(n.__proto__)return n.__proto__;if(n.constructor)return n.constructor.prototype}var RK=tC,Qr=aO,fp=a0,D3=Hw,Mx=Tp,lw=Ww,kK=lO,DK=LK,FK=hO;function hO(n,e){var t={a:n};return dO(n,e,t,0),t}function dO(n,e,t,i){if(n!==e){var r=t[i],o=!1;if(lw(n)||lw(e))iC(n,e,t,i);else if(e==null)Mx(n)||(F3(n,t,i),r=t[i]),r=gc(r,new Qr(Qr.REMOVE,n,e));else if(fp(e))if(fp(n))if(n.tagName===e.tagName&&n.namespace===e.namespace&&n.key===e.key){var c=DK(n.properties,e.properties);c&&(r=gc(r,new Qr(Qr.PROPS,n,c))),r=OK(n,e,t,r,i)}else r=gc(r,new Qr(Qr.VNODE,n,e)),o=!0;else r=gc(r,new Qr(Qr.VNODE,n,e)),o=!0;else D3(e)?D3(n)?n.text!==e.text&&(r=gc(r,new Qr(Qr.VTEXT,n,e))):(r=gc(r,new Qr(Qr.VTEXT,n,e)),o=!0):Mx(e)&&(Mx(n)||(o=!0),r=gc(r,new Qr(Qr.WIDGET,n,e)));r&&(t[i]=r),o&&F3(n,t,i)}}function OK(n,e,t,i,r){for(var o=n.children,c=NK(o,e.children),s=c.children,f=o.length,p=s.length,g=f>p?f:p,_=0;_<g;_++){var x=o[_],b=s[_];r+=1,x?dO(x,b,t,r):b&&(i=gc(i,new Qr(Qr.INSERT,null,b))),fp(x)&&x.count&&(r+=x.count)}return c.moves&&(i=gc(i,new Qr(Qr.ORDER,n,c.moves))),i}function F3(n,e,t){pO(n,e,t),fO(n,e,t)}function fO(n,e,t){if(Mx(n))typeof n.destroy=="function"&&(e[t]=gc(e[t],new Qr(Qr.REMOVE,n,null)));else if(fp(n)&&(n.hasWidgets||n.hasThunks))for(var i=n.children,r=i.length,o=0;o<r;o++){var c=i[o];t+=1,fO(c,e,t),fp(c)&&c.count&&(t+=c.count)}else lw(n)&&iC(n,null,e,t)}function iC(n,e,t,i){var r=kK(n,e),o=hO(r.a,r.b);zK(o)&&(t[i]=new Qr(Qr.THUNK,null,o))}function zK(n){for(var e in n)if(e!=="a")return!0;return!1}function pO(n,e,t){if(fp(n)){if(n.hooks&&(e[t]=gc(e[t],new Qr(Qr.PROPS,n,BK(n.hooks)))),n.descendantHooks||n.hasThunks)for(var i=n.children,r=i.length,o=0;o<r;o++){var c=i[o];t+=1,pO(c,e,t),fp(c)&&c.count&&(t+=c.count)}}else lw(n)&&iC(n,null,e,t)}function BK(n){var e={};for(var t in n)e[t]=void 0;return e}function NK(n,e){var t=O3(e),i=t.keys,r=t.free;if(r.length===e.length)return{children:e,moves:null};var o=O3(n),c=o.keys,s=o.free;if(s.length===n.length)return{children:e,moves:null};for(var f=[],p=0,g=r.length,_=0,x=0;x<n.length;x++){var b=n[x],M;b.key?i.hasOwnProperty(b.key)?(M=i[b.key],f.push(e[M])):(M=x-_++,f.push(null)):p<g?(M=r[p++],f.push(e[M])):(M=x-_++,f.push(null))}for(var P=p>=r.length?e.length:r[p],k=0;k<e.length;k++){var L=e[k];L.key?c.hasOwnProperty(L.key)||f.push(L):k>=P&&f.push(L)}for(var I=f.slice(),F=0,N=[],H=[],Y,q=0;q<e.length;){var U=e[q];for(Y=I[F];Y===null&&I.length;)N.push(ex(I,F,null)),Y=I[F];!Y||Y.key!==U.key?U.key?(Y&&Y.key?i[Y.key]!==q+1?(N.push(ex(I,F,Y.key)),Y=I[F],!Y||Y.key!==U.key?H.push({key:U.key,to:q}):F++):H.push({key:U.key,to:q}):H.push({key:U.key,to:q}),q++):Y&&Y.key&&N.push(ex(I,F,Y.key)):(F++,q++)}for(;F<I.length;)Y=I[F],N.push(ex(I,F,Y&&Y.key));return N.length===_&&!H.length?{children:f,moves:null}:{children:f,moves:{removes:N,inserts:H}}}function ex(n,e,t){return n.splice(e,1),{from:e,key:t}}function O3(n){for(var e={},t=[],i=n.length,r=0;r<i;r++){var o=n[r];o.key?e[o.key]=r:t.push(r)}return{keys:e,free:t}}function gc(n,e){return n?(RK(n)?n.push(e):n=[n,e],n):e}var $K=FK,VK=$K,z3=Array.prototype.slice,mO=UK;function UK(n,e){for(("length"in n)||(n=[n]),n=z3.call(n);n.length;){var t=n.shift(),i=e(t);if(i)return i;t.childNodes&&t.childNodes.length&&(n=z3.call(t.childNodes).concat(n))}}var jK=Ug;function Ug(n,e){if(!(this instanceof Ug))return new Ug(n,e);this.data=n,this.nodeValue=n,this.length=n.length,this.ownerDocument=e||null}Ug.prototype.nodeType=8;Ug.prototype.nodeName="#comment";Ug.prototype.toString=function(){return"[object Comment]"};var GK=$d;function $d(n,e){if(!(this instanceof $d))return new $d(n);this.data=n||"",this.length=this.data.length,this.ownerDocument=e||null}$d.prototype.type="DOMTextNode";$d.prototype.nodeType=3;$d.prototype.nodeName="#text";$d.prototype.toString=function(){return this.data};$d.prototype.replaceData=function(e,t,i){var r=this.data,o=r.substring(0,e),c=r.substring(e+t,r.length);this.data=o+i+c,this.length=this.data.length};var gO=qK;function qK(n){var e=this,t=n.type;n.target||(n.target=e),e.listeners||(e.listeners={});var i=e.listeners[t];if(i)return i.forEach(function(r){n.currentTarget=e,typeof r=="function"?r(n):r.handleEvent(n)});e.parentNode&&e.parentNode.dispatchEvent(n)}var _O=HK;function HK(n,e){var t=this;t.listeners||(t.listeners={}),t.listeners[n]||(t.listeners[n]=[]),t.listeners[n].indexOf(e)===-1&&t.listeners[n].push(e)}var vO=WK;function WK(n,e){var t=this;if(t.listeners&&t.listeners[n]){var i=t.listeners[n],r=i.indexOf(e);r!==-1&&i.splice(r,1)}}var ZK=yO,XK=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function yO(n){switch(n.nodeType){case 3:return nC(n.data);case 8:return"<!--"+n.data+"-->";default:return YK(n)}}function YK(n){var e=[],t=n.tagName;return n.namespaceURI==="http://www.w3.org/1999/xhtml"&&(t=t.toLowerCase()),e.push("<"+t+eJ(n)+QK(n)),XK.indexOf(t)>-1?e.push(" />"):(e.push(">"),n.childNodes.length?e.push.apply(e,n.childNodes.map(yO)):n.textContent||n.innerText?e.push(nC(n.textContent||n.innerText)):n.innerHTML&&e.push(n.innerHTML),e.push("</"+t+">")),e.join("")}function KK(n,e){var t=typeof n[e];return e==="style"&&Object.keys(n.style).length>0?!0:n.hasOwnProperty(e)&&(t==="string"||t==="boolean"||t==="number")&&e!=="nodeName"&&e!=="className"&&e!=="tagName"&&e!=="textContent"&&e!=="innerText"&&e!=="namespaceURI"&&e!=="innerHTML"}function JK(n){if(typeof n=="string")return n;var e="";return Object.keys(n).forEach(function(t){var i=n[t];t=t.replace(/[A-Z]/g,function(r){return"-"+r.toLowerCase()}),e+=t+":"+i+";"}),e}function QK(n){var e=n.dataset,t=[];for(var i in e)t.push({name:"data-"+i,value:e[i]});return t.length?bO(t):""}function bO(n){var e=[];return n.forEach(function(t){var i=t.name,r=t.value;i==="style"&&(r=JK(r)),e.push(i+'="'+tJ(r)+'"')}),e.length?" "+e.join(" "):""}function eJ(n){var e=[];for(var t in n)KK(n,t)&&e.push({name:t,value:n[t]});for(var i in n._attributes)for(var r in n._attributes[i]){var o=n._attributes[i][r],c=(o.prefix?o.prefix+":":"")+r;e.push({name:c,value:o.value})}return n.className&&e.push({name:"class",value:n.className}),e.length?bO(e):""}function nC(n){var e="";return typeof n=="string"?e=n:n&&(e=n.toString()),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function tJ(n){return nC(n).replace(/"/g,"&quot;")}var rC=mO,iJ=gO,nJ=_O,rJ=vO,sJ=ZK,B3="http://www.w3.org/1999/xhtml",xO=Gr;function Gr(n,e,t){if(!(this instanceof Gr))return new Gr(n);var i=t===void 0?B3:t||null;this.tagName=i===B3?String(n).toUpperCase():n,this.nodeName=this.tagName,this.className="",this.dataset={},this.childNodes=[],this.parentNode=null,this.style={},this.ownerDocument=e||null,this.namespaceURI=i,this._attributes={},this.tagName==="INPUT"&&(this.type="text")}Gr.prototype.type="DOMElement";Gr.prototype.nodeType=1;Gr.prototype.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e),e.parentNode=this,e};Gr.prototype.replaceChild=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=this.childNodes.indexOf(t);return t.parentNode=null,this.childNodes[i]=e,e.parentNode=this,t};Gr.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return this.childNodes.splice(t,1),e.parentNode=null,e};Gr.prototype.insertBefore=function(e,t){e.parentNode&&e.parentNode.removeChild(e);var i=t==null?-1:this.childNodes.indexOf(t);return i>-1?this.childNodes.splice(i,0,e):this.childNodes.push(e),e.parentNode=this,e};Gr.prototype.setAttributeNS=function(e,t,i){var r=null,o=t,c=t.indexOf(":");if(c>-1&&(r=t.substr(0,c),o=t.substr(c+1)),this.tagName==="INPUT"&&t==="type")this.type=i;else{var s=this._attributes[e]||(this._attributes[e]={});s[o]={value:i,prefix:r}}};Gr.prototype.getAttributeNS=function(e,t){var i=this._attributes[e],r=i&&i[t]&&i[t].value;return this.tagName==="INPUT"&&t==="type"?this.type:typeof r!="string"?null:r};Gr.prototype.removeAttributeNS=function(e,t){var i=this._attributes[e];i&&delete i[t]};Gr.prototype.hasAttributeNS=function(e,t){var i=this._attributes[e];return!!i&&t in i};Gr.prototype.setAttribute=function(e,t){return this.setAttributeNS(null,e,t)};Gr.prototype.getAttribute=function(e){return this.getAttributeNS(null,e)};Gr.prototype.removeAttribute=function(e){return this.removeAttributeNS(null,e)};Gr.prototype.hasAttribute=function(e){return this.hasAttributeNS(null,e)};Gr.prototype.removeEventListener=rJ;Gr.prototype.addEventListener=nJ;Gr.prototype.dispatchEvent=iJ;Gr.prototype.focus=function(){};Gr.prototype.toString=function(){return sJ(this)};Gr.prototype.getElementsByClassName=function(e){var t=e.split(" "),i=[];return rC(this,function(r){if(r.nodeType===1){var o=r.className||"",c=o.split(" ");t.every(function(s){return c.indexOf(s)!==-1})&&i.push(r)}}),i};Gr.prototype.getElementsByTagName=function(e){e=e.toLowerCase();var t=[];return rC(this.childNodes,function(i){i.nodeType===1&&(e==="*"||i.tagName.toLowerCase()===e)&&t.push(i)}),t};Gr.prototype.contains=function(e){return rC(this,function(t){return e===t})||!1};var sC=xO,oJ=_u;function _u(n){if(!(this instanceof _u))return new _u;this.childNodes=[],this.parentNode=null,this.ownerDocument=n||null}_u.prototype.type="DocumentFragment";_u.prototype.nodeType=11;_u.prototype.nodeName="#document-fragment";_u.prototype.appendChild=sC.prototype.appendChild;_u.prototype.replaceChild=sC.prototype.replaceChild;_u.prototype.removeChild=sC.prototype.removeChild;_u.prototype.toString=function(){return this.childNodes.map(function(e){return String(e)}).join("")};var aJ=oC;function oC(n){}oC.prototype.initEvent=function(e,t,i){this.type=e,this.bubbles=t,this.cancelable=i};oC.prototype.preventDefault=function(){};var lJ=mO,cJ=jK,uJ=GK,l0=xO,hJ=oJ,dJ=aJ,fJ=gO,pJ=_O,mJ=vO,gJ=cw;function cw(){if(!(this instanceof cw))return new cw;this.head=this.createElement("head"),this.body=this.createElement("body"),this.documentElement=this.createElement("html"),this.documentElement.appendChild(this.head),this.documentElement.appendChild(this.body),this.childNodes=[this.documentElement],this.nodeType=9}var ul=cw.prototype;ul.createTextNode=function(e){return new uJ(e,this)};ul.createElementNS=function(e,t){var i=e===null?null:String(e);return new l0(t,this,i)};ul.createElement=function(e){return new l0(e,this)};ul.createDocumentFragment=function(){return new hJ(this)};ul.createEvent=function(e){return new dJ};ul.createComment=function(e){return new cJ(e,this)};ul.getElementById=function(e){e=String(e);var t=lJ(this.childNodes,function(i){if(String(i.id)===e)return i});return t||null};ul.getElementsByClassName=l0.prototype.getElementsByClassName;ul.getElementsByTagName=l0.prototype.getElementsByTagName;ul.contains=l0.prototype.contains;ul.removeEventListener=mJ;ul.addEventListener=pJ;ul.dispatchEvent=fJ;var _J=gJ,vJ=new _J,N3=typeof Ry<"u"?Ry:typeof window<"u"?window:{},yJ=vJ,Nv;typeof document<"u"?Nv=document:(Nv=N3["__GLOBAL_DOCUMENT_CACHE@4"],Nv||(Nv=N3["__GLOBAL_DOCUMENT_CACHE@4"]=yJ));var wO=Nv,TM=cO,SO=Zw,TO=bJ;function bJ(n,e,t){for(var i in e){var r=e[i];r===void 0?$3(n,i,r,t):SO(r)?($3(n,i,r,t),r.hook&&r.hook(n,i,t?t[i]:void 0)):TM(r)?xJ(n,e,t,i,r):n[i]=r}}function $3(n,e,t,i){if(i){var r=i[e];if(SO(r))r.unhook&&r.unhook(n,e,t);else if(e==="attributes")for(var o in r)n.removeAttribute(o);else if(e==="style")for(var c in r)n.style[c]="";else typeof r=="string"?n[e]="":n[e]=null}}function xJ(n,e,t,i,r){var o=t?t[i]:void 0;if(i==="attributes"){for(var c in r){var s=r[c];s===void 0?n.removeAttribute(c):n.setAttribute(c,s)}return}if(o&&TM(o)&&V3(o)!==V3(r)){n[i]=r;return}TM(n[i])||(n[i]={});var f=i==="style"?"":void 0;for(var p in r){var g=r[p];n[i][p]=g===void 0?f:g}}function V3(n){if(Object.getPrototypeOf)return Object.getPrototypeOf(n);if(n.__proto__)return n.__proto__;if(n.constructor)return n.constructor.prototype}var U3=wO,wJ=TO,SJ=a0,TJ=Hw,MJ=Tp,CJ=lO,MO=CO;function CO(n,e){var t=e&&e.document||U3,i=e?e.warn:null;if(n=CJ(n).a,MJ(n))return n.init();if(TJ(n))return t.createTextNode(n.text);if(!SJ(n))return i&&i("Item is not a valid virtual dom node",n),null;var r=n.namespace===null?t.createElement(n.tagName):t.createElementNS(n.namespace,n.tagName),o=n.properties;wJ(r,o);for(var c=n.children,s=0;s<c.length;s++){var f=CO(c[s],e);f&&r.appendChild(f)}return r}var EJ={},AJ=PJ;function PJ(n,e,t,i){return!t||t.length===0?{}:(t.sort(IJ),EO(n,e,t,i,0))}function EO(n,e,t,i,r){if(i=i||{},n){j3(t,r,r)&&(i[r]=n);var o=e.children;if(o)for(var c=n.childNodes,s=0;s<e.children.length;s++){r+=1;var f=o[s]||EJ,p=r+(f.count||0);j3(t,r,p)&&EO(c[s],f,t,i,r),r=p}}return i}function j3(n,e,t){if(n.length===0)return!1;for(var i=0,r=n.length-1,o,c;i<=r;){if(o=(r+i)/2>>0,c=n[o],i===r)return c>=e&&c<=t;if(c<e)i=o+1;else if(c>t)r=o-1;else return!0}return!1}function IJ(n,e){return n>e?1:-1}var G3=Tp,LJ=RJ;function RJ(n,e){return G3(n)&&G3(e)?"name"in n&&"name"in e?n.id===e.id:n.init===e.init:!1}var kJ=TO,DJ=Tp,_d=aO,FJ=LJ,OJ=zJ;function zJ(n,e,t){var i=n.type,r=n.vNode,o=n.patch;switch(i){case _d.REMOVE:return BJ(e,r);case _d.INSERT:return NJ(e,o,t);case _d.VTEXT:return $J(e,r,o,t);case _d.WIDGET:return VJ(e,r,o,t);case _d.VNODE:return UJ(e,r,o,t);case _d.ORDER:return jJ(e,o),e;case _d.PROPS:return kJ(e,o,r.properties),e;case _d.THUNK:return GJ(e,t.patch(e,o,t));default:return e}}function BJ(n,e){var t=n.parentNode;return t&&t.removeChild(n),AO(n,e),null}function NJ(n,e,t){var i=t.render(e,t);return n&&n.appendChild(i),n}function $J(n,e,t,i){var r;if(n.nodeType===3)n.replaceData(0,n.length,t.text),r=n;else{var o=n.parentNode;r=i.render(t,i),o&&r!==n&&o.replaceChild(r,n)}return r}function VJ(n,e,t,i){var r=FJ(e,t),o;r?o=t.update(e,n)||n:o=i.render(t,i);var c=n.parentNode;return c&&o!==n&&c.replaceChild(o,n),r||AO(n,e),o}function UJ(n,e,t,i){var r=n.parentNode,o=i.render(t,i);return r&&o!==n&&r.replaceChild(o,n),o}function AO(n,e){typeof e.destroy=="function"&&DJ(e)&&e.destroy(n)}function jJ(n,e){for(var t=n.childNodes,i={},r,o,c,s=0;s<e.removes.length;s++)o=e.removes[s],r=t[o.from],o.key&&(i[o.key]=r),n.removeChild(r);for(var f=t.length,p=0;p<e.inserts.length;p++)c=e.inserts[p],r=i[c.key],n.insertBefore(r,c.to>=f++?null:t[c.to])}function GJ(n,e){return n&&e&&n!==e&&n.parentNode&&n.parentNode.replaceChild(e,n),e}var qJ=wO,HJ=tC,WJ=MO,ZJ=AJ,q3=OJ,XJ=PO;function PO(n,e,t){return t=t||{},t.patch=t.patch&&t.patch!==PO?t.patch:YJ,t.render=t.render||WJ,t.patch(n,e,t)}function YJ(n,e,t){var i=JJ(e);if(i.length===0)return n;var r=ZJ(n,e.a,i),o=n.ownerDocument;!t.document&&o!==qJ&&(t.document=o);for(var c=0;c<i.length;c++){var s=i[c];n=KJ(n,r[s],e[s],t)}return n}function KJ(n,e,t,i){if(!e)return n;var r;if(HJ(t))for(var o=0;o<t.length;o++)r=q3(t[o],e,i),e===n&&(n=r);else r=q3(t,e,i),e===n&&(n=r);return n}function JJ(n){var e=[];for(var t in n)t!=="a"&&e.push(Number(t));return e}var QJ=XJ,eQ=QJ,tQ=o0,iQ=a0,nQ=Tp,rQ=Ww,sQ=Zw,IO=aC,oQ={},aQ=[];function aC(n,e,t,i,r){this.tagName=n,this.properties=e||oQ,this.children=t||aQ,this.key=i!=null?String(i):void 0,this.namespace=typeof r=="string"?r:null;var o=t&&t.length||0,c=0,s=!1,f=!1,p=!1,g;for(var _ in e)if(e.hasOwnProperty(_)){var x=e[_];sQ(x)&&x.unhook&&(g||(g={}),g[_]=x)}for(var b=0;b<o;b++){var M=t[b];iQ(M)?(c+=M.count||0,!s&&M.hasWidgets&&(s=!0),!f&&M.hasThunks&&(f=!0),!p&&(M.hooks||M.descendantHooks)&&(p=!0)):!s&&nQ(M)?typeof M.destroy=="function"&&(s=!0):!f&&rQ(M)&&(f=!0)}this.count=o+c,this.hasWidgets=s,this.hasThunks=f,this.hooks=g,this.descendantHooks=p}aC.prototype.version=tQ;aC.prototype.type="VirtualNode";var lQ=o0,LO=lC;function lC(n){this.text=String(n)}lC.prototype.version=lQ;lC.prototype.type="VirtualText";var cQ=(function(e){var t=String.prototype.split,i=/()??/.exec("")[1]===e,r;return r=function(o,_,s){if(Object.prototype.toString.call(_)!=="[object RegExp]")return t.call(o,_,s);var f=[],p=(_.ignoreCase?"i":"")+(_.multiline?"m":"")+(_.extended?"x":"")+(_.sticky?"y":""),g=0,_=new RegExp(_.source,p+"g"),x,b,M,P;for(o+="",i||(x=new RegExp("^"+_.source+"$(?!\\s)",p)),s=s===e?-1>>>0:s>>>0;(b=_.exec(o))&&(M=b.index+b[0].length,!(M>g&&(f.push(o.slice(g,b.index)),!i&&b.length>1&&b[0].replace(x,function(){for(var k=1;k<arguments.length-2;k++)arguments[k]===e&&(b[k]=e)}),b.length>1&&b.index<o.length&&Array.prototype.push.apply(f,b.slice(1)),P=b[0].length,g=M,f.length>=s)));)_.lastIndex===b.index&&_.lastIndex++;return g===o.length?(P||!_.test(""))&&f.push(""):f.push(o.slice(g)),f.length>s?f.slice(0,s):f},r})(),uQ=cQ,hQ=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,dQ=/^\.|#/,fQ=pQ;function pQ(n,e){if(!n)return"DIV";var t=!e.hasOwnProperty("id"),i=uQ(n,hQ),r=null;dQ.test(i[1])&&(r="DIV");var o,c,s,f;for(f=0;f<i.length;f++)c=i[f],c&&(s=c.charAt(0),r?s==="."?(o=o||[],o.push(c.substring(1,c.length))):s==="#"&&t&&(e.id=c.substring(1,c.length)):r=c);return o&&(e.className&&o.push(e.className),e.className=o.join(" ")),e.namespace?r:r.toUpperCase()}var mQ=uw;function uw(n){if(!(this instanceof uw))return new uw(n);this.value=n}uw.prototype.hook=function(n,e){n[e]!==this.value&&(n[e]=this.value)};var gT=typeof window<"u"?window:typeof Ry<"u"?Ry:{},gQ=_Q;function _Q(n,e){return n in gT?gT[n]:(gT[n]=e,e)}var H3=gQ,vQ=yQ;function yQ(n,e,t){var i="__INDIVIDUAL_ONE_VERSION_"+n,r=i+"_ENFORCE_SINGLETON",o=H3(r,e);if(o!==e)throw new Error("Can only have one copy of "+n+`.
You already have version `+o+` installed.
This means you cannot install version `+e);return H3(i,t)}var bQ=vQ,RO="7";bQ("ev-store",RO);var W3="__EV_STORE_KEY@"+RO,xQ=wQ;function wQ(n){var e=n[W3];return e||(e=n[W3]={}),e}var kO=xQ,SQ=ky;function ky(n){if(!(this instanceof ky))return new ky(n);this.value=n}ky.prototype.hook=function(n,e){var t=kO(n),i=e.substr(3);t[i]=this.value};ky.prototype.unhook=function(n,e){var t=kO(n),i=e.substr(3);t[i]=void 0};var DO=tC,TQ=IO,Z3=LO,MQ=a0,CQ=Hw,EQ=Tp,FO=Zw,AQ=Ww,PQ=fQ,IQ=mQ,LQ=SQ,RQ=kQ;function kQ(n,e,t){var i=[],r,o,c,s;return!t&&FQ(e)&&(t=e,o={}),o=o||e||{},r=PQ(n,o),o.hasOwnProperty("key")&&(c=o.key,o.key=void 0),o.hasOwnProperty("namespace")&&(s=o.namespace,o.namespace=void 0),r==="INPUT"&&!s&&o.hasOwnProperty("value")&&o.value!==void 0&&!FO(o.value)&&(o.value=IQ(o.value)),DQ(o),t!=null&&OO(t,i,r,o),new TQ(r,o,i,c,s)}function OO(n,e,t,i){if(typeof n=="string")e.push(new Z3(n));else if(typeof n=="number")e.push(new Z3(String(n)));else if(zO(n))e.push(n);else if(DO(n))for(var r=0;r<n.length;r++)OO(n[r],e,t,i);else{if(n==null)return;throw OQ({foreignObject:n,parentVnode:{tagName:t,properties:i}})}}function DQ(n){for(var e in n)if(n.hasOwnProperty(e)){var t=n[e];if(FO(t))continue;e.substr(0,3)==="ev-"&&(n[e]=LQ(t))}}function zO(n){return MQ(n)||CQ(n)||EQ(n)||AQ(n)}function FQ(n){return typeof n=="string"||DO(n)||zO(n)}function OQ(n){var e=new Error;return e.type="virtual-hyperscript.unexpected.virtual-element",e.message=`Unexpected virtual child passed to h().
Expected a VNode / Vthunk / VWidget / string but:
got:
`+X3(n.foreignObject)+`.
The parent vnode is:
`+X3(n.parentVnode),e.foreignObject=n.foreignObject,e.parentVnode=n.parentVnode,e}function X3(n){try{return JSON.stringify(n,null,"    ")}catch{return String(n)}}var zQ=RQ,BQ=zQ,NQ=MO,$Q=NQ,VQ=VK,UQ=eQ,jQ=BQ,GQ=$Q,qQ=IO,HQ=LO,jt={diff:VQ,patch:UQ,h:jQ,create:GQ,VNode:qQ,VText:HQ};class Xw{constructor(){this._events={}}fire(e,t){if(this._listens(e))for(const i of this._events[e])i(t)}off(e,t){if(!e){this._events={};return}if(this._listens(e)){const i=this._events[e].indexOf(t);i>=0&&this._events[e].splice(i,1),this._events[e].length||delete this._events[e]}}on(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)}_listens(e){return e in this._events}}class yo{constructor(){this._subscriptions=[]}push(e){this._subscriptions.push(e)}unsubscribe(){for(const e of this._subscriptions)e.unsubscribe();this._subscriptions=[]}}class bo extends Xw{constructor(e,t,i){super(),this._activated$=new Eh(!1),this._configurationSubject$=new ri,this._activated=!1,this._container=t,this._name=e,this._navigator=i,this._subscriptions=new yo,this._configuration$=this._configurationSubject$.pipe(An(this.defaultConfiguration),Vr((r,o)=>{for(let c in o)o.hasOwnProperty(c)&&(r[c]=o[c]);return r}),Pi(1),gi()),this._configuration$.subscribe(()=>{})}get activated(){return this._activated}get activated$(){return this._activated$}get defaultConfiguration(){return this._getDefaultConfiguration()}get configuration$(){return this._configuration$}get name(){return this._name}activate(e){this._activated||(e!==void 0&&this._configurationSubject$.next(e),this._activated=!0,this._activate(),this._activated$.next(!0))}configure(e){this._configurationSubject$.next(e)}deactivate(){this._activated&&(this._activated=!1,this._deactivate(),this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._activated$.next(!1))}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}resize(){}}var Qo;(function(n){n[n.Hidden=0]="Hidden",n[n.Loading=1]="Loading",n[n.Visible=2]="Visible"})(Qo||(Qo={}));class BO extends bo{constructor(e,t,i){super(e,t,i)}_activate(){const e=this.configuration$.pipe(wi(i=>!!i.id),oi(i=>!i.src),ei(i=>this._getImageSrc$(i.id).pipe(Nn(r=>(console.error(r),zi())))),Pi(1),gi()),t=this._subscriptions;t.push(e.pipe(We(i=>({src:i}))).subscribe(i=>{this._configurationSubject$.next(i)})),t.push(Si(this.configuration$,e).pipe(oi(([i,r])=>!!i.src&&i.src!==r),wi()).subscribe(([,i])=>{window.URL.revokeObjectURL(i)})),t.push(this._configuration$.pipe(yi(void 0,i=>i.state),ei(i=>Si(Ai(i.state),this._navigator.stateService.currentImage$)),ei(([i,r])=>{const o=Si(Ai(r.id),r.image$.pipe(oi(c=>!!c),We(c=>c.src)));return i===Qo.Visible?o.pipe(wi()):o}),yi(([i,r],[o,c])=>i===o&&r===c),We(([i,r])=>({id:i,src:r}))).subscribe(this._configurationSubject$)),t.push(Si(this._configuration$,this._container.configurationService.exploreUrl$,this._container.renderService.size$).pipe(We(([i,r,o])=>{if(!i.src)return{name:this._name,vNode:jt.h("div",[])};const c=o.width<=640||o.height<=480?".mapillary-cover-compact":"";if(i.state===Qo.Hidden){const f=jt.h("div.mapillary-cover-container.mapillary-cover-done"+c,[this._getCoverBackgroundVNode(i)]);return{name:this._name,vNode:f}}const s=jt.h("div.mapillary-cover-container"+c,[this._getCoverButtonVNode(i,r)]);return{name:this._name,vNode:s}})).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{state:Qo.Visible}}_getCoverButtonVNode(e,t){const i=e.state===Qo.Loading?"div.mapillary-cover.mapillary-cover-loading":"div.mapillary-cover",r=jt.h("div.mapillary-cover-button",[jt.h("div.mapillary-cover-button-icon",[])]),o=jt.h("a.mapillary-cover-logo",{href:t,target:"_blank"},[]),c=jt.h("div.mapillary-cover-indicator",{onclick:()=>{this.configure({state:Qo.Loading})}},[]);return jt.h(i,[this._getCoverBackgroundVNode(e),c,r,o])}_getCoverBackgroundVNode(e){const t={style:{backgroundImage:`url(${e.src})`}},i=[];return e.state===Qo.Loading&&i.push(jt.h("div.mapillary-cover-spinner",{},[])),jt.h("div.mapillary-cover-background",t,i)}_getImageSrc$(e){return gr.create(t=>{this._navigator.api.getImages$([e]).subscribe(i=>{for(const r of i){const o=typeof e=="number"?e.toString():e;if(r.node_id===o){this._navigator.api.data.getImageBuffer(r.node.thumb.url).then(c=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{t.next(s.src),t.complete()},s.onerror=()=>{t.error(new Error(`Failed to load cover image (${e})`))};const f=new Blob([c]);s.src=window.URL.createObjectURL(f)},c=>{t.error(c)});return}}t.error(new cr(`Non existent cover key: ${e}`))},i=>{t.error(i)})})}}BO.componentName="cover";class NO extends bo{_activate(){this._subscriptions.push(Si(this._container.configurationService.exploreUrl$,this._navigator.stateService.currentImage$,this._container.renderService.size$).pipe(We(([e,t,i])=>{const r=this._makeAttribution(t.creatorUsername,e,t.id,t.capturedAt,i.width);return{name:this._name,vNode:r}})).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}makeImageUrl(e,t){return`${e}/app/?pKey=${t}&focus=photo`}_makeAttribution(e,t,i,r,o){const c=o<=640,s=this._makeDate(r,c),f=this._makeBy(e,t,i,c),p=c?".mapillary-attribution-compact":"";return jt.h("div.mapillary-attribution-container"+p,{},[...f,s])}_makeBy(e,t,i,r){const o=jt.h("div.mapillary-attribution-logo",[]);return e?this._makeCreatorBy(o,e,t,i,r):this._makeGeneralBy(o,t,i,r)}_makeCreatorBy(e,t,i,r,o){const c=jt.h("a.mapillary-attribution-icon-container",{href:i,rel:"noreferrer",target:"_blank"},[e]),s=o?`${t}`:`image by ${t}`,f=jt.h("div.mapillary-attribution-username",{textContent:s},[]),p=jt.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(i,r),rel:"noreferrer",target:"_blank"},[f]);return[c,p]}_makeGeneralBy(e,t,i,r){const o=jt.h("div.mapillary-attribution-username",{textContent:"images by"},[]),c=jt.h("div.mapillary-attribution-icon-container",{},[e]),s=jt.h("div.mapillary-attribution-username",{textContent:"contributors"},[]),f=[c,s];return r||f.unshift(o),[jt.h("a.mapillary-attribution-image-container",{href:this.makeImageUrl(t,i),rel:"noreferrer",target:"_blank"},f)]}_makeDate(e,t){const i=new Date(e).toDateString().split(" "),r=(i.length>3?t?[i[3]]:[i[1],i[2]+",",i[3]]:i).join(" ");return jt.h("div.mapillary-attribution-date",{textContent:r},[])}}NO.componentName="attribution";class zo{constructor(){this._unprojectDepth=200}basicToCanvas(e,t,i,r,o){const c=r.unprojectBasic([e,t],this._unprojectDepth);return this.projectToCanvas(c,i,o)}basicToCanvasSafe(e,t,i,r,o){const c=this.basicToViewportSafe(e,t,r,o);return c===null?null:this.viewportToCanvas(c[0],c[1],i)}basicToViewport(e,t,i,r){const o=i.unprojectBasic([e,t],this._unprojectDepth);return this.projectToViewport(o,r)}basicToViewportSafe(e,t,i,r){const o=i.unprojectBasic([e,t],this._unprojectDepth);return this.worldToCamera(o,r)[2]>0?null:this.projectToViewport(o,r)}cameraToViewport(e,t){const i=new Fe().fromArray(e).applyMatrix4(t.projectionMatrix);return[i.x,i.y]}canvasPosition(e,t){const i=t.getBoundingClientRect(),r=e.clientX-i.left-t.clientLeft,o=e.clientY-i.top-t.clientTop;return[r,o]}canvasToBasic(e,t,i,r,o){const c=this.unprojectFromCanvas(e,t,i,o).toArray();return r.projectBasic(c)}canvasToViewport(e,t,i){const[r,o]=this.containerToCanvas(i),c=2*e/r-1,s=1-2*t/o;return[c,s]}containerToCanvas(e){return[e.offsetWidth,e.offsetHeight]}getBasicDistances(e,t){const i=this.viewportToBasic(-1,1,e,t),r=this.viewportToBasic(1,1,e,t),o=this.viewportToBasic(1,-1,e,t),c=this.viewportToBasic(-1,-1,e,t);let s=0,f=0,p=0,g=0;return i[1]<0&&r[1]<0&&(s=i[1]>r[1]?-i[1]:-r[1]),r[0]>1&&o[0]>1&&(f=r[0]<o[0]?r[0]-1:o[0]-1),o[1]>1&&c[1]>1&&(p=o[1]<c[1]?o[1]-1:c[1]-1),c[0]<0&&i[0]<0&&(g=c[0]>i[0]?-c[0]:-i[0]),[s,f,p,g]}getPixelDistances(e,t,i){const r=this.viewportToBasic(-1,1,t,i),o=this.viewportToBasic(1,1,t,i),c=this.viewportToBasic(1,-1,t,i),s=this.viewportToBasic(-1,-1,t,i);let f=0,p=0,g=0,_=0;const[x,b]=this.containerToCanvas(e);if(r[1]<0&&o[1]<0){const M=r[1]>o[1]?r[0]:o[0],P=this.basicToCanvas(M,0,e,t,i);f=P[1]>0?P[1]:0}if(o[0]>1&&c[0]>1){const M=o[0]<c[0]?o[1]:c[1],P=this.basicToCanvas(1,M,e,t,i);p=P[0]<x?x-P[0]:0}if(c[1]>1&&s[1]>1){const M=c[1]<s[1]?c[0]:s[0],P=this.basicToCanvas(M,1,e,t,i);g=P[1]<b?b-P[1]:0}if(s[0]<0&&r[0]<0){const M=s[0]>r[0]?s[1]:r[1],P=this.basicToCanvas(0,M,e,t,i);_=P[0]>0?P[0]:0}return[f,p,g,_]}insideElement(e,t){const i=t.getBoundingClientRect(),r=i.left+t.clientLeft,o=r+t.clientWidth,c=i.top+t.clientTop,s=c+t.clientHeight;return e.clientX>r&&e.clientX<o&&e.clientY>c&&e.clientY<s}projectToCanvas(e,t,i){const r=this.projectToViewport(e,i);return this.viewportToCanvas(r[0],r[1],t)}projectToCanvasSafe(e,t,i){if(this.worldToCamera(e,i)[2]>0)return null;const o=this.projectToViewport(e,i);return this.viewportToCanvas(o[0],o[1],t)}projectToViewport(e,t){const i=new Fe(e[0],e[1],e[2]).project(t);return[i.x,i.y]}unprojectFromCanvas(e,t,i,r){const o=this.canvasToViewport(e,t,i);return this.unprojectFromViewport(o[0],o[1],r)}unprojectFromViewport(e,t,i){return new Fe(e,t,1).unproject(i)}viewportToBasic(e,t,i,r){const o=new Fe(e,t,1).unproject(r).toArray();return i.projectBasic(o)}viewportToCanvas(e,t,i){const[r,o]=this.containerToCanvas(i),c=r*(e+1)/2,s=-o*(t-1)/2;return[c,s]}worldToCamera(e,t){return new Fe(e[0],e[1],e[2]).applyMatrix4(t.matrixWorldInverse).toArray()}}var Ld;(function(n){n[n.Automatic=0]="Automatic",n[n.Large=1]="Large",n[n.Small=2]="Small"})(Ld||(Ld={}));class $O extends bo{constructor(e,t,i){super(e,t,i),this._spatial=new vo,this._viewportCoords=new zo,this._svgNamespace="http://www.w3.org/2000/svg",this._distinctThreshold=Math.PI/360,this._animationSpeed=.075}_activate(){const e=this._subscriptions,t=this._container.renderService.renderCamera$.pipe(We(f=>{let p=this._spatial.degToRad(f.perspective.fov),g=f.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:Math.atan(f.perspective.aspect*Math.tan(.5*p))*2;return[this._spatial.azimuthalToBearing(f.rotation.phi),g]}),yi((f,p)=>Math.abs(p[0]-f[0])<this._distinctThreshold&&Math.abs(p[1]-f[1])<this._distinctThreshold)),i=Si(this._navigator.stateService.currentState$.pipe(yi(void 0,f=>f.state.currentImage.id)),this._navigator.panService.panImages$).pipe(We(([f,p])=>{const g=f.state.currentImage,_=f.state.currentTransform;if(ki(g.cameraType))return[Math.PI,Math.PI];const x=this._computeProjectedPoints(_),b=this._spatial.degToRad(this._computeHorizontalFov(x));let M=b/2,P=b/2;for(const[k,,L]of p){const I=this._spatial.wrap(k.compassAngle-g.compassAngle,-180,180);I<0?M=this._spatial.degToRad(Math.abs(I))+L/2:P=this._spatial.degToRad(Math.abs(I))+L/2}return[M,P]}),yi(([f,p],[g,_])=>Math.abs(g-f)<this._distinctThreshold&&Math.abs(_-p)<this._distinctThreshold)),r=Si(this._navigator.stateService.currentState$.pipe(yi(void 0,f=>f.state.currentImage.id)),this._container.renderService.bearing$).pipe(We(([f,p])=>this._spatial.degToRad(f.state.currentImage.compassAngle-p))),o=new ri,c=o.pipe(Vr((f,p)=>p(f),{alpha:0,curr:[0,0,0],prev:[0,0,0]}),We(f=>{const p=Bg.smootherstep(f.alpha,0,1),g=f.curr,_=f.prev;return[this._interpolate(_[0],g[0],p),this._interpolate(_[1],g[1],p)]}));e.push(i.pipe(We(f=>p=>{const g=Bg.smootherstep(p.alpha,0,1),_=p.curr,x=p.prev,b=[this._interpolate(x[0],_[0],g),this._interpolate(x[1],_[1],g)];return{alpha:0,curr:f.slice(),prev:b}})).subscribe(o)),e.push(i.pipe(ei(()=>this._container.renderService.renderCameraFrame$.pipe(Ys(1),Vr(f=>f+this._animationSpeed,0),iF(f=>f<=1+this._animationSpeed),We(f=>Math.min(f,1)))),We(f=>p=>({alpha:f,curr:p.curr.slice(),prev:p.prev.slice()}))).subscribe(o));const s=Si(r,c).pipe(We(([f,p])=>[f,p[0],p[1]]));e.push(Si(t,s,this._configuration$,this._container.renderService.size$).pipe(We(([[f,p],[g,_,x],b,M])=>{const P=this._createBackground(f),k=this._createFovIndicator(_,x,g),L=this._createNorth(f),I=this._createCircleSectorCompass(this._createCircleSector(Math.max(Math.PI/20,p),"#FFF")),F=b.size===Ld.Small||b.size===Ld.Automatic&&M.width<640?".mapillary-bearing-compact":"";return{name:this._name,vNode:jt.h("div.mapillary-bearing-indicator-container"+F,{oncontextmenu:N=>{N.preventDefault()}},[P,k,L,I])}})).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{size:Ld.Automatic}}_createFovIndicator(e,t,i){const r=this._createFovArc(e,t),o=jt.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[r]);return jt.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:`rotateZ(${this._spatial.radToDeg(i)}deg)`,width:"36px"}},[o])}_createFovArc(e,t){const o=e+t;if(o>2*Math.PI-Math.PI/90)return jt.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:`${16.75}`,stroke:"#FFF","stroke-width":`${2.5}`},namespace:this._svgNamespace},[]);let c=-Math.PI/2-e,s=c+o,f=16.75*Math.cos(c),p=16.75*Math.sin(c),g=16.75*Math.cos(s),_=16.75*Math.sin(s),x=o>=Math.PI?1:0,b=`M ${f} ${p} A ${16.75} ${16.75} 0 ${x} 1 ${g} ${_}`;return jt.h("path",{attributes:{d:b,"fill-opacity":"0",stroke:"#FFF","stroke-width":`${2.5}`},namespace:this._svgNamespace},[])}_createCircleSectorCompass(e){let t=jt.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[e]);return jt.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[t])}_createCircleSector(e,t){if(e>2*Math.PI-Math.PI/90)return jt.h("circle",{attributes:{cx:"0",cy:"0",fill:t,r:"1"},namespace:this._svgNamespace},[]);let i=-Math.PI/2-e/2,r=i+e,o=Math.cos(i),c=Math.sin(i),s=Math.cos(r),f=Math.sin(r),p=e>=Math.PI?1:0,g=`M 0 0 ${o} ${c} A 1 1 0 ${p} 1 ${s} ${f}`;return jt.h("path",{attributes:{d:g,fill:t},namespace:this._svgNamespace},[])}_createNorth(e){const t=jt.h("div.mapillary-bearing-north",[]);return jt.h("div.mapillary-bearing-north-container",{style:{transform:`rotateZ(${this._spatial.radToDeg(-e)}deg)`}},[t])}_createBackground(e){return jt.h("div.mapillary-bearing-indicator-background",{style:{transform:`rotateZ(${this._spatial.radToDeg(-e)}deg)`}},[jt.h("div.mapillary-bearing-indicator-background-circle",[]),jt.h("div.mapillary-bearing-indicator-background-arrow-container",[jt.h("div.mapillary-bearing-indicator-background-arrow",[])])])}_computeProjectedPoints(e){return eC(e,[[1,0]],[[0,.5]],12,this._viewportCoords)}_computeHorizontalFov(e){const t=e.map(r=>this._coordToFov(r[0]));return Math.min(...t)}_coordToFov(e){return this._spatial.radToDeg(2*Math.atan(e))}_interpolate(e,t,i){return(1-i)*e+i*t}}$O.componentName="bearing";class VO extends bo{constructor(e,t,i){super(e,t,i)}_activate(){const e=this._subscriptions;e.push(Si(this._navigator.stateService.currentImage$.pipe(ei(t=>t.sequenceEdges$),oi(t=>t.cached)),this._configuration$).pipe(ei(t=>{let i=t[0],r=t[1],o=Math.max(0,Math.min(4,r.depth.sequence)),c=this._cache$(i.edges,Ot.Next,o),s=this._cache$(i.edges,Ot.Prev,o);return fn(c,s).pipe(Nn(f=>(console.error("Failed to cache sequence edges.",f),zi())))})).subscribe(()=>{})),e.push(Si(this._navigator.stateService.currentImage$.pipe(ei(t=>Si(Ai(t),t.spatialEdges$.pipe(oi(i=>i.cached))))),this._configuration$).pipe(ei(([[t,i],r])=>{let o=i.edges,c=r.depth,s=Math.max(0,Math.min(2,c.spherical)),f=ki(t.cameraType)?0:Math.max(0,Math.min(3,c.step)),p=ki(t.cameraType)?0:Math.max(0,Math.min(1,c.turn)),g=this._cache$(o,Ot.Spherical,s),_=this._cache$(o,Ot.StepForward,f),x=this._cache$(o,Ot.StepBackward,f),b=this._cache$(o,Ot.StepLeft,f),M=this._cache$(o,Ot.StepRight,f),P=this._cache$(o,Ot.TurnLeft,p),k=this._cache$(o,Ot.TurnRight,p),L=this._cache$(o,Ot.TurnU,p);return fn(_,x,b,M,g,P,k,L).pipe(Nn(I=>(console.error("Failed to cache spatial edges.",I),zi())))})).subscribe(()=>{}))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{depth:{spherical:1,sequence:2,step:1,turn:0}}}_cache$(e,t,i){return xy(Ai(e),Ai(i)).pipe(eF(r=>{let o=r[0],c=r[1],s=[];if(c>0)for(let f of o)f.data.direction===t&&s.push(xy(this._navigator.graphService.cacheImage$(f.target).pipe(Wi(p=>this._imageToEdges$(p,t))),Ai(c-1)));return Fr(s).pipe(tp())}),Ys(1))}_imageToEdges$(e,t){return([Ot.Next,Ot.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(wi(i=>i.cached),We(i=>i.edges))}}VO.componentName="cache";class Bl extends cr{constructor(e){super(e??"The request was cancelled."),Object.setPrototypeOf(this,Bl.prototype),this.name="CancelMapillaryError"}}class WQ{constructor(e,t){this._spatial=new vo,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._configure(e),this._resize(t),this._reset()}get minWidth(){return this._minWidth}get maxWidth(){return this._maxWidth}get containerWidth(){return this._containerWidth}get containerWidthCss(){return this._containerWidthCss}get containerMarginCss(){return this._containerMarginCss}get containerLeftCss(){return this._containerLeftCss}get containerHeight(){return this._containerHeight}get containerHeightCss(){return this._containerHeightCss}get containerBottomCss(){return this._containerBottomCss}get stepCircleSize(){return this._stepCircleSize}get stepCircleSizeCss(){return this._stepCircleSizeCss}get stepCircleMarginCss(){return this._stepCircleMarginCss}get turnCircleSize(){return this._turnCircleSize}get turnCircleSizeCss(){return this._turnCircleSizeCss}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}get shadowOffset(){return this._shadowOffset}configure(e){this._configure(e),this._reset()}resize(e){this._resize(e),this._reset()}angleToCoordinates(e){return[Math.cos(e),Math.sin(e)]}relativeAngleToCoordiantes(e,t){let i=this._spatial.wrapAngle(e-t);return this.angleToCoordinates(i)}_configure(e){this._minWidth=e.minWidth,this._maxWidth=this._getMaxWidth(e.minWidth,e.maxWidth)}_resize(e){this._elementWidth=e.width,this._elementHeight=e.height}_reset(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight),this._containerHeight=this._getContainerHeight(this.containerWidth),this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight),this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight),this._outerRadius=this._getOuterRadius(this._containerHeight),this._innerRadius=this._getInnerRadius(this._containerHeight),this._shadowOffset=3,this._containerWidthCss=this._numberToCssPixels(this._containerWidth),this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth),this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth)),this._containerHeightCss=this._numberToCssPixels(this._containerHeight),this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight)),this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize),this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize),this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)}_getContainerWidth(e,t){let i=(e-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),r=(t-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),o=Math.max(0,Math.min(1,Math.min(i,r)));return o=.04*Math.round(25*o),this._minWidth+o*(this._maxWidth-this._minWidth)}_getContainerHeight(e){return .77*e}_getStepCircleDiameter(e){return .34*e}_getTurnCircleDiameter(e){return .3*e}_getOuterRadius(e){return .31*e}_getInnerRadius(e){return .125*e}_numberToCssPixels(e){return e+"px"}_getMaxWidth(e,t){return e>t?e:t}}class ZQ{constructor(e,t){this._isEdge=!1,this._spatial=new vo,this._calculator=new WQ(e,t),this._image=null,this._rotation={phi:0,theta:0},this._epsilon=.5*Math.PI/180,this._highlightKey=null,this._distinguishSequence=!1,this._needsRender=!1,this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[],this._stepDirections=[Ot.StepForward,Ot.StepBackward,Ot.StepLeft,Ot.StepRight],this._turnDirections=[Ot.TurnLeft,Ot.TurnRight,Ot.TurnU],this._turnNames={},this._turnNames[Ot.TurnLeft]="mapillary-direction-turn-left",this._turnNames[Ot.TurnRight]="mapillary-direction-turn-right",this._turnNames[Ot.TurnU]="mapillary-direction-turn-around";let i=!!document.documentMode;this._isEdge=!i&&!!window.StyleMedia}get needsRender(){return this._needsRender}render(e){this._needsRender=!1;let t=this._rotation,i=[],r=[];return ki(this._image.cameraType)?i=i.concat(this._createSphericalArrows(e,t)):(i=i.concat(this._createPerspectiveToSphericalArrows(e,t)),i=i.concat(this._createStepArrows(e,t)),r=r.concat(this._createTurnArrows(e))),this._getContainer(i,r,t)}setEdges(e,t){this._setEdges(e,t),this._setNeedsRender()}setImage(e){this._image=e,this._clearEdges(),this._setNeedsRender()}setRenderCamera(e){let t=e.rotation;Math.abs(t.phi-this._rotation.phi)<this._epsilon||(this._rotation=t,this._setNeedsRender())}setConfiguration(e){let t=!1;(this._highlightKey!==e.highlightId||this._distinguishSequence!==e.distinguishSequence)&&(this._highlightKey=e.highlightId,this._distinguishSequence=e.distinguishSequence,t=!0),(this._calculator.minWidth!==e.minWidth||this._calculator.maxWidth!==e.maxWidth)&&(this._calculator.configure(e),t=!0),t&&this._setNeedsRender()}resize(e){this._calculator.resize(e),this._setNeedsRender()}_setNeedsRender(){this._image!=null&&(this._needsRender=!0)}_clearEdges(){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[]}_setEdges(e,t){this._stepEdges=[],this._turnEdges=[],this._sphericalEdges=[],this._sequenceEdgeKeys=[];for(let i of e.edges){let r=i.data.direction;if(this._stepDirections.indexOf(r)>-1){this._stepEdges.push(i);continue}if(this._turnDirections.indexOf(r)>-1){this._turnEdges.push(i);continue}i.data.direction===Ot.Spherical&&this._sphericalEdges.push(i)}if(this._distinguishSequence&&t!=null){let i=this._sphericalEdges.concat(this._stepEdges).concat(this._turnEdges);for(let r of i){let o=r.target;for(let c of t.imageIds)if(c===o){this._sequenceEdgeKeys.push(o);break}}}}_createSphericalArrows(e,t){let i=[];for(let r of this._sphericalEdges)i.push(this._createVNodeByKey(e,r.target,r.data.worldMotionAzimuth,t,this._calculator.outerRadius,"mapillary-direction-arrow-spherical"));for(let r of this._stepEdges)i.push(this._createSphericalToPerspectiveArrow(e,r.target,r.data.worldMotionAzimuth,t,r.data.direction));return i}_createSphericalToPerspectiveArrow(e,t,i,r,o){let c=Math.PI/8,s=r.phi;switch(o){case Ot.StepBackward:s=r.phi-Math.PI;break;case Ot.StepLeft:s=r.phi+Math.PI/2;break;case Ot.StepRight:s=r.phi-Math.PI/2;break}return Math.abs(this._spatial.wrapAngle(i-s))<c?this._createVNodeByKey(e,t,i,r,this._calculator.outerRadius,"mapillary-direction-arrow-step"):this._createVNodeInactive(t,i,r)}_createPerspectiveToSphericalArrows(e,t){let i=[];for(let r of this._sphericalEdges)i.push(this._createVNodeByKey(e,r.target,r.data.worldMotionAzimuth,t,this._calculator.innerRadius,"mapillary-direction-arrow-spherical",!0));return i}_createStepArrows(e,t){let i=[];for(let r of this._stepEdges)i.push(this._createVNodeByDirection(e,r.target,r.data.worldMotionAzimuth,t,r.data.direction));return i}_createTurnArrows(e){let t=[];for(let i of this._turnEdges){let r=i.data.direction,o=this._turnNames[r];t.push(this._createVNodeByTurn(e,i.target,o,r))}return t}_createVNodeByKey(e,t,i,r,o,c,s){let f=p=>{e.moveTo$(t).subscribe(void 0,g=>{g instanceof Bl||console.error(g)})};return this._createVNode(t,i,r,o,c,"mapillary-direction-circle",f,s)}_createVNodeByDirection(e,t,i,r,o){let c=s=>{e.moveDir$(o).subscribe(void 0,f=>{f instanceof Bl||console.error(f)})};return this._createVNode(t,i,r,this._calculator.outerRadius,"mapillary-direction-arrow-step","mapillary-direction-circle",c)}_createVNodeByTurn(e,t,i,r){let o=g=>{e.moveDir$(r).subscribe(void 0,_=>{_ instanceof Bl||console.error(_)})},c={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(r){case Ot.TurnLeft:c.left="5px",c.top="5px";break;case Ot.TurnRight:c.right="5px",c.top="5px";break;case Ot.TurnU:c.left="5px",c.bottom="5px";break}let s={attributes:{"data-id":t},onclick:o,style:c},f="mapillary-direction-turn-circle";this._sequenceEdgeKeys.indexOf(t)>-1&&(f+="-sequence"),this._highlightKey===t&&(f+="-highlight");let p=jt.h(`div.${i}`,{},[]);return jt.h("div."+f,s,[p])}_createVNodeInactive(e,t,i){return this._createVNode(e,t,i,this._calculator.outerRadius,"mapillary-direction-arrow-inactive","mapillary-direction-circle-inactive")}_createVNode(e,t,i,r,o,c,s,f){let p=this._calculator.angleToCoordinates(t-i.phi),g=Math.round(-r*p[1]+.5*this._calculator.containerWidth),_=Math.round(-r*p[0]+.5*this._calculator.containerHeight),x=this._calculator.relativeAngleToCoordiantes(t,i.phi),b=this._calculator.shadowOffset,M=-b*x[1],P=b*x[0],k=`drop-shadow(${M}px ${P}px 1px rgba(0,0,0,0.8))`,L={style:{"-webkit-filter":k,filter:k}},I=jt.h("div."+o,L,[]),F=-this._spatial.radToDeg(t-i.phi),N=f?`translate(${g}px, ${_}px) rotate(${F}deg) translateZ(-0.01px)`:`translate(${g}px, ${_}px) rotate(${F}deg)`,H={attributes:{"data-id":e},onclick:s,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:N,width:this._calculator.stepCircleSizeCss}};return this._sequenceEdgeKeys.indexOf(e)>-1&&(c+="-sequence"),this._highlightKey===e&&(c+="-highlight"),jt.h("div."+c,H,[I])}_getContainer(e,t,i){let r=this._isEdge?"rotateX(60deg)":`perspective(${this._calculator.containerWidthCss}) rotateX(60deg)`,o={oncontextmenu:c=>{c.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:r,width:this._calculator.containerWidthCss}};return jt.h("div.mapillary-direction-perspective",o,t.concat(e))}}class UO extends bo{constructor(e,t,i,r){super(e,t,i),this._renderer=r||new ZQ(this.defaultConfiguration,{height:t.container.offsetHeight,width:t.container.offsetWidth}),this._hoveredIdSubject$=new ri,this._hoveredId$=this._hoveredIdSubject$.pipe(dn())}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}_activate(){const e=this._subscriptions;e.push(this._configuration$.subscribe(t=>{this._renderer.setConfiguration(t)})),e.push(this._container.renderService.size$.subscribe(t=>{this._renderer.resize(t)})),e.push(this._navigator.stateService.currentImage$.pipe(Dr(t=>{this._container.domRenderer.render$.next({name:this._name,vNode:jt.h("div",{},[])}),this._renderer.setImage(t)}),Ui(this._configuration$),ei(([t,i])=>Si(t.spatialEdges$,i.distinguishSequence?this._navigator.graphService.cacheSequence$(t.sequenceId).pipe(Nn(r=>(console.error(`Failed to cache sequence (${t.sequenceId})`,r),Ai(null)))):Ai(null)))).subscribe(([t,i])=>{this._renderer.setEdges(t,i)})),e.push(this._container.renderService.renderCameraFrame$.pipe(Dr(t=>{this._renderer.setRenderCamera(t)}),We(()=>this._renderer),oi(t=>t.needsRender),We(t=>({name:this._name,vNode:t.render(this._navigator)}))).subscribe(this._container.domRenderer.render$)),e.push(Si(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(An(null)),this._container.mouseService.mouseUp$.pipe(An(null))).pipe(We(([t])=>{let i=t.getElementsByClassName("mapillary-direction-perspective");for(let r=0;r<i.length;r++){let o=i.item(r).querySelector(":hover");if(o!=null&&o.hasAttribute("data-id"))return o.getAttribute("data-id")}return null}),yi()).subscribe(this._hoveredIdSubject$)),e.push(this._hoveredId$.subscribe(t=>{const i="hover",r={id:t,target:this,type:i};this.fire(i,r)}))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{distinguishSequence:!1,maxWidth:460,minWidth:260}}}UO.componentName="direction";const XQ=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

#define tau 6.28318530718

uniform sampler2D projectorTex;
uniform float opacity;

varying vec4 vRstq;

void main()
{
    vec3 b = normalize(vRstq.xyz);
    float lat = -asin(b.y);
    float lng = atan(b.x, b.z);
    float x = lng / tau + 0.5;
    float y = lat / tau * 2.0 + 0.5;
    vec4 baseColor = texture2D(projectorTex, vec2(x, y));
    baseColor.a = opacity;
    gl_FragColor = baseColor;
}
`,YQ=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,KQ=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

#define tau 6.28318530718

uniform sampler2D projectorTex;
uniform float curtain;
uniform float opacity;

varying vec4 vRstq;

void main()
{
    vec3 b = normalize(vRstq.xyz);
    float lat = -asin(b.y);
    float lng = atan(b.x, b.z);
    float x = lng / tau + 0.5;
    float y = lat / tau * 2.0 + 0.5;

    bool inverted = curtain < 0.5;

    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;
    float curtainMax = curtain;

    bool insideCurtain = inverted ?
        x > curtainMin || x < curtainMax :
        x > curtainMin && x < curtainMax;

    vec4 baseColor;
    if (insideCurtain) {
        baseColor = texture2D(projectorTex, vec2(x, y));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,JQ=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,QQ=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float focal;
uniform float k1;
uniform float k2;
uniform float scale_x;
uniform float scale_y;
uniform float radial_peak;

varying vec4 vRstq;

void main()
{
    float x = vRstq.x;
    float y = vRstq.y;
    float z = vRstq.z;

    float r = sqrt(x * x + y * y);
    float theta = atan(r, z);

    if (radial_peak > 0. && theta > radial_peak) {
        theta = radial_peak;
    }

    float theta2 = theta * theta;
    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));
    float s = focal * theta_d / r;

    float u = scale_x * s * x + 0.5;
    float v = -scale_y * s * y + 0.5;

    vec4 baseColor;
    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,eee=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,tee=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float focal;
uniform float k1;
uniform float k2;
uniform float scale_x;
uniform float scale_y;
uniform float radial_peak;
uniform float curtain;

varying vec4 vRstq;

void main()
{
    float x = vRstq.x;
    float y = vRstq.y;
    float z = vRstq.z;

    float r2 = sqrt(x * x + y * y);
    float theta = atan(r2, z);

    if (radial_peak > 0. && theta > radial_peak) {
        theta = radial_peak;
    }

    float theta2 = theta * theta;
    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));
    float s = focal * theta_d / r2;

    float u = scale_x * s * x + 0.5;
    float v = -scale_y * s * y + 0.5;

    vec4 baseColor;
    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,iee=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,nee=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float focal;
uniform float k1;
uniform float k2;
uniform float scale_x;
uniform float scale_y;
uniform float radial_peak;

varying vec4 vRstq;

void main()
{
    float x = vRstq.x / vRstq.z;
    float y = vRstq.y / vRstq.z;
    float r2 = x * x + y * y;

    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {
        r2 = radial_peak * radial_peak;
    }

    float d = 1.0 + k1 * r2 + k2 * r2 * r2;
    float u = scale_x * focal * d * x + 0.5;
    float v = - scale_y * focal * d * y + 0.5;

    vec4 baseColor;
    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,ree=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,see=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float focal;
uniform float k1;
uniform float k2;
uniform float scale_x;
uniform float scale_y;
uniform float radial_peak;
uniform float curtain;

varying vec4 vRstq;

void main()
{
    float x = vRstq.x / vRstq.z;
    float y = vRstq.y / vRstq.z;
    float r2 = x * x + y * y;

    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {
        r2 = radial_peak * radial_peak;
    }

    float d = 1.0 + k1 * r2 + k2 * r2 * r2;
    float u = scale_x * focal * d * x + 0.5;
    float v = - scale_y * focal * d * y + 0.5;

    vec4 baseColor;
    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,oee=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,aee=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;

varying vec4 vRstq;

void main()
{
    float u = vRstq.x / vRstq.w;
    float v = vRstq.y / vRstq.w;

    vec4 baseColor;
    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,lee=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,cee=`
#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D projectorTex;
uniform float opacity;
uniform float curtain;

varying vec4 vRstq;

void main()
{
    float u = vRstq.x / vRstq.w;
    float v = vRstq.y / vRstq.w;

    vec4 baseColor;
    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {
        baseColor = texture2D(projectorTex, vec2(u, v));
        baseColor.a = opacity;
    } else {
        baseColor = vec4(0.0, 0.0, 0.0, 0.0);
    }

    gl_FragColor = baseColor;
}
`,uee=`
#ifdef GL_ES
precision highp float;
#endif

uniform mat4 projectorMat;

varying vec4 vRstq;

void main()
{
    vRstq = projectorMat * vec4(position, 1.0);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`;class Kr{}Kr.fisheye={fragment:QQ,vertex:eee};Kr.fisheyeCurtain={fragment:tee,vertex:iee};Kr.perspective={fragment:nee,vertex:ree};Kr.perspectiveCurtain={fragment:see,vertex:oee};Kr.perspectiveDistorted={fragment:aee,vertex:lee};Kr.perspectiveDistortedCurtain={fragment:cee,vertex:uee};Kr.spherical={fragment:XQ,vertex:YQ};Kr.sphericalCurtain={fragment:KQ,vertex:JQ};class jO{constructor(e,t){this._imagePlaneDepth=e??200,this._imageSphereRadius=t??200}createMesh(e,t){return ki(t.cameraType)?this._createImageSphere(e,t):ow(t.cameraType)?this._createImagePlaneFisheye(e,t):this._createImagePlane(e,t)}createFlatMesh(e,t,i,r,o,c){let s=this._createTexture(e.image),f=this._createDistortedPlaneMaterialParameters(t,s),p=new Jo(f),g=this._getFlatImagePlaneGeoFromBasic(t,i,r,o,c);return new kr(g,p)}createCurtainMesh(e,t){return ki(t.cameraType)?this._createSphereCurtainMesh(e,t):ow(t.cameraType)?this._createCurtainMeshFisheye(e,t):this._createCurtainMesh(e,t)}createDistortedCurtainMesh(e,t){return this._createDistortedCurtainMesh(e,t)}_createCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createCurtainPlaneMaterialParameters(t,i),o=new Jo(r),c=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new kr(c,o)}_createCurtainMeshFisheye(e,t){let i=this._createTexture(e.image),r=this._createCurtainPlaneMaterialParametersFisheye(t,i),o=new Jo(r),c=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeo(t);return new kr(c,o)}_createDistortedCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createDistortedCurtainPlaneMaterialParameters(t,i),o=new Jo(r),c=this._getRegularFlatImagePlaneGeo(t);return new kr(c,o)}_createSphereCurtainMesh(e,t){let i=this._createTexture(e.image),r=this._createCurtainSphereMaterialParameters(t,i),o=new Jo(r);return this._useMesh(t,e)?new kr(this._getImageSphereGeo(t,e),o):new kr(this._getFlatImageSphereGeo(t),o)}_createImageSphere(e,t){let i=this._createTexture(e.image),r=this._createSphereMaterialParameters(t,i),o=new Jo(r);return this._useMesh(t,e)?new kr(this._getImageSphereGeo(t,e),o):new kr(this._getFlatImageSphereGeo(t),o)}_createImagePlane(e,t){let i=this._createTexture(e.image),r=this._createPlaneMaterialParameters(t,i),o=new Jo(r),c=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new kr(c,o)}_createImagePlaneFisheye(e,t){let i=this._createTexture(e.image),r=this._createPlaneMaterialParametersFisheye(t,i),o=new Jo(r),c=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeoFisheye(t);return new kr(c,o)}_createSphereMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.spherical.fragment,side:Ko,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:Kr.spherical.vertex}}_createCurtainSphereMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.sphericalCurtain.fragment,side:Ko,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.rt},projectorTex:{value:t}},vertexShader:Kr.sphericalCurtain.vertex}}_createPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.perspective.fragment,side:Ko,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Kr.perspective.vertex}}_createPlaneMaterialParametersFisheye(e,t){return{depthWrite:!1,fragmentShader:Kr.fisheye.fragment,side:Ko,transparent:!0,uniforms:{focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Kr.fisheye.vertex}}_createCurtainPlaneMaterialParametersFisheye(e,t){return{depthWrite:!1,fragmentShader:Kr.fisheyeCurtain.fragment,side:Ko,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Kr.fisheyeCurtain.vertex}}_createCurtainPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.perspectiveCurtain.fragment,side:Ko,transparent:!0,uniforms:{curtain:{value:1},focal:{value:e.focal},k1:{value:e.ck1},k2:{value:e.ck2},opacity:{value:1},projectorMat:{value:e.basicRt},projectorTex:{value:t},radial_peak:{value:e.radialPeak?e.radialPeak:0},scale_x:{value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:Kr.perspectiveCurtain.vertex}}_createDistortedCurtainPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.perspectiveDistortedCurtain.fragment,side:Ko,transparent:!0,uniforms:{curtain:{value:1},opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:Kr.perspectiveDistortedCurtain.vertex}}_createDistortedPlaneMaterialParameters(e,t){return{depthWrite:!1,fragmentShader:Kr.perspectiveDistorted.fragment,side:Ko,transparent:!0,uniforms:{opacity:{value:1},projectorMat:{value:e.projectorMatrix()},projectorTex:{value:t}},vertexShader:Kr.perspectiveDistorted.vertex}}_createTexture(e){let t=new zs(e);return t.minFilter=Ro,t.needsUpdate=!0,t}_useMesh(e,t){return t.mesh.vertices.length&&e.hasValidScale}_getImageSphereGeo(e,t){const i=e.srtInverse;let r=5*e.scale,o=this._imageSphereRadius*e.scale,c=t.mesh.vertices,s=c.length/3,f=new Float32Array(c.length);for(let x=0;x<s;++x){let b=3*x,M=c[b+0],P=c[b+1],k=c[b+2],L=Math.sqrt(M*M+P*P+k*k),F=Math.max(r,Math.min(L,o))/L,N=new Fe(M*F,P*F,k*F);N.applyMatrix4(i),f[b+0]=N.x,f[b+1]=N.y,f[b+2]=N.z}let p=t.mesh.faces,g=new Uint16Array(p.length);for(let x=0;x<p.length;++x)g[x]=p[x];let _=new $n;return _.setAttribute("position",new Mn(f,3)),_.setIndex(new Mn(g,1)),_}_getImagePlaneGeo(e,t){const r=e.srtInverse;let o=5*e.scale,c=this._imagePlaneDepth*e.scale,s=t.mesh.vertices,f=s.length/3,p=new Float32Array(s.length);for(let b=0;b<f;++b){let M=3*b,P=s[M+0],k=s[M+1],L=s[M+2];b<4&&(P*=3,k*=3);let I=Math.max(o,Math.min(L,c)),F=I/L,N=new Fe(P*F,k*F,I);N.applyMatrix4(r),p[M+0]=N.x,p[M+1]=N.y,p[M+2]=N.z}let g=t.mesh.faces,_=new Uint16Array(g.length);for(let b=0;b<g.length;++b)_[b]=g[b];let x=new $n;return x.setAttribute("position",new Mn(p,3)),x.setIndex(new Mn(_,1)),x}_getImagePlaneGeoFisheye(e,t){const i=e.srtInverse;let r=5*e.scale,o=this._imagePlaneDepth*e.scale,c=t.mesh.vertices,s=c.length/3,f=new Float32Array(c.length);for(let x=0;x<s;++x){let b=3*x,M=c[b+0],P=c[b+1],k=c[b+2],L=Math.sqrt(M*M+P*P+k*k),F=Math.max(r,Math.min(L,o))/L,N=new Fe(M*F,P*F,k*F);N.applyMatrix4(i),f[b+0]=N.x,f[b+1]=N.y,f[b+2]=N.z}let p=t.mesh.faces,g=new Uint16Array(p.length);for(let x=0;x<p.length;++x)g[x]=p[x];let _=new $n;return _.setAttribute("position",new Mn(f,3)),_.setIndex(new Mn(g,1)),_}_getFlatImageSphereGeo(e){const t=new W2(this._imageSphereRadius,20,40),i=e.rt.clone().invert();return t.applyMatrix4(i),t}_getRegularFlatImagePlaneGeo(e){let t=e.width,i=e.height,r=Math.max(t,i),o=t/2/r,c=i/2/r;return this._getFlatImagePlaneGeo(e,o,c)}_getFlatImagePlaneGeo(e,t,i){let r=[];return r.push(e.unprojectSfM([-t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,i],this._imagePlaneDepth)),r.push(e.unprojectSfM([-t,i],this._imagePlaneDepth)),this._createFlatGeometry(r)}_getRegularFlatImagePlaneGeoFisheye(e){let t=e.width,i=e.height,r=Math.max(t,i),o=t/2/r,c=i/2/r;return this._getFlatImagePlaneGeoFisheye(e,o,c)}_getFlatImagePlaneGeoFisheye(e,t,i){let r=[];return r.push(e.unprojectSfM([-t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,-i],this._imagePlaneDepth)),r.push(e.unprojectSfM([t,i],this._imagePlaneDepth)),r.push(e.unprojectSfM([-t,i],this._imagePlaneDepth)),this._createFlatGeometry(r)}_getFlatImagePlaneGeoFromBasic(e,t,i,r,o){let c=[];return c.push(e.unprojectBasic([t,r],this._imagePlaneDepth)),c.push(e.unprojectBasic([i,r],this._imagePlaneDepth)),c.push(e.unprojectBasic([i,o],this._imagePlaneDepth)),c.push(e.unprojectBasic([t,o],this._imagePlaneDepth)),this._createFlatGeometry(c)}_createFlatGeometry(e){let t=new Float32Array(12);for(let o=0;o<e.length;o++){let c=3*o;t[c+0]=e[o][0],t[c+1]=e[o][1],t[c+2]=e[o][2]}let i=new Uint16Array(6);i[0]=0,i[1]=1,i[2]=3,i[3]=1,i[4]=2,i[5]=3;let r=new $n;return r.setAttribute("position",new Mn(t,3)),r.setIndex(new Mn(i,1)),r}}class GO{constructor(){this._planes={},this._planesOld={},this._planesPeriphery={},this._scene=new _h,this._sceneOld=new _h,this._scenePeriphery=new _h}get planes(){return this._planes}get planesOld(){return this._planesOld}get planesPeriphery(){return this._planesPeriphery}get scene(){return this._scene}get sceneOld(){return this._sceneOld}get scenePeriphery(){return this._scenePeriphery}updateImagePlanes(e){this._dispose(this._planesOld,this.sceneOld);for(const t in this._planes){if(!this._planes.hasOwnProperty(t))continue;const i=this._planes[t];this._scene.remove(i),this._sceneOld.add(i)}for(const t in e)e.hasOwnProperty(t)&&this._scene.add(e[t]);this._planesOld=this._planes,this._planes=e}addImagePlanes(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._scene.add(i),this._planes[t]=i}}addImagePlanesOld(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._sceneOld.add(i),this._planesOld[t]=i}}setImagePlanes(e){this._clear(),this.addImagePlanes(e)}addPeripheryPlanes(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];this._scenePeriphery.add(i),this._planesPeriphery[t]=i}}setPeripheryPlanes(e){this._clearPeriphery(),this.addPeripheryPlanes(e)}setImagePlanesOld(e){this._clearOld(),this.addImagePlanesOld(e)}clear(){this._clear(),this._clearOld()}_clear(){this._dispose(this._planes,this._scene),this._planes={}}_clearOld(){this._dispose(this._planesOld,this._sceneOld),this._planesOld={}}_clearPeriphery(){this._dispose(this._planesPeriphery,this._scenePeriphery),this._planesPeriphery={}}_dispose(e,t){for(const i in e){if(!e.hasOwnProperty(i))continue;const r=e[i];t.remove(r),r.geometry.dispose(),r.material.dispose();let o=r.material.uniforms.projectorTex.value;o?.dispose()}}}class hee{constructor(){this._factory=new jO,this._scene=new GO,this._alpha=0,this._alphaOld=0,this._fadeOutSpeed=.05,this._currentKey=null,this._previousKey=null,this._providerDisposers={},this._frameId=0,this._needsRender=!1}get frameId(){return this._frameId}get needsRender(){return this._needsRender}indicateNeedsRender(){this._needsRender=!0}addPeripheryPlane(e,t){const i=this._factory.createMesh(e,t),r={};r[e.id]=i,this._scene.addPeripheryPlanes(r),this._needsRender=!0}clearPeripheryPlanes(){this._scene.setPeripheryPlanes({}),this._needsRender=!0}updateFrame(e){this._updateFrameId(e.id),this._needsRender=this._updateAlpha(e.state.alpha)||this._needsRender,this._needsRender=this._updateAlphaOld(e.state.alpha)||this._needsRender,this._needsRender=this._updateImagePlanes(e.state)||this._needsRender}setTextureProvider(e,t){if(e!==this._currentKey)return;let i=t.textureCreated$.subscribe(c=>{this._updateTexture(c)}),r=t.textureUpdated$.subscribe(c=>{this._needsRender=!0}),o=()=>{i.unsubscribe(),r.unsubscribe(),t.dispose()};if(e in this._providerDisposers){let c=this._providerDisposers[e];c(),delete this._providerDisposers[e]}this._providerDisposers[e]=o}updateTextureImage(e,t){this._needsRender=!0;const i=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(const r in i){if(!i.hasOwnProperty(r)||r!==t.id)continue;let s=i[r].material.uniforms.projectorTex.value;s.image=e,s.needsUpdate=!0}}render(e,t){const i=this._scene.planes,r=this._scene.planesOld,o=this._scene.planesPeriphery,c=Object.keys(r).length?1:this._alpha,s=Object.keys(r).length?1:Math.floor(this._alpha);for(const f in i){if(!i.hasOwnProperty(f))continue;const p=i[f];p.material.uniforms.opacity.value=c}for(const f in r){if(!r.hasOwnProperty(f))continue;const p=r[f];p.material.uniforms.opacity.value=this._alphaOld}for(const f in o){if(!o.hasOwnProperty(f))continue;const p=o[f];p.material.uniforms.opacity.value=s}t.render(this._scene.scenePeriphery,e),t.render(this._scene.scene,e),t.render(this._scene.sceneOld,e);for(const f in i){if(!i.hasOwnProperty(f))continue;const p=i[f];p.material.uniforms.opacity.value=this._alpha}t.render(this._scene.scene,e)}clearNeedsRender(){this._needsRender=!1}dispose(){this._scene.clear()}_updateFrameId(e){this._frameId=e}_updateAlpha(e){return e===this._alpha?!1:(this._alpha=e,!0)}_updateAlphaOld(e){return e<1||this._alphaOld===0?!1:(this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed),!0)}_updateImagePlanes(e){if(e.currentImage==null||e.currentImage.id===this._currentKey)return!1;let t=e.previousImage!=null?e.previousImage.id:null,i=e.currentImage.id;if(this._previousKey!==t&&this._previousKey!==i&&this._previousKey in this._providerDisposers){let c=this._providerDisposers[this._previousKey];c(),delete this._providerDisposers[this._previousKey]}if(t!=null){if(t!==this._currentKey&&t!==this._previousKey){let c=this._factory.createMesh(e.previousImage,e.previousTransform);const s={};s[t]=c,this._scene.updateImagePlanes(s)}this._previousKey=t}this._currentKey=i;let r=this._factory.createMesh(e.currentImage,e.currentTransform);const o={};return o[i]=r,this._scene.updateImagePlanes(o),this._alphaOld=1,!0}_updateTexture(e){this._needsRender=!0;const t=this._scene.planes;for(const i in t){if(!t.hasOwnProperty(i))continue;let o=t[i].material,c=o.uniforms.projectorTex.value;o.uniforms.projectorTex.value=null,c.dispose(),o.uniforms.projectorTex.value=e}}_extend(e,...t){for(const i of t)for(const r in i)i.hasOwnProperty(r)&&(e[r]=i[r]);return e}}var Ph;(function(n){n[n.Background=0]="Background",n[n.Opaque=1]="Opaque"})(Ph||(Ph={}));class qO{constructor(e){this._api=e,this._urls$=new Map}getImage$(e){let t;const i=new Promise((r,o)=>{t=o});return[gr.create(r=>{this._api.data.getImageBuffer(e,i).then(o=>{t=null;const c=new Image;c.crossOrigin="Anonymous",c.onload=()=>{window.URL.revokeObjectURL(c.src),r.next(c),r.complete()},c.onerror=()=>{t=null,window.URL.revokeObjectURL(c.src),r.error(new Error("Failed to load image tile"))};const s=new Blob([o]);c.src=window.URL.createObjectURL(s)},o=>{t=null,r.error(o)})}),()=>{t&&t()}]}getURLs$(e,t){const i=this._inventId(e,t);if(this._urls$.has(i))return this._urls$.get(i);const r={imageId:e,z:t},o=this._api.getImageTiles$(r).pipe(We(c=>c.node),ma(()=>{this._urls$.delete(i)}),Ya(),gi());return this._urls$.set(i,o),o}_inventId(e,t){return`${e}-${t}`}}class MM{constructor(){this._tiles=new Map,this._urlLevels=new Set,this._urls=new Map}add(e,t){if(this._tiles.has(e))throw new Error(`Image tile already stored (${e})`);this._tiles.set(e,t)}addURLs(e,t){const i=this._urls;for(const r of t){const o=this.inventId(r);if(this._urls.has(o))throw new Error(`URL already stored (${o})`);i.set(o,r.url)}this._urlLevels.add(e)}dispose(){this._tiles.forEach(e=>window.URL.revokeObjectURL(e.src)),this._tiles.clear(),this._urls.clear(),this._urlLevels.clear()}get(e){return this._tiles.get(e)}getURL(e){return this._urls.get(e)}has(e){return this._tiles.has(e)}hasURL(e){return this._urls.has(e)}hasURLLevel(e){return this._urlLevels.has(e)}inventId(e){return`${e.z}-${e.x}-${e.y}`}}class HO{constructor(){this._viewportCoords=new zo}computeRegionOfInterest(e,t,i){const r=this._viewportBoundaryPoints(4),o=this._viewportPointsBoundingBox(r,e,i);this._clipBoundingBox(o);const c=2/t.width,s=2/t.height,f=[[-.5*c,.5*s],[.5*c,.5*s],[.5*c,-.5*s],[-.5*c,-.5*s]],p=this._viewportPointsBoundingBox(f,e,i),g=p.minX<p.maxX;return{bbox:o,pixelHeight:p.maxY-p.minY,pixelWidth:p.maxX-p.minX+(g?0:1)}}_viewportBoundaryPoints(e){const t=[],i=[[-1,1],[1,1],[1,-1],[-1,-1]],r=[[2,0],[0,-2],[-2,0],[0,2]];for(let o=0;o<4;++o){const c=i[o],s=r[o];for(let f=0;f<e;++f)t.push([c[0]+s[0]*f/e,c[1]+s[1]*f/e])}return t}_viewportPointsBoundingBox(e,t,i){const r=e.map(o=>this._viewportCoords.viewportToBasic(o[0],o[1],i,t.perspective));return ki(i.cameraType)?this._boundingBoxSpherical(r):this._boundingBox(r)}_boundingBox(e){const t={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY};for(let i=0;i<e.length;++i)t.minX=Math.min(t.minX,e[i][0]),t.maxX=Math.max(t.maxX,e[i][0]),t.minY=Math.min(t.minY,e[i][1]),t.maxY=Math.max(t.maxY,e[i][1]);return t}_boundingBoxSpherical(e){const t=[],i=[];for(let o=0;o<e.length;++o)t.push(e[o][0]),i.push(e[o][1]);t.sort((o,c)=>this._sign(o-c)),i.sort((o,c)=>this._sign(o-c));const r=this._intervalSpherical(t);return{maxX:r[1],maxY:i[i.length-1],minX:r[0],minY:i[0]}}_intervalSpherical(e){let t=0,i=-1;for(let o=0;o<e.length-1;++o){const c=e[o+1]-e[o];c>t&&(t=c,i=o)}return e[0]+1-e[e.length-1]>t?[e[0],e[e.length-1]]:[e[i+1],e[i]]}_clipBoundingBox(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}_sign(e){return e>0?1:e<0?-1:0}}const dee=11,WO=1024;function Y3(n,e,t){return Math.max(e,Math.min(t,n))}function ZO(n){return WO/cC(n)}function cC(n){return Math.pow(2,n.z-n.max)}function fee(n){const e=Math.max(n.w,n.h);return Math.log(e)/Math.log(2)}function XO(n){return Math.ceil(fee(n))}function pee(n,e,t){return Math.max(e,Math.min(t,XO(n)))}function K3(n,e,t){const i=ZO(t),r=e.w,o=e.h,c=Math.ceil(r/i)-1,s=Math.ceil(o/i)-1,f=Y3(Math.floor(r*n[0]/i),0,c),p=Y3(Math.floor(o*n[1]/i),0,s);return{x:f,y:p}}function _T(n,e,t){const r=1/cC(t)*WO,o=r*n.x,c=r*n.y,s=Math.min(r,e.w-o);return{h:Math.min(r,e.h-c),x:o,y:c,w:s}}function J3(n,e,t){return t*n<=e&&e<t*(n+1)}function mee(n,e){if(n.z===e.z)return n.x===e.x&&n.y===e.y;const t=n.z<e.z?n:e,i=n.z<e.z?e:n,r=1/cC({max:i.z,z:t.z}),o=J3(t.x,i.x,r),c=J3(t.y,i.y,r);return o&&c}function gee(n,e,t,i){const r=[];if(n.x>e.x){const c=ZO(i),s=Math.ceil(t.w/c)-1;for(let f=n.x;f<=s;f++)r.push(f);for(let f=0;f<=e.x;f++)r.push(f)}else for(let c=n.x;c<=e.x;c++)r.push(c);const o=[];for(const c of r)for(let s=n.y;s<=e.y;s++)o.push({x:c,y:s});return o}function Q3(n){return n.w>0&&n.h>0}class CM{constructor(e,t,i,r,o,c,s){const f={h:i,w:t};Q3(f)||console.warn(`Original image size (${t}, ${i}) is invalid (${e}). Tiles will not be loaded.`),this._imageId=e,this._size=f,this._level={max:XO(this._size),z:-1},this._holder=new yo,this._updated$=new ri,this._createdSubject$=new ri,this._created$=this._createdSubject$.pipe(Pi(1),gi()),this._holder.push(this._created$.subscribe(()=>{})),this._hasSubject$=new ri,this._has$=this._hasSubject$.pipe(An(!1),Pi(1),gi()),this._holder.push(this._has$.subscribe(()=>{})),this._renderedLevel=new Set,this._rendered=new Map,this._subscriptions=new Map,this._urlSubscriptions=new Map,this._loader=o,this._store=c,this._background=r,this._renderer=s,this._aborts=[],this._render=null,this._disposed=!1}get disposed(){return this._disposed}get hasTexture$(){return this._has$}get id(){return this._imageId}get textureUpdated$(){return this._updated$}get textureCreated$(){return this._created$}abort(){this._subscriptions.forEach(e=>e.unsubscribe()),this._subscriptions.clear();for(const e of this._aborts)e();this._aborts=[]}dispose(){if(this._disposed){console.warn(`Texture already disposed (${this._imageId})`);return}this._urlSubscriptions.forEach(e=>e.unsubscribe()),this._urlSubscriptions.clear(),this.abort(),this._render!=null&&(this._render.target.dispose(),this._render.target=null,this._render.camera=null,this._render=null),this._store.dispose(),this._holder.unsubscribe(),this._renderedLevel.clear(),this._background=null,this._renderer=null,this._disposed=!0}setRegionOfInterest(e){if(!Q3(this._size))return;const t=1/e.pixelWidth,i=1/e.pixelHeight,r=pee({h:i,w:t},dee,this._level.max);r!==this._level.z&&(this.abort(),this._level.z=r,this._renderedLevel.clear(),this._rendered.forEach((f,p)=>{f.z===r&&this._renderedLevel.add(p)})),this._render==null&&this._initRender();const o=K3([e.bbox.minX,e.bbox.minY],this._size,this._level),c=K3([e.bbox.maxX,e.bbox.maxY],this._size,this._level),s=gee(o,c,this._size,this._level);this._fetchTiles(r,s)}_fetchTile(e){const t=this._loader.getImage$(e.url),i=t[0],r=t[1];this._aborts.push(r);const o=this._store.inventId(e),c=i.subscribe(s=>{const f=_T(e,this._size,this._level);this._renderToTarget(f,s),this._subscriptions.delete(o),this._removeFromArray(r,this._aborts),this._markRendered(e),this._store.add(o,s),this._updated$.next(!0)},s=>{this._subscriptions.delete(o),this._removeFromArray(r,this._aborts),console.error(s)});c.closed||this._subscriptions.set(o,c)}_fetchTiles(e,t){const r=(this._store.hasURLLevel(e)?Ai(void 0):this._loader.getURLs$(this._imageId,e).pipe(Dr(o=>{this._store.hasURLLevel(e)||this._store.addURLs(e,o)}))).subscribe(()=>{if(e===this._level.z){for(const o of t){const c={x:o.x,y:o.y,z:e,url:null},s=this._store.inventId(c);if(!(this._renderedLevel.has(s)||this._subscriptions.has(s))){if(this._store.has(s)){const f=_T(o,this._size,this._level);this._renderToTarget(f,this._store.get(s)),this._markRendered(c),this._updated$.next(!0);continue}c.url=this._store.getURL(s),this._fetchTile(c)}}this._urlSubscriptions.delete(e)}},o=>{this._urlSubscriptions.delete(e),console.error(o)});r.closed||this._urlSubscriptions.set(e,r)}_initRender(){const e=this._size.w/2,t=this._size.h/2,i=-1,r=1,o=new $w(-e,e,t,-t,i,r);o.position.z=1;const c=this._renderer.getContext(),s=c.getParameter(c.MAX_TEXTURE_SIZE),f=Math.max(this._size.w,this._size.h),p=s>f?1:s/f,g=Math.floor(p*this._size.w),_=Math.floor(p*this._size.h),x=new xc(g,_,{depthBuffer:!1,format:np,magFilter:Ro,minFilter:Ro,stencilBuffer:!1});this._render={camera:o,target:x};const b=_T({x:0,y:0},this._size,{max:this._level.max,z:0});this._renderToTarget(b,this._background),this._createdSubject$.next(x.texture),this._hasSubject$.next(!0)}_markRendered(e){const t=Array.from(this._rendered.entries()).filter(([r,o])=>o.z!==e.z);for(const[r,o]of t)mee(e,o)&&this._rendered.delete(r);const i=this._store.inventId(e);this._rendered.set(i,e),this._renderedLevel.add(i)}_removeFromArray(e,t){const i=t.indexOf(e);i!==-1&&t.splice(i,1)}_renderToTarget(e,t){const i=new zs(t);i.minFilter=Ro,i.needsUpdate=!0;const r=new Nw(e.w,e.h),o=new e0({map:i,side:zg}),c=new kr(r,o);c.position.x=-this._size.w/2+e.x+e.w/2,c.position.y=this._size.h/2-e.y-e.h/2;const s=new _h;s.add(c);const f=this._renderer.getRenderTarget();this._renderer.resetState(),this._renderer.setRenderTarget(this._render.target),this._renderer.render(s,this._render.camera),this._renderer.setRenderTarget(f),s.remove(c),r.dispose(),o.dispose(),i.dispose()}}var Oi;(function(n){n[n.Custom=0]="Custom",n[n.Earth=1]="Earth",n[n.Traversing=2]="Traversing",n[n.Waiting=3]="Waiting",n[n.WaitingInteractively=4]="WaitingInteractively"})(Oi||(Oi={}));class YO extends bo{constructor(e,t,i){super(e,t,i),this._imageTileLoader=new qO(i.api),this._roiCalculator=new HO,this._rendererOperation$=new ri,this._rendererCreator$=new ri,this._rendererDisposer$=new ri,this._renderer$=this._rendererOperation$.pipe(Vr((r,o)=>o(r),null),oi(r=>r!=null),yi(void 0,r=>r.frameId)),this._rendererCreator$.pipe(We(()=>r=>{if(r!=null)throw new Error("Multiple image plane states can not be created at the same time");return new hee})).subscribe(this._rendererOperation$),this._rendererDisposer$.pipe(We(()=>r=>(r.dispose(),null))).subscribe(this._rendererOperation$)}_activate(){const e=this._subscriptions;e.push(this._renderer$.pipe(We(f=>{const p={name:this._name,renderer:{frameId:f.frameId,needsRender:f.needsRender,render:f.render.bind(f),pass:Ph.Background}};return f.clearNeedsRender(),p})).subscribe(this._container.glRenderer.render$)),this._rendererCreator$.next(null),e.push(this._navigator.stateService.currentState$.pipe(We(f=>p=>(p.updateFrame(f),p))).subscribe(this._rendererOperation$));const t=this._container.configurationService.imageTiling$.pipe(ei(f=>f?this._navigator.stateService.currentState$:new ri),yi(void 0,f=>f.state.currentImage.id),Ui(this._container.glRenderer.webGLRenderer$),We(([f,p])=>{const g=f.state,_=g.currentImage,x=g.currentTransform;return new CM(_.id,x.basicWidth,x.basicHeight,_.image,this._imageTileLoader,new MM,p)}),Pi(1),gi());e.push(t.subscribe(()=>{})),e.push(t.pipe(We(f=>p=>(p.setTextureProvider(f.id,f),p))).subscribe(this._rendererOperation$)),e.push(t.pipe(tl()).subscribe(f=>{f[0].abort()}));const i=this._container.configurationService.imageTiling$.pipe(ei(f=>f?Si(this._navigator.stateService.state$,this._navigator.stateService.inTranslation$):new ri),ei(([f,p])=>(f===Oi.Traversing||f===Oi.Waiting||f===Oi.WaitingInteractively)&&!p?this._container.renderService.renderCameraFrame$:zi()),We(f=>({camera:f,height:f.size.height.valueOf(),lookat:f.camera.lookat.clone(),width:f.size.width.valueOf(),zoom:f.zoom.valueOf()})),tl(),We(([f,p])=>{const g=f.width===p.width&&f.height===p.height&&f.zoom===p.zoom&&f.lookat.equals(p.lookat);return{camera:p.camera,stalled:g}}),yi((f,p)=>f.stalled===p.stalled),oi(f=>f.stalled),Ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(t.pipe(ei(f=>i.pipe(We(([p,g,_])=>{const x=p.camera,b=new zo().viewportToBasic(0,0,_,x.perspective);if(!(b[0]<0||b[1]<0||b[0]>1||b[1]>1))return[this._roiCalculator.computeRegionOfInterest(x,g,_),f]}),oi(p=>!!p))),oi(f=>!f[1].disposed)).subscribe(([f,p])=>{p.setRegionOfInterest(f)}));const r=t.pipe(ei(f=>f.hasTexture$),An(!1),Pi(1),gi());e.push(r.subscribe(()=>{})),e.push(this._navigator.panService.panImages$.pipe(oi(f=>f.length===0),We(()=>f=>(f.clearPeripheryPlanes(),f))).subscribe(this._rendererOperation$));const o=this._navigator.panService.panImages$.pipe(ei(f=>Fr(f).pipe(Wi(([p,g])=>Si(this._navigator.graphService.cacheImage$(p.id).pipe(Nn(_=>(console.error(`Failed to cache periphery image (${p.id})`,_),zi()))),Ai(g))))),dn());e.push(o.pipe(We(([f,p])=>g=>(g.addPeripheryPlane(f,p),g))).subscribe(this._rendererOperation$)),e.push(o.pipe(Wi(([f])=>f.cacheImage$().pipe(Nn(()=>zi()))),We(f=>p=>(p.updateTextureImage(f.image,f),p))).subscribe(this._rendererOperation$));const c=this._navigator.stateService.currentState$.pipe(We(f=>f.state.alpha<1),yi()),s=Si(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,c).pipe(We(([f,p,g,_])=>!(f||p||g||_)),oi(f=>f));e.push(this._navigator.stateService.state$.pipe(ei(f=>f===Oi.Traversing?this._navigator.panService.panImages$:zi()),ei(f=>s.pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.currentTransform$),Wi(([,p,g,_])=>Ai([p,g,_,f])))),ei(([f,p,g,_])=>{const x=f.camera.lookat.clone().sub(f.camera.position),P=[new vo().viewingDirection(p.rotation).angleTo(x),void 0],k=new zo().viewportToBasic(0,0,g,f.perspective);k[0]>=0&&k[0]<=1&&k[1]>=0&&k[1]<=1&&(P[0]=Number.NEGATIVE_INFINITY);for(const[L]of _){const F=new vo().viewingDirection(L.rotation).angleTo(x);F<P[0]&&(P[0]=F,P[1]=L.id)}return P[1]?this._navigator.moveTo$(P[1]).pipe(Nn(()=>zi())):zi()})).subscribe())}_deactivate(){this._rendererDisposer$.next(null),this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}}YO.componentName="image";class xu{constructor(e,t,i){this._component=e,this._container=t,this._navigator=i,this._enabled=!1}get isEnabled(){return this._enabled}enable(){this._enabled||!this._component.activated||(this._enable(),this._enabled=!0,this._component.configure(this._getConfiguration(!0)))}disable(){this._enabled&&(this._disable(),this._enabled=!1,this._component.activated&&this._component.configure(this._getConfiguration(!1)))}}class _ee extends xu{_enable(){const e=this._navigator.stateService.currentImage$.pipe(ei(t=>t.sequenceEdges$));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ui(e)).subscribe(([t,i])=>{let r=null;switch(t.keyCode){case 38:r=Ot.Next;break;case 40:r=Ot.Prev;break;default:return}if(t.preventDefault(),!(!t.altKey||t.shiftKey||!i.cached)){for(const o of i.edges)if(o.data.direction===r){this._navigator.moveTo$(o.target).subscribe(void 0,c=>{c instanceof Bl||console.error(c)});return}}})}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keySequenceNavigation:e}}}class vee extends xu{constructor(e,t,i,r){super(e,t,i),this._spatial=r}_enable(){const e=this._navigator.stateService.currentImage$.pipe(ei(t=>t.spatialEdges$));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ui(e,this._navigator.stateService.currentState$)).subscribe(([t,i,r])=>{let o=ki(r.state.currentImage.cameraType),c=null;switch(t.keyCode){case 37:c=t.shiftKey&&!o?Ot.TurnLeft:Ot.StepLeft;break;case 38:c=t.shiftKey&&!o?Ot.Spherical:Ot.StepForward;break;case 39:c=t.shiftKey&&!o?Ot.TurnRight:Ot.StepRight;break;case 40:c=t.shiftKey&&!o?Ot.TurnU:Ot.StepBackward;break;default:return}if(t.preventDefault(),!(t.altKey||!i.cached||t.shiftKey&&o))if(!o)this._moveDir(c,i);else{const s={};s[Ot.StepBackward]=Math.PI,s[Ot.StepForward]=0,s[Ot.StepLeft]=Math.PI/2,s[Ot.StepRight]=-Math.PI/2;const f=this._rotationFromCamera(r.state.camera).phi,p=this._spatial.wrapAngle(f+s[c]),g=Math.PI/4,_=i.edges.filter(M=>M.data.direction===Ot.Spherical||M.data.direction===c);let x=Number.MAX_VALUE,b=null;for(const M of _){const P=Math.abs(this._spatial.wrapAngle(M.data.worldMotionAzimuth-p));P<Math.min(x,g)&&(x=P,b=M.target)}if(b==null)return;this._moveTo(b)}})}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keySpatialNavigation:e}}_moveDir(e,t){for(const i of t.edges)if(i.data.direction===e){this._moveTo(i.target);return}}_moveTo(e){this._navigator.moveTo$(e).subscribe(void 0,t=>{t instanceof Bl||console.error(t)})}_rotationFromCamera(e){let t=e.lookat.clone().sub(e.position),i=t.clone().dot(e.up),r=t.clone().sub(e.up.clone().multiplyScalar(i)),o=Math.atan2(r.y,r.x),c=Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1]);return{phi:o,theta:c}}}class yee extends xu{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(([e,t,i])=>{if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0;switch(e.key){case"+":r=1;break;case"-":r=-1;break;default:return}e.preventDefault();const o=this._viewportCoords.unprojectFromViewport(0,0,t.perspective),c=i.projectBasic(o.toArray());this._navigator.stateService.zoomIn(r,c)})}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keyZoom:e}}}class bee extends xu{_enable(){this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(Ui(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentImage$.pipe(ei(e=>e.sequenceEdges$)),this._navigator.stateService.state$.pipe(We(e=>e===Oi.Earth),yi()))).subscribe(([e,t,i,r,o,c])=>{if(!(e.altKey||e.ctrlKey||e.metaKey)){switch(e.key){case"D":if(!e.shiftKey)return;const s=t?null:i===Ot.Next?Ot.Prev:i===Ot.Prev?Ot.Next:null;s!=null&&this._navigator.playService.setDirection(s);break;case" ":if(e.shiftKey)return;if(!c)if(t)this._navigator.playService.stop();else for(let f of o.edges)f.data.direction===i&&this._navigator.playService.play();break;case"<":this._navigator.playService.setSpeed(r-.05);break;case">":this._navigator.playService.setSpeed(r+.05);break;default:return}e.preventDefault()}})}_disable(){this._keyDownSubscription.unsubscribe()}_getConfiguration(e){return{keyPlay:e}}}class KO extends bo{constructor(e,t,i){super(e,t,i),this._keyPlayHandler=new bee(this,t,i),this._keySequenceNavigationHandler=new _ee(this,t,i),this._keySpatialNavigationHandler=new vee(this,t,i,new vo),this._keyZoomHandler=new yee(this,t,i,new zo)}get keyPlay(){return this._keyPlayHandler}get keySequenceNavigation(){return this._keySequenceNavigationHandler}get keySpatialNavigation(){return this._keySpatialNavigationHandler}get keyZoom(){return this._keyZoomHandler}_activate(){this._subscriptions.push(this._configuration$.subscribe(e=>{e.keyPlay?this._keyPlayHandler.enable():this._keyPlayHandler.disable(),e.keySequenceNavigation?this._keySequenceNavigationHandler.enable():this._keySequenceNavigationHandler.disable(),e.keySpatialNavigation?this._keySpatialNavigationHandler.enable():this._keySpatialNavigationHandler.disable(),e.keyZoom?this._keyZoomHandler.enable():this._keyZoomHandler.disable()}))}_deactivate(){this._subscriptions.unsubscribe(),this._keyPlayHandler.disable(),this._keySequenceNavigationHandler.disable(),this._keySpatialNavigationHandler.disable(),this._keyZoomHandler.disable()}_getDefaultConfiguration(){return{keyPlay:!0,keySequenceNavigation:!0,keySpatialNavigation:!0,keyZoom:!0}}}KO.componentName="keyboard";class xee{constructor(e,t){this._needsRender=!1,this._interactiveObjects=[],this._markers={},this._objectMarkers={},this._raycaster=t||new sw,this._scene=e||new _h}get markers(){return this._markers}get needsRender(){return this._needsRender}add(e,t){e.id in this._markers&&this._dispose(e.id),e.createGeometry(t),this._scene.add(e.geometry),this._markers[e.id]=e;for(let i of e.getInteractiveObjects())this._interactiveObjects.push(i),this._objectMarkers[i.uuid]=e.id;this._needsRender=!0}clear(){for(const e in this._markers)this._markers.hasOwnProperty&&this._dispose(e);this._needsRender=!0}get(e){return this._markers[e]}getAll(){return Object.keys(this._markers).map(e=>this._markers[e])}has(e){return e in this._markers}intersectObjects([e,t],i){this._raycaster.setFromCamera(new li(e,t),i);const r=this._raycaster.intersectObjects(this._interactiveObjects);for(const o of r)if(o.object.uuid in this._objectMarkers)return this._objectMarkers[o.object.uuid];return null}lerpAltitude(e,t,i){e in this._markers&&(this._markers[e].lerpAltitude(t,i),this._needsRender=!0)}remove(e){e in this._markers&&(this._dispose(e),this._needsRender=!0)}render(e,t){t.render(this._scene,e),this._needsRender=!1}update(e,t,i){if(!(e in this._markers))return;this._markers[e].updatePosition(t,i),this._needsRender=!0}_dispose(e){const t=this._markers[e];this._scene.remove(t.geometry);for(let i of t.getInteractiveObjects()){const r=this._interactiveObjects.indexOf(i);r!==-1?this._interactiveObjects.splice(r,1):console.warn(`Object does not exist (${i.id}) for ${e}`),delete this._objectMarkers[i.uuid]}t.disposeGeometry(),delete this._markers[e]}}class JO extends bo{constructor(e,t,i){super(e,t,i),this._graphCalculator=new Q2,this._markerScene=new xee,this._markerSet=new Ly,this._viewportCoords=new zo,this._relativeGroundAltitude=-2}add(e){this._markerSet.add(e)}fire(e,t){super.fire(e,t)}get(e){return this._markerSet.get(e)}getAll(){return this._markerSet.getAll()}getMarkerIdAt(e){return new Promise((t,i)=>{this._container.renderService.renderCamera$.pipe(wi(),We(r=>{const o=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._markerScene.intersectObjects(o,r.perspective)})).subscribe(r=>{t(r)},r=>{i(r)})})}has(e){return this._markerSet.has(e)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}remove(e){this._markerSet.remove(e)}removeAll(){this._markerSet.removeAll()}_activate(){const e=this._navigator.stateService.currentState$.pipe(We(M=>M.state.camera.position.z+this._relativeGroundAltitude),yi((M,P)=>Math.abs(M-P)<.01),Pi(1),gi()),t=Si(e,this._navigator.stateService.reference$).pipe(wi(),We(()=>{}),Pi(1),gi()),i=this._configuration$.pipe(We(M=>({visibleBBoxSize:Math.max(1,Math.min(200,M.visibleBBoxSize))}))),r=this._navigator.stateService.currentImage$.pipe(We(M=>M.lngLat),Pi(1),gi()),o=Si(i,r).pipe(We(([M,P])=>this._graphCalculator.boundingBoxCorners(P,M.visibleBBoxSize/2)),Pi(1),gi()),c=Si(Nl(Ai(this._markerSet),this._markerSet.changed$),o).pipe(We(([M,P])=>M.search(P))),s=this._subscriptions;s.push(t.pipe(ei(()=>c.pipe(Ui(this._navigator.stateService.reference$,e)))).subscribe(([M,P,k])=>{const L=this._markerScene,I=L.markers,F=Object.assign({},I);for(const N of M)if(N.id in I)delete F[N.id];else{const H=ta(N.lngLat.lng,N.lngLat.lat,P.alt+k,P.lng,P.lat,P.alt);L.add(N,H)}for(const N in F)F.hasOwnProperty(N)&&L.remove(N)})),s.push(t.pipe(ei(()=>this._markerSet.updated$.pipe(Ui(o,this._navigator.stateService.reference$,e)))).subscribe(([M,[P,k],L,I])=>{const F=this._markerScene;for(const N of M){const H=F.has(N.id),Y=N.lngLat.lat>P.lat&&N.lngLat.lat<k.lat&&N.lngLat.lng>P.lng&&N.lngLat.lng<k.lng;if(Y){const q=ta(N.lngLat.lng,N.lngLat.lat,L.alt+I,L.lng,L.lat,L.alt);F.add(N,q)}else!Y&&H&&F.remove(N.id)}})),s.push(this._navigator.stateService.reference$.pipe(Ys(1),Ui(e)).subscribe(([M,P])=>{const k=this._markerScene;for(const L of k.getAll()){const I=ta(L.lngLat.lng,L.lngLat.lat,M.alt+P,M.lng,M.lat,M.alt);k.update(L.id,I)}})),s.push(e.pipe(Ys(1),Ui(this._navigator.stateService.reference$,r)).subscribe(([M,P,k])=>{const L=this._markerScene,I=ta(k.lng,k.lat,P.alt+M,P.lng,P.lat,P.alt);for(const F of L.getAll()){const N=ta(F.lngLat.lng,F.lngLat.lat,P.alt+M,P.lng,P.lat,P.alt),H=N[0]-I[0],Y=N[1]-I[1],q=Math.sqrt(H*H+Y*Y);q>50||L.lerpAltitude(F.id,M,Math.min(1,Math.max(0,1.2-1.2*q/50)))}})),s.push(this._navigator.stateService.currentState$.pipe(We(M=>{const P=this._markerScene;return{name:this._name,renderer:{frameId:M.id,needsRender:P.needsRender,render:P.render.bind(P),pass:Ph.Opaque}}})).subscribe(this._container.glRenderer.render$));const f=Si(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(We(([M,P])=>{const k=this._container.container,[L,I]=this._viewportCoords.canvasPosition(P,k),F=this._viewportCoords.canvasToViewport(L,I,k);return this._markerScene.intersectObjects(F,M.perspective)}),Pi(1),gi()),p=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(We(()=>!0)),g=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(We(()=>!1)),_=fn(p,g).pipe(An(!1));s.push(fn(p.pipe(Ui(f)),Si(g,Ai(null))).pipe(An([!1,null]),tl()).subscribe(([M,P])=>{const k=P[0],L=k?"markerdragstart":"markerdragend",I=k?P[1]:M[1],N={marker:this._markerScene.get(I),target:this,type:L};this.fire(L,N)}));const x=fn(this._container.mouseService.mouseDown$.pipe(We(()=>!0)),this._container.mouseService.documentMouseUp$.pipe(We(()=>!1))).pipe(An(!1));s.push(Si(this._container.mouseService.active$,f.pipe(yi()),x,_).pipe(We(([M,P,k,L])=>!M&&P!=null&&k||L),yi()).subscribe(M=>{M?(this._container.mouseService.claimMouse(this._name,1),this._container.mouseService.claimWheel(this._name,1)):(this._container.mouseService.unclaimMouse(this._name),this._container.mouseService.unclaimWheel(this._name))}));const b=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(Ui(f,this._container.renderService.renderCamera$),We(([M,P,k])=>{const L=this._markerScene.get(P),I=this._container.container,[F,N]=this._viewportCoords.projectToCanvas(L.geometry.position.toArray(),I,k.perspective),[H,Y]=this._viewportCoords.canvasPosition(M,I),q=[H-F,Y-N];return[L,q,k]}),Pi(1),gi());s.push(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(Ui(b,this._navigator.stateService.reference$,i)).subscribe(([M,[P,k,L],I,F])=>{if(!this._markerScene.has(P.id))return;const N=this._container.container,[H,Y]=this._viewportCoords.canvasPosition(M,N),q=H-k[0],U=Y-k[1],[G,j]=this._viewportCoords.canvasToViewport(q,U,N),B=new Fe(G,j,1).unproject(L.perspective).sub(L.perspective.position).normalize(),ne=Math.min(this._relativeGroundAltitude/B.z,F.visibleBBoxSize/2-.1);if(ne<0)return;const J=B.clone().multiplyScalar(ne).add(L.perspective.position);J.z=L.perspective.position.z+this._relativeGroundAltitude;const[le,ae]=dp(J.x,J.y,J.z,I.lng,I.lat,I.alt);this._markerScene.update(P.id,J.toArray(),{lat:ae,lng:le}),this._markerSet.update(P);const pe="markerposition",fe={marker:P,target:this,type:pe};this.fire(pe,fe)}))}_deactivate(){this._subscriptions.unsubscribe(),this._markerScene.clear()}_getDefaultConfiguration(){return{visibleBBoxSize:100}}}JO.componentName="marker";function wee(n){return n>0?1:n<0?-1:0}function tx(n,e){return n.x<=Math.max(e.p1.x,e.p2.x)&&n.x>=Math.min(e.p1.x,e.p2.x)&&n.y>=Math.max(e.p1.y,e.p2.y)&&n.y>=Math.min(e.p1.y,e.p2.y)}function QO(n,e){const t=n.p2.x-n.p1.x,i=n.p2.y-n.p1.y,r=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,c=t*o-i*r,s=t*t+i*i,f=r*r+o*o;return c*c<1e-10*s*f}function ix(n,e,t){const i=(e.y-n.y)*(t.x-e.x)-(t.y-e.y)*(e.x-n.x);return wee(i)}function See(n,e){if(QO(n,e))return!1;const t=ix(n.p1,n.p2,e.p1),i=ix(n.p1,n.p2,e.p2),r=ix(e.p1,e.p2,n.p1),o=ix(e.p1,e.p2,n.p2);return!!(t!==i&&r!==o||t===0&&tx(e.p1,n)||i===0&&tx(e.p2,n)||r===0&&tx(n.p1,e)||o===0&&tx(n.p2,e))}function Tee(n,e){if(QO(n,e))return;const t=n.p1.x,i=n.p2.x,r=n.p1.y,o=n.p2.y,c=e.p1.x,s=e.p2.x,f=e.p1.y,p=e.p2.y,g=(t-i)*(f-p)-(r-o)*(c-s),_=(t*o-r*i)*(c-s)-(t-i)*(c*p-f*s),x=(t*o-r*i)*(f-p)-(r-o)*(c*p-f*s);return{x:_/g,y:x/g}}function Mee(n){let e=[],t=[[0,0],[1,0],[1,1],[0,1]],i=[[1,0],[0,1],[-1,0],[0,-1]];for(let r=0;r<4;++r){let o=t[r],c=i[r];for(let s=0;s<n;++s)e.push([o[0]+c[0]*s/n,o[1]+c[1]*s/n])}return e}function vT(n,e){return n>=-1&&n<=1&&e>=-1&&e<=1}function nx(n,e){return n>=0&&n<=1&&e>=0&&e<=1}function hw(n,e,t){const r=Mee(100).map(F=>t.basicToViewportSafe(F[0],F[1],n,e)),o=[],c=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}],s=[!1,!1,!1,!1];for(let F=0;F<r.length;F++){const N=r[F],H=r[(F+1)%r.length];if(N===null)continue;if(H===null){vT(N[0],N[1])&&o.push(N);continue}const[Y,q]=N,[U,G]=H;if(vT(Y,q))if(vT(U,G))o.push(N);else for(let j=0;j<4;j++){const B={p1:{x:Y,y:q},p2:{x:U,y:G}},ne={p1:c[j],p2:c[(j+1)%4]};if(See(B,ne)){const le=Tee(B,ne);o.push(N,[le.x,le.y]),s[j]=!0}}}const[f,p]=t.viewportToBasic(-1,1,n,e),[g,_]=t.viewportToBasic(1,1,n,e),[x,b]=t.viewportToBasic(1,-1,n,e),[M,P]=t.viewportToBasic(-1,-1,n,e);nx(f,p)&&(s[3]=s[0]=!0),nx(g,_)&&(s[0]=s[1]=!0),nx(x,b)&&(s[1]=s[2]=!0),nx(M,P)&&(s[2]=s[3]=!0);const k=[-1,-1,1,1];for(let F of o){const N=F[0],H=F[1];N>k[1]&&(k[1]=N),N<k[3]&&(k[3]=N),H>k[0]&&(k[0]=H),H<k[2]&&(k[2]=H)}const L=[1,1,-1,-1],I=[];for(let F=0;F<4;F++){if(s[F]){I.push(0);continue}I.push(Math.abs(L[F]-k[F]))}return I}class Cee extends xu{constructor(e,t,i,r,o){super(e,t,i),this._spatial=o,this._viewportCoords=r}_enable(){const e=this._navigator.stateService.currentState$.pipe(We(t=>t.state.alpha<1),yi());this._bounceSubscription=Si(e,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(We(t=>t[0]||t[1]||t[2]||t[3]),yi(),ei(t=>t?zi():Si(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$.pipe(wi()))),Ui(this._navigator.panService.panImages$)).subscribe(([[t,i],r])=>{if(!i.hasValidScale&&t.camera.focal<.1||t.perspective.aspect===0||t.perspective.aspect===Number.POSITIVE_INFINITY)return;const o=hw(i,t.perspective,this._viewportCoords),c=this._viewportCoords.viewportToBasic(0,0,i,t.perspective);(c[0]<0||c[0]>1)&&r.length>0&&(o[0]=o[2]=0);for(const[,k]of r){const L=hw(k,t.perspective,this._viewportCoords);for(let I=1;I<o.length;I+=2)L[I]<o[I]&&(o[I]=L[I])}if(Math.max(...o)<.01)return;const s=o[1]-o[3],f=o[0]-o[2],p=this._viewportCoords.unprojectFromViewport(0,0,t.perspective).sub(t.perspective.position),g=this._viewportCoords.unprojectFromViewport(s,0,t.perspective).sub(t.perspective.position),_=this._viewportCoords.unprojectFromViewport(0,f,t.perspective).sub(t.perspective.position);let x=(s>0?1:-1)*g.angleTo(p),b=(f>0?1:-1)*_.angleTo(p);const M=Math.PI/60,P=.1;x=this._spatial.clamp(P*x,-M,M),b=this._spatial.clamp(P*b,-M,M),this._navigator.stateService.rotateUnbounded({phi:x,theta:b})})}_disable(){this._bounceSubscription.unsubscribe()}_getConfiguration(){return{}}}class Cx{static filteredPairwiseMouseDrag$(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseDragStart$,t.mouseDrag$,t.mouseDragEnd$)}static filteredPairwiseMouseRightDrag$(e,t){return this._filteredPairwiseMouseDrag$(e,t,t.mouseRightDragStart$,t.mouseRightDrag$,t.mouseRightDragEnd$)}static _filteredPairwiseMouseDrag$(e,t,i,r,o){return t.filtered$(e,i).pipe(ei(c=>{const s=Nl(Ai(c),t.filtered$(e,r)),f=t.filtered$(e,o).pipe(We(()=>null));return fn(s,f).pipe(iF(p=>!!p),An(null))}),tl(),oi(c=>c[0]!=null&&c[1]!=null))}}class Eee extends xu{constructor(e,t,i,r,o){super(e,t,i),this._spatial=o,this._viewportCoords=r}_enable(){let e=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(We(()=>!0),dn()),t=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(We(()=>!1),dn());this._activeMouseSubscription=fn(e,t).subscribe(this._container.mouseService.activate$);const i=fn(e,t).pipe(ei(s=>s?this._container.mouseService.documentMouseMove$:zi()));this._preventDefaultSubscription=fn(i,this._container.touchService.touchMove$).subscribe(s=>{s.preventDefault()});let r=this._container.touchService.singleTouchDragStart$.pipe(We(()=>!0)),o=this._container.touchService.singleTouchDragEnd$.pipe(We(()=>!1));this._activeTouchSubscription=fn(r,o).subscribe(this._container.touchService.activate$);const c=this._navigator.stateService.currentState$.pipe(We(s=>ki(s.state.currentImage.cameraType)||s.state.imagesAhead<1),yi(),ei(s=>{if(!s)return zi();const f=Cx.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService),p=fn(this._container.touchService.singleTouchDragStart$,this._container.touchService.singleTouchDrag$,this._container.touchService.singleTouchDragEnd$.pipe(We(()=>null))).pipe(We(g=>g!=null&&g.touches.length>0?g.touches[0]:null),tl(),oi(g=>g[0]!=null&&g[1]!=null));return fn(f,p)}),Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panImages$),We(([s,f,p,g])=>{let _=s[0],x=s[1],b=x.clientX-_.clientX,M=x.clientY-_.clientY,P=this._container.container,[k,L]=this._viewportCoords.canvasPosition(x,P),I=this._viewportCoords.unprojectFromCanvas(k,L,P,f.perspective).sub(f.perspective.position),F=this._viewportCoords.unprojectFromCanvas(k-b,L,P,f.perspective).sub(f.perspective.position),N=this._viewportCoords.unprojectFromCanvas(k,L-M,P,f.perspective).sub(f.perspective.position),H=(b>0?1:-1)*F.angleTo(I),Y=(M>0?-1:1)*N.angleTo(I);const q=hw(p,f.perspective,this._viewportCoords);for(const[,U]of g){const G=hw(U,f.perspective,this._viewportCoords);for(let j=0;j<q.length;j++)G[j]<q[j]&&(q[j]=G[j])}return q[0]>0&&Y<0&&(Y/=Math.max(1,200*q[0])),q[2]>0&&Y>0&&(Y/=Math.max(1,200*q[2])),q[1]>0&&H<0&&(H/=Math.max(1,200*q[1])),q[3]>0&&H>0&&(H/=Math.max(1,200*q[3])),{phi:H,theta:Y}}),dn());this._rotateWithoutInertiaSubscription=c.subscribe(s=>{this._navigator.stateService.rotateWithoutInertia(s)}),this._rotateSubscription=c.pipe(Vr((s,f)=>(this._drainBuffer(s),s.push([Date.now(),f]),s),[]),VG(fn(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$)),We(s=>{const f=this._drainBuffer(s.slice()),p={phi:0,theta:0};for(const x of f)p.phi+=x[1].phi,p.theta+=x[1].theta;const g=f.length;g>0&&(p.phi/=g,p.theta/=g);const _=Math.PI/18;return p.phi=this._spatial.clamp(p.phi,-_,_),p.theta=this._spatial.clamp(p.theta,-_,_),p})).subscribe(s=>{this._navigator.stateService.rotate(s)})}_disable(){this._activeMouseSubscription.unsubscribe(),this._activeTouchSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._rotateSubscription.unsubscribe(),this._rotateWithoutInertiaSubscription.unsubscribe(),this._activeMouseSubscription=null,this._activeTouchSubscription=null,this._preventDefaultSubscription=null,this._rotateSubscription=null}_getConfiguration(e){return{dragPan:e}}_drainBuffer(e){const i=Date.now();for(;e.length>0&&i-e[0][0]>50;)e.shift();return e}}class Aee extends xu{constructor(e,t,i,r,o){super(e,t,i),this._spatial=o,this._viewportCoords=r,this._subscriptions=new yo}_enable(){const e=this._navigator.stateService.state$.pipe(We(i=>i===Oi.Earth),Pi(1),gi()),t=this._subscriptions;t.push(e.pipe(ei(i=>i?this._container.mouseService.mouseWheel$:zi())).subscribe(i=>{i.preventDefault()})),t.push(e.pipe(ei(i=>i?Cx.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService).pipe(oi(([r,o])=>!(r.ctrlKey&&o.ctrlKey))):zi()),Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),We(([[i,r],o,c])=>{const s=[0,0,1],f=[0,0,-2],p=this._planeIntersection(r,s,f,o.perspective,this._container.container),g=this._planeIntersection(i,s,f,o.perspective,this._container.container);return!p||!g?null:new Fe().subVectors(p,g).multiplyScalar(-1).toArray()}),oi(i=>!!i)).subscribe(i=>{this._navigator.stateService.truck(i)})),t.push(e.pipe(ei(i=>i?Cx.filteredPairwiseMouseDrag$(this._component.name,this._container.mouseService).pipe(oi(([r,o])=>r.ctrlKey&&o.ctrlKey)):zi()),We(([i,r])=>this._mousePairToRotation(i,r))).subscribe(i=>{this._navigator.stateService.orbit(i)})),t.push(e.pipe(ei(i=>i?Cx.filteredPairwiseMouseRightDrag$(this._component.name,this._container.mouseService).pipe(oi(([r,o])=>!r.ctrlKey&&!o.ctrlKey)):zi()),We(([i,r])=>this._mousePairToRotation(i,r))).subscribe(i=>{this._navigator.stateService.orbit(i)})),t.push(e.pipe(ei(i=>i?this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$):zi()),We(i=>{let r=i.deltaY;i.deltaMode===1?r=40*r:i.deltaMode===2&&(r=800*r);const o=this._viewportCoords.containerToCanvas(this._container.container);return-r/o[1]})).subscribe(i=>{this._navigator.stateService.dolly(i)}))}_disable(){this._subscriptions.unsubscribe()}_getConfiguration(){return{}}_eventToViewport(e,t){const i=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToViewport(i[0],i[1],t)}_mousePairToRotation(e,t){const[i,r]=this._eventToViewport(t,this._container.container),[o,c]=this._eventToViewport(e,this._container.container),s=(o-i)*Math.PI,f=(r-c)*Math.PI/2;return{phi:s,theta:f}}_planeIntersection(e,t,i,r,o){const[c,s]=this._viewportCoords.canvasPosition(e,o),f=this._viewportCoords.unprojectFromCanvas(c,s,o,r).sub(r.position).normalize();if(Math.abs(this._spatial.angleToPlane(f.toArray(),t))<Math.PI/90)return null;const p=r.position.clone(),g=new Fe().fromArray(t),_=new Fe().fromArray(i),x=new Fe().subVectors(_,p).dot(g)/f.clone().dot(g),b=new Fe().addVectors(p,f.multiplyScalar(x));return this._viewportCoords.worldToCamera(b.toArray(),r)[2]>0?null:b}}class Pee extends xu{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._container.mouseService.claimWheel(this._component.name,0),this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe(e=>{e.preventDefault()}),this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(Ui(this._navigator.stateService.currentState$,(e,t)=>[e,t]),oi(e=>{let t=e[1].state;return ki(t.currentImage.cameraType)||t.imagesAhead<1}),We(e=>e[0]),Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,(e,t,i)=>[e,t,i])).subscribe(e=>{let t=e[0],i=e[1],r=e[2],o=this._container.container,[c,s]=this._viewportCoords.canvasPosition(t,o),f=this._viewportCoords.unprojectFromCanvas(c,s,o,i.perspective),p=r.projectBasic(f.toArray()),g=t.deltaY;t.deltaMode===1?g=40*g:t.deltaMode===2&&(g=800*g);const _=this._viewportCoords.containerToCanvas(o);let x=-3*g/_[1];this._navigator.stateService.zoomIn(x,p)})}_disable(){this._container.mouseService.unclaimWheel(this._component.name),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}_getConfiguration(e){return{scrollZoom:e}}}class Iee extends xu{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r}_enable(){this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe(i=>{i.originalEvent.preventDefault()});let e=this._container.touchService.pinchStart$.pipe(We(i=>!0)),t=this._container.touchService.pinchEnd$.pipe(We(i=>!1));this._activeSubscription=fn(e,t).subscribe(this._container.touchService.activate$),this._zoomSubscription=this._container.touchService.pinch$.pipe(Ui(this._navigator.stateService.currentState$),oi(i=>{let r=i[1].state;return ki(r.currentImage.cameraType)||r.imagesAhead<1}),We(i=>i[0]),Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(([i,r,o])=>{let c=this._container.container,[s,f]=this._viewportCoords.canvasPosition(i,c),p=this._viewportCoords.unprojectFromCanvas(s,f,c,r.perspective),g=o.projectBasic(p.toArray());const[_,x]=this._viewportCoords.containerToCanvas(c);let b=3*i.distanceChange/Math.min(_,x);this._navigator.stateService.zoomIn(b,g)})}_disable(){this._activeSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null}_getConfiguration(e){return{touchZoom:e}}}class ez extends bo{constructor(e,t,i){super(e,t,i);const r=new vo,o=new zo;this._bounceHandler=new Cee(this,t,i,o,r),this._dragPanHandler=new Eee(this,t,i,o,r),this._earthControlHandler=new Aee(this,t,i,o,r),this._scrollZoomHandler=new Pee(this,t,i,o),this._touchZoomHandler=new Iee(this,t,i,o)}get dragPan(){return this._dragPanHandler}get earthControl(){return this._earthControlHandler}get scrollZoom(){return this._scrollZoomHandler}get touchZoom(){return this._touchZoomHandler}_activate(){this._bounceHandler.enable(),this._subscriptions.push(this._configuration$.subscribe(e=>{e.dragPan?this._dragPanHandler.enable():this._dragPanHandler.disable(),e.earthControl?this._earthControlHandler.enable():this._earthControlHandler.disable(),e.scrollZoom?this._scrollZoomHandler.enable():this._scrollZoomHandler.disable(),e.touchZoom?this._touchZoomHandler.enable():this._touchZoomHandler.disable()})),this._container.mouseService.claimMouse(this._name,0)}_deactivate(){this._container.mouseService.unclaimMouse(this._name),this._subscriptions.unsubscribe(),this._bounceHandler.disable(),this._dragPanHandler.disable(),this._earthControlHandler.disable(),this._scrollZoomHandler.disable(),this._touchZoomHandler.disable()}_getDefaultConfiguration(){return{dragPan:!0,earthControl:!0,scrollZoom:!0,touchZoom:!0}}}ez.componentName="pointer";class uC{constructor(e){this._document=e||document}get document(){return this._document}createElement(e,t,i){const r=this._document.createElement(e);return t&&(r.className=t),i&&i.appendChild(r),r}}class tz extends bo{constructor(e,t,i,r){super(e,t,i),this._dom=r||new uC,this._popups=[],this._added$=new ri,this._popups$=new ri}add(e){for(const t of e)this._popups.indexOf(t)===-1&&(this._popups.push(t),this._activated&&t.setParentContainer(this._popupContainer));this._added$.next(e),this._popups$.next(this._popups)}getAll(){return this._popups.slice()}remove(e){for(const t of e)this._remove(t);this._popups$.next(this._popups)}removeAll(){for(const e of this._popups.slice())this._remove(e);this._popups$.next(this._popups)}_activate(){this._popupContainer=this._dom.createElement("div","mapillary-popup-container",this._container.container);for(const i of this._popups)i.setParentContainer(this._popupContainer);const e=this._subscriptions;e.push(Si(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe(([i,r,o])=>{for(const c of this._popups)c.update(i,r,o)}));const t=this._popups$.pipe(An(this._popups),ei(i=>Fr(i).pipe(Wi(r=>r.changed$))),We(i=>[i]));e.push(fn(this._added$,t).pipe(Ui(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe(([i,r,o,c])=>{for(const s of i)s.update(r,o,c)}))}_deactivate(){this._subscriptions.unsubscribe();for(const e of this._popups)e.remove();this._container.container.removeChild(this._popupContainer),delete this._popupContainer}_getDefaultConfiguration(){return{}}_remove(e){const t=this._popups.indexOf(e);if(t===-1)return;const i=this._popups.splice(t,1)[0];this._activated&&i.remove()}}tz.componentName="popup";var na;(function(n){n[n.Sequence=0]="Sequence",n[n.Spatial=1]="Spatial"})(na||(na={}));var fo;(function(n){n[n.Default=0]="Default",n[n.Playback=1]="Playback",n[n.Timeline=2]="Timeline"})(fo||(fo={}));class Lee{constructor(e){this._container=e,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._stepperDefaultWidth=108,this._controlsDefaultWidth=88,this._defaultHeight=30,this._expandControls=!1,this._mode=fo.Default,this._speed=.5,this._changingSpeed=!1,this._index=null,this._changingPosition=!1,this._mouseEnterDirection$=new ri,this._mouseLeaveDirection$=new ri,this._notifyChanged$=new ri,this._notifyChangingPositionChanged$=new ri,this._notifySpeedChanged$=new ri,this._notifyIndexChanged$=new ri}get changed$(){return this._notifyChanged$}get changingPositionChanged$(){return this._notifyChangingPositionChanged$}get speed$(){return this._notifySpeedChanged$}get index$(){return this._notifyIndexChanged$}get mouseEnterDirection$(){return this._mouseEnterDirection$}get mouseLeaveDirection$(){return this._mouseLeaveDirection$}activate(){this._changingSubscription||(this._changingSubscription=fn(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(oi(e=>e.touches.length===0))).subscribe(()=>{this._changingSpeed&&(this._changingSpeed=!1),this._changingPosition&&this._setChangingPosition(!1)}))}deactivate(){this._changingSubscription&&(this._changingSpeed=!1,this._changingPosition=!1,this._expandControls=!1,this._mode=fo.Default,this._changingSubscription.unsubscribe(),this._changingSubscription=null)}render(e,t,i,r,o,c,s,f,p){if(t.visible===!1)return jt.h("div.mapillary-sequence-container",{},[]);const g=this._createStepper(e,t,s,i,f,p),_=this._createSequenceControls(i),x=this._createPlaybackControls(i,r,f,t),b=this._createTimelineControls(i,o,c);return jt.h("div.mapillary-sequence-container",[g,_,x,b])}getContainerWidth(e,t){let i=t.minWidth,r=t.maxWidth;r<i&&(r=i);let o=(e.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),c=(e.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),s=Math.max(0,Math.min(1,Math.min(o,c)));return i+s*(r-i)}_createPositionInput(e,t){this._index=e;const i=b=>{this._index=Number(b.target.value),this._notifyIndexChanged$.next(this._index)},r=this._container.domContainer.getBoundingClientRect(),o=Math.max(276,Math.min(410,5+.8*r.width))-65,c=b=>{b.stopPropagation(),this._setChangingPosition(!0)},s=b=>{this._changingPosition===!0&&b.stopPropagation()},p={max:t??1,min:0,onchange:i,oninput:i,onkeydown:b=>{(b.key==="ArrowDown"||b.key==="ArrowLeft"||b.key==="ArrowRight"||b.key==="ArrowUp")&&b.preventDefault()},onpointerdown:c,onpointermove:s,ontouchmove:s,ontouchstart:c,style:{width:`${o}px`},type:"range",value:e??0},g=e==null||t==null||t<=1;g&&(p.disabled="true");const _=jt.h("input.mapillary-sequence-position",p,[]),x=g?".mapillary-sequence-position-container-inactive":".mapillary-sequence-position-container";return jt.h("div"+x,[_])}_createSpeedInput(e){this._speed=e;const t=p=>{this._speed=Number(p.target.value)/1e3,this._notifySpeedChanged$.next(this._speed)},i=this._container.domContainer.getBoundingClientRect(),r=Math.max(276,Math.min(410,5+.8*i.width))-160,o=p=>{this._changingSpeed=!0,p.stopPropagation()},c=p=>{this._changingSpeed===!0&&p.stopPropagation()},s=p=>{(p.key==="ArrowDown"||p.key==="ArrowLeft"||p.key==="ArrowRight"||p.key==="ArrowUp")&&p.preventDefault()},f=jt.h("input.mapillary-sequence-speed",{max:1e3,min:0,onchange:t,oninput:t,onkeydown:s,onpointerdown:o,onpointermove:c,ontouchmove:c,ontouchstart:o,style:{width:`${r}px`},type:"range",value:1e3*e},[]);return jt.h("div.mapillary-sequence-speed-container",[f])}_createPlaybackControls(e,t,i,r){if(this._mode!==fo.Playback)return jt.h("div.mapillary-sequence-playback",[]);const o=jt.h("div.mapillary-sequence-switch-icon.mapillary-sequence-icon-visible",[]),c=r.direction===Ot.Next?Ot.Prev:Ot.Next,s=r.playing,f={onclick:()=>{s||i.configure({direction:c})}},p=r.playing?".mapillary-sequence-switch-button-inactive":".mapillary-sequence-switch-button",g=jt.h("div"+p,f,[o]),_=jt.h("div.mapillary-sequence-slow-icon.mapillary-sequence-icon-visible",[]),x=jt.h("div.mapillary-sequence-slow-container",[_]),b=jt.h("div.mapillary-sequence-fast-icon.mapillary-sequence-icon-visible",[]),M=jt.h("div.mapillary-sequence-fast-container",[b]),P=jt.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),k={onclick:()=>{this._mode=fo.Default,this._notifyChanged$.next(this)}},L=jt.h("div.mapillary-sequence-close-button",k,[P]),I=this._createSpeedInput(t),F=[g,x,I,M,L],H={style:{top:`${Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10)}px`}};return jt.h("div.mapillary-sequence-playback",H,F)}_createPlayingButton(e,t,i,r,o){let c=r.direction===Ot.Next&&e!=null||r.direction===Ot.Prev&&t!=null;c=c&&i;let f={onclick:r.playing?()=>{o.stop()}:c?()=>{o.play()}:null},p={};r.direction===Ot.Prev&&(p.style={transform:"rotate(180deg) translate(50%, 50%)"});let g=jt.h("div.mapillary-sequence-icon",p,[]),_=r.playing?"mapillary-sequence-stop":c?"mapillary-sequence-play":"mapillary-sequence-play-inactive";return jt.h("div."+_,f,[g])}_createSequenceControls(e){const t=Math.round(8/this._stepperDefaultWidth*e),i={onclick:()=>{this._expandControls=!this._expandControls,this._mode=fo.Default,this._notifyChanged$.next(this)},style:{"border-bottom-right-radius":`${t}px`,"border-top-right-radius":`${t}px`}},r=jt.h("div.mapillary-sequence-expander-bar",[]),o=jt.h("div.mapillary-sequence-expander-button",i,[r]),c=this._mode===fo.Playback?".mapillary-sequence-fast-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-fast-icon",s=jt.h("div"+c,[]),f={onclick:()=>{this._mode=this._mode===fo.Playback?fo.Default:fo.Playback,this._notifyChanged$.next(this)}},p=jt.h("div.mapillary-sequence-playback-button",f,[s]),g=this._mode===fo.Timeline?".mapillary-sequence-timeline-icon-gray.mapillary-sequence-icon-visible":".mapillary-sequence-timeline-icon",_=jt.h("div"+g,[]),x={onclick:()=>{this._mode=this._mode===fo.Timeline?fo.Default:fo.Timeline,this._notifyChanged$.next(this)}},b=jt.h("div.mapillary-sequence-timeline-button",x,[_]),M={style:{height:this._defaultHeight/this._stepperDefaultWidth*e+"px",transform:`translate(${e/2+2}px, 0)`,width:this._controlsDefaultWidth/this._stepperDefaultWidth*e+"px"}},P=".mapillary-sequence-controls"+(this._expandControls?".mapillary-sequence-controls-expanded":"");return jt.h("div"+P,M,[p,b,o])}_createSequenceArrows(e,t,i,r,o){let c={onclick:e!=null?()=>{o.moveDir$(Ot.Next).subscribe(void 0,b=>{b instanceof Bl||console.error(b)})}:null,onpointerenter:()=>{this._mouseEnterDirection$.next(Ot.Next)},onpointerleave:()=>{this._mouseLeaveDirection$.next(Ot.Next)}};const s=Math.round(8/this._stepperDefaultWidth*i);let f={onclick:t!=null?()=>{o.moveDir$(Ot.Prev).subscribe(void 0,b=>{b instanceof Bl||console.error(b)})}:null,onpointerenter:()=>{this._mouseEnterDirection$.next(Ot.Prev)},onpointerleave:()=>{this._mouseLeaveDirection$.next(Ot.Prev)},style:{"border-bottom-left-radius":`${s}px`,"border-top-left-radius":`${s}px`}},p=this._getStepClassName(Ot.Next,e,r.highlightId),g=this._getStepClassName(Ot.Prev,t,r.highlightId),_=jt.h("div.mapillary-sequence-icon",[]),x=jt.h("div.mapillary-sequence-icon",[]);return[jt.h("div."+g,f,[x]),jt.h("div."+p,c,[_])]}_createStepper(e,t,i,r,o,c){let s=null,f=null;for(let x of e.edges)x.data.direction===Ot.Next&&(s=x.target),x.data.direction===Ot.Prev&&(f=x.target);const p=this._createPlayingButton(s,f,i,t,o),g=this._createSequenceArrows(s,f,r,t,c);g.splice(1,0,p);const _={oncontextmenu:x=>{x.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*r+"px",width:r+"px"}};return jt.h("div.mapillary-sequence-stepper",_,g)}_createTimelineControls(e,t,i){if(this._mode!==fo.Timeline)return jt.h("div.mapillary-sequence-timeline",[]);const r=this._createPositionInput(t,i),o=jt.h("div.mapillary-sequence-close-icon.mapillary-sequence-icon-visible",[]),c={onclick:()=>{this._mode=fo.Default,this._notifyChanged$.next(this)}},s=jt.h("div.mapillary-sequence-close-button",c,[o]),p={style:{top:`${Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10)}px`}};return jt.h("div.mapillary-sequence-timeline",p,[r,s])}_getStepClassName(e,t,i){let r=e===Ot.Next?"mapillary-sequence-step-next":"mapillary-sequence-step-prev";return t==null?r+="-inactive":i===t&&(r+="-highlight"),r}_setChangingPosition(e){this._changingPosition=e,this._notifyChangingPositionChanged$.next(e)}}class iz extends bo{constructor(e,t,i,r,o){super(e,t,i),this._sequenceDOMRenderer=r||new Lee(t),this._scheduler=o,this._containerWidth$=new ri,this._hoveredIdSubject$=new ri,this._hoveredId$=this._hoveredIdSubject$.pipe(dn()),this._navigator.playService.playing$.pipe(Ys(1),Ui(this._configuration$)).subscribe(([c,s])=>{const f="playing",p={playing:c,target:this,type:f};this.fire(f,p),c!==s.playing&&(c?this.play():this.stop())}),this._navigator.playService.direction$.pipe(Ys(1),Ui(this._configuration$)).subscribe(([c,s])=>{c!==s.direction&&this.configure({direction:c})})}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}play(){this.configure({playing:!0})}stop(){this.configure({playing:!1})}_activate(){this._sequenceDOMRenderer.activate();const e=this._navigator.stateService.currentImage$.pipe(ei(s=>s.sequenceEdges$),Pi(1),gi()),t=this._navigator.stateService.currentImage$.pipe(yi(void 0,s=>s.sequenceId),ei(s=>Nl(Ai(null),this._navigator.graphService.cacheSequence$(s.sequenceId).pipe(cM(3),Nn(f=>(console.error("Failed to cache sequence",f),Ai(null)))))),An(null),Pi(1),gi()),i=this._subscriptions;i.push(t.subscribe());const r=this._sequenceDOMRenderer.index$.pipe(Ui(t),We(([s,f])=>f!=null?f.imageIds[s]:null),oi(s=>!!s),yi(),Ya(),gi());i.push(fn(r.pipe(wy(100,this._scheduler)),r.pipe(XD(400,this._scheduler))).pipe(yi(),ei(s=>this._navigator.moveTo$(s).pipe(Nn(()=>zi())))).subscribe()),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(oi(s=>s)).subscribe(()=>{this._navigator.graphService.setGraphMode(na.Sequence)})),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(oi(s=>!s)).subscribe(()=>{this._navigator.graphService.setGraphMode(na.Spatial)})),this._navigator.graphService.graphMode$.pipe(ei(s=>s===na.Spatial?this._navigator.stateService.currentImage$.pipe(zl(2)):zi()),oi(s=>!s.spatialEdges.cached),ei(s=>this._navigator.graphService.cacheImage$(s.id).pipe(Nn(()=>zi())))).subscribe(),i.push(this._sequenceDOMRenderer.changingPositionChanged$.pipe(oi(s=>s)).subscribe(()=>{this._navigator.playService.stop()})),i.push(Si(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(An(!1),yi())).pipe(Ui(this._navigator.stateService.currentImage$),ei(([[s,f],p])=>f&&s===na.Sequence?this._navigator.graphService.cacheSequenceImages$(p.sequenceId,p.id).pipe(cM(3),Nn(g=>(console.error("Failed to cache sequence images.",g),zi()))):zi())).subscribe());const o=t.pipe(ei(s=>{if(!s)return Ai({index:null,max:null});let f=!0;return this._sequenceDOMRenderer.changingPositionChanged$.pipe(An(!1),yi(),ei(p=>{const g=!p&&f?0:1;return f=!1,p?r:this._navigator.stateService.currentImage$.pipe(We(_=>_.id),yi(),Ys(g))}),We(p=>{const g=s.imageIds.indexOf(p);return g===-1?{index:null,max:null}:{index:g,max:s.imageIds.length-1}}))})),c=this._navigator.stateService.state$.pipe(We(s=>s===Oi.Earth),yi());i.push(Si(e,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(An(this._sequenceDOMRenderer)),this._navigator.playService.speed$,o,c).pipe(We(([s,f,p,,g,_,x])=>{const b=this._sequenceDOMRenderer.render(s,f,p,g,_.index,_.max,!x,this,this._navigator);return{name:this._name,vNode:b}})).subscribe(this._container.domRenderer.render$)),i.push(this._sequenceDOMRenderer.speed$.subscribe(s=>{this._navigator.playService.setSpeed(s)})),i.push(this._configuration$.pipe(We(s=>s.direction),yi()).subscribe(s=>{this._navigator.playService.setDirection(s)})),i.push(Si(this._container.renderService.size$,this._configuration$.pipe(yi((s,f)=>s[0]===f[0]&&s[1]===f[1],s=>[s.minWidth,s.maxWidth]))).pipe(We(([s,f])=>this._sequenceDOMRenderer.getContainerWidth(s,f))).subscribe(this._containerWidth$)),i.push(this._configuration$.pipe(We(s=>s.playing),yi()).subscribe(s=>{s?this._navigator.playService.play():this._navigator.playService.stop()})),i.push(this._sequenceDOMRenderer.mouseEnterDirection$.pipe(ei(s=>{const f=e.pipe(We(p=>{for(let g of p.edges)if(g.data.direction===s)return g.target;return null}),Sd(this._sequenceDOMRenderer.mouseLeaveDirection$));return Nl(f,Ai(null))}),yi()).subscribe(this._hoveredIdSubject$)),i.push(this._hoveredId$.subscribe(s=>{const f="hover",p={id:s,target:this,type:f};this.fire(f,p)}))}_deactivate(){this._subscriptions.unsubscribe(),this._sequenceDOMRenderer.deactivate()}_getDefaultConfiguration(){return{direction:Ot.Next,maxWidth:108,minWidth:70,playing:!1,visible:!0}}}iz.componentName="sequence";var Rl;(function(n){n[n.Motion=0]="Motion",n[n.Stationary=1]="Stationary"})(Rl||(Rl={}));const Ree=1e-8;class Cg{constructor(e,t,i,r,o,c,s,f,p,g){this._orientation=this._getValue(e,1);let _=s!=null?s.width:4,x=s!=null?s.height:3,b=this._orientation<5;this._width=this._getValue(t,b?_:x),this._height=this._getValue(i,b?x:_),this._basicAspect=b?this._width/this._height:this._height/this._width,this._basicWidth=b?t:i,this._basicHeight=b?i:t;const M=this._getCameraParameters(p,g),P=M[0],k=M[1],L=M[2];this._focal=this._getValue(P,1),this._scale=this._getValue(r,0),this._worldToCamera=this.createWorldToCamera(o,c),this._worldToCameraInverse=new Ri().copy(this._worldToCamera).invert(),this._scaledWorldToCamera=this._createScaledWorldToCamera(this._worldToCamera,this._scale),this._scaledWorldToCameraInverse=new Ri().copy(this._scaledWorldToCamera).invert(),this._basicWorldToCamera=this._createBasicWorldToCamera(this._worldToCamera,e),this._textureScale=f||[1,1],this._ck1=k||0,this._ck2=L||0,this._cameraType=g||"perspective",this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}get ck1(){return this._ck1}get ck2(){return this._ck2}get cameraType(){return this._cameraType}get basicAspect(){return this._basicAspect}get basicHeight(){return this._basicHeight}get basicRt(){return this._basicWorldToCamera}get basicWidth(){return this._basicWidth}get focal(){return this._focal}get height(){return this._height}get orientation(){return this._orientation}get rt(){return this._worldToCamera}get srt(){return this._scaledWorldToCamera}get srtInverse(){return this._scaledWorldToCameraInverse}get scale(){return this._scale}get hasValidScale(){return this._scale>.01&&this._scale<50}get radialPeak(){return this._radialPeak}get width(){return this._width}upVector(){let e=this._worldToCamera.elements;switch(this._orientation){case 1:return new Fe(-e[1],-e[5],-e[9]);case 3:return new Fe(e[1],e[5],e[9]);case 6:return new Fe(-e[0],-e[4],-e[8]);case 8:return new Fe(e[0],e[4],e[8]);default:return new Fe(-e[1],-e[5],-e[9])}}projectorMatrix(){let e=this._normalizedToTextureMatrix(),t=this._focal,i=new Ri().set(t,0,0,0,0,t,0,0,0,0,0,0,0,0,1,0);return e.multiply(i),e.multiply(this._worldToCamera),e}projectBasic(e){let t=this.projectSfM(e);return this._sfmToBasic(t)}unprojectBasic(e,t,i){let r=this._basicToSfm(e);return this.unprojectSfM(r,t,i)}projectSfM(e){let t=new Zn(e[0],e[1],e[2],1);return t.applyMatrix4(this._worldToCamera),this._bearingToSfm([t.x,t.y,t.z])}unprojectSfM(e,t,i){const r=this._sfmToBearing(e),c=(i&&!ki(this._cameraType)?new Zn(t*r[0]/r[2],t*r[1]/r[2],t,1):new Zn(t*r[0],t*r[1],t*r[2],1)).applyMatrix4(this._worldToCameraInverse);return[c.x/c.w,c.y/c.w,c.z/c.w]}_sfmToBearing(e){if(ki(this._cameraType)){let t=e[0]*2*Math.PI,i=-e[1]*2*Math.PI,r=Math.cos(i)*Math.sin(t),o=-Math.sin(i),c=Math.cos(i)*Math.cos(t);return[r,o,c]}else if(ow(this._cameraType)){let[t,i]=[e[0]/this._focal,e[1]/this._focal];const r=Math.sqrt(t*t+i*i);let o=this._distortionFromDistortedRadius(r,this._ck1,this._ck2,this._radialPeak),c=r/o,s=Math.cos(c),f=Math.sin(c);const p=r>Ree?1/r:1;let g=f*t*p,_=f*i*p;return[g,_,s]}else{let[t,i]=[e[0]/this._focal,e[1]/this._focal];const r=Math.sqrt(t*t+i*i);let o=this._distortionFromDistortedRadius(r,this._ck1,this._ck2,this._radialPeak);const c=t/o,s=i/o;let f=new Fe(c,s,1);return f.normalize(),[f.x,f.y,f.z]}}_distortionFromDistortedRadius(e,t,i,r){let o=1;for(let c=0;c<10;c++){let s=e/o;s>r&&(s=r),o=1+t*Math.pow(s,2)+i*Math.pow(s,4)}return o}_bearingToSfm(e){if(ki(this._cameraType)){let t=e[0],i=e[1],r=e[2],o=Math.atan2(t,r),c=Math.atan2(-i,Math.sqrt(t*t+r*r));return[o/(2*Math.PI),-c/(2*Math.PI)]}else if(ow(this._cameraType))if(e[2]>0){const[t,i,r]=e,o=Math.sqrt(t*t+i*i);let c=Math.atan2(o,r);c>this._radialPeak&&(c=this._radialPeak);const s=1+Math.pow(c,2)*(this._ck1+Math.pow(c,2)*this._ck2),f=this._focal*s*c/o;return[f*t,f*i]}else return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY];else if(e[2]>0){let[t,i]=[e[0]/e[2],e[1]/e[2]],r=t*t+i*i;const o=Math.pow(this._radialPeak,2);r>o&&(r=o);const c=1+this._ck1*r+this._ck2*Math.pow(r,2);return[this._focal*c*t,this._focal*c*i]}else return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}_basicToSfm(e){let t,i;switch(this._orientation){case 1:t=e[0],i=e[1];break;case 3:t=1-e[0],i=1-e[1];break;case 6:t=e[1],i=1-e[0];break;case 8:t=1-e[1],i=e[0];break;default:t=e[0],i=e[1];break}let r=this._width,o=this._height,c=Math.max(r,o),s=t*r/c-r/c/2,f=i*o/c-o/c/2;return[s,f]}_sfmToBasic(e){let t=this._width,i=this._height,r=Math.max(t,i),o=(e[0]+t/r/2)/t*r,c=(e[1]+i/r/2)/i*r,s,f;switch(this._orientation){case 1:s=o,f=c;break;case 3:s=1-o,f=1-c;break;case 6:s=1-c,f=o;break;case 8:s=c,f=1-o;break;default:s=o,f=c;break}return[s,f]}_getValue(e,t){return e!=null&&e>0?e:t}_getCameraParameters(e,t){if(ki(t))return[];if(!e||e.length===0)return[1,0,0];const i=3-e.length;return i<=0?e:e.concat(new Array(i).fill(0))}createWorldToCamera(e,t){const i=new Fe(e[0],e[1],e[2]),r=i.length();r>0&&i.normalize();const o=new Ri;return o.makeRotationAxis(i,r),o.setPosition(new Fe(t[0],t[1],t[2])),o}_createScaledWorldToCamera(e,t){const i=e.clone(),r=i.elements;return r[12]=t*r[12],r[13]=t*r[13],r[14]=t*r[14],i.scale(new Fe(t,t,t)),i}_createBasicWorldToCamera(e,t){const i=new Fe(0,0,1);let r=0;switch(t){case 3:r=Math.PI;break;case 6:r=Math.PI/2;break;case 8:r=3*Math.PI/2;break}return new Ri().makeRotationAxis(i,r).multiply(e)}_getRadialPeak(e,t){const i=5*t,r=3*e,c=Math.pow(r,2)-4*i*1;if(c<0)return;const s=(-r-Math.sqrt(c))/2/i,f=(-r+Math.sqrt(c))/2/i,p=Math.min(s,f),g=Math.max(s,f);return p>0?Math.sqrt(p):g>0?Math.sqrt(g):void 0}_normalizedToTextureMatrix(){const e=Math.max(this._width,this._height),t=this._orientation<5?this._textureScale[0]:this._textureScale[1],i=this._orientation<5?this._textureScale[1]:this._textureScale[0],r=e/this._width*t,o=e/this._height*i;switch(this._orientation){case 1:return new Ri().set(r,0,0,.5,0,-o,0,.5,0,0,1,0,0,0,0,1);case 3:return new Ri().set(-r,0,0,.5,0,o,0,.5,0,0,1,0,0,0,0,1);case 6:return new Ri().set(0,-o,0,.5,-r,0,0,.5,0,0,1,0,0,0,0,1);case 8:return new Ri().set(0,o,0,.5,r,0,0,.5,0,0,1,0,0,0,0,1);default:return new Ri().set(r,0,0,.5,0,-o,0,.5,0,0,1,0,0,0,0,1)}}}class kee{constructor(){this._factory=new jO,this._scene=new GO,this._spatial=new vo,this._currentKey=null,this._previousKey=null,this._disabled=!1,this._curtain=1,this._frameId=0,this._needsRender=!1,this._mode=null,this._currentProviderDisposers={},this._previousProviderDisposers={}}get disabled(){return this._disabled}get frameId(){return this._frameId}get needsRender(){return this._needsRender}setTextureProvider(e,t){this._setTextureProvider(e,this._currentKey,t,this._currentProviderDisposers,this._updateTexture.bind(this))}setTextureProviderPrev(e,t){this._setTextureProvider(e,this._previousKey,t,this._previousProviderDisposers,this._updateTexturePrev.bind(this))}update(e,t){this._updateFrameId(e.id),this._updateImagePlanes(e.state,t)}updateCurtain(e){this._curtain!==e&&(this._curtain=e,this._updateCurtain(),this._needsRender=!0)}updateTexture(e,t){const i=t.id===this._currentKey?this._scene.planes:t.id===this._previousKey?this._scene.planesOld:{};if(Object.keys(i).length!==0){this._needsRender=!0;for(const r in i){if(!i.hasOwnProperty(r))continue;let s=i[r].material.uniforms.projectorTex.value;s.image=e,s.needsUpdate=!0}}}updateTextureImage(e,t){if(this._currentKey!==t.id)return;this._needsRender=!0;const i=this._scene.planes;for(const r in i){if(!i.hasOwnProperty(r))continue;let s=i[r].material.uniforms.projectorTex.value;s.image=e,s.needsUpdate=!0}}render(e,t){this.disabled||t.render(this._scene.sceneOld,e),t.render(this._scene.scene,e),this._needsRender=!1}dispose(){this._scene.clear();for(const e in this._currentProviderDisposers)this._currentProviderDisposers.hasOwnProperty(e)&&this._currentProviderDisposers[e]();for(const e in this._previousProviderDisposers)this._previousProviderDisposers.hasOwnProperty(e)&&this._previousProviderDisposers[e]();this._currentProviderDisposers={},this._previousProviderDisposers={}}_getBasicCorners(e,t){let i,r;return e>t?(i=.5,r=.5*e/t):(i=.5*t/e,r=.5),[[.5-i,.5-r],[.5+i,.5+r]]}_setDisabled(e){this._disabled=e.currentImage==null||e.previousImage==null||ki(e.currentImage.cameraType)&&!ki(e.previousImage.cameraType)}_setTextureProvider(e,t,i,r,o){if(e!==t)return;let c=i.textureCreated$.subscribe(o),s=i.textureUpdated$.subscribe(p=>{this._needsRender=!0}),f=()=>{c.unsubscribe(),s.unsubscribe(),i.dispose()};if(e in r){let p=r[e];p(),delete r[e]}r[e]=f}_updateCurtain(){const e=this._scene.planes;for(const t in e){if(!e.hasOwnProperty(t))continue;let r=e[t].material;r.uniforms.curtain&&(r.uniforms.curtain.value=this._curtain)}}_updateFrameId(e){this._frameId=e}_updateImagePlanes(e,t){const i=e.currentImage!=null&&this._currentKey!==e.currentImage.id,r=e.previousImage!=null&&this._previousKey!==e.previousImage.id,o=this._mode!==t;if(!(i||r||o))return;this._setDisabled(e),this._needsRender=!0,this._mode=t;const c=e.motionless||t===Rl.Stationary||ki(e.currentImage.cameraType);if((this.disabled||r)&&this._previousKey in this._previousProviderDisposers&&(this._previousProviderDisposers[this._previousKey](),delete this._previousProviderDisposers[this._previousKey]),this.disabled)this._scene.setImagePlanesOld({});else if(r||o){const s=e.previousImage;this._previousKey=s.id;const f=e.currentTransform.rt.elements;let p=[f[12],f[13],f[14]];const g=e.currentTransform.basicAspect,_=e.previousTransform.basicAspect,x=g>_?[1,_/g]:[g/_,1];let b=e.currentImage.rotation,M=e.currentImage.width,P=e.currentImage.height;ki(s.cameraType)&&(b=e.previousImage.rotation,p=this._spatial.rotate(this._spatial.opticalCenter(e.currentImage.rotation,p).toArray(),b).multiplyScalar(-1).toArray(),M=e.previousImage.width,P=e.previousImage.height);const k=new Cg(e.currentImage.exifOrientation,M,P,e.currentImage.scale,b,p,s.image,x,e.currentImage.cameraParameters,e.currentImage.cameraType);let L;if(ki(s.cameraType))L=this._factory.createMesh(s,c||ki(e.currentImage.cameraType)?k:e.previousTransform);else if(c){const[[F,N],[H,Y]]=this._getBasicCorners(g,_);L=this._factory.createFlatMesh(e.previousImage,k,F,H,N,Y)}else L=this._factory.createMesh(e.previousImage,e.previousTransform);const I={};I[s.id]=L,this._scene.setImagePlanesOld(I)}if(i||o){this._currentKey in this._currentProviderDisposers&&(this._currentProviderDisposers[this._currentKey](),delete this._currentProviderDisposers[this._currentKey]),this._currentKey=e.currentImage.id;const s={};ki(e.currentImage.cameraType)?s[e.currentImage.id]=this._factory.createCurtainMesh(e.currentImage,e.currentTransform):c?s[e.currentImage.id]=this._factory.createDistortedCurtainMesh(e.currentImage,e.currentTransform):s[e.currentImage.id]=this._factory.createCurtainMesh(e.currentImage,e.currentTransform),this._scene.setImagePlanes(s),this._updateCurtain()}}_updateTexture(e){this._needsRender=!0;const t=this._scene.planes;for(const i in t){if(!t.hasOwnProperty(i))continue;let o=t[i].material,c=o.uniforms.projectorTex.value;o.uniforms.projectorTex.value=null,c.dispose(),o.uniforms.projectorTex.value=e}}_updateTexturePrev(e){this._needsRender=!0;const t=this._scene.planesOld;for(const i in t){if(!t.hasOwnProperty(i))continue;let o=t[i].material,c=o.uniforms.projectorTex.value;o.uniforms.projectorTex.value=null,c.dispose(),o.uniforms.projectorTex.value=e}}}class Dee{constructor(e){this._container=e,this._interacting=!1,this._notifyModeChanged$=new ri,this._notifyPositionChanged$=new ri,this._stopInteractionSubscription=null}get mode$(){return this._notifyModeChanged$}get position$(){return this._notifyPositionChanged$}activate(){this._stopInteractionSubscription||(this._stopInteractionSubscription=fn(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(oi(e=>e.touches.length===0))).subscribe(e=>{this._interacting&&(this._interacting=!1)}))}deactivate(){this._stopInteractionSubscription&&(this._interacting=!1,this._stopInteractionSubscription.unsubscribe(),this._stopInteractionSubscription=null)}render(e,t,i,r,o){const c=[];if(o){c.push(jt.h("div.mapillary-slider-border",[]));const p=!(i||r);p&&(c.push(this._createModeButton(t)),c.push(this._createModeButton2d(t))),c.push(this._createPositionInput(e,p))}const s=this._container.domContainer.getBoundingClientRect(),f=Math.max(215,Math.min(400,s.width-100));return jt.h("div.mapillary-slider-container",{style:{width:`${f}px`}},c)}_createModeButton(e){const t={onclick:()=>{e!==Rl.Motion&&this._notifyModeChanged$.next(Rl.Motion)}},i=e===Rl.Stationary?"mapillary-slider-mode-button-inactive":"mapillary-slider-mode-button";return jt.h("div."+i,t,[jt.h("div.mapillary-slider-mode-icon",[])])}_createModeButton2d(e){const t={onclick:()=>{e!==Rl.Stationary&&this._notifyModeChanged$.next(Rl.Stationary)}},i=e===Rl.Motion?"mapillary-slider-mode-button-2d-inactive":"mapillary-slider-mode-button-2d";return jt.h("div."+i,t,[jt.h("div.mapillary-slider-mode-icon-2d",[])])}_createPositionInput(e,t){const i=g=>{this._notifyPositionChanged$.next(Number(g.target.value)/1e3)},r=g=>{this._interacting=!0,g.stopPropagation()},o=g=>{this._interacting&&g.stopPropagation()},c=g=>{(g.key==="ArrowDown"||g.key==="ArrowLeft"||g.key==="ArrowRight"||g.key==="ArrowUp")&&g.preventDefault()},s=this._container.domContainer.getBoundingClientRect(),f=Math.max(215,Math.min(400,s.width-105))-84+(t?0:52),p=jt.h("input.mapillary-slider-position",{max:1e3,min:0,onchange:i,oninput:i,onkeydown:c,onpointerdown:r,onpointermove:o,ontouchmove:o,ontouchstart:r,style:{width:`${f}px`},type:"range",value:1e3*e},[]);return jt.h("div.mapillary-slider-position-container",[p])}}class nz extends bo{constructor(e,t,i,r){super(e,t,i),this._viewportCoords=r||new zo,this._domRenderer=new Dee(t),this._imageTileLoader=new qO(i.api),this._roiCalculator=new HO,this._spatial=new vo,this._glRendererOperation$=new ri,this._glRendererCreator$=new ri,this._glRendererDisposer$=new ri,this._glRenderer$=this._glRendererOperation$.pipe(Vr((o,c)=>c(o),null),oi(o=>o!=null),yi(void 0,o=>o.frameId)),this._glRendererCreator$.pipe(We(()=>o=>{if(o!=null)throw new Error("Multiple slider states can not be created at the same time");return new kee})).subscribe(this._glRendererOperation$),this._glRendererDisposer$.pipe(We(()=>o=>(o.dispose(),null))).subscribe(this._glRendererOperation$)}_activate(){const e=this._subscriptions;e.push(this._domRenderer.mode$.subscribe(b=>{this.configure({mode:b})})),e.push(this._glRenderer$.pipe(We(b=>({name:this._name,renderer:{frameId:b.frameId,needsRender:b.needsRender,render:b.render.bind(b),pass:Ph.Background}}))).subscribe(this._container.glRenderer.render$));const t=Nl(this.configuration$.pipe(We(b=>b.initialPosition!=null?b.initialPosition:1),wi()),this._domRenderer.position$),i=this.configuration$.pipe(We(b=>b.mode),yi()),r=this._navigator.stateService.currentState$.pipe(We(b=>b.state.motionless),yi()),o=this._navigator.stateService.currentState$.pipe(We(b=>ki(b.state.currentImage.cameraType)),yi()),c=Si(this._configuration$.pipe(We(b=>b.sliderVisible)),this._navigator.stateService.currentState$.pipe(We(b=>!(b.state.currentImage==null||b.state.previousImage==null||ki(b.state.currentImage.cameraType)&&!ki(b.state.previousImage.cameraType))),yi())).pipe(We(([b,M])=>b&&M),yi());this._waitSubscription=Si(i,r,o,c).pipe(Ui(this._navigator.stateService.state$)).subscribe(([[b,M,P,k],L])=>{const I=k&&(M||b===Rl.Stationary||P);I&&L!==Oi.WaitingInteractively?this._navigator.stateService.waitInteractively():!I&&L!==Oi.Waiting&&this._navigator.stateService.wait()}),e.push(Si(t,i,r,o,c).subscribe(([b,M,P,k])=>{P||M===Rl.Stationary||k?this._navigator.stateService.moveTo(1):this._navigator.stateService.moveTo(b)})),e.push(Si(t,i,r,o,c,this._container.renderService.size$).pipe(We(([b,M,P,k,L])=>({name:this._name,vNode:this._domRenderer.render(b,M,P,k,L)}))).subscribe(this._container.domRenderer.render$)),this._glRendererCreator$.next(null),e.push(Si(t,o,c,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(We(([b,M,P,k,L])=>{if(!M)return P?b:1;const I=this._viewportCoords.viewportToBasic(-1.15,0,L,k.perspective),F=this._viewportCoords.viewportToBasic(1.15,0,L,k.perspective),N=F[0]<I[0]?F[0]+1:F[0],H=I[0]+b*(N-I[0]);return H>1?H-1:H}),We(b=>M=>(M.updateCurtain(b),M))).subscribe(this._glRendererOperation$)),e.push(Si(this._navigator.stateService.currentState$,i).pipe(We(([b,M])=>P=>(P.update(b,M),P))).subscribe(this._glRendererOperation$)),e.push(this._configuration$.pipe(oi(b=>b.ids!=null),ei(b=>xy(xy(this._catchCacheImage$(b.ids.background),this._catchCacheImage$(b.ids.foreground)).pipe(We(M=>({background:M[0],foreground:M[1]}))),this._navigator.stateService.currentState$.pipe(wi())).pipe(We(M=>({images:M[0],state:M[1].state}))))).subscribe(b=>{if(!(b.state.currentImage!=null&&b.state.previousImage!=null&&b.state.currentImage.id===b.images.foreground.id&&b.state.previousImage.id===b.images.background.id)){if(b.state.currentImage.id===b.images.background.id){this._navigator.stateService.setImages([b.images.foreground]);return}if(b.state.currentImage.id===b.images.foreground.id&&b.state.trajectory.length===1){this._navigator.stateService.prependImages([b.images.background]);return}this._navigator.stateService.setImages([b.images.background]),this._navigator.stateService.setImages([b.images.foreground])}},b=>{console.error(b)}));const s=this._container.configurationService.imageTiling$.pipe(ei(b=>b?this._navigator.stateService.currentState$:new ri),yi(void 0,b=>b.state.currentImage.id),Ui(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),We(([b,M,P])=>{const k=b.state;Math.max(P.width,P.height);const L=k.currentImage,I=k.currentTransform;return new CM(L.id,I.basicWidth,I.basicHeight,L.image,this._imageTileLoader,new MM,M)}),Pi(1),gi());e.push(s.subscribe(()=>{})),e.push(s.pipe(We(b=>M=>(M.setTextureProvider(b.id,b),M))).subscribe(this._glRendererOperation$)),e.push(s.pipe(tl()).subscribe(b=>{b[0].abort()}));const f=this._container.configurationService.imageTiling$.pipe(ei(b=>b?Si(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(wy(250))):new ri),We(([b,M])=>[b.camera.position.clone(),b.camera.lookat.clone(),b.zoom.valueOf(),M.height.valueOf(),M.width.valueOf()]),tl(),uM(b=>b[1][2]-b[0][2]<0||b[1][2]===0),We(b=>{let M=b[0][0].equals(b[1][0]),P=b[0][1].equals(b[1][1]),k=b[0][2]===b[1][2],L=b[0][3]===b[1][3],I=b[0][4]===b[1][4];return M&&P&&k&&L&&I}),yi(),oi(b=>b),ei(()=>this._container.renderService.renderCameraFrame$.pipe(wi())),Ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(s.pipe(ei(b=>f.pipe(We(([M,P,k])=>[this._roiCalculator.computeRegionOfInterest(M,P,k),b]))),oi(b=>!b[1].disposed)).subscribe(b=>{let M=b[0];b[1].setRegionOfInterest(M)}));const p=s.pipe(ei(b=>b.hasTexture$),An(!1),Pi(1),gi());e.push(p.subscribe(()=>{}));const g=this._container.configurationService.imageTiling$.pipe(ei(b=>b?this._navigator.stateService.currentState$:new ri),oi(b=>!!b.state.previousImage),yi(void 0,b=>b.state.previousImage.id),Ui(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),We(([b,M,P])=>{const k=b.state,L=k.previousImage,I=k.previousTransform;return new CM(L.id,I.basicWidth,I.basicHeight,L.image,this._imageTileLoader,new MM,M)}),Pi(1),gi());e.push(g.subscribe(()=>{})),e.push(g.pipe(We(b=>M=>(M.setTextureProviderPrev(b.id,b),M))).subscribe(this._glRendererOperation$)),e.push(g.pipe(tl()).subscribe(b=>{b[0].abort()}));const _=this._container.configurationService.imageTiling$.pipe(ei(b=>b?Si(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(wy(250))):new ri),We(([b,M])=>[b.camera.position.clone(),b.camera.lookat.clone(),b.zoom.valueOf(),M.height.valueOf(),M.width.valueOf()]),tl(),uM(b=>b[1][2]-b[0][2]<0||b[1][2]===0),We(b=>{let M=b[0][0].equals(b[1][0]),P=b[0][1].equals(b[1][1]),k=b[0][2]===b[1][2],L=b[0][3]===b[1][3],I=b[0][4]===b[1][4];return M&&P&&k&&L&&I}),yi(),oi(b=>b),ei(()=>this._container.renderService.renderCameraFrame$.pipe(wi())),Ui(this._container.renderService.size$,this._navigator.stateService.currentTransform$));e.push(g.pipe(ei(b=>_.pipe(We(([M,P,k])=>[this._roiCalculator.computeRegionOfInterest(M,P,k),b]))),oi(b=>!b[1].disposed),Ui(this._navigator.stateService.currentState$)).subscribe(([[b,M],P])=>{let k=null;if(ki(P.state.previousImage.cameraType))if(ki(P.state.currentImage.cameraType)){const L=this._spatial.viewingDirection(P.state.currentImage.rotation),I=this._spatial.viewingDirection(P.state.previousImage.rotation),N=this._spatial.angleBetweenVector2(L.x,L.y,I.x,I.y)/(2*Math.PI);k={bbox:{maxX:this._spatial.wrap(b.bbox.maxX+N,0,1),maxY:b.bbox.maxY,minX:this._spatial.wrap(b.bbox.minX+N,0,1),minY:b.bbox.minY},pixelHeight:b.pixelHeight,pixelWidth:b.pixelWidth}}else{const L=this._spatial.viewingDirection(P.state.currentImage.rotation),I=this._spatial.viewingDirection(P.state.previousImage.rotation),N=this._spatial.angleBetweenVector2(L.x,L.y,I.x,I.y)/(2*Math.PI),H=this._spatial.angleToPlane(L.toArray(),[0,0,1]),q=(this._spatial.angleToPlane(I.toArray(),[0,0,1])-H)/(2*Math.PI),U=P.state.currentTransform,G=Math.max(U.basicWidth,U.basicHeight),j=G>0?2*Math.atan(.5*U.basicWidth/(G*U.focal)):Math.PI/3,B=G>0?2*Math.atan(.5*U.basicHeight/(G*U.focal)):Math.PI/3,ne=j/(2*Math.PI),J=B/Math.PI,le=(b.bbox.maxX-b.bbox.minX)*ne,ae=(b.bbox.maxY-b.bbox.minY)*J,pe=b.pixelWidth*ne,fe=b.pixelHeight*J,Te=(b.bbox.minX+b.bbox.maxX)/2-.5,Ce=(b.bbox.minY+b.bbox.maxY)/2-.5,tt=.5+N+ne*Te-le/2,Ke=.5+N+ne*Te+le/2,dt=.5+q+J*Ce-ae/2,et=.5+q+J*Ce+ae/2;k={bbox:{maxX:this._spatial.wrap(Ke,0,1),maxY:et,minX:this._spatial.wrap(tt,0,1),minY:dt},pixelHeight:fe,pixelWidth:pe}}else{const L=P.state.currentTransform.basicAspect,I=P.state.previousTransform.basicAspect,[[F,N],[H,Y]]=this._getBasicCorners(L,I),q=H-F,U=Y-N,G=b.pixelWidth/q,j=b.pixelHeight/U,B=(q-1)/(2*q)+b.bbox.minX/q,ne=(q-1)/(2*q)+b.bbox.maxX/q,J=(U-1)/(2*U)+b.bbox.minY/U,le=(U-1)/(2*U)+b.bbox.maxY/U,ae={maxX:ne,maxY:le,minX:B,minY:J};this._clipBoundingBox(ae),k={bbox:ae,pixelHeight:j,pixelWidth:G}}M.setRegionOfInterest(k)}));const x=g.pipe(ei(b=>b.hasTexture$),An(!1),Pi(1),gi());e.push(x.subscribe(()=>{}))}_deactivate(){this._waitSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(wi()).subscribe(e=>{e!==Oi.Traversing&&this._navigator.stateService.traverse()}),this._glRendererDisposer$.next(null),this._domRenderer.deactivate(),this._subscriptions.unsubscribe(),this.configure({ids:null})}_getDefaultConfiguration(){return{initialPosition:1,mode:Rl.Motion,sliderVisible:!0}}_catchCacheImage$(e){return this._navigator.graphService.cacheImage$(e).pipe(Nn(t=>(console.error(`Failed to cache slider image (${e})`,t),zi())))}_getBasicCorners(e,t){let i,r;return e>t?(i=.5,r=.5*e/t):(i=.5*t/e,r=.5),[[.5-i,.5-r],[.5+i,.5+r]]}_clipBoundingBox(e){e.minX=Math.max(0,Math.min(1,e.minX)),e.maxX=Math.max(0,Math.min(1,e.maxX)),e.minY=Math.max(0,Math.min(1,e.minY)),e.maxY=Math.max(0,Math.min(1,e.maxY))}}nz.componentName="slider";class c0{constructor(e,t){this._subscriptions=new yo,this._graphService=e,this._stateService=t;const i=this._subscriptions;this._directionSubject$=new ri,this._direction$=this._directionSubject$.pipe(An(Ot.Next),Pi(1),gi()),i.push(this._direction$.subscribe()),this._playing=!1,this._playingSubject$=new ri,this._playing$=this._playingSubject$.pipe(An(this._playing),Pi(1),gi()),i.push(this._playing$.subscribe()),this._speed=.5,this._speedSubject$=new ri,this._speed$=this._speedSubject$.pipe(An(this._speed),Pi(1),gi()),i.push(this._speed$.subscribe()),this._imagesAhead=this._mapImagesAhead(this._mapSpeed(this._speed)),this._bridging$=null}get playing(){return this._playing}get direction$(){return this._direction$}get playing$(){return this._playing$}get speed$(){return this._speed$}play(){if(this._playing)return;this._stateService.cutImages();const e=this._setSpeed(this._speed);this._stateService.setSpeed(e),this._graphModeSubscription=this._speed$.pipe(We(i=>i>c0.sequenceSpeed?na.Sequence:na.Spatial),yi()).subscribe(i=>{this._graphService.setGraphMode(i)}),this._cacheSubscription=Si(this._stateService.currentImage$.pipe(We(i=>[i.sequenceId,i.id]),yi(void 0,([i])=>i)),this._graphService.graphMode$,this._direction$).pipe(ei(([[i,r],o,c])=>{if(c!==Ot.Next&&c!==Ot.Prev)return Ai([void 0,c]);const s=(o===na.Sequence?this._graphService.cacheSequenceImages$(i,r):this._graphService.cacheSequence$(i)).pipe(cM(3),Nn(f=>(console.error(f),Ai(void 0))));return Si(s,Ai(c))}),ei(([i,r])=>{if(i===void 0)return zi();const o=i.imageIds.slice();return r===Ot.Prev&&o.reverse(),this._stateService.currentState$.pipe(We(c=>[c.state.trajectory[c.state.trajectory.length-1].id,c.state.imagesAhead]),Vr(([c,s],[f,p])=>{c===void 0&&(c=f);const g=o.length-1;if(p>=this._imagesAhead||o[g]===c)return[c,[]];const _=o.indexOf(f),x=o.indexOf(c)+1,b=Math.min(g,_+this._imagesAhead-p)+1;return b<=x?[c,[]]:[o[b-1],o.slice(x,b)]},[void 0,[]]),Wi(([c,s])=>Fr(s)))}),Wi(i=>this._graphService.cacheImage$(i).pipe(Nn(()=>zi())),6)).subscribe(),this._playingSubscription=this._stateService.currentState$.pipe(oi(i=>i.state.imagesAhead<this._imagesAhead),yi(void 0,i=>i.state.lastImage.id),We(i=>{const r=i.state.lastImage,o=i.state.trajectory;let c;for(let s=o.length-2;s>=0;s--){const f=o[s];if(f.sequenceId!==r.sequenceId)break;if(f.capturedAt!==r.capturedAt){c=f.capturedAt<r.capturedAt;break}}return[i.state.lastImage,c]}),Ui(this._direction$),ei(([[i,r],o])=>xy(([Ot.Next,Ot.Prev].indexOf(o)>-1?i.sequenceEdges$:i.spatialEdges$).pipe(wi(c=>c.cached),aM(15e3)),Ai(o)).pipe(We(([c,s])=>{for(let f of c.edges)if(f.data.direction===s)return f.target;return null}),ei(c=>c!=null?this._graphService.cacheImage$(c):zi())))).subscribe(i=>{this._stateService.appendImagess([i])},i=>{console.error(i),this.stop()}),this._clearSubscription=this._stateService.currentImage$.pipe(Kx(1,10)).subscribe(i=>{this._stateService.clearPriorImages()}),this._setPlaying(!0);const t=this._stateService.currentState$.pipe(We(i=>i.state),yi(([i,r],[o,c])=>i===o&&r===c,i=>[i.currentImage.id,i.lastImage.id]),oi(i=>i.currentImage.id===i.lastImage.id&&i.currentIndex===i.trajectory.length-1),We(i=>i.currentImage));this._stopSubscription=Si(t,this._direction$).pipe(ei(([i,r])=>{const o=([Ot.Next,Ot.Prev].indexOf(r)>-1?i.sequenceEdges$:i.spatialEdges$).pipe(wi(c=>c.cached),aM(15e3),Nn(c=>(console.error(c),Ai({cached:!1,edges:[]}))));return Si(Ai(r),o).pipe(We(([c,s])=>{for(const f of s.edges)if(f.data.direction===c)return!0;return!1}))}),Wi(i=>i||!this._bridging$?Ai(i):this._bridging$.pipe(We(r=>r!=null),Nn(r=>(console.error(r),Ai(!1))))),wi(i=>!i)).subscribe(void 0,void 0,()=>{this.stop()}),this._stopSubscription.closed&&(this._stopSubscription=null),this._earthSubscription=this._stateService.state$.pipe(We(i=>i===Oi.Earth),yi(),wi(i=>i)).subscribe(void 0,void 0,()=>{this.stop()}),this._earthSubscription.closed&&(this._earthSubscription=null)}dispose(){this.stop(),this._subscriptions.unsubscribe()}setDirection(e){this._directionSubject$.next(e)}setSpeed(e){if(e=Math.max(0,Math.min(1,e)),e===this._speed)return;const t=this._setSpeed(e);this._playing&&this._stateService.setSpeed(t),this._speedSubject$.next(this._speed)}stop(){this._playing&&(this._stopSubscription&&(this._stopSubscription.closed||this._stopSubscription.unsubscribe(),this._stopSubscription=null),this._earthSubscription&&(this._earthSubscription.closed||this._earthSubscription.unsubscribe(),this._earthSubscription=null),this._graphModeSubscription.unsubscribe(),this._graphModeSubscription=null,this._cacheSubscription.unsubscribe(),this._cacheSubscription=null,this._playingSubscription.unsubscribe(),this._playingSubscription=null,this._clearSubscription.unsubscribe(),this._clearSubscription=null,this._stateService.setSpeed(1),this._stateService.cutImages(),this._graphService.setGraphMode(na.Spatial),this._setPlaying(!1))}_mapSpeed(e){const t=2*e-1;return Math.pow(10,t)-.2*t}_mapImagesAhead(e){return Math.round(Math.max(10,Math.min(50,8+6*e)))}_setPlaying(e){this._playing=e,this._playingSubject$.next(e)}_setSpeed(e){this._speed=e;const t=this._mapSpeed(this._speed);return this._imagesAhead=this._mapImagesAhead(t),t}}c0.sequenceSpeed=.54;var Dl;(function(n){n[n.Hidden=0]="Hidden",n[n.Homogeneous=1]="Homogeneous",n[n.Cluster=2]="Cluster",n[n.ConnectedComponent=3]="ConnectedComponent",n[n.Sequence=4]="Sequence"})(Dl||(Dl={}));var Dy;(function(n){n[n.Hidden=0]="Hidden",n[n.Altitude=1]="Altitude",n[n.Flat=2]="Flat"})(Dy||(Dy={}));class Fee extends $F{constructor(e){super(),this._originalSize=e.originalSize;const{cluster:t,color:i,scale:r,translation:o}=e;this._makeAttributes(t),this.material.size=r*this._originalSize,this.setColor(i),this.matrixAutoUpdate=!1,this.position.fromArray(o),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setColor(e){this.material.vertexColors=e==null,this.material.color=new Bi(e),this.material.needsUpdate=!0}resize(e){this.material.size=e*this._originalSize,this.material.needsUpdate=!0}_makeAttributes(e){const t=[],i=[],r=e.points;for(const c in r){if(!r.hasOwnProperty(c))continue;const s=r[c];t.push(...s.coordinates);const f=s.color;i.push(f[0]),i.push(f[1]),i.push(f[2])}const o=this.geometry;o.setAttribute("position",new Mn(new Float32Array(t),3)),o.setAttribute("color",new Mn(new Float32Array(i),3))}}class Oee extends Sp{constructor(e){super(),this._makeAttributes(e),this.matrixAutoUpdate=!1,this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}_makeAttributes(e){const t=e.slice();t.push(e[0]);let i=0;const r=new Float32Array(3*(e.length+1));for(const o of t)r[i++]=o[0],r[i++]=o[1],r[i++]=o[2];this.geometry.setAttribute("position",new Mn(r,3))}}const zee=14,Bee=6;function eL(n,e){return n===e}function Nee(n){return Math.pow(2,n)}function $ee(n){const t=Nee(n)/2;return{min:[-t,-t,-t],max:[t,t,t]}}class hC{constructor(e,t,i,r){this.level=e,this.leafLevel=t,this.boundingBox=i,this.parent=r,this.children=[],this.items=[],r&&r.children.push(this)}get isEmpty(){return!(this.children.length||this.items.length)}add(e){const t=this;if(!t.boundingBox.containsPoint(e.position))throw new Error("Item not contained in node");if(eL(t.level,t.leafLevel))return t.items.push(e),this;for(const i of t.children)if(i.boundingBox.containsPoint(e.position))return i.add(e);for(const i of t._generateBoundingBoxes())if(i.containsPoint(e.position))return new hC(t.level-1,t.leafLevel,i,t).add(e);throw new Error("Item not contained in children")}intersect(e,t,i){if(e.intersectBox(this.boundingBox,t)){if(eL(this.level,this.leafLevel)){i.push(this);return}for(const r of this.children)r.intersect(e,t,i)}}remove(e){const t=this.items.indexOf(e);if(t<0)throw new Error(`Item does not exist ${e.uuid}`);this.items.splice(t,1)}traverse(){const e=this;if(!e.isEmpty)return;const t=e.parent;if(!t)return;const i=t.children.indexOf(e);if(i<0)throw new Error("Corrupt octree");t.children.splice(i,1),this.parent=null,t.traverse()}_generateBoundingBoxes(){const e=this,t=e.boundingBox.min,r=(e.boundingBox.max.x-t.x)/2,o=[[t.x,t.y+r,t.z+r],[t.x+r,t.y+r,t.z+r],[t.x,t.y,t.z+r],[t.x+r,t.y,t.z+r],[t.x,t.y+r,t.z],[t.x+r,t.y+r,t.z],[t.x,t.y,t.z],[t.x+r,t.y,t.z]],c=[];for(const[s,f,p]of o)c.push(new cl(new Fe(s,f,p),new Fe(s+r,f+r,p+r)));return c}}class Vee{constructor(e,t){if(this.rootLevel=e,this.leafLevel=t,t>e)throw new Error;this._index=new Map,this._root=this._makeRoot()}get root(){return this._root}add(e){if(!this.root.boundingBox.containsPoint(e.position)){console.warn(`Object outside bounding box ${e.uuid}`);return}const t=this._root.add(e);this._index.set(e.uuid,t)}has(e){return this._index.has(e.uuid)}intersect(e){const t=[],i=new Fe;return this._root.intersect(e,i,t),t.map(r=>r.items).reduce((r,o)=>(r.push(...o),r),[])}reset(){this._root=this._makeRoot(),this._index.clear()}remove(e){if(!this.has(e))throw new Error(`Frame does not exist ${e.uuid}`);const t=this._index.get(e.uuid);t.remove(e),t.traverse(),this._index.delete(e.uuid)}_makeRoot(){const e=this.rootLevel,t=$ee(e),i=new cl(new Fe().fromArray(t.min),new Fe().fromArray(t.max));return new hC(e,this.leafLevel,i)}}class Uee{constructor(e,t){this._objects=[],this._objectImageMap=new Map,this._octree=e??new Vee(zee,Bee),this._raycaster=t??new sw,this._interactiveLayer=1,this._raycaster=t||new sw(void 0,void 0,1,1e4),this._lineThreshold=.2,this._largeLineThreshold=.4,this._raycaster.params.Line.threshold=this._lineThreshold,this._raycaster.layers.set(this._interactiveLayer)}get interactiveLayer(){return this._interactiveLayer}get octree(){return this._octree}get raycaster(){return this._raycaster}add(e,t){const i=e.uuid;this._objectImageMap.set(i,t),this._objects.push(e),this._octree.add(e)}intersectObjects(e,t){this._raycaster.setFromCamera(new li().fromArray(e),t);const i=this._octree.intersect(this.raycaster.ray),r=this._raycaster.intersectObjects(i),o=this._objectImageMap;for(const c of r){const s=c.object.uuid;if(o.has(s))return o.get(s)}return null}remove(e){const t=this._objects,i=t.indexOf(e);if(i!==-1){const r=t.splice(i,1);for(const o of r)this._objectImageMap.delete(o.uuid);this._octree.remove(e)}else console.warn("Object does not exist")}resetIntersectionThreshold(e){this._raycaster.params.Line.threshold=e?this._largeLineThreshold:this._lineThreshold}}class jee extends Sp{constructor(e){super(e.geometry,e.material);const t=e.mode,i=e.originalOrigin,o=e.transform.unprojectBasic([0,0],0);this._relativeAltitude=i[2]-o[2],this._makeAttributes(o,i,t),this.matrixAutoUpdate=!1,this.position.fromArray(o),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setMode(e){const t=this.geometry.attributes.position,i=t.array;i[5]=this._modeToAltitude(e),t.needsUpdate=!0,this.geometry.computeBoundingSphere()}_makeAttributes(e,t,i){const r=new Float32Array(6);r[0]=0,r[1]=0,r[2]=0,r[3]=t[0]-e[0],r[4]=t[1]-e[1],r[5]=this._modeToAltitude(i);const o=new Mn(r,3);this.geometry.setAttribute("position",o),o.needsUpdate=!0,this.geometry.computeBoundingSphere()}_modeToAltitude(e){return e===Dy.Altitude?this._relativeAltitude:0}}class rz extends Uw{constructor(e){super(e.geometry,e.material);const t=e.color,i=e.size,r=e.scale,o=e.transform,c=o.unprojectBasic([0,0],0),s=this._makePositions(i,o,c);this._makeAttributes(s,t),this.geometry.computeBoundingSphere(),this.geometry.computeBoundingBox(),this.matrixAutoUpdate=!1,this.position.fromArray(c),this.scale.set(r,r,r),this.updateMatrix(),this.updateMatrixWorld(!1)}dispose(){this.geometry.dispose(),this.material.dispose()}setColor(e){return this._updateColorAttribute(e),this}resize(e){return this.scale.set(e,e,e),this.updateMatrix(),this.updateMatrixWorld(!1),this}_makeAttributes(e,t){const i=this.geometry,r=new Mn(new Float32Array(e),3);i.setAttribute("position",r),r.needsUpdate=!0;const o=new Mn(new Float32Array(e.length),3);i.setAttribute("color",o),this._updateColorAttribute(t)}_updateColorAttribute(e){const[t,i,r]=new Bi(e).toArray(),o=this.geometry.attributes.color,c=o.array,s=c.length;let f=0;for(let p=0;p<s;p++)c[f++]=t,c[f++]=i,c[f++]=r;o.needsUpdate=!0}}class Gee extends rz{_makePositions(e,t,i){const o=[];o.push(...this._makeAxis(e,t,i)),o.push(...this._makeLat(.5,10,e,t,i));for(const c of[0,.25,.5,.75])o.push(...this._makeLng(c,10,e,t,i));return o}_makeAxis(e,t,i){const r=t.unprojectBasic([.5,1],.8*e),o=t.unprojectBasic([.5,0],1.2*e);return[r[0]-i[0],r[1]-i[1],r[2]-i[2],o[0]-i[0],o[1]-i[1],o[2]-i[2]]}_makeLat(e,t,i,r,o){const c=.8*i,[s,f,p]=o,g=[],_=r.unprojectBasic([0,e],c);_[0]-=s,_[1]-=f,_[2]-=p,g.push(..._);for(let x=1;x<=t;x++){const b=r.unprojectBasic([x/t,e],c);b[0]-=s,b[1]-=f,b[2]-=p,g.push(...b,...b)}return g.push(..._),g}_makeLng(e,t,i,r,o){const c=.8*i,[s,f,p]=o,g=[],_=r.unprojectBasic([e,0],c);_[0]-=s,_[1]-=f,_[2]-=p,g.push(..._);for(let x=0;x<=t;x++){const b=r.unprojectBasic([e,x/t],c);b[0]-=s,b[1]-=f,b[2]-=p,g.push(...b,...b)}return g.push(..._),g}}class qee extends rz{_makePositions(e,t,i){const o=[];return o.push(...this._makeDiags(e,t,i)),o.push(...this._makeFrame(e,8,t,i)),o}_makeDiags(e,t,i){const[r,o,c]=i,s=[0,0,0],f=[];for(const p of[[0,0],[1,0],[1,1],[0,1]]){const g=t.unprojectBasic(p,e);g[0]-=r,g[1]-=o,g[2]-=c,f.push(...s,...g)}return f}_makeFrame(e,t,i,r){const o=[];o.push(...this._subsample([0,1],[0,0],t)),o.push(...this._subsample([0,0],[1,0],t)),o.push(...this._subsample([1,0],[1,1],t));const[c,s,f]=r,p=[];for(const g of o){const _=i.unprojectBasic(g,e);_[0]-=c,_[1]-=s,_[2]-=f,p.push(..._)}return p}_interpolate(e,t,i){return e+i*(t-e)}_subsample(e,t,i){if(i<1)return[e,t];const r=[];r.push(e);for(let o=0;o<=i;o++){const c=[];for(let s=0;s<3;s++)c.push(this._interpolate(e[s],t[s],o/(i+1)));r.push(c),r.push(c)}return r.push(t),r}}function dw(n,e,t){const[i,r,o]=e,[c,s,f]=dp(i,r,o,t.lng,t.lat,t.alt);return ta(c,s,f,n.lng,n.lat,n.alt)}class Hee{constructor(e,t,i){this.id=e,this._scene=t,this._intersection=i,this.cameras=new Rn,this.keys=[],this._positionLines={},this._positions=new Rn,this._cameraFrames={},this._clusters=new Map,this._connectedComponents=new Map,this._sequences=new Map,this._props={},this.clusterVisibles={},this._frameMaterial=new Ah({fog:!1,vertexColors:!0}),this._positionMaterial=new Ah({fog:!1,color:16711680}),this._scene.add(this.cameras,this._positions)}addImage(e){const t=e.image,i=t.id;if(this.hasImage(i))throw new Error(`Image exists ${i}`);const r=e.idMap.ccId;this._connectedComponents.has(r)||this._connectedComponents.set(r,[]);const o=e.idMap.clusterId;this._clusters.has(o)||this._clusters.set(o,[]);const c=e.idMap.sequenceId;this._sequences.has(c)||this._sequences.set(c,[]),this._props[i]={image:t,ids:{ccId:r,clusterId:o,sequenceId:c}},this.keys.push(i)}applyCameraColor(e,t){this._cameraFrames[e].setColor(t)}applyCameraSize(e){for(const t of this.cameras.children)t.resize(e)}applyFilter(e){var t;const i=this.clusterVisibles;for(const s in i)i.hasOwnProperty(s)&&(i[s]=!1);const r=this._cameraFrames,o=this._positionLines,c=this._intersection.interactiveLayer;for(const s of Object.values(this._props)){const f=s.image,p=e(f),g=f.id;o[g].visible=p;const _=r[g];this._setCameraVisibility(_,p,c),i[t=s.ids.clusterId]||(i[t]=p)}}applyPositionMode(e){this._positions.visible=e!==Dy.Hidden;for(const t of this._positions.children)t.setMode(e)}dispose(){this._disposeCameras(),this._disposePositions(),this._scene=null,this._intersection=null}getCamerasByMode(e){if(e===Dl.Cluster)return this._clusters;if(e===Dl.ConnectedComponent)return this._connectedComponents;if(e===Dl.Sequence)return this._sequences;const t=Dl,i=t[t.Homogeneous],r=new Map;return r.set(i,this.cameras.children),r}getColorId(e,t){const i=this._props[e],r=Dl;switch(t){case r.Cluster:return i.ids.clusterId;case r.ConnectedComponent:return i.ids.ccId;case r.Sequence:return i.ids.sequenceId;default:return r[r.Homogeneous]}}hasImage(e){return this.keys.indexOf(e)!==-1}resetReference(e,t){const i=this._cameraFrames;for(const o in i){if(!i.hasOwnProperty(o))continue;const c=i[o];c.position.fromArray(dw(e,c.position.toArray(),t))}const r=this._positionLines;for(const o in r){if(!r.hasOwnProperty(o))continue;const c=r[o];c.position.fromArray(dw(e,c.position.toArray(),t))}}visualize(e){var t,i;const r=e.id,o=e.visible,c=e.transform,s={color:e.color,material:this._frameMaterial,scale:e.scale,size:e.maxSize,transform:c},f=ki(c.cameraType)?new Gee(s):new qee(s),p=this._intersection.interactiveLayer;this._setCameraVisibility(f,o,p),this.cameras.add(f),this._cameraFrames[r]=f,this._intersection.add(f,r);const _=this._props[r].ids;(t=this.clusterVisibles)[i=_.clusterId]||(t[i]=o),this._connectedComponents.get(_.ccId).push(f),this._clusters.get(_.clusterId).push(f),this._sequences.get(_.sequenceId).push(f);const x={material:this._positionMaterial,mode:e.positionMode,originalOrigin:e.originalPosition,transform:c},b=new jee(x);b.visible=o,this._positions.add(b),this._positionLines[r]=b}_disposeCameras(){const e=this._intersection,t=this.cameras;for(const i of t.children.slice())i.dispose(),e.remove(i),t.remove(i);this._scene.remove(this.cameras)}_disposePositions(){const e=this._positions;for(const t of e.children.slice())t.dispose(),e.remove(t);this._scene.remove(this._positions)}_setCameraVisibility(e,t,i){e.visible=t,t?e.layers.enable(i):e.layers.disable(i)}}class Wee{constructor(){this._colors=new Map;const e=Dl;this._colors.set(e[e.Homogeneous],"#FFFFFF")}getColor(e){const t=this._colors;return t.has(e)||t.set(e,this._randomColor()),t.get(e)}_randomColor(){return`hsl(${Math.floor(360*Math.random())}, 100%, 50%)`}}function EM(n){return n!==Dl.Hidden}function Zee(n){return n===Oi.Custom||n===Oi.Earth}var tu;(function(n){n[n.Hidden=0]="Hidden",n[n.Original=1]="Original",n[n.Cluster=2]="Cluster"})(tu||(tu={}));const Xee="NO_CLUSTER_ID",Yee="NO_MERGE_ID",Kee="NO_SEQUENCE_ID";class Jee{constructor(e,t){this._rayNearScale=1.1,this._originalPointSize=2,this._originalCameraSize=2,this._imageCellMap=new Map,this._scene=t||new _h,this._scene.autoUpdate=!1,this._intersection=new Uee,this._assets=new Wee,this._needsRender=!1,this._images={},this._cells={},this._cellClusters={},this._clusters={},this._cameraVisualizationMode=e.cameraVisualizationMode?e.cameraVisualizationMode:Dl.Homogeneous,this._cameraSize=e.cameraSize,this._pointSize=e.pointSize,this._pointVisualizationMode=e.pointVisualizationMode?e.pointVisualizationMode:tu.Original,this._positionMode=e.originalPositionMode,this._cellsVisible=e.cellsVisible,this._hoveredId=null,this._selectedId=null,this._colors={hover:"#FF0000",select:"#FF8000"},this._filter=()=>!0}get needsRender(){return this._needsRender}get intersection(){return this._intersection}addCluster(e,t,i){if(this.hasCluster(e.id,i))return;const r=e.id;if(!(r in this._clusters)){this._clusters[r]={points:new Rn,cellIds:[]};const o=this._getClusterVisible(r),c=this._clusters[r],s=this._pointVisualizationMode===tu.Cluster?this._assets.getColor(r):null,f=new Fee({cluster:e,color:s,originalSize:this._originalPointSize,scale:this._pointSize,translation:t});c.points.visible=o,c.points.add(f),this._scene.add(c.points)}this._clusters[r].cellIds.indexOf(i)===-1&&this._clusters[r].cellIds.push(i),i in this._cellClusters||(this._cellClusters[i]={keys:[]}),this._cellClusters[i].keys.indexOf(r)===-1&&this._cellClusters[i].keys.push(r),this._needsRender=!0}addImage(e,t,i,r){var o,c,s;const f=e.id,p={clusterId:(o=e.clusterId)!==null&&o!==void 0?o:Xee,sequenceId:(c=e.sequenceId)!==null&&c!==void 0?c:Kee,ccId:(s=e.mergeId)!==null&&s!==void 0?s:Yee};if(!(r in this._images)){const M=new Hee(r,this._scene,this._intersection);M.cameras.visible=EM(this._cameraVisualizationMode),M.applyPositionMode(this._positionMode),this._images[r]=M}const g=this._images[r];if(g.hasImage(f))return;g.addImage({idMap:p,image:e});const _=g.getColorId(f,this._cameraVisualizationMode),x=this._assets.getColor(_),b=this._filter(e);if(g.visualize({id:f,color:x,positionMode:this._positionMode,scale:this._cameraSize,transform:t,visible:b,maxSize:this._originalCameraSize,originalPosition:i}),this._imageCellMap.set(f,r),f===this._selectedId&&this._highlight(f,this._colors.select,this._cameraVisualizationMode),p.clusterId in this._clusters){const M=this._getClusterVisible(p.clusterId);this._clusters[p.clusterId].points.visible=M}this._needsRender=!0}addCell(e,t){if(this.hasCell(t))return;const i=new Oee(e);this._cells[t]=new Rn,this._cells[t].visible=this._cellsVisible,this._cells[t].add(i),this._scene.add(this._cells[t]),this._needsRender=!0}deactivate(){this._filter=()=>!0,this._selectedId=null,this._hoveredId=null,this.uncache()}hasCluster(e,t){return e in this._clusters&&this._clusters[e].cellIds.indexOf(t)!==-1}hasCell(e){return e in this._cells}hasImage(e,t){return t in this._images&&this._images[t].hasImage(e)}render(e,t){t.render(this._scene,e),this._needsRender=!1}resetReference(e,t){const i=this._clusters;for(const c in i){if(!i.hasOwnProperty(c))continue;const s=i[c];s.points.position.fromArray(dw(e,s.points.position.toArray(),t))}const r=this._cells;for(const c in r){if(!r.hasOwnProperty(c))continue;const s=r[c];s.position.fromArray(dw(e,s.position.toArray(),t))}const o=this._images;for(const c in o){if(!o.hasOwnProperty(c))continue;o[c].resetReference(e,t)}}setCameraSize(e){if(Math.abs(e-this._cameraSize)<.001)return;const t=this._images;for(const i of Object.keys(t))t[i].applyCameraSize(e);this._intersection.raycaster.near=this._getNear(e),this._cameraSize=e,this._needsRender=!0}setFilter(e){this._filter=e;const t={};for(const r of Object.values(this._images)){r.applyFilter(e);const o=r.clusterVisibles;for(const c in o)o.hasOwnProperty(c)&&(c in t||(t[c]=!1),t[c]||(t[c]=o[c]))}const i=this._pointVisualizationMode!==tu.Hidden;for(const r in t){if(!t.hasOwnProperty(r))continue;t[r]&&(t[r]=i);const o=t[r];r in this._clusters&&(this._clusters[r].points.visible=o)}this._needsRender=!0}setHoveredImage(e){if(e!=null&&!this._imageCellMap.has(e))throw new cr(`Image does not exist: ${e}`);this._hoveredId!==e&&(this._needsRender=!0,this._hoveredId!=null&&(this._hoveredId===this._selectedId?this._highlight(this._hoveredId,this._colors.select,this._cameraVisualizationMode):this._resetCameraColor(this._hoveredId)),this._highlight(e,this._colors.hover,this._cameraVisualizationMode),this._hoveredId=e)}setNavigationState(e){this._intersection.resetIntersectionThreshold(e)}setPointSize(e){if(Math.abs(e-this._pointSize)<.001)return;const t=this._clusters;for(const i in t)if(t.hasOwnProperty(i))for(const r of t[i].points.children)r.resize(e);this._pointSize=e,this._needsRender=!0}setPointVisualizationMode(e){if(e!==this._pointVisualizationMode){this._pointVisualizationMode=e;for(const t in this._clusters){if(!this._clusters.hasOwnProperty(t))continue;const i=this._clusters[t];i.points.visible=this._getClusterVisible(t);for(const r of i.points.children){const o=e===tu.Cluster?this._assets.getColor(t):null;r.setColor(o)}}this._needsRender=!0}}setPositionMode(e){if(e!==this._positionMode){for(const t of Object.values(this._images))t.applyPositionMode(e);this._positionMode=e,this._needsRender=!0}}setSelectedImage(e){this._selectedId!==e&&(this._needsRender=!0,this._selectedId!=null&&this._resetCameraColor(this._selectedId),this._highlight(e,this._colors.select,this._cameraVisualizationMode),this._selectedId=e)}setCellVisibility(e){if(e!==this._cellsVisible){for(const t in this._cells)this._cells.hasOwnProperty(t)&&(this._cells[t].visible=e);this._cellsVisible=e,this._needsRender=!0}}setCameraVisualizationMode(e){if(e===this._cameraVisualizationMode)return;const t=EM(e),i=this._assets;for(const r of Object.values(this._images))r.cameras.visible=t,r.getCamerasByMode(e).forEach((c,s)=>{const f=i.getColor(s);for(const p of c)p.setColor(f)});this._highlight(this._hoveredId,this._colors.hover,e),this._highlight(this._selectedId,this._colors.select,e),this._cameraVisualizationMode=e,this._needsRender=!0}uncache(e){for(const t of Object.keys(this._cellClusters))e&&e.indexOf(t)!==-1||this._disposeReconstruction(t);for(const t of Object.keys(this._images)){if(e&&e.indexOf(t)!==-1)continue;const i=this._imageCellMap,r=this._images[t].keys;for(const o of r)i.delete(o);this._images[t].dispose(),delete this._images[t]}for(const t of Object.keys(this._cells))e&&e.indexOf(t)!==-1||this._disposeCell(t);this._needsRender=!0}_getClusterVisible(e){if(this._pointVisualizationMode===tu.Hidden)return!1;let t=!1;for(const i of Object.values(this._images)){const r=i.clusterVisibles;e in r&&(t||(t=r[e]))}return t}_disposePoints(e){for(const t of this._cellClusters[e].keys){if(!(t in this._clusters))continue;const i=this._clusters[t].cellIds.indexOf(e);if(i!==-1&&(this._clusters[t].cellIds.splice(i,1),!(this._clusters[t].cellIds.length>0))){for(const r of this._clusters[t].points.children.slice())r.dispose();this._scene.remove(this._clusters[t].points),delete this._clusters[t]}}}_disposeReconstruction(e){this._disposePoints(e),delete this._cellClusters[e]}_disposeCell(e){const t=this._cells[e];for(const i of t.children.slice())i.dispose(),t.remove(i);this._scene.remove(t),delete this._cells[e]}_getNear(e){const t=this._rayNearScale*this._originalCameraSize*e;return Math.max(1,t)}_resetCameraColor(e){const t=this._imageCellMap;if(e==null||!t.has(e))return;const i=t.get(e),r=this._images[i],o=r.getColorId(e,this._cameraVisualizationMode),c=this._assets.getColor(o);r.applyCameraColor(e,c)}_highlight(e,t,i){const r=this._imageCellMap;if(e==null||!r.has(e))return;const o=r.get(e);t=i===Dl.Homogeneous?t:"#FFFFFF",this._images[o].applyCameraColor(e,t)}}class Qee{constructor(e,t){this._graphService=e,this._data=t,this._cells={},this._cacheRequests={},this._clusters={},this._clusterCells={},this._cellClusters={},this._cachingCells$={},this._cachingClusters$={}}cacheClusters$(e){if(!this.hasCell(e))throw new Error("Cannot cache reconstructions of a non-existing cell.");if(this.hasClusters(e))throw new Error("Cannot cache reconstructions that already exists.");if(this.isCachingClusters(e))return this._cachingClusters$[e];const t=this.getCell(e).filter(c=>!!c.clusterId&&!!c.clusterUrl).map(c=>({key:c.clusterId,url:c.clusterUrl})),i=Array.from(new Map(t.map(c=>[c.key,c])).values());this._cellClusters[e]=i,this._cacheRequests[e]=[];let r;const o=new Promise((c,s)=>{r=s});return this._cacheRequests[e].push(r),this._cachingClusters$[e]=this._cacheClusters$(i,e,o).pipe(ma(()=>{e in this._cachingClusters$&&delete this._cachingClusters$[e],e in this._cacheRequests&&delete this._cacheRequests[e]}),Ya(),gi()),this._cachingClusters$[e]}cacheCell$(e){if(this.hasCell(e))throw new Error("Cannot cache cell that already exists.");return this.isCachingCell(e)?this._cachingCells$[e]:(this._cachingCells$[e]=this._graphService.cacheCell$(e).pipe(Nn(t=>(console.error(t),zi())),oi(()=>!(e in this._cells)),Dr(t=>{this._cells[e]=[],this._cells[e].push(...t),delete this._cachingCells$[e]}),ma(()=>{e in this._cachingCells$&&delete this._cachingCells$[e]}),Ya(),gi()),this._cachingCells$[e])}isCachingClusters(e){return e in this._cachingClusters$}isCachingCell(e){return e in this._cachingCells$}hasClusters(e){if(e in this._cachingClusters$||!(e in this._cellClusters))return!1;for(const t of this._cellClusters[e])if(!(t.key in this._clusters))return!1;return!0}hasCell(e){return!(e in this._cachingCells$)&&e in this._cells}getClusters(e){return e in this._cellClusters?this._cellClusters[e].map(t=>this._clusters[t.key]).filter(t=>!!t):[]}getCell(e){return e in this._cells?this._cells[e]:[]}uncache(e){for(let t of Object.keys(this._cacheRequests))if(!(e&&e.indexOf(t)!==-1)){for(const i of this._cacheRequests[t])i();delete this._cacheRequests[t]}for(let t of Object.keys(this._cellClusters))if(!(e&&e.indexOf(t)!==-1)){for(const i of this._cellClusters[t]){if(!(i.key in this._clusterCells))continue;const r=this._clusterCells[i.key].indexOf(t);r!==-1&&(this._clusterCells[i.key].splice(r,1),!(this._clusterCells[i.key].length>0)&&(delete this._clusterCells[i.key],delete this._clusters[i.key]))}delete this._cellClusters[t]}for(let t of Object.keys(this._cells))e&&e.indexOf(t)!==-1||delete this._cells[t]}updateCell$(e){if(!this.hasCell(e))throw new Error("Cannot update cell that does not exists.");return this._graphService.cacheCell$(e).pipe(Nn(t=>(console.error(t),zi())),oi(()=>e in this._cells),Dr(t=>{this._cells[e]=[],this._cells[e].push(...t)}),Ya(),gi())}updateClusters$(e){if(!this.hasCell(e))throw new Error("Cannot update reconstructions of a non-existing cell.");if(!this.hasClusters(e))throw new Error("Cannot update reconstructions for cell that is not cached.");const t=this.getCell(e).filter(r=>!!r.clusterId&&!!r.clusterUrl).map(r=>({key:r.clusterId,url:r.clusterUrl})),i=Array.from(new Map(t.map(r=>[r.key,r])).values()).filter(r=>!(r.key in this._clusters));return this._cellClusters[e].push(...i),this._cacheClusters$(i,e,null)}_cacheClusters$(e,t,i){return Fr(e).pipe(Wi(r=>this._hasCluster(r.key)?Ai(this._getCluster(r.key)):this._getCluster$(r.url,r.key,i).pipe(Nn(o=>(o instanceof Bl||console.error(o),zi()))),6),oi(()=>t in this._cellClusters),Dr(r=>{this._hasCluster(r.id)||(this._clusters[r.id]=r),r.id in this._clusterCells||(this._clusterCells[r.id]=[]),this._clusterCells[r.id].indexOf(t)===-1&&this._clusterCells[r.id].push(t)}))}_getCluster(e){return this._clusters[e]}_getCluster$(e,t,i){return gr.create(r=>{this._data.getCluster(e,i).then(o=>{o.id=t,r.next(o),r.complete()},o=>{r.error(o)})})}_hasCluster(e){return e in this._clusters}}function AM(n,e,t){const i=new Set;return i.add(n),sz(i,[n],0,e,t),Array.from(i)}function sz(n,e,t,i,r){if(t>=i)return;const o=[];for(const s of e){const f=r.getAdjacent(s);o.push(...f)}const c=[];for(const s of o)n.has(s)||(n.add(s),c.push(s));sz(n,c,t+1,i,r)}class oz extends bo{constructor(e,t,i){super(e,t,i),this._cache=new Qee(i.graphService,i.api.data),this._scene=new Jee(this._getDefaultConfiguration()),this._viewportCoords=new zo,this._spatial=new vo}getFrameIdAt(e){return new Promise((t,i)=>{this._container.renderService.renderCamera$.pipe(wi(),We(r=>{const o=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._scene.intersection.intersectObjects(o,r.perspective)})).subscribe(r=>{t(r)},r=>{i(r)})})}_activate(){this._navigator.cacheService.configure({cellDepth:3});const e=this._subscriptions;e.push(this._navigator.stateService.reference$.pipe(tl()).subscribe(([x,b])=>{this._scene.resetReference(b,x)})),e.push(this._navigator.graphService.filter$.subscribe(x=>{this._scene.setFilter(x)}));const t=this._container.renderService.bearing$.pipe(We(x=>6*Math.floor(x/6)),yi(),Pi(1),gi()),i=this._navigator.stateService.currentImage$.pipe(We(x=>this._navigator.api.data.geometry.lngLatToCellId(x.originalLngLat)),yi(),Pi(1),gi()),r=this._configuration$.pipe(We(x=>this._spatial.clamp(x.cellGridDepth,1,3)),yi(),Pi(1),gi()),o=Si(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(We(([x,b])=>x&&b>c0.sequenceSpeed),yi(),Pi(1),gi()),c=this._navigator.stateService.state$.pipe(We(x=>Zee(x)),yi(),Pi(1),gi());e.push(c.subscribe(x=>{this._scene.setNavigationState(x)}));const s=Si(c,o,t,r,this._navigator.stateService.currentImage$).pipe(yi(([x,b,M,P,k],[L,I,F,N,H])=>{if(x!==L)return!1;const Y=k.id===H.id&&b===I&&P===N;return x?Y:Y&&M===F}),IS(([x,b,M,P,k])=>{if(x){const I=this._navigator.api.data.geometry,F=I.lngLatToCellId(k.originalLngLat),N=b?[F]:AM(F,P,I);return Ai(N)}const L=b?30:90;return Ai(this._cellsInFov(k,M,L))}),ei(x=>Fr(x).pipe(Wi(b=>(this._cache.hasCell(b)?Ai(this._cache.getCell(b)):this._cache.cacheCell$(b)).pipe(We(P=>({id:b,images:P}))),6))));e.push(s.pipe(Ui(this._navigator.stateService.reference$)).subscribe(([x,b])=>{this._scene.hasCell(x.id)||this._scene.addCell(this._cellToTopocentric(x.id,b),x.id)})),e.push(s.pipe(Ui(this._navigator.stateService.reference$)).subscribe(([x,b])=>{this._addSceneImages(x,b)})),e.push(s.pipe(IS(x=>{const b=x.id;let M;return this._cache.hasClusters(b)?M=Fr(this._cache.getClusters(b)):this._cache.isCachingClusters(b)?M=this._cache.cacheClusters$(b).pipe(Og(null,{}),ei(()=>Fr(this._cache.getClusters(b)))):this._cache.hasCell(b)?M=this._cache.cacheClusters$(b):M=zi(),Si(Ai(b),M)}),Ui(this._navigator.stateService.reference$)).subscribe(([[x,b],M])=>{this._scene.hasCluster(b.id,x)||this._scene.addCluster(b,this._computeTranslation(b,M),x)})),e.push(this._configuration$.pipe(We(x=>{var b;x.cameraSize=this._spatial.clamp(x.cameraSize,.01,1),x.pointSize=this._spatial.clamp(x.pointSize,.01,1);const M=x.pointsVisible?(b=x.pointVisualizationMode)!==null&&b!==void 0?b:tu.Original:tu.Hidden;return{cameraSize:x.cameraSize,cameraVisualizationMode:x.cameraVisualizationMode,cellsVisible:x.cellsVisible,originalPositionMode:x.originalPositionMode,pointSize:x.pointSize,pointVisualizationMode:M}}),yi((x,b)=>x.cameraSize===b.cameraSize&&x.cameraVisualizationMode===b.cameraVisualizationMode&&x.cellsVisible===b.cellsVisible&&x.originalPositionMode===b.originalPositionMode&&x.pointSize===b.pointSize&&x.pointVisualizationMode===b.pointVisualizationMode)).subscribe(x=>{this._scene.setCameraSize(x.cameraSize);const b=x.cameraVisualizationMode;this._scene.setCameraVisualizationMode(b),this._scene.setCellVisibility(x.cellsVisible),this._scene.setPointSize(x.pointSize);const M=x.pointVisualizationMode;this._scene.setPointVisualizationMode(M);const P=x.originalPositionMode;this._scene.setPositionMode(P)})),e.push(Si(i,r).subscribe(([x,b])=>{const M=AM(x,b,this._navigator.api.data.geometry);this._scene.uncache(M),this._cache.uncache(M)})),e.push(this._navigator.playService.playing$.pipe(ei(x=>x?zi():this._container.mouseService.dblClick$),Ui(this._container.renderService.renderCamera$),ei(([x,b])=>{const M=this._container.container,[P,k]=this._viewportCoords.canvasPosition(x,M),L=this._viewportCoords.canvasToViewport(P,k,M),I=this._scene.intersection.intersectObjects(L,b.perspective);return I?this._navigator.moveTo$(I).pipe(Nn(()=>zi())):zi()})).subscribe());const f=Si(this._configuration$,this._navigator.stateService.state$).pipe(We(([x,b])=>(x.cameraSize=this._spatial.clamp(x.cameraSize,.01,1),{size:x.cameraSize,visible:EM(x.cameraVisualizationMode),state:b})),yi((x,b)=>x.size===b.size&&x.visible===b.visible&&x.state===b.state)),p=this._container.mouseService.mouseMove$.pipe(Pi(1),gi());e.push(p.subscribe());const g=fn(this._container.mouseService.mouseEnter$,this._container.mouseService.mouseLeave$,this._container.mouseService.windowBlur$);e.push(Si(this._navigator.playService.playing$,g,c,this._navigator.graphService.filter$).pipe(ei(([x,b])=>!x&&b.type==="pointerenter"?Si(Nl(p.pipe(zl(1)),this._container.mouseService.mouseMove$),this._container.renderService.renderCamera$,f):Si(Ai(b),Ai(null),Ai(null)))).subscribe(([x,b])=>{if(x.type!=="pointermove"){this._scene.setHoveredImage(null);return}const M=this._container.container,[P,k]=this._viewportCoords.canvasPosition(x,M),L=this._viewportCoords.canvasToViewport(P,k,M),I=this._scene.intersection.intersectObjects(L,b.perspective);this._scene.setHoveredImage(I)})),e.push(this._navigator.stateService.currentId$.subscribe(x=>{this._scene.setSelectedImage(x)})),e.push(this._navigator.stateService.currentState$.pipe(We(x=>{const b=this._scene;return{name:this._name,renderer:{frameId:x.id,needsRender:b.needsRender,render:b.render.bind(b),pass:Ph.Opaque}}})).subscribe(this._container.glRenderer.render$));const _=this._navigator.graphService.dataAdded$.pipe(oi(x=>this._cache.hasCell(x)),Wi(x=>this._cache.updateCell$(x).pipe(We(b=>({id:x,images:b})),Ui(this._navigator.stateService.reference$))),Ya(),gi());e.push(_.subscribe(([x,b])=>{this._addSceneImages(x,b)})),e.push(_.pipe(IS(([x])=>{const b=x.id,M=this._cache;let P;return M.hasClusters(b)?P=M.updateClusters$(b):M.isCachingClusters(b)?P=this._cache.cacheClusters$(b).pipe(Og(null,{}),ei(()=>Fr(M.updateClusters$(b)))):P=zi(),Si(Ai(b),P)}),Ui(this._navigator.stateService.reference$)).subscribe(([[x,b],M])=>{this._scene.hasCluster(b.id,x)||this._scene.addCluster(b,this._computeTranslation(b,M),x)}))}_deactivate(){this._subscriptions.unsubscribe(),this._cache.uncache(),this._scene.deactivate(),this._navigator.cacheService.configure()}_getDefaultConfiguration(){return{cameraSize:.1,cameraVisualizationMode:Dl.Homogeneous,cellGridDepth:1,originalPositionMode:Dy.Hidden,pointSize:.1,pointsVisible:!0,pointVisualizationMode:tu.Original,cellsVisible:!1}}_addSceneImages(e,t){const i=e.id,r=e.images;for(const o of r)this._scene.hasImage(o.id,i)||this._scene.addImage(o,this._createTransform(o,t),this._computeOriginalPosition(o,t),i)}_cellsInFov(e,t,i){const r=this._spatial,o=this._navigator.api.data.geometry,c=o.lngLatToCellId(e.originalLngLat),s=[c],f=i/2,p=o.getAdjacent(c);for(const g of p){const _=o.getVertices(g);for(const x of _){const[b,M]=ta(x.lng,x.lat,0,e.lngLat.lng,e.lngLat.lat,0),P=Math.atan2(M,b),k=r.radToDeg(r.azimuthalToBearing(P));Math.abs(k-t)<f&&s.push(g)}}return s}_computeOriginalPosition(e,t){return ta(e.originalLngLat.lng,e.originalLngLat.lat,e.originalAltitude!=null?e.originalAltitude:e.computedAltitude,t.lng,t.lat,t.alt)}_cellToTopocentric(e,t){return this._navigator.api.data.geometry.getVertices(e).map(r=>ta(r.lng,r.lat,-2,t.lng,t.lat,t.alt))}_computeTranslation(e,t){return ta(e.reference.lng,e.reference.lat,e.reference.alt,t.lng,t.lat,t.alt)}_createTransform(e,t){const i=aw({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t);return new Cg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,i,void 0,void 0,e.cameraParameters,e.cameraType)}}oz.componentName="spatial";class dC{constructor(){this._notifyChanged$=new ri}get changed$(){return this._notifyChanged$}}class Ds extends cr{constructor(e){super(e??"The provided geometry value is incorrect"),Object.setPrototypeOf(this,Ds.prototype),this.name="GeometryTagError"}}class ete extends dC{constructor(e){if(super(),e.length<2)throw new Ds("A points geometry must have two or more positions.");this._points=[];for(const i of e){if(i[0]<0||i[0]>1||i[1]<0||i[1]>1)throw new Ds("Basic coordinates of points must be on the interval [0, 1].");this._points.push(i.slice())}}get points(){return this._points}addPoint2d(e){const t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points.push(t),this._notifyChanged$.next(this)}getPoint2d(e){return this._points[e].slice()}removePoint2d(e){if(e<0||e>=this._points.length||this._points.length<3)throw new Ds("Index for removed point must be valid.");this._points.splice(e,1),this._notifyChanged$.next(this)}setVertex2d(e,t,i){this.setPoint2d(e,t,i)}setPoint2d(e,t,i){const r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points[e]=r,this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints3d(this._points,e)}getPoint3d(e,t){return t.unprojectBasic(this._points[e],200)}getPoints2d(){return this._points.slice()}getCentroid2d(e){if(!e)throw new Ds("Get centroid must be called with a transform for points geometries.");const[t,i,r,o]=this.getRect2d(e),c=t<r?(t+r)/2:(t+r+1)/2%1,s=(i+o)/2;return[c,s]}getCentroid3d(e){let t=this.getCentroid2d();return e.unprojectBasic(t,200)}getRect2d(e){let t=1,i=0,r=1,o=0;const c=this._points;for(const s of c)s[0]<t&&(t=s[0]),s[0]>i&&(i=s[0]),s[1]<r&&(r=s[1]),s[1]>o&&(o=s[1]);if(ki(e.cameraType)){const s=[];for(let g=0;g<c.length;g++)s[g]=g;s.sort((g,_)=>c[g][0]<c[_][0]?-1:c[g][0]>c[_][0]?1:g<_?-1:1);let f=c[s[0]][0]+1-c[s[s.length-1]][0],p=0;for(let g=0;g<s.length-1;g++){const _=s[g],x=s[g+1],b=c[x][0]-c[_][0];b>f&&(f=b,p=g+1)}p>0&&(t=c[s[p]][0],i=c[s[p-1]][0])}return[t,r,i,o]}setCentroid2d(e,t){throw new Error("Not implemented")}_getPoints3d(e,t){return e.map(i=>t.unprojectBasic(i,200))}}class az{constructor(e,t,i){this._geometry=e,this._transform=t,this._viewportCoords=i||new zo,this._aborted$=new ri,this._created$=new ri,this._glObjectsChanged$=new ri,this._geometryChangedSubscription=this._geometry.changed$.subscribe(()=>{this._onGeometryChanged(),this._glObjectsChanged$.next(this)})}get geometry(){return this._geometry}get glObjects(){return this._glObjects}get aborted$(){return this._aborted$}get created$(){return this._created$}get glObjectsChanged$(){return this._glObjectsChanged$}get geometryChanged$(){return this._geometry.changed$.pipe(We(()=>this))}dispose(){this._geometryChangedSubscription.unsubscribe()}_canvasToTransform(e){const t=Math.round(e[0]),i=Math.round(e[1]);return`translate(-50%,-50%) translate(${t}px,${i}px)`}_colorToBackground(e){return"#"+("000000"+e.toString(16)).substr(-6)}_createOutine(e,t){const i=this._getLinePositions(e),r=new $n;r.setAttribute("position",new Mn(i,3));const o=new Ah({color:t,linewidth:1});return new Sp(r,o)}_disposeLine(e){e!=null&&(e.geometry.dispose(),e.material.dispose())}_getLinePositions(e){const t=e.length,i=new Float32Array(t*3);for(let r=0;r<t;++r){const o=3*r,c=e[r];i[o]=c[0],i[o+1]=c[1],i[o+2]=c[2]}return i}}var fC={exports:{}};fC.exports=Yw;fC.exports.default=Yw;function Yw(n,e,t){t=t||2;var i=e&&e.length,r=i?e[0]*t:n.length,o=lz(n,0,r,t,!0),c=[];if(!o||o.next===o.prev)return c;var s,f,p,g,_,x,b;if(i&&(o=ste(n,e,o,t)),n.length>80*t){s=p=n[0],f=g=n[1];for(var M=t;M<r;M+=t)_=n[M],x=n[M+1],_<s&&(s=_),x<f&&(f=x),_>p&&(p=_),x>g&&(g=x);b=Math.max(p-s,g-f),b=b!==0?1/b:0}return Fy(o,c,t,s,f,b),c}function lz(n,e,t,i,r){var o,c;if(r===LM(n,e,t,i)>0)for(o=e;o<t;o+=i)c=tL(o,n[o],n[o+1],c);else for(o=t-i;o>=e;o-=i)c=tL(o,n[o],n[o+1],c);return c&&Kw(c,c.next)&&(zy(c),c=c.next),c}function Vd(n,e){if(!n)return n;e||(e=n);var t=n,i;do if(i=!1,!t.steiner&&(Kw(t,t.next)||as(t.prev,t,t.next)===0)){if(zy(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Fy(n,e,t,i,r,o,c){if(n){!c&&o&&ute(n,i,r,o);for(var s=n,f,p;n.prev!==n.next;){if(f=n.prev,p=n.next,o?ite(n,i,r,o):tte(n)){e.push(f.i/t),e.push(n.i/t),e.push(p.i/t),zy(n),n=p.next,s=p.next;continue}if(n=p,n===s){c?c===1?(n=nte(Vd(n),e,t),Fy(n,e,t,i,r,o,2)):c===2&&rte(n,e,t,i,r,o):Fy(Vd(n),e,t,i,r,o,1);break}}}}function tte(n){var e=n.prev,t=n,i=n.next;if(as(e,t,i)>=0)return!1;for(var r=n.next.next;r!==n.prev;){if(mg(e.x,e.y,t.x,t.y,i.x,i.y,r.x,r.y)&&as(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function ite(n,e,t,i){var r=n.prev,o=n,c=n.next;if(as(r,o,c)>=0)return!1;for(var s=r.x<o.x?r.x<c.x?r.x:c.x:o.x<c.x?o.x:c.x,f=r.y<o.y?r.y<c.y?r.y:c.y:o.y<c.y?o.y:c.y,p=r.x>o.x?r.x>c.x?r.x:c.x:o.x>c.x?o.x:c.x,g=r.y>o.y?r.y>c.y?r.y:c.y:o.y>c.y?o.y:c.y,_=PM(s,f,e,t,i),x=PM(p,g,e,t,i),b=n.prevZ,M=n.nextZ;b&&b.z>=_&&M&&M.z<=x;){if(b!==n.prev&&b!==n.next&&mg(r.x,r.y,o.x,o.y,c.x,c.y,b.x,b.y)&&as(b.prev,b,b.next)>=0||(b=b.prevZ,M!==n.prev&&M!==n.next&&mg(r.x,r.y,o.x,o.y,c.x,c.y,M.x,M.y)&&as(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;b&&b.z>=_;){if(b!==n.prev&&b!==n.next&&mg(r.x,r.y,o.x,o.y,c.x,c.y,b.x,b.y)&&as(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;M&&M.z<=x;){if(M!==n.prev&&M!==n.next&&mg(r.x,r.y,o.x,o.y,c.x,c.y,M.x,M.y)&&as(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function nte(n,e,t){var i=n;do{var r=i.prev,o=i.next.next;!Kw(r,o)&&cz(r,i,i.next,o)&&Oy(r,o)&&Oy(o,r)&&(e.push(r.i/t),e.push(i.i/t),e.push(o.i/t),zy(i),zy(i.next),i=n=o),i=i.next}while(i!==n);return Vd(i)}function rte(n,e,t,i,r,o){var c=n;do{for(var s=c.next.next;s!==c.prev;){if(c.i!==s.i&&fte(c,s)){var f=uz(c,s);c=Vd(c,c.next),f=Vd(f,f.next),Fy(c,e,t,i,r,o),Fy(f,e,t,i,r,o);return}s=s.next}c=c.next}while(c!==n)}function ste(n,e,t,i){var r=[],o,c,s,f,p;for(o=0,c=e.length;o<c;o++)s=e[o]*i,f=o<c-1?e[o+1]*i:n.length,p=lz(n,s,f,i,!1),p===p.next&&(p.steiner=!0),r.push(dte(p));for(r.sort(ote),o=0;o<r.length;o++)t=ate(r[o],t),t=Vd(t,t.next);return t}function ote(n,e){return n.x-e.x}function ate(n,e){var t=lte(n,e);if(!t)return e;var i=uz(t,n),r=Vd(t,t.next);return Vd(i,i.next),e===t?r:e}function lte(n,e){var t=e,i=n.x,r=n.y,o=-1/0,c;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){var s=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(s<=i&&s>o){if(o=s,s===i){if(r===t.y)return t;if(r===t.next.y)return t.next}c=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!c)return null;if(i===o)return c;var f=c,p=c.x,g=c.y,_=1/0,x;t=c;do i>=t.x&&t.x>=p&&i!==t.x&&mg(r<g?i:o,r,p,g,r<g?o:i,r,t.x,t.y)&&(x=Math.abs(r-t.y)/(i-t.x),Oy(t,n)&&(x<_||x===_&&(t.x>c.x||t.x===c.x&&cte(c,t)))&&(c=t,_=x)),t=t.next;while(t!==f);return c}function cte(n,e){return as(n.prev,n,e.prev)<0&&as(e.next,n,n.next)<0}function ute(n,e,t,i){var r=n;do r.z===null&&(r.z=PM(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,hte(r)}function hte(n){var e,t,i,r,o,c,s,f,p=1;do{for(t=n,n=null,o=null,c=0;t;){for(c++,i=t,s=0,e=0;e<p&&(s++,i=i.nextZ,!!i);e++);for(f=p;s>0||f>0&&i;)s!==0&&(f===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,s--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:n=r,r.prevZ=o,o=r;t=i}o.nextZ=null,p*=2}while(c>1);return n}function PM(n,e,t,i,r){return n=32767*(n-t)*r,e=32767*(e-i)*r,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function dte(n){var e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function mg(n,e,t,i,r,o,c,s){return(r-c)*(e-s)-(n-c)*(o-s)>=0&&(n-c)*(i-s)-(t-c)*(e-s)>=0&&(t-c)*(o-s)-(r-c)*(i-s)>=0}function fte(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!pte(n,e)&&(Oy(n,e)&&Oy(e,n)&&mte(n,e)&&(as(n.prev,n,e.prev)||as(n,e.prev,e))||Kw(n,e)&&as(n.prev,n,n.next)>0&&as(e.prev,e,e.next)>0)}function as(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Kw(n,e){return n.x===e.x&&n.y===e.y}function cz(n,e,t,i){var r=sx(as(n,e,t)),o=sx(as(n,e,i)),c=sx(as(t,i,n)),s=sx(as(t,i,e));return!!(r!==o&&c!==s||r===0&&rx(n,t,e)||o===0&&rx(n,i,e)||c===0&&rx(t,n,i)||s===0&&rx(t,e,i))}function rx(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function sx(n){return n>0?1:n<0?-1:0}function pte(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&cz(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Oy(n,e){return as(n.prev,n,n.next)<0?as(n,e,n.next)>=0&&as(n,n.prev,e)>=0:as(n,e,n.prev)<0||as(n,n.next,e)<0}function mte(n,e){var t=n,i=!1,r=(n.x+e.x)/2,o=(n.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&r<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function uz(n,e){var t=new IM(n.i,n.x,n.y),i=new IM(e.i,e.x,e.y),r=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function tL(n,e,t,i){var r=new IM(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function zy(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function IM(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}Yw.deviation=function(n,e,t,i){var r=e&&e.length,o=r?e[0]*t:n.length,c=Math.abs(LM(n,0,o,t));if(r)for(var s=0,f=e.length;s<f;s++){var p=e[s]*t,g=s<f-1?e[s+1]*t:n.length;c-=Math.abs(LM(n,p,g,t))}var _=0;for(s=0;s<i.length;s+=3){var x=i[s]*t,b=i[s+1]*t,M=i[s+2]*t;_+=Math.abs((n[x]-n[M])*(n[b+1]-n[x+1])-(n[x]-n[b])*(n[M+1]-n[x+1]))}return c===0&&_===0?0:Math.abs((_-c)/c)};function LM(n,e,t,i){for(var r=0,o=e,c=t-i;o<t;o+=i)r+=(n[c]-n[o])*(n[o+1]+n[c+1]),c=o;return r}Yw.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,r=0;r<n.length;r++){for(var o=0;o<n[r].length;o++)for(var c=0;c<e;c++)t.vertices.push(n[r][o][c]);r>0&&(i+=n[r-1].length,t.holes.push(i))}return t};var iL=fC.exports,pC={exports:{}};class gte{constructor(e=[],t=_te){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const o=e-1>>1,c=t[o];if(i(r,c)>=0)break;t[e]=c,e=o}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,o=t[e];for(;e<r;){let c=(e<<1)+1,s=t[c];const f=c+1;if(f<this.length&&i(t[f],s)<0&&(c=f,s=t[f]),i(s,o)>=0)break;t[e]=s,e=c}t[e]=o}}function _te(n,e){return n<e?-1:n>e?1:0}var vte=Object.freeze({__proto__:null,default:gte}),yte=fK(vte),Ex=yte;Ex.default&&(Ex=Ex.default);pC.exports=hz;pC.exports.default=hz;function hz(n,e,t){e=e||1;for(var i,r,o,c,s=0;s<n[0].length;s++){var f=n[0][s];(!s||f[0]<i)&&(i=f[0]),(!s||f[1]<r)&&(r=f[1]),(!s||f[0]>o)&&(o=f[0]),(!s||f[1]>c)&&(c=f[1])}var p=o-i,g=c-r,_=Math.min(p,g),x=_/2;if(_===0){var b=[i,r];return b.distance=0,b}for(var M=new Ex(void 0,bte),P=i;P<o;P+=_)for(var k=r;k<c;k+=_)M.push(new xd(P+x,k+x,x,n));var L=wte(n),I=new xd(i+p/2,r+g/2,0,n);I.d>L.d&&(L=I);for(var F=M.length;M.length;){var N=M.pop();N.d>L.d&&(L=N,t&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,F)),!(N.max-L.d<=e)&&(x=N.h/2,M.push(new xd(N.x-x,N.y-x,x,n)),M.push(new xd(N.x+x,N.y-x,x,n)),M.push(new xd(N.x-x,N.y+x,x,n)),M.push(new xd(N.x+x,N.y+x,x,n)),F+=4)}t&&(console.log("num probes: "+F),console.log("best distance: "+L.d));var H=[L.x,L.y];return H.distance=L.d,H}function bte(n,e){return e.max-n.max}function xd(n,e,t,i){this.x=n,this.y=e,this.h=t,this.d=xte(n,e,i),this.max=this.d+this.h*Math.SQRT2}function xte(n,e,t){for(var i=!1,r=1/0,o=0;o<t.length;o++)for(var c=t[o],s=0,f=c.length,p=f-1;s<f;p=s++){var g=c[s],_=c[p];g[1]>e!=_[1]>e&&n<(_[0]-g[0])*(e-g[1])/(_[1]-g[1])+g[0]&&(i=!i),r=Math.min(r,Ste(n,e,g,_))}return r===0?0:(i?1:-1)*Math.sqrt(r)}function wte(n){for(var e=0,t=0,i=0,r=n[0],o=0,c=r.length,s=c-1;o<c;s=o++){var f=r[o],p=r[s],g=f[0]*p[1]-p[0]*f[1];t+=(f[0]+p[0])*g,i+=(f[1]+p[1])*g,e+=g*3}return e===0?new xd(r[0][0],r[0][1],0,n):new xd(t/e,i/e,0,n)}function Ste(n,e,t,i){var r=t[0],o=t[1],c=i[0]-r,s=i[1]-o;if(c!==0||s!==0){var f=((n-r)*c+(e-o)*s)/(c*c+s*s);f>1?(r=i[0],o=i[1]):f>0&&(r+=c*f,o+=s*f)}return c=n-r,s=e-o,c*c+s*s}var Tte=pC.exports;function Mte(n,e){return n>e?1:n<e?-1:0}class mC{constructor(e=Mte,t=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!t}rotateLeft(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t}rotateRight(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t}_splay(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}}splay(e){for(var t,i,r,o,c;e.parent;)t=e.parent,i=t.parent,i&&i.parent?(r=i.parent,r.left===i?r.left=e:r.right=e,e.parent=r):(e.parent=null,this._root=e),o=e.left,c=e.right,e===t.left?(i&&(i.left===t?(t.right?(i.left=t.right,i.left.parent=i):i.left=null,t.right=i,i.parent=t):(o?(i.right=o,o.parent=i):i.right=null,e.left=i,i.parent=e)),c?(t.left=c,c.parent=t):t.left=null,e.right=t,t.parent=e):(i&&(i.right===t?(t.left?(i.right=t.left,i.right.parent=i):i.right=null,t.left=i,i.parent=t):(c?(i.left=c,c.parent=i):i.left=null,e.right=i,i.parent=e)),o?(t.right=o,o.parent=t):t.right=null,e.left=t,t.parent=e)}replace(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,t){var i=this._root,r=null,o=this._compare,c;if(this._noDuplicates)for(;i;){if(r=i,c=o(i.key,e),c===0)return;o(i.key,e)<0?i=i.right:i=i.left}else for(;i;)r=i,o(i.key,e)<0?i=i.right:i=i.left;return i={key:e,data:t,left:null,right:null,parent:r},r?o(r.key,i.key)<0?r.right=i:r.left=i:this._root=i,this.splay(i),this._size++,i}find(e){for(var t=this._root,i=this._compare;t;){var r=i(t.key,e);if(r<0)t=t.right;else if(r>0)t=t.left;else return t}return null}contains(e){for(var t=this._root,i=this._compare;t;){var r=i(e,t.key);if(r===0)return!0;r<0?t=t.left:t=t.right}return!1}remove(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),!t.left)this.replace(t,t.right);else if(!t.right)this.replace(t,t.left);else{var i=this.minNode(t.right);i.parent!==t&&(this.replace(i,i.right),i.right=t.right,i.right.parent=i),this.replace(t,i),i.left=t.left,i.left.parent=i}return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),!e.left)this.replace(e,e.right);else if(!e.right)this.replace(e,e.left);else{var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}return this._size--,!0}erase(e){var t=this.find(e);if(t){this.splay(t);var i=t.left,r=t.right,o=null;i&&(i.parent=null,o=this.maxNode(i),this.splay(o),this._root=o),r&&(i?o.right=r:this._root=r,r.parent=o),this._size--}}pop(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t}next(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t}prev(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t}forEach(e){for(var t=this._root,i=[],r=!1,o=0;!r;)t?(i.push(t),t=t.left):i.length>0?(t=i.pop(),e(t,o++),t=t.right):r=!0;return this}range(e,t,i,r){const o=[],c=this._compare;let s=this._root,f;for(;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),f=c(s.key,t),f>0)break;if(c(s.key,e)>=0&&i.call(r,s))return this;s=s.right}return this}keys(){for(var e=this._root,t=[],i=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),i.push(e.key),e=e.right):r=!0;return i}values(){for(var e=this._root,t=[],i=[],r=!1;!r;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),i.push(e.data),e=e.right):r=!0;return i}at(e){for(var t=this._root,i=[],r=!1,o=0;!r;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),o===e)return t;o++,t=t.right}else r=!0;return null}load(e=[],t=[],i=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const r=e.length;return i&&kM(e,t,0,r-1,this._compare),this._root=RM(null,e,t,0,r),this._size=r,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,t,i,r,o){return new mC(i,o).load(e,t,r)}}function RM(n,e,t,i,r){const o=r-i;if(o>0){const c=i+Math.floor(o/2),s=e[c],f=t[c],p={key:s,data:f,parent:n};return p.left=RM(p,e,t,i,c),p.right=RM(p,e,t,c+1,r),p}return null}function kM(n,e,t,i,r){if(t>=i)return;const o=n[t+i>>1];let c=t-1,s=i+1;for(;;){do c++;while(r(n[c],o)<0);do s--;while(r(n[s],o)>0);if(c>=s)break;let f=n[c];n[c]=n[s],n[s]=f,f=e[c],e[c]=e[s],e[s]=f}kM(n,e,t,s,r),kM(n,e,s+1,i,r)}const dz=0,fz=1,pz=2,mz=3,fw=0,DM=1,pw=2,gz=3;function Tv(n,e,t){e===null?(n.inOut=!1,n.otherInOut=!0):(n.isSubject===e.isSubject?(n.inOut=!e.inOut,n.otherInOut=e.otherInOut):(n.inOut=!e.otherInOut,n.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(n.prevInResult=!nL(e,t)||e.isVertical()?e.prevInResult:e)),nL(n,t)?n.resultTransition=Cte(n,t):n.resultTransition=0}function nL(n,e){switch(n.type){case dz:switch(e){case fw:return!n.otherInOut;case DM:return n.otherInOut;case pw:return n.isSubject&&n.otherInOut||!n.isSubject&&!n.otherInOut;case gz:return!0}break;case pz:return e===fw||e===DM;case mz:return e===pw;case fz:return!1}return!1}function Cte(n,e){let t=!n.inOut,i=!n.otherInOut,r;switch(e){case fw:r=t&&i;break;case DM:r=t||i;break;case gz:r=t^i;break;case pw:n.isSubject?r=t&&!i:r=i&&!t;break}return r?1:-1}class jg{constructor(e,t,i,r,o){this.left=t,this.point=e,this.otherEvent=i,this.isSubject=r,this.type=o||dz,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const t=this.point,i=this.otherEvent.point;return this.left?(t[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(t[1]-e[1])>0:(i[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(i[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new jg(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function Kc(n,e){return n[0]===e[0]?n[1]===e[1]:!1}const vh=11102230246251565e-32,Co=134217729,Ete=(3+8*vh)*vh;function yT(n,e,t,i,r){let o,c,s,f,p=e[0],g=i[0],_=0,x=0;g>p==g>-p?(o=p,p=e[++_]):(o=g,g=i[++x]);let b=0;if(_<n&&x<t)for(g>p==g>-p?(c=p+o,s=o-(c-p),p=e[++_]):(c=g+o,s=o-(c-g),g=i[++x]),o=c,s!==0&&(r[b++]=s);_<n&&x<t;)g>p==g>-p?(c=o+p,f=c-o,s=o-(c-f)+(p-f),p=e[++_]):(c=o+g,f=c-o,s=o-(c-f)+(g-f),g=i[++x]),o=c,s!==0&&(r[b++]=s);for(;_<n;)c=o+p,f=c-o,s=o-(c-f)+(p-f),p=e[++_],o=c,s!==0&&(r[b++]=s);for(;x<t;)c=o+g,f=c-o,s=o-(c-f)+(g-f),g=i[++x],o=c,s!==0&&(r[b++]=s);return(o!==0||b===0)&&(r[b++]=o),b}function Ate(n,e){let t=e[0];for(let i=1;i<n;i++)t+=e[i];return t}function u0(n){return new Float64Array(n)}const Pte=(3+16*vh)*vh,Ite=(2+12*vh)*vh,Lte=(9+64*vh)*vh*vh,ig=u0(4),rL=u0(8),sL=u0(12),oL=u0(16),Xo=u0(4);function Rte(n,e,t,i,r,o,c){let s,f,p,g,_,x,b,M,P,k,L,I,F,N,H,Y,q,U;const G=n-r,j=t-r,B=e-o,ne=i-o;N=G*ne,x=Co*G,b=x-(x-G),M=G-b,x=Co*ne,P=x-(x-ne),k=ne-P,H=M*k-(N-b*P-M*P-b*k),Y=B*j,x=Co*B,b=x-(x-B),M=B-b,x=Co*j,P=x-(x-j),k=j-P,q=M*k-(Y-b*P-M*P-b*k),L=H-q,_=H-L,ig[0]=H-(L+_)+(_-q),I=N+L,_=I-N,F=N-(I-_)+(L-_),L=F-Y,_=F-L,ig[1]=F-(L+_)+(_-Y),U=I+L,_=U-I,ig[2]=I-(U-_)+(L-_),ig[3]=U;let J=Ate(4,ig),le=Ite*c;if(J>=le||-J>=le||(_=n-G,s=n-(G+_)+(_-r),_=t-j,p=t-(j+_)+(_-r),_=e-B,f=e-(B+_)+(_-o),_=i-ne,g=i-(ne+_)+(_-o),s===0&&f===0&&p===0&&g===0)||(le=Lte*c+Ete*Math.abs(J),J+=G*g+ne*s-(B*p+j*f),J>=le||-J>=le))return J;N=s*ne,x=Co*s,b=x-(x-s),M=s-b,x=Co*ne,P=x-(x-ne),k=ne-P,H=M*k-(N-b*P-M*P-b*k),Y=f*j,x=Co*f,b=x-(x-f),M=f-b,x=Co*j,P=x-(x-j),k=j-P,q=M*k-(Y-b*P-M*P-b*k),L=H-q,_=H-L,Xo[0]=H-(L+_)+(_-q),I=N+L,_=I-N,F=N-(I-_)+(L-_),L=F-Y,_=F-L,Xo[1]=F-(L+_)+(_-Y),U=I+L,_=U-I,Xo[2]=I-(U-_)+(L-_),Xo[3]=U;const ae=yT(4,ig,4,Xo,rL);N=G*g,x=Co*G,b=x-(x-G),M=G-b,x=Co*g,P=x-(x-g),k=g-P,H=M*k-(N-b*P-M*P-b*k),Y=B*p,x=Co*B,b=x-(x-B),M=B-b,x=Co*p,P=x-(x-p),k=p-P,q=M*k-(Y-b*P-M*P-b*k),L=H-q,_=H-L,Xo[0]=H-(L+_)+(_-q),I=N+L,_=I-N,F=N-(I-_)+(L-_),L=F-Y,_=F-L,Xo[1]=F-(L+_)+(_-Y),U=I+L,_=U-I,Xo[2]=I-(U-_)+(L-_),Xo[3]=U;const pe=yT(ae,rL,4,Xo,sL);N=s*g,x=Co*s,b=x-(x-s),M=s-b,x=Co*g,P=x-(x-g),k=g-P,H=M*k-(N-b*P-M*P-b*k),Y=f*p,x=Co*f,b=x-(x-f),M=f-b,x=Co*p,P=x-(x-p),k=p-P,q=M*k-(Y-b*P-M*P-b*k),L=H-q,_=H-L,Xo[0]=H-(L+_)+(_-q),I=N+L,_=I-N,F=N-(I-_)+(L-_),L=F-Y,_=F-L,Xo[1]=F-(L+_)+(_-Y),U=I+L,_=U-I,Xo[2]=I-(U-_)+(L-_),Xo[3]=U;const fe=yT(pe,sL,4,Xo,oL);return oL[fe-1]}function kte(n,e,t,i,r,o){const c=(e-o)*(t-r),s=(n-r)*(i-o),f=c-s;if(c===0||s===0||c>0!=s>0)return f;const p=Math.abs(c+s);return Math.abs(f)>=Pte*p?f:-Rte(n,e,t,i,r,o,p)}function FM(n,e,t){const i=kte(n[0],n[1],e[0],e[1],t[0],t[1]);return i>0?-1:i<0?1:0}function Ud(n,e){const t=n.point,i=e.point;return t[0]>i[0]?1:t[0]<i[0]?-1:t[1]!==i[1]?t[1]>i[1]?1:-1:Dte(n,e,t)}function Dte(n,e,t,i){return n.left!==e.left?n.left?1:-1:FM(t,n.otherEvent.point,e.otherEvent.point)!==0?n.isBelow(e.otherEvent.point)?-1:1:!n.isSubject&&e.isSubject?1:-1}function vd(n,e,t){const i=new jg(e,!1,n,n.isSubject),r=new jg(e,!0,n.otherEvent,n.isSubject);return Kc(n.point,n.otherEvent.point)&&console.warn("what is that, a collapsed segment?",n),i.contourId=r.contourId=n.contourId,Ud(r,n.otherEvent)>0&&(n.otherEvent.left=!0,r.left=!1),n.otherEvent.otherEvent=r,n.otherEvent=i,t.push(r),t.push(i),t}function ox(n,e){return n[0]*e[1]-n[1]*e[0]}function bT(n,e){return n[0]*e[0]+n[1]*e[1]}function Fte(n,e,t,i,r){const o=[e[0]-n[0],e[1]-n[1]],c=[i[0]-t[0],i[1]-t[1]];function s(k,L,I){return[k[0]+L*I[0],k[1]+L*I[1]]}const f=[t[0]-n[0],t[1]-n[1]];let p=ox(o,c),g=p*p;const _=bT(o,o);if(g>0){const k=ox(f,c)/p;if(k<0||k>1)return null;const L=ox(f,o)/p;return L<0||L>1?null:k===0||k===1?[s(n,k,o)]:L===0||L===1?[s(t,L,c)]:[s(n,k,o)]}if(p=ox(f,o),g=p*p,g>0)return null;const x=bT(o,f)/_,b=x+bT(o,c)/_,M=Math.min(x,b),P=Math.max(x,b);return M<=1&&P>=0?M===1?[s(n,M>0?M:0,o)]:P===0?[s(n,P<1?P:1,o)]:[s(n,M>0?M:0,o),s(n,P<1?P:1,o)]:null}function xT(n,e,t){const i=Fte(n.point,n.otherEvent.point,e.point,e.otherEvent.point),r=i?i.length:0;if(r===0||r===1&&(Kc(n.point,e.point)||Kc(n.otherEvent.point,e.otherEvent.point))||r===2&&n.isSubject===e.isSubject)return 0;if(r===1)return!Kc(n.point,i[0])&&!Kc(n.otherEvent.point,i[0])&&vd(n,i[0],t),!Kc(e.point,i[0])&&!Kc(e.otherEvent.point,i[0])&&vd(e,i[0],t),1;const o=[];let c=!1,s=!1;return Kc(n.point,e.point)?c=!0:Ud(n,e)===1?o.push(e,n):o.push(n,e),Kc(n.otherEvent.point,e.otherEvent.point)?s=!0:Ud(n.otherEvent,e.otherEvent)===1?o.push(e.otherEvent,n.otherEvent):o.push(n.otherEvent,e.otherEvent),c&&s||c?(e.type=fz,n.type=e.inOut===n.inOut?pz:mz,c&&!s&&vd(o[1].otherEvent,o[0].point,t),2):s?(vd(o[0],o[1].point,t),3):o[0]!==o[3].otherEvent?(vd(o[0],o[1].point,t),vd(o[1],o[2].point,t),3):(vd(o[0],o[1].point,t),vd(o[3].otherEvent,o[2].point,t),3)}function Ote(n,e){if(n===e)return 0;if(FM(n.point,n.otherEvent.point,e.point)!==0||FM(n.point,n.otherEvent.point,e.otherEvent.point)!==0)return Kc(n.point,e.point)?n.isBelow(e.otherEvent.point)?-1:1:n.point[0]===e.point[0]?n.point[1]<e.point[1]?-1:1:Ud(n,e)===1?e.isAbove(n.point)?-1:1:n.isBelow(e.point)?-1:1;if(n.isSubject===e.isSubject){let t=n.point,i=e.point;if(t[0]===i[0]&&t[1]===i[1])return t=n.otherEvent.point,i=e.otherEvent.point,t[0]===i[0]&&t[1]===i[1]?0:n.contourId>e.contourId?1:-1}else return n.isSubject?-1:1;return Ud(n,e)===1?1:-1}function zte(n,e,t,i,r,o){const c=new mC(Ote),s=[],f=Math.min(i[2],r[2]);let p,g,_;for(;n.length!==0;){let x=n.pop();if(s.push(x),x.point[0]>f||o===pw)break;if(x.left){g=p=c.insert(x),_=c.minNode(),p!==_?p=c.prev(p):p=null,g=c.next(g);const b=p?p.key:null;let M;if(Tv(x,b,o),g&&xT(x,g.key,n)===2&&(Tv(x,b,o),Tv(x,g.key,o)),p&&xT(p.key,x,n)===2){let P=p;P!==_?P=c.prev(P):P=null,M=P?P.key:null,Tv(b,M,o),Tv(x,b,o)}}else x=x.otherEvent,g=p=c.find(x),p&&g&&(p!==_?p=c.prev(p):p=null,g=c.next(g),c.remove(x),g&&p&&xT(p.key,g.key,n))}return s}class Bte{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function Nte(n){let e,t,i,r;const o=[];for(t=0,i=n.length;t<i;t++)e=n[t],(e.left&&e.inResult||!e.left&&e.otherEvent.inResult)&&o.push(e);let c=!1;for(;!c;)for(c=!0,t=0,i=o.length;t<i;t++)t+1<i&&Ud(o[t],o[t+1])===1&&(r=o[t],o[t]=o[t+1],o[t+1]=r,c=!1);for(t=0,i=o.length;t<i;t++)e=o[t],e.otherPos=t;for(t=0,i=o.length;t<i;t++)e=o[t],e.left||(r=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=r);return o}function $te(n,e,t,i){let r=n+1,o=e[n].point,c;const s=e.length;for(r<s&&(c=e[r].point);r<s&&c[0]===o[0]&&c[1]===o[1];){if(t[r])r++;else return r;c=e[r].point}for(r=n-1;t[r]&&r>i;)r--;return r}function Vte(n,e,t){const i=new Bte;if(n.prevInResult!=null){const r=n.prevInResult,o=r.outputContourId;if(r.resultTransition>0){const s=e[o];if(s.holeOf!=null){const f=s.holeOf;e[f].holeIds.push(t),i.holeOf=f,i.depth=e[o].depth}else e[o].holeIds.push(t),i.holeOf=o,i.depth=e[o].depth+1}else i.holeOf=null,i.depth=e[o].depth}else i.holeOf=null,i.depth=0;return i}function Ute(n){let e,t;const i=Nte(n),r={},o=[];for(e=0,t=i.length;e<t;e++){if(r[e])continue;const c=o.length,s=Vte(i[e],o,c),f=x=>{r[x]=!0,i[x].outputContourId=c};let p=e,g=e;const _=i[e].point;for(s.points.push(_);f(p),p=i[p].otherPos,f(p),s.points.push(i[p].point),p=$te(p,i,r,g),p!=g;);o.push(s)}return o}var gC={exports:{}};gC.exports=By;gC.exports.default=By;function By(n,e){if(!(this instanceof By))return new By(n,e);if(this.data=n||[],this.length=this.data.length,this.compare=e||jte,this.length>0)for(var t=(this.length>>1)-1;t>=0;t--)this._down(t)}function jte(n,e){return n<e?-1:n>e?1:0}By.prototype={push:function(n){this.data.push(n),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var n=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),n}},peek:function(){return this.data[0]},_up:function(n){for(var e=this.data,t=this.compare,i=e[n];n>0;){var r=n-1>>1,o=e[r];if(t(i,o)>=0)break;e[n]=o,n=r}e[n]=i},_down:function(n){for(var e=this.data,t=this.compare,i=this.length>>1,r=e[n];n<i;){var o=(n<<1)+1,c=o+1,s=e[o];if(c<this.length&&t(e[c],s)<0&&(o=c,s=e[c]),t(s,r)>=0)break;e[n]=s,n=o}e[n]=r}};var Gte=gC.exports;const aL=Math.max,lL=Math.min;let ax=0;function cL(n,e,t,i,r,o){let c,s,f,p,g,_;for(c=0,s=n.length-1;c<s;c++){if(f=n[c],p=n[c+1],g=new jg(f,!1,void 0,e),_=new jg(p,!1,g,e),g.otherEvent=_,f[0]===p[0]&&f[1]===p[1])continue;g.contourId=_.contourId=t,o||(g.isExteriorRing=!1,_.isExteriorRing=!1),Ud(g,_)>0?_.left=!0:g.left=!0;const x=f[0],b=f[1];r[0]=lL(r[0],x),r[1]=lL(r[1],b),r[2]=aL(r[2],x),r[3]=aL(r[3],b),i.push(g),i.push(_)}}function qte(n,e,t,i,r){const o=new Gte(null,Ud);let c,s,f,p,g,_;for(f=0,p=n.length;f<p;f++)for(c=n[f],g=0,_=c.length;g<_;g++)s=g===0,s&&ax++,cL(c[g],!0,ax,o,t,s);for(f=0,p=e.length;f<p;f++)for(c=e[f],g=0,_=c.length;g<_;g++)s=g===0,s&&ax++,cL(c[g],!1,ax,o,i,s);return o}const mw=[];function Hte(n,e,t){let i=null;return n.length*e.length===0&&(i=mw),i}function Wte(n,e,t,i,r){let o=null;return(t[0]>i[2]||i[0]>t[2]||t[1]>i[3]||i[1]>t[3])&&(o=mw),o}function Zte(n,e,t){typeof n[0][0][0]=="number"&&(n=[n]),typeof e[0][0][0]=="number"&&(e=[e]);let i=Hte(n,e);if(i)return i===mw?null:i;const r=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],c=qte(n,e,r,o);if(i=Wte(n,e,r,o),i)return i===mw?null:i;const s=zte(c,n,e,r,o,t),f=Ute(s),p=[];for(let g=0;g<f.length;g++){let _=f[g];if(_.isExterior()){let x=[_.points];for(let b=0;b<_.holeIds.length;b++){let M=_.holeIds[b];x.push(f[M].points)}p.push(x)}}return p}function Xte(n,e){return Zte(n,e,fw)}class _z extends dC{constructor(){super(),this._subsampleThreshold=.005}_getPoleOfInaccessibility2d(e){return Tte([e],.03)}_project(e,t){const i=this._createCamera(t.upVector().toArray(),t.unprojectSfM([0,0],0),t.unprojectSfM([0,0],10));return this._deunproject(e,t,i)}_subsample(e,t=this._subsampleThreshold){const i=[],r=e.length;for(let o=0;o<r;o++){const c=e[o],s=e[(o+1)%r];i.push(c);const f=Math.sqrt(Math.pow(s[0]-c[0],2)+Math.pow(s[1]-c[1],2)),p=Math.floor(f/t),g=1/(p+1);for(let _=1;_<=p;_++){const x=_*g,b=[(1-x)*c[0]+x*s[0],(1-x)*c[1]+x*s[1]];i.push(b)}}return i}_triangulate(e,t,i,r){let o=[e.slice(0,-1)];for(let g of i??[])o.push(g.slice(0,-1));let c=t.slice(0,-1);for(let g of r??[])c=c.concat(g.slice(0,-1));let s=iL.flatten(o),f=iL(s.vertices,s.holes,s.dimensions),p=[];for(let g=0;g<f.length;++g){let _=c[f[g]];p.push(_[0]),p.push(_[1]),p.push(_[2])}return p}_triangulateSpherical(e,t,i){const r=[];for(let f=0;f<3;f++)for(let p=0;p<3;p++){const g=f===0?-1e-9:1e-9,_=p===0?-1e-9:1e-9,x=f/3+g,b=p/3+_,M=(f+1)/3+1e-9,P=(p+1)/3+1e-9,k=[[x,b],[x,P],[M,P],[M,b],[x,b]],L=[(2*f+1)/6,(2*p+1)/6];r.push(...this._triangulateSubarea(e,t,k,L,i))}return r}_unproject(e,t,i=200){return e.map(r=>t.unprojectBasic(r,i))}_createCamera(e,t,i){const r=new i0;return r.up.copy(new Fe().fromArray(e)),r.position.copy(new Fe().fromArray(t)),r.lookAt(new Fe().fromArray(i)),r.updateMatrix(),r.updateMatrixWorld(!0),r}_deunproject(e,t,i){return e.map(r=>{const o=t.unprojectBasic(r,1e4),c=new Fe(o[0],o[1],o[2]).applyMatrix4(i.matrixWorldInverse);return[c.x/c.z,c.y/c.z]})}_triangulateSubarea(e,t,i,r,o){const c=Xte([e,...t],[i]);if(!c)return[];const s=[],f=this._subsampleThreshold,p=this._createCamera(o.upVector().toArray(),o.unprojectSfM([0,0],0),o.unprojectBasic(r,10));for(const g of c){const _=this._subsample(g[0],f),x=this._deunproject(_,o,p),b=this._unproject(_,o),M=[],P=[];for(let k=1;k<g.length;k++){let L=this._subsample(g[k],f);const I=this._deunproject(L,o,p),F=this._unproject(L,o);M.push(I),P.push(F)}s.push(...this._triangulate(x,b,M,P))}return s}}class _a extends _z{constructor(e){if(super(),e.length!==4)throw new Ds("Rectangle needs to have four values.");if(e[1]>e[3])throw new Ds("Basic Y coordinates values can not be inverted.");for(let t of e)if(t<0||t>1)throw new Ds("Basic coordinates must be on the interval [0, 1].");this._anchorIndex=void 0,this._rect=e.slice(0,4),this._inverted=this._rect[0]>this._rect[2]}get anchorIndex(){return this._anchorIndex}get inverted(){return this._inverted}get rect(){return this._rect}initializeAnchorIndexing(e){if(this._anchorIndex!==void 0)throw new Ds("Anchor indexing is already initialized.");if(e<0||e>3)throw new Ds(`Invalid anchor index: ${e}.`);this._anchorIndex=e===void 0?0:e}terminateAnchorIndexing(){this._anchorIndex=void 0}setOppositeVertex2d(e,t){if(this._anchorIndex===void 0)throw new Ds("Anchor indexing needs to be initialized.");const i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))],r=this._rect.slice(),o=this._anchorIndex===0?[r[0],r[3]]:this._anchorIndex===1?[r[0],r[1]]:this._anchorIndex===2?[r[2],r[1]]:[r[2],r[3]];if(ki(t.cameraType)){const c=this._anchorIndex<2?i[0]-r[2]:i[0]-r[0];!this._inverted&&this._anchorIndex<2&&i[0]<.25&&r[2]>.75&&c<-.5?(this._inverted=!0,this._anchorIndex=o[1]>i[1]?0:1):!this._inverted&&this._anchorIndex>=2&&i[0]<.25&&r[2]>.75&&c<-.5?(this._inverted=!0,this._anchorIndex=o[1]>i[1]?0:1):this._inverted&&this._anchorIndex>=2&&i[0]<.25&&r[0]>.75&&c<-.5?(this._inverted=!1,o[0]>i[0]?this._anchorIndex=o[1]>i[1]?3:2:this._anchorIndex=o[1]>i[1]?0:1):!this._inverted&&this._anchorIndex>=2&&i[0]>.75&&r[0]<.25&&c>.5?(this._inverted=!0,this._anchorIndex=o[1]>i[1]?3:2):!this._inverted&&this._anchorIndex<2&&i[0]>.75&&r[0]<.25&&c>.5?(this._inverted=!0,this._anchorIndex=o[1]>i[1]?3:2):this._inverted&&this._anchorIndex<2&&i[0]>.75&&r[2]<.25&&c>.5?(this._inverted=!1,o[0]>i[0]?this._anchorIndex=o[1]>i[1]?3:2:this._anchorIndex=o[1]>i[1]?0:1):this._inverted&&this._anchorIndex<2&&i[0]>r[0]?(this._inverted=!1,this._anchorIndex=o[1]>i[1]?0:1):this._inverted&&this._anchorIndex>=2&&i[0]<r[2]?(this._inverted=!1,this._anchorIndex=o[1]>i[1]?3:2):this._inverted?this._anchorIndex<2?this._anchorIndex=o[1]>i[1]?0:1:this._anchorIndex=o[1]>i[1]?3:2:o[0]<=i[0]&&o[1]>i[1]?this._anchorIndex=0:o[0]<=i[0]&&o[1]<=i[1]?this._anchorIndex=1:o[0]>i[0]&&o[1]<=i[1]?this._anchorIndex=2:this._anchorIndex=3;const s=[];this._anchorIndex===0?(s[0]=o[0],s[1]=i[1],s[2]=i[0],s[3]=o[1]):this._anchorIndex===1?(s[0]=o[0],s[1]=o[1],s[2]=i[0],s[3]=i[1]):this._anchorIndex===2?(s[0]=i[0],s[1]=o[1],s[2]=o[0],s[3]=i[1]):(s[0]=i[0],s[1]=i[1],s[2]=o[0],s[3]=o[1]),(!this._inverted&&s[0]>s[2]||this._inverted&&s[0]<s[2])&&(s[0]=r[0],s[2]=r[2]),s[1]>s[3]&&(s[1]=r[1],s[3]=r[3]),this._rect[0]=s[0],this._rect[1]=s[1],this._rect[2]=s[2],this._rect[3]=s[3]}else{o[0]<=i[0]&&o[1]>i[1]?this._anchorIndex=0:o[0]<=i[0]&&o[1]<=i[1]?this._anchorIndex=1:o[0]>i[0]&&o[1]<=i[1]?this._anchorIndex=2:this._anchorIndex=3;const c=[];this._anchorIndex===0?(c[0]=o[0],c[1]=i[1],c[2]=i[0],c[3]=o[1]):this._anchorIndex===1?(c[0]=o[0],c[1]=o[1],c[2]=i[0],c[3]=i[1]):this._anchorIndex===2?(c[0]=i[0],c[1]=o[1],c[2]=o[0],c[3]=i[1]):(c[0]=i[0],c[1]=i[1],c[2]=o[0],c[3]=o[1]),c[0]>c[2]&&(c[0]=r[0],c[2]=r[2]),c[1]>c[3]&&(c[1]=r[1],c[3]=r[3]),this._rect[0]=c[0],this._rect[1]=c[1],this._rect[2]=c[2],this._rect[3]=c[3]}this._notifyChanged$.next(this)}setVertex2d(e,t,i){let r=this._rect.slice(),o=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))],c=[];if(e===0?(c[0]=o[0],c[1]=r[1],c[2]=r[2],c[3]=o[1]):e===1?(c[0]=o[0],c[1]=o[1],c[2]=r[2],c[3]=r[3]):e===2?(c[0]=r[0],c[1]=o[1],c[2]=o[0],c[3]=r[3]):e===3&&(c[0]=r[0],c[1]=r[1],c[2]=o[0],c[3]=o[1]),ki(i.cameraType)){let s=e<2&&o[0]>.75&&r[0]<.25||e>=2&&this._inverted&&o[0]>.75&&r[2]<.25,f=e<2&&this._inverted&&o[0]<.25&&r[0]>.75||e>=2&&o[0]<.25&&r[2]>.75;s||f?this._inverted=!this._inverted:(c[0]-r[0]<-.25&&(c[0]=r[0]),c[2]-r[2]>.25&&(c[2]=r[2])),(!this._inverted&&c[0]>c[2]||this._inverted&&c[0]<c[2])&&(c[0]=r[0],c[2]=r[2])}else c[0]>c[2]&&(c[0]=r[0],c[2]=r[2]);c[1]>c[3]&&(c[1]=r[1],c[3]=r[3]),this._rect[0]=c[0],this._rect[1]=c[1],this._rect[2]=c[2],this._rect[3]=c[3],this._notifyChanged$.next(this)}setCentroid2d(e,t){let i=this._rect.slice(),r=i[0],o=this._inverted?i[2]+1:i[2],c=i[1],s=i[3],f=r+(o-r)/2,p=c+(s-c)/2,g=0;if(ki(t.cameraType))g=this._inverted?e[0]+1-f:e[0]-f;else{let M=-r,P=1-o;g=Math.max(M,Math.min(P,e[0]-f))}let _=-c,x=1-s,b=Math.max(_,Math.min(x,e[1]-p));this._rect[0]=i[0]+g,this._rect[1]=i[1]+b,this._rect[2]=i[2]+g,this._rect[3]=i[3]+b,this._rect[0]<0?(this._rect[0]+=1,this._inverted=!this._inverted):this._rect[0]>1&&(this._rect[0]-=1,this._inverted=!this._inverted),this._rect[2]<0?(this._rect[2]+=1,this._inverted=!this._inverted):this._rect[2]>1&&(this._rect[2]-=1,this._inverted=!this._inverted),this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints2d().map(t=>e.unprojectBasic(t,200))}getVertex2d(e){return this._rectToVertices2d(this._rect)[e]}getNonAdjustedVertex2d(e){return this._rectToNonAdjustedVertices2d(this._rect)[e]}getVertex3d(e,t){return t.unprojectBasic(this._rectToVertices2d(this._rect)[e],200)}getVertices2d(){return this._rectToVertices2d(this._rect)}getVertices3d(e){return this._rectToVertices2d(this._rect).map(t=>e.unprojectBasic(t,200))}getCentroid2d(){const e=this._rect,t=e[0],i=this._inverted?e[2]+1:e[2],r=e[1],o=e[3],c=(t+i)/2,s=(r+o)/2;return[c,s]}getCentroid3d(e){const t=this.getCentroid2d();return e.unprojectBasic(t,200)}getPoleOfInaccessibility2d(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))}getPoleOfInaccessibility3d(e){let t=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return e.unprojectBasic(t,200)}getTriangles3d(e){return ki(e.cameraType)?[]:this._triangulate(this._project(this._getPoints2d(),e),this.getPoints3d(e))}validate(e){let t=this._rect;return!(!this._inverted&&e[0]<t[0]||e[0]-t[2]>.25||e[1]<t[1])}_getPoints2d(){let e=this._rectToVertices2d(this._rect),t=e.length-1,i=10,r=[];for(let o=0;o<t;++o){let c=e[o][0],s=e[o][1],f=e[o+1][0],p=e[o+1][1],g=(f-c)/(i-1),_=(p-s)/(i-1);for(let x=0;x<i;++x){let b=[c+x*g,s+x*_];r.push(b)}}return r}_rectToVertices2d(e){return[[e[0],e[3]],[e[0],e[1]],[this._inverted?e[2]+1:e[2],e[1]],[this._inverted?e[2]+1:e[2],e[3]],[e[0],e[3]]]}_rectToNonAdjustedVertices2d(e){return[[e[0],e[3]],[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]}}class Yte extends az{constructor(e,t,i,r){super(e,i,r),this._options={color:t.color==null?16777215:t.color,indicateCompleter:t.indicateCompleter==null?!0:t.indicateCompleter},this._rectGeometry=new _a(this._geometry.getRect2d(i)),this._createGlObjects()}create(){this._geometry.points.length<3||(this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this))}dispose(){super.dispose(),this._disposeObjects()}getDOMObjects(e,t){const i={offsetHeight:t.height,offsetWidth:t.width},r=[],o=this._geometry.getPoints2d(),c=o.length;for(let s=0;s<c-1;s++){const f=s,[p,g]=o[s],_=this._viewportCoords.basicToCanvasSafe(p,g,i,this._transform,e);if(!_)continue;const x=I=>{I.stopPropagation(),this._aborted$.next(this)},b=I=>{I.stopPropagation(),this._geometry.removePoint2d(f)},M=this._canvasToTransform(_),P={onclick:s===0&&c<3?x:b,style:{transform:M}};r.push(jt.h("div.mapillary-tag-interactor",P,[]));const L={style:{background:this._colorToBackground(this._options.color),transform:M}};r.push(jt.h("div.mapillary-tag-vertex",L,[]))}if(c>2&&this._options.indicateCompleter===!0){const[s,f]=this._geometry.getCentroid2d(this._transform),p=this._viewportCoords.basicToCanvasSafe(s,f,i,this._transform,e);if(p){const g=P=>{P.stopPropagation(),this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this)},_=this._canvasToTransform(p),x={onclick:g,style:{transform:_}};r.push(jt.h("div.mapillary-tag-completer.mapillary-tag-larger",x,[]));const b={style:{background:this._colorToBackground(this._options.color),transform:_}};r.push(jt.h("div.mapillary-tag-vertex.mapillary-tag-larger",b,[]));const M={style:{transform:_}};r.push(jt.h("div.mapillary-tag-dot",M,[]))}}return r}_onGeometryChanged(){this._disposeObjects(),this._rectGeometry=new _a(this._geometry.getRect2d(this._transform)),this._createGlObjects()}_createGlObjects(){this._glObjects=[];const e=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects.push(this._outline)}_disposeObjects(){this._disposeLine(this._outline),this._outline=null,this._glObjects=null}}class yh extends _z{constructor(e,t){super();let i=e.length;if(i<3)throw new Ds("A polygon must have three or more positions.");if(e[0][0]!==e[i-1][0]||e[0][1]!==e[i-1][1])throw new Ds("First and last positions must be equivalent.");this._polygon=[];for(let r of e){if(r[0]<0||r[0]>1||r[1]<0||r[1]>1)throw new Ds("Basic coordinates of polygon must be on the interval [0, 1].");this._polygon.push(r.slice())}if(this._holes=[],t!=null)for(let r=0;r<t.length;r++){let o=t[r],c=o.length;if(c<3)throw new Ds("A polygon hole must have three or more positions.");if(o[0][0]!==o[c-1][0]||o[0][1]!==o[c-1][1])throw new Ds("First and last positions of hole must be equivalent.");this._holes.push([]);for(let s of o){if(s[0]<0||s[0]>1||s[1]<0||s[1]>1)throw new Ds("Basic coordinates of hole must be on the interval [0, 1].");this._holes[r].push(s.slice())}}}get polygon(){return this._polygon}get holes(){return this._holes}addVertex2d(e){let t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._polygon.splice(this._polygon.length-1,0,t),this._notifyChanged$.next(this)}getVertex2d(e){return this._polygon[e].slice()}removeVertex2d(e){if(e<0||e>=this._polygon.length||this._polygon.length<4)throw new Ds("Index for removed vertex must be valid.");if(e>0&&e<this._polygon.length-1)this._polygon.splice(e,1);else{this._polygon.splice(0,1),this._polygon.pop();let t=this._polygon[0].slice();this._polygon.push(t)}this._notifyChanged$.next(this)}setVertex2d(e,t,i){let r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];e===0||e===this._polygon.length-1?(this._polygon[0]=r.slice(),this._polygon[this._polygon.length-1]=r.slice()):this._polygon[e]=r.slice(),this._notifyChanged$.next(this)}setCentroid2d(e,t){let i=this._polygon.map(k=>k[0]),r=this._polygon.map(k=>k[1]),o=Math.min.apply(Math,i),c=Math.max.apply(Math,i),s=Math.min.apply(Math,r),f=Math.max.apply(Math,r),p=this.getCentroid2d(),g=-o,_=1-c,x=-s,b=1-f,M=Math.max(g,Math.min(_,e[0]-p[0])),P=Math.max(x,Math.min(b,e[1]-p[1]));for(let k of this._polygon)k[0]+=M,k[1]+=P;this._notifyChanged$.next(this)}getPoints3d(e){return this._getPoints3d(this._subsample(this._polygon),e)}getVertex3d(e,t){return t.unprojectBasic(this._polygon[e],200)}getVertices2d(){return this._polygon.slice()}getVertices3d(e){return this._getPoints3d(this._polygon,e)}getHolePoints3d(e){return this._holes.map(t=>this._getPoints3d(this._subsample(t),e))}getHoleVertices3d(e){return this._holes.map(t=>this._getPoints3d(t,e))}getCentroid2d(){let e=this._polygon,t=0,i=0,r=0;for(let o=0;o<e.length-1;o++){let c=e[o][0],s=e[o][1],f=e[o+1][0],p=e[o+1][1],g=c*p-f*s;t+=g,i+=(c+f)*g,r+=(s+p)*g}return t/=2,i/=6*t,r/=6*t,[i,r]}getCentroid3d(e){let t=this.getCentroid2d();return e.unprojectBasic(t,200)}get3dDomainTriangles3d(e){return this._triangulate(this._project(this._polygon,e),this.getVertices3d(e),this._holes.map(t=>this._project(t,e)),this.getHoleVertices3d(e))}getTriangles3d(e){if(ki(e.cameraType))return this._triangulateSpherical(this._polygon.slice(),this.holes.slice(),e);const t=this._project(this._subsample(this._polygon),e),i=this.getPoints3d(e),r=this._holes.map(c=>this._project(this._subsample(c),e)),o=this.getHolePoints3d(e);return this._triangulate(t,i,r,o)}getPoleOfInaccessibility2d(){return this._getPoleOfInaccessibility2d(this._polygon.slice())}getPoleOfInaccessibility3d(e){let t=this._getPoleOfInaccessibility2d(this._polygon.slice());return e.unprojectBasic(t,200)}_getPoints3d(e,t){return e.map(i=>t.unprojectBasic(i,200))}}class uL extends az{constructor(e,t,i,r){super(e,i,r),this._options={color:t.color==null?16777215:t.color},this._createGlObjects()}create(){if(this._geometry instanceof _a)this._created$.next(this);else if(this._geometry instanceof yh){const e=this._geometry;e.removeVertex2d(e.polygon.length-2),this._created$.next(this)}}dispose(){super.dispose(),this._disposeLine(this._outline),this._disposeObjects()}getDOMObjects(e,t){const i=[],r={offsetHeight:t.height,offsetWidth:t.width},o=c=>{c.stopPropagation(),this._aborted$.next(this)};if(this._geometry instanceof _a){const c=this._geometry.anchorIndex,s=c===void 0?1:c,[f,p]=this._geometry.getVertex2d(s),g=this._viewportCoords.basicToCanvasSafe(f,p,r,this._transform,e);if(g!=null){const _=this._colorToBackground(this._options.color),x=this._canvasToTransform(g),b={style:{background:_,transform:x}},M={onclick:o,style:{transform:x}};i.push(jt.h("div.mapillary-tag-interactor",M,[])),i.push(jt.h("div.mapillary-tag-vertex",b,[]))}}else if(this._geometry instanceof yh){const c=this._geometry,[s,f]=c.getVertex2d(0),p=this._viewportCoords.basicToCanvasSafe(s,f,r,this._transform,e);if(p!=null){const _=c.polygon.length>4?P=>{P.stopPropagation(),c.removeVertex2d(c.polygon.length-2),this._created$.next(this)}:o,x=this._canvasToTransform(p),b={onclick:_,style:{transform:x}},M=c.polygon.length>4?"mapillary-tag-completer":"mapillary-tag-interactor";i.push(jt.h("div."+M,b,[]))}if(c.polygon.length>3){const[_,x]=c.getVertex2d(c.polygon.length-3),b=this._viewportCoords.basicToCanvasSafe(_,x,r,this._transform,e);if(b!=null){const M=L=>{L.stopPropagation(),c.removeVertex2d(c.polygon.length-3)},P=this._canvasToTransform(b),k={onclick:M,style:{transform:P}};i.push(jt.h("div.mapillary-tag-interactor",k,[]))}}const g=c.polygon.slice();g.splice(-2,2);for(const _ of g){const x=this._viewportCoords.basicToCanvasSafe(_[0],_[1],r,this._transform,e);if(x!=null){const b=this._colorToBackground(this._options.color),M=this._canvasToTransform(x),P={style:{background:b,transform:M}};i.push(jt.h("div.mapillary-tag-vertex",P,[]))}}}return i}addPoint(e){if(this._geometry instanceof _a){if(!this._geometry.validate(e))return;this._created$.next(this)}else this._geometry instanceof yh&&this._geometry.addVertex2d(e)}_onGeometryChanged(){this._disposeLine(this._outline),this._disposeObjects(),this._createGlObjects()}_disposeObjects(){this._outline=null,this._glObjects=[]}_createGlObjects(){const e=this._geometry instanceof _a?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(e,this._options.color),this._glObjects=[this._outline]}}class Kte{constructor(e,t){this._component=e,this._navigator=t,this._tagOperation$=new ri,this._createPoints$=new ri,this._createPolygon$=new ri,this._createRect$=new ri,this._delete$=new ri,this._tag$=this._tagOperation$.pipe(Vr((i,r)=>r(i),null),dn()),this._replayedTag$=this._tag$.pipe(Pi(1),gi()),this._replayedTag$.subscribe(),this._createPoints$.pipe(Ui(this._component.configuration$,this._navigator.stateService.currentTransform$),We(([i,r,o])=>()=>{const c=new ete([[i[0],i[1]],[i[0],i[1]]]);return new Yte(c,{color:r.createColor,indicateCompleter:r.indicatePointsCompleter},o)})).subscribe(this._tagOperation$),this._createRect$.pipe(Ui(this._component.configuration$,this._navigator.stateService.currentTransform$),We(([i,r,o])=>()=>{const c=new _a([i[0],i[1],i[0],i[1]]);return new uL(c,{color:r.createColor},o)})).subscribe(this._tagOperation$),this._createPolygon$.pipe(Ui(this._component.configuration$,this._navigator.stateService.currentTransform$),We(([i,r,o])=>()=>{const c=new yh([[i[0],i[1]],[i[0],i[1]],[i[0],i[1]]]);return new uL(c,{color:r.createColor},o)})).subscribe(this._tagOperation$),this._delete$.pipe(We(()=>()=>null)).subscribe(this._tagOperation$)}get createRect$(){return this._createRect$}get createPolygon$(){return this._createPolygon$}get createPoints$(){return this._createPoints$}get delete$(){return this._delete$}get tag$(){return this._tag$}get replayedTag$(){return this._replayedTag$}}class Jte{render(e,t,i,r,o){let c=[];for(const s of e)c=c.concat(s.getDOMObjects(i,r,o));return t!=null&&(c=c.concat(t.getDOMObjects(r,o))),jt.h("div.mapillary-tag-container",{},c)}clear(){return jt.h("div",{},[])}}class Qte{constructor(e,t){this._createTag=null,this._needsRender=!1,this._raycaster=t||new sw,this._scene=e||new _h,this._objectTags={},this._retrievableObjects=[],this._tags={}}get needsRender(){return this._needsRender}add(e){for(let t of e)t.tag.id in this._tags&&this._remove(t.tag.id),this._add(t);this._needsRender=!0}addCreateTag(e){for(const t of e.glObjects)this._scene.add(t);this._createTag={tag:e,objects:e.glObjects},this._needsRender=!0}clear(){for(const e of Object.keys(this._tags))this._remove(e);this._needsRender=!1}get(e){return this.has(e)?this._tags[e].tag:void 0}has(e){return e in this._tags}hasCreateTag(){return this._createTag!=null}intersectObjects([e,t],i){this._raycaster.setFromCamera(new li(e,t),i);const r=this._raycaster.intersectObjects(this._retrievableObjects),o=[];for(const c of r)c.object.uuid in this._objectTags&&o.push(this._objectTags[c.object.uuid]);return o}remove(e){for(const t of e)this._remove(t);this._needsRender=!0}removeAll(){for(const e of Object.keys(this._tags))this._remove(e);this._needsRender=!0}removeCreateTag(){if(this._createTag!=null){for(const e of this._createTag.objects)this._scene.remove(e);this._createTag.tag.dispose(),this._createTag=null,this._needsRender=!0}}render(e,t){t.render(this._scene,e),this._needsRender=!1}update(){this._needsRender=!0}updateCreateTagObjects(e){if(this._createTag.tag!==e)throw new Error("Create tags do not have the same reference.");for(let t of this._createTag.objects)this._scene.remove(t);for(const t of e.glObjects)this._scene.add(t);this._createTag.objects=e.glObjects,this._needsRender=!0}updateObjects(e){const t=e.tag.id;if(this._tags[t].tag!==e)throw new Error("Tags do not have the same reference.");const i=this._tags[t];this._removeObjects(i),delete this._tags[t],this._add(e),this._needsRender=!0}_add(e){const t=e.tag.id,i={tag:e,objects:[],retrievableObjects:[]};this._tags[t]=i;for(const r of e.getGLObjects())i.objects.push(r),this._scene.add(r);for(const r of e.getRetrievableObjects())i.retrievableObjects.push(r),this._retrievableObjects.push(r),this._objectTags[r.uuid]=e.tag.id}_remove(e){const t=this._tags[e];this._removeObjects(t),t.tag.dispose(),delete this._tags[e]}_removeObjects(e){for(const t of e.objects)this._scene.remove(t);for(const t of e.retrievableObjects){const i=this._retrievableObjects.indexOf(t);i!==-1&&this._retrievableObjects.splice(i,1)}}}var gg;(function(n){n[n.Default=0]="Default",n[n.CreatePoint=1]="CreatePoint",n[n.CreatePoints=2]="CreatePoints",n[n.CreatePolygon=3]="CreatePolygon",n[n.CreateRect=4]="CreateRect",n[n.CreateRectDrag=5]="CreateRectDrag"})(gg||(gg={}));var il;(function(n){n[n.None=0]="None",n[n.Centroid=1]="Centroid",n[n.Vertex=2]="Vertex"})(il||(il={}));class vz{constructor(e,t,i){this._tag=e,this._transform=t,this._viewportCoords=i||new zo,this._glObjectsChanged$=new ri,this._interact$=new ri}get glObjectsChanged$(){return this._glObjectsChanged$}get interact$(){return this._interact$}get tag(){return this._tag}}class yz extends vz{constructor(e,t){super(e,t),this._geometryChangedSubscription=this._tag.geometry.changed$.subscribe(()=>{this._onGeometryChanged()}),this._changedSubscription=this._tag.changed$.subscribe(()=>{this._onTagChanged()&&this._glObjectsChanged$.next(this)})}dispose(){this._changedSubscription.unsubscribe(),this._geometryChangedSubscription.unsubscribe()}_colorToCss(e){return"#"+("000000"+e.toString(16)).substr(-6)}_createFill(){let e=this._getTriangles(),t=new Float32Array(e),i=new $n;i.setAttribute("position",new Mn(t,3)),i.computeBoundingSphere();let r=new e0({side:Ko,transparent:!0});return this._updateFillMaterial(r),new kr(i,r)}_createLine(e){let t=this._getLinePositions(e),i=new $n;i.setAttribute("position",new Mn(t,3)),i.computeBoundingSphere();let r=new Ah;this._updateLineBasicMaterial(r);const o=new Sp(i,r);return o.renderOrder=1,o}_createOutline(){return this._createLine(this._getPoints3d())}_disposeFill(){this._fill!=null&&(this._fill.geometry.dispose(),this._fill.material.dispose(),this._fill=null)}_disposeOutline(){this._outline!=null&&(this._outline.geometry.dispose(),this._outline.material.dispose(),this._outline=null)}_getLinePositions(e){let t=e.length,i=new Float32Array(t*3);for(let r=0;r<t;++r){let o=3*r,c=e[r];i[o+0]=c[0],i[o+1]=c[1],i[o+2]=c[2]}return i}_interact(e,t,i){return r=>{let o=r.offsetX-r.target.offsetWidth/2,c=r.offsetY-r.target.offsetHeight/2;this._interact$.next({cursor:t,offsetX:o,offsetY:c,operation:e,tag:this._tag,vertexIndex:i})}}_updateFillGeometry(){let e=this._getTriangles(),t=new Float32Array(e),i=this._fill.geometry,r=i.getAttribute("position");r.array.length===t.length?(r.set(t),r.needsUpdate=!0):(i.deleteAttribute("position"),i.setAttribute("position",new Mn(t,3))),i.computeBoundingSphere()}_updateLine(e,t){let i=this._getLinePositions(t),r=e.geometry,o=r.getAttribute("position");o.set(i),o.needsUpdate=!0,r.computeBoundingSphere()}_updateOulineGeometry(){this._updateLine(this._outline,this._getPoints3d())}}class eie extends yz{constructor(e,t){super(e,t),this._rectGeometry=new _a(this._tag.geometry.getRect2d(t)),this._fill=ki(t.cameraType)?null:this._createFill(),this._outline=this._tag.lineWidth>=1?this._createOutline():null}dispose(){super.dispose(),this._disposeFill(),this._disposeOutline()}getDOMObjects(e,t,i){const r=[],o={offsetHeight:i.height,offsetWidth:i.width};if(!this._tag.editable)return r;const c=this._colorToCss(this._tag.lineColor),s=this._tag.geometry.getPoints2d();for(let f=0;f<s.length;f++){const[p,g]=s[f],_=this._viewportCoords.basicToCanvasSafe(p,g,o,this._transform,t);if(_==null)continue;const x="crosshair",b=this._interact(il.Vertex,x,f),M=Math.round(_[0]),P=Math.round(_[1]),k=`translate(-50%, -50%) translate(${M}px,${P}px)`,L={onpointerdown:b,style:{background:c,transform:k,cursor:x}};if(r.push(jt.h("div.mapillary-tag-resizer",L,[])),!this._tag.indicateVertices)continue;const I={style:{background:c,transform:k}};r.push(jt.h("div.mapillary-tag-vertex",I,[]))}return r}getGLObjects(){const e=[];return this._fill!=null&&e.push(this._fill),this._outline!=null&&e.push(this._outline),e}getRetrievableObjects(){return this._fill!=null?[this._fill]:[]}_onGeometryChanged(){this._rectGeometry=new _a(this._tag.geometry.getRect2d(this._transform)),this._fill!=null&&this._updateFillGeometry(),this._outline!=null&&this._updateOulineGeometry()}_onTagChanged(){let e=!1;return this._fill!=null&&this._updateFillMaterial(this._fill.material),this._outline==null?this._tag.lineWidth>=1&&(this._outline=this._createOutline(),e=!0):this._updateOutlineMaterial(),e}_getPoints3d(){return this._rectGeometry.getPoints3d(this._transform)}_getTriangles(){return this._rectGeometry.getTriangles3d(this._transform)}_updateFillMaterial(e){e.color=new Bi(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}_updateLineBasicMaterial(e){e.color=new Bi(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}_updateOutlineMaterial(){let e=this._outline.material;this._updateLineBasicMaterial(e)}}class _C extends Xw{constructor(e,t){super(),this._id=e,this._geometry=t,this._notifyChanged$=new ri,this._notifyChanged$.subscribe(i=>{const o={target:this,type:"tag"};this.fire("tag",o)}),this._geometry.changed$.subscribe(i=>{const r="geometry",o={target:this,type:r};this.fire(r,o)})}get id(){return this._id}get geometry(){return this._geometry}get changed$(){return this._notifyChanged$}get geometryChanged$(){return this._geometry.changed$.pipe(We(()=>this),dn())}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}}class hL extends _C{constructor(e,t,i){super(e,t),i=i||{},this._editable=i.editable==null?!1:i.editable,this._fillColor=i.fillColor==null?16777215:i.fillColor,this._fillOpacity=i.fillOpacity==null?0:i.fillOpacity,this._indicateVertices=i.indicateVertices==null?!0:i.indicateVertices,this._lineColor=i.lineColor==null?16777215:i.lineColor,this._lineOpacity=i.lineOpacity==null?1:i.lineOpacity,this._lineWidth=i.lineWidth==null?1:i.lineWidth}get editable(){return this._editable}set editable(e){this._editable=e,this._notifyChanged$.next(this)}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this._notifyChanged$.next(this)}get fillOpacity(){return this._fillOpacity}set fillOpacity(e){this._fillOpacity=e,this._notifyChanged$.next(this)}get geometry(){return this._geometry}get indicateVertices(){return this._indicateVertices}set indicateVertices(e){this._indicateVertices=e,this._notifyChanged$.next(this)}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this._notifyChanged$.next(this)}get lineOpacity(){return this._lineOpacity}set lineOpacity(e){this._lineOpacity=e,this._notifyChanged$.next(this)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._notifyChanged$.next(this)}setOptions(e){this._editable=e.editable==null?this._editable:e.editable,this._indicateVertices=e.indicateVertices==null?this._indicateVertices:e.indicateVertices,this._lineColor=e.lineColor==null?this._lineColor:e.lineColor,this._lineWidth=e.lineWidth==null?this._lineWidth:e.lineWidth,this._fillColor=e.fillColor==null?this._fillColor:e.fillColor,this._fillOpacity=e.fillOpacity==null?this._fillOpacity:e.fillOpacity,this._notifyChanged$.next(this)}}var Gg;(function(n){n[n.TwoDimensional=0]="TwoDimensional",n[n.ThreeDimensional=1]="ThreeDimensional"})(Gg||(Gg={}));class tie extends yz{constructor(e,t){super(e,t),this._fill=ki(t.cameraType)?e.domain===Gg.TwoDimensional&&e.geometry instanceof yh?this._createFill():null:this._createFill(),this._holes=this._tag.lineWidth>=1?this._createHoles():[],this._outline=this._tag.lineWidth>=1?this._createOutline():null}dispose(){super.dispose(),this._disposeFill(),this._disposeHoles(),this._disposeOutline()}getDOMObjects(e,t,i){const r=[],o=this._tag.geometry instanceof _a,c=!ki(this._transform.cameraType),s={offsetHeight:i.height,offsetWidth:i.width};if(this._tag.icon!=null&&(o||c)){const[g,_]=this._tag.geometry instanceof _a?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),x=this._viewportCoords.basicToCanvasSafe(g,_,s,this._transform,t);if(x!=null){const b=()=>{this._interact$.next({offsetX:0,offsetY:0,operation:il.None,tag:this._tag})};if(e.loaded){const M=e.getDOMSprite(this._tag.icon,this._tag.iconFloat),P=Math.round(x[0]),k=Math.round(x[1]),L=`translate(${P}px,${k}px)`,F={onclick:N=>{N.stopPropagation(),this._tag.click$.next(this._tag)},onpointerdown:b,style:{transform:L}};r.push(jt.h("div.mapillary-tag-symbol",F,[M]))}}}else if(this._tag.text!=null&&(o||c)){const[g,_]=this._tag.geometry instanceof _a?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),x=this._viewportCoords.basicToCanvasSafe(g,_,s,this._transform,t);if(x!=null){const b=Math.round(x[0]),M=Math.round(x[1]),P=this._tag.geometry instanceof _a?`translate(${b}px,${M}px)`:`translate(-50%, -50%) translate(${b}px,${M}px)`,L={onpointerdown:()=>{this._interact$.next({offsetX:0,offsetY:0,operation:il.None,tag:this._tag})},style:{color:this._colorToCss(this._tag.textColor),transform:P},textContent:this._tag.text};r.push(jt.h("span.mapillary-tag-symbol",L,[]))}}if(!this._tag.editable)return r;const f=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof _a){const[g,_]=this._tag.geometry.getCentroid2d(),x=this._viewportCoords.basicToCanvasSafe(g,_,s,this._transform,t);if(x!=null){const b=this._interact(il.Centroid,"move"),M=Math.round(x[0]),P=Math.round(x[1]),k=`translate(-50%, -50%) translate(${M}px,${P}px)`,L={onpointerdown:b,style:{background:f,transform:k}};r.push(jt.h("div.mapillary-tag-mover",L,[]))}}const p=this._tag.geometry.getVertices2d();for(let g=0;g<p.length-1;g++){if(o&&(this._tag.icon!=null&&g===this._tag.iconIndex||this._tag.icon==null&&this._tag.text!=null&&g===3))continue;const[_,x]=p[g],b=this._viewportCoords.basicToCanvasSafe(_,x,s,this._transform,t);if(b==null)continue;const M=o?g%2===0?"nesw-resize":"nwse-resize":"crosshair",P=this._interact(il.Vertex,M,g),k=Math.round(b[0]),L=Math.round(b[1]),I=`translate(-50%, -50%) translate(${k}px,${L}px)`,F={onpointerdown:P,style:{background:f,transform:I,cursor:M}};if(r.push(jt.h("div.mapillary-tag-resizer",F,[])),!this._tag.indicateVertices)continue;const N={style:{background:f,transform:I}};r.push(jt.h("div.mapillary-tag-vertex",N,[]))}return r}getGLObjects(){const e=[];this._fill!=null&&e.push(this._fill);for(const t of this._holes)e.push(t);return this._outline!=null&&e.push(this._outline),e}getRetrievableObjects(){return this._fill!=null?[this._fill]:[]}_onGeometryChanged(){this._fill!=null&&this._updateFillGeometry(),this._holes.length>0&&this._updateHoleGeometries(),this._outline!=null&&this._updateOulineGeometry()}_onTagChanged(){let e=!1;return this._fill!=null&&this._updateFillMaterial(this._fill.material),this._outline==null?this._tag.lineWidth>=1&&(this._holes=this._createHoles(),this._outline=this._createOutline(),e=!0):(this._updateHoleMaterials(),this._updateOutlineMaterial()),e}_getPoints3d(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)}_getTriangles(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)}_updateFillMaterial(e){e.color=new Bi(this._tag.fillColor),e.opacity=this._tag.fillOpacity,e.needsUpdate=!0}_updateLineBasicMaterial(e){e.color=new Bi(this._tag.lineColor),e.linewidth=Math.max(this._tag.lineWidth,1),e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0,e.opacity=this._tag.lineOpacity,e.transparent=this._tag.lineOpacity<1,e.needsUpdate=!0}_createHoles(){let e=[];if(this._tag.geometry instanceof yh){let t=this._getHoles3d();for(let i of t){let r=this._createLine(i);e.push(r)}}return e}_disposeHoles(){for(let e of this._holes)e.geometry.dispose(),e.material.dispose();this._holes=[]}_getHoles3d(){const e=this._tag.geometry;return this._in3dDomain()?e.getHoleVertices3d(this._transform):e.getHolePoints3d(this._transform)}_in3dDomain(){return this._tag.geometry instanceof yh&&this._tag.domain===Gg.ThreeDimensional}_updateHoleGeometries(){let e=this._getHoles3d();if(e.length!==this._holes.length)throw new Error("Changing the number of holes is not supported.");for(let t=0;t<this._holes.length;t++){let i=e[t],r=this._holes[t];this._updateLine(r,i)}}_updateHoleMaterials(){for(const e of this._holes)this._updateLineBasicMaterial(e.material)}_updateOutlineMaterial(){this._updateLineBasicMaterial(this._outline.material)}}var ss;(function(n){n[n.Bottom=0]="Bottom",n[n.BottomLeft=1]="BottomLeft",n[n.BottomRight=2]="BottomRight",n[n.Center=3]="Center",n[n.Left=4]="Left",n[n.Right=5]="Right",n[n.Top=6]="Top",n[n.TopLeft=7]="TopLeft",n[n.TopRight=8]="TopRight"})(ss||(ss={}));class dL extends _C{constructor(e,t,i){super(e,t),i=i||{};const r=i.domain!=null&&t instanceof yh?i.domain:Gg.TwoDimensional,o=this._twoDimensionalPolygon(r,t);this._domain=r,this._editable=i.editable==null||o?!1:i.editable,this._fillColor=i.fillColor==null?16777215:i.fillColor,this._fillOpacity=i.fillOpacity==null?0:i.fillOpacity,this._icon=i.icon===void 0?null:i.icon,this._iconFloat=i.iconFloat==null?ss.Center:i.iconFloat,this._iconIndex=i.iconIndex==null?3:i.iconIndex,this._indicateVertices=i.indicateVertices==null?!0:i.indicateVertices,this._lineColor=i.lineColor==null?16777215:i.lineColor,this._lineOpacity=i.lineOpacity==null?1:i.lineOpacity,this._lineWidth=i.lineWidth==null?1:i.lineWidth,this._text=i.text===void 0?null:i.text,this._textColor=i.textColor==null?16777215:i.textColor,this._click$=new ri,this._click$.subscribe(()=>{const c="click",s={target:this,type:c};this.fire(c,s)})}get click$(){return this._click$}get domain(){return this._domain}get editable(){return this._editable}set editable(e){this._twoDimensionalPolygon(this._domain,this._geometry)||(this._editable=e,this._notifyChanged$.next(this))}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this._notifyChanged$.next(this)}get fillOpacity(){return this._fillOpacity}set fillOpacity(e){this._fillOpacity=e,this._notifyChanged$.next(this)}get geometry(){return this._geometry}get icon(){return this._icon}set icon(e){this._icon=e,this._notifyChanged$.next(this)}get iconFloat(){return this._iconFloat}set iconFloat(e){this._iconFloat=e,this._notifyChanged$.next(this)}get iconIndex(){return this._iconIndex}set iconIndex(e){this._iconIndex=e,this._notifyChanged$.next(this)}get indicateVertices(){return this._indicateVertices}set indicateVertices(e){this._indicateVertices=e,this._notifyChanged$.next(this)}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this._notifyChanged$.next(this)}get lineOpacity(){return this._lineOpacity}set lineOpacity(e){this._lineOpacity=e,this._notifyChanged$.next(this)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._notifyChanged$.next(this)}get text(){return this._text}set text(e){this._text=e,this._notifyChanged$.next(this)}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this._notifyChanged$.next(this)}fire(e,t){super.fire(e,t)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}setOptions(e){const t=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=t||e.editable==null?this._editable:e.editable,this._icon=e.icon===void 0?this._icon:e.icon,this._iconFloat=e.iconFloat==null?this._iconFloat:e.iconFloat,this._iconIndex=e.iconIndex==null?this._iconIndex:e.iconIndex,this._indicateVertices=e.indicateVertices==null?this._indicateVertices:e.indicateVertices,this._lineColor=e.lineColor==null?this._lineColor:e.lineColor,this._lineWidth=e.lineWidth==null?this._lineWidth:e.lineWidth,this._fillColor=e.fillColor==null?this._fillColor:e.fillColor,this._fillOpacity=e.fillOpacity==null?this._fillOpacity:e.fillOpacity,this._text=e.text===void 0?this._text:e.text,this._textColor=e.textColor==null?this._textColor:e.textColor,this._notifyChanged$.next(this)}_twoDimensionalPolygon(e,t){return e!==Gg.ThreeDimensional&&t instanceof yh}}class iie extends vz{dispose(){}getDOMObjects(e,t,i){const r=this._tag,o={offsetHeight:i.height,offsetWidth:i.width},c=[],[s,f]=r.geometry.getCentroid2d(),p=this._viewportCoords.basicToCanvasSafe(s,f,o,this._transform,t);if(p!=null){const g=L=>{this._interact$.next({offsetX:0,offsetY:0,operation:il.None,tag:r})},_=Math.round(p[0]),x=Math.round(p[1]);if(r.icon!=null){if(e.loaded){const L=e.getDOMSprite(r.icon,ss.Bottom),I=`translate(${_}px,${x+8}px)`,F={onpointerdown:g,style:{pointerEvents:"all",transform:I}};c.push(jt.h("div",F,[L]))}}else if(r.text!=null){const L=`translate(-50%,0%) translate(${_}px,${x+8}px)`,I={onpointerdown:g,style:{color:this._colorToCss(r.textColor),transform:L},textContent:r.text};c.push(jt.h("span.mapillary-tag-symbol",I,[]))}const b=this._interact(il.Centroid,r,"move"),M=this._colorToCss(r.color),P=`translate(-50%,-50%) translate(${_}px,${x}px)`;if(r.editable){let L={onpointerdown:b,style:{background:M,transform:P}};c.push(jt.h("div.mapillary-tag-spot-interactor",L,[]))}const k={style:{background:M,transform:P}};c.push(jt.h("div.mapillary-tag-vertex",k,[]))}return c}getGLObjects(){return[]}getRetrievableObjects(){return[]}_colorToCss(e){return"#"+("000000"+e.toString(16)).substr(-6)}_interact(e,t,i,r){return o=>{const c=o.offsetX-o.target.offsetWidth/2,s=o.offsetY-o.target.offsetHeight/2;this._interact$.next({cursor:i,offsetX:c,offsetY:s,operation:e,tag:t,vertexIndex:r})}}}class fL extends _C{constructor(e,t,i){super(e,t),i=i||{},this._color=i.color==null?16777215:i.color,this._editable=i.editable==null?!1:i.editable,this._icon=i.icon===void 0?null:i.icon,this._text=i.text===void 0?null:i.text,this._textColor=i.textColor==null?16777215:i.textColor}get color(){return this._color}set color(e){this._color=e,this._notifyChanged$.next(this)}get editable(){return this._editable}set editable(e){this._editable=e,this._notifyChanged$.next(this)}get icon(){return this._icon}set icon(e){this._icon=e,this._notifyChanged$.next(this)}get text(){return this._text}set text(e){this._text=e,this._notifyChanged$.next(this)}get textColor(){return this._textColor}set textColor(e){this._textColor=e,this._notifyChanged$.next(this)}setOptions(e){this._color=e.color==null?this._color:e.color,this._editable=e.editable==null?this._editable:e.editable,this._icon=e.icon===void 0?this._icon:e.icon,this._text=e.text===void 0?this._text:e.text,this._textColor=e.textColor==null?this._textColor:e.textColor,this._notifyChanged$.next(this)}}class nie{constructor(){this._active=!1,this._hash={},this._hashDeactivated={},this._notifyChanged$=new ri}get active(){return this._active}get changed$(){return this._notifyChanged$}activate(e){if(!this._active){for(const t in this._hashDeactivated){if(!this._hashDeactivated.hasOwnProperty(t))continue;const i=this._hashDeactivated[t];this._add(i,e)}this._hashDeactivated={},this._active=!0,this._notifyChanged$.next(this)}}deactivate(){if(this._active){for(const e in this._hash)this._hash.hasOwnProperty(e)&&(this._hashDeactivated[e]=this._hash[e].tag);this._hash={},this._active=!1}}add(e,t){this._assertActivationState(!0);for(const i of e)this._add(i,t);this._notifyChanged$.next(this)}addDeactivated(e){this._assertActivationState(!1);for(const t of e){if(!(t instanceof dL||t instanceof fL||t instanceof hL))throw new Error("Tag type not supported");this._hashDeactivated[t.id]=t}}get(e){return this.has(e)?this._hash[e]:void 0}getAll(){const e=this._hash;return Object.keys(e).map(t=>e[t])}getAllDeactivated(){const e=this._hashDeactivated;return Object.keys(e).map(t=>e[t])}getDeactivated(e){return this.hasDeactivated(e)?this._hashDeactivated[e]:void 0}has(e){return e in this._hash}hasDeactivated(e){return e in this._hashDeactivated}remove(e){this._assertActivationState(!0);const t=this._hash;for(const i of e)i in t&&delete t[i];this._notifyChanged$.next(this)}removeAll(){this._assertActivationState(!0),this._hash={},this._notifyChanged$.next(this)}removeAllDeactivated(){this._assertActivationState(!1),this._hashDeactivated={}}removeDeactivated(e){this._assertActivationState(!1);const t=this._hashDeactivated;for(const i of e)i in t&&delete t[i]}_add(e,t){if(e instanceof dL)this._hash[e.id]=new tie(e,t);else if(e instanceof fL)this._hash[e.id]=new iie(e,t);else if(e instanceof hL)this._hash[e.id]=new eie(e,t);else throw new Error("Tag type not supported")}_assertActivationState(e){if(e!==this._active)throw new Error("Tag set not in correct state for operation.")}}class rie extends dC{constructor(e){super();let t=e[0],i=e[1];if(t<0||t>1||i<0||i>1)throw new Ds("Basic coordinates must be on the interval [0, 1].");this._point=e.slice()}get point(){return this._point}getCentroid2d(){return this._point.slice()}getCentroid3d(e){return e.unprojectBasic(this._point,200)}setCentroid2d(e,t){let i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._point[0]=i[0],this._point[1]=i[1],this._notifyChanged$.next(this)}}class bz extends xu{constructor(e,t,i,r){super(e,t,i),this._name=`${this._component.name}-${this._getNameExtension()}`,this._viewportCoords=r}_getConfiguration(e){return{}}_mouseEventToBasic(e,t,i,r,o,c){o=o??0,c=c??0;const[s,f]=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToBasic(s-o,f-c,t,r,i.perspective)}}class vC extends bz{constructor(e,t,i,r,o){super(e,t,i,r),this._tagCreator=o,this._geometryCreated$=new ri}get geometryCreated$(){return this._geometryCreated$}_enable(){this._enableCreate(),this._container.container.classList.add("component-tag-create")}_disable(){this._container.container.classList.remove("component-tag-create"),this._disableCreate()}_validateBasic(e){const t=e[0],i=e[1];return 0<=t&&t<=1&&0<=i&&i<=1}_mouseEventToBasic$(e){return e.pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),We(([t,i,r])=>this._mouseEventToBasic(t,this._container.container,i,r)))}}class sie extends vC{_enableCreate(){this._container.mouseService.deferPixels(this._name,4),this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(oi(this._validateBasic),We(e=>new rie(e))).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.undeferPixels(this._name),this._geometryCreatedSubscription.unsubscribe()}_getNameExtension(){return"create-point"}}class yC extends vC{_enableCreate(){this._container.mouseService.deferPixels(this._name,4);const e=this._navigator.stateService.currentTransform$.pipe(We(()=>{}),Pi(1),gi());this._deleteSubscription=e.pipe(Ys(1)).subscribe(this._tagCreator.delete$);const t=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(dn());this._createSubscription=e.pipe(ei(()=>t.pipe(oi(this._validateBasic),zl(1)))).subscribe(this._create$),this._setVertexSubscription=this._tagCreator.tag$.pipe(ei(i=>i?Si(Ai(i),fn(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$),this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$):zi())).subscribe(([i,r,o,c])=>{const s=this._mouseEventToBasic(r,this._container.container,o,c);this._setVertex2d(i,s,c)}),this._addPointSubscription=this._tagCreator.tag$.pipe(ei(i=>i?Si(Ai(i),t):zi())).subscribe(([i,r])=>{this._addPoint(i,r)}),this._geometryCreateSubscription=this._tagCreator.tag$.pipe(ei(i=>i?i.created$.pipe(We(r=>r.geometry)):zi())).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.undeferPixels(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreateSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}}class oie extends yC{get _create$(){return this._tagCreator.createPoints$}_addPoint(e,t){e.geometry.addPoint2d(t)}_getNameExtension(){return"create-points"}_setVertex2d(e,t,i){e.geometry.setPoint2d(e.geometry.points.length-1,t,i)}}class aie extends yC{get _create$(){return this._tagCreator.createPolygon$}_addPoint(e,t){e.addPoint(t)}_getNameExtension(){return"create-polygon"}_setVertex2d(e,t,i){e.geometry.setVertex2d(e.geometry.polygon.length-2,t,i)}}class lie extends yC{get _create$(){return this._tagCreator.createRect$}_addPoint(e,t){const i=e.geometry;i.validate(t)||(t=i.getNonAdjustedVertex2d(3)),e.addPoint(t)}_enable(){super._enable(),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(oi(e=>!!e)).subscribe(e=>{e.geometry.initializeAnchorIndexing()})}_disable(){super._disable(),this._initializeAnchorIndexingSubscription.unsubscribe()}_getNameExtension(){return"create-rect"}_setVertex2d(e,t,i){e.geometry.setOppositeVertex2d(t,i)}}class cie extends vC{_enableCreate(){this._container.mouseService.claimMouse(this._name,2),this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(We(i=>null),Ys(1)).subscribe(this._tagCreator.delete$),this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(oi(this._validateBasic)).subscribe(this._tagCreator.createRect$),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(oi(i=>!!i)).subscribe(i=>{i.geometry.initializeAnchorIndexing()});const e=Si(fn(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(Ui(this._navigator.stateService.currentTransform$),We(([[i,r],o])=>this._mouseEventToBasic(i,this._container.container,r,o)));this._setVertexSubscription=this._tagCreator.tag$.pipe(ei(i=>i?Si(Ai(i),e,this._navigator.stateService.currentTransform$):zi())).subscribe(([i,r,o])=>{i.geometry.setOppositeVertex2d(r,o)});const t=this._container.mouseService.mouseDragEnd$.pipe(Ui(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(oi(this._validateBasic)),(i,r)=>r),dn());this._addPointSubscription=this._tagCreator.tag$.pipe(ei(i=>i?Si(Ai(i),t):zi())).subscribe(([i,r])=>{const o=i.geometry;o.validate(r)||(r=o.getNonAdjustedVertex2d(3)),i.addPoint(r)}),this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(ei(i=>i?i.created$.pipe(We(r=>r.geometry)):zi())).subscribe(this._geometryCreated$)}_disableCreate(){this._container.mouseService.unclaimMouse(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreatedSubscription.unsubscribe(),this._initializeAnchorIndexingSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()}_getNameExtension(){return"create-rect-drag"}}class uie extends bz{constructor(e,t,i,r,o){super(e,t,i,r),this._tagSet=o}_enable(){const e=this._tagSet.changed$.pipe(We(t=>t.getAll()),ei(t=>Fr(t).pipe(Wi(i=>i.interact$))),ei(t=>Nl(Ai(t),this._container.mouseService.documentMouseUp$.pipe(We(()=>({offsetX:0,offsetY:0,operation:il.None,tag:null})),wi()))),dn());fn(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(dn()),this._claimMouseSubscription=e.pipe(ei(t=>t.tag?this._container.mouseService.domMouseDragStart$:zi())).subscribe(()=>{this._container.mouseService.claimMouse(this._name,3)}),this._cursorSubscription=e.pipe(We(t=>t.cursor),yi()).subscribe(t=>{const i=["crosshair","move","nesw-resize","nwse-resize"];for(const r of i)this._container.container.classList.remove(`component-tag-edit-${r}`);t&&this._container.container.classList.add(`component-tag-edit-${t}`)}),this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe(t=>{this._container.mouseService.unclaimMouse(this._name)}),this._preventDefaultSubscription=e.pipe(ei(t=>t.tag?this._container.mouseService.documentMouseMove$:zi())).subscribe(t=>{t.preventDefault()}),this._updateGeometrySubscription=e.pipe(ei(t=>{if(t.operation===il.None||!t.tag)return zi();const i=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDrag$).pipe(oi(r=>this._viewportCoords.insideElement(r,this._container.container)));return Si(i,this._container.renderService.renderCamera$).pipe(Ui(Ai(t),this._navigator.stateService.currentTransform$,([r,o],c,s)=>[r,o,c,s]))})).subscribe(([t,i,r,o])=>{const c=this._mouseEventToBasic(t,this._container.container,i,o,r.offsetX,r.offsetY),s=r.tag.geometry;r.operation===il.Centroid?s.setCentroid2d(c,o):r.operation===il.Vertex&&s.setVertex2d(r.vertexIndex,c,o)})}_disable(){this._claimMouseSubscription.unsubscribe(),this._cursorSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._unclaimMouseSubscription.unsubscribe(),this._updateGeometrySubscription.unsubscribe()}_getNameExtension(){return"edit-vertex"}}class xz extends bo{constructor(e,t,i){super(e,t,i),this._tagDomRenderer=new Jte,this._tagScene=new Qte,this._tagSet=new nie,this._tagCreator=new Kte(this,i),this._viewportCoords=new zo,this._createHandlers={CreatePoint:new sie(this,t,i,this._viewportCoords,this._tagCreator),CreatePoints:new oie(this,t,i,this._viewportCoords,this._tagCreator),CreatePolygon:new aie(this,t,i,this._viewportCoords,this._tagCreator),CreateRect:new lie(this,t,i,this._viewportCoords,this._tagCreator),CreateRectDrag:new cie(this,t,i,this._viewportCoords,this._tagCreator),Default:void 0},this._editVertexHandler=new uie(this,t,i,this._viewportCoords,this._tagSet),this._renderTags$=this._tagSet.changed$.pipe(We(r=>{const o=r.getAll();return o.sort((c,s)=>{const f=c.tag.id,p=s.tag.id;return f<p?-1:f>p?1:0}),o}),dn()),this._tagChanged$=this._renderTags$.pipe(ei(r=>Fr(r).pipe(Wi(o=>fn(o.tag.changed$,o.tag.geometryChanged$)))),dn()),this._renderTagGLChanged$=this._renderTags$.pipe(ei(r=>Fr(r).pipe(Wi(o=>o.glObjectsChanged$))),dn()),this._createGeometryChanged$=this._tagCreator.tag$.pipe(ei(r=>r!=null?r.geometryChanged$:zi()),dn()),this._createGLObjectsChanged$=this._tagCreator.tag$.pipe(ei(r=>r!=null?r.glObjectsChanged$:zi()),dn()),this._creatingConfiguration$=this._configuration$.pipe(yi((r,o)=>r.mode===o.mode,r=>({createColor:r.createColor,mode:r.mode})),Pi(1),gi()),this._creatingConfiguration$.subscribe(r=>{const o="tagmode",c={mode:r.mode,target:this,type:o};this.fire(o,c)})}add(e){this._activated?this._navigator.stateService.currentTransform$.pipe(wi()).subscribe(t=>{this._tagSet.add(e,t);const i=e.map(r=>this._tagSet.get(r.id));this._tagScene.add(i)}):this._tagSet.addDeactivated(e)}calculateRect(e){return new Promise((t,i)=>{this._navigator.stateService.currentTransform$.pipe(wi(),We(r=>e.getRect2d(r))).subscribe(r=>{t(r)},r=>{i(r)})})}create(){this._tagCreator.replayedTag$.pipe(wi(),oi(e=>!!e)).subscribe(e=>{e.create()})}changeMode(e){this.configure({mode:e})}fire(e,t){super.fire(e,t)}get(e){if(this._activated){const t=this._tagSet.get(e);return t!==void 0?t.tag:void 0}else return this._tagSet.getDeactivated(e)}getAll(){return this.activated?this._tagSet.getAll().map(e=>e.tag):this._tagSet.getAllDeactivated()}getTagIdsAt(e){return new Promise((t,i)=>{this._container.renderService.renderCamera$.pipe(wi(),We(r=>{const o=this._viewportCoords.canvasToViewport(e[0],e[1],this._container.container);return this._tagScene.intersectObjects(o,r.perspective)})).subscribe(r=>{t(r)},r=>{i(r)})})}has(e){return this._activated?this._tagSet.has(e):this._tagSet.hasDeactivated(e)}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}remove(e){this._activated?(this._tagSet.remove(e),this._tagScene.remove(e)):this._tagSet.removeDeactivated(e)}removeAll(){this._activated?(this._tagSet.removeAll(),this._tagScene.removeAll()):this._tagSet.removeAllDeactivated()}_activate(){this._editVertexHandler.enable();const e=Fr(Object.keys(this._createHandlers)).pipe(We(i=>this._createHandlers[i]),oi(i=>!!i),Wi(i=>i.geometryCreated$),dn()),t=this._subscriptions;t.push(e.subscribe(i=>{const r="geometrycreate",o={geometry:i,target:this,type:r};this.fire(r,o)})),t.push(this._tagCreator.tag$.pipe(uM(i=>i==null),yi()).subscribe(i=>{const r=i!=null?"tagcreatestart":"tagcreateend",o={target:this,type:r};this.fire(r,o)})),t.push(e.subscribe(()=>{this.changeMode(gg.Default)})),t.push(this._creatingConfiguration$.subscribe(i=>{this._disableCreateHandlers();const r=gg[i.mode],o=this._createHandlers[r];o&&o.enable()})),t.push(this._renderTags$.subscribe(()=>{const i="tags",r={target:this,type:i};this.fire(i,r)})),t.push(this._tagCreator.tag$.pipe(ei(i=>i!=null?i.aborted$.pipe(We(()=>null)):zi())).subscribe(()=>{this.changeMode(gg.Default)})),t.push(this._tagCreator.tag$.subscribe(i=>{this._tagScene.hasCreateTag()&&this._tagScene.removeCreateTag(),i!=null&&this._tagScene.addCreateTag(i)})),t.push(this._createGLObjectsChanged$.subscribe(i=>{this._tagScene.updateCreateTagObjects(i)})),t.push(this._renderTagGLChanged$.subscribe(i=>{this._tagScene.updateObjects(i)})),t.push(this._tagChanged$.subscribe(()=>{this._tagScene.update()})),t.push(Si(this._renderTags$.pipe(An([]),Dr(()=>{this._container.domRenderer.render$.next({name:this._name,vNode:this._tagDomRenderer.clear()})})),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(An(null)),fn(this._tagCreator.tag$,this._createGeometryChanged$).pipe(An(null))).pipe(We(([i,r,o,c,,s])=>({name:this._name,vNode:this._tagDomRenderer.render(i,s,o,r.perspective,c)}))).subscribe(this._container.domRenderer.render$)),t.push(this._navigator.stateService.currentState$.pipe(We(i=>{const r=this._tagScene;return{name:this._name,renderer:{frameId:i.id,needsRender:r.needsRender,render:r.render.bind(r),pass:Ph.Opaque}}})).subscribe(this._container.glRenderer.render$)),this._navigator.stateService.currentTransform$.pipe(wi()).subscribe(i=>{this._tagSet.activate(i),this._tagScene.add(this._tagSet.getAll())})}_deactivate(){this._editVertexHandler.disable(),this._disableCreateHandlers(),this._tagScene.clear(),this._tagSet.deactivate(),this._tagCreator.delete$.next(null),this._subscriptions.unsubscribe(),this._container.container.classList.remove("component-tag-create")}_getDefaultConfiguration(){return{createColor:16777215,indicatePointsCompleter:!0,mode:gg.Default}}_disableCreateHandlers(){const e=this._createHandlers;for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];i&&i.disable()}}}xz.componentName="tag";class wz extends bo{constructor(e,t,i){super(e,t,i),this._viewportCoords=new zo,this._zoomDelta$=new ri}_activate(){const e=this._subscriptions;e.push(Si(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(We(([t,i,r,o])=>{const c=t.state.zoom,s=jt.h("div.mapillary-zoom-in-icon",[]),f=c>=3||i===Oi.Waiting?jt.h("div.mapillary-zoom-in-button-inactive",[s]):jt.h("div.mapillary-zoom-in-button",{onclick:()=>{this._zoomDelta$.next(1)}},[s]),p=jt.h("div.mapillary-zoom-out-icon",[]),g=c<=0||i===Oi.Waiting?jt.h("div.mapillary-zoom-out-button-inactive",[p]):jt.h("div.mapillary-zoom-out-button",{onclick:()=>{this._zoomDelta$.next(-1)}},[p]),_=r.size===Ld.Small||r.size===Ld.Automatic&&o.width<640?".mapillary-zoom-compact":"";return{name:this._name,vNode:jt.h("div.mapillary-zoom-container"+_,{oncontextmenu:x=>{x.preventDefault()}},[f,g])}})).subscribe(this._container.domRenderer.render$)),e.push(this._zoomDelta$.pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(([t,i,r])=>{const o=this._viewportCoords.unprojectFromViewport(0,0,i.perspective),c=r.projectBasic(o.toArray());this._navigator.stateService.zoomIn(t,c)}))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{size:Ld.Automatic}}}wz.componentName="zoom";class Sz extends bo{constructor(e,t,i,r){super(e,t,i),this._canvasId=`${t.id}-${this._name}`,this._dom=r||new uC}_activate(){const e=this._container.domRenderer.element$.pipe(We(()=>this._dom.document.getElementById(this._canvasId)),oi(t=>!!t),We(t=>{const i=t.parentElement,r=i.offsetWidth,o=i.offsetHeight;return[t,{height:o,width:r}]}),yi((t,i)=>t.height===i.height&&t.width===i.width,([,t])=>t));this._subscriptions.push(Si(e,this._navigator.stateService.currentImage$).subscribe(([[t,i],r])=>{t.width=i.width,t.height=i.height,t.getContext("2d").drawImage(r.image,0,0,i.width,i.height)})),this._container.domRenderer.renderAdaptive$.next({name:this._name,vNode:jt.h(`canvas#${this._canvasId}`,[])})}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{}}}Sz.componentName="imagefallback";class Tz extends bo{constructor(e,t,i){super(e,t,i),this._seqNames={},this._seqNames[Ot[Ot.Prev]]="-prev",this._seqNames[Ot[Ot.Next]]="-next",this._spaTopNames={},this._spaTopNames[Ot[Ot.TurnLeft]]="-turn-left",this._spaTopNames[Ot[Ot.StepLeft]]="-left",this._spaTopNames[Ot[Ot.StepForward]]="-forward",this._spaTopNames[Ot[Ot.StepRight]]="-right",this._spaTopNames[Ot[Ot.TurnRight]]="-turn-right",this._spaBottomNames={},this._spaBottomNames[Ot[Ot.TurnU]]="-turn-around",this._spaBottomNames[Ot[Ot.StepBackward]]="-backward"}_activate(){this._subscriptions.push(Si(this._navigator.stateService.currentImage$,this._configuration$).pipe(ei(([e,t])=>{const i=t.sequence?e.sequenceEdges$.pipe(We(o=>o.edges.map(c=>c.data.direction))):Ai([]),r=!ki(e.cameraType)&&t.spatial?e.spatialEdges$.pipe(We(o=>o.edges.map(c=>c.data.direction))):Ai([]);return Si(i,r).pipe(We(([o,c])=>o.concat(c)))}),We(e=>{const t=this._createArrowRow(this._seqNames,e),i=this._createArrowRow(this._spaTopNames,e),r=this._createArrowRow(this._spaBottomNames,e),o=jt.h("div.mapillary-navigation-sequence",t),c=jt.h("div.NavigationSpatialTop",i),s=jt.h("div.mapillary-navigation-spatial-bottom",r),f=jt.h("div.mapillary-navigation-spatial",[c,s]);return{name:this._name,vNode:jt.h("div.NavigationContainer",[o,f])}})).subscribe(this._container.domRenderer.render$))}_deactivate(){this._subscriptions.unsubscribe()}_getDefaultConfiguration(){return{sequence:!0,spatial:!0}}_createArrowRow(e,t){const i=[];for(const r in e){if(!e.hasOwnProperty(r))continue;const o=Ot[r];t.indexOf(o)!==-1?i.push(this._createVNode(o,e[r],"visible")):i.push(this._createVNode(o,e[r],"hidden"))}return i}_createVNode(e,t,i){return jt.h(`span.mapillary-navigation-button.mapillary-navigation${t}`,{onclick:()=>{this._navigator.moveDir$(e).subscribe(void 0,r=>{r instanceof Bl||console.error(r)})},style:{visibility:i}},[])}}Tz.componentName="navigationfallback";function o_(n){let e=n.length;for(;--e>=0;)n[e]=0}const hie=3,die=258,Mz=29,fie=256,pie=fie+1+Mz,Cz=30,mie=512,gie=new Array((pie+2)*2);o_(gie);const _ie=new Array(Cz*2);o_(_ie);const vie=new Array(mie);o_(vie);const yie=new Array(die-hie+1);o_(yie);const bie=new Array(Mz);o_(bie);const xie=new Array(Cz);o_(xie);const wie=(n,e,t,i)=>{let r=n&65535|0,o=n>>>16&65535|0,c=0;for(;t!==0;){c=t>2e3?2e3:t,t-=c;do r=r+e[i++]|0,o=o+r|0;while(--c);r%=65521,o%=65521}return r|o<<16|0};var OM=wie;const Sie=()=>{let n,e=[];for(var t=0;t<256;t++){n=t;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e},Tie=new Uint32Array(Sie()),Mie=(n,e,t,i)=>{const r=Tie,o=i+t;n^=-1;for(let c=i;c<o;c++)n=n>>>8^r[(n^e[c])&255];return n^-1};var Xc=Mie,zM={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ez={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Cie=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var Eie=function(n){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const i in t)Cie(t,i)&&(n[i]=t[i])}}return n},Aie=n=>{let e=0;for(let i=0,r=n.length;i<r;i++)e+=n[i].length;const t=new Uint8Array(e);for(let i=0,r=0,o=n.length;i<o;i++){let c=n[i];t.set(c,r),r+=c.length}return t},Az={assign:Eie,flattenChunks:Aie};let Pz=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Pz=!1}const Ny=new Uint8Array(256);for(let n=0;n<256;n++)Ny[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Ny[254]=Ny[254]=1;var Pie=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let e,t,i,r,o,c=n.length,s=0;for(r=0;r<c;r++)t=n.charCodeAt(r),(t&64512)===55296&&r+1<c&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(s),o=0,r=0;o<s;r++)t=n.charCodeAt(r),(t&64512)===55296&&r+1<c&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),t<128?e[o++]=t:t<2048?(e[o++]=192|t>>>6,e[o++]=128|t&63):t<65536?(e[o++]=224|t>>>12,e[o++]=128|t>>>6&63,e[o++]=128|t&63):(e[o++]=240|t>>>18,e[o++]=128|t>>>12&63,e[o++]=128|t>>>6&63,e[o++]=128|t&63);return e};const Iie=(n,e)=>{if(e<65534&&n.subarray&&Pz)return String.fromCharCode.apply(null,n.length===e?n:n.subarray(0,e));let t="";for(let i=0;i<e;i++)t+=String.fromCharCode(n[i]);return t};var Lie=(n,e)=>{const t=e||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,e));let i,r;const o=new Array(t*2);for(r=0,i=0;i<t;){let c=n[i++];if(c<128){o[r++]=c;continue}let s=Ny[c];if(s>4){o[r++]=65533,i+=s-1;continue}for(c&=s===2?31:s===3?15:7;s>1&&i<t;)c=c<<6|n[i++]&63,s--;if(s>1){o[r++]=65533;continue}c<65536?o[r++]=c:(c-=65536,o[r++]=55296|c>>10&1023,o[r++]=56320|c&1023)}return Iie(o,r)},Rie=(n,e)=>{e=e||n.length,e>n.length&&(e=n.length);let t=e-1;for(;t>=0&&(n[t]&192)===128;)t--;return t<0||t===0?e:t+Ny[n[t]]>e?t:e},BM={string2buf:Pie,buf2string:Lie,utf8border:Rie};function kie(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Die=kie;const lx=30,Fie=12;var Oie=function(e,t){let i,r,o,c,s,f,p,g,_,x,b,M,P,k,L,I,F,N,H,Y,q,U,G,j;const B=e.state;i=e.next_in,G=e.input,r=i+(e.avail_in-5),o=e.next_out,j=e.output,c=o-(t-e.avail_out),s=o+(e.avail_out-257),f=B.dmax,p=B.wsize,g=B.whave,_=B.wnext,x=B.window,b=B.hold,M=B.bits,P=B.lencode,k=B.distcode,L=(1<<B.lenbits)-1,I=(1<<B.distbits)-1;e:do{M<15&&(b+=G[i++]<<M,M+=8,b+=G[i++]<<M,M+=8),F=P[b&L];t:for(;;){if(N=F>>>24,b>>>=N,M-=N,N=F>>>16&255,N===0)j[o++]=F&65535;else if(N&16){H=F&65535,N&=15,N&&(M<N&&(b+=G[i++]<<M,M+=8),H+=b&(1<<N)-1,b>>>=N,M-=N),M<15&&(b+=G[i++]<<M,M+=8,b+=G[i++]<<M,M+=8),F=k[b&I];i:for(;;){if(N=F>>>24,b>>>=N,M-=N,N=F>>>16&255,N&16){if(Y=F&65535,N&=15,M<N&&(b+=G[i++]<<M,M+=8,M<N&&(b+=G[i++]<<M,M+=8)),Y+=b&(1<<N)-1,Y>f){e.msg="invalid distance too far back",B.mode=lx;break e}if(b>>>=N,M-=N,N=o-c,Y>N){if(N=Y-N,N>g&&B.sane){e.msg="invalid distance too far back",B.mode=lx;break e}if(q=0,U=x,_===0){if(q+=p-N,N<H){H-=N;do j[o++]=x[q++];while(--N);q=o-Y,U=j}}else if(_<N){if(q+=p+_-N,N-=_,N<H){H-=N;do j[o++]=x[q++];while(--N);if(q=0,_<H){N=_,H-=N;do j[o++]=x[q++];while(--N);q=o-Y,U=j}}}else if(q+=_-N,N<H){H-=N;do j[o++]=x[q++];while(--N);q=o-Y,U=j}for(;H>2;)j[o++]=U[q++],j[o++]=U[q++],j[o++]=U[q++],H-=3;H&&(j[o++]=U[q++],H>1&&(j[o++]=U[q++]))}else{q=o-Y;do j[o++]=j[q++],j[o++]=j[q++],j[o++]=j[q++],H-=3;while(H>2);H&&(j[o++]=j[q++],H>1&&(j[o++]=j[q++]))}}else if((N&64)===0){F=k[(F&65535)+(b&(1<<N)-1)];continue i}else{e.msg="invalid distance code",B.mode=lx;break e}break}}else if((N&64)===0){F=P[(F&65535)+(b&(1<<N)-1)];continue t}else if(N&32){B.mode=Fie;break e}else{e.msg="invalid literal/length code",B.mode=lx;break e}break}}while(i<r&&o<s);H=M>>3,i-=H,M-=H<<3,b&=(1<<M)-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?5+(r-i):5-(i-r),e.avail_out=o<s?257+(s-o):257-(o-s),B.hold=b,B.bits=M};const ng=15,pL=852,mL=592,gL=0,wT=1,_L=2,zie=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Bie=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Nie=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$ie=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Vie=(n,e,t,i,r,o,c,s)=>{const f=s.bits;let p=0,g=0,_=0,x=0,b=0,M=0,P=0,k=0,L=0,I=0,F,N,H,Y,q,U=null,G=0,j;const B=new Uint16Array(ng+1),ne=new Uint16Array(ng+1);let J=null,le=0,ae,pe,fe;for(p=0;p<=ng;p++)B[p]=0;for(g=0;g<i;g++)B[e[t+g]]++;for(b=f,x=ng;x>=1&&B[x]===0;x--);if(b>x&&(b=x),x===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,s.bits=1,0;for(_=1;_<x&&B[_]===0;_++);for(b<_&&(b=_),k=1,p=1;p<=ng;p++)if(k<<=1,k-=B[p],k<0)return-1;if(k>0&&(n===gL||x!==1))return-1;for(ne[1]=0,p=1;p<ng;p++)ne[p+1]=ne[p]+B[p];for(g=0;g<i;g++)e[t+g]!==0&&(c[ne[e[t+g]]++]=g);if(n===gL?(U=J=c,j=19):n===wT?(U=zie,G-=257,J=Bie,le-=257,j=256):(U=Nie,J=$ie,j=-1),I=0,g=0,p=_,q=o,M=b,P=0,H=-1,L=1<<b,Y=L-1,n===wT&&L>pL||n===_L&&L>mL)return 1;for(;;){ae=p-P,c[g]<j?(pe=0,fe=c[g]):c[g]>j?(pe=J[le+c[g]],fe=U[G+c[g]]):(pe=96,fe=0),F=1<<p-P,N=1<<M,_=N;do N-=F,r[q+(I>>P)+N]=ae<<24|pe<<16|fe|0;while(N!==0);for(F=1<<p-1;I&F;)F>>=1;if(F!==0?(I&=F-1,I+=F):I=0,g++,--B[p]===0){if(p===x)break;p=e[t+c[g]]}if(p>b&&(I&Y)!==H){for(P===0&&(P=b),q+=_,M=p-P,k=1<<M;M+P<x&&(k-=B[M+P],!(k<=0));)M++,k<<=1;if(L+=1<<M,n===wT&&L>pL||n===_L&&L>mL)return 1;H=I&Y,r[H]=b<<24|M<<16|q-o|0}}return I!==0&&(r[q+I]=p-P<<24|64<<16|0),s.bits=b,0};var ay=Vie;const Uie=0,Iz=1,Lz=2,{Z_FINISH:vL,Z_BLOCK:jie,Z_TREES:cx,Z_OK:pp,Z_STREAM_END:Gie,Z_NEED_DICT:qie,Z_STREAM_ERROR:Vl,Z_DATA_ERROR:Rz,Z_MEM_ERROR:kz,Z_BUF_ERROR:Hie,Z_DEFLATED:yL}=Ez,Dz=1,bL=2,xL=3,wL=4,SL=5,TL=6,ML=7,CL=8,EL=9,AL=10,gw=11,sh=12,ST=13,PL=14,TT=15,IL=16,LL=17,RL=18,kL=19,ux=20,hx=21,DL=22,FL=23,OL=24,zL=25,BL=26,MT=27,NL=28,$L=29,Yr=30,Fz=31,Wie=32,Zie=852,Xie=592,Yie=15,Kie=Yie,VL=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function Jie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Oz=n=>{if(!n||!n.state)return Vl;const e=n.state;return n.total_in=n.total_out=e.total=0,n.msg="",e.wrap&&(n.adler=e.wrap&1),e.mode=Dz,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Zie),e.distcode=e.distdyn=new Int32Array(Xie),e.sane=1,e.back=-1,pp},zz=n=>{if(!n||!n.state)return Vl;const e=n.state;return e.wsize=0,e.whave=0,e.wnext=0,Oz(n)},Bz=(n,e)=>{let t;if(!n||!n.state)return Vl;const i=n.state;return e<0?(t=0,e=-e):(t=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?Vl:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,zz(n))},Nz=(n,e)=>{if(!n)return Vl;const t=new Jie;n.state=t,t.window=null;const i=Bz(n,e);return i!==pp&&(n.state=null),i},Qie=n=>Nz(n,Kie);let UL=!0,CT,ET;const ene=n=>{if(UL){CT=new Int32Array(512),ET=new Int32Array(32);let e=0;for(;e<144;)n.lens[e++]=8;for(;e<256;)n.lens[e++]=9;for(;e<280;)n.lens[e++]=7;for(;e<288;)n.lens[e++]=8;for(ay(Iz,n.lens,0,288,CT,0,n.work,{bits:9}),e=0;e<32;)n.lens[e++]=5;ay(Lz,n.lens,0,32,ET,0,n.work,{bits:5}),UL=!1}n.lencode=CT,n.lenbits=9,n.distcode=ET,n.distbits=5},$z=(n,e,t,i)=>{let r;const o=n.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(e.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(e.subarray(t-i,t-i+r),o.wnext),i-=r,i?(o.window.set(e.subarray(t-i,t),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},tne=(n,e)=>{let t,i,r,o,c,s,f,p,g,_,x,b,M,P,k=0,L,I,F,N,H,Y,q,U;const G=new Uint8Array(4);let j,B;const ne=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!n||!n.state||!n.output||!n.input&&n.avail_in!==0)return Vl;t=n.state,t.mode===sh&&(t.mode=ST),c=n.next_out,r=n.output,f=n.avail_out,o=n.next_in,i=n.input,s=n.avail_in,p=t.hold,g=t.bits,_=s,x=f,U=pp;e:for(;;)switch(t.mode){case Dz:if(t.wrap===0){t.mode=ST;break}for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(t.wrap&2&&p===35615){t.check=0,G[0]=p&255,G[1]=p>>>8&255,t.check=Xc(t.check,G,2,0),p=0,g=0,t.mode=bL;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((p&255)<<8)+(p>>8))%31){n.msg="incorrect header check",t.mode=Yr;break}if((p&15)!==yL){n.msg="unknown compression method",t.mode=Yr;break}if(p>>>=4,g-=4,q=(p&15)+8,t.wbits===0)t.wbits=q;else if(q>t.wbits){n.msg="invalid window size",t.mode=Yr;break}t.dmax=1<<t.wbits,n.adler=t.check=1,t.mode=p&512?AL:sh,p=0,g=0;break;case bL:for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(t.flags=p,(t.flags&255)!==yL){n.msg="unknown compression method",t.mode=Yr;break}if(t.flags&57344){n.msg="unknown header flags set",t.mode=Yr;break}t.head&&(t.head.text=p>>8&1),t.flags&512&&(G[0]=p&255,G[1]=p>>>8&255,t.check=Xc(t.check,G,2,0)),p=0,g=0,t.mode=xL;case xL:for(;g<32;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.head&&(t.head.time=p),t.flags&512&&(G[0]=p&255,G[1]=p>>>8&255,G[2]=p>>>16&255,G[3]=p>>>24&255,t.check=Xc(t.check,G,4,0)),p=0,g=0,t.mode=wL;case wL:for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.head&&(t.head.xflags=p&255,t.head.os=p>>8),t.flags&512&&(G[0]=p&255,G[1]=p>>>8&255,t.check=Xc(t.check,G,2,0)),p=0,g=0,t.mode=SL;case SL:if(t.flags&1024){for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.length=p,t.head&&(t.head.extra_len=p),t.flags&512&&(G[0]=p&255,G[1]=p>>>8&255,t.check=Xc(t.check,G,2,0)),p=0,g=0}else t.head&&(t.head.extra=null);t.mode=TL;case TL:if(t.flags&1024&&(b=t.length,b>s&&(b=s),b&&(t.head&&(q=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(o,o+b),q)),t.flags&512&&(t.check=Xc(t.check,i,b,o)),s-=b,o+=b,t.length-=b),t.length))break e;t.length=0,t.mode=ML;case ML:if(t.flags&2048){if(s===0)break e;b=0;do q=i[o+b++],t.head&&q&&t.length<65536&&(t.head.name+=String.fromCharCode(q));while(q&&b<s);if(t.flags&512&&(t.check=Xc(t.check,i,b,o)),s-=b,o+=b,q)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=CL;case CL:if(t.flags&4096){if(s===0)break e;b=0;do q=i[o+b++],t.head&&q&&t.length<65536&&(t.head.comment+=String.fromCharCode(q));while(q&&b<s);if(t.flags&512&&(t.check=Xc(t.check,i,b,o)),s-=b,o+=b,q)break e}else t.head&&(t.head.comment=null);t.mode=EL;case EL:if(t.flags&512){for(;g<16;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(p!==(t.check&65535)){n.msg="header crc mismatch",t.mode=Yr;break}p=0,g=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),n.adler=t.check=0,t.mode=sh;break;case AL:for(;g<32;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}n.adler=t.check=VL(p),p=0,g=0,t.mode=gw;case gw:if(t.havedict===0)return n.next_out=c,n.avail_out=f,n.next_in=o,n.avail_in=s,t.hold=p,t.bits=g,qie;n.adler=t.check=1,t.mode=sh;case sh:if(e===jie||e===cx)break e;case ST:if(t.last){p>>>=g&7,g-=g&7,t.mode=MT;break}for(;g<3;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}switch(t.last=p&1,p>>>=1,g-=1,p&3){case 0:t.mode=PL;break;case 1:if(ene(t),t.mode=ux,e===cx){p>>>=2,g-=2;break e}break;case 2:t.mode=LL;break;case 3:n.msg="invalid block type",t.mode=Yr}p>>>=2,g-=2;break;case PL:for(p>>>=g&7,g-=g&7;g<32;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if((p&65535)!==(p>>>16^65535)){n.msg="invalid stored block lengths",t.mode=Yr;break}if(t.length=p&65535,p=0,g=0,t.mode=TT,e===cx)break e;case TT:t.mode=IL;case IL:if(b=t.length,b){if(b>s&&(b=s),b>f&&(b=f),b===0)break e;r.set(i.subarray(o,o+b),c),s-=b,o+=b,f-=b,c+=b,t.length-=b;break}t.mode=sh;break;case LL:for(;g<14;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(t.nlen=(p&31)+257,p>>>=5,g-=5,t.ndist=(p&31)+1,p>>>=5,g-=5,t.ncode=(p&15)+4,p>>>=4,g-=4,t.nlen>286||t.ndist>30){n.msg="too many length or distance symbols",t.mode=Yr;break}t.have=0,t.mode=RL;case RL:for(;t.have<t.ncode;){for(;g<3;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.lens[ne[t.have++]]=p&7,p>>>=3,g-=3}for(;t.have<19;)t.lens[ne[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,j={bits:t.lenbits},U=ay(Uie,t.lens,0,19,t.lencode,0,t.work,j),t.lenbits=j.bits,U){n.msg="invalid code lengths set",t.mode=Yr;break}t.have=0,t.mode=kL;case kL:for(;t.have<t.nlen+t.ndist;){for(;k=t.lencode[p&(1<<t.lenbits)-1],L=k>>>24,I=k>>>16&255,F=k&65535,!(L<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(F<16)p>>>=L,g-=L,t.lens[t.have++]=F;else{if(F===16){for(B=L+2;g<B;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(p>>>=L,g-=L,t.have===0){n.msg="invalid bit length repeat",t.mode=Yr;break}q=t.lens[t.have-1],b=3+(p&3),p>>>=2,g-=2}else if(F===17){for(B=L+3;g<B;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}p>>>=L,g-=L,q=0,b=3+(p&7),p>>>=3,g-=3}else{for(B=L+7;g<B;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}p>>>=L,g-=L,q=0,b=11+(p&127),p>>>=7,g-=7}if(t.have+b>t.nlen+t.ndist){n.msg="invalid bit length repeat",t.mode=Yr;break}for(;b--;)t.lens[t.have++]=q}}if(t.mode===Yr)break;if(t.lens[256]===0){n.msg="invalid code -- missing end-of-block",t.mode=Yr;break}if(t.lenbits=9,j={bits:t.lenbits},U=ay(Iz,t.lens,0,t.nlen,t.lencode,0,t.work,j),t.lenbits=j.bits,U){n.msg="invalid literal/lengths set",t.mode=Yr;break}if(t.distbits=6,t.distcode=t.distdyn,j={bits:t.distbits},U=ay(Lz,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,j),t.distbits=j.bits,U){n.msg="invalid distances set",t.mode=Yr;break}if(t.mode=ux,e===cx)break e;case ux:t.mode=hx;case hx:if(s>=6&&f>=258){n.next_out=c,n.avail_out=f,n.next_in=o,n.avail_in=s,t.hold=p,t.bits=g,Oie(n,x),c=n.next_out,r=n.output,f=n.avail_out,o=n.next_in,i=n.input,s=n.avail_in,p=t.hold,g=t.bits,t.mode===sh&&(t.back=-1);break}for(t.back=0;k=t.lencode[p&(1<<t.lenbits)-1],L=k>>>24,I=k>>>16&255,F=k&65535,!(L<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(I&&(I&240)===0){for(N=L,H=I,Y=F;k=t.lencode[Y+((p&(1<<N+H)-1)>>N)],L=k>>>24,I=k>>>16&255,F=k&65535,!(N+L<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}p>>>=N,g-=N,t.back+=N}if(p>>>=L,g-=L,t.back+=L,t.length=F,I===0){t.mode=BL;break}if(I&32){t.back=-1,t.mode=sh;break}if(I&64){n.msg="invalid literal/length code",t.mode=Yr;break}t.extra=I&15,t.mode=DL;case DL:if(t.extra){for(B=t.extra;g<B;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.length+=p&(1<<t.extra)-1,p>>>=t.extra,g-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=FL;case FL:for(;k=t.distcode[p&(1<<t.distbits)-1],L=k>>>24,I=k>>>16&255,F=k&65535,!(L<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if((I&240)===0){for(N=L,H=I,Y=F;k=t.distcode[Y+((p&(1<<N+H)-1)>>N)],L=k>>>24,I=k>>>16&255,F=k&65535,!(N+L<=g);){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}p>>>=N,g-=N,t.back+=N}if(p>>>=L,g-=L,t.back+=L,I&64){n.msg="invalid distance code",t.mode=Yr;break}t.offset=F,t.extra=I&15,t.mode=OL;case OL:if(t.extra){for(B=t.extra;g<B;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}t.offset+=p&(1<<t.extra)-1,p>>>=t.extra,g-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){n.msg="invalid distance too far back",t.mode=Yr;break}t.mode=zL;case zL:if(f===0)break e;if(b=x-f,t.offset>b){if(b=t.offset-b,b>t.whave&&t.sane){n.msg="invalid distance too far back",t.mode=Yr;break}b>t.wnext?(b-=t.wnext,M=t.wsize-b):M=t.wnext-b,b>t.length&&(b=t.length),P=t.window}else P=r,M=c-t.offset,b=t.length;b>f&&(b=f),f-=b,t.length-=b;do r[c++]=P[M++];while(--b);t.length===0&&(t.mode=hx);break;case BL:if(f===0)break e;r[c++]=t.length,f--,t.mode=hx;break;case MT:if(t.wrap){for(;g<32;){if(s===0)break e;s--,p|=i[o++]<<g,g+=8}if(x-=f,n.total_out+=x,t.total+=x,x&&(n.adler=t.check=t.flags?Xc(t.check,r,x,c-x):OM(t.check,r,x,c-x)),x=f,(t.flags?p:VL(p))!==t.check){n.msg="incorrect data check",t.mode=Yr;break}p=0,g=0}t.mode=NL;case NL:if(t.wrap&&t.flags){for(;g<32;){if(s===0)break e;s--,p+=i[o++]<<g,g+=8}if(p!==(t.total&4294967295)){n.msg="incorrect length check",t.mode=Yr;break}p=0,g=0}t.mode=$L;case $L:U=Gie;break e;case Yr:U=Rz;break e;case Fz:return kz;case Wie:default:return Vl}return n.next_out=c,n.avail_out=f,n.next_in=o,n.avail_in=s,t.hold=p,t.bits=g,(t.wsize||x!==n.avail_out&&t.mode<Yr&&(t.mode<MT||e!==vL))&&$z(n,n.output,n.next_out,x-n.avail_out),_-=n.avail_in,x-=n.avail_out,n.total_in+=_,n.total_out+=x,t.total+=x,t.wrap&&x&&(n.adler=t.check=t.flags?Xc(t.check,r,x,n.next_out-x):OM(t.check,r,x,n.next_out-x)),n.data_type=t.bits+(t.last?64:0)+(t.mode===sh?128:0)+(t.mode===ux||t.mode===TT?256:0),(_===0&&x===0||e===vL)&&U===pp&&(U=Hie),U},ine=n=>{if(!n||!n.state)return Vl;let e=n.state;return e.window&&(e.window=null),n.state=null,pp},nne=(n,e)=>{if(!n||!n.state)return Vl;const t=n.state;return(t.wrap&2)===0?Vl:(t.head=e,e.done=!1,pp)},rne=(n,e)=>{const t=e.length;let i,r,o;return!n||!n.state||(i=n.state,i.wrap!==0&&i.mode!==gw)?Vl:i.mode===gw&&(r=1,r=OM(r,e,t,0),r!==i.check)?Rz:(o=$z(n,e,t,t),o?(i.mode=Fz,kz):(i.havedict=1,pp))};var sne=zz,one=Bz,ane=Oz,lne=Qie,cne=Nz,une=tne,hne=ine,dne=nne,fne=rne,pne="pako inflate (from Nodeca project)",uh={inflateReset:sne,inflateReset2:one,inflateResetKeep:ane,inflateInit:lne,inflateInit2:cne,inflate:une,inflateEnd:hne,inflateGetHeader:dne,inflateSetDictionary:fne,inflateInfo:pne};function mne(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gne=mne;const Vz=Object.prototype.toString,{Z_NO_FLUSH:_ne,Z_FINISH:vne,Z_OK:$y,Z_STREAM_END:AT,Z_NEED_DICT:PT,Z_STREAM_ERROR:yne,Z_DATA_ERROR:jL,Z_MEM_ERROR:bne}=Ez;function Jw(n){this.options=Az.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(n&&n.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Die,this.strm.avail_out=0;let t=uh.inflateInit2(this.strm,e.windowBits);if(t!==$y)throw new Error(zM[t]);if(this.header=new gne,uh.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=BM.string2buf(e.dictionary):Vz.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=uh.inflateSetDictionary(this.strm,e.dictionary),t!==$y)))throw new Error(zM[t])}Jw.prototype.push=function(n,e){const t=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let o,c,s;if(this.ended)return!1;for(e===~~e?c=e:c=e===!0?vne:_ne,Vz.call(n)==="[object ArrayBuffer]"?t.input=new Uint8Array(n):t.input=n,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),o=uh.inflate(t,c),o===PT&&r&&(o=uh.inflateSetDictionary(t,r),o===$y?o=uh.inflate(t,c):o===jL&&(o=PT));t.avail_in>0&&o===AT&&t.state.wrap>0&&n[t.next_in]!==0;)uh.inflateReset(t),o=uh.inflate(t,c);switch(o){case yne:case jL:case PT:case bne:return this.onEnd(o),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||o===AT))if(this.options.to==="string"){let f=BM.utf8border(t.output,t.next_out),p=t.next_out-f,g=BM.buf2string(t.output,f);t.next_out=p,t.avail_out=i-p,p&&t.output.set(t.output.subarray(f,f+p),0),this.onData(g)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===$y&&s===0)){if(o===AT)return o=uh.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Jw.prototype.onData=function(n){this.chunks.push(n)};Jw.prototype.onEnd=function(n){n===$y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Az.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function xne(n,e){const t=new Jw(e);if(t.push(n),t.err)throw t.msg||zM[t.err];return t.result}var wne=xne,Sne={inflate:wne};const{inflate:Tne}=Sne;var Mne=Tne,bC={};bC.read=function(n,e,t,i,r){var o,c,s=r*8-i-1,f=(1<<s)-1,p=f>>1,g=-7,_=t?r-1:0,x=t?-1:1,b=n[e+_];for(_+=x,o=b&(1<<-g)-1,b>>=-g,g+=s;g>0;o=o*256+n[e+_],_+=x,g-=8);for(c=o&(1<<-g)-1,o>>=-g,g+=i;g>0;c=c*256+n[e+_],_+=x,g-=8);if(o===0)o=1-p;else{if(o===f)return c?NaN:(b?-1:1)*(1/0);c=c+Math.pow(2,i),o=o-p}return(b?-1:1)*c*Math.pow(2,o-i)};bC.write=function(n,e,t,i,r,o){var c,s,f,p=o*8-r-1,g=(1<<p)-1,_=g>>1,x=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=i?0:o-1,M=i?1:-1,P=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,c=g):(c=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-c))<1&&(c--,f*=2),c+_>=1?e+=x/f:e+=x*Math.pow(2,1-_),e*f>=2&&(c++,f/=2),c+_>=g?(s=0,c=g):c+_>=1?(s=(e*f-1)*Math.pow(2,r),c=c+_):(s=e*Math.pow(2,_-1)*Math.pow(2,r),c=0));r>=8;n[t+b]=s&255,b+=M,s/=256,r-=8);for(c=c<<r|s,p+=r;p>0;n[t+b]=c&255,b+=M,c/=256,p-=8);n[t+b-M]|=P*128};var Cne=qn,dx=bC;function qn(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}qn.Varint=0;qn.Fixed64=1;qn.Bytes=2;qn.Fixed32=5;var NM=65536*65536,GL=1/NM,Ene=12,Uz=typeof TextDecoder>"u"?null:new TextDecoder("utf8");qn.prototype={destroy:function(){this.buf=null},readFields:function(n,e,t){for(t=t||this.length;this.pos<t;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=i&7,n(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=fx(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=HL(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=fx(this.buf,this.pos)+fx(this.buf,this.pos+4)*NM;return this.pos+=8,n},readSFixed64:function(){var n=fx(this.buf,this.pos)+HL(this.buf,this.pos+4)*NM;return this.pos+=8,n},readFloat:function(){var n=dx.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=dx.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e=this.buf,t,i;return i=e[this.pos++],t=i&127,i<128||(i=e[this.pos++],t|=(i&127)<<7,i<128)||(i=e[this.pos++],t|=(i&127)<<14,i<128)||(i=e[this.pos++],t|=(i&127)<<21,i<128)?t:(i=e[this.pos],t|=(i&15)<<28,Ane(t,n,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2===1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=Ene&&Uz?Une(this.buf,e,n):Vne(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==qn.Bytes)return n.push(this.readVarint(e));var t=oh(this);for(n=n||[];this.pos<t;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==qn.Bytes)return n.push(this.readSVarint());var e=oh(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==qn.Bytes)return n.push(this.readBoolean());var e=oh(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==qn.Bytes)return n.push(this.readFloat());var e=oh(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==qn.Bytes)return n.push(this.readDouble());var e=oh(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==qn.Bytes)return n.push(this.readFixed32());var e=oh(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==qn.Bytes)return n.push(this.readSFixed32());var e=oh(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==qn.Bytes)return n.push(this.readFixed64());var e=oh(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==qn.Bytes)return n.push(this.readSFixed64());var e=oh(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=n&7;if(e===qn.Varint)for(;this.buf[this.pos++]>127;);else if(e===qn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===qn.Fixed32)this.pos+=4;else if(e===qn.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),sg(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),sg(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),sg(this.buf,n&-1,this.pos),sg(this.buf,Math.floor(n*GL),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),sg(this.buf,n&-1,this.pos),sg(this.buf,Math.floor(n*GL),this.pos+4),this.pos+=8},writeVarint:function(n){if(n=+n||0,n>268435455||n<0){Pne(n,this);return}this.realloc(4),this.buf[this.pos++]=n&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=n>>>7&127)))},writeSVarint:function(n){this.writeVarint(n<0?-n*2-1:n*2)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(n.length*4),this.pos++;var e=this.pos;this.pos=jne(this.buf,n,this.pos);var t=this.pos-e;t>=128&&qL(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(n){this.realloc(4),dx.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),dx.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,e){this.pos++;var t=this.pos;n(e,this);var i=this.pos-t;i>=128&&qL(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeMessage:function(n,e,t){this.writeTag(n,qn.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Rne,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,kne,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,One,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Dne,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Fne,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,zne,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,Bne,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Nne,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,$ne,e)},writeBytesField:function(n,e){this.writeTag(n,qn.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,qn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,qn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,qn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,qn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,qn.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,qn.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,qn.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,qn.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,qn.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};function Ane(n,e,t){var i=t.buf,r,o;if(o=i[t.pos++],r=(o&112)>>4,o<128||(o=i[t.pos++],r|=(o&127)<<3,o<128)||(o=i[t.pos++],r|=(o&127)<<10,o<128)||(o=i[t.pos++],r|=(o&127)<<17,o<128)||(o=i[t.pos++],r|=(o&127)<<24,o<128)||(o=i[t.pos++],r|=(o&1)<<31,o<128))return rg(n,r,e);throw new Error("Expected varint not more than 10 bytes")}function oh(n){return n.type===qn.Bytes?n.readVarint()+n.pos:n.pos+1}function rg(n,e,t){return t?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function Pne(n,e){var t,i;if(n>=0?(t=n%4294967296|0,i=n/4294967296|0):(t=~(-n%4294967296),i=~(-n/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Ine(t,i,e),Lne(i,e)}function Ine(n,e,t){t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos]=n&127}function Lne(n,e){var t=(n&7)<<4;e.buf[e.pos++]|=t|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function qL(n,e,t){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(var r=t.pos-1;r>=n;r--)t.buf[r+i]=t.buf[r]}function Rne(n,e){for(var t=0;t<n.length;t++)e.writeVarint(n[t])}function kne(n,e){for(var t=0;t<n.length;t++)e.writeSVarint(n[t])}function Dne(n,e){for(var t=0;t<n.length;t++)e.writeFloat(n[t])}function Fne(n,e){for(var t=0;t<n.length;t++)e.writeDouble(n[t])}function One(n,e){for(var t=0;t<n.length;t++)e.writeBoolean(n[t])}function zne(n,e){for(var t=0;t<n.length;t++)e.writeFixed32(n[t])}function Bne(n,e){for(var t=0;t<n.length;t++)e.writeSFixed32(n[t])}function Nne(n,e){for(var t=0;t<n.length;t++)e.writeFixed64(n[t])}function $ne(n,e){for(var t=0;t<n.length;t++)e.writeSFixed64(n[t])}function fx(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+n[e+3]*16777216}function sg(n,e,t){n[t]=e,n[t+1]=e>>>8,n[t+2]=e>>>16,n[t+3]=e>>>24}function HL(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function Vne(n,e,t){for(var i="",r=e;r<t;){var o=n[r],c=null,s=o>239?4:o>223?3:o>191?2:1;if(r+s>t)break;var f,p,g;s===1?o<128&&(c=o):s===2?(f=n[r+1],(f&192)===128&&(c=(o&31)<<6|f&63,c<=127&&(c=null))):s===3?(f=n[r+1],p=n[r+2],(f&192)===128&&(p&192)===128&&(c=(o&15)<<12|(f&63)<<6|p&63,(c<=2047||c>=55296&&c<=57343)&&(c=null))):s===4&&(f=n[r+1],p=n[r+2],g=n[r+3],(f&192)===128&&(p&192)===128&&(g&192)===128&&(c=(o&15)<<18|(f&63)<<12|(p&63)<<6|g&63,(c<=65535||c>=1114112)&&(c=null))),c===null?(c=65533,s=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|c&1023),i+=String.fromCharCode(c),r+=s}return i}function Une(n,e,t){return Uz.decode(n.subarray(e,t))}function jne(n,e,t){for(var i=0,r,o;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(o)if(r<56320){n[t++]=239,n[t++]=191,n[t++]=189,o=r;continue}else r=o-55296<<10|r-56320|65536,o=null;else{r>56319||i+1===e.length?(n[t++]=239,n[t++]=191,n[t++]=189):o=r;continue}else o&&(n[t++]=239,n[t++]=191,n[t++]=189,o=null);r<128?n[t++]=r:(r<2048?n[t++]=r>>6|192:(r<65536?n[t++]=r>>12|224:(n[t++]=r>>18|240,n[t++]=r>>12&63|128),n[t++]=r>>6&63|128),n[t++]=r&63|128)}return t}function Gne(n){const e=Mne(n,{to:"string"});return JSON.parse(e)}function IT(n,e){return jz(n,"GET","arraybuffer",[],null,e)}function jz(n,e,t,i,r,o){const c=new XMLHttpRequest,s=new Promise((f,p)=>{c.open(e,n,!0);for(const g of i)c.setRequestHeader(g.name,g.value);c.responseType=t,c.timeout=15e3,c.onload=()=>{var g;if(c.status!==200){const _=(g=c.response)!==null&&g!==void 0?g:new cr(`Response status error: ${n}`);p(_)}c.response||p(new cr(`Response empty: ${n}`)),f(c.response)},c.onerror=()=>{p(new cr(`Request error: ${n}`))},c.ontimeout=()=>{p(new cr(`Request timeout: ${n}`))},c.onabort=()=>{p(new cr(`Request aborted: ${n}`))},c.send(e==="POST"?r:null)});return o&&o.catch(()=>{c.abort()}),s}function qne(n){const e=new Cne(n),t={faces:[],vertices:[]};return e.readFields(Hne,t)}function Hne(n,e,t){n===1?e.vertices.push(t.readFloat()):n===2?e.faces.push(t.readVarint()):console.warn(`Unsupported pbf tag (${n})`)}class Wne extends Xw{constructor(e){super(),this._geometry=e}get geometry(){return this._geometry}fire(e,t){super.fire(e,t)}getCoreImages(e){return Promise.reject(new cr("Not implemented"))}getCluster(e,t){return Promise.reject(new cr("Not implemented"))}getSpatialImages(e){return Promise.reject(new cr("Not implemented"))}getImages(e){return Promise.reject(new cr("Not implemented"))}getImageBuffer(e,t){return Promise.reject(new cr("Not implemented"))}getImageTiles(e){return Promise.reject(new cr("Not implemented"))}getMesh(e,t){return Promise.reject(new cr("Not implemented"))}getSequence(e){return Promise.reject(new cr("Not implemented"))}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}setAccessToken(e){throw new cr("Not implemented")}}class Zne{constructor(){}bboxToCellIds(e,t){throw new cr("Not implemented")}getAdjacent(e){throw new cr("Not implemented")}getVertices(e){throw new cr("Not implemented")}lngLatToCellId(e){throw new cr("Not implemented")}_approxBboxToCellIds(e,t){if(t.lat<=e.lat||t.lng<=e.lng)throw new cr("North east needs to be top right of south west");const i=(e.lat+t.lat)/2,r=(e.lng+t.lng)/2,o=ta(t.lng,t.lat,0,r,i,0),c=Math.max(o[0],o[1]);return this._lngLatToCellIds({lat:i,lng:r},c)}_enuToGeodetic(e,t){const[i,r]=dp(e[0],e[1],e[2],t.lng,t.lat,0);return{lat:r,lng:i}}_getLngLatBoundingBoxCorners(e,t){return[[-t,t,0],[t,t,0],[t,-t,0],[-t,-t,0]].map(i=>this._enuToGeodetic(i,e))}_lngLatToCellIds(e,t){const i=this.lngLatToCellId(e),r=this._getLngLatBoundingBoxCorners(e,t);for(const o of r)if(this.lngLatToCellId(o)!==i)return[i,...this.getAdjacent(i)];return[i]}}var ah={exports:{}},Ax={exports:{}};(function(n){(function(e,t){typeof pK=="function"&&n&&n.exports?n.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()})(Ry,function(){function e(j,B,ne){this.low=j|0,this.high=B|0,this.unsigned=!!ne}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function t(j){return(j&&j.__isLong__)===!0}e.isLong=t;var i={},r={};function o(j,B){var ne,J,le;return B?(j>>>=0,(le=0<=j&&j<256)&&(J=r[j],J)?J:(ne=s(j,(j|0)<0?-1:0,!0),le&&(r[j]=ne),ne)):(j|=0,(le=-128<=j&&j<128)&&(J=i[j],J)?J:(ne=s(j,j<0?-1:0,!1),le&&(i[j]=ne),ne))}e.fromInt=o;function c(j,B){if(isNaN(j)||!isFinite(j))return B?I:L;if(B){if(j<0)return I;if(j>=M)return q}else{if(j<=-P)return U;if(j+1>=P)return Y}return j<0?c(-j,B).neg():s(j%b|0,j/b|0,B)}e.fromNumber=c;function s(j,B,ne){return new e(j,B,ne)}e.fromBits=s;var f=Math.pow;function p(j,B,ne){if(j.length===0)throw Error("empty string");if(j==="NaN"||j==="Infinity"||j==="+Infinity"||j==="-Infinity")return L;if(typeof B=="number"?(ne=B,B=!1):B=!!B,ne=ne||10,ne<2||36<ne)throw RangeError("radix");var J;if((J=j.indexOf("-"))>0)throw Error("interior hyphen");if(J===0)return p(j.substring(1),B,ne).neg();for(var le=c(f(ne,8)),ae=L,pe=0;pe<j.length;pe+=8){var fe=Math.min(8,j.length-pe),Te=parseInt(j.substring(pe,pe+fe),ne);if(fe<8){var Ce=c(f(ne,fe));ae=ae.mul(Ce).add(c(Te))}else ae=ae.mul(le),ae=ae.add(c(Te))}return ae.unsigned=B,ae}e.fromString=p;function g(j){return j instanceof e?j:typeof j=="number"?c(j):typeof j=="string"?p(j):s(j.low,j.high,j.unsigned)}e.fromValue=g;var _=65536,x=1<<24,b=_*_,M=b*b,P=M/2,k=o(x),L=o(0);e.ZERO=L;var I=o(0,!0);e.UZERO=I;var F=o(1);e.ONE=F;var N=o(1,!0);e.UONE=N;var H=o(-1);e.NEG_ONE=H;var Y=s(-1,2147483647,!1);e.MAX_VALUE=Y;var q=s(-1,-1,!0);e.MAX_UNSIGNED_VALUE=q;var U=s(0,-2147483648,!1);e.MIN_VALUE=U;var G=e.prototype;return G.toInt=function(){return this.unsigned?this.low>>>0:this.low},G.toNumber=function(){return this.unsigned?(this.high>>>0)*b+(this.low>>>0):this.high*b+(this.low>>>0)},G.toString=function(B){if(B=B||10,B<2||36<B)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(U)){var ne=c(B),J=this.div(ne),le=J.mul(ne).sub(this);return J.toString(B)+le.toInt().toString(B)}else return"-"+this.neg().toString(B);for(var ae=c(f(B,6),this.unsigned),pe=this,fe="";;){var Te=pe.div(ae),Ce=pe.sub(Te.mul(ae)).toInt()>>>0,tt=Ce.toString(B);if(pe=Te,pe.isZero())return tt+fe;for(;tt.length<6;)tt="0"+tt;fe=""+tt+fe}},G.getHighBits=function(){return this.high},G.getHighBitsUnsigned=function(){return this.high>>>0},G.getLowBits=function(){return this.low},G.getLowBitsUnsigned=function(){return this.low>>>0},G.getNumBitsAbs=function(){if(this.isNegative())return this.eq(U)?64:this.neg().getNumBitsAbs();for(var B=this.high!=0?this.high:this.low,ne=31;ne>0&&(B&1<<ne)==0;ne--);return this.high!=0?ne+33:ne+1},G.isZero=function(){return this.high===0&&this.low===0},G.isNegative=function(){return!this.unsigned&&this.high<0},G.isPositive=function(){return this.unsigned||this.high>=0},G.isOdd=function(){return(this.low&1)===1},G.isEven=function(){return(this.low&1)===0},G.equals=function(B){return t(B)||(B=g(B)),this.unsigned!==B.unsigned&&this.high>>>31===1&&B.high>>>31===1?!1:this.high===B.high&&this.low===B.low},G.eq=G.equals,G.notEquals=function(B){return!this.eq(B)},G.neq=G.notEquals,G.lessThan=function(B){return this.comp(B)<0},G.lt=G.lessThan,G.lessThanOrEqual=function(B){return this.comp(B)<=0},G.lte=G.lessThanOrEqual,G.greaterThan=function(B){return this.comp(B)>0},G.gt=G.greaterThan,G.greaterThanOrEqual=function(B){return this.comp(B)>=0},G.gte=G.greaterThanOrEqual,G.compare=function(B){if(t(B)||(B=g(B)),this.eq(B))return 0;var ne=this.isNegative(),J=B.isNegative();return ne&&!J?-1:!ne&&J?1:this.unsigned?B.high>>>0>this.high>>>0||B.high===this.high&&B.low>>>0>this.low>>>0?-1:1:this.sub(B).isNegative()?-1:1},G.comp=G.compare,G.negate=function(){return!this.unsigned&&this.eq(U)?U:this.not().add(F)},G.neg=G.negate,G.add=function(B){t(B)||(B=g(B));var ne=this.high>>>16,J=this.high&65535,le=this.low>>>16,ae=this.low&65535,pe=B.high>>>16,fe=B.high&65535,Te=B.low>>>16,Ce=B.low&65535,tt=0,Ke=0,dt=0,et=0;return et+=ae+Ce,dt+=et>>>16,et&=65535,dt+=le+Te,Ke+=dt>>>16,dt&=65535,Ke+=J+fe,tt+=Ke>>>16,Ke&=65535,tt+=ne+pe,tt&=65535,s(dt<<16|et,tt<<16|Ke,this.unsigned)},G.subtract=function(B){return t(B)||(B=g(B)),this.add(B.neg())},G.sub=G.subtract,G.multiply=function(B){if(this.isZero()||(t(B)||(B=g(B)),B.isZero()))return L;if(this.eq(U))return B.isOdd()?U:L;if(B.eq(U))return this.isOdd()?U:L;if(this.isNegative())return B.isNegative()?this.neg().mul(B.neg()):this.neg().mul(B).neg();if(B.isNegative())return this.mul(B.neg()).neg();if(this.lt(k)&&B.lt(k))return c(this.toNumber()*B.toNumber(),this.unsigned);var ne=this.high>>>16,J=this.high&65535,le=this.low>>>16,ae=this.low&65535,pe=B.high>>>16,fe=B.high&65535,Te=B.low>>>16,Ce=B.low&65535,tt=0,Ke=0,dt=0,et=0;return et+=ae*Ce,dt+=et>>>16,et&=65535,dt+=le*Ce,Ke+=dt>>>16,dt&=65535,dt+=ae*Te,Ke+=dt>>>16,dt&=65535,Ke+=J*Ce,tt+=Ke>>>16,Ke&=65535,Ke+=le*Te,tt+=Ke>>>16,Ke&=65535,Ke+=ae*fe,tt+=Ke>>>16,Ke&=65535,tt+=ne*Ce+J*Te+le*fe+ae*pe,tt&=65535,s(dt<<16|et,tt<<16|Ke,this.unsigned)},G.mul=G.multiply,G.divide=function(B){if(t(B)||(B=g(B)),B.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?I:L;var ne,J,le;if(this.unsigned){if(B.unsigned||(B=B.toUnsigned()),B.gt(this))return I;if(B.gt(this.shru(1)))return N;le=I}else{if(this.eq(U)){if(B.eq(F)||B.eq(H))return U;if(B.eq(U))return F;var ae=this.shr(1);return ne=ae.div(B).shl(1),ne.eq(L)?B.isNegative()?F:H:(J=this.sub(B.mul(ne)),le=ne.add(J.div(B)),le)}else if(B.eq(U))return this.unsigned?I:L;if(this.isNegative())return B.isNegative()?this.neg().div(B.neg()):this.neg().div(B).neg();if(B.isNegative())return this.div(B.neg()).neg();le=L}for(J=this;J.gte(B);){ne=Math.max(1,Math.floor(J.toNumber()/B.toNumber()));for(var pe=Math.ceil(Math.log(ne)/Math.LN2),fe=pe<=48?1:f(2,pe-48),Te=c(ne),Ce=Te.mul(B);Ce.isNegative()||Ce.gt(J);)ne-=fe,Te=c(ne,this.unsigned),Ce=Te.mul(B);Te.isZero()&&(Te=F),le=le.add(Te),J=J.sub(Ce)}return le},G.div=G.divide,G.modulo=function(B){return t(B)||(B=g(B)),this.sub(this.div(B).mul(B))},G.mod=G.modulo,G.not=function(){return s(~this.low,~this.high,this.unsigned)},G.and=function(B){return t(B)||(B=g(B)),s(this.low&B.low,this.high&B.high,this.unsigned)},G.or=function(B){return t(B)||(B=g(B)),s(this.low|B.low,this.high|B.high,this.unsigned)},G.xor=function(B){return t(B)||(B=g(B)),s(this.low^B.low,this.high^B.high,this.unsigned)},G.shiftLeft=function(B){return t(B)&&(B=B.toInt()),(B&=63)===0?this:B<32?s(this.low<<B,this.high<<B|this.low>>>32-B,this.unsigned):s(0,this.low<<B-32,this.unsigned)},G.shl=G.shiftLeft,G.shiftRight=function(B){return t(B)&&(B=B.toInt()),(B&=63)===0?this:B<32?s(this.low>>>B|this.high<<32-B,this.high>>B,this.unsigned):s(this.high>>B-32,this.high>=0?0:-1,this.unsigned)},G.shr=G.shiftRight,G.shiftRightUnsigned=function(B){if(t(B)&&(B=B.toInt()),B&=63,B===0)return this;var ne=this.high;if(B<32){var J=this.low;return s(J>>>B|ne<<32-B,ne>>>B,this.unsigned)}else return B===32?s(ne,0,this.unsigned):s(ne>>>B-32,0,this.unsigned)},G.shru=G.shiftRightUnsigned,G.toSigned=function(){return this.unsigned?s(this.low,this.high,!1):this},G.toUnsigned=function(){return this.unsigned?this:s(this.low,this.high,!0)},G.toBytes=function(j){return j?this.toBytesLE():this.toBytesBE()},G.toBytesLE=function(){var j=this.high,B=this.low;return[B&255,B>>>8&255,B>>>16&255,B>>>24&255,j&255,j>>>8&255,j>>>16&255,j>>>24&255]},G.toBytesBE=function(){var j=this.high,B=this.low;return[j>>>24&255,j>>>16&255,j>>>8&255,j&255,B>>>24&255,B>>>16&255,B>>>8&255,B&255]},e})})(Ax);(function(n){(function(e){var t=e.S2={L:{}};t.L.LatLng=function(p,g,_){var x=parseFloat(p,10),b=parseFloat(g,10);if(isNaN(x)||isNaN(b))throw new Error("Invalid LatLng object: ("+p+", "+g+")");return _!==!0&&(x=Math.max(Math.min(x,90),-90),b=(b+180)%360+(b<-180||b===180?180:-180)),{lat:x,lng:b}},t.L.LatLng.DEG_TO_RAD=Math.PI/180,t.L.LatLng.RAD_TO_DEG=180/Math.PI,t.LatLngToXYZ=function(p){var g=t.L.LatLng.DEG_TO_RAD,_=p.lat*g,x=p.lng*g,b=Math.cos(_);return[Math.cos(x)*b,Math.sin(x)*b,Math.sin(_)]},t.XYZToLatLng=function(p){var g=t.L.LatLng.RAD_TO_DEG,_=Math.atan2(p[2],Math.sqrt(p[0]*p[0]+p[1]*p[1])),x=Math.atan2(p[1],p[0]);return t.L.LatLng(_*g,x*g)};var i=function(p){var g=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];return g[0]>g[1]?g[0]>g[2]?0:2:g[1]>g[2]?1:2},r=function(p,g){var _,x;switch(p){case 0:_=g[1]/g[0],x=g[2]/g[0];break;case 1:_=-g[0]/g[1],x=g[2]/g[1];break;case 2:_=-g[0]/g[2],x=-g[1]/g[2];break;case 3:_=g[2]/g[0],x=g[1]/g[0];break;case 4:_=g[2]/g[1],x=-g[0]/g[1];break;case 5:_=-g[1]/g[2],x=-g[0]/g[2];break;default:throw{error:"Invalid face"}}return[_,x]};t.XYZToFaceUV=function(p){var g=i(p);p[g]<0&&(g+=3);var _=r(g,p);return[g,_]},t.FaceUVToXYZ=function(p,g){var _=g[0],x=g[1];switch(p){case 0:return[1,_,x];case 1:return[-_,1,x];case 2:return[-_,-x,1];case 3:return[-1,-x,-_];case 4:return[x,-1,-_];case 5:return[x,_,-1];default:throw{error:"Invalid face"}}};var o=function(p){return p>=.5?1/3*(4*p*p-1):1/3*(1-4*(1-p)*(1-p))};t.STToUV=function(p){return[o(p[0]),o(p[1])]};var c=function(p){return p>=0?.5*Math.sqrt(1+3*p):1-.5*Math.sqrt(1-3*p)};t.UVToST=function(p){return[c(p[0]),c(p[1])]},t.STToIJ=function(p,g){var _=1<<g,x=function(b){var M=Math.floor(b*_);return Math.max(0,Math.min(_-1,M))};return[x(p[0]),x(p[1])]},t.IJToST=function(p,g,_){var x=1<<g;return[(p[0]+_[0])/x,(p[1]+_[1])/x]};var s=function(p,g,_,x){if(x==0){_==1&&(g.x=p-1-g.x,g.y=p-1-g.y);var b=g.x;g.x=g.y,g.y=b}},f=function(p,g,_,x){var b={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};typeof x!="number"&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var M=x%2?"d":"a",P=[],k=_-1;k>=0;k--){var L=1<<k,I=p&L?1:0,F=g&L?1:0,N=b[M][I*2+F];P.push(N[0]),M=N[1]}return P};t.S2Cell=function(){},t.S2Cell.FromHilbertQuadKey=function(p){var g=p.split("/"),_=parseInt(g[0]),x=g[1],b=x.length,M={x:0,y:0},P,k,L,I,F,N;for(P=b-1;P>=0;P--)k=b-P,L=x[P],I=0,F=0,L==="1"?F=1:L==="2"?(I=1,F=1):L==="3"&&(I=1),N=Math.pow(2,k-1),s(N,M,I,F),M.x+=N*I,M.y+=N*F;if(_%2===1){var H=M.x;M.x=M.y,M.y=H}return t.S2Cell.FromFaceIJ(parseInt(_),[M.x,M.y],k)},t.S2Cell.FromLatLng=function(p,g){if(!p.lat&&p.lat!==0||!p.lng&&p.lng!==0)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var _=t.LatLngToXYZ(p),x=t.XYZToFaceUV(_),b=t.UVToST(x[1]),M=t.STToIJ(b,g);return t.S2Cell.FromFaceIJ(x[0],M,g)},t.S2Cell.FromFaceIJ=function(p,g,_){var x=new t.S2Cell;return x.face=p,x.ij=g,x.level=_,x},t.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},t.S2Cell.prototype.getLatLng=function(){var p=t.IJToST(this.ij,this.level,[.5,.5]),g=t.STToUV(p),_=t.FaceUVToXYZ(this.face,g);return t.XYZToLatLng(_)},t.S2Cell.prototype.getCornerLatLngs=function(){for(var p=[],g=[[0,0],[0,1],[1,1],[1,0]],_=0;_<4;_++){var x=t.IJToST(this.ij,this.level,g[_]),b=t.STToUV(x),M=t.FaceUVToXYZ(this.face,b);p.push(t.XYZToLatLng(M))}return p},t.S2Cell.prototype.getFaceAndQuads=function(){var p=f(this.ij[0],this.ij[1],this.level,this.face);return[this.face,p]},t.S2Cell.prototype.toHilbertQuadkey=function(){var p=f(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+p.join("")},t.latLngToNeighborKeys=t.S2Cell.latLngToNeighborKeys=function(p,g,_){return t.S2Cell.FromLatLng({lat:p,lng:g},_).getNeighbors().map(function(x){return x.toHilbertQuadkey()})},t.S2Cell.prototype.getNeighbors=function(){var p=function(M,P,k){var L=1<<k;if(P[0]>=0&&P[1]>=0&&P[0]<L&&P[1]<L)return t.S2Cell.FromFaceIJ(M,P,k);var I=t.IJToST(P,k,[.5,.5]),F=t.STToUV(I),N=t.FaceUVToXYZ(M,F),H=t.XYZToFaceUV(N);return M=H[0],F=H[1],I=t.UVToST(F),P=t.STToIJ(I,k),t.S2Cell.FromFaceIJ(M,P,k)},g=this.face,_=this.ij[0],x=this.ij[1],b=this.level;return[p(g,[_-1,x],b),p(g,[_,x-1],b),p(g,[_+1,x],b),p(g,[_,x+1],b)]},t.FACE_BITS=3,t.MAX_LEVEL=30,t.POS_BITS=2*t.MAX_LEVEL+1,t.facePosLevelToId=t.S2Cell.facePosLevelToId=t.fromFacePosLevel=function(p,g,_){var x=e.dcodeIO&&e.dcodeIO.Long||Ax.exports,b,M,P;for(_||(_=g.length),g.length>_&&(g=g.substr(0,_)),b=x.fromString(p.toString(10),!0,10).toString(2);b.length<t.FACE_BITS;)b="0"+b;for(M=x.fromString(g,!0,4).toString(2);M.length<2*_;)M="0"+M;for(P=b+M,P+="1";P.length<t.FACE_BITS+t.POS_BITS;)P+="0";return x.fromString(P,!0,2).toString(10)},t.keyToId=t.S2Cell.keyToId=t.toId=t.toCellId=t.fromKey=function(p){var g=p.split("/");return t.fromFacePosLevel(g[0],g[1],g[1].length)},t.idToKey=t.S2Cell.idToKey=t.S2Cell.toKey=t.toKey=t.fromId=t.fromCellId=t.S2Cell.toHilbertQuadkey=t.toHilbertQuadkey=function(p){for(var g=e.dcodeIO&&e.dcodeIO.Long||Ax.exports,_=g.fromString(p,!0,10).toString(2);_.length<t.FACE_BITS+t.POS_BITS;)_="0"+_;for(var x=_.lastIndexOf("1"),b=_.substring(0,3),M=_.substring(3,x),P=M.length/2,k=g.fromString(b,!0,2).toString(10),L=g.fromString(M,!0,2).toString(4);L.length<P;)L="0"+L;return k+"/"+L},t.keyToLatLng=t.S2Cell.keyToLatLng=function(p){var g=t.S2Cell.FromHilbertQuadKey(p);return g.getLatLng()},t.idToLatLng=t.S2Cell.idToLatLng=function(p){var g=t.idToKey(p);return t.keyToLatLng(g)},t.S2Cell.latLngToKey=t.latLngToKey=t.latLngToQuadkey=function(p,g,_){if(isNaN(_)||_<1||_>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return t.S2Cell.FromLatLng({lat:p,lng:g},_).toHilbertQuadkey()},t.stepKey=function(p,g){var _=e.dcodeIO&&e.dcodeIO.Long||Ax.exports,x=p.split("/"),b=x[0],M=x[1],P=x[1].length,k=_.fromString(M,!0,4),L;g>0?L=k.add(Math.abs(g)):g<0&&(L=k.subtract(Math.abs(g)));var I=L.toString(4);for(I==="0"&&console.warning(new Error("face/position wrapping is not yet supported"));I.length<P;)I="0"+I;return b+"/"+I},t.S2Cell.prevKey=t.prevKey=function(p){return t.stepKey(p,-1)},t.S2Cell.nextKey=t.nextKey=function(p){return t.stepKey(p,1)}})(n.exports)})(ah);class Xne extends Zne{constructor(e=17){super(),this._level=e}bboxToCellIds(e,t){return this._approxBboxToCellIds(e,t)}getAdjacent(e){const t=ah.exports.S2.idToKey(e),r=t.split("/")[1].length,[o,c,s,f]=this._getNeighbors(t,r),p=[t,o,c,s,f],g=Array.from(new Set([...this._getNeighbors(o,r),...this._getNeighbors(c,r),...this._getNeighbors(s,r),...this._getNeighbors(f,r)].filter(x=>!p.includes(x)))),_=[o,c,s,f];for(const x of g){let b=0;for(const M of this._getNeighbors(x,r))p.includes(M)&&b++;b===2&&_.push(x)}return _.map(x=>ah.exports.S2.keyToId(x))}getVertices(e){const t=ah.exports.S2.idToKey(e);return ah.exports.S2.S2Cell.FromHilbertQuadKey(t).getCornerLatLngs().map(r=>({lat:r.lat,lng:r.lng}))}lngLatToCellId(e){return this._lngLatToId(e,this._level)}_getNeighbors(e,t){const i=ah.exports.S2.keyToLatLng(e);return ah.exports.S2.latLngToNeighborKeys(i.lat,i.lng,t)}_lngLatToId(e,t){const i=ah.exports.S2.latLngToKey(e.lat,e.lng,t);return ah.exports.S2.keyToId(i)}}function Yne(n){switch(n){case"equirectangular":case"spherical":return"spherical";case"fisheye":return"fisheye";default:return"perspective"}}class Kne{clusterReconstruction(e){const i=e.points,r=1/255;for(const s in i){if(!i.hasOwnProperty(s))continue;const f=i[s].color;f[0]*=r,f[1]*=r,f[2]*=r}const o=e.reference_lla,c={alt:o.altitude,lat:o.latitude,lng:o.longitude};return{id:null,points:i,reference:c}}coreImage(e){const t=this._geometry(e.geometry),i=this._geometry(e.computed_geometry),r={id:e.sequence},o=e.id;return{computed_geometry:i,geometry:t,id:o,sequence:r}}spatialImage(e){var t,i,r,o,c;e.camera_type=Yne(e.camera_type),e.merge_id=e.merge_cc?e.merge_cc.toString():null,e.private=null;const s=e.camera_type==="spherical"?e.thumb_2048_url:e.thumb_1024_url;return e.thumb=(t=e.thumb)!==null&&t!==void 0?t:{id:null,url:s},e.cluster=(i=e.sfm_cluster)!==null&&i!==void 0?i:{id:null,url:null},e.creator=(r=e.creator)!==null&&r!==void 0?r:{id:null,username:null},e.owner=(o=e.organization)!==null&&o!==void 0?o:{id:null},e.mesh=(c=e.mesh)!==null&&c!==void 0?c:{id:null,url:null},e}_geometry(e){const t=e?.coordinates;return t?{lat:t[1],lng:t[0]}:null}}class Jne{constructor(){this.imagesPath="images",this.sequencePath="image_ids",this._imageTilesPath="tiles",this.coreFields=["computed_geometry","geometry","sequence"],this.idFields=["id"],this.spatialFields=["altitude","atomic_scale","camera_parameters","camera_type","captured_at","compass_angle","computed_altitude","computed_compass_angle","computed_rotation","creator","exif_orientation","height","merge_cc","mesh","organization","quality_score","sfm_cluster","thumb_1024_url","thumb_2048_url","width"],this.imageTileFields=["url","z","x","y"]}images(e,t){return`image_ids=${e.join(",")}&fields=${t.join(",")}`}imagesS2(e,t){return`s2=${e}&fields=${t.join(",")}`}imageTiles(e,t){return`z=${e}&fields=${t.join(",")}`}imageTilesPath(e){return`${e}/${this._imageTilesPath}`}sequence(e){return`sequence_id=${e}`}}class Qne extends Wne{constructor(e,t,i,r){var o;super(t??new Xne),this._convert=i??new Kne,this._query=r??new Jne,this._method="GET";const c=e??{};this._endpoint=(o=c.endpoint)!==null&&o!==void 0?o:"https://graph.mapillary.com",this._accessToken=c.accessToken}getCluster(e,t){return IT(e,t).then(i=>{const r=Gne(i);if(r.length<1)throw new Error("Cluster reconstruction empty");return this._convert.clusterReconstruction(r[0])})}getCoreImages(e){const t=[...this._query.idFields,...this._query.coreFields],i=this._query.imagesS2(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then(o=>{const c={cell_id:e,images:[]},s=o.data;for(const f of s){const p=this._convert.coreImage(f);c.images.push(p)}return c})}getImageBuffer(e,t){return IT(e,t)}getImages(e){const t=[...this._query.idFields,...this._query.coreFields,...this._query.spatialFields],i=this._query.images(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then(o=>{const c=[],s=o.data;for(const f of s){const p=this._convert.coreImage(f),g=this._convert.spatialImage(f),x={node:Object.assign({},g,p),node_id:f.id};c.push(x)}return c})}getImageTiles(e){const t=[...this._query.imageTileFields],i=this._query.imageTiles(e.z,t),r=new URL(this._query.imageTilesPath(e.imageId),this._endpoint).href;return this._fetchGraphContract(i,r).then(o=>({node:o.data,node_id:e.imageId}))}getMesh(e,t){return IT(e,t).then(i=>qne(i))}getSequence(e){const t=this._query.sequence(e),i=new URL(this._query.sequencePath,this._endpoint).href;return this._fetchGraphContract(t,i).then(r=>({id:e,image_ids:r.data.map(c=>c.id)}))}getSpatialImages(e){const t=[...this._query.idFields,...this._query.coreFields,...this._query.spatialFields],i=this._query.images(e,t),r=new URL(this._query.imagesPath,this._endpoint).href;return this._fetchGraphContract(i,r).then(o=>{const c=[],s=o.data;for(const f of s){const g={node:this._convert.spatialImage(f),node_id:f.id};c.push(g)}return c})}setAccessToken(e){this._accessToken=e}_createHeaders(){const e=[{name:"Accept",value:"application/json"},{name:"Content-Type",value:"application/x-www-form-urlencoded"}];return this._accessToken&&e.push({name:"Authorization",value:`OAuth ${this._accessToken}`}),e}_fetchGraphContract(e,t){const i=this._method,r=this._createHeaders(),o=`${t}?${e}`;return jz(o,i,"json",r,null,null).catch(c=>{const s=this._makeErrorMessage(c);throw new cr(s)})}_makeErrorMessage(e){const t=e.error;return t?`${t.code} (${t.type}, ${t.fbtrace_id}): ${t.message}`:"Failed to fetch data"}}var bh;(function(n){n[n.Custom=0]="Custom",n[n.Earth=1]="Earth",n[n.Street=2]="Street"})(bh||(bh={}));var qg;(function(n){n[n.Letterbox=0]="Letterbox",n[n.Fill=1]="Fill"})(qg||(qg={}));var WL;(function(n){n[n.Opaque=0]="Opaque"})(WL||(WL={}));var _w;(function(n){n[n.Default=0]="Default",n[n.Instantaneous=1]="Instantaneous"})(_w||(_w={}));class ere{constructor(e,t,i,r,o,c){this._container=e,this._observer=i,this._navigator=t,this._options=o??{},this._key=r,this._navigable=r==null,this._componentService=c||new Mr(this._container,this._navigator),this._coverComponent=this._componentService.getCover(),this._initializeComponents(),r?(this._initilizeCoverComponent(),this._subscribeCoverComponent()):this._navigator.movedToId$.pipe(wi(s=>s!=null)).subscribe(s=>{this._key=s,this._componentService.deactivateCover(),this._coverComponent.configure({id:this._key,state:Qo.Hidden}),this._subscribeCoverComponent(),this._navigator.stateService.start(),this._navigator.cacheService.start(),this._navigator.panService.start(),this._observer.startEmit()})}get navigable(){return this._navigable}get(e){return this._componentService.get(e)}activate(e){this._componentService.activate(e)}activateCover(){this._coverComponent.configure({state:Qo.Visible})}deactivate(e){this._componentService.deactivate(e)}deactivateCover(){this._coverComponent.configure({state:Qo.Loading})}remove(){this._componentService.remove(),this._configurationSubscription!=null&&this._configurationSubscription.unsubscribe()}_initializeComponents(){var e,t;const i=this._options;this._uFalse((e=i.fallback)===null||e===void 0?void 0:e.image,"imagefallback"),this._uFalse((t=i.fallback)===null||t===void 0?void 0:t.navigation,"navigationfallback"),this._uFalse(i.marker,"marker"),this._uFalse(i.popup,"popup"),this._uFalse(i.slider,"slider"),this._uFalse(i.spatial,"spatial"),this._uFalse(i.tag,"tag"),this._uTrue(i.attribution,"attribution"),this._uTrue(i.bearing,"bearing"),this._uTrue(i.cache,"cache"),this._uTrue(i.direction,"direction"),this._uTrue(i.image,"image"),this._uTrue(i.keyboard,"keyboard"),this._uTrue(i.pointer,"pointer"),this._uTrue(i.sequence,"sequence"),this._uTrue(i.zoom,"zoom")}_initilizeCoverComponent(){let e=this._options;this._coverComponent.configure({id:this._key}),e.cover===void 0||e.cover?this.activateCover():this.deactivateCover()}_setNavigable(e){this._navigable!==e&&(this._navigable=e,this._observer.navigable$.next(e))}_subscribeCoverComponent(){this._configurationSubscription=this._coverComponent.configuration$.pipe(yi(void 0,e=>e.state)).subscribe(e=>{e.state===Qo.Loading?this._navigator.stateService.currentId$.pipe(wi(),ei(t=>{const i=t==null||t!==e.id;return i&&this._setNavigable(!1),i?this._navigator.moveTo$(e.id):this._navigator.stateService.currentImage$.pipe(wi())})).subscribe(()=>{this._navigator.stateService.start(),this._navigator.cacheService.start(),this._navigator.panService.start(),this._observer.startEmit(),this._coverComponent.configure({state:Qo.Hidden}),this._componentService.deactivateCover(),this._setNavigable(!0)},t=>{console.error("Failed to deactivate cover.",t),this._coverComponent.configure({state:Qo.Visible})}):e.state===Qo.Visible&&(this._observer.stopEmit(),this._navigator.stateService.stop(),this._navigator.cacheService.stop(),this._navigator.playService.stop(),this._navigator.panService.stop(),this._componentService.activateCover(),this._setNavigable(e.id==null))})}_uFalse(e,t){if(e===void 0){this._componentService.deactivate(t);return}if(typeof e=="boolean"){e?this._componentService.activate(t):this._componentService.deactivate(t);return}this._componentService.configure(t,e),this._componentService.activate(t)}_uTrue(e,t){if(e===void 0){this._componentService.activate(t);return}if(typeof e=="boolean"){e?this._componentService.activate(t):this._componentService.deactivate(t);return}this._componentService.configure(t,e),this._componentService.activate(t)}}class tre{constructor(e,t,i){this._adaptiveOperation$=new ri,this._render$=new ri,this._renderAdaptive$=new ri,this._subscriptions=new yo,this._renderService=t,this._currentFrame$=i;const r=this._subscriptions,o=jt.create(jt.h("div.mapillary-dom-renderer",[]));e.appendChild(o),this._offset$=this._adaptiveOperation$.pipe(Vr((f,p)=>p(f),{elementHeight:e.offsetHeight,elementWidth:e.offsetWidth,imageAspect:0,renderMode:qg.Fill}),oi(f=>f.imageAspect>0&&f.elementWidth>0&&f.elementHeight>0),We(f=>{const p=f.elementWidth/f.elementHeight,g=f.imageAspect/p;let _=0,x=0;return f.renderMode===qg.Letterbox?f.imageAspect>p?_=f.elementHeight*(1-1/g)/2:x=f.elementWidth*(1-g)/2:f.imageAspect>p?x=-f.elementWidth*(g-1)/2:_=-f.elementHeight*(1/g-1)/2,{bottom:_,left:x,right:x,top:_}}));const c=this._currentFrame$.pipe(oi(f=>f.state.currentImage!=null),yi((f,p)=>f===p,f=>f.state.currentImage.id),We(f=>f.state.currentTransform.basicAspect),We(f=>p=>(p.imageAspect=f,p))).subscribe(this._adaptiveOperation$),s=Si(this._renderAdaptive$.pipe(Vr((f,p)=>(p.vNode==null?delete f[p.name]:f[p.name]=p.vNode,f),{})),this._offset$).pipe(We(f=>{const p=[],g=f[0];for(const b in g)g.hasOwnProperty(b)&&p.push(g[b]);const _=f[1],x={style:{bottom:_.bottom+"px",left:_.left+"px","pointer-events":"none",position:"absolute",right:_.right+"px",top:_.top+"px"}};return{name:"mapillary-dom-adaptive-renderer",vNode:jt.h("div.mapillary-dom-adaptive-renderer",x,p)}})).subscribe(this._render$);this._vNode$=this._render$.pipe(Vr((f,p)=>(p.vNode==null?delete f[p.name]:f[p.name]=p.vNode,f),{}),We(f=>{const p=[];for(const g in f)f.hasOwnProperty(g)&&p.push(f[g]);return jt.h("div.mapillary-dom-renderer",p)})),this._vPatch$=this._vNode$.pipe(Vr((f,p)=>(f.vpatch=jt.diff(f.vNode,p),f.vNode=p,f),{vNode:jt.h("div.mapillary-dom-renderer",[]),vpatch:null}),$G("vpatch")),this._element$=this._vPatch$.pipe(Vr((f,p)=>jt.patch(f,p),o),Pi(1),gi()),r.push(c),r.push(s),r.push(this._element$.subscribe(()=>{})),r.push(this._renderService.size$.pipe(We(f=>p=>(p.elementWidth=f.width,p.elementHeight=f.height,p))).subscribe(this._adaptiveOperation$)),r.push(this._renderService.renderMode$.pipe(We(f=>p=>(p.renderMode=f,p))).subscribe(this._adaptiveOperation$))}get element$(){return this._element$}get render$(){return this._render$}get renderAdaptive$(){return this._renderAdaptive$}clear(e){this._renderAdaptive$.next({name:e,vNode:null}),this._render$.next({name:e,vNode:null})}remove(){this._subscriptions.unsubscribe()}}class ire{constructor(e,t,i){this._renderFrame$=new ri,this._renderCameraOperation$=new ri,this._render$=new ri,this._clear$=new ri,this._renderOperation$=new ri,this._rendererOperation$=new ri,this._eraserOperation$=new ri,this._triggerOperation$=new ri,this._subscriptions=new yo,this._opaqueRender$=new ri,this._renderService=i;const r=this._subscriptions;this._renderer$=this._rendererOperation$.pipe(Vr((M,P)=>P(M),{needsRender:!1,renderer:null}),oi(M=>!!M.renderer)),this._renderCollection$=this._renderOperation$.pipe(Vr((M,P)=>P(M),{}),dn()),this._renderCamera$=this._renderCameraOperation$.pipe(Vr((M,P)=>P(M),{frameId:-1,needsRender:!1,perspective:null})),this._eraser$=this._eraserOperation$.pipe(An(M=>M),Vr((M,P)=>P(M),{needsRender:!1}));const o=this._triggerOperation$.pipe(An(M=>M),Vr((M,P)=>P(M),{needsRender:!1})),c=new Bi(986895),s=Si(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$,o).pipe(We(([M,P,k,L,I])=>{const F=Object.keys(P).map(N=>P[N]);return{camera:k,eraser:L,trigger:I,renderer:M,renders:F}}),oi(M=>{let P=M.renderer.needsRender||M.camera.needsRender||M.eraser.needsRender||M.trigger.needsRender;const k=M.camera.frameId;for(const L of M.renders){if(L.frameId!==k)return!1;P=P||L.needsRender}return P}),yi((M,P)=>M===P,M=>M.eraser.needsRender||M.trigger.needsRender?-M.camera.frameId:M.camera.frameId)).subscribe(M=>{M.renderer.needsRender=!1,M.camera.needsRender=!1,M.eraser.needsRender=!1,M.trigger.needsRender=!1;const P=M.camera.perspective,k=[],L=[];for(const F of M.renders)F.pass===Ph.Background?k.push(F.render):F.pass===Ph.Opaque&&L.push(F.render);const I=M.renderer.renderer;I.resetState(),I.setClearColor(c,1),I.clear();for(const F of k)F(P,I);I.clearDepth();for(const F of L)F(P,I);I.resetState(),this._opaqueRender$.next()});r.push(s),r.push(this._renderFrame$.pipe(We(M=>P=>(P.frameId=M.frameId,P.perspective=M.perspective,M.changed===!0&&(P.needsRender=!0),P))).subscribe(this._renderCameraOperation$)),this._renderFrameSubscribe();const f=this._render$.pipe(We(M=>P=>(P[M.name]=M.renderer,P))),p=this._clear$.pipe(We(M=>P=>(delete P[M],P)));r.push(fn(f,p).subscribe(this._renderOperation$)),this._webGLRenderer$=this._render$.pipe(wi(),We(()=>{t.appendChild(e);const M=i.element,P=new hr({canvas:e});return P.setPixelRatio(window.devicePixelRatio),P.setSize(M.offsetWidth,M.offsetHeight),P.autoClear=!1,P}),Pi(1),gi()),r.push(this._webGLRenderer$.subscribe(()=>{}));const g=this._webGLRenderer$.pipe(wi(),We(M=>P=>(P.needsRender=!0,P.renderer=M,P))),_=this._renderService.size$.pipe(We(M=>P=>(P.renderer==null||(P.renderer.setSize(M.width,M.height),P.needsRender=!0),P))),x=this._clear$.pipe(We(()=>M=>(M.renderer==null||(M.needsRender=!0),M)));r.push(fn(g,_,x).subscribe(this._rendererOperation$));const b=this._renderCollection$.pipe(oi(M=>Object.keys(M).length===0),dn());r.push(b.subscribe(()=>{this._renderFrameSubscription!=null&&(this._renderFrameSubscription.unsubscribe(),this._renderFrameSubscription=null,this._renderFrameSubscribe())})),r.push(b.pipe(We(()=>M=>(M.needsRender=!0,M))).subscribe(this._eraserOperation$))}get render$(){return this._render$}get opaqueRender$(){return this._opaqueRender$}get webGLRenderer$(){return this._webGLRenderer$}clear(e){this._clear$.next(e)}remove(){this._rendererOperation$.next(e=>{if(e.renderer!=null){const t=e.renderer.getContext().getExtension("WEBGL_lose_context");t&&t.loseContext(),e.renderer=null}return e}),this._renderFrameSubscription!=null&&this._renderFrameSubscription.unsubscribe(),this._subscriptions.unsubscribe()}triggerRerender(){this._renderService.renderCameraFrame$.pipe(Ys(1),wi()).subscribe(()=>{this._triggerOperation$.next(e=>(e.needsRender=!0,e))})}_renderFrameSubscribe(){this._render$.pipe(wi(),We(()=>e=>(e.needsRender=!0,e))).subscribe(e=>{this._renderCameraOperation$.next(e)}),this._renderFrameSubscription=this._render$.pipe(wi(),Wi(()=>this._renderService.renderCameraFrame$)).subscribe(this._renderFrame$)}}class Td{constructor(e){e!=null?(this._position=new Fe().fromArray(e.unprojectSfM([0,0],0)),this._lookat=new Fe().fromArray(e.unprojectSfM([0,0],10)),this._up=e.upVector(),this._focal=this._getFocal(e)):(this._position=new Fe(0,0,0),this._lookat=new Fe(1,0,0),this._up=new Fe(0,0,1),this._focal=1)}get position(){return this._position}get lookat(){return this._lookat}get up(){return this._up}get focal(){return this._focal}set focal(e){this._focal=e}lerpCameras(e,t,i){this._position.subVectors(t.position,e.position).multiplyScalar(i).add(e.position),this._lookat.subVectors(t.lookat,e.lookat).multiplyScalar(i).add(e.lookat),this._up.subVectors(t.up,e.up).multiplyScalar(i).add(e.up),this._focal=(1-i)*e.focal+i*t.focal}copy(e){this._position.copy(e.position),this._lookat.copy(e.lookat),this._up.copy(e.up),this._focal=e.focal}clone(){let e=new Td;return e.position.copy(this._position),e.lookat.copy(this._lookat),e.up.copy(this._up),e.focal=this._focal,e}diff(e){let t=this._position.distanceToSquared(e.position),i=this._lookat.distanceToSquared(e.lookat),r=this._up.distanceToSquared(e.up),o=100*Math.abs(this._focal-e.focal);return Math.max(t,i,r,o)}_getFocal(e){return ki(e.cameraType)?.5/Math.tan(Math.PI/2):e.focal}}class nre{constructor(e,t,i){this._spatial=new vo,this._viewportCoords=new zo,this._size={width:e,height:t},this._initialFov=60,this._alpha=-1,this._stateTransitionAlpha=-1,this._stateTransitionFov=-1,this._renderMode=i,this._zoom=0,this._frameId=-1,this._changed=!1,this._changedForFrame=-1,this._currentImageId=null,this._previousImageId=null,this._currentSpherical=!1,this._previousSpherical=!1,this._state=null,this._currentProjectedPoints=[],this._previousProjectedPoints=[],this._currentFov=this._initialFov,this._previousFov=this._initialFov,this._camera=new Td,this._perspective=new ea(this._initialFov,this._computeAspect(e,t),.1,1e4),this._perspective.position.copy(this._camera.position),this._perspective.up.copy(this._camera.up),this._perspective.lookAt(this._camera.lookat),this._perspective.updateMatrixWorld(!0),this._perspective.matrixAutoUpdate=!1,this._rotation={phi:0,theta:0}}get alpha(){return this._alpha}get camera(){return this._camera}get changed(){return this._frameId===this._changedForFrame}get frameId(){return this._frameId}get perspective(){return this._perspective}get renderMode(){return this._renderMode}get rotation(){return this._rotation}get zoom(){return this._zoom}get size(){return this._size}getTilt(){return 90-this._spatial.radToDeg(this._rotation.theta)}fovToZoom(e){e=Math.min(90,Math.max(0,e));const t=this._computeCurrentFov(0),i=this._alpha===1?t:this._interpolateFov(t,this._computePreviousFov(0),this._alpha),r=Math.tan(i/2*Math.PI/180),o=Math.tan(e/2*Math.PI/180);return Math.log(r/o)/Math.log(2)}setFrame(e){const t=e.state;if(t.state!==this._state){if(this._state=t.state,this._state!==Oi.Custom&&(this.setRenderMode(this._renderMode),this.setSize(this._size)),this._state===Oi.Earth){const p=this._fovToY(this._perspective.fov,this._zoom);this._stateTransitionFov=this._yToFov(p,0)}this._changed=!0}const i=t.currentImage.id,r=t.previousImage?t.previousImage.id:null;i!==this._currentImageId&&(this._currentImageId=i,this._currentSpherical=ki(t.currentTransform.cameraType),this._currentProjectedPoints=this._computeProjectedPoints(t.currentTransform),this._changed=!0),r!==this._previousImageId&&(this._previousImageId=r,this._previousSpherical=ki(t.previousTransform.cameraType),this._previousProjectedPoints=this._computeProjectedPoints(t.previousTransform),this._changed=!0);const o=t.zoom;o!==this._zoom&&(this._changed=!0),this._changed&&(this._currentFov=this._computeCurrentFov(o),this._previousFov=this._computePreviousFov(o));const c=t.alpha,s=t.stateTransitionAlpha;if(this._changed||c!==this._alpha||s!==this._stateTransitionAlpha){switch(this._alpha=c,this._stateTransitionAlpha=s,this._state){case Oi.Earth:{const p=this._stateTransitionFov,g=this._focalToFov(t.camera.focal),_=Bg.lerp(p,g,s),x=this._fovToY(_,0);this._perspective.fov=this._yToFov(x,o);break}case Oi.Custom:break;default:this._perspective.fov=this._interpolateFov(this._currentFov,this._previousFov,this._alpha),this._changed=!0;break}this._zoom=o,this._state!==Oi.Custom&&this._perspective.updateProjectionMatrix()}const f=t.camera;this._camera.diff(f)>1e-9&&(this._camera.copy(f),this._rotation=this._computeRotation(f),this._perspective.up.copy(f.up),this._perspective.position.copy(f.position),this._perspective.matrixAutoUpdate=!0,this._perspective.lookAt(f.lookat),this._perspective.matrixAutoUpdate=!1,this._perspective.updateMatrix(),this._perspective.updateMatrixWorld(!1),this._changed=!0),this._setFrameId(e.id)}setProjectionMatrix(e){this._perspective.fov=this._focalToFov(e[5]/2),this._perspective.projectionMatrix.fromArray(e),this._perspective.projectionMatrixInverse.copy(this._perspective.projectionMatrix).invert(),this._changed=!0}setRenderMode(e){this._renderMode=e,this._state!==Oi.Custom&&(this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}setSize(e){this._size=e,this._state!==Oi.Custom&&(this._perspective.aspect=this._computeAspect(e.width,e.height),this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0)}_computeAspect(e,t){return e===0?0:e/t}_computeCurrentFov(e){return this._perspective.aspect===0?0:this._currentImageId?this._currentSpherical?this._yToFov(1,e):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,e,this.perspective.aspect):this._initialFov}_computeFov(){return this._currentFov=this._computeCurrentFov(this._zoom),this._previousFov=this._computePreviousFov(this._zoom),this._interpolateFov(this._currentFov,this._previousFov,this._alpha)}_computePreviousFov(e){return this._perspective.aspect===0?0:this._currentImageId?this._previousImageId?this._previousSpherical?this._yToFov(1,e):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,e,this.perspective.aspect):this._currentFov:this._initialFov}_computeProjectedPoints(e){return eC(e,[[.5,0],[1,0]],[[.5,0],[0,.5]],100,this._viewportCoords)}_computeRequiredVerticalFov(e,t,i){const r=Math.max(e[0]/i,e[1]);return this._yToFov(r,t)}_computeRotation(e){let t=e.lookat.clone().sub(e.position),i=e.up.clone(),r=this._spatial.azimuthal(t.toArray(),i.toArray()),o=Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1]);return{phi:r,theta:o}}_computeVerticalFov(e,t,i,r){const o=e.map(s=>this._computeRequiredVerticalFov(s,i,r));return t===qg.Fill?Math.min(...o)*.995:Math.max(...o)}_yToFov(e,t){return 2*Math.atan(e/Math.pow(2,t))*180/Math.PI}_focalToFov(e){return 2*Math.atan2(1,2*e)*180/Math.PI}_fovToY(e,t){return Math.pow(2,t)*Math.tan(Math.PI*e/360)}_interpolateFov(e,t,i){return i*e+(1-i)*t}_setFrameId(e){this._frameId=e,this._changed&&(this._changed=!1,this._changedForFrame=e)}}class rre{constructor(e,t,i,r){this._subscriptions=new yo,this._element=e,this._currentFrame$=t,this._spatial=new vo,i=i??qg.Fill,this._resize$=new ri,this._projectionMatrix$=new ri,this._renderCameraOperation$=new ri,this._size$=new Eh({height:this._element.offsetHeight,width:this._element.offsetWidth});const o=this._subscriptions;o.push(this._resize$.pipe(We(()=>({height:this._element.offsetHeight,width:this._element.offsetWidth}))).subscribe(this._size$)),this._renderMode$=new Eh(i),this._renderCameraHolder$=this._renderCameraOperation$.pipe(An(c=>c),Vr((c,s)=>s(c),r??new nre(this._element.offsetWidth,this._element.offsetHeight,i)),Pi(1),gi()),this._renderCameraFrame$=this._currentFrame$.pipe(Ui(this._renderCameraHolder$),Dr(([c,s])=>{s.setFrame(c)}),We(c=>c[1]),Pi(1),gi()),this._renderCamera$=this._renderCameraFrame$.pipe(oi(c=>c.changed),Pi(1),gi()),this._bearing$=this._renderCamera$.pipe(We(c=>{let s=this._spatial.radToDeg(this._spatial.azimuthalToBearing(c.rotation.phi));return this._spatial.wrap(s,0,360)}),Pi(1),gi()),o.push(this._size$.pipe(Ys(1),We(c=>s=>(s.setSize(c),s))).subscribe(this._renderCameraOperation$)),o.push(this._renderMode$.pipe(Ys(1),We(c=>s=>(s.setRenderMode(c),s))).subscribe(this._renderCameraOperation$)),o.push(this._projectionMatrix$.pipe(We(c=>s=>(s.setProjectionMatrix(c),s))).subscribe(this._renderCameraOperation$)),o.push(this._bearing$.subscribe(()=>{})),o.push(this._renderCameraHolder$.subscribe(()=>{})),o.push(this._size$.subscribe(()=>{})),o.push(this._renderMode$.subscribe(()=>{})),o.push(this._renderCamera$.subscribe(()=>{})),o.push(this._renderCameraFrame$.subscribe(()=>{}))}get bearing$(){return this._bearing$}get element(){return this._element}get projectionMatrix$(){return this._projectionMatrix$}get renderCamera$(){return this._renderCamera$}get renderCameraFrame$(){return this._renderCameraFrame$}get renderMode$(){return this._renderMode$}get resize$(){return this._resize$}get size$(){return this._size$}dispose(){this._subscriptions.unsubscribe()}}class sre{constructor(e){this._keyDown$=Tr(e,"keydown"),this._keyUp$=Tr(e,"keyup")}get keyDown$(){return this._keyDown$}get keyUp$(){return this._keyUp$}}const ug=0,$v=2,ore={[ug]:1,[$v]:2};class are{constructor(e,t,i,r){this._subscriptions=new yo;const o=this._subscriptions;this._activeSubject$=new Eh(!1),this._active$=this._activeSubject$.pipe(yi(),Pi(1),gi()),this._claimMouse$=new ri,this._claimWheel$=new ri,this._deferPixelClaims$=new ri,this._deferPixels$=this._deferPixelClaims$.pipe(Vr((_,x)=>(x.deferPixels==null?delete _[x.name]:_[x.name]=x.deferPixels,_),{}),We(_=>{let x=-1;for(const b in _){if(!_.hasOwnProperty(b))continue;const M=_[b];M>x&&(x=M)}return x}),An(-1),Pi(1),gi()),o.push(this._deferPixels$.subscribe(()=>{})),this._documentMouseMove$=Tr(r,"pointermove").pipe(oi(this._isMousePen)),this._documentMouseUp$=Tr(r,"pointerup").pipe(oi(this._isMousePen)),this._mouseDown$=Tr(t,"pointerdown").pipe(oi(this._isMousePen)),this._mouseEnter$=Tr(t,"pointerenter").pipe(oi(this._isMousePen)),this._mouseLeave$=Tr(t,"pointerleave").pipe(oi(this._isMousePen)),this._mouseMove$=Tr(t,"pointermove").pipe(oi(this._isMousePen)),this._mouseUp$=Tr(t,"pointerup").pipe(oi(this._isMousePen)),this._mouseOut$=Tr(t,"pointerout").pipe(oi(this._isMousePen)),this._mouseOver$=Tr(t,"pointerover").pipe(oi(this._isMousePen)),this._domMouseDown$=Tr(i,"pointerdown").pipe(oi(this._isMousePen)),this._domMouseMove$=Tr(i,"pointermove").pipe(oi(this._isMousePen)),this._click$=Tr(t,"click"),this._contextMenu$=Tr(t,"contextmenu"),this._windowBlur$=Tr(window,"blur"),this._dblClick$=fn(Tr(e,"click"),Tr(t,"dblclick")).pipe(Kx(3,1),oi(_=>{const x=_[0],b=_[1],M=_[2];return x.type==="click"&&b.type==="click"&&M.type==="dblclick"&&x.target.parentNode===t&&b.target.parentNode===t}),We(_=>_[2]),dn()),o.push(fn(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe(_=>{_.preventDefault()})),this._mouseWheel$=fn(Tr(t,"wheel"),Tr(i,"wheel")).pipe(dn()),this._consistentContextMenu$=fn(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(Kx(3,1),oi(_=>_[0].type==="pointerdown"&&_[1].type==="contextmenu"&&_[2].type==="pointerup"),We(_=>_[1]),dn());const c=fn(this._windowBlur$,this._documentMouseMove$.pipe(oi(_=>this._buttonReleased(_,ug))),this._documentMouseUp$.pipe(oi(_=>this._mouseButton(_)===ug))).pipe(dn()),s=this._createMouseDragInitiate$(ug,this._mouseDown$,c,!0).pipe(dn());this._mouseDragStart$=this._createMouseDragStart$(s).pipe(dn()),this._mouseDrag$=this._createMouseDrag$(s,c).pipe(dn()),this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,c).pipe(dn());const f=this._createMouseDragInitiate$(ug,this._domMouseDown$,c,!1).pipe(dn());this._domMouseDragStart$=this._createMouseDragStart$(f).pipe(dn()),this._domMouseDrag$=this._createMouseDrag$(f,c).pipe(dn()),this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,c).pipe(dn());const p=fn(this._windowBlur$,this._documentMouseMove$.pipe(oi(_=>this._buttonReleased(_,$v))),this._documentMouseUp$.pipe(oi(_=>this._mouseButton(_)===$v))).pipe(dn()),g=this._createMouseDragInitiate$($v,this._mouseDown$,p,!0).pipe(dn());this._mouseRightDragStart$=this._createMouseDragStart$(g).pipe(dn()),this._mouseRightDrag$=this._createMouseDrag$(g,p).pipe(dn()),this._mouseRightDragEnd$=this._createMouseDragEnd$(this._mouseRightDragStart$,p).pipe(dn()),this._proximateClick$=this._mouseDown$.pipe(ei(_=>this._click$.pipe(Sd(this._createDeferredMouseMove$(_,this._documentMouseMove$)),zl(1))),dn()),this._staticClick$=this._mouseDown$.pipe(ei(()=>this._click$.pipe(Sd(this._documentMouseMove$),zl(1))),dn()),o.push(this._mouseDragStart$.subscribe()),o.push(this._mouseDrag$.subscribe()),o.push(this._mouseDragEnd$.subscribe()),o.push(this._domMouseDragStart$.subscribe()),o.push(this._domMouseDrag$.subscribe()),o.push(this._domMouseDragEnd$.subscribe()),o.push(this._mouseRightDragStart$.subscribe()),o.push(this._mouseRightDrag$.subscribe()),o.push(this._mouseRightDragEnd$.subscribe()),o.push(this._staticClick$.subscribe()),this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(Pi(1),gi()),this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(Pi(1),gi()),o.push(this._mouseOwner$.subscribe(()=>{})),o.push(this._wheelOwner$.subscribe(()=>{}))}get active$(){return this._active$}get activate$(){return this._activeSubject$}get documentMouseMove$(){return this._documentMouseMove$}get documentMouseUp$(){return this._documentMouseUp$}get domMouseDragStart$(){return this._domMouseDragStart$}get domMouseDrag$(){return this._domMouseDrag$}get domMouseDragEnd$(){return this._domMouseDragEnd$}get domMouseDown$(){return this._domMouseDown$}get domMouseMove$(){return this._domMouseMove$}get mouseOwner$(){return this._mouseOwner$}get mouseDown$(){return this._mouseDown$}get mouseEnter$(){return this._mouseEnter$}get mouseMove$(){return this._mouseMove$}get mouseLeave$(){return this._mouseLeave$}get mouseOut$(){return this._mouseOut$}get mouseOver$(){return this._mouseOver$}get mouseUp$(){return this._mouseUp$}get click$(){return this._click$}get dblClick$(){return this._dblClick$}get contextMenu$(){return this._consistentContextMenu$}get mouseWheel$(){return this._mouseWheel$}get mouseDragStart$(){return this._mouseDragStart$}get mouseDrag$(){return this._mouseDrag$}get mouseDragEnd$(){return this._mouseDragEnd$}get mouseRightDragStart$(){return this._mouseRightDragStart$}get mouseRightDrag$(){return this._mouseRightDrag$}get mouseRightDragEnd$(){return this._mouseRightDragEnd$}get proximateClick$(){return this._proximateClick$}get staticClick$(){return this._staticClick$}get windowBlur$(){return this._windowBlur$}dispose(){this._subscriptions.unsubscribe()}claimMouse(e,t){this._claimMouse$.next({name:e,zindex:t})}unclaimMouse(e){this._claimMouse$.next({name:e,zindex:null})}deferPixels(e,t){this._deferPixelClaims$.next({name:e,deferPixels:t})}undeferPixels(e){this._deferPixelClaims$.next({name:e,deferPixels:null})}claimWheel(e,t){this._claimWheel$.next({name:e,zindex:t})}unclaimWheel(e){this._claimWheel$.next({name:e,zindex:null})}filtered$(e,t){return this._filtered(e,t,this._mouseOwner$)}filteredWheel$(e,t){return this._filtered(e,t,this._wheelOwner$)}_createDeferredMouseMove$(e,t){return t.pipe(We(i=>{const r=i.clientX-e.clientX,o=i.clientY-e.clientY;return[i,Math.sqrt(r*r+o*o)]}),Ui(this._deferPixels$),oi(([[,i],r])=>i>r),We(([[i]])=>i))}_createMouseDrag$(e,t){return e.pipe(We(([,i])=>i),ei(i=>Nl(Ai(i),this._documentMouseMove$).pipe(Sd(t))))}_createMouseDragEnd$(e,t){return e.pipe(ei(()=>t.pipe(wi())))}_createMouseDragStart$(e){return e.pipe(We(([t])=>t))}_createMouseDragInitiate$(e,t,i,r){return t.pipe(oi(o=>this._mouseButton(o)===e),ei(o=>Si(Ai(o),r?this._createDeferredMouseMove$(o,this._documentMouseMove$):this._documentMouseMove$).pipe(Sd(i),zl(1))))}_createOwner$(e){return e.pipe(Vr((t,i)=>(i.zindex==null?delete t[i.name]:t[i.name]=i.zindex,t),{}),We(t=>{let i=null,r=-1;for(const o in t)t.hasOwnProperty(o)&&t[o]>r&&(r=t[o],i=o);return i}),An(null))}_filtered(e,t,i){return t.pipe(Ui(i),oi(([,r])=>r===e),We(([r])=>r))}_mouseButton(e){const t=e.type==="pointerdown"||e.type==="pointerup",i=window.InstallTrigger;return t&&typeof i<"u"&&e.button===$v&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?ug:e.button}_buttonReleased(e,t){const i=ore[t];return e.buttons===void 0||(e.buttons&i)!==i}_isMousePen(e){const t=e.pointerType;return t==="mouse"||t==="pen"}}class lre{set json(e){this._json=e}set image(e){this._image=e,this._texture=new zs(this._image),this._texture.minFilter=Ws}get loaded(){return!!(this._image&&this._json)}getGLSprite(e){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");let t=this._json[e];if(!t)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),new Rn;let i=this._texture.clone();i.needsUpdate=!0;let r=this._image.width,o=this._image.height;i.offset.x=t.x/r,i.offset.y=(o-t.y-t.height)/o,i.repeat.x=t.width/r,i.repeat.y=t.height/o;let c=new V2({map:i});return new zF(c)}getDOMSprite(e,t){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");t==null&&(t=ss.Center);let i=this._json[e];if(!i)return console.warn("Sprite with key"+e+"does not exist in sprite definition."),jt.h("div",{},[]);let r=i.y,o=i.x+i.width,c=i.y+i.height,s=i.x,f=-i.x,p=-i.y,g=this._image.height,_=this._image.width;switch(t){case ss.Bottom:case ss.Center:case ss.Top:f-=i.width/2;break;case ss.BottomLeft:case ss.Left:case ss.TopLeft:f-=i.width;break;case ss.BottomRight:case ss.Right:case ss.TopRight:}switch(t){case ss.Center:case ss.Left:case ss.Right:p-=i.height/2;break;case ss.Top:case ss.TopLeft:case ss.TopRight:p-=i.height;break;case ss.Bottom:case ss.BottomLeft:case ss.BottomRight:}let x=1/i.pixelRatio;r*=x,o*=x,c*=x,s*=x,f*=x,p*=x,g*=x,_*=x;let b={src:this._image.src,style:{clip:`rect(${r}px, ${o}px, ${c}px, ${s}px)`,height:`${g}px`,left:`${f}px`,position:"absolute",top:`${p}px`,width:`${_}px`}};return jt.h("img",b,[])}}class cre{constructor(e){if(this._retina=window.devicePixelRatio>1,this._spriteAtlasOperation$=new ri,this._spriteAtlas$=this._spriteAtlasOperation$.pipe(An(o=>o),Vr((o,c)=>c(o),new lre),Pi(1),gi()),this._atlasSubscription=this._spriteAtlas$.subscribe(()=>{}),e==null)return;let t=this._retina?"@2x":"",i=new XMLHttpRequest;i.open("GET",e+t+".png",!0),i.responseType="arraybuffer",i.onload=()=>{let o=new Image;o.onload=()=>{this._spriteAtlasOperation$.next(s=>(s.image=o,s))};let c=new Blob([i.response]);o.src=window.URL.createObjectURL(c)},i.onerror=o=>{console.error(new Error(`Failed to fetch sprite sheet (${e}${t}.png)`))},i.send();let r=new XMLHttpRequest;r.open("GET",e+t+".json",!0),r.responseType="text",r.onload=()=>{let o=JSON.parse(r.response);this._spriteAtlasOperation$.next(c=>(c.json=o,c))},r.onerror=o=>{console.error(new Error(`Failed to fetch sheet (${e}${t}.json)`))},r.send()}get spriteAtlas$(){return this._spriteAtlas$}dispose(){this._atlasSubscription.unsubscribe()}}class ure{constructor(e,t){this._subscriptions=new yo;const i=this._subscriptions;this._activeSubject$=new Eh(!1),this._active$=this._activeSubject$.pipe(yi(),Pi(1),gi()),i.push(Tr(t,"touchmove").subscribe(g=>{g.preventDefault()})),this._touchStart$=Tr(e,"touchstart"),this._touchMove$=Tr(e,"touchmove"),this._touchEnd$=Tr(e,"touchend"),this._touchCancel$=Tr(e,"touchcancel");const r=this._touchStart$.pipe(oi(g=>g.touches.length===1&&g.targetTouches.length===1),dn());this._doubleTap$=r.pipe(FG(()=>r.pipe(wi(),ei(()=>fn(L2(300),r).pipe(zl(1))))),oi(g=>g.length===2),We(g=>g[g.length-1]),dn()),i.push(this._doubleTap$.subscribe(g=>{g.preventDefault()})),this._singleTouchMove$=this._touchMove$.pipe(oi(g=>g.touches.length===1&&g.targetTouches.length===1),dn());let o=fn(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(oi(g=>g.touches.length===1&&g.targetTouches.length===1)),c=fn(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(oi(g=>g.touches.length>=1)),s=fn(this._touchEnd$,this._touchCancel$).pipe(oi(g=>g.touches.length===0));this._singleTouchDragStart$=o.pipe(Wi(()=>this._singleTouchMove$.pipe(Sd(fn(s,c)),zl(1)))),this._singleTouchDragEnd$=o.pipe(Wi(()=>fn(s,c).pipe(wi()))),this._singleTouchDrag$=o.pipe(ei(()=>this._singleTouchMove$.pipe(Ys(1),Sd(fn(c,s)))));let f=fn(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=f.pipe(oi(g=>g.touches.length===2&&g.targetTouches.length===2)),this._pinchEnd$=f.pipe(oi(g=>g.touches.length!==2||g.targetTouches.length!==2)),this._pinchOperation$=new ri,this._pinch$=this._pinchOperation$.pipe(Vr((g,_)=>_(g),{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null}));const p=this._touchMove$.pipe(oi(g=>g.touches.length===2&&g.targetTouches.length===2),We(g=>_=>{let x=g.touches[0],b=g.touches[1],M=Math.min(x.clientX,b.clientX),P=Math.max(x.clientX,b.clientX),k=Math.min(x.clientY,b.clientY),L=Math.max(x.clientY,b.clientY),I=M+(P-M)/2,F=k+(L-k)/2,N=I+x.pageX-x.clientX,H=F+x.pageY-x.clientY,Y=I+x.screenX-x.clientX,q=F+x.screenY-x.clientY,U=Math.abs(x.clientX-b.clientX),G=Math.abs(x.clientY-b.clientY),j=Math.sqrt(U*U+G*G),B=j-_.distance,ne=U-_.distanceX,J=G-_.distanceY;return{changeX:ne,changeY:J,clientX:I,clientY:F,distance:j,distanceChange:B,distanceX:U,distanceY:G,originalEvent:g,pageX:N,pageY:H,screenX:Y,screenY:q,touch1:x,touch2:b}})).subscribe(this._pinchOperation$);i.push(p),this._pinchChange$=this._pinchStart$.pipe(ei(()=>this._pinch$.pipe(Ys(1),Sd(this._pinchEnd$))))}get active$(){return this._active$}get activate$(){return this._activeSubject$}get doubleTap$(){return this._doubleTap$}get touchStart$(){return this._touchStart$}get touchMove$(){return this._touchMove$}get touchEnd$(){return this._touchEnd$}get touchCancel$(){return this._touchCancel$}get singleTouchDragStart$(){return this._singleTouchDragStart$}get singleTouchDrag$(){return this._singleTouchDrag$}get singleTouchDragEnd$(){return this._singleTouchDragEnd$}get pinch$(){return this._pinchChange$}get pinchStart$(){return this._pinchStart$}get pinchEnd$(){return this._pinchEnd$}dispose(){this._subscriptions.unsubscribe()}}class hre{constructor(e){var t,i,r,o;const c=(i=(t=e?.url)===null||t===void 0?void 0:t.exploreHost)!==null&&i!==void 0?i:"www.mapillary.com",f=`${(o=(r=e?.url)===null||r===void 0?void 0:r.scheme)!==null&&o!==void 0?o:"https"}://${c}`;this._exploreUrl$=Ai(f);const p=e?.imageTiling!==!1;this._imageTiling$=Ai(p)}get exploreUrl$(){return this._exploreUrl$}get imageTiling$(){return this._imageTiling$}}class dre{constructor(e,t,i){var r;if(this._onWindowResize=()=>{this._trackResize&&this.renderService.resize$.next()},this._dom=i??new uC,typeof e.container=="string"){if(this._container=this._dom.document.getElementById(e.container),!this._container)throw new Error(`Container "${e.container}" not found.`)}else if(e.container instanceof HTMLElement)this._container=e.container;else throw new Error('Invalid type: "container" must be a String or HTMLElement.');this._trackResize=e.trackResize!==!1,this.id=(r=this._container.id)!==null&&r!==void 0?r:"mapillary-fallback-container-id",this._container.classList.add("mapillary-viewer"),this._canvasContainer=this._dom.createElement("div","mapillary-interactive",this._container),this._canvas=this._dom.createElement("canvas","mapillary-canvas"),this._canvas.style.position="absolute",this._canvas.setAttribute("tabindex","0"),this._domContainer=this._dom.createElement("div","mapillary-dom",this._container),this.configurationService=new hre(e),this.renderService=new rre(this._container,t.currentState$,e.renderMode),this.glRenderer=new ire(this._canvas,this._canvasContainer,this.renderService),this.domRenderer=new tre(this._domContainer,this.renderService,t.currentState$),this.keyboardService=new sre(this._canvasContainer),this.mouseService=new are(this._container,this._canvasContainer,this._domContainer,document),this.touchService=new ure(this._canvasContainer,this._domContainer),this.spriteService=new cre(e.sprite),window.addEventListener("resize",this._onWindowResize,!1)}get canvas(){return this._canvas.parentNode?this._canvas:null}get canvasContainer(){return this._canvasContainer}get container(){return this._container}get domContainer(){return this._domContainer}remove(){window.removeEventListener("resize",this._onWindowResize,!1),this.spriteService.dispose(),this.touchService.dispose(),this.mouseService.dispose(),this.glRenderer.remove(),this.domRenderer.remove(),this.renderService.dispose(),this._removeNode(this._canvasContainer),this._removeNode(this._domContainer),this._container.classList.remove("mapillary-viewer")}_removeNode(e){e.parentNode&&e.parentNode.removeChild(e)}}class fre{constructor(e,t,i){this._graphService=e,this._stateService=t,this._api=i,this._subscriptions=new yo,this._started=!1,this._cellDepth=1}get started(){return this._started}configure(e){if(!e){this._cellDepth=1;return}this._cellDepth=Math.max(1,Math.min(3,e.cellDepth))}start(){if(this._started)return;const e=this._subscriptions;e.push(this._stateService.currentState$.pipe(yi(void 0,t=>t.state.currentImage.id),We(t=>{const i=t.state,r=i.trajectory,o=r.map(s=>s.id),c=r[r.length-1].sequenceId;return[o,i.currentImage.originalLngLat,c]}),Kx(1,5),Ui(this._graphService.graphMode$),ei(([t,i])=>{const r=t[0][0],o=t[0][1],c=this._api.data.geometry,s=c.lngLatToCellId(o),f=AM(s,this._cellDepth,c),p=i===na.Sequence?t[0][2]:void 0;return this._graphService.uncache$(r,f,p)})).subscribe(()=>{})),e.push(this._graphService.graphMode$.pipe(Ys(1),Ui(this._stateService.currentState$),ei(([t,i])=>t===na.Sequence?this._keyToEdges(i.state.currentImage.id,r=>r.sequenceEdges$):Fr(i.state.trajectory.map(r=>r.id).slice(i.state.currentIndex)).pipe(Wi(r=>this._keyToEdges(r,o=>o.spatialEdges$),6)))).subscribe(()=>{})),e.push(this._graphService.dataAdded$.pipe(Ui(this._stateService.currentId$),ei(([t,i])=>this._graphService.cacheImage$(i))).subscribe(()=>{})),this._started=!0}stop(){this._started&&(this._subscriptions.unsubscribe(),this._started=!1)}_keyToEdges(e,t){return this._graphService.cacheImage$(e).pipe(ei(t),wi(i=>i.cached),aM(15e3),Nn(i=>(console.error(`Failed to cache edges (${e}).`,i),zi())))}}class pre{constructor(){this._loadersSubject$=new ri,this._loaders$=this._loadersSubject$.pipe(Vr((e,t)=>(t.task!==void 0&&(e[t.task]=t.loading),e),{}),An({}),Pi(1),gi())}get loading$(){return this._loaders$.pipe(We(e=>{for(const t in e)if(e.hasOwnProperty(t)&&e[t])return!0;return!1}),wy(100),yi())}taskLoading$(e){return this._loaders$.pipe(We(t=>!!t[e]),wy(100),yi())}startLoading(e){this._loadersSubject$.next({loading:!0,task:e})}stopLoading(e){this._loadersSubject$.next({loading:!1,task:e})}}var Al;(function(n){n[n.Disabled=0]="Disabled",n[n.Enabled=1]="Enabled",n[n.Started=2]="Started"})(Al||(Al={}));class mre{constructor(e,t,i,r,o,c){this._subscriptions=new yo,this._graphService=e,this._stateService=t,this._graphCalculator=r??new Q2,this._spatial=o??new vo,this._viewportCoords=c??new zo,this._mode=i!==!1?Al.Enabled:Al.Disabled,this._panImagesSubject$=new ri,this._panImages$=this._panImagesSubject$.pipe(An([]),Pi(1),gi()),this._subscriptions.push(this._panImages$.subscribe())}get panImages$(){return this._panImages$}dispose(){this.stop(),this._panImagesSubscription!=null&&this._panImagesSubscription.unsubscribe(),this._subscriptions.unsubscribe()}enable(){this._mode===Al.Disabled&&(this._mode=Al.Enabled,this.start())}disable(){this._mode!==Al.Disabled&&(this.stop(),this._mode=Al.Disabled)}start(){if(this._mode!==Al.Enabled)return;const e=this._stateService.currentImage$.pipe(ei(t=>{if(!t.merged||ki(t.cameraType))return Ai([]);const i=Ai(t),r=this._graphCalculator.boundingBoxCorners(t.lngLat,20),o=this._graphService.cacheBoundingBox$(r[0],r[1]).pipe(Nn(c=>(console.error(`Failed to cache periphery bounding box (${t.id})`,c),zi())),We(c=>{if(ki(t.cameraType))return[];const s=[];for(const f of c)f.id!==t.id&&f.mergeId===t.mergeId&&(ki(f.cameraType)||this._distance(f,t)>4||s.push(f));return s}));return Si(i,o).pipe(Ui(this._stateService.reference$),We(([[c,s],f])=>{const p=this._spatial.viewingDirection(c.rotation),g=aw({lat:c.lngLat.lat,lng:c.lngLat.lng,alt:c.computedAltitude},c.rotation,f),_=this._createTransform(c,g),x=this._spatial.wrap(this._spatial.azimuthal(p.toArray(),_.upVector().toArray()),0,2*Math.PI),b=this._computeProjectedPoints(_),M=this._computeHorizontalFov(b)/180*Math.PI,P=Math.PI/8;let k,L;for(const F of s){const N=aw({lat:F.lngLat.lat,lng:F.lngLat.lng,alt:F.computedAltitude},F.rotation,f),H=this._createTransform(F,N),Y=this._computeProjectedPoints(H),q=this._computeHorizontalFov(Y)/180*Math.PI,U=this._spatial.viewingDirection(F.rotation),G=this._spatial.wrap(this._spatial.azimuthal(U.toArray(),H.upVector().toArray()),0,2*Math.PI),j=this._spatial.angleBetweenVector2(p.x,p.y,U.x,U.y);let B=Number.NEGATIVE_INFINITY;j>0?x>G?B=x-2*Math.PI+M/2-(G-q/2):B=x+M/2-(G-q/2):x<G?B=G+q/2-(x+2*Math.PI-M/2):B=G+q/2-(x-M/2);const ne=Math.abs(q-B),J=this._distance(F,c),le=Math.min(this._timeDifference(F,c),4),ae=20*Math.abs(B-P),pe=Math.min(5,1/Math.min(q/M,1)),fe=B>0?-2*ne:0,Te=J+le+ae+pe+fe;B>0&&B<.5*M&&B<.5*q&&ne>.5*M&&(j>0?k?Te<k[0]&&(k=[Te,F,H,q]):k=[Te,F,H,q]:L?Te<L[0]&&(L=[Te,F,H,q]):L=[Te,F,H,q])}const I=[];return k&&I.push([k[1],k[2],k[3]]),L&&I.push([L[1],L[2],L[3]]),I}),An([]))}));this._panImagesSubscription=this._stateService.currentState$.pipe(We(t=>t.state.imagesAhead>0),yi(),ei(t=>t?Ai([]):e)).subscribe(t=>{this._panImagesSubject$.next(t)}),this._mode=Al.Started}stop(){this._mode===Al.Started&&(this._panImagesSubscription.unsubscribe(),this._panImagesSubject$.next([]),this._mode=Al.Enabled)}_distance(e,t){const[i,r,o]=ta(e.lngLat.lng,e.lngLat.lat,e.computedAltitude,t.lngLat.lng,t.lngLat.lat,t.computedAltitude);return Math.sqrt(i*i+r*r+o*o)}_timeDifference(e,t){return Math.abs(e.capturedAt-t.capturedAt)/2592e6}_createTransform(e,t){return new Cg(e.exifOrientation,e.width,e.height,e.scale,e.rotation,t,e.assetsCached?e.image:void 0,void 0,e.cameraParameters,e.cameraType)}_computeProjectedPoints(e){return eC(e,[[1,0]],[[0,.5]],20,this._viewportCoords)}_computeHorizontalFov(e){const t=e.map(r=>this._coordToFov(r[0]));return Math.min(...t)}_coordToFov(e){return 2*Math.atan(e)*180/Math.PI}}class ZL{constructor(e){this._data=e}get data(){return this._data}getCoreImages$(e){return this._wrap$(this._data.getCoreImages(e))}getImages$(e){return this._wrap$(this._data.getImages(e))}getImageTiles$(e){return this._wrap$(this._data.getImageTiles(e))}getSequence$(e){return this._wrap$(this._data.getSequence(e))}getSpatialImages$(e){return this._wrap$(this._data.getSpatialImages(e))}setAccessToken(e){this._data.setAccessToken(e)}_wrap$(e){return gr.create(t=>{e.then(i=>{t.next(i),t.complete()},i=>{t.error(i)})})}}class gre{constructor(e){this._dataAdded$=new ri,this._subscriptions=new yo,this._onDataAdded=i=>{this._graph$.pipe(wi(),Wi(r=>r.updateCells$(i.cellIds).pipe(Dr(()=>{r.resetSpatialEdges()})))).subscribe(r=>{this._dataAdded$.next(r)})};const t=this._subscriptions;this._graph$=Nl(Ai(e),e.changed$).pipe(Pi(1),gi()),t.push(this._graph$.subscribe(()=>{})),this._graphMode=na.Spatial,this._graphModeSubject$=new ri,this._graphMode$=this._graphModeSubject$.pipe(An(this._graphMode),Pi(1),gi()),t.push(this._graphMode$.subscribe(()=>{})),this._firstGraphSubjects$=[],this._initializeCacheSubscriptions=[],this._sequenceSubscriptions=[],this._spatialSubscriptions=[],e.api.data.on("datacreate",this._onDataAdded)}get dataAdded$(){return this._dataAdded$}get filter$(){return this._graph$.pipe(wi(),Wi(e=>e.filter$))}get graphMode$(){return this._graphMode$}cacheBoundingBox$(e,t){return this._graph$.pipe(wi(),Wi(i=>i.cacheBoundingBox$(e,t)))}cacheCell$(e){return this._graph$.pipe(wi(),Wi(t=>t.cacheCell$(e)))}cacheImage$(e){const t=new ri;this._firstGraphSubjects$.push(t);const i=t.pipe(Pi(1),gi()),r=i.pipe(We(f=>f.getNode(e)),Wi(f=>f.assetsCached?Ai(f):f.cacheAssets$()),Pi(1),gi());r.subscribe(void 0,f=>{console.error(`Failed to cache image (${e}).`,f)});let o;o=this._graph$.pipe(wi(),Wi(f=>f.isCachingFull(e)||!f.hasNode(e)?f.cacheFull$(e):f.isCachingFill(e)||!f.getNode(e).complete?f.cacheFill$(e):Ai(f)),Dr(f=>{if(!f.hasNode(e))throw new ar(`Failed to cache image (${e})`);f.hasInitializedCache(e)||f.initializeCache(e)}),ma(()=>{o!=null&&(this._removeFromArray(o,this._initializeCacheSubscriptions),this._removeFromArray(t,this._firstGraphSubjects$))})).subscribe(f=>{t.next(f),t.complete()},f=>{t.error(f)}),o.closed||this._initializeCacheSubscriptions.push(o);const c=i.pipe(Nn(()=>zi()),Wi(f=>f.isCachingNodeSequence(e)||!f.hasNodeSequence(e)?f.cacheNodeSequence$(e):Ai(f)),Pi(1),gi());let s;if(s=c.pipe(Dr(f=>{f.getNode(e).sequenceEdges.cached||f.cacheSequenceEdges(e)}),ma(()=>{s!=null&&this._removeFromArray(s,this._sequenceSubscriptions)})).subscribe(()=>{},f=>{console.error(`Failed to cache sequence edges (${e}).`,f)}),s.closed||this._sequenceSubscriptions.push(s),this._graphMode===na.Spatial){let f;f=i.pipe(Nn(()=>zi()),eF(p=>p.hasTiles(e)?zi():Fr(p.cacheTiles$(e)).pipe(Wi(g=>g.pipe(Wi(_=>_.isCachingTiles(e)?zi():Ai(_)),Nn(_=>(console.error(`Failed to cache tile data (${e}).`,_),zi())))))),lM(1),Wi(p=>p.hasSpatialArea(e)?Ai(p):Fr(p.cacheSpatialArea$(e)).pipe(Wi(g=>g.pipe(Nn(_=>(console.error(`Failed to cache spatial images (${e}).`,_),zi())))))),lM(1),Wi(p=>p.hasNodeSequence(e)?Ai(p):p.cacheNodeSequence$(e)),Dr(p=>{p.getNode(e).spatialEdges.cached||p.cacheSpatialEdges(e)}),ma(()=>{f!=null&&this._removeFromArray(f,this._spatialSubscriptions)})).subscribe(()=>{},p=>{const g=`Failed to cache spatial edges (${e}).`;console.error(g,p)}),f.closed||this._spatialSubscriptions.push(f)}return r.pipe(wi(f=>f.assetsCached))}cacheSequence$(e){return this._graph$.pipe(wi(),Wi(t=>t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):Ai(t)),We(t=>t.getSequence(e)))}cacheSequenceImages$(e,t){return this._graph$.pipe(wi(),Wi(i=>i.isCachingSequence(e)||!i.hasSequence(e)?i.cacheSequence$(e):Ai(i)),Wi(i=>i.isCachingSequenceNodes(e)||!i.hasSequenceNodes(e)?i.cacheSequenceNodes$(e,t):Ai(i)),We(i=>i.getSequence(e)))}dispose(){this._graph$.pipe(wi()).subscribe(e=>{e.unsubscribe()}),this._subscriptions.unsubscribe()}setFilter$(e){return this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(wi(),Dr(t=>{t.resetSpatialEdges(),t.setFilter(e)}),We(()=>{}))}setGraphMode(e){this._graphMode!==e&&(e===na.Sequence&&this._resetSubscriptions(this._spatialSubscriptions),this._graphMode=e,this._graphModeSubject$.next(this._graphMode))}reset$(e){return this._abortSubjects(this._firstGraphSubjects$),this._resetSubscriptions(this._initializeCacheSubscriptions),this._resetSubscriptions(this._sequenceSubscriptions),this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(wi(),Dr(t=>{t.reset(e)}),We(()=>{}))}uncache$(e,t,i){return this._graph$.pipe(wi(),Dr(r=>{r.uncache(e,t,i)}),We(()=>{}))}_abortSubjects(e){for(const t of e.slice())this._removeFromArray(t,e),t.error(new Error("Cache image request was aborted."))}_removeFromArray(e,t){const i=t.indexOf(e);i!==-1&&t.splice(i,1)}_resetSubscriptions(e){for(const t of e.slice())this._removeFromArray(t,e),t.closed||t.unsubscribe()}}class _re{constructor(e){e.requestAnimationFrame?(this._cancelAnimationFrame=e.cancelAnimationFrame.bind(e),this._requestAnimationFrame=e.requestAnimationFrame.bind(e)):e.mozRequestAnimationFrame?(this._cancelAnimationFrame=e.mozCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.mozRequestAnimationFrame.bind(e)):e.webkitRequestAnimationFrame?(this._cancelAnimationFrame=e.webkitCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.webkitRequestAnimationFrame.bind(e)):e.msRequestAnimationFrame?(this._cancelAnimationFrame=e.msCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.msRequestAnimationFrame.bind(e)):e.oRequestAnimationFrame?(this._cancelAnimationFrame=e.oCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.oRequestAnimationFrame.bind(e)):(this._cancelAnimationFrame=e.clearTimeout.bind(e),this._requestAnimationFrame=t=>e.setTimeout(t,1e3/60))}get cancelAnimationFrame(){return this._cancelAnimationFrame}get requestAnimationFrame(){return this._requestAnimationFrame}}class Qw{constructor(e){this._spatial=new vo,this._referenceThreshold=.01,this._transitionMode=e.transitionMode,this._reference=e.reference,this._alpha=e.alpha,this._stateTransitionAlpha=0,this._camera=e.camera.clone(),this._zoom=e.zoom,this._currentIndex=e.currentIndex,this._trajectory=e.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];for(let t of this._trajectory){let i=this._imageToTranslation(t,this._reference),r=new Cg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,i,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.push(r),this._trajectoryCameras.push(new Td(r))}this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null,this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new Td,this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}get reference(){return this._reference}get alpha(){return this._getAlpha()}get stateTransitionAlpha(){return this._getStateTransitionAlpha()}get camera(){return this._camera}get zoom(){return this._zoom}get trajectory(){return this._trajectory}get currentIndex(){return this._currentIndex}get currentImage(){return this._currentImage}get previousImage(){return this._previousImage}get currentCamera(){return this._currentCamera}get currentTransform(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null}get previousTransform(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null}get motionless(){return this._motionless}get transitionMode(){return this._transitionMode}move(e){}moveTo(e){}rotate(e){}rotateUnbounded(e){}rotateWithoutInertia(e){}rotateBasic(e){}rotateBasicUnbounded(e){}rotateBasicWithoutInertia(e){}rotateToBasic(e){}setSpeed(e){}zoomIn(e,t){}update(e){}setCenter(e){}setZoom(e){}dolly(e){}orbit(e){}setViewMatrix(e){}truck(e){}append(e){if(e.length<1)throw Error("Trajectory can not be empty");this._currentIndex<0?this.set(e):(this._trajectory=this._trajectory.concat(e),this._appendToTrajectories(e))}prepend(e){if(e.length<1)throw Error("Trajectory can not be empty");this._trajectory=e.slice().concat(this._trajectory),this._currentIndex+=e.length,this._setCurrentImage(),this._setReference(this._currentImage)?this._setTrajectories():this._prependToTrajectories(e),this._setCurrentCamera()}remove(e){if(e<0)throw Error("n must be a positive integer");if(this._currentIndex-1<e)throw Error("Current and previous images can not be removed");for(let t=0;t<e;t++)this._trajectory.shift(),this._trajectoryTransforms.shift(),this._trajectoryCameras.shift(),this._currentIndex--;this._setCurrentImage()}clearPrior(){this._currentIndex>0&&this.remove(this._currentIndex-1)}clear(){this.cut(),this._currentIndex>0&&this.remove(this._currentIndex-1)}cut(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()}set(e){this._setTrajectory(e),this._setCurrentImage(),this._setReference(this._currentImage),this._setTrajectories(),this._setCurrentCamera()}getCenter(){return this._currentImage!=null?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]}setTransitionMode(e){this._transitionMode=e}_getAlpha(){return 1}_getStateTransitionAlpha(){return 1}_setCurrent(){this._setCurrentImage(),this._setReference(this._currentImage)&&this._setTrajectories(),this._setCurrentCamera()}_setCurrentCamera(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}_motionlessTransition(){return this._currentImage!=null&&this._previousImage!=null&&(this._transitionMode===_w.Instantaneous||!(this._currentImage.merged&&this._previousImage.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))}_setReference(e){return Math.abs(e.lngLat.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(e.lngLat.lng-this.reference.lng)<this._referenceThreshold||this._previousImage!=null&&!this._motionlessTransition()?!1:(this._reference.lat=e.lngLat.lat,this._reference.lng=e.lngLat.lng,this._reference.alt=e.computedAltitude,!0)}_setCurrentImage(){this._currentImage=this._trajectory.length>0?this._trajectory[this._currentIndex]:null,this._previousImage=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null}_setTrajectory(e){if(e.length<1)throw new pa("Trajectory can not be empty");this._currentImage!=null?(this._trajectory=[this._currentImage].concat(e),this._currentIndex=1):(this._trajectory=e.slice(),this._currentIndex=0)}_setTrajectories(){this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)}_appendToTrajectories(e){for(let t of e){if(!t.assetsCached)throw new pa("Assets must be cached when image is added to trajectory");let i=this._imageToTranslation(t,this.reference),r=new Cg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,i,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.push(r),this._trajectoryCameras.push(new Td(r))}}_prependToTrajectories(e){for(let t of e.reverse()){if(!t.assetsCached)throw new pa("Assets must be cached when added to trajectory");let i=this._imageToTranslation(t,this.reference),r=new Cg(t.exifOrientation,t.width,t.height,t.scale,t.rotation,i,t.image,void 0,t.cameraParameters,t.cameraType);this._trajectoryTransforms.unshift(r),this._trajectoryCameras.unshift(new Td(r))}}_imageToTranslation(e,t){return aw({alt:e.computedAltitude,lat:e.lngLat.lat,lng:e.lngLat.lng},e.rotation,t)}_sameConnectedComponent(){let e=this._currentImage,t=this._previousImage;return!!e&&!!t&&e.mergeId===t.mergeId}_withinOriginalDistance(){let e=this._currentImage,t=this._previousImage;return!e||!t?!0:this._spatial.distanceFromLngLat(e.originalLngLat.lng,e.originalLngLat.lat,t.originalLngLat.lng,t.originalLngLat.lat)<25}}class XL extends Qw{constructor(e){super(e)}setViewMatrix(e){const i=new Ri().fromArray(e).invert().elements,r=new Fe(i[12],i[13],i[14]),o=new Fe(-i[8],-i[9],-i[10]),c=new Fe(i[4],i[5],i[6]),s=this._camera;s.position.copy(r),s.lookat.copy(r.clone().add(o)),s.up.copy(c);const f=.5/Math.tan(Math.PI/3);s.focal=f}}class YL extends Qw{constructor(e){super(e),this._transition=0;const t=this._camera.position.clone(),i=this._camera.lookat.clone().sub(t).normalize(),r=Math.sqrt(i.x*i.x+i.y*i.y),o=Math.atan2(i.z,r),c=new Fe;if(o>-Math.PI/45)c.copy(t),t.add(new Fe(i.x,i.y,0).multiplyScalar(-50)),t.z=30;else{const F=t.clone(),N=new Fe(0,0,1),H=new Fe(0,0,-2),Y=new Fe().subVectors(H,F).dot(N)/i.dot(N),U=F.clone().add(i.clone().multiplyScalar(Math.min(1e4,Y)));c.copy(U);const G=t.clone().sub(U).normalize();t.copy(U.add(G.multiplyScalar(Math.max(50,G.length()))))}const s=this._camera.position.clone(),f=s.clone().add(i.clone().normalize().multiplyScalar(10)),p=this._camera.up.clone(),g=f.clone(),_=g.clone().add(i.clone().normalize().multiplyScalar(10)),x=p.clone(),b=t.clone(),M=c.clone(),P=new Fe(0,0,1),k=t.clone().add(M.clone().sub(b).normalize().multiplyScalar(-10)),L=M.clone(),I=P.clone();this._curveE=new ry([g,s,b,k]),this._curveL=new ry([_,f,M,L]),this._curveU=new ry([x,p,P,I]),this._zoom0=this._zoom,this._zoom1=0,this._camera.focal=.5/Math.tan(Math.PI/4)}get _isTransitioning(){return this._transition<1}dolly(e){if(this._isTransitioning)return;const t=this._camera,i=t.position.clone().sub(t.lookat),o=i.length()*Math.pow(2,-e),c=Math.max(1,Math.min(o,4e3));i.normalize(),i.multiplyScalar(c),t.position.copy(t.lookat).add(i)}orbit(e){if(this._isTransitioning)return;const t=this._camera,i=new go().setFromUnitVectors(t.up,new Fe(0,0,1)),r=i.clone().invert(),o=t.position.clone().sub(t.lookat);o.applyQuaternion(i);const c=o.length();let s=Math.atan2(o.y,o.x);s+=e.phi;let f=Math.atan2(Math.sqrt(o.x*o.x+o.y*o.y),o.z);f+=e.theta;const p=Math.PI/36;f=Math.max(p,Math.min(Math.PI/2-p,f)),o.x=Math.sin(f)*Math.cos(s),o.y=Math.sin(f)*Math.sin(s),o.z=Math.cos(f),o.applyQuaternion(r),t.position.copy(t.lookat).add(o.multiplyScalar(c))}truck(e){if(this._isTransitioning)return;const t=this._camera;t.position.add(new Fe().fromArray(e)),t.lookat.add(new Fe().fromArray(e))}update(e){if(!this._isTransitioning)return;this._transition=Math.min(this._transition+2*e/3,1);const t=Bg.smootherstep(this._transition,0,1),i=(t+1)/3,r=this._curveE.getPoint(i),o=this._curveL.getPoint(i),c=this._curveU.getPoint(i);this._camera.position.copy(r),this._camera.lookat.copy(o),this._camera.up.copy(c),this._zoom=Bg.lerp(this._zoom0,this._zoom1,t),this._stateTransitionAlpha=t}_getStateTransitionAlpha(){return this._stateTransitionAlpha}}class KL{constructor(e,t){this._phi=e,this._theta=t}get phi(){return this._phi}set phi(e){this._phi=e}get theta(){return this._theta}set theta(e){this._theta=e}get isZero(){return this._phi===0&&this._theta===0}copy(e){this._phi=e.phi,this._theta=e.theta}lerp(e,t){this._phi=(1-t)*this._phi+t*e.phi,this._theta=(1-t)*this._theta+t*e.theta}multiply(e){this._phi*=e,this._theta*=e}threshold(e){this._phi=Math.abs(this._phi)>e?this._phi:0,this._theta=Math.abs(this._theta)>e?this._theta:0}lengthSquared(){return this._phi*this._phi+this._theta*this._theta}reset(){this._phi=0,this._theta=0}}class Gz extends Qw{constructor(e){super(e),this._animationSpeed=1/40,this._rotationDelta=new KL(0,0),this._requestedRotationDelta=null,this._basicRotation=[0,0],this._requestedBasicRotation=null,this._requestedBasicRotationUnbounded=null,this._rotationAcceleration=.86,this._rotationIncreaseAlpha=.97,this._rotationDecreaseAlpha=.9,this._rotationThreshold=.001,this._unboundedRotationAlpha=.8,this._desiredZoom=e.zoom,this._minZoom=0,this._maxZoom=3,this._lookatDepth=10,this._desiredLookat=null,this._desiredCenter=null}rotate(e){this._currentImage!=null&&(e.phi===0&&e.theta===0||(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta!=null?(this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+e.phi,this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+e.theta):this._requestedRotationDelta=new KL(e.phi,e.theta)))}rotateUnbounded(e){if(this._currentImage==null||(this._requestedBasicRotation=null,this._requestedRotationDelta=null,this._applyRotation(e,this._currentCamera),this._applyRotation(e,this._previousCamera),!this._desiredLookat))return;const t=new go().setFromUnitVectors(this._currentCamera.up,new Fe(0,0,1)),i=t.clone().invert(),r=new Fe().copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(t),o=r.length();let c=Math.atan2(r.y,r.x);c+=e.phi;let s=Math.atan2(Math.sqrt(r.x*r.x+r.y*r.y),r.z);s+=e.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),r.x=Math.sin(s)*Math.cos(c),r.y=Math.sin(s)*Math.sin(c),r.z=Math.cos(s),r.applyQuaternion(i),this._desiredLookat.copy(this._camera.position).add(r.multiplyScalar(o))}rotateWithoutInertia(e){if(this._currentImage==null)return;this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta=null;const t=Math.PI/(10*Math.pow(2,this._zoom)),i={phi:this._spatial.clamp(e.phi,-t,t),theta:this._spatial.clamp(e.theta,-t,t)};this._applyRotation(i,this._currentCamera),this._applyRotation(i,this._previousCamera)}rotateBasic(e){if(this._currentImage!=null)if(this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation!=null){this._requestedBasicRotation[0]+=e[0],this._requestedBasicRotation[1]+=e[1];let t=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-t,t),this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-t,t)}else this._requestedBasicRotation=e.slice()}rotateBasicUnbounded(e){this._currentImage!=null&&(this._requestedBasicRotationUnbounded!=null?(this._requestedBasicRotationUnbounded[0]+=e[0],this._requestedBasicRotationUnbounded[1]+=e[1]):this._requestedBasicRotationUnbounded=e.slice())}rotateBasicWithoutInertia(e){if(this._currentImage==null)return;this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null;const t=.05/Math.pow(2,this._zoom),i=e.slice();i[0]=this._spatial.clamp(i[0],-t,t),i[1]=this._spatial.clamp(i[1],-t,t),this._applyRotationBasic(i)}rotateToBasic(e){if(this._currentImage==null)return;this._desiredZoom=this._zoom,this._desiredLookat=null,e[0]=this._spatial.clamp(e[0],0,1),e[1]=this._spatial.clamp(e[1],0,1);let t=this.currentTransform.unprojectBasic(e,this._lookatDepth);this._currentCamera.lookat.fromArray(t)}zoomIn(e,t){if(this._currentImage==null)return;this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+e));let i=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray()),r=i[0],o=i[1],c=Math.pow(2,this._zoom),s=Math.pow(2,this._desiredZoom),f=t[0],p=t[1];ki(this.currentTransform.cameraType)&&(f-r>.5?f=f-1:r-f>.5&&(f=1+f));let g=f-c/s*(f-r),_=p-c/s*(p-o);ki(this._currentImage.cameraType)?(g=this._spatial.wrap(g+this._basicRotation[0],0,1),_=this._spatial.clamp(_+this._basicRotation[1],.05,.95)):(g=this._spatial.clamp(g,0,1),_=this._spatial.clamp(_,0,1)),this._desiredLookat=new Fe().fromArray(this.currentTransform.unprojectBasic([g,_],this._lookatDepth))}setCenter(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._desiredZoom=this._zoom;let t=[this._spatial.clamp(e[0],0,1),this._spatial.clamp(e[1],0,1)];if(this._currentImage==null){this._desiredCenter=t;return}this._desiredCenter=null;let i=new Fe().fromArray(this.currentTransform.unprojectBasic(t,this._lookatDepth)),r=this.previousTransform!=null?this.previousTransform:this.currentTransform,o=new Fe().fromArray(r.unprojectBasic(t,this._lookatDepth));this._currentCamera.lookat.copy(i),this._previousCamera.lookat.copy(o)}setZoom(e){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._zoom=this._spatial.clamp(e,this._minZoom,this._maxZoom),this._desiredZoom=this._zoom}_applyRotation(e,t){if(t==null)return;let i=new go().setFromUnitVectors(t.up,new Fe(0,0,1)),r=i.clone().invert(),o=new Fe;o.copy(t.lookat).sub(t.position),o.applyQuaternion(i);let c=o.length(),s=Math.atan2(o.y,o.x);s+=e.phi;let f=Math.atan2(Math.sqrt(o.x*o.x+o.y*o.y),o.z);f+=e.theta,f=Math.max(.1,Math.min(Math.PI-.1,f)),o.x=Math.sin(f)*Math.cos(s),o.y=Math.sin(f)*Math.sin(s),o.z=Math.cos(f),o.applyQuaternion(r),t.lookat.copy(t.position).add(o.multiplyScalar(c))}_applyRotationBasic(e){let t=this._currentImage,i=this._previousImage!=null?this.previousImage:this.currentImage,r=this._currentCamera,o=this._previousCamera,c=this.currentTransform,s=this.previousTransform!=null?this.previousTransform:this.currentTransform,f=c.projectBasic(r.lookat.toArray()),p=s.projectBasic(o.lookat.toArray());ki(t.cameraType)?(f[0]=this._spatial.wrap(f[0]+e[0],0,1),f[1]=this._spatial.clamp(f[1]+e[1],.05,.95)):(f[0]=this._spatial.clamp(f[0]+e[0],0,1),f[1]=this._spatial.clamp(f[1]+e[1],0,1)),ki(i.cameraType)?(p[0]=this._spatial.wrap(p[0]+e[0],0,1),p[1]=this._spatial.clamp(p[1]+e[1],.05,.95)):(p[0]=this._spatial.clamp(p[0]+e[0],0,1),p[1]=this._spatial.clamp(f[1]+e[1],0,1));let g=c.unprojectBasic(f,this._lookatDepth);r.lookat.fromArray(g);let _=s.unprojectBasic(p,this._lookatDepth);o.lookat.fromArray(_)}_updateZoom(e){let t=this._desiredZoom-this._zoom,i=t>0?1:t<0?-1:0;t!==0&&(Math.abs(t)<.002?(this._zoom=this._desiredZoom,this._desiredLookat!=null&&(this._desiredLookat=null)):this._zoom+=i*Math.max(Math.abs(5*e*t),.002))}_updateLookat(e){if(this._desiredLookat===null)return;let t=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);Math.abs(t)<1e-6?(this._currentCamera.lookat.copy(this._desiredLookat),this._desiredLookat=null):this._currentCamera.lookat.lerp(this._desiredLookat,5*e)}_updateRotation(){if(this._requestedRotationDelta!=null){let t=this._rotationDelta.lengthSquared();this._requestedRotationDelta.lengthSquared()>t?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),this._requestedRotationDelta=null;return}if(this._rotationDelta.isZero)return;const e=ki(this.currentImage.cameraType)?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*e),this._rotationDelta.threshold(this._rotationThreshold)}_updateRotationBasic(){if(this._requestedBasicRotation!=null){let e=this._basicRotation[0],t=this._basicRotation[1],i=this._requestedBasicRotation[0],r=this._requestedBasicRotation[1];Math.abs(i)>Math.abs(e)?this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*i:this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*i,Math.abs(r)>Math.abs(t)?this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*r:this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*r,this._requestedBasicRotation=null;return}if(this._requestedBasicRotationUnbounded!=null){let e=this._requestedBasicRotationUnbounded[0],t=this._requestedBasicRotationUnbounded[1];if(Math.abs(e)>0&&(this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*e),Math.abs(t)>0&&(this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*t),this._desiredLookat!=null){let i=this.currentTransform.projectBasic(this._desiredLookat.toArray());i[0]+=e,i[1]+=t,this._desiredLookat=new Fe().fromArray(this.currentTransform.unprojectBasic(i,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}this._basicRotation[0]===0&&this._basicRotation[1]===0||(this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0],this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1],Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)&&(this._basicRotation=[0,0]))}_clearRotation(){ki(this._currentImage.cameraType)||(this._requestedRotationDelta!=null&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset(),this._requestedBasicRotation!=null&&(this._requestedBasicRotation=null),(this._basicRotation[0]>0||this._basicRotation[1]>0)&&(this._basicRotation=[0,0]))}_setDesiredCenter(){if(this._desiredCenter==null)return;let e=new Fe().fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(e)),this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(e)),this._desiredCenter=null}_setDesiredZoom(){this._desiredZoom=ki(this._currentImage.cameraType)||this._previousImage==null?this._zoom:0}}class JL extends Gz{constructor(e){super(e),this._adjustCameras(),this._motionless=this._motionlessTransition()}prepend(e){super.prepend(e),this._motionless=this._motionlessTransition()}set(e){super.set(e),this._motionless=this._motionlessTransition()}move(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}moveTo(e){this._alpha=Math.max(0,Math.min(1,e))}update(e){this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),(this._basicRotation[0]!==0||this._basicRotation[1]!==0)&&this._applyRotationBasic(this._basicRotation);let t=this._animationSpeed*e/.1*6;this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.round(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(this._previousImage!=null){if(ki(this._currentImage.cameraType)){let e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(ki(this._previousImage.cameraType)){let e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}}}}class QL extends Gz{constructor(e){super(e),this._adjustCameras(),this._motionless=this._motionlessTransition(),this._baseAlpha=this._alpha,this._speedCoefficient=1,this._smoothing=!1}append(e){let t=this._trajectory.length===0;t&&this._resetTransition(),super.append(e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}prepend(e){let t=this._trajectory.length===0;t&&this._resetTransition(),super.prepend(e),t&&(this._setDesiredCenter(),this._setDesiredZoom())}set(e){super.set(e),this._desiredLookat=null,this._resetTransition(),this._clearRotation(),this._setDesiredCenter(),this._setDesiredZoom(),this._trajectory.length<3&&(this._smoothing=!0)}setSpeed(e){this._speedCoefficient=this._spatial.clamp(e,0,10)}update(e){this._alpha===1&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._smoothing=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setCurrent(),this._resetTransition(),this._clearRotation(),this._desiredZoom=ki(this._currentImage.cameraType)?this._zoom:0,this._desiredLookat=null);let t=this._animationSpeed*e/.1*6;this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*t),this._smoothing?this._alpha=Bg.smootherstep(this._baseAlpha,0,1):this._alpha=this._baseAlpha,this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),(this._basicRotation[0]!==0||this._basicRotation[1]!==0)&&this._applyRotationBasic(this._basicRotation),this._updateZoom(t),this._updateLookat(t),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.ceil(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(this._previousImage==null)return;let e=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position)),ki(this._currentImage.cameraType)&&this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}_resetTransition(){this._alpha=0,this._baseAlpha=0,this._motionless=this._motionlessTransition()}}class eR extends Qw{constructor(e){super(e),this._zoom=0,this._adjustCameras(),this._motionless=this._motionlessTransition()}prepend(e){super.prepend(e),this._motionless=this._motionlessTransition()}set(e){super.set(e),this._motionless=this._motionlessTransition()}move(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))}moveTo(e){this._alpha=Math.max(0,Math.min(1,e))}update(){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)}_getAlpha(){return this._motionless?Math.round(this._alpha):this._alpha}_setCurrentCamera(){super._setCurrentCamera(),this._adjustCameras()}_adjustCameras(){if(this._previousImage!=null){if(ki(this._currentImage.cameraType)){let e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(ki(this._previousImage.cameraType)){let e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}}}}class vre{constructor(){const e=Oi[Oi.Custom],t=Oi[Oi.Earth],i=Oi[Oi.Traversing],r=Oi[Oi.Waiting],o=Oi[Oi.WaitingInteractively];this._creators=new Map;const c=this._creators;c.set(e,XL),c.set(t,YL),c.set(i,QL),c.set(r,eR),c.set(o,JL),this._transitions=new Map;const s=this._transitions;s.set(e,[t,i]),s.set(t,[e,i]),s.set(i,[e,t,r,o]),s.set(r,[i,o]),s.set(o,[i,r])}getState(e){if(e instanceof XL)return Oi.Custom;if(e instanceof YL)return Oi.Earth;if(e instanceof QL)return Oi.Traversing;if(e instanceof eR)return Oi.Waiting;if(e instanceof JL)return Oi.WaitingInteractively;throw new Error("Invalid state instance")}generate(e,t){const i=this._creators.get(Oi[e]);return new i(t)}transition(e,t){if(!this.validate(e,t))throw new Error("Invalid transition");return this.generate(t,e)}validate(e,t){const i=Oi[this.getState(e)],r=Oi[t],o=this._transitions;return o.has(i)&&o.get(i).includes(r)}}class yre{constructor(e,t){this._transitions=new vre,this._state=this._transitions.generate(e,{alpha:1,camera:new Td,currentIndex:-1,reference:{alt:0,lat:0,lng:0},trajectory:[],transitionMode:t??_w.Default,zoom:0})}get state(){return this._transitions.getState(this._state)}get reference(){return this._state.reference}get alpha(){return this._state.alpha}get stateTransitionAlpha(){return this._state.stateTransitionAlpha}get camera(){return this._state.camera}get zoom(){return this._state.zoom}get currentImage(){return this._state.currentImage}get previousImage(){return this._state.previousImage}get currentCamera(){return this._state.currentCamera}get currentTransform(){return this._state.currentTransform}get previousTransform(){return this._state.previousTransform}get trajectory(){return this._state.trajectory}get currentIndex(){return this._state.currentIndex}get lastImage(){return this._state.trajectory[this._state.trajectory.length-1]}get imagesAhead(){return this._state.trajectory.length-1-this._state.currentIndex}get motionless(){return this._state.motionless}custom(){this._transition(Oi.Custom)}earth(){this._transition(Oi.Earth)}traverse(){this._transition(Oi.Traversing)}wait(){this._transition(Oi.Waiting)}waitInteractively(){this._transition(Oi.WaitingInteractively)}getCenter(){return this._state.getCenter()}setCenter(e){this._state.setCenter(e)}setZoom(e){this._state.setZoom(e)}update(e){this._state.update(e)}append(e){this._state.append(e)}prepend(e){this._state.prepend(e)}remove(e){this._state.remove(e)}clear(){this._state.clear()}clearPrior(){this._state.clearPrior()}cut(){this._state.cut()}set(e){this._state.set(e)}setViewMatrix(e){this._state.setViewMatrix(e)}rotate(e){this._state.rotate(e)}rotateUnbounded(e){this._state.rotateUnbounded(e)}rotateWithoutInertia(e){this._state.rotateWithoutInertia(e)}rotateBasic(e){this._state.rotateBasic(e)}rotateBasicUnbounded(e){this._state.rotateBasicUnbounded(e)}rotateBasicWithoutInertia(e){this._state.rotateBasicWithoutInertia(e)}rotateToBasic(e){this._state.rotateToBasic(e)}move(e){this._state.move(e)}moveTo(e){this._state.moveTo(e)}zoomIn(e,t){this._state.zoomIn(e,t)}setSpeed(e){this._state.setSpeed(e)}setTransitionMode(e){this._state.setTransitionMode(e)}dolly(e){this._state.dolly(e)}orbit(e){this._state.orbit(e)}truck(e){this._state.truck(e)}_transition(e){if(!this._transitions.validate(this._state,e)){const i=this._transitions.getState(this._state);console.warn(`Transition not valid (${Oi[i]} - ${Oi[e]})`);return}const t=this._transitions.transition(this._state,e);this._state=t}}class bre{constructor(e,t){this._appendImage$=new ri,this._clock=new LY,this._subscriptions=new yo;const i=this._subscriptions;this._start$=new ri,this._frame$=new ri,this._contextOperation$=new Eh(c=>c),this._context$=this._contextOperation$.pipe(Vr((c,s)=>s(c),new yre(e,t)),Pi(1),gi()),this._state$=this._context$.pipe(We(c=>c.state),yi(),Pi(1),gi()),this._currentState$=this._frame$.pipe(Ui(this._context$,(c,s)=>[c,s]),oi(c=>c[1].currentImage!=null),Dr(c=>{c[1].update(this._clock.getDelta())}),We(c=>({fps:60,id:c[0],state:c[1]})),dn()),this._lastState$=this._currentState$.pipe(Pi(1),gi());let r=this._currentState$.pipe(yi(void 0,c=>c.state.currentImage.id),Pi(1),gi()),o=new ri;i.push(r.subscribe(o)),this._currentId$=new Eh(null),i.push(o.pipe(We(c=>c.state.currentImage.id)).subscribe(this._currentId$)),this._currentImage$=o.pipe(We(c=>c.state.currentImage),Pi(1),gi()),this._currentCamera$=o.pipe(We(c=>c.state.currentCamera),Pi(1),gi()),this._currentTransform$=o.pipe(We(c=>c.state.currentTransform),Pi(1),gi()),this._reference$=o.pipe(We(c=>c.state.reference),yi((c,s)=>c.lat===s.lat&&c.lng===s.lng,c=>({lat:c.lat,lng:c.lng})),Pi(1),gi()),this._currentImageExternal$=r.pipe(We(c=>c.state.currentImage),Pi(1),gi()),i.push(this._appendImage$.pipe(We(c=>s=>(s.append([c]),s))).subscribe(this._contextOperation$)),this._inMotionOperation$=new ri,i.push(r.pipe(We(()=>!0)).subscribe(this._inMotionOperation$)),i.push(this._inMotionOperation$.pipe(yi(),oi(c=>c),ei(()=>this._currentState$.pipe(oi(c=>c.state.imagesAhead===0),We(c=>[c.state.camera.clone(),c.state.zoom]),tl(),We(c=>{let s=c[0][0],f=c[1][0],p=c[0][1],g=c[1][1];return s.diff(f)>1e-5||Math.abs(p-g)>1e-5}),wi(c=>!c)))).subscribe(this._inMotionOperation$)),this._inMotion$=this._inMotionOperation$.pipe(yi(),Pi(1),gi()),this._inTranslationOperation$=new ri,i.push(r.pipe(We(()=>!0)).subscribe(this._inTranslationOperation$)),i.push(this._inTranslationOperation$.pipe(yi(),oi(c=>c),ei(()=>this._currentState$.pipe(oi(c=>c.state.imagesAhead===0),We(c=>c.state.camera.position.clone()),tl(),We(c=>c[0].distanceToSquared(c[1])!==0),wi(c=>!c)))).subscribe(this._inTranslationOperation$)),this._inTranslation$=this._inTranslationOperation$.pipe(yi(),Pi(1),gi()),i.push(this._state$.subscribe(()=>{})),i.push(this._currentImage$.subscribe(()=>{})),i.push(this._currentCamera$.subscribe(()=>{})),i.push(this._currentTransform$.subscribe(()=>{})),i.push(this._reference$.subscribe(()=>{})),i.push(this._currentImageExternal$.subscribe(()=>{})),i.push(this._lastState$.subscribe(()=>{})),i.push(this._inMotion$.subscribe(()=>{})),i.push(this._inTranslation$.subscribe(()=>{})),this._frameId=null,this._frameGenerator=new _re(window)}get currentState$(){return this._currentState$}get currentImage$(){return this._currentImage$}get currentId$(){return this._currentId$}get currentImageExternal$(){return this._currentImageExternal$}get currentCamera$(){return this._currentCamera$}get currentTransform$(){return this._currentTransform$}get state$(){return this._state$}get reference$(){return this._reference$}get inMotion$(){return this._inMotion$}get inTranslation$(){return this._inTranslation$}get appendImage$(){return this._appendImage$}dispose(){this.stop(),this._subscriptions.unsubscribe()}custom(){this._inMotionOperation$.next(!0),this._invokeContextOperation(e=>{e.custom()})}earth(){this._inMotionOperation$.next(!0),this._invokeContextOperation(e=>{e.earth()})}traverse(){this._inMotionOperation$.next(!0),this._invokeContextOperation(e=>{e.traverse()})}wait(){this._invokeContextOperation(e=>{e.wait()})}waitInteractively(){this._invokeContextOperation(e=>{e.waitInteractively()})}appendImagess(e){this._invokeContextOperation(t=>{t.append(e)})}prependImages(e){this._invokeContextOperation(t=>{t.prepend(e)})}removeImages(e){this._invokeContextOperation(t=>{t.remove(e)})}clearImages(){this._invokeContextOperation(e=>{e.clear()})}clearPriorImages(){this._invokeContextOperation(e=>{e.clearPrior()})}cutImages(){this._invokeContextOperation(e=>{e.cut()})}setImages(e){this._invokeContextOperation(t=>{t.set(e)})}setViewMatrix(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.setViewMatrix(e)})}rotate(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotate(e)})}rotateUnbounded(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateUnbounded(e)})}rotateWithoutInertia(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateWithoutInertia(e)})}rotateBasic(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateBasic(e)})}rotateBasicUnbounded(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateBasicUnbounded(e)})}rotateBasicWithoutInertia(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateBasicWithoutInertia(e)})}rotateToBasic(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.rotateToBasic(e)})}move(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.move(e)})}moveTo(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.moveTo(e)})}dolly(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.dolly(e)})}orbit(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.orbit(e)})}truck(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.truck(e)})}zoomIn(e,t){this._inMotionOperation$.next(!0),this._invokeContextOperation(i=>{i.zoomIn(e,t)})}getCenter(){return this._lastState$.pipe(wi(),We(e=>e.state.getCenter()))}getZoom(){return this._lastState$.pipe(wi(),We(e=>e.state.zoom))}setCenter(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.setCenter(e)})}setSpeed(e){this._invokeContextOperation(t=>{t.setSpeed(e)})}setTransitionMode(e){this._invokeContextOperation(t=>{t.setTransitionMode(e)})}setZoom(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(t=>{t.setZoom(e)})}start(){this._clock.start(),this._frameId==null&&(this._start$.next(null),this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId))}stop(){this._clock.stop(),this._frameId!=null&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)}_invokeContextOperation(e){this._contextOperation$.next(t=>(e(t),t))}_frame(){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId)}}function qz(n){switch(n){case bh.Custom:return Oi.Custom;case bh.Earth:return Oi.Earth;case bh.Street:return Oi.Traversing;default:return null}}class xre{constructor(e,t,i,r,o,c,s,f){var p;t?this._api=t:e.dataProvider?this._api=new ZL(e.dataProvider):this._api=new ZL(new Qne({accessToken:e.accessToken})),this._graphService=i??new gre(new Iy(this.api)),this._loadingName="navigator",this._loadingService=r??new pre;const g=(p=e.cameraControls)!==null&&p!==void 0?p:bh.Street;this._stateService=o??new bre(qz(g),e.transitionMode),this._cacheService=c??new fre(this._graphService,this._stateService,this._api),this._playService=s??new c0(this._graphService,this._stateService),this._panService=f??new mre(this._graphService,this._stateService,e.combinedPanning),this._idRequested$=new Eh(null),this._movedToId$=new Eh(null),this._request$=null,this._requestSubscription=null,this._imageRequestSubscription=null}get api(){return this._api}get cacheService(){return this._cacheService}get graphService(){return this._graphService}get loadingService(){return this._loadingService}get movedToId$(){return this._movedToId$}get panService(){return this._panService}get playService(){return this._playService}get stateService(){return this._stateService}dispose(){this._abortRequest("viewer removed"),this._cacheService.stop(),this._graphService.dispose(),this._panService.dispose(),this._playService.dispose(),this._stateService.dispose()}moveTo$(e){this._abortRequest(`to id ${e}`),this._loadingService.startLoading(this._loadingName);const t=this._moveTo$(e);return this._makeRequest$(t)}moveDir$(e){this._abortRequest(`in dir ${Ot[e]}`),this._loadingService.startLoading(this._loadingName);const t=this.stateService.currentImage$.pipe(wi(),Wi(i=>([Ot.Next,Ot.Prev].indexOf(e)>-1?i.sequenceEdges$:i.spatialEdges$).pipe(wi(),We(r=>{for(let o of r.edges)if(o.data.direction===e)return o.target;return null}))),Wi(i=>i==null?(this._loadingService.stopLoading(this._loadingName),Sx(new Error(`Direction (${e}) does not exist for current image.`))):this._moveTo$(i)));return this._makeRequest$(t)}setFilter$(e){return this._stateService.clearImages(),this._movedToId$.pipe(wi(),Wi(t=>t!=null?this._trajectoryIds$().pipe(Wi(i=>this._graphService.setFilter$(e).pipe(Wi(()=>this._cacheIds$(i)))),Og()):this._idRequested$.pipe(wi(),Wi(i=>i!=null?this._graphService.setFilter$(e).pipe(Wi(()=>this._graphService.cacheImage$(i))):this._graphService.setFilter$(e).pipe(We(()=>{}))))),We(()=>{}))}setAccessToken$(e){return this._abortRequest("to set user token"),this._stateService.clearImages(),this._movedToId$.pipe(wi(),Dr(()=>{this._api.setAccessToken(e)}),Wi(t=>t==null?this._graphService.reset$([]):this._trajectoryIds$().pipe(Wi(i=>this._graphService.reset$(i).pipe(Wi(()=>this._cacheIds$(i)))),Og(),We(()=>{}))))}_cacheIds$(e){const t=e.map(i=>this._graphService.cacheImage$(i));return Fr(t).pipe(tp())}_abortRequest(e){this._requestSubscription!=null&&(this._requestSubscription.unsubscribe(),this._requestSubscription=null),this._imageRequestSubscription!=null&&(this._imageRequestSubscription.unsubscribe(),this._imageRequestSubscription=null),this._request$!=null&&(this._request$.isStopped||this._request$.hasError||this._request$.error(new Bl(`Request aborted by a subsequent request ${e}.`)),this._request$=null)}_makeRequest$(e){const t=new LD(1);return this._requestSubscription=t.subscribe(void 0,()=>{}),this._request$=t,this._imageRequestSubscription=e.subscribe(i=>{this._request$=null,t.next(i),t.complete()},i=>{this._request$=null,t.error(i)}),t}_moveTo$(e){return this._idRequested$.next(e),this._graphService.cacheImage$(e).pipe(Dr(t=>{this._stateService.setImages([t]),this._movedToId$.next(t.id)}),ma(()=>{this._loadingService.stopLoading(this._loadingName)}))}_trajectoryIds$(){return this._stateService.currentState$.pipe(wi(),We(e=>e.state.trajectory.map(t=>t.id)))}}class wre{constructor(e,t){this._spatial=t??new vo,this._viewportCoords=e??new zo}basicToCanvas(e,t,i,r){return this._viewportCoords.basicToCanvasSafe(e[0],e[1],t,r,i.perspective)}canvasToBasic(e,t,i,r){let o=this._viewportCoords.canvasToBasic(e[0],e[1],t,r,i.perspective);return(o[0]<0||o[0]>1||o[1]<0||o[1]>1)&&(o=null),o}eventToUnprojection(e,t,i,r,o){const c=this._viewportCoords.canvasPosition(e,t);return this.canvasToUnprojection(c,t,i,r,o)}canvasToUnprojection(e,t,i,r,o){const c=e[0],s=e[1],[f,p]=this._viewportCoords.canvasToViewport(c,s,t),g=new Fe(f,p,1).unproject(i.perspective);let _=o.projectBasic(g.toArray());(_[0]<0||_[0]>1||_[1]<0||_[1]>1)&&(_=null);const x=g.clone().sub(i.camera.position).normalize(),b=-2/x.z;let M=null;if(b>0&&b<100&&_){const k=x.clone().multiplyScalar(b).add(i.camera.position),[L,I]=dp(k.x,k.y,k.z,r.lng,r.lat,r.alt);M={lat:I,lng:L}}return{basicPoint:_,lngLat:M,pixelPoint:[c,s]}}cameraToLngLat(e,t){const i=e.camera.position,[r,o]=dp(i.x,i.y,i.z,t.lng,t.lat,t.alt);return{lat:o,lng:r}}lngLatToCanvas(e,t,i,r){const o=ta(e.lng,e.lat,0,r.lng,r.lat,r.alt);return this._viewportCoords.projectToCanvasSafe(o,t,i.perspective)}distanceBetweenLngLats(e,t){return this._spatial.distanceFromLngLat(e.lng,e.lat,t.lng,t.lat)}}class Sre{constructor(e,t,i){this._subscriptions=new yo,this._emitSubscriptions=new yo,this._container=i,this._viewer=e,this._navigator=t,this._projection=new wre,this._started=!1,this._navigable$=new ri;const r=this._subscriptions;r.push(this._navigable$.subscribe(o=>{const c="navigable",s={navigable:o,target:this._viewer,type:c};this._viewer.fire(c,s)})),r.push(this._navigator.loadingService.loading$.subscribe(o=>{const c="dataloading",s={loading:o,target:this._viewer,type:c};this._viewer.fire(c,s)})),r.push(this._container.glRenderer.opaqueRender$.pipe(wi()).subscribe(()=>{const o="load",c={target:this._viewer,type:o};this._viewer.fire(o,c)}))}get started(){return this._started}get navigable$(){return this._navigable$}get projection(){return this._projection}dispose(){this.stopEmit(),this._subscriptions.unsubscribe()}project$(e){return Si(this._container.renderService.renderCamera$,this._navigator.stateService.currentImage$,this._navigator.stateService.reference$).pipe(wi(),We(([t,i,r])=>{if(this._projection.distanceBetweenLngLats(e,i.lngLat)>1e3)return null;const o=this._projection.lngLatToCanvas(e,this._container.container,t,r);return o?[Math.round(o[0]),Math.round(o[1])]:null}))}projectBasic$(e){return Si(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(wi(),We(([t,i])=>{const r=this._projection.basicToCanvas(e,this._container.container,t,i);return r?[Math.round(r[0]),Math.round(r[1])]:null}))}startEmit(){if(this._started)return;this._started=!0;const e=this._emitSubscriptions;e.push(this._navigator.stateService.currentImageExternal$.subscribe(i=>{const r="image",o={image:i,target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(this._navigator.stateService.currentImageExternal$.pipe(ei(i=>i.sequenceEdges$)).subscribe(i=>{const r="sequenceedges",o={status:i,target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(this._navigator.stateService.currentImageExternal$.pipe(ei(i=>i.spatialEdges$)).subscribe(i=>{const r="spatialedges",o={status:i,target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(this._navigator.stateService.reference$.subscribe(i=>{const r="reference",o={reference:i,target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(Si(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(We(i=>i[0]||i[1]||i[2]),yi()).subscribe(i=>{const r=i?"movestart":"moveend",o={target:this._viewer,type:r};this._viewer.fire(r,o)})),e.push(this._container.renderService.bearing$.pipe(XD(100),yi((i,r)=>Math.abs(r-i)<1)).subscribe(i=>{const r="bearing",o={bearing:i,target:this._viewer,type:r};this._viewer.fire(r,o)}));const t=this._container.mouseService.active$.pipe(ei(i=>i?zi():this._container.mouseService.mouseMove$));e.push(fn(this._mapMouseEvent$("click",this._container.mouseService.staticClick$),this._mapMouseEvent$("contextmenu",this._container.mouseService.contextMenu$),this._mapMouseEvent$("dblclick",this._container.mouseService.dblClick$),this._mapMouseEvent$("mousedown",this._container.mouseService.mouseDown$),this._mapMouseEvent$("mousemove",t),this._mapMouseEvent$("mouseout",this._container.mouseService.mouseOut$),this._mapMouseEvent$("mouseover",this._container.mouseService.mouseOver$),this._mapMouseEvent$("mouseup",this._container.mouseService.mouseUp$)).pipe(Ui(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$,this._navigator.stateService.state$),We(([[i,r],o,c,s,f])=>{const p=this._projection.eventToUnprojection(r,this._container.container,o,c,s);return{basicPoint:f===Oi.Traversing?p.basicPoint:null,lngLat:p.lngLat,originalEvent:r,pixelPoint:p.pixelPoint,target:this._viewer,type:i}})).subscribe(i=>{this._viewer.fire(i.type,i)})),e.push(this._container.renderService.renderCamera$.pipe(yi(([i,r],[o,c])=>this._closeTo(i,o,.01)&&this._closeTo(r,c,.01),i=>i.camera.position.toArray())).subscribe(()=>{const i="position",r={target:this._viewer,type:i};this._viewer.fire(i,r)})),e.push(this._container.renderService.renderCamera$.pipe(yi(([i,r],[o,c])=>this._closeTo(i,o,.001)&&this._closeTo(r,c,.001),i=>[i.rotation.phi,i.rotation.theta])).subscribe(()=>{const r={target:this._viewer,type:"pov"};this._viewer.fire("pov",r)})),e.push(this._container.renderService.renderCamera$.pipe(yi((i,r)=>this._closeTo(i,r,.01),i=>i.perspective.fov)).subscribe(()=>{const r={target:this._viewer,type:"fov"};this._viewer.fire("fov",r)}))}stopEmit(){this.started&&(this._emitSubscriptions.unsubscribe(),this._started=!1)}unproject$(e){return Si(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(wi(),We(([t,i,r])=>this._projection.canvasToUnprojection(e,this._container.container,t,i,r).lngLat))}unprojectBasic$(e){return Si(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(wi(),We(([t,i])=>this._projection.canvasToBasic(e,this._container.container,t,i)))}_closeTo(e,t,i){return Math.abs(e-t)<=i}_mapMouseEvent$(e,t){return t.pipe(We(i=>[e,i]))}}class Tre{constructor(e,t){this._container=e,this._navigator=t,this._renderers={}}add(e,t){const i=new yo;this._renderers[e.id]={subs:i,renderer:e},i.push(Si([this._container.glRenderer.webGLRenderer$,this._navigator.stateService.reference$]).pipe(zl(1)).subscribe(([r,o])=>{e.onAdd(t,o,r.getContext())})),i.push(this._container.glRenderer.opaqueRender$.pipe(Ui(this._container.renderService.renderCamera$,this._container.glRenderer.webGLRenderer$)).subscribe(([,r,o])=>{const c=o.getContext(),s=r.perspective.matrixWorldInverse,f=r.perspective.projectionMatrix;e.render(c,s.toArray(),f.toArray())})),i.push(this._navigator.stateService.reference$.pipe(Ys(1)).subscribe(r=>{e.onReference(t,r)}))}dispose(e){for(const t of Object.keys(this._renderers))this.remove(t,e)}has(e){return e in this._renderers}remove(e,t){this._renderers[e].subs.unsubscribe();const i=this._renderers[e].renderer;delete this._renderers[e],this._container.glRenderer.webGLRenderer$.subscribe(r=>{i.onRemove(t,r.getContext())})}}class Mre{constructor(e,t){this._container=e,this._navigator=t,this._controls=null,this._subscriptions=new yo}attach(e,t){if(this._controls)throw new cr("Custom camera controls already attached");this._controls=e;const i=new ri,r=i.pipe(ei(()=>this._navigator.stateService.state$),We(c=>c===Oi.Custom),yi()),o=this._subscriptions;o.push(r.pipe(An(!1),tl(),Ui(this._navigator.stateService.reference$,this._container.renderService.renderCamera$)).subscribe(([[c,s],f,p])=>{s?e.onActivate(t,p.perspective.matrixWorldInverse.toArray(),p.perspective.projectionMatrix.toArray(),f):c&&e.onDeactivate(t)})),o.push(r.pipe(ei(c=>c?this._navigator.stateService.currentState$.pipe(Ys(1)):zi())).subscribe(c=>{e.onAnimationFrame(t,c.id)})),o.push(r.pipe(ei(c=>c?this._navigator.stateService.reference$.pipe(Ys(1)):zi())).subscribe(c=>e.onReference(t,c))),o.push(r.pipe(ei(c=>c?this._container.renderService.size$.pipe(Ys(1)):zi())).subscribe(()=>e.onResize(t))),o.push(Si([this._container.glRenderer.webGLRenderer$,this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.state$]).pipe(wi()).subscribe(()=>{const c=f=>{!this._controls||e!==this._controls||this._updateProjectionMatrix(f)},s=f=>{!this._controls||e!==this._controls||this._updateViewMatrix(f)};e.onAttach(t,s,c),i.next(),i.complete()}))}detach(e){const t=this._controls;return this._controls=null,this._subscriptions.unsubscribe(),new Promise(i=>{this._navigator.stateService.state$.pipe(zl(1)).subscribe(r=>{if(!t){i(null);return}r===Oi.Custom&&t.onDeactivate(e),t.onDetach(e),i(t)})})}dispose(e){this.detach(e)}has(e){return!!this._controls&&e===this._controls}_updateProjectionMatrix(e){this._navigator.stateService.state$.pipe(wi()).subscribe(t=>{if(t!==Oi.Custom){console.warn("Incorrect camera control mode for projection matrix update");return}this._container.renderService.projectionMatrix$.next(e)})}_updateViewMatrix(e){this._navigator.stateService.state$.pipe(wi()).subscribe(t=>{if(t!==Oi.Custom){console.warn("Incorrect camera control mode for view matrix update");return}this._navigator.stateService.setViewMatrix(e)})}}class Cre extends Xw{constructor(e){super(),this._navigator=new xre(e),this._container=new dre(e,this._navigator.stateService),this._observer=new Sre(this,this._navigator,this._container),this._componentController=new ere(this._container,this._navigator,this._observer,e.imageId,e.component),this._customRenderer=new Tre(this._container,this._navigator),this._customCameraControls=new Mre(this._container,this._navigator)}get dataProvider(){return this._navigator.api.data}get isNavigable(){return this._componentController.navigable}activateCombinedPanning(){this._navigator.panService.enable()}activateComponent(e){this._componentController.activate(e)}activateCover(){this._componentController.activateCover()}addCustomRenderer(e){this._customRenderer.add(e,this)}attachCustomCameraControls(e){this._customCameraControls.attach(e,this)}deactivateCombinedPanning(){this._navigator.panService.disable()}deactivateComponent(e){this._componentController.deactivate(e)}deactivateCover(){this._componentController.deactivateCover()}detachCustomCameraControls(){return this._customCameraControls.detach(this)}fire(e,t){super.fire(e,t)}getBearing(){return new Promise((e,t)=>{this._container.renderService.bearing$.pipe(wi()).subscribe(i=>{e(i)},i=>{t(i)})})}getCameraControls(){return new Promise((e,t)=>{this._navigator.stateService.state$.pipe(wi()).subscribe(i=>{switch(i){case Oi.Custom:e(bh.Custom);break;case Oi.Earth:e(bh.Earth);break;default:e(bh.Street);break}},i=>{t(i)})})}getCanvas(){return this._container.canvas}getCanvasContainer(){return this._container.canvasContainer}getCenter(){return new Promise((e,t)=>{this._navigator.stateService.getCenter().subscribe(i=>{e(i)},i=>{t(i)})})}getComponent(e){return this._componentController.get(e)}getContainer(){return this._container.container}getFieldOfView(){return new Promise((e,t)=>{this._container.renderService.renderCamera$.pipe(wi()).subscribe(i=>{e(i.perspective.fov)},i=>{t(i)})})}getImage(){return new Promise((e,t)=>{this._navigator.stateService.currentImage$.pipe(wi()).subscribe(i=>{e(i)},i=>{t(i)})})}getPointOfView(){return new Promise((e,t)=>{Si(this._container.renderService.renderCamera$,this._container.renderService.bearing$).pipe(wi()).subscribe(([i,r])=>{e({bearing:r,tilt:i.getTilt()})},i=>{t(i)})})}getPosition(){return new Promise((e,t)=>{Si(this._container.renderService.renderCamera$,this._navigator.stateService.reference$).pipe(wi()).subscribe(([i,r])=>{e(this._observer.projection.cameraToLngLat(i,r))},i=>{t(i)})})}getReference(){return new Promise((e,t)=>{this._navigator.stateService.reference$.pipe(wi()).subscribe(i=>{e(i)},i=>{t(i)})})}getZoom(){return new Promise((e,t)=>{this._navigator.stateService.getZoom().subscribe(i=>{e(i)},i=>{t(i)})})}hasCustomCameraControls(e){return this._customCameraControls.has(e)}hasCustomRenderer(e){return this._customRenderer.has(e)}moveDir(e){const t=this.isNavigable?this._navigator.moveDir$(e):Sx(new Error("Calling moveDir is not supported when viewer is not navigable."));return new Promise((i,r)=>{t.subscribe(o=>{i(o)},o=>{r(o)})})}moveTo(e){const t=this.isNavigable?this._navigator.moveTo$(e):Sx(new Error("Calling moveTo is not supported when viewer is not navigable."));return new Promise((i,r)=>{t.subscribe(o=>{i(o)},o=>{r(o)})})}off(e,t){super.off(e,t)}on(e,t){super.on(e,t)}project(e){return new Promise((t,i)=>{this._observer.project$(e).subscribe(r=>{t(r)},r=>{i(r)})})}projectFromBasic(e){return new Promise((t,i)=>{this._observer.projectBasic$(e).subscribe(r=>{t(r)},r=>{i(r)})})}remove(){this._customRenderer.dispose(this),this._customCameraControls.dispose(this),this._observer.dispose(),this._componentController.remove(),this._navigator.dispose(),this._container.remove();const e="remove",t={target:this,type:e};this.fire(e,t)}removeCustomRenderer(e){this._customRenderer.remove(e,this)}resize(){this._container.renderService.resize$.next()}setCameraControls(e){const t=qz(e);t===Oi.Traversing?this._navigator.stateService.traverse():t===Oi.Earth?this._navigator.stateService.earth():t===Oi.Custom?this._navigator.stateService.custom():console.warn(`Unsupported camera control transition (${e})`)}setCenter(e){this._navigator.stateService.setCenter(e)}setFieldOfView(e){this._container.renderService.renderCamera$.pipe(wi()).subscribe(t=>{const i=t.fovToZoom(e);this._navigator.stateService.setZoom(i)})}setFilter(e){return new Promise((t,i)=>{this._navigator.setFilter$(e).subscribe(()=>{t(void 0)},r=>{i(r)})})}setRenderMode(e){this._container.renderService.renderMode$.next(e)}setTransitionMode(e){this._navigator.stateService.setTransitionMode(e)}setAccessToken(e){const t=this.isNavigable?this._navigator.setAccessToken$(e):Sx(new Error("Calling setAccessToken is not supported when viewer is not navigable."));return new Promise((i,r)=>{t.subscribe(()=>{i(void 0)},o=>{r(o)})})}setZoom(e){this._navigator.stateService.setZoom(e)}triggerRerender(){this._container.glRenderer.triggerRerender()}unproject(e){return new Promise((t,i)=>{this._observer.unproject$(e).subscribe(r=>{t(r)},r=>{i(r)})})}unprojectToBasic(e){return new Promise((t,i)=>{this._observer.unprojectBasic$(e).subscribe(r=>{t(r)},r=>{i(r)})})}}Iy.register(oO);Ly.register(oO);Mr.registerCover(BO);Mr.register(NO);Mr.register($O);Mr.register(VO);Mr.register(UO);Mr.register(YO);Mr.register(KO);Mr.register(JO);Mr.register(ez);Mr.register(tz);Mr.register(iz);Mr.register(nz);Mr.register(oz);Mr.register(xz);Mr.register(wz);Mr.register(Sz);Mr.register(Tz);const Ere="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%20height='256'%20width='256'%20version='1.1'%3e%3cpath%20d='M0,0%20h100%20v100%20h-100z'%20fill='%2335af6d'/%3e%3cpath%20d='M42.71,66.19A2.5,2.5%200,0,1%2039.32,67.2L5.08,48.69A2.5,2.5%200,0,1%205.48,44.12L33.27,34.85A2.5,2.5%200,0,0%2034.85,33.27L44.12,5.48A2.5,2.5%200,0,1%2048.69,5.08L67.2,39.32A2.5,2.5%200,0,1%2066.19,42.71L61.79,45.09A2.5,2.5%200,0,1%2058.4,44.08L50.88,30.15A2.5,2.5%200,0,0%2046.3,30.55L42.76,41.18A2.5,2.5%200,0,1%2041.18,42.76L30.55,46.3A2.5,2.5%200,0,0%2030.15,50.88L44.08,58.4A2.5,2.5%200,0,1%2045.09,61.79zM68.33,46.67A2.5,2.5%200,0,1%2071.72,47.68L96.01,92.63A2.5,2.5%200,0,1%2092.63,96.01L47.68,71.72A2.5,2.5%200,0,1%2046.67,68.33L49.05,63.93A2.5,2.5%200,0,1%2052.43,62.92L67.89,71.27A2.5,2.5%200,0,0%2071.27,67.89L62.92,52.43A2.5,2.5%200,0,1%2063.93,49.05z'%20fill='%23fff'%20transform='scale(.79)%20translate(10.5,10.5)'/%3e%3c/svg%3e";function Hz(n,e,t,i={}){const r=vg(n),o=dh(r[0]),c=dh(r[1]),s=dh(t),f=Z5(e,i.units),p=Math.asin(Math.sin(c)*Math.cos(f)+Math.cos(c)*Math.sin(f)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(f)*Math.cos(c),Math.cos(f)-Math.sin(c)*Math.sin(p)),_=Fx(g),x=Fx(p);return r[2]!==void 0?Hf([_,x,r[2]],i.properties):Hf([_,x],i.properties)}function Are(n,e,t={}){const i=t.steps||64,r=t.properties?t.properties:!Array.isArray(n)&&n.type==="Feature"&&n.properties?n.properties:{},o=[];for(let c=0;c<i;c++)o.push(Hz(n,e,c*-360/i,t).geometry.coordinates);return o.push(o[0]),H5([o],r)}function Pre(n,e,t,i,r={}){const o=r.steps||64,c=tR(t),s=tR(i),f=!Array.isArray(n)&&n.type==="Feature"?n.properties:{};if(c===s)return tP(Are(n,e,r).geometry.coordinates[0],f);const p=c,g=c<s?s:s+360;let _=p;const x=[];let b=0;const M=(g-p)/o;for(;_<=g;)x.push(Hz(n,e,_,r).geometry.coordinates),b++,_=p+b*M;return tP(x,f)}function tR(n){let e=n%360;return e<0&&(e+=360),e}var Ire=Pre,Lre=Xt("<!> <!> <!> <!>",1),Rre=Xt("<!> <!>",1),kre=Xt('<button class="btn btn-secondary"><img alt="Mapillary" height="30px"/></button> <!> <!> <div class="viewer-container svelte-cogdew"><button class="btn btn-primary">X</button> <div style="width: 100%; height: 100%"></div></div>',1);function Dre(n,e){en(e,!0);let t=ii(!1),i=ii(void 0),r=ii(void 0),o=ii(void 0),c=ii(0);xa(()=>{ee(r)?.remove()}),cn(()=>{ee(i)&&ys(()=>{yt(r,new Cre({accessToken:s,container:ee(i)}),!0),ee(r).on("position",async F=>{let N=await ee(r).getPosition();yt(o,[N.lng,N.lat],!0)}),ee(r).on("bearing",F=>{yt(c,F.bearing,!0)})})});let s="MLY|25548189401504437|3c9576aa434c09888b5de1c28f13b1df";async function f(F){ee(r)?.resize(),await ee(r)?.moveTo(F)}let p=Kt(()=>{if(!ee(o))return no();let N=Ire(Hf(ee(o)),30,ee(c)-30,ee(c)+30,{units:"meters"});return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[ee(o),...N.geometry.coordinates,ee(o)]]}}});var g=kre(),_=ui(g);_.__click=()=>yt(t,!0);var x=Bt(_),b=ht(_,2);jV(b,{tiles:[`https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=${s}`],maxzoom:14,children:(F,N)=>{var H=Lre(),Y=ui(H);{let j=Kt(()=>({visibility:ee(t)?"visible":"none"}));Fl(Y,{sourceLayer:"sequence",paint:{"line-width":2,"line-color":["case",["get","is_pano"],"blue","green"]},get layout(){return ee(j)}})}var q=ht(Y,2);{let j=Kt(()=>({visibility:ee(t)?"visible":"none","icon-image":"chevron","icon-rotate":["get","compass_angle"],"icon-offset":[15,0]}));Av(q,{minzoom:16,sourceLayer:"image",get layout(){return ee(j)}})}var U=ht(q,2);{let j=Kt(()=>({"circle-radius":8,"circle-color":Fg("transparent","orange"),"circle-stroke-color":"black","circle-stroke-width":Fg(0,2)})),B=Kt(()=>({visibility:ee(t)?"visible":"none"}));ru(U,{sourceLayer:"image",manageHoverState:!0,get paint(){return ee(j)},get layout(){return ee(B)},hoverCursor:"pointer",onclick:ne=>f(ne.features[0].properties.id)})}var G=ht(U,2);{let j=Kt(()=>({visibility:ee(t)?"visible":"none"}));ru(G,{sourceLayer:"image",paint:{"circle-radius":4,"circle-color":["case",["get","is_pano"],"blue","green"],"circle-stroke-color":"black","circle-stroke-width":1},get layout(){return ee(j)}})}pt(F,H)},$$slots:{default:!0}});var M=ht(b,2);Hs(M,{get data(){return ee(p)},children:(F,N)=>{var H=Rre(),Y=ui(H);{let U=Kt(()=>({visibility:ee(t)?"visible":"none"}));p2(Y,{paint:{"fill-color":"orange","fill-opacity":.8},get layout(){return ee(U)}})}var q=ht(Y,2);{let U=Kt(()=>({visibility:ee(t)?"visible":"none"}));Fl(q,{paint:{"line-width":2,"line-color":"black"},get layout(){return ee(U)}})}pt(F,H)},$$slots:{default:!0}});var P=ht(M,2);let k;var L=Bt(P);L.__click=()=>yt(t,!1);var I=ht(L,2);vc(I,F=>yt(i,F),()=>ee(i)),Ji(()=>{_.disabled=ee(t),lu(x,"src",Ere),k=gh(P,"",k,{visibility:ee(t)?"visible":"hidden"})}),pt(n,g),tn()}ps(["click"]);var Fre=Xt('<div class="action-bar svelte-1pbywzu"><!> <!> <!> <!></div>');function Ore(n,e){en(e,!0);let t=st(e,"basemap",15),i="60px";var r=Fre();gh(r,"",{},{bottom:i});var o=Bt(r);vj(o,{get basemap(){return t()},set basemap(p){t(p)}});var c=ht(o,2);Ej(c,{});var s=ht(c,2);Dre(s,{});var f=ht(s,2);Nj(f),pt(n,r),tn()}let rp={RoadWithSeparate:"purple",RoadWithTags:"blue",RoadWithoutSidewalksExplicit:"#8B4000",RoadWithoutSidewalksImplicit:"orange",RoadUnknown:"#ff69b4",Sidewalk:"black",Crossing:"green",Other:"grey"},zre={RoadWithSeparate:"With separate sidewalks",RoadWithTags:"With tagged sidewalks",RoadWithoutSidewalksExplicit:"Tagged as no sidewalks",RoadWithoutSidewalksImplicit:"Assumed as no sidewalks",RoadUnknown:"Totally unknown",Sidewalk:"Separate sidewalk",Crossing:"Crossing",Other:"Other"};function Zf(n){return["interpolate",["linear"],["zoom"],5,.5+n,10,1+n,12,1.5+n,14,4+n,16,yy(["get","kind"],{Sidewalk:4+n,Crossing:5+n,Other:5+n},7+n),20,yy(["get","kind"],{Sidewalk:7+n,Crossing:10+n,Other:10+n},24+n)]}var Bre=Xt("<!> <!>",1),Nre=Xt("<!> <!>",1),$re=Xt("<!> <!> <!> <!> <!> <!> <!> <!>",1);function Vre(n,e){en(e,!0);const t=()=>on(kh,"$map",c),i=()=>on(Xs,"$backend",c),r=()=>on(Yx,"$debugMode",c),o=()=>on(ia,"$mutationCounter",c),[c,s]=cs();let f=st(e,"pinnedWay",15),p=st(e,"drawProblemDetails",15);function g(q){f(null);for(let U of t().queryRenderedFeatures(q.point,{layers:["speedwalk-ways"]})){f(e.ways.features.find(G=>G.id==U.id));break}}let _=Kt(()=>i()&&f()?JSON.parse(i().getSideLocations(BigInt(f().properties.id))):no());cn(()=>{let q=no();if(f())for(let U of f().properties.problems)q.features=[...q.features,...U.details];p(q)});function x(q){let U=no();if(q)for(let[G,j]of q.properties.node_ids.entries()){let B=e.nodes.features.find(ne=>ne.properties.id==j);U.features.push({type:"Feature",geometry:B.geometry,properties:{idx:G}})}return U}function b(q,U){if(!q||!U)return no();let G=parseInt(q.properties.tags["tmp:closest_way"]);if(!G)return no();for(let j of e.ways.features)if(j.properties.id==G){let B=JSON.parse(JSON.stringify(j));return B.properties.left=q.properties.tags["tmp:side"]=="Left",{type:"FeatureCollection",features:[B]}}return no()}var M=$re(),P=ui(M);zk(P,{onclick:g});var k=ht(P,2);{let q=Kt(()=>f()||no());Hs(k,{get data(){return ee(q)},children:(U,G)=>{var j=Bre(),B=ui(j);{let J=Kt(()=>({"line-width":Zf(10),"line-color":"cyan","line-opacity":.5}));Fl(B,{beforeId:"Road labels",get paint(){return ee(J)}})}var ne=ht(B,2);Av(ne,{minzoom:12,layout:{"icon-image":"arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0}}),pt(U,j)},$$slots:{default:!0}})}var L=ht(k,2);{let q=Kt(()=>b(f(),r()));Hs(L,{get data(){return ee(q)},children:(U,G)=>{{let j=Kt(()=>({"line-width":Zf(10),"line-color":"blue","line-opacity":.5,"line-offset":["case",["get","left"],-5,5]}));Fl(U,{beforeId:"Road labels",get paint(){return ee(j)}})}},$$slots:{default:!0}})}var I=ht(L,2);Hs(I,{get data(){return e.ways},children:(q,U)=>{{let G=Kt(()=>({"line-width":Zf(0),"line-color":yy(["get","kind"],rp,"cyan")}));Fl(q,{id:"speedwalk-ways",beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",get filter(){return e.filterWays},get paint(){return ee(G)}})}},$$slots:{default:!0}});var F=ht(I,2);Hy(F,o,q=>{{let U=Kt(()=>i()?JSON.parse(i().getRoadSides()):no());Hs(q,{get data(){return ee(U)},children:(G,j)=>{{let B=Kt(()=>({visibility:e.showRoadSides?"visible":"none","text-field":["get","sidewalks"],"text-size":15,"symbol-placement":"line","symbol-spacing":30,"text-allow-overlap":!0,"text-rotation-alignment":"viewport"}));Av(G,{minzoom:16,paint:{"text-color":"white","text-halo-color":"black","text-halo-width":2},get layout(){return ee(B)}})}},$$slots:{default:!0}})}});var N=ht(F,2);Hs(N,{get data(){return ee(_)},children:(q,U)=>{Av(q,{paint:{"text-color":"black","text-halo-color":"cyan","text-halo-width":4},layout:{"text-field":["get","side"],"text-size":16,"symbol-placement":"line"}})},$$slots:{default:!0}});var H=ht(N,2);{let q=Kt(()=>x(f()));Hs(H,{get data(){return ee(q)},children:(U,G)=>{{let j=Kt(()=>({"text-field":["get","idx"],"text-size":16,visibility:r()?"visible":"none"}));Av(U,{paint:{"text-color":"white","text-halo-color":"blue","text-halo-width":5},get layout(){return ee(j)}})}},$$slots:{default:!0}})}var Y=ht(H,2);Hs(Y,{get data(){return p()},children:(q,U)=>{var G=Nre(),j=ui(G);{let ne=Kt(()=>({visibility:e.showProblemDetails?"visible":"none"}));ru(j,{get filter(){return yD},paint:{"circle-radius":20,"circle-color":["get","color"],"circle-opacity":.5},get layout(){return ee(ne)}})}var B=ht(j,2);{let ne=Kt(()=>({"line-width":Zf(5),"line-color":["get","color"],"line-opacity":.5})),J=Kt(()=>({visibility:e.showProblemDetails?"visible":"none"}));Fl(B,{get filter(){return tM},get paint(){return ee(ne)},get layout(){return ee(J)}})}pt(q,G)},$$slots:{default:!0}}),pt(n,M),tn(),s()}const ho=[];for(let n=0;n<256;++n)ho.push((n+256).toString(16).slice(1));function Ure(n,e=0){return(ho[n[e+0]]+ho[n[e+1]]+ho[n[e+2]]+ho[n[e+3]]+"-"+ho[n[e+4]]+ho[n[e+5]]+"-"+ho[n[e+6]]+ho[n[e+7]]+"-"+ho[n[e+8]]+ho[n[e+9]]+"-"+ho[n[e+10]]+ho[n[e+11]]+ho[n[e+12]]+ho[n[e+13]]+ho[n[e+14]]+ho[n[e+15]]).toLowerCase()}let LT;const jre=new Uint8Array(16);function Gre(){if(!LT){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");LT=crypto.getRandomValues.bind(crypto)}return LT(jre)}const qre=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),iR={randomUUID:qre};function Hre(n,e,t){n=n||{};const i=n.random??n.rng?.()??Gre();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Ure(i)}function Wre(n,e,t){return iR.randomUUID&&!n?iR.randomUUID():Hre(n)}var Zre=Xt('<div class="accordion mb-3"><div class="accordion-item"><div class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" aria-expanded="true"><!></button></div> <div><div class="accordion-body"><!></div></div></div></div>');function jd(n,e){en(e,!0);let t=st(e,"open",3,!0),i=Wre();var r=Zre(),o=Bt(r),c=Bt(o),s=Bt(c),f=Bt(s);xs(f,()=>e.header);var p=ht(c,2);let g;var _=Bt(p),x=Bt(_);xs(x,()=>e.body),Ji(()=>{lu(s,"data-bs-target",`#${i}`),lu(s,"aria-controls",i),lu(p,"id",i),g=lp(p,1,"accordion-collapse collapse",null,g,{show:t()})}),pt(n,r),tn()}var Xre=Xt("<option> </option>"),Yre=Xt('<button class="btn btn-sm btn-primary">Pick next</button>'),Kre=Xt('<div class="problem-header svelte-fc5ubw"><p class="problem-count svelte-fc5ubw"> </p> <!></div>'),Jre=Xt(`<p>When a crossing way hits a road, the node should be tagged as a
        crossing. Instructions to fix are TODO.</p>`),Qre=Xt(`<p>Here are places where part of a road has separate sidewalks tagged, but
        then the next part of the road doesn't. It's best to be consistent about
        separate sidewalks along the entire length of a road. To fix:</p> <ol><li>Go map separate sidewalks along the entire road (in another editor)</li> <li>Update the road tagging to indicate those separate sidewalks (here or
          in another editor)</li> <li>Refresh the data here to verify</li></ol> <p>(This problem is detected when the road names are the same, so there are
        some false positives you can ignore.)</p>`,1),ese=Xt(`<p>Here are footways with a crossing node, but the way needs to be split
        and tagged as <i>footway=crossing</i> .</p> <ol><li>Open in another editor</li> <li>Split the way around the crossing</li> <li>Tag <i>footway=crossing</i> on the smaller segment</li> <li>Refresh the data here to verify</li></ol>`,1),tse=Xt(`<p>These roads aren't tagged as having separate sidewalks, but it looks
        like there's a parallel separate sidewalk already mapped.</p> <ol><li>Check each segment. If separate sidewalks are already there, update
          the tagging here.</li> <li>If the separate sidewalks don't cover the entire length of the road,
          ideally go finish drawing the separate sidewalks in another tool, then
          update the tagging on the road.</li></ol> <p>There are false positives. Check the full length of the road.</p>`,1),ise=Xt(`<p><i>sidewalk=separate</i> is ambiguous. Update the tagging to specify if there are separate sidewalks
        on both sides or just one.</p>`),nse=Xt(`<p>These roads have separate sidewalks tagged on one side, but the other
        side is unspecified or not drawn separately. Be consistent on each road
        and use another editor to draw separate sidewalks on both sides.</p>`),rse=Xt('<select class="form-select"><option>Show a type of problem</option><!></select> <!> <!>',1);function sse(n,e){en(e,!0);const t=()=>on(kh,"$map",i),[i,r]=cs();let o=st(e,"drawProblems",15),c=["missing crossing node","separate sidewalks should be continued here"],s=["missing footway=crossing","possible separate sidewalk near way without it tagged","sidewalk=separate is ambiguous about the side","sidewalk:left and sidewalk:right should each be tagged as separate or no"],f=Kt(()=>{let x={};for(let b of[...c,...s])x[b]=0;for(let b of[...e.nodes.features,...e.ways.features])for(let M of b.properties.problems)x[M.note]+=1;return x}),p=ii(""),g=ii(0);cn(()=>{let x={type:"FeatureCollection",features:[]};for(let b of[...e.nodes.features,...e.ways.features])b.properties.problems.some(M=>M.note==ee(p))&&x.features.push(b);o(x)});function _(){if(!t()||!ee(p)||o().features.length===0)return;const x=o().features[ee(g)];yt(g,(ee(g)+1)%o().features.length);try{if(x.geometry.type==="Point"){const b=x.geometry.coordinates;t().flyTo({center:[b[0],b[1]],zoom:19,animate:!0})}else{const b=bD(x);t().fitBounds(b,{animate:!0,padding:50})}}catch(b){console.error("Error focusing on problem:",b)}}jd(n,{header:M=>{var P=Hn("Problems");pt(M,P)},body:M=>{var P=rse(),k=ui(P),L=Bt(k);L.value=L.__value="";var I=ht(L);Os(I,17,()=>Object.entries(ee(f)),Fs,(U,G)=>{var j=Kt(()=>el(ee(G),2));let B=()=>ee(j)[0],ne=()=>ee(j)[1];var J=Xre(),le=Bt(J),ae={};Ji(()=>{J.disabled=ne()==0,ln(le,`${B()??""} (${ne()??""})`),ae!==(ae=B())&&(J.value=(J.__value=B())??"")}),pt(U,J)});var F=ht(k,2);{var N=U=>{var G=Kre(),j=Bt(G),B=Bt(j),ne=ht(j,2);{var J=le=>{var ae=Yre();ae.__click=_,pt(le,ae)};Ki(ne,le=>{o().features.length>0&&le(J)})}Ji(()=>ln(B,`${ee(f)[ee(p)]??""} problems`)),pt(U,G)};Ki(F,U=>{ee(p)&&U(N)})}var H=ht(F,2);{var Y=U=>{var G=Jre();pt(U,G)},q=U=>{var G=tr(),j=ui(G);{var B=J=>{var le=Qre();pt(J,le)},ne=J=>{var le=tr(),ae=ui(le);{var pe=Te=>{var Ce=ese();pt(Te,Ce)},fe=Te=>{var Ce=tr(),tt=ui(Ce);{var Ke=et=>{var Oe=tse();pt(et,Oe)},dt=et=>{var Oe=tr(),lt=ui(Oe);{var Ye=Lt=>{var At=ise();pt(Lt,At)},zt=Lt=>{var At=tr(),Nt=ui(At);{var $t=Ze=>{var bt=nse();pt(Ze,bt)};Ki(Nt,Ze=>{ee(p)=="sidewalk:left and sidewalk:right should each be tagged as separate or no"&&Ze($t)},!0)}pt(Lt,At)};Ki(lt,Lt=>{ee(p)=="sidewalk=separate is ambiguous about the side"?Lt(Ye):Lt(zt,!1)},!0)}pt(et,Oe)};Ki(tt,et=>{ee(p)=="possible separate sidewalk near way without it tagged"?et(Ke):et(dt,!1)},!0)}pt(Te,Ce)};Ki(ae,Te=>{ee(p)=="missing footway=crossing"?Te(pe):Te(fe,!1)},!0)}pt(J,le)};Ki(j,J=>{ee(p)=="separate sidewalks should be continued here"?J(B):J(ne,!1)},!0)}pt(U,G)};Ki(H,U=>{ee(p)=="missing crossing node"?U(Y):U(q,!1)})}N$(k,()=>ee(p),U=>{yt(p,U,!0),yt(g,0)}),pt(M,P)},$$slots:{header:!0,body:!0}}),tn(),r()}ps(["click"]);var ose=Xt("<!> <!> <!>",1);function ase(n,e){en(e,!0);let t=ii(.5);function i(r){let o=2500,c=.35,s=.85,f=(Math.sin(r/o*Math.PI*2)+1)/2;yt(t,c+f*(s-c)),requestAnimationFrame(i)}requestAnimationFrame(i),Hs(n,{get data(){return e.drawProblems},children:(r,o)=>{var c=ose(),s=ui(c);ru(s,{get filter(){return yD},paint:{"circle-radius":10,"circle-color":"red","circle-opacity":.5,"circle-stroke-color":"black","circle-stroke-width":1}});var f=ht(s,2);{let g=Kt(()=>({"line-width":Zf(15),"line-color":"red","line-opacity":ee(t),"line-blur":5})),_=Kt(()=>({visibility:e.pinnedWay?"none":"visible"}));Fl(f,{get filter(){return tM},maxzoom:16,get paint(){return ee(g)},get layout(){return ee(_)}})}var p=ht(f,2);{let g=Kt(()=>({"line-width":Zf(20),"line-color":"red","line-opacity":ee(t),"line-blur":5})),_=Kt(()=>({visibility:e.pinnedWay?"none":"visible"}));Fl(p,{get filter(){return tM},beforeId:"Road labels",minzoom:16,get paint(){return ee(g)},get layout(){return ee(_)}})}pt(r,c)},$$slots:{default:!0}}),tn()}function px(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var RT={exports:{}},nR;function lse(){return nR||(nR=1,(function(n,e){(function(t){n.exports=t()})(function(){return(function(){function t(i,r,o){function c(p,g){if(!r[p]){if(!i[p]){var _=typeof px=="function"&&px;if(!g&&_)return _(p,!0);if(s)return s(p,!0);var x=new Error("Cannot find module '"+p+"'");throw x.code="MODULE_NOT_FOUND",x}var b=r[p]={exports:{}};i[p][0].call(b.exports,function(M){var P=i[p][1][M];return c(P||M)},b,b.exports,t,i,r,o)}return r[p].exports}for(var s=typeof px=="function"&&px,f=0;f<o.length;f++)c(o[f]);return c}return t})()({1:[function(t,i,r){r.byteLength=x,r.toByteArray=M,r.fromByteArray=L;for(var o=[],c=[],s=typeof Uint8Array<"u"?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,g=f.length;p<g;++p)o[p]=f[p],c[f.charCodeAt(p)]=p;c[45]=62,c[95]=63;function _(I){var F=I.length;if(F%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var N=I.indexOf("=");N===-1&&(N=F);var H=N===F?0:4-N%4;return[N,H]}function x(I){var F=_(I),N=F[0],H=F[1];return(N+H)*3/4-H}function b(I,F,N){return(F+N)*3/4-N}function M(I){var F,N=_(I),H=N[0],Y=N[1],q=new s(b(I,H,Y)),U=0,G=Y>0?H-4:H,j;for(j=0;j<G;j+=4)F=c[I.charCodeAt(j)]<<18|c[I.charCodeAt(j+1)]<<12|c[I.charCodeAt(j+2)]<<6|c[I.charCodeAt(j+3)],q[U++]=F>>16&255,q[U++]=F>>8&255,q[U++]=F&255;return Y===2&&(F=c[I.charCodeAt(j)]<<2|c[I.charCodeAt(j+1)]>>4,q[U++]=F&255),Y===1&&(F=c[I.charCodeAt(j)]<<10|c[I.charCodeAt(j+1)]<<4|c[I.charCodeAt(j+2)]>>2,q[U++]=F>>8&255,q[U++]=F&255),q}function P(I){return o[I>>18&63]+o[I>>12&63]+o[I>>6&63]+o[I&63]}function k(I,F,N){for(var H,Y=[],q=F;q<N;q+=3)H=(I[q]<<16&16711680)+(I[q+1]<<8&65280)+(I[q+2]&255),Y.push(P(H));return Y.join("")}function L(I){for(var F,N=I.length,H=N%3,Y=[],q=16383,U=0,G=N-H;U<G;U+=q)Y.push(k(I,U,U+q>G?G:U+q));return H===1?(F=I[N-1],Y.push(o[F>>2]+o[F<<4&63]+"==")):H===2&&(F=(I[N-2]<<8)+I[N-1],Y.push(o[F>>10]+o[F>>4&63]+o[F<<2&63]+"=")),Y.join("")}},{}],2:[function(t,i,r){(function(o){(function(){var c=t("base64-js"),s=t("ieee754");r.Buffer=_,r.SlowBuffer=H,r.INSPECT_MAX_BYTES=50;var f=2147483647;r.kMaxLength=f,_.TYPED_ARRAY_SUPPORT=p(),!_.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function p(){try{var ve=new Uint8Array(1);return ve.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},ve.foo()===42}catch{return!1}}Object.defineProperty(_.prototype,"parent",{enumerable:!0,get:function(){if(_.isBuffer(this))return this.buffer}}),Object.defineProperty(_.prototype,"offset",{enumerable:!0,get:function(){if(_.isBuffer(this))return this.byteOffset}});function g(ve){if(ve>f)throw new RangeError('The value "'+ve+'" is invalid for option "size"');var te=new Uint8Array(ve);return te.__proto__=_.prototype,te}function _(ve,te,se){if(typeof ve=="number"){if(typeof te=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return P(ve)}return x(ve,te,se)}typeof Symbol<"u"&&Symbol.species!=null&&_[Symbol.species]===_&&Object.defineProperty(_,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),_.poolSize=8192;function x(ve,te,se){if(typeof ve=="string")return k(ve,te);if(ArrayBuffer.isView(ve))return L(ve);if(ve==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ve);if(xe(ve,ArrayBuffer)||ve&&xe(ve.buffer,ArrayBuffer))return I(ve,te,se);if(typeof ve=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var Ie=ve.valueOf&&ve.valueOf();if(Ie!=null&&Ie!==ve)return _.from(Ie,te,se);var Ue=F(ve);if(Ue)return Ue;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ve[Symbol.toPrimitive]=="function")return _.from(ve[Symbol.toPrimitive]("string"),te,se);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ve)}_.from=function(ve,te,se){return x(ve,te,se)},_.prototype.__proto__=Uint8Array.prototype,_.__proto__=Uint8Array;function b(ve){if(typeof ve!="number")throw new TypeError('"size" argument must be of type number');if(ve<0)throw new RangeError('The value "'+ve+'" is invalid for option "size"')}function M(ve,te,se){return b(ve),ve<=0?g(ve):te!==void 0?typeof se=="string"?g(ve).fill(te,se):g(ve).fill(te):g(ve)}_.alloc=function(ve,te,se){return M(ve,te,se)};function P(ve){return b(ve),g(ve<0?0:N(ve)|0)}_.allocUnsafe=function(ve){return P(ve)},_.allocUnsafeSlow=function(ve){return P(ve)};function k(ve,te){if((typeof te!="string"||te==="")&&(te="utf8"),!_.isEncoding(te))throw new TypeError("Unknown encoding: "+te);var se=Y(ve,te)|0,Ie=g(se),Ue=Ie.write(ve,te);return Ue!==se&&(Ie=Ie.slice(0,Ue)),Ie}function L(ve){for(var te=ve.length<0?0:N(ve.length)|0,se=g(te),Ie=0;Ie<te;Ie+=1)se[Ie]=ve[Ie]&255;return se}function I(ve,te,se){if(te<0||ve.byteLength<te)throw new RangeError('"offset" is outside of buffer bounds');if(ve.byteLength<te+(se||0))throw new RangeError('"length" is outside of buffer bounds');var Ie;return te===void 0&&se===void 0?Ie=new Uint8Array(ve):se===void 0?Ie=new Uint8Array(ve,te):Ie=new Uint8Array(ve,te,se),Ie.__proto__=_.prototype,Ie}function F(ve){if(_.isBuffer(ve)){var te=N(ve.length)|0,se=g(te);return se.length===0||ve.copy(se,0,0,te),se}if(ve.length!==void 0)return typeof ve.length!="number"||ft(ve.length)?g(0):L(ve);if(ve.type==="Buffer"&&Array.isArray(ve.data))return L(ve.data)}function N(ve){if(ve>=f)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f.toString(16)+" bytes");return ve|0}function H(ve){return+ve!=ve&&(ve=0),_.alloc(+ve)}_.isBuffer=function(te){return te!=null&&te._isBuffer===!0&&te!==_.prototype},_.compare=function(te,se){if(xe(te,Uint8Array)&&(te=_.from(te,te.offset,te.byteLength)),xe(se,Uint8Array)&&(se=_.from(se,se.offset,se.byteLength)),!_.isBuffer(te)||!_.isBuffer(se))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(te===se)return 0;for(var Ie=te.length,Ue=se.length,ct=0,we=Math.min(Ie,Ue);ct<we;++ct)if(te[ct]!==se[ct]){Ie=te[ct],Ue=se[ct];break}return Ie<Ue?-1:Ue<Ie?1:0},_.isEncoding=function(te){switch(String(te).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.concat=function(te,se){if(!Array.isArray(te))throw new TypeError('"list" argument must be an Array of Buffers');if(te.length===0)return _.alloc(0);var Ie;if(se===void 0)for(se=0,Ie=0;Ie<te.length;++Ie)se+=te[Ie].length;var Ue=_.allocUnsafe(se),ct=0;for(Ie=0;Ie<te.length;++Ie){var we=te[Ie];if(xe(we,Uint8Array)&&(we=_.from(we)),!_.isBuffer(we))throw new TypeError('"list" argument must be an Array of Buffers');we.copy(Ue,ct),ct+=we.length}return Ue};function Y(ve,te){if(_.isBuffer(ve))return ve.length;if(ArrayBuffer.isView(ve)||xe(ve,ArrayBuffer))return ve.byteLength;if(typeof ve!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ve);var se=ve.length,Ie=arguments.length>2&&arguments[2]===!0;if(!Ie&&se===0)return 0;for(var Ue=!1;;)switch(te){case"ascii":case"latin1":case"binary":return se;case"utf8":case"utf-8":return bt(ve).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return se*2;case"hex":return se>>>1;case"base64":return Pt(ve).length;default:if(Ue)return Ie?-1:bt(ve).length;te=(""+te).toLowerCase(),Ue=!0}}_.byteLength=Y;function q(ve,te,se){var Ie=!1;if((te===void 0||te<0)&&(te=0),te>this.length||((se===void 0||se>this.length)&&(se=this.length),se<=0)||(se>>>=0,te>>>=0,se<=te))return"";for(ve||(ve="utf8");;)switch(ve){case"hex":return et(this,te,se);case"utf8":case"utf-8":return Te(this,te,se);case"ascii":return Ke(this,te,se);case"latin1":case"binary":return dt(this,te,se);case"base64":return fe(this,te,se);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Oe(this,te,se);default:if(Ie)throw new TypeError("Unknown encoding: "+ve);ve=(ve+"").toLowerCase(),Ie=!0}}_.prototype._isBuffer=!0;function U(ve,te,se){var Ie=ve[te];ve[te]=ve[se],ve[se]=Ie}_.prototype.swap16=function(){var te=this.length;if(te%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var se=0;se<te;se+=2)U(this,se,se+1);return this},_.prototype.swap32=function(){var te=this.length;if(te%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var se=0;se<te;se+=4)U(this,se,se+3),U(this,se+1,se+2);return this},_.prototype.swap64=function(){var te=this.length;if(te%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var se=0;se<te;se+=8)U(this,se,se+7),U(this,se+1,se+6),U(this,se+2,se+5),U(this,se+3,se+4);return this},_.prototype.toString=function(){var te=this.length;return te===0?"":arguments.length===0?Te(this,0,te):q.apply(this,arguments)},_.prototype.toLocaleString=_.prototype.toString,_.prototype.equals=function(te){if(!_.isBuffer(te))throw new TypeError("Argument must be a Buffer");return this===te?!0:_.compare(this,te)===0},_.prototype.inspect=function(){var te="",se=r.INSPECT_MAX_BYTES;return te=this.toString("hex",0,se).replace(/(.{2})/g,"$1 ").trim(),this.length>se&&(te+=" ... "),"<Buffer "+te+">"},_.prototype.compare=function(te,se,Ie,Ue,ct){if(xe(te,Uint8Array)&&(te=_.from(te,te.offset,te.byteLength)),!_.isBuffer(te))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof te);if(se===void 0&&(se=0),Ie===void 0&&(Ie=te?te.length:0),Ue===void 0&&(Ue=0),ct===void 0&&(ct=this.length),se<0||Ie>te.length||Ue<0||ct>this.length)throw new RangeError("out of range index");if(Ue>=ct&&se>=Ie)return 0;if(Ue>=ct)return-1;if(se>=Ie)return 1;if(se>>>=0,Ie>>>=0,Ue>>>=0,ct>>>=0,this===te)return 0;for(var we=ct-Ue,Q=Ie-se,ue=Math.min(we,Q),de=this.slice(Ue,ct),Pe=te.slice(se,Ie),Re=0;Re<ue;++Re)if(de[Re]!==Pe[Re]){we=de[Re],Q=Pe[Re];break}return we<Q?-1:Q<we?1:0};function G(ve,te,se,Ie,Ue){if(ve.length===0)return-1;if(typeof se=="string"?(Ie=se,se=0):se>2147483647?se=2147483647:se<-2147483648&&(se=-2147483648),se=+se,ft(se)&&(se=Ue?0:ve.length-1),se<0&&(se=ve.length+se),se>=ve.length){if(Ue)return-1;se=ve.length-1}else if(se<0)if(Ue)se=0;else return-1;if(typeof te=="string"&&(te=_.from(te,Ie)),_.isBuffer(te))return te.length===0?-1:j(ve,te,se,Ie,Ue);if(typeof te=="number")return te=te&255,typeof Uint8Array.prototype.indexOf=="function"?Ue?Uint8Array.prototype.indexOf.call(ve,te,se):Uint8Array.prototype.lastIndexOf.call(ve,te,se):j(ve,[te],se,Ie,Ue);throw new TypeError("val must be string, number or Buffer")}function j(ve,te,se,Ie,Ue){var ct=1,we=ve.length,Q=te.length;if(Ie!==void 0&&(Ie=String(Ie).toLowerCase(),Ie==="ucs2"||Ie==="ucs-2"||Ie==="utf16le"||Ie==="utf-16le")){if(ve.length<2||te.length<2)return-1;ct=2,we/=2,Q/=2,se/=2}function ue(ot,Xe){return ct===1?ot[Xe]:ot.readUInt16BE(Xe*ct)}var de;if(Ue){var Pe=-1;for(de=se;de<we;de++)if(ue(ve,de)===ue(te,Pe===-1?0:de-Pe)){if(Pe===-1&&(Pe=de),de-Pe+1===Q)return Pe*ct}else Pe!==-1&&(de-=de-Pe),Pe=-1}else for(se+Q>we&&(se=we-Q),de=se;de>=0;de--){for(var Re=!0,rt=0;rt<Q;rt++)if(ue(ve,de+rt)!==ue(te,rt)){Re=!1;break}if(Re)return de}return-1}_.prototype.includes=function(te,se,Ie){return this.indexOf(te,se,Ie)!==-1},_.prototype.indexOf=function(te,se,Ie){return G(this,te,se,Ie,!0)},_.prototype.lastIndexOf=function(te,se,Ie){return G(this,te,se,Ie,!1)};function B(ve,te,se,Ie){se=Number(se)||0;var Ue=ve.length-se;Ie?(Ie=Number(Ie),Ie>Ue&&(Ie=Ue)):Ie=Ue;var ct=te.length;Ie>ct/2&&(Ie=ct/2);for(var we=0;we<Ie;++we){var Q=parseInt(te.substr(we*2,2),16);if(ft(Q))return we;ve[se+we]=Q}return we}function ne(ve,te,se,Ie){return Ee(bt(te,ve.length-se),ve,se,Ie)}function J(ve,te,se,Ie){return Ee(Mt(te),ve,se,Ie)}function le(ve,te,se,Ie){return J(ve,te,se,Ie)}function ae(ve,te,se,Ie){return Ee(Pt(te),ve,se,Ie)}function pe(ve,te,se,Ie){return Ee(Zt(te,ve.length-se),ve,se,Ie)}_.prototype.write=function(te,se,Ie,Ue){if(se===void 0)Ue="utf8",Ie=this.length,se=0;else if(Ie===void 0&&typeof se=="string")Ue=se,Ie=this.length,se=0;else if(isFinite(se))se=se>>>0,isFinite(Ie)?(Ie=Ie>>>0,Ue===void 0&&(Ue="utf8")):(Ue=Ie,Ie=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var ct=this.length-se;if((Ie===void 0||Ie>ct)&&(Ie=ct),te.length>0&&(Ie<0||se<0)||se>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ue||(Ue="utf8");for(var we=!1;;)switch(Ue){case"hex":return B(this,te,se,Ie);case"utf8":case"utf-8":return ne(this,te,se,Ie);case"ascii":return J(this,te,se,Ie);case"latin1":case"binary":return le(this,te,se,Ie);case"base64":return ae(this,te,se,Ie);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pe(this,te,se,Ie);default:if(we)throw new TypeError("Unknown encoding: "+Ue);Ue=(""+Ue).toLowerCase(),we=!0}},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function fe(ve,te,se){return te===0&&se===ve.length?c.fromByteArray(ve):c.fromByteArray(ve.slice(te,se))}function Te(ve,te,se){se=Math.min(ve.length,se);for(var Ie=[],Ue=te;Ue<se;){var ct=ve[Ue],we=null,Q=ct>239?4:ct>223?3:ct>191?2:1;if(Ue+Q<=se){var ue,de,Pe,Re;switch(Q){case 1:ct<128&&(we=ct);break;case 2:ue=ve[Ue+1],(ue&192)===128&&(Re=(ct&31)<<6|ue&63,Re>127&&(we=Re));break;case 3:ue=ve[Ue+1],de=ve[Ue+2],(ue&192)===128&&(de&192)===128&&(Re=(ct&15)<<12|(ue&63)<<6|de&63,Re>2047&&(Re<55296||Re>57343)&&(we=Re));break;case 4:ue=ve[Ue+1],de=ve[Ue+2],Pe=ve[Ue+3],(ue&192)===128&&(de&192)===128&&(Pe&192)===128&&(Re=(ct&15)<<18|(ue&63)<<12|(de&63)<<6|Pe&63,Re>65535&&Re<1114112&&(we=Re))}}we===null?(we=65533,Q=1):we>65535&&(we-=65536,Ie.push(we>>>10&1023|55296),we=56320|we&1023),Ie.push(we),Ue+=Q}return tt(Ie)}var Ce=4096;function tt(ve){var te=ve.length;if(te<=Ce)return String.fromCharCode.apply(String,ve);for(var se="",Ie=0;Ie<te;)se+=String.fromCharCode.apply(String,ve.slice(Ie,Ie+=Ce));return se}function Ke(ve,te,se){var Ie="";se=Math.min(ve.length,se);for(var Ue=te;Ue<se;++Ue)Ie+=String.fromCharCode(ve[Ue]&127);return Ie}function dt(ve,te,se){var Ie="";se=Math.min(ve.length,se);for(var Ue=te;Ue<se;++Ue)Ie+=String.fromCharCode(ve[Ue]);return Ie}function et(ve,te,se){var Ie=ve.length;(!te||te<0)&&(te=0),(!se||se<0||se>Ie)&&(se=Ie);for(var Ue="",ct=te;ct<se;++ct)Ue+=Ze(ve[ct]);return Ue}function Oe(ve,te,se){for(var Ie=ve.slice(te,se),Ue="",ct=0;ct<Ie.length;ct+=2)Ue+=String.fromCharCode(Ie[ct]+Ie[ct+1]*256);return Ue}_.prototype.slice=function(te,se){var Ie=this.length;te=~~te,se=se===void 0?Ie:~~se,te<0?(te+=Ie,te<0&&(te=0)):te>Ie&&(te=Ie),se<0?(se+=Ie,se<0&&(se=0)):se>Ie&&(se=Ie),se<te&&(se=te);var Ue=this.subarray(te,se);return Ue.__proto__=_.prototype,Ue};function lt(ve,te,se){if(ve%1!==0||ve<0)throw new RangeError("offset is not uint");if(ve+te>se)throw new RangeError("Trying to access beyond buffer length")}_.prototype.readUIntLE=function(te,se,Ie){te=te>>>0,se=se>>>0,Ie||lt(te,se,this.length);for(var Ue=this[te],ct=1,we=0;++we<se&&(ct*=256);)Ue+=this[te+we]*ct;return Ue},_.prototype.readUIntBE=function(te,se,Ie){te=te>>>0,se=se>>>0,Ie||lt(te,se,this.length);for(var Ue=this[te+--se],ct=1;se>0&&(ct*=256);)Ue+=this[te+--se]*ct;return Ue},_.prototype.readUInt8=function(te,se){return te=te>>>0,se||lt(te,1,this.length),this[te]},_.prototype.readUInt16LE=function(te,se){return te=te>>>0,se||lt(te,2,this.length),this[te]|this[te+1]<<8},_.prototype.readUInt16BE=function(te,se){return te=te>>>0,se||lt(te,2,this.length),this[te]<<8|this[te+1]},_.prototype.readUInt32LE=function(te,se){return te=te>>>0,se||lt(te,4,this.length),(this[te]|this[te+1]<<8|this[te+2]<<16)+this[te+3]*16777216},_.prototype.readUInt32BE=function(te,se){return te=te>>>0,se||lt(te,4,this.length),this[te]*16777216+(this[te+1]<<16|this[te+2]<<8|this[te+3])},_.prototype.readIntLE=function(te,se,Ie){te=te>>>0,se=se>>>0,Ie||lt(te,se,this.length);for(var Ue=this[te],ct=1,we=0;++we<se&&(ct*=256);)Ue+=this[te+we]*ct;return ct*=128,Ue>=ct&&(Ue-=Math.pow(2,8*se)),Ue},_.prototype.readIntBE=function(te,se,Ie){te=te>>>0,se=se>>>0,Ie||lt(te,se,this.length);for(var Ue=se,ct=1,we=this[te+--Ue];Ue>0&&(ct*=256);)we+=this[te+--Ue]*ct;return ct*=128,we>=ct&&(we-=Math.pow(2,8*se)),we},_.prototype.readInt8=function(te,se){return te=te>>>0,se||lt(te,1,this.length),this[te]&128?(255-this[te]+1)*-1:this[te]},_.prototype.readInt16LE=function(te,se){te=te>>>0,se||lt(te,2,this.length);var Ie=this[te]|this[te+1]<<8;return Ie&32768?Ie|4294901760:Ie},_.prototype.readInt16BE=function(te,se){te=te>>>0,se||lt(te,2,this.length);var Ie=this[te+1]|this[te]<<8;return Ie&32768?Ie|4294901760:Ie},_.prototype.readInt32LE=function(te,se){return te=te>>>0,se||lt(te,4,this.length),this[te]|this[te+1]<<8|this[te+2]<<16|this[te+3]<<24},_.prototype.readInt32BE=function(te,se){return te=te>>>0,se||lt(te,4,this.length),this[te]<<24|this[te+1]<<16|this[te+2]<<8|this[te+3]},_.prototype.readFloatLE=function(te,se){return te=te>>>0,se||lt(te,4,this.length),s.read(this,te,!0,23,4)},_.prototype.readFloatBE=function(te,se){return te=te>>>0,se||lt(te,4,this.length),s.read(this,te,!1,23,4)},_.prototype.readDoubleLE=function(te,se){return te=te>>>0,se||lt(te,8,this.length),s.read(this,te,!0,52,8)},_.prototype.readDoubleBE=function(te,se){return te=te>>>0,se||lt(te,8,this.length),s.read(this,te,!1,52,8)};function Ye(ve,te,se,Ie,Ue,ct){if(!_.isBuffer(ve))throw new TypeError('"buffer" argument must be a Buffer instance');if(te>Ue||te<ct)throw new RangeError('"value" argument is out of bounds');if(se+Ie>ve.length)throw new RangeError("Index out of range")}_.prototype.writeUIntLE=function(te,se,Ie,Ue){if(te=+te,se=se>>>0,Ie=Ie>>>0,!Ue){var ct=Math.pow(2,8*Ie)-1;Ye(this,te,se,Ie,ct,0)}var we=1,Q=0;for(this[se]=te&255;++Q<Ie&&(we*=256);)this[se+Q]=te/we&255;return se+Ie},_.prototype.writeUIntBE=function(te,se,Ie,Ue){if(te=+te,se=se>>>0,Ie=Ie>>>0,!Ue){var ct=Math.pow(2,8*Ie)-1;Ye(this,te,se,Ie,ct,0)}var we=Ie-1,Q=1;for(this[se+we]=te&255;--we>=0&&(Q*=256);)this[se+we]=te/Q&255;return se+Ie},_.prototype.writeUInt8=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,1,255,0),this[se]=te&255,se+1},_.prototype.writeUInt16LE=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,2,65535,0),this[se]=te&255,this[se+1]=te>>>8,se+2},_.prototype.writeUInt16BE=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,2,65535,0),this[se]=te>>>8,this[se+1]=te&255,se+2},_.prototype.writeUInt32LE=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,4,4294967295,0),this[se+3]=te>>>24,this[se+2]=te>>>16,this[se+1]=te>>>8,this[se]=te&255,se+4},_.prototype.writeUInt32BE=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,4,4294967295,0),this[se]=te>>>24,this[se+1]=te>>>16,this[se+2]=te>>>8,this[se+3]=te&255,se+4},_.prototype.writeIntLE=function(te,se,Ie,Ue){if(te=+te,se=se>>>0,!Ue){var ct=Math.pow(2,8*Ie-1);Ye(this,te,se,Ie,ct-1,-ct)}var we=0,Q=1,ue=0;for(this[se]=te&255;++we<Ie&&(Q*=256);)te<0&&ue===0&&this[se+we-1]!==0&&(ue=1),this[se+we]=(te/Q>>0)-ue&255;return se+Ie},_.prototype.writeIntBE=function(te,se,Ie,Ue){if(te=+te,se=se>>>0,!Ue){var ct=Math.pow(2,8*Ie-1);Ye(this,te,se,Ie,ct-1,-ct)}var we=Ie-1,Q=1,ue=0;for(this[se+we]=te&255;--we>=0&&(Q*=256);)te<0&&ue===0&&this[se+we+1]!==0&&(ue=1),this[se+we]=(te/Q>>0)-ue&255;return se+Ie},_.prototype.writeInt8=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,1,127,-128),te<0&&(te=255+te+1),this[se]=te&255,se+1},_.prototype.writeInt16LE=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,2,32767,-32768),this[se]=te&255,this[se+1]=te>>>8,se+2},_.prototype.writeInt16BE=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,2,32767,-32768),this[se]=te>>>8,this[se+1]=te&255,se+2},_.prototype.writeInt32LE=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,4,2147483647,-2147483648),this[se]=te&255,this[se+1]=te>>>8,this[se+2]=te>>>16,this[se+3]=te>>>24,se+4},_.prototype.writeInt32BE=function(te,se,Ie){return te=+te,se=se>>>0,Ie||Ye(this,te,se,4,2147483647,-2147483648),te<0&&(te=4294967295+te+1),this[se]=te>>>24,this[se+1]=te>>>16,this[se+2]=te>>>8,this[se+3]=te&255,se+4};function zt(ve,te,se,Ie,Ue,ct){if(se+Ie>ve.length)throw new RangeError("Index out of range");if(se<0)throw new RangeError("Index out of range")}function Lt(ve,te,se,Ie,Ue){return te=+te,se=se>>>0,Ue||zt(ve,te,se,4),s.write(ve,te,se,Ie,23,4),se+4}_.prototype.writeFloatLE=function(te,se,Ie){return Lt(this,te,se,!0,Ie)},_.prototype.writeFloatBE=function(te,se,Ie){return Lt(this,te,se,!1,Ie)};function At(ve,te,se,Ie,Ue){return te=+te,se=se>>>0,Ue||zt(ve,te,se,8),s.write(ve,te,se,Ie,52,8),se+8}_.prototype.writeDoubleLE=function(te,se,Ie){return At(this,te,se,!0,Ie)},_.prototype.writeDoubleBE=function(te,se,Ie){return At(this,te,se,!1,Ie)},_.prototype.copy=function(te,se,Ie,Ue){if(!_.isBuffer(te))throw new TypeError("argument should be a Buffer");if(Ie||(Ie=0),!Ue&&Ue!==0&&(Ue=this.length),se>=te.length&&(se=te.length),se||(se=0),Ue>0&&Ue<Ie&&(Ue=Ie),Ue===Ie||te.length===0||this.length===0)return 0;if(se<0)throw new RangeError("targetStart out of bounds");if(Ie<0||Ie>=this.length)throw new RangeError("Index out of range");if(Ue<0)throw new RangeError("sourceEnd out of bounds");Ue>this.length&&(Ue=this.length),te.length-se<Ue-Ie&&(Ue=te.length-se+Ie);var ct=Ue-Ie;if(this===te&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(se,Ie,Ue);else if(this===te&&Ie<se&&se<Ue)for(var we=ct-1;we>=0;--we)te[we+se]=this[we+Ie];else Uint8Array.prototype.set.call(te,this.subarray(Ie,Ue),se);return ct},_.prototype.fill=function(te,se,Ie,Ue){if(typeof te=="string"){if(typeof se=="string"?(Ue=se,se=0,Ie=this.length):typeof Ie=="string"&&(Ue=Ie,Ie=this.length),Ue!==void 0&&typeof Ue!="string")throw new TypeError("encoding must be a string");if(typeof Ue=="string"&&!_.isEncoding(Ue))throw new TypeError("Unknown encoding: "+Ue);if(te.length===1){var ct=te.charCodeAt(0);(Ue==="utf8"&&ct<128||Ue==="latin1")&&(te=ct)}}else typeof te=="number"&&(te=te&255);if(se<0||this.length<se||this.length<Ie)throw new RangeError("Out of range index");if(Ie<=se)return this;se=se>>>0,Ie=Ie===void 0?this.length:Ie>>>0,te||(te=0);var we;if(typeof te=="number")for(we=se;we<Ie;++we)this[we]=te;else{var Q=_.isBuffer(te)?te:_.from(te,Ue),ue=Q.length;if(ue===0)throw new TypeError('The value "'+te+'" is invalid for argument "value"');for(we=0;we<Ie-se;++we)this[we+se]=Q[we%ue]}return this};var Nt=/[^+/0-9A-Za-z-_]/g;function $t(ve){if(ve=ve.split("=")[0],ve=ve.trim().replace(Nt,""),ve.length<2)return"";for(;ve.length%4!==0;)ve=ve+"=";return ve}function Ze(ve){return ve<16?"0"+ve.toString(16):ve.toString(16)}function bt(ve,te){te=te||1/0;for(var se,Ie=ve.length,Ue=null,ct=[],we=0;we<Ie;++we){if(se=ve.charCodeAt(we),se>55295&&se<57344){if(!Ue){if(se>56319){(te-=3)>-1&&ct.push(239,191,189);continue}else if(we+1===Ie){(te-=3)>-1&&ct.push(239,191,189);continue}Ue=se;continue}if(se<56320){(te-=3)>-1&&ct.push(239,191,189),Ue=se;continue}se=(Ue-55296<<10|se-56320)+65536}else Ue&&(te-=3)>-1&&ct.push(239,191,189);if(Ue=null,se<128){if((te-=1)<0)break;ct.push(se)}else if(se<2048){if((te-=2)<0)break;ct.push(se>>6|192,se&63|128)}else if(se<65536){if((te-=3)<0)break;ct.push(se>>12|224,se>>6&63|128,se&63|128)}else if(se<1114112){if((te-=4)<0)break;ct.push(se>>18|240,se>>12&63|128,se>>6&63|128,se&63|128)}else throw new Error("Invalid code point")}return ct}function Mt(ve){for(var te=[],se=0;se<ve.length;++se)te.push(ve.charCodeAt(se)&255);return te}function Zt(ve,te){for(var se,Ie,Ue,ct=[],we=0;we<ve.length&&!((te-=2)<0);++we)se=ve.charCodeAt(we),Ie=se>>8,Ue=se%256,ct.push(Ue),ct.push(Ie);return ct}function Pt(ve){return c.toByteArray($t(ve))}function Ee(ve,te,se,Ie){for(var Ue=0;Ue<Ie&&!(Ue+se>=te.length||Ue>=ve.length);++Ue)te[Ue+se]=ve[Ue];return Ue}function xe(ve,te){return ve instanceof te||ve!=null&&ve.constructor!=null&&ve.constructor.name!=null&&ve.constructor.name===te.name}function ft(ve){return ve!==ve}}).call(this)}).call(this,t("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:14}],3:[function(t,i,r){const o=t("./validator"),c=t("./xmlparser/XMLParser"),s=t("./xmlbuilder/json2xml");i.exports={XMLParser:c,XMLValidator:o,XMLBuilder:s}},{"./validator":5,"./xmlbuilder/json2xml":6,"./xmlparser/XMLParser":11}],4:[function(t,i,r){const o=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",c=o+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+o+"]["+c+"]*",f=new RegExp("^"+s+"$"),p=function(_,x){const b=[];let M=x.exec(_);for(;M;){const P=[];P.startIndex=x.lastIndex-M[0].length;const k=M.length;for(let L=0;L<k;L++)P.push(M[L]);b.push(P),M=x.exec(_)}return b},g=function(_){const x=f.exec(_);return!(x===null||typeof x>"u")};r.isExist=function(_){return typeof _<"u"},r.isEmptyObject=function(_){return Object.keys(_).length===0},r.merge=function(_,x,b){if(x){const M=Object.keys(x),P=M.length;for(let k=0;k<P;k++)b==="strict"?_[M[k]]=[x[M[k]]]:_[M[k]]=x[M[k]]}},r.getValue=function(_){return r.isExist(_)?_:""},r.isName=g,r.getAllMatches=p,r.nameRegexp=s},{}],5:[function(t,i,r){const o=t("./util"),c={allowBooleanAttributes:!1,unpairedTags:[]};r.validate=function(Y,q){q=Object.assign({},c,q);const U=[];let G=!1,j=!1;Y[0]==="\uFEFF"&&(Y=Y.substr(1));for(let B=0;B<Y.length;B++)if(Y[B]==="<"&&Y[B+1]==="?"){if(B+=2,B=f(Y,B),B.err)return B}else if(Y[B]==="<"){let ne=B;if(B++,Y[B]==="!"){B=p(Y,B);continue}else{let J=!1;Y[B]==="/"&&(J=!0,B++);let le="";for(;B<Y.length&&Y[B]!==">"&&Y[B]!==" "&&Y[B]!=="	"&&Y[B]!==`
`&&Y[B]!=="\r";B++)le+=Y[B];if(le=le.trim(),le[le.length-1]==="/"&&(le=le.substring(0,le.length-1),B--),!F(le)){let fe;return le.trim().length===0?fe="Invalid space after '<'.":fe="Tag '"+le+"' is an invalid name.",L("InvalidTag",fe,N(Y,B))}const ae=x(Y,B);if(ae===!1)return L("InvalidAttr","Attributes for '"+le+"' have open quote.",N(Y,B));let pe=ae.value;if(B=ae.index,pe[pe.length-1]==="/"){const fe=B-pe.length;pe=pe.substring(0,pe.length-1);const Te=M(pe,q);if(Te===!0)G=!0;else return L(Te.err.code,Te.err.msg,N(Y,fe+Te.err.line))}else if(J)if(ae.tagClosed){if(pe.trim().length>0)return L("InvalidTag","Closing tag '"+le+"' can't have attributes or invalid starting.",N(Y,ne));if(U.length===0)return L("InvalidTag","Closing tag '"+le+"' has not been opened.",N(Y,ne));{const fe=U.pop();if(le!==fe.tagName){let Te=N(Y,fe.tagStartPos);return L("InvalidTag","Expected closing tag '"+fe.tagName+"' (opened in line "+Te.line+", col "+Te.col+") instead of closing tag '"+le+"'.",N(Y,ne))}U.length==0&&(j=!0)}}else return L("InvalidTag","Closing tag '"+le+"' doesn't have proper closing.",N(Y,B));else{const fe=M(pe,q);if(fe!==!0)return L(fe.err.code,fe.err.msg,N(Y,B-pe.length+fe.err.line));if(j===!0)return L("InvalidXml","Multiple possible root nodes found.",N(Y,B));q.unpairedTags.indexOf(le)!==-1||U.push({tagName:le,tagStartPos:ne}),G=!0}for(B++;B<Y.length;B++)if(Y[B]==="<")if(Y[B+1]==="!"){B++,B=p(Y,B);continue}else if(Y[B+1]==="?"){if(B=f(Y,++B),B.err)return B}else break;else if(Y[B]==="&"){const fe=k(Y,B);if(fe==-1)return L("InvalidChar","char '&' is not expected.",N(Y,B));B=fe}else if(j===!0&&!s(Y[B]))return L("InvalidXml","Extra text at the end",N(Y,B));Y[B]==="<"&&B--}}else{if(s(Y[B]))continue;return L("InvalidChar","char '"+Y[B]+"' is not expected.",N(Y,B))}if(G){if(U.length==1)return L("InvalidTag","Unclosed tag '"+U[0].tagName+"'.",N(Y,U[0].tagStartPos));if(U.length>0)return L("InvalidXml","Invalid '"+JSON.stringify(U.map(B=>B.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return L("InvalidXml","Start tag expected.",1);return!0};function s(Y){return Y===" "||Y==="	"||Y===`
`||Y==="\r"}function f(Y,q){const U=q;for(;q<Y.length;q++)if(Y[q]=="?"||Y[q]==" "){const G=Y.substr(U,q-U);if(q>5&&G==="xml")return L("InvalidXml","XML declaration allowed only at the start of the document.",N(Y,q));if(Y[q]=="?"&&Y[q+1]==">"){q++;break}else continue}return q}function p(Y,q){if(Y.length>q+5&&Y[q+1]==="-"&&Y[q+2]==="-"){for(q+=3;q<Y.length;q++)if(Y[q]==="-"&&Y[q+1]==="-"&&Y[q+2]===">"){q+=2;break}}else if(Y.length>q+8&&Y[q+1]==="D"&&Y[q+2]==="O"&&Y[q+3]==="C"&&Y[q+4]==="T"&&Y[q+5]==="Y"&&Y[q+6]==="P"&&Y[q+7]==="E"){let U=1;for(q+=8;q<Y.length;q++)if(Y[q]==="<")U++;else if(Y[q]===">"&&(U--,U===0))break}else if(Y.length>q+9&&Y[q+1]==="["&&Y[q+2]==="C"&&Y[q+3]==="D"&&Y[q+4]==="A"&&Y[q+5]==="T"&&Y[q+6]==="A"&&Y[q+7]==="["){for(q+=8;q<Y.length;q++)if(Y[q]==="]"&&Y[q+1]==="]"&&Y[q+2]===">"){q+=2;break}}return q}const g='"',_="'";function x(Y,q){let U="",G="",j=!1;for(;q<Y.length;q++){if(Y[q]===g||Y[q]===_)G===""?G=Y[q]:G!==Y[q]||(G="");else if(Y[q]===">"&&G===""){j=!0;break}U+=Y[q]}return G!==""?!1:{value:U,index:q,tagClosed:j}}const b=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function M(Y,q){const U=o.getAllMatches(Y,b),G={};for(let j=0;j<U.length;j++){if(U[j][1].length===0)return L("InvalidAttr","Attribute '"+U[j][2]+"' has no space in starting.",H(U[j]));if(U[j][3]!==void 0&&U[j][4]===void 0)return L("InvalidAttr","Attribute '"+U[j][2]+"' is without value.",H(U[j]));if(U[j][3]===void 0&&!q.allowBooleanAttributes)return L("InvalidAttr","boolean attribute '"+U[j][2]+"' is not allowed.",H(U[j]));const B=U[j][2];if(!I(B))return L("InvalidAttr","Attribute '"+B+"' is an invalid name.",H(U[j]));if(!G.hasOwnProperty(B))G[B]=1;else return L("InvalidAttr","Attribute '"+B+"' is repeated.",H(U[j]))}return!0}function P(Y,q){let U=/\d/;for(Y[q]==="x"&&(q++,U=/[\da-fA-F]/);q<Y.length;q++){if(Y[q]===";")return q;if(!Y[q].match(U))break}return-1}function k(Y,q){if(q++,Y[q]===";")return-1;if(Y[q]==="#")return q++,P(Y,q);let U=0;for(;q<Y.length;q++,U++)if(!(Y[q].match(/\w/)&&U<20)){if(Y[q]===";")break;return-1}return q}function L(Y,q,U){return{err:{code:Y,msg:q,line:U.line||U,col:U.col}}}function I(Y){return o.isName(Y)}function F(Y){return o.isName(Y)}function N(Y,q){const U=Y.substring(0,q).split(/\r?\n/);return{line:U.length,col:U[U.length-1].length+1}}function H(Y){return Y.startIndex+Y[1].length}},{"./util":4}],6:[function(t,i,r){const o=t("./orderedJs2Xml"),c={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(_,x){return x},attributeValueProcessor:function(_,x){return x},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function s(_){this.options=Object.assign({},c,_),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=g),this.processTextOrObjNode=f,this.options.format?(this.indentate=p,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}s.prototype.build=function(_){return this.options.preserveOrder?o(_,this.options):(Array.isArray(_)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(_={[this.options.arrayNodeName]:_}),this.j2x(_,0).val)},s.prototype.j2x=function(_,x){let b="",M="";for(let P in _)if(Object.prototype.hasOwnProperty.call(_,P))if(typeof _[P]>"u")this.isAttribute(P)&&(M+="");else if(_[P]===null)this.isAttribute(P)?M+="":P[0]==="?"?M+=this.indentate(x)+"<"+P+"?"+this.tagEndChar:M+=this.indentate(x)+"<"+P+"/"+this.tagEndChar;else if(_[P]instanceof Date)M+=this.buildTextValNode(_[P],P,"",x);else if(typeof _[P]!="object"){const k=this.isAttribute(P);if(k)b+=this.buildAttrPairStr(k,""+_[P]);else if(P===this.options.textNodeName){let L=this.options.tagValueProcessor(P,""+_[P]);M+=this.replaceEntitiesValue(L)}else M+=this.buildTextValNode(_[P],P,"",x)}else if(Array.isArray(_[P])){const k=_[P].length;let L="",I="";for(let F=0;F<k;F++){const N=_[P][F];if(!(typeof N>"u"))if(N===null)P[0]==="?"?M+=this.indentate(x)+"<"+P+"?"+this.tagEndChar:M+=this.indentate(x)+"<"+P+"/"+this.tagEndChar;else if(typeof N=="object")if(this.options.oneListGroup){const H=this.j2x(N,x+1);L+=H.val,this.options.attributesGroupName&&N.hasOwnProperty(this.options.attributesGroupName)&&(I+=H.attrStr)}else L+=this.processTextOrObjNode(N,P,x);else if(this.options.oneListGroup){let H=this.options.tagValueProcessor(P,N);H=this.replaceEntitiesValue(H),L+=H}else L+=this.buildTextValNode(N,P,"",x)}this.options.oneListGroup&&(L=this.buildObjectNode(L,P,I,x)),M+=L}else if(this.options.attributesGroupName&&P===this.options.attributesGroupName){const k=Object.keys(_[P]),L=k.length;for(let I=0;I<L;I++)b+=this.buildAttrPairStr(k[I],""+_[P][k[I]])}else M+=this.processTextOrObjNode(_[P],P,x);return{attrStr:b,val:M}},s.prototype.buildAttrPairStr=function(_,x){return x=this.options.attributeValueProcessor(_,""+x),x=this.replaceEntitiesValue(x),this.options.suppressBooleanAttributes&&x==="true"?" "+_:" "+_+'="'+x+'"'};function f(_,x,b){const M=this.j2x(_,b+1);return _[this.options.textNodeName]!==void 0&&Object.keys(_).length===1?this.buildTextValNode(_[this.options.textNodeName],x,M.attrStr,b):this.buildObjectNode(M.val,x,M.attrStr,b)}s.prototype.buildObjectNode=function(_,x,b,M){if(_==="")return x[0]==="?"?this.indentate(M)+"<"+x+b+"?"+this.tagEndChar:this.indentate(M)+"<"+x+b+this.closeTag(x)+this.tagEndChar;{let P="</"+x+this.tagEndChar,k="";return x[0]==="?"&&(k="?",P=""),(b||b==="")&&_.indexOf("<")===-1?this.indentate(M)+"<"+x+b+k+">"+_+P:this.options.commentPropName!==!1&&x===this.options.commentPropName&&k.length===0?this.indentate(M)+`<!--${_}-->`+this.newLine:this.indentate(M)+"<"+x+b+k+this.tagEndChar+_+this.indentate(M)+P}},s.prototype.closeTag=function(_){let x="";return this.options.unpairedTags.indexOf(_)!==-1?this.options.suppressUnpairedNode||(x="/"):this.options.suppressEmptyNode?x="/":x=`></${_}`,x},s.prototype.buildTextValNode=function(_,x,b,M){if(this.options.cdataPropName!==!1&&x===this.options.cdataPropName)return this.indentate(M)+`<![CDATA[${_}]]>`+this.newLine;if(this.options.commentPropName!==!1&&x===this.options.commentPropName)return this.indentate(M)+`<!--${_}-->`+this.newLine;if(x[0]==="?")return this.indentate(M)+"<"+x+b+"?"+this.tagEndChar;{let P=this.options.tagValueProcessor(x,_);return P=this.replaceEntitiesValue(P),P===""?this.indentate(M)+"<"+x+b+this.closeTag(x)+this.tagEndChar:this.indentate(M)+"<"+x+b+">"+P+"</"+x+this.tagEndChar}},s.prototype.replaceEntitiesValue=function(_){if(_&&_.length>0&&this.options.processEntities)for(let x=0;x<this.options.entities.length;x++){const b=this.options.entities[x];_=_.replace(b.regex,b.val)}return _};function p(_){return this.options.indentBy.repeat(_)}function g(_){return _.startsWith(this.options.attributeNamePrefix)&&_!==this.options.textNodeName?_.substr(this.attrPrefixLen):!1}i.exports=s},{"./orderedJs2Xml":7}],7:[function(t,i,r){function c(x,b){let M="";return b.format&&b.indentBy.length>0&&(M=`
`),s(x,b,"",M)}function s(x,b,M,P){let k="",L=!1;for(let I=0;I<x.length;I++){const F=x[I],N=f(F);if(N===void 0)continue;let H="";if(M.length===0?H=N:H=`${M}.${N}`,N===b.textNodeName){let j=F[N];g(H,b)||(j=b.tagValueProcessor(N,j),j=_(j,b)),L&&(k+=P),k+=j,L=!1;continue}else if(N===b.cdataPropName){L&&(k+=P),k+=`<![CDATA[${F[N][0][b.textNodeName]}]]>`,L=!1;continue}else if(N===b.commentPropName){k+=P+`<!--${F[N][0][b.textNodeName]}-->`,L=!0;continue}else if(N[0]==="?"){const j=p(F[":@"],b),B=N==="?xml"?"":P;let ne=F[N][0][b.textNodeName];ne=ne.length!==0?" "+ne:"",k+=B+`<${N}${ne}${j}?>`,L=!0;continue}let Y=P;Y!==""&&(Y+=b.indentBy);const q=p(F[":@"],b),U=P+`<${N}${q}`,G=s(F[N],b,H,Y);b.unpairedTags.indexOf(N)!==-1?b.suppressUnpairedNode?k+=U+">":k+=U+"/>":(!G||G.length===0)&&b.suppressEmptyNode?k+=U+"/>":G&&G.endsWith(">")?k+=U+`>${G}${P}</${N}>`:(k+=U+">",G&&P!==""&&(G.includes("/>")||G.includes("</"))?k+=P+b.indentBy+G+P:k+=G,k+=`</${N}>`),L=!0}return k}function f(x){const b=Object.keys(x);for(let M=0;M<b.length;M++){const P=b[M];if(x.hasOwnProperty(P)&&P!==":@")return P}}function p(x,b){let M="";if(x&&!b.ignoreAttributes)for(let P in x){if(!x.hasOwnProperty(P))continue;let k=b.attributeValueProcessor(P,x[P]);k=_(k,b),k===!0&&b.suppressBooleanAttributes?M+=` ${P.substr(b.attributeNamePrefix.length)}`:M+=` ${P.substr(b.attributeNamePrefix.length)}="${k}"`}return M}function g(x,b){x=x.substr(0,x.length-b.textNodeName.length-1);let M=x.substr(x.lastIndexOf(".")+1);for(let P in b.stopNodes)if(b.stopNodes[P]===x||b.stopNodes[P]==="*."+M)return!0;return!1}function _(x,b){if(x&&x.length>0&&b.processEntities)for(let M=0;M<b.entities.length;M++){const P=b.entities[M];x=x.replace(P.regex,P.val)}return x}i.exports=c},{}],8:[function(t,i,r){const o=t("../util");function c(M,P){const k={};if(M[P+3]==="O"&&M[P+4]==="C"&&M[P+5]==="T"&&M[P+6]==="Y"&&M[P+7]==="P"&&M[P+8]==="E"){P=P+9;let L=1,I=!1,F=!1,N="";for(;P<M.length;P++)if(M[P]==="<"&&!F){if(I&&p(M,P))P+=7,[entityName,val,P]=s(M,P+1),val.indexOf("&")===-1&&(k[b(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(I&&g(M,P))P+=8;else if(I&&_(M,P))P+=8;else if(I&&x(M,P))P+=9;else if(f)F=!0;else throw new Error("Invalid DOCTYPE");L++,N=""}else if(M[P]===">"){if(F?M[P-1]==="-"&&M[P-2]==="-"&&(F=!1,L--):L--,L===0)break}else M[P]==="["?I=!0:N+=M[P];if(L!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:k,i:P}}function s(M,P){let k="";for(;P<M.length&&M[P]!=="'"&&M[P]!=='"';P++)k+=M[P];if(k=k.trim(),k.indexOf(" ")!==-1)throw new Error("External entites are not supported");const L=M[P++];let I="";for(;P<M.length&&M[P]!==L;P++)I+=M[P];return[k,I,P]}function f(M,P){return M[P+1]==="!"&&M[P+2]==="-"&&M[P+3]==="-"}function p(M,P){return M[P+1]==="!"&&M[P+2]==="E"&&M[P+3]==="N"&&M[P+4]==="T"&&M[P+5]==="I"&&M[P+6]==="T"&&M[P+7]==="Y"}function g(M,P){return M[P+1]==="!"&&M[P+2]==="E"&&M[P+3]==="L"&&M[P+4]==="E"&&M[P+5]==="M"&&M[P+6]==="E"&&M[P+7]==="N"&&M[P+8]==="T"}function _(M,P){return M[P+1]==="!"&&M[P+2]==="A"&&M[P+3]==="T"&&M[P+4]==="T"&&M[P+5]==="L"&&M[P+6]==="I"&&M[P+7]==="S"&&M[P+8]==="T"}function x(M,P){return M[P+1]==="!"&&M[P+2]==="N"&&M[P+3]==="O"&&M[P+4]==="T"&&M[P+5]==="A"&&M[P+6]==="T"&&M[P+7]==="I"&&M[P+8]==="O"&&M[P+9]==="N"}function b(M){if(o.isName(M))return M;throw new Error(`Invalid entity name ${M}`)}i.exports=c},{"../util":4}],9:[function(t,i,r){const o={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,f){return f},attributeValueProcessor:function(s,f){return f},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,f,p){return s}},c=function(s){return Object.assign({},o,s)};r.buildOptions=c,r.defaultOptions=o},{}],10:[function(t,i,r){const o=t("../util"),c=t("./xmlNode"),s=t("./DocTypeReader"),f=t("strnum");class p{constructor(j){this.options=j,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"Â¢"},pound:{regex:/&(pound|#163);/g,val:"Â£"},yen:{regex:/&(yen|#165);/g,val:"Â¥"},euro:{regex:/&(euro|#8364);/g,val:"â¬"},copyright:{regex:/&(copy|#169);/g,val:"Â©"},reg:{regex:/&(reg|#174);/g,val:"Â®"},inr:{regex:/&(inr|#8377);/g,val:"â¹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(B,ne)=>String.fromCharCode(Number.parseInt(ne,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(B,ne)=>String.fromCharCode(Number.parseInt(ne,16))}},this.addExternalEntities=g,this.parseXml=P,this.parseTextData=_,this.resolveNameSpace=x,this.buildAttributesMap=M,this.isItStopNode=F,this.replaceEntitiesValue=L,this.readStopNodeData=q,this.saveTextToParentTag=I,this.addChild=k}}function g(G){const j=Object.keys(G);for(let B=0;B<j.length;B++){const ne=j[B];this.lastEntities[ne]={regex:new RegExp("&"+ne+";","g"),val:G[ne]}}}function _(G,j,B,ne,J,le,ae){if(G!==void 0&&(this.options.trimValues&&!ne&&(G=G.trim()),G.length>0)){ae||(G=this.replaceEntitiesValue(G));const pe=this.options.tagValueProcessor(j,G,B,J,le);return pe==null?G:typeof pe!=typeof G||pe!==G?pe:this.options.trimValues?U(G,this.options.parseTagValue,this.options.numberParseOptions):G.trim()===G?U(G,this.options.parseTagValue,this.options.numberParseOptions):G}}function x(G){if(this.options.removeNSPrefix){const j=G.split(":"),B=G.charAt(0)==="/"?"/":"";if(j[0]==="xmlns")return"";j.length===2&&(G=B+j[1])}return G}const b=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function M(G,j,B){if(!this.options.ignoreAttributes&&typeof G=="string"){const ne=o.getAllMatches(G,b),J=ne.length,le={};for(let ae=0;ae<J;ae++){const pe=this.resolveNameSpace(ne[ae][1]);let fe=ne[ae][4],Te=this.options.attributeNamePrefix+pe;if(pe.length)if(this.options.transformAttributeName&&(Te=this.options.transformAttributeName(Te)),Te==="__proto__"&&(Te="#__proto__"),fe!==void 0){this.options.trimValues&&(fe=fe.trim()),fe=this.replaceEntitiesValue(fe);const Ce=this.options.attributeValueProcessor(pe,fe,j);Ce==null?le[Te]=fe:typeof Ce!=typeof fe||Ce!==fe?le[Te]=Ce:le[Te]=U(fe,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(le[Te]=!0)}if(!Object.keys(le).length)return;if(this.options.attributesGroupName){const ae={};return ae[this.options.attributesGroupName]=le,ae}return le}}const P=function(G){G=G.replace(/\r\n?/g,`
`);const j=new c("!xml");let B=j,ne="",J="";for(let le=0;le<G.length;le++)if(G[le]==="<")if(G[le+1]==="/"){const pe=H(G,">",le,"Closing Tag is not closed.");let fe=G.substring(le+2,pe).trim();if(this.options.removeNSPrefix){const tt=fe.indexOf(":");tt!==-1&&(fe=fe.substr(tt+1))}this.options.transformTagName&&(fe=this.options.transformTagName(fe)),B&&(ne=this.saveTextToParentTag(ne,B,J));const Te=J.substring(J.lastIndexOf(".")+1);if(fe&&this.options.unpairedTags.indexOf(fe)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${fe}>`);let Ce=0;Te&&this.options.unpairedTags.indexOf(Te)!==-1?(Ce=J.lastIndexOf(".",J.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Ce=J.lastIndexOf("."),J=J.substring(0,Ce),B=this.tagsNodeStack.pop(),ne="",le=pe}else if(G[le+1]==="?"){let pe=Y(G,le,!1,"?>");if(!pe)throw new Error("Pi Tag is not closed.");if(ne=this.saveTextToParentTag(ne,B,J),!(this.options.ignoreDeclaration&&pe.tagName==="?xml"||this.options.ignorePiTags)){const fe=new c(pe.tagName);fe.add(this.options.textNodeName,""),pe.tagName!==pe.tagExp&&pe.attrExpPresent&&(fe[":@"]=this.buildAttributesMap(pe.tagExp,J,pe.tagName)),this.addChild(B,fe,J)}le=pe.closeIndex+1}else if(G.substr(le+1,3)==="!--"){const pe=H(G,"-->",le+4,"Comment is not closed.");if(this.options.commentPropName){const fe=G.substring(le+4,pe-2);ne=this.saveTextToParentTag(ne,B,J),B.add(this.options.commentPropName,[{[this.options.textNodeName]:fe}])}le=pe}else if(G.substr(le+1,2)==="!D"){const pe=s(G,le);this.docTypeEntities=pe.entities,le=pe.i}else if(G.substr(le+1,2)==="!["){const pe=H(G,"]]>",le,"CDATA is not closed.")-2,fe=G.substring(le+9,pe);ne=this.saveTextToParentTag(ne,B,J);let Te=this.parseTextData(fe,B.tagname,J,!0,!1,!0,!0);Te==null&&(Te=""),this.options.cdataPropName?B.add(this.options.cdataPropName,[{[this.options.textNodeName]:fe}]):B.add(this.options.textNodeName,Te),le=pe+2}else{let pe=Y(G,le,this.options.removeNSPrefix),fe=pe.tagName;const Te=pe.rawTagName;let Ce=pe.tagExp,tt=pe.attrExpPresent,Ke=pe.closeIndex;this.options.transformTagName&&(fe=this.options.transformTagName(fe)),B&&ne&&B.tagname!=="!xml"&&(ne=this.saveTextToParentTag(ne,B,J,!1));const dt=B;if(dt&&this.options.unpairedTags.indexOf(dt.tagname)!==-1&&(B=this.tagsNodeStack.pop(),J=J.substring(0,J.lastIndexOf("."))),fe!==j.tagname&&(J+=J?"."+fe:fe),this.isItStopNode(this.options.stopNodes,J,fe)){let et="";if(Ce.length>0&&Ce.lastIndexOf("/")===Ce.length-1)fe[fe.length-1]==="/"?(fe=fe.substr(0,fe.length-1),J=J.substr(0,J.length-1),Ce=fe):Ce=Ce.substr(0,Ce.length-1),le=pe.closeIndex;else if(this.options.unpairedTags.indexOf(fe)!==-1)le=pe.closeIndex;else{const lt=this.readStopNodeData(G,Te,Ke+1);if(!lt)throw new Error(`Unexpected end of ${Te}`);le=lt.i,et=lt.tagContent}const Oe=new c(fe);fe!==Ce&&tt&&(Oe[":@"]=this.buildAttributesMap(Ce,J,fe)),et&&(et=this.parseTextData(et,fe,J,!0,tt,!0,!0)),J=J.substr(0,J.lastIndexOf(".")),Oe.add(this.options.textNodeName,et),this.addChild(B,Oe,J)}else{if(Ce.length>0&&Ce.lastIndexOf("/")===Ce.length-1){fe[fe.length-1]==="/"?(fe=fe.substr(0,fe.length-1),J=J.substr(0,J.length-1),Ce=fe):Ce=Ce.substr(0,Ce.length-1),this.options.transformTagName&&(fe=this.options.transformTagName(fe));const et=new c(fe);fe!==Ce&&tt&&(et[":@"]=this.buildAttributesMap(Ce,J,fe)),this.addChild(B,et,J),J=J.substr(0,J.lastIndexOf("."))}else{const et=new c(fe);this.tagsNodeStack.push(B),fe!==Ce&&tt&&(et[":@"]=this.buildAttributesMap(Ce,J,fe)),this.addChild(B,et,J),B=et}ne="",le=Ke}}else ne+=G[le];return j.child};function k(G,j,B){const ne=this.options.updateTag(j.tagname,B,j[":@"]);ne===!1||(typeof ne=="string"&&(j.tagname=ne),G.addChild(j))}const L=function(G){if(this.options.processEntities){for(let j in this.docTypeEntities){const B=this.docTypeEntities[j];G=G.replace(B.regx,B.val)}for(let j in this.lastEntities){const B=this.lastEntities[j];G=G.replace(B.regex,B.val)}if(this.options.htmlEntities)for(let j in this.htmlEntities){const B=this.htmlEntities[j];G=G.replace(B.regex,B.val)}G=G.replace(this.ampEntity.regex,this.ampEntity.val)}return G};function I(G,j,B,ne){return G&&(ne===void 0&&(ne=Object.keys(j.child).length===0),G=this.parseTextData(G,j.tagname,B,!1,j[":@"]?Object.keys(j[":@"]).length!==0:!1,ne),G!==void 0&&G!==""&&j.add(this.options.textNodeName,G),G=""),G}function F(G,j,B){const ne="*."+B;for(const J in G){const le=G[J];if(ne===le||j===le)return!0}return!1}function N(G,j,B=">"){let ne,J="";for(let le=j;le<G.length;le++){let ae=G[le];if(ne)ae===ne&&(ne="");else if(ae==='"'||ae==="'")ne=ae;else if(ae===B[0])if(B[1]){if(G[le+1]===B[1])return{data:J,index:le}}else return{data:J,index:le};else ae==="	"&&(ae=" ");J+=ae}}function H(G,j,B,ne){const J=G.indexOf(j,B);if(J===-1)throw new Error(ne);return J+j.length-1}function Y(G,j,B,ne=">"){const J=N(G,j+1,ne);if(!J)return;let le=J.data;const ae=J.index,pe=le.search(/\s/);let fe=le,Te=!0;pe!==-1&&(fe=le.substring(0,pe),le=le.substring(pe+1).trimStart());const Ce=fe;if(B){const tt=fe.indexOf(":");tt!==-1&&(fe=fe.substr(tt+1),Te=fe!==J.data.substr(tt+1))}return{tagName:fe,tagExp:le,closeIndex:ae,attrExpPresent:Te,rawTagName:Ce}}function q(G,j,B){const ne=B;let J=1;for(;B<G.length;B++)if(G[B]==="<")if(G[B+1]==="/"){const le=H(G,">",B,`${j} is not closed`);if(G.substring(B+2,le).trim()===j&&(J--,J===0))return{tagContent:G.substring(ne,B),i:le};B=le}else if(G[B+1]==="?")B=H(G,"?>",B+1,"StopNode is not closed.");else if(G.substr(B+1,3)==="!--")B=H(G,"-->",B+3,"StopNode is not closed.");else if(G.substr(B+1,2)==="![")B=H(G,"]]>",B,"StopNode is not closed.")-2;else{const le=Y(G,B,">");le&&((le&&le.tagName)===j&&le.tagExp[le.tagExp.length-1]!=="/"&&J++,B=le.closeIndex)}}function U(G,j,B){if(j&&typeof G=="string"){const ne=G.trim();return ne==="true"?!0:ne==="false"?!1:f(G,B)}else return o.isExist(G)?G:""}i.exports=p},{"../util":4,"./DocTypeReader":8,"./xmlNode":13,strnum:15}],11:[function(t,i,r){const{buildOptions:o}=t("./OptionsBuilder"),c=t("./OrderedObjParser"),{prettify:s}=t("./node2json"),f=t("../validator");class p{constructor(_){this.externalEntities={},this.options=o(_)}parse(_,x){if(typeof _!="string")if(_.toString)_=_.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(x){x===!0&&(x={});const P=f.validate(_,x);if(P!==!0)throw Error(`${P.err.msg}:${P.err.line}:${P.err.col}`)}const b=new c(this.options);b.addExternalEntities(this.externalEntities);const M=b.parseXml(_);return this.options.preserveOrder||M===void 0?M:s(M,this.options)}addEntity(_,x){if(x.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(_.indexOf("&")!==-1||_.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(x==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[_]=x}}i.exports=p},{"../validator":5,"./OptionsBuilder":9,"./OrderedObjParser":10,"./node2json":12}],12:[function(t,i,r){function o(g,_){return c(g,_)}function c(g,_,x){let b;const M={};for(let P=0;P<g.length;P++){const k=g[P],L=s(k);let I="";if(x===void 0?I=L:I=x+"."+L,L===_.textNodeName)b===void 0?b=k[L]:b+=""+k[L];else{if(L===void 0)continue;if(k[L]){let F=c(k[L],_,I);const N=p(F,_);k[":@"]?f(F,k[":@"],I,_):Object.keys(F).length===1&&F[_.textNodeName]!==void 0&&!_.alwaysCreateTextNode?F=F[_.textNodeName]:Object.keys(F).length===0&&(_.alwaysCreateTextNode?F[_.textNodeName]="":F=""),M[L]!==void 0&&M.hasOwnProperty(L)?(Array.isArray(M[L])||(M[L]=[M[L]]),M[L].push(F)):_.isArray(L,I,N)?M[L]=[F]:M[L]=F}}}return typeof b=="string"?b.length>0&&(M[_.textNodeName]=b):b!==void 0&&(M[_.textNodeName]=b),M}function s(g){const _=Object.keys(g);for(let x=0;x<_.length;x++){const b=_[x];if(b!==":@")return b}}function f(g,_,x,b){if(_){const M=Object.keys(_),P=M.length;for(let k=0;k<P;k++){const L=M[k];b.isArray(L,x+"."+L,!0,!0)?g[L]=[_[L]]:g[L]=_[L]}}}function p(g,_){const{textNodeName:x}=_,b=Object.keys(g).length;return!!(b===0||b===1&&(g[x]||typeof g[x]=="boolean"||g[x]===0))}r.prettify=o},{}],13:[function(t,i,r){class o{constructor(s){this.tagname=s,this.child=[],this[":@"]={}}add(s,f){s==="__proto__"&&(s="#__proto__"),this.child.push({[s]:f})}addChild(s){s.tagname==="__proto__"&&(s.tagname="#__proto__"),s[":@"]&&Object.keys(s[":@"]).length>0?this.child.push({[s.tagname]:s.child,":@":s[":@"]}):this.child.push({[s.tagname]:s.child})}}i.exports=o},{}],14:[function(t,i,r){r.read=function(o,c,s,f,p){var g,_,x=p*8-f-1,b=(1<<x)-1,M=b>>1,P=-7,k=s?p-1:0,L=s?-1:1,I=o[c+k];for(k+=L,g=I&(1<<-P)-1,I>>=-P,P+=x;P>0;g=g*256+o[c+k],k+=L,P-=8);for(_=g&(1<<-P)-1,g>>=-P,P+=f;P>0;_=_*256+o[c+k],k+=L,P-=8);if(g===0)g=1-M;else{if(g===b)return _?NaN:(I?-1:1)*(1/0);_=_+Math.pow(2,f),g=g-M}return(I?-1:1)*_*Math.pow(2,g-f)},r.write=function(o,c,s,f,p,g){var _,x,b,M=g*8-p-1,P=(1<<M)-1,k=P>>1,L=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=f?0:g-1,F=f?1:-1,N=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(x=isNaN(c)?1:0,_=P):(_=Math.floor(Math.log(c)/Math.LN2),c*(b=Math.pow(2,-_))<1&&(_--,b*=2),_+k>=1?c+=L/b:c+=L*Math.pow(2,1-k),c*b>=2&&(_++,b/=2),_+k>=P?(x=0,_=P):_+k>=1?(x=(c*b-1)*Math.pow(2,p),_=_+k):(x=c*Math.pow(2,k-1)*Math.pow(2,p),_=0));p>=8;o[s+I]=x&255,I+=F,x/=256,p-=8);for(_=_<<p|x,M+=p;M>0;o[s+I]=_&255,I+=F,_/=256,M-=8);o[s+I-F]|=N*128}},{}],15:[function(t,i,r){const o=/^[-+]?0x[a-fA-F0-9]+$/,c=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const s={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function f(g,_={}){if(_=Object.assign({},s,_),!g||typeof g!="string")return g;let x=g.trim();if(_.skipLike!==void 0&&_.skipLike.test(x))return g;if(_.hex&&o.test(x))return Number.parseInt(x,16);{const b=c.exec(x);if(b){const M=b[1],P=b[2];let k=p(b[3]);const L=b[4]||b[6];if(!_.leadingZeros&&P.length>0&&M&&x[2]!==".")return g;if(!_.leadingZeros&&P.length>0&&!M&&x[1]!==".")return g;{const I=Number(x),F=""+I;return F.search(/[eE]/)!==-1||L?_.eNotation?I:g:x.indexOf(".")!==-1?F==="0"&&k===""||F===k||M&&F==="-"+k?I:g:P?k===F||M+k===F?I:g:x===F||x===M+F?I:g}}else return g}}function p(g){return g&&g.indexOf(".")!==-1&&(g=g.replace(/0+$/,""),g==="."?g="0":g[0]==="."?g="0"+g:g[g.length-1]==="."&&(g=g.substr(0,g.length-1))),g}i.exports=f},{}],16:[function(t,i,r){i.exports={name:"osm-api",version:"3.3.1",contributors:["Kyle Hensel (https://github.com/k-yle)"],description:"ðºï¸ð Javascript/Typescript wrapper around the OpenStreetMap API",main:"dist",unpkg:"dist/index.min.js",types:"dist/src/index.d.ts",license:"MIT",files:["dist"],keywords:["osm","openstreetmap","openstreetmap api"],repository:"https://github.com/osmlab/osm-api-js",scripts:{build:"rm -rf dist && tsc --emitDeclarationOnly && rm -rf dist/__tests__ && browserify -s OSM src/index.ts -p tsify > dist/index.js && uglifyjs dist/index.js > dist/index.min.js",lint:"eslint .",test:"vitest",trypublish:"npm publish --provenance || true"},engines:{node:">=18"},dependencies:{"@types/geojson":"^7946.0.13","fast-xml-parser":"^4.4.1"},devDependencies:{"@types/node":"^22.5.5",browserify:"^17.0.0",eslint:"^9.10.0","eslint-config-kyle":"^25.0.0-beta3",tsify:"^5.0.4",typescript:"^5.6.2","uglify-js":"^3.19.3",vitest:"^2.1.1"},prettier:{trailingComma:"es5"}}},{}],17:[function(t,i,r){(function(o){(function(){var c=this&&this.__awaiter||function(x,b,M,P){function k(L){return L instanceof M?L:new M(function(I){I(L)})}return new(M||(M=Promise))(function(L,I){function F(Y){try{H(P.next(Y))}catch(q){I(q)}}function N(Y){try{H(P.throw(Y))}catch(q){I(q)}}function H(Y){Y.done?L(Y.value):k(Y.value).then(F,N)}H((P=P.apply(x,b||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.osmFetch=_;const s=t("../auth"),f=t("../config"),p=t("./_xml"),g=x=>typeof btoa>"u"?o.from(x,"binary").toString("base64"):btoa(x);function _(x,b,M){return c(this,void 0,void 0,function*(){const{apiUrl:P,authHeader:k,basicAuth:L,userAgent:I}=(0,f.getConfig)(),F=L&&`Basic ${g(`${L.username}:${L.password}`)}`,N=(0,s.getAuthToken)()&&`Bearer ${(0,s.getAuthToken)()}`;let H=new URLSearchParams(b).toString();H&&(H=`?${H}`);const Y=yield fetch(`${P}/api${x}${H}`,Object.assign(Object.assign({},M),{headers:Object.assign({Authorization:k||F||N||"","User-Agent":I},M?.headers)})),q=Y.headers.get("Content-Type");if(q?.startsWith("application/xml")){const G=yield Y.text();return yield p.xmlParser.parse(G)}if(q?.startsWith("application/json"))return Y.json();if(Y.ok)return yield Y.text();const U=new Error(`OSM API: ${yield Y.text()}`);throw U.cause=Y.status,U})}}).call(this)}).call(this,t("buffer").Buffer)},{"../auth":58,"../config":60,"./_xml":18,buffer:2}],18:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.xmlParser=void 0;const o=t("fast-xml-parser");r.xmlParser=new o.XMLParser({ignoreAttributes:!1,attributesGroupName:"$",attributeNamePrefix:"",isArray:c=>c!=="$",attributeValueProcessor(c,s){return s.replaceAll(/&#(x9|9);/g,"	").replaceAll(/&#(xA|10);/g,`
`).replaceAll(/&#(xD|13);/g,"\r")}})},{"fast-xml-parser":3}],19:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createChangesetMetaXml=s,r.createOsmChangeXml=p;const o=t("fast-xml-parser"),c=new o.XMLBuilder({ignoreAttributes:!1,attributeNamePrefix:"$",format:!0,suppressEmptyNode:!0,suppressBooleanAttributes:!1,entities:[{regex:/&/g,val:"&amp;"},{regex:/>/g,val:"&gt;"},{regex:/</g,val:"&lt;"},{regex:/'/g,val:"&apos;"},{regex:/"/g,val:"&quot;"},{regex:/\t/g,val:"&#9;"},{regex:/\n/g,val:"&#10;"},{regex:/\r/g,val:"&#13;"}]});function s(g){return c.build({osm:{changeset:{tag:Object.entries(g).map(([_,x])=>({$k:_,$v:x}))}}})}const f=(g,_,x)=>{const b=["node","way","relation"];return x==="delete"&&b.reverse(),_.reduce((M,P)=>{const k={$id:P.id,$version:x==="create"?0:P.version,$changeset:g,tag:Object.entries(P.tags||{}).map(([L,I])=>({$k:L,$v:I}))};switch(P.type){case"node":{const L=Object.assign(Object.assign({},k),{$lat:P.lat,$lon:P.lon});return Object.assign(Object.assign({},M),{node:[...M.node,L]})}case"way":{if(!P.nodes)throw new Error("Way has no nodes");const L=Object.assign(Object.assign({},k),{nd:P.nodes.map(I=>({$ref:I}))});return Object.assign(Object.assign({},M),{way:[...M.way,L]})}case"relation":{if(!P.members)throw new Error("Relation has no members");const L=Object.assign(Object.assign({},k),{member:P.members.map(I=>({$type:I.type,$ref:I.ref,$role:I.role}))});return Object.assign(Object.assign({},M),{relation:[...M.relation,L]})}default:return M}},Object.fromEntries(b.map(M=>[M,[]])))};function p(g,_,x){return c.build({osmChange:{$version:"0.6",$generator:"osm-api-js",changeset:x?{tag:Object.entries(x).map(([b,M])=>({$k:b,$v:M}))}:void 0,create:[f(g,_.create,"create")],modify:[f(g,_.modify,"modify")],delete:[Object.assign({"$if-unused":!0},f(g,_.delete,"delete"))]}})}},{"fast-xml-parser":3}],20:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.parseOsmChangeJson=p,r.parseOsmChangeXml=g;const o=t("../_xml");function c(_){if(_?.tag)return Object.fromEntries(_.tag.map(x=>[x.$.k,x.$.v]))}function s(_){return{changeset:+_.$.changeset,id:+_.$.id,timestamp:_.$.timestamp,uid:+_.$.uid,user:_.$.user,version:+_.$.version,tags:c(_)}}const f=_=>{const x=[];if(_.node){const b=_.node.map(M=>Object.assign(Object.assign({type:"node"},s(M)),{lat:+M.$.lat,lon:+M.$.lon}));x.push(...b)}if(_.way){const b=_.way.map(M=>{var P;return Object.assign(Object.assign({type:"way"},s(M)),{nodes:((P=M.nd)===null||P===void 0?void 0:P.map(k=>+k.$.ref))||[]})});x.push(...b)}if(_.relation){const b=_.relation.map(M=>{var P;return Object.assign(Object.assign({type:"relation"},s(M)),{members:((P=M.member)===null||P===void 0?void 0:P.map(k=>({ref:+k.$.ref,role:k.$.role,type:k.$.type})))||[]})});x.push(...b)}return x};function p(_){var x,b,M,P;const k=c((x=_.osmChange[0].changeset)===null||x===void 0?void 0:x[0]),L={create:((b=_.osmChange[0].create)===null||b===void 0?void 0:b.flatMap(f))||[],modify:((M=_.osmChange[0].modify)===null||M===void 0?void 0:M.flatMap(f))||[],delete:((P=_.osmChange[0].delete)===null||P===void 0?void 0:P.flatMap(f))||[]};return k&&(L.changeset=k),L}function g(_){const x=o.xmlParser.parse(_);return p(x)}},{"../_xml":18}],21:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getOsmChangeSize=f,r.chunkOsmChange=p;const o=["create","modify","delete"],c=["create-node","create-way","create-relation","delete-relation","delete-way","delete-node","modify-node","modify-way","modify-relation"],s=()=>({create:[],modify:[],delete:[]});function f(g){return g.create.length+g.modify.length+g.delete.length}function p(g,_){var x;const b=(x=_?.api.changesets.maximum_elements)!==null&&x!==void 0?x:p.DEFAULT_LIMIT;if(f(g)<=b)return[g];const M={};for(const I of o)for(const F of g[I]){const N=`${I}-${F.type}`;M[N]||(M[N]=[]),M[N].push(F)}const P=[s()];function k(){var I;for(const F of c){const N=F.split("-")[0],H=(I=M[F])===null||I===void 0?void 0:I.pop();if(H)return{action:N,feature:H}}}let L;for(;L=k();){const I=P[0];I[L.action].push(L.feature),f(I)>=b&&P.unshift(s())}return P.reverse()}p.DEFAULT_LIMIT=1e4},{}],22:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(M){return M instanceof _?M:new _(function(P){P(M)})}return new(_||(_=Promise))(function(M,P){function k(F){try{I(x.next(F))}catch(N){P(N)}}function L(F){try{I(x.throw(F))}catch(N){P(N)}}function I(F){F.done?M(F.value):b(F.value).then(k,L)}I((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.createChangesetComment=f;const c=t("../_osmFetch"),s=t("./getChangesets");function f(p,g,_){return o(this,void 0,void 0,function*(){const x=yield(0,c.osmFetch)(`/0.6/changeset/${p}/comment.json`,void 0,Object.assign(Object.assign({},_),{method:"POST",body:`text=${encodeURIComponent(g)}`,headers:Object.assign(Object.assign({},_?.headers),{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"})}));return(0,s.mapRawChangeset)(x.changeset)})}},{"../_osmFetch":17,"./getChangesets":24}],23:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(M){return M instanceof _?M:new _(function(P){P(M)})}return new(_||(_=Promise))(function(M,P){function k(F){try{I(x.next(F))}catch(N){P(N)}}function L(F){try{I(x.throw(F))}catch(N){P(N)}}function I(F){F.done?M(F.value):b(F.value).then(k,L)}I((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getChangesetDiff=f;const c=t("../_osmFetch"),s=t("./_parseOsmChangeXml");function f(p,g){return o(this,void 0,void 0,function*(){const _=yield(0,c.osmFetch)(`/0.6/changeset/${p}/download`,void 0,g);return(0,s.parseOsmChangeJson)(_)})}},{"../_osmFetch":17,"./_parseOsmChangeXml":20}],24:[function(t,i,r){var o=this&&this.__awaiter||function(_,x,b,M){function P(k){return k instanceof b?k:new b(function(L){L(k)})}return new(b||(b=Promise))(function(k,L){function I(H){try{N(M.next(H))}catch(Y){L(Y)}}function F(H){try{N(M.throw(H))}catch(Y){L(Y)}}function N(H){H.done?k(H.value):P(H.value).then(I,F)}N((M=M.apply(_,x||[])).next())})},c=this&&this.__rest||function(_,x){var b={};for(var M in _)Object.prototype.hasOwnProperty.call(_,M)&&x.indexOf(M)<0&&(b[M]=_[M]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var P=0,M=Object.getOwnPropertySymbols(_);P<M.length;P++)x.indexOf(M[P])<0&&Object.prototype.propertyIsEnumerable.call(_,M[P])&&(b[M[P]]=_[M[P]]);return b};Object.defineProperty(r,"__esModule",{value:!0}),r.mapRawChangeset=void 0,r.listChangesets=p,r.getChangeset=g;const s=t("../_osmFetch"),f=_=>{var{comments:x}=_,b=c(_,["comments"]);return Object.assign(Object.assign({},b),{created_at:new Date(b.created_at),closed_at:b.closed_at?new Date(b.closed_at):void 0,discussion:x?.map(M=>Object.assign(Object.assign({},M),{date:new Date(M.date),uid:`${M.uid}`}))})};r.mapRawChangeset=f;function p(_,x){return o(this,void 0,void 0,function*(){const{only:b}=_,M=c(_,["only"]);return(yield(0,s.osmFetch)("/0.6/changesets.json",Object.assign(Object.assign({},b&&{[b]:!0}),M),x)).changesets.map(r.mapRawChangeset)})}function g(_){return o(this,arguments,void 0,function*(x,b=!0,M){const P=yield(0,s.osmFetch)(`/0.6/changeset/${x}.json`,b?{include_discussion:1}:{},M);return(0,r.mapRawChangeset)(P.changeset)})}},{"../_osmFetch":17}],25:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(p,g,_,x){x===void 0&&(x=_);var b=Object.getOwnPropertyDescriptor(g,_);(!b||("get"in b?!g.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return g[_]}}),Object.defineProperty(p,x,b)}):(function(p,g,_,x){x===void 0&&(x=_),p[x]=g[_]})),c=this&&this.__exportStar||function(p,g){for(var _ in p)_!=="default"&&!Object.prototype.hasOwnProperty.call(g,_)&&o(g,p,_)};Object.defineProperty(r,"__esModule",{value:!0}),r.createOsmChangeXml=r.parseOsmChangeXml=void 0,c(t("./chunkOsmChange"),r),c(t("./createChangesetComment"),r),c(t("./getChangesetDiff"),r),c(t("./getChangesets"),r),c(t("./subscription"),r),c(t("./uploadChangeset"),r);var s=t("./_parseOsmChangeXml");Object.defineProperty(r,"parseOsmChangeXml",{enumerable:!0,get:function(){return s.parseOsmChangeXml}});var f=t("./_createOsmChangeXml");Object.defineProperty(r,"createOsmChangeXml",{enumerable:!0,get:function(){return f.createOsmChangeXml}})},{"./_createOsmChangeXml":19,"./_parseOsmChangeXml":20,"./chunkOsmChange":21,"./createChangesetComment":22,"./getChangesetDiff":23,"./getChangesets":24,"./subscription":26,"./uploadChangeset":27}],26:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(M){return M instanceof _?M:new _(function(P){P(M)})}return new(_||(_=Promise))(function(M,P){function k(F){try{I(x.next(F))}catch(N){P(N)}}function L(F){try{I(x.throw(F))}catch(N){P(N)}}function I(F){F.done?M(F.value):b(F.value).then(k,L)}I((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.subscribeToChangeset=s,r.unsubscribeFromChangeset=f;const c=t("../_osmFetch");function s(p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/changeset/${p}/subscribe`,{},Object.assign(Object.assign({},g),{method:"POST"}))})}function f(p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/changeset/${p}/unsubscribe`,{},Object.assign(Object.assign({},g),{method:"POST"}))})}},{"../_osmFetch":17}],27:[function(t,i,r){var o=this&&this.__awaiter||function(b,M,P,k){function L(I){return I instanceof P?I:new P(function(F){F(I)})}return new(P||(P=Promise))(function(I,F){function N(q){try{Y(k.next(q))}catch(U){F(U)}}function H(q){try{Y(k.throw(q))}catch(U){F(U)}}function Y(q){q.done?I(q.value):L(q.value).then(N,H)}Y((k=k.apply(b,M||[])).next())})},c=this&&this.__rest||function(b,M){var P={};for(var k in b)Object.prototype.hasOwnProperty.call(b,k)&&M.indexOf(k)<0&&(P[k]=b[k]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,k=Object.getOwnPropertySymbols(b);L<k.length;L++)M.indexOf(k[L])<0&&Object.prototype.propertyIsEnumerable.call(b,k[L])&&(P[k[L]]=b[k[L]]);return P};Object.defineProperty(r,"__esModule",{value:!0}),r.compress=_,r.uploadChangeset=x;const s=t("../_osmFetch"),f=t("../../../package.json"),p=t("./_createOsmChangeXml"),g=t("./chunkOsmChange");function _(b){if(!globalThis.CompressionStream)return;const M=new Response(b).body.pipeThrough(new CompressionStream("gzip"));return new Response(M).blob()}function x(b,M,P){return o(this,void 0,void 0,function*(){const k=P||{},{onChunk:L,onProgress:I,disableCompression:F}=k,N=c(k,["onChunk","onProgress","disableCompression"]),H=(0,g.chunkOsmChange)(M),Y=[],q=(0,g.getOsmChangeSize)(M);for(const[U,G]of H.entries()){let j=b;H.length>1&&(L?j=L({featureCount:q,changesetIndex:U,changesetTotal:H.length}):j.chunk=`${U+1}/${H.length}`),j.created_by||(j.created_by=`osm-api-js ${f.version}`),I?.({phase:"upload",step:U+1,total:H.length});const B=+(yield(0,s.osmFetch)("/0.6/changeset/create",void 0,Object.assign(Object.assign({},N),{method:"PUT",body:(0,p.createChangesetMetaXml)(j),headers:Object.assign(Object.assign({},N.headers),{"content-type":"application/xml; charset=utf-8"})}))),ne=(0,p.createOsmChangeXml)(B,G),J=!F&&(yield _(ne));yield(0,s.osmFetch)(`/0.6/changeset/${B}/upload`,void 0,Object.assign(Object.assign({},N),{method:"POST",body:J||ne,headers:Object.assign(Object.assign(Object.assign({},N.headers),J&&{"Content-Encoding":"gzip"}),{"content-type":"application/xml; charset=utf-8"})})),yield(0,s.osmFetch)(`/0.6/changeset/${B}/close`,void 0,Object.assign(Object.assign({},N),{method:"PUT"})),Y.push(B)}return Y[0]})}},{"../../../package.json":16,"../_osmFetch":17,"./_createOsmChangeXml":19,"./chunkOsmChange":21}],28:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.createUserBlock=s;const c=t("../_osmFetch");function s(f,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/user_blocks.json",f,Object.assign(Object.assign({},p),{method:"POST"}))).user_block})}},{"../_osmFetch":17}],29:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getUserBlock=s;const c=t("../_osmFetch");function s(f,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user_blocks/${f}.json`,{},p)).user_block})}},{"../_osmFetch":17}],30:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(M){return M instanceof _?M:new _(function(P){P(M)})}return new(_||(_=Promise))(function(M,P){function k(F){try{I(x.next(F))}catch(N){P(N)}}function L(F){try{I(x.throw(F))}catch(N){P(N)}}function I(F){F.done?M(F.value):b(F.value).then(k,L)}I((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.hideChangesetComment=f;const c=t("../_osmFetch"),s=t("../changesets");function f(p,g,_){return o(this,void 0,void 0,function*(){const x=yield(0,c.osmFetch)(`/0.6/changeset_comments/${p}/visibility.json`,{},Object.assign(Object.assign({},_),{method:g==="unhide"?"POST":"DELETE"}));return(0,s.mapRawChangeset)(x.changeset)})}},{"../_osmFetch":17,"../changesets":25}],31:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(M){return M instanceof _?M:new _(function(P){P(M)})}return new(_||(_=Promise))(function(M,P){function k(F){try{I(x.next(F))}catch(N){P(N)}}function L(F){try{I(x.throw(F))}catch(N){P(N)}}function I(F){F.done?M(F.value):b(F.value).then(k,L)}I((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.hideNote=f;const c=t("../_osmFetch"),s=t("../notes");function f(p,g,_){return o(this,void 0,void 0,function*(){const x=yield(0,c.osmFetch)(`/0.6/notes/${p}.json`,g?{text:g}:{},Object.assign(Object.assign({},_),{method:"DELETE"}));return(0,s.featureToNote)(x)})}},{"../_osmFetch":17,"../notes":48}],32:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,f,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(f,p);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[p]}}),Object.defineProperty(s,g,_)}):(function(s,f,p,g){g===void 0&&(g=p),s[g]=f[p]})),c=this&&this.__exportStar||function(s,f){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(f,p)&&o(f,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./createUserBlock"),r),c(t("./getUserBlock"),r),c(t("./hideChangesetComment"),r),c(t("./hideNote"),r),c(t("./redactFeature"),r)},{"./createUserBlock":28,"./getUserBlock":29,"./hideChangesetComment":30,"./hideNote":31,"./redactFeature":33}],33:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.redactFeature=s;const c=t("../_osmFetch");function s(f,p){return o(this,arguments,void 0,function*({featureType:g,featureId:_,featureVersion:x,redactionId:b},M){yield(0,c.osmFetch)(`/0.6/${g}/${_}/${x}/redact`,b?{redaction:b}:{},Object.assign(Object.assign({},M),{method:"POST"}))})}},{"../_osmFetch":17}],34:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(M){return M instanceof _?M:new _(function(P){P(M)})}return new(_||(_=Promise))(function(M,P){function k(F){try{I(x.next(F))}catch(N){P(N)}}function L(F){try{I(x.throw(F))}catch(N){P(N)}}function I(F){F.done?M(F.value):b(F.value).then(k,L)}I((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getApiCapabilities=s,r.getCapabilities=f;const c=t("./_osmFetch");function s(p){return o(this,void 0,void 0,function*(){return(0,c.osmFetch)("/capabilities.json",void 0,p)})}function f(){return o(this,void 0,void 0,function*(){const p=yield s();return{limits:{maxArea:p.api.area.maximum,maxNoteArea:p.api.note_area.maximum,maxTracepointPerPage:p.api.tracepoints.per_page,maxWayNodes:p.api.waynodes.maximum,maxChangesetElements:p.api.changesets.maximum_elements,maxTimeout:p.api.timeout.seconds},policy:{imageryBlacklist:p.policy.imagery.blacklist.map(_=>_.regex)}}})}},{"./_osmFetch":17}],35:[function(t,i,r){var o=this&&this.__awaiter||function(b,M,P,k){function L(I){return I instanceof P?I:new P(function(F){F(I)})}return new(P||(P=Promise))(function(I,F){function N(q){try{Y(k.next(q))}catch(U){F(U)}}function H(q){try{Y(k.throw(q))}catch(U){F(U)}}function Y(q){q.done?I(q.value):L(q.value).then(N,H)}Y((k=k.apply(b,M||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getFeature=s,r.getFeatures=f,r.getFeatureAtVersion=p,r.getFeatureHistory=g,r.getWaysForNode=_,r.getRelationsForElement=x;const c=t("./_osmFetch");function s(b,M,P,k){return o(this,void 0,void 0,function*(){const L=P&&b!=="node"?"/full":"";return(yield(0,c.osmFetch)(`/0.6/${b}/${M}${L}.json`,void 0,k)).elements})}function f(b,M,P){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/${b}s.json?${b}s=${M.join(",")}`,void 0,P)).elements})}function p(b,M,P,k){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/${b}/${M}/${P}.json`,void 0,k)).elements[0]})}function g(b,M,P){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/${b}/${M}/history.json`,void 0,P)).elements})}function _(b,M){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/node/${b}/ways.json`,void 0,M)).elements})}function x(b,M,P){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/${b}/${M}/relations.json`,void 0,P)).elements})}},{"./_osmFetch":17}],36:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getMapData=s;const c=t("./_osmFetch");function s(f,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/map.json",{bbox:f},p)).elements})}},{"./_osmFetch":17}],37:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getPermissions=s;const c=t("./_osmFetch");function s(f){return o(this,void 0,void 0,function*(){return(0,c.osmFetch)("/0.6/permissions.json",void 0,f)})}},{"./_osmFetch":17}],38:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getUIdFromDisplayName=s;const c=t("./changesets");function s(f){return o(this,void 0,void 0,function*(){const p=yield(0,c.listChangesets)({display_name:f});if(!p.length)throw new Error("Could not get uid because the user has never edited the map");return p[0].uid})}},{"./changesets":25}],39:[function(t,i,r){var o=this&&this.__awaiter||function(_,x,b,M){function P(k){return k instanceof b?k:new b(function(L){L(k)})}return new(b||(b=Promise))(function(k,L){function I(H){try{N(M.next(H))}catch(Y){L(Y)}}function F(H){try{N(M.throw(H))}catch(Y){L(Y)}}function N(H){H.done?k(H.value):P(H.value).then(I,F)}N((M=M.apply(_,x||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getUser=s,r.getUsers=f,r.getUserBlockById=p,r.getOwnUserBlocks=g;const c=t("./_osmFetch");function s(_,x){return o(this,void 0,void 0,function*(){const b=yield(0,c.osmFetch)(`/0.6/user/${_==="me"?"details":_}.json`,void 0,x);return Object.assign(Object.assign({},b.user),{account_created:new Date(b.user.account_created)})})}function f(_,x){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/users",{users:_},x)).users.map(M=>Object.assign(Object.assign({},M),{account_created:new Date(M.account_created)}))})}function p(_,x){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user_blocks/${_}.json`,void 0,x)).user_block})}function g(_){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/user/blocks/active",void 0,_)).user_blocks})}},{"./_osmFetch":17}],40:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,f,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(f,p);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[p]}}),Object.defineProperty(s,g,_)}):(function(s,f,p,g){g===void 0&&(g=p),s[g]=f[p]})),c=this&&this.__exportStar||function(s,f){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(f,p)&&o(f,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./changesets"),r),c(t("./dwg"),r),c(t("./messages"),r),c(t("./notes"),r),c(t("./preferences"),r),c(t("./getCapabilities"),r),c(t("./getFeature"),r),c(t("./getMapData"),r),c(t("./getPermissions"),r),c(t("./getUIdFromDisplayName"),r),c(t("./getUser"),r)},{"./changesets":25,"./dwg":32,"./getCapabilities":34,"./getFeature":35,"./getMapData":36,"./getPermissions":37,"./getUIdFromDisplayName":38,"./getUser":39,"./messages":43,"./notes":48,"./preferences":53}],41:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.deleteMessage=s;const c=t("../_osmFetch");function s(f,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user/messages/${f}.json`,{},Object.assign(Object.assign({},p),{method:"DELETE"}))).message})}},{"../_osmFetch":17}],42:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getMessage=s;const c=t("../_osmFetch");function s(f,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user/messages/${f}.json`,void 0,p)).message})}},{"../_osmFetch":17}],43:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,f,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(f,p);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[p]}}),Object.defineProperty(s,g,_)}):(function(s,f,p,g){g===void 0&&(g=p),s[g]=f[p]})),c=this&&this.__exportStar||function(s,f){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(f,p)&&o(f,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./deleteMessage"),r),c(t("./getMessage"),r),c(t("./listMessages"),r),c(t("./sendMessage"),r),c(t("./updateMessageReadStatus"),r)},{"./deleteMessage":41,"./getMessage":42,"./listMessages":44,"./sendMessage":45,"./updateMessageReadStatus":46}],44:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.listMessages=s;const c=t("../_osmFetch");function s(f,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user/messages/${f}.json`,void 0,p)).messages})}},{"../_osmFetch":17}],45:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.sendMessage=s;const c=t("../_osmFetch");function s(f,p){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/user/messages.json",f,Object.assign(Object.assign({},p),{method:"POST"}))).message})}},{"../_osmFetch":17}],46:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.updateMessageReadStatus=s;const c=t("../_osmFetch");function s(f,p,g){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/user/messages/${f}.json`,{read_status:p},Object.assign(Object.assign({},g),{method:"POST"}))).message})}},{"../_osmFetch":17}],47:[function(t,i,r){var o=this&&this.__awaiter||function(x,b,M,P){function k(L){return L instanceof M?L:new M(function(I){I(L)})}return new(M||(M=Promise))(function(L,I){function F(Y){try{H(P.next(Y))}catch(q){I(q)}}function N(Y){try{H(P.throw(Y))}catch(q){I(q)}}function H(Y){Y.done?L(Y.value):k(Y.value).then(F,N)}H((P=P.apply(x,b||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.featureToNote=void 0,r.getNotesForQuery=p,r.getNotesForArea=g,r.getNote=_;const c=t("../_osmFetch"),s=x=>{const[b,M]=x.geometry.coordinates;return Object.assign(Object.assign({},x.properties),{location:{lat:M,lng:b}})};r.featureToNote=s;function f(x,b,M){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)(`/0.6/notes${b?"/search":""}.json`,x,M)).features.map(r.featureToNote)})}function p(x,b){return f(x,!0,b)}function g(x,b){return f({bbox:x},!1,b)}function _(x,b){return o(this,void 0,void 0,function*(){const M=yield(0,c.osmFetch)(`/0.6/notes/${x}.json`,void 0,b);return(0,r.featureToNote)(M)})}},{"../_osmFetch":17}],48:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,f,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(f,p);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[p]}}),Object.defineProperty(s,g,_)}):(function(s,f,p,g){g===void 0&&(g=p),s[g]=f[p]})),c=this&&this.__exportStar||function(s,f){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(f,p)&&o(f,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./getNotes"),r),c(t("./noteActions"),r),c(t("./subscription"),r)},{"./getNotes":47,"./noteActions":49,"./subscription":50}],49:[function(t,i,r){var o=this&&this.__awaiter||function(x,b,M,P){function k(L){return L instanceof M?L:new M(function(I){I(L)})}return new(M||(M=Promise))(function(L,I){function F(Y){try{H(P.next(Y))}catch(q){I(q)}}function N(Y){try{H(P.throw(Y))}catch(q){I(q)}}function H(Y){Y.done?L(Y.value):k(Y.value).then(F,N)}H((P=P.apply(x,b||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.createNote=f,r.commentOnNote=p,r.closeNote=g,r.reopenNote=_;const c=t("../_osmFetch"),s=t("./getNotes");function f(x,b,M,P){return o(this,void 0,void 0,function*(){const k=yield(0,c.osmFetch)("/0.6/notes.json",{lat:x,lon:b,text:M},Object.assign(Object.assign({},P),{method:"POST"}));return(0,s.featureToNote)(k)})}function p(x,b,M){return o(this,void 0,void 0,function*(){const P=yield(0,c.osmFetch)(`/0.6/notes/${x}/comment.json`,b?{text:b}:{},Object.assign(Object.assign({},M),{method:"POST"}));return(0,s.featureToNote)(P)})}function g(x,b,M){return o(this,void 0,void 0,function*(){const P=yield(0,c.osmFetch)(`/0.6/notes/${x}/close.json`,b?{text:b}:{},Object.assign(Object.assign({},M),{method:"POST"}));return(0,s.featureToNote)(P)})}function _(x,b,M){return o(this,void 0,void 0,function*(){const P=yield(0,c.osmFetch)(`/0.6/notes/${x}/reopen.json`,b?{text:b}:{},Object.assign(Object.assign({},M),{method:"POST"}));return(0,s.featureToNote)(P)})}},{"../_osmFetch":17,"./getNotes":47}],50:[function(t,i,r){var o=this&&this.__awaiter||function(p,g,_,x){function b(M){return M instanceof _?M:new _(function(P){P(M)})}return new(_||(_=Promise))(function(M,P){function k(F){try{I(x.next(F))}catch(N){P(N)}}function L(F){try{I(x.throw(F))}catch(N){P(N)}}function I(F){F.done?M(F.value):b(F.value).then(k,L)}I((x=x.apply(p,g||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.subscribeToNote=s,r.unsubscribeFromNote=f;const c=t("../_osmFetch");function s(p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/notes/${p}/subscription`,{},Object.assign(Object.assign({},g),{method:"POST"}))})}function f(p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/notes/${p}/subscription`,{},Object.assign(Object.assign({},g),{method:"DELETE"}))})}},{"../_osmFetch":17}],51:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.deletePreferences=s;const c=t("../_osmFetch");function s(f,p){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/user/preferences/${f}.json`,{},Object.assign(Object.assign({},p),{method:"DELETE"}))})}},{"../_osmFetch":17}],52:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.getPreferences=s;const c=t("../_osmFetch");function s(f){return o(this,void 0,void 0,function*(){return(yield(0,c.osmFetch)("/0.6/user/preferences.json",void 0,f)).preferences})}},{"../_osmFetch":17}],53:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,f,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(f,p);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[p]}}),Object.defineProperty(s,g,_)}):(function(s,f,p,g){g===void 0&&(g=p),s[g]=f[p]})),c=this&&this.__exportStar||function(s,f){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(f,p)&&o(f,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./deletePreferences"),r),c(t("./getPreferences"),r),c(t("./updatePreferences"),r)},{"./deletePreferences":51,"./getPreferences":52,"./updatePreferences":54}],54:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.updatePreferences=s;const c=t("../_osmFetch");function s(f,p,g){return o(this,void 0,void 0,function*(){yield(0,c.osmFetch)(`/0.6/user/preferences/${f}.json`,{},Object.assign(Object.assign({},g),{method:"PUT",body:p}))})}},{"../_osmFetch":17}],55:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createPopup=c;const o="osm-api-auth-complete";function c(s){let f=!1;return new Promise(p=>{const[g,_]=[600,550],x=Object.entries({width:g,height:_,left:window.screen.width/2-g/2,top:window.screen.height/2-_/2}).map(([k,L])=>`${k}=${L}`).join(","),b=window.open("about:blank","oauth_window",x);if(!b)throw new Error("Popup was blocked");b.location=s;const M=new BroadcastChannel(o),P=k=>{f||(p(k.data),f=!0,M.removeEventListener("message",P),M.close())};M.addEventListener("message",P)})}},{}],56:[function(t,i,r){var o=this&&this.__awaiter||function(f,p,g,_){function x(b){return b instanceof g?b:new g(function(M){M(b)})}return new(g||(g=Promise))(function(b,M){function P(I){try{L(_.next(I))}catch(F){M(F)}}function k(I){try{L(_.throw(I))}catch(F){M(F)}}function L(I){I.done?b(I.value):x(I.value).then(P,k)}L((_=_.apply(f,p||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.exchangeCode=s;const c=t("./helpers");function s(f,p){return o(this,arguments,void 0,function*(g,{options:_,pkceVerifier:x,state:b}){const M=new URL(g).searchParams,P=M.get("error_description"),k=M.get("code"),L=M.get("state");if(P)throw new Error(P);if(!k)throw new Error("No code in OAuth response");if(!x||!b)throw new Error("No login in progress");if(b!==L)throw new Error("State Mismatch");const I={grant_type:"authorization_code",code:k,redirect_uri:_.redirectUrl,client_id:_.clientId,code_verifier:x},F=`${(0,c.getOAuthBaseUrl)()}/oauth2/token?${new URLSearchParams(I).toString()}`,H=yield(yield fetch(F,{method:"POST",body:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if("error_description"in H)throw new Error(H.error_description);const Y={issuedAt:new Date(H.created_at*1e3).toISOString(),accessToken:H.access_token,scopes:H.scope.split(" ")};return localStorage.setItem("__osmAuth",JSON.stringify(Y)),Y})}},{"./helpers":57}],57:[function(t,i,r){var o=this&&this.__awaiter||function(g,_,x,b){function M(P){return P instanceof x?P:new x(function(k){k(P)})}return new(x||(x=Promise))(function(P,k){function L(N){try{F(b.next(N))}catch(H){k(H)}}function I(N){try{F(b.throw(N))}catch(H){k(H)}}function F(N){N.done?P(N.value):M(N.value).then(L,I)}F((b=b.apply(g,_||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.sha256=s,r.getRandomString=f,r.getOAuthBaseUrl=p;const c=t("../config");function s(g){return o(this,void 0,void 0,function*(){const _=new TextEncoder().encode(g),x=yield window.crypto.subtle.digest("SHA-256",_);return btoa(String.fromCharCode(...new Uint8Array(x))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")})}function f(){return[...window.crypto.getRandomValues(new Uint32Array(32))].map(g=>`0${g.toString(16)}`.slice(-2)).join("")}function p(){let g=(0,c.getConfig)().apiUrl;return g==="https://api.openstreetmap.org"&&(g="https://www.openstreetmap.org"),g}},{"../config":60}],58:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,f,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(f,p);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[p]}}),Object.defineProperty(s,g,_)}):(function(s,f,p,g){g===void 0&&(g=p),s[g]=f[p]})),c=this&&this.__exportStar||function(s,f){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(f,p)&&o(f,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./oauth2"),r)},{"./oauth2":59}],59:[function(t,i,r){var o=this&&this.__awaiter||function(b,M,P,k){function L(I){return I instanceof P?I:new P(function(F){F(I)})}return new(P||(P=Promise))(function(I,F){function N(q){try{Y(k.next(q))}catch(U){F(U)}}function H(q){try{Y(k.throw(q))}catch(U){F(U)}}function Y(q){q.done?I(q.value):L(q.value).then(N,H)}Y((k=k.apply(b,M||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0}),r.isLoggedIn=r.getAuthToken=r.authReady=void 0,r.login=p,r.logout=x;const c=t("./createPopup"),s=t("./exchangeCode"),f=t("./helpers");function p(b){return o(this,void 0,void 0,function*(){if(!b.redirectUrl)throw new Error("You must include the 'redirectUrl' option");if(!b.clientId)throw new Error("You must include the 'clientId' option");if(!b.scopes)throw new Error("You must include the 'scopes' option");const M=(0,f.getRandomString)(),P=(0,f.getRandomString)(),k=yield(0,f.sha256)(P),L={scope:b.scopes.join(" "),include_granted_scopes:"true",response_type:"code",state:M,redirect_uri:b.redirectUrl,client_id:b.clientId,code_challenge_method:"S256",code_challenge:k},I=`/oauth2/authorize?${new URLSearchParams(L).toString()}`,F=b.switchUser?`/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(I)}`)}`:I,N=(0,f.getOAuthBaseUrl)()+F,H={state:M,pkceVerifier:P,options:b};if(b.mode==="popup"){const Y=yield(0,c.createPopup)(N);return(0,s.exchangeCode)(Y,H)}if(b.mode==="redirect"){localStorage.setItem("__osmAuthTemp",JSON.stringify(H)),window.location.replace(N);return}throw new Error("options.mode must be 'popup' or 'redirect'")})}r.authReady=o(void 0,void 0,void 0,function*(){if(typeof window>"u")return;const b=window.location.href,M=localStorage.getItem("__osmAuthTemp");if(new URL(b).searchParams.get("code")&&M)try{const P=JSON.parse(M);yield(0,s.exchangeCode)(b,P),localStorage.removeItem("__osmAuthTemp")}catch(P){console.error("OSM Auth Error",P)}});const g=()=>{try{const b=localStorage.getItem("__osmAuth");return b?JSON.parse(b).accessToken:void 0}catch{return}};r.getAuthToken=g;const _=()=>!!(0,r.getAuthToken)();r.isLoggedIn=_;function x(){localStorage.removeItem("__osmAuth")}},{"./createPopup":55,"./exchangeCode":56,"./helpers":57}],60:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getConfig=void 0,r.configure=s;const o={apiUrl:"https://api.openstreetmap.org",userAgent:"https://github.com/osmlab/osm-api-js"},c=()=>o;r.getConfig=c;function s(f){Object.assign(o,f)}},{}],61:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,f,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(f,p);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[p]}}),Object.defineProperty(s,g,_)}):(function(s,f,p,g){g===void 0&&(g=p),s[g]=f[p]})),c=this&&this.__exportStar||function(s,f){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(f,p)&&o(f,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./api"),r),c(t("./auth"),r),c(t("./config"),r),c(t("./types"),r)},{"./api":40,"./auth":58,"./config":60,"./types":65}],62:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0})},{}],63:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],64:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],65:[function(t,i,r){var o=this&&this.__createBinding||(Object.create?(function(s,f,p,g){g===void 0&&(g=p);var _=Object.getOwnPropertyDescriptor(f,p);(!_||("get"in _?!f.__esModule:_.writable||_.configurable))&&(_={enumerable:!0,get:function(){return f[p]}}),Object.defineProperty(s,g,_)}):(function(s,f,p,g){g===void 0&&(g=p),s[g]=f[p]})),c=this&&this.__exportStar||function(s,f){for(var p in s)p!=="default"&&!Object.prototype.hasOwnProperty.call(f,p)&&o(f,s,p)};Object.defineProperty(r,"__esModule",{value:!0}),c(t("./changesets"),r),c(t("./features"),r),c(t("./general"),r),c(t("./messages"),r),c(t("./notes"),r),c(t("./osmPatch"),r),c(t("./user"),r)},{"./changesets":62,"./features":63,"./general":64,"./messages":66,"./notes":67,"./osmPatch":68,"./user":69}],66:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],67:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],68:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}],69:[function(t,i,r){arguments[4][62][0].apply(r,arguments)},{dup:62}]},{},[61])(61)})})(RT)),RT.exports}var Vv=lse(),cse=Xt('<div class="mb-1"><button class="btn btn-danger">Clear edits</button> <button class="btn btn-danger"> </button></div> <div class="mb-1"><button class="btn btn-secondary">Download .osc</button> <button class="btn btn-secondary">Upload changeset</button></div>',1),use=Xt("<!> <!>",1);function hse(n,e){en(e,!0);const t=()=>on(ia,"$mutationCounter",o),i=()=>on(Xs,"$backend",o),r=()=>on(Qv,"$loggedInUser",o),[o,c]=cs();let s=ii(bs([])),f=ii("");cn(()=>{t(),ys(()=>{yt(s,i()?JSON.parse(i().getEdits()):[],!0),rl(Zx,ee(s).length>0)})});async function p(){if(window.confirm("Do you really want to clear your edits?")){yt(f,"Clearing edits"),await uu();try{i().editClear(),Kf(ia,t())}finally{yt(f,"")}}}async function g(){yt(f,"Undoing last edit"),await uu();try{i().editUndo(),Kf(ia,t())}finally{yt(f,"")}}function _(){Pw("changes.osc",i().toOsc())}async function x(){if(!r()){window.alert("You have to log in first");return}if(ee(s).some(I=>!("SetTags"in I))){window.alert("You've done a bulk operation. You should NOT upload this to OSM -- it's only for testing or usage in you own tool that consumes OSM data.");return}if(!window.confirm("Do you really know what you're doing and want to upload this?"))return;let L=window.prompt("Please describe this changeset");if(L)try{let I=await Vv.uploadChangeset({created_by:"Speedwalk",comment:L},JSON.parse(i().toOsmChangeJson()));window.open(`https://www.openstreetmap.org/changeset/${I}`,"_blank"),rl(Xs,null),rl(Zx,!1)}catch(I){window.alert(`Upload failed: ${I}`)}}async function b(L){L.key=="z"&&L.ctrlKey&&ee(s).length>0&&await g()}var M=use();JM("keydown",ly,b);var P=ui(M);vp(P,{get loading(){return ee(f)}});var k=ht(P,2);jd(k,{header:F=>{var N=Hn();Ji(()=>ln(N,`${ee(s).length??""}
    ${ee(s).length==1?"edit":"edits"}`)),pt(F,N)},body:F=>{var N=tr(),H=ui(N);{var Y=q=>{var U=cse(),G=ui(U),j=Bt(G);j.__click=p;var B=ht(j,2);B.__click=g;var ne=Bt(B),J=ht(G,2),le=Bt(J);le.__click=_;var ae=ht(le,2);ae.__click=x,Ji(()=>{B.disabled=ee(s).length==0,ln(ne,`Undo (${ee(s).length??""})`)}),pt(q,U)};Ki(H,q=>{ee(s).length>0&&q(Y)})}pt(F,N)},$$slots:{header:!0,body:!0}}),pt(n,M),tn(),c()}ps(["click"]);var dse=Xt('<div class="card mb-3"><div class="card-header">Assume old-style tags on one-ways</div> <div class="card-body"><!> <button class="btn btn-secondary">Autoset tags on one-ways</button></div></div> <div class="card mb-3"><div class="card-header">Make all sidewalks</div> <div class="card-body"><!> <button class="btn btn-secondary">Make sidewalks</button></div></div> <button class="btn btn-secondary">Connect all crossing nodes</button>',1),fse=Xt('<button class="btn btn-secondary">Bulk operations</button>'),pse=Xt(`<h2>Bulk operations</h2> <p>Speedwalk has some experimental features that can automatically generate
    separate sidewalks on roads tagged with <i>sidewalk = left,right,both</i> . This is intended for use in routers and other tools that require separate sidewalks.
    This generation is very error-prone and not meant to ever replace mapping sidewalks
    properly, just as a stop-gap for areas with low coverage. Feel free to test it
    out, but do not ever upload the results to OSM.</p> <button class="btn btn-primary">I understand</button> <button class="btn btn-secondary">Cancel</button>`,1),mse=Xt("<!> <!> <!>",1);function gse(n,e){en(e,!0);const t=()=>on(Xx,"$enabledBulkOps",o),i=()=>on(Xs,"$backend",o),r=()=>on(ia,"$mutationCounter",o),[o,c]=cs();let s=ii(!1);function f(){rl(Xx,!0),yt(s,!1)}let p=ii(""),g=ii(!0),_=ii(!0);async function x(){yt(p,"Generating sidewalks"),await uu();try{i().editMakeAllSidewalks(ee(_)),Kf(ia,r())}catch(H){window.alert(`Error: ${H}`)}finally{yt(p,"")}}async function b(){yt(p,"Connecting crossings"),await uu();try{i().editConnectAllCrossings(),Kf(ia,r())}catch(H){window.alert(`Error: ${H}`)}finally{yt(p,"")}}async function M(){yt(p,"Inferring sidewalks around one-ways"),await uu();try{i().editAssumeTags(ee(g)),Kf(ia,r())}catch(H){window.alert(`Error: ${H}`)}finally{yt(p,"")}}var P=mse(),k=ui(P);vp(k,{get loading(){return ee(p)}});var L=ht(k,2);{var I=H=>{jd(H,{header:U=>{var G=Hn("Bulk operations");pt(U,G)},body:U=>{var G=dse(),j=ui(G),B=ht(Bt(j),2),ne=Bt(B);fs(ne,{get checked(){return ee(g)},set checked(Ce){yt(g,Ce,!0)},children:(Ce,tt)=>{var Ke=Hn("Drive on the left");pt(Ce,Ke)},$$slots:{default:!0}});var J=ht(ne,2);J.__click=M;var le=ht(j,2),ae=ht(Bt(le),2),pe=Bt(ae);fs(pe,{get checked(){return ee(_)},set checked(Ce){yt(_,Ce,!0)},children:(Ce,tt)=>{var Ke=Hn("Only for major roads");pt(Ce,Ke)},$$slots:{default:!0}});var fe=ht(pe,2);fe.__click=x;var Te=ht(le,2);Te.__click=b,pt(U,G)},$$slots:{header:!0,body:!0}})},F=H=>{var Y=fse();Y.__click=()=>yt(s,!0),pt(H,Y)};Ki(L,H=>{t()?H(I):H(F,!1)})}var N=ht(L,2);hp(N,{get show(){return ee(s)},set show(H){yt(s,H,!0)},children:(H,Y)=>{var q=pse(),U=ht(ui(q),4);U.__click=f;var G=ht(U,2);G.__click=()=>yt(s,!1),pt(H,q)},$$slots:{default:!0}}),pt(n,P),tn(),c()}ps(["click"]);var _se=Xt('<span class="svelte-1jjc18c"></span>'),vse=Xt('<span class="color-swatch svelte-1jjc18c"></span> ',1),yse=Xt('<div style="display: flex; align-items: center; gap: 6px;"><!></div>'),bse=Xt('<span class="color-swatch svelte-1jjc18c"></span> ',1),xse=Xt('<div style="display: flex; align-items: center; gap: 6px;"><!></div>'),wse=Xt('<div class="card mb-3"><div class="card-header">Roads</div> <div class="card-body"><div class="row mb-1 svelte-1jjc18c"></div> <!> <div class="mb-3"></div> <!></div></div> <!>',1);function Sse(n,e){en(e,!0);const t=()=>on(ia,"$mutationCounter",r),i=()=>on(Xs,"$backend",r),[r,o]=cs();let c=st(e,"showKinds",15),s=[["RoadWithSeparate","With separate sidewalks"],["RoadWithTags","With tagged sidewalks"],["RoadWithoutSidewalksExplicit","Tagged as no sidewalks"],["RoadWithoutSidewalksImplicit","Assumed as no sidewalks"],["RoadUnknown","Totally unknown"]],f=[["Sidewalk","Sidewalks"],["Crossing","Crossings"],["Other","Other"]],p=Kt(()=>(t(),JSON.parse(i().getMetrics()))),g=Kt(()=>sj(s.map(([F,N])=>ee(p).total_length_meters[F])));function _(F){return F}var x=wse(),b=ui(x),M=ht(Bt(b),2),P=Bt(M);Os(P,21,()=>s,Fs,(F,N)=>{var H=Kt(()=>el(ee(N),2));let Y=()=>ee(H)[0];const q=Kt(()=>ee(p).total_length_meters[Y()]);var U=_se();let G;Ji(j=>G=gh(U,"",G,j),[()=>({width:`${100*ee(q)/ee(g)}%`,height:"100%","background-color":rp[Y()]})]),pt(F,U)});var k=ht(P,2);Os(k,17,()=>s,Fs,(F,N)=>{var H=Kt(()=>el(ee(N),2));let Y=()=>ee(H)[0],q=()=>ee(H)[1];var U=yse(),G=Bt(U);fs(G,{get checked(){return c()[Y()]},set checked(j){c(c()[Y()]=j,!0)},children:(j,B)=>{var ne=vse(),J=ui(ne);let le;var ae=ht(J);Ji((pe,fe)=>{le=gh(J,"",le,pe),ln(ae,` ${q()??""}: ${fe??""}`)},[()=>({background:rp[Y()]}),()=>rM(ee(p).total_length_meters[Y()])]),pt(j,ne)},$$slots:{default:!0}}),pt(F,U)});var L=ht(k,4);xs(L,()=>e.extraControls);var I=ht(b,2);Os(I,17,()=>f,Fs,(F,N)=>{var H=Kt(()=>el(ee(N),2));let Y=()=>ee(H)[0],q=()=>ee(H)[1];var U=xse(),G=Bt(U);fs(G,{get checked(){return c()[Y()]},set checked(j){c(c()[Y()]=j,!0)},children:(j,B)=>{var ne=bse(),J=ui(ne);let le;var ae=ht(J);Ji((pe,fe)=>{le=gh(J,"",le,pe),ln(ae,` ${q()??""}: ${fe??""}`)},[()=>({background:rp[Y()]}),()=>rM(ee(p).total_length_meters[Y()])]),pt(j,ne)},$$slots:{default:!0}}),pt(F,U)}),pt(n,x),tn(),o()}var Tse=Xt("<p> </p>"),Mse=Xt("<u>Problems:</u> <!> <!> <!>",1),Cse=Xt("<li> </li>"),Ese=Xt('<div><button class="btn btn-secondary mb-1"><kbd> </kbd> </button></div>'),Ase=Xt("<u>Current sidewalk tags</u> <ul></ul> <u>Override to these tags</u> <!>",1),Pse=Xt('<div><button class="btn btn-secondary mb-1"><kbd> </kbd> </button></div>'),Ise=Xt("<u>Set these tags</u> <!>",1),Lse=Xt("<tr><td> </td><td> </td></tr>"),Rse=Xt("<p> </p>"),kse=Xt('<!> <div class="card mb-5"><div class="card-header"><a target="_blank"> </a> ( <a target="_blank" title="Edit way"><i class="fa-solid fa-pencil"></i></a> </div> <div class="card-body"><!> <!> <table class="table table-bordered"><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody></tbody></table> <!></div></div>',1);function Dse(n,e){en(e,!0);const t=()=>on(Xs,"$backend",o),i=()=>on(ia,"$mutationCounter",o),r=()=>on(Yx,"$debugMode",o),[o,c]=cs();let s=st(e,"showProblemDetails",15),f=ii("");async function p(ae){yt(f,"Setting tags"),await uu();try{t().editSetTags(BigInt(e.pinnedWay.properties.id),ae),Kf(ia,i())}finally{yt(f,"")}}let g=[[["sidewalk:both","separate"]],[["sidewalk:left","separate"],["sidewalk:right","no"]],[["sidewalk:right","separate"],["sidewalk:left","no"]],[["sidewalk","both"]],[["sidewalk","left"]],[["sidewalk","right"]],[["sidewalk","no"]]],_=[[["footway","sidewalk"]],[["footway","crossing"]]];async function x(ae){let pe=[];e.pinnedWay.properties.kind.startsWith("Road")?pe=g:(e.pinnedWay.properties.kind=="Sidewalk"||e.pinnedWay.properties.kind=="Other")&&(pe=_);let fe=parseInt(ae.key);Number.isInteger(fe)&&fe<=pe.length&&await p(pe[fe-1])}var b=kse();JM("keypress",ly,x);var M=ui(b);vp(M,{get loading(){return ee(f)}});var P=ht(M,2),k=Bt(P),L=Bt(k),I=Bt(L),F=ht(L,2),N=ht(F),H=ht(k,2),Y=Bt(H);{var q=ae=>{var pe=Mse(),fe=ht(ui(pe),2);Os(fe,17,()=>e.pinnedWay.properties.problems,Fs,(Ke,dt)=>{var et=Tse(),Oe=Bt(et);Ji(()=>ln(Oe,ee(dt).note)),pt(Ke,et)});var Te=ht(fe,2);{var Ce=Ke=>{fs(Ke,{get checked(){return s()},set checked(dt){s(dt)},children:(dt,et)=>{var Oe=Hn("Show problem details");pt(dt,Oe)},$$slots:{default:!0}})};Ki(Te,Ke=>{e.drawProblemDetails.features.length&&Ke(Ce)})}var tt=ht(Te,2);{let Ke=Kt(()=>Object.fromEntries(e.drawProblemDetails.features.map(dt=>[dt.properties.label,dt.properties.color])));x2(tt,{get labelColors(){return ee(Ke)},itemsPerRow:1})}pt(ae,pe)};Ki(Y,ae=>{e.pinnedWay.properties.problems.length&&ae(q)})}var U=ht(Y,2);{var G=ae=>{var pe=Ase(),fe=ht(ui(pe),2);Os(fe,21,()=>Object.entries(e.pinnedWay.properties.tags),Fs,(Ce,tt)=>{var Ke=Kt(()=>el(ee(tt),2));let dt=()=>ee(Ke)[0],et=()=>ee(Ke)[1];var Oe=tr(),lt=ui(Oe);{var Ye=zt=>{var Lt=Cse(),At=Bt(Lt);Ji(()=>ln(At,`${dt()??""} = ${et()??""}`)),pt(zt,Lt)};Ki(lt,zt=>{dt().startsWith("sidewalk")&&zt(Ye)})}pt(Ce,Oe)});var Te=ht(fe,4);Os(Te,17,()=>g.entries(),Fs,(Ce,tt)=>{var Ke=Kt(()=>el(ee(tt),2));let dt=()=>ee(Ke)[0],et=()=>ee(Ke)[1];var Oe=Ese(),lt=Bt(Oe);lt.__click=()=>p(et());var Ye=Bt(lt),zt=Bt(Ye),Lt=ht(Ye);Ji(At=>{ln(zt,dt()+1),ln(Lt,` ${At??""}`)},[()=>et().map(At=>`${At[0]} = ${At[1]}`).join(", ")]),pt(Ce,Oe)}),pt(ae,pe)},j=ae=>{var pe=tr(),fe=ui(pe);{var Te=Ce=>{var tt=Ise(),Ke=ht(ui(tt),2);Os(Ke,17,()=>_.entries(),Fs,(dt,et)=>{var Oe=Kt(()=>el(ee(et),2));let lt=()=>ee(Oe)[0],Ye=()=>ee(Oe)[1];var zt=Pse(),Lt=Bt(zt);Lt.__click=()=>p(Ye());var At=Bt(Lt),Nt=Bt(At),$t=ht(At);Ji(Ze=>{ln(Nt,lt()+1),ln($t,` ${Ze??""}`)},[()=>Ye().map(Ze=>`${Ze[0]} = ${Ze[1]}`).join(", ")]),pt(dt,zt)}),pt(Ce,tt)};Ki(fe,Ce=>{(e.pinnedWay.properties.kind=="Sidewalk"||e.pinnedWay.properties.kind=="Other")&&Ce(Te)},!0)}pt(ae,pe)};Ki(U,ae=>{e.pinnedWay.properties.kind.startsWith("Road")?ae(G):ae(j,!1)})}var B=ht(U,2),ne=ht(Bt(B));Os(ne,21,()=>Object.entries(e.pinnedWay.properties.tags),Fs,(ae,pe)=>{var fe=Kt(()=>el(ee(pe),2));let Te=()=>ee(fe)[0],Ce=()=>ee(fe)[1];var tt=Lse(),Ke=Bt(tt),dt=Bt(Ke),et=ht(Ke),Oe=Bt(et);Ji(()=>{ln(dt,Te()),ln(Oe,Ce())}),pt(ae,tt)});var J=ht(B,2);{var le=ae=>{var pe=Rse(),fe=Bt(pe);Ji(Te=>ln(fe,`Nodes: ${Te??""}`),[()=>e.pinnedWay.properties.node_ids.join(", ")]),pt(ae,pe)};Ki(J,ae=>{r()&&ae(le)})}Ji(()=>{lu(L,"href",`https://www.openstreetmap.org/way/${e.pinnedWay.properties.id??""}`),ln(I,`Way ${e.pinnedWay.properties.id??""}`),lu(F,"href",`https://www.openstreetmap.org/edit?way=${e.pinnedWay.properties.id??""}`),ln(N,` ) : ${zre[e.pinnedWay.properties.kind]??""}`)}),pt(n,b),tn(),c()}ps(["click"]);var Fse=Xt("<!> <!> <!> <!>",1),Ose=Xt("<tr><td> </td><td> </td></tr>"),zse=Xt("<p> </p>"),Bse=Xt("<u>Problems:</u> <!>",1),Nse=Xt('<h4> </h4> <p> </p> <table class="table table-bordered"><tbody></tbody></table> <!>',1),$se=Xt("<!> <!> <!>",1),Vse=Xt("<!> <!> <!> <!>",1),Use=Xt("<!> <!> <!> <!>",1),jse=Xt("<!> <!>",1);function Gse(n,e){en(e,!0);const t=()=>on(ia,"$mutationCounter",o),i=()=>on(Xs,"$backend",o),r=()=>on(Yx,"$debugMode",o),[o,c]=cs();let s=ii({type:"FeatureCollection",features:[]}),f=ii({type:"FeatureCollection",features:[]}),p=ii(null),g=ii(!1),_=ii(!1),x=ii(!1),b=ii(!0),M=ii(bs(Object.fromEntries(Object.keys(rp).map(U=>[U,!0])))),P=ii(!0),k=ii(bs(no())),L=ii(!1),I=ii(""),F=ii(bs(no()));cn(()=>{t(),yt(I,"Recalculating model"),uu().then(()=>{try{yt(s,JSON.parse(i().getNodes())),yt(f,JSON.parse(i().getWays()))}finally{yt(I,"")}if(ee(p)){let U=ee(p).id;yt(p,ee(f).features.find(G=>G.id==U),!0)}})});function N(){let U=[];return ee(x)&&U.push(["any",["in",["get","kind"],["literal",["Sidewalk","Crossing","Other"]]],["get","is_severance"]]),ee(b)||U.push(["!",["get","is_service"]]),ee(_)&&U.push(["get","modified"]),U.push(["in",["get","kind"],["literal",Object.entries(ee(M)).filter(G=>G[1]).map(G=>G[0])]]),["all",...U]}var H=jse(),Y=ui(H);vp(Y,{get loading(){return ee(I)}});var q=ht(Y,2);Xy(q,{left:j=>{var B=Fse(),ne=ui(B);hse(ne,{});var J=ht(ne,2);sse(J,{get nodes(){return ee(s)},get ways(){return ee(f)},get drawProblems(){return ee(F)},set drawProblems(fe){yt(F,fe,!0)}});var le=ht(J,2);{var ae=fe=>{Dse(fe,{get pinnedWay(){return ee(p)},get drawProblemDetails(){return ee(k)},get showProblemDetails(){return ee(P)},set showProblemDetails(Te){yt(P,Te,!0)}})};Ki(le,fe=>{ee(p)&&fe(ae)})}var pe=ht(le,2);gse(pe,{}),pt(j,B)},main:j=>{var B=Use(),ne=ui(B);{let pe=Kt(N);Vre(ne,{get showProblemDetails(){return ee(P)},get nodes(){return ee(s)},get ways(){return ee(f)},get showRoadSides(){return ee(L)},get filterWays(){return ee(pe)},get pinnedWay(){return ee(p)},set pinnedWay(fe){yt(p,fe,!0)},get drawProblemDetails(){return ee(k)},set drawProblemDetails(fe){yt(k,fe,!0)}})}var J=ht(ne,2);ase(J,{get drawProblems(){return ee(F)},get pinnedWay(){return ee(p)}});var le=ht(J,2);Hs(le,{get data(){return ee(s)},children:(pe,fe)=>{{let Te=Kt(()=>({"circle-radius":7,"circle-color":["case",["any",["get","is_crossing"],["get","is_explicit_crossing_no"]],"yellow","grey"],"circle-opacity":["case",["any",["get","is_crossing"],["get","is_explicit_crossing_no"]],ee(_)?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1})),Ce=Kt(()=>({visibility:ee(g)?"visible":"none"}));ru(pe,{beforeId:"Road labels",manageHoverState:!0,get paint(){return ee(Te)},get layout(){return ee(Ce)},children:(tt,Ke)=>{g2(tt,{openOn:"hover",children:(et,Oe)=>{let lt=()=>Oe?.().data;const Ye=Kt(()=>lt()?.properties??{}),zt=Kt(()=>JSON.parse(ee(Ye).problems));var Lt=Nse(),At=ui(Lt),Nt=Bt(At),$t=ht(At,2),Ze=Bt($t),bt=ht($t,2),Mt=Bt(bt);Os(Mt,21,()=>Object.entries(JSON.parse(ee(Ye).tags||"{}")),Fs,(Ee,xe)=>{var ft=Kt(()=>el(ee(xe),2));let ve=()=>ee(ft)[0],te=()=>ee(ft)[1];var se=Ose(),Ie=Bt(se),Ue=Bt(Ie),ct=ht(Ie),we=Bt(ct);Ji(()=>{ln(Ue,ve()),ln(we,te())}),pt(Ee,se)});var Zt=ht(bt,2);{var Pt=Ee=>{var xe=Bse(),ft=ht(ui(xe),2);Os(ft,17,()=>ee(zt),Fs,(ve,te)=>{var se=zse(),Ie=Bt(se);Ji(()=>ln(Ie,ee(te).note)),pt(ve,se)}),pt(Ee,xe)};Ki(Zt,Ee=>{ee(zt).length&&Ee(Pt)})}Ji(()=>{ln(Nt,`Node ${ee(Ye).id??""}`),ln(Ze,`Ways: ${ee(Ye).way_ids??""}`)}),pt(et,Lt)},$$slots:{default:!0}})},$$slots:{default:!0}})}},$$slots:{default:!0}});var ae=ht(le,2);Dk(ae,{position:"top-right",children:(pe,fe)=>{jd(pe,{header:tt=>{var Ke=Hn("Layers");pt(tt,Ke)},body:tt=>{var Ke=Vse(),dt=ui(Ke);fs(dt,{get checked(){return W$(),r()},set checked(Ye){rl(Yx,Ye)},children:(Ye,zt)=>{var Lt=Hn("Debug mode");pt(Ye,Lt)},$$slots:{default:!0}});var et=ht(dt,2);fs(et,{get checked(){return ee(g)},set checked(Ye){yt(g,Ye,!0)},children:(Ye,zt)=>{var Lt=Hn("Nodes");pt(Ye,Lt)},$$slots:{default:!0}});var Oe=ht(et,2);fs(Oe,{get checked(){return ee(_)},set checked(Ye){yt(_,Ye,!0)},children:(Ye,zt)=>{var Lt=Hn("Only modified objects");pt(Ye,Lt)},$$slots:{default:!0}});var lt=ht(Oe,2);Sse(lt,{get showKinds(){return ee(M)},set showKinds(zt){yt(M,zt,!0)},extraControls:zt=>{var Lt=$se(),At=ui(Lt);fs(At,{get checked(){return ee(x)},set checked(Ze){yt(x,Ze,!0)},children:(Ze,bt)=>{var Mt=Hn("Only show major roads");pt(Ze,Mt)},$$slots:{default:!0}});var Nt=ht(At,2);fs(Nt,{get checked(){return ee(b)},set checked(Ze){yt(b,Ze,!0)},children:(Ze,bt)=>{var Mt=Hn("Show service roads");pt(Ze,Mt)},$$slots:{default:!0}});var $t=ht(Nt,2);fs($t,{get checked(){return ee(L)},set checked(Ze){yt(L,Ze,!0)},children:(Ze,bt)=>{var Mt=Hn("Show each side with sidewalks â or not â");pt(Ze,Mt)},$$slots:{default:!0}}),pt(zt,Lt)},$$slots:{extraControls:!0}}),pt(tt,Ke)},$$slots:{header:!0,body:!0}})},$$slots:{default:!0}}),pt(j,B)},$$slots:{left:!0,main:!0}}),pt(n,H),tn(),c()}var qse=Xt(`<button class="btn btn-secondary">Generate imaginary crossings where they're missing</button>`),Hse=Xt('<button class="btn btn-secondary">Bulk operations</button>'),Wse=Xt(`<h2>Bulk operations</h2> <p>Speedwalk has some experimental features that can automatically generate
    crossing nodes on every arm of a junction where they're expected. This is
    intended <b>only</b> for use in other projects to study the potential benefits of having more crossings.
    Do not ever upload the results of this to OSM.</p> <button class="btn btn-primary">I understand</button> <button class="btn btn-secondary">Cancel</button>`,1),Zse=Xt("<!> <!> <!>",1);function Xse(n,e){en(e,!0);const t=()=>on(Xx,"$enabledBulkOps",o),i=()=>on(Xs,"$backend",o),r=()=>on(ia,"$mutationCounter",o),[o,c]=cs();let s=ii(!1);function f(){rl(Xx,!0),yt(s,!1)}let p=ii("");async function g(){yt(p,"Generating missing crossings"),await uu();try{i().editGenerateMissingCrossings(e.options),Kf(ia,r())}catch(L){window.alert(`Error: ${L}`)}finally{yt(p,"")}}var _=Zse(),x=ui(_);vp(x,{get loading(){return ee(p)}});var b=ht(x,2);{var M=L=>{jd(L,{header:N=>{var H=Hn("Bulk operations");pt(N,H)},body:N=>{var H=qse();H.__click=g,pt(N,H)},$$slots:{header:!0,body:!0}})},P=L=>{var I=Hse();I.__click=()=>yt(s,!0),pt(L,I)};Ki(b,L=>{t()?L(M):L(P,!1)})}var k=ht(b,2);hp(k,{get show(){return ee(s)},set show(L){yt(s,L,!0)},children:(L,I)=>{var F=Wse(),N=ht(ui(F),4);N.__click=f;var H=ht(N,2);H.__click=()=>yt(s,!1),pt(L,F)},$$slots:{default:!0}}),pt(n,_),tn(),c()}ps(["click"]);var Yse=Xt('<p> <!> <!>.</p> <p class="mb-3"><i> </i></p>',1),Kse=Xt(`<h4>Crossings audit</h4> <p> </p> <!> <hr/> <p>For each junction shown, this tool looks for crossing nodes on each arm
      (road) of the junction. Please map a crossing node on each arm by clicking
      to open in iD, then refreshing data here to check. If there's no way to
      cross an arm, use <a href="https://wiki.openstreetmap.org/wiki/Tag:crossing=no" target="_blank">crossing=no</a> to indicate a lack of a crossing. Please ignore cases where you would not expect
      any crossing to be (and report a bug to improve this tool). And note that there
      might be mid-block crossings anywhere along a road; this tool only audits junctions.</p> <!>`,1),Jse=Xt("<tr><td> </td><td> </td></tr>"),Qse=Xt('<h4> </h4> <table class="table table-bordered"><tbody></tbody></table>',1),eoe=Xt("Ignore <code>service</code> , <code>track</code> roads",1),toe=Xt("Ignore <code>footway</code> and <code>path</code>",1),ioe=Xt('<!> <!> <!> <!> <!> <!> <div><label class="form-label">How far away can a crossing be? (m): <input class="form-control" type="number" min="1" max="100"/></label></div> <div class="card card-body mt-3"><!></div>',1),noe=Xt("<!> <!> <!> <!> <!> <!>",1);function roe(n,e){en(e,!0);const t=()=>on(Xs,"$backend",o),i=()=>on(ia,"$mutationCounter",o),r=()=>on(kh,"$map",o),[o,c]=cs();let s=bs({only_major_roads:!0,ignore_utility_roads:!0,ignore_cycleways:!0,ignore_footways:!0,ignore_roundabouts:!0,ignore_motorways:!0,max_distance:40}),f=Kt(()=>t()&&s.max_distance&&i()>=0?JSON.parse(t().auditCrossings(s)):no()),p=Kt(()=>ee(f).features.filter(N=>N.properties.complete).length),g=ii(void 0),_=Kt(()=>ee(g)?JSON.parse(ee(g).properties.arms):no()),x=Kt(()=>ee(g)?JSON.parse(ee(g).properties.crossings):no()),b=Kt(()=>ee(g)?JSON.parse(ee(g).properties.explicit_non_crossings):no()),M=Kt(()=>ee(x).features.length),P=Kt(()=>ee(b).features.length),k=Kt(()=>ee(g)?ee(g).properties.number_ignored_arms:0),L=Kt(()=>{if(i(),!t())return no();let N=JSON.parse(t().getNodes());return N.features=N.features.filter(H=>H.properties.is_crossing||H.properties.is_explicit_crossing_no),N});function I(){let N=SD(r());if(N){let H=TD(N.zoom,N.lat,N.lng);window.open(H,"_blank","noopener,noreferrer")}}let F={"Junction to audit":"black","Fully mapped junction":"green",Crossing:"yellow","crossing=no":"purple","crossing=imaginary":"cyan"};Xy(n,{left:Y=>{var q=Kse(),U=ht(ui(q),2),G=Bt(U),j=ht(U,2);{var B=J=>{var le=Yse(),ae=ui(le),pe=Bt(ae),fe=ht(pe);{var Te=lt=>{var Ye=Hn();Ji(()=>ln(Ye,`(plus ${ee(k)??""}
          ${ee(k)==1?"arm":"arms"} not expected to have crossings)`)),pt(lt,Ye)};Ki(fe,lt=>{ee(k)>0&&lt(Te)})}var Ce=ht(fe),tt=ht(Ce);{var Ke=lt=>{var Ye=Hn();Ji(()=>ln(Ye,`, ${ee(P)??""} explicit ${ee(P)==1?"non-crossing":"non-crossings"}`)),pt(lt,Ye)};Ki(tt,lt=>{ee(P)>0&&lt(Ke)})}var dt=ht(ae,2),et=Bt(dt),Oe=Bt(et);Ji(()=>{ln(pe,`Junction has ${ee(_).features.length-ee(k)} arms `),ln(Ce,`,
        ${ee(M)??""}
        ${ee(M)==1?"crossing":"crossings"} `),ln(Oe,`Arms are up to ${s.max_distance??""}m away from the junction along
          the same OSM way. If the way is split before a crossing, the crossing
          won't be counted. Only the first crossing is counted per arm.`)}),pt(J,le)};Ki(j,J=>{ee(g)&&J(B)})}var ne=ht(j,6);Xse(ne,{get options(){return s}}),Ji((J,le)=>ln(G,`${J??""} / ${le??""}
      junctions have all possible crossings mapped`),[()=>ee(p).toLocaleString(),()=>ee(f).features.length.toLocaleString()]),pt(Y,q)},main:Y=>{var q=noe(),U=ui(q);Hs(U,{get data(){return ee(f)},generateId:!0,children:(le,ae)=>{{let pe=Kt(()=>({"circle-radius":15,"circle-color":["case",["get","complete"],F["Fully mapped junction"],F["Junction to audit"]],"circle-opacity":Fg(.5,1),"circle-stroke-color":"black","circle-stroke-width":3}));ru(le,{manageHoverState:!0,get paint(){return ee(pe)},hoverCursor:"pointer",onclick:I,get hovered(){return ee(g)},set hovered(fe){yt(g,fe,!0)}})}},$$slots:{default:!0}});var G=ht(U,2);Hs(G,{get data(){return ee(_)},children:(le,ae)=>{Fl(le,{paint:{"line-width":6,"line-color":["case",["get","has_crossing"],"blue","red"]}})},$$slots:{default:!0}});var j=ht(G,2);Hs(j,{get data(){return ee(L)},generateId:!0,children:(le,ae)=>{{let pe=Kt(()=>({"circle-radius":7,"circle-color":["case",["get","is_explicit_crossing_no"],F["crossing=no"],["get","is_imaginary_crossing"],F["crossing=imaginary"],F.Crossing],"circle-opacity":Fg(.3,1),"circle-stroke-color":"black","circle-stroke-width":1}));ru(le,{manageHoverState:!0,get paint(){return ee(pe)},children:(fe,Te)=>{g2(fe,{openOn:"hover",children:(tt,Ke)=>{let dt=()=>Ke?.().data;const et=Kt(()=>dt()?.properties??{});var Oe=Qse(),lt=ui(Oe),Ye=Bt(lt),zt=ht(lt,2),Lt=Bt(zt);Os(Lt,21,()=>Object.entries(JSON.parse(ee(et).tags||"{}")),Fs,(At,Nt)=>{var $t=Kt(()=>el(ee(Nt),2));let Ze=()=>ee($t)[0],bt=()=>ee($t)[1];var Mt=Jse(),Zt=Bt(Mt),Pt=Bt(Zt),Ee=ht(Zt),xe=Bt(Ee);Ji(()=>{ln(Pt,Ze()),ln(xe,bt())}),pt(At,Mt)}),Ji(()=>ln(Ye,`Node ${ee(et).id??""}`)),pt(tt,Oe)},$$slots:{default:!0}})},$$slots:{default:!0}})}},$$slots:{default:!0}});var B=ht(j,2);Hs(B,{get data(){return ee(x)},children:(le,ae)=>{ru(le,{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"black","circle-stroke-width":3}})},$$slots:{default:!0}});var ne=ht(B,2);Hs(ne,{get data(){return ee(b)},children:(le,ae)=>{ru(le,{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"purple","circle-stroke-width":3}})},$$slots:{default:!0}});var J=ht(ne,2);Dk(J,{position:"top-right",children:(le,ae)=>{jd(le,{header:Te=>{var Ce=Hn("Settings");pt(Te,Ce)},body:Te=>{var Ce=ioe(),tt=ui(Ce);fs(tt,{get checked(){return s.only_major_roads},set checked($t){s.only_major_roads=$t},children:($t,Ze)=>{var bt=Hn("Only junctions on major roads");pt($t,bt)},$$slots:{default:!0}});var Ke=ht(tt,2);fs(Ke,{get checked(){return s.ignore_utility_roads},set checked($t){s.ignore_utility_roads=$t},children:($t,Ze)=>{var bt=eoe();pt($t,bt)},$$slots:{default:!0}});var dt=ht(Ke,2);fs(dt,{get checked(){return s.ignore_cycleways},set checked($t){s.ignore_cycleways=$t},children:($t,Ze)=>{var bt=Hn("Ignore cycleways");pt($t,bt)},$$slots:{default:!0}});var et=ht(dt,2);fs(et,{get checked(){return s.ignore_footways},set checked($t){s.ignore_footways=$t},children:($t,Ze)=>{var bt=toe();pt($t,bt)},$$slots:{default:!0}});var Oe=ht(et,2);fs(Oe,{get checked(){return s.ignore_roundabouts},set checked($t){s.ignore_roundabouts=$t},children:($t,Ze)=>{var bt=Hn("Don't expect crossings on roundabouts");pt($t,bt)},$$slots:{default:!0}});var lt=ht(Oe,2);fs(lt,{get checked(){return s.ignore_motorways},set checked($t){s.ignore_motorways=$t},children:($t,Ze)=>{var bt=Hn("Don't expect crossings on motorways");pt($t,bt)},$$slots:{default:!0}});var Ye=ht(lt,2),zt=Bt(Ye),Lt=ht(Bt(zt)),At=ht(Ye,2),Nt=Bt(At);x2(Nt,{get labelColors(){return F},itemsPerRow:1,swatchClass:"circle"}),qv(Lt,()=>s.max_distance,$t=>s.max_distance=$t),pt(Te,Ce)},$$slots:{header:!0,body:!0}})},$$slots:{default:!0}}),pt(Y,q)},$$slots:{left:!0,main:!0}}),tn(),c()}var soe=Xt('<div class="card"><div class="card-body"><div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio"/> Everything</label></div> <div class="form-check"><label class="form-check-label"><input class="form-check-input" type="radio"/> Only footways</label></div> <div class="form-check mb-3"><label class="form-check-label"><input class="form-check-input" type="radio"/> Anything routeable for walking</label></div> <!></div></div>');function Wz(n,e){en(e,!1);const t=()=>on(Gf,"$networkFilter",i),[i,r]=cs(),o=[];Tw();var c=soe(),s=Bt(c),f=Bt(s),p=Bt(f),g=Bt(p);g.value=g.__value="Everything";var _=ht(f,2),x=Bt(_),b=Bt(x);b.value=b.__value="OnlyExplicitFootways";var M=ht(_,2),P=Bt(M),k=Bt(P);k.value=k.__value="RouteableNetwork";var L=ht(M,2);fs(L,{get checked(){return t().ignore_deadends},set checked(I){ub(Gf,ys(t).ignore_deadends=I,ys(t))},children:(I,F)=>{var N=Hn("Ignore deadends under 10m");pt(I,N)},$$slots:{default:!0},$$legacy:!0}),hS(o,[],g,()=>t().include,I=>ub(Gf,ys(t).include=I,ys(t))),hS(o,[],b,()=>t().include,I=>ub(Gf,ys(t).include=I,ys(t))),hS(o,[],k,()=>t().include,I=>ub(Gf,ys(t).include=I,ys(t))),pt(n,c),tn(),r()}var ooe=Xt('<li><a href="#"> </a></li>'),aoe=Xt("<h4>Network disconnections</h4> <p>This shows where the network is disconnected. Click a piece to see it.</p> <!> <ul></ul>",1),loe=Xt("<!> <!>",1);function coe(n,e){en(e,!0);const t=()=>on(Xs,"$backend",o),i=()=>on(Gf,"$networkFilter",o),r=()=>on(kh,"$map",o),[o,c]=cs();let s=Kt(()=>t()?JSON.parse(t().findConnectedComponents(i())):{...no(),component_lengths:[]}),f=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],p=yy(["to-string",["%",["get","component"],f.length]],Object.fromEntries(f.map((M,P)=>[P.toString(),M])),"black"),g=ii(null);function _(M){return M==null?p:["case",["==",["get","component"],M],p,"black"]}function x(M){yt(g,M.features[0].properties.component,!0)}function b(M){r().queryRenderedFeatures(M.point,{layers:["speedwalk-disconnections"]}).length==0&&yt(g,null)}Xy(n,{left:k=>{var L=aoe(),I=ht(ui(L),4);Wz(I,{});var F=ht(I,2);Os(F,21,()=>ee(s).component_lengths,Fs,(N,H,Y)=>{var q=ooe(),U=Bt(q);U.__click=B=>{B.preventDefault(),r()?.fitBounds(ee(s).component_bboxes[Y]),yt(g,Y,!0)};let G;var j=Bt(U);Ji(B=>{G=gh(U,"",G,{color:f[Y%f.length]}),ln(j,B)},[()=>rM(ee(H))]),pt(N,q)}),pt(k,L)},main:k=>{var L=loe(),I=ui(L);zk(I,{onclick:b});var F=ht(I,2);Hs(F,{get data(){return ee(s)},generateId:!0,children:(N,H)=>{{let Y=Kt(()=>({"line-width":Fg(5,10),"line-color":_(ee(g))}));Fl(N,{id:"speedwalk-disconnections",get paint(){return ee(Y)},manageHoverState:!0,hoverCursor:"pointer",onclick:x})}},$$slots:{default:!0}}),pt(k,L)},$$slots:{left:!0,main:!0}}),tn(),c()}ps(["click"]);var uoe=Xt(`<p>The output will have a LineString for each edge in the network. An
          edge goes between exactly two graph nodes, so one OSM way usually
          becomes many edges. Each LineString will have these properties:</p> <ul><li><b>node1</b> : The OSM node ID of the beginning of the edge. This is safer to use to
            form a graph than the first coordinate.</li> <li><b>node2</b> : The OSM node ID of the end of the edge. This is safer to use to form
            a graph than the last coordinate.</li> <li><b>way</b> : The OSM way ID where this edge comes from.</li> <li><b>kind</b> : Speedwalk's classification of this edge</li> <li>Each tag from the OSM way will appear as a key and value</li></ul> <p>Note OSM IDs will be negative if you have run bulk operations and
          generated synthetic sidewalks or crossings.</p>`,1),hoe=Xt('<h4>Export network</h4> <p>You can export the routeable walking network as a GeoJSON file.</p> <!> <button class="btn btn-primary mt-3 mb-3">Download GeoJSON</button> <!> <!>',1),doe=Xt("<tr><td> </td><td> </td></tr>"),foe=Xt('<table class="table table-bordered"><tbody></tbody></table>');function poe(n,e){en(e,!0);const t=()=>on(Xs,"$backend",r),i=()=>on(Gf,"$networkFilter",r),[r,o]=cs();let c=Kt(()=>t()?JSON.parse(t().exportNetwork(i())):no());function s(){Pw("network.geojson",JSON.stringify(ee(c)))}Xy(n,{left:g=>{var _=hoe(),x=ht(ui(_),4);Wz(x,{});var b=ht(x,2);b.__click=s;var M=ht(b,2);jd(M,{open:!1,header:I=>{var F=Hn("Details");pt(I,F)},body:I=>{var F=uoe();pt(I,F)},$$slots:{header:!0,body:!0}});var P=ht(M,2);jd(P,{header:I=>{var F=Hn("Legend");pt(I,F)},body:I=>{x2(I,{get labelColors(){return rp},itemsPerRow:1})},$$slots:{header:!0,body:!0}}),pt(g,_)},main:g=>{Hs(g,{get data(){return ee(c)},generateId:!0,children:(_,x)=>{{let b=Kt(()=>({"line-width":Zf(0),"line-color":yy(["get","kind"],rp,"cyan"),"line-opacity":Fg(1,.5)}));Fl(_,{manageHoverState:!0,get paint(){return ee(b)},children:(M,P)=>{g2(M,{openOn:"hover",children:(L,I)=>{let F=()=>I?.().data;var N=foe(),H=Bt(N);Os(H,21,()=>Object.entries(F().properties),Fs,(Y,q)=>{var U=Kt(()=>el(ee(q),2));let G=()=>ee(U)[0],j=()=>ee(U)[1];var B=doe(),ne=Bt(B),J=Bt(ne),le=ht(ne),ae=Bt(le);Ji(()=>{ln(J,G()),ln(ae,j())}),pt(Y,B)}),pt(L,N)},$$slots:{default:!0}})},$$slots:{default:!0}})}},$$slots:{default:!0}})},$$slots:{left:!0,main:!0}}),tn(),o()}ps(["click"]);function moe(n,e){en(e,!1);const t=()=>on(Xs,"$backend",i),[i,r]=cs();let o=JSON.parse(t().getBoundary()),c={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],o.geometry.coordinates[0]]}};Tw(),Hs(n,{get data(){return c},children:(s,f)=>{p2(s,{paint:{"fill-color":"black","fill-opacity":.3}})},$$slots:{default:!0}}),tn(),r()}var goe=Xt('<img alt="OSM avatar" height="30"/>'),_oe=Xt('<div class="nav-item dropdown"><button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"><!> </button> <ul class="dropdown-menu"><li><a class="dropdown-item" href="#">Logout</a></li></ul></div>'),voe=Xt('<button class="btn btn-primary">Login to OSM</button>');function yoe(n,e){en(e,!1);const t=()=>on(Qv,"$loggedInUser",i),[i,r]=cs();e2(o);async function o(){if(Vv.isLoggedIn()){let x=await Vv.getUser("me");rl(Qv,{name:x.display_name,uid:x.id,avatarUrl:x.img?.href||""})}}async function c(){try{await Vv.login({mode:"popup",clientId:"vyCV0t-IiskqNBgpiHvuSAmf2nC8K-zfByeFL6XtAzc",redirectUrl:`${window.location.origin}/speedwalk/land.html`,scopes:["read_prefs","write_api"]}),await o()}catch(x){window.alert(`Login failed: ${x}`)}}async function s(){rl(Qv,void 0),await Vv.logout()}Tw();var f=tr(),p=ui(f);{var g=x=>{var b=_oe(),M=Bt(b),P=Bt(M);{var k=H=>{var Y=goe();Ji(()=>lu(Y,"src",t().avatarUrl)),pt(H,Y)};Ki(P,H=>{t().avatarUrl&&H(k)})}var L=ht(P),I=ht(M,2),F=Bt(I),N=Bt(F);N.__click=s,Ji(()=>ln(L,` ${t().name??""}`)),pt(x,b)},_=x=>{var b=voe();b.__click=c,pt(x,b)};Ki(p,x=>{t()?x(g):x(_,!1)})}pt(n,f),tn(),r()}ps(["click"]);const boe="/speedwalk/assets/logo-3MjkCCFo.svg";var xoe=Xt('<h1>Choose an area to work on</h1> <div class="mb-3"><button class="btn btn-secondary">Import a new area</button></div> <div class="card card-body mb-3"><p> </p> <button class="btn btn-secondary">Refresh OSM data</button> <!></div> <button class="btn btn-primary">Cancel</button>',1),woe=Xt('<!> <!> <button class="btn btn-outline-secondary">&larr; Load another area</button>',1);function Soe(n,e){en(e,!0);const t=()=>on(Zx,"$anyEdits",r),i=()=>on(Xs,"$backend",r),[r,o]=cs();let c=ii(!1),s=ii(""),f=ii(!1);function p(L){if(L){let I=new Date(1e3*Number(L));return`${I.toLocaleString()} (${g(I)} ago)`}return"unknown"}function g(L){let I=Date.now()-L.getTime(),F=Math.floor(I/1e3),N=Math.floor(F/60),H=Math.floor(N/60),Y=Math.floor(H/24);return Y?Y==1?"1 day":`${Y} days`:H?H==1?"1 hour":`${H} hours`:N?N==1?"1 minute":`${N} minutes`:"a few seconds"}function _(){t()&&!window.confirm("Changing areas will discard your current edits. Do you want to clear the edits?")||(rl(Xs,null),rl(Zx,!1))}async function x(){if(!(t()&&!window.confirm("Refreshing OSM data will discard your current edits. Do you want to clear the edits?"))){yt(c,!1);try{yt(s,"Grabbing new OSM data from Overpass");let L=JSON.parse(i().getBoundary()),I=xD(L),F=await fetch(I);if(!F.ok)throw new Error(`Overpass failed: ${F}`);let N=await F.bytes();if(ee(f)){let H=new TextDecoder().decode(N);Pw("refreshed_import.osm.xml",H)}yt(s,"Processing Overpass data"),await uu(),rl(Xs,new Wx(new Uint8Array(N),L))}catch(L){window.alert(`Couldn't import from Overpass: ${L}`)}finally{yt(s,"")}}}var b=woe(),M=ui(b);vp(M,{get loading(){return ee(s)}});var P=ht(M,2);hp(P,{get show(){return ee(c)},set show(L){yt(c,L,!0)},children:(L,I)=>{var F=xoe(),N=ht(ui(F),2),H=Bt(N);H.__click=_;var Y=ht(N,2),q=Bt(Y),U=Bt(q),G=ht(q,2);G.__click=x;var j=ht(G,2);fs(j,{get checked(){return ee(f)},set checked(ne){yt(f,ne,!0)},children:(ne,J)=>{var le=Hn("Save a copy of the latest osm.xml after refreshing");pt(ne,le)},$$slots:{default:!0}});var B=ht(Y,2);B.__click=()=>yt(c,!1),Ji(ne=>ln(U,`OSM data is from ${ne??""}`),[()=>p(i()?.getOsmTimestamp())]),pt(L,F)},$$slots:{default:!0}});var k=ht(P,2);k.__click=()=>yt(c,!0),pt(n,b),tn(),o()}ps(["click"]);var Toe=Xt('<li class="nav-item"><a href="#"> </a></li>'),Moe=Xt("<!> <!>",1),Coe=Xt(`<h1>Welcome to Speedwalk</h1> <p>This tool helps you quickly assess how sidewalks are mapped in OSM. You can
    find and fix common tagging problems. The tool assumes you understand the
    correct <a href="https://wiki.openstreetmap.org/wiki/Sidewalks" target="_blank">sidewalk mapping conventions</a> . If you are unsure about some edits you make, you can download the changeset
    file and check in JOSM, rather than uploading directly.</p> <p>This is an <a href="https://github.com/a-b-street/speedwalk" target="_blank">open source project</a> developed without funding by <a href="https://abstreet.uk" target="_blank">A/B Street Ltd</a> . Please file a Github issue or contact <a href="mailto:dustin@abstreet.uk" target="_blank">dustin@abstreet.uk</a> with feedback. <b>This is an alpha tool; there will be problems!</b></p> <button class="btn btn-primary">Start</button>`,1),Eoe=Xt('<ul class="nav nav-underline"><img style="height: 30px" alt="A/B Street logo"/> <h3>Speedwalk</h3> <!> <li class="nav-item ms-auto"><a class="nav-link" href="#"><i class="fa-solid fa-circle-info"></i> About</a></li> <!></ul> <!>',1);function Aoe(n){const e=()=>on(Xs,"$backend",i),t=()=>on(nM,"$mode",i),[i,r]=cs();let o=ii(!1),c=[[{kind:"sidewalks"},"Sidewalks"],[{kind:"crossings"},"Crossings"],[{kind:"disconnections"},"Network disconnections"],[{kind:"export"},"Export"]];var s=Eoe(),f=ui(s),p=Bt(f),g=ht(p,4);{var _=k=>{var L=Moe(),I=ui(L);Soe(I,{});var F=ht(I,2);Os(F,17,()=>c,Fs,(N,H)=>{var Y=Kt(()=>el(ee(H),2));let q=()=>ee(Y)[0],U=()=>ee(Y)[1];var G=Toe(),j=Bt(G);let B;j.__click=()=>rl(nM,q());var ne=Bt(j);Ji(J=>{B=lp(j,1,"nav-link",null,B,J),ln(ne,U())},[()=>({active:JSON.stringify(t())==JSON.stringify(q())})]),pt(N,G)}),pt(k,L)};Ki(g,k=>{e()&&k(_)})}var x=ht(g,2),b=Bt(x);b.__click=()=>yt(o,!0);var M=ht(x,2);yoe(M,{});var P=ht(f,2);hp(P,{get show(){return ee(o)},set show(k){yt(o,k,!0)},children:(k,L)=>{var I=Coe(),F=ht(ui(I),6);F.__click=()=>yt(o,!1),pt(k,I)},$$slots:{default:!0}}),Ji(()=>lu(p,"src",boe)),pt(n,s),r()}ps(["click"]);var Poe=Xt('<link rel="icon" type="image/x-icon"/>'),Ioe=Xt("<div></div>"),Loe=Xt('<div class="p-3"><!></div>'),Roe=Xt("<!> <!>",1),koe=Xt("<!> <!> <!> <!>",1),Doe=Xt('<div style="position:relative; width: 100%; height: 100vh;"><!></div>');function Foe(n,e){en(e,!0);const t=()=>on(Xs,"$backend",r),i=()=>on(nM,"$mode",r),[r,o]=cs();e2(async()=>{await wD()});let c=ii(void 0),s=ii(!1);cn(()=>{ee(c)&&kh.set(ee(c))});let f=ii("Maptiler OpenStreetMap"),p=Qf.get(ee(f));cn(()=>{ee(f)&&ys(()=>{ee(c)?.setStyle(Qf.get(ee(f)),{transformStyle:(g,_)=>{if(!g)return _;let x=g.layers.filter(P=>["circle-","line-","fill-","heatmap-","symbol-","speedwalk-","edit-polygon-"].some(k=>P.id.startsWith(k))),b=_.layers.concat(x),M=_.sources;for(let[P,k]of Object.entries(g.sources||{}))(P.startsWith("geojson-")||P.startsWith("heatmap")||P.startsWith("vector-"))&&(M[P]=k);return{..._,sources:M,layers:b}}})})}),k$("1n46o8q",g=>{var _=Poe();Ji(()=>lu(_,"href",lj)),pt(g,_)}),WV(n,{top:b=>{Aoe(b)},left:b=>{var M=Loe(),P=Bt(M);{var k=L=>{var I=Ioe();vc(I,F=>Yv.value=F,()=>Yv?.value),pt(L,I)};Ki(P,L=>{ee(c)&&L(k)})}pt(b,M)},main:b=>{var M=Doe(),P=Bt(M);{let k=Kt(()=>[{id:"arrow",url:cj},{id:"chevron",url:uj}]);eV(P,{get style(){return p},hash:!0,onerror:L=>{console.log(L.error)},get images(){return ee(k)},get map(){return ee(c)},set map(L){yt(c,L,!0)},get loaded(){return ee(s)},set loaded(L){yt(s,L,!0)},children:(L,I)=>{var F=koe(),N=ui(F);$U(N,{get map(){return ee(c)}});var H=ht(N,2);BU(H,{get map(){return ee(c)},get loaded(){return ee(s)}});var Y=ht(H,2);Ore(Y,{get basemap(){return ee(f)},set basemap(G){yt(f,G,!0)}});var q=ht(Y,2);{var U=G=>{var j=tr(),B=ui(j);{var ne=le=>{var ae=Roe(),pe=ui(ae);moe(pe,{});var fe=ht(pe,2);Hy(fe,i,Te=>{var Ce=tr(),tt=ui(Ce);{var Ke=et=>{Gse(et,{})},dt=et=>{var Oe=tr(),lt=ui(Oe);{var Ye=Lt=>{roe(Lt,{})},zt=Lt=>{var At=tr(),Nt=ui(At);{var $t=bt=>{coe(bt,{})},Ze=bt=>{var Mt=tr(),Zt=ui(Mt);{var Pt=Ee=>{poe(Ee,{})};Ki(Zt,Ee=>{i().kind=="export"&&Ee(Pt)},!0)}pt(bt,Mt)};Ki(Nt,bt=>{i().kind=="disconnections"?bt($t):bt(Ze,!1)},!0)}pt(Lt,At)};Ki(lt,Lt=>{i().kind=="crossings"?Lt(Ye):Lt(zt,!1)},!0)}pt(et,Oe)};Ki(tt,et=>{i().kind=="sidewalks"?et(Ke):et(dt,!1)})}pt(Te,Ce)}),pt(le,ae)},J=le=>{aj(le,{})};Ki(B,le=>{t()?le(ne):le(J,!1)})}pt(G,j)};Ki(q,G=>{ee(c)&&G(U)})}pt(L,F)},$$slots:{default:!0}})}pt(b,M)},$$slots:{top:!0,left:!0,main:!0}}),tn(),o()}E$(Foe,{target:document.getElementById("app")});
