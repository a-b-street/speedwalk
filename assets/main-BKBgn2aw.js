var b1=Object.defineProperty;var v1=(r,e,n)=>e in r?b1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var Wn=(r,e,n)=>v1(r,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function n(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(c){if(c.ep)return;c.ep=!0;const d=n(c);fetch(c.href,d)}})();function Ot(){}function w1(r,e){for(const n in e)r[n]=e[n];return r}function s0(r){return r()}function fg(){return Object.create(null)}function jn(r){r.forEach(s0)}function np(r){return typeof r=="function"}function Yt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let $h;function Gn(r,e){return r===e?!0:($h||($h=document.createElement("a")),$h.href=e,r===$h.href)}function x1(r){return Object.keys(r).length===0}function o0(r,...e){if(r==null){for(const o of e)o(void 0);return Ot}const n=r.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function a0(r){let e;return o0(r,n=>e=n)(),e}function Bt(r,e,n){r.$$.on_destroy.push(o0(e,n))}function wn(r,e,n,o){if(r){const c=l0(r,e,n,o);return r[0](c)}}function l0(r,e,n,o){return r[1]&&o?w1(n.ctx.slice(),r[1](o(e))):n.ctx}function xn(r,e,n,o){if(r[2]&&o){const c=r[2](o(n));if(e.dirty===void 0)return c;if(typeof c=="object"){const d=[],h=Math.max(e.dirty.length,c.length);for(let a=0;a<h;a+=1)d[a]=e.dirty[a]|c[a];return d}return e.dirty|c}return e.dirty}function kn(r,e,n,o,c,d){if(c){const h=l0(e,n,o,d);r.p(h,c)}}function Sn(r){if(r.ctx.length>32){const e=[],n=r.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function k1(r){const e={};for(const n in r)e[n]=!0;return e}function Yc(r){return r??""}function Qi(r,e,n){return r.set(n),e}function S1(r){return r&&np(r.destroy)?r.destroy:Ot}const c0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ce(r,e){r.appendChild(e)}function be(r,e,n){r.insertBefore(e,n||null)}function ye(r){r.parentNode&&r.parentNode.removeChild(r)}function $n(r,e){for(let n=0;n<r.length;n+=1)r[n]&&r[n].d(e)}function xe(r){return document.createElement(r)}function da(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function gt(r){return document.createTextNode(r)}function Ue(){return gt(" ")}function Mn(){return gt("")}function Ut(r,e,n,o){return r.addEventListener(e,n,o),()=>r.removeEventListener(e,n,o)}function rp(r){return function(e){return e.preventDefault(),r.call(this,e)}}function T1(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function he(r,e,n){n==null?r.removeAttribute(e):r.getAttribute(e)!==n&&r.setAttribute(e,n)}function C1(r){let e;return{p(...n){e=n,e.forEach(o=>r.push(o))},r(){e.forEach(n=>r.splice(r.indexOf(n),1))}}}function u0(r){return r===""?null:+r}function E1(r){return Array.from(r.childNodes)}function _i(r,e){e=""+e,r.data!==e&&(r.data=e)}function mr(r,e){r.value=e??""}function tn(r,e,n,o){n==null?r.style.removeProperty(e):r.style.setProperty(e,n,"")}function dg(r,e,n){for(let o=0;o<r.options.length;o+=1){const c=r.options[o];if(c.__value===e){c.selected=!0;return}}(!n||e!==void 0)&&(r.selectedIndex=-1)}function I1(r){const e=r.querySelector(":checked");return e&&e.__value}function gr(r,e,n){r.classList.toggle(e,!!n)}function A1(r,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(r,{detail:e,bubbles:n,cancelable:o})}let hh;function rh(r){hh=r}function yh(){if(!hh)throw new Error("Function called outside component initialization");return hh}function sp(r){yh().$$.on_mount.push(r)}function ps(r){yh().$$.on_destroy.push(r)}function sl(){const r=yh();return(e,n,{cancelable:o=!1}={})=>{const c=r.$$.callbacks[e];if(c){const d=A1(e,n,{cancelable:o});return c.slice().forEach(h=>{h.call(r,d)}),!d.defaultPrevented}return!0}}function op(r,e){return yh().$$.context.set(r,e),e}function h0(r){return yh().$$.context.get(r)}function Di(r,e){const n=r.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}const Uc=[],mi=[];let Xc=[];const Nd=[],f0=Promise.resolve();let jd=!1;function d0(){jd||(jd=!0,f0.then(m0))}function p0(){return d0(),f0}function pf(r){Xc.push(r)}function Fi(r){Nd.push(r)}const Ed=new Set;let Rc=0;function m0(){if(Rc!==0)return;const r=hh;do{try{for(;Rc<Uc.length;){const e=Uc[Rc];Rc++,rh(e),M1(e.$$)}}catch(e){throw Uc.length=0,Rc=0,e}for(rh(null),Uc.length=0,Rc=0;mi.length;)mi.pop()();for(let e=0;e<Xc.length;e+=1){const n=Xc[e];Ed.has(n)||(Ed.add(n),n())}Xc.length=0}while(Uc.length);for(;Nd.length;)Nd.pop()();jd=!1,Ed.clear(),rh(r)}function M1(r){if(r.fragment!==null){r.update(),jn(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(pf)}}function P1(r){const e=[],n=[];Xc.forEach(o=>r.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),Xc=e}const cf=new Set;let jl;function nn(){jl={r:0,c:[],p:jl}}function rn(){jl.r||jn(jl.c),jl=jl.p}function Pe(r,e){r&&r.i&&(cf.delete(r),r.i(e))}function De(r,e,n,o){if(r&&r.o){if(cf.has(r))return;cf.add(r),jl.c.push(()=>{cf.delete(r),o&&(n&&r.d(1),o())}),r.o(e)}else o&&o()}function Ni(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function L1(r,e){De(r,1,1,()=>{e.delete(r.key)})}function z1(r,e,n,o,c,d,h,a,_,S,k,y){let C=r.length,E=d.length,T=C;const M={};for(;T--;)M[r[T].key]=T;const R=[],N=new Map,z=new Map,V=[];for(T=E;T--;){const te=y(c,d,T),U=n(te);let j=h.get(U);j?V.push(()=>j.p(te,e)):(j=S(U,te),j.c()),N.set(U,R[T]=j),U in M&&z.set(U,Math.abs(T-M[U]))}const Y=new Set,se=new Set;function $(te){Pe(te,1),te.m(a,k),h.set(te.key,te),k=te.first,E--}for(;C&&E;){const te=R[E-1],U=r[C-1],j=te.key,G=U.key;te===U?(k=te.first,C--,E--):N.has(G)?!h.has(j)||Y.has(j)?$(te):se.has(G)?C--:z.get(j)>z.get(G)?(se.add(j),$(te)):(Y.add(G),C--):(_(U,h),C--)}for(;C--;){const te=r[C];N.has(te.key)||_(te,h)}for(;E;)$(R[E-1]);return jn(V),R}function Ri(r,e,n){const o=r.$$.props[e];o!==void 0&&(r.$$.bound[o]=n,n(r.$$.ctx[o]))}function lt(r){r&&r.c()}function ot(r,e,n){const{fragment:o,after_update:c}=r.$$;o&&o.m(e,n),pf(()=>{const d=r.$$.on_mount.map(s0).filter(np);r.$$.on_destroy?r.$$.on_destroy.push(...d):jn(d),r.$$.on_mount=[]}),c.forEach(pf)}function at(r,e){const n=r.$$;n.fragment!==null&&(P1(n.after_update),jn(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function O1(r,e){r.$$.dirty[0]===-1&&(Uc.push(r),d0(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function oi(r,e,n,o,c,d,h=null,a=[-1]){const _=hh;rh(r);const S=r.$$={fragment:null,ctx:[],props:d,update:Ot,not_equal:c,bound:fg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:fg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};h&&h(S.root);let k=!1;if(S.ctx=n?n(r,e.props||{},(y,C,...E)=>{const T=E.length?E[0]:C;return S.ctx&&c(S.ctx[y],S.ctx[y]=T)&&(!S.skip_bound&&S.bound[y]&&S.bound[y](T),k&&O1(r,y)),C}):[],S.update(),k=!0,jn(S.before_update),S.fragment=o?o(S.ctx):!1,e.target){if(e.hydrate){const y=E1(e.target);S.fragment&&S.fragment.l(y),y.forEach(ye)}else S.fragment&&S.fragment.c();e.intro&&Pe(r.$$.fragment),ot(r,e.target,e.anchor),m0()}rh(_)}class ai{constructor(){Wn(this,"$$");Wn(this,"$$set")}$destroy(){at(this,1),this.$destroy=Ot}$on(e,n){if(!np(n))return Ot;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const c=o.indexOf(n);c!==-1&&o.splice(c,1)}}$set(e){this.$$set&&!x1(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const D1="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(D1);var g0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function F1(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function R1(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var n=function o(){return this instanceof o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(r).forEach(function(o){var c=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(n,o,c.get?c:{enumerable:!0,get:function(){return r[o]}})}),n}var B1={exports:{}},Qr="top",Es="bottom",Is="right",$r="left",xf="auto",ru=[Qr,Es,Is,$r],ql="start",Qc="end",_0="clippingParents",ap="viewport",Vc="popper",y0="reference",Ud=ru.reduce(function(r,e){return r.concat([e+"-"+ql,e+"-"+Qc])},[]),lp=[].concat(ru,[xf]).reduce(function(r,e){return r.concat([e,e+"-"+ql,e+"-"+Qc])},[]),b0="beforeRead",v0="read",w0="afterRead",x0="beforeMain",k0="main",S0="afterMain",T0="beforeWrite",C0="write",E0="afterWrite",I0=[b0,v0,w0,x0,k0,S0,T0,C0,E0];function Bo(r){return r?(r.nodeName||"").toLowerCase():null}function As(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function Zl(r){var e=As(r).Element;return r instanceof e||r instanceof Element}function Hs(r){var e=As(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function cp(r){if(typeof ShadowRoot>"u")return!1;var e=As(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function N1(r){var e=r.state;Object.keys(e.elements).forEach(function(n){var o=e.styles[n]||{},c=e.attributes[n]||{},d=e.elements[n];!Hs(d)||!Bo(d)||(Object.assign(d.style,o),Object.keys(c).forEach(function(h){var a=c[h];a===!1?d.removeAttribute(h):d.setAttribute(h,a===!0?"":a)}))})}function j1(r){var e=r.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(o){var c=e.elements[o],d=e.attributes[o]||{},h=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:n[o]),a=h.reduce(function(_,S){return _[S]="",_},{});!Hs(c)||!Bo(c)||(Object.assign(c.style,a),Object.keys(d).forEach(function(_){c.removeAttribute(_)}))})}}const up={name:"applyStyles",enabled:!0,phase:"write",fn:N1,effect:j1,requires:["computeStyles"]};function Ro(r){return r.split("-")[0]}var Ul=Math.max,mf=Math.min,$c=Math.round;function Vd(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function A0(){return!/^((?!chrome|android).)*safari/i.test(Vd())}function eu(r,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var o=r.getBoundingClientRect(),c=1,d=1;e&&Hs(r)&&(c=r.offsetWidth>0&&$c(o.width)/r.offsetWidth||1,d=r.offsetHeight>0&&$c(o.height)/r.offsetHeight||1);var h=Zl(r)?As(r):window,a=h.visualViewport,_=!A0()&&n,S=(o.left+(_&&a?a.offsetLeft:0))/c,k=(o.top+(_&&a?a.offsetTop:0))/d,y=o.width/c,C=o.height/d;return{width:y,height:C,top:k,right:S+y,bottom:k+C,left:S,x:S,y:k}}function hp(r){var e=eu(r),n=r.offsetWidth,o=r.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:r.offsetLeft,y:r.offsetTop,width:n,height:o}}function M0(r,e){var n=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(n&&cp(n)){var o=e;do{if(o&&r.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function pa(r){return As(r).getComputedStyle(r)}function U1(r){return["table","td","th"].indexOf(Bo(r))>=0}function ol(r){return((Zl(r)?r.ownerDocument:r.document)||window.document).documentElement}function kf(r){return Bo(r)==="html"?r:r.assignedSlot||r.parentNode||(cp(r)?r.host:null)||ol(r)}function pg(r){return!Hs(r)||pa(r).position==="fixed"?null:r.offsetParent}function V1(r){var e=/firefox/i.test(Vd()),n=/Trident/i.test(Vd());if(n&&Hs(r)){var o=pa(r);if(o.position==="fixed")return null}var c=kf(r);for(cp(c)&&(c=c.host);Hs(c)&&["html","body"].indexOf(Bo(c))<0;){var d=pa(c);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||e&&d.willChange==="filter"||e&&d.filter&&d.filter!=="none")return c;c=c.parentNode}return null}function bh(r){for(var e=As(r),n=pg(r);n&&U1(n)&&pa(n).position==="static";)n=pg(n);return n&&(Bo(n)==="html"||Bo(n)==="body"&&pa(n).position==="static")?e:n||V1(r)||e}function fp(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function sh(r,e,n){return Ul(r,mf(e,n))}function q1(r,e,n){var o=sh(r,e,n);return o>n?n:o}function P0(){return{top:0,right:0,bottom:0,left:0}}function L0(r){return Object.assign({},P0(),r)}function z0(r,e){return e.reduce(function(n,o){return n[o]=r,n},{})}var Z1=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,L0(typeof e!="number"?e:z0(e,ru))};function W1(r){var e,n=r.state,o=r.name,c=r.options,d=n.elements.arrow,h=n.modifiersData.popperOffsets,a=Ro(n.placement),_=fp(a),S=[$r,Is].indexOf(a)>=0,k=S?"height":"width";if(!(!d||!h)){var y=Z1(c.padding,n),C=hp(d),E=_==="y"?Qr:$r,T=_==="y"?Es:Is,M=n.rects.reference[k]+n.rects.reference[_]-h[_]-n.rects.popper[k],R=h[_]-n.rects.reference[_],N=bh(d),z=N?_==="y"?N.clientHeight||0:N.clientWidth||0:0,V=M/2-R/2,Y=y[E],se=z-C[k]-y[T],$=z/2-C[k]/2+V,te=sh(Y,$,se),U=_;n.modifiersData[o]=(e={},e[U]=te,e.centerOffset=te-$,e)}}function G1(r){var e=r.state,n=r.options,o=n.element,c=o===void 0?"[data-popper-arrow]":o;c!=null&&(typeof c=="string"&&(c=e.elements.popper.querySelector(c),!c)||M0(e.elements.popper,c)&&(e.elements.arrow=c))}const O0={name:"arrow",enabled:!0,phase:"main",fn:W1,effect:G1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function tu(r){return r.split("-")[1]}var H1={top:"auto",right:"auto",bottom:"auto",left:"auto"};function X1(r,e){var n=r.x,o=r.y,c=e.devicePixelRatio||1;return{x:$c(n*c)/c||0,y:$c(o*c)/c||0}}function mg(r){var e,n=r.popper,o=r.popperRect,c=r.placement,d=r.variation,h=r.offsets,a=r.position,_=r.gpuAcceleration,S=r.adaptive,k=r.roundOffsets,y=r.isFixed,C=h.x,E=C===void 0?0:C,T=h.y,M=T===void 0?0:T,R=typeof k=="function"?k({x:E,y:M}):{x:E,y:M};E=R.x,M=R.y;var N=h.hasOwnProperty("x"),z=h.hasOwnProperty("y"),V=$r,Y=Qr,se=window;if(S){var $=bh(n),te="clientHeight",U="clientWidth";if($===As(n)&&($=ol(n),pa($).position!=="static"&&a==="absolute"&&(te="scrollHeight",U="scrollWidth")),$=$,c===Qr||(c===$r||c===Is)&&d===Qc){Y=Es;var j=y&&$===se&&se.visualViewport?se.visualViewport.height:$[te];M-=j-o.height,M*=_?1:-1}if(c===$r||(c===Qr||c===Es)&&d===Qc){V=Is;var G=y&&$===se&&se.visualViewport?se.visualViewport.width:$[U];E-=G-o.width,E*=_?1:-1}}var O=Object.assign({position:a},S&&H1),W=k===!0?X1({x:E,y:M},As(n)):{x:E,y:M};if(E=W.x,M=W.y,_){var le;return Object.assign({},O,(le={},le[Y]=z?"0":"",le[V]=N?"0":"",le.transform=(se.devicePixelRatio||1)<=1?"translate("+E+"px, "+M+"px)":"translate3d("+E+"px, "+M+"px, 0)",le))}return Object.assign({},O,(e={},e[Y]=z?M+"px":"",e[V]=N?E+"px":"",e.transform="",e))}function K1(r){var e=r.state,n=r.options,o=n.gpuAcceleration,c=o===void 0?!0:o,d=n.adaptive,h=d===void 0?!0:d,a=n.roundOffsets,_=a===void 0?!0:a,S={placement:Ro(e.placement),variation:tu(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:c,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,mg(Object.assign({},S,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:h,roundOffsets:_})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,mg(Object.assign({},S,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:_})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const dp={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:K1,data:{}};var ef={passive:!0};function J1(r){var e=r.state,n=r.instance,o=r.options,c=o.scroll,d=c===void 0?!0:c,h=o.resize,a=h===void 0?!0:h,_=As(e.elements.popper),S=[].concat(e.scrollParents.reference,e.scrollParents.popper);return d&&S.forEach(function(k){k.addEventListener("scroll",n.update,ef)}),a&&_.addEventListener("resize",n.update,ef),function(){d&&S.forEach(function(k){k.removeEventListener("scroll",n.update,ef)}),a&&_.removeEventListener("resize",n.update,ef)}}const pp={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:J1,data:{}};var Y1={left:"right",right:"left",bottom:"top",top:"bottom"};function uf(r){return r.replace(/left|right|bottom|top/g,function(e){return Y1[e]})}var Q1={start:"end",end:"start"};function gg(r){return r.replace(/start|end/g,function(e){return Q1[e]})}function mp(r){var e=As(r),n=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:n,scrollTop:o}}function gp(r){return eu(ol(r)).left+mp(r).scrollLeft}function $1(r,e){var n=As(r),o=ol(r),c=n.visualViewport,d=o.clientWidth,h=o.clientHeight,a=0,_=0;if(c){d=c.width,h=c.height;var S=A0();(S||!S&&e==="fixed")&&(a=c.offsetLeft,_=c.offsetTop)}return{width:d,height:h,x:a+gp(r),y:_}}function ew(r){var e,n=ol(r),o=mp(r),c=(e=r.ownerDocument)==null?void 0:e.body,d=Ul(n.scrollWidth,n.clientWidth,c?c.scrollWidth:0,c?c.clientWidth:0),h=Ul(n.scrollHeight,n.clientHeight,c?c.scrollHeight:0,c?c.clientHeight:0),a=-o.scrollLeft+gp(r),_=-o.scrollTop;return pa(c||n).direction==="rtl"&&(a+=Ul(n.clientWidth,c?c.clientWidth:0)-d),{width:d,height:h,x:a,y:_}}function _p(r){var e=pa(r),n=e.overflow,o=e.overflowX,c=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+c+o)}function D0(r){return["html","body","#document"].indexOf(Bo(r))>=0?r.ownerDocument.body:Hs(r)&&_p(r)?r:D0(kf(r))}function oh(r,e){var n;e===void 0&&(e=[]);var o=D0(r),c=o===((n=r.ownerDocument)==null?void 0:n.body),d=As(o),h=c?[d].concat(d.visualViewport||[],_p(o)?o:[]):o,a=e.concat(h);return c?a:a.concat(oh(kf(h)))}function qd(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function tw(r,e){var n=eu(r,!1,e==="fixed");return n.top=n.top+r.clientTop,n.left=n.left+r.clientLeft,n.bottom=n.top+r.clientHeight,n.right=n.left+r.clientWidth,n.width=r.clientWidth,n.height=r.clientHeight,n.x=n.left,n.y=n.top,n}function _g(r,e,n){return e===ap?qd($1(r,n)):Zl(e)?tw(e,n):qd(ew(ol(r)))}function iw(r){var e=oh(kf(r)),n=["absolute","fixed"].indexOf(pa(r).position)>=0,o=n&&Hs(r)?bh(r):r;return Zl(o)?e.filter(function(c){return Zl(c)&&M0(c,o)&&Bo(c)!=="body"}):[]}function nw(r,e,n,o){var c=e==="clippingParents"?iw(r):[].concat(e),d=[].concat(c,[n]),h=d[0],a=d.reduce(function(_,S){var k=_g(r,S,o);return _.top=Ul(k.top,_.top),_.right=mf(k.right,_.right),_.bottom=mf(k.bottom,_.bottom),_.left=Ul(k.left,_.left),_},_g(r,h,o));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function F0(r){var e=r.reference,n=r.element,o=r.placement,c=o?Ro(o):null,d=o?tu(o):null,h=e.x+e.width/2-n.width/2,a=e.y+e.height/2-n.height/2,_;switch(c){case Qr:_={x:h,y:e.y-n.height};break;case Es:_={x:h,y:e.y+e.height};break;case Is:_={x:e.x+e.width,y:a};break;case $r:_={x:e.x-n.width,y:a};break;default:_={x:e.x,y:e.y}}var S=c?fp(c):null;if(S!=null){var k=S==="y"?"height":"width";switch(d){case ql:_[S]=_[S]-(e[k]/2-n[k]/2);break;case Qc:_[S]=_[S]+(e[k]/2-n[k]/2);break}}return _}function iu(r,e){e===void 0&&(e={});var n=e,o=n.placement,c=o===void 0?r.placement:o,d=n.strategy,h=d===void 0?r.strategy:d,a=n.boundary,_=a===void 0?_0:a,S=n.rootBoundary,k=S===void 0?ap:S,y=n.elementContext,C=y===void 0?Vc:y,E=n.altBoundary,T=E===void 0?!1:E,M=n.padding,R=M===void 0?0:M,N=L0(typeof R!="number"?R:z0(R,ru)),z=C===Vc?y0:Vc,V=r.rects.popper,Y=r.elements[T?z:C],se=nw(Zl(Y)?Y:Y.contextElement||ol(r.elements.popper),_,k,h),$=eu(r.elements.reference),te=F0({reference:$,element:V,placement:c}),U=qd(Object.assign({},V,te)),j=C===Vc?U:$,G={top:se.top-j.top+N.top,bottom:j.bottom-se.bottom+N.bottom,left:se.left-j.left+N.left,right:j.right-se.right+N.right},O=r.modifiersData.offset;if(C===Vc&&O){var W=O[c];Object.keys(G).forEach(function(le){var de=[Is,Es].indexOf(le)>=0?1:-1,ve=[Qr,Es].indexOf(le)>=0?"y":"x";G[le]+=W[ve]*de})}return G}function rw(r,e){e===void 0&&(e={});var n=e,o=n.placement,c=n.boundary,d=n.rootBoundary,h=n.padding,a=n.flipVariations,_=n.allowedAutoPlacements,S=_===void 0?lp:_,k=tu(o),y=k?a?Ud:Ud.filter(function(T){return tu(T)===k}):ru,C=y.filter(function(T){return S.indexOf(T)>=0});C.length===0&&(C=y);var E=C.reduce(function(T,M){return T[M]=iu(r,{placement:M,boundary:c,rootBoundary:d,padding:h})[Ro(M)],T},{});return Object.keys(E).sort(function(T,M){return E[T]-E[M]})}function sw(r){if(Ro(r)===xf)return[];var e=uf(r);return[gg(r),e,gg(e)]}function ow(r){var e=r.state,n=r.options,o=r.name;if(!e.modifiersData[o]._skip){for(var c=n.mainAxis,d=c===void 0?!0:c,h=n.altAxis,a=h===void 0?!0:h,_=n.fallbackPlacements,S=n.padding,k=n.boundary,y=n.rootBoundary,C=n.altBoundary,E=n.flipVariations,T=E===void 0?!0:E,M=n.allowedAutoPlacements,R=e.options.placement,N=Ro(R),z=N===R,V=_||(z||!T?[uf(R)]:sw(R)),Y=[R].concat(V).reduce(function(Je,wt){return Je.concat(Ro(wt)===xf?rw(e,{placement:wt,boundary:k,rootBoundary:y,padding:S,flipVariations:T,allowedAutoPlacements:M}):wt)},[]),se=e.rects.reference,$=e.rects.popper,te=new Map,U=!0,j=Y[0],G=0;G<Y.length;G++){var O=Y[G],W=Ro(O),le=tu(O)===ql,de=[Qr,Es].indexOf(W)>=0,ve=de?"width":"height",pe=iu(e,{placement:O,boundary:k,rootBoundary:y,altBoundary:C,padding:S}),we=de?le?Is:$r:le?Es:Qr;se[ve]>$[ve]&&(we=uf(we));var Te=uf(we),Ae=[];if(d&&Ae.push(pe[W]<=0),a&&Ae.push(pe[we]<=0,pe[Te]<=0),Ae.every(function(Je){return Je})){j=O,U=!1;break}te.set(O,Ae)}if(U)for(var ct=T?3:1,We=function(wt){var Tt=Y.find(function(Ht){var li=te.get(Ht);if(li)return li.slice(0,wt).every(function(Mi){return Mi})});if(Tt)return j=Tt,"break"},pt=ct;pt>0;pt--){var kt=We(pt);if(kt==="break")break}e.placement!==j&&(e.modifiersData[o]._skip=!0,e.placement=j,e.reset=!0)}}const R0={name:"flip",enabled:!0,phase:"main",fn:ow,requiresIfExists:["offset"],data:{_skip:!1}};function yg(r,e,n){return n===void 0&&(n={x:0,y:0}),{top:r.top-e.height-n.y,right:r.right-e.width+n.x,bottom:r.bottom-e.height+n.y,left:r.left-e.width-n.x}}function bg(r){return[Qr,Is,Es,$r].some(function(e){return r[e]>=0})}function aw(r){var e=r.state,n=r.name,o=e.rects.reference,c=e.rects.popper,d=e.modifiersData.preventOverflow,h=iu(e,{elementContext:"reference"}),a=iu(e,{altBoundary:!0}),_=yg(h,o),S=yg(a,c,d),k=bg(_),y=bg(S);e.modifiersData[n]={referenceClippingOffsets:_,popperEscapeOffsets:S,isReferenceHidden:k,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":k,"data-popper-escaped":y})}const B0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:aw};function lw(r,e,n){var o=Ro(r),c=[$r,Qr].indexOf(o)>=0?-1:1,d=typeof n=="function"?n(Object.assign({},e,{placement:r})):n,h=d[0],a=d[1];return h=h||0,a=(a||0)*c,[$r,Is].indexOf(o)>=0?{x:a,y:h}:{x:h,y:a}}function cw(r){var e=r.state,n=r.options,o=r.name,c=n.offset,d=c===void 0?[0,0]:c,h=lp.reduce(function(k,y){return k[y]=lw(y,e.rects,d),k},{}),a=h[e.placement],_=a.x,S=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=_,e.modifiersData.popperOffsets.y+=S),e.modifiersData[o]=h}const N0={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:cw};function uw(r){var e=r.state,n=r.name;e.modifiersData[n]=F0({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const yp={name:"popperOffsets",enabled:!0,phase:"read",fn:uw,data:{}};function hw(r){return r==="x"?"y":"x"}function fw(r){var e=r.state,n=r.options,o=r.name,c=n.mainAxis,d=c===void 0?!0:c,h=n.altAxis,a=h===void 0?!1:h,_=n.boundary,S=n.rootBoundary,k=n.altBoundary,y=n.padding,C=n.tether,E=C===void 0?!0:C,T=n.tetherOffset,M=T===void 0?0:T,R=iu(e,{boundary:_,rootBoundary:S,padding:y,altBoundary:k}),N=Ro(e.placement),z=tu(e.placement),V=!z,Y=fp(N),se=hw(Y),$=e.modifiersData.popperOffsets,te=e.rects.reference,U=e.rects.popper,j=typeof M=="function"?M(Object.assign({},e.rects,{placement:e.placement})):M,G=typeof j=="number"?{mainAxis:j,altAxis:j}:Object.assign({mainAxis:0,altAxis:0},j),O=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,W={x:0,y:0};if($){if(d){var le,de=Y==="y"?Qr:$r,ve=Y==="y"?Es:Is,pe=Y==="y"?"height":"width",we=$[Y],Te=we+R[de],Ae=we-R[ve],ct=E?-U[pe]/2:0,We=z===ql?te[pe]:U[pe],pt=z===ql?-U[pe]:-te[pe],kt=e.elements.arrow,Je=E&&kt?hp(kt):{width:0,height:0},wt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:P0(),Tt=wt[de],Ht=wt[ve],li=sh(0,te[pe],Je[pe]),Mi=V?te[pe]/2-ct-li-Tt-G.mainAxis:We-li-Tt-G.mainAxis,Pi=V?-te[pe]/2+ct+li+Ht+G.mainAxis:pt+li+Ht+G.mainAxis,Ti=e.elements.arrow&&bh(e.elements.arrow),At=Ti?Y==="y"?Ti.clientTop||0:Ti.clientLeft||0:0,Xe=(le=O==null?void 0:O[Y])!=null?le:0,Pt=we+Mi-Xe-At,ni=we+Pi-Xe,$e=sh(E?mf(Te,Pt):Te,we,E?Ul(Ae,ni):Ae);$[Y]=$e,W[Y]=$e-we}if(a){var yi,yt=Y==="x"?Qr:$r,it=Y==="x"?Es:Is,fe=$[se],X=se==="y"?"height":"width",Q=fe+R[yt],Me=fe-R[it],Ze=[Qr,$r].indexOf(N)!==-1,dt=(yi=O==null?void 0:O[se])!=null?yi:0,st=Ze?Q:fe-te[X]-U[X]-dt+G.altAxis,Ci=Ze?fe+te[X]+U[X]-dt-G.altAxis:Me,ft=E&&Ze?q1(st,fe,Ci):sh(E?st:Q,fe,E?Ci:Me);$[se]=ft,W[se]=ft-fe}e.modifiersData[o]=W}}const j0={name:"preventOverflow",enabled:!0,phase:"main",fn:fw,requiresIfExists:["offset"]};function dw(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function pw(r){return r===As(r)||!Hs(r)?mp(r):dw(r)}function mw(r){var e=r.getBoundingClientRect(),n=$c(e.width)/r.offsetWidth||1,o=$c(e.height)/r.offsetHeight||1;return n!==1||o!==1}function gw(r,e,n){n===void 0&&(n=!1);var o=Hs(e),c=Hs(e)&&mw(e),d=ol(e),h=eu(r,c,n),a={scrollLeft:0,scrollTop:0},_={x:0,y:0};return(o||!o&&!n)&&((Bo(e)!=="body"||_p(d))&&(a=pw(e)),Hs(e)?(_=eu(e,!0),_.x+=e.clientLeft,_.y+=e.clientTop):d&&(_.x=gp(d))),{x:h.left+a.scrollLeft-_.x,y:h.top+a.scrollTop-_.y,width:h.width,height:h.height}}function _w(r){var e=new Map,n=new Set,o=[];r.forEach(function(d){e.set(d.name,d)});function c(d){n.add(d.name);var h=[].concat(d.requires||[],d.requiresIfExists||[]);h.forEach(function(a){if(!n.has(a)){var _=e.get(a);_&&c(_)}}),o.push(d)}return r.forEach(function(d){n.has(d.name)||c(d)}),o}function yw(r){var e=_w(r);return I0.reduce(function(n,o){return n.concat(e.filter(function(c){return c.phase===o}))},[])}function bw(r){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(r())})})),e}}function vw(r){var e=r.reduce(function(n,o){var c=n[o.name];return n[o.name]=c?Object.assign({},c,o,{options:Object.assign({},c.options,o.options),data:Object.assign({},c.data,o.data)}):o,n},{});return Object.keys(e).map(function(n){return e[n]})}var vg={placement:"bottom",modifiers:[],strategy:"absolute"};function wg(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function Sf(r){r===void 0&&(r={});var e=r,n=e.defaultModifiers,o=n===void 0?[]:n,c=e.defaultOptions,d=c===void 0?vg:c;return function(a,_,S){S===void 0&&(S=d);var k={placement:"bottom",orderedModifiers:[],options:Object.assign({},vg,d),modifiersData:{},elements:{reference:a,popper:_},attributes:{},styles:{}},y=[],C=!1,E={state:k,setOptions:function(N){var z=typeof N=="function"?N(k.options):N;M(),k.options=Object.assign({},d,k.options,z),k.scrollParents={reference:Zl(a)?oh(a):a.contextElement?oh(a.contextElement):[],popper:oh(_)};var V=yw(vw([].concat(o,k.options.modifiers)));return k.orderedModifiers=V.filter(function(Y){return Y.enabled}),T(),E.update()},forceUpdate:function(){if(!C){var N=k.elements,z=N.reference,V=N.popper;if(wg(z,V)){k.rects={reference:gw(z,bh(V),k.options.strategy==="fixed"),popper:hp(V)},k.reset=!1,k.placement=k.options.placement,k.orderedModifiers.forEach(function(G){return k.modifiersData[G.name]=Object.assign({},G.data)});for(var Y=0;Y<k.orderedModifiers.length;Y++){if(k.reset===!0){k.reset=!1,Y=-1;continue}var se=k.orderedModifiers[Y],$=se.fn,te=se.options,U=te===void 0?{}:te,j=se.name;typeof $=="function"&&(k=$({state:k,options:U,name:j,instance:E})||k)}}}},update:bw(function(){return new Promise(function(R){E.forceUpdate(),R(k)})}),destroy:function(){M(),C=!0}};if(!wg(a,_))return E;E.setOptions(S).then(function(R){!C&&S.onFirstUpdate&&S.onFirstUpdate(R)});function T(){k.orderedModifiers.forEach(function(R){var N=R.name,z=R.options,V=z===void 0?{}:z,Y=R.effect;if(typeof Y=="function"){var se=Y({state:k,name:N,instance:E,options:V}),$=function(){};y.push(se||$)}})}function M(){y.forEach(function(R){return R()}),y=[]}return E}}var ww=Sf(),xw=[pp,yp,dp,up],kw=Sf({defaultModifiers:xw}),Sw=[pp,yp,dp,up,N0,R0,j0,O0,B0],Tw=Sf({defaultModifiers:Sw});const Cw=Object.freeze(Object.defineProperty({__proto__:null,afterMain:S0,afterRead:w0,afterWrite:E0,applyStyles:up,arrow:O0,auto:xf,basePlacements:ru,beforeMain:x0,beforeRead:b0,beforeWrite:T0,bottom:Es,clippingParents:_0,computeStyles:dp,createPopper:Tw,createPopperBase:ww,createPopperLite:kw,detectOverflow:iu,end:Qc,eventListeners:pp,flip:R0,hide:B0,left:$r,main:k0,modifierPhases:I0,offset:N0,placements:lp,popper:Vc,popperGenerator:Sf,popperOffsets:yp,preventOverflow:j0,read:v0,reference:y0,right:Is,start:ql,top:Qr,variationPlacements:Ud,viewport:ap,write:C0},Symbol.toStringTag,{value:"Module"})),Ew=R1(Cw);/*!
  * Bootstrap v5.3.8 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(r,e){(function(n,o){r.exports=o(Ew)})(g0,function(n){function o(Ne){const F=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(Ne){for(const oe in Ne)if(oe!=="default"){const Re=Object.getOwnPropertyDescriptor(Ne,oe);Object.defineProperty(F,oe,Re.get?Re:{enumerable:!0,get:()=>Ne[oe]})}}return F.default=Ne,Object.freeze(F)}const c=o(n),d=new Map,h={set(Ne,F,oe){d.has(Ne)||d.set(Ne,new Map);const Re=d.get(Ne);Re.has(F)||Re.size===0?Re.set(F,oe):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(Re.keys())[0]}.`)},get:(Ne,F)=>d.has(Ne)&&d.get(Ne).get(F)||null,remove(Ne,F){if(!d.has(Ne))return;const oe=d.get(Ne);oe.delete(F),oe.size===0&&d.delete(Ne)}},a="transitionend",_=Ne=>(Ne&&window.CSS&&window.CSS.escape&&(Ne=Ne.replace(/#([^\s"#']+)/g,(F,oe)=>`#${CSS.escape(oe)}`)),Ne),S=Ne=>Ne==null?`${Ne}`:Object.prototype.toString.call(Ne).match(/\s([a-z]+)/i)[1].toLowerCase(),k=Ne=>{Ne.dispatchEvent(new Event(a))},y=Ne=>!(!Ne||typeof Ne!="object")&&(Ne.jquery!==void 0&&(Ne=Ne[0]),Ne.nodeType!==void 0),C=Ne=>y(Ne)?Ne.jquery?Ne[0]:Ne:typeof Ne=="string"&&Ne.length>0?document.querySelector(_(Ne)):null,E=Ne=>{if(!y(Ne)||Ne.getClientRects().length===0)return!1;const F=getComputedStyle(Ne).getPropertyValue("visibility")==="visible",oe=Ne.closest("details:not([open])");if(!oe)return F;if(oe!==Ne){const Re=Ne.closest("summary");if(Re&&Re.parentNode!==oe||Re===null)return!1}return F},T=Ne=>!Ne||Ne.nodeType!==Node.ELEMENT_NODE||!!Ne.classList.contains("disabled")||(Ne.disabled!==void 0?Ne.disabled:Ne.hasAttribute("disabled")&&Ne.getAttribute("disabled")!=="false"),M=Ne=>{if(!document.documentElement.attachShadow)return null;if(typeof Ne.getRootNode=="function"){const F=Ne.getRootNode();return F instanceof ShadowRoot?F:null}return Ne instanceof ShadowRoot?Ne:Ne.parentNode?M(Ne.parentNode):null},R=()=>{},N=Ne=>{Ne.offsetHeight},z=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,V=[],Y=()=>document.documentElement.dir==="rtl",se=Ne=>{var F;F=()=>{const oe=z();if(oe){const Re=Ne.NAME,mt=oe.fn[Re];oe.fn[Re]=Ne.jQueryInterface,oe.fn[Re].Constructor=Ne,oe.fn[Re].noConflict=()=>(oe.fn[Re]=mt,Ne.jQueryInterface)}},document.readyState==="loading"?(V.length||document.addEventListener("DOMContentLoaded",()=>{for(const oe of V)oe()}),V.push(F)):F()},$=(Ne,F=[],oe=Ne)=>typeof Ne=="function"?Ne.call(...F):oe,te=(Ne,F,oe=!0)=>{if(!oe)return void $(Ne);const Re=(Xt=>{if(!Xt)return 0;let{transitionDuration:Hi,transitionDelay:cn}=window.getComputedStyle(Xt);const On=Number.parseFloat(Hi),In=Number.parseFloat(cn);return On||In?(Hi=Hi.split(",")[0],cn=cn.split(",")[0],1e3*(Number.parseFloat(Hi)+Number.parseFloat(cn))):0})(F)+5;let mt=!1;const It=({target:Xt})=>{Xt===F&&(mt=!0,F.removeEventListener(a,It),$(Ne))};F.addEventListener(a,It),setTimeout(()=>{mt||k(F)},Re)},U=(Ne,F,oe,Re)=>{const mt=Ne.length;let It=Ne.indexOf(F);return It===-1?!oe&&Re?Ne[mt-1]:Ne[0]:(It+=oe?1:-1,Re&&(It=(It+mt)%mt),Ne[Math.max(0,Math.min(It,mt-1))])},j=/[^.]*(?=\..*)\.|.*/,G=/\..*/,O=/::\d+$/,W={};let le=1;const de={mouseenter:"mouseover",mouseleave:"mouseout"},ve=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function pe(Ne,F){return F&&`${F}::${le++}`||Ne.uidEvent||le++}function we(Ne){const F=pe(Ne);return Ne.uidEvent=F,W[F]=W[F]||{},W[F]}function Te(Ne,F,oe=null){return Object.values(Ne).find(Re=>Re.callable===F&&Re.delegationSelector===oe)}function Ae(Ne,F,oe){const Re=typeof F=="string",mt=Re?oe:F||oe;let It=kt(Ne);return ve.has(It)||(It=Ne),[Re,mt,It]}function ct(Ne,F,oe,Re,mt){if(typeof F!="string"||!Ne)return;let[It,Xt,Hi]=Ae(F,oe,Re);F in de&&(Xt=(ss=>function(xr){if(!xr.relatedTarget||xr.relatedTarget!==xr.delegateTarget&&!xr.delegateTarget.contains(xr.relatedTarget))return ss.call(this,xr)})(Xt));const cn=we(Ne),On=cn[Hi]||(cn[Hi]={}),In=Te(On,Xt,It?oe:null);if(In)return void(In.oneOff=In.oneOff&&mt);const wr=pe(Xt,F.replace(j,"")),zr=It?function(Wr,ss,xr){return function oo(os){const Ra=Wr.querySelectorAll(ss);for(let{target:Gr}=os;Gr&&Gr!==this;Gr=Gr.parentNode)for(const wl of Ra)if(wl===Gr)return wt(os,{delegateTarget:Gr}),oo.oneOff&&Je.off(Wr,os.type,ss,xr),xr.apply(Gr,[os])}}(Ne,oe,Xt):function(Wr,ss){return function xr(oo){return wt(oo,{delegateTarget:Wr}),xr.oneOff&&Je.off(Wr,oo.type,ss),ss.apply(Wr,[oo])}}(Ne,Xt);zr.delegationSelector=It?oe:null,zr.callable=Xt,zr.oneOff=mt,zr.uidEvent=wr,On[wr]=zr,Ne.addEventListener(Hi,zr,It)}function We(Ne,F,oe,Re,mt){const It=Te(F[oe],Re,mt);It&&(Ne.removeEventListener(oe,It,!!mt),delete F[oe][It.uidEvent])}function pt(Ne,F,oe,Re){const mt=F[oe]||{};for(const[It,Xt]of Object.entries(mt))It.includes(Re)&&We(Ne,F,oe,Xt.callable,Xt.delegationSelector)}function kt(Ne){return Ne=Ne.replace(G,""),de[Ne]||Ne}const Je={on(Ne,F,oe,Re){ct(Ne,F,oe,Re,!1)},one(Ne,F,oe,Re){ct(Ne,F,oe,Re,!0)},off(Ne,F,oe,Re){if(typeof F!="string"||!Ne)return;const[mt,It,Xt]=Ae(F,oe,Re),Hi=Xt!==F,cn=we(Ne),On=cn[Xt]||{},In=F.startsWith(".");if(It===void 0){if(In)for(const wr of Object.keys(cn))pt(Ne,cn,wr,F.slice(1));for(const[wr,zr]of Object.entries(On)){const Wr=wr.replace(O,"");Hi&&!F.includes(Wr)||We(Ne,cn,Xt,zr.callable,zr.delegationSelector)}}else{if(!Object.keys(On).length)return;We(Ne,cn,Xt,It,mt?oe:null)}},trigger(Ne,F,oe){if(typeof F!="string"||!Ne)return null;const Re=z();let mt=null,It=!0,Xt=!0,Hi=!1;F!==kt(F)&&Re&&(mt=Re.Event(F,oe),Re(Ne).trigger(mt),It=!mt.isPropagationStopped(),Xt=!mt.isImmediatePropagationStopped(),Hi=mt.isDefaultPrevented());const cn=wt(new Event(F,{bubbles:It,cancelable:!0}),oe);return Hi&&cn.preventDefault(),Xt&&Ne.dispatchEvent(cn),cn.defaultPrevented&&mt&&mt.preventDefault(),cn}};function wt(Ne,F={}){for(const[oe,Re]of Object.entries(F))try{Ne[oe]=Re}catch{Object.defineProperty(Ne,oe,{configurable:!0,get:()=>Re})}return Ne}function Tt(Ne){if(Ne==="true")return!0;if(Ne==="false")return!1;if(Ne===Number(Ne).toString())return Number(Ne);if(Ne===""||Ne==="null")return null;if(typeof Ne!="string")return Ne;try{return JSON.parse(decodeURIComponent(Ne))}catch{return Ne}}function Ht(Ne){return Ne.replace(/[A-Z]/g,F=>`-${F.toLowerCase()}`)}const li={setDataAttribute(Ne,F,oe){Ne.setAttribute(`data-bs-${Ht(F)}`,oe)},removeDataAttribute(Ne,F){Ne.removeAttribute(`data-bs-${Ht(F)}`)},getDataAttributes(Ne){if(!Ne)return{};const F={},oe=Object.keys(Ne.dataset).filter(Re=>Re.startsWith("bs")&&!Re.startsWith("bsConfig"));for(const Re of oe){let mt=Re.replace(/^bs/,"");mt=mt.charAt(0).toLowerCase()+mt.slice(1),F[mt]=Tt(Ne.dataset[Re])}return F},getDataAttribute:(Ne,F)=>Tt(Ne.getAttribute(`data-bs-${Ht(F)}`))};class Mi{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(F){return F=this._mergeConfigObj(F),F=this._configAfterMerge(F),this._typeCheckConfig(F),F}_configAfterMerge(F){return F}_mergeConfigObj(F,oe){const Re=y(oe)?li.getDataAttribute(oe,"config"):{};return{...this.constructor.Default,...typeof Re=="object"?Re:{},...y(oe)?li.getDataAttributes(oe):{},...typeof F=="object"?F:{}}}_typeCheckConfig(F,oe=this.constructor.DefaultType){for(const[Re,mt]of Object.entries(oe)){const It=F[Re],Xt=y(It)?"element":S(It);if(!new RegExp(mt).test(Xt))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${Re}" provided type "${Xt}" but expected type "${mt}".`)}}}class Pi extends Mi{constructor(F,oe){super(),(F=C(F))&&(this._element=F,this._config=this._getConfig(oe),h.set(this._element,this.constructor.DATA_KEY,this))}dispose(){h.remove(this._element,this.constructor.DATA_KEY),Je.off(this._element,this.constructor.EVENT_KEY);for(const F of Object.getOwnPropertyNames(this))this[F]=null}_queueCallback(F,oe,Re=!0){te(F,oe,Re)}_getConfig(F){return F=this._mergeConfigObj(F,this._element),F=this._configAfterMerge(F),this._typeCheckConfig(F),F}static getInstance(F){return h.get(C(F),this.DATA_KEY)}static getOrCreateInstance(F,oe={}){return this.getInstance(F)||new this(F,typeof oe=="object"?oe:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(F){return`${F}${this.EVENT_KEY}`}}const Ti=Ne=>{let F=Ne.getAttribute("data-bs-target");if(!F||F==="#"){let oe=Ne.getAttribute("href");if(!oe||!oe.includes("#")&&!oe.startsWith("."))return null;oe.includes("#")&&!oe.startsWith("#")&&(oe=`#${oe.split("#")[1]}`),F=oe&&oe!=="#"?oe.trim():null}return F?F.split(",").map(oe=>_(oe)).join(","):null},At={find:(Ne,F=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(F,Ne)),findOne:(Ne,F=document.documentElement)=>Element.prototype.querySelector.call(F,Ne),children:(Ne,F)=>[].concat(...Ne.children).filter(oe=>oe.matches(F)),parents(Ne,F){const oe=[];let Re=Ne.parentNode.closest(F);for(;Re;)oe.push(Re),Re=Re.parentNode.closest(F);return oe},prev(Ne,F){let oe=Ne.previousElementSibling;for(;oe;){if(oe.matches(F))return[oe];oe=oe.previousElementSibling}return[]},next(Ne,F){let oe=Ne.nextElementSibling;for(;oe;){if(oe.matches(F))return[oe];oe=oe.nextElementSibling}return[]},focusableChildren(Ne){const F=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(oe=>`${oe}:not([tabindex^="-"])`).join(",");return this.find(F,Ne).filter(oe=>!T(oe)&&E(oe))},getSelectorFromElement(Ne){const F=Ti(Ne);return F&&At.findOne(F)?F:null},getElementFromSelector(Ne){const F=Ti(Ne);return F?At.findOne(F):null},getMultipleElementsFromSelector(Ne){const F=Ti(Ne);return F?At.find(F):[]}},Xe=(Ne,F="hide")=>{const oe=`click.dismiss${Ne.EVENT_KEY}`,Re=Ne.NAME;Je.on(document,oe,`[data-bs-dismiss="${Re}"]`,function(mt){if(["A","AREA"].includes(this.tagName)&&mt.preventDefault(),T(this))return;const It=At.getElementFromSelector(this)||this.closest(`.${Re}`);Ne.getOrCreateInstance(It)[F]()})},Pt=".bs.alert",ni=`close${Pt}`,$e=`closed${Pt}`;class yi extends Pi{static get NAME(){return"alert"}close(){if(Je.trigger(this._element,ni).defaultPrevented)return;this._element.classList.remove("show");const F=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,F)}_destroyElement(){this._element.remove(),Je.trigger(this._element,$e),this.dispose()}static jQueryInterface(F){return this.each(function(){const oe=yi.getOrCreateInstance(this);if(typeof F=="string"){if(oe[F]===void 0||F.startsWith("_")||F==="constructor")throw new TypeError(`No method named "${F}"`);oe[F](this)}})}}Xe(yi,"close"),se(yi);const yt='[data-bs-toggle="button"]';class it extends Pi{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(F){return this.each(function(){const oe=it.getOrCreateInstance(this);F==="toggle"&&oe[F]()})}}Je.on(document,"click.bs.button.data-api",yt,Ne=>{Ne.preventDefault();const F=Ne.target.closest(yt);it.getOrCreateInstance(F).toggle()}),se(it);const fe=".bs.swipe",X=`touchstart${fe}`,Q=`touchmove${fe}`,Me=`touchend${fe}`,Ze=`pointerdown${fe}`,dt=`pointerup${fe}`,st={endCallback:null,leftCallback:null,rightCallback:null},Ci={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class ft extends Mi{constructor(F,oe){super(),this._element=F,F&&ft.isSupported()&&(this._config=this._getConfig(oe),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return st}static get DefaultType(){return Ci}static get NAME(){return"swipe"}dispose(){Je.off(this._element,fe)}_start(F){this._supportPointerEvents?this._eventIsPointerPenTouch(F)&&(this._deltaX=F.clientX):this._deltaX=F.touches[0].clientX}_end(F){this._eventIsPointerPenTouch(F)&&(this._deltaX=F.clientX-this._deltaX),this._handleSwipe(),$(this._config.endCallback)}_move(F){this._deltaX=F.touches&&F.touches.length>1?0:F.touches[0].clientX-this._deltaX}_handleSwipe(){const F=Math.abs(this._deltaX);if(F<=40)return;const oe=F/this._deltaX;this._deltaX=0,oe&&$(oe>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Je.on(this._element,Ze,F=>this._start(F)),Je.on(this._element,dt,F=>this._end(F)),this._element.classList.add("pointer-event")):(Je.on(this._element,X,F=>this._start(F)),Je.on(this._element,Q,F=>this._move(F)),Je.on(this._element,Me,F=>this._end(F)))}_eventIsPointerPenTouch(F){return this._supportPointerEvents&&(F.pointerType==="pen"||F.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Wt=".bs.carousel",Ei=".data-api",Bi="ArrowLeft",Cn="ArrowRight",St="next",ui="prev",ii="left",sn="right",_r=`slide${Wt}`,ci=`slid${Wt}`,yr=`keydown${Wt}`,br=`mouseenter${Wt}`,Ar=`mouseleave${Wt}`,Mr=`dragstart${Wt}`,Le=`load${Wt}${Ei}`,ie=`click${Wt}${Ei}`,ne="carousel",me="active",Se=".active",Ve=".carousel-item",Ge=Se+Ve,et={[Bi]:sn,[Cn]:ii},Be={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ut={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class bt extends Pi{constructor(F,oe){super(F,oe),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=At.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===ne&&this.cycle()}static get Default(){return Be}static get DefaultType(){return ut}static get NAME(){return"carousel"}next(){this._slide(St)}nextWhenVisible(){!document.hidden&&E(this._element)&&this.next()}prev(){this._slide(ui)}pause(){this._isSliding&&k(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?Je.one(this._element,ci,()=>this.cycle()):this.cycle())}to(F){const oe=this._getItems();if(F>oe.length-1||F<0)return;if(this._isSliding)return void Je.one(this._element,ci,()=>this.to(F));const Re=this._getItemIndex(this._getActive());if(Re===F)return;const mt=F>Re?St:ui;this._slide(mt,oe[F])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(F){return F.defaultInterval=F.interval,F}_addEventListeners(){this._config.keyboard&&Je.on(this._element,yr,F=>this._keydown(F)),this._config.pause==="hover"&&(Je.on(this._element,br,()=>this.pause()),Je.on(this._element,Ar,()=>this._maybeEnableCycle())),this._config.touch&&ft.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const oe of At.find(".carousel-item img",this._element))Je.on(oe,Mr,Re=>Re.preventDefault());const F={leftCallback:()=>this._slide(this._directionToOrder(ii)),rightCallback:()=>this._slide(this._directionToOrder(sn)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new ft(this._element,F)}_keydown(F){if(/input|textarea/i.test(F.target.tagName))return;const oe=et[F.key];oe&&(F.preventDefault(),this._slide(this._directionToOrder(oe)))}_getItemIndex(F){return this._getItems().indexOf(F)}_setActiveIndicatorElement(F){if(!this._indicatorsElement)return;const oe=At.findOne(Se,this._indicatorsElement);oe.classList.remove(me),oe.removeAttribute("aria-current");const Re=At.findOne(`[data-bs-slide-to="${F}"]`,this._indicatorsElement);Re&&(Re.classList.add(me),Re.setAttribute("aria-current","true"))}_updateInterval(){const F=this._activeElement||this._getActive();if(!F)return;const oe=Number.parseInt(F.getAttribute("data-bs-interval"),10);this._config.interval=oe||this._config.defaultInterval}_slide(F,oe=null){if(this._isSliding)return;const Re=this._getActive(),mt=F===St,It=oe||U(this._getItems(),Re,mt,this._config.wrap);if(It===Re)return;const Xt=this._getItemIndex(It),Hi=wr=>Je.trigger(this._element,wr,{relatedTarget:It,direction:this._orderToDirection(F),from:this._getItemIndex(Re),to:Xt});if(Hi(_r).defaultPrevented||!Re||!It)return;const cn=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Xt),this._activeElement=It;const On=mt?"carousel-item-start":"carousel-item-end",In=mt?"carousel-item-next":"carousel-item-prev";It.classList.add(In),N(It),Re.classList.add(On),It.classList.add(On),this._queueCallback(()=>{It.classList.remove(On,In),It.classList.add(me),Re.classList.remove(me,In,On),this._isSliding=!1,Hi(ci)},Re,this._isAnimated()),cn&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return At.findOne(Ge,this._element)}_getItems(){return At.find(Ve,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(F){return Y()?F===ii?ui:St:F===ii?St:ui}_orderToDirection(F){return Y()?F===ui?ii:sn:F===ui?sn:ii}static jQueryInterface(F){return this.each(function(){const oe=bt.getOrCreateInstance(this,F);if(typeof F!="number"){if(typeof F=="string"){if(oe[F]===void 0||F.startsWith("_")||F==="constructor")throw new TypeError(`No method named "${F}"`);oe[F]()}}else oe.to(F)})}}Je.on(document,ie,"[data-bs-slide], [data-bs-slide-to]",function(Ne){const F=At.getElementFromSelector(this);if(!F||!F.classList.contains(ne))return;Ne.preventDefault();const oe=bt.getOrCreateInstance(F),Re=this.getAttribute("data-bs-slide-to");return Re?(oe.to(Re),void oe._maybeEnableCycle()):li.getDataAttribute(this,"slide")==="next"?(oe.next(),void oe._maybeEnableCycle()):(oe.prev(),void oe._maybeEnableCycle())}),Je.on(window,Le,()=>{const Ne=At.find('[data-bs-ride="carousel"]');for(const F of Ne)bt.getOrCreateInstance(F)}),se(bt);const rt=".bs.collapse",Et=`show${rt}`,Qt=`shown${rt}`,ri=`hide${rt}`,ji=`hidden${rt}`,wi=`click${rt}.data-api`,zi="show",Si="collapse",hn="collapsing",fn=`:scope .${Si} .${Si}`,Ke='[data-bs-toggle="collapse"]',pi={parent:null,toggle:!0},ki={parent:"(null|element)",toggle:"boolean"};class Ui extends Pi{constructor(F,oe){super(F,oe),this._isTransitioning=!1,this._triggerArray=[];const Re=At.find(Ke);for(const mt of Re){const It=At.getSelectorFromElement(mt),Xt=At.find(It).filter(Hi=>Hi===this._element);It!==null&&Xt.length&&this._triggerArray.push(mt)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return pi}static get DefaultType(){return ki}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let F=[];if(this._config.parent&&(F=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(mt=>mt!==this._element).map(mt=>Ui.getOrCreateInstance(mt,{toggle:!1}))),F.length&&F[0]._isTransitioning||Je.trigger(this._element,Et).defaultPrevented)return;for(const mt of F)mt.hide();const oe=this._getDimension();this._element.classList.remove(Si),this._element.classList.add(hn),this._element.style[oe]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const Re=`scroll${oe[0].toUpperCase()+oe.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(hn),this._element.classList.add(Si,zi),this._element.style[oe]="",Je.trigger(this._element,Qt)},this._element,!0),this._element.style[oe]=`${this._element[Re]}px`}hide(){if(this._isTransitioning||!this._isShown()||Je.trigger(this._element,ri).defaultPrevented)return;const F=this._getDimension();this._element.style[F]=`${this._element.getBoundingClientRect()[F]}px`,N(this._element),this._element.classList.add(hn),this._element.classList.remove(Si,zi);for(const oe of this._triggerArray){const Re=At.getElementFromSelector(oe);Re&&!this._isShown(Re)&&this._addAriaAndCollapsedClass([oe],!1)}this._isTransitioning=!0,this._element.style[F]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(hn),this._element.classList.add(Si),Je.trigger(this._element,ji)},this._element,!0)}_isShown(F=this._element){return F.classList.contains(zi)}_configAfterMerge(F){return F.toggle=!!F.toggle,F.parent=C(F.parent),F}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const F=this._getFirstLevelChildren(Ke);for(const oe of F){const Re=At.getElementFromSelector(oe);Re&&this._addAriaAndCollapsedClass([oe],this._isShown(Re))}}_getFirstLevelChildren(F){const oe=At.find(fn,this._config.parent);return At.find(F,this._config.parent).filter(Re=>!oe.includes(Re))}_addAriaAndCollapsedClass(F,oe){if(F.length)for(const Re of F)Re.classList.toggle("collapsed",!oe),Re.setAttribute("aria-expanded",oe)}static jQueryInterface(F){const oe={};return typeof F=="string"&&/show|hide/.test(F)&&(oe.toggle=!1),this.each(function(){const Re=Ui.getOrCreateInstance(this,oe);if(typeof F=="string"){if(Re[F]===void 0)throw new TypeError(`No method named "${F}"`);Re[F]()}})}}Je.on(document,wi,Ke,function(Ne){(Ne.target.tagName==="A"||Ne.delegateTarget&&Ne.delegateTarget.tagName==="A")&&Ne.preventDefault();for(const F of At.getMultipleElementsFromSelector(this))Ui.getOrCreateInstance(F,{toggle:!1}).toggle()}),se(Ui);const Ki="dropdown",Ji=".bs.dropdown",Un=".data-api",si="ArrowUp",es="ArrowDown",Hn=`hide${Ji}`,Vn=`hidden${Ji}`,pn=`show${Ji}`,ba=`shown${Ji}`,zn=`click${Ji}${Un}`,Xn=`keydown${Ji}${Un}`,Ur=`keyup${Ji}${Un}`,Rn="show",Ii='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',No=`${Ii}.${Rn}`,ar=".dropdown-menu",En=Y()?"top-end":"top-start",va=Y()?"top-start":"top-end",Vr=Y()?"bottom-end":"bottom-start",ll=Y()?"bottom-start":"bottom-end",qr=Y()?"left-start":"right-start",ou=Y()?"right-start":"left-start",wa={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Xs={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Bn extends Pi{constructor(F,oe){super(F,oe),this._popper=null,this._parent=this._element.parentNode,this._menu=At.next(this._element,ar)[0]||At.prev(this._element,ar)[0]||At.findOne(ar,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return wa}static get DefaultType(){return Xs}static get NAME(){return Ki}toggle(){return this._isShown()?this.hide():this.show()}show(){if(T(this._element)||this._isShown())return;const F={relatedTarget:this._element};if(!Je.trigger(this._element,pn,F).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const oe of[].concat(...document.body.children))Je.on(oe,"mouseover",R);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Rn),this._element.classList.add(Rn),Je.trigger(this._element,ba,F)}}hide(){if(T(this._element)||!this._isShown())return;const F={relatedTarget:this._element};this._completeHide(F)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(F){if(!Je.trigger(this._element,Hn,F).defaultPrevented){if("ontouchstart"in document.documentElement)for(const oe of[].concat(...document.body.children))Je.off(oe,"mouseover",R);this._popper&&this._popper.destroy(),this._menu.classList.remove(Rn),this._element.classList.remove(Rn),this._element.setAttribute("aria-expanded","false"),li.removeDataAttribute(this._menu,"popper"),Je.trigger(this._element,Vn,F)}}_getConfig(F){if(typeof(F=super._getConfig(F)).reference=="object"&&!y(F.reference)&&typeof F.reference.getBoundingClientRect!="function")throw new TypeError(`${Ki.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return F}_createPopper(){if(c===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let F=this._element;this._config.reference==="parent"?F=this._parent:y(this._config.reference)?F=C(this._config.reference):typeof this._config.reference=="object"&&(F=this._config.reference);const oe=this._getPopperConfig();this._popper=c.createPopper(F,this._menu,oe)}_isShown(){return this._menu.classList.contains(Rn)}_getPlacement(){const F=this._parent;if(F.classList.contains("dropend"))return qr;if(F.classList.contains("dropstart"))return ou;if(F.classList.contains("dropup-center"))return"top";if(F.classList.contains("dropdown-center"))return"bottom";const oe=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return F.classList.contains("dropup")?oe?va:En:oe?ll:Vr}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:F}=this._config;return typeof F=="string"?F.split(",").map(oe=>Number.parseInt(oe,10)):typeof F=="function"?oe=>F(oe,this._element):F}_getPopperConfig(){const F={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(li.setDataAttribute(this._menu,"popper","static"),F.modifiers=[{name:"applyStyles",enabled:!1}]),{...F,...$(this._config.popperConfig,[void 0,F])}}_selectMenuItem({key:F,target:oe}){const Re=At.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(mt=>E(mt));Re.length&&U(Re,oe,F===es,!Re.includes(oe)).focus()}static jQueryInterface(F){return this.each(function(){const oe=Bn.getOrCreateInstance(this,F);if(typeof F=="string"){if(oe[F]===void 0)throw new TypeError(`No method named "${F}"`);oe[F]()}})}static clearMenus(F){if(F.button===2||F.type==="keyup"&&F.key!=="Tab")return;const oe=At.find(No);for(const Re of oe){const mt=Bn.getInstance(Re);if(!mt||mt._config.autoClose===!1)continue;const It=F.composedPath(),Xt=It.includes(mt._menu);if(It.includes(mt._element)||mt._config.autoClose==="inside"&&!Xt||mt._config.autoClose==="outside"&&Xt||mt._menu.contains(F.target)&&(F.type==="keyup"&&F.key==="Tab"||/input|select|option|textarea|form/i.test(F.target.tagName)))continue;const Hi={relatedTarget:mt._element};F.type==="click"&&(Hi.clickEvent=F),mt._completeHide(Hi)}}static dataApiKeydownHandler(F){const oe=/input|textarea/i.test(F.target.tagName),Re=F.key==="Escape",mt=[si,es].includes(F.key);if(!mt&&!Re||oe&&!Re)return;F.preventDefault();const It=this.matches(Ii)?this:At.prev(this,Ii)[0]||At.next(this,Ii)[0]||At.findOne(Ii,F.delegateTarget.parentNode),Xt=Bn.getOrCreateInstance(It);if(mt)return F.stopPropagation(),Xt.show(),void Xt._selectMenuItem(F);Xt._isShown()&&(F.stopPropagation(),Xt.hide(),It.focus())}}Je.on(document,Xn,Ii,Bn.dataApiKeydownHandler),Je.on(document,Xn,ar,Bn.dataApiKeydownHandler),Je.on(document,zn,Bn.clearMenus),Je.on(document,Ur,Bn.clearMenus),Je.on(document,zn,Ii,function(Ne){Ne.preventDefault(),Bn.getOrCreateInstance(this).toggle()}),se(Bn);const Gi="backdrop",xa="show",ka=`mousedown.bs.${Gi}`,po={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},cl={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class jo extends Mi{constructor(F){super(),this._config=this._getConfig(F),this._isAppended=!1,this._element=null}static get Default(){return po}static get DefaultType(){return cl}static get NAME(){return Gi}show(F){if(!this._config.isVisible)return void $(F);this._append();const oe=this._getElement();this._config.isAnimated&&N(oe),oe.classList.add(xa),this._emulateAnimation(()=>{$(F)})}hide(F){this._config.isVisible?(this._getElement().classList.remove(xa),this._emulateAnimation(()=>{this.dispose(),$(F)})):$(F)}dispose(){this._isAppended&&(Je.off(this._element,ka),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const F=document.createElement("div");F.className=this._config.className,this._config.isAnimated&&F.classList.add("fade"),this._element=F}return this._element}_configAfterMerge(F){return F.rootElement=C(F.rootElement),F}_append(){if(this._isAppended)return;const F=this._getElement();this._config.rootElement.append(F),Je.on(F,ka,()=>{$(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(F){te(F,this._getElement(),this._config.isAnimated)}}const Ms=".bs.focustrap",Sa=`focusin${Ms}`,mo=`keydown.tab${Ms}`,ul="backward",au={autofocus:!0,trapElement:null},Kl={autofocus:"boolean",trapElement:"element"};class Jl extends Mi{constructor(F){super(),this._config=this._getConfig(F),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return au}static get DefaultType(){return Kl}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Je.off(document,Ms),Je.on(document,Sa,F=>this._handleFocusin(F)),Je.on(document,mo,F=>this._handleKeydown(F)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Je.off(document,Ms))}_handleFocusin(F){const{trapElement:oe}=this._config;if(F.target===document||F.target===oe||oe.contains(F.target))return;const Re=At.focusableChildren(oe);Re.length===0?oe.focus():this._lastTabNavDirection===ul?Re[Re.length-1].focus():Re[0].focus()}_handleKeydown(F){F.key==="Tab"&&(this._lastTabNavDirection=F.shiftKey?ul:"forward")}}const Ps=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",go=".sticky-top",qn="padding-right",tr="margin-right";class _o{constructor(){this._element=document.body}getWidth(){const F=document.documentElement.clientWidth;return Math.abs(window.innerWidth-F)}hide(){const F=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,qn,oe=>oe+F),this._setElementAttributes(Ps,qn,oe=>oe+F),this._setElementAttributes(go,tr,oe=>oe-F)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,qn),this._resetElementAttributes(Ps,qn),this._resetElementAttributes(go,tr)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(F,oe,Re){const mt=this.getWidth();this._applyManipulationCallback(F,It=>{if(It!==this._element&&window.innerWidth>It.clientWidth+mt)return;this._saveInitialAttribute(It,oe);const Xt=window.getComputedStyle(It).getPropertyValue(oe);It.style.setProperty(oe,`${Re(Number.parseFloat(Xt))}px`)})}_saveInitialAttribute(F,oe){const Re=F.style.getPropertyValue(oe);Re&&li.setDataAttribute(F,oe,Re)}_resetElementAttributes(F,oe){this._applyManipulationCallback(F,Re=>{const mt=li.getDataAttribute(Re,oe);mt!==null?(li.removeDataAttribute(Re,oe),Re.style.setProperty(oe,mt)):Re.style.removeProperty(oe)})}_applyManipulationCallback(F,oe){if(y(F))oe(F);else for(const Re of At.find(F,this._element))oe(Re)}}const ir=".bs.modal",Ta=`hide${ir}`,Yl=`hidePrevented${ir}`,Ks=`hidden${ir}`,Ql=`show${ir}`,$l=`shown${ir}`,ec=`resize${ir}`,lu=`click.dismiss${ir}`,cu=`mousedown.dismiss${ir}`,tc=`keydown.dismiss${ir}`,Uo=`click${ir}.data-api`,Ca="modal-open",Vo="show",qo="modal-static",hl={backdrop:!0,focus:!0,keyboard:!0},ts={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Js extends Pi{constructor(F,oe){super(F,oe),this._dialog=At.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new _o,this._addEventListeners()}static get Default(){return hl}static get DefaultType(){return ts}static get NAME(){return"modal"}toggle(F){return this._isShown?this.hide():this.show(F)}show(F){this._isShown||this._isTransitioning||Je.trigger(this._element,Ql,{relatedTarget:F}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Ca),this._adjustDialog(),this._backdrop.show(()=>this._showElement(F)))}hide(){this._isShown&&!this._isTransitioning&&(Je.trigger(this._element,Ta).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Vo),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){Je.off(window,ir),Je.off(this._dialog,ir),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new jo({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Jl({trapElement:this._element})}_showElement(F){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const oe=At.findOne(".modal-body",this._dialog);oe&&(oe.scrollTop=0),N(this._element),this._element.classList.add(Vo),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Je.trigger(this._element,$l,{relatedTarget:F})},this._dialog,this._isAnimated())}_addEventListeners(){Je.on(this._element,tc,F=>{F.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),Je.on(window,ec,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Je.on(this._element,cu,F=>{Je.one(this._element,lu,oe=>{this._element===F.target&&this._element===oe.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Ca),this._resetAdjustments(),this._scrollBar.reset(),Je.trigger(this._element,Ks)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(Je.trigger(this._element,Yl).defaultPrevented)return;const F=this._element.scrollHeight>document.documentElement.clientHeight,oe=this._element.style.overflowY;oe==="hidden"||this._element.classList.contains(qo)||(F||(this._element.style.overflowY="hidden"),this._element.classList.add(qo),this._queueCallback(()=>{this._element.classList.remove(qo),this._queueCallback(()=>{this._element.style.overflowY=oe},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const F=this._element.scrollHeight>document.documentElement.clientHeight,oe=this._scrollBar.getWidth(),Re=oe>0;if(Re&&!F){const mt=Y()?"paddingLeft":"paddingRight";this._element.style[mt]=`${oe}px`}if(!Re&&F){const mt=Y()?"paddingRight":"paddingLeft";this._element.style[mt]=`${oe}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(F,oe){return this.each(function(){const Re=Js.getOrCreateInstance(this,F);if(typeof F=="string"){if(Re[F]===void 0)throw new TypeError(`No method named "${F}"`);Re[F](oe)}})}}Je.on(document,Uo,'[data-bs-toggle="modal"]',function(Ne){const F=At.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&Ne.preventDefault(),Je.one(F,Ql,Re=>{Re.defaultPrevented||Je.one(F,Ks,()=>{E(this)&&this.focus()})});const oe=At.findOne(".modal.show");oe&&Js.getInstance(oe).hide(),Js.getOrCreateInstance(F).toggle(this)}),Xe(Js),se(Js);const Zr=".bs.offcanvas",Ls=".data-api",zs=`load${Zr}${Ls}`,Xi="show",Zo="showing",ic="hiding",Ys=".offcanvas.show",uu=`show${Zr}`,nc=`shown${Zr}`,hu=`hide${Zr}`,fl=`hidePrevented${Zr}`,Ea=`hidden${Zr}`,rc=`resize${Zr}`,sc=`click${Zr}${Ls}`,oc=`keydown.dismiss${Zr}`,ac={backdrop:!0,keyboard:!0,scroll:!1},Qs={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class is extends Pi{constructor(F,oe){super(F,oe),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return ac}static get DefaultType(){return Qs}static get NAME(){return"offcanvas"}toggle(F){return this._isShown?this.hide():this.show(F)}show(F){this._isShown||Je.trigger(this._element,uu,{relatedTarget:F}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new _o().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Zo),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Xi),this._element.classList.remove(Zo),Je.trigger(this._element,nc,{relatedTarget:F})},this._element,!0))}hide(){this._isShown&&(Je.trigger(this._element,hu).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(ic),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Xi,ic),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new _o().reset(),Je.trigger(this._element,Ea)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const F=!!this._config.backdrop;return new jo({className:"offcanvas-backdrop",isVisible:F,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:F?()=>{this._config.backdrop!=="static"?this.hide():Je.trigger(this._element,fl)}:null})}_initializeFocusTrap(){return new Jl({trapElement:this._element})}_addEventListeners(){Je.on(this._element,oc,F=>{F.key==="Escape"&&(this._config.keyboard?this.hide():Je.trigger(this._element,fl))})}static jQueryInterface(F){return this.each(function(){const oe=is.getOrCreateInstance(this,F);if(typeof F=="string"){if(oe[F]===void 0||F.startsWith("_")||F==="constructor")throw new TypeError(`No method named "${F}"`);oe[F](this)}})}}Je.on(document,sc,'[data-bs-toggle="offcanvas"]',function(Ne){const F=At.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&Ne.preventDefault(),T(this))return;Je.one(F,Ea,()=>{E(this)&&this.focus()});const oe=At.findOne(Ys);oe&&oe!==F&&is.getInstance(oe).hide(),is.getOrCreateInstance(F).toggle(this)}),Je.on(window,zs,()=>{for(const Ne of At.find(Ys))is.getOrCreateInstance(Ne).show()}),Je.on(window,rc,()=>{for(const Ne of At.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(Ne).position!=="fixed"&&is.getOrCreateInstance(Ne).hide()}),Xe(is),se(is);const lc={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},cc=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Wo=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,fu=(Ne,F)=>{const oe=Ne.nodeName.toLowerCase();return F.includes(oe)?!cc.has(oe)||!!Wo.test(Ne.nodeValue):F.filter(Re=>Re instanceof RegExp).some(Re=>Re.test(oe))},Ia={allowList:lc,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},du={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},pu={entry:"(string|element|function|null)",selector:"(string|element)"};class uc extends Mi{constructor(F){super(),this._config=this._getConfig(F)}static get Default(){return Ia}static get DefaultType(){return du}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(F=>this._resolvePossibleFunction(F)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(F){return this._checkContent(F),this._config.content={...this._config.content,...F},this}toHtml(){const F=document.createElement("div");F.innerHTML=this._maybeSanitize(this._config.template);for(const[mt,It]of Object.entries(this._config.content))this._setContent(F,It,mt);const oe=F.children[0],Re=this._resolvePossibleFunction(this._config.extraClass);return Re&&oe.classList.add(...Re.split(" ")),oe}_typeCheckConfig(F){super._typeCheckConfig(F),this._checkContent(F.content)}_checkContent(F){for(const[oe,Re]of Object.entries(F))super._typeCheckConfig({selector:oe,entry:Re},pu)}_setContent(F,oe,Re){const mt=At.findOne(Re,F);mt&&((oe=this._resolvePossibleFunction(oe))?y(oe)?this._putElementInTemplate(C(oe),mt):this._config.html?mt.innerHTML=this._maybeSanitize(oe):mt.textContent=oe:mt.remove())}_maybeSanitize(F){return this._config.sanitize?function(oe,Re,mt){if(!oe.length)return oe;if(mt&&typeof mt=="function")return mt(oe);const It=new window.DOMParser().parseFromString(oe,"text/html"),Xt=[].concat(...It.body.querySelectorAll("*"));for(const Hi of Xt){const cn=Hi.nodeName.toLowerCase();if(!Object.keys(Re).includes(cn)){Hi.remove();continue}const On=[].concat(...Hi.attributes),In=[].concat(Re["*"]||[],Re[cn]||[]);for(const wr of On)fu(wr,In)||Hi.removeAttribute(wr.nodeName)}return It.body.innerHTML}(F,this._config.allowList,this._config.sanitizeFn):F}_resolvePossibleFunction(F){return $(F,[void 0,this])}_putElementInTemplate(F,oe){if(this._config.html)return oe.innerHTML="",void oe.append(F);oe.textContent=F.textContent}}const hc=new Set(["sanitize","allowList","sanitizeFn"]),Aa="fade",yo="show",fc=".tooltip-inner",Go=".modal",ns="hide.bs.modal",$s="hover",Ho="focus",Xo="click",Ma={AUTO:"auto",TOP:"top",RIGHT:Y()?"left":"right",BOTTOM:"bottom",LEFT:Y()?"right":"left"},dl={allowList:lc,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},eo={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class ms extends Pi{constructor(F,oe){if(c===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(F,oe),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return dl}static get DefaultType(){return eo}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),Je.off(this._element.closest(Go),ns,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const F=Je.trigger(this._element,this.constructor.eventName("show")),oe=(M(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(F.defaultPrevented||!oe)return;this._disposePopper();const Re=this._getTipElement();this._element.setAttribute("aria-describedby",Re.getAttribute("id"));const{container:mt}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(mt.append(Re),Je.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(Re),Re.classList.add(yo),"ontouchstart"in document.documentElement)for(const It of[].concat(...document.body.children))Je.on(It,"mouseover",R);this._queueCallback(()=>{Je.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!Je.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(yo),"ontouchstart"in document.documentElement)for(const F of[].concat(...document.body.children))Je.off(F,"mouseover",R);this._activeTrigger[Xo]=!1,this._activeTrigger[Ho]=!1,this._activeTrigger[$s]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Je.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(F){const oe=this._getTemplateFactory(F).toHtml();if(!oe)return null;oe.classList.remove(Aa,yo),oe.classList.add(`bs-${this.constructor.NAME}-auto`);const Re=(mt=>{do mt+=Math.floor(1e6*Math.random());while(document.getElementById(mt));return mt})(this.constructor.NAME).toString();return oe.setAttribute("id",Re),this._isAnimated()&&oe.classList.add(Aa),oe}setContent(F){this._newContent=F,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(F){return this._templateFactory?this._templateFactory.changeContent(F):this._templateFactory=new uc({...this._config,content:F,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[fc]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(F){return this.constructor.getOrCreateInstance(F.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Aa)}_isShown(){return this.tip&&this.tip.classList.contains(yo)}_createPopper(F){const oe=$(this._config.placement,[this,F,this._element]),Re=Ma[oe.toUpperCase()];return c.createPopper(this._element,F,this._getPopperConfig(Re))}_getOffset(){const{offset:F}=this._config;return typeof F=="string"?F.split(",").map(oe=>Number.parseInt(oe,10)):typeof F=="function"?oe=>F(oe,this._element):F}_resolvePossibleFunction(F){return $(F,[this._element,this._element])}_getPopperConfig(F){const oe={placement:F,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:Re=>{this._getTipElement().setAttribute("data-popper-placement",Re.state.placement)}}]};return{...oe,...$(this._config.popperConfig,[void 0,oe])}}_setListeners(){const F=this._config.trigger.split(" ");for(const oe of F)if(oe==="click")Je.on(this._element,this.constructor.eventName("click"),this._config.selector,Re=>{const mt=this._initializeOnDelegatedTarget(Re);mt._activeTrigger[Xo]=!(mt._isShown()&&mt._activeTrigger[Xo]),mt.toggle()});else if(oe!=="manual"){const Re=oe===$s?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),mt=oe===$s?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");Je.on(this._element,Re,this._config.selector,It=>{const Xt=this._initializeOnDelegatedTarget(It);Xt._activeTrigger[It.type==="focusin"?Ho:$s]=!0,Xt._enter()}),Je.on(this._element,mt,this._config.selector,It=>{const Xt=this._initializeOnDelegatedTarget(It);Xt._activeTrigger[It.type==="focusout"?Ho:$s]=Xt._element.contains(It.relatedTarget),Xt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Je.on(this._element.closest(Go),ns,this._hideModalHandler)}_fixTitle(){const F=this._element.getAttribute("title");F&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",F),this._element.setAttribute("data-bs-original-title",F),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(F,oe){clearTimeout(this._timeout),this._timeout=setTimeout(F,oe)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(F){const oe=li.getDataAttributes(this._element);for(const Re of Object.keys(oe))hc.has(Re)&&delete oe[Re];return F={...oe,...typeof F=="object"&&F?F:{}},F=this._mergeConfigObj(F),F=this._configAfterMerge(F),this._typeCheckConfig(F),F}_configAfterMerge(F){return F.container=F.container===!1?document.body:C(F.container),typeof F.delay=="number"&&(F.delay={show:F.delay,hide:F.delay}),typeof F.title=="number"&&(F.title=F.title.toString()),typeof F.content=="number"&&(F.content=F.content.toString()),F}_getDelegateConfig(){const F={};for(const[oe,Re]of Object.entries(this._config))this.constructor.Default[oe]!==Re&&(F[oe]=Re);return F.selector=!1,F.trigger="manual",F}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(F){return this.each(function(){const oe=ms.getOrCreateInstance(this,F);if(typeof F=="string"){if(oe[F]===void 0)throw new TypeError(`No method named "${F}"`);oe[F]()}})}}se(ms);const mu=".popover-header",Tn=".popover-body",gu={...ms.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Li={...ms.DefaultType,content:"(null|string|element|function)"};class to extends ms{static get Default(){return gu}static get DefaultType(){return Li}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[mu]:this._getTitle(),[Tn]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(F){return this.each(function(){const oe=to.getOrCreateInstance(this,F);if(typeof F=="string"){if(oe[F]===void 0)throw new TypeError(`No method named "${F}"`);oe[F]()}})}}se(to);const $i=".bs.scrollspy",en=`activate${$i}`,Os=`click${$i}`,Ko=`load${$i}.data-api`,rs="active",Jo="[href]",Ds=".nav-link",bo=`${Ds}, .nav-item > ${Ds}, .list-group-item`,Pr={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},pl={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class io extends Pi{constructor(F,oe){super(F,oe),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Pr}static get DefaultType(){return pl}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const F of this._observableSections.values())this._observer.observe(F)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(F){return F.target=C(F.target)||document.body,F.rootMargin=F.offset?`${F.offset}px 0px -30%`:F.rootMargin,typeof F.threshold=="string"&&(F.threshold=F.threshold.split(",").map(oe=>Number.parseFloat(oe))),F}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Je.off(this._config.target,Os),Je.on(this._config.target,Os,Jo,F=>{const oe=this._observableSections.get(F.target.hash);if(oe){F.preventDefault();const Re=this._rootElement||window,mt=oe.offsetTop-this._element.offsetTop;if(Re.scrollTo)return void Re.scrollTo({top:mt,behavior:"smooth"});Re.scrollTop=mt}}))}_getNewObserver(){const F={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(oe=>this._observerCallback(oe),F)}_observerCallback(F){const oe=Xt=>this._targetLinks.get(`#${Xt.target.id}`),Re=Xt=>{this._previousScrollData.visibleEntryTop=Xt.target.offsetTop,this._process(oe(Xt))},mt=(this._rootElement||document.documentElement).scrollTop,It=mt>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=mt;for(const Xt of F){if(!Xt.isIntersecting){this._activeTarget=null,this._clearActiveClass(oe(Xt));continue}const Hi=Xt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(It&&Hi){if(Re(Xt),!mt)return}else It||Hi||Re(Xt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const F=At.find(Jo,this._config.target);for(const oe of F){if(!oe.hash||T(oe))continue;const Re=At.findOne(decodeURI(oe.hash),this._element);E(Re)&&(this._targetLinks.set(decodeURI(oe.hash),oe),this._observableSections.set(oe.hash,Re))}}_process(F){this._activeTarget!==F&&(this._clearActiveClass(this._config.target),this._activeTarget=F,F.classList.add(rs),this._activateParents(F),Je.trigger(this._element,en,{relatedTarget:F}))}_activateParents(F){if(F.classList.contains("dropdown-item"))At.findOne(".dropdown-toggle",F.closest(".dropdown")).classList.add(rs);else for(const oe of At.parents(F,".nav, .list-group"))for(const Re of At.prev(oe,bo))Re.classList.add(rs)}_clearActiveClass(F){F.classList.remove(rs);const oe=At.find(`${Jo}.${rs}`,F);for(const Re of oe)Re.classList.remove(rs)}static jQueryInterface(F){return this.each(function(){const oe=io.getOrCreateInstance(this,F);if(typeof F=="string"){if(oe[F]===void 0||F.startsWith("_")||F==="constructor")throw new TypeError(`No method named "${F}"`);oe[F]()}})}}Je.on(window,Ko,()=>{for(const Ne of At.find('[data-bs-spy="scroll"]'))io.getOrCreateInstance(Ne)}),se(io);const gs=".bs.tab",no=`hide${gs}`,Yo=`hidden${gs}`,Qo=`show${gs}`,vo=`shown${gs}`,$o=`click${gs}`,Pa=`keydown${gs}`,wo=`load${gs}`,xo="ArrowLeft",ml="ArrowRight",gl="ArrowUp",Wi="ArrowDown",ko="Home",dc="End",Fs="active",ro="fade",La="show",ea=".dropdown-toggle",za=`:not(${ea})`,_l='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',So=`.nav-link${za}, .list-group-item${za}, [role="tab"]${za}, ${_l}`,Oa=`.${Fs}[data-bs-toggle="tab"], .${Fs}[data-bs-toggle="pill"], .${Fs}[data-bs-toggle="list"]`;class Lr extends Pi{constructor(F){super(F),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Je.on(this._element,Pa,oe=>this._keydown(oe)))}static get NAME(){return"tab"}show(){const F=this._element;if(this._elemIsActive(F))return;const oe=this._getActiveElem(),Re=oe?Je.trigger(oe,no,{relatedTarget:F}):null;Je.trigger(F,Qo,{relatedTarget:oe}).defaultPrevented||Re&&Re.defaultPrevented||(this._deactivate(oe,F),this._activate(F,oe))}_activate(F,oe){F&&(F.classList.add(Fs),this._activate(At.getElementFromSelector(F)),this._queueCallback(()=>{F.getAttribute("role")==="tab"?(F.removeAttribute("tabindex"),F.setAttribute("aria-selected",!0),this._toggleDropDown(F,!0),Je.trigger(F,vo,{relatedTarget:oe})):F.classList.add(La)},F,F.classList.contains(ro)))}_deactivate(F,oe){F&&(F.classList.remove(Fs),F.blur(),this._deactivate(At.getElementFromSelector(F)),this._queueCallback(()=>{F.getAttribute("role")==="tab"?(F.setAttribute("aria-selected",!1),F.setAttribute("tabindex","-1"),this._toggleDropDown(F,!1),Je.trigger(F,Yo,{relatedTarget:oe})):F.classList.remove(La)},F,F.classList.contains(ro)))}_keydown(F){if(![xo,ml,gl,Wi,ko,dc].includes(F.key))return;F.stopPropagation(),F.preventDefault();const oe=this._getChildren().filter(mt=>!T(mt));let Re;if([ko,dc].includes(F.key))Re=oe[F.key===ko?0:oe.length-1];else{const mt=[ml,Wi].includes(F.key);Re=U(oe,F.target,mt,!0)}Re&&(Re.focus({preventScroll:!0}),Lr.getOrCreateInstance(Re).show())}_getChildren(){return At.find(So,this._parent)}_getActiveElem(){return this._getChildren().find(F=>this._elemIsActive(F))||null}_setInitialAttributes(F,oe){this._setAttributeIfNotExists(F,"role","tablist");for(const Re of oe)this._setInitialAttributesOnChild(Re)}_setInitialAttributesOnChild(F){F=this._getInnerElement(F);const oe=this._elemIsActive(F),Re=this._getOuterElement(F);F.setAttribute("aria-selected",oe),Re!==F&&this._setAttributeIfNotExists(Re,"role","presentation"),oe||F.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(F,"role","tab"),this._setInitialAttributesOnTargetPanel(F)}_setInitialAttributesOnTargetPanel(F){const oe=At.getElementFromSelector(F);oe&&(this._setAttributeIfNotExists(oe,"role","tabpanel"),F.id&&this._setAttributeIfNotExists(oe,"aria-labelledby",`${F.id}`))}_toggleDropDown(F,oe){const Re=this._getOuterElement(F);if(!Re.classList.contains("dropdown"))return;const mt=(It,Xt)=>{const Hi=At.findOne(It,Re);Hi&&Hi.classList.toggle(Xt,oe)};mt(ea,Fs),mt(".dropdown-menu",La),Re.setAttribute("aria-expanded",oe)}_setAttributeIfNotExists(F,oe,Re){F.hasAttribute(oe)||F.setAttribute(oe,Re)}_elemIsActive(F){return F.classList.contains(Fs)}_getInnerElement(F){return F.matches(So)?F:At.findOne(So,F)}_getOuterElement(F){return F.closest(".nav-item, .list-group-item")||F}static jQueryInterface(F){return this.each(function(){const oe=Lr.getOrCreateInstance(this);if(typeof F=="string"){if(oe[F]===void 0||F.startsWith("_")||F==="constructor")throw new TypeError(`No method named "${F}"`);oe[F]()}})}}Je.on(document,$o,_l,function(Ne){["A","AREA"].includes(this.tagName)&&Ne.preventDefault(),T(this)||Lr.getOrCreateInstance(this).show()}),Je.on(window,wo,()=>{for(const Ne of At.find(Oa))Lr.getOrCreateInstance(Ne)}),se(Lr);const vr=".bs.toast",To=`mouseover${vr}`,yl=`mouseout${vr}`,Co=`focusin${vr}`,ta=`focusout${vr}`,Da=`hide${vr}`,Fa=`hidden${vr}`,bl=`show${vr}`,_u=`shown${vr}`,vl="hide",so="show",Eo="showing",ia={animation:"boolean",autohide:"boolean",delay:"number"},na={animation:!0,autohide:!0,delay:5e3};class Pn extends Pi{constructor(F,oe){super(F,oe),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return na}static get DefaultType(){return ia}static get NAME(){return"toast"}show(){Je.trigger(this._element,bl).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(vl),N(this._element),this._element.classList.add(so,Eo),this._queueCallback(()=>{this._element.classList.remove(Eo),Je.trigger(this._element,_u),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(Je.trigger(this._element,Da).defaultPrevented||(this._element.classList.add(Eo),this._queueCallback(()=>{this._element.classList.add(vl),this._element.classList.remove(Eo,so),Je.trigger(this._element,Fa)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(so),super.dispose()}isShown(){return this._element.classList.contains(so)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(F,oe){switch(F.type){case"mouseover":case"mouseout":this._hasMouseInteraction=oe;break;case"focusin":case"focusout":this._hasKeyboardInteraction=oe}if(oe)return void this._clearTimeout();const Re=F.relatedTarget;this._element===Re||this._element.contains(Re)||this._maybeScheduleHide()}_setListeners(){Je.on(this._element,To,F=>this._onInteraction(F,!0)),Je.on(this._element,yl,F=>this._onInteraction(F,!1)),Je.on(this._element,Co,F=>this._onInteraction(F,!0)),Je.on(this._element,ta,F=>this._onInteraction(F,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(F){return this.each(function(){const oe=Pn.getOrCreateInstance(this,F);if(typeof F=="string"){if(oe[F]===void 0)throw new TypeError(`No method named "${F}"`);oe[F](this)}})}}return Xe(Pn),se(Pn),{Alert:yi,Button:it,Carousel:bt,Collapse:Ui,Dropdown:Bn,Modal:Js,Offcanvas:is,Popover:to,ScrollSpy:io,Tab:Lr,Toast:Pn,Tooltip:ms}})})(B1);var Ts=63710088e-1,Iw={centimeters:Ts*100,centimetres:Ts*100,degrees:360/(2*Math.PI),feet:Ts*3.28084,inches:Ts*39.37,kilometers:Ts/1e3,kilometres:Ts/1e3,meters:Ts,metres:Ts,miles:Ts/1609.344,millimeters:Ts*1e3,millimetres:Ts*1e3,nauticalmiles:Ts/1852,radians:1,yards:Ts*1.0936};function Zd(r,e,n={}){const o={type:"Feature"};return(n.id===0||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=e||{},o.geometry=r,o}function tf(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!kg(r[0])||!kg(r[1]))throw new Error("coordinates must contain numbers");return Zd({type:"Point",coordinates:r},e,n)}function Aw(r,e="kilometers"){const n=Iw[e];if(!n)throw new Error(e+" units is invalid");return r*n}function xg(r){return r%(2*Math.PI)*180/Math.PI}function Wc(r){return r%360*Math.PI/180}function kg(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Gc(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mw(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Bl(r,e,n={}){var o=Gc(r),c=Gc(e),d=Wc(c[1]-o[1]),h=Wc(c[0]-o[0]),a=Wc(o[1]),_=Wc(c[1]),S=Math.pow(Math.sin(d/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(a)*Math.cos(_);return Aw(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)),n.units)}function U0(r,e,n){if(r!==null)for(var o,c,d,h,a,_,S,k=0,y=0,C,E=r.type,T=E==="FeatureCollection",M=E==="Feature",R=T?r.features.length:1,N=0;N<R;N++){S=T?r.features[N].geometry:M?r.geometry:r,C=S?S.type==="GeometryCollection":!1,a=C?S.geometries.length:1;for(var z=0;z<a;z++){var V=0,Y=0;if(h=C?S.geometries[z]:S,h!==null){_=h.coordinates;var se=h.type;switch(k=0,se){case null:break;case"Point":if(e(_,y,N,V,Y)===!1)return!1;y++,V++;break;case"LineString":case"MultiPoint":for(o=0;o<_.length;o++){if(e(_[o],y,N,V,Y)===!1)return!1;y++,se==="MultiPoint"&&V++}se==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(o=0;o<_.length;o++){for(c=0;c<_[o].length-k;c++){if(e(_[o][c],y,N,V,Y)===!1)return!1;y++}se==="MultiLineString"&&V++,se==="Polygon"&&Y++}se==="Polygon"&&V++;break;case"MultiPolygon":for(o=0;o<_.length;o++){for(Y=0,c=0;c<_[o].length;c++){for(d=0;d<_[o][c].length-k;d++){if(e(_[o][c][d],y,N,V,Y)===!1)return!1;y++}Y++}V++}break;case"GeometryCollection":for(o=0;o<h.geometries.length;o++)if(U0(h.geometries[o],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pw(r,e){var n,o,c,d,h,a,_,S,k,y,C=0,E=r.type==="FeatureCollection",T=r.type==="Feature",M=E?r.features.length:1;for(n=0;n<M;n++){for(a=E?r.features[n].geometry:T?r.geometry:r,S=E?r.features[n].properties:T?r.properties:{},k=E?r.features[n].bbox:T?r.bbox:void 0,y=E?r.features[n].id:T?r.id:void 0,_=a?a.type==="GeometryCollection":!1,h=_?a.geometries.length:1,c=0;c<h;c++){if(d=_?a.geometries[c]:a,d===null){if(e(null,C,S,k,y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(d,C,S,k,y)===!1)return!1;break}case"GeometryCollection":{for(o=0;o<d.geometries.length;o++)if(e(d.geometries[o],C,S,k,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function Lw(r,e){Pw(r,function(n,o,c,d,h){var a=n===null?null:n.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Zd(n,c,{bbox:d,id:h}),o,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var k=n.coordinates[S],y={type:_,coordinates:k};if(e(Zd(y,c),o,S)===!1)return!1}})}var zw=Object.defineProperty,Ow=Object.defineProperties,Dw=Object.getOwnPropertyDescriptors,Sg=Object.getOwnPropertySymbols,Fw=Object.prototype.hasOwnProperty,Rw=Object.prototype.propertyIsEnumerable,Tg=(r,e,n)=>e in r?zw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,Cg=(r,e)=>{for(var n in e||(e={}))Fw.call(e,n)&&Tg(r,n,e[n]);if(Sg)for(var n of Sg(e))Rw.call(e,n)&&Tg(r,n,e[n]);return r},Eg=(r,e)=>Ow(r,Dw(e));function Bw(r,e,n={}){if(!r||!e)throw new Error("lines and pt are required arguments");const o=Gc(e);let c=tf([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),d=0;return Lw(r,function(h,a,_){const S=Mw(h);for(let k=0;k<S.length-1;k++){const y=tf(S[k]);y.properties.dist=Bl(e,y,n);const C=Gc(y),E=tf(S[k+1]);E.properties.dist=Bl(e,E,n);const T=Gc(E),M=Bl(y,E,n);let R,N;C[0]===o[0]&&C[1]===o[1]?[R,,N]=[C,void 0,!1]:T[0]===o[0]&&T[1]===o[1]?[R,,N]=[T,void 0,!0]:[R,,N]=Uw(y.geometry.coordinates,E.geometry.coordinates,Gc(e));let z;R&&(z=tf(R,{dist:Bl(e,R,n),multiFeatureIndex:_,location:d+Bl(y,R,n)})),z&&z.properties.dist<c.properties.dist&&(c=Eg(Cg({},z),{properties:Eg(Cg({},z.properties),{index:N?k+1:k})})),d+=M}}),c}function Nw(r,e){const[n,o,c]=r,[d,h,a]=e;return n*d+o*h+c*a}function jw(r,e){const[n,o,c]=r,[d,h,a]=e;return[o*a-c*h,c*d-n*a,n*h-o*d]}function Ig(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2))}function Ol(r,e){const n=Nw(r,e)/(Ig(r)*Ig(e));return Math.acos(Math.min(Math.max(n,-1),1))}function Id(r){const e=Wc(r[1]),n=Wc(r[0]);return[Math.cos(e)*Math.cos(n),Math.cos(e)*Math.sin(n),Math.sin(e)]}function Dl(r){const[e,n,o]=r,c=xg(Math.asin(o));return[xg(Math.atan2(n,e)),c]}function Uw(r,e,n){const o=Id(r),c=Id(e),d=Id(n),[h,a,_]=d,[S,k,y]=jw(o,c),C=k*_-y*a,E=y*h-S*_,T=S*a-k*h,M=T*k-E*y,R=C*y-T*S,N=E*S-C*k,z=1/Math.sqrt(Math.pow(M,2)+Math.pow(R,2)+Math.pow(N,2)),V=[M*z,R*z,N*z],Y=[-1*M*z,-1*R*z,-1*N*z],se=Ol(o,c),$=Ol(o,V),te=Ol(c,V),U=Ol(o,Y),j=Ol(c,Y);let G;return $<U&&$<j||te<U&&te<j?G=V:G=Y,Ol(o,G)>se||Ol(c,G)>se?Bl(Dl(G),Dl(o))<=Bl(Dl(G),Dl(c))?[Dl(o),!0,!1]:[Dl(c),!1,!0]:[Dl(G),!1,!1]}var Vw=Bw;const qw=["==",["geometry-type"],"Polygon"],Zw=["==",["geometry-type"],"LineString"],Ww=["==",["geometry-type"],"Point"];function V0(){return{type:"FeatureCollection",features:[]}}function Ad(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:q0(r)}}}function q0(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Bc=[];function Md(r,e){return{subscribe:vn(r,e).subscribe}}function vn(r,e=Ot){let n;const o=new Set;function c(a){if(Yt(r,a)&&(r=a,n)){const _=!Bc.length;for(const S of o)S[1](),Bc.push(S,r);if(_){for(let S=0;S<Bc.length;S+=2)Bc[S][0](Bc[S+1]);Bc.length=0}}}function d(a){c(a(r))}function h(a,_=Ot){const S=[a,_];return o.add(S),o.size===1&&(n=e(c,d)||Ot),a(r),()=>{o.delete(S),o.size===0&&n&&(n(),n=null)}}return{set:c,update:d,subscribe:h}}const Z0=vn(V0()),W0=vn(0),Gw=100;class Hw{constructor(e){Wn(this,"map");Wn(this,"active");Wn(this,"eventListenersSuccess");Wn(this,"eventListenersUpdated");Wn(this,"eventListenersFailure");Wn(this,"points");Wn(this,"cursor");Wn(this,"hover");Wn(this,"dragFrom");Wn(this,"previousStates");Wn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-e.lngLat.lng,o=this.dragFrom[1]-e.lngLat.lat;for(let c of this.points)c[0]-=n,c[1]-=o}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Wn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(Ag(this.points).forEach((o,c)=>{n.push([c+1,Vw(o,this.cursor).properties.dist])}),n.sort((o,c)=>o[1]-c[1]),n.length>0){let o=n[0][0];this.points.splice(o,0,this.cursor.geometry.coordinates),this.hover=o}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Wn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Ad(e.lngLat.toArray()),this.onClick(e),this.finish())});Wn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Wn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Wn(this,"onKeypress",e=>{if(!this.active)return;let n=e.target.tagName;n=="INPUT"||n=="TEXTAREA"||(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Wn(this,"onKeyDown",e=>{if(!this.active)return;let n=e.target.tagName;n=="INPUT"||n=="TEXTAREA"||e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersSuccess)n(e);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=V0();this.points.forEach((c,d)=>{let h=Ad(c);h.properties.hover=this.hover==d,h.properties.idx=d,e.features.push(h)}),e.features=e.features.concat(Ag(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",e.features.push(n)),Z0.set(e);let o="crosshair";this.hover!=null&&(o=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=o,W0.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersUpdated)n(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Ad(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(q0),n=[JSON.parse(JSON.stringify(e))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Gw&&this.previousStates.shift()}}function Ag(r){let e=[];for(let n=0;n<r.length-1;n++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[n],r[n+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function Xw(r){let e,n,o;return{c(){e=gt("Undo ("),n=gt(r[1]),o=gt(")")},m(c,d){be(c,e,d),be(c,n,d),be(c,o,d)},p(c,d){d&2&&_i(n,c[1])},d(c){c&&(ye(e),ye(n),ye(o))}}}function Kw(r){let e;return{c(){e=gt("Undo")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function Jw(r){let e,n,o,c,d,h,a,_,S,k,y;function C(M,R){return M[1]==0?Kw:Xw}let E=C(r),T=E(r);return{c(){e=xe("div"),n=xe("button"),n.textContent="Finish",o=Ue(),c=xe("button"),c.textContent="Cancel",d=Ue(),h=xe("button"),T.c(),_=Ue(),S=xe("ul"),S.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,h.disabled=a=r[1]==0,tn(e,"display","flex"),tn(e,"justify-content","space-between")},m(M,R){be(M,e,R),ce(e,n),ce(e,o),ce(e,c),ce(e,d),ce(e,h),T.m(h,null),be(M,_,R),be(M,S,R),k||(y=[Ut(n,"click",r[2]),Ut(c,"click",r[3]),Ut(h,"click",r[4])],k=!0)},p(M,[R]){E===(E=C(M))&&T?T.p(M,R):(T.d(1),T=E(M),T&&(T.c(),T.m(h,null))),R&2&&a!==(a=M[1]==0)&&(h.disabled=a)},i:Ot,o:Ot,d(M){M&&(ye(e),ye(_),ye(S)),T.d(),k=!1,jn(y)}}}function Yw(r,e,n){let o;Bt(r,W0,_=>n(1,o=_));let{polygonTool:c}=e;const d=()=>c.finish(),h=()=>c.cancel(),a=()=>c.undo();return r.$$set=_=>{"polygonTool"in _&&n(0,c=_.polygonTool)},[c,o,d,h,a]}class Qw extends ai{constructor(e){super(),oi(this,e,Yw,Jw,Yt,{polygonTool:0})}}let $w=Date.now();function vh(r){return`${r}-${$w++}`}const G0=Symbol.for("svelte-maplibre");function ex(){return h0(G0)}function Mg(r){return{subscribe:r.subscribe}}function H0({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:o=!1}){let c=ex(),d=vn(null),h=Mg(d),a={...c,[r]:Mg(d)};if(e&&(a.popupTarget=h),o){let _=vn(null);a.layerEvent=_,c.layerEvent=_}return n&&(a.cluster=vn()),op(G0,a),{...c,self:d}}function tx(){return H0({key:"source",setCluster:!0})}function ix(r=!0){return H0({key:"layer",setPopupTarget:r,setMouseEvent:r})}var X0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,e){(function(n,o){r.exports=o()})(g0,function(){var n={},o={};function c(h,a,_){if(o[h]=_,h==="index"){var S="var sharedModule = {}; ("+o.shared+")(sharedModule); ("+o.worker+")(sharedModule);",k={};return o.shared(k),o.index(n,k),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([S],{type:"text/javascript"}))),n}}c("shared",["exports"],function(h){function a(s,i,l,f){return new(l||(l=Promise))(function(g,w){function x(B){try{P(f.next(B))}catch(q){w(q)}}function I(B){try{P(f.throw(B))}catch(q){w(q)}}function P(B){var q;B.done?g(B.value):(q=B.value,q instanceof l?q:new l(function(H){H(q)})).then(x,I)}P((f=f.apply(s,i||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var S=k;function k(s,i){this.x=s,this.y=i}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,l=s.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),l=Math.sin(s),f=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=f,this},_rotateAround:function(s,i){var l=Math.cos(s),f=Math.sin(s),g=i.y+f*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-f*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var y=_(S),C=E;function E(s,i,l,f){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=f}E.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,f=0;f<8;f++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var w=this.sampleCurveDerivativeX(l);if(Math.abs(w)<1e-6)break;l-=g/w}var x=0,I=1;for(l=s,f=0;f<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));f++)s>g?x=l:I=l,l=.5*(I-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var T=_(C);let M,R;function N(){return M==null&&(M=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),M}function z(){if(R==null&&(R=!1,N())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let f=0;f<5*5;f++){const g=4*f;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(f%5,Math.floor(f/5),1,1)}const l=i.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&l[f]!==f){R=!0;break}}}return R||!1}function V(s,i,l,f){const g=new T(s,i,l,f);return w=>g.solve(w)}const Y=V(.25,.1,.25,1);function se(s,i,l){return Math.min(l,Math.max(i,s))}function $(s,i,l){const f=l-i,g=((s-i)%f+f)%f+i;return g===i?l:g}function te(s,...i){for(const l of i)for(const f in l)s[f]=l[f];return s}let U=1;function j(s,i,l){const f={};for(const g in s)f[g]=i.call(this,s[g],g,s);return f}function G(s,i,l){const f={};for(const g in s)i.call(this,s[g],g,s)&&(f[g]=s[g]);return f}function O(s){return Array.isArray(s)?s.map(O):typeof s=="object"&&s?j(s,O):s}const W={};function le(s){W[s]||(typeof console<"u"&&console.warn(s),W[s]=!0)}function de(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}function ve(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let pe=null;function we(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ae(s,i,l,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const I=x.startsWith("BGR"),P=new Uint8ClampedArray(f*g*4);if(yield w.copyTo(P,function(B,q,H,ee,re){const ue=4*Math.max(-q,0),ge=(Math.max(0,H)-H)*ee*4+ue,Ee=4*ee,ze=Math.max(0,q),tt=Math.max(0,H);return{rect:{x:ze,y:tt,width:Math.min(B.width,q+ee)-ze,height:Math.min(B.height,H+re)-tt},layout:[{offset:ge,stride:Ee}]}}(s,i,l,f,g)),I)for(let B=0;B<P.length;B+=4){const q=P[B];P[B]=P[B+2],P[B+2]=q}return P}finally{w.close()}})}let ct,We;const pt="AbortError";function kt(){return new Error(pt)}const Je={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function wt(s){return Je.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const Tt="global-dispatcher";class Ht extends Error{constructor(i,l,f,g){super(`AJAXError: ${l} (${i}): ${f}`),this.status=i,this.statusText=l,this.url=f,this.body=g}}const li=()=>ve(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Mi=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=wt(s.url);if(f)return f(s,i);if(ve(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:Tt},i)}if(!(/^file:/.test(l=s.url)||/^file:/.test(li())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:li(),signal:g.signal});f.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const B=yield x.blob();throw new Ht(x.status,x.statusText,f.url,B)}let I;I=f.type==="arrayBuffer"||f.type==="image"?x.arrayBuffer():f.type==="json"?x.json():x.text();const P=yield I;if(g.signal.aborted)throw kt();return{data:P,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,i);if(ve(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:Tt},i)}var l;return function(f,g){return new Promise((w,x)=>{var I;const P=new XMLHttpRequest;P.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(P.responseType="arraybuffer");for(const B in f.headers)P.setRequestHeader(B,f.headers[B]);f.type==="json"&&(P.responseType="text",!((I=f.headers)===null||I===void 0)&&I.Accept||P.setRequestHeader("Accept","application/json")),P.withCredentials=f.credentials==="include",P.onerror=()=>{x(new Error(P.statusText))},P.onload=()=>{if(!g.signal.aborted)if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let B=P.response;if(f.type==="json")try{B=JSON.parse(P.response)}catch(q){return void x(q)}w({data:B,cacheControl:P.getResponseHeader("Cache-Control"),expires:P.getResponseHeader("Expires")})}else{const B=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});x(new Ht(P.status,P.statusText,f.url,B))}},g.signal.addEventListener("abort",()=>{P.abort(),x(kt())}),P.send(f.body)})}(s,i)};function Pi(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function Ti(s,i,l){l[s]&&l[s].indexOf(i)!==-1||(l[s]=l[s]||[],l[s].push(i))}function At(s,i,l){if(l&&l[s]){const f=l[s].indexOf(i);f!==-1&&l[s].splice(f,1)}}class Xe{constructor(i,l={}){te(this,l),this.type=i}}class Pt extends Xe{constructor(i,l={}){super("error",te({error:i},l))}}class ni{on(i,l){return this._listeners=this._listeners||{},Ti(i,l,this._listeners),this}off(i,l){return At(i,l,this._listeners),At(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ti(i,l,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,l){typeof i=="string"&&(i=new Xe(i,l||{}));const f=i.type;if(this.listens(f)){i.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const I of g)I.call(this,i);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const I of w)At(f,I,this._oneTimeListeners),I.call(this,i);const x=this._eventedParent;x&&(te(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof Pt&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const yi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yt(s,i){const l={};for(const f in s)f!=="ref"&&(l[f]=s[f]);return yi.forEach(f=>{f in i&&(l[f]=i[f])}),l}function it(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let l=0;l<s.length;l++)if(!it(s[l],i[l]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const l in s)if(!it(s[l],i[l]))return!1;return!0}return s===i}function fe(s,i){s.push(i)}function X(s,i,l){fe(l,{command:"addSource",args:[s,i[s]]})}function Q(s,i,l){fe(i,{command:"removeSource",args:[s]}),l[s]=!0}function Me(s,i,l,f){Q(s,l,f),X(s,i,l)}function Ze(s,i,l){let f;for(f in s[l])if(Object.prototype.hasOwnProperty.call(s[l],f)&&f!=="data"&&!it(s[l][f],i[l][f]))return!1;for(f in i[l])if(Object.prototype.hasOwnProperty.call(i[l],f)&&f!=="data"&&!it(s[l][f],i[l][f]))return!1;return!0}function dt(s,i,l,f,g,w){s=s||{},i=i||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(it(s[x],i[x])||l.push({command:w,args:[f,x,i[x],g]}));for(const x in i)Object.prototype.hasOwnProperty.call(i,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(it(s[x],i[x])||l.push({command:w,args:[f,x,i[x],g]}))}function st(s){return s.id}function Ci(s,i){return s[i.id]=i,s}class ft{constructor(i,l,f,g){this.message=(i?`${i}: `:"")+f,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function Wt(s,...i){for(const l of i)for(const f in l)s[f]=l[f];return s}class Ei extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Bi{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[f,g]of l)this.bindings[f]=g}concat(i){return new Bi(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Cn={kind:"null"},St={kind:"number"},ui={kind:"string"},ii={kind:"boolean"},sn={kind:"color"},_r={kind:"object"},ci={kind:"value"},yr={kind:"collator"},br={kind:"formatted"},Ar={kind:"padding"},Mr={kind:"resolvedImage"},Le={kind:"variableAnchorOffsetCollection"};function ie(s,i){return{kind:"array",itemType:s,N:i}}function ne(s){if(s.kind==="array"){const i=ne(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const me=[Cn,St,ui,ii,sn,br,_r,ie(ci),Ar,Mr,Le];function Se(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Se(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const l of me)if(!Se(l,i))return null}}return`Expected ${ne(s)} but found ${ne(i)} instead.`}function Ve(s,i){return i.some(l=>l.kind===s.kind)}function Ge(s,i){return i.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}function et(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const Be=.96422,ut=.82521,bt=4/29,rt=6/29,Et=3*rt*rt,Qt=rt*rt*rt,ri=Math.PI/180,ji=180/Math.PI;function wi(s){return(s%=360)<0&&(s+=360),s}function zi([s,i,l,f]){let g,w;const x=hn((.2225045*(s=Si(s))+.7168786*(i=Si(i))+.0606169*(l=Si(l)))/1);s===i&&i===l?g=w=x:(g=hn((.4360747*s+.3850649*i+.1430804*l)/Be),w=hn((.0139322*s+.0971045*i+.7141733*l)/ut));const I=116*x-16;return[I<0?0:I,500*(g-x),200*(x-w),f]}function Si(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function hn(s){return s>Qt?Math.pow(s,1/3):s/Et+bt}function fn([s,i,l,f]){let g=(s+16)/116,w=isNaN(i)?g:g+i/500,x=isNaN(l)?g:g-l/200;return g=1*pi(g),w=Be*pi(w),x=ut*pi(x),[Ke(3.1338561*w-1.6168667*g-.4906146*x),Ke(-.9787684*w+1.9161415*g+.033454*x),Ke(.0719453*w-.2289914*g+1.4052427*x),f]}function Ke(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function pi(s){return s>rt?s*s*s:Et*(s-bt)}function ki(s){return parseInt(s.padEnd(2,s),16)/255}function Ui(s,i){return Ki(i?s/100:s,0,1)}function Ki(s,i,l){return Math.min(Math.max(i,s),l)}function Ji(s){return!s.some(Number.isNaN)}const Un={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class si{constructor(i,l,f,g=1,w=!0){this.r=i,this.g=l,this.b=f,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,l,f,g]))}static parse(i){if(i instanceof si)return i;if(typeof i!="string")return;const l=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Un[f];if(g){const[x,I,P]=g;return[x/255,I/255,P/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let I=1;return[ki(f.slice(I,I+=x)),ki(f.slice(I,I+=x)),ki(f.slice(I,I+=x)),ki(f.slice(I,I+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[I,P,B,q,H,ee,re,ue,ge,Ee,ze,tt]=x,qe=[q||" ",re||" ",Ee].join("");if(qe==="  "||qe==="  /"||qe===",,"||qe===",,,"){const Qe=[B,ee,ge].join(""),ht=Qe==="%%%"?100:Qe===""?255:0;if(ht){const xt=[Ki(+P/ht,0,1),Ki(+H/ht,0,1),Ki(+ue/ht,0,1),ze?Ui(+ze,tt):1];if(Ji(xt))return xt}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,I,P,B,q,H,ee,re,ue]=w,ge=[P||" ",q||" ",ee].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const Ee=[+I,Ki(+B,0,100),Ki(+H,0,100),re?Ui(+re,ue):1];if(Ji(Ee))return function([ze,tt,qe,Qe]){function ht(xt){const jt=(xt+ze/30)%12,hi=tt*Math.min(qe,1-qe);return qe-hi*Math.max(-1,Math.min(jt-3,9-jt,1))}return ze=wi(ze),tt/=100,qe/=100,[ht(0),ht(8),ht(4),Qe]}(Ee)}}}(i);return l?new si(...l,!1):void 0}get rgb(){const{r:i,g:l,b:f,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[i/w,l/w,f/w,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[l,f,g,w]=zi(i),x=Math.sqrt(f*f+g*g);return[Math.round(1e4*x)?wi(Math.atan2(g,f)*ji):NaN,x,l,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zi(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){const[i,l,f,g]=this.rgb;return`rgba(${[i,l,f].map(w=>Math.round(255*w)).join(",")},${g})`}}si.black=new si(0,0,0,1),si.white=new si(1,1,1,1),si.transparent=new si(0,0,0,0),si.red=new si(1,0,0,1);class es{constructor(i,l,f){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hn{constructor(i,l,f,g,w){this.text=i,this.image=l,this.scale=f,this.fontStack=g,this.textColor=w}}class Vn{constructor(i){this.sections=i}static fromString(i){return new Vn([new Hn(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Vn?i:Vn.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class pn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof pn)return i;if(typeof i=="number")return new pn([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new pn(i)}}toString(){return JSON.stringify(this.values)}}const ba=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class zn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof zn)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){const f=i[l],g=i[l+1];if(typeof f!="string"||!ba.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new zn(i)}}toString(){return JSON.stringify(this.values)}}class Xn{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Xn({name:i,available:!1}):null}}function Ur(s,i,l,f){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,i,l,f]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rn(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof si||s instanceof es||s instanceof Vn||s instanceof pn||s instanceof zn||s instanceof Xn)return!0;if(Array.isArray(s)){for(const i of s)if(!Rn(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!Rn(s[i]))return!1;return!0}return!1}function Ii(s){if(s===null)return Cn;if(typeof s=="string")return ui;if(typeof s=="boolean")return ii;if(typeof s=="number")return St;if(s instanceof si)return sn;if(s instanceof es)return yr;if(s instanceof Vn)return br;if(s instanceof pn)return Ar;if(s instanceof zn)return Le;if(s instanceof Xn)return Mr;if(Array.isArray(s)){const i=s.length;let l;for(const f of s){const g=Ii(f);if(l){if(l===g)continue;l=ci;break}l=g}return ie(l||ci,i)}return _r}function No(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof si||s instanceof Vn||s instanceof pn||s instanceof zn||s instanceof Xn?s.toString():JSON.stringify(s)}class ar{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Rn(i[1]))return l.error("invalid value");const f=i[1];let g=Ii(f);const w=l.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new ar(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class En{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const va={string:ui,number:St,boolean:ii,object:_r};class Vr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let f,g=1;const w=i[0];if(w==="array"){let I,P;if(i.length>2){const B=i[1];if(typeof B!="string"||!(B in va)||B==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);I=va[B],g++}else I=ci;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);P=i[2],g++}f=ie(I,P)}else{if(!va[w])throw new Error(`Types doesn't contain name = ${w}`);f=va[w]}const x=[];for(;g<i.length;g++){const I=l.parse(i[g],g,ci);if(!I)return null;x.push(I)}return new Vr(f,x)}evaluate(i){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(i);if(!Se(this.type,Ii(f)))return f;if(l===this.args.length-1)throw new En(`Expected value to be of type ${ne(this.type)}, but found ${ne(Ii(f))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ll={"to-boolean":ii,"to-color":sn,"to-number":St,"to-string":ui};class qr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const f=i[0];if(!ll[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&i.length!==2)return l.error("Expected one argument.");const g=ll[f],w=[];for(let x=1;x<i.length;x++){const I=l.parse(i[x],x,ci);if(!I)return null;w.push(I)}return new qr(g,w)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,f;for(const g of this.args){if(l=g.evaluate(i),f=null,l instanceof si)return l;if(typeof l=="string"){const w=i.parseColor(l);if(w)return w}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Ur(l[0],l[1],l[2],l[3]),!f))return new si(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new En(f||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const f of this.args){l=f.evaluate(i);const g=pn.parse(l);if(g)return g}throw new En(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const f of this.args){l=f.evaluate(i);const g=zn.parse(l);if(g)return g}throw new En(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const f of this.args){if(l=f.evaluate(i),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new En(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Vn.fromString(No(this.args[0].evaluate(i)));case"resolvedImage":return Xn.fromString(No(this.args[0].evaluate(i)));default:return No(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ou=["Unknown","Point","LineString","Polygon"];class wa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ou[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=si.parse(i)),l}}class Xs{constructor(i,l,f=[],g,w=new Bi,x=[]){this.registry=i,this.path=f,this.key=f.map(I=>`[${I}]`).join(""),this.scope=w,this.errors=x,this.expectedType=g,this._isConstant=l}parse(i,l,f,g,w={}){return l?this.concat(l,f,g)._parse(i,w):this._parse(i,w)}_parse(i,l){function f(g,w,x){return x==="assert"?new Vr(w,[g]):x==="coerce"?new qr(w,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let x=w.parse(i,this);if(!x)return null;if(this.expectedType){const I=this.expectedType,P=x.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||P.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(I.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(I,P))return null}else x=f(x,I,l.typeAnnotation||"coerce");else x=f(x,I,l.typeAnnotation||"coerce");else x=f(x,I,l.typeAnnotation||"coerce");else x=f(x,I,l.typeAnnotation||"assert")}if(!(x instanceof ar)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const I=new wa;try{x=new ar(x.type,x.evaluate(I))}catch(P){return this.error(P.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,f){const g=typeof i=="number"?this.path.concat(i):this.path,w=f?this.scope.concat(f):this.scope;return new Xs(this.registry,this._isConstant,g,l||null,w,this.errors)}error(i,...l){const f=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ei(f,i))}checkSubtype(i,l){const f=Se(i,l);return f&&this.error(f),f}}class Bn{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let w=1;w<i.length-1;w+=2){const x=i[w];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",w);const I=l.parse(i[w+1],w+1);if(!I)return null;f.push([x,I])}const g=l.parse(i[i.length-1],i.length-1,l.expectedType,f);return g?new Bn(f,g):null}outputDefined(){return this.result.outputDefined()}}class Gi{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const f=i[1];return l.scope.has(f)?new Gi(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class xa{constructor(i,l,f){this.type=i,this.index=l,this.input=f}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,St),g=l.parse(i[2],2,ie(l.expectedType||ci));return f&&g?new xa(g.type.itemType,f,g):null}evaluate(i){const l=this.index.evaluate(i),f=this.input.evaluate(i);if(l<0)throw new En(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new En(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new En(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class ka{constructor(i,l){this.type=ii,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,ci),g=l.parse(i[2],2,ci);return f&&g?Ve(f.type,[ii,ui,St,Cn,ci])?new ka(f,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(f.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!Ge(l,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${ne(Ii(l))} instead.`);if(!Ge(f,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${ne(Ii(f))} instead.`);return f.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class po{constructor(i,l,f){this.type=St,this.needle=i,this.haystack=l,this.fromIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,ci),g=l.parse(i[2],2,ci);if(!f||!g)return null;if(!Ve(f.type,[ii,ui,St,Cn,ci]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(f.type)} instead`);if(i.length===4){const w=l.parse(i[3],3,St);return w?new po(f,g,w):null}return new po(f,g)}evaluate(i){const l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!Ge(l,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${ne(Ii(l))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(i)),Ge(f,["string"])){const w=f.indexOf(l,g);return w===-1?-1:[...f.slice(0,w)].length}if(Ge(f,["array"]))return f.indexOf(l,g);throw new En(`Expected second argument to be of type array or string, but found ${ne(Ii(f))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class cl{constructor(i,l,f,g,w,x){this.inputType=i,this.type=l,this.input=f,this.cases=g,this.outputs=w,this.otherwise=x}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let f,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const w={},x=[];for(let B=2;B<i.length-1;B+=2){let q=i[B];const H=i[B+1];Array.isArray(q)||(q=[q]);const ee=l.concat(B);if(q.length===0)return ee.error("Expected at least one branch label.");for(const ue of q){if(typeof ue!="number"&&typeof ue!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ue=="number"&&Math.floor(ue)!==ue)return ee.error("Numeric branch labels must be integer values.");if(f){if(ee.checkSubtype(f,Ii(ue)))return null}else f=Ii(ue);if(w[String(ue)]!==void 0)return ee.error("Branch labels must be unique.");w[String(ue)]=x.length}const re=l.parse(H,B,g);if(!re)return null;g=g||re.type,x.push(re)}const I=l.parse(i[1],1,ci);if(!I)return null;const P=l.parse(i[i.length-1],i.length-1,g);return P?I.type.kind!=="value"&&l.concat(1).checkSubtype(f,I.type)?null:new cl(f,g,I,w,x,P):null}evaluate(i){const l=this.input.evaluate(i);return(Ii(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class jo{constructor(i,l,f){this.type=i,this.branches=l,this.otherwise=f}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);const g=[];for(let x=1;x<i.length-1;x+=2){const I=l.parse(i[x],x,ii);if(!I)return null;const P=l.parse(i[x+1],x+1,f);if(!P)return null;g.push([I,P]),f=f||P.type}const w=l.parse(i[i.length-1],i.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new jo(f,g,w)}evaluate(i){for(const[l,f]of this.branches)if(l.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,f]of this.branches)i(l),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Ms{constructor(i,l,f,g){this.type=i,this.input=l,this.beginIndex=f,this.endIndex=g}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,ci),g=l.parse(i[2],2,St);if(!f||!g)return null;if(!Ve(f.type,[ie(ci),ui,ci]))return l.error(`Expected first argument to be of type array or string, but found ${ne(f.type)} instead`);if(i.length===4){const w=l.parse(i[3],3,St);return w?new Ms(f.type,f,g,w):null}return new Ms(f.type,f,g)}evaluate(i){const l=this.input.evaluate(i),f=this.beginIndex.evaluate(i);let g;if(this.endIndex&&(g=this.endIndex.evaluate(i)),Ge(l,["string"]))return[...l].slice(f,g).join("");if(Ge(l,["array"]))return l.slice(f,g);throw new En(`Expected first argument to be of type array or string, but found ${ne(Ii(l))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function Sa(s,i){const l=s.length-1;let f,g,w=0,x=l,I=0;for(;w<=x;)if(I=Math.floor((w+x)/2),f=s[I],g=s[I+1],f<=i){if(I===l||i<g)return I;w=I+1}else{if(!(f>i))throw new En("Input is not a number.");x=I-1}return 0}class mo{constructor(i,l,f){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[g,w]of f)this.labels.push(g),this.outputs.push(w)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(i[1],1,St);if(!f)return null;const g=[];let w=null;l.expectedType&&l.expectedType.kind!=="value"&&(w=l.expectedType);for(let x=1;x<i.length;x+=2){const I=x===1?-1/0:i[x],P=i[x+1],B=x,q=x+1;if(typeof I!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(g.length&&g[g.length-1][0]>=I)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const H=l.parse(P,q,w);if(!H)return null;w=w||H.type,g.push([I,H])}return new mo(w,f,g)}evaluate(i){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return f[0].evaluate(i);const w=l.length;return g>=l[w-1]?f[w-1].evaluate(i):f[Sa(l,g)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function ul(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var au=Kl;function Kl(s,i,l,f){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=f}Kl.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,f=0;f<8;f++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var w=this.sampleCurveDerivativeX(l);if(Math.abs(w)<1e-6)break;l-=g/w}var x=0,I=1;for(l=s,f=0;f<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));f++)s>g?x=l:I=l,l=.5*(I-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Jl=ul(au);function Ps(s,i,l){return s+l*(i-s)}function go(s,i,l){return s.map((f,g)=>Ps(f,i[g],l))}const qn={number:Ps,color:function(s,i,l,f="rgb"){switch(f){case"rgb":{const[g,w,x,I]=go(s.rgb,i.rgb,l);return new si(g,w,x,I,!1)}case"hcl":{const[g,w,x,I]=s.hcl,[P,B,q,H]=i.hcl;let ee,re;if(isNaN(g)||isNaN(P))isNaN(g)?isNaN(P)?ee=NaN:(ee=P,x!==1&&x!==0||(re=B)):(ee=g,q!==1&&q!==0||(re=w));else{let tt=P-g;P>g&&tt>180?tt-=360:P<g&&g-P>180&&(tt+=360),ee=g+l*tt}const[ue,ge,Ee,ze]=function([tt,qe,Qe,ht]){return tt=isNaN(tt)?0:tt*ri,fn([Qe,Math.cos(tt)*qe,Math.sin(tt)*qe,ht])}([ee,re??Ps(w,B,l),Ps(x,q,l),Ps(I,H,l)]);return new si(ue,ge,Ee,ze,!1)}case"lab":{const[g,w,x,I]=fn(go(s.lab,i.lab,l));return new si(g,w,x,I,!1)}}},array:go,padding:function(s,i,l){return new pn(go(s.values,i.values,l))},variableAnchorOffsetCollection:function(s,i,l){const f=s.values,g=i.values;if(f.length!==g.length)throw new En(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const w=[];for(let x=0;x<f.length;x+=2){if(f[x]!==g[x])throw new En(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${f[x]}, to[${x}]: ${g[x]}`);w.push(f[x]);const[I,P]=f[x+1],[B,q]=g[x+1];w.push([Ps(I,B,l),Ps(P,q,l)])}return new zn(w)}};class tr{constructor(i,l,f,g,w){this.type=i,this.operator=l,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[x,I]of w)this.labels.push(x),this.outputs.push(I)}static interpolationFactor(i,l,f,g){let w=0;if(i.name==="exponential")w=_o(l,i.base,f,g);else if(i.name==="linear")w=_o(l,1,f,g);else if(i.name==="cubic-bezier"){const x=i.controlPoints;w=new Jl(x[0],x[1],x[2],x[3]).solve(_o(l,1,f,g))}return w}static parse(i,l){let[f,g,w,...x]=i;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const B=g[1];if(typeof B!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:B}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const B=g.slice(1);if(B.length!==4||B.some(q=>typeof q!="number"||q<0||q>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:B}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(w=l.parse(w,2,St),!w)return null;const I=[];let P=null;f==="interpolate-hcl"||f==="interpolate-lab"?P=sn:l.expectedType&&l.expectedType.kind!=="value"&&(P=l.expectedType);for(let B=0;B<x.length;B+=2){const q=x[B],H=x[B+1],ee=B+3,re=B+4;if(typeof q!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(I.length&&I[I.length-1][0]>=q)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const ue=l.parse(H,re,P);if(!ue)return null;P=P||ue.type,I.push([q,ue])}return et(P,St)||et(P,sn)||et(P,Ar)||et(P,Le)||et(P,ie(St))?new tr(P,f,g,w,I):l.error(`Type ${ne(P)} is not interpolatable.`)}evaluate(i){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return f[0].evaluate(i);const w=l.length;if(g>=l[w-1])return f[w-1].evaluate(i);const x=Sa(l,g),I=tr.interpolationFactor(this.interpolation,g,l[x],l[x+1]),P=f[x].evaluate(i),B=f[x+1].evaluate(i);switch(this.operator){case"interpolate":return qn[this.type.kind](P,B,I);case"interpolate-hcl":return qn.color(P,B,I,"hcl");case"interpolate-lab":return qn.color(P,B,I,"lab")}}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function _o(s,i,l,f){const g=f-l,w=s-l;return g===0?0:i===1?w/g:(Math.pow(i,w)-1)/(Math.pow(i,g)-1)}class ir{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let f=null;const g=l.expectedType;g&&g.kind!=="value"&&(f=g);const w=[];for(const I of i.slice(1)){const P=l.parse(I,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!P)return null;f=f||P.type,w.push(P)}if(!f)throw new Error("No output type");const x=g&&w.some(I=>Se(g,I.type));return new ir(x?ci:f,w)}evaluate(i){let l,f=null,g=0;for(const w of this.args)if(g++,f=w.evaluate(i),f&&f instanceof Xn&&!f.available&&(l||(l=f.name),f=null,g===this.args.length&&(f=l)),f!==null)break;return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function Ta(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Yl(s,i,l,f){return f.compare(i,l)===0}function Ks(s,i,l){const f=s!=="=="&&s!=="!=";return class K0{constructor(w,x,I){this.type=ii,this.lhs=w,this.rhs=x,this.collator=I,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const I=w[0];let P=x.parse(w[1],1,ci);if(!P)return null;if(!Ta(I,P.type))return x.concat(1).error(`"${I}" comparisons are not supported for type '${ne(P.type)}'.`);let B=x.parse(w[2],2,ci);if(!B)return null;if(!Ta(I,B.type))return x.concat(2).error(`"${I}" comparisons are not supported for type '${ne(B.type)}'.`);if(P.type.kind!==B.type.kind&&P.type.kind!=="value"&&B.type.kind!=="value")return x.error(`Cannot compare types '${ne(P.type)}' and '${ne(B.type)}'.`);f&&(P.type.kind==="value"&&B.type.kind!=="value"?P=new Vr(B.type,[P]):P.type.kind!=="value"&&B.type.kind==="value"&&(B=new Vr(P.type,[B])));let q=null;if(w.length===4){if(P.type.kind!=="string"&&B.type.kind!=="string"&&P.type.kind!=="value"&&B.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(q=x.parse(w[3],3,yr),!q)return null}return new K0(P,B,q)}evaluate(w){const x=this.lhs.evaluate(w),I=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const P=Ii(x),B=Ii(I);if(P.kind!==B.kind||P.kind!=="string"&&P.kind!=="number")throw new En(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${P.kind}, ${B.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const P=Ii(x),B=Ii(I);if(P.kind!=="string"||B.kind!=="string")return i(w,x,I)}return this.collator?l(w,x,I,this.collator.evaluate(w)):i(w,x,I)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Ql=Ks("==",function(s,i,l){return i===l},Yl),$l=Ks("!=",function(s,i,l){return i!==l},function(s,i,l,f){return!Yl(0,i,l,f)}),ec=Ks("<",function(s,i,l){return i<l},function(s,i,l,f){return f.compare(i,l)<0}),lu=Ks(">",function(s,i,l){return i>l},function(s,i,l,f){return f.compare(i,l)>0}),cu=Ks("<=",function(s,i,l){return i<=l},function(s,i,l,f){return f.compare(i,l)<=0}),tc=Ks(">=",function(s,i,l){return i>=l},function(s,i,l,f){return f.compare(i,l)>=0});class Uo{constructor(i,l,f){this.type=yr,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const f=i[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");const g=l.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,ii);if(!g)return null;const w=l.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,ii);if(!w)return null;let x=null;return f.locale&&(x=l.parse(f.locale,1,ui),!x)?null:new Uo(g,w,x)}evaluate(i){return new es(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class Ca{constructor(i,l,f,g,w){this.type=ui,this.number=i,this.locale=l,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const f=l.parse(i[1],1,St);if(!f)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=l.parse(g.locale,1,ui),!w))return null;let x=null;if(g.currency&&(x=l.parse(g.currency,1,ui),!x))return null;let I=null;if(g["min-fraction-digits"]&&(I=l.parse(g["min-fraction-digits"],1,St),!I))return null;let P=null;return g["max-fraction-digits"]&&(P=l.parse(g["max-fraction-digits"],1,St),!P)?null:new Ca(f,w,x,I,P)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Vo{constructor(i){this.type=br,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");const g=[];let w=!1;for(let x=1;x<=i.length-1;++x){const I=i[x];if(w&&typeof I=="object"&&!Array.isArray(I)){w=!1;let P=null;if(I["font-scale"]&&(P=l.parse(I["font-scale"],1,St),!P))return null;let B=null;if(I["text-font"]&&(B=l.parse(I["text-font"],1,ie(ui)),!B))return null;let q=null;if(I["text-color"]&&(q=l.parse(I["text-color"],1,sn),!q))return null;const H=g[g.length-1];H.scale=P,H.font=B,H.textColor=q}else{const P=l.parse(i[x],1,ci);if(!P)return null;const B=P.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:P,scale:null,font:null,textColor:null})}}return new Vo(g)}evaluate(i){return new Vn(this.sections.map(l=>{const f=l.content.evaluate(i);return Ii(f)===Mr?new Hn("",f,null,null,null):new Hn(No(f),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}}class qo{constructor(i){this.type=Mr,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const f=l.parse(i[1],1,ui);return f?new qo(f):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),f=Xn.fromString(l);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(l)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}}class hl{constructor(i){this.type=St,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=l.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${ne(f.type)} instead.`):new hl(f):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new En(`Expected value to be of type string or array, but found ${ne(Ii(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const ts=8192;function Js(s,i){const l=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(l*g*ts),Math.round(f*g*ts)]}function Zr(s,i){const l=Math.pow(2,i.z);return[(g=(s[0]/ts+i.x)/l,360*g-180),(f=(s[1]/ts+i.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,g}function Ls(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function zs(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Xi(s,i,l){const f=s[0]-i[0],g=s[1]-i[1],w=s[0]-l[0],x=s[1]-l[1];return f*x-w*g==0&&f*w<=0&&g*x<=0}function Zo(s,i,l,f){return(g=[f[0]-l[0],f[1]-l[1]])[0]*(w=[i[0]-s[0],i[1]-s[1]])[1]-g[1]*w[0]!=0&&!(!fl(s,i,l,f)||!fl(l,f,s,i));var g,w}function ic(s,i,l){for(const f of l)for(let g=0;g<f.length-1;++g)if(Zo(s,i,f[g],f[g+1]))return!0;return!1}function Ys(s,i,l=!1){let f=!1;for(const I of i)for(let P=0;P<I.length-1;P++){if(Xi(s,I[P],I[P+1]))return l;(w=I[P])[1]>(g=s)[1]!=(x=I[P+1])[1]>g[1]&&g[0]<(x[0]-w[0])*(g[1]-w[1])/(x[1]-w[1])+w[0]&&(f=!f)}var g,w,x;return f}function uu(s,i){for(const l of i)if(Ys(s,l))return!0;return!1}function nc(s,i){for(const l of s)if(!Ys(l,i))return!1;for(let l=0;l<s.length-1;++l)if(ic(s[l],s[l+1],i))return!1;return!0}function hu(s,i){for(const l of i)if(nc(s,l))return!0;return!1}function fl(s,i,l,f){const g=f[0]-l[0],w=f[1]-l[1],x=(s[0]-l[0])*w-g*(s[1]-l[1]),I=(i[0]-l[0])*w-g*(i[1]-l[1]);return x>0&&I<0||x<0&&I>0}function Ea(s,i,l){const f=[];for(let g=0;g<s.length;g++){const w=[];for(let x=0;x<s[g].length;x++){const I=Js(s[g][x],l);Ls(i,I),w.push(I)}f.push(w)}return f}function rc(s,i,l){const f=[];for(let g=0;g<s.length;g++){const w=Ea(s[g],i,l);f.push(w)}return f}function sc(s,i,l,f){if(s[0]<l[0]||s[0]>l[2]){const g=.5*f;let w=s[0]-l[0]>g?-f:l[0]-s[0]>g?f:0;w===0&&(w=s[0]-l[2]>g?-f:l[2]-s[0]>g?f:0),s[0]+=w}Ls(i,s)}function oc(s,i,l,f){const g=Math.pow(2,f.z)*ts,w=[f.x*ts,f.y*ts],x=[];for(const I of s)for(const P of I){const B=[P.x+w[0],P.y+w[1]];sc(B,i,l,g),x.push(B)}return x}function ac(s,i,l,f){const g=Math.pow(2,f.z)*ts,w=[f.x*ts,f.y*ts],x=[];for(const P of s){const B=[];for(const q of P){const H=[q.x+w[0],q.y+w[1]];Ls(i,H),B.push(H)}x.push(B)}if(i[2]-i[0]<=g/2){(I=i)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const P of x)for(const B of P)sc(B,i,l,g)}var I;return x}class Qs{constructor(i,l){this.type=ii,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Rn(i[1])){const f=i[1];if(f.type==="FeatureCollection"){const g=[];for(const w of f.features){const{type:x,coordinates:I}=w.geometry;x==="Polygon"&&g.push(I),x==="MultiPolygon"&&g.push(...I)}if(g.length)return new Qs(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Qs(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Qs(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(f.type==="Polygon"){const I=Ea(f.coordinates,w,x),P=oc(l.geometry(),g,w,x);if(!zs(g,w))return!1;for(const B of P)if(!Ys(B,I))return!1}if(f.type==="MultiPolygon"){const I=rc(f.coordinates,w,x),P=oc(l.geometry(),g,w,x);if(!zs(g,w))return!1;for(const B of P)if(!uu(B,I))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(f.type==="Polygon"){const I=Ea(f.coordinates,w,x),P=ac(l.geometry(),g,w,x);if(!zs(g,w))return!1;for(const B of P)if(!nc(B,I))return!1}if(f.type==="MultiPolygon"){const I=rc(f.coordinates,w,x),P=ac(l.geometry(),g,w,x);if(!zs(g,w))return!1;for(const B of P)if(!hu(B,I))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let is=class{constructor(s=[],i=(l,f)=>l<f?-1:l>f?1:0){if(this.data=s,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:i,compare:l}=this,f=i[s];for(;s>0;){const g=s-1>>1,w=i[g];if(l(f,w)>=0)break;i[s]=w,s=g}i[s]=f}_down(s){const{data:i,compare:l}=this,f=this.length>>1,g=i[s];for(;s<f;){let w=1+(s<<1);const x=w+1;if(x<this.length&&l(i[x],i[w])<0&&(w=x),l(i[w],g)>=0)break;i[s]=i[w],s=w}i[s]=g}};function lc(s,i,l,f,g){cc(s,i,l,f||s.length-1,g||fu)}function cc(s,i,l,f,g){for(;f>l;){if(f-l>600){var w=f-l+1,x=i-l+1,I=Math.log(w),P=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*P*(w-P)/w)*(x-w/2<0?-1:1);cc(s,i,Math.max(l,Math.floor(i-x*P/w+B)),Math.min(f,Math.floor(i+(w-x)*P/w+B)),g)}var q=s[i],H=l,ee=f;for(Wo(s,l,i),g(s[f],q)>0&&Wo(s,l,f);H<ee;){for(Wo(s,H,ee),H++,ee--;g(s[H],q)<0;)H++;for(;g(s[ee],q)>0;)ee--}g(s[l],q)===0?Wo(s,l,ee):Wo(s,++ee,f),ee<=i&&(l=ee+1),i<=ee&&(f=ee-1)}}function Wo(s,i,l){var f=s[i];s[i]=s[l],s[l]=f}function fu(s,i){return s<i?-1:s>i?1:0}function Ia(s,i){if(s.length<=1)return[s];const l=[];let f,g;for(const w of s){const x=pu(w);x!==0&&(w.area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(f&&l.push(f),f=[w]):f.push(w))}if(f&&l.push(f),i>1)for(let w=0;w<l.length;w++)l[w].length<=i||(lc(l[w],i,1,l[w].length-1,du),l[w]=l[w].slice(0,i));return l}function du(s,i){return i.area-s.area}function pu(s){let i=0;for(let l,f,g=0,w=s.length,x=w-1;g<w;x=g++)l=s[g],f=s[x],i+=(f.x-l.x)*(l.y+f.y);return i}const uc=1/298.257223563,hc=uc*(2-uc),Aa=Math.PI/180;class yo{constructor(i){const l=6378.137*Aa*1e3,f=Math.cos(i*Aa),g=1/(1-hc*(1-f*f)),w=Math.sqrt(g);this.kx=l*w*f,this.ky=l*w*g*(1-hc)}distance(i,l){const f=this.wrap(i[0]-l[0])*this.kx,g=(i[1]-l[1])*this.ky;return Math.sqrt(f*f+g*g)}pointOnLine(i,l){let f,g,w,x,I=1/0;for(let P=0;P<i.length-1;P++){let B=i[P][0],q=i[P][1],H=this.wrap(i[P+1][0]-B)*this.kx,ee=(i[P+1][1]-q)*this.ky,re=0;H===0&&ee===0||(re=(this.wrap(l[0]-B)*this.kx*H+(l[1]-q)*this.ky*ee)/(H*H+ee*ee),re>1?(B=i[P+1][0],q=i[P+1][1]):re>0&&(B+=H/this.kx*re,q+=ee/this.ky*re)),H=this.wrap(l[0]-B)*this.kx,ee=(l[1]-q)*this.ky;const ue=H*H+ee*ee;ue<I&&(I=ue,f=B,g=q,w=P,x=re)}return{point:[f,g],index:w,t:Math.max(0,Math.min(1,x))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function fc(s,i){return i[0]-s[0]}function Go(s){return s[1]-s[0]+1}function ns(s,i){return s[1]>=s[0]&&s[1]<i}function $s(s,i){if(s[0]>s[1])return[null,null];const l=Go(s);if(i){if(l===2)return[s,null];const g=Math.floor(l/2);return[[s[0],s[0]+g],[s[0]+g,s[1]]]}if(l===1)return[s,null];const f=Math.floor(l/2)-1;return[[s[0],s[0]+f],[s[0]+f+1,s[1]]]}function Ho(s,i){if(!ns(i,s.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let f=i[0];f<=i[1];++f)Ls(l,s[f]);return l}function Xo(s){const i=[1/0,1/0,-1/0,-1/0];for(const l of s)for(const f of l)Ls(i,f);return i}function Ma(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function dl(s,i,l){if(!Ma(s)||!Ma(i))return NaN;let f=0,g=0;return s[2]<i[0]&&(f=i[0]-s[2]),s[0]>i[2]&&(f=s[0]-i[2]),s[1]>i[3]&&(g=s[1]-i[3]),s[3]<i[1]&&(g=i[1]-s[3]),l.distance([0,0],[f,g])}function eo(s,i,l){const f=l.pointOnLine(i,s);return l.distance(s,f.point)}function ms(s,i,l,f,g){const w=Math.min(eo(s,[l,f],g),eo(i,[l,f],g)),x=Math.min(eo(l,[s,i],g),eo(f,[s,i],g));return Math.min(w,x)}function mu(s,i,l,f,g){if(!ns(i,s.length)||!ns(f,l.length))return 1/0;let w=1/0;for(let x=i[0];x<i[1];++x){const I=s[x],P=s[x+1];for(let B=f[0];B<f[1];++B){const q=l[B],H=l[B+1];if(Zo(I,P,q,H))return 0;w=Math.min(w,ms(I,P,q,H,g))}}return w}function Tn(s,i,l,f,g){if(!ns(i,s.length)||!ns(f,l.length))return NaN;let w=1/0;for(let x=i[0];x<=i[1];++x)for(let I=f[0];I<=f[1];++I)if(w=Math.min(w,g.distance(s[x],l[I])),w===0)return w;return w}function gu(s,i,l){if(Ys(s,i,!0))return 0;let f=1/0;for(const g of i){const w=g[0],x=g[g.length-1];if(w!==x&&(f=Math.min(f,eo(s,[x,w],l)),f===0))return f;const I=l.pointOnLine(g,s);if(f=Math.min(f,l.distance(s,I.point)),f===0)return f}return f}function Li(s,i,l,f){if(!ns(i,s.length))return NaN;for(let w=i[0];w<=i[1];++w)if(Ys(s[w],l,!0))return 0;let g=1/0;for(let w=i[0];w<i[1];++w){const x=s[w],I=s[w+1];for(const P of l)for(let B=0,q=P.length,H=q-1;B<q;H=B++){const ee=P[H],re=P[B];if(Zo(x,I,ee,re))return 0;g=Math.min(g,ms(x,I,ee,re,f))}}return g}function to(s,i){for(const l of s)for(const f of l)if(Ys(f,i,!0))return!0;return!1}function $i(s,i,l,f=1/0){const g=Xo(s),w=Xo(i);if(f!==1/0&&dl(g,w,l)>=f)return f;if(zs(g,w)){if(to(s,i))return 0}else if(to(i,s))return 0;let x=1/0;for(const I of s)for(let P=0,B=I.length,q=B-1;P<B;q=P++){const H=I[q],ee=I[P];for(const re of i)for(let ue=0,ge=re.length,Ee=ge-1;ue<ge;Ee=ue++){const ze=re[Ee],tt=re[ue];if(Zo(H,ee,ze,tt))return 0;x=Math.min(x,ms(H,ee,ze,tt,l))}}return x}function en(s,i,l,f,g,w){if(!w)return;const x=dl(Ho(f,w),g,l);x<i&&s.push([x,w,[0,0]])}function Os(s,i,l,f,g,w,x){if(!w||!x)return;const I=dl(Ho(f,w),Ho(g,x),l);I<i&&s.push([I,w,x])}function Ko(s,i,l,f,g=1/0){let w=Math.min(f.distance(s[0],l[0][0]),g);if(w===0)return w;const x=new is([[0,[0,s.length-1],[0,0]]],fc),I=Xo(l);for(;x.length>0;){const P=x.pop();if(P[0]>=w)continue;const B=P[1],q=i?50:100;if(Go(B)<=q){if(!ns(B,s.length))return NaN;if(i){const H=Li(s,B,l,f);if(isNaN(H)||H===0)return H;w=Math.min(w,H)}else for(let H=B[0];H<=B[1];++H){const ee=gu(s[H],l,f);if(w=Math.min(w,ee),w===0)return 0}}else{const H=$s(B,i);en(x,w,f,s,I,H[0]),en(x,w,f,s,I,H[1])}}return w}function rs(s,i,l,f,g,w=1/0){let x=Math.min(w,g.distance(s[0],l[0]));if(x===0)return x;const I=new is([[0,[0,s.length-1],[0,l.length-1]]],fc);for(;I.length>0;){const P=I.pop();if(P[0]>=x)continue;const B=P[1],q=P[2],H=i?50:100,ee=f?50:100;if(Go(B)<=H&&Go(q)<=ee){if(!ns(B,s.length)&&ns(q,l.length))return NaN;let re;if(i&&f)re=mu(s,B,l,q,g),x=Math.min(x,re);else if(i&&!f){const ue=s.slice(B[0],B[1]+1);for(let ge=q[0];ge<=q[1];++ge)if(re=eo(l[ge],ue,g),x=Math.min(x,re),x===0)return x}else if(!i&&f){const ue=l.slice(q[0],q[1]+1);for(let ge=B[0];ge<=B[1];++ge)if(re=eo(s[ge],ue,g),x=Math.min(x,re),x===0)return x}else re=Tn(s,B,l,q,g),x=Math.min(x,re)}else{const re=$s(B,i),ue=$s(q,f);Os(I,x,g,s,l,re[0],ue[0]),Os(I,x,g,s,l,re[0],ue[1]),Os(I,x,g,s,l,re[1],ue[0]),Os(I,x,g,s,l,re[1],ue[1])}}return x}function Jo(s){return s.type==="MultiPolygon"?s.coordinates.map(i=>({type:"Polygon",coordinates:i})):s.type==="MultiLineString"?s.coordinates.map(i=>({type:"LineString",coordinates:i})):s.type==="MultiPoint"?s.coordinates.map(i=>({type:"Point",coordinates:i})):[s]}class Ds{constructor(i,l){this.type=St,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Rn(i[1])){const f=i[1];if(f.type==="FeatureCollection")return new Ds(f,f.features.map(g=>Jo(g.geometry)).flat());if(f.type==="Feature")return new Ds(f,Jo(f.geometry));if("type"in f&&"coordinates"in f)return new Ds(f,Jo(f))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,f){const g=l.geometry(),w=g.flat().map(P=>Zr([P.x,P.y],l.canonical));if(g.length===0)return NaN;const x=new yo(w[0][1]);let I=1/0;for(const P of f){switch(P.type){case"Point":I=Math.min(I,rs(w,!1,[P.coordinates],!1,x,I));break;case"LineString":I=Math.min(I,rs(w,!1,P.coordinates,!0,x,I));break;case"Polygon":I=Math.min(I,Ko(w,!1,P.coordinates,x,I))}if(I===0)return I}return I}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,f){const g=l.geometry(),w=g.flat().map(P=>Zr([P.x,P.y],l.canonical));if(g.length===0)return NaN;const x=new yo(w[0][1]);let I=1/0;for(const P of f){switch(P.type){case"Point":I=Math.min(I,rs(w,!0,[P.coordinates],!1,x,I));break;case"LineString":I=Math.min(I,rs(w,!0,P.coordinates,!0,x,I));break;case"Polygon":I=Math.min(I,Ko(w,!0,P.coordinates,x,I))}if(I===0)return I}return I}(i,this.geometries);if(i.geometryType()==="Polygon")return function(l,f){const g=l.geometry();if(g.length===0||g[0].length===0)return NaN;const w=Ia(g,0).map(P=>P.map(B=>B.map(q=>Zr([q.x,q.y],l.canonical)))),x=new yo(w[0][0][0][1]);let I=1/0;for(const P of f)for(const B of w){switch(P.type){case"Point":I=Math.min(I,Ko([P.coordinates],!1,B,x,I));break;case"LineString":I=Math.min(I,Ko(P.coordinates,!0,B,x,I));break;case"Polygon":I=Math.min(I,$i(B,P.coordinates,x,I))}if(I===0)return I}return I}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const bo={"==":Ql,"!=":$l,">":lu,"<":ec,">=":tc,"<=":cu,array:Vr,at:xa,boolean:Vr,case:jo,coalesce:ir,collator:Uo,format:Vo,image:qo,in:ka,"index-of":po,interpolate:tr,"interpolate-hcl":tr,"interpolate-lab":tr,length:hl,let:Bn,literal:ar,match:cl,number:Vr,"number-format":Ca,object:Vr,slice:Ms,step:mo,string:Vr,"to-boolean":qr,"to-color":qr,"to-number":qr,"to-string":qr,var:Gi,within:Qs,distance:Ds};class Pr{constructor(i,l,f,g){this.name=i,this.type=l,this._evaluate=f,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const f=i[0],g=Pr.definitions[f];if(!g)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,I=x.filter(([B])=>!Array.isArray(B)||B.length===i.length-1);let P=null;for(const[B,q]of I){P=new Xs(l.registry,Yo,l.path,null,l.scope);const H=[];let ee=!1;for(let re=1;re<i.length;re++){const ue=i[re],ge=Array.isArray(B)?B[re-1]:B.type,Ee=P.parse(ue,1+H.length,ge);if(!Ee){ee=!0;break}H.push(Ee)}if(!ee)if(Array.isArray(B)&&B.length!==H.length)P.error(`Expected ${B.length} arguments, but found ${H.length} instead.`);else{for(let re=0;re<H.length;re++){const ue=Array.isArray(B)?B[re]:B.type,ge=H[re];P.concat(re+1).checkSubtype(ue,ge.type)}if(P.errors.length===0)return new Pr(f,w,q,H)}}if(I.length===1)l.errors.push(...P.errors);else{const B=(I.length?I:x).map(([H])=>{return ee=H,Array.isArray(ee)?`(${ee.map(ne).join(", ")})`:`(${ne(ee.type)}...)`;var ee}).join(" | "),q=[];for(let H=1;H<i.length;H++){const ee=l.parse(i[H],1+q.length);if(!ee)return null;q.push(ne(ee.type))}l.error(`Expected arguments of type ${B}, but found (${q.join(", ")}) instead.`)}return null}static register(i,l){Pr.definitions=l;for(const f in l)i[f]=Pr}}function pl(s,[i,l,f,g]){i=i.evaluate(s),l=l.evaluate(s),f=f.evaluate(s);const w=g?g.evaluate(s):1,x=Ur(i,l,f,w);if(x)throw new En(x);return new si(i/255,l/255,f/255,w,!1)}function io(s,i){return s in i}function gs(s,i){const l=i[s];return l===void 0?null:l}function no(s){return{type:s}}function Yo(s){if(s instanceof Gi)return Yo(s.boundExpression);if(s instanceof Pr&&s.name==="error"||s instanceof Uo||s instanceof Qs||s instanceof Ds)return!1;const i=s instanceof qr||s instanceof Vr;let l=!0;return s.eachChild(f=>{l=i?l&&Yo(f):l&&f instanceof ar}),!!l&&Qo(s)&&$o(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Qo(s){if(s instanceof Pr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Qs||s instanceof Ds)return!1;let i=!0;return s.eachChild(l=>{i&&!Qo(l)&&(i=!1)}),i}function vo(s){if(s instanceof Pr&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(l=>{i&&!vo(l)&&(i=!1)}),i}function $o(s,i){if(s instanceof Pr&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(f=>{l&&!$o(f,i)&&(l=!1)}),l}function Pa(s){return{result:"success",value:s}}function wo(s){return{result:"error",value:s}}function xo(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function ml(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function gl(s){return!!s.expression&&s.expression.interpolated}function Wi(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function ko(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function dc(s){return s}function Fs(s,i){const l=i.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",g=f||!(f||s.property!==void 0),w=s.type||(gl(i)?"exponential":"interval");if(l||i.type==="padding"){const q=l?si.parse:pn.parse;(s=Wt({},s)).stops&&(s.stops=s.stops.map(H=>[H[0],q(H[1])])),s.default=q(s.default?s.default:i.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let I,P,B;if(w==="exponential")I=za;else if(w==="interval")I=ea;else if(w==="categorical"){I=La,P=Object.create(null);for(const q of s.stops)P[q[0]]=q[1];B=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);I=_l}if(f){const q={},H=[];for(let ue=0;ue<s.stops.length;ue++){const ge=s.stops[ue],Ee=ge[0].zoom;q[Ee]===void 0&&(q[Ee]={zoom:Ee,type:s.type,property:s.property,default:s.default,stops:[]},H.push(Ee)),q[Ee].stops.push([ge[0].value,ge[1]])}const ee=[];for(const ue of H)ee.push([q[ue].zoom,Fs(q[ue],i)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:tr.interpolationFactor.bind(void 0,re),zoomStops:ee.map(ue=>ue[0]),evaluate:({zoom:ue},ge)=>za({stops:ee,base:s.base},i,ue).evaluate(ue,ge)}}if(g){const q=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:tr.interpolationFactor.bind(void 0,q),zoomStops:s.stops.map(H=>H[0]),evaluate:({zoom:H})=>I(s,i,H,P,B)}}return{kind:"source",evaluate(q,H){const ee=H&&H.properties?H.properties[s.property]:void 0;return ee===void 0?ro(s.default,i.default):I(s,i,ee,P,B)}}}function ro(s,i,l){return s!==void 0?s:i!==void 0?i:l!==void 0?l:void 0}function La(s,i,l,f,g){return ro(typeof l===g?f[l]:void 0,s.default,i.default)}function ea(s,i,l){if(Wi(l)!=="number")return ro(s.default,i.default);const f=s.stops.length;if(f===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[f-1][0])return s.stops[f-1][1];const g=Sa(s.stops.map(w=>w[0]),l);return s.stops[g][1]}function za(s,i,l){const f=s.base!==void 0?s.base:1;if(Wi(l)!=="number")return ro(s.default,i.default);const g=s.stops.length;if(g===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[g-1][0])return s.stops[g-1][1];const w=Sa(s.stops.map(q=>q[0]),l),x=function(q,H,ee,re){const ue=re-ee,ge=q-ee;return ue===0?0:H===1?ge/ue:(Math.pow(H,ge)-1)/(Math.pow(H,ue)-1)}(l,f,s.stops[w][0],s.stops[w+1][0]),I=s.stops[w][1],P=s.stops[w+1][1],B=qn[i.type]||dc;return typeof I.evaluate=="function"?{evaluate(...q){const H=I.evaluate.apply(void 0,q),ee=P.evaluate.apply(void 0,q);if(H!==void 0&&ee!==void 0)return B(H,ee,x,s.colorSpace)}}:B(I,P,x,s.colorSpace)}function _l(s,i,l){switch(i.type){case"color":l=si.parse(l);break;case"formatted":l=Vn.fromString(l.toString());break;case"resolvedImage":l=Xn.fromString(l.toString());break;case"padding":l=pn.parse(l);break;default:Wi(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0)}return ro(l,s.default,i.default)}Pr.register(bo,{error:[{kind:"error"},[ui],(s,[i])=>{throw new En(i.evaluate(s))}],typeof:[ui,[ci],(s,[i])=>ne(Ii(i.evaluate(s)))],"to-rgba":[ie(St,4),[sn],(s,[i])=>{const[l,f,g,w]=i.evaluate(s).rgb;return[255*l,255*f,255*g,w]}],rgb:[sn,[St,St,St],pl],rgba:[sn,[St,St,St,St],pl],has:{type:ii,overloads:[[[ui],(s,[i])=>io(i.evaluate(s),s.properties())],[[ui,_r],(s,[i,l])=>io(i.evaluate(s),l.evaluate(s))]]},get:{type:ci,overloads:[[[ui],(s,[i])=>gs(i.evaluate(s),s.properties())],[[ui,_r],(s,[i,l])=>gs(i.evaluate(s),l.evaluate(s))]]},"feature-state":[ci,[ui],(s,[i])=>gs(i.evaluate(s),s.featureState||{})],properties:[_r,[],s=>s.properties()],"geometry-type":[ui,[],s=>s.geometryType()],id:[ci,[],s=>s.id()],zoom:[St,[],s=>s.globals.zoom],"heatmap-density":[St,[],s=>s.globals.heatmapDensity||0],"line-progress":[St,[],s=>s.globals.lineProgress||0],accumulated:[ci,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[St,no(St),(s,i)=>{let l=0;for(const f of i)l+=f.evaluate(s);return l}],"*":[St,no(St),(s,i)=>{let l=1;for(const f of i)l*=f.evaluate(s);return l}],"-":{type:St,overloads:[[[St,St],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[St],(s,[i])=>-i.evaluate(s)]]},"/":[St,[St,St],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[St,[St,St],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[St,[St],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[St,[St],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[St,[St],(s,[i])=>Math.log(i.evaluate(s))],log2:[St,[St],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[St,[St],(s,[i])=>Math.sin(i.evaluate(s))],cos:[St,[St],(s,[i])=>Math.cos(i.evaluate(s))],tan:[St,[St],(s,[i])=>Math.tan(i.evaluate(s))],asin:[St,[St],(s,[i])=>Math.asin(i.evaluate(s))],acos:[St,[St],(s,[i])=>Math.acos(i.evaluate(s))],atan:[St,[St],(s,[i])=>Math.atan(i.evaluate(s))],min:[St,no(St),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[St,no(St),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[St,[St],(s,[i])=>Math.abs(i.evaluate(s))],round:[St,[St],(s,[i])=>{const l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[St,[St],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[St,[St],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[ii,[ui,ci],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[ii,[ci],(s,[i])=>s.id()===i.value],"filter-type-==":[ii,[ui],(s,[i])=>s.geometryType()===i.value],"filter-<":[ii,[ui,ci],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f<g}],"filter-id-<":[ii,[ci],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l<f}],"filter->":[ii,[ui,ci],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f>g}],"filter-id->":[ii,[ci],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l>f}],"filter-<=":[ii,[ui,ci],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[ii,[ci],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l<=f}],"filter->=":[ii,[ui,ci],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[ii,[ci],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l>=f}],"filter-has":[ii,[ci],(s,[i])=>i.value in s.properties()],"filter-has-id":[ii,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ii,[ie(ui)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[ii,[ie(ci)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[ii,[ui,ie(ci)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[ii,[ui,ie(ci)],(s,[i,l])=>function(f,g,w,x){for(;w<=x;){const I=w+x>>1;if(g[I]===f)return!0;g[I]>f?x=I-1:w=I+1}return!1}(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:ii,overloads:[[[ii,ii],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[no(ii),(s,i)=>{for(const l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:ii,overloads:[[[ii,ii],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[no(ii),(s,i)=>{for(const l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[ii,[ii],(s,[i])=>!i.evaluate(s)],"is-supported-script":[ii,[ui],(s,[i])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(i.evaluate(s))}],upcase:[ui,[ui],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[ui,[ui],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[ui,no(ci),(s,i)=>i.map(l=>No(l.evaluate(s))).join("")],"resolved-locale":[ui,[yr],(s,[i])=>i.evaluate(s).resolvedLocale()]});class So{constructor(i,l){var f;this.expression=i,this._warningHistory={},this._evaluator=new wa,this._defaultValue=l?(f=l).type==="color"&&ko(f.default)?new si(0,0,0,0):f.type==="color"?si.parse(f.default)||null:f.type==="padding"?pn.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?zn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,f,g,w,x){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(i,l,f,g,w,x){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new En(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Oa(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in bo}function Lr(s,i){const l=new Xs(bo,Yo,[],i?function(g){const w={color:sn,string:ui,number:St,enum:ui,boolean:ii,formatted:br,padding:Ar,resolvedImage:Mr,variableAnchorOffsetCollection:Le};return g.type==="array"?ie(w[g.value]||ci,g.length):w[g.type]}(i):void 0),f=l.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Pa(new So(f,i)):wo(l.errors)}class vr{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!vo(l.expression)}evaluateWithoutErrorHandling(i,l,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,g,w,x)}evaluate(i,l,f,g,w,x){return this._styleExpression.evaluate(i,l,f,g,w,x)}}class To{constructor(i,l,f,g){this.kind=i,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!vo(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,l,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,g,w,x)}evaluate(i,l,f,g,w,x){return this._styleExpression.evaluate(i,l,f,g,w,x)}interpolationFactor(i,l,f){return this.interpolationType?tr.interpolationFactor(this.interpolationType,i,l,f):0}}function yl(s,i){const l=Lr(s,i);if(l.result==="error")return l;const f=l.value.expression,g=Qo(f);if(!g&&!xo(i))return wo([new Ei("","data expressions not supported")]);const w=$o(f,["zoom"]);if(!w&&!ml(i))return wo([new Ei("","zoom expressions not supported")]);const x=ta(f);return x||w?x instanceof Ei?wo([x]):x instanceof tr&&!gl(i)?wo([new Ei("",'"interpolate" expressions cannot be used with this property')]):Pa(x?new To(g?"camera":"composite",l.value,x.labels,x instanceof tr?x.interpolation:void 0):new vr(g?"constant":"source",l.value)):wo([new Ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Co{constructor(i,l){this._parameters=i,this._specification=l,Wt(this,Fs(this._parameters,this._specification))}static deserialize(i){return new Co(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ta(s){let i=null;if(s instanceof Bn)i=ta(s.result);else if(s instanceof ir){for(const l of s.args)if(i=ta(l),i)break}else(s instanceof mo||s instanceof tr)&&s.input instanceof Pr&&s.input.name==="zoom"&&(i=s);return i instanceof Ei||s.eachChild(l=>{const f=ta(l);f instanceof Ei?i=f:!i&&f?i=new Ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new Ei("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Da(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!Da(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Fa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function bl(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Da(s)||(s=so(s));const i=Lr(s,Fa);if(i.result==="error")throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,f,g)=>i.value.evaluate(l,f,{},g),needGeometry:vl(s)}}function _u(s,i){return s<i?-1:s>i?1:0}function vl(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let i=1;i<s.length;i++)if(vl(s[i]))return!0;return!1}function so(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?Eo(s[1],s[2],"=="):i==="!="?Pn(Eo(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Eo(s[1],s[2],i):i==="any"?(l=s.slice(1),["any"].concat(l.map(so))):i==="all"?["all"].concat(s.slice(1).map(so)):i==="none"?["all"].concat(s.slice(1).map(so).map(Pn)):i==="in"?ia(s[1],s.slice(2)):i==="!in"?Pn(ia(s[1],s.slice(2))):i==="has"?na(s[1]):i!=="!has"||Pn(na(s[1]));var l}function Eo(s,i,l){switch(s){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,s,i]}}function ia(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",s,["literal",i.sort(_u)]]:["filter-in-small",s,["literal",i]]}}function na(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Pn(s){return["!",s]}function Ne(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const w of s)g+=`${Ne(w)},`;return`${g}]`}const l=Object.keys(s).sort();let f="{";for(let g=0;g<l.length;g++)f+=`${JSON.stringify(l[g])}:${Ne(s[l[g]])},`;return`${f}}`}function F(s){let i="";for(const l of yi)i+=`/${Ne(s[l])}`;return i}function oe(s){const i=s.value;return i?[new ft(s.key,i,"constants have been deprecated as of v8")]:[]}function Re(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function mt(s){if(Array.isArray(s))return s.map(mt);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const l in s)i[l]=mt(s[l]);return i}return Re(s)}function It(s){const i=s.key,l=s.value,f=s.valueSpec||{},g=s.objectElementValidators||{},w=s.style,x=s.styleSpec,I=s.validateSpec;let P=[];const B=Wi(l);if(B!=="object")return[new ft(i,l,`object expected, ${B} found`)];for(const q in l){const H=q.split(".")[0],ee=f[H]||f["*"];let re;if(g[H])re=g[H];else if(f[H])re=I;else if(g["*"])re=g["*"];else{if(!f["*"]){P.push(new ft(i,l[q],`unknown property "${q}"`));continue}re=I}P=P.concat(re({key:(i&&`${i}.`)+q,value:l[q],valueSpec:ee,style:w,styleSpec:x,object:l,objectKey:q,validateSpec:I},l))}for(const q in f)g[q]||f[q].required&&f[q].default===void 0&&l[q]===void 0&&P.push(new ft(i,l,`missing required property "${q}"`));return P}function Xt(s){const i=s.value,l=s.valueSpec,f=s.style,g=s.styleSpec,w=s.key,x=s.arrayElementValidator||s.validateSpec;if(Wi(i)!=="array")return[new ft(w,i,`array expected, ${Wi(i)} found`)];if(l.length&&i.length!==l.length)return[new ft(w,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new ft(w,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let I={type:l.value,values:l.values};g.$version<7&&(I.function=l.function),Wi(l.value)==="object"&&(I=l.value);let P=[];for(let B=0;B<i.length;B++)P=P.concat(x({array:i,arrayIndex:B,value:i[B],valueSpec:I,validateSpec:s.validateSpec,style:f,styleSpec:g,key:`${w}[${B}]`}));return P}function Hi(s){const i=s.key,l=s.value,f=s.valueSpec;let g=Wi(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new ft(i,l,`number expected, ${g} found`)]:"minimum"in f&&l<f.minimum?[new ft(i,l,`${l} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&l>f.maximum?[new ft(i,l,`${l} is greater than the maximum value ${f.maximum}`)]:[]}function cn(s){const i=s.valueSpec,l=Re(s.value.type);let f,g,w,x={};const I=l!=="categorical"&&s.value.property===void 0,P=!I,B=Wi(s.value.stops)==="array"&&Wi(s.value.stops[0])==="array"&&Wi(s.value.stops[0][0])==="object",q=It({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(re){if(l==="identity")return[new ft(re.key,re.value,'identity function may not have a "stops" property')];let ue=[];const ge=re.value;return ue=ue.concat(Xt({key:re.key,value:ge,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:H})),Wi(ge)==="array"&&ge.length===0&&ue.push(new ft(re.key,ge,"array must have at least one stop")),ue},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:i,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return l==="identity"&&I&&q.push(new ft(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||q.push(new ft(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!gl(s.valueSpec)&&q.push(new ft(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(P&&!xo(s.valueSpec)?q.push(new ft(s.key,s.value,"property functions not supported")):I&&!ml(s.valueSpec)&&q.push(new ft(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!B||s.value.property!==void 0||q.push(new ft(s.key,s.value,'"property" property is required')),q;function H(re){let ue=[];const ge=re.value,Ee=re.key;if(Wi(ge)!=="array")return[new ft(Ee,ge,`array expected, ${Wi(ge)} found`)];if(ge.length!==2)return[new ft(Ee,ge,`array length 2 expected, length ${ge.length} found`)];if(B){if(Wi(ge[0])!=="object")return[new ft(Ee,ge,`object expected, ${Wi(ge[0])} found`)];if(ge[0].zoom===void 0)return[new ft(Ee,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new ft(Ee,ge,"object stop key must have value")];if(w&&w>Re(ge[0].zoom))return[new ft(Ee,ge[0].zoom,"stop zoom values must appear in ascending order")];Re(ge[0].zoom)!==w&&(w=Re(ge[0].zoom),g=void 0,x={}),ue=ue.concat(It({key:`${Ee}[0]`,value:ge[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:Hi,value:ee}}))}else ue=ue.concat(ee({key:`${Ee}[0]`,value:ge[0],validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},ge));return Oa(mt(ge[1]))?ue.concat([new ft(`${Ee}[1]`,ge[1],"expressions are not allowed in function stops.")]):ue.concat(re.validateSpec({key:`${Ee}[1]`,value:ge[1],valueSpec:i,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function ee(re,ue){const ge=Wi(re.value),Ee=Re(re.value),ze=re.value!==null?re.value:ue;if(f){if(ge!==f)return[new ft(re.key,ze,`${ge} stop domain type must match previous stop domain type ${f}`)]}else f=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean")return[new ft(re.key,ze,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&l!=="categorical"){let tt=`number expected, ${ge} found`;return xo(i)&&l===void 0&&(tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(re.key,ze,tt)]}return l!=="categorical"||ge!=="number"||isFinite(Ee)&&Math.floor(Ee)===Ee?l!=="categorical"&&ge==="number"&&g!==void 0&&Ee<g?[new ft(re.key,ze,"stop domain values must appear in ascending order")]:(g=Ee,l==="categorical"&&Ee in x?[new ft(re.key,ze,"stop domain values must be unique")]:(x[Ee]=!0,[])):[new ft(re.key,ze,`integer expected, found ${Ee}`)]}}function On(s){const i=(s.expressionContext==="property"?yl:Lr)(mt(s.value),s.valueSpec);if(i.result==="error")return i.value.map(f=>new ft(`${s.key}${f.key}`,s.value,f.message));const l=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new ft(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!vo(l))return[new ft(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!vo(l))return[new ft(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!$o(l,["zoom","feature-state"]))return[new ft(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Qo(l))return[new ft(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function In(s){const i=s.key,l=s.value,f=s.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Re(l))===-1&&g.push(new ft(i,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(Re(l))===-1&&g.push(new ft(i,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function wr(s){return Da(mt(s.value))?On(Wt({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):zr(s)}function zr(s){const i=s.value,l=s.key;if(Wi(i)!=="array")return[new ft(l,i,`array expected, ${Wi(i)} found`)];const f=s.styleSpec;let g,w=[];if(i.length<1)return[new ft(l,i,"filter array must have at least 1 element")];switch(w=w.concat(In({key:`${l}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),Re(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Re(i[1])==="$type"&&w.push(new ft(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new ft(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Wi(i[1]),g!=="string"&&w.push(new ft(`${l}[1]`,i[1],`string expected, ${g} found`)));for(let x=2;x<i.length;x++)g=Wi(i[x]),Re(i[1])==="$type"?w=w.concat(In({key:`${l}[${x}]`,value:i[x],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new ft(`${l}[${x}]`,i[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)w=w.concat(zr({key:`${l}[${x}]`,value:i[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Wi(i[1]),i.length!==2?w.push(new ft(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new ft(`${l}[1]`,i[1],`string expected, ${g} found`))}return w}function Wr(s,i){const l=s.key,f=s.validateSpec,g=s.style,w=s.styleSpec,x=s.value,I=s.objectKey,P=w[`${i}_${s.layerType}`];if(!P)return[];const B=I.match(/^(.*)-transition$/);if(i==="paint"&&B&&P[B[1]]&&P[B[1]].transition)return f({key:l,value:x,valueSpec:w.transition,style:g,styleSpec:w});const q=s.valueSpec||P[I];if(!q)return[new ft(l,x,`unknown property "${I}"`)];let H;if(Wi(x)==="string"&&xo(q)&&!q.tokens&&(H=/^{([^}]+)}$/.exec(x)))return[new ft(l,x,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(H[1])} }\`.`)];const ee=[];return s.layerType==="symbol"&&(I==="text-field"&&g&&!g.glyphs&&ee.push(new ft(l,x,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&ko(mt(x))&&Re(x.type)==="identity"&&ee.push(new ft(l,x,'"text-font" does not support identity functions'))),ee.concat(f({key:s.key,value:x,valueSpec:q,style:g,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:I}))}function ss(s){return Wr(s,"paint")}function xr(s){return Wr(s,"layout")}function oo(s){let i=[];const l=s.value,f=s.key,g=s.style,w=s.styleSpec;l.type||l.ref||i.push(new ft(f,l,'either "type" or "ref" is required'));let x=Re(l.type);const I=Re(l.ref);if(l.id){const P=Re(l.id);for(let B=0;B<s.arrayIndex;B++){const q=g.layers[B];Re(q.id)===P&&i.push(new ft(f,l.id,`duplicate layer id "${l.id}", previously used at line ${q.id.__line__}`))}}if("ref"in l){let P;["type","source","source-layer","filter","layout"].forEach(B=>{B in l&&i.push(new ft(f,l[B],`"${B}" is prohibited for ref layers`))}),g.layers.forEach(B=>{Re(B.id)===I&&(P=B)}),P?P.ref?i.push(new ft(f,l.ref,"ref cannot reference another ref layer")):x=Re(P.type):i.push(new ft(f,l.ref,`ref layer "${I}" not found`))}else if(x!=="background")if(l.source){const P=g.sources&&g.sources[l.source],B=P&&Re(P.type);P?B==="vector"&&x==="raster"?i.push(new ft(f,l.source,`layer "${l.id}" requires a raster source`)):B!=="raster-dem"&&x==="hillshade"?i.push(new ft(f,l.source,`layer "${l.id}" requires a raster-dem source`)):B==="raster"&&x!=="raster"?i.push(new ft(f,l.source,`layer "${l.id}" requires a vector source`)):B!=="vector"||l["source-layer"]?B==="raster-dem"&&x!=="hillshade"?i.push(new ft(f,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!l.paint||!l.paint["line-gradient"]||B==="geojson"&&P.lineMetrics||i.push(new ft(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ft(f,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new ft(f,l.source,`source "${l.source}" not found`))}else i.push(new ft(f,l,'missing required property "source"'));return i=i.concat(It({key:f,value:l,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:l.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"}),filter:wr,layout:P=>It({layer:l,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":B=>xr(Wt({layerType:x},B))}}),paint:P=>It({layer:l,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":B=>ss(Wt({layerType:x},B))}})}})),i}function os(s){const i=s.value,l=s.key,f=Wi(i);return f!=="string"?[new ft(l,i,`string expected, ${f} found`)]:[]}const Ra={promoteId:function({key:s,value:i}){if(Wi(i)==="string")return os({key:s,value:i});{const l=[];for(const f in i)l.push(...os({key:`${s}.${f}`,value:i[f]}));return l}}};function Gr(s){const i=s.value,l=s.key,f=s.styleSpec,g=s.style,w=s.validateSpec;if(!i.type)return[new ft(l,i,'"type" is required')];const x=Re(i.type);let I;switch(x){case"vector":case"raster":return I=It({key:l,value:i,valueSpec:f[`source_${x.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:Ra,validateSpec:w}),I;case"raster-dem":return I=function(P){var B;const q=(B=P.sourceName)!==null&&B!==void 0?B:"",H=P.value,ee=P.styleSpec,re=ee.source_raster_dem,ue=P.style;let ge=[];const Ee=Wi(H);if(H===void 0)return ge;if(Ee!=="object")return ge.push(new ft("source_raster_dem",H,`object expected, ${Ee} found`)),ge;const ze=Re(H.encoding)==="custom",tt=["redFactor","greenFactor","blueFactor","baseShift"],qe=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Qe in H)!ze&&tt.includes(Qe)?ge.push(new ft(Qe,H[Qe],`In "${q}": "${Qe}" is only valid when "encoding" is set to "custom". ${qe} encoding found`)):re[Qe]?ge=ge.concat(P.validateSpec({key:Qe,value:H[Qe],valueSpec:re[Qe],validateSpec:P.validateSpec,style:ue,styleSpec:ee})):ge.push(new ft(Qe,H[Qe],`unknown property "${Qe}"`));return ge}({sourceName:l,value:i,style:s.style,styleSpec:f,validateSpec:w}),I;case"geojson":if(I=It({key:l,value:i,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:w,objectElementValidators:Ra}),i.cluster)for(const P in i.clusterProperties){const[B,q]=i.clusterProperties[P],H=typeof B=="string"?[B,["accumulated"],["get",P]]:B;I.push(...On({key:`${l}.${P}.map`,value:q,expressionContext:"cluster-map"})),I.push(...On({key:`${l}.${P}.reduce`,value:H,expressionContext:"cluster-reduce"}))}return I;case"video":return It({key:l,value:i,valueSpec:f.source_video,style:g,validateSpec:w,styleSpec:f});case"image":return It({key:l,value:i,valueSpec:f.source_image,style:g,validateSpec:w,styleSpec:f});case"canvas":return[new ft(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return In({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function wl(s){const i=s.value,l=s.styleSpec,f=l.light,g=s.style;let w=[];const x=Wi(i);if(i===void 0)return w;if(x!=="object")return w=w.concat([new ft("light",i,`object expected, ${x} found`)]),w;for(const I in i){const P=I.match(/^(.*)-transition$/);w=w.concat(P&&f[P[1]]&&f[P[1]].transition?s.validateSpec({key:I,value:i[I],valueSpec:l.transition,validateSpec:s.validateSpec,style:g,styleSpec:l}):f[I]?s.validateSpec({key:I,value:i[I],valueSpec:f[I],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new ft(I,i[I],`unknown property "${I}"`)])}return w}function yu(s){const i=s.value,l=s.styleSpec,f=l.sky,g=s.style,w=Wi(i);if(i===void 0)return[];if(w!=="object")return[new ft("sky",i,`object expected, ${w} found`)];let x=[];for(const I in i)x=x.concat(f[I]?s.validateSpec({key:I,value:i[I],valueSpec:f[I],style:g,styleSpec:l}):[new ft(I,i[I],`unknown property "${I}"`)]);return x}function bu(s){const i=s.value,l=s.styleSpec,f=l.terrain,g=s.style;let w=[];const x=Wi(i);if(i===void 0)return w;if(x!=="object")return w=w.concat([new ft("terrain",i,`object expected, ${x} found`)]),w;for(const I in i)w=w.concat(f[I]?s.validateSpec({key:I,value:i[I],valueSpec:f[I],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new ft(I,i[I],`unknown property "${I}"`)]);return w}function vu(s){let i=[];const l=s.value,f=s.key;if(Array.isArray(l)){const g=[],w=[];for(const x in l)l[x].id&&g.includes(l[x].id)&&i.push(new ft(f,l,`all the sprites' ids must be unique, but ${l[x].id} is duplicated`)),g.push(l[x].id),l[x].url&&w.includes(l[x].url)&&i.push(new ft(f,l,`all the sprites' URLs must be unique, but ${l[x].url} is duplicated`)),w.push(l[x].url),i=i.concat(It({key:`${f}[${x}]`,value:l[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return os({key:f,value:l})}const pc={"*":()=>[],array:Xt,boolean:function(s){const i=s.value,l=s.key,f=Wi(i);return f!=="boolean"?[new ft(l,i,`boolean expected, ${f} found`)]:[]},number:Hi,color:function(s){const i=s.key,l=s.value,f=Wi(l);return f!=="string"?[new ft(i,l,`color expected, ${f} found`)]:si.parse(String(l))?[]:[new ft(i,l,`color expected, "${l}" found`)]},constants:oe,enum:In,filter:wr,function:cn,layer:oo,object:It,source:Gr,light:wl,sky:yu,terrain:bu,projection:function(s){const i=s.value,l=s.styleSpec,f=l.projection,g=s.style,w=Wi(i);if(i===void 0)return[];if(w!=="object")return[new ft("projection",i,`object expected, ${w} found`)];let x=[];for(const I in i)x=x.concat(f[I]?s.validateSpec({key:I,value:i[I],valueSpec:f[I],style:g,styleSpec:l}):[new ft(I,i[I],`unknown property "${I}"`)]);return x},string:os,formatted:function(s){return os(s).length===0?[]:On(s)},resolvedImage:function(s){return os(s).length===0?[]:On(s)},padding:function(s){const i=s.key,l=s.value;if(Wi(l)==="array"){if(l.length<1||l.length>4)return[new ft(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const f={type:"number"};let g=[];for(let w=0;w<l.length;w++)g=g.concat(s.validateSpec({key:`${i}[${w}]`,value:l[w],validateSpec:s.validateSpec,valueSpec:f}));return g}return Hi({key:i,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,l=s.value,f=Wi(l),g=s.styleSpec;if(f!=="array"||l.length<1||l.length%2!=0)return[new ft(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<l.length;x+=2)w=w.concat(In({key:`${i}[${x}]`,value:l[x],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Xt({key:`${i}[${x+1}]`,value:l[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return w},sprite:vu};function xl(s){const i=s.value,l=s.valueSpec,f=s.styleSpec;return s.validateSpec=xl,l.expression&&ko(Re(i))?cn(s):l.expression&&Oa(mt(i))?On(s):l.type&&pc[l.type]?pc[l.type](s):It(Wt({},s,{valueSpec:l.type?f[l.type]:l}))}function kh(s){const i=s.value,l=s.key,f=os(s);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new ft(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new ft(l,i,'"glyphs" url must include a "{range}" token'))),f}function as(s,i=$e){let l=[];return l=l.concat(xl({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:xl,objectElementValidators:{glyphs:kh,"*":()=>[]}})),s.constants&&(l=l.concat(oe({key:"constants",value:s.constants}))),wu(l)}function Rs(s){return function(i){return s({...i,validateSpec:xl})}}function wu(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function _s(s){return function(...i){return wu(s.apply(this,i))}}as.source=_s(Rs(Gr)),as.sprite=_s(Rs(vu)),as.glyphs=_s(Rs(kh)),as.light=_s(Rs(wl)),as.sky=_s(Rs(yu)),as.terrain=_s(Rs(bu)),as.layer=_s(Rs(oo)),as.filter=_s(Rs(wr)),as.paintProperty=_s(Rs(ss)),as.layoutProperty=_s(Rs(xr));const ra=as,Pf=ra.light,Lf=ra.sky,Sh=ra.paintProperty,Th=ra.layoutProperty;function xu(s,i){let l=!1;if(i&&i.length)for(const f of i)s.fire(new Pt(new Error(f.message))),l=!0;return l}class Ba{constructor(i,l,f){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(l=x[1])+2*(f=x[2]);for(let P=0;P<this.d*this.d;P++){const B=x[3+P],q=x[3+P+1];g.push(B===q?null:x.subarray(B,q))}const I=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],I),this.bboxes=x.subarray(I),this.insert=this._insertReadonly}else{this.d=l+2*f;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=f,this.scale=l/i,this.uid=0;const w=f/l*i;this.min=-w,this.max=i+w}insert(i,l,f,g,w){this._forEachCell(l,f,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,f,g,w,x){this.cells[w].push(x)}query(i,l,f,g,w){const x=this.min,I=this.max;if(i<=x&&l<=x&&I<=f&&I<=g&&!w)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(i,l,f,g,this._queryCell,P,{},w),P}}_queryCell(i,l,f,g,w,x,I,P){const B=this.cells[w];if(B!==null){const q=this.keys,H=this.bboxes;for(let ee=0;ee<B.length;ee++){const re=B[ee];if(I[re]===void 0){const ue=4*re;(P?P(H[ue+0],H[ue+1],H[ue+2],H[ue+3]):i<=H[ue+2]&&l<=H[ue+3]&&f>=H[ue+0]&&g>=H[ue+1])?(I[re]=!0,x.push(q[re])):I[re]=!1}}}}_forEachCell(i,l,f,g,w,x,I,P){const B=this._convertToCellCoord(i),q=this._convertToCellCoord(l),H=this._convertToCellCoord(f),ee=this._convertToCellCoord(g);for(let re=B;re<=H;re++)for(let ue=q;ue<=ee;ue++){const ge=this.d*ue+re;if((!P||P(this._convertFromCellCoord(re),this._convertFromCellCoord(ue),this._convertFromCellCoord(re+1),this._convertFromCellCoord(ue+1)))&&w.call(this,i,l,f,g,ge,x,I,P))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const g=new Int32Array(l+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=l;for(let x=0;x<i.length;x++){const I=i[x];g[3+x]=w,g.set(I,w),w+=I.length}return g[3+i.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+i.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(i,l){const f=i.toArrayBuffer();return l&&l.push(f),{buffer:f}}static deserialize(i){return new Ba(i.buffer)}}const ls={};function Zt(s,i,l={}){if(ls[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),ls[s]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}Zt("Object",Object),Zt("TransferableGridIndex",Ba),Zt("Color",si),Zt("Error",Error),Zt("AJAXError",Ht),Zt("ResolvedImage",Xn),Zt("StylePropertyFunction",Co),Zt("StyleExpression",So,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",To),Zt("ZoomConstantExpression",vr),Zt("CompoundExpression",Pr,{omit:["_evaluate"]});for(const s in bo)bo[s]._classRegistryKey||Zt(`Expression_${s}`,bo[s]);function mc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function ku(s){return s.$name||s.constructor._classRegistryKey}function Ch(s){return!function(i){if(i===null||typeof i!="object")return!1;const l=ku(i);return!(!l||l==="Object")}(s)&&(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||mc(s)||we(s)||ArrayBuffer.isView(s)||s instanceof ImageData)}function Na(s,i){if(Ch(s))return(mc(s)||we(s))&&i&&i.push(s),ArrayBuffer.isView(s)&&i&&i.push(s.buffer),s instanceof ImageData&&i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const w=[];for(const x of s)w.push(Na(x,i));return w}if(typeof s!="object")throw new Error("can't serialize object of type "+typeof s);const l=ku(s);if(!l)throw new Error(`can't serialize object of unregistered class ${s.constructor.name}`);if(!ls[l])throw new Error(`${l} is not registered.`);const{klass:f}=ls[l],g=f.serialize?f.serialize(s,i):{};if(f.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||ls[l].omit.indexOf(w)>=0)continue;const x=s[w];g[w]=ls[l].shallow.indexOf(w)>=0?x:Na(x,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(g.$name=l),g}function ja(s){if(Ch(s))return s;if(Array.isArray(s))return s.map(ja);if(typeof s!="object")throw new Error("can't deserialize object of type "+typeof s);const i=ku(s)||"Object";if(!ls[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=ls[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(s);const f=Object.create(l.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const w=s[g];f[g]=ls[i].shallow.indexOf(g)>=0?w:ja(w)}return f}class Su{constructor(){this.first=!0}update(i,l){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const qi={"Latin-1 Supplement":s=>s>=128&&s<=255,"Hangul Jamo":s=>s>=4352&&s<=4607,Khmer:s=>s>=6016&&s<=6143,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Katakana:s=>s>=12448&&s<=12543,Kanbun:s=>s>=12688&&s<=12703,"CJK Strokes":s=>s>=12736&&s<=12783,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"Private Use Area":s=>s>=57344&&s<=63743,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Tu(s){for(const i of s)if(Eu(i.charCodeAt(0)))return!0;return!1}function zf(s){for(const i of s)if(!Ua(i.charCodeAt(0)))return!1;return!0}function Cu(s){const i=s.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(i.join("|"),"u")}const Of=Cu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ua(s){return!Of.test(String.fromCodePoint(s))}const Eh=Cu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Eu(s){return!(s!==746&&s!==747&&(s<4352||!(qi["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||qi["CJK Compatibility"](s)||qi["CJK Strokes"](s)||!(!qi["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||qi["Enclosed CJK Letters and Months"](s)||qi["Ideographic Description Characters"](s)||qi.Kanbun(s)||qi.Katakana(s)&&s!==12540||!(!qi["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!qi["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||qi["Vertical Forms"](s)||qi["Yijing Hexagram Symbols"](s)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(s))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(s))||Eh.test(String.fromCodePoint(s)))))}function Ih(s){return!(Eu(s)||function(i){return!!(qi["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||qi["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||qi["Letterlike Symbols"](i)||qi["Number Forms"](i)||qi["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||qi["Control Pictures"](i)&&i!==9251||qi["Optical Character Recognition"](i)||qi["Enclosed Alphanumerics"](i)||qi["Geometric Shapes"](i)||qi["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||qi["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||qi["CJK Symbols and Punctuation"](i)||qi.Katakana(i)||qi["Private Use Area"](i)||qi["CJK Compatibility Forms"](i)||qi["Small Form Variants"](i)||qi["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}const Df=Cu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Iu(s){return Df.test(String.fromCodePoint(s))}function Ff(s,i){return!(!i&&Iu(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||qi.Khmer(s))}function Rf(s){for(const i of s)if(Iu(i.charCodeAt(0)))return!0;return!1}const Hr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class mn{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Su,this.transition={})}isSupportedScript(i){return function(l,f){for(const g of l)if(!Ff(g.charCodeAt(0),f))return!1;return!0}(i,Hr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*l}}}class Va{constructor(i,l){this.property=i,this.value=l,this.expression=function(f,g){if(ko(f))return new Co(f,g);if(Oa(f)){const w=yl(f,g);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=f;return g.type==="color"&&typeof f=="string"?w=si.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=zn.parse(f)):w=pn.parse(f),{kind:"constant",evaluate:()=>w}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,f){return this.property.possiblyEvaluate(this,i,l,f)}}class gc{constructor(i){this.property=i,this.value=new Va(i,void 0)}transitioned(i,l){return new Ah(this.property,this.value,l,te({},i.transition,this.transition),i.now)}untransitioned(){return new Ah(this.property,this.value,null,{},0)}}class _c{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return O(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new gc(this._values[i].property)),this._values[i].value=new Va(this._values[i].property,l===null?void 0:O(l))}getTransition(i){return O(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new gc(this._values[i].property)),this._values[i].transition=O(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(i[l]=f);const g=this.getTransition(l);g!==void 0&&(i[`${l}-transition`]=g)}return i}transitioned(i,l){const f=new kl(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(i,l._values[g]);return f}untransitioned(){const i=new kl(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Ah{constructor(i,l,f,g,w){this.property=i,this.value=l,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(i,l,f){const g=i.now||0,w=this.value.possiblyEvaluate(i,l,f),x=this.prior;if(x){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return x.possiblyEvaluate(i,l,f);{const I=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,l,f),w,function(P){if(P<=0)return 0;if(P>=1)return 1;const B=P*P,q=B*P;return 4*(P<.5?q:3*(P-B)+q-.75)}(I))}}return w}}class kl{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,f){const g=new Tl(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(i,l,f);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Sl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return O(this._values[i].value)}setValue(i,l){this._values[i]=new Va(this._values[i].property,l===null?void 0:O(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(i[l]=f)}return i}possiblyEvaluate(i,l,f){const g=new Tl(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(i,l,f);return g}}class Bs{constructor(i,l,f){this.property=i,this.value=l,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,f,g){return this.property.evaluate(this.value,this.parameters,i,l,f,g)}}class Tl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Kt{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,f){const g=qn[this.specification.type];return g?g(i,l,f):i}}class di{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,f,g){return new Bs(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},f,g)}:i.expression,l)}interpolate(i,l,f){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new Bs(this,{kind:"constant",value:void 0},i.parameters);const g=qn[this.specification.type];if(g){const w=g(i.value.value,l.value.value,f);return new Bs(this,{kind:"constant",value:w},i.parameters)}return i}evaluate(i,l,f,g,w,x){return i.kind==="constant"?i.value:i.evaluate(l,f,g,w,x)}}class yc extends di{possiblyEvaluate(i,l,f,g){if(i.value===void 0)return new Bs(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){const w=i.expression.evaluate(l,null,{},f,g),x=i.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,I=this._calculate(x,x,x,l);return new Bs(this,{kind:"constant",value:I},l)}if(i.expression.kind==="camera"){const w=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new Bs(this,{kind:"constant",value:w},l)}return new Bs(this,i.expression,l)}evaluate(i,l,f,g,w,x){if(i.kind==="source"){const I=i.evaluate(l,f,g,w,x);return this._calculate(I,I,I,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},f,g),i.evaluate({zoom:Math.floor(l.zoom)},f,g),i.evaluate({zoom:Math.floor(l.zoom)+1},f,g),l):i.value}_calculate(i,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:f,to:l}}interpolate(i){return i}}class bc{constructor(i){this.specification=i}possiblyEvaluate(i,l,f,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const w=i.expression.evaluate(l,null,{},f,g);return this._calculate(w,w,w,l)}return this._calculate(i.expression.evaluate(new mn(Math.floor(l.zoom-1),l)),i.expression.evaluate(new mn(Math.floor(l.zoom),l)),i.expression.evaluate(new mn(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:f,to:l}}interpolate(i){return i}}class Au{constructor(i){this.specification=i}possiblyEvaluate(i,l,f,g){return!!i.expression.evaluate(l,null,{},f,g)}interpolate(){return!1}}class v{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const f=i[l];f.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new Va(f,void 0),w=this.defaultTransitionablePropertyValues[l]=new gc(f);this.defaultTransitioningPropertyValues[l]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}Zt("DataDrivenProperty",di),Zt("DataConstantProperty",Kt),Zt("CrossFadedDataDrivenProperty",yc),Zt("CrossFadedProperty",bc),Zt("ColorRampProperty",Au);const t="-transition";class u extends ni{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new Sl(l.layout)),l.paint)){this._transitionablePaint=new _c(l.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Tl(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,f={}){l!=null&&this._validate(Th,`layers.${this.id}.layout.${i}`,i,l,f)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(t)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,f={}){if(l!=null&&this._validate(Sh,`layers.${this.id}.paint.${i}`,i,l,f))return!1;if(i.endsWith(t))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[i],w=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),I=g.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(i,I,P)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),G(i,(l,f)=>!(l===void 0||f==="layout"&&!Object.keys(l).length||f==="paint"&&!Object.keys(l).length))}_validate(i,l,f,g,w={}){return(!w||w.validate!==!1)&&xu(this,i.call(ra,{key:l,layerType:this.type,objectKey:f,value:g,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Bs&&xo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class b{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function A(s,i=1){let l=0,f=0;return{members:s.map(g=>{const w=p[g.type].BYTES_PER_ELEMENT,x=l=L(l,Math.max(i,w)),I=g.components||1;return f=Math.max(f,w),l+=w*I,{name:g.name,type:g.type,components:I,offset:x}}),size:L(l,Math.max(f,i)),alignment:i}}function L(s,i){return Math.ceil(s/i)*i}class D extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.int16[g+0]=l,this.int16[g+1]=f,i}}D.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",D);class Z extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=3*i;return this.int16[w+0]=l,this.int16[w+1]=f,this.int16[w+2]=g,i}}Z.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",Z);class K extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,g)}emplace(i,l,f,g,w){const x=4*i;return this.int16[x+0]=l,this.int16[x+1]=f,this.int16[x+2]=g,this.int16[x+3]=w,i}}K.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",K);class J extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x){const I=this.length;return this.resize(I+1),this.emplace(I,i,l,f,g,w,x)}emplace(i,l,f,g,w,x,I){const P=6*i;return this.int16[P+0]=l,this.int16[P+1]=f,this.int16[P+2]=g,this.int16[P+3]=w,this.int16[P+4]=x,this.int16[P+5]=I,i}}J.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",J);class ae extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x){const I=this.length;return this.resize(I+1),this.emplace(I,i,l,f,g,w,x)}emplace(i,l,f,g,w,x,I){const P=4*i,B=8*i;return this.int16[P+0]=l,this.int16[P+1]=f,this.uint8[B+4]=g,this.uint8[B+5]=w,this.uint8[B+6]=x,this.uint8[B+7]=I,i}}ae.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",ae);class _e extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.float32[g+0]=l,this.float32[g+1]=f,i}}_e.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",_e);class ke extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,P,B,q){const H=this.length;return this.resize(H+1),this.emplace(H,i,l,f,g,w,x,I,P,B,q)}emplace(i,l,f,g,w,x,I,P,B,q,H){const ee=10*i;return this.uint16[ee+0]=l,this.uint16[ee+1]=f,this.uint16[ee+2]=g,this.uint16[ee+3]=w,this.uint16[ee+4]=x,this.uint16[ee+5]=I,this.uint16[ee+6]=P,this.uint16[ee+7]=B,this.uint16[ee+8]=q,this.uint16[ee+9]=H,i}}ke.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",ke);class Ie extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,P,B,q,H,ee){const re=this.length;return this.resize(re+1),this.emplace(re,i,l,f,g,w,x,I,P,B,q,H,ee)}emplace(i,l,f,g,w,x,I,P,B,q,H,ee,re){const ue=12*i;return this.int16[ue+0]=l,this.int16[ue+1]=f,this.int16[ue+2]=g,this.int16[ue+3]=w,this.uint16[ue+4]=x,this.uint16[ue+5]=I,this.uint16[ue+6]=P,this.uint16[ue+7]=B,this.int16[ue+8]=q,this.int16[ue+9]=H,this.int16[ue+10]=ee,this.int16[ue+11]=re,i}}Ie.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",Ie);class Oe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=3*i;return this.float32[w+0]=l,this.float32[w+1]=f,this.float32[w+2]=g,i}}Oe.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",Oe);class Fe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Fe.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",Fe);class je extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,P,B){const q=this.length;return this.resize(q+1),this.emplace(q,i,l,f,g,w,x,I,P,B)}emplace(i,l,f,g,w,x,I,P,B,q){const H=10*i,ee=5*i;return this.int16[H+0]=l,this.int16[H+1]=f,this.int16[H+2]=g,this.int16[H+3]=w,this.int16[H+4]=x,this.int16[H+5]=I,this.uint32[ee+3]=P,this.uint16[H+8]=B,this.uint16[H+9]=q,i}}je.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",je);class Ce extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x){const I=this.length;return this.resize(I+1),this.emplace(I,i,l,f,g,w,x)}emplace(i,l,f,g,w,x,I){const P=6*i;return this.int16[P+0]=l,this.int16[P+1]=f,this.int16[P+2]=g,this.int16[P+3]=w,this.int16[P+4]=x,this.int16[P+5]=I,i}}Ce.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",Ce);class He extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,f,g,w)}emplace(i,l,f,g,w,x){const I=4*i,P=8*i;return this.float32[I+0]=l,this.float32[I+1]=f,this.float32[I+2]=g,this.int16[P+6]=w,this.int16[P+7]=x,i}}He.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",He);class Ye extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x){const I=this.length;return this.resize(I+1),this.emplace(I,i,l,f,g,w,x)}emplace(i,l,f,g,w,x,I){const P=16*i,B=4*i,q=8*i;return this.uint8[P+0]=l,this.uint8[P+1]=f,this.float32[B+1]=g,this.float32[B+2]=w,this.int16[q+6]=x,this.int16[q+7]=I,i}}Ye.prototype.bytesPerElement=16,Zt("StructArrayLayout2ub2f2i16",Ye);class nt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=3*i;return this.uint16[w+0]=l,this.uint16[w+1]=f,this.uint16[w+2]=g,i}}nt.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",nt);class vt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,P,B,q,H,ee,re,ue,ge,Ee,ze){const tt=this.length;return this.resize(tt+1),this.emplace(tt,i,l,f,g,w,x,I,P,B,q,H,ee,re,ue,ge,Ee,ze)}emplace(i,l,f,g,w,x,I,P,B,q,H,ee,re,ue,ge,Ee,ze,tt){const qe=24*i,Qe=12*i,ht=48*i;return this.int16[qe+0]=l,this.int16[qe+1]=f,this.uint16[qe+2]=g,this.uint16[qe+3]=w,this.uint32[Qe+2]=x,this.uint32[Qe+3]=I,this.uint32[Qe+4]=P,this.uint16[qe+10]=B,this.uint16[qe+11]=q,this.uint16[qe+12]=H,this.float32[Qe+7]=ee,this.float32[Qe+8]=re,this.uint8[ht+36]=ue,this.uint8[ht+37]=ge,this.uint8[ht+38]=Ee,this.uint32[Qe+10]=ze,this.int16[qe+22]=tt,i}}vt.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vt);class Ct extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,P,B,q,H,ee,re,ue,ge,Ee,ze,tt,qe,Qe,ht,xt,jt,hi,Rt,Dt,ei,Gt){const qt=this.length;return this.resize(qt+1),this.emplace(qt,i,l,f,g,w,x,I,P,B,q,H,ee,re,ue,ge,Ee,ze,tt,qe,Qe,ht,xt,jt,hi,Rt,Dt,ei,Gt)}emplace(i,l,f,g,w,x,I,P,B,q,H,ee,re,ue,ge,Ee,ze,tt,qe,Qe,ht,xt,jt,hi,Rt,Dt,ei,Gt,qt){const _t=32*i,ti=16*i;return this.int16[_t+0]=l,this.int16[_t+1]=f,this.int16[_t+2]=g,this.int16[_t+3]=w,this.int16[_t+4]=x,this.int16[_t+5]=I,this.int16[_t+6]=P,this.int16[_t+7]=B,this.uint16[_t+8]=q,this.uint16[_t+9]=H,this.uint16[_t+10]=ee,this.uint16[_t+11]=re,this.uint16[_t+12]=ue,this.uint16[_t+13]=ge,this.uint16[_t+14]=Ee,this.uint16[_t+15]=ze,this.uint16[_t+16]=tt,this.uint16[_t+17]=qe,this.uint16[_t+18]=Qe,this.uint16[_t+19]=ht,this.uint16[_t+20]=xt,this.uint16[_t+21]=jt,this.uint16[_t+22]=hi,this.uint32[ti+12]=Rt,this.float32[ti+13]=Dt,this.float32[ti+14]=ei,this.uint16[_t+30]=Gt,this.uint16[_t+31]=qt,i}}Ct.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Ct);class Ft extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Ft.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",Ft);class Vt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=3*i;return this.uint16[6*i+0]=l,this.float32[w+1]=f,this.float32[w+2]=g,i}}Vt.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",Vt);class Lt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=4*i;return this.uint32[2*i+0]=l,this.uint16[w+2]=f,this.uint16[w+3]=g,i}}Lt.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",Lt);class Mt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.uint16[g+0]=l,this.uint16[g+1]=f,i}}Mt.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",Mt);class Jt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}Jt.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",Jt);class xi extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,g)}emplace(i,l,f,g,w){const x=4*i;return this.float32[x+0]=l,this.float32[x+1]=f,this.float32[x+2]=g,this.float32[x+3]=w,i}}xi.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",xi);class zt extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}zt.prototype.size=20;class Nt extends je{get(i){return new zt(this,i)}}Zt("CollisionBoxArray",Nt);class bi extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}bi.prototype.size=48;class gn extends vt{get(i){return new bi(this,i)}}Zt("PlacedSymbolArray",gn);class Ai extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ai.prototype.size=64;class Vi extends Ct{get(i){return new Ai(this,i)}}Zt("SymbolInstanceArray",Vi);class _n extends Ft{getoffsetX(i){return this.float32[1*i+0]}}Zt("GlyphOffsetArray",_n);class lr extends Z{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Zt("SymbolLineVertexArray",lr);class ys extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ys.prototype.size=12;class yn extends Vt{get(i){return new ys(this,i)}}Zt("TextAnchorOffsetArray",yn);class Or extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Or.prototype.size=8;class kr extends Lt{get(i){return new Or(this,i)}}Zt("FeatureIndexArray",kr);class cr extends D{}class Sr extends D{}class Ns extends D{}class qa extends J{}class vc extends ae{}class Za extends _e{}class cs extends ke{}class wc extends Ie{}class Mu extends Oe{}class us extends Fe{}class hs extends Ce{}class Io extends Ye{}class bs extends nt{}class nr extends Mt{}const ur=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xr}=ur;class Zi{constructor(i=[]){this.segments=i}prepareSegment(i,l,f,g){let w=this.segments[this.segments.length-1];return i>Zi.MAX_VERTEX_ARRAY_LENGTH&&le(`Max vertices per segment is ${Zi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!w||w.vertexLength+i>Zi.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:l.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,f,g){return new Zi([{vertexOffset:i,primitiveOffset:l,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function sa(s,i){return 256*(s=se(Math.floor(s),0,255))+se(Math.floor(i),0,255)}Zi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Zi);const Wa=A([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ga={exports:{}},Mh={exports:{}};Mh.exports=function(s,i){var l,f,g,w,x,I,P,B;for(f=s.length-(l=3&s.length),g=i,x=3432918353,I=461845907,B=0;B<f;)P=255&s.charCodeAt(B)|(255&s.charCodeAt(++B))<<8|(255&s.charCodeAt(++B))<<16|(255&s.charCodeAt(++B))<<24,++B,g=27492+(65535&(w=5*(65535&(g=(g^=P=(65535&(P=(P=(65535&P)*x+(((P>>>16)*x&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(P=0,l){case 3:P^=(255&s.charCodeAt(B+2))<<16;case 2:P^=(255&s.charCodeAt(B+1))<<8;case 1:g^=P=(65535&(P=(P=(65535&(P^=255&s.charCodeAt(B)))*x+(((P>>>16)*x&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Bf=Mh.exports,Ph={exports:{}};Ph.exports=function(s,i){for(var l,f=s.length,g=i^f,w=0;f>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:g^=(255&s.charCodeAt(w+2))<<16;case 2:g^=(255&s.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Ao=Bf,Lh=Ph.exports;Ga.exports=Ao,Ga.exports.murmur3=Ao,Ga.exports.murmur2=Lh;var xc=_(Ga.exports);class Cl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,f,g){this.ids.push(kc(i)),this.positions.push(l,f,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=kc(i);let f=0,g=this.ids.length-1;for(;f<g;){const x=f+g>>1;this.ids[x]>=l?g=x:f=x+1}const w=[];for(;this.ids[f]===l;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(i,l){const f=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Sc(f,g,0,f.length-1),l&&l.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(i){const l=new Cl;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function kc(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:xc(String(s))}function Sc(s,i,l,f){for(;l<f;){const g=s[l+f>>1];let w=l-1,x=f+1;for(;;){do w++;while(s[w]<g);do x--;while(s[x]>g);if(w>=x)break;Ha(s,w,x),Ha(i,3*w,3*x),Ha(i,3*w+1,3*x+1),Ha(i,3*w+2,3*x+2)}x-l<f-x?(Sc(s,i,l,x),l=x+1):(Sc(s,i,x+1,f),f=x)}}function Ha(s,i,l){const f=s[i];s[i]=s[l],s[l]=f}Zt("FeaturePositionMap",Cl);class El{constructor(i,l){this.gl=i.gl,this.location=l}}class zh extends El{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ap extends El{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Mp extends El{constructor(i,l){super(i,l),this.current=si.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Eb=new Float32Array(16);function Nf(s){return[sa(255*s.r,255*s.g),sa(255*s.b,255*s.a)]}class Pu{constructor(i,l,f){this.value=i,this.uniformNames=l.map(g=>`u_${g}`),this.type=f}setUniform(i,l,f){i.set(f.constantOr(this.value))}getBinding(i,l,f){return this.type==="color"?new Mp(i,l):new zh(i,l)}}class Tc{constructor(i,l){this.uniformNames=l.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,f,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&i.set(w)}getBinding(i,l,f){return f.substr(0,9)==="u_pattern"?new Ap(i,l):new zh(i,l)}}class oa{constructor(i,l,f,g){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,l,f,g,w){const x=this.paintVertexArray.length,I=this.expression.evaluate(new mn(0),l,{},g,[],w);this.paintVertexArray.resize(i),this._setPaintValue(x,i,I)}updatePaintArray(i,l,f,g){const w=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(i,l,w)}_setPaintValue(i,l,f){if(this.type==="color"){const g=Nf(f);for(let w=i;w<l;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ao{constructor(i,l,f,g,w,x){this.expression=i,this.uniformNames=l.map(I=>`u_${I}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=l.map(I=>({name:`a_${I}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,l,f,g,w){const x=this.expression.evaluate(new mn(this.zoom),l,{},g,[],w),I=this.expression.evaluate(new mn(this.zoom+1),l,{},g,[],w),P=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(P,i,x,I)}updatePaintArray(i,l,f,g){const w=this.expression.evaluate({zoom:this.zoom},f,g),x=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(i,l,w,x)}_setPaintValue(i,l,f,g){if(this.type==="color"){const w=Nf(f),x=Nf(g);for(let I=i;I<l;I++)this.paintVertexArray.emplace(I,w[0],w[1],x[0],x[1])}else{for(let w=i;w<l;w++)this.paintVertexArray.emplace(w,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=se(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,l,f){return new zh(i,l)}}class Xa{constructor(i,l,f,g,w,x){this.expression=i,this.type=l,this.useIntegerZoom=f,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(i,l,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,l.patterns&&l.patterns[this.layerId],f)}updatePaintArray(i,l,f,g,w){this._setPaintValues(i,l,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(i,l,f,g){if(!g||!f)return;const{min:w,mid:x,max:I}=f,P=g[w],B=g[x],q=g[I];if(P&&B&&q)for(let H=i;H<l;H++)this.zoomInPaintVertexArray.emplace(H,B.tl[0],B.tl[1],B.br[0],B.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],B.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(H,B.tl[0],B.tl[1],B.br[0],B.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],B.pixelRatio,q.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,Wa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,Wa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Pp{constructor(i,l,f){this.binders={},this._buffers=[];const g=[];for(const w in i.paint._values){if(!f(w))continue;const x=i.paint.get(w);if(!(x instanceof Bs&&xo(x.property.specification)))continue;const I=Ib(w,i.type),P=x.value,B=x.property.specification.type,q=x.property.useIntegerZoom,H=x.property.specification["property-type"],ee=H==="cross-faded"||H==="cross-faded-data-driven";if(P.kind==="constant")this.binders[w]=ee?new Tc(P.value,I):new Pu(P.value,I,B),g.push(`/u_${w}`);else if(P.kind==="source"||ee){const re=Lp(w,B,"source");this.binders[w]=ee?new Xa(P,B,q,l,re,i.id):new oa(P,I,B,re),g.push(`/a_${w}`)}else{const re=Lp(w,B,"composite");this.binders[w]=new ao(P,I,B,q,l,re),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof oa||l instanceof ao?l.maxValue:0}populatePaintArrays(i,l,f,g,w){for(const x in this.binders){const I=this.binders[x];(I instanceof oa||I instanceof ao||I instanceof Xa)&&I.populatePaintArray(i,l,f,g,w)}}setConstantPatternPositions(i,l){for(const f in this.binders){const g=this.binders[f];g instanceof Tc&&g.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,f,g,w){let x=!1;for(const I in i){const P=l.getPositions(I);for(const B of P){const q=f.feature(B.index);for(const H in this.binders){const ee=this.binders[H];if((ee instanceof oa||ee instanceof ao||ee instanceof Xa)&&ee.expression.isStateDependent===!0){const re=g.paint.get(H);ee.expression=re.value,ee.updatePaintArray(B.start,B.end,q,i[I],w),x=!0}}}}return x}defines(){const i=[];for(const l in this.binders){const f=this.binders[l];(f instanceof Pu||f instanceof Tc)&&i.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof oa||f instanceof ao)for(let g=0;g<f.paintVertexAttributes.length;g++)i.push(f.paintVertexAttributes[g].name);else if(f instanceof Xa)for(let g=0;g<Wa.members.length;g++)i.push(Wa.members[g].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof Pu||f instanceof Tc||f instanceof ao)for(const g of f.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const f=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof Pu||w instanceof Tc||w instanceof ao){for(const x of w.uniformNames)if(l[x]){const I=w.getBinding(i,l[x],x);f.push({name:x,property:g,binding:I})}}}return f}setUniforms(i,l,f,g){for(const{name:w,property:x,binding:I}of l)this.binders[x].setUniform(I,g,f.get(x),w)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const f=this.binders[l];if(i&&f instanceof Xa){const g=i.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof oa||f instanceof ao)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const l in this.binders){const f=this.binders[l];(f instanceof oa||f instanceof ao||f instanceof Xa)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof oa||l instanceof ao||l instanceof Xa)&&l.destroy()}}}class Il{constructor(i,l,f=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new Pp(g,l,f);this.needsUpload=!1,this._featureMap=new Cl,this._bufferOffset=0}populatePaintArrays(i,l,f,g,w,x){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(i,l,g,w,x);l.id!==void 0&&this._featureMap.add(l.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,f,g){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(i,this._featureMap,l,w,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Ib(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Lp(s,i,l){const f={color:{source:_e,composite:xi},number:{source:Ft,composite:_e}},g=function(w){return{"line-pattern":{source:cs,composite:cs},"fill-pattern":{source:cs,composite:cs},"fill-extrusion-pattern":{source:cs,composite:cs}}[w]}(s);return g&&g[l]||f[i][l]}Zt("ConstantBinder",Pu),Zt("CrossFadedConstantBinder",Tc),Zt("SourceExpressionBinder",oa),Zt("CrossFadedCompositeBinder",Xa),Zt("CompositeExpressionBinder",ao),Zt("ProgramConfiguration",Pp,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Il);const Nn=8192,jf=Math.pow(2,14)-1,zp=-jf-1;function Al(s){const i=Nn/s.extent,l=s.loadGeometry();for(let f=0;f<l.length;f++){const g=l[f];for(let w=0;w<g.length;w++){const x=g[w],I=Math.round(x.x*i),P=Math.round(x.y*i);x.x=se(I,zp,jf),x.y=se(P,zp,jf),(I<x.x||I>x.x+1||P<x.y||P>x.y+1)&&le("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Ml(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?Al(s):[]}}function Oh(s,i,l,f,g){s.emplaceBack(2*i+(f+1)/2,2*l+(g+1)/2)}class Uf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Sr,this.indexArray=new bs,this.segments=new Zi,this.programConfigurations=new Il(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){const g=this.layers[0],w=[];let x=null,I=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),I=!x.isConstant());for(const{feature:P,id:B,index:q,sourceLayerIndex:H}of i){const ee=this.layers[0]._featureFilter.needGeometry,re=Ml(P,ee);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),re,f))continue;const ue=I?x.evaluate(re,{},f):void 0,ge={id:B,properties:P.properties,type:P.type,sourceLayerIndex:H,index:q,geometry:ee?re.geometry:Al(P),patterns:{},sortKey:ue};w.push(ge)}I&&w.sort((P,B)=>P.sortKey-B.sortKey);for(const P of w){const{geometry:B,index:q,sourceLayerIndex:H}=P,ee=i[q].feature;this.addFeature(P,B,q,f),l.featureIndex.insert(ee,B,q,H,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Xr),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,f,g){for(const w of l)for(const x of w){const I=x.x,P=x.y;if(I<0||I>=Nn||P<0||P>=Nn)continue;const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),q=B.vertexLength;Oh(this.layoutVertexArray,I,P,-1,-1),Oh(this.layoutVertexArray,I,P,1,-1),Oh(this.layoutVertexArray,I,P,1,1),Oh(this.layoutVertexArray,I,P,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},g)}}function Op(s,i){for(let l=0;l<s.length;l++)if(Cc(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(Cc(s,i[l]))return!0;return!!Vf(s,i)}function Ab(s,i,l){return!!Cc(s,i)||!!qf(i,s,l)}function Dp(s,i){if(s.length===1)return Rp(i,s[0]);for(let l=0;l<i.length;l++){const f=i[l];for(let g=0;g<f.length;g++)if(Cc(s,f[g]))return!0}for(let l=0;l<s.length;l++)if(Rp(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(Vf(s,i[l]))return!0;return!1}function Mb(s,i,l){if(s.length>1){if(Vf(s,i))return!0;for(let f=0;f<i.length;f++)if(qf(i[f],s,l))return!0}for(let f=0;f<s.length;f++)if(qf(s[f],i,l))return!0;return!1}function Vf(s,i){if(s.length===0||i.length===0)return!1;for(let l=0;l<s.length-1;l++){const f=s[l],g=s[l+1];for(let w=0;w<i.length-1;w++)if(Pb(f,g,i[w],i[w+1]))return!0}return!1}function Pb(s,i,l,f){return de(s,l,f)!==de(i,l,f)&&de(s,i,l)!==de(s,i,f)}function qf(s,i,l){const f=l*l;if(i.length===1)return s.distSqr(i[0])<f;for(let g=1;g<i.length;g++)if(Fp(s,i[g-1],i[g])<f)return!0;return!1}function Fp(s,i,l){const f=i.distSqr(l);if(f===0)return s.distSqr(i);const g=((s.x-i.x)*(l.x-i.x)+(s.y-i.y)*(l.y-i.y))/f;return s.distSqr(g<0?i:g>1?l:l.sub(i)._mult(g)._add(i))}function Rp(s,i){let l,f,g,w=!1;for(let x=0;x<s.length;x++){l=s[x];for(let I=0,P=l.length-1;I<l.length;P=I++)f=l[I],g=l[P],f.y>i.y!=g.y>i.y&&i.x<(g.x-f.x)*(i.y-f.y)/(g.y-f.y)+f.x&&(w=!w)}return w}function Cc(s,i){let l=!1;for(let f=0,g=s.length-1;f<s.length;g=f++){const w=s[f],x=s[g];w.y>i.y!=x.y>i.y&&i.x<(x.x-w.x)*(i.y-w.y)/(x.y-w.y)+w.x&&(l=!l)}return l}function Lb(s,i,l){const f=l[0],g=l[2];if(s.x<f.x&&i.x<f.x||s.x>g.x&&i.x>g.x||s.y<f.y&&i.y<f.y||s.y>g.y&&i.y>g.y)return!1;const w=de(s,i,l[0]);return w!==de(s,i,l[1])||w!==de(s,i,l[2])||w!==de(s,i,l[3])}function Lu(s,i,l){const f=i.paint.get(s).value;return f.kind==="constant"?f.value:l.programConfigurations.get(i.id).getMaxValue(s)}function Dh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Fh(s,i,l,f,g){if(!i[0]&&!i[1])return s;const w=y.convert(i)._mult(g);l==="viewport"&&w._rotate(-f);const x=[];for(let I=0;I<s.length;I++)x.push(s[I].sub(w));return x}let Bp,Np;Zt("CircleBucket",Uf,{omit:["layers"]});var zb={get paint(){return Np=Np||new v({"circle-radius":new di($e.paint_circle["circle-radius"]),"circle-color":new di($e.paint_circle["circle-color"]),"circle-blur":new di($e.paint_circle["circle-blur"]),"circle-opacity":new di($e.paint_circle["circle-opacity"]),"circle-translate":new Kt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Kt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Kt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Kt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new di($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new di($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new di($e.paint_circle["circle-stroke-opacity"])})},get layout(){return Bp=Bp||new v({"circle-sort-key":new di($e.layout_circle["circle-sort-key"])})}},Dr=1e-6,Ec=typeof Float32Array<"u"?Float32Array:Array;function Zf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function jp(s,i,l){var f=i[0],g=i[1],w=i[2],x=i[3],I=i[4],P=i[5],B=i[6],q=i[7],H=i[8],ee=i[9],re=i[10],ue=i[11],ge=i[12],Ee=i[13],ze=i[14],tt=i[15],qe=l[0],Qe=l[1],ht=l[2],xt=l[3];return s[0]=qe*f+Qe*I+ht*H+xt*ge,s[1]=qe*g+Qe*P+ht*ee+xt*Ee,s[2]=qe*w+Qe*B+ht*re+xt*ze,s[3]=qe*x+Qe*q+ht*ue+xt*tt,s[4]=(qe=l[4])*f+(Qe=l[5])*I+(ht=l[6])*H+(xt=l[7])*ge,s[5]=qe*g+Qe*P+ht*ee+xt*Ee,s[6]=qe*w+Qe*B+ht*re+xt*ze,s[7]=qe*x+Qe*q+ht*ue+xt*tt,s[8]=(qe=l[8])*f+(Qe=l[9])*I+(ht=l[10])*H+(xt=l[11])*ge,s[9]=qe*g+Qe*P+ht*ee+xt*Ee,s[10]=qe*w+Qe*B+ht*re+xt*ze,s[11]=qe*x+Qe*q+ht*ue+xt*tt,s[12]=(qe=l[12])*f+(Qe=l[13])*I+(ht=l[14])*H+(xt=l[15])*ge,s[13]=qe*g+Qe*P+ht*ee+xt*Ee,s[14]=qe*w+Qe*B+ht*re+xt*ze,s[15]=qe*x+Qe*q+ht*ue+xt*tt,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var zu,Ob=jp;function Rh(s,i,l){var f=i[0],g=i[1],w=i[2],x=i[3];return s[0]=l[0]*f+l[4]*g+l[8]*w+l[12]*x,s[1]=l[1]*f+l[5]*g+l[9]*w+l[13]*x,s[2]=l[2]*f+l[6]*g+l[10]*w+l[14]*x,s[3]=l[3]*f+l[7]*g+l[11]*w+l[15]*x,s}zu=new Ec(4),Ec!=Float32Array&&(zu[0]=0,zu[1]=0,zu[2]=0,zu[3]=0);class Db extends u{constructor(i){super(i,zb)}createBucket(i){return new Uf(i)}queryRadius(i){const l=i;return Lu("circle-radius",this,l)+Lu("circle-stroke-width",this,l)+Dh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,l,f,g,w,x,I,P){const B=Fh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,I),q=this.paint.get("circle-radius").evaluate(l,f)+this.paint.get("circle-stroke-width").evaluate(l,f),H=this.paint.get("circle-pitch-alignment")==="map",ee=H?B:function(ue,ge){return ue.map(Ee=>Up(Ee,ge))}(B,P),re=H?q*I:q;for(const ue of g)for(const ge of ue){const Ee=H?ge:Up(ge,P);let ze=re;const tt=Rh([],[ge.x,ge.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ze*=tt[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ze*=x.cameraToCenterDistance/tt[3]),Ab(ee,Ee,ze))return!0}return!1}}function Up(s,i){const l=Rh([],[s.x,s.y,0,1],i);return new y(l[0]/l[3],l[1]/l[3])}class Vp extends Uf{}let qp;Zt("HeatmapBucket",Vp,{omit:["layers"]});var Fb={get paint(){return qp=qp||new v({"heatmap-radius":new di($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new di($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Kt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Au($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Kt($e.paint_heatmap["heatmap-opacity"])})}};function Wf(s,{width:i,height:l},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*l*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*l*f}`)}else g=new Uint8Array(i*l*f);return s.width=i,s.height=l,s.data=g,s}function Zp(s,{width:i,height:l},f){if(i===s.width&&l===s.height)return;const g=Wf({},{width:i,height:l},f);Gf(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,l)},f),s.width=i,s.height=l,s.data=g.data}function Gf(s,i,l,f,g,w){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||l.x>s.width-g.width||l.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||f.x>i.width-g.width||f.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,I=i.data;if(x===I)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<g.height;P++){const B=((l.y+P)*s.width+l.x)*w,q=((f.y+P)*i.width+f.x)*w;for(let H=0;H<g.width*w;H++)I[q+H]=x[B+H]}return i}class Ou{constructor(i,l){Wf(this,i,1,l)}resize(i){Zp(this,i,1)}clone(){return new Ou({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,f,g,w){Gf(i,l,f,g,w,1)}}class vs{constructor(i,l){Wf(this,i,4,l)}resize(i){Zp(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,f,g,w){Gf(i,l,f,g,w,4)}}function Wp(s){const i={},l=s.resolution||256,f=s.clips?s.clips.length:1,g=s.image||new vs({width:l,height:f});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const w=(x,I,P)=>{i[s.evaluationKey]=P;const B=s.expression.evaluate(i);g.data[x+I+0]=Math.floor(255*B.r/B.a),g.data[x+I+1]=Math.floor(255*B.g/B.a),g.data[x+I+2]=Math.floor(255*B.b/B.a),g.data[x+I+3]=Math.floor(255*B.a)};if(s.clips)for(let x=0,I=0;x<f;++x,I+=4*l)for(let P=0,B=0;P<l;P++,B+=4){const q=P/(l-1),{start:H,end:ee}=s.clips[x];w(I,B,H*(1-q)+ee*q)}else for(let x=0,I=0;x<l;x++,I+=4)w(0,I,x/(l-1));return g}Zt("AlphaImage",Ou),Zt("RGBAImage",vs);const Hf="big-fb";class Rb extends u{createBucket(i){return new Vp(i)}constructor(i){super(i,Fb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Hf)&&this.heatmapFbos.delete(Hf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Gp;var Bb={get paint(){return Gp=Gp||new v({"hillshade-illumination-direction":new Kt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Kt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Kt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Kt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Kt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Kt($e.paint_hillshade["hillshade-accent-color"])})}};class Nb extends u{constructor(i){super(i,Bb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const jb=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ub}=jb;function Hp(s,i,l=2){const f=i&&i.length,g=f?i[0]*l:s.length;let w=Xp(s,0,g,l,!0);const x=[];if(!w||w.next===w.prev)return x;let I,P,B;if(f&&(w=function(q,H,ee,re){const ue=[];for(let ge=0,Ee=H.length;ge<Ee;ge++){const ze=Xp(q,H[ge]*re,ge<Ee-1?H[ge+1]*re:q.length,re,!1);ze===ze.next&&(ze.steiner=!0),ue.push(Kb(ze))}ue.sort(Gb);for(let ge=0;ge<ue.length;ge++)ee=Hb(ue[ge],ee);return ee}(s,i,w,l)),s.length>80*l){I=1/0,P=1/0;let q=-1/0,H=-1/0;for(let ee=l;ee<g;ee+=l){const re=s[ee],ue=s[ee+1];re<I&&(I=re),ue<P&&(P=ue),re>q&&(q=re),ue>H&&(H=ue)}B=Math.max(q-I,H-P),B=B!==0?32767/B:0}return Du(w,x,l,I,P,B,0),x}function Xp(s,i,l,f,g){let w;if(g===function(x,I,P,B){let q=0;for(let H=I,ee=P-B;H<P;H+=B)q+=(x[ee]-x[H])*(x[H+1]+x[ee+1]),ee=H;return q}(s,i,l,f)>0)for(let x=i;x<l;x+=f)w=Yp(x/f|0,s[x],s[x+1],w);else for(let x=l-f;x>=i;x-=f)w=Yp(x/f|0,s[x],s[x+1],w);return w&&Bh(w,w.next)&&(Ru(w),w=w.next),w}function Pl(s,i){if(!s)return s;i||(i=s);let l,f=s;do if(l=!1,f.steiner||!Bh(f,f.next)&&Dn(f.prev,f,f.next)!==0)f=f.next;else{if(Ru(f),f=i=f.prev,f===f.next)break;l=!0}while(l||f!==i);return i}function Du(s,i,l,f,g,w,x){if(!s)return;!x&&w&&function(P,B,q,H){let ee=P;do ee.z===0&&(ee.z=Xf(ee.x,ee.y,B,q,H)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==P);ee.prevZ.nextZ=null,ee.prevZ=null,function(re){let ue,ge=1;do{let Ee,ze=re;re=null;let tt=null;for(ue=0;ze;){ue++;let qe=ze,Qe=0;for(let xt=0;xt<ge&&(Qe++,qe=qe.nextZ,qe);xt++);let ht=ge;for(;Qe>0||ht>0&&qe;)Qe!==0&&(ht===0||!qe||ze.z<=qe.z)?(Ee=ze,ze=ze.nextZ,Qe--):(Ee=qe,qe=qe.nextZ,ht--),tt?tt.nextZ=Ee:re=Ee,Ee.prevZ=tt,tt=Ee;ze=qe}tt.nextZ=null,ge*=2}while(ue>1)}(ee)}(s,f,g,w);let I=s;for(;s.prev!==s.next;){const P=s.prev,B=s.next;if(w?qb(s,f,g,w):Vb(s))i.push(P.i,s.i,B.i),Ru(s),s=B.next,I=B.next;else if((s=B)===I){x?x===1?Du(s=Zb(Pl(s),i),i,l,f,g,w,2):x===2&&Wb(s,i,l,f,g,w):Du(Pl(s),i,l,f,g,w,1);break}}}function Vb(s){const i=s.prev,l=s,f=s.next;if(Dn(i,l,f)>=0)return!1;const g=i.x,w=l.x,x=f.x,I=i.y,P=l.y,B=f.y,q=g<w?g<x?g:x:w<x?w:x,H=I<P?I<B?I:B:P<B?P:B,ee=g>w?g>x?g:x:w>x?w:x,re=I>P?I>B?I:B:P>B?P:B;let ue=f.next;for(;ue!==i;){if(ue.x>=q&&ue.x<=ee&&ue.y>=H&&ue.y<=re&&Ic(g,I,w,P,x,B,ue.x,ue.y)&&Dn(ue.prev,ue,ue.next)>=0)return!1;ue=ue.next}return!0}function qb(s,i,l,f){const g=s.prev,w=s,x=s.next;if(Dn(g,w,x)>=0)return!1;const I=g.x,P=w.x,B=x.x,q=g.y,H=w.y,ee=x.y,re=I<P?I<B?I:B:P<B?P:B,ue=q<H?q<ee?q:ee:H<ee?H:ee,ge=I>P?I>B?I:B:P>B?P:B,Ee=q>H?q>ee?q:ee:H>ee?H:ee,ze=Xf(re,ue,i,l,f),tt=Xf(ge,Ee,i,l,f);let qe=s.prevZ,Qe=s.nextZ;for(;qe&&qe.z>=ze&&Qe&&Qe.z<=tt;){if(qe.x>=re&&qe.x<=ge&&qe.y>=ue&&qe.y<=Ee&&qe!==g&&qe!==x&&Ic(I,q,P,H,B,ee,qe.x,qe.y)&&Dn(qe.prev,qe,qe.next)>=0||(qe=qe.prevZ,Qe.x>=re&&Qe.x<=ge&&Qe.y>=ue&&Qe.y<=Ee&&Qe!==g&&Qe!==x&&Ic(I,q,P,H,B,ee,Qe.x,Qe.y)&&Dn(Qe.prev,Qe,Qe.next)>=0))return!1;Qe=Qe.nextZ}for(;qe&&qe.z>=ze;){if(qe.x>=re&&qe.x<=ge&&qe.y>=ue&&qe.y<=Ee&&qe!==g&&qe!==x&&Ic(I,q,P,H,B,ee,qe.x,qe.y)&&Dn(qe.prev,qe,qe.next)>=0)return!1;qe=qe.prevZ}for(;Qe&&Qe.z<=tt;){if(Qe.x>=re&&Qe.x<=ge&&Qe.y>=ue&&Qe.y<=Ee&&Qe!==g&&Qe!==x&&Ic(I,q,P,H,B,ee,Qe.x,Qe.y)&&Dn(Qe.prev,Qe,Qe.next)>=0)return!1;Qe=Qe.nextZ}return!0}function Zb(s,i){let l=s;do{const f=l.prev,g=l.next.next;!Bh(f,g)&&Kp(f,l,l.next,g)&&Fu(f,g)&&Fu(g,f)&&(i.push(f.i,l.i,g.i),Ru(l),Ru(l.next),l=s=g),l=l.next}while(l!==s);return Pl(l)}function Wb(s,i,l,f,g,w){let x=s;do{let I=x.next.next;for(;I!==x.prev;){if(x.i!==I.i&&Jb(x,I)){let P=Jp(x,I);return x=Pl(x,x.next),P=Pl(P,P.next),Du(x,i,l,f,g,w,0),void Du(P,i,l,f,g,w,0)}I=I.next}x=x.next}while(x!==s)}function Gb(s,i){return s.x-i.x}function Hb(s,i){const l=function(g,w){let x=w;const I=g.x,P=g.y;let B,q=-1/0;do{if(P<=x.y&&P>=x.next.y&&x.next.y!==x.y){const ge=x.x+(P-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(ge<=I&&ge>q&&(q=ge,B=x.x<x.next.x?x:x.next,ge===I))return B}x=x.next}while(x!==w);if(!B)return null;const H=B,ee=B.x,re=B.y;let ue=1/0;x=B;do{if(I>=x.x&&x.x>=ee&&I!==x.x&&Ic(P<re?I:q,P,ee,re,P<re?q:I,P,x.x,x.y)){const ge=Math.abs(P-x.y)/(I-x.x);Fu(x,g)&&(ge<ue||ge===ue&&(x.x>B.x||x.x===B.x&&Xb(B,x)))&&(B=x,ue=ge)}x=x.next}while(x!==H);return B}(s,i);if(!l)return i;const f=Jp(l,s);return Pl(f,f.next),Pl(l,l.next)}function Xb(s,i){return Dn(s.prev,s,i.prev)<0&&Dn(i.next,s,s.next)<0}function Xf(s,i,l,f,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Kb(s){let i=s,l=s;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==s);return l}function Ic(s,i,l,f,g,w,x,I){return(g-x)*(i-I)>=(s-x)*(w-I)&&(s-x)*(f-I)>=(l-x)*(i-I)&&(l-x)*(w-I)>=(g-x)*(f-I)}function Jb(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(l,f){let g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==f.i&&g.next.i!==f.i&&Kp(g,g.next,l,f))return!0;g=g.next}while(g!==l);return!1}(s,i)&&(Fu(s,i)&&Fu(i,s)&&function(l,f){let g=l,w=!1;const x=(l.x+f.x)/2,I=(l.y+f.y)/2;do g.y>I!=g.next.y>I&&g.next.y!==g.y&&x<(g.next.x-g.x)*(I-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==l);return w}(s,i)&&(Dn(s.prev,s,i.prev)||Dn(s,i.prev,i))||Bh(s,i)&&Dn(s.prev,s,s.next)>0&&Dn(i.prev,i,i.next)>0)}function Dn(s,i,l){return(i.y-s.y)*(l.x-i.x)-(i.x-s.x)*(l.y-i.y)}function Bh(s,i){return s.x===i.x&&s.y===i.y}function Kp(s,i,l,f){const g=jh(Dn(s,i,l)),w=jh(Dn(s,i,f)),x=jh(Dn(l,f,s)),I=jh(Dn(l,f,i));return g!==w&&x!==I||!(g!==0||!Nh(s,l,i))||!(w!==0||!Nh(s,f,i))||!(x!==0||!Nh(l,s,f))||!(I!==0||!Nh(l,i,f))}function Nh(s,i,l){return i.x<=Math.max(s.x,l.x)&&i.x>=Math.min(s.x,l.x)&&i.y<=Math.max(s.y,l.y)&&i.y>=Math.min(s.y,l.y)}function jh(s){return s>0?1:s<0?-1:0}function Fu(s,i){return Dn(s.prev,s,s.next)<0?Dn(s,i,s.next)>=0&&Dn(s,s.prev,i)>=0:Dn(s,i,s.prev)<0||Dn(s,s.next,i)<0}function Jp(s,i){const l=Kf(s.i,s.x,s.y),f=Kf(i.i,i.x,i.y),g=s.next,w=i.prev;return s.next=i,i.prev=s,l.next=g,g.prev=l,f.next=l,l.prev=f,w.next=f,f.prev=w,f}function Yp(s,i,l,f){const g=Kf(s,i,l);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Ru(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Kf(s,i,l){return{i:s,x:i,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Jf(s,i,l){const f=l.patternDependencies;let g=!1;for(const w of i){const x=w.paint.get(`${s}-pattern`);x.isConstant()||(g=!0);const I=x.constantOr(null);I&&(g=!0,f[I.to]=!0,f[I.from]=!0)}return g}function Yf(s,i,l,f,g){const w=g.patternDependencies;for(const x of i){const I=x.paint.get(`${s}-pattern`).value;if(I.kind!=="constant"){let P=I.evaluate({zoom:f-1},l,{},g.availableImages),B=I.evaluate({zoom:f},l,{},g.availableImages),q=I.evaluate({zoom:f+1},l,{},g.availableImages);P=P&&P.name?P.name:P,B=B&&B.name?B.name:B,q=q&&q.name?q.name:q,w[P]=!0,w[B]=!0,w[q]=!0,l.patterns[x.id]={min:P,mid:B,max:q}}}return l}class Qf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ns,this.indexArray=new bs,this.indexArray2=new nr,this.programConfigurations=new Il(i.layers,i.zoom),this.segments=new Zi,this.segments2=new Zi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.hasPattern=Jf("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),x=[];for(const{feature:I,id:P,index:B,sourceLayerIndex:q}of i){const H=this.layers[0]._featureFilter.needGeometry,ee=Ml(I,H);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),ee,f))continue;const re=w?g.evaluate(ee,{},f,l.availableImages):void 0,ue={id:P,properties:I.properties,type:I.type,sourceLayerIndex:q,index:B,geometry:H?ee.geometry:Al(I),patterns:{},sortKey:re};x.push(ue)}w&&x.sort((I,P)=>I.sortKey-P.sortKey);for(const I of x){const{geometry:P,index:B,sourceLayerIndex:q}=I;if(this.hasPattern){const H=Yf("fill",this.layers,I,this.zoom,l);this.patternFeatures.push(H)}else this.addFeature(I,P,B,f,{});l.featureIndex.insert(i[B].feature,P,B,q,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}addFeatures(i,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ub),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,f,g,w){for(const x of Ia(l,500)){let I=0;for(const re of x)I+=re.length;const P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),B=P.vertexLength,q=[],H=[];for(const re of x){if(re.length===0)continue;re!==x[0]&&H.push(q.length/2);const ue=this.segments2.prepareSegment(re.length,this.layoutVertexArray,this.indexArray2),ge=ue.vertexLength;this.layoutVertexArray.emplaceBack(re[0].x,re[0].y),this.indexArray2.emplaceBack(ge+re.length-1,ge),q.push(re[0].x),q.push(re[0].y);for(let Ee=1;Ee<re.length;Ee++)this.layoutVertexArray.emplaceBack(re[Ee].x,re[Ee].y),this.indexArray2.emplaceBack(ge+Ee-1,ge+Ee),q.push(re[Ee].x),q.push(re[Ee].y);ue.vertexLength+=re.length,ue.primitiveLength+=re.length}const ee=Hp(q,H);for(let re=0;re<ee.length;re+=3)this.indexArray.emplaceBack(B+ee[re],B+ee[re+1],B+ee[re+2]);P.vertexLength+=I,P.primitiveLength+=ee.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,g)}}let Qp,$p;Zt("FillBucket",Qf,{omit:["layers","patternFeatures"]});var Yb={get paint(){return $p=$p||new v({"fill-antialias":new Kt($e.paint_fill["fill-antialias"]),"fill-opacity":new di($e.paint_fill["fill-opacity"]),"fill-color":new di($e.paint_fill["fill-color"]),"fill-outline-color":new di($e.paint_fill["fill-outline-color"]),"fill-translate":new Kt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Kt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new yc($e.paint_fill["fill-pattern"])})},get layout(){return Qp=Qp||new v({"fill-sort-key":new di($e.layout_fill["fill-sort-key"])})}};class Qb extends u{constructor(i){super(i,Yb)}recalculate(i,l){super.recalculate(i,l);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Qf(i)}queryRadius(){return Dh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,l,f,g,w,x,I){return Dp(Fh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,I),g)}isTileClipped(){return!0}}const $b=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ev=A([{name:"a_centroid",components:2,type:"Int16"}],4),{members:tv}=$b;var Ka={},iv=S,em=Ac;function Ac(s,i,l,f,g){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=g,s.readFields(nv,this,i)}function nv(s,i,l){s==1?i.id=l.readVarint():s==2?function(f,g){for(var w=f.readVarint()+f.pos;f.pos<w;){var x=g._keys[f.readVarint()],I=g._values[f.readVarint()];g.properties[x]=I}}(l,i):s==3?i.type=l.readVarint():s==4&&(i._geometry=l.pos)}function rv(s){for(var i,l,f=0,g=0,w=s.length,x=w-1;g<w;x=g++)f+=((l=s[x]).x-(i=s[g]).x)*(i.y+l.y);return f}Ac.types=["Unknown","Point","LineString","Polygon"],Ac.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,l=s.readVarint()+s.pos,f=1,g=0,w=0,x=0,I=[];s.pos<l;){if(g<=0){var P=s.readVarint();f=7&P,g=P>>3}if(g--,f===1||f===2)w+=s.readSVarint(),x+=s.readSVarint(),f===1&&(i&&I.push(i),i=[]),i.push(new iv(w,x));else{if(f!==7)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&I.push(i),I},Ac.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,l=1,f=0,g=0,w=0,x=1/0,I=-1/0,P=1/0,B=-1/0;s.pos<i;){if(f<=0){var q=s.readVarint();l=7&q,f=q>>3}if(f--,l===1||l===2)(g+=s.readSVarint())<x&&(x=g),g>I&&(I=g),(w+=s.readSVarint())<P&&(P=w),w>B&&(B=w);else if(l!==7)throw new Error("unknown command "+l)}return[x,P,I,B]},Ac.prototype.toGeoJSON=function(s,i,l){var f,g,w=this.extent*Math.pow(2,l),x=this.extent*s,I=this.extent*i,P=this.loadGeometry(),B=Ac.types[this.type];function q(re){for(var ue=0;ue<re.length;ue++){var ge=re[ue];re[ue]=[360*(ge.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(ge.y+I)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(f=0;f<P.length;f++)H[f]=P[f][0];q(P=H);break;case 2:for(f=0;f<P.length;f++)q(P[f]);break;case 3:for(P=function(re){var ue=re.length;if(ue<=1)return[re];for(var ge,Ee,ze=[],tt=0;tt<ue;tt++){var qe=rv(re[tt]);qe!==0&&(Ee===void 0&&(Ee=qe<0),Ee===qe<0?(ge&&ze.push(ge),ge=[re[tt]]):ge.push(re[tt]))}return ge&&ze.push(ge),ze}(P),f=0;f<P.length;f++)for(g=0;g<P[f].length;g++)q(P[f][g])}P.length===1?P=P[0]:B="Multi"+B;var ee={type:"Feature",geometry:{type:B,coordinates:P},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var sv=em,tm=im;function im(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(ov,this,i),this.length=this._features.length}function ov(s,i,l){s===15?i.version=l.readVarint():s===1?i.name=l.readString():s===5?i.extent=l.readVarint():s===2?i._features.push(l.pos):s===3?i._keys.push(l.readString()):s===4&&i._values.push(function(f){for(var g=null,w=f.readVarint()+f.pos;f.pos<w;){var x=f.readVarint()>>3;g=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return g}(l))}im.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new sv(this._pbf,i,this.extent,this._keys,this._values)};var av=tm;function lv(s,i,l){if(s===3){var f=new av(l,l.readVarint()+l.pos);f.length&&(i[f.name]=f)}}Ka.VectorTile=function(s,i){this.layers=s.readFields(lv,{},i)},Ka.VectorTileFeature=em,Ka.VectorTileLayer=tm;const cv=Ka.VectorTileFeature.types,$f=Math.pow(2,13);function Bu(s,i,l,f,g,w,x,I){s.emplaceBack(i,l,2*Math.floor(f*$f)+x,g*$f*2,w*$f*2,Math.round(I))}class ed{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new qa,this.centroidVertexArray=new cr,this.indexArray=new bs,this.programConfigurations=new Il(i.layers,i.zoom),this.segments=new Zi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.features=[],this.hasPattern=Jf("fill-extrusion",this.layers,l);for(const{feature:g,id:w,index:x,sourceLayerIndex:I}of i){const P=this.layers[0]._featureFilter.needGeometry,B=Ml(g,P);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),B,f))continue;const q={id:w,sourceLayerIndex:I,index:x,geometry:P?B.geometry:Al(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Yf("fill-extrusion",this.layers,q,this.zoom,l)):this.addFeature(q,q.geometry,x,f,{}),l.featureIndex.insert(g,q.geometry,x,I,this.index,!0)}}addFeatures(i,l,f){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,l,f)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,tv),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,ev.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,f,g,w){for(const x of Ia(l,500)){const I={x:0,y:0,vertexCount:0};let P=0;for(const ue of x)P+=ue.length;let B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ue of x){if(ue.length===0||hv(ue))continue;let ge=0;for(let Ee=0;Ee<ue.length;Ee++){const ze=ue[Ee];if(Ee>=1){const tt=ue[Ee-1];if(!uv(ze,tt)){B.vertexLength+4>Zi.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const qe=ze.sub(tt)._perp()._unit(),Qe=tt.dist(ze);ge+Qe>32768&&(ge=0),Bu(this.layoutVertexArray,ze.x,ze.y,qe.x,qe.y,0,0,ge),Bu(this.layoutVertexArray,ze.x,ze.y,qe.x,qe.y,0,1,ge),I.x+=2*ze.x,I.y+=2*ze.y,I.vertexCount+=2,ge+=Qe,Bu(this.layoutVertexArray,tt.x,tt.y,qe.x,qe.y,0,0,ge),Bu(this.layoutVertexArray,tt.x,tt.y,qe.x,qe.y,0,1,ge),I.x+=2*tt.x,I.y+=2*tt.y,I.vertexCount+=2;const ht=B.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),B.vertexLength+=4,B.primitiveLength+=2}}}}if(B.vertexLength+P>Zi.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),cv[i.type]!=="Polygon")continue;const q=[],H=[],ee=B.vertexLength;for(const ue of x)if(ue.length!==0){ue!==x[0]&&H.push(q.length/2);for(let ge=0;ge<ue.length;ge++){const Ee=ue[ge];Bu(this.layoutVertexArray,Ee.x,Ee.y,0,0,1,1,0),I.x+=Ee.x,I.y+=Ee.y,I.vertexCount+=1,q.push(Ee.x),q.push(Ee.y)}}const re=Hp(q,H);for(let ue=0;ue<re.length;ue+=3)this.indexArray.emplaceBack(ee+re[ue],ee+re[ue+2],ee+re[ue+1]);B.primitiveLength+=re.length/3,B.vertexLength+=P;for(let ue=0;ue<I.vertexCount;ue++){const ge=Math.floor(I.x/I.vertexCount),Ee=Math.floor(I.y/I.vertexCount);this.centroidVertexArray.emplaceBack(ge,Ee)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,g)}}function uv(s,i){return s.x===i.x&&(s.x<0||s.x>Nn)||s.y===i.y&&(s.y<0||s.y>Nn)}function hv(s){return s.every(i=>i.x<0)||s.every(i=>i.x>Nn)||s.every(i=>i.y<0)||s.every(i=>i.y>Nn)}let nm;Zt("FillExtrusionBucket",ed,{omit:["layers","features"]});var fv={get paint(){return nm=nm||new v({"fill-extrusion-opacity":new Kt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new di($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Kt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Kt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yc($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new di($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new di($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Kt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class dv extends u{constructor(i){super(i,fv)}createBucket(i){return new ed(i)}queryRadius(){return Dh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,l,f,g,w,x,I,P){const B=Fh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,I),q=this.paint.get("fill-extrusion-height").evaluate(l,f),H=this.paint.get("fill-extrusion-base").evaluate(l,f),ee=function(ue,ge,Ee,ze){const tt=[];for(const qe of ue){const Qe=[qe.x,qe.y,0,1];Rh(Qe,Qe,ge),tt.push(new y(Qe[0]/Qe[3],Qe[1]/Qe[3]))}return tt}(B,P),re=function(ue,ge,Ee,ze){const tt=[],qe=[],Qe=ze[8]*ge,ht=ze[9]*ge,xt=ze[10]*ge,jt=ze[11]*ge,hi=ze[8]*Ee,Rt=ze[9]*Ee,Dt=ze[10]*Ee,ei=ze[11]*Ee;for(const Gt of ue){const qt=[],_t=[];for(const ti of Gt){const $t=ti.x,vi=ti.y,un=ze[0]*$t+ze[4]*vi+ze[12],an=ze[1]*$t+ze[5]*vi+ze[13],Kn=ze[2]*$t+ze[6]*vi+ze[14],js=ze[3]*$t+ze[7]*vi+ze[15],fr=Kn+xt,Jn=js+jt,Fr=un+hi,Rr=an+Rt,Br=Kn+Dt,Ln=js+ei,Yn=new y((un+Qe)/Jn,(an+ht)/Jn);Yn.z=fr/Jn,qt.push(Yn);const Tr=new y(Fr/Ln,Rr/Ln);Tr.z=Br/Ln,_t.push(Tr)}tt.push(qt),qe.push(_t)}return[tt,qe]}(g,H,q,P);return function(ue,ge,Ee){let ze=1/0;Dp(Ee,ge)&&(ze=rm(Ee,ge[0]));for(let tt=0;tt<ge.length;tt++){const qe=ge[tt],Qe=ue[tt];for(let ht=0;ht<qe.length-1;ht++){const xt=qe[ht],jt=[xt,qe[ht+1],Qe[ht+1],Qe[ht],xt];Op(Ee,jt)&&(ze=Math.min(ze,rm(Ee,jt)))}}return ze!==1/0&&ze}(re[0],re[1],ee)}}function Nu(s,i){return s.x*i.x+s.y*i.y}function rm(s,i){if(s.length===1){let l=0;const f=i[l++];let g;for(;!g||f.equals(g);)if(g=i[l++],!g)return 1/0;for(;l<i.length;l++){const w=i[l],x=s[0],I=g.sub(f),P=w.sub(f),B=x.sub(f),q=Nu(I,I),H=Nu(I,P),ee=Nu(P,P),re=Nu(B,I),ue=Nu(B,P),ge=q*ee-H*H,Ee=(ee*re-H*ue)/ge,ze=(q*ue-H*re)/ge,tt=f.z*(1-Ee-ze)+g.z*Ee+w.z*ze;if(isFinite(tt))return tt}return 1/0}{let l=1/0;for(const f of i)l=Math.min(l,f.z);return l}}const pv=A([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:mv}=pv,gv=A([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_v}=gv,yv=Ka.VectorTileFeature.types,bv=Math.cos(Math.PI/180*37.5),sm=Math.pow(2,14)/.5;class td{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new vc,this.layoutVertexArray2=new Za,this.indexArray=new bs,this.programConfigurations=new Il(i.layers,i.zoom),this.segments=new Zi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.hasPattern=Jf("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),x=[];for(const{feature:I,id:P,index:B,sourceLayerIndex:q}of i){const H=this.layers[0]._featureFilter.needGeometry,ee=Ml(I,H);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),ee,f))continue;const re=w?g.evaluate(ee,{},f):void 0,ue={id:P,properties:I.properties,type:I.type,sourceLayerIndex:q,index:B,geometry:H?ee.geometry:Al(I),patterns:{},sortKey:re};x.push(ue)}w&&x.sort((I,P)=>I.sortKey-P.sortKey);for(const I of x){const{geometry:P,index:B,sourceLayerIndex:q}=I;if(this.hasPattern){const H=Yf("line",this.layers,I,this.zoom,l);this.patternFeatures.push(H)}else this.addFeature(I,P,B,f,{});l.featureIndex.insert(i[B].feature,P,B,q,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}addFeatures(i,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,_v)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,mv),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,f,g,w){const x=this.layers[0].layout,I=x.get("line-join").evaluate(i,{}),P=x.get("line-cap"),B=x.get("line-miter-limit"),q=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const H of l)this.addLine(H,i,I,P,B,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,g)}addLine(i,l,f,g,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ze=0;ze<i.length-1;ze++)this.totalDistance+=i[ze].dist(i[ze+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=yv[l.type]==="Polygon";let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let B=0;for(;B<P-1&&i[B].equals(i[B+1]);)B++;if(P<(I?3:2))return;f==="bevel"&&(w=1.05);const q=this.overscaling<=16?15*Nn/(512*this.overscaling):0,H=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let ee,re,ue,ge,Ee;this.e1=this.e2=-1,I&&(ee=i[P-2],Ee=i[B].sub(ee)._unit()._perp());for(let ze=B;ze<P;ze++){if(ue=ze===P-1?I?i[B+1]:void 0:i[ze+1],ue&&i[ze].equals(ue))continue;Ee&&(ge=Ee),ee&&(re=ee),ee=i[ze],Ee=ue?ue.sub(ee)._unit()._perp():ge,ge=ge||Ee;let tt=ge.add(Ee);tt.x===0&&tt.y===0||tt._unit();const qe=ge.x*Ee.x+ge.y*Ee.y,Qe=tt.x*Ee.x+tt.y*Ee.y,ht=Qe!==0?1/Qe:1/0,xt=2*Math.sqrt(2-2*Qe),jt=Qe<bv&&re&&ue,hi=ge.x*Ee.y-ge.y*Ee.x>0;if(jt&&ze>B){const ei=ee.dist(re);if(ei>2*q){const Gt=ee.sub(ee.sub(re)._mult(q/ei)._round());this.updateDistance(re,Gt),this.addCurrentVertex(Gt,ge,0,0,H),re=Gt}}const Rt=re&&ue;let Dt=Rt?f:I?"butt":g;if(Rt&&Dt==="round"&&(ht<x?Dt="miter":ht<=2&&(Dt="fakeround")),Dt==="miter"&&ht>w&&(Dt="bevel"),Dt==="bevel"&&(ht>2&&(Dt="flipbevel"),ht<w&&(Dt="miter")),re&&this.updateDistance(re,ee),Dt==="miter")tt._mult(ht),this.addCurrentVertex(ee,tt,0,0,H);else if(Dt==="flipbevel"){if(ht>100)tt=Ee.mult(-1);else{const ei=ht*ge.add(Ee).mag()/ge.sub(Ee).mag();tt._perp()._mult(ei*(hi?-1:1))}this.addCurrentVertex(ee,tt,0,0,H),this.addCurrentVertex(ee,tt.mult(-1),0,0,H)}else if(Dt==="bevel"||Dt==="fakeround"){const ei=-Math.sqrt(ht*ht-1),Gt=hi?ei:0,qt=hi?0:ei;if(re&&this.addCurrentVertex(ee,ge,Gt,qt,H),Dt==="fakeround"){const _t=Math.round(180*xt/Math.PI/20);for(let ti=1;ti<_t;ti++){let $t=ti/_t;if($t!==.5){const un=$t-.5;$t+=$t*un*($t-1)*((1.0904+qe*(qe*(3.55645-1.43519*qe)-3.2452))*un*un+(.848013+qe*(.215638*qe-1.06021)))}const vi=Ee.sub(ge)._mult($t)._add(ge)._unit()._mult(hi?-1:1);this.addHalfVertex(ee,vi.x,vi.y,!1,hi,0,H)}}ue&&this.addCurrentVertex(ee,Ee,-Gt,-qt,H)}else if(Dt==="butt")this.addCurrentVertex(ee,tt,0,0,H);else if(Dt==="square"){const ei=re?1:-1;this.addCurrentVertex(ee,tt,ei,ei,H)}else Dt==="round"&&(re&&(this.addCurrentVertex(ee,ge,0,0,H),this.addCurrentVertex(ee,ge,1,1,H,!0)),ue&&(this.addCurrentVertex(ee,Ee,-1,-1,H,!0),this.addCurrentVertex(ee,Ee,0,0,H)));if(jt&&ze<P-1){const ei=ee.dist(ue);if(ei>2*q){const Gt=ee.add(ue.sub(ee)._mult(q/ei)._round());this.updateDistance(ee,Gt),this.addCurrentVertex(Gt,Ee,0,0,H),ee=Gt}}}}addCurrentVertex(i,l,f,g,w,x=!1){const I=l.y*g-l.x,P=-l.y-l.x*g;this.addHalfVertex(i,l.x+l.y*f,l.y-l.x*f,x,!1,f,w),this.addHalfVertex(i,I,P,x,!0,-g,w),this.distance>sm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,f,g,w,x))}addHalfVertex({x:i,y:l},f,g,w,x,I,P){const B=.5*(this.lineClips?this.scaledDistance*(sm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(w?1:0),(l<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(I===0?0:I<0?-1:1)|(63&B)<<2,B>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const q=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,q),P.primitiveLength++),x?this.e2=q:this.e1=q}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}let om,am;Zt("LineBucket",td,{omit:["layers","patternFeatures"]});var lm={get paint(){return am=am||new v({"line-opacity":new di($e.paint_line["line-opacity"]),"line-color":new di($e.paint_line["line-color"]),"line-translate":new Kt($e.paint_line["line-translate"]),"line-translate-anchor":new Kt($e.paint_line["line-translate-anchor"]),"line-width":new di($e.paint_line["line-width"]),"line-gap-width":new di($e.paint_line["line-gap-width"]),"line-offset":new di($e.paint_line["line-offset"]),"line-blur":new di($e.paint_line["line-blur"]),"line-dasharray":new bc($e.paint_line["line-dasharray"]),"line-pattern":new yc($e.paint_line["line-pattern"]),"line-gradient":new Au($e.paint_line["line-gradient"])})},get layout(){return om=om||new v({"line-cap":new Kt($e.layout_line["line-cap"]),"line-join":new di($e.layout_line["line-join"]),"line-miter-limit":new Kt($e.layout_line["line-miter-limit"]),"line-round-limit":new Kt($e.layout_line["line-round-limit"]),"line-sort-key":new di($e.layout_line["line-sort-key"])})}};class vv extends di{possiblyEvaluate(i,l){return l=new mn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,f,g){return l=te({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,f,g)}}let Uh;class wv extends u{constructor(i){super(i,lm),this.gradientVersion=0,Uh||(Uh=new vv(lm.paint.properties["line-width"].specification),Uh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof mo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=Uh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new td(i)}queryRadius(i){const l=i,f=cm(Lu("line-width",this,l),Lu("line-gap-width",this,l)),g=Lu("line-offset",this,l);return f/2+Math.abs(g)+Dh(this.paint.get("line-translate"))}queryIntersectsFeature(i,l,f,g,w,x,I){const P=Fh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,I),B=I/2*cm(this.paint.get("line-width").evaluate(l,f),this.paint.get("line-gap-width").evaluate(l,f)),q=this.paint.get("line-offset").evaluate(l,f);return q&&(g=function(H,ee){const re=[];for(let ue=0;ue<H.length;ue++){const ge=H[ue],Ee=[];for(let ze=0;ze<ge.length;ze++){const tt=ge[ze-1],qe=ge[ze],Qe=ge[ze+1],ht=ze===0?new y(0,0):qe.sub(tt)._unit()._perp(),xt=ze===ge.length-1?new y(0,0):Qe.sub(qe)._unit()._perp(),jt=ht._add(xt)._unit(),hi=jt.x*xt.x+jt.y*xt.y;hi!==0&&jt._mult(1/hi),Ee.push(jt._mult(ee)._add(qe))}re.push(Ee)}return re}(g,q*I)),function(H,ee,re){for(let ue=0;ue<ee.length;ue++){const ge=ee[ue];if(H.length>=3){for(let Ee=0;Ee<ge.length;Ee++)if(Cc(H,ge[Ee]))return!0}if(Mb(H,ge,re))return!0}return!1}(P,g,B)}isTileClipped(){return!0}}function cm(s,i){return i>0?i+2*s:s}const xv=A([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kv=A([{name:"a_projected_pos",components:3,type:"Float32"}],4);A([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Sv=A([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);A([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const um=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Tv=A([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cv(s,i,l){return s.sections.forEach(f=>{f.text=function(g,w,x){const I=w.layout.get("text-transform").evaluate(x,{});return I==="uppercase"?g=g.toLocaleUpperCase():I==="lowercase"&&(g=g.toLocaleLowerCase()),Hr.applyArabicShaping&&(g=Hr.applyArabicShaping(g)),g}(f.text,i,l)}),s}A([{name:"triangle",components:3,type:"Uint16"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),A([{type:"Float32",name:"offsetX"}]),A([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),A([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ju={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Zn=24,hm=on,fm=function(s,i,l,f,g){var w,x,I=8*g-f-1,P=(1<<I)-1,B=P>>1,q=-7,H=g-1,ee=-1,re=s[i+H];for(H+=ee,w=re&(1<<-q)-1,re>>=-q,q+=I;q>0;w=256*w+s[i+H],H+=ee,q-=8);for(x=w&(1<<-q)-1,w>>=-q,q+=f;q>0;x=256*x+s[i+H],H+=ee,q-=8);if(w===0)w=1-B;else{if(w===P)return x?NaN:1/0*(re?-1:1);x+=Math.pow(2,f),w-=B}return(re?-1:1)*x*Math.pow(2,w-f)},dm=function(s,i,l,f,g,w){var x,I,P,B=8*w-g-1,q=(1<<B)-1,H=q>>1,ee=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=0,ue=1,ge=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(I=isNaN(i)?1:0,x=q):(x=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-x))<1&&(x--,P*=2),(i+=x+H>=1?ee/P:ee*Math.pow(2,1-H))*P>=2&&(x++,P/=2),x+H>=q?(I=0,x=q):x+H>=1?(I=(i*P-1)*Math.pow(2,g),x+=H):(I=i*Math.pow(2,H-1)*Math.pow(2,g),x=0));g>=8;s[l+re]=255&I,re+=ue,I/=256,g-=8);for(x=x<<g|I,B+=g;B>0;s[l+re]=255&x,re+=ue,x/=256,B-=8);s[l+re-ue]|=128*ge};function on(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}on.Varint=0,on.Fixed64=1,on.Bytes=2,on.Fixed32=5;var id=4294967296,pm=1/id,mm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function aa(s){return s.type===on.Bytes?s.readVarint()+s.pos:s.pos+1}function Mc(s,i,l){return l?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function gm(s,i,l){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(f);for(var g=l.pos-1;g>=s;g--)l.buf[g+f]=l.buf[g]}function Ev(s,i){for(var l=0;l<s.length;l++)i.writeVarint(s[l])}function Iv(s,i){for(var l=0;l<s.length;l++)i.writeSVarint(s[l])}function Av(s,i){for(var l=0;l<s.length;l++)i.writeFloat(s[l])}function Mv(s,i){for(var l=0;l<s.length;l++)i.writeDouble(s[l])}function Pv(s,i){for(var l=0;l<s.length;l++)i.writeBoolean(s[l])}function Lv(s,i){for(var l=0;l<s.length;l++)i.writeFixed32(s[l])}function zv(s,i){for(var l=0;l<s.length;l++)i.writeSFixed32(s[l])}function Ov(s,i){for(var l=0;l<s.length;l++)i.writeFixed64(s[l])}function Dv(s,i){for(var l=0;l<s.length;l++)i.writeSFixed64(s[l])}function Vh(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Pc(s,i,l){s[l]=i,s[l+1]=i>>>8,s[l+2]=i>>>16,s[l+3]=i>>>24}function _m(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}on.prototype={destroy:function(){this.buf=null},readFields:function(s,i,l){for(l=l||this.length;this.pos<l;){var f=this.readVarint(),g=f>>3,w=this.pos;this.type=7&f,s(g,i,this),this.pos===w&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Vh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=_m(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Vh(this.buf,this.pos)+Vh(this.buf,this.pos+4)*id;return this.pos+=8,s},readSFixed64:function(){var s=Vh(this.buf,this.pos)+_m(this.buf,this.pos+4)*id;return this.pos+=8,s},readFloat:function(){var s=fm(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=fm(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,l,f=this.buf;return i=127&(l=f[this.pos++]),l<128?i:(i|=(127&(l=f[this.pos++]))<<7,l<128?i:(i|=(127&(l=f[this.pos++]))<<14,l<128?i:(i|=(127&(l=f[this.pos++]))<<21,l<128?i:function(g,w,x){var I,P,B=x.buf;if(I=(112&(P=B[x.pos++]))>>4,P<128||(I|=(127&(P=B[x.pos++]))<<3,P<128)||(I|=(127&(P=B[x.pos++]))<<10,P<128)||(I|=(127&(P=B[x.pos++]))<<17,P<128)||(I|=(127&(P=B[x.pos++]))<<24,P<128)||(I|=(1&(P=B[x.pos++]))<<31,P<128))return Mc(g,I,w);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&mm?function(l,f,g){return mm.decode(l.subarray(f,g))}(this.buf,i,s):function(l,f,g){for(var w="",x=f;x<g;){var I,P,B,q=l[x],H=null,ee=q>239?4:q>223?3:q>191?2:1;if(x+ee>g)break;ee===1?q<128&&(H=q):ee===2?(192&(I=l[x+1]))==128&&(H=(31&q)<<6|63&I)<=127&&(H=null):ee===3?(P=l[x+2],(192&(I=l[x+1]))==128&&(192&P)==128&&((H=(15&q)<<12|(63&I)<<6|63&P)<=2047||H>=55296&&H<=57343)&&(H=null)):ee===4&&(P=l[x+2],B=l[x+3],(192&(I=l[x+1]))==128&&(192&P)==128&&(192&B)==128&&((H=(15&q)<<18|(63&I)<<12|(63&P)<<6|63&B)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,ee=1):H>65535&&(H-=65536,w+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),w+=String.fromCharCode(H),x+=ee}return w}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==on.Bytes)return s.push(this.readVarint(i));var l=aa(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==on.Bytes)return s.push(this.readSVarint());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==on.Bytes)return s.push(this.readBoolean());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==on.Bytes)return s.push(this.readFloat());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==on.Bytes)return s.push(this.readDouble());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==on.Bytes)return s.push(this.readFixed32());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==on.Bytes)return s.push(this.readSFixed32());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==on.Bytes)return s.push(this.readFixed64());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==on.Bytes)return s.push(this.readSFixed64());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===on.Varint)for(;this.buf[this.pos++]>127;);else if(i===on.Bytes)this.pos=this.readVarint()+this.pos;else if(i===on.Fixed32)this.pos+=4;else{if(i!==on.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Pc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Pc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Pc(this.buf,-1&s,this.pos),Pc(this.buf,Math.floor(s*pm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Pc(this.buf,-1&s,this.pos),Pc(this.buf,Math.floor(s*pm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,l){var f,g;if(i>=0?(f=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(w,x,I){I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,I.buf[I.pos]=127&(w>>>=7)}(f,0,l),function(w,x){var I=(7&w)<<4;x.buf[x.pos++]|=I|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(g,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,g,w){for(var x,I,P=0;P<g.length;P++){if((x=g.charCodeAt(P))>55295&&x<57344){if(!I){x>56319||P+1===g.length?(f[w++]=239,f[w++]=191,f[w++]=189):I=x;continue}if(x<56320){f[w++]=239,f[w++]=191,f[w++]=189,I=x;continue}x=I-55296<<10|x-56320|65536,I=null}else I&&(f[w++]=239,f[w++]=191,f[w++]=189,I=null);x<128?f[w++]=x:(x<2048?f[w++]=x>>6|192:(x<65536?f[w++]=x>>12|224:(f[w++]=x>>18|240,f[w++]=x>>12&63|128),f[w++]=x>>6&63|128),f[w++]=63&x|128)}return w}(this.buf,s,this.pos);var l=this.pos-i;l>=128&&gm(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),dm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),dm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,i){this.pos++;var l=this.pos;s(i,this);var f=this.pos-l;f>=128&&gm(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,l){this.writeTag(s,on.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,Ev,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,Iv,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,Pv,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,Av,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,Mv,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,Lv,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,zv,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,Ov,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,Dv,i)},writeBytesField:function(s,i){this.writeTag(s,on.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,on.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,on.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,on.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,on.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,on.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,on.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,on.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,on.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,on.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var nd=_(hm);const rd=3;function Fv(s,i,l){s===1&&l.readMessage(Rv,i)}function Rv(s,i,l){if(s===3){const{id:f,bitmap:g,width:w,height:x,left:I,top:P,advance:B}=l.readMessage(Bv,{});i.push({id:f,bitmap:new Ou({width:w+2*rd,height:x+2*rd},g),metrics:{width:w,height:x,left:I,top:P,advance:B}})}}function Bv(s,i,l){s===1?i.id=l.readVarint():s===2?i.bitmap=l.readBytes():s===3?i.width=l.readVarint():s===4?i.height=l.readVarint():s===5?i.left=l.readSVarint():s===6?i.top=l.readSVarint():s===7&&(i.advance=l.readVarint())}const ym=rd;function bm(s){let i=0,l=0;for(const x of s)i+=x.w*x.h,l=Math.max(l,x.w);s.sort((x,I)=>I.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let g=0,w=0;for(const x of s)for(let I=f.length-1;I>=0;I--){const P=f[I];if(!(x.w>P.w||x.h>P.h)){if(x.x=P.x,x.y=P.y,w=Math.max(w,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===P.w&&x.h===P.h){const B=f.pop();I<f.length&&(f[I]=B)}else x.h===P.h?(P.x+=x.w,P.w-=x.w):x.w===P.w?(P.y+=x.h,P.h-=x.h):(f.push({x:P.x+x.w,y:P.y,w:P.w-x.w,h:x.h}),P.y+=x.h,P.h-=x.h);break}}return{w:g,h:w,fill:i/(g*w)||0}}const Kr=1;class sd{constructor(i,{pixelRatio:l,version:f,stretchX:g,stretchY:w,content:x,textFitWidth:I,textFitHeight:P}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=g,this.stretchY=w,this.content=x,this.version=f,this.textFitWidth=I,this.textFitHeight=P}get tl(){return[this.paddedRect.x+Kr,this.paddedRect.y+Kr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Kr,this.paddedRect.y+this.paddedRect.h-Kr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Kr)/this.pixelRatio,(this.paddedRect.h-2*Kr)/this.pixelRatio]}}class vm{constructor(i,l){const f={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(i,f,w),this.addImages(l,g,w);const{w:x,h:I}=bm(w),P=new vs({width:x||1,height:I||1});for(const B in i){const q=i[B],H=f[B].paddedRect;vs.copy(q.data,P,{x:0,y:0},{x:H.x+Kr,y:H.y+Kr},q.data)}for(const B in l){const q=l[B],H=g[B].paddedRect,ee=H.x+Kr,re=H.y+Kr,ue=q.data.width,ge=q.data.height;vs.copy(q.data,P,{x:0,y:0},{x:ee,y:re},q.data),vs.copy(q.data,P,{x:0,y:ge-1},{x:ee,y:re-1},{width:ue,height:1}),vs.copy(q.data,P,{x:0,y:0},{x:ee,y:re+ge},{width:ue,height:1}),vs.copy(q.data,P,{x:ue-1,y:0},{x:ee-1,y:re},{width:1,height:ge}),vs.copy(q.data,P,{x:0,y:0},{x:ee+ue,y:re},{width:1,height:ge})}this.image=P,this.iconPositions=f,this.patternPositions=g}addImages(i,l,f){for(const g in i){const w=i[g],x={x:0,y:0,w:w.data.width+2*Kr,h:w.data.height+2*Kr};f.push(x),l[g]=new sd(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),l)}patchUpdatedImage(i,l,f){if(!i||!l||i.version===l.version)return;i.version=l.version;const[g,w]=i.tl;f.update(l.data,void 0,{x:g,y:w})}}var Ja;Zt("ImagePosition",sd),Zt("ImageAtlas",vm),h.ah=void 0,(Ja=h.ah||(h.ah={}))[Ja.none=0]="none",Ja[Ja.horizontal=1]="horizontal",Ja[Ja.vertical=2]="vertical",Ja[Ja.horizontalOnly=3]="horizontalOnly";const Uu=-17;class Vu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const f=new Vu;return f.scale=i||1,f.fontStack=l,f}static forImage(i){const l=new Vu;return l.imageName=i,l}}class Lc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const f=new Lc;for(let g=0;g<i.sections.length;g++){const w=i.sections[g];w.image?f.addImageSection(w):f.addTextSection(w,l)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,w=i.charCodeAt(f-1)||null;l+=g&&Ih(g)&&!ju[i[f+1]]||w&&Ih(w)&&!ju[i[f-1]]||!ju[i[f]]?i[f]:ju[i[f]]}return l}(this.text)}trim(){let i=0;for(let f=0;f<this.text.length&&Zh[this.text.charCodeAt(f)];f++)i++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Zh[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const f=new Lc;return f.text=this.text.substring(i,l),f.sectionIndex=this.sectionIndex.slice(i,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(Vu.forText(i.scale,i.fontStack||l));const f=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(f)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void le("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Vu.forImage(l)),this.sectionIndex.push(this.sections.length-1)):le("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qh(s,i,l,f,g,w,x,I,P,B,q,H,ee,re,ue){const ge=Lc.fromFeature(s,g);let Ee;H===h.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:ze,processStyledBidirectionalText:tt}=Hr;if(ze&&ge.sections.length===1){Ee=[];const ht=ze(ge.toString(),od(ge,B,w,i,f,re));for(const xt of ht){const jt=new Lc;jt.text=xt,jt.sections=ge.sections;for(let hi=0;hi<xt.length;hi++)jt.sectionIndex.push(0);Ee.push(jt)}}else if(tt){Ee=[];const ht=tt(ge.text,ge.sectionIndex,od(ge,B,w,i,f,re));for(const xt of ht){const jt=new Lc;jt.text=xt[0],jt.sectionIndex=xt[1],jt.sections=ge.sections,Ee.push(jt)}}else Ee=function(ht,xt){const jt=[],hi=ht.text;let Rt=0;for(const Dt of xt)jt.push(ht.substring(Rt,Dt)),Rt=Dt;return Rt<hi.length&&jt.push(ht.substring(Rt,hi.length)),jt}(ge,od(ge,B,w,i,f,re));const qe=[],Qe={positionedLines:qe,text:ge.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(ht,xt,jt,hi,Rt,Dt,ei,Gt,qt,_t,ti,$t){let vi=0,un=Uu,an=0,Kn=0;const js=Gt==="right"?1:Gt==="left"?0:.5;let fr=0;for(const Ln of Rt){Ln.trim();const Yn=Ln.getMaxScale(),Tr=(Yn-1)*Zn,dr={positionedGlyphs:[],lineOffset:0};ht.positionedLines[fr]=dr;const Nr=dr.positionedGlyphs;let pr=0;if(!Ln.length()){un+=Dt,++fr;continue}for(let Jr=0;Jr<Ln.length();Jr++){const Yi=Ln.getSection(Jr),dn=Ln.getSectionIndex(Jr),bn=Ln.getCharCode(Jr);let fs=0,An=null,Fc=null,Po=null,Lo=Zn;const Us=!(qt===h.ah.horizontal||!ti&&!Eu(bn)||ti&&(Zh[bn]||(Jn=bn,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Jn)))));if(Yi.imageName){const ks=hi[Yi.imageName];if(!ks)continue;Po=Yi.imageName,ht.iconsInText=ht.iconsInText||!0,Fc=ks.paddedRect;const rr=ks.displaySize;Yi.scale=Yi.scale*Zn/$t,An={width:rr[0],height:rr[1],left:Kr,top:-ym,advance:Us?rr[1]:rr[0]},fs=Tr+(Zn-rr[1]*Yi.scale),Lo=An.advance;const la=Us?rr[0]*Yi.scale-Zn*Yn:rr[1]*Yi.scale-Zn*Yn;la>0&&la>pr&&(pr=la)}else{const ks=jt[Yi.fontStack],rr=ks&&ks[bn];if(rr&&rr.rect)Fc=rr.rect,An=rr.metrics;else{const la=xt[Yi.fontStack],Xu=la&&la[bn];if(!Xu)continue;An=Xu.metrics}fs=(Yn-Yi.scale)*Zn}Us?(ht.verticalizable=!0,Nr.push({glyph:bn,imageName:Po,x:vi,y:un+fs,vertical:Us,scale:Yi.scale,fontStack:Yi.fontStack,sectionIndex:dn,metrics:An,rect:Fc}),vi+=Lo*Yi.scale+_t):(Nr.push({glyph:bn,imageName:Po,x:vi,y:un+fs,vertical:Us,scale:Yi.scale,fontStack:Yi.fontStack,sectionIndex:dn,metrics:An,rect:Fc}),vi+=An.advance*Yi.scale+_t)}Nr.length!==0&&(an=Math.max(vi-_t,an),Vv(Nr,0,Nr.length-1,js,pr)),vi=0;const xs=Dt*Yn+pr;dr.lineOffset=Math.max(pr,Tr),un+=xs,Kn=Math.max(xs,Kn),++fr}var Jn;const Fr=un-Uu,{horizontalAlign:Rr,verticalAlign:Br}=ad(ei);(function(Ln,Yn,Tr,dr,Nr,pr,xs,Jr,Yi){const dn=(Yn-Tr)*Nr;let bn=0;bn=pr!==xs?-Jr*dr-Uu:(-dr*Yi+.5)*xs;for(const fs of Ln)for(const An of fs.positionedGlyphs)An.x+=dn,An.y+=bn})(ht.positionedLines,js,Rr,Br,an,Kn,Dt,Fr,Rt.length),ht.top+=-Br*Fr,ht.bottom=ht.top+Fr,ht.left+=-Rr*an,ht.right=ht.left+an}(Qe,i,l,f,Ee,x,I,P,H,B,ee,ue),!function(ht){for(const xt of ht)if(xt.positionedGlyphs.length!==0)return!1;return!0}(qe)&&Qe}const Zh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Nv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},jv={40:!0};function wm(s,i,l,f,g,w){if(i.imageName){const x=f[i.imageName];return x?x.displaySize[0]*i.scale*Zn/w+g:0}{const x=l[i.fontStack],I=x&&x[s];return I?I.metrics.advance*i.scale+g:0}}function xm(s,i,l,f){const g=Math.pow(s-i,2);return f?s<i?g/2:2*g:g+Math.abs(l)*l}function Uv(s,i,l){let f=0;return s===10&&(f-=1e4),l&&(f+=150),s!==40&&s!==65288||(f+=50),i!==41&&i!==65289||(f+=50),f}function km(s,i,l,f,g,w){let x=null,I=xm(i,l,g,w);for(const P of f){const B=xm(i-P.x,l,g,w)+P.badness;B<=I&&(x=P,I=B)}return{index:s,x:i,priorBreak:x,badness:I}}function Sm(s){return s?Sm(s.priorBreak).concat(s.index):[]}function od(s,i,l,f,g,w){if(!s)return[];const x=[],I=function(H,ee,re,ue,ge,Ee){let ze=0;for(let tt=0;tt<H.length();tt++){const qe=H.getSection(tt);ze+=wm(H.getCharCode(tt),qe,ue,ge,ee,Ee)}return ze/Math.max(1,Math.ceil(ze/re))}(s,i,l,f,g,w),P=s.text.indexOf("")>=0;let B=0;for(let H=0;H<s.length();H++){const ee=s.getSection(H),re=s.getCharCode(H);if(Zh[re]||(B+=wm(re,ee,f,g,i,w)),H<s.length()-1){const ue=!((q=re)<11904)&&(!!qi["CJK Compatibility Forms"](q)||!!qi["CJK Compatibility"](q)||!!qi["CJK Strokes"](q)||!!qi["CJK Symbols and Punctuation"](q)||!!qi["Enclosed CJK Letters and Months"](q)||!!qi["Halfwidth and Fullwidth Forms"](q)||!!qi["Ideographic Description Characters"](q)||!!qi["Vertical Forms"](q)||Eh.test(String.fromCodePoint(q)));(Nv[re]||ue||ee.imageName||H!==s.length()-2&&jv[s.getCharCode(H+1)])&&x.push(km(H+1,B,I,x,Uv(re,s.getCharCode(H+1),ue&&P),!1))}}var q;return Sm(km(s.length(),B,I,x,0,!0))}function ad(s){let i=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function Vv(s,i,l,f,g){if(!f&&!g)return;const w=s[l],x=(s[l].x+w.metrics.advance*w.scale)*f;for(let I=i;I<=l;I++)s[I].x-=x,s[I].y+=g}function qv(s,i,l){const{horizontalAlign:f,verticalAlign:g}=ad(l),w=i[0]-s.displaySize[0]*f,x=i[1]-s.displaySize[1]*g;return{image:s,top:x,bottom:x+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function Tm(s){var i,l;let f=s.left,g=s.top,w=s.right-f,x=s.bottom-g;const I=(i=s.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",P=(l=s.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",B=(s.image.content[2]-s.image.content[0])/(s.image.content[3]-s.image.content[1]);if(P==="proportional"){if(I==="stretchOnly"&&w/x<B||I==="proportional"){const q=Math.ceil(x*B);f*=q/w,w=q}}else if(I==="proportional"&&P==="stretchOnly"&&B!==0&&w/x>B){const q=Math.ceil(w/B);g*=q/x,x=q}return{x1:f,y1:g,x2:f+w,y2:g+x}}function Cm(s,i,l,f,g,w){const x=s.image;let I;if(x.content){const Ee=x.content,ze=x.pixelRatio||1;I=[Ee[0]/ze,Ee[1]/ze,x.displaySize[0]-Ee[2]/ze,x.displaySize[1]-Ee[3]/ze]}const P=i.left*w,B=i.right*w;let q,H,ee,re;l==="width"||l==="both"?(re=g[0]+P-f[3],H=g[0]+B+f[1]):(re=g[0]+(P+B-x.displaySize[0])/2,H=re+x.displaySize[0]);const ue=i.top*w,ge=i.bottom*w;return l==="height"||l==="both"?(q=g[1]+ue-f[0],ee=g[1]+ge+f[2]):(q=g[1]+(ue+ge-x.displaySize[1])/2,ee=q+x.displaySize[1]),{image:x,top:q,right:H,bottom:ee,left:re,collisionPadding:I}}const qu=255,Mo=128,Ya=qu*Mo;function Em(s,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new mn(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=l;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let x=w;for(;x<f.length&&f[x]<s+1;)x++;x=Math.min(f.length-1,x);const I=f[w],P=f[x];return l.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:P,interpolationType:g}:{kind:"camera",minZoom:I,maxZoom:P,minSize:l.evaluate(new mn(I)),maxSize:l.evaluate(new mn(P)),interpolationType:g}}}function ld(s,i,l){let f="never";const g=s.get(i);return g?f=g:s.get(l)&&(f="always"),f}const Zv=Ka.VectorTileFeature.types,Wv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wh(s,i,l,f,g,w,x,I,P,B,q,H,ee){const re=I?Math.min(Ya,Math.round(I[0])):0,ue=I?Math.min(Ya,Math.round(I[1])):0;s.emplaceBack(i,l,Math.round(32*f),Math.round(32*g),w,x,(re<<1)+(P?1:0),ue,16*B,16*q,256*H,256*ee)}function cd(s,i,l){s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l)}function Gv(s){for(const i of s.sections)if(Rf(i.text))return!0;return!1}class ud{constructor(i){this.layoutVertexArray=new wc,this.indexArray=new bs,this.programConfigurations=i,this.segments=new Zi,this.dynamicLayoutVertexArray=new Mu,this.opacityVertexArray=new us,this.hasVisibleVertices=!1,this.placedSymbolArray=new gn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,xv.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,kv.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Wv,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",ud);class hd{constructor(i,l,f){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new f,this.segments=new Zi,this.collisionVertexArray=new Io}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Sv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",hd);class zc{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zf([]),this.placementViewportMatrix=Zf([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Em(this.zoom,l["text-size"]),this.iconSizeData=Em(this.zoom,l["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=ld(f,"text-overlap","text-allow-overlap")!=="never"||ld(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(x=>h.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID}createArrays(){this.text=new ud(new Il(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new ud(new Il(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new _n,this.lineVertexArray=new lr,this.symbolInstances=new Vi,this.textAnchorOffsets=new yn}calculateGlyphDependencies(i,l,f,g,w){for(let x=0;x<i.length;x++)if(l[i.charCodeAt(x)]=!0,(f||g)&&w){const I=ju[i.charAt(x)];I&&(l[I.charCodeAt(0)]=!0)}}populate(i,l,f){const g=this.layers[0],w=g.layout,x=w.get("text-font"),I=w.get("text-field"),P=w.get("icon-image"),B=(I.value.kind!=="constant"||I.value.value instanceof Vn&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),q=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,H=w.get("symbol-sort-key");if(this.features=[],!B&&!q)return;const ee=l.iconDependencies,re=l.glyphDependencies,ue=l.availableImages,ge=new mn(this.zoom);for(const{feature:Ee,id:ze,index:tt,sourceLayerIndex:qe}of i){const Qe=g._featureFilter.needGeometry,ht=Ml(Ee,Qe);if(!g._featureFilter.filter(ge,ht,f))continue;let xt,jt;if(Qe||(ht.geometry=Al(Ee)),B){const Rt=g.getValueAndResolveTokens("text-field",ht,f,ue),Dt=Vn.factory(Rt),ei=this.hasRTLText=this.hasRTLText||Gv(Dt);(!ei||Hr.getRTLTextPluginStatus()==="unavailable"||ei&&Hr.isParsed())&&(xt=Cv(Dt,g,ht))}if(q){const Rt=g.getValueAndResolveTokens("icon-image",ht,f,ue);jt=Rt instanceof Xn?Rt:Xn.fromString(Rt)}if(!xt&&!jt)continue;const hi=this.sortFeaturesByKey?H.evaluate(ht,{},f):void 0;if(this.features.push({id:ze,text:xt,icon:jt,index:tt,sourceLayerIndex:qe,geometry:ht.geometry,properties:Ee.properties,type:Zv[Ee.type],sortKey:hi}),jt&&(ee[jt.name]=!0),xt){const Rt=x.evaluate(ht,{},f).join(","),Dt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.ah.vertical)>=0;for(const ei of xt.sections)if(ei.image)ee[ei.image.name]=!0;else{const Gt=Tu(xt.toString()),qt=ei.fontStack||Rt,_t=re[qt]=re[qt]||{};this.calculateGlyphDependencies(ei.text,_t,Dt,this.allowVerticalPlacement,Gt)}}}w.get("symbol-placement")==="line"&&(this.features=function(Ee){const ze={},tt={},qe=[];let Qe=0;function ht(Rt){qe.push(Ee[Rt]),Qe++}function xt(Rt,Dt,ei){const Gt=tt[Rt];return delete tt[Rt],tt[Dt]=Gt,qe[Gt].geometry[0].pop(),qe[Gt].geometry[0]=qe[Gt].geometry[0].concat(ei[0]),Gt}function jt(Rt,Dt,ei){const Gt=ze[Dt];return delete ze[Dt],ze[Rt]=Gt,qe[Gt].geometry[0].shift(),qe[Gt].geometry[0]=ei[0].concat(qe[Gt].geometry[0]),Gt}function hi(Rt,Dt,ei){const Gt=ei?Dt[0][Dt[0].length-1]:Dt[0][0];return`${Rt}:${Gt.x}:${Gt.y}`}for(let Rt=0;Rt<Ee.length;Rt++){const Dt=Ee[Rt],ei=Dt.geometry,Gt=Dt.text?Dt.text.toString():null;if(!Gt){ht(Rt);continue}const qt=hi(Gt,ei),_t=hi(Gt,ei,!0);if(qt in tt&&_t in ze&&tt[qt]!==ze[_t]){const ti=jt(qt,_t,ei),$t=xt(qt,_t,qe[ti].geometry);delete ze[qt],delete tt[_t],tt[hi(Gt,qe[$t].geometry,!0)]=$t,qe[ti].geometry=null}else qt in tt?xt(qt,_t,ei):_t in ze?jt(qt,_t,ei):(ht(Rt),ze[qt]=Qe-1,tt[_t]=Qe-1)}return qe.filter(Rt=>Rt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ee,ze)=>Ee.sortKey-ze.sortKey)}update(i,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,f),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const f=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(l[i.segment+1]),w=i.dist(l[i.segment]);const x={};for(let I=i.segment+1;I<l.length;I++)x[I]={x:l[I].x,y:l[I].y,tileUnitDistanceFromAnchor:g},I<l.length-1&&(g+=l[I+1].dist(l[I]));for(let I=i.segment||0;I>=0;I--)x[I]={x:l[I].x,y:l[I].y,tileUnitDistanceFromAnchor:w},I>0&&(w+=l[I-1].dist(l[I]));for(let I=0;I<l.length;I++){const P=x[I];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,l,f,g,w,x,I,P,B,q,H,ee){const re=i.indexArray,ue=i.layoutVertexArray,ge=i.segments.prepareSegment(4*l.length,ue,re,this.canOverlap?x.sortKey:void 0),Ee=this.glyphOffsetArray.length,ze=ge.vertexLength,tt=this.allowVerticalPlacement&&I===h.ah.vertical?Math.PI/2:0,qe=x.text&&x.text.sections;for(let Qe=0;Qe<l.length;Qe++){const{tl:ht,tr:xt,bl:jt,br:hi,tex:Rt,pixelOffsetTL:Dt,pixelOffsetBR:ei,minFontScaleX:Gt,minFontScaleY:qt,glyphOffset:_t,isSDF:ti,sectionIndex:$t}=l[Qe],vi=ge.vertexLength,un=_t[1];Wh(ue,P.x,P.y,ht.x,un+ht.y,Rt.x,Rt.y,f,ti,Dt.x,Dt.y,Gt,qt),Wh(ue,P.x,P.y,xt.x,un+xt.y,Rt.x+Rt.w,Rt.y,f,ti,ei.x,Dt.y,Gt,qt),Wh(ue,P.x,P.y,jt.x,un+jt.y,Rt.x,Rt.y+Rt.h,f,ti,Dt.x,ei.y,Gt,qt),Wh(ue,P.x,P.y,hi.x,un+hi.y,Rt.x+Rt.w,Rt.y+Rt.h,f,ti,ei.x,ei.y,Gt,qt),cd(i.dynamicLayoutVertexArray,P,tt),re.emplaceBack(vi,vi+1,vi+2),re.emplaceBack(vi+1,vi+2,vi+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_t[0]),Qe!==l.length-1&&$t===l[Qe+1].sectionIndex||i.programConfigurations.populatePaintArrays(ue.length,x,x.index,{},ee,qe&&qe[$t])}i.placedSymbolArray.emplaceBack(P.x,P.y,Ee,this.glyphOffsetArray.length-Ee,ze,B,q,P.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],I,0,!1,0,H)}_addCollisionDebugVertex(i,l,f,g,w,x){return l.emplaceBack(0,0),i.emplaceBack(f.x,f.y,g,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(i,l,f,g,w,x,I){const P=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),B=P.vertexLength,q=w.layoutVertexArray,H=w.collisionVertexArray,ee=I.anchorX,re=I.anchorY;this._addCollisionDebugVertex(q,H,x,ee,re,new y(i,l)),this._addCollisionDebugVertex(q,H,x,ee,re,new y(f,l)),this._addCollisionDebugVertex(q,H,x,ee,re,new y(f,g)),this._addCollisionDebugVertex(q,H,x,ee,re,new y(i,g)),P.vertexLength+=4;const ue=w.indexArray;ue.emplaceBack(B,B+1),ue.emplaceBack(B+1,B+2),ue.emplaceBack(B+2,B+3),ue.emplaceBack(B+3,B),P.primitiveLength+=4}addDebugCollisionBoxes(i,l,f,g){for(let w=i;w<l;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hd(hs,um.members,nr),this.iconCollisionBox=new hd(hs,um.members,nr);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,f,g,w,x,I,P,B){const q={};for(let H=l;H<f;H++){const ee=i.get(H);q.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},q.textFeatureIndex=ee.featureIndex;break}for(let H=g;H<w;H++){const ee=i.get(H);q.verticalTextBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},q.verticalTextFeatureIndex=ee.featureIndex;break}for(let H=x;H<I;H++){const ee=i.get(H);q.iconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},q.iconFeatureIndex=ee.featureIndex;break}for(let H=P;H<B;H++){const ee=i.get(H);q.verticalIconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},q.verticalIconFeatureIndex=ee.featureIndex;break}return q}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const f=i.placedSymbolArray.get(l),g=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<g;w+=4)i.indexArray.emplaceBack(w,w+1,w+2),i.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),f=Math.cos(i),g=[],w=[],x=[];for(let I=0;I<this.symbolInstances.length;++I){x.push(I);const P=this.symbolInstances.get(I);g.push(0|Math.round(l*P.anchorX+f*P.anchorY)),w.push(P.featureIndex)}return x.sort((I,P)=>g[I]-g[P]||w[P]-w[I]),x}addToSortKeyRanges(i,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,w,x)=>{g>=0&&x.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Im,Am;Zt("SymbolBucket",zc,{omit:["layers","collisionBoxArray","features","compareText"]}),zc.MAX_GLYPHS=65535,zc.addDynamicAttributes=cd;var fd={get paint(){return Am=Am||new v({"icon-opacity":new di($e.paint_symbol["icon-opacity"]),"icon-color":new di($e.paint_symbol["icon-color"]),"icon-halo-color":new di($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new di($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new di($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Kt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Kt($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new di($e.paint_symbol["text-opacity"]),"text-color":new di($e.paint_symbol["text-color"],{runtimeType:sn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new di($e.paint_symbol["text-halo-color"]),"text-halo-width":new di($e.paint_symbol["text-halo-width"]),"text-halo-blur":new di($e.paint_symbol["text-halo-blur"]),"text-translate":new Kt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Kt($e.paint_symbol["text-translate-anchor"])})},get layout(){return Im=Im||new v({"symbol-placement":new Kt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Kt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Kt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new di($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Kt($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Kt($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Kt($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Kt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Kt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Kt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new di($e.layout_symbol["icon-size"]),"icon-text-fit":new Kt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new di($e.layout_symbol["icon-image"]),"icon-rotate":new di($e.layout_symbol["icon-rotate"]),"icon-padding":new di($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Kt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new di($e.layout_symbol["icon-offset"]),"icon-anchor":new di($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Kt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Kt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Kt($e.layout_symbol["text-rotation-alignment"]),"text-field":new di($e.layout_symbol["text-field"]),"text-font":new di($e.layout_symbol["text-font"]),"text-size":new di($e.layout_symbol["text-size"]),"text-max-width":new di($e.layout_symbol["text-max-width"]),"text-line-height":new Kt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new di($e.layout_symbol["text-letter-spacing"]),"text-justify":new di($e.layout_symbol["text-justify"]),"text-radial-offset":new di($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Kt($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new di($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new di($e.layout_symbol["text-anchor"]),"text-max-angle":new Kt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Kt($e.layout_symbol["text-writing-mode"]),"text-rotate":new di($e.layout_symbol["text-rotate"]),"text-padding":new Kt($e.layout_symbol["text-padding"]),"text-keep-upright":new Kt($e.layout_symbol["text-keep-upright"]),"text-transform":new di($e.layout_symbol["text-transform"]),"text-offset":new di($e.layout_symbol["text-offset"]),"text-allow-overlap":new Kt($e.layout_symbol["text-allow-overlap"]),"text-overlap":new Kt($e.layout_symbol["text-overlap"]),"text-ignore-placement":new Kt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Kt($e.layout_symbol["text-optional"])})}};class Mm{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Cn,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",Mm,{omit:["defaultValue"]});class Gh extends u{constructor(i){super(i,fd)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const w of f)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,f,g){const w=this.layout.get(i).evaluate(l,{},f,g),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||Oa(x.value)||!w?w:function(I,P){return P.replace(/{([^{}]+)}/g,(B,q)=>I&&q in I?String(I[q]):"")}(l.properties,w)}createBucket(i){return new zc(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of fd.paint.overridableProperties){if(!Gh.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),f=new Mm(l),g=new So(f,l.property.specification);let w=null;w=l.value.kind==="constant"||l.value.kind==="source"?new vr("source",g):new To("composite",g,l.value.zoomStops),this.paint._values[i]=new Bs(l.property,w,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&Gh.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const f=i.get("text-field"),g=fd.paint.properties[l];let w=!1;const x=I=>{for(const P of I)if(g.overrides&&g.overrides.hasOverride(P))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Vn)x(f.value.value.sections);else if(f.value.kind==="source"){const I=B=>{w||(B instanceof ar&&Ii(B.value)===br?x(B.value.sections):B instanceof Vo?x(B.sections):B.eachChild(I))},P=f.value;P._styleExpression&&I(P._styleExpression.expression)}return w}}let Pm;var Hv={get paint(){return Pm=Pm||new v({"background-color":new Kt($e.paint_background["background-color"]),"background-pattern":new bc($e.paint_background["background-pattern"]),"background-opacity":new Kt($e.paint_background["background-opacity"])})}};class Xv extends u{constructor(i){super(i,Hv)}}let Lm;var Kv={get paint(){return Lm=Lm||new v({"raster-opacity":new Kt($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Kt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Kt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Kt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Kt($e.paint_raster["raster-saturation"]),"raster-contrast":new Kt($e.paint_raster["raster-contrast"]),"raster-resampling":new Kt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Kt($e.paint_raster["raster-fade-duration"])})}};class Jv extends u{constructor(i){super(i,Kv)}}class Yv extends u{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Qv{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const dd=63710088e-1;class Qa{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qa($(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,f=this.lat*l,g=i.lat*l,w=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((i.lng-this.lng)*l);return dd*Math.acos(Math.min(w,1))}static convert(i){if(i instanceof Qa)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Qa(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Qa(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const zm=2*Math.PI*dd;function Om(s){return zm*Math.cos(s*Math.PI/180)}function Dm(s){return(180+s)/360}function Fm(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Rm(s,i){return s/Om(i)}function pd(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Zu{constructor(i,l,f=0){this.x=+i,this.y=+l,this.z=+f}static fromLngLat(i,l=0){const f=Qa.convert(i);return new Zu(Dm(f.lng),Fm(f.lat),Rm(l,f.lat))}toLngLat(){return new Qa(360*this.x-180,pd(this.y))}toAltitude(){return this.z*Om(pd(this.y))}meterInMercatorCoordinateUnits(){return 1/zm*(i=pd(this.y),1/Math.cos(i*Math.PI/180));var i}}function Bm(s,i,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class md{constructor(i,l,f){if(!function(g,w,x){return!(g<0||g>25||x<0||x>=Math.pow(2,g)||w<0||w>=Math.pow(2,g))}(i,l,f))throw new Error(`x=${l}, y=${f}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=f,this.key=Wu(0,i,i,l,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,f){const g=(x=this.y,I=this.z,P=Bm(256*(w=this.x),256*(x=Math.pow(2,I)-x-1),I),B=Bm(256*(w+1),256*(x+1),I),P[0]+","+P[1]+","+B[0]+","+B[1]);var w,x,I,P,B;const q=function(H,ee,re){let ue,ge="";for(let Ee=H;Ee>0;Ee--)ue=1<<Ee-1,ge+=(ee&ue?1:0)+(re&ue?2:0);return ge}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,q).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new y((i.x*l-this.x)*Nn,(i.y*l-this.y)*Nn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Nm{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Wu(i,l.z,l.z,l.x,l.y)}}class ws{constructor(i,l,f,g,w){if(i<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${f}`);this.overscaledZ=i,this.wrap=l,this.canonical=new md(f,+g,+w),this.key=Wu(l,i,f,g,w)}clone(){return new ws(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new ws(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ws(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-i;return i>this.canonical.z?Wu(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):Wu(this.wrap*+l,i,i,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new ws(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new ws(l,this.wrap,l,f,g),new ws(l,this.wrap,l,f+1,g),new ws(l,this.wrap,l,f,g+1),new ws(l,this.wrap,l,f+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new ws(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new ws(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Nm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Zu(i.x-this.wrap,i.y))}}function Wu(s,i,l,f,g){(s*=2)<0&&(s=-1*s-1);const w=1<<l;return(w*w*s+w*g+f).toString(36)+l.toString(36)+i.toString(36)}Zt("CanonicalTileID",md),Zt("OverscaledTileID",ws,{omit:["posMatrix"]});class jm{constructor(i,l,f,g=1,w=1,x=1,I=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void le(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const P=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=x,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let B=0;B<P;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(P,B)]=this.data[this._idx(P-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,P)]=this.data[this._idx(B,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let B=0;B<P;B++)for(let q=0;q<P;q++){const H=this.get(B,q);H>this.max&&(this.max=H),H<this.min&&(this.min=H)}}get(i,l){const f=new Uint8Array(this.data.buffer),g=4*this._idx(i,l);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}unpack(i,l,f){return i*this.redFactor+l*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new vs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,w=l*this.dim+this.dim,x=f*this.dim,I=f*this.dim+this.dim;switch(l){case-1:g=w-1;break;case 1:w=g+1}switch(f){case-1:x=I-1;break;case 1:I=x+1}const P=-l*this.dim,B=-f*this.dim;for(let q=x;q<I;q++)for(let H=g;H<w;H++)this.data[this._idx(H,q)]=i.data[this._idx(H+P,q+B)]}}Zt("DEMData",jm);class Um{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const f=i[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Vm{constructor(i,l,f,g,w){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=f,i._y=g,this.properties=i.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(i[l]=this[l]);return i}}class qm{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Ba(Nn,16,0),this.grid3D=new Ba(Nn,16,0),this.featureIndexArray=new kr,this.promoteId=l}insert(i,l,f,g,w,x){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,w);const P=x?this.grid3D:this.grid;for(let B=0;B<l.length;B++){const q=l[B],H=[1/0,1/0,-1/0,-1/0];for(let ee=0;ee<q.length;ee++){const re=q[ee];H[0]=Math.min(H[0],re.x),H[1]=Math.min(H[1],re.y),H[2]=Math.max(H[2],re.x),H[3]=Math.max(H[3],re.y)}H[0]<Nn&&H[1]<Nn&&H[2]>=0&&H[3]>=0&&P.insert(I,H[0],H[1],H[2],H[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ka.VectorTile(new nd(this.rawTileData)).layers,this.sourceLayerCoder=new Um(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,f,g){this.loadVTLayers();const w=i.params||{},x=Nn/i.tileSize/i.scale,I=bl(w.filter),P=i.queryGeometry,B=i.queryPadding*x,q=Wm(P),H=this.grid.query(q.minX-B,q.minY-B,q.maxX+B,q.maxY+B),ee=Wm(i.cameraQueryGeometry),re=this.grid3D.query(ee.minX-B,ee.minY-B,ee.maxX+B,ee.maxY+B,(Ee,ze,tt,qe)=>function(Qe,ht,xt,jt,hi){for(const Dt of Qe)if(ht<=Dt.x&&xt<=Dt.y&&jt>=Dt.x&&hi>=Dt.y)return!0;const Rt=[new y(ht,xt),new y(ht,hi),new y(jt,hi),new y(jt,xt)];if(Qe.length>2){for(const Dt of Rt)if(Cc(Qe,Dt))return!0}for(let Dt=0;Dt<Qe.length-1;Dt++)if(Lb(Qe[Dt],Qe[Dt+1],Rt))return!0;return!1}(i.cameraQueryGeometry,Ee-B,ze-B,tt+B,qe+B));for(const Ee of re)H.push(Ee);H.sort($v);const ue={};let ge;for(let Ee=0;Ee<H.length;Ee++){const ze=H[Ee];if(ze===ge)continue;ge=ze;const tt=this.featureIndexArray.get(ze);let qe=null;this.loadMatchingFeature(ue,tt.bucketIndex,tt.sourceLayerIndex,tt.featureIndex,I,w.layers,w.availableImages,l,f,g,(Qe,ht,xt)=>(qe||(qe=Al(Qe)),ht.queryIntersectsFeature(P,Qe,xt,qe,this.z,i.transform,x,i.pixelPosMatrix)))}return ue}loadMatchingFeature(i,l,f,g,w,x,I,P,B,q,H){const ee=this.bucketLayerIDs[l];if(x&&!function(Ee,ze){for(let tt=0;tt<Ee.length;tt++)if(ze.indexOf(Ee[tt])>=0)return!0;return!1}(x,ee))return;const re=this.sourceLayerCoder.decode(f),ue=this.vtLayers[re].feature(g);if(w.needGeometry){const Ee=Ml(ue,!0);if(!w.filter(new mn(this.tileID.overscaledZ),Ee,this.tileID.canonical))return}else if(!w.filter(new mn(this.tileID.overscaledZ),ue))return;const ge=this.getId(ue,re);for(let Ee=0;Ee<ee.length;Ee++){const ze=ee[Ee];if(x&&x.indexOf(ze)<0)continue;const tt=P[ze];if(!tt)continue;let qe={};ge&&q&&(qe=q.getState(tt.sourceLayer||"_geojsonTileLayer",ge));const Qe=te({},B[ze]);Qe.paint=Zm(Qe.paint,tt.paint,ue,qe,I),Qe.layout=Zm(Qe.layout,tt.layout,ue,qe,I);const ht=!H||H(ue,tt,qe);if(!ht)continue;const xt=new Vm(ue,this.z,this.x,this.y,ge);xt.layer=Qe;let jt=i[ze];jt===void 0&&(jt=i[ze]=[]),jt.push({featureIndex:g,feature:xt,intersectionZ:ht})}}lookupSymbolFeatures(i,l,f,g,w,x,I,P){const B={};this.loadVTLayers();const q=bl(w);for(const H of i)this.loadMatchingFeature(B,f,g,H,q,x,I,P,l);return B}hasLayer(i){for(const l of this.bucketLayerIDs)for(const f of l)if(i===f)return!0;return!1}getId(i,l){let f=i.id;return this.promoteId&&(f=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof f=="boolean"&&(f=Number(f))),f}}function Zm(s,i,l,f,g){return j(s,(w,x)=>{const I=i instanceof Tl?i.get(x):null;return I&&I.evaluate?I.evaluate(l,f,g):I})}function Wm(s){let i=1/0,l=1/0,f=-1/0,g=-1/0;for(const w of s)i=Math.min(i,w.x),l=Math.min(l,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);return{minX:i,minY:l,maxX:f,maxY:g}}function $v(s,i){return i-s}function Gm(s,i,l,f,g){const w=[];for(let x=0;x<s.length;x++){const I=s[x];let P;for(let B=0;B<I.length-1;B++){let q=I[B],H=I[B+1];q.x<i&&H.x<i||(q.x<i?q=new y(i,q.y+(i-q.x)/(H.x-q.x)*(H.y-q.y))._round():H.x<i&&(H=new y(i,q.y+(i-q.x)/(H.x-q.x)*(H.y-q.y))._round()),q.y<l&&H.y<l||(q.y<l?q=new y(q.x+(l-q.y)/(H.y-q.y)*(H.x-q.x),l)._round():H.y<l&&(H=new y(q.x+(l-q.y)/(H.y-q.y)*(H.x-q.x),l)._round()),q.x>=f&&H.x>=f||(q.x>=f?q=new y(f,q.y+(f-q.x)/(H.x-q.x)*(H.y-q.y))._round():H.x>=f&&(H=new y(f,q.y+(f-q.x)/(H.x-q.x)*(H.y-q.y))._round()),q.y>=g&&H.y>=g||(q.y>=g?q=new y(q.x+(g-q.y)/(H.y-q.y)*(H.x-q.x),g)._round():H.y>=g&&(H=new y(q.x+(g-q.y)/(H.y-q.y)*(H.x-q.x),g)._round()),P&&q.equals(P[P.length-1])||(P=[q],w.push(P)),P.push(H)))))}}return w}Zt("FeatureIndex",qm,{omit:["rawTileData","sourceLayerCoder"]});class $a extends y{constructor(i,l,f,g){super(i,l),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new $a(this.x,this.y,this.angle,this.segment)}}function Hm(s,i,l,f,g){if(i.segment===void 0||l===0)return!0;let w=i,x=i.segment+1,I=0;for(;I>-l/2;){if(x--,x<0)return!1;I-=s[x].dist(w),w=s[x]}I+=s[x].dist(s[x+1]),x++;const P=[];let B=0;for(;I<l/2;){const q=s[x],H=s[x+1];if(!H)return!1;let ee=s[x-1].angleTo(q)-q.angleTo(H);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:I,angleDelta:ee}),B+=ee;I-P[0].distance>f;)B-=P.shift().angleDelta;if(B>g)return!1;x++,I+=q.dist(H)}return!0}function Xm(s){let i=0;for(let l=0;l<s.length-1;l++)i+=s[l].dist(s[l+1]);return i}function Km(s,i,l){return s?.6*i*l:0}function Jm(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function e1(s,i,l,f,g,w){const x=Km(l,g,w),I=Jm(l,f)*w;let P=0;const B=Xm(s)/2;for(let q=0;q<s.length-1;q++){const H=s[q],ee=s[q+1],re=H.dist(ee);if(P+re>B){const ue=(B-P)/re,ge=qn.number(H.x,ee.x,ue),Ee=qn.number(H.y,ee.y,ue),ze=new $a(ge,Ee,ee.angleTo(H),q);return ze._round(),!x||Hm(s,ze,I,x,i)?ze:void 0}P+=re}}function t1(s,i,l,f,g,w,x,I,P){const B=Km(f,w,x),q=Jm(f,g),H=q*x,ee=s[0].x===0||s[0].x===P||s[0].y===0||s[0].y===P;return i-H<i/4&&(i=H+i/4),Ym(s,ee?i/2*I%i:(q/2+2*w)*x*I%i,i,B,l,H,ee,!1,P)}function Ym(s,i,l,f,g,w,x,I,P){const B=w/2,q=Xm(s);let H=0,ee=i-l,re=[];for(let ue=0;ue<s.length-1;ue++){const ge=s[ue],Ee=s[ue+1],ze=ge.dist(Ee),tt=Ee.angleTo(ge);for(;ee+l<H+ze;){ee+=l;const qe=(ee-H)/ze,Qe=qn.number(ge.x,Ee.x,qe),ht=qn.number(ge.y,Ee.y,qe);if(Qe>=0&&Qe<P&&ht>=0&&ht<P&&ee-B>=0&&ee+B<=q){const xt=new $a(Qe,ht,tt,ue);xt._round(),f&&!Hm(s,xt,w,f,g)||re.push(xt)}}H+=ze}return I||re.length||x||(re=Ym(s,H/2,l,f,g,w,x,!0,P)),re}Zt("Anchor",$a);const Oc=Kr;function Qm(s,i,l,f){const g=[],w=s.image,x=w.pixelRatio,I=w.paddedRect.w-2*Oc,P=w.paddedRect.h-2*Oc;let B={x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};const q=w.stretchX||[[0,I]],H=w.stretchY||[[0,P]],ee=(_t,ti)=>_t+ti[1]-ti[0],re=q.reduce(ee,0),ue=H.reduce(ee,0),ge=I-re,Ee=P-ue;let ze=0,tt=re,qe=0,Qe=ue,ht=0,xt=ge,jt=0,hi=Ee;if(w.content&&f){const _t=w.content,ti=_t[2]-_t[0],$t=_t[3]-_t[1];(w.textFitWidth||w.textFitHeight)&&(B=Tm(s)),ze=Hh(q,0,_t[0]),qe=Hh(H,0,_t[1]),tt=Hh(q,_t[0],_t[2]),Qe=Hh(H,_t[1],_t[3]),ht=_t[0]-ze,jt=_t[1]-qe,xt=ti-tt,hi=$t-Qe}const Rt=B.x1,Dt=B.y1,ei=B.x2-Rt,Gt=B.y2-Dt,qt=(_t,ti,$t,vi)=>{const un=Xh(_t.stretch-ze,tt,ei,Rt),an=Kh(_t.fixed-ht,xt,_t.stretch,re),Kn=Xh(ti.stretch-qe,Qe,Gt,Dt),js=Kh(ti.fixed-jt,hi,ti.stretch,ue),fr=Xh($t.stretch-ze,tt,ei,Rt),Jn=Kh($t.fixed-ht,xt,$t.stretch,re),Fr=Xh(vi.stretch-qe,Qe,Gt,Dt),Rr=Kh(vi.fixed-jt,hi,vi.stretch,ue),Br=new y(un,Kn),Ln=new y(fr,Kn),Yn=new y(fr,Fr),Tr=new y(un,Fr),dr=new y(an/x,js/x),Nr=new y(Jn/x,Rr/x),pr=i*Math.PI/180;if(pr){const Yi=Math.sin(pr),dn=Math.cos(pr),bn=[dn,-Yi,Yi,dn];Br._matMult(bn),Ln._matMult(bn),Tr._matMult(bn),Yn._matMult(bn)}const xs=_t.stretch+_t.fixed,Jr=ti.stretch+ti.fixed;return{tl:Br,tr:Ln,bl:Tr,br:Yn,tex:{x:w.paddedRect.x+Oc+xs,y:w.paddedRect.y+Oc+Jr,w:$t.stretch+$t.fixed-xs,h:vi.stretch+vi.fixed-Jr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:dr,pixelOffsetBR:Nr,minFontScaleX:xt/x/ei,minFontScaleY:hi/x/Gt,isSDF:l}};if(f&&(w.stretchX||w.stretchY)){const _t=$m(q,ge,re),ti=$m(H,Ee,ue);for(let $t=0;$t<_t.length-1;$t++){const vi=_t[$t],un=_t[$t+1];for(let an=0;an<ti.length-1;an++)g.push(qt(vi,ti[an],un,ti[an+1]))}}else g.push(qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:P+1}));return g}function Hh(s,i,l){let f=0;for(const g of s)f+=Math.max(i,Math.min(l,g[1]))-Math.max(i,Math.min(l,g[0]));return f}function $m(s,i,l){const f=[{fixed:-Oc,stretch:0}];for(const[g,w]of s){const x=f[f.length-1];f.push({fixed:g-x.stretch,stretch:x.stretch}),f.push({fixed:g-x.stretch,stretch:x.stretch+(w-g)})}return f.push({fixed:i+Oc,stretch:l}),f}function Xh(s,i,l,f){return s/i*l+f}function Kh(s,i,l,f){return s-i*l/f}class Jh{constructor(i,l,f,g,w,x,I,P,B,q){var H;if(this.boxStartIndex=i.length,B){let ee=x.top,re=x.bottom;const ue=x.collisionPadding;ue&&(ee-=ue[1],re+=ue[3]);let ge=re-ee;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{const ee=!((H=x.image)===null||H===void 0)&&H.content&&(x.image.textFitWidth||x.image.textFitHeight)?Tm(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};ee.y1=ee.y1*I-P[0],ee.y2=ee.y2*I+P[2],ee.x1=ee.x1*I-P[3],ee.x2=ee.x2*I+P[1];const re=x.collisionPadding;if(re&&(ee.x1-=re[0]*I,ee.y1-=re[1]*I,ee.x2+=re[2]*I,ee.y2+=re[3]*I),q){const ue=new y(ee.x1,ee.y1),ge=new y(ee.x2,ee.y1),Ee=new y(ee.x1,ee.y2),ze=new y(ee.x2,ee.y2),tt=q*Math.PI/180;ue._rotate(tt),ge._rotate(tt),Ee._rotate(tt),ze._rotate(tt),ee.x1=Math.min(ue.x,ge.x,Ee.x,ze.x),ee.x2=Math.max(ue.x,ge.x,Ee.x,ze.x),ee.y1=Math.min(ue.y,ge.y,Ee.y,ze.y),ee.y2=Math.max(ue.y,ge.y,Ee.y,ze.y)}i.emplaceBack(l.x,l.y,ee.x1,ee.y1,ee.x2,ee.y2,f,g,w)}this.boxEndIndex=i.length}}class i1{constructor(i=[],l=(f,g)=>f<g?-1:f>g?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:f}=this,g=l[i];for(;i>0;){const w=i-1>>1,x=l[w];if(f(g,x)>=0)break;l[i]=x,i=w}l[i]=g}_down(i){const{data:l,compare:f}=this,g=this.length>>1,w=l[i];for(;i<g;){let x=1+(i<<1);const I=x+1;if(I<this.length&&f(l[I],l[x])<0&&(x=I),f(l[x],w)>=0)break;l[i]=l[x],i=x}l[i]=w}}function n1(s,i=1,l=!1){let f=1/0,g=1/0,w=-1/0,x=-1/0;const I=s[0];for(let re=0;re<I.length;re++){const ue=I[re];(!re||ue.x<f)&&(f=ue.x),(!re||ue.y<g)&&(g=ue.y),(!re||ue.x>w)&&(w=ue.x),(!re||ue.y>x)&&(x=ue.y)}const P=Math.min(w-f,x-g);let B=P/2;const q=new i1([],r1);if(P===0)return new y(f,g);for(let re=f;re<w;re+=P)for(let ue=g;ue<x;ue+=P)q.push(new Dc(re+B,ue+B,B,s));let H=function(re){let ue=0,ge=0,Ee=0;const ze=re[0];for(let tt=0,qe=ze.length,Qe=qe-1;tt<qe;Qe=tt++){const ht=ze[tt],xt=ze[Qe],jt=ht.x*xt.y-xt.x*ht.y;ge+=(ht.x+xt.x)*jt,Ee+=(ht.y+xt.y)*jt,ue+=3*jt}return new Dc(ge/ue,Ee/ue,0,re)}(s),ee=q.length;for(;q.length;){const re=q.pop();(re.d>H.d||!H.d)&&(H=re,l&&console.log("found best %d after %d probes",Math.round(1e4*re.d)/1e4,ee)),re.max-H.d<=i||(B=re.h/2,q.push(new Dc(re.p.x-B,re.p.y-B,B,s)),q.push(new Dc(re.p.x+B,re.p.y-B,B,s)),q.push(new Dc(re.p.x-B,re.p.y+B,B,s)),q.push(new Dc(re.p.x+B,re.p.y+B,B,s)),ee+=4)}return l&&(console.log(`num probes: ${ee}`),console.log(`best distance: ${H.d}`)),H.p}function r1(s,i){return i.max-s.max}function Dc(s,i,l,f){this.p=new y(s,i),this.h=l,this.d=function(g,w){let x=!1,I=1/0;for(let P=0;P<w.length;P++){const B=w[P];for(let q=0,H=B.length,ee=H-1;q<H;ee=q++){const re=B[q],ue=B[ee];re.y>g.y!=ue.y>g.y&&g.x<(ue.x-re.x)*(g.y-re.y)/(ue.y-re.y)+re.x&&(x=!x),I=Math.min(I,Fp(g,re,ue))}}return(x?1:-1)*Math.sqrt(I)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var hr;h.aq=void 0,(hr=h.aq||(h.aq={}))[hr.center=1]="center",hr[hr.left=2]="left",hr[hr.right=3]="right",hr[hr.top=4]="top",hr[hr.bottom=5]="bottom",hr[hr["top-left"]=6]="top-left",hr[hr["top-right"]=7]="top-right",hr[hr["bottom-left"]=8]="bottom-left",hr[hr["bottom-right"]=9]="bottom-right";const el=7,gd=Number.POSITIVE_INFINITY;function eg(s,i){return i[1]!==gd?function(l,f,g){let w=0,x=0;switch(f=Math.abs(f),g=Math.abs(g),l){case"top-right":case"top-left":case"top":x=g-el;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+el}switch(l){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,x]}(s,i[0],i[1]):function(l,f){let g=0,w=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(l){case"top-right":case"top-left":w=x-el;break;case"bottom-right":case"bottom-left":w=-x+el;break;case"bottom":w=-f+el;break;case"top":w=f-el}switch(l){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=f;break;case"right":g=-f}return[g,w]}(s,i[0])}function tg(s,i,l){var f;const g=s.layout,w=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(i,{},l);if(w){const I=w.values,P=[];for(let B=0;B<I.length;B+=2){const q=P[B]=I[B],H=I[B+1].map(ee=>ee*Zn);q.startsWith("top")?H[1]-=el:q.startsWith("bottom")&&(H[1]+=el),P[B+1]=H}return new zn(P)}const x=g.get("text-variable-anchor");if(x){let I;I=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},l)*Zn,gd]:g.get("text-offset").evaluate(i,{},l).map(B=>B*Zn);const P=[];for(const B of x)P.push(B,eg(B,I));return new zn(P)}return null}function _d(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function s1(s,i,l,f,g,w,x,I,P,B,q){let H=w.textMaxSize.evaluate(i,{});H===void 0&&(H=x);const ee=s.layers[0].layout,re=ee.get("icon-offset").evaluate(i,{},q),ue=ng(l.horizontal),ge=x/24,Ee=s.tilePixelRatio*ge,ze=s.tilePixelRatio*H/24,tt=s.tilePixelRatio*I,qe=s.tilePixelRatio*ee.get("symbol-spacing"),Qe=ee.get("text-padding")*s.tilePixelRatio,ht=function(_t,ti,$t,vi=1){const un=_t.get("icon-padding").evaluate(ti,{},$t),an=un&&un.values;return[an[0]*vi,an[1]*vi,an[2]*vi,an[3]*vi]}(ee,i,q,s.tilePixelRatio),xt=ee.get("text-max-angle")/180*Math.PI,jt=ee.get("text-rotation-alignment")!=="viewport"&&ee.get("symbol-placement")!=="point",hi=ee.get("icon-rotation-alignment")==="map"&&ee.get("symbol-placement")!=="point",Rt=ee.get("symbol-placement"),Dt=qe/2,ei=ee.get("icon-text-fit");let Gt;f&&ei!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(Gt=Cm(f,l.vertical,ei,ee.get("icon-text-fit-padding"),re,ge)),ue&&(f=Cm(f,ue,ei,ee.get("icon-text-fit-padding"),re,ge)));const qt=(_t,ti)=>{ti.x<0||ti.x>=Nn||ti.y<0||ti.y>=Nn||function($t,vi,un,an,Kn,js,fr,Jn,Fr,Rr,Br,Ln,Yn,Tr,dr,Nr,pr,xs,Jr,Yi,dn,bn,fs,An,Fc){const Po=$t.addToLineVertexArray(vi,un);let Lo,Us,ks,rr,la=0,Xu=0,ag=0,lg=0,Td=-1,Cd=-1;const ca={};let cg=xc("");if($t.allowVerticalPlacement&&an.vertical){const Cr=Jn.layout.get("text-rotate").evaluate(dn,{},An)+90;ks=new Jh(Fr,vi,Rr,Br,Ln,an.vertical,Yn,Tr,dr,Cr),fr&&(rr=new Jh(Fr,vi,Rr,Br,Ln,fr,pr,xs,dr,Cr))}if(Kn){const Cr=Jn.layout.get("icon-rotate").evaluate(dn,{}),Ss=Jn.layout.get("icon-text-fit")!=="none",Ll=Qm(Kn,Cr,fs,Ss),co=fr?Qm(fr,Cr,fs,Ss):void 0;Us=new Jh(Fr,vi,Rr,Br,Ln,Kn,pr,xs,!1,Cr),la=4*Ll.length;const zl=$t.iconSizeData;let zo=null;zl.kind==="source"?(zo=[Mo*Jn.layout.get("icon-size").evaluate(dn,{})],zo[0]>Ya&&le(`${$t.layerIds[0]}: Value for "icon-size" is >= ${qu}. Reduce your "icon-size".`)):zl.kind==="composite"&&(zo=[Mo*bn.compositeIconSizes[0].evaluate(dn,{},An),Mo*bn.compositeIconSizes[1].evaluate(dn,{},An)],(zo[0]>Ya||zo[1]>Ya)&&le(`${$t.layerIds[0]}: Value for "icon-size" is >= ${qu}. Reduce your "icon-size".`)),$t.addSymbols($t.icon,Ll,zo,Yi,Jr,dn,h.ah.none,vi,Po.lineStartIndex,Po.lineLength,-1,An),Td=$t.icon.placedSymbolArray.length-1,co&&(Xu=4*co.length,$t.addSymbols($t.icon,co,zo,Yi,Jr,dn,h.ah.vertical,vi,Po.lineStartIndex,Po.lineLength,-1,An),Cd=$t.icon.placedSymbolArray.length-1)}const ug=Object.keys(an.horizontal);for(const Cr of ug){const Ss=an.horizontal[Cr];if(!Lo){cg=xc(Ss.text);const co=Jn.layout.get("text-rotate").evaluate(dn,{},An);Lo=new Jh(Fr,vi,Rr,Br,Ln,Ss,Yn,Tr,dr,co)}const Ll=Ss.positionedLines.length===1;if(ag+=ig($t,vi,Ss,js,Jn,dr,dn,Nr,Po,an.vertical?h.ah.horizontal:h.ah.horizontalOnly,Ll?ug:[Cr],ca,Td,bn,An),Ll)break}an.vertical&&(lg+=ig($t,vi,an.vertical,js,Jn,dr,dn,Nr,Po,h.ah.vertical,["vertical"],ca,Cd,bn,An));const l1=Lo?Lo.boxStartIndex:$t.collisionBoxArray.length,c1=Lo?Lo.boxEndIndex:$t.collisionBoxArray.length,u1=ks?ks.boxStartIndex:$t.collisionBoxArray.length,h1=ks?ks.boxEndIndex:$t.collisionBoxArray.length,f1=Us?Us.boxStartIndex:$t.collisionBoxArray.length,d1=Us?Us.boxEndIndex:$t.collisionBoxArray.length,p1=rr?rr.boxStartIndex:$t.collisionBoxArray.length,m1=rr?rr.boxEndIndex:$t.collisionBoxArray.length;let lo=-1;const Qh=(Cr,Ss)=>Cr&&Cr.circleDiameter?Math.max(Cr.circleDiameter,Ss):Ss;lo=Qh(Lo,lo),lo=Qh(ks,lo),lo=Qh(Us,lo),lo=Qh(rr,lo);const hg=lo>-1?1:0;hg&&(lo*=Fc/Zn),$t.glyphOffsetArray.length>=zc.MAX_GLYPHS&&le("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dn.sortKey!==void 0&&$t.addToSortKeyRanges($t.symbolInstances.length,dn.sortKey);const g1=tg(Jn,dn,An),[_1,y1]=function(Cr,Ss){const Ll=Cr.length,co=Ss==null?void 0:Ss.values;if((co==null?void 0:co.length)>0)for(let zl=0;zl<co.length;zl+=2){const zo=co[zl+1];Cr.emplaceBack(h.aq[co[zl]],zo[0],zo[1])}return[Ll,Cr.length]}($t.textAnchorOffsets,g1);$t.symbolInstances.emplaceBack(vi.x,vi.y,ca.right>=0?ca.right:-1,ca.center>=0?ca.center:-1,ca.left>=0?ca.left:-1,ca.vertical||-1,Td,Cd,cg,l1,c1,u1,h1,f1,d1,p1,m1,Rr,ag,lg,la,Xu,hg,0,Yn,lo,_1,y1)}(s,ti,_t,l,f,g,Gt,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,Ee,[Qe,Qe,Qe,Qe],jt,P,tt,ht,hi,re,i,w,B,q,x)};if(Rt==="line")for(const _t of Gm(i.geometry,0,0,Nn,Nn)){const ti=t1(_t,qe,xt,l.vertical||ue,f,24,ze,s.overscaling,Nn);for(const $t of ti)ue&&o1(s,ue.text,Dt,$t)||qt(_t,$t)}else if(Rt==="line-center"){for(const _t of i.geometry)if(_t.length>1){const ti=e1(_t,xt,l.vertical||ue,f,24,ze);ti&&qt(_t,ti)}}else if(i.type==="Polygon")for(const _t of Ia(i.geometry,0)){const ti=n1(_t,16);qt(_t[0],new $a(ti.x,ti.y,0))}else if(i.type==="LineString")for(const _t of i.geometry)qt(_t,new $a(_t[0].x,_t[0].y,0));else if(i.type==="Point")for(const _t of i.geometry)for(const ti of _t)qt([ti],new $a(ti.x,ti.y,0))}function ig(s,i,l,f,g,w,x,I,P,B,q,H,ee,re,ue){const ge=function(tt,qe,Qe,ht,xt,jt,hi,Rt){const Dt=ht.layout.get("text-rotate").evaluate(jt,{})*Math.PI/180,ei=[];for(const Gt of qe.positionedLines)for(const qt of Gt.positionedGlyphs){if(!qt.rect)continue;const _t=qt.rect||{};let ti=ym+1,$t=!0,vi=1,un=0;const an=(xt||Rt)&&qt.vertical,Kn=qt.metrics.advance*qt.scale/2;if(Rt&&qe.verticalizable&&(un=Gt.lineOffset/2-(qt.imageName?-(Zn-qt.metrics.width*qt.scale)/2:(qt.scale-1)*Zn)),qt.imageName){const Yi=hi[qt.imageName];$t=Yi.sdf,vi=Yi.pixelRatio,ti=Kr/vi}const js=xt?[qt.x+Kn,qt.y]:[0,0];let fr=xt?[0,0]:[qt.x+Kn+Qe[0],qt.y+Qe[1]-un],Jn=[0,0];an&&(Jn=fr,fr=[0,0]);const Fr=qt.metrics.isDoubleResolution?2:1,Rr=(qt.metrics.left-ti)*qt.scale-Kn+fr[0],Br=(-qt.metrics.top-ti)*qt.scale+fr[1],Ln=Rr+_t.w/Fr*qt.scale/vi,Yn=Br+_t.h/Fr*qt.scale/vi,Tr=new y(Rr,Br),dr=new y(Ln,Br),Nr=new y(Rr,Yn),pr=new y(Ln,Yn);if(an){const Yi=new y(-Kn,Kn-Uu),dn=-Math.PI/2,bn=Zn/2-Kn,fs=new y(5-Uu-bn,-(qt.imageName?bn:0)),An=new y(...Jn);Tr._rotateAround(dn,Yi)._add(fs)._add(An),dr._rotateAround(dn,Yi)._add(fs)._add(An),Nr._rotateAround(dn,Yi)._add(fs)._add(An),pr._rotateAround(dn,Yi)._add(fs)._add(An)}if(Dt){const Yi=Math.sin(Dt),dn=Math.cos(Dt),bn=[dn,-Yi,Yi,dn];Tr._matMult(bn),dr._matMult(bn),Nr._matMult(bn),pr._matMult(bn)}const xs=new y(0,0),Jr=new y(0,0);ei.push({tl:Tr,tr:dr,bl:Nr,br:pr,tex:_t,writingMode:qe.writingMode,glyphOffset:js,sectionIndex:qt.sectionIndex,isSDF:$t,pixelOffsetTL:xs,pixelOffsetBR:Jr,minFontScaleX:0,minFontScaleY:0})}return ei}(0,l,I,g,w,x,f,s.allowVerticalPlacement),Ee=s.textSizeData;let ze=null;Ee.kind==="source"?(ze=[Mo*g.layout.get("text-size").evaluate(x,{})],ze[0]>Ya&&le(`${s.layerIds[0]}: Value for "text-size" is >= ${qu}. Reduce your "text-size".`)):Ee.kind==="composite"&&(ze=[Mo*re.compositeTextSizes[0].evaluate(x,{},ue),Mo*re.compositeTextSizes[1].evaluate(x,{},ue)],(ze[0]>Ya||ze[1]>Ya)&&le(`${s.layerIds[0]}: Value for "text-size" is >= ${qu}. Reduce your "text-size".`)),s.addSymbols(s.text,ge,ze,I,w,x,B,i,P.lineStartIndex,P.lineLength,ee,ue);for(const tt of q)H[tt]=s.text.placedSymbolArray.length-1;return 4*ge.length}function ng(s){for(const i in s)return s[i];return null}function o1(s,i,l,f){const g=s.compareText;if(i in g){const w=g[i];for(let x=w.length-1;x>=0;x--)if(f.dist(w[x])<l)return!0}else g[i]=[];return g[i].push(f),!1}const rg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class yd{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,f]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=rg[15&f];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(i,2,1),[I]=new Uint32Array(i,4,1);return new yd(I,x,w,i)}constructor(i,l=64,f=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const w=rg.indexOf(this.ArrayType),x=2*i*this.ArrayType.BYTES_PER_ELEMENT,I=i*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-I%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+I+P,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+x+I+P),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+I+P,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=l,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return bd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:I}=this,P=[0,w.length-1,0],B=[];for(;P.length;){const q=P.pop()||0,H=P.pop()||0,ee=P.pop()||0;if(H-ee<=I){for(let Ee=ee;Ee<=H;Ee++){const ze=x[2*Ee],tt=x[2*Ee+1];ze>=i&&ze<=f&&tt>=l&&tt<=g&&B.push(w[Ee])}continue}const re=ee+H>>1,ue=x[2*re],ge=x[2*re+1];ue>=i&&ue<=f&&ge>=l&&ge<=g&&B.push(w[re]),(q===0?i<=ue:l<=ge)&&(P.push(ee),P.push(re-1),P.push(1-q)),(q===0?f>=ue:g>=ge)&&(P.push(re+1),P.push(H),P.push(1-q))}return B}within(i,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:x}=this,I=[0,g.length-1,0],P=[],B=f*f;for(;I.length;){const q=I.pop()||0,H=I.pop()||0,ee=I.pop()||0;if(H-ee<=x){for(let Ee=ee;Ee<=H;Ee++)og(w[2*Ee],w[2*Ee+1],i,l)<=B&&P.push(g[Ee]);continue}const re=ee+H>>1,ue=w[2*re],ge=w[2*re+1];og(ue,ge,i,l)<=B&&P.push(g[re]),(q===0?i-f<=ue:l-f<=ge)&&(I.push(ee),I.push(re-1),I.push(1-q)),(q===0?i+f>=ue:l+f>=ge)&&(I.push(re+1),I.push(H),I.push(1-q))}return P}}function bd(s,i,l,f,g,w){if(g-f<=l)return;const x=f+g>>1;sg(s,i,x,f,g,w),bd(s,i,l,f,x-1,1-w),bd(s,i,l,x+1,g,1-w)}function sg(s,i,l,f,g,w){for(;g>f;){if(g-f>600){const B=g-f+1,q=l-f+1,H=Math.log(B),ee=.5*Math.exp(2*H/3),re=.5*Math.sqrt(H*ee*(B-ee)/B)*(q-B/2<0?-1:1);sg(s,i,l,Math.max(f,Math.floor(l-q*ee/B+re)),Math.min(g,Math.floor(l+(B-q)*ee/B+re)),w)}const x=i[2*l+w];let I=f,P=g;for(Gu(s,i,f,l),i[2*g+w]>x&&Gu(s,i,f,g);I<P;){for(Gu(s,i,I,P),I++,P--;i[2*I+w]<x;)I++;for(;i[2*P+w]>x;)P--}i[2*f+w]===x?Gu(s,i,f,P):(P++,Gu(s,i,P,g)),P<=l&&(f=P+1),l<=P&&(g=P-1)}}function Gu(s,i,l,f){vd(s,l,f),vd(i,2*l,2*f),vd(i,2*l+1,2*f+1)}function vd(s,i,l){const f=s[i];s[i]=s[l],s[l]=f}function og(s,i,l,f){const g=s-l,w=i-f;return g*g+w*w}var wd;h.bg=void 0,(wd=h.bg||(h.bg={})).create="create",wd.load="load",wd.fullLoad="fullLoad";let Yh=null,Hu=[];const xd=1e3/60,kd="loadTime",Sd="fullLoadTime",a1={mark(s){performance.mark(s)},frame(s){const i=s;Yh!=null&&Hu.push(i-Yh),Yh=i},clearMetrics(){Yh=null,Hu=[],performance.clearMeasures(kd),performance.clearMeasures(Sd);for(const s in h.bg)performance.clearMarks(h.bg[s])},getPerformanceMetrics(){performance.measure(kd,h.bg.create,h.bg.load),performance.measure(Sd,h.bg.create,h.bg.fullLoad);const s=performance.getEntriesByName(kd)[0].duration,i=performance.getEntriesByName(Sd)[0].duration,l=Hu.length,f=1/(Hu.reduce((w,x)=>w+x,0)/l/1e3),g=Hu.filter(w=>w>xd).reduce((w,x)=>w+(x-xd)/xd,0);return{loadTime:s,fullLoadTime:i,fps:f,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};h.$=class extends K{},h.A=Ec,h.B=Lf,h.C=function(s){if(pe==null){const i=s.navigator?s.navigator.userAgent:null;pe=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return pe},h.D=Kt,h.E=ni,h.F=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Qv(()=>this.process()),this.subscription=function(l,f,g,w){return l.addEventListener(f,g,!1),{unsubscribe:()=>{l.removeEventListener(f,g,!1)}}}(this.target,"message",l=>this.receive(l)),this.globalScope=ve(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((l,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:l,reject:f},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const I={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const w=[],x=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Na(s.data,w)});this.target.postMessage(x,{transfer:w})})}receive(s){const i=s.data,l=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[l];const f=this.abortControllers[l];return delete this.abortControllers[l],void(f&&f.abort())}if(ve(self)||i.mustQueue)return this.tasks[l]=i,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(ja(i.error)):g.resolve(ja(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=ja(i.data),f=new AbortController;this.abortControllers[s]=f;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,l,f);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,l){const f=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Na(i):null,data:Na(l,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},h.G=Tt,h.H=function(){var s=new Ec(16);return Ec!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},h.I=sd,h.J=function(s,i,l){var f,g,w,x,I,P,B,q,H,ee,re,ue,ge=l[0],Ee=l[1],ze=l[2];return i===s?(s[12]=i[0]*ge+i[4]*Ee+i[8]*ze+i[12],s[13]=i[1]*ge+i[5]*Ee+i[9]*ze+i[13],s[14]=i[2]*ge+i[6]*Ee+i[10]*ze+i[14],s[15]=i[3]*ge+i[7]*Ee+i[11]*ze+i[15]):(g=i[1],w=i[2],x=i[3],I=i[4],P=i[5],B=i[6],q=i[7],H=i[8],ee=i[9],re=i[10],ue=i[11],s[0]=f=i[0],s[1]=g,s[2]=w,s[3]=x,s[4]=I,s[5]=P,s[6]=B,s[7]=q,s[8]=H,s[9]=ee,s[10]=re,s[11]=ue,s[12]=f*ge+I*Ee+H*ze+i[12],s[13]=g*ge+P*Ee+ee*ze+i[13],s[14]=w*ge+B*Ee+re*ze+i[14],s[15]=x*ge+q*Ee+ue*ze+i[15]),s},h.K=function(s,i,l){var f=l[0],g=l[1],w=l[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*w,s[9]=i[9]*w,s[10]=i[10]*w,s[11]=i[11]*w,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},h.L=jp,h.M=function(s,i){const l={};for(let f=0;f<i.length;f++){const g=i[f];g in s&&(l[g]=s[g])}return l},h.N=Qa,h.O=Dm,h.P=y,h.Q=Fm,h.R=vs,h.S=ws,h.T=_c,h.U=N,h.V=z,h.W=Ae,h.X=Nn,h.Y=A,h.Z=Zu,h._=a,h.a=Je,h.a$=function(s,i){var l=s[0],f=s[1],g=s[2],w=s[3],x=s[4],I=s[5],P=s[6],B=s[7],q=s[8],H=s[9],ee=s[10],re=s[11],ue=s[12],ge=s[13],Ee=s[14],ze=s[15],tt=i[0],qe=i[1],Qe=i[2],ht=i[3],xt=i[4],jt=i[5],hi=i[6],Rt=i[7],Dt=i[8],ei=i[9],Gt=i[10],qt=i[11],_t=i[12],ti=i[13],$t=i[14],vi=i[15];return Math.abs(l-tt)<=Dr*Math.max(1,Math.abs(l),Math.abs(tt))&&Math.abs(f-qe)<=Dr*Math.max(1,Math.abs(f),Math.abs(qe))&&Math.abs(g-Qe)<=Dr*Math.max(1,Math.abs(g),Math.abs(Qe))&&Math.abs(w-ht)<=Dr*Math.max(1,Math.abs(w),Math.abs(ht))&&Math.abs(x-xt)<=Dr*Math.max(1,Math.abs(x),Math.abs(xt))&&Math.abs(I-jt)<=Dr*Math.max(1,Math.abs(I),Math.abs(jt))&&Math.abs(P-hi)<=Dr*Math.max(1,Math.abs(P),Math.abs(hi))&&Math.abs(B-Rt)<=Dr*Math.max(1,Math.abs(B),Math.abs(Rt))&&Math.abs(q-Dt)<=Dr*Math.max(1,Math.abs(q),Math.abs(Dt))&&Math.abs(H-ei)<=Dr*Math.max(1,Math.abs(H),Math.abs(ei))&&Math.abs(ee-Gt)<=Dr*Math.max(1,Math.abs(ee),Math.abs(Gt))&&Math.abs(re-qt)<=Dr*Math.max(1,Math.abs(re),Math.abs(qt))&&Math.abs(ue-_t)<=Dr*Math.max(1,Math.abs(ue),Math.abs(_t))&&Math.abs(ge-ti)<=Dr*Math.max(1,Math.abs(ge),Math.abs(ti))&&Math.abs(Ee-$t)<=Dr*Math.max(1,Math.abs(Ee),Math.abs($t))&&Math.abs(ze-vi)<=Dr*Math.max(1,Math.abs(ze),Math.abs(vi))},h.a0=Zi,h.a1=md,h.a2=ft,h.a3=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(l=>{i.onloadstart=()=>{l(i)};for(const f of s){const g=window.document.createElement("source");Pi(f)||(i.crossOrigin="Anonymous"),g.src=f,i.appendChild(g)}})},h.a4=function(){return U++},h.a5=Nt,h.a6=zc,h.a7=bl,h.a8=Ml,h.a9=Vm,h.aA=function(s){if(s.type==="custom")return new Yv(s);switch(s.type){case"background":return new Xv(s);case"circle":return new Db(s);case"fill":return new Qb(s);case"fill-extrusion":return new dv(s);case"heatmap":return new Rb(s);case"hillshade":return new Nb(s);case"line":return new wv(s);case"raster":return new Jv(s);case"symbol":return new Gh(s)}},h.aB=O,h.aC=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let l=[];try{if(!it(s.version,i.version))return[{command:"setStyle",args:[i]}];it(s.center,i.center)||l.push({command:"setCenter",args:[i.center]}),it(s.zoom,i.zoom)||l.push({command:"setZoom",args:[i.zoom]}),it(s.bearing,i.bearing)||l.push({command:"setBearing",args:[i.bearing]}),it(s.pitch,i.pitch)||l.push({command:"setPitch",args:[i.pitch]}),it(s.sprite,i.sprite)||l.push({command:"setSprite",args:[i.sprite]}),it(s.glyphs,i.glyphs)||l.push({command:"setGlyphs",args:[i.glyphs]}),it(s.transition,i.transition)||l.push({command:"setTransition",args:[i.transition]}),it(s.light,i.light)||l.push({command:"setLight",args:[i.light]}),it(s.terrain,i.terrain)||l.push({command:"setTerrain",args:[i.terrain]}),it(s.sky,i.sky)||l.push({command:"setSky",args:[i.sky]}),it(s.projection,i.projection)||l.push({command:"setProjection",args:[i.projection]});const f={},g=[];(function(x,I,P,B){let q;for(q in I=I||{},x=x||{})Object.prototype.hasOwnProperty.call(x,q)&&(Object.prototype.hasOwnProperty.call(I,q)||Q(q,P,B));for(q in I)Object.prototype.hasOwnProperty.call(I,q)&&(Object.prototype.hasOwnProperty.call(x,q)?it(x[q],I[q])||(x[q].type==="geojson"&&I[q].type==="geojson"&&Ze(x,I,q)?fe(P,{command:"setGeoJSONSourceData",args:[q,I[q].data]}):Me(q,I,P,B)):X(q,I,P))})(s.sources,i.sources,g,f);const w=[];s.layers&&s.layers.forEach(x=>{"source"in x&&f[x.source]?l.push({command:"removeLayer",args:[x.id]}):w.push(x)}),l=l.concat(g),function(x,I,P){I=I||[];const B=(x=x||[]).map(st),q=I.map(st),H=x.reduce(Ci,{}),ee=I.reduce(Ci,{}),re=B.slice(),ue=Object.create(null);let ge,Ee,ze,tt,qe;for(let Qe=0,ht=0;Qe<B.length;Qe++)ge=B[Qe],Object.prototype.hasOwnProperty.call(ee,ge)?ht++:(fe(P,{command:"removeLayer",args:[ge]}),re.splice(re.indexOf(ge,ht),1));for(let Qe=0,ht=0;Qe<q.length;Qe++)ge=q[q.length-1-Qe],re[re.length-1-Qe]!==ge&&(Object.prototype.hasOwnProperty.call(H,ge)?(fe(P,{command:"removeLayer",args:[ge]}),re.splice(re.lastIndexOf(ge,re.length-ht),1)):ht++,tt=re[re.length-Qe],fe(P,{command:"addLayer",args:[ee[ge],tt]}),re.splice(re.length-Qe,0,ge),ue[ge]=!0);for(let Qe=0;Qe<q.length;Qe++)if(ge=q[Qe],Ee=H[ge],ze=ee[ge],!ue[ge]&&!it(Ee,ze))if(it(Ee.source,ze.source)&&it(Ee["source-layer"],ze["source-layer"])&&it(Ee.type,ze.type)){for(qe in dt(Ee.layout,ze.layout,P,ge,null,"setLayoutProperty"),dt(Ee.paint,ze.paint,P,ge,null,"setPaintProperty"),it(Ee.filter,ze.filter)||fe(P,{command:"setFilter",args:[ge,ze.filter]}),it(Ee.minzoom,ze.minzoom)&&it(Ee.maxzoom,ze.maxzoom)||fe(P,{command:"setLayerZoomRange",args:[ge,ze.minzoom,ze.maxzoom]}),Ee)Object.prototype.hasOwnProperty.call(Ee,qe)&&qe!=="layout"&&qe!=="paint"&&qe!=="filter"&&qe!=="metadata"&&qe!=="minzoom"&&qe!=="maxzoom"&&(qe.indexOf("paint.")===0?dt(Ee[qe],ze[qe],P,ge,qe.slice(6),"setPaintProperty"):it(Ee[qe],ze[qe])||fe(P,{command:"setLayerProperty",args:[ge,qe,ze[qe]]}));for(qe in ze)Object.prototype.hasOwnProperty.call(ze,qe)&&!Object.prototype.hasOwnProperty.call(Ee,qe)&&qe!=="layout"&&qe!=="paint"&&qe!=="filter"&&qe!=="metadata"&&qe!=="minzoom"&&qe!=="maxzoom"&&(qe.indexOf("paint.")===0?dt(Ee[qe],ze[qe],P,ge,qe.slice(6),"setPaintProperty"):it(Ee[qe],ze[qe])||fe(P,{command:"setLayerProperty",args:[ge,qe,ze[qe]]}))}else fe(P,{command:"removeLayer",args:[ge]}),tt=re[re.lastIndexOf(ge)+1],fe(P,{command:"addLayer",args:[ze,tt]})}(w,i.layers,l)}catch(f){console.warn("Unable to compute style diff:",f),l=[{command:"setStyle",args:[i]}]}return l},h.aD=function(s){const i=[],l=s.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},h.aE=function s(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let f=0;f<i.length;f++)if(!s(i[f],l[f]))return!1;return!0}if(typeof i=="object"&&i!==null&&l!==null){if(typeof l!="object"||Object.keys(i).length!==Object.keys(l).length)return!1;for(const f in i)if(!s(i[f],l[f]))return!1;return!0}return i===l},h.aF=j,h.aG=G,h.aH=class extends El{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},h.aI=zh,h.aJ=class extends El{constructor(s,i){super(s,i),this.current=Eb}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},h.aK=Ap,h.aL=Mp,h.aM=si,h.aN=class extends El{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},h.aO=class extends El{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},h.aP=function(s,i,l,f,g,w,x){var I=1/(i-l),P=1/(f-g),B=1/(w-x);return s[0]=-2*I,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*P,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*B,s[11]=0,s[12]=(i+l)*I,s[13]=(g+f)*P,s[14]=(x+w)*B,s[15]=1,s},h.aQ=Ob,h.aR=class extends He{},h.aS=Tv,h.aT=class extends nt{},h.aU=Hf,h.aV=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},h.aW=Wp,h.aX=cr,h.aY=bs,h.aZ=class extends Jt{},h.a_=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},h.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,g,w)=>{const x=g||w;return i[f]=!x||x.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},h.ab=function(s,i){const l=[];for(const f in s)f in i||l.push(f);return l},h.ac=se,h.ad=function(s,i,l){var f=Math.sin(l),g=Math.cos(l),w=i[0],x=i[1],I=i[2],P=i[3],B=i[4],q=i[5],H=i[6],ee=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*g+B*f,s[1]=x*g+q*f,s[2]=I*g+H*f,s[3]=P*g+ee*f,s[4]=B*g-w*f,s[5]=q*g-x*f,s[6]=H*g-I*f,s[7]=ee*g-P*f,s},h.ae=function(s){var i=new Ec(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},h.af=Rh,h.ag=function(s,i){let l=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:x}=s,I=g?se(tr.interpolationFactor(g,i,w,x),0,1):0;s.kind==="camera"?f=qn.number(s.minSize,s.maxSize,I):l=I}return{uSizeT:l,uSize:f}},h.ai=function(s,{uSize:i,uSizeT:l},{lowerSize:f,upperSize:g}){return s.kind==="source"?f/Mo:s.kind==="composite"?qn.number(f/Mo,g/Mo,l):i},h.aj=cd,h.ak=function(s,i,l,f){const g=i.y-s.y,w=i.x-s.x,x=f.y-l.y,I=f.x-l.x,P=x*w-I*g;if(P===0)return null;const B=(I*(s.y-l.y)-x*(s.x-l.x))/P;return new y(s.x+B*w,s.y+B*g)},h.al=Gm,h.am=Op,h.an=Zf,h.ao=function(s){let i=1/0,l=1/0,f=-1/0,g=-1/0;for(const w of s)i=Math.min(i,w.x),l=Math.min(l,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);return[i,l,f,g]},h.ap=Zn,h.ar=ld,h.as=function(s,i){var l=i[0],f=i[1],g=i[2],w=i[3],x=i[4],I=i[5],P=i[6],B=i[7],q=i[8],H=i[9],ee=i[10],re=i[11],ue=i[12],ge=i[13],Ee=i[14],ze=i[15],tt=l*I-f*x,qe=l*P-g*x,Qe=l*B-w*x,ht=f*P-g*I,xt=f*B-w*I,jt=g*B-w*P,hi=q*ge-H*ue,Rt=q*Ee-ee*ue,Dt=q*ze-re*ue,ei=H*Ee-ee*ge,Gt=H*ze-re*ge,qt=ee*ze-re*Ee,_t=tt*qt-qe*Gt+Qe*ei+ht*Dt-xt*Rt+jt*hi;return _t?(s[0]=(I*qt-P*Gt+B*ei)*(_t=1/_t),s[1]=(g*Gt-f*qt-w*ei)*_t,s[2]=(ge*jt-Ee*xt+ze*ht)*_t,s[3]=(ee*xt-H*jt-re*ht)*_t,s[4]=(P*Dt-x*qt-B*Rt)*_t,s[5]=(l*qt-g*Dt+w*Rt)*_t,s[6]=(Ee*Qe-ue*jt-ze*qe)*_t,s[7]=(q*jt-ee*Qe+re*qe)*_t,s[8]=(x*Gt-I*Dt+B*hi)*_t,s[9]=(f*Dt-l*Gt-w*hi)*_t,s[10]=(ue*xt-ge*Qe+ze*tt)*_t,s[11]=(H*Qe-q*xt-re*tt)*_t,s[12]=(I*Rt-x*ei-P*hi)*_t,s[13]=(l*ei-f*Rt+g*hi)*_t,s[14]=(ge*qe-ue*ht-Ee*tt)*_t,s[15]=(q*ht-H*qe+ee*tt)*_t,s):null},h.at=_d,h.au=ad,h.av=yd,h.aw=function(){const s={},i=$e.$version;for(const l in $e.$root){const f=$e.$root[l];if(f.required){let g=null;g=l==="version"?i:f.type==="array"?[]:{},g!=null&&(s[l]=g)}}return s},h.ax=Su,h.ay=li,h.az=function(s){s=s.slice();const i=Object.create(null);for(let l=0;l<s.length;l++)i[s[l].id]=s[l];for(let l=0;l<s.length;l++)"ref"in s[l]&&(s[l]=yt(s[l],i[s[l].ref]));return s},h.b=we,h.b0=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},h.b1=function(s,i,l){return s[0]=i[0]*l[0],s[1]=i[1]*l[1],s[2]=i[2]*l[2],s[3]=i[3]*l[3],s},h.b2=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},h.b3=$,h.b4=Nm,h.b5=Rm,h.b6=function(s,i,l,f,g){var w,x=1/Math.tan(i/2);return s[0]=x/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+f)*(w=1/(f-g)),s[14]=2*g*f*w):(s[10]=-1,s[14]=-2*f),s},h.b7=function(s,i,l){var f=Math.sin(l),g=Math.cos(l),w=i[4],x=i[5],I=i[6],P=i[7],B=i[8],q=i[9],H=i[10],ee=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=w*g+B*f,s[5]=x*g+q*f,s[6]=I*g+H*f,s[7]=P*g+ee*f,s[8]=B*g-w*f,s[9]=q*g-x*f,s[10]=H*g-I*f,s[11]=ee*g-P*f,s},h.b8=V,h.b9=Y,h.bA=hm,h.bB=function(s){return s.message===pt},h.bC=Lr,h.bD=Hr,h.ba=function(s){return s*Math.PI/180},h.bb=function(s,i){const{x:l,y:f}=Zu.fromLngLat(i);return!(s<0||s>25||f<0||f>=1||l<0||l>=1)},h.bc=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},h.bd=class extends Z{},h.be=dd,h.bf=a1,h.bh=Ht,h.bi=function(s,i){Je.REGISTERED_PROTOCOLS[s]=i},h.bj=function(s){delete Je.REGISTERED_PROTOCOLS[s]},h.bk=function(s,i){const l={};for(let g=0;g<s.length;g++){const w=i&&i[s[g].id]||F(s[g]);i&&(i[s[g].id]=w);let x=l[w];x||(x=l[w]=[]),x.push(s[g])}const f=[];for(const g in l)f.push(l[g]);return f},h.bl=Zt,h.bm=Um,h.bn=qm,h.bo=vm,h.bp=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Nn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],l=i.layout,f=i._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new mn(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new mn(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new mn(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:q}=s.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new mn(B),s.canonical),f["text-size"].possiblyEvaluate(new mn(q),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:q}=s.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new mn(B),s.canonical),f["icon-size"].possiblyEvaluate(new mn(q),s.canonical)]}const w=l.get("text-line-height")*Zn,x=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",I=l.get("text-keep-upright"),P=l.get("text-size");for(const B of s.bucket.features){const q=l.get("text-font").evaluate(B,{},s.canonical).join(","),H=P.evaluate(B,{},s.canonical),ee=g.layoutTextSize.evaluate(B,{},s.canonical),re=g.layoutIconSize.evaluate(B,{},s.canonical),ue={horizontal:{},vertical:void 0},ge=B.text;let Ee,ze=[0,0];if(ge){const Qe=ge.toString(),ht=l.get("text-letter-spacing").evaluate(B,{},s.canonical)*Zn,xt=zf(Qe)?ht:0,jt=l.get("text-anchor").evaluate(B,{},s.canonical),hi=tg(i,B,s.canonical);if(!hi){const Gt=l.get("text-radial-offset").evaluate(B,{},s.canonical);ze=Gt?eg(jt,[Gt*Zn,gd]):l.get("text-offset").evaluate(B,{},s.canonical).map(qt=>qt*Zn)}let Rt=x?"center":l.get("text-justify").evaluate(B,{},s.canonical);const Dt=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(B,{},s.canonical)*Zn:1/0,ei=()=>{s.bucket.allowVerticalPlacement&&Tu(Qe)&&(ue.vertical=qh(ge,s.glyphMap,s.glyphPositions,s.imagePositions,q,Dt,w,jt,"left",xt,ze,h.ah.vertical,!0,ee,H))};if(!x&&hi){const Gt=new Set;if(Rt==="auto")for(let _t=0;_t<hi.values.length;_t+=2)Gt.add(_d(hi.values[_t]));else Gt.add(Rt);let qt=!1;for(const _t of Gt)if(!ue.horizontal[_t])if(qt)ue.horizontal[_t]=ue.horizontal[0];else{const ti=qh(ge,s.glyphMap,s.glyphPositions,s.imagePositions,q,Dt,w,"center",_t,xt,ze,h.ah.horizontal,!1,ee,H);ti&&(ue.horizontal[_t]=ti,qt=ti.positionedLines.length===1)}ei()}else{Rt==="auto"&&(Rt=_d(jt));const Gt=qh(ge,s.glyphMap,s.glyphPositions,s.imagePositions,q,Dt,w,jt,Rt,xt,ze,h.ah.horizontal,!1,ee,H);Gt&&(ue.horizontal[Rt]=Gt),ei(),Tu(Qe)&&x&&I&&(ue.vertical=qh(ge,s.glyphMap,s.glyphPositions,s.imagePositions,q,Dt,w,jt,Rt,xt,ze,h.ah.vertical,!1,ee,H))}}let tt=!1;if(B.icon&&B.icon.name){const Qe=s.imageMap[B.icon.name];Qe&&(Ee=qv(s.imagePositions[B.icon.name],l.get("icon-offset").evaluate(B,{},s.canonical),l.get("icon-anchor").evaluate(B,{},s.canonical)),tt=!!Qe.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=tt:s.bucket.sdfIcons!==tt&&le("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==s.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const qe=ng(ue.horizontal)||ue.vertical;s.bucket.iconsInText=!!qe&&qe.iconsInText,(qe||Ee)&&s1(s.bucket,B,ue,Ee,s.imageMap,g,ee,re,ze,tt,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},h.bq=td,h.br=Qf,h.bs=ed,h.bt=Ka,h.bu=nd,h.bv=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},h.bw=function(s,i,l,f,g){return a(this,void 0,void 0,function*(){if(z())try{return yield Ae(s,i,l,f,g)}catch{}return function(w,x,I,P,B){const q=w.width,H=w.height;ct&&We||(ct=new OffscreenCanvas(q,H),We=ct.getContext("2d",{willReadFrequently:!0})),ct.width=q,ct.height=H,We.drawImage(w,0,0,q,H);const ee=We.getImageData(x,I,P,B);return We.clearRect(0,0,q,H),ee.data}(s,i,l,f,g)})},h.bx=jm,h.by=_,h.bz=S,h.c=kt,h.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),h.e=te,h.f=s=>new Promise((i,l)=>{const f=new Image;f.onload=()=>{i(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Te})},f.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(g):Te}),h.g=wt,h.h=(s,i)=>Mi(te(s,{type:"json"}),i),h.i=ve,h.j=Pt,h.k=Xe,h.l=(s,i)=>Mi(te(s,{type:"arrayBuffer"}),i),h.m=Mi,h.n=function(s){return new nd(s).readFields(Fv,[])},h.o=Ou,h.p=bm,h.q=v,h.r=Pf,h.s=Pi,h.t=xu,h.u=ra,h.v=$e,h.w=le,h.x=function([s,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(l),y:s*Math.sin(i)*Math.sin(l),z:s*Math.cos(l)}},h.y=qn,h.z=mn}),c("worker",["./shared"],function(h){class a{constructor(ie){this.keyCache={},ie&&this.replace(ie)}replace(ie){this._layerConfigs={},this._layers={},this.update(ie,[])}update(ie,ne){for(const Se of ie){this._layerConfigs[Se.id]=Se;const Ve=this._layers[Se.id]=h.aA(Se);Ve._featureFilter=h.a7(Ve.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(const Se of ne)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const me=h.bk(Object.values(this._layerConfigs),this.keyCache);for(const Se of me){const Ve=Se.map(rt=>this._layers[rt.id]),Ge=Ve[0];if(Ge.visibility==="none")continue;const et=Ge.source||"";let Be=this.familiesBySource[et];Be||(Be=this.familiesBySource[et]={});const ut=Ge.sourceLayer||"_geojsonTileLayer";let bt=Be[ut];bt||(bt=Be[ut]=[]),bt.push(Ve)}}}class _{constructor(ie){const ne={},me=[];for(const et in ie){const Be=ie[et],ut=ne[et]={};for(const bt in Be){const rt=Be[+bt];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Et={x:0,y:0,w:rt.bitmap.width+2,h:rt.bitmap.height+2};me.push(Et),ut[bt]={rect:Et,metrics:rt.metrics}}}const{w:Se,h:Ve}=h.p(me),Ge=new h.o({width:Se||1,height:Ve||1});for(const et in ie){const Be=ie[et];for(const ut in Be){const bt=Be[+ut];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;const rt=ne[et][ut].rect;h.o.copy(bt.bitmap,Ge,{x:0,y:0},{x:rt.x+1,y:rt.y+1},bt.bitmap)}}this.image=Ge,this.positions=ne}}h.bl("GlyphAtlas",_);class S{constructor(ie){this.tileID=new h.S(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.uid=ie.uid,this.zoom=ie.zoom,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.collectResourceTiming,this.returnDependencies=!!ie.returnDependencies,this.promoteId=ie.promoteId,this.inFlightDependencies=[]}parse(ie,ne,me,Se){return h._(this,void 0,void 0,function*(){this.status="parsing",this.data=ie,this.collisionBoxArray=new h.a5;const Ve=new h.bm(Object.keys(ie.layers).sort()),Ge=new h.bn(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const et={},Be={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},ut=ne.familiesBySource[this.source];for(const Ke in ut){const pi=ie.layers[Ke];if(!pi)continue;pi.version===1&&h.w(`Vector tile source "${this.source}" layer "${Ke}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ki=Ve.encode(Ke),Ui=[];for(let Ki=0;Ki<pi.length;Ki++){const Ji=pi.feature(Ki),Un=Ge.getId(Ji,Ke);Ui.push({feature:Ji,id:Un,index:Ki,sourceLayerIndex:ki})}for(const Ki of ut[Ke]){const Ji=Ki[0];Ji.source!==this.source&&h.w(`layer.source = ${Ji.source} does not equal this.source = ${this.source}`),Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility!=="none"&&(k(Ki,this.zoom,me),(et[Ji.id]=Ji.createBucket({index:Ge.bucketLayerIDs.length,layers:Ki,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ki,sourceID:this.source})).populate(Ui,Be,this.tileID.canonical),Ge.bucketLayerIDs.push(Ki.map(Un=>Un.id)))}}const bt=h.aF(Be.glyphDependencies,Ke=>Object.keys(Ke).map(Number));this.inFlightDependencies.forEach(Ke=>Ke==null?void 0:Ke.abort()),this.inFlightDependencies=[];let rt=Promise.resolve({});if(Object.keys(bt).length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),rt=Se.sendAsync({type:"GG",data:{stacks:bt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ke)}const Et=Object.keys(Be.iconDependencies);let Qt=Promise.resolve({});if(Et.length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),Qt=Se.sendAsync({type:"GI",data:{icons:Et,source:this.source,tileID:this.tileID,type:"icons"}},Ke)}const ri=Object.keys(Be.patternDependencies);let ji=Promise.resolve({});if(ri.length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),ji=Se.sendAsync({type:"GI",data:{icons:ri,source:this.source,tileID:this.tileID,type:"patterns"}},Ke)}const[wi,zi,Si]=yield Promise.all([rt,Qt,ji]),hn=new _(wi),fn=new h.bo(zi,Si);for(const Ke in et){const pi=et[Ke];pi instanceof h.a6?(k(pi.layers,this.zoom,me),h.bp({bucket:pi,glyphMap:wi,glyphPositions:hn.positions,imageMap:zi,imagePositions:fn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):pi.hasPattern&&(pi instanceof h.bq||pi instanceof h.br||pi instanceof h.bs)&&(k(pi.layers,this.zoom,me),pi.addFeatures(Be,this.tileID.canonical,fn.patternPositions))}return this.status="done",{buckets:Object.values(et).filter(Ke=>!Ke.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hn.image,imageAtlas:fn,glyphMap:this.returnDependencies?wi:null,iconMap:this.returnDependencies?zi:null,glyphPositions:this.returnDependencies?hn.positions:null}})}}function k(Le,ie,ne){const me=new h.z(ie);for(const Se of Le)Se.recalculate(me,ne)}class y{constructor(ie,ne,me){this.actor=ie,this.layerIndex=ne,this.availableImages=me,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ie,ne){return h._(this,void 0,void 0,function*(){const me=yield h.l(ie.request,ne);try{return{vectorTile:new h.bt.VectorTile(new h.bu(me.data)),rawData:me.data,cacheControl:me.cacheControl,expires:me.expires}}catch(Se){const Ve=new Uint8Array(me.data);let Ge=`Unable to parse the tile at ${ie.request.url}, `;throw Ge+=Ve[0]===31&&Ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(Ge)}})}loadTile(ie){return h._(this,void 0,void 0,function*(){const ne=ie.uid,me=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new h.bv(ie.request),Se=new S(ie);this.loading[ne]=Se;const Ve=new AbortController;Se.abort=Ve;try{const Ge=yield this.loadVectorTile(ie,Ve);if(delete this.loading[ne],!Ge)return null;const et=Ge.rawData,Be={};Ge.expires&&(Be.expires=Ge.expires),Ge.cacheControl&&(Be.cacheControl=Ge.cacheControl);const ut={};if(me){const rt=me.finish();rt&&(ut.resourceTiming=JSON.parse(JSON.stringify(rt)))}Se.vectorTile=Ge.vectorTile;const bt=Se.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ne]=Se,this.fetching[ne]={rawTileData:et,cacheControl:Be,resourceTiming:ut};try{const rt=yield bt;return h.e({rawTileData:et.slice(0)},rt,Be,ut)}finally{delete this.fetching[ne]}}catch(Ge){throw delete this.loading[ne],Se.status="done",this.loaded[ne]=Se,Ge}})}reloadTile(ie){return h._(this,void 0,void 0,function*(){const ne=ie.uid;if(!this.loaded||!this.loaded[ne])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const me=this.loaded[ne];if(me.showCollisionBoxes=ie.showCollisionBoxes,me.status==="parsing"){const Se=yield me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ve;if(this.fetching[ne]){const{rawTileData:Ge,cacheControl:et,resourceTiming:Be}=this.fetching[ne];delete this.fetching[ne],Ve=h.e({rawTileData:Ge.slice(0)},Se,et,Be)}else Ve=Se;return Ve}if(me.status==="done"&&me.vectorTile)return me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ie){return h._(this,void 0,void 0,function*(){const ne=this.loading,me=ie.uid;ne&&ne[me]&&ne[me].abort&&(ne[me].abort.abort(),delete ne[me])})}removeTile(ie){return h._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ie.uid]&&delete this.loaded[ie.uid]})}}class C{constructor(){this.loaded={}}loadTile(ie){return h._(this,void 0,void 0,function*(){const{uid:ne,encoding:me,rawImageData:Se,redFactor:Ve,greenFactor:Ge,blueFactor:et,baseShift:Be}=ie,ut=Se.width+2,bt=Se.height+2,rt=h.b(Se)?new h.R({width:ut,height:bt},yield h.bw(Se,-1,-1,ut,bt)):Se,Et=new h.bx(ne,rt,me,Ve,Ge,et,Be);return this.loaded=this.loaded||{},this.loaded[ne]=Et,Et})}removeTile(ie){const ne=this.loaded,me=ie.uid;ne&&ne[me]&&delete ne[me]}}function E(Le,ie){if(Le.length!==0){T(Le[0],ie);for(var ne=1;ne<Le.length;ne++)T(Le[ne],!ie)}}function T(Le,ie){for(var ne=0,me=0,Se=0,Ve=Le.length,Ge=Ve-1;Se<Ve;Ge=Se++){var et=(Le[Se][0]-Le[Ge][0])*(Le[Ge][1]+Le[Se][1]),Be=ne+et;me+=Math.abs(ne)>=Math.abs(et)?ne-Be+et:et-Be+ne,ne=Be}ne+me>=0!=!!ie&&Le.reverse()}var M=h.by(function Le(ie,ne){var me,Se=ie&&ie.type;if(Se==="FeatureCollection")for(me=0;me<ie.features.length;me++)Le(ie.features[me],ne);else if(Se==="GeometryCollection")for(me=0;me<ie.geometries.length;me++)Le(ie.geometries[me],ne);else if(Se==="Feature")Le(ie.geometry,ne);else if(Se==="Polygon")E(ie.coordinates,ne);else if(Se==="MultiPolygon")for(me=0;me<ie.coordinates.length;me++)E(ie.coordinates[me],ne);return ie});const R=h.bt.VectorTileFeature.prototype.toGeoJSON;var N={exports:{}},z=h.bz,V=h.bt.VectorTileFeature,Y=se;function se(Le,ie){this.options=ie||{},this.features=Le,this.length=Le.length}function $(Le,ie){this.id=typeof Le.id=="number"?Le.id:void 0,this.type=Le.type,this.rawGeometry=Le.type===1?[Le.geometry]:Le.geometry,this.properties=Le.tags,this.extent=ie||4096}se.prototype.feature=function(Le){return new $(this.features[Le],this.options.extent)},$.prototype.loadGeometry=function(){var Le=this.rawGeometry;this.geometry=[];for(var ie=0;ie<Le.length;ie++){for(var ne=Le[ie],me=[],Se=0;Se<ne.length;Se++)me.push(new z(ne[Se][0],ne[Se][1]));this.geometry.push(me)}return this.geometry},$.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Le=this.geometry,ie=1/0,ne=-1/0,me=1/0,Se=-1/0,Ve=0;Ve<Le.length;Ve++)for(var Ge=Le[Ve],et=0;et<Ge.length;et++){var Be=Ge[et];ie=Math.min(ie,Be.x),ne=Math.max(ne,Be.x),me=Math.min(me,Be.y),Se=Math.max(Se,Be.y)}return[ie,me,ne,Se]},$.prototype.toGeoJSON=V.prototype.toGeoJSON;var te=h.bA,U=Y;function j(Le){var ie=new te;return function(ne,me){for(var Se in ne.layers)me.writeMessage(3,G,ne.layers[Se])}(Le,ie),ie.finish()}function G(Le,ie){var ne;ie.writeVarintField(15,Le.version||1),ie.writeStringField(1,Le.name||""),ie.writeVarintField(5,Le.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<Le.length;ne++)me.feature=Le.feature(ne),ie.writeMessage(2,O,me);var Se=me.keys;for(ne=0;ne<Se.length;ne++)ie.writeStringField(3,Se[ne]);var Ve=me.values;for(ne=0;ne<Ve.length;ne++)ie.writeMessage(4,pe,Ve[ne])}function O(Le,ie){var ne=Le.feature;ne.id!==void 0&&ie.writeVarintField(1,ne.id),ie.writeMessage(2,W,Le),ie.writeVarintField(3,ne.type),ie.writeMessage(4,ve,ne)}function W(Le,ie){var ne=Le.feature,me=Le.keys,Se=Le.values,Ve=Le.keycache,Ge=Le.valuecache;for(var et in ne.properties){var Be=ne.properties[et],ut=Ve[et];if(Be!==null){ut===void 0&&(me.push(et),Ve[et]=ut=me.length-1),ie.writeVarint(ut);var bt=typeof Be;bt!=="string"&&bt!=="boolean"&&bt!=="number"&&(Be=JSON.stringify(Be));var rt=bt+":"+Be,Et=Ge[rt];Et===void 0&&(Se.push(Be),Ge[rt]=Et=Se.length-1),ie.writeVarint(Et)}}}function le(Le,ie){return(ie<<3)+(7&Le)}function de(Le){return Le<<1^Le>>31}function ve(Le,ie){for(var ne=Le.loadGeometry(),me=Le.type,Se=0,Ve=0,Ge=ne.length,et=0;et<Ge;et++){var Be=ne[et],ut=1;me===1&&(ut=Be.length),ie.writeVarint(le(1,ut));for(var bt=me===3?Be.length-1:Be.length,rt=0;rt<bt;rt++){rt===1&&me!==1&&ie.writeVarint(le(2,bt-1));var Et=Be[rt].x-Se,Qt=Be[rt].y-Ve;ie.writeVarint(de(Et)),ie.writeVarint(de(Qt)),Se+=Et,Ve+=Qt}me===3&&ie.writeVarint(le(7,1))}}function pe(Le,ie){var ne=typeof Le;ne==="string"?ie.writeStringField(1,Le):ne==="boolean"?ie.writeBooleanField(7,Le):ne==="number"&&(Le%1!=0?ie.writeDoubleField(3,Le):Le<0?ie.writeSVarintField(6,Le):ie.writeVarintField(5,Le))}N.exports=j,N.exports.fromVectorTileJs=j,N.exports.fromGeojsonVt=function(Le,ie){ie=ie||{};var ne={};for(var me in Le)ne[me]=new U(Le[me].features,ie),ne[me].name=me,ne[me].version=ie.version,ne[me].extent=ie.extent;return j({layers:ne})},N.exports.GeoJSONWrapper=U;var we=h.by(N.exports);const Te={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},Ae=Math.fround||(ct=new Float32Array(1),Le=>(ct[0]=+Le,ct[0]));var ct;const We=3,pt=5,kt=6;class Je{constructor(ie){this.options=Object.assign(Object.create(Te),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:ne,minZoom:me,maxZoom:Se}=this.options;ne&&console.time("total time");const Ve=`prepare ${ie.length} points`;ne&&console.time(Ve),this.points=ie;const Ge=[];for(let Be=0;Be<ie.length;Be++){const ut=ie[Be];if(!ut.geometry)continue;const[bt,rt]=ut.geometry.coordinates,Et=Ae(Ht(bt)),Qt=Ae(li(rt));Ge.push(Et,Qt,1/0,Be,-1,1),this.options.reduce&&Ge.push(0)}let et=this.trees[Se+1]=this._createTree(Ge);ne&&console.timeEnd(Ve);for(let Be=Se;Be>=me;Be--){const ut=+Date.now();et=this.trees[Be]=this._createTree(this._cluster(et,Be)),ne&&console.log("z%d: %d clusters in %dms",Be,et.numItems,+Date.now()-ut)}return ne&&console.timeEnd("total time"),this}getClusters(ie,ne){let me=((ie[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,ie[1]));let Ve=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)me=-180,Ve=180;else if(me>Ve){const rt=this.getClusters([me,Se,180,Ge],ne),Et=this.getClusters([-180,Se,Ve,Ge],ne);return rt.concat(Et)}const et=this.trees[this._limitZoom(ne)],Be=et.range(Ht(me),li(Ge),Ht(Ve),li(Se)),ut=et.data,bt=[];for(const rt of Be){const Et=this.stride*rt;bt.push(ut[Et+pt]>1?wt(ut,Et,this.clusterProps):this.points[ut[Et+We]])}return bt}getChildren(ie){const ne=this._getOriginId(ie),me=this._getOriginZoom(ie),Se="No cluster with the specified id.",Ve=this.trees[me];if(!Ve)throw new Error(Se);const Ge=Ve.data;if(ne*this.stride>=Ge.length)throw new Error(Se);const et=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Be=Ve.within(Ge[ne*this.stride],Ge[ne*this.stride+1],et),ut=[];for(const bt of Be){const rt=bt*this.stride;Ge[rt+4]===ie&&ut.push(Ge[rt+pt]>1?wt(Ge,rt,this.clusterProps):this.points[Ge[rt+We]])}if(ut.length===0)throw new Error(Se);return ut}getLeaves(ie,ne,me){const Se=[];return this._appendLeaves(Se,ie,ne=ne||10,me=me||0,0),Se}getTile(ie,ne,me){const Se=this.trees[this._limitZoom(ie)],Ve=Math.pow(2,ie),{extent:Ge,radius:et}=this.options,Be=et/Ge,ut=(me-Be)/Ve,bt=(me+1+Be)/Ve,rt={features:[]};return this._addTileFeatures(Se.range((ne-Be)/Ve,ut,(ne+1+Be)/Ve,bt),Se.data,ne,me,Ve,rt),ne===0&&this._addTileFeatures(Se.range(1-Be/Ve,ut,1,bt),Se.data,Ve,me,Ve,rt),ne===Ve-1&&this._addTileFeatures(Se.range(0,ut,Be/Ve,bt),Se.data,-1,me,Ve,rt),rt.features.length?rt:null}getClusterExpansionZoom(ie){let ne=this._getOriginZoom(ie)-1;for(;ne<=this.options.maxZoom;){const me=this.getChildren(ie);if(ne++,me.length!==1)break;ie=me[0].properties.cluster_id}return ne}_appendLeaves(ie,ne,me,Se,Ve){const Ge=this.getChildren(ne);for(const et of Ge){const Be=et.properties;if(Be&&Be.cluster?Ve+Be.point_count<=Se?Ve+=Be.point_count:Ve=this._appendLeaves(ie,Be.cluster_id,me,Se,Ve):Ve<Se?Ve++:ie.push(et),ie.length===me)break}return Ve}_createTree(ie){const ne=new h.av(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<ie.length;me+=this.stride)ne.add(ie[me],ie[me+1]);return ne.finish(),ne.data=ie,ne}_addTileFeatures(ie,ne,me,Se,Ve,Ge){for(const et of ie){const Be=et*this.stride,ut=ne[Be+pt]>1;let bt,rt,Et;if(ut)bt=Tt(ne,Be,this.clusterProps),rt=ne[Be],Et=ne[Be+1];else{const ji=this.points[ne[Be+We]];bt=ji.properties;const[wi,zi]=ji.geometry.coordinates;rt=Ht(wi),Et=li(zi)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(rt*Ve-me)),Math.round(this.options.extent*(Et*Ve-Se))]],tags:bt};let ri;ri=ut||this.options.generateId?ne[Be+We]:this.points[ne[Be+We]].id,ri!==void 0&&(Qt.id=ri),Ge.features.push(Qt)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,ne){const{radius:me,extent:Se,reduce:Ve,minPoints:Ge}=this.options,et=me/(Se*Math.pow(2,ne)),Be=ie.data,ut=[],bt=this.stride;for(let rt=0;rt<Be.length;rt+=bt){if(Be[rt+2]<=ne)continue;Be[rt+2]=ne;const Et=Be[rt],Qt=Be[rt+1],ri=ie.within(Be[rt],Be[rt+1],et),ji=Be[rt+pt];let wi=ji;for(const zi of ri){const Si=zi*bt;Be[Si+2]>ne&&(wi+=Be[Si+pt])}if(wi>ji&&wi>=Ge){let zi,Si=Et*ji,hn=Qt*ji,fn=-1;const Ke=((rt/bt|0)<<5)+(ne+1)+this.points.length;for(const pi of ri){const ki=pi*bt;if(Be[ki+2]<=ne)continue;Be[ki+2]=ne;const Ui=Be[ki+pt];Si+=Be[ki]*Ui,hn+=Be[ki+1]*Ui,Be[ki+4]=Ke,Ve&&(zi||(zi=this._map(Be,rt,!0),fn=this.clusterProps.length,this.clusterProps.push(zi)),Ve(zi,this._map(Be,ki)))}Be[rt+4]=Ke,ut.push(Si/wi,hn/wi,1/0,Ke,-1,wi),Ve&&ut.push(fn)}else{for(let zi=0;zi<bt;zi++)ut.push(Be[rt+zi]);if(wi>1)for(const zi of ri){const Si=zi*bt;if(!(Be[Si+2]<=ne)){Be[Si+2]=ne;for(let hn=0;hn<bt;hn++)ut.push(Be[Si+hn])}}}}return ut}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,ne,me){if(ie[ne+pt]>1){const Ge=this.clusterProps[ie[ne+kt]];return me?Object.assign({},Ge):Ge}const Se=this.points[ie[ne+We]].properties,Ve=this.options.map(Se);return me&&Ve===Se?Object.assign({},Ve):Ve}}function wt(Le,ie,ne){return{type:"Feature",id:Le[ie+We],properties:Tt(Le,ie,ne),geometry:{type:"Point",coordinates:[(me=Le[ie],360*(me-.5)),Mi(Le[ie+1])]}};var me}function Tt(Le,ie,ne){const me=Le[ie+pt],Se=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ve=Le[ie+kt],Ge=Ve===-1?{}:Object.assign({},ne[Ve]);return Object.assign(Ge,{cluster:!0,cluster_id:Le[ie+We],point_count:me,point_count_abbreviated:Se})}function Ht(Le){return Le/360+.5}function li(Le){const ie=Math.sin(Le*Math.PI/180),ne=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ne<0?0:ne>1?1:ne}function Mi(Le){const ie=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function Pi(Le,ie,ne,me){let Se=me;const Ve=ie+(ne-ie>>1);let Ge,et=ne-ie;const Be=Le[ie],ut=Le[ie+1],bt=Le[ne],rt=Le[ne+1];for(let Et=ie+3;Et<ne;Et+=3){const Qt=Ti(Le[Et],Le[Et+1],Be,ut,bt,rt);if(Qt>Se)Ge=Et,Se=Qt;else if(Qt===Se){const ri=Math.abs(Et-Ve);ri<et&&(Ge=Et,et=ri)}}Se>me&&(Ge-ie>3&&Pi(Le,ie,Ge,me),Le[Ge+2]=Se,ne-Ge>3&&Pi(Le,Ge,ne,me))}function Ti(Le,ie,ne,me,Se,Ve){let Ge=Se-ne,et=Ve-me;if(Ge!==0||et!==0){const Be=((Le-ne)*Ge+(ie-me)*et)/(Ge*Ge+et*et);Be>1?(ne=Se,me=Ve):Be>0&&(ne+=Ge*Be,me+=et*Be)}return Ge=Le-ne,et=ie-me,Ge*Ge+et*et}function At(Le,ie,ne,me){const Se={id:Le??null,type:ie,geometry:ne,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")Xe(Se,ne);else if(ie==="Polygon")Xe(Se,ne[0]);else if(ie==="MultiLineString")for(const Ve of ne)Xe(Se,Ve);else if(ie==="MultiPolygon")for(const Ve of ne)Xe(Se,Ve[0]);return Se}function Xe(Le,ie){for(let ne=0;ne<ie.length;ne+=3)Le.minX=Math.min(Le.minX,ie[ne]),Le.minY=Math.min(Le.minY,ie[ne+1]),Le.maxX=Math.max(Le.maxX,ie[ne]),Le.maxY=Math.max(Le.maxY,ie[ne+1])}function Pt(Le,ie,ne,me){if(!ie.geometry)return;const Se=ie.geometry.coordinates;if(Se&&Se.length===0)return;const Ve=ie.geometry.type,Ge=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2);let et=[],Be=ie.id;if(ne.promoteId?Be=ie.properties[ne.promoteId]:ne.generateId&&(Be=me||0),Ve==="Point")ni(Se,et);else if(Ve==="MultiPoint")for(const ut of Se)ni(ut,et);else if(Ve==="LineString")$e(Se,et,Ge,!1);else if(Ve==="MultiLineString"){if(ne.lineMetrics){for(const ut of Se)et=[],$e(ut,et,Ge,!1),Le.push(At(Be,"LineString",et,ie.properties));return}yi(Se,et,Ge,!1)}else if(Ve==="Polygon")yi(Se,et,Ge,!0);else{if(Ve!=="MultiPolygon"){if(Ve==="GeometryCollection"){for(const ut of ie.geometry.geometries)Pt(Le,{id:Be,geometry:ut,properties:ie.properties},ne,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ut of Se){const bt=[];yi(ut,bt,Ge,!0),et.push(bt)}}Le.push(At(Be,Ve,et,ie.properties))}function ni(Le,ie){ie.push(yt(Le[0]),it(Le[1]),0)}function $e(Le,ie,ne,me){let Se,Ve,Ge=0;for(let Be=0;Be<Le.length;Be++){const ut=yt(Le[Be][0]),bt=it(Le[Be][1]);ie.push(ut,bt,0),Be>0&&(Ge+=me?(Se*bt-ut*Ve)/2:Math.sqrt(Math.pow(ut-Se,2)+Math.pow(bt-Ve,2))),Se=ut,Ve=bt}const et=ie.length-3;ie[2]=1,Pi(ie,0,et,ne),ie[et+2]=1,ie.size=Math.abs(Ge),ie.start=0,ie.end=ie.size}function yi(Le,ie,ne,me){for(let Se=0;Se<Le.length;Se++){const Ve=[];$e(Le[Se],Ve,ne,me),ie.push(Ve)}}function yt(Le){return Le/360+.5}function it(Le){const ie=Math.sin(Le*Math.PI/180),ne=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ne<0?0:ne>1?1:ne}function fe(Le,ie,ne,me,Se,Ve,Ge,et){if(me/=ie,Ve>=(ne/=ie)&&Ge<me)return Le;if(Ge<ne||Ve>=me)return null;const Be=[];for(const ut of Le){const bt=ut.geometry;let rt=ut.type;const Et=Se===0?ut.minX:ut.minY,Qt=Se===0?ut.maxX:ut.maxY;if(Et>=ne&&Qt<me){Be.push(ut);continue}if(Qt<ne||Et>=me)continue;let ri=[];if(rt==="Point"||rt==="MultiPoint")X(bt,ri,ne,me,Se);else if(rt==="LineString")Q(bt,ri,ne,me,Se,!1,et.lineMetrics);else if(rt==="MultiLineString")Ze(bt,ri,ne,me,Se,!1);else if(rt==="Polygon")Ze(bt,ri,ne,me,Se,!0);else if(rt==="MultiPolygon")for(const ji of bt){const wi=[];Ze(ji,wi,ne,me,Se,!0),wi.length&&ri.push(wi)}if(ri.length){if(et.lineMetrics&&rt==="LineString"){for(const ji of ri)Be.push(At(ut.id,rt,ji,ut.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(ri.length===1?(rt="LineString",ri=ri[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=ri.length===3?"Point":"MultiPoint"),Be.push(At(ut.id,rt,ri,ut.tags))}}return Be.length?Be:null}function X(Le,ie,ne,me,Se){for(let Ve=0;Ve<Le.length;Ve+=3){const Ge=Le[Ve+Se];Ge>=ne&&Ge<=me&&dt(ie,Le[Ve],Le[Ve+1],Le[Ve+2])}}function Q(Le,ie,ne,me,Se,Ve,Ge){let et=Me(Le);const Be=Se===0?st:Ci;let ut,bt,rt=Le.start;for(let wi=0;wi<Le.length-3;wi+=3){const zi=Le[wi],Si=Le[wi+1],hn=Le[wi+2],fn=Le[wi+3],Ke=Le[wi+4],pi=Se===0?zi:Si,ki=Se===0?fn:Ke;let Ui=!1;Ge&&(ut=Math.sqrt(Math.pow(zi-fn,2)+Math.pow(Si-Ke,2))),pi<ne?ki>ne&&(bt=Be(et,zi,Si,fn,Ke,ne),Ge&&(et.start=rt+ut*bt)):pi>me?ki<me&&(bt=Be(et,zi,Si,fn,Ke,me),Ge&&(et.start=rt+ut*bt)):dt(et,zi,Si,hn),ki<ne&&pi>=ne&&(bt=Be(et,zi,Si,fn,Ke,ne),Ui=!0),ki>me&&pi<=me&&(bt=Be(et,zi,Si,fn,Ke,me),Ui=!0),!Ve&&Ui&&(Ge&&(et.end=rt+ut*bt),ie.push(et),et=Me(Le)),Ge&&(rt+=ut)}let Et=Le.length-3;const Qt=Le[Et],ri=Le[Et+1],ji=Se===0?Qt:ri;ji>=ne&&ji<=me&&dt(et,Qt,ri,Le[Et+2]),Et=et.length-3,Ve&&Et>=3&&(et[Et]!==et[0]||et[Et+1]!==et[1])&&dt(et,et[0],et[1],et[2]),et.length&&ie.push(et)}function Me(Le){const ie=[];return ie.size=Le.size,ie.start=Le.start,ie.end=Le.end,ie}function Ze(Le,ie,ne,me,Se,Ve){for(const Ge of Le)Q(Ge,ie,ne,me,Se,Ve,!1)}function dt(Le,ie,ne,me){Le.push(ie,ne,me)}function st(Le,ie,ne,me,Se,Ve){const Ge=(Ve-ie)/(me-ie);return dt(Le,Ve,ne+(Se-ne)*Ge,1),Ge}function Ci(Le,ie,ne,me,Se,Ve){const Ge=(Ve-ne)/(Se-ne);return dt(Le,ie+(me-ie)*Ge,Ve,1),Ge}function ft(Le,ie){const ne=[];for(let me=0;me<Le.length;me++){const Se=Le[me],Ve=Se.type;let Ge;if(Ve==="Point"||Ve==="MultiPoint"||Ve==="LineString")Ge=Wt(Se.geometry,ie);else if(Ve==="MultiLineString"||Ve==="Polygon"){Ge=[];for(const et of Se.geometry)Ge.push(Wt(et,ie))}else if(Ve==="MultiPolygon"){Ge=[];for(const et of Se.geometry){const Be=[];for(const ut of et)Be.push(Wt(ut,ie));Ge.push(Be)}}ne.push(At(Se.id,Ve,Ge,Se.tags))}return ne}function Wt(Le,ie){const ne=[];ne.size=Le.size,Le.start!==void 0&&(ne.start=Le.start,ne.end=Le.end);for(let me=0;me<Le.length;me+=3)ne.push(Le[me]+ie,Le[me+1],Le[me+2]);return ne}function Ei(Le,ie){if(Le.transformed)return Le;const ne=1<<Le.z,me=Le.x,Se=Le.y;for(const Ve of Le.features){const Ge=Ve.geometry,et=Ve.type;if(Ve.geometry=[],et===1)for(let Be=0;Be<Ge.length;Be+=2)Ve.geometry.push(Bi(Ge[Be],Ge[Be+1],ie,ne,me,Se));else for(let Be=0;Be<Ge.length;Be++){const ut=[];for(let bt=0;bt<Ge[Be].length;bt+=2)ut.push(Bi(Ge[Be][bt],Ge[Be][bt+1],ie,ne,me,Se));Ve.geometry.push(ut)}}return Le.transformed=!0,Le}function Bi(Le,ie,ne,me,Se,Ve){return[Math.round(ne*(Le*me-Se)),Math.round(ne*(ie*me-Ve))]}function Cn(Le,ie,ne,me,Se){const Ve=ie===Se.maxZoom?0:Se.tolerance/((1<<ie)*Se.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:Le.length,source:null,x:ne,y:me,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of Le)St(Ge,et,Ve,Se);return Ge}function St(Le,ie,ne,me){const Se=ie.geometry,Ve=ie.type,Ge=[];if(Le.minX=Math.min(Le.minX,ie.minX),Le.minY=Math.min(Le.minY,ie.minY),Le.maxX=Math.max(Le.maxX,ie.maxX),Le.maxY=Math.max(Le.maxY,ie.maxY),Ve==="Point"||Ve==="MultiPoint")for(let et=0;et<Se.length;et+=3)Ge.push(Se[et],Se[et+1]),Le.numPoints++,Le.numSimplified++;else if(Ve==="LineString")ui(Ge,Se,Le,ne,!1,!1);else if(Ve==="MultiLineString"||Ve==="Polygon")for(let et=0;et<Se.length;et++)ui(Ge,Se[et],Le,ne,Ve==="Polygon",et===0);else if(Ve==="MultiPolygon")for(let et=0;et<Se.length;et++){const Be=Se[et];for(let ut=0;ut<Be.length;ut++)ui(Ge,Be[ut],Le,ne,!0,ut===0)}if(Ge.length){let et=ie.tags||null;if(Ve==="LineString"&&me.lineMetrics){et={};for(const ut in ie.tags)et[ut]=ie.tags[ut];et.mapbox_clip_start=Se.start/Se.size,et.mapbox_clip_end=Se.end/Se.size}const Be={geometry:Ge,type:Ve==="Polygon"||Ve==="MultiPolygon"?3:Ve==="LineString"||Ve==="MultiLineString"?2:1,tags:et};ie.id!==null&&(Be.id=ie.id),Le.features.push(Be)}}function ui(Le,ie,ne,me,Se,Ve){const Ge=me*me;if(me>0&&ie.size<(Se?Ge:me))return void(ne.numPoints+=ie.length/3);const et=[];for(let Be=0;Be<ie.length;Be+=3)(me===0||ie[Be+2]>Ge)&&(ne.numSimplified++,et.push(ie[Be],ie[Be+1])),ne.numPoints++;Se&&function(Be,ut){let bt=0;for(let rt=0,Et=Be.length,Qt=Et-2;rt<Et;Qt=rt,rt+=2)bt+=(Be[rt]-Be[Qt])*(Be[rt+1]+Be[Qt+1]);if(bt>0===ut)for(let rt=0,Et=Be.length;rt<Et/2;rt+=2){const Qt=Be[rt],ri=Be[rt+1];Be[rt]=Be[Et-2-rt],Be[rt+1]=Be[Et-1-rt],Be[Et-2-rt]=Qt,Be[Et-1-rt]=ri}}(et,Ve),Le.push(et)}const ii={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class sn{constructor(ie,ne){const me=(ne=this.options=function(Ve,Ge){for(const et in Ge)Ve[et]=Ge[et];return Ve}(Object.create(ii),ne)).debug;if(me&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=function(Ve,Ge){const et=[];if(Ve.type==="FeatureCollection")for(let Be=0;Be<Ve.features.length;Be++)Pt(et,Ve.features[Be],Ge,Be);else Pt(et,Ve.type==="Feature"?Ve:{geometry:Ve},Ge);return et}(ie,ne);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=function(Ve,Ge){const et=Ge.buffer/Ge.extent;let Be=Ve;const ut=fe(Ve,1,-1-et,et,0,-1,2,Ge),bt=fe(Ve,1,1-et,2+et,0,-1,2,Ge);return(ut||bt)&&(Be=fe(Ve,1,-et,1+et,0,-1,2,Ge)||[],ut&&(Be=ft(ut,1).concat(Be)),bt&&(Be=Be.concat(ft(bt,-1)))),Be}(Se,ne),Se.length&&this.splitTile(Se,0,0,0),me&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ie,ne,me,Se,Ve,Ge,et){const Be=[ie,ne,me,Se],ut=this.options,bt=ut.debug;for(;Be.length;){Se=Be.pop(),me=Be.pop(),ne=Be.pop(),ie=Be.pop();const rt=1<<ne,Et=_r(ne,me,Se);let Qt=this.tiles[Et];if(!Qt&&(bt>1&&console.time("creation"),Qt=this.tiles[Et]=Cn(ie,ne,me,Se,ut),this.tileCoords.push({z:ne,x:me,y:Se}),bt)){bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,me,Se,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Ui=`z${ne}`;this.stats[Ui]=(this.stats[Ui]||0)+1,this.total++}if(Qt.source=ie,Ve==null){if(ne===ut.indexMaxZoom||Qt.numPoints<=ut.indexMaxPoints)continue}else{if(ne===ut.maxZoom||ne===Ve)continue;if(Ve!=null){const Ui=Ve-ne;if(me!==Ge>>Ui||Se!==et>>Ui)continue}}if(Qt.source=null,ie.length===0)continue;bt>1&&console.time("clipping");const ri=.5*ut.buffer/ut.extent,ji=.5-ri,wi=.5+ri,zi=1+ri;let Si=null,hn=null,fn=null,Ke=null,pi=fe(ie,rt,me-ri,me+wi,0,Qt.minX,Qt.maxX,ut),ki=fe(ie,rt,me+ji,me+zi,0,Qt.minX,Qt.maxX,ut);ie=null,pi&&(Si=fe(pi,rt,Se-ri,Se+wi,1,Qt.minY,Qt.maxY,ut),hn=fe(pi,rt,Se+ji,Se+zi,1,Qt.minY,Qt.maxY,ut),pi=null),ki&&(fn=fe(ki,rt,Se-ri,Se+wi,1,Qt.minY,Qt.maxY,ut),Ke=fe(ki,rt,Se+ji,Se+zi,1,Qt.minY,Qt.maxY,ut),ki=null),bt>1&&console.timeEnd("clipping"),Be.push(Si||[],ne+1,2*me,2*Se),Be.push(hn||[],ne+1,2*me,2*Se+1),Be.push(fn||[],ne+1,2*me+1,2*Se),Be.push(Ke||[],ne+1,2*me+1,2*Se+1)}}getTile(ie,ne,me){ie=+ie,ne=+ne,me=+me;const Se=this.options,{extent:Ve,debug:Ge}=Se;if(ie<0||ie>24)return null;const et=1<<ie,Be=_r(ie,ne=ne+et&et-1,me);if(this.tiles[Be])return Ei(this.tiles[Be],Ve);Ge>1&&console.log("drilling down to z%d-%d-%d",ie,ne,me);let ut,bt=ie,rt=ne,Et=me;for(;!ut&&bt>0;)bt--,rt>>=1,Et>>=1,ut=this.tiles[_r(bt,rt,Et)];return ut&&ut.source?(Ge>1&&(console.log("found parent tile z%d-%d-%d",bt,rt,Et),console.time("drilling down")),this.splitTile(ut.source,bt,rt,Et,ie,ne,me),Ge>1&&console.timeEnd("drilling down"),this.tiles[Be]?Ei(this.tiles[Be],Ve):null):null}}function _r(Le,ie,ne){return 32*((1<<Le)*ne+ie)+Le}function ci(Le,ie){return ie?Le.properties[ie]:Le.id}function yr(Le,ie){if(Le==null)return!0;if(Le.type==="Feature")return ci(Le,ie)!=null;if(Le.type==="FeatureCollection"){const ne=new Set;for(const me of Le.features){const Se=ci(me,ie);if(Se==null||ne.has(Se))return!1;ne.add(Se)}return!0}return!1}function br(Le,ie){const ne=new Map;if(Le!=null)if(Le.type==="Feature")ne.set(ci(Le,ie),Le);else for(const me of Le.features)ne.set(ci(me,ie),me);return ne}class Ar extends y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ie,ne){return h._(this,void 0,void 0,function*(){const me=ie.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!Se)return null;const Ve=new class{constructor(et){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.X,this.length=et.length,this._features=et}feature(et){return new class{constructor(Be){this._feature=Be,this.extent=h.X,this.type=Be.type,this.properties=Be.tags,"id"in Be&&!isNaN(Be.id)&&(this.id=parseInt(Be.id,10))}loadGeometry(){if(this._feature.type===1){const Be=[];for(const ut of this._feature.geometry)Be.push([new h.P(ut[0],ut[1])]);return Be}{const Be=[];for(const ut of this._feature.geometry){const bt=[];for(const rt of ut)bt.push(new h.P(rt[0],rt[1]));Be.push(bt)}return Be}}toGeoJSON(Be,ut,bt){return R.call(this,Be,ut,bt)}}(this._features[et])}}(Se.features);let Ge=we(Ve);return Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),{vectorTile:Ve,rawData:Ge.buffer}})}loadData(ie){return h._(this,void 0,void 0,function*(){var ne;(ne=this._pendingRequest)===null||ne===void 0||ne.abort();const me=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new h.bv(ie.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ie,this._pendingRequest),this._geoJSONIndex=ie.cluster?new Je(function({superclusterOptions:Ge,clusterProperties:et}){if(!et||!Ge)return Ge;const Be={},ut={},bt={accumulated:null,zoom:0},rt={properties:null},Et=Object.keys(et);for(const Qt of Et){const[ri,ji]=et[Qt],wi=h.bC(ji),zi=h.bC(typeof ri=="string"?[ri,["accumulated"],["get",Qt]]:ri);Be[Qt]=wi.value,ut[Qt]=zi.value}return Ge.map=Qt=>{rt.properties=Qt;const ri={};for(const ji of Et)ri[ji]=Be[ji].evaluate(bt,rt);return ri},Ge.reduce=(Qt,ri)=>{rt.properties=ri;for(const ji of Et)bt.accumulated=Qt[ji],Qt[ji]=ut[ji].evaluate(bt,rt)},Ge}(ie)).load((yield this._pendingData).features):(Se=yield this._pendingData,new sn(Se,ie.geojsonVtOptions)),this.loaded={};const Ve={};if(me){const Ge=me.finish();Ge&&(Ve.resourceTiming={},Ve.resourceTiming[ie.source]=JSON.parse(JSON.stringify(Ge)))}return Ve}catch(Ve){if(delete this._pendingRequest,h.bB(Ve))return{abandoned:!0};throw Ve}var Se})}getData(){return h._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ie){const ne=this.loaded;return ne&&ne[ie.uid]?super.reloadTile(ie):this.loadTile(ie)}loadAndProcessGeoJSON(ie,ne){return h._(this,void 0,void 0,function*(){let me=yield this.loadGeoJSON(ie,ne);if(delete this._pendingRequest,typeof me!="object")throw new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`);if(M(me,!0),ie.filter){const Se=h.bC(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(Ge=>`${Ge.key}: ${Ge.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(Ge=>Se.value.evaluate({zoom:0},Ge))}}return me})}loadGeoJSON(ie,ne){return h._(this,void 0,void 0,function*(){const{promoteId:me}=ie;if(ie.request){const Se=yield h.h(ie.request,ne);return this._dataUpdateable=yr(Se.data,me)?br(Se.data,me):void 0,Se.data}if(typeof ie.data=="string")try{const Se=JSON.parse(ie.data);return this._dataUpdateable=yr(Se,me)?br(Se,me):void 0,Se}catch{throw new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`)}if(!ie.dataDiff)throw new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ie.source}`);return function(Se,Ve,Ge){var et,Be,ut,bt;if(Ve.removeAll&&Se.clear(),Ve.remove)for(const rt of Ve.remove)Se.delete(rt);if(Ve.add)for(const rt of Ve.add){const Et=ci(rt,Ge);Et!=null&&Se.set(Et,rt)}if(Ve.update)for(const rt of Ve.update){let Et=Se.get(rt.id);if(Et==null)continue;const Qt=!rt.removeAllProperties&&(((et=rt.removeProperties)===null||et===void 0?void 0:et.length)>0||((Be=rt.addOrUpdateProperties)===null||Be===void 0?void 0:Be.length)>0);if((rt.newGeometry||rt.removeAllProperties||Qt)&&(Et=Object.assign({},Et),Se.set(rt.id,Et),Qt&&(Et.properties=Object.assign({},Et.properties))),rt.newGeometry&&(Et.geometry=rt.newGeometry),rt.removeAllProperties)Et.properties={};else if(((ut=rt.removeProperties)===null||ut===void 0?void 0:ut.length)>0)for(const ri of rt.removeProperties)Object.prototype.hasOwnProperty.call(Et.properties,ri)&&delete Et.properties[ri];if(((bt=rt.addOrUpdateProperties)===null||bt===void 0?void 0:bt.length)>0)for(const{key:ri,value:ji}of rt.addOrUpdateProperties)Et.properties[ri]=ji}}(this._dataUpdateable,ie.dataDiff,me),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ie){return h._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ie){return this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId)}getClusterChildren(ie){return this._geoJSONIndex.getChildren(ie.clusterId)}getClusterLeaves(ie){return this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset)}}class Mr{constructor(ie){this.self=ie,this.actor=new h.F(ie),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ne,me)=>{if(this.externalWorkerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.externalWorkerSourceTypes[ne]=me},this.self.addProtocol=h.bi,this.self.removeProtocol=h.bj,this.self.registerRTLTextPlugin=ne=>{if(h.bD.isParsed())throw new Error("RTL text plugin already registered.");h.bD.setMethods(ne)},this.actor.registerMessageHandler("LDT",(ne,me)=>this._getDEMWorkerSource(ne,me.source).loadTile(me)),this.actor.registerMessageHandler("RDT",(ne,me)=>h._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ne,me.source).removeTile(me)})),this.actor.registerMessageHandler("GCEZ",(ne,me)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(ne,me.type,me.source).getClusterExpansionZoom(me)})),this.actor.registerMessageHandler("GCC",(ne,me)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(ne,me.type,me.source).getClusterChildren(me)})),this.actor.registerMessageHandler("GCL",(ne,me)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(ne,me.type,me.source).getClusterLeaves(me)})),this.actor.registerMessageHandler("LD",(ne,me)=>this._getWorkerSource(ne,me.type,me.source).loadData(me)),this.actor.registerMessageHandler("GD",(ne,me)=>this._getWorkerSource(ne,me.type,me.source).getData()),this.actor.registerMessageHandler("LT",(ne,me)=>this._getWorkerSource(ne,me.type,me.source).loadTile(me)),this.actor.registerMessageHandler("RT",(ne,me)=>this._getWorkerSource(ne,me.type,me.source).reloadTile(me)),this.actor.registerMessageHandler("AT",(ne,me)=>this._getWorkerSource(ne,me.type,me.source).abortTile(me)),this.actor.registerMessageHandler("RMT",(ne,me)=>this._getWorkerSource(ne,me.type,me.source).removeTile(me)),this.actor.registerMessageHandler("RS",(ne,me)=>h._(this,void 0,void 0,function*(){if(!this.workerSources[ne]||!this.workerSources[ne][me.type]||!this.workerSources[ne][me.type][me.source])return;const Se=this.workerSources[ne][me.type][me.source];delete this.workerSources[ne][me.type][me.source],Se.removeSource!==void 0&&Se.removeSource(me)})),this.actor.registerMessageHandler("RM",ne=>h._(this,void 0,void 0,function*(){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne]})),this.actor.registerMessageHandler("SR",(ne,me)=>h._(this,void 0,void 0,function*(){this.referrer=me})),this.actor.registerMessageHandler("SRPS",(ne,me)=>this._syncRTLPluginState(ne,me)),this.actor.registerMessageHandler("IS",(ne,me)=>h._(this,void 0,void 0,function*(){this.self.importScripts(me)})),this.actor.registerMessageHandler("SI",(ne,me)=>this._setImages(ne,me)),this.actor.registerMessageHandler("UL",(ne,me)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(ne).update(me.layers,me.removedIds)})),this.actor.registerMessageHandler("SL",(ne,me)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(ne).replace(me)}))}_setImages(ie,ne){return h._(this,void 0,void 0,function*(){this.availableImages[ie]=ne;for(const me in this.workerSources[ie]){const Se=this.workerSources[ie][me];for(const Ve in Se)Se[Ve].availableImages=ne}})}_syncRTLPluginState(ie,ne){return h._(this,void 0,void 0,function*(){if(h.bD.isParsed())return h.bD.getState();if(ne.pluginStatus!=="loading")return h.bD.setState(ne),ne;const me=ne.pluginURL;if(this.self.importScripts(me),h.bD.isParsed()){const Se={pluginStatus:"loaded",pluginURL:me};return h.bD.setState(Se),Se}throw h.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${me}`)})}_getAvailableImages(ie){let ne=this.availableImages[ie];return ne||(ne=[]),ne}_getLayerIndex(ie){let ne=this.layerIndexes[ie];return ne||(ne=this.layerIndexes[ie]=new a),ne}_getWorkerSource(ie,ne,me){if(this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][ne]||(this.workerSources[ie][ne]={}),!this.workerSources[ie][ne][me]){const Se={sendAsync:(Ve,Ge)=>(Ve.targetMapId=ie,this.actor.sendAsync(Ve,Ge))};switch(ne){case"vector":this.workerSources[ie][ne][me]=new y(Se,this._getLayerIndex(ie),this._getAvailableImages(ie));break;case"geojson":this.workerSources[ie][ne][me]=new Ar(Se,this._getLayerIndex(ie),this._getAvailableImages(ie));break;default:this.workerSources[ie][ne][me]=new this.externalWorkerSourceTypes[ne](Se,this._getLayerIndex(ie),this._getAvailableImages(ie))}}return this.workerSources[ie][ne][me]}_getDEMWorkerSource(ie,ne){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][ne]||(this.demWorkerSources[ie][ne]=new C),this.demWorkerSources[ie][ne]}}return h.i(self)&&(self.worker=new Mr(self)),Mr}),c("index",["exports","./shared"],function(h,a){var _="4.7.1";let S,k;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((t,u)=>{const p=requestAnimationFrame(t);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),u(a.c())})}),getImageData(v,t=0){return this.getImageCanvasContext(v).getImageData(-t,-t,v.width+2*t,v.height+2*t)},getImageCanvasContext(v){const t=window.document.createElement("canvas"),u=t.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return t.width=v.width,t.height=v.height,u.drawImage(v,0,0,v.width,v.height),u},resolveURL:v=>(S||(S=document.createElement("a")),S.href=v,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class C{static testProp(t){if(!C.docStyle)return t[0];for(let u=0;u<t.length;u++)if(t[u]in C.docStyle)return t[u];return t[0]}static create(t,u,p){const m=window.document.createElement(t);return u!==void 0&&(m.className=u),p&&p.appendChild(m),m}static createNS(t,u){return window.document.createElementNS(t,u)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(t,u){t.style[C.transformProp]=u}static addEventListener(t,u,p,m={}){t.addEventListener(u,p,"passive"in m?m:m.capture)}static removeEventListener(t,u,p,m={}){t.removeEventListener(u,p,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(t){const u=t.getBoundingClientRect();return{x:u.width/t.offsetWidth||1,y:u.height/t.offsetHeight||1,boundingClientRect:u}}static getPoint(t,u,p){const m=u.boundingClientRect;return new a.P((p.clientX-m.left)/u.x-t.clientLeft,(p.clientY-m.top)/u.y-t.clientTop)}static mousePos(t,u){const p=C.getScale(t);return C.getPoint(t,p,u)}static touchPos(t,u){const p=[],m=C.getScale(t);for(let b=0;b<u.length;b++)p.push(C.getPoint(t,m,u[b]));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const E={supported:!1,testSupport:function(v){!R&&M&&(N?z(v):T=v)}};let T,M,R=!1,N=!1;function z(v){const t=v.createTexture();v.bindTexture(v.TEXTURE_2D,t);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,M),v.isContextLost())return;E.supported=!0}catch{}v.deleteTexture(t),R=!0}var V;typeof document<"u"&&(M=document.createElement("img"),M.onload=()=>{T&&z(T),T=null,N=!0},M.onerror=()=>{R=!0,T=null},M.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let t,u,p,m;v.resetRequestQueue=()=>{t=[],u=0,p=0,m={}},v.addThrottleControl=D=>{const Z=p++;return m[Z]=D,Z},v.removeThrottleControl=D=>{delete m[D],A()},v.getImage=(D,Z,K=!0)=>new Promise((J,ae)=>{E.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),a.e(D,{type:"image"}),t.push({abortController:Z,requestParameters:D,supportImageRefresh:K,state:"queued",onError:_e=>{ae(_e)},onSuccess:_e=>{J(_e)}}),A()});const b=D=>a._(this,void 0,void 0,function*(){D.state="running";const{requestParameters:Z,supportImageRefresh:K,onError:J,onSuccess:ae,abortController:_e}=D,ke=K===!1&&!a.i(self)&&!a.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce((Fe,je)=>Fe&&je==="accept",!0));u++;const Ie=ke?L(Z,_e):a.m(Z,_e);try{const Fe=yield Ie;delete D.abortController,D.state="completed",Fe.data instanceof HTMLImageElement||a.b(Fe.data)?ae(Fe):Fe.data&&ae({data:yield(Oe=Fe.data,typeof createImageBitmap=="function"?a.d(Oe):a.f(Oe)),cacheControl:Fe.cacheControl,expires:Fe.expires})}catch(Fe){delete D.abortController,J(Fe)}finally{u--,A()}var Oe}),A=()=>{const D=(()=>{for(const Z of Object.keys(m))if(m[Z]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=u;Z<D&&t.length>0;Z++){const K=t.shift();K.abortController.signal.aborted?Z--:b(K)}},L=(D,Z)=>new Promise((K,J)=>{const ae=new Image,_e=D.url,ke=D.credentials;ke&&ke==="include"?ae.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!a.s(_e))&&(ae.crossOrigin="anonymous"),Z.signal.addEventListener("abort",()=>{ae.src="",J(a.c())}),ae.fetchPriority="high",ae.onload=()=>{ae.onerror=ae.onload=null,K({data:ae})},ae.onerror=()=>{ae.onerror=ae.onload=null,Z.signal.aborted||J(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ae.src=_e})}(V||(V={})),V.resetRequestQueue();class Y{constructor(t){this._transformRequestFn=t}transformRequest(t,u){return this._transformRequestFn&&this._transformRequestFn(t,u)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function se(v){var t=new a.A(3);return t[0]=v[0],t[1]=v[1],t[2]=v[2],t}var $,te=function(v,t,u){return v[0]=t[0]-u[0],v[1]=t[1]-u[1],v[2]=t[2]-u[2],v};$=new a.A(3),a.A!=Float32Array&&($[0]=0,$[1]=0,$[2]=0);var U=function(v){var t=v[0],u=v[1];return t*t+u*u};function j(v){const t=[];if(typeof v=="string")t.push({id:"default",url:v});else if(v&&v.length>0){const u=[];for(const{id:p,url:m}of v){const b=`${p}${m}`;u.indexOf(b)===-1&&(u.push(b),t.push({id:p,url:m}))}}return t}function G(v,t,u){const p=v.split("?");return p[0]+=`${t}${u}`,p.join("?")}(function(){var v=new a.A(2);a.A!=Float32Array&&(v[0]=0,v[1]=0)})();class O{constructor(t,u,p,m){this.context=t,this.format=p,this.texture=t.gl.createTexture(),this.update(u,m)}update(t,u,p){const{width:m,height:b}=t,A=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:L}=this,{gl:D}=L;if(this.useMipmap=!!(u&&u.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!u||u.premultiply!==!1)),A)this.size=[m,b],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.b(t)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,t):D.texImage2D(D.TEXTURE_2D,0,this.format,m,b,0,this.format,D.UNSIGNED_BYTE,t.data);else{const{x:Z,y:K}=p||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.b(t)?D.texSubImage2D(D.TEXTURE_2D,0,Z,K,D.RGBA,D.UNSIGNED_BYTE,t):D.texSubImage2D(D.TEXTURE_2D,0,Z,K,m,b,D.RGBA,D.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(t,u,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),t!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,t),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||t),this.filter=t),u!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function W(v){const{userImage:t}=v;return!!(t&&t.render&&t.render())&&(v.data.replace(new Uint8Array(t.data.buffer)),!0)}class le extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:u,promiseResolve:p}of this.requestors)p(this._getImagesForIds(u));this.requestors=[]}}getImage(t){const u=this.images[t];if(u&&!u.data&&u.spriteData){const p=u.spriteData;u.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),u.spriteData=null}return u}addImage(t,u){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,u)&&(this.images[t]=u)}_validate(t,u){let p=!0;const m=u.data||u.spriteData;return this._validateStretch(u.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,u){if(!t)return!0;let p=0;for(const m of t){if(m[0]<p||m[1]<m[0]||u<m[1])return!1;p=m[1]}return!0}_validateContent(t,u){if(!t)return!0;if(t.length!==4)return!1;const p=u.spriteData,m=p&&p.width||u.data.width,b=p&&p.height||u.data.height;return!(t[0]<0||m<t[0]||t[1]<0||b<t[1]||t[2]<0||m<t[2]||t[3]<0||b<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,u,p=!0){const m=this.getImage(t);if(p&&(m.data.width!==u.data.width||m.data.height!==u.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=m.version+1,this.images[t]=u,this.updatedImages[t]=!0}removeImage(t){const u=this.images[t];delete this.images[t],delete this.patterns[t],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((u,p)=>{let m=!0;if(!this.isLoaded())for(const b of t)this.images[b]||(m=!1);this.isLoaded()||m?u(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:u})})}_getImagesForIds(t){const u={};for(const p of t){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?u[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:t,height:u}=this.atlasImage;return{width:t,height:u}}getPattern(t){const u=this.patterns[t],p=this.getImage(t);if(!p)return null;if(u&&u.position.version===p.version)return u.position;if(u)u.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new a.I(m,p);this.patterns[t]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const u=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new O(t,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:u,h:p}=a.p(t),m=this.atlasImage;m.resize({width:u||1,height:p||1});for(const b in this.patterns){const{bin:A}=this.patterns[b],L=A.x+1,D=A.y+1,Z=this.getImage(b).data,K=Z.width,J=Z.height;a.R.copy(Z,m,{x:0,y:0},{x:L,y:D},{width:K,height:J}),a.R.copy(Z,m,{x:0,y:J-1},{x:L,y:D-1},{width:K,height:1}),a.R.copy(Z,m,{x:0,y:0},{x:L,y:D+J},{width:K,height:1}),a.R.copy(Z,m,{x:K-1,y:0},{x:L-1,y:D},{width:1,height:J}),a.R.copy(Z,m,{x:0,y:0},{x:L+K,y:D},{width:1,height:J})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const u of t){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const p=this.getImage(u);p||a.w(`Image with ID: "${u}" was not found`),W(p)&&this.updateImage(u,p)}}}const de=1e20;function ve(v,t,u,p,m,b,A,L,D){for(let Z=t;Z<t+p;Z++)pe(v,u*b+Z,b,m,A,L,D);for(let Z=u;Z<u+m;Z++)pe(v,Z*b+t,1,p,A,L,D)}function pe(v,t,u,p,m,b,A){b[0]=0,A[0]=-de,A[1]=de,m[0]=v[t];for(let L=1,D=0,Z=0;L<p;L++){m[L]=v[t+L*u];const K=L*L;do{const J=b[D];Z=(m[L]-m[J]+K-J*J)/(L-J)/2}while(Z<=A[D]&&--D>-1);D++,b[D]=L,A[D]=Z,A[D+1]=de}for(let L=0,D=0;L<p;L++){for(;A[D+1]<L;)D++;const Z=b[D],K=L-Z;v[t+L*u]=m[Z]+K*K}}class we{constructor(t,u){this.requestManager=t,this.localIdeographFontFamily=u,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return a._(this,void 0,void 0,function*(){const u=[];for(const b in t)for(const A of t[b])u.push(this._getAndCacheGlyphsPromise(b,A));const p=yield Promise.all(u),m={};for(const{stack:b,id:A,glyph:L}of p)m[b]||(m[b]={}),m[b][A]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};return m})}_getAndCacheGlyphsPromise(t,u){return a._(this,void 0,void 0,function*(){let p=this.entries[t];p||(p=this.entries[t]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[u];if(m!==void 0)return{stack:t,id:u,glyph:m};if(m=this._tinySDF(p,t,u),m)return p.glyphs[u]=m,{stack:t,id:u,glyph:m};const b=Math.floor(u/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:t,id:u,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const L=we.loadGlyphRange(t,b,this.url,this.requestManager);p.requests[b]=L}const A=yield p.requests[b];for(const L in A)this._doesCharSupportLocalGlyph(+L)||(p.glyphs[+L]=A[+L]);return p.ranges[b]=!0,{stack:t,id:u,glyph:A[u]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))}_tinySDF(t,u,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=t.tinySDF;if(!b){let L="400";/bold/i.test(u)?L="900":/medium/i.test(u)?L="500":/light/i.test(u)&&(L="200"),b=t.tinySDF=new we.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:L})}const A=b.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}we.loadGlyphRange=function(v,t,u,p){return a._(this,void 0,void 0,function*(){const m=256*t,b=m+255,A=p.transformRequest(u.replace("{fontstack}",v).replace("{range}",`${m}-${b}`),"Glyphs"),L=yield a.l(A,new AbortController);if(!L||!L.data)throw new Error(`Could not load glyph range. range: ${t}, ${m}-${b}`);const D={};for(const Z of a.n(L.data))D[Z.id]=Z;return D})},we.TinySDF=class{constructor({fontSize:v=24,buffer:t=3,radius:u=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:A="normal"}={}){this.buffer=t,this.cutoff=p,this.radius=u;const L=this.size=v+4*t,D=this._createCanvas(L),Z=this.ctx=D.getContext("2d",{willReadFrequently:!0});Z.font=`${A} ${b} ${v}px ${m}`,Z.textBaseline="alphabetic",Z.textAlign="left",Z.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(v){const t=document.createElement("canvas");return t.width=t.height=v,t}draw(v){const{width:t,actualBoundingBoxAscent:u,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(v),A=Math.ceil(u),L=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),D=Math.min(this.size-this.buffer,A+Math.ceil(p)),Z=L+2*this.buffer,K=D+2*this.buffer,J=Math.max(Z*K,0),ae=new Uint8ClampedArray(J),_e={data:ae,width:Z,height:K,glyphWidth:L,glyphHeight:D,glyphTop:A,glyphLeft:0,glyphAdvance:t};if(L===0||D===0)return _e;const{ctx:ke,buffer:Ie,gridInner:Oe,gridOuter:Fe}=this;ke.clearRect(Ie,Ie,L,D),ke.fillText(v,Ie,Ie+A);const je=ke.getImageData(Ie,Ie,L,D);Fe.fill(de,0,J),Oe.fill(0,0,J);for(let Ce=0;Ce<D;Ce++)for(let He=0;He<L;He++){const Ye=je.data[4*(Ce*L+He)+3]/255;if(Ye===0)continue;const nt=(Ce+Ie)*Z+He+Ie;if(Ye===1)Fe[nt]=0,Oe[nt]=de;else{const vt=.5-Ye;Fe[nt]=vt>0?vt*vt:0,Oe[nt]=vt<0?vt*vt:0}}ve(Fe,0,0,Z,K,Z,this.f,this.v,this.z),ve(Oe,Ie,Ie,L,D,Z,this.f,this.v,this.z);for(let Ce=0;Ce<J;Ce++){const He=Math.sqrt(Fe[Ce])-Math.sqrt(Oe[Ce]);ae[Ce]=Math.round(255-255*(He/this.radius+this.cutoff))}return _e}};class Te{constructor(){this.specification=a.v.light.position}possiblyEvaluate(t,u){return a.x(t.expression.evaluate(u))}interpolate(t,u,p){return{x:a.y.number(t.x,u.x,p),y:a.y.number(t.y,u.y,p),z:a.y.number(t.z,u.z,p)}}}let Ae;class ct extends a.E{constructor(t){super(),Ae=Ae||new a.q({anchor:new a.D(a.v.light.anchor),position:new Te,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ae),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,u={}){if(!this._validate(a.r,t,u))for(const p in t){const m=t[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,u,p){return(!p||p.validate!==!1)&&a.t(this,t.call(a.u,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const We=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class pt extends a.E{constructor(t){super(),this._transitionable=new a.T(We),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(t,u={}){if(!this._validate(a.B,t,u)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in t){const m=t[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,u,p={}){return(p==null?void 0:p.validate)!==!1&&a.t(this,t.call(a.u,a.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class kt{constructor(t,u){this.width=t,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,u){const p=t.join(",")+String(u);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(t,u)),this.dashEntry[p]}getDashRanges(t,u,p){const m=[];let b=t.length%2==1?-t[t.length-1]*p:0,A=t[0]*p,L=!0;m.push({left:b,right:A,isDash:L,zeroLength:t[0]===0});let D=t[0];for(let Z=1;Z<t.length;Z++){L=!L;const K=t[Z];b=D*p,D+=K,A=D*p,m.push({left:b,right:A,isDash:L,zeroLength:K===0})}return m}addRoundDash(t,u,p){const m=u/2;for(let b=-p;b<=p;b++){const A=this.width*(this.nextRow+p+b);let L=0,D=t[L];for(let Z=0;Z<this.width;Z++){Z/D.right>1&&(D=t[++L]);const K=Math.abs(Z-D.left),J=Math.abs(Z-D.right),ae=Math.min(K,J);let _e;const ke=b/p*(m+1);if(D.isDash){const Ie=m-Math.abs(ke);_e=Math.sqrt(ae*ae+Ie*Ie)}else _e=m-Math.sqrt(ae*ae+ke*ke);this.data[A+Z]=Math.max(0,Math.min(255,_e+128))}}}addRegularDash(t){for(let L=t.length-1;L>=0;--L){const D=t[L],Z=t[L+1];D.zeroLength?t.splice(L,1):Z&&Z.isDash===D.isDash&&(Z.left=D.left,t.splice(L,1))}const u=t[0],p=t[t.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const m=this.width*this.nextRow;let b=0,A=t[b];for(let L=0;L<this.width;L++){L/A.right>1&&(A=t[++b]);const D=Math.abs(L-A.left),Z=Math.abs(L-A.right),K=Math.min(D,Z);this.data[m+L]=Math.max(0,Math.min(255,(A.isDash?K:-K)+128))}}addDash(t,u){const p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let L=0;L<t.length;L++)b+=t[L];if(b!==0){const L=this.width/b,D=this.getDashRanges(t,this.width,L);u?this.addRoundDash(D,L,p):this.addRegularDash(D)}const A={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,A}bind(t){const u=t.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const Je="maplibre_preloaded_worker_pool";class wt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Je]}numActive(){return Object.keys(this.active).length}}const Tt=Math.floor(y.hardwareConcurrency/2);let Ht,li;function Mi(){return Ht||(Ht=new wt),Ht}wt.workerCount=a.C(globalThis)?Math.max(Math.min(Tt,3),1):1;class Pi{constructor(t,u){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u;const p=this.workerPool.acquire(u);for(let m=0;m<p.length;m++){const b=new a.F(p[m],u);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,u){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:t,data:u}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,u){for(const p of this.actors)p.registerMessageHandler(t,u)}}function Ti(){return li||(li=new Pi(Mi(),a.G),li.registerMessageHandler("GR",(v,t,u)=>a.m(t,u))),li}function At(v,t){const u=a.H();return a.J(u,u,[1,1,0]),a.K(u,u,[.5*v.width,.5*v.height,1]),a.L(u,u,v.calculatePosMatrix(t.toUnwrapped()))}function Xe(v,t,u,p,m,b){const A=function(J,ae,_e){if(J)for(const ke of J){const Ie=ae[ke];if(Ie&&Ie.source===_e&&Ie.type==="fill-extrusion")return!0}else for(const ke in ae){const Ie=ae[ke];if(Ie.source===_e&&Ie.type==="fill-extrusion")return!0}return!1}(m&&m.layers,t,v.id),L=b.maxPitchScaleFactor(),D=v.tilesIn(p,L,A);D.sort(Pt);const Z=[];for(const J of D)Z.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(t,u,v._state,J.queryGeometry,J.cameraQueryGeometry,J.scale,m,b,L,At(v.transform,J.tileID))});const K=function(J){const ae={},_e={};for(const ke of J){const Ie=ke.queryResults,Oe=ke.wrappedTileID,Fe=_e[Oe]=_e[Oe]||{};for(const je in Ie){const Ce=Ie[je],He=Fe[je]=Fe[je]||{},Ye=ae[je]=ae[je]||[];for(const nt of Ce)He[nt.featureIndex]||(He[nt.featureIndex]=!0,Ye.push(nt))}}return ae}(Z);for(const J in K)K[J].forEach(ae=>{const _e=ae.feature,ke=v.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ke});return K}function Pt(v,t){const u=v.tileID,p=t.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}function ni(v,t,u){return a._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield a.h(t.transformRequest(v.url,"Source"),u)).data:yield y.frameAsync(u),!p)return null;const m=a.M(a.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class $e{constructor(t,u){t&&(u?this.setSouthWest(t).setNorthEast(u):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof a.N?new a.N(t.lng,t.lat):a.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof a.N?new a.N(t.lng,t.lat):a.N.convert(t),this}extend(t){const u=this._sw,p=this._ne;let m,b;if(t instanceof a.N)m=t,b=t;else{if(!(t instanceof $e))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend($e.convert(t)):this.extend(a.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(a.N.convert(t)):this;if(m=t._sw,b=t._ne,!m||!b)return this}return u||p?(u.lng=Math.min(m.lng,u.lng),u.lat=Math.min(m.lat,u.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new a.N(m.lng,m.lat),this._ne=new a.N(b.lng,b.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:u,lat:p}=a.N.convert(t);let m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(t){return t instanceof $e?t:t&&new $e(t)}static fromLngLat(t,u=0){const p=360*u/40075017,m=p/Math.cos(Math.PI/180*t.lat);return new $e(new a.N(t.lng-m,t.lat-p),new a.N(t.lng+m,t.lat+p))}adjustAntiMeridian(){const t=new a.N(this._sw.lng,this._sw.lat),u=new a.N(this._ne.lng,this._ne.lat);return new $e(t,t.lng>u.lng?new a.N(u.lng+360,u.lat):u)}}class yi{constructor(t,u,p){this.bounds=$e.convert(this.validateBounds(t)),this.minzoom=u||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const u=Math.pow(2,t.z),p=Math.floor(a.O(this.bounds.getWest())*u),m=Math.floor(a.Q(this.bounds.getNorth())*u),b=Math.ceil(a.O(this.bounds.getEast())*u),A=Math.ceil(a.Q(this.bounds.getSouth())*u);return t.x>=p&&t.x<b&&t.y>=m&&t.y<A}}class yt extends a.E{constructor(t,u,p,m){if(super(),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(u,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ni(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(a.e(this,t),t.bounds&&(this.tileBounds=new yi(t.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new a.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(t){return a._(this,void 0,void 0,function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(u,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((b,A)=>{t.reloadPromise={resolve:b,reject:A}})}else t.actor=this.dispatcher.getActor(),m="LT";t.abortController=new AbortController;try{const b=yield t.actor.sendAsync({type:m,data:p},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,b)}catch(b){if(delete t.abortController,t.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,u){if(u&&u.resourceTiming&&(t.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&t.setExpiryData(u),t.loadVectorData(u,this.map.painter),t.reloadPromise){const p=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(p.resolve).catch(p.reject)}}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class it extends a.E{constructor(t,u,p,m){super(),this.id=t,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},u),a.e(this,a.M(u,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ni(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(a.e(this,t),t.bounds&&(this.tileBounds=new yi(t.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new a.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return a.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return a._(this,void 0,void 0,function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const p=yield V.getImage(this.map._requestManager.transformRequest(u,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,A=p.data;t.texture=this.map.painter.getTileTexture(A.width),t.texture?t.texture.update(A,{useMipmap:!0}):(t.texture=new O(m,A,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}})}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class fe extends it{constructor(t,u,p,m){super(t,u,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(t){return a._(this,void 0,void 0,function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(u,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const m=yield V.getImage(p,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&t.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const A=a.b(b)&&a.U()?b:yield this.readImageNow(b),L={type:this.type,uid:t.uid,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const D=yield t.actor.sendAsync({type:"LDT",data:L});t.dem=D,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(m){if(delete t.abortController,t.aborted)t.state="unloaded";else if(m)throw t.state="errored",m}})}readImageNow(t){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const u=t.width+2,p=t.height+2;try{return new a.R({width:u,height:p},yield a.W(t,-1,-1,u,p))}catch{}}return y.getImageData(t,1)})}_getNeighboringTiles(t){const u=t.canonical,p=Math.pow(2,u.z),m=(u.x-1+p)%p,b=u.x===0?t.wrap-1:t.wrap,A=(u.x+1+p)%p,L=u.x+1===p?t.wrap+1:t.wrap,D={};return D[new a.S(t.overscaledZ,b,u.z,m,u.y).key]={backfilled:!1},D[new a.S(t.overscaledZ,L,u.z,A,u.y).key]={backfilled:!1},u.y>0&&(D[new a.S(t.overscaledZ,b,u.z,m,u.y-1).key]={backfilled:!1},D[new a.S(t.overscaledZ,t.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},D[new a.S(t.overscaledZ,L,u.z,A,u.y-1).key]={backfilled:!1}),u.y+1<p&&(D[new a.S(t.overscaledZ,b,u.z,m,u.y+1).key]={backfilled:!1},D[new a.S(t.overscaledZ,t.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},D[new a.S(t.overscaledZ,L,u.z,A,u.y+1).key]={backfilled:!1}),D}unloadTile(t){return a._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class X extends a.E{constructor(t,u,p,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=u.data,this._options=a.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const b=a.X/this.tileSize;u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*b,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*b,extent:a.X,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:a.X,radius:(u.clusterRadius||50)*b,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return a._(this,void 0,void 0,function*(){const t=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,u,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:u,offset:p}})}_updateWorkerData(t){return a._(this,void 0,void 0,function*(){const u=a.e({type:this.type},this.workerOptions);t?u.dataDiff=t:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(y.resolveURL(this._data),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:u});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(b,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(t){return a._(this,void 0,void 0,function*(){const u=t.actor?"RT":"LT";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const m=yield this.actor.sendAsync({type:u,data:p},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(m,this.map.painter,u==="RT")})}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Q=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Me extends a.E{constructor(t,u,p,m){super(),this.id=t,this.dispatcher=p,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=u}load(t){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield V.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,t&&(this.coordinates=t),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new a.j(u))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const u=t.map(a.Z.fromLngLat);this.tileID=function(m){let b=1/0,A=1/0,L=-1/0,D=-1/0;for(const ae of m)b=Math.min(b,ae.x),A=Math.min(A,ae.y),L=Math.max(L,ae.x),D=Math.max(D,ae.y);const Z=Math.max(L-b,D-A),K=Math.max(0,Math.floor(-Math.log(Z)/Math.LN2)),J=Math.pow(2,K);return new a.a1(K,Math.floor((b+L)/2*J),Math.floor((A+D)/2*J))}(u),this.minzoom=this.maxzoom=this.tileID.z;const p=u.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.X,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.X),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,u=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new O(t,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ze extends Me{constructor(t,u,p,m){super(t,u,p,m),this.roundZoom=!0,this.type="video",this.options=u}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const u of t.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield a.a3(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new a.j(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const u=this.video.seekable;t<u.start(0)||t>u.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,u=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new O(t,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class dt extends Me{constructor(t,u,p,m){super(t,u,p,m),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(A=>typeof A!="number"))||this.fire(new a.j(new a.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${t}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,p=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new O(u,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const st={},Ci=v=>{switch(v){case"geojson":return X;case"image":return Me;case"raster":return it;case"raster-dem":return fe;case"vector":return yt;case"video":return Ze;case"canvas":return dt}return st[v]},ft="RTLPluginLoaded";class Wt extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ti()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return a._(this,arguments,void 0,function*(u,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ft))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ei=null;function Bi(){return Ei||(Ei=new Wt),Ei}class Cn{constructor(t,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=a.a4(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const u=t+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,b){const A={};if(!b)return A;for(const L of m){const D=L.layerIds.map(Z=>b.getLayer(Z)).filter(Boolean);if(D.length!==0){L.layers=D,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(Z=>D.filter(K=>K.id===Z)[0]));for(const Z of D)A[Z.id]=L}}return A}(t.buckets,u.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a6){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a6&&b.hasRTLText){this.hasRTLText=!0,Bi().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(t)}const u=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new O(t,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new O(t,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,u,p,m,b,A,L,D,Z,K){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:A,tileSize:this.tileSize,pixelPosMatrix:K,transform:D,params:L,queryPadding:this.queryPadding*Z},t,u,p):{}}querySourceFeatures(t,u){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=u&&u.sourceLayer?u.sourceLayer:"",A=m._geojsonTileLayer||m[b];if(!A)return;const L=a.a7(u&&u.filter),{z:D,x:Z,y:K}=this.tileID.canonical,J={z:D,x:Z,y:K};for(let ae=0;ae<A.length;ae++){const _e=A.feature(ae);if(L.needGeometry){const Oe=a.a8(_e,!0);if(!L.filter(new a.z(this.tileID.overscaledZ),Oe,this.tileID.canonical))continue}else if(!L.filter(new a.z(this.tileID.overscaledZ),_e))continue;const ke=p.getId(_e,b),Ie=new a.a9(_e,D,Z,K,ke);Ie.tile=J,t.push(Ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const u=this.expirationTime;if(t.cacheControl){const p=a.aa(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{const b=this.expirationTime-u;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!u.style.hasLayer(m))continue;const b=this.buckets[m],A=b.layers[0].sourceLayer||"_geojsonTileLayer",L=p[A],D=t[A];if(!L||!D||Object.keys(D).length===0)continue;b.update(D,L,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Z=u&&u.style&&u.style.getLayer(m);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=y.now()+t}setDependencies(t,u){const p={};for(const m of u)p[m]=!0;this.dependencies[t]=p}hasDependency(t,u){for(const p of t){const m=this.dependencies[p];if(m){for(const b of u)if(m[b])return!0}}return!1}}class St{constructor(t,u){this.max=t,this.onRemove=u,this.reset()}reset(){for(const t in this.data)for(const u of this.data[t])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(t,u,p){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:u,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const u=this.data[t].shift();return u.timeout&&clearTimeout(u.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),u.value}getByKey(t){const u=this.data[t];return u?u[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,u){if(!this.has(t))return this;const p=t.wrapped().key,m=u===void 0?0:this.data[p].indexOf(u),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(t){const u=[];for(const p in this.data)for(const m of this.data[p])t(m.value)||u.push(m);for(const p of u)this.remove(p.value.tileID,p)}}class ui{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,u,p){const m=String(u);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},a.e(this.stateChanges[t][m],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==m&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const b in this.state[t][m])p[b]||(this.deletedStates[t][m][b]=null)}else for(const b in p)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][b]===null&&delete this.deletedStates[t][m][b]}removeFeatureState(t,u,p){if(this.deletedStates[t]===null)return;const m=String(u);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&u!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][p]=null);else if(u!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(p in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][p]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,u){const p=String(u),m=a.e({},(this.state[t]||{})[p],(this.stateChanges[t]||{})[p]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][u];if(b===null)return{};for(const A in b)delete m[A]}return m}initializeTileState(t,u){t.setFeatureState(this.state,u)}coalesceChanges(t,u){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const A in this.stateChanges[m])this.state[m][A]||(this.state[m][A]={}),a.e(this.state[m][A],this.stateChanges[m][A]),b[A]=this.state[m][A];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const A in this.state[m])b[A]={},this.state[m][A]={};else for(const A in this.deletedStates[m]){if(this.deletedStates[m][A]===null)this.state[m][A]={};else for(const L of Object.keys(this.deletedStates[m][A]))delete this.state[m][A][L];b[A]=this.state[m][A]}p[m]=p[m]||{},a.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in t)t[m].setFeatureState(p,u)}}class ii extends a.E{constructor(t,u,p){super(),this.id=t,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,A,L)=>{const D=new(Ci(b.type))(m,b,A,L);if(D.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${D.id}`);return D})(t,u,p,this),this._tiles={},this._cache=new St(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ui,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const u=this._tiles[t];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,u,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,u,p)}catch(m){t.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new a.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const p=this._tiles[u];p.upload(t),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(sn).map(t=>t.key)}getRenderableIds(t){const u=[];for(const p in this._tiles)this._isIdRenderable(p,t)&&u.push(this._tiles[p]);return t?u.sort((p,m)=>{const b=p.tileID,A=m.tileID,L=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),D=new a.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-A.overscaledZ||D.y-L.y||D.x-L.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(sn).map(p=>p.key)}hasRenderableParent(t){const u=this.findLoadedParent(t,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(t,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(u||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,u){return a._(this,void 0,void 0,function*(){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=u),yield this._loadTile(p,t,u))})}_tileLoaded(t,u,p){t.timeAdded=y.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(u,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const u=this.getRenderableIds();for(let m=0;m<u.length;m++){const b=u[m];if(t.neighboringTiles&&t.neighboringTiles[b]){const A=this.getTileByID(b);p(t,A),p(A,t)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let A=b.tileID.canonical.x-m.tileID.canonical.x;const L=b.tileID.canonical.y-m.tileID.canonical.y,D=Math.pow(2,m.tileID.canonical.z),Z=b.tileID.key;A===0&&L===0||Math.abs(L)>1||(Math.abs(A)>1&&(Math.abs(A+D)===1?A+=D:Math.abs(A-D)===1&&(A-=D)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,A,L),m.neighboringTiles&&m.neighboringTiles[Z]&&(m.neighboringTiles[Z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,u,p,m){for(const b in this._tiles){let A=this._tiles[b];if(m[b]||!A.hasData()||A.tileID.overscaledZ<=u||A.tileID.overscaledZ>p)continue;let L=A.tileID;for(;A&&A.tileID.overscaledZ>u+1;){const Z=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[Z.key],A&&A.hasData()&&(L=Z)}let D=L;for(;D.overscaledZ>u;)if(D=D.scaledTo(D.overscaledZ-1),t[D.key]){m[L.key]=L;break}}}findLoadedParent(t,u){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=u?p:null}for(let p=t.overscaledZ-1;p>=u;p--){const m=t.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const u=this._tiles[t.key];return u&&u.hasData()?u:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const u=Math.ceil(t.width/this._source.tileSize)+1,p=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(u*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(t){const u=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,u){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(t,u,p,m,b,A){const L={},D={},Z=Object.keys(t),K=y.now();for(const J of Z){const ae=t[J],_e=this._tiles[J];if(!_e||_e.fadeEndTime!==0&&_e.fadeEndTime<=K)continue;const ke=this.findLoadedParent(ae,u),Ie=this.findLoadedSibling(ae),Oe=ke||Ie||null;Oe&&(this._addTile(Oe.tileID),L[Oe.tileID.key]=Oe.tileID),D[J]=ae}this._retainLoadedChildren(D,m,p,t);for(const J in L)t[J]||(this._coveredTiles[J]=!0,t[J]=L[J]);if(A){const J={},ae={};for(const _e of b)this._tiles[_e.key].hasData()?J[_e.key]=_e:ae[_e.key]=_e;for(const _e in ae){const ke=ae[_e].children(this._source.maxzoom);this._tiles[ke[0].key]&&this._tiles[ke[1].key]&&this._tiles[ke[2].key]&&this._tiles[ke[3].key]&&(J[ke[0].key]=t[ke[0].key]=ke[0],J[ke[1].key]=t[ke[1].key]=ke[1],J[ke[2].key]=t[ke[2].key]=ke[2],J[ke[3].key]=t[ke[3].key]=ke[3],delete ae[_e])}for(const _e in ae){const ke=ae[_e],Ie=this.findLoadedParent(ke,this._source.minzoom),Oe=this.findLoadedSibling(ke),Fe=Ie||Oe||null;if(Fe){J[Fe.tileID.key]=t[Fe.tileID.key]=Fe.tileID;for(const je in J)J[je].isChildOf(Fe.tileID)&&delete J[je]}}for(const _e in this._tiles)J[_e]||(this._coveredTiles[_e]=!0)}}update(t,u){if(!this._sourceLoaded||this._paused)return;let p;this.transform=t,this.terrain=u,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new a.S(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y)):(p=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(p=p.filter(K=>this._source.hasTile(K)))):p=[];const m=t.coveringZoomLevel(this._source),b=Math.max(m-ii.maxOverzooming,this._source.minzoom),A=Math.max(m+ii.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const K={};for(const J of p)if(J.canonical.z>this._source.minzoom){const ae=J.scaledTo(J.canonical.z-1);K[ae.key]=ae;const _e=J.scaledTo(Math.max(this._source.minzoom,Math.min(J.canonical.z,5)));K[_e.key]=_e}p=p.concat(Object.values(K))}const L=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,L&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const D=this._updateRetainedTiles(p,m);_r(this._source.type)&&this._updateCoveredAndRetainedTiles(D,b,A,m,p,u);for(const K in D)this._tiles[K].clearFadeHold();const Z=a.ab(this._tiles,D);for(const K of Z){const J=this._tiles[K];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(K)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,u){var p;const m={},b={},A=Math.max(u-ii.maxOverzooming,this._source.minzoom),L=Math.max(u+ii.maxUnderzooming,this._source.minzoom),D={};for(const Z of t){const K=this._addTile(Z);m[Z.key]=Z,K.hasData()||u<this._source.maxzoom&&(D[Z.key]=Z)}this._retainLoadedChildren(D,u,L,m);for(const Z of t){let K=this._tiles[Z.key];if(K.hasData())continue;if(u+1>this._source.maxzoom){const ae=Z.children(this._source.maxzoom)[0],_e=this.getTile(ae);if(_e&&_e.hasData()){m[ae.key]=ae;continue}}else{const ae=Z.children(this._source.maxzoom);if(m[ae[0].key]&&m[ae[1].key]&&m[ae[2].key]&&m[ae[3].key])continue}let J=K.wasRequested();for(let ae=Z.overscaledZ-1;ae>=A;--ae){const _e=Z.scaledTo(ae);if(b[_e.key])break;if(b[_e.key]=!0,K=this.getTile(_e),!K&&J&&(K=this._addTile(_e)),K){const ke=K.hasData();if((ke||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||J)&&(m[_e.key]=_e),J=K.wasRequested(),ke)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const u=[];let p,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}u.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of u)this._loadedParentTiles[b]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const u=this._tiles[t].tileID,p=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=p}}_addTile(t){let u=this._tiles[t.key];if(u)return u;u=this._cache.getAndRemove(t),u&&(this._setTileReloadTimer(t.key,u),u.tileID=t,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,u)));const p=u;return u||(u=new Cn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(u,t.key,u.state)),u.uses++,this._tiles[t.key]=u,p||this._source.fire(new a.k("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(t,u){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=u.getExpiryTimeout();p&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},p))}_removeTile(t){const u=this._tiles[t];u&&(u.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(t){const u=t.sourceDataType;t.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&u==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,u,p){const m=[],b=this.transform;if(!b)return m;const A=p?b.getCameraQueryGeometry(t):t,L=t.map(ke=>b.pointCoordinate(ke,this.terrain)),D=A.map(ke=>b.pointCoordinate(ke,this.terrain)),Z=this.getIds();let K=1/0,J=1/0,ae=-1/0,_e=-1/0;for(const ke of D)K=Math.min(K,ke.x),J=Math.min(J,ke.y),ae=Math.max(ae,ke.x),_e=Math.max(_e,ke.y);for(let ke=0;ke<Z.length;ke++){const Ie=this._tiles[Z[ke]];if(Ie.holdingForFade())continue;const Oe=Ie.tileID,Fe=Math.pow(2,b.zoom-Ie.tileID.overscaledZ),je=u*Ie.queryPadding*a.X/Ie.tileSize/Fe,Ce=[Oe.getTilePoint(new a.Z(K,J)),Oe.getTilePoint(new a.Z(ae,_e))];if(Ce[0].x-je<a.X&&Ce[0].y-je<a.X&&Ce[1].x+je>=0&&Ce[1].y+je>=0){const He=L.map(nt=>Oe.getTilePoint(nt)),Ye=D.map(nt=>Oe.getTilePoint(nt));m.push({tile:Ie,tileID:Oe,queryGeometry:He,cameraQueryGeometry:Ye,scale:Fe})}}return m}getVisibleCoordinates(t){const u=this.getRenderableIds(t).map(p=>this._tiles[p].tileID);for(const p of u)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(_r(this._source.type)){const t=y.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=t)return!0}return!1}setFeatureState(t,u,p){this._state.updateState(t=t||"_geojsonTileLayer",u,p)}removeFeatureState(t,u,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",u,p)}getFeatureState(t,u){return this._state.getState(t=t||"_geojsonTileLayer",u)}setDependencies(t,u,p){const m=this._tiles[t];m&&m.setDependencies(u,p)}reloadTilesForDependencies(t,u){for(const p in this._tiles)this._tiles[p].hasDependency(t,u)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(t,u))}}function sn(v,t){const u=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return v.overscaledZ-t.overscaledZ||p-u||t.canonical.y-v.canonical.y||t.canonical.x-v.canonical.x}function _r(v){return v==="raster"||v==="image"||v==="video"}ii.maxOverzooming=10,ii.maxUnderzooming=3;class ci{constructor(t,u){this.reset(t,u)}reset(t,u){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ac(t,0,1);let u=1,p=this._distances[u];const m=t*this.paddedLength+this.padding;for(;p<m&&u<this._distances.length;)p=this._distances[++u];const b=u-1,A=this._distances[b],L=p-A,D=L>0?(m-A)/L:0;return this.points[b].mult(1-D).add(this.points[u].mult(D))}}function yr(v,t){let u=!0;return v==="always"||v!=="never"&&t!=="never"||(u=!1),u}class br{constructor(t,u,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(u/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=u,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,u,p,m,b){this._forEachCell(u,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(t,u,p,m){this._forEachCell(u-m,p-m,u+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(u),this.circles.push(p),this.circles.push(m)}_insertBoxCell(t,u,p,m,b,A){this.boxCells[b].push(A)}_insertCircleCell(t,u,p,m,b,A){this.circleCells[b].push(A)}_query(t,u,p,m,b,A,L){if(p<0||t>this.width||m<0||u>this.height)return[];const D=[];if(t<=0&&u<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:t,y1:u,x2:p,y2:m}];for(let Z=0;Z<this.boxKeys.length;Z++)D.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const K=this.circles[3*Z],J=this.circles[3*Z+1],ae=this.circles[3*Z+2];D.push({key:this.circleKeys[Z],x1:K-ae,y1:J-ae,x2:K+ae,y2:J+ae})}}else this._forEachCell(t,u,p,m,this._queryCell,D,{hitTest:b,overlapMode:A,seenUids:{box:{},circle:{}}},L);return D}query(t,u,p,m){return this._query(t,u,p,m,!1,null)}hitTest(t,u,p,m,b,A){return this._query(t,u,p,m,!0,b,A).length>0}hitTestCircle(t,u,p,m,b){const A=t-p,L=t+p,D=u-p,Z=u+p;if(L<0||A>this.width||Z<0||D>this.height)return!1;const K=[];return this._forEachCell(A,D,L,Z,this._queryCellCircle,K,{hitTest:!0,overlapMode:m,circle:{x:t,y:u,radius:p},seenUids:{box:{},circle:{}}},b),K.length>0}_queryCell(t,u,p,m,b,A,L,D){const{seenUids:Z,hitTest:K,overlapMode:J}=L,ae=this.boxCells[b];if(ae!==null){const ke=this.bboxes;for(const Ie of ae)if(!Z.box[Ie]){Z.box[Ie]=!0;const Oe=4*Ie,Fe=this.boxKeys[Ie];if(t<=ke[Oe+2]&&u<=ke[Oe+3]&&p>=ke[Oe+0]&&m>=ke[Oe+1]&&(!D||D(Fe))&&(!K||!yr(J,Fe.overlapMode))&&(A.push({key:Fe,x1:ke[Oe],y1:ke[Oe+1],x2:ke[Oe+2],y2:ke[Oe+3]}),K))return!0}}const _e=this.circleCells[b];if(_e!==null){const ke=this.circles;for(const Ie of _e)if(!Z.circle[Ie]){Z.circle[Ie]=!0;const Oe=3*Ie,Fe=this.circleKeys[Ie];if(this._circleAndRectCollide(ke[Oe],ke[Oe+1],ke[Oe+2],t,u,p,m)&&(!D||D(Fe))&&(!K||!yr(J,Fe.overlapMode))){const je=ke[Oe],Ce=ke[Oe+1],He=ke[Oe+2];if(A.push({key:Fe,x1:je-He,y1:Ce-He,x2:je+He,y2:Ce+He}),K)return!0}}}return!1}_queryCellCircle(t,u,p,m,b,A,L,D){const{circle:Z,seenUids:K,overlapMode:J}=L,ae=this.boxCells[b];if(ae!==null){const ke=this.bboxes;for(const Ie of ae)if(!K.box[Ie]){K.box[Ie]=!0;const Oe=4*Ie,Fe=this.boxKeys[Ie];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,ke[Oe+0],ke[Oe+1],ke[Oe+2],ke[Oe+3])&&(!D||D(Fe))&&!yr(J,Fe.overlapMode))return A.push(!0),!0}}const _e=this.circleCells[b];if(_e!==null){const ke=this.circles;for(const Ie of _e)if(!K.circle[Ie]){K.circle[Ie]=!0;const Oe=3*Ie,Fe=this.circleKeys[Ie];if(this._circlesCollide(ke[Oe],ke[Oe+1],ke[Oe+2],Z.x,Z.y,Z.radius)&&(!D||D(Fe))&&!yr(J,Fe.overlapMode))return A.push(!0),!0}}}_forEachCell(t,u,p,m,b,A,L,D){const Z=this._convertToXCellCoord(t),K=this._convertToYCellCoord(u),J=this._convertToXCellCoord(p),ae=this._convertToYCellCoord(m);for(let _e=Z;_e<=J;_e++)for(let ke=K;ke<=ae;ke++)if(b.call(this,t,u,p,m,this.xCellCount*ke+_e,A,L,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,u,p,m,b,A){const L=m-t,D=b-u,Z=p+A;return Z*Z>L*L+D*D}_circleAndRectCollide(t,u,p,m,b,A,L){const D=(A-m)/2,Z=Math.abs(t-(m+D));if(Z>D+p)return!1;const K=(L-b)/2,J=Math.abs(u-(b+K));if(J>K+p)return!1;if(Z<=D||J<=K)return!0;const ae=Z-D,_e=J-K;return ae*ae+_e*_e<=p*p}}function Ar(v,t,u,p,m){const b=a.H();return t?(a.K(b,b,[1/m,1/m,1]),u||a.ad(b,b,p.angle)):a.L(b,p.labelPlaneMatrix,v),b}function Mr(v,t,u,p,m){if(t){const b=a.ae(v);return a.K(b,b,[m,m,1]),u||a.ad(b,b,-p.angle),b}return p.glCoordMatrix}function Le(v,t,u,p){let m;p?(m=[v,t,p(v,t),1],a.af(m,m,u)):(m=[v,t,0,1],ji(m,m,u));const b=m[3];return{point:new a.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function ie(v,t){return .5+v/t*.5}function ne(v,t){return v.x>=-t[0]&&v.x<=t[0]&&v.y>=-t[1]&&v.y<=t[1]}function me(v,t,u,p,m,b,A,L,D,Z,K,J,ae,_e,ke){const Ie=p?v.textSizeData:v.iconSizeData,Oe=a.ag(Ie,u.transform.zoom),Fe=[256/u.width*2+1,256/u.height*2+1],je=p?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;je.clear();const Ce=v.lineVertexArray,He=p?v.text.placedSymbolArray:v.icon.placedSymbolArray,Ye=u.transform.width/u.transform.height;let nt=!1;for(let vt=0;vt<He.length;vt++){const Ct=He.get(vt);if(Ct.hidden||Ct.writingMode===a.ah.vertical&&!nt){ri(Ct.numGlyphs,je);continue}nt=!1;const Ft=Le(Ct.anchorX,Ct.anchorY,t,ke);if(!ne(Ft.point,Fe)){ri(Ct.numGlyphs,je);continue}const Vt=ie(u.transform.cameraToCenterDistance,Ft.signedDistanceFromCamera),Lt=a.ai(Ie,Oe,Ct),Mt=A?Lt/Vt:Lt*Vt,Jt={getElevation:ke,labelPlaneMatrix:m,lineVertexArray:Ce,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:Z,tileAnchorPoint:new a.P(Ct.anchorX,Ct.anchorY),unwrappedTileID:K,width:J,height:ae,translation:_e},xi=Ge(Jt,Ct,Mt,!1,L,t,b,v.glyphOffsetArray,je,Ye,D);nt=xi.useVertical,(xi.notEnoughRoom||nt||xi.needsFlipping&&Ge(Jt,Ct,Mt,!0,L,t,b,v.glyphOffsetArray,je,Ye,D).notEnoughRoom)&&ri(Ct.numGlyphs,je)}p?v.text.dynamicLayoutVertexBuffer.updateData(je):v.icon.dynamicLayoutVertexBuffer.updateData(je)}function Se(v,t,u,p,m,b,A,L){const D=b.glyphStartIndex+b.numGlyphs,Z=b.lineStartIndex,K=b.lineStartIndex+b.lineLength,J=t.getoffsetX(b.glyphStartIndex),ae=t.getoffsetX(D-1),_e=Et(v*J,u,p,m,b.segment,Z,K,L,A);if(!_e)return null;const ke=Et(v*ae,u,p,m,b.segment,Z,K,L,A);return ke?L.projectionCache.anyProjectionOccluded?null:{first:_e,last:ke}:null}function Ve(v,t,u,p){return v===a.ah.horizontal&&Math.abs(u.y-t.y)>Math.abs(u.x-t.x)*p?{useVertical:!0}:(v===a.ah.vertical?t.y<u.y:t.x>u.x)?{needsFlipping:!0}:null}function Ge(v,t,u,p,m,b,A,L,D,Z,K){const J=u/24,ae=t.lineOffsetX*J,_e=t.lineOffsetY*J;let ke;if(t.numGlyphs>1){const Ie=t.glyphStartIndex+t.numGlyphs,Oe=t.lineStartIndex,Fe=t.lineStartIndex+t.lineLength,je=Se(J,L,ae,_e,p,t,K,v);if(!je)return{notEnoughRoom:!0};const Ce=Le(je.first.point.x,je.first.point.y,A,v.getElevation).point,He=Le(je.last.point.x,je.last.point.y,A,v.getElevation).point;if(m&&!p){const Ye=Ve(t.writingMode,Ce,He,Z);if(Ye)return Ye}ke=[je.first];for(let Ye=t.glyphStartIndex+1;Ye<Ie-1;Ye++)ke.push(Et(J*L.getoffsetX(Ye),ae,_e,p,t.segment,Oe,Fe,v,K));ke.push(je.last)}else{if(m&&!p){const Oe=Le(v.tileAnchorPoint.x,v.tileAnchorPoint.y,b,v.getElevation).point,Fe=t.lineStartIndex+t.segment+1,je=new a.P(v.lineVertexArray.getx(Fe),v.lineVertexArray.gety(Fe)),Ce=Le(je.x,je.y,b,v.getElevation),He=Ce.signedDistanceFromCamera>0?Ce.point:function(nt,vt,Ct,Ft,Vt,Lt){return et(nt,vt,Ct,1,Vt,Lt)}(v.tileAnchorPoint,je,Oe,0,b,v),Ye=Ve(t.writingMode,Oe,He,Z);if(Ye)return Ye}const Ie=Et(J*L.getoffsetX(t.glyphStartIndex),ae,_e,p,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,v,K);if(!Ie||v.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ke=[Ie]}for(const Ie of ke)a.aj(D,Ie.point,Ie.angle);return{}}function et(v,t,u,p,m,b){const A=v.add(v.sub(t)._unit()),L=m!==void 0?Le(A.x,A.y,m,b.getElevation).point:ut(A.x,A.y,b).point,D=u.sub(L);return u.add(D._mult(p/D.mag()))}function Be(v,t,u){const p=t.projectionCache;if(p.projections[v])return p.projections[v];const m=new a.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),b=ut(m.x,m.y,t);if(b.signedDistanceFromCamera>0)return p.projections[v]=b.point,p.anyProjectionOccluded=p.anyProjectionOccluded||b.isOccluded,b.point;const A=v-u.direction;return function(L,D,Z,K,J){return et(L,D,Z,K,void 0,J)}(u.distanceFromAnchor===0?t.tileAnchorPoint:new a.P(t.lineVertexArray.getx(A),t.lineVertexArray.gety(A)),m,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,t)}function ut(v,t,u){const p=v+u.translation[0],m=t+u.translation[1];let b;return!u.pitchWithMap&&u.projection.useSpecialProjectionForSymbols?(b=u.projection.projectTileCoordinates(p,m,u.unwrappedTileID,u.getElevation),b.point.x=(.5*b.point.x+.5)*u.width,b.point.y=(.5*-b.point.y+.5)*u.height):(b=Le(p,m,u.labelPlaneMatrix,u.getElevation),b.isOccluded=!1),b}function bt(v,t,u){return v._unit()._perp()._mult(t*u)}function rt(v,t,u,p,m,b,A,L,D){if(L.projectionCache.offsets[v])return L.projectionCache.offsets[v];const Z=u.add(t);if(v+D.direction<p||v+D.direction>=m)return L.projectionCache.offsets[v]=Z,Z;const K=Be(v+D.direction,L,D),J=bt(K.sub(u),A,D.direction),ae=u.add(J),_e=K.add(J);return L.projectionCache.offsets[v]=a.ak(b,Z,ae,_e)||Z,L.projectionCache.offsets[v]}function Et(v,t,u,p,m,b,A,L,D){const Z=p?v-t:v+t;let K=Z>0?1:-1,J=0;p&&(K*=-1,J=Math.PI),K<0&&(J+=Math.PI);let ae,_e=K>0?b+m:b+m+1;L.projectionCache.cachedAnchorPoint?ae=L.projectionCache.cachedAnchorPoint:(ae=ut(L.tileAnchorPoint.x,L.tileAnchorPoint.y,L).point,L.projectionCache.cachedAnchorPoint=ae);let ke,Ie,Oe=ae,Fe=ae,je=0,Ce=0;const He=Math.abs(Z),Ye=[];let nt;for(;je+Ce<=He;){if(_e+=K,_e<b||_e>=A)return null;je+=Ce,Fe=Oe,Ie=ke;const Ft={absOffsetX:He,direction:K,distanceFromAnchor:je,previousVertex:Fe};if(Oe=Be(_e,L,Ft),u===0)Ye.push(Fe),nt=Oe.sub(Fe);else{let Vt;const Lt=Oe.sub(Fe);Vt=Lt.mag()===0?bt(Be(_e+K,L,Ft).sub(Oe),u,K):bt(Lt,u,K),Ie||(Ie=Fe.add(Vt)),ke=rt(_e,Vt,Oe,b,A,Ie,u,L,Ft),Ye.push(Ie),nt=ke.sub(Ie)}Ce=nt.mag()}const vt=nt._mult((He-je)/Ce)._add(Ie||Fe),Ct=J+Math.atan2(Oe.y-Fe.y,Oe.x-Fe.x);return Ye.push(vt),{point:vt,angle:D?Ct:0,path:Ye}}const Qt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ri(v,t){for(let u=0;u<v;u++){const p=t.length;t.resize(p+4),t.float32.set(Qt,3*p)}}function ji(v,t,u){const p=t[0],m=t[1];return v[0]=u[0]*p+u[4]*m+u[12],v[1]=u[1]*p+u[5]*m+u[13],v[3]=u[3]*p+u[7]*m+u[15],v}const wi=100;class zi{constructor(t,u,p=new br(t.width+200,t.height+200,25),m=new br(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=u,this.grid=p,this.ignoredGrid=m,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+wi,this.screenBottomBoundary=t.height+wi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,u,p,m,b,A,L,D,Z,K,J){const ae=t.anchorPointX+D[0],_e=t.anchorPointY+D[1],ke=this.projectAndGetPerspectiveRatio(m,ae,_e,b,K),Ie=p*ke.perspectiveRatio;let Oe;if(A||L)Oe=this._projectCollisionBox(t,Ie,m,b,A,L,D,ke,K,J);else{const Ye=ke.point.x+(J?J.x*Ie:0),nt=ke.point.y+(J?J.y*Ie:0);Oe={allPointsOccluded:!1,box:[Ye+t.x1*Ie,nt+t.y1*Ie,Ye+t.x2*Ie,nt+t.y2*Ie]}}const[Fe,je,Ce,He]=Oe.box;return this.mapProjection.useSpecialProjectionForSymbols&&(A?Oe.allPointsOccluded:this.mapProjection.isOccluded(ae,_e,b))||ke.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Fe,je,Ce,He)||u!=="always"&&this.grid.hitTest(Fe,je,Ce,He,u,Z)?{box:[Fe,je,Ce,He],placeable:!1,offscreen:!1}:{box:[Fe,je,Ce,He],placeable:!0,offscreen:this.isOffscreen(Fe,je,Ce,He)}}placeCollisionCircles(t,u,p,m,b,A,L,D,Z,K,J,ae,_e,ke,Ie,Oe){const Fe=[],je=new a.P(u.anchorX,u.anchorY),Ce=this.getPerspectiveRatio(A,je.x,je.y,L,Oe),He=(J?b/Ce:b*Ce)/a.ap,Ye={getElevation:Oe,labelPlaneMatrix:D,lineVertexArray:p,pitchWithMap:J,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:je,unwrappedTileID:L,width:this.transform.width,height:this.transform.height,translation:Ie},nt=Se(He,m,u.lineOffsetX*He,u.lineOffsetY*He,!1,u,!1,Ye);let vt=!1,Ct=!1,Ft=!0;if(nt){const Vt=.5*_e*Ce+ke,Lt=new a.P(-100,-100),Mt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Jt=new ci,xi=nt.first,zt=nt.last;let Nt=[];for(let Ai=xi.path.length-1;Ai>=1;Ai--)Nt.push(xi.path[Ai]);for(let Ai=1;Ai<zt.path.length;Ai++)Nt.push(zt.path[Ai]);const bi=2.5*Vt;if(Z){const Ai=this.projectPathToScreenSpace(Nt,Ye,Z);Nt=Ai.some(Vi=>Vi.signedDistanceFromCamera<=0)?[]:Ai.map(Vi=>Vi.point)}let gn=[];if(Nt.length>0){const Ai=Nt[0].clone(),Vi=Nt[0].clone();for(let _n=1;_n<Nt.length;_n++)Ai.x=Math.min(Ai.x,Nt[_n].x),Ai.y=Math.min(Ai.y,Nt[_n].y),Vi.x=Math.max(Vi.x,Nt[_n].x),Vi.y=Math.max(Vi.y,Nt[_n].y);gn=Ai.x>=Lt.x&&Vi.x<=Mt.x&&Ai.y>=Lt.y&&Vi.y<=Mt.y?[Nt]:Vi.x<Lt.x||Ai.x>Mt.x||Vi.y<Lt.y||Ai.y>Mt.y?[]:a.al([Nt],Lt.x,Lt.y,Mt.x,Mt.y)}for(const Ai of gn){Jt.reset(Ai,.25*Vt);let Vi=0;Vi=Jt.length<=.5*Vt?1:Math.ceil(Jt.paddedLength/bi)+1;for(let _n=0;_n<Vi;_n++){const lr=_n/Math.max(Vi-1,1),ys=Jt.lerp(lr),yn=ys.x+wi,Or=ys.y+wi;Fe.push(yn,Or,Vt,0);const kr=yn-Vt,cr=Or-Vt,Sr=yn+Vt,Ns=Or+Vt;if(Ft=Ft&&this.isOffscreen(kr,cr,Sr,Ns),Ct=Ct||this.isInsideGrid(kr,cr,Sr,Ns),t!=="always"&&this.grid.hitTestCircle(yn,Or,Vt,t,ae)&&(vt=!0,!K))return{circles:[],offscreen:!1,collisionDetected:vt}}}}return{circles:!K&&vt||!Ct||Ce<this.perspectiveRatioCutoff?[]:Fe,offscreen:Ft,collisionDetected:vt}}projectPathToScreenSpace(t,u,p){return t.map(m=>Le(m.x,m.y,p,u.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let p=1/0,m=1/0,b=-1/0,A=-1/0;for(const K of t){const J=new a.P(K.x+wi,K.y+wi);p=Math.min(p,J.x),m=Math.min(m,J.y),b=Math.max(b,J.x),A=Math.max(A,J.y),u.push(J)}const L=this.grid.query(p,m,b,A).concat(this.ignoredGrid.query(p,m,b,A)),D={},Z={};for(const K of L){const J=K.key;if(D[J.bucketInstanceId]===void 0&&(D[J.bucketInstanceId]={}),D[J.bucketInstanceId][J.featureIndex])continue;const ae=[new a.P(K.x1,K.y1),new a.P(K.x2,K.y1),new a.P(K.x2,K.y2),new a.P(K.x1,K.y2)];a.am(u,ae)&&(D[J.bucketInstanceId][J.featureIndex]=!0,Z[J.bucketInstanceId]===void 0&&(Z[J.bucketInstanceId]=[]),Z[J.bucketInstanceId].push(J.featureIndex))}return Z}insertCollisionBox(t,u,p,m,b,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:u},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,u,p,m,b,A){const L=p?this.ignoredGrid:this.grid,D={bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:u};for(let Z=0;Z<t.length;Z+=4)L.insertCircle(D,t[Z],t[Z+1],t[Z+2])}projectAndGetPerspectiveRatio(t,u,p,m,b){let A;b?(A=[u,p,b(u,p),1],a.af(A,A,t)):(A=[u,p,0,1],ji(A,A,t));const L=A[3];return{point:new a.P((A[0]/L+1)/2*this.transform.width+wi,(-A[1]/L+1)/2*this.transform.height+wi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/L*.5,isOccluded:!1,signedDistanceFromCamera:L}}getPerspectiveRatio(t,u,p,m,b){const A=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(u,p,m,b):Le(u,p,t,b);return .5+this.transform.cameraToCenterDistance/A.signedDistanceFromCamera*.5}isOffscreen(t,u,p,m){return p<wi||t>=this.screenRightBoundary||m<wi||u>this.screenBottomBoundary}isInsideGrid(t,u,p,m){return p>=0&&t<this.gridRightBoundary&&m>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const t=a.an([]);return a.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,u,p,m,b,A,L,D,Z,K){let J=new a.P(1,0),ae=new a.P(0,1);const _e=new a.P(t.anchorPointX+L[0],t.anchorPointY+L[1]);if(A&&!b){const Ft=this.projectAndGetPerspectiveRatio(p,_e.x+1,_e.y,m,Z).point.sub(D.point).unit(),Vt=Math.atan(Ft.y/Ft.x)+(Ft.x<0?Math.PI:0),Lt=Math.sin(Vt),Mt=Math.cos(Vt);J=new a.P(Mt,Lt),ae=new a.P(-Lt,Mt)}else if(!A&&b){const Ft=-this.transform.angle,Vt=Math.sin(Ft),Lt=Math.cos(Ft);J=new a.P(Lt,Vt),ae=new a.P(-Vt,Lt)}let ke=D.point,Ie=u;if(b){ke=_e;const Ft=this.transform.zoom-Math.floor(this.transform.zoom);Ie=Math.pow(2,-Ft),Ie*=this.mapProjection.getPitchedTextCorrection(this.transform,_e,m),K||(Ie*=a.ac(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}K&&(ke=ke.add(J.mult(K.x*Ie)).add(ae.mult(K.y*Ie)));const Oe=t.x1*Ie,Fe=t.x2*Ie,je=(Oe+Fe)/2,Ce=t.y1*Ie,He=t.y2*Ie,Ye=(Ce+He)/2,nt=[{offsetX:Oe,offsetY:Ce},{offsetX:je,offsetY:Ce},{offsetX:Fe,offsetY:Ce},{offsetX:Fe,offsetY:Ye},{offsetX:Fe,offsetY:He},{offsetX:je,offsetY:He},{offsetX:Oe,offsetY:He},{offsetX:Oe,offsetY:Ye}];let vt=[];for(const{offsetX:Ft,offsetY:Vt}of nt)vt.push(new a.P(ke.x+J.x*Ft+ae.x*Vt,ke.y+J.y*Ft+ae.y*Vt));let Ct=!1;if(b){const Ft=vt.map(Vt=>this.projectAndGetPerspectiveRatio(p,Vt.x,Vt.y,m,Z));Ct=Ft.some(Vt=>!Vt.isOccluded),vt=Ft.map(Vt=>Vt.point)}else Ct=!0;return{box:a.ao(vt),allPointsOccluded:!Ct}}}function Si(v,t,u){return t*(a.X/(v.tileSize*Math.pow(2,u-v.tileID.overscaledZ)))}class hn{constructor(t,u,p,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?u:-u))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class fn{constructor(t,u,p,m,b){this.text=new hn(t?t.text:null,u,p,b),this.icon=new hn(t?t.icon:null,u,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ke{constructor(t,u,p){this.text=t,this.icon=u,this.skipFade=p}}class pi{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class ki{constructor(t,u,p,m,b){this.bucketInstanceId=t,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class Ui{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const u=++this.maxGroupID;this.collisionGroups[t]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[t]}}function Ki(v,t,u,p,m){const{horizontalAlign:b,verticalAlign:A}=a.au(v);return new a.P(-(b-.5)*t+p[0]*m,-(A-.5)*u+p[1]*m)}class Ji{constructor(t,u,p,m,b,A){this.transform=t.clone(),this.terrain=p,this.collisionIndex=new zi(this.transform,u),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Ui(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const u=this.terrain;return u?(p,m)=>u.getElevation(t,p,m):null}getBucketParts(t,u,p,m){const b=p.getBucket(u),A=p.latestFeatureIndex;if(!b||!A||u.id!==b.layerIds[0])return;const L=p.collisionBoxArray,D=b.layers[0].layout,Z=b.layers[0].paint,K=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),J=p.tileSize/a.X,ae=p.tileID.toUnwrapped(),_e=this.transform.calculatePosMatrix(ae),ke=D.get("text-pitch-alignment")==="map",Ie=D.get("text-rotation-alignment")==="map",Oe=Si(p,1,this.transform.zoom),Fe=this.collisionIndex.mapProjection.translatePosition(this.transform,p,Z.get("text-translate"),Z.get("text-translate-anchor")),je=this.collisionIndex.mapProjection.translatePosition(this.transform,p,Z.get("icon-translate"),Z.get("icon-translate-anchor")),Ce=Ar(_e,ke,Ie,this.transform,Oe);let He=null;if(ke){const nt=Mr(_e,ke,Ie,this.transform,Oe);He=a.L([],this.transform.labelPlaneMatrix,nt)}this.retainedQueryData[b.bucketInstanceId]=new ki(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,p.tileID);const Ye={bucket:b,layout:D,translationText:Fe,translationIcon:je,posMatrix:_e,unwrappedTileID:ae,textLabelPlaneMatrix:Ce,labelToScreenMatrix:He,scale:K,textPixelRatio:J,holdingForFade:p.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:a.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const nt of b.sortKeyRanges){const{sortKey:vt,symbolInstanceStart:Ct,symbolInstanceEnd:Ft}=nt;t.push({sortKey:vt,symbolInstanceStart:Ct,symbolInstanceEnd:Ft,parameters:Ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ye})}attemptAnchorPlacement(t,u,p,m,b,A,L,D,Z,K,J,ae,_e,ke,Ie,Oe,Fe,je,Ce){const He=a.aq[t.textAnchor],Ye=[t.textOffset0,t.textOffset1],nt=Ki(He,p,m,Ye,b),vt=this.collisionIndex.placeCollisionBox(u,ae,D,Z,K,L,A,Oe,J.predicate,Ce,nt);if((!je||this.collisionIndex.placeCollisionBox(je,ae,D,Z,K,L,A,Fe,J.predicate,Ce,nt).placeable)&&vt.placeable){let Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(Ct=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),_e.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[_e.crossTileID]={textOffset:Ye,width:p,height:m,anchor:He,textBoxScale:b,prevAnchor:Ct},this.markUsedJustification(ke,He,_e,Ie),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Ie,_e),this.placedOrientations[_e.crossTileID]=Ie),{shift:nt,placedGlyphBoxes:vt}}}placeLayerBucketPart(t,u,p){const{bucket:m,layout:b,translationText:A,translationIcon:L,posMatrix:D,unwrappedTileID:Z,textLabelPlaneMatrix:K,labelToScreenMatrix:J,textPixelRatio:ae,holdingForFade:_e,collisionBoxArray:ke,partiallyEvaluatedTextSize:Ie,collisionGroup:Oe}=t.parameters,Fe=b.get("text-optional"),je=b.get("icon-optional"),Ce=a.ar(b,"text-overlap","text-allow-overlap"),He=Ce==="always",Ye=a.ar(b,"icon-overlap","icon-allow-overlap"),nt=Ye==="always",vt=b.get("text-rotation-alignment")==="map",Ct=b.get("text-pitch-alignment")==="map",Ft=b.get("icon-text-fit")!=="none",Vt=b.get("symbol-z-order")==="viewport-y",Lt=He&&(nt||!m.hasIconData()||je),Mt=nt&&(He||!m.hasTextData()||Fe);!m.collisionArrays&&ke&&m.deserializeCollisionBoxes(ke);const Jt=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),xi=(zt,Nt,bi)=>{var gn,Ai;if(u[zt.crossTileID])return;if(_e)return void(this.placements[zt.crossTileID]=new Ke(!1,!1,!1));let Vi=!1,_n=!1,lr=!0,ys=null,yn={box:null,placeable:!1,offscreen:null},Or={placeable:!1},kr=null,cr=null,Sr=null,Ns=0,qa=0,vc=0;Nt.textFeatureIndex?Ns=Nt.textFeatureIndex:zt.useRuntimeCollisionCircles&&(Ns=zt.featureIndex),Nt.verticalTextFeatureIndex&&(qa=Nt.verticalTextFeatureIndex);const Za=Nt.textBox;if(Za){const us=nr=>{let ur=a.ah.horizontal;if(m.allowVerticalPlacement&&!nr&&this.prevPlacement){const Xr=this.prevPlacement.placedOrientations[zt.crossTileID];Xr&&(this.placedOrientations[zt.crossTileID]=Xr,ur=Xr,this.markUsedOrientation(m,ur,zt))}return ur},hs=(nr,ur)=>{if(m.allowVerticalPlacement&&zt.numVerticalGlyphVertices>0&&Nt.verticalTextBox){for(const Xr of m.writingModes)if(Xr===a.ah.vertical?(yn=ur(),Or=yn):yn=nr(),yn&&yn.placeable)break}else yn=nr()},Io=zt.textAnchorOffsetStartIndex,bs=zt.textAnchorOffsetEndIndex;if(bs===Io){const nr=(ur,Xr)=>{const Zi=this.collisionIndex.placeCollisionBox(ur,Ce,ae,D,Z,Ct,vt,A,Oe.predicate,Jt);return Zi&&Zi.placeable&&(this.markUsedOrientation(m,Xr,zt),this.placedOrientations[zt.crossTileID]=Xr),Zi};hs(()=>nr(Za,a.ah.horizontal),()=>{const ur=Nt.verticalTextBox;return m.allowVerticalPlacement&&zt.numVerticalGlyphVertices>0&&ur?nr(ur,a.ah.vertical):{box:null,offscreen:null}}),us(yn&&yn.placeable)}else{let nr=a.aq[(Ai=(gn=this.prevPlacement)===null||gn===void 0?void 0:gn.variableOffsets[zt.crossTileID])===null||Ai===void 0?void 0:Ai.anchor];const ur=(Zi,sa,Wa)=>{const Ga=Zi.x2-Zi.x1,Mh=Zi.y2-Zi.y1,Bf=zt.textBoxScale,Ph=Ft&&Ye==="never"?sa:null;let Ao=null,Lh=Ce==="never"?1:2,xc="never";nr&&Lh++;for(let Cl=0;Cl<Lh;Cl++){for(let kc=Io;kc<bs;kc++){const Sc=m.textAnchorOffsets.get(kc);if(nr&&Sc.textAnchor!==nr)continue;const Ha=this.attemptAnchorPlacement(Sc,Zi,Ga,Mh,Bf,vt,Ct,ae,D,Z,Oe,xc,zt,m,Wa,A,L,Ph,Jt);if(Ha&&(Ao=Ha.placedGlyphBoxes,Ao&&Ao.placeable))return Vi=!0,ys=Ha.shift,Ao}nr?nr=null:xc=Ce}return p&&!Ao&&(Ao={box:this.collisionIndex.placeCollisionBox(Za,"always",ae,D,Z,Ct,vt,A,Oe.predicate,Jt,new a.P(0,0)).box,offscreen:!1,placeable:!1}),Ao};hs(()=>ur(Za,Nt.iconBox,a.ah.horizontal),()=>{const Zi=Nt.verticalTextBox;return m.allowVerticalPlacement&&(!yn||!yn.placeable)&&zt.numVerticalGlyphVertices>0&&Zi?ur(Zi,Nt.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),yn&&(Vi=yn.placeable,lr=yn.offscreen);const Xr=us(yn&&yn.placeable);if(!Vi&&this.prevPlacement){const Zi=this.prevPlacement.variableOffsets[zt.crossTileID];Zi&&(this.variableOffsets[zt.crossTileID]=Zi,this.markUsedJustification(m,Zi.anchor,zt,Xr))}}}if(kr=yn,Vi=kr&&kr.placeable,lr=kr&&kr.offscreen,zt.useRuntimeCollisionCircles){const us=m.text.placedSymbolArray.get(zt.centerJustifiedTextSymbolIndex),hs=a.ai(m.textSizeData,Ie,us),Io=b.get("text-padding");cr=this.collisionIndex.placeCollisionCircles(Ce,us,m.lineVertexArray,m.glyphOffsetArray,hs,D,Z,K,J,p,Ct,Oe.predicate,zt.collisionCircleDiameter,Io,A,Jt),cr.circles.length&&cr.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),Vi=He||cr.circles.length>0&&!cr.collisionDetected,lr=lr&&cr.offscreen}if(Nt.iconFeatureIndex&&(vc=Nt.iconFeatureIndex),Nt.iconBox){const us=hs=>this.collisionIndex.placeCollisionBox(hs,Ye,ae,D,Z,Ct,vt,L,Oe.predicate,Jt,Ft&&ys?ys:void 0);Or&&Or.placeable&&Nt.verticalIconBox?(Sr=us(Nt.verticalIconBox),_n=Sr.placeable):(Sr=us(Nt.iconBox),_n=Sr.placeable),lr=lr&&Sr.offscreen}const cs=Fe||zt.numHorizontalGlyphVertices===0&&zt.numVerticalGlyphVertices===0,wc=je||zt.numIconVertices===0;cs||wc?wc?cs||(_n=_n&&Vi):Vi=_n&&Vi:_n=Vi=_n&&Vi;const Mu=_n&&Sr.placeable;if(Vi&&kr.placeable&&this.collisionIndex.insertCollisionBox(kr.box,Ce,b.get("text-ignore-placement"),m.bucketInstanceId,Or&&Or.placeable&&qa?qa:Ns,Oe.ID),Mu&&this.collisionIndex.insertCollisionBox(Sr.box,Ye,b.get("icon-ignore-placement"),m.bucketInstanceId,vc,Oe.ID),cr&&Vi&&this.collisionIndex.insertCollisionCircles(cr.circles,Ce,b.get("text-ignore-placement"),m.bucketInstanceId,Ns,Oe.ID),p&&this.storeCollisionData(m.bucketInstanceId,bi,Nt,kr,Sr,cr),zt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[zt.crossTileID]=new Ke(Vi||Lt,_n||Mt,lr||m.justReloaded),u[zt.crossTileID]=!0};if(Vt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const zt=m.getSortedSymbolIndexes(this.transform.angle);for(let Nt=zt.length-1;Nt>=0;--Nt){const bi=zt[Nt];xi(m.symbolInstances.get(bi),m.collisionArrays[bi],bi)}}else for(let zt=t.symbolInstanceStart;zt<t.symbolInstanceEnd;zt++)xi(m.symbolInstances.get(zt),m.collisionArrays[zt],zt);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const zt=this.collisionCircleArrays[m.bucketInstanceId];a.as(zt.invProjMatrix,D),zt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(t,u,p,m,b,A){if(p.textBox||p.iconBox){let L,D;this.collisionBoxArrays.has(t)?L=this.collisionBoxArrays.get(t):(L=new Map,this.collisionBoxArrays.set(t,L)),L.has(u)?D=L.get(u):(D={text:null,icon:null},L.set(u,D)),p.textBox&&(D.text=m.box),p.iconBox&&(D.icon=b.box)}if(A){let L=this.collisionCircleArrays[t];L===void 0&&(L=this.collisionCircleArrays[t]=new pi);for(let D=0;D<A.circles.length;D+=4)L.circles.push(A.circles[D+0]),L.circles.push(A.circles[D+1]),L.circles.push(A.circles[D+2]),L.circles.push(A.collisionDetected?1:0)}}markUsedJustification(t,u,p,m){let b;b=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.at(u)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const L of A)L>=0&&(t.text.placedSymbolArray.get(L).crossTileID=b>=0&&L!==b?0:p.crossTileID)}markUsedOrientation(t,u,p){const m=u===a.ah.horizontal||u===a.ah.horizontalOnly?u:0,b=u===a.ah.vertical?u:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const L of A)t.text.placedSymbolArray.get(L).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const m=u?u.symbolFadeChange(t):1,b=u?u.opacities:{},A=u?u.variableOffsets:{},L=u?u.placedOrientations:{};for(const D in this.placements){const Z=this.placements[D],K=b[D];K?(this.opacities[D]=new fn(K,m,Z.text,Z.icon),p=p||Z.text!==K.text.placed||Z.icon!==K.icon.placed):(this.opacities[D]=new fn(null,m,Z.text,Z.icon,Z.skipFade),p=p||Z.text||Z.icon)}for(const D in b){const Z=b[D];if(!this.opacities[D]){const K=new fn(Z,m,!1,!1);K.isHidden()||(this.opacities[D]=K,p=p||Z.text.placed||Z.icon.placed)}}for(const D in A)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=A[D]);for(const D in L)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=L[D]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:t)}updateLayerOpacities(t,u){const p={};for(const m of u){const b=m.getBucket(t);b&&m.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(t,u,p,m){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const b=t.layers[0],A=b.layout,L=new fn(null,0,!1,!1,!0),D=A.get("text-allow-overlap"),Z=A.get("icon-allow-overlap"),K=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),J=A.get("text-rotation-alignment")==="map",ae=A.get("text-pitch-alignment")==="map",_e=A.get("icon-text-fit")!=="none",ke=new fn(null,0,D&&(Z||!t.hasIconData()||A.get("icon-optional")),Z&&(D||!t.hasTextData()||A.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const Ie=(Fe,je,Ce)=>{for(let He=0;He<je/4;He++)Fe.opacityVertexArray.emplaceBack(Ce);Fe.hasVisibleVertices=Fe.hasVisibleVertices||Ce!==Ur},Oe=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Fe=0;Fe<t.symbolInstances.length;Fe++){const je=t.symbolInstances.get(Fe),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:He,crossTileID:Ye}=je;let nt=this.opacities[Ye];p[Ye]?nt=L:nt||(nt=ke,this.opacities[Ye]=nt),p[Ye]=!0;const vt=je.numIconVertices>0,Ct=this.placedOrientations[je.crossTileID],Ft=Ct===a.ah.vertical,Vt=Ct===a.ah.horizontal||Ct===a.ah.horizontalOnly;if(Ce>0||He>0){const Mt=Xn(nt.text);Ie(t.text,Ce,Ft?Ur:Mt),Ie(t.text,He,Vt?Ur:Mt);const Jt=nt.text.isHidden();[je.rightJustifiedTextSymbolIndex,je.centerJustifiedTextSymbolIndex,je.leftJustifiedTextSymbolIndex].forEach(Nt=>{Nt>=0&&(t.text.placedSymbolArray.get(Nt).hidden=Jt||Ft?1:0)}),je.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(je.verticalPlacedTextSymbolIndex).hidden=Jt||Vt?1:0);const xi=this.variableOffsets[je.crossTileID];xi&&this.markUsedJustification(t,xi.anchor,je,Ct);const zt=this.placedOrientations[je.crossTileID];zt&&(this.markUsedJustification(t,"left",je,zt),this.markUsedOrientation(t,zt,je))}if(vt){const Mt=Xn(nt.icon),Jt=!(_e&&je.verticalPlacedIconSymbolIndex&&Ft);je.placedIconSymbolIndex>=0&&(Ie(t.icon,je.numIconVertices,Jt?Mt:Ur),t.icon.placedSymbolArray.get(je.placedIconSymbolIndex).hidden=nt.icon.isHidden()),je.verticalPlacedIconSymbolIndex>=0&&(Ie(t.icon,je.numVerticalIconVertices,Jt?Ur:Mt),t.icon.placedSymbolArray.get(je.verticalPlacedIconSymbolIndex).hidden=nt.icon.isHidden())}const Lt=Oe&&Oe.has(Fe)?Oe.get(Fe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Mt=t.collisionArrays[Fe];if(Mt){let Jt=new a.P(0,0);if(Mt.textBox||Mt.verticalTextBox){let xi=!0;if(K){const zt=this.variableOffsets[Ye];zt?(Jt=Ki(zt.anchor,zt.width,zt.height,zt.textOffset,zt.textBoxScale),J&&Jt._rotate(ae?this.transform.angle:-this.transform.angle)):xi=!1}if(Mt.textBox||Mt.verticalTextBox){let zt;Mt.textBox&&(zt=Ft),Mt.verticalTextBox&&(zt=Vt),Un(t.textCollisionBox.collisionVertexArray,nt.text.placed,!xi||zt,Lt.text,Jt.x,Jt.y)}}if(Mt.iconBox||Mt.verticalIconBox){const xi=!!(!Vt&&Mt.verticalIconBox);let zt;Mt.iconBox&&(zt=xi),Mt.verticalIconBox&&(zt=!xi),Un(t.iconCollisionBox.collisionVertexArray,nt.icon.placed,zt,Lt.icon,_e?Jt.x:0,_e?Jt.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Fe.invProjMatrix,t.placementViewportMatrix=Fe.viewportMatrix,t.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function Un(v,t,u,p,m,b){p&&p.length!==0||(p=[0,0,0,0]);const A=p[0]-wi,L=p[1]-wi,D=p[2]-wi,Z=p[3]-wi;v.emplaceBack(t?1:0,u?1:0,m||0,b||0,A,L),v.emplaceBack(t?1:0,u?1:0,m||0,b||0,D,L),v.emplaceBack(t?1:0,u?1:0,m||0,b||0,D,Z),v.emplaceBack(t?1:0,u?1:0,m||0,b||0,A,Z)}const si=Math.pow(2,25),es=Math.pow(2,24),Hn=Math.pow(2,17),Vn=Math.pow(2,16),pn=Math.pow(2,9),ba=Math.pow(2,8),zn=Math.pow(2,1);function Xn(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const t=v.placed?1:0,u=Math.floor(127*v.opacity);return u*si+t*es+u*Hn+t*Vn+u*pn+t*ba+u*zn+t}const Ur=0;function Rn(){return{isOccluded:(v,t,u)=>!1,getPitchedTextCorrection:(v,t,u)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(v,t,u,p){throw new Error("Not implemented.")},translatePosition:(v,t,u,p)=>function(m,b,A,L,D=!1){if(!A[0]&&!A[1])return[0,0];const Z=D?L==="map"?m.angle:0:L==="viewport"?-m.angle:0;if(Z){const K=Math.sin(Z),J=Math.cos(Z);A=[A[0]*J-A[1]*K,A[0]*K+A[1]*J]}return[D?A[0]:Si(b,A[0],m.zoom),D?A[1]:Si(b,A[1],m.zoom)]}(v,t,u,p),getCircleRadiusCorrection:v=>1}}class Ii{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,u,p,m,b){const A=this._bucketParts;for(;this._currentTileIndex<t.length;)if(u.getBucketParts(A,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((L,D)=>L.sortKey-D.sortKey));this._currentPartIndex<A.length;)if(u.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class No{constructor(t,u,p,m,b,A,L,D){this.placement=new Ji(t,Rn(),u,A,L,D),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,u,p){const m=y.now(),b=()=>!this._forceFullPlacement&&y.now()-m>2;for(;this._currentPlacementIndex>=0;){const A=u[t[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=L)&&(!A.maxzoom||A.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new Ii(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ar=512/a.X/2;class En{constructor(t,u,p){this.tileID=t,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<u.length;b++){const A=u.get(b),L=A.key,D=m.get(L);D?D.push(A):m.set(L,[A])}for(const[b,A]of m){const L={positions:A.map(D=>({x:Math.floor(D.anchorX*ar),y:Math.floor(D.anchorY*ar)})),crossTileIDs:A.map(D=>D.crossTileID)};if(L.positions.length>128){const D=new a.av(L.positions.length,16,Uint16Array);for(const{x:Z,y:K}of L.positions)D.add(Z,K);D.finish(),delete L.positions,L.index=D}this._symbolsByKey[b]=L}}getScaledCoordinates(t,u){const{x:p,y:m,z:b}=this.tileID.canonical,{x:A,y:L,z:D}=u.canonical,Z=ar/Math.pow(2,D-b),K=(L*a.X+t.anchorY)*Z,J=m*a.X*ar;return{x:Math.floor((A*a.X+t.anchorX)*Z-p*a.X*ar),y:Math.floor(K-J)}}findMatches(t,u,p){const m=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<t.length;b++){const A=t.get(b);if(A.crossTileID)continue;const L=this._symbolsByKey[A.key];if(!L)continue;const D=this.getScaledCoordinates(A,u);if(L.index){const Z=L.index.range(D.x-m,D.y-m,D.x+m,D.y+m).sort();for(const K of Z){const J=L.crossTileIDs[K];if(!p[J]){p[J]=!0,A.crossTileID=J;break}}}else if(L.positions)for(let Z=0;Z<L.positions.length;Z++){const K=L.positions[Z],J=L.crossTileIDs[Z];if(Math.abs(K.x-D.x)<=m&&Math.abs(K.y-D.y)<=m&&!p[J]){p[J]=!0,A.crossTileID=J;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class va{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const u=Math.round((t-this.lng)/360);if(u!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const A in m){const L=m[A];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+u),b[L.tileID.key]=L}this.indexes[p]=b}this.lng=t}addBucket(t,u,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const A=this.indexes[b];if(Number(b)>t.overscaledZ)for(const L in A){const D=A[L];D.tileID.isChildOf(t)&&D.findMatches(u.symbolInstances,t,m)}else{const L=A[t.scaledTo(Number(b)).key];L&&L.findMatches(u.symbolInstances,t,m)}}for(let b=0;b<u.symbolInstances.length;b++){const A=u.symbolInstances.get(b);A.crossTileID||(A.crossTileID=p.generate(),m[A.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new En(t,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(t,u){for(const p of u.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[t][m]}removeStaleBuckets(t){let u=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)t[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],u=!0)}return u}}class ll{constructor(){this.layerIndexes={},this.crossTileIDs=new va,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,u,p){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Vr);let b=!1;const A={};m.handleWrapJump(p);for(const L of u){const D=L.getBucket(t);D&&t.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(L.tileID,D,this.crossTileIDs)&&(b=!0),A[D.bucketInstanceId]=!0)}return m.removeStaleBuckets(A)&&(b=!0),b}pruneUnusedLayers(t){const u={};t.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}const qr=(v,t)=>a.t(v,t&&t.filter(u=>u.identifier!=="source.canvas")),ou=a.aw();class wa extends a.E{constructor(t,u={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=t,this.dispatcher=new Pi(Mi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new le,this.imageManager.setEventedParent(this),this.glyphManager=new we(t._requestManager,u.localIdeographFontFamily),this.lineAtlas=new kt(256,512),this.crossTileSymbolIndex=new ll,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),Bi().on(ft,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const A in this._layers){const L=this._layers[A];L.source===b.id&&this._validateLayer(L)}})}loadURL(t,u={},p){this.fire(new a.k("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const m=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;a.h(m,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,u,p)}).catch(A=>{this._loadStyleRequest=null,A&&!b.signal.aborted&&this.fire(new a.j(A))})}loadJSON(t,u={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(t,u,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(ou,{validate:!1})}_load(t,u,p){var m;const b=u.transformStyle?u.transformStyle(p,t):t;if(!u.validate||!qr(this,a.u(b))){this._loaded=!0,this.stylesheet=b;for(const A in b.sources)this.addSource(A,b.sources[A],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new ct(this.stylesheet.light),this.sky=new pt(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const t=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(u=>u.id),this._layers={},this._serializedLayers=null;for(const u of t){const p=a.aA(u);p.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=p}}_loadSprite(t,u=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,A,L,D){return a._(this,void 0,void 0,function*(){const Z=j(b),K=L>1?"@2x":"",J={},ae={};for(const{id:_e,url:ke}of Z){const Ie=A.transformRequest(G(ke,K,".json"),"SpriteJSON");J[_e]=a.h(Ie,D);const Oe=A.transformRequest(G(ke,K,".png"),"SpriteImage");ae[_e]=V.getImage(Oe,D)}return yield Promise.all([...Object.values(J),...Object.values(ae)]),function(_e,ke){return a._(this,void 0,void 0,function*(){const Ie={};for(const Oe in _e){Ie[Oe]={};const Fe=y.getImageCanvasContext((yield ke[Oe]).data),je=(yield _e[Oe]).data;for(const Ce in je){const{width:He,height:Ye,x:nt,y:vt,sdf:Ct,pixelRatio:Ft,stretchX:Vt,stretchY:Lt,content:Mt,textFitWidth:Jt,textFitHeight:xi}=je[Ce];Ie[Oe][Ce]={data:null,pixelRatio:Ft,sdf:Ct,stretchX:Vt,stretchY:Lt,content:Mt,textFitWidth:Jt,textFitHeight:xi,spriteData:{width:He,height:Ye,x:nt,y:vt,context:Fe}}}}return Ie})}(J,ae)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const A in b){this._spritesImagesIds[A]=[];const L=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter(D=>!(D in b)):[];for(const D of L)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in b[A]){const Z=A==="default"?D:`${A}:${D}`;this._spritesImagesIds[A].push(Z),Z in this.imageManager.images?this.imageManager.updateImage(Z,b[A][D],!1):this.imageManager.addImage(Z,b[A][D]),u&&(this._changedImages[Z]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(t){const u=this.sourceCaches[t.source];if(!u)return;const p=t.sourceLayer;if(!p)return;const m=u.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,u=!1){const p=this._serializedAllLayers();if(!t||t.length===0)return Object.values(u?a.aB(p):p);const m=[];for(const b of t)if(p[b]){const A=u?a.aB(p[b]):p[b];m.push(A)}return m}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const u=Object.keys(this._layers);for(const p of u){const m=this._layers[p];m.type!=="custom"&&(t[p]=m.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const u=this._changed;if(u){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const A in this._updatedSources){const L=this._updatedSources[A];if(L==="reload")this._reloadSource(A);else{if(L!=="clear")throw new Error(`Invalid action ${L}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,u&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,u={}){var p;this._checkLoaded();const m=this.serialize();if(t=u.transformStyle?u.transformStyle(m,t):t,((p=u.validate)===null||p===void 0||p)&&qr(this,a.u(t)))return!1;(t=a.aB(t)).layers=a.az(t.layers);const b=a.aC(m,t),A=this._getOperationsToPerform(b);if(A.unimplemented.length>0)throw new Error(`Unimplemented: ${A.unimplemented.join(", ")}.`);if(A.operations.length===0)return!1;for(const L of A.operations)L();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const u=[],p=[];for(const m of t)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":u.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":u.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":u.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":u.push(()=>{});break;default:p.push(m.command)}return{operations:u,unimplemented:p}}addImage(t,u){if(this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,u),this._afterImageUpdated(t)}updateImage(t,u){this.imageManager.updateImage(t,u)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,u,p={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(a.u.source,`sources.${t}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const m=this.sourceCaches[t]=new ii(t,u,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new a.j(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));const u=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],u.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,u){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const p=this.sourceCaches[t].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(u),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,u,p={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(t.type==="custom"){if(qr(this,a.aD(t)))return;b=a.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(m,t.source),t=a.aB(t),t=a.e(t,{source:m})),this._validate(a.u.layer,`layers.${m}`,t,{arrayIndex:-1},p))return;b=a.aA(t),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const A=u?this._order.indexOf(u):this._order.length;if(u&&A===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${u}".`)));else{if(this._order.splice(A,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const L=this._removedLayers[m];delete this._removedLayers[m],L.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,u){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===u)return;const p=this._order.indexOf(t);this._order.splice(p,1);const m=u?this._order.indexOf(u):this._order.length;u&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${t}" before non-existing layer "${u}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const u=this._layers[t];if(!u)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${t}".`)));u.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=u,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],u.onRemove&&u.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,u,p){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===u&&m.maxzoom===p||(u!=null&&(m.minzoom=u),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,u,p={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!a.aE(m.filter,u))return u==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.u.filter,`layers.${m.id}.filter`,u,null,p)||(m.filter=a.aB(u),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.aB(this.getLayer(t).filter)}setLayoutProperty(t,u,p,m={}){this._checkLoaded();const b=this.getLayer(t);b?a.aE(b.getLayoutProperty(u),p)||(b.setLayoutProperty(u,p,m),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,u){const p=this.getLayer(t);if(p)return p.getLayoutProperty(u);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,u,p,m={}){this._checkLoaded();const b=this.getLayer(t);b?a.aE(b.getPaintProperty(u),p)||(b.setPaintProperty(u,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,u){return this.getLayer(t).getPaintProperty(u)}setFeatureState(t,u){this._checkLoaded();const p=t.source,m=t.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const A=b.getSource().type;A==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||m?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,t.id,u)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,u){this._checkLoaded();const p=t.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,A=b==="vector"?t.sourceLayer:void 0;b!=="vector"||A?u&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(A,t.id,u):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const u=t.source,p=t.sourceLayer,m=this.sourceCaches[u];if(m!==void 0)return m.getSource().type!=="vector"||p?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,t.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=a.aF(this.sourceCaches,b=>b.serialize()),u=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:t,layers:u,terrain:p},b=>b!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const u=A=>this._layers[A].type==="fill-extrusion",p={},m=[];for(let A=this._order.length-1;A>=0;A--){const L=this._order[A];if(u(L)){p[L]=A;for(const D of t){const Z=D[L];if(Z)for(const K of Z)m.push(K)}}}m.sort((A,L)=>L.intersectionZ-A.intersectionZ);const b=[];for(let A=this._order.length-1;A>=0;A--){const L=this._order[A];if(u(L))for(let D=m.length-1;D>=0;D--){const Z=m[D].feature;if(p[Z.layer.id]<A)break;b.push(Z),m.pop()}else for(const D of t){const Z=D[L];if(Z)for(const K of Z)b.push(K.feature)}}return b}queryRenderedFeatures(t,u,p){u&&u.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",u.filter,null,u);const m={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const L of u.layers){const D=this._layers[L];if(!D)return this.fire(new a.j(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];m[D.source]=!0}}const b=[];u.availableImages=this._availableImages;const A=this._serializedAllLayers();for(const L in this.sourceCaches)u.layers&&!m[L]||b.push(Xe(this.sourceCaches[L],this._layers,A,t,u,p));return this.placement&&b.push(function(L,D,Z,K,J,ae,_e){const ke={},Ie=ae.queryRenderedSymbols(K),Oe=[];for(const Fe of Object.keys(Ie).map(Number))Oe.push(_e[Fe]);Oe.sort(Pt);for(const Fe of Oe){const je=Fe.featureIndex.lookupSymbolFeatures(Ie[Fe.bucketInstanceId],D,Fe.bucketIndex,Fe.sourceLayerIndex,J.filter,J.layers,J.availableImages,L);for(const Ce in je){const He=ke[Ce]=ke[Ce]||[],Ye=je[Ce];Ye.sort((nt,vt)=>{const Ct=Fe.featureSortOrder;if(Ct){const Ft=Ct.indexOf(nt.featureIndex);return Ct.indexOf(vt.featureIndex)-Ft}return vt.featureIndex-nt.featureIndex});for(const nt of Ye)He.push(nt)}}for(const Fe in ke)ke[Fe].forEach(je=>{const Ce=je.feature,He=Z[L[Fe].source].getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]),Ce.state=He});return ke}(this._layers,A,this.sourceCaches,t,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,u){u&&u.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",u.filter,null,u);const p=this.sourceCaches[t];return p?function(m,b){const A=m.getRenderableIds().map(Z=>m.getTileByID(Z)),L=[],D={};for(let Z=0;Z<A.length;Z++){const K=A[Z],J=K.tileID.canonical.key;D[J]||(D[J]=!0,K.querySourceFeatures(L,b))}return L}(p,u):[]}getLight(){return this.light.getLight()}setLight(t,u={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const A in t)if(!a.aE(t[A],p[A])){m=!0;break}if(!m)return;const b={now:y.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,u),this.light.updateTransitions(b)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,u={}){const p=this.getSky();let m=!1;if(!t&&!p)return;if(t&&!p)m=!0;else if(!t&&p)m=!0;else for(const A in t)if(!a.aE(t[A],p[A])){m=!0;break}if(!m)return;const b={now:y.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,u),this.sky.updateTransitions(b)}_validate(t,u,p,m,b={}){return(!b||b.validate!==!1)&&qr(this,t.call(a.u,a.e({key:u,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Bi().off(ft,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const p=this.sourceCaches[u];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const u in this.sourceCaches)this.sourceCaches[u].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,u,p,m,b=!1){let A=!1,L=!1;const D={};for(const Z of this._order){const K=this._layers[Z];if(K.type!=="symbol")continue;if(!D[K.source]){const ae=this.sourceCaches[K.source];D[K.source]=ae.getRenderableIds(!0).map(_e=>ae.getTileByID(_e)).sort((_e,ke)=>ke.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(ke.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(K,D[K.source],t.center.lng);A=A||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),t.zoom))&&(this.pauseablePlacement=new No(t,this.map.terrain,this._order,b,u,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),L=!0),A&&this.pauseablePlacement.placement.setStale()),L||A)for(const Z of this._order){const K=this._layers[Z];K.type==="symbol"&&this.placement.updateLayerOpacities(K,D[K.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,u){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,u.icons),p})}getGlyphs(t,u){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(u.stacks),m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,u={}){this._checkLoaded(),t&&this._validate(a.u.glyphs,"glyphs",t,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,u,p={},m){this._checkLoaded();const b=[{id:t,url:u}],A=[...j(this.stylesheet.sprite),...b];this._validate(a.u.sprite,"sprite",A,null,p)||(this.stylesheet.sprite=A,this._loadSprite(b,!0,m))}removeSprite(t){this._checkLoaded();const u=j(this.stylesheet.sprite);if(u.find(p=>p.id===t)){if(this._spritesImagesIds[t])for(const p of this._spritesImagesIds[t])this.imageManager.removeImage(p),this._changedImages[p]=!0;u.splice(u.findIndex(p=>p.id===t),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return j(this.stylesheet.sprite)}setSprite(t,u={},p){this._checkLoaded(),t&&this._validate(a.u.sprite,"sprite",t,null,u)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,p):(this._unloadSprite(),p&&p(null)))}}var Xs=a.Y([{name:"a_pos",type:"Int16",components:2}]);const Bn={prelude:Gi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Gi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Gi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Gi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Gi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Gi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Gi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Gi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Gi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Gi(v,t){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=t.match(/attribute ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=b?b.concat(m):m,L={};return{fragmentSource:v=v.replace(u,(D,Z,K,J,ae)=>(L[ae]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
varying ${K} ${J} ${ae};
#else
uniform ${K} ${J} u_${ae};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ae}
    ${K} ${J} ${ae} = u_${ae};
#endif
`)),vertexSource:t=t.replace(u,(D,Z,K,J,ae)=>{const _e=J==="float"?"vec2":"vec4",ke=ae.match(/color/)?"color":_e;return L[ae]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
uniform lowp float u_${ae}_t;
attribute ${K} ${_e} a_${ae};
varying ${K} ${J} ${ae};
#else
uniform ${K} ${J} u_${ae};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${ae}
    ${ae} = a_${ae};
#else
    ${K} ${J} ${ae} = u_${ae};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ae}
    ${ae} = unpack_mix_${ke}(a_${ae}, u_${ae}_t);
#else
    ${K} ${J} ${ae} = u_${ae};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
uniform lowp float u_${ae}_t;
attribute ${K} ${_e} a_${ae};
#else
uniform ${K} ${J} u_${ae};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${ae}
    ${K} ${J} ${ae} = a_${ae};
#else
    ${K} ${J} ${ae} = u_${ae};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ae}
    ${K} ${J} ${ae} = unpack_mix_${ke}(a_${ae}, u_${ae}_t);
#else
    ${K} ${J} ${ae} = u_${ae};
#endif
`}),staticAttributes:p,staticUniforms:A}}class xa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,u,p,m,b,A,L,D,Z){this.context=t;let K=this.boundPaintVertexBuffers.length!==m.length;for(let J=0;!K&&J<m.length;J++)this.boundPaintVertexBuffers[J]!==m[J]&&(K=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||K||this.boundIndexBuffer!==b||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==L||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==Z?this.freshBind(u,p,m,b,A,L,D,Z):(t.bindVertexArray.set(this.vao),L&&L.bind(),b&&b.dynamicDraw&&b.bind(),D&&D.bind(),Z&&Z.bind())}freshBind(t,u,p,m,b,A,L,D){const Z=t.numAttributes,K=this.context,J=K.gl;this.vao&&this.destroy(),this.vao=K.createVertexArray(),K.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=L,this.boundDynamicVertexBuffer3=D,u.enableAttributes(J,t);for(const ae of p)ae.enableAttributes(J,t);A&&A.enableAttributes(J,t),L&&L.enableAttributes(J,t),D&&D.enableAttributes(J,t),u.bind(),u.setVertexAttribPointers(J,t,b);for(const ae of p)ae.bind(),ae.setVertexAttribPointers(J,t,b);A&&(A.bind(),A.setVertexAttribPointers(J,t,b)),m&&m.bind(),L&&(L.bind(),L.setVertexAttribPointers(J,t,b)),D&&(D.bind(),D.setVertexAttribPointers(J,t,b)),K.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ka=(v,t,u,p,m)=>({u_matrix:v,u_texture:0,u_ele_delta:t,u_fog_matrix:u,u_fog_color:p?p.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?p.calculateFogBlendOpacity(m):0,u_horizon_color:p?p.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1});function po(v){const t=[];for(let u=0;u<v.length;u++){if(v[u]===null)continue;const p=v[u].split(" ");t.push(p.pop())}return t}class cl{constructor(t,u,p,m,b,A){const L=t.gl;this.program=L.createProgram();const D=po(u.staticAttributes),Z=p?p.getBinderAttributes():[],K=D.concat(Z),J=Bn.prelude.staticUniforms?po(Bn.prelude.staticUniforms):[],ae=u.staticUniforms?po(u.staticUniforms):[],_e=p?p.getBinderUniforms():[],ke=J.concat(ae).concat(_e),Ie=[];for(const nt of ke)Ie.indexOf(nt)<0&&Ie.push(nt);const Oe=p?p.defines():[];b&&Oe.push("#define OVERDRAW_INSPECTOR;"),A&&Oe.push("#define TERRAIN3D;");const Fe=Oe.concat(Bn.prelude.fragmentSource,u.fragmentSource).join(`
`),je=Oe.concat(Bn.prelude.vertexSource,u.vertexSource).join(`
`),Ce=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(Ce,Fe),L.compileShader(Ce),!L.getShaderParameter(Ce,L.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${L.getShaderInfoLog(Ce)}`);L.attachShader(this.program,Ce);const He=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(He,je),L.compileShader(He),!L.getShaderParameter(He,L.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${L.getShaderInfoLog(He)}`);L.attachShader(this.program,He),this.attributes={};const Ye={};this.numAttributes=K.length;for(let nt=0;nt<this.numAttributes;nt++)K[nt]&&(L.bindAttribLocation(this.program,nt,K[nt]),this.attributes[K[nt]]=nt);if(L.linkProgram(this.program),!L.getProgramParameter(this.program,L.LINK_STATUS))throw new Error(`Program failed to link: ${L.getProgramInfoLog(this.program)}`);L.deleteShader(He),L.deleteShader(Ce);for(let nt=0;nt<Ie.length;nt++){const vt=Ie[nt];if(vt&&!Ye[vt]){const Ct=L.getUniformLocation(this.program,vt);Ct&&(Ye[vt]=Ct)}}this.fixedUniforms=m(t,Ye),this.terrainUniforms=((nt,vt)=>({u_depth:new a.aH(nt,vt.u_depth),u_terrain:new a.aH(nt,vt.u_terrain),u_terrain_dim:new a.aI(nt,vt.u_terrain_dim),u_terrain_matrix:new a.aJ(nt,vt.u_terrain_matrix),u_terrain_unpack:new a.aK(nt,vt.u_terrain_unpack),u_terrain_exaggeration:new a.aI(nt,vt.u_terrain_exaggeration)}))(t,Ye),this.binderUniforms=p?p.getUniforms(t,Ye):[]}draw(t,u,p,m,b,A,L,D,Z,K,J,ae,_e,ke,Ie,Oe,Fe,je){const Ce=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(m),t.setColorMode(b),t.setCullFace(A),D){t.activeTexture.set(Ce.TEXTURE2),Ce.bindTexture(Ce.TEXTURE_2D,D.depthTexture),t.activeTexture.set(Ce.TEXTURE3),Ce.bindTexture(Ce.TEXTURE_2D,D.texture);for(const Ye in this.terrainUniforms)this.terrainUniforms[Ye].set(D[Ye])}for(const Ye in this.fixedUniforms)this.fixedUniforms[Ye].set(L[Ye]);Ie&&Ie.setUniforms(t,this.binderUniforms,_e,{zoom:ke});let He=0;switch(u){case Ce.LINES:He=2;break;case Ce.TRIANGLES:He=3;break;case Ce.LINE_STRIP:He=1}for(const Ye of ae.get()){const nt=Ye.vaos||(Ye.vaos={});(nt[Z]||(nt[Z]=new xa)).bind(t,this,K,Ie?Ie.getPaintVertexBuffers():[],J,Ye.vertexOffset,Oe,Fe,je),Ce.drawElements(u,Ye.primitiveLength*He,Ce.UNSIGNED_SHORT,Ye.primitiveOffset*He*2)}}}function jo(v,t,u){const p=1/Si(u,1,t.transform.tileZoom),m=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,t.transform.tileZoom)/m,A=b*(u.tileID.canonical.x+u.tileID.wrap*m),L=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[A>>16,L>>16],u_pixel_coord_lower:[65535&A,65535&L]}}const Ms=(v,t,u,p)=>{const m=t.style.light,b=m.properties.get("position"),A=[b.x,b.y,b.z],L=function(){var Z=new a.A(9);return a.A!=Float32Array&&(Z[1]=0,Z[2]=0,Z[3]=0,Z[5]=0,Z[6]=0,Z[7]=0),Z[0]=1,Z[4]=1,Z[8]=1,Z}();m.properties.get("anchor")==="viewport"&&function(Z,K){var J=Math.sin(K),ae=Math.cos(K);Z[0]=ae,Z[1]=J,Z[2]=0,Z[3]=-J,Z[4]=ae,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}(L,-t.transform.angle),function(Z,K,J){var ae=K[0],_e=K[1],ke=K[2];Z[0]=ae*J[0]+_e*J[3]+ke*J[6],Z[1]=ae*J[1]+_e*J[4]+ke*J[7],Z[2]=ae*J[2]+_e*J[5]+ke*J[8]}(A,A,L);const D=m.properties.get("color");return{u_matrix:v,u_lightpos:A,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+u,u_opacity:p}},Sa=(v,t,u,p,m,b,A)=>a.e(Ms(v,t,u,p),jo(b,t,A),{u_height_factor:-Math.pow(2,m.overscaledZ)/A.tileSize/8}),mo=v=>({u_matrix:v}),ul=(v,t,u,p)=>a.e(mo(v),jo(u,t,p)),au=(v,t)=>({u_matrix:v,u_world:t}),Kl=(v,t,u,p,m)=>a.e(ul(v,t,u,p),{u_world:m}),Jl=(v,t,u,p)=>{const m=v.transform;let b,A;if(p.paint.get("circle-pitch-alignment")==="map"){const L=Si(u,1,m.zoom);b=!0,A=[L,L]}else b=!1,A=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(t.posMatrix,u,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:A}},Ps=(v,t,u)=>({u_matrix:v,u_inv_matrix:t,u_camera_to_center_distance:u.cameraToCenterDistance,u_viewport_size:[u.width,u.height]}),go=(v,t,u=1)=>({u_matrix:v,u_color:t,u_overlay:0,u_overlay_scale:u}),qn=v=>({u_matrix:v}),tr=(v,t,u,p)=>({u_matrix:v,u_extrude_scale:Si(t,1,u),u_intensity:p}),_o=(v,t,u,p)=>{const m=a.H();a.aP(m,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:u,u_color_ramp:p,u_opacity:t.paint.get("heatmap-opacity")}};function ir(v,t){const u=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new a.Z(0,p/u).toLngLat().lat,new a.Z(0,(p+1)/u).toLngLat().lat]}const Ta=(v,t,u,p)=>{const m=v.transform;return{u_matrix:ec(v,t,u,p),u_ratio:1/Si(t,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Yl=(v,t,u,p,m)=>a.e(Ta(v,t,u,m),{u_image:0,u_image_height:p}),Ks=(v,t,u,p,m)=>{const b=v.transform,A=$l(t,b);return{u_matrix:ec(v,t,u,m),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Si(t,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Ql=(v,t,u,p,m,b)=>{const A=v.lineAtlas,L=$l(t,v.transform),D=u.layout.get("line-cap")==="round",Z=A.getDash(p.from,D),K=A.getDash(p.to,D),J=Z.width*m.fromScale,ae=K.width*m.toScale;return a.e(Ta(v,t,u,b),{u_patternscale_a:[L/J,-Z.height/2],u_patternscale_b:[L/ae,-K.height/2],u_sdfgamma:A.width/(256*Math.min(J,ae)*v.pixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:K.y,u_mix:m.t})};function $l(v,t){return 1/Si(v,1,t.tileZoom)}function ec(v,t,u,p){return v.translatePosMatrix(p?p.posMatrix:t.tileID.posMatrix,t,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const lu=(v,t,u,p,m)=>{return{u_matrix:v,u_tl_parent:t,u_scale_parent:u,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(A=m.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:cu(m.paint.get("raster-hue-rotate"))};var b,A};function cu(v){v*=Math.PI/180;const t=Math.sin(v),u=Math.cos(v);return[(2*u+1)/3,(-Math.sqrt(3)*t-u+1)/3,(Math.sqrt(3)*t-u+1)/3]}const tc=(v,t,u,p,m,b,A,L,D,Z,K,J,ae,_e)=>{const ke=A.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ke.cameraToCenterDistance,u_pitch:ke.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:ke.width/ke.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:L,u_label_plane_matrix:D,u_coord_matrix:Z,u_is_text:+J,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:ae,u_texture:0,u_translation:K,u_pitched_scale:_e}},Uo=(v,t,u,p,m,b,A,L,D,Z,K,J,ae,_e,ke)=>{const Ie=A.transform;return a.e(tc(v,t,u,p,m,b,A,L,D,Z,K,J,ae,ke),{u_gamma_scale:p?Math.cos(Ie._pitch)*Ie.cameraToCenterDistance:1,u_device_pixel_ratio:A.pixelRatio,u_is_halo:1})},Ca=(v,t,u,p,m,b,A,L,D,Z,K,J,ae,_e)=>a.e(Uo(v,t,u,p,m,b,A,L,D,Z,K,!0,J,!0,_e),{u_texsize_icon:ae,u_texture_icon:1}),Vo=(v,t,u)=>({u_matrix:v,u_opacity:t,u_color:u}),qo=(v,t,u,p,m,b)=>a.e(function(A,L,D,Z){const K=D.imageManager.getPattern(A.from.toString()),J=D.imageManager.getPattern(A.to.toString()),{width:ae,height:_e}=D.imageManager.getPixelSize(),ke=Math.pow(2,Z.tileID.overscaledZ),Ie=Z.tileSize*Math.pow(2,D.transform.tileZoom)/ke,Oe=Ie*(Z.tileID.canonical.x+Z.tileID.wrap*ke),Fe=Ie*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:K.tl,u_pattern_br_a:K.br,u_pattern_tl_b:J.tl,u_pattern_br_b:J.br,u_texsize:[ae,_e],u_mix:L.t,u_pattern_size_a:K.displaySize,u_pattern_size_b:J.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Si(Z,1,D.transform.tileZoom),u_pixel_coord_upper:[Oe>>16,Fe>>16],u_pixel_coord_lower:[65535&Oe,65535&Fe]}}(p,b,u,m),{u_matrix:v,u_opacity:t}),hl={fillExtrusion:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_lightpos:new a.aN(v,t.u_lightpos),u_lightintensity:new a.aI(v,t.u_lightintensity),u_lightcolor:new a.aN(v,t.u_lightcolor),u_vertical_gradient:new a.aI(v,t.u_vertical_gradient),u_opacity:new a.aI(v,t.u_opacity)}),fillExtrusionPattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_lightpos:new a.aN(v,t.u_lightpos),u_lightintensity:new a.aI(v,t.u_lightintensity),u_lightcolor:new a.aN(v,t.u_lightcolor),u_vertical_gradient:new a.aI(v,t.u_vertical_gradient),u_height_factor:new a.aI(v,t.u_height_factor),u_image:new a.aH(v,t.u_image),u_texsize:new a.aO(v,t.u_texsize),u_pixel_coord_upper:new a.aO(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,t.u_pixel_coord_lower),u_scale:new a.aN(v,t.u_scale),u_fade:new a.aI(v,t.u_fade),u_opacity:new a.aI(v,t.u_opacity)}),fill:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix)}),fillPattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_image:new a.aH(v,t.u_image),u_texsize:new a.aO(v,t.u_texsize),u_pixel_coord_upper:new a.aO(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,t.u_pixel_coord_lower),u_scale:new a.aN(v,t.u_scale),u_fade:new a.aI(v,t.u_fade)}),fillOutline:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_world:new a.aO(v,t.u_world)}),fillOutlinePattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_world:new a.aO(v,t.u_world),u_image:new a.aH(v,t.u_image),u_texsize:new a.aO(v,t.u_texsize),u_pixel_coord_upper:new a.aO(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,t.u_pixel_coord_lower),u_scale:new a.aN(v,t.u_scale),u_fade:new a.aI(v,t.u_fade)}),circle:(v,t)=>({u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_scale_with_map:new a.aH(v,t.u_scale_with_map),u_pitch_with_map:new a.aH(v,t.u_pitch_with_map),u_extrude_scale:new a.aO(v,t.u_extrude_scale),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_matrix:new a.aJ(v,t.u_matrix)}),collisionBox:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_pixel_extrude_scale:new a.aO(v,t.u_pixel_extrude_scale)}),collisionCircle:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_inv_matrix:new a.aJ(v,t.u_inv_matrix),u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_viewport_size:new a.aO(v,t.u_viewport_size)}),debug:(v,t)=>({u_color:new a.aL(v,t.u_color),u_matrix:new a.aJ(v,t.u_matrix),u_overlay:new a.aH(v,t.u_overlay),u_overlay_scale:new a.aI(v,t.u_overlay_scale)}),clippingMask:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix)}),heatmap:(v,t)=>({u_extrude_scale:new a.aI(v,t.u_extrude_scale),u_intensity:new a.aI(v,t.u_intensity),u_matrix:new a.aJ(v,t.u_matrix)}),heatmapTexture:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_world:new a.aO(v,t.u_world),u_image:new a.aH(v,t.u_image),u_color_ramp:new a.aH(v,t.u_color_ramp),u_opacity:new a.aI(v,t.u_opacity)}),hillshade:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_image:new a.aH(v,t.u_image),u_latrange:new a.aO(v,t.u_latrange),u_light:new a.aO(v,t.u_light),u_shadow:new a.aL(v,t.u_shadow),u_highlight:new a.aL(v,t.u_highlight),u_accent:new a.aL(v,t.u_accent)}),hillshadePrepare:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_image:new a.aH(v,t.u_image),u_dimension:new a.aO(v,t.u_dimension),u_zoom:new a.aI(v,t.u_zoom),u_unpack:new a.aK(v,t.u_unpack)}),line:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_ratio:new a.aI(v,t.u_ratio),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,t.u_units_to_pixels)}),lineGradient:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_ratio:new a.aI(v,t.u_ratio),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,t.u_units_to_pixels),u_image:new a.aH(v,t.u_image),u_image_height:new a.aI(v,t.u_image_height)}),linePattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_texsize:new a.aO(v,t.u_texsize),u_ratio:new a.aI(v,t.u_ratio),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_image:new a.aH(v,t.u_image),u_units_to_pixels:new a.aO(v,t.u_units_to_pixels),u_scale:new a.aN(v,t.u_scale),u_fade:new a.aI(v,t.u_fade)}),lineSDF:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_ratio:new a.aI(v,t.u_ratio),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,t.u_units_to_pixels),u_patternscale_a:new a.aO(v,t.u_patternscale_a),u_patternscale_b:new a.aO(v,t.u_patternscale_b),u_sdfgamma:new a.aI(v,t.u_sdfgamma),u_image:new a.aH(v,t.u_image),u_tex_y_a:new a.aI(v,t.u_tex_y_a),u_tex_y_b:new a.aI(v,t.u_tex_y_b),u_mix:new a.aI(v,t.u_mix)}),raster:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_tl_parent:new a.aO(v,t.u_tl_parent),u_scale_parent:new a.aI(v,t.u_scale_parent),u_buffer_scale:new a.aI(v,t.u_buffer_scale),u_fade_t:new a.aI(v,t.u_fade_t),u_opacity:new a.aI(v,t.u_opacity),u_image0:new a.aH(v,t.u_image0),u_image1:new a.aH(v,t.u_image1),u_brightness_low:new a.aI(v,t.u_brightness_low),u_brightness_high:new a.aI(v,t.u_brightness_high),u_saturation_factor:new a.aI(v,t.u_saturation_factor),u_contrast_factor:new a.aI(v,t.u_contrast_factor),u_spin_weights:new a.aN(v,t.u_spin_weights)}),symbolIcon:(v,t)=>({u_is_size_zoom_constant:new a.aH(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,t.u_is_size_feature_constant),u_size_t:new a.aI(v,t.u_size_t),u_size:new a.aI(v,t.u_size),u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_pitch:new a.aI(v,t.u_pitch),u_rotate_symbol:new a.aH(v,t.u_rotate_symbol),u_aspect_ratio:new a.aI(v,t.u_aspect_ratio),u_fade_change:new a.aI(v,t.u_fade_change),u_matrix:new a.aJ(v,t.u_matrix),u_label_plane_matrix:new a.aJ(v,t.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,t.u_coord_matrix),u_is_text:new a.aH(v,t.u_is_text),u_pitch_with_map:new a.aH(v,t.u_pitch_with_map),u_is_along_line:new a.aH(v,t.u_is_along_line),u_is_variable_anchor:new a.aH(v,t.u_is_variable_anchor),u_texsize:new a.aO(v,t.u_texsize),u_texture:new a.aH(v,t.u_texture),u_translation:new a.aO(v,t.u_translation),u_pitched_scale:new a.aI(v,t.u_pitched_scale)}),symbolSDF:(v,t)=>({u_is_size_zoom_constant:new a.aH(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,t.u_is_size_feature_constant),u_size_t:new a.aI(v,t.u_size_t),u_size:new a.aI(v,t.u_size),u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_pitch:new a.aI(v,t.u_pitch),u_rotate_symbol:new a.aH(v,t.u_rotate_symbol),u_aspect_ratio:new a.aI(v,t.u_aspect_ratio),u_fade_change:new a.aI(v,t.u_fade_change),u_matrix:new a.aJ(v,t.u_matrix),u_label_plane_matrix:new a.aJ(v,t.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,t.u_coord_matrix),u_is_text:new a.aH(v,t.u_is_text),u_pitch_with_map:new a.aH(v,t.u_pitch_with_map),u_is_along_line:new a.aH(v,t.u_is_along_line),u_is_variable_anchor:new a.aH(v,t.u_is_variable_anchor),u_texsize:new a.aO(v,t.u_texsize),u_texture:new a.aH(v,t.u_texture),u_gamma_scale:new a.aI(v,t.u_gamma_scale),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_is_halo:new a.aH(v,t.u_is_halo),u_translation:new a.aO(v,t.u_translation),u_pitched_scale:new a.aI(v,t.u_pitched_scale)}),symbolTextAndIcon:(v,t)=>({u_is_size_zoom_constant:new a.aH(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,t.u_is_size_feature_constant),u_size_t:new a.aI(v,t.u_size_t),u_size:new a.aI(v,t.u_size),u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_pitch:new a.aI(v,t.u_pitch),u_rotate_symbol:new a.aH(v,t.u_rotate_symbol),u_aspect_ratio:new a.aI(v,t.u_aspect_ratio),u_fade_change:new a.aI(v,t.u_fade_change),u_matrix:new a.aJ(v,t.u_matrix),u_label_plane_matrix:new a.aJ(v,t.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,t.u_coord_matrix),u_is_text:new a.aH(v,t.u_is_text),u_pitch_with_map:new a.aH(v,t.u_pitch_with_map),u_is_along_line:new a.aH(v,t.u_is_along_line),u_is_variable_anchor:new a.aH(v,t.u_is_variable_anchor),u_texsize:new a.aO(v,t.u_texsize),u_texsize_icon:new a.aO(v,t.u_texsize_icon),u_texture:new a.aH(v,t.u_texture),u_texture_icon:new a.aH(v,t.u_texture_icon),u_gamma_scale:new a.aI(v,t.u_gamma_scale),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_is_halo:new a.aH(v,t.u_is_halo),u_translation:new a.aO(v,t.u_translation),u_pitched_scale:new a.aI(v,t.u_pitched_scale)}),background:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_opacity:new a.aI(v,t.u_opacity),u_color:new a.aL(v,t.u_color)}),backgroundPattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_opacity:new a.aI(v,t.u_opacity),u_image:new a.aH(v,t.u_image),u_pattern_tl_a:new a.aO(v,t.u_pattern_tl_a),u_pattern_br_a:new a.aO(v,t.u_pattern_br_a),u_pattern_tl_b:new a.aO(v,t.u_pattern_tl_b),u_pattern_br_b:new a.aO(v,t.u_pattern_br_b),u_texsize:new a.aO(v,t.u_texsize),u_mix:new a.aI(v,t.u_mix),u_pattern_size_a:new a.aO(v,t.u_pattern_size_a),u_pattern_size_b:new a.aO(v,t.u_pattern_size_b),u_scale_a:new a.aI(v,t.u_scale_a),u_scale_b:new a.aI(v,t.u_scale_b),u_pixel_coord_upper:new a.aO(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(v,t.u_tile_units_to_pixels)}),terrain:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_texture:new a.aH(v,t.u_texture),u_ele_delta:new a.aI(v,t.u_ele_delta),u_fog_matrix:new a.aJ(v,t.u_fog_matrix),u_fog_color:new a.aL(v,t.u_fog_color),u_fog_ground_blend:new a.aI(v,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(v,t.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(v,t.u_horizon_color),u_horizon_fog_blend:new a.aI(v,t.u_horizon_fog_blend)}),terrainDepth:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_ele_delta:new a.aI(v,t.u_ele_delta)}),terrainCoords:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_texture:new a.aH(v,t.u_texture),u_terrain_coords_id:new a.aI(v,t.u_terrain_coords_id),u_ele_delta:new a.aI(v,t.u_ele_delta)}),sky:(v,t)=>({u_sky_color:new a.aL(v,t.u_sky_color),u_horizon_color:new a.aL(v,t.u_horizon_color),u_horizon:new a.aI(v,t.u_horizon),u_sky_horizon_blend:new a.aI(v,t.u_sky_horizon_blend)})};class ts{constructor(t,u,p){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Js={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zr{constructor(t,u,p,m){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=m,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,u){for(let p=0;p<this.attributes.length;p++){const m=u.attributes[this.attributes[p].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,u,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],A=u.attributes[b.name];A!==void 0&&t.vertexAttribPointer(A,b.components,t[Js[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ls=new WeakMap;function zs(v){var t;if(Ls.has(v))return Ls.get(v);{const u=(t=v.getParameter(v.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ls.set(v,u),u}}class Xi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zo extends Xi{getDefault(){return a.aM.transparent}set(t){const u=this.current;(t.r!==u.r||t.g!==u.g||t.b!==u.b||t.a!==u.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ic extends Xi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ys extends Xi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class uu extends Xi{getDefault(){return[!0,!0,!0,!0]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||t[3]!==u[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class nc extends Xi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hu extends Xi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class fl extends Xi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const u=this.current;(t.func!==u.func||t.ref!==u.ref||t.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ea extends Xi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class rc extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=t,this.dirty=!1}}class sc extends Xi{getDefault(){return[0,1]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class oc extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=t,this.dirty=!1}}class ac extends Xi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Qs extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.BLEND):u.disable(u.BLEND),this.current=t,this.dirty=!1}}class is extends Xi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class lc extends Xi{getDefault(){return a.aM.transparent}set(t){const u=this.current;(t.r!==u.r||t.g!==u.g||t.b!==u.b||t.a!==u.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cc extends Xi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Wo extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=t,this.dirty=!1}}class fu extends Xi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ia extends Xi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class du extends Xi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class pu extends Xi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class uc extends Xi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||t[3]!==u[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hc extends Xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Aa extends Xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yo extends Xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fc extends Xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Go extends Xi{getDefault(){return null}set(t){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ns extends Xi{getDefault(){return null}set(t){var u;if(t===this.current&&!this.dirty)return;const p=this.gl;zs(p)?p.bindVertexArray(t):(u=p.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class $s extends Xi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ho extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Xo extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ma extends Xi{constructor(t,u){super(t),this.context=t,this.parent=u}getDefault(){return null}}class dl extends Ma{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class eo extends Ma{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ms extends Ma{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class mu{constructor(t,u,p,m,b){this.context=t,this.width=u,this.height=p;const A=t.gl,L=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new dl(t,L),m)this.depthAttachment=b?new ms(t,L):new eo(t,L);else if(b)throw new Error("Stencil cannot be set without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,u=this.colorAttachment.get();if(u&&t.deleteTexture(u),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class Tn{constructor(t,u,p){this.blendFunction=t,this.blendColor=u,this.mask=p}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,a.aM.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,a.aM.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],a.aM.transparent,[!0,!0,!0,!0]);class gu{constructor(t){var u,p;if(this.gl=t,this.clearColor=new Zo(this),this.clearDepth=new ic(this),this.clearStencil=new Ys(this),this.colorMask=new uu(this),this.depthMask=new nc(this),this.stencilMask=new hu(this),this.stencilFunc=new fl(this),this.stencilOp=new Ea(this),this.stencilTest=new rc(this),this.depthRange=new sc(this),this.depthTest=new oc(this),this.depthFunc=new ac(this),this.blend=new Qs(this),this.blendFunc=new is(this),this.blendColor=new lc(this),this.blendEquation=new cc(this),this.cullFace=new Wo(this),this.cullFaceSide=new fu(this),this.frontFace=new Ia(this),this.program=new du(this),this.activeTexture=new pu(this),this.viewport=new uc(this),this.bindFramebuffer=new hc(this),this.bindRenderbuffer=new Aa(this),this.bindTexture=new yo(this),this.bindVertexBuffer=new fc(this),this.bindElementBuffer=new Go(this),this.bindVertexArray=new ns(this),this.pixelStoreUnpack=new $s(this),this.pixelStoreUnpackPremultiplyAlpha=new Ho(this),this.pixelStoreUnpackFlipY=new Xo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),zs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const m=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=t.RGBA16F)!==null&&u!==void 0?u:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=t.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const m=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,u){return new ts(this,t,u)}createVertexBuffer(t,u,p){return new Zr(this,t,u,p)}createRenderbuffer(t,u,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,t,u,p),this.bindRenderbuffer.set(null),b}createFramebuffer(t,u,p,m){return new mu(this,t,u,p,m)}clear({color:t,depth:u,stencil:p}){const m=this.gl;let b=0;t&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.aE(t.blendFunction,Tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return zs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var u;return zs(this.gl)?this.gl.deleteVertexArray(t):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Li{constructor(t,u,p){this.func=t,this.mask=u,this.range=p}}Li.ReadOnly=!1,Li.ReadWrite=!0,Li.disabled=new Li(519,Li.ReadOnly,[0,1]);const to=7680;class $i{constructor(t,u,p,m,b,A){this.test=t,this.ref=u,this.mask=p,this.fail=m,this.depthFail=b,this.pass=A}}$i.disabled=new $i({func:519,mask:0},0,0,to,to,to);class en{constructor(t,u,p){this.enable=t,this.mode=u,this.frontFace=p}}let Os;function Ko(v,t,u,p,m){const b=v.context,A=b.gl,L=v.useProgram("collisionBox"),D=[];let Z=0,K=0;for(let Fe=0;Fe<p.length;Fe++){const je=p[Fe],Ce=t.getTile(je).getBucket(u);if(!Ce)continue;const He=m?Ce.textCollisionBox:Ce.iconCollisionBox,Ye=Ce.collisionCircleArray;if(Ye.length>0){const nt=a.H();a.aQ(nt,Ce.placementInvProjMatrix,v.transform.glCoordMatrix),a.aQ(nt,nt,Ce.placementViewportMatrix),D.push({circleArray:Ye,circleOffset:K,transform:je.posMatrix,invTransform:nt,coord:je}),Z+=Ye.length/4,K=Z}He&&L.draw(b,A.LINES,Li.disabled,$i.disabled,v.colorModeForRenderPass(),en.disabled,{u_matrix:je.posMatrix,u_pixel_extrude_scale:[1/(J=v.transform).width,1/J.height]},v.style.map.terrain&&v.style.map.terrain.getTerrainData(je),u.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,v.transform.zoom,null,null,He.collisionVertexBuffer)}var J;if(!m||!D.length)return;const ae=v.useProgram("collisionCircle"),_e=new a.aR;_e.resize(4*Z),_e._trim();let ke=0;for(const Fe of D)for(let je=0;je<Fe.circleArray.length/4;je++){const Ce=4*je,He=Fe.circleArray[Ce+0],Ye=Fe.circleArray[Ce+1],nt=Fe.circleArray[Ce+2],vt=Fe.circleArray[Ce+3];_e.emplace(ke++,He,Ye,nt,vt,0),_e.emplace(ke++,He,Ye,nt,vt,1),_e.emplace(ke++,He,Ye,nt,vt,2),_e.emplace(ke++,He,Ye,nt,vt,3)}(!Os||Os.length<2*Z)&&(Os=function(Fe){const je=2*Fe,Ce=new a.aT;Ce.resize(je),Ce._trim();for(let He=0;He<je;He++){const Ye=6*He;Ce.uint16[Ye+0]=4*He+0,Ce.uint16[Ye+1]=4*He+1,Ce.uint16[Ye+2]=4*He+2,Ce.uint16[Ye+3]=4*He+2,Ce.uint16[Ye+4]=4*He+3,Ce.uint16[Ye+5]=4*He+0}return Ce}(Z));const Ie=b.createIndexBuffer(Os,!0),Oe=b.createVertexBuffer(_e,a.aS.members,!0);for(const Fe of D){const je=Ps(Fe.transform,Fe.invTransform,v.transform);ae.draw(b,A.TRIANGLES,Li.disabled,$i.disabled,v.colorModeForRenderPass(),en.disabled,je,v.style.map.terrain&&v.style.map.terrain.getTerrainData(Fe.coord),u.id,Oe,Ie,a.a0.simpleSegment(0,2*Fe.circleOffset,Fe.circleArray.length,Fe.circleArray.length/2),null,v.transform.zoom,null,null,null)}Oe.destroy(),Ie.destroy()}en.disabled=new en(!1,1029,2305),en.backCCW=new en(!0,1029,2305);const rs=a.an(new Float32Array(16));function Jo(v,t,u,p,m,b){const{horizontalAlign:A,verticalAlign:L}=a.au(v);return new a.P((-(A-.5)*t/m+p[0])*b,(-(L-.5)*u/m+p[1])*b)}function Ds(v,t,u,p,m,b){const A=t.tileAnchorPoint.add(new a.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let L=p.mult(b);u||(L=L.rotate(-m));const D=A.add(L);return Le(D.x,D.y,t.labelPlaneMatrix,t.getElevation).point}if(u){const L=ut(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(v),D=Math.atan(L.y/L.x)+(L.x<0?Math.PI:0);return v.add(p.rotate(D))}return v.add(p)}function bo(v,t,u,p,m,b,A,L,D,Z,K,J,ae,_e){const ke=v.text.placedSymbolArray,Ie=v.text.dynamicLayoutVertexArray,Oe=v.icon.dynamicLayoutVertexArray,Fe={};Ie.clear();for(let je=0;je<ke.length;je++){const Ce=ke.get(je),He=Ce.hidden||!Ce.crossTileID||v.allowVerticalPlacement&&!Ce.placedOrientation?null:p[Ce.crossTileID];if(He){const Ye=new a.P(Ce.anchorX,Ce.anchorY),nt={getElevation:_e,width:m.width,height:m.height,labelPlaneMatrix:b,pitchWithMap:u,projection:K,tileAnchorPoint:Ye,translation:J,unwrappedTileID:ae},vt=u?Le(Ye.x,Ye.y,A,_e):ut(Ye.x,Ye.y,nt),Ct=ie(m.cameraToCenterDistance,vt.signedDistanceFromCamera);let Ft=a.ai(v.textSizeData,D,Ce)*Ct/a.ap;u&&(Ft*=v.tilePixelRatio/L);const{width:Vt,height:Lt,anchor:Mt,textOffset:Jt,textBoxScale:xi}=He,zt=Jo(Mt,Vt,Lt,Jt,xi,Ft),Nt=K.getPitchedTextCorrection(m,Ye.add(new a.P(J[0],J[1])),ae),bi=Ds(vt.point,nt,t,zt,m.angle,Nt),gn=v.allowVerticalPlacement&&Ce.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Ai=0;Ai<Ce.numGlyphs;Ai++)a.aj(Ie,bi,gn);Z&&Ce.associatedIconIndex>=0&&(Fe[Ce.associatedIconIndex]={shiftedAnchor:bi,angle:gn})}else ri(Ce.numGlyphs,Ie)}if(Z){Oe.clear();const je=v.icon.placedSymbolArray;for(let Ce=0;Ce<je.length;Ce++){const He=je.get(Ce);if(He.hidden)ri(He.numGlyphs,Oe);else{const Ye=Fe[Ce];if(Ye)for(let nt=0;nt<He.numGlyphs;nt++)a.aj(Oe,Ye.shiftedAnchor,Ye.angle);else ri(He.numGlyphs,Oe)}}v.icon.dynamicLayoutVertexBuffer.updateData(Oe)}v.text.dynamicLayoutVertexBuffer.updateData(Ie)}function Pr(v,t,u){return u.iconsInText&&t?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function pl(v,t,u,p,m,b,A,L,D,Z,K,J){const ae=v.context,_e=ae.gl,ke=v.transform,Ie=Rn(),Oe=L==="map",Fe=D==="map",je=L!=="viewport"&&u.layout.get("symbol-placement")!=="point",Ce=Oe&&!Fe&&!je,He=!Fe&&je,Ye=!u.layout.get("symbol-sort-key").isConstant();let nt=!1;const vt=v.depthModeForSublayer(0,Li.ReadOnly),Ct=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ft=[],Vt=Ie.getCircleRadiusCorrection(ke);for(const Lt of p){const Mt=t.getTile(Lt),Jt=Mt.getBucket(u);if(!Jt)continue;const xi=m?Jt.text:Jt.icon;if(!xi||!xi.segments.get().length||!xi.hasVisibleVertices)continue;const zt=xi.programConfigurations.get(u.id),Nt=m||Jt.sdfIcons,bi=m?Jt.textSizeData:Jt.iconSizeData,gn=Fe||ke.pitch!==0,Ai=v.useProgram(Pr(Nt,m,Jt),zt),Vi=a.ag(bi,ke.zoom),_n=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Lt);let lr,ys,yn,Or,kr=[0,0],cr=null;if(m)ys=Mt.glyphAtlasTexture,yn=_e.LINEAR,lr=Mt.glyphAtlasTexture.size,Jt.iconsInText&&(kr=Mt.imageAtlasTexture.size,cr=Mt.imageAtlasTexture,Or=gn||v.options.rotating||v.options.zooming||bi.kind==="composite"||bi.kind==="camera"?_e.LINEAR:_e.NEAREST);else{const Zi=u.layout.get("icon-size").constantOr(0)!==1||Jt.iconsNeedLinear;ys=Mt.imageAtlasTexture,yn=Nt||v.options.rotating||v.options.zooming||Zi||gn?_e.LINEAR:_e.NEAREST,lr=Mt.imageAtlasTexture.size}const Sr=Si(Mt,1,v.transform.zoom),Ns=He?Lt.posMatrix:rs,qa=Ar(Ns,Fe,Oe,v.transform,Sr),vc=Mr(Ns,Fe,Oe,v.transform,Sr),Za=Mr(Lt.posMatrix,Fe,Oe,v.transform,Sr),cs=Ie.translatePosition(v.transform,Mt,b,A),wc=Ct&&Jt.hasTextData(),Mu=u.layout.get("icon-text-fit")!=="none"&&wc&&Jt.hasIconData();if(je){const Zi=v.style.map.terrain?(Wa,Ga)=>v.style.map.terrain.getElevation(Lt,Wa,Ga):null,sa=u.layout.get("text-rotation-alignment")==="map";me(Jt,Lt.posMatrix,v,m,qa,Za,Fe,Z,sa,Ie,Lt.toUnwrapped(),ke.width,ke.height,cs,Zi)}const us=Lt.posMatrix,hs=m&&Ct||Mu,Io=je||hs?rs:qa,bs=vc,nr=Nt&&u.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ur;ur=Nt?Jt.iconsInText?Ca(bi.kind,Vi,Ce,Fe,je,hs,v,us,Io,bs,cs,lr,kr,Vt):Uo(bi.kind,Vi,Ce,Fe,je,hs,v,us,Io,bs,cs,m,lr,!0,Vt):tc(bi.kind,Vi,Ce,Fe,je,hs,v,us,Io,bs,cs,m,lr,Vt);const Xr={program:Ai,buffers:xi,uniformValues:ur,atlasTexture:ys,atlasTextureIcon:cr,atlasInterpolation:yn,atlasInterpolationIcon:Or,isSDF:Nt,hasHalo:nr};if(Ye&&Jt.canOverlap){nt=!0;const Zi=xi.segments.get();for(const sa of Zi)Ft.push({segments:new a.a0([sa]),sortKey:sa.sortKey,state:Xr,terrainData:_n})}else Ft.push({segments:xi.segments,sortKey:0,state:Xr,terrainData:_n})}nt&&Ft.sort((Lt,Mt)=>Lt.sortKey-Mt.sortKey);for(const Lt of Ft){const Mt=Lt.state;if(ae.activeTexture.set(_e.TEXTURE0),Mt.atlasTexture.bind(Mt.atlasInterpolation,_e.CLAMP_TO_EDGE),Mt.atlasTextureIcon&&(ae.activeTexture.set(_e.TEXTURE1),Mt.atlasTextureIcon&&Mt.atlasTextureIcon.bind(Mt.atlasInterpolationIcon,_e.CLAMP_TO_EDGE)),Mt.isSDF){const Jt=Mt.uniformValues;Mt.hasHalo&&(Jt.u_is_halo=1,io(Mt.buffers,Lt.segments,u,v,Mt.program,vt,K,J,Jt,Lt.terrainData)),Jt.u_is_halo=0}io(Mt.buffers,Lt.segments,u,v,Mt.program,vt,K,J,Mt.uniformValues,Lt.terrainData)}}function io(v,t,u,p,m,b,A,L,D,Z){const K=p.context;m.draw(K,K.gl.TRIANGLES,b,A,L,en.disabled,D,Z,u.id,v.layoutVertexBuffer,v.indexBuffer,t,u.paint,p.transform.zoom,v.programConfigurations.get(u.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function gs(v,t,u,p){const m=v.context,b=m.gl,A=$i.disabled,L=new Tn([b.ONE,b.ONE],a.aM.transparent,[!0,!0,!0,!0]),D=t.getBucket(u);if(!D)return;const Z=p.key;let K=u.heatmapFbos.get(Z);K||(K=Yo(m,t.tileSize,t.tileSize),u.heatmapFbos.set(Z,K)),m.bindFramebuffer.set(K.framebuffer),m.viewport.set([0,0,t.tileSize,t.tileSize]),m.clear({color:a.aM.transparent});const J=D.programConfigurations.get(u.id),ae=v.useProgram("heatmap",J),_e=v.style.map.terrain.getTerrainData(p);ae.draw(m,b.TRIANGLES,Li.disabled,A,L,en.disabled,tr(p.posMatrix,t,v.transform.zoom,u.paint.get("heatmap-intensity")),_e,u.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,u.paint,v.transform.zoom,J)}function no(v,t,u){const p=v.context,m=p.gl;p.setColorMode(v.colorModeForRenderPass());const b=Qo(p,t),A=u.key,L=t.heatmapFbos.get(A);L&&(p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,L.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),b.bind(m.LINEAR,m.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(p,m.TRIANGLES,Li.disabled,$i.disabled,v.colorModeForRenderPass(),en.disabled,_o(v,t,0,1),null,t.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,t.paint,v.transform.zoom),L.destroy(),t.heatmapFbos.delete(A))}function Yo(v,t,u){var p,m;const b=v.gl,A=b.createTexture();b.bindTexture(b.TEXTURE_2D,A),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const L=(p=v.HALF_FLOAT)!==null&&p!==void 0?p:b.UNSIGNED_BYTE,D=(m=v.RGBA16F)!==null&&m!==void 0?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,D,t,u,0,b.RGBA,L,null);const Z=v.createFramebuffer(t,u,!1,!1);return Z.colorAttachment.set(A),Z}function Qo(v,t){return t.colorRampTexture||(t.colorRampTexture=new O(v,t.colorRamp,v.gl.RGBA)),t.colorRampTexture}function vo(v,t,u,p,m){if(!u||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let A=b[u.to.toString()],L=b[u.from.toString()];if(!A&&L&&(A=L),!L&&A&&(L=A),!A||!L){const D=m.getPaintProperty(t);A=b[D],L=b[D]}A&&L&&v.setConstantPatternPositions(A,L)}function $o(v,t,u,p,m,b,A){const L=v.context.gl,D="fill-pattern",Z=u.paint.get(D),K=Z&&Z.constantOr(1),J=u.getCrossfadeParameters();let ae,_e,ke,Ie,Oe;A?(_e=K&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ae=L.LINES):(_e=K?"fillPattern":"fill",ae=L.TRIANGLES);const Fe=Z.constantOr(null);for(const je of p){const Ce=t.getTile(je);if(K&&!Ce.patternsLoaded())continue;const He=Ce.getBucket(u);if(!He)continue;const Ye=He.programConfigurations.get(u.id),nt=v.useProgram(_e,Ye),vt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(je);K&&(v.context.activeTexture.set(L.TEXTURE0),Ce.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ye.updatePaintBuffers(J)),vo(Ye,D,Fe,Ce,u);const Ct=vt?je:null,Ft=v.translatePosMatrix(Ct?Ct.posMatrix:je.posMatrix,Ce,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(A){Ie=He.indexBuffer2,Oe=He.segments2;const Vt=[L.drawingBufferWidth,L.drawingBufferHeight];ke=_e==="fillOutlinePattern"&&K?Kl(Ft,v,J,Ce,Vt):au(Ft,Vt)}else Ie=He.indexBuffer,Oe=He.segments,ke=K?ul(Ft,v,J,Ce):mo(Ft);nt.draw(v.context,ae,m,v.stencilModeForClipping(je),b,en.disabled,ke,vt,u.id,He.layoutVertexBuffer,Ie,Oe,u.paint,v.transform.zoom,Ye)}}function Pa(v,t,u,p,m,b,A){const L=v.context,D=L.gl,Z="fill-extrusion-pattern",K=u.paint.get(Z),J=K.constantOr(1),ae=u.getCrossfadeParameters(),_e=u.paint.get("fill-extrusion-opacity"),ke=K.constantOr(null);for(const Ie of p){const Oe=t.getTile(Ie),Fe=Oe.getBucket(u);if(!Fe)continue;const je=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ie),Ce=Fe.programConfigurations.get(u.id),He=v.useProgram(J?"fillExtrusionPattern":"fillExtrusion",Ce);J&&(v.context.activeTexture.set(D.TEXTURE0),Oe.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ce.updatePaintBuffers(ae)),vo(Ce,Z,ke,Oe,u);const Ye=v.translatePosMatrix(Ie.posMatrix,Oe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),nt=u.paint.get("fill-extrusion-vertical-gradient"),vt=J?Sa(Ye,v,nt,_e,Ie,ae,Oe):Ms(Ye,v,nt,_e);He.draw(L,L.gl.TRIANGLES,m,b,A,en.backCCW,vt,je,u.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,u.paint,v.transform.zoom,Ce,v.style.map.terrain&&Fe.centroidVertexBuffer)}}function wo(v,t,u,p,m,b,A){const L=v.context,D=L.gl,Z=u.fbo;if(!Z)return;const K=v.useProgram("hillshade"),J=v.style.map.terrain&&v.style.map.terrain.getTerrainData(t);L.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,Z.colorAttachment.get()),K.draw(L,D.TRIANGLES,m,b,A,en.disabled,((ae,_e,ke,Ie)=>{const Oe=ke.paint.get("hillshade-shadow-color"),Fe=ke.paint.get("hillshade-highlight-color"),je=ke.paint.get("hillshade-accent-color");let Ce=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ce-=ae.transform.angle);const He=!ae.options.moving;return{u_matrix:Ie?Ie.posMatrix:ae.transform.calculatePosMatrix(_e.tileID.toUnwrapped(),He),u_image:0,u_latrange:ir(0,_e.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Ce],u_shadow:Oe,u_highlight:Fe,u_accent:je}})(v,u,p,J?t:null),J,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function xo(v,t,u,p,m,b){const A=v.context,L=A.gl,D=t.dem;if(D&&D.data){const Z=D.dim,K=D.stride,J=D.getPixels();if(A.activeTexture.set(L.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||v.getTileTexture(K),t.demTexture){const _e=t.demTexture;_e.update(J,{premultiply:!1}),_e.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else t.demTexture=new O(A,J,L.RGBA,{premultiply:!1}),t.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);A.activeTexture.set(L.TEXTURE0);let ae=t.fbo;if(!ae){const _e=new O(A,{width:Z,height:Z,data:null},L.RGBA);_e.bind(L.LINEAR,L.CLAMP_TO_EDGE),ae=t.fbo=A.createFramebuffer(Z,Z,!0,!1),ae.colorAttachment.set(_e.texture)}A.bindFramebuffer.set(ae.framebuffer),A.viewport.set([0,0,Z,Z]),v.useProgram("hillshadePrepare").draw(A,L.TRIANGLES,p,m,b,en.disabled,((_e,ke)=>{const Ie=ke.stride,Oe=a.H();return a.aP(Oe,0,a.X,-a.X,0,0,1),a.J(Oe,Oe,[0,-a.X,0]),{u_matrix:Oe,u_image:1,u_dimension:[Ie,Ie],u_zoom:_e.overscaledZ,u_unpack:ke.getUnpackVector()}})(t.tileID,D),null,u.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function ml(v,t,u,p,m,b){const A=p.paint.get("raster-fade-duration");if(!b&&A>0){const L=y.now(),D=(L-v.timeAdded)/A,Z=t?(L-t.timeAdded)/A:-1,K=u.getSource(),J=m.coveringZoomLevel({tileSize:K.tileSize,roundZoom:K.roundZoom}),ae=!t||Math.abs(t.tileID.overscaledZ-J)>Math.abs(v.tileID.overscaledZ-J),_e=ae&&v.refreshedUponExpiration?1:a.ac(ae?D:1-Z,0,1);return v.refreshedUponExpiration&&D>=1&&(v.refreshedUponExpiration=!1),t?{opacity:1,mix:1-_e}:{opacity:_e,mix:0}}return{opacity:1,mix:0}}const gl=new a.aM(1,0,0,1),Wi=new a.aM(0,1,0,1),ko=new a.aM(0,0,1,1),dc=new a.aM(1,0,1,1),Fs=new a.aM(0,1,1,1);function ro(v,t,u,p){ea(v,0,t+u/2,v.transform.width,u,p)}function La(v,t,u,p){ea(v,t-u/2,0,u,v.transform.height,p)}function ea(v,t,u,p,m,b){const A=v.context,L=A.gl;L.enable(L.SCISSOR_TEST),L.scissor(t*v.pixelRatio,u*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),A.clear({color:b}),L.disable(L.SCISSOR_TEST)}function za(v,t,u){const p=v.context,m=p.gl,b=u.posMatrix,A=v.useProgram("debug"),L=Li.disabled,D=$i.disabled,Z=v.colorModeForRenderPass(),K="$debug",J=v.style.map.terrain&&v.style.map.terrain.getTerrainData(u);p.activeTexture.set(m.TEXTURE0);const ae=t.getTileByID(u.key).latestRawTileData,_e=Math.floor((ae&&ae.byteLength||0)/1024),ke=t.getTile(u).tileSize,Ie=512/Math.min(ke,512)*(u.overscaledZ/v.transform.zoom)*.5;let Oe=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Oe+=` => ${u.overscaledZ}`),function(Fe,je){Fe.initDebugOverlayCanvas();const Ce=Fe.debugOverlayCanvas,He=Fe.context.gl,Ye=Fe.debugOverlayCanvas.getContext("2d");Ye.clearRect(0,0,Ce.width,Ce.height),Ye.shadowColor="white",Ye.shadowBlur=2,Ye.lineWidth=1.5,Ye.strokeStyle="white",Ye.textBaseline="top",Ye.font="bold 36px Open Sans, sans-serif",Ye.fillText(je,5,5),Ye.strokeText(je,5,5),Fe.debugOverlayTexture.update(Ce),Fe.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(v,`${Oe} ${_e}kB`),A.draw(p,m.TRIANGLES,L,D,Tn.alphaBlended,en.disabled,go(b,a.aM.transparent,Ie),null,K,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),A.draw(p,m.LINE_STRIP,L,D,Z,en.disabled,go(b,a.aM.red),J,K,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function _l(v,t,u){const p=v.context,m=p.gl,b=v.colorModeForRenderPass(),A=new Li(m.LEQUAL,Li.ReadWrite,v.depthRangeFor3D),L=v.useProgram("terrain"),D=t.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,v.width,v.height]);for(const Z of u){const K=v.renderToTexture.getTexture(Z),J=t.getTerrainData(Z.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,K.texture);const ae=v.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),_e=t.getMeshFrameDelta(v.transform.zoom),ke=v.transform.calculateFogMatrix(Z.tileID.toUnwrapped()),Ie=ka(ae,_e,ke,v.style.sky,v.transform.pitch);L.draw(p,m.TRIANGLES,A,$i.disabled,b,en.backCCW,Ie,J,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}class So{constructor(t,u,p){this.vertexBuffer=t,this.indexBuffer=u,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Oa{constructor(t,u){this.context=new gu(t),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ii.maxUnderzooming+ii.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ll}resize(t,u,p){if(this.width=Math.floor(t*p),this.height=Math.floor(u*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,u=new a.aX;u.emplaceBack(0,0),u.emplaceBack(a.X,0),u.emplaceBack(0,a.X),u.emplaceBack(a.X,a.X),this.tileExtentBuffer=t.createVertexBuffer(u,Xs.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const p=new a.aX;p.emplaceBack(0,0),p.emplaceBack(a.X,0),p.emplaceBack(0,a.X),p.emplaceBack(a.X,a.X),this.debugBuffer=t.createVertexBuffer(p,Xs.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const m=new a.$;m.emplaceBack(0,0,0,0),m.emplaceBack(a.X,0,a.X,0),m.emplaceBack(0,a.X,0,a.X),m.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=t.createVertexBuffer(m,Q.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const b=new a.aX;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,Xs.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const A=new a.aZ;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(A);const L=new a.aY;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(L);const D=this.context.gl;this.stencilClearMode=new $i({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)}clearStencil(){const t=this.context,u=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.H();a.aP(p,0,this.width,this.height,0,0,1),a.K(p,p,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,u.TRIANGLES,Li.disabled,this.stencilClearMode,Tn.disabled,en.disabled,qn(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,u){if(this.currentStencilSource===t.source||!t.isTileClipped()||!u||!u.length)return;this.currentStencilSource=t.source;const p=this.context,m=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(Tn.disabled),p.setDepthMode(Li.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of u){const L=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A);b.draw(p,m.TRIANGLES,Li.disabled,new $i({func:m.ALWAYS,mask:0},L,255,m.KEEP,m.KEEP,m.REPLACE),Tn.disabled,en.disabled,qn(A.posMatrix),D,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,u=this.context.gl;return new $i({func:u.NOTEQUAL,mask:255},t,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(t){const u=this.context.gl;return new $i({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(t){const u=this.context.gl,p=t.sort((A,L)=>L.overscaledZ-A.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const A={};for(let L=0;L<b;L++)A[L+m]=new $i({func:u.GEQUAL,mask:255},L+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[A,p]}return[{[m]:$i.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Tn([t.CONSTANT_COLOR,t.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tn.unblended:Tn.alphaBlended}depthModeForSublayer(t,u,p){if(!this.opaquePassEnabledForLayer())return Li.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Li(p||this.context.gl.LEQUAL,u,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,u){this.style=t,this.options=u,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},A={},L={};for(const D in m){const Z=m[D];Z.used&&Z.prepare(this.context),b[D]=Z.getVisibleCoordinates(),A[D]=b[D].slice().reverse(),L[D]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<p.length;D++)if(this.style._layers[p[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of p){const Z=this.style._layers[D];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const K=A[Z.source];(Z.type==="custom"||K.length)&&this.renderLayer(this,m[Z.source],Z,K)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(D,Z){const K=D.context,J=K.gl,ae=((Fe,je,Ce)=>({u_sky_color:Fe.properties.get("sky-color"),u_horizon_color:Fe.properties.get("horizon-color"),u_horizon:(je.height/2+je.getHorizon())*Ce,u_sky_horizon_blend:Fe.properties.get("sky-horizon-blend")*je.height/2*Ce}))(Z,D.style.map.transform,D.pixelRatio),_e=new Li(J.LEQUAL,Li.ReadWrite,[0,1]),ke=$i.disabled,Ie=D.colorModeForRenderPass(),Oe=D.useProgram("sky");if(!Z.mesh){const Fe=new a.aX;Fe.emplaceBack(-1,-1),Fe.emplaceBack(1,-1),Fe.emplaceBack(1,1),Fe.emplaceBack(-1,1);const je=new a.aY;je.emplaceBack(0,1,2),je.emplaceBack(0,2,3),Z.mesh=new So(K.createVertexBuffer(Fe,Xs.members),K.createIndexBuffer(je),a.a0.simpleSegment(0,0,Fe.length,je.length))}Oe.draw(K,J.TRIANGLES,_e,ke,Ie,en.disabled,ae,void 0,"sky",Z.mesh.vertexBuffer,Z.mesh.indexBuffer,Z.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[p[this.currentLayer]],Z=m[D.source],K=b[D.source];this._renderTileClippingMasks(D,K),this.renderLayer(this,Z,D,K)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const D=this.style._layers[p[this.currentLayer]],Z=m[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D))continue;const K=(D.type==="symbol"?L:A)[D.source];this._renderTileClippingMasks(D,b[D.source]),this.renderLayer(this,Z,D,K)}if(this.options.showTileBoundaries){const D=function(Z,K){let J=null;const ae=Object.values(Z._layers).flatMap(Oe=>Oe.source&&!Oe.isHidden(K)?[Z.sourceCaches[Oe.source]]:[]),_e=ae.filter(Oe=>Oe.getSource().type==="vector"),ke=ae.filter(Oe=>Oe.getSource().type!=="vector"),Ie=Oe=>{(!J||J.getSource().maxzoom<Oe.getSource().maxzoom)&&(J=Oe)};return _e.forEach(Oe=>Ie(Oe)),J||ke.forEach(Oe=>Ie(Oe)),J}(this.style,this.transform.zoom);D&&function(Z,K,J){for(let ae=0;ae<J.length;ae++)za(Z,K,J[ae])}(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const Z=D.transform.padding;ro(D,D.transform.height-(Z.top||0),3,gl),ro(D,Z.bottom||0,3,Wi),La(D,Z.left||0,3,ko),La(D,D.transform.width-(Z.right||0),3,dc);const K=D.transform.centerPoint;(function(J,ae,_e,ke){ea(J,ae-1,_e-10,2,20,ke),ea(J,ae-10,_e-1,20,2,ke)})(D,K.x,D.transform.height-K.y,Fs)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=t?!a.a_(u,p):!a.a$(u,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.b0(u,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,A){const L=b.context,D=L.gl,Z=Tn.unblended,K=new Li(D.LEQUAL,Li.ReadWrite,[0,1]),J=A.getTerrainMesh(),ae=A.sourceCache.getRenderableTiles(),_e=b.useProgram("terrainDepth");L.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),L.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),L.clear({color:a.aM.transparent,depth:1});for(const ke of ae){const Ie=A.getTerrainData(ke.tileID),Oe={u_matrix:b.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(b.transform.zoom)};_e.draw(L,D.TRIANGLES,K,$i.disabled,Z,en.backCCW,Oe,Ie,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}L.bindFramebuffer.set(null),L.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,A){const L=b.context,D=L.gl,Z=Tn.unblended,K=new Li(D.LEQUAL,Li.ReadWrite,[0,1]),J=A.getTerrainMesh(),ae=A.getCoordsTexture(),_e=A.sourceCache.getRenderableTiles(),ke=b.useProgram("terrainCoords");L.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),L.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),L.clear({color:a.aM.transparent,depth:1}),A.coordsIndex=[];for(const Ie of _e){const Oe=A.getTerrainData(Ie.tileID);L.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,ae.texture);const Fe={u_matrix:b.transform.calculatePosMatrix(Ie.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(b.transform.zoom)};ke.draw(L,D.TRIANGLES,K,$i.disabled,Z,en.backCCW,Fe,Oe,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),A.coordsIndex.push(Ie.tileID.key)}L.bindFramebuffer.set(null),L.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(t,u,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,A,L,D,Z){if(b.renderPass!=="translucent")return;const K=$i.disabled,J=b.colorModeForRenderPass();(L._unevaluatedLayout.hasValue("text-variable-anchor")||L._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ae,_e,ke,Ie,Oe,Fe,je,Ce,He){const Ye=_e.transform,nt=Rn(),vt=Oe==="map",Ct=Fe==="map";for(const Ft of ae){const Vt=Ie.getTile(Ft),Lt=Vt.getBucket(ke);if(!Lt||!Lt.text||!Lt.text.segments.get().length)continue;const Mt=a.ag(Lt.textSizeData,Ye.zoom),Jt=Si(Vt,1,_e.transform.zoom),xi=Ar(Ft.posMatrix,Ct,vt,_e.transform,Jt),zt=ke.layout.get("icon-text-fit")!=="none"&&Lt.hasIconData();if(Mt){const Nt=Math.pow(2,Ye.zoom-Vt.tileID.overscaledZ),bi=_e.style.map.terrain?(Ai,Vi)=>_e.style.map.terrain.getElevation(Ft,Ai,Vi):null,gn=nt.translatePosition(Ye,Vt,je,Ce);bo(Lt,vt,Ct,He,Ye,xi,Ft.posMatrix,Nt,Mt,zt,nt,gn,Ft.toUnwrapped(),bi)}}}(D,b,L,A,L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),Z),L.paint.get("icon-opacity").constantOr(1)!==0&&pl(b,A,L,D,!1,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),L.layout.get("icon-rotation-alignment"),L.layout.get("icon-pitch-alignment"),L.layout.get("icon-keep-upright"),K,J),L.paint.get("text-opacity").constantOr(1)!==0&&pl(b,A,L,D,!0,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.layout.get("text-keep-upright"),K,J),A.map.showCollisionBoxes&&(Ko(b,A,L,D,!0),Ko(b,A,L,D,!1))})(t,u,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,A,L,D){if(b.renderPass!=="translucent")return;const Z=L.paint.get("circle-opacity"),K=L.paint.get("circle-stroke-width"),J=L.paint.get("circle-stroke-opacity"),ae=!L.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(K.constantOr(1)===0||J.constantOr(1)===0))return;const _e=b.context,ke=_e.gl,Ie=b.depthModeForSublayer(0,Li.ReadOnly),Oe=$i.disabled,Fe=b.colorModeForRenderPass(),je=[];for(let Ce=0;Ce<D.length;Ce++){const He=D[Ce],Ye=A.getTile(He),nt=Ye.getBucket(L);if(!nt)continue;const vt=nt.programConfigurations.get(L.id),Ct=b.useProgram("circle",vt),Ft=nt.layoutVertexBuffer,Vt=nt.indexBuffer,Lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),Mt={programConfiguration:vt,program:Ct,layoutVertexBuffer:Ft,indexBuffer:Vt,uniformValues:Jl(b,He,Ye,L),terrainData:Lt};if(ae){const Jt=nt.segments.get();for(const xi of Jt)je.push({segments:new a.a0([xi]),sortKey:xi.sortKey,state:Mt})}else je.push({segments:nt.segments,sortKey:0,state:Mt})}ae&&je.sort((Ce,He)=>Ce.sortKey-He.sortKey);for(const Ce of je){const{programConfiguration:He,program:Ye,layoutVertexBuffer:nt,indexBuffer:vt,uniformValues:Ct,terrainData:Ft}=Ce.state;Ye.draw(_e,ke.TRIANGLES,Ie,Oe,Fe,en.disabled,Ct,Ft,L.id,nt,vt,Ce.segments,L.paint,b.transform.zoom,He)}})(t,u,p,m);break;case"heatmap":(function(b,A,L,D){if(L.paint.get("heatmap-opacity")===0)return;const Z=b.context;if(b.style.map.terrain){for(const K of D){const J=A.getTile(K);A.hasRenderableParent(K)||(b.renderPass==="offscreen"?gs(b,J,L,K):b.renderPass==="translucent"&&no(b,L,K))}Z.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(K,J,ae,_e){const ke=K.context,Ie=ke.gl,Oe=$i.disabled,Fe=new Tn([Ie.ONE,Ie.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function(je,Ce,He){const Ye=je.gl;je.activeTexture.set(Ye.TEXTURE1),je.viewport.set([0,0,Ce.width/4,Ce.height/4]);let nt=He.heatmapFbos.get(a.aU);nt?(Ye.bindTexture(Ye.TEXTURE_2D,nt.colorAttachment.get()),je.bindFramebuffer.set(nt.framebuffer)):(nt=Yo(je,Ce.width/4,Ce.height/4),He.heatmapFbos.set(a.aU,nt))})(ke,K,ae),ke.clear({color:a.aM.transparent});for(let je=0;je<_e.length;je++){const Ce=_e[je];if(J.hasRenderableParent(Ce))continue;const He=J.getTile(Ce),Ye=He.getBucket(ae);if(!Ye)continue;const nt=Ye.programConfigurations.get(ae.id),vt=K.useProgram("heatmap",nt),{zoom:Ct}=K.transform;vt.draw(ke,Ie.TRIANGLES,Li.disabled,Oe,Fe,en.disabled,tr(Ce.posMatrix,He,Ct,ae.paint.get("heatmap-intensity")),null,ae.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,ae.paint,K.transform.zoom,nt)}ke.viewport.set([0,0,K.width,K.height])}(b,A,L,D):b.renderPass==="translucent"&&function(K,J){const ae=K.context,_e=ae.gl;ae.setColorMode(K.colorModeForRenderPass());const ke=J.heatmapFbos.get(a.aU);ke&&(ae.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,ke.colorAttachment.get()),ae.activeTexture.set(_e.TEXTURE1),Qo(ae,J).bind(_e.LINEAR,_e.CLAMP_TO_EDGE),K.useProgram("heatmapTexture").draw(ae,_e.TRIANGLES,Li.disabled,$i.disabled,K.colorModeForRenderPass(),en.disabled,_o(K,J,0,1),null,J.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments,J.paint,K.transform.zoom))}(b,L)})(t,u,p,m);break;case"line":(function(b,A,L,D){if(b.renderPass!=="translucent")return;const Z=L.paint.get("line-opacity"),K=L.paint.get("line-width");if(Z.constantOr(1)===0||K.constantOr(1)===0)return;const J=b.depthModeForSublayer(0,Li.ReadOnly),ae=b.colorModeForRenderPass(),_e=L.paint.get("line-dasharray"),ke=L.paint.get("line-pattern"),Ie=ke.constantOr(1),Oe=L.paint.get("line-gradient"),Fe=L.getCrossfadeParameters(),je=Ie?"linePattern":_e?"lineSDF":Oe?"lineGradient":"line",Ce=b.context,He=Ce.gl;let Ye=!0;for(const nt of D){const vt=A.getTile(nt);if(Ie&&!vt.patternsLoaded())continue;const Ct=vt.getBucket(L);if(!Ct)continue;const Ft=Ct.programConfigurations.get(L.id),Vt=b.context.program.get(),Lt=b.useProgram(je,Ft),Mt=Ye||Lt.program!==Vt,Jt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(nt),xi=ke.constantOr(null);if(xi&&vt.imageAtlas){const bi=vt.imageAtlas,gn=bi.patternPositions[xi.to.toString()],Ai=bi.patternPositions[xi.from.toString()];gn&&Ai&&Ft.setConstantPatternPositions(gn,Ai)}const zt=Jt?nt:null,Nt=Ie?Ks(b,vt,L,Fe,zt):_e?Ql(b,vt,L,_e,Fe,zt):Oe?Yl(b,vt,L,Ct.lineClipsArray.length,zt):Ta(b,vt,L,zt);if(Ie)Ce.activeTexture.set(He.TEXTURE0),vt.imageAtlasTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE),Ft.updatePaintBuffers(Fe);else if(_e&&(Mt||b.lineAtlas.dirty))Ce.activeTexture.set(He.TEXTURE0),b.lineAtlas.bind(Ce);else if(Oe){const bi=Ct.gradients[L.id];let gn=bi.texture;if(L.gradientVersion!==bi.version){let Ai=256;if(L.stepInterpolant){const Vi=A.getSource().maxzoom,_n=nt.canonical.z===Vi?Math.ceil(1<<b.transform.maxZoom-nt.canonical.z):1;Ai=a.ac(a.aV(Ct.maxLineLength/a.X*1024*_n),256,Ce.maxTextureSize)}bi.gradient=a.aW({expression:L.gradientExpression(),evaluationKey:"lineProgress",resolution:Ai,image:bi.gradient||void 0,clips:Ct.lineClipsArray}),bi.texture?bi.texture.update(bi.gradient):bi.texture=new O(Ce,bi.gradient,He.RGBA),bi.version=L.gradientVersion,gn=bi.texture}Ce.activeTexture.set(He.TEXTURE0),gn.bind(L.stepInterpolant?He.NEAREST:He.LINEAR,He.CLAMP_TO_EDGE)}Lt.draw(Ce,He.TRIANGLES,J,b.stencilModeForClipping(nt),ae,en.disabled,Nt,Jt,L.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,L.paint,b.transform.zoom,Ft,Ct.layoutVertexBuffer2),Ye=!1}})(t,u,p,m);break;case"fill":(function(b,A,L,D){const Z=L.paint.get("fill-color"),K=L.paint.get("fill-opacity");if(K.constantOr(1)===0)return;const J=b.colorModeForRenderPass(),ae=L.paint.get("fill-pattern"),_e=b.opaquePassEnabledForLayer()&&!ae.constantOr(1)&&Z.constantOr(a.aM.transparent).a===1&&K.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===_e){const ke=b.depthModeForSublayer(1,b.renderPass==="opaque"?Li.ReadWrite:Li.ReadOnly);$o(b,A,L,D,ke,J,!1)}if(b.renderPass==="translucent"&&L.paint.get("fill-antialias")){const ke=b.depthModeForSublayer(L.getPaintProperty("fill-outline-color")?2:0,Li.ReadOnly);$o(b,A,L,D,ke,J,!0)}})(t,u,p,m);break;case"fill-extrusion":(function(b,A,L,D){const Z=L.paint.get("fill-extrusion-opacity");if(Z!==0&&b.renderPass==="translucent"){const K=new Li(b.context.gl.LEQUAL,Li.ReadWrite,b.depthRangeFor3D);if(Z!==1||L.paint.get("fill-extrusion-pattern").constantOr(1))Pa(b,A,L,D,K,$i.disabled,Tn.disabled),Pa(b,A,L,D,K,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const J=b.colorModeForRenderPass();Pa(b,A,L,D,K,$i.disabled,J)}}})(t,u,p,m);break;case"hillshade":(function(b,A,L,D){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const Z=b.context,K=b.depthModeForSublayer(0,Li.ReadOnly),J=b.colorModeForRenderPass(),[ae,_e]=b.renderPass==="translucent"?b.stencilConfigForOverlap(D):[{},D];for(const ke of _e){const Ie=A.getTile(ke);Ie.needsHillshadePrepare!==void 0&&Ie.needsHillshadePrepare&&b.renderPass==="offscreen"?xo(b,Ie,L,K,$i.disabled,J):b.renderPass==="translucent"&&wo(b,ke,Ie,L,K,ae[ke.overscaledZ],J)}Z.viewport.set([0,0,b.width,b.height])})(t,u,p,m);break;case"raster":(function(b,A,L,D){if(b.renderPass!=="translucent"||L.paint.get("raster-opacity")===0||!D.length)return;const Z=b.context,K=Z.gl,J=A.getSource(),ae=b.useProgram("raster"),_e=b.colorModeForRenderPass(),[ke,Ie]=J instanceof Me?[{},D]:b.stencilConfigForOverlap(D),Oe=Ie[Ie.length-1].overscaledZ,Fe=!b.options.moving;for(const je of Ie){const Ce=b.depthModeForSublayer(je.overscaledZ-Oe,L.paint.get("raster-opacity")===1?Li.ReadWrite:Li.ReadOnly,K.LESS),He=A.getTile(je);He.registerFadeDuration(L.paint.get("raster-fade-duration"));const Ye=A.findLoadedParent(je,0),nt=A.findLoadedSibling(je),vt=ml(He,Ye||nt||null,A,L,b.transform,b.style.map.terrain);let Ct,Ft;const Vt=L.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR;Z.activeTexture.set(K.TEXTURE0),He.texture.bind(Vt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(K.TEXTURE1),Ye?(Ye.texture.bind(Vt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),Ct=Math.pow(2,Ye.tileID.overscaledZ-He.tileID.overscaledZ),Ft=[He.tileID.canonical.x*Ct%1,He.tileID.canonical.y*Ct%1]):He.texture.bind(Vt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),He.texture.useMipmap&&Z.extTextureFilterAnisotropic&&b.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const Lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(je),Mt=Lt?je:null,Jt=Mt?Mt.posMatrix:b.transform.calculatePosMatrix(je.toUnwrapped(),Fe),xi=lu(Jt,Ft||[0,0],Ct||1,vt,L);J instanceof Me?ae.draw(Z,K.TRIANGLES,Ce,$i.disabled,_e,en.disabled,xi,Lt,L.id,J.boundsBuffer,b.quadTriangleIndexBuffer,J.boundsSegments):ae.draw(Z,K.TRIANGLES,Ce,ke[je.overscaledZ],_e,en.disabled,xi,Lt,L.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(t,u,p,m);break;case"background":(function(b,A,L,D){const Z=L.paint.get("background-color"),K=L.paint.get("background-opacity");if(K===0)return;const J=b.context,ae=J.gl,_e=b.transform,ke=_e.tileSize,Ie=L.paint.get("background-pattern");if(b.isPatternMissing(Ie))return;const Oe=!Ie&&Z.a===1&&K===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==Oe)return;const Fe=$i.disabled,je=b.depthModeForSublayer(0,Oe==="opaque"?Li.ReadWrite:Li.ReadOnly),Ce=b.colorModeForRenderPass(),He=b.useProgram(Ie?"backgroundPattern":"background"),Ye=D||_e.coveringTiles({tileSize:ke,terrain:b.style.map.terrain});Ie&&(J.activeTexture.set(ae.TEXTURE0),b.imageManager.bind(b.context));const nt=L.getCrossfadeParameters();for(const vt of Ye){const Ct=D?vt.posMatrix:b.transform.calculatePosMatrix(vt.toUnwrapped()),Ft=Ie?qo(Ct,K,b,Ie,{tileID:vt,tileSize:ke},nt):Vo(Ct,K,Z),Vt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(vt);He.draw(J,ae.TRIANGLES,je,Fe,Ce,en.disabled,Ft,Vt,L.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(t,0,p,m);break;case"custom":(function(b,A,L){const D=b.context,Z=L.implementation;if(b.renderPass==="offscreen"){const K=Z.prerender;K&&(b.setCustomLayerDefaults(),D.setColorMode(b.colorModeForRenderPass()),K.call(Z,D.gl,b.transform.customLayerMatrix()),D.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),D.setColorMode(b.colorModeForRenderPass()),D.setStencilMode($i.disabled);const K=Z.renderingMode==="3d"?new Li(b.context.gl.LEQUAL,Li.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Li.ReadOnly);D.setDepthMode(K),Z.render(D.gl,b.transform.customLayerMatrix(),{farZ:b.transform.farZ,nearZ:b.transform.nearZ,fov:b.transform._fov,modelViewProjectionMatrix:b.transform.modelViewProjectionMatrix,projectionMatrix:b.transform.projectionMatrix}),D.setDirty(),b.setBaseState(),D.bindFramebuffer.set(null)}})(t,0,p)}}translatePosMatrix(t,u,p,m,b){if(!p[0]&&!p[1])return t;const A=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(A){const Z=Math.sin(A),K=Math.cos(A);p=[p[0]*K-p[1]*Z,p[0]*Z+p[1]*K]}const L=[b?p[0]:Si(u,p[0],this.transform.zoom),b?p[1]:Si(u,p[1],this.transform.zoom),0],D=new Float32Array(16);return a.J(D,t,L),D}saveTileTexture(t){const u=this._tileTextures[t.size[0]];u?u.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const u=this._tileTextures[t];return u&&u.length>0?u.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const u=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!u||!p}useProgram(t,u){this.cache=this.cache||{};const p=t+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new cl(this.context,Bn[t],u,hl[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new O(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:u}=this.context.gl;return this.width!==t||this.height!==u}}class Lr{constructor(t,u){this.points=t,this.planes=u}static fromInvProjectionMatrix(t,u,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const D=1/(L=a.af([],L,t))[3]/u*m;return a.b1(L,L,[D,D,1/L[3],D])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const D=function(ae,_e){var ke=_e[0],Ie=_e[1],Oe=_e[2],Fe=ke*ke+Ie*Ie+Oe*Oe;return Fe>0&&(Fe=1/Math.sqrt(Fe)),ae[0]=_e[0]*Fe,ae[1]=_e[1]*Fe,ae[2]=_e[2]*Fe,ae}([],function(ae,_e,ke){var Ie=_e[0],Oe=_e[1],Fe=_e[2],je=ke[0],Ce=ke[1],He=ke[2];return ae[0]=Oe*He-Fe*Ce,ae[1]=Fe*je-Ie*He,ae[2]=Ie*Ce-Oe*je,ae}([],te([],b[L[0]],b[L[1]]),te([],b[L[2]],b[L[1]]))),Z=-((K=D)[0]*(J=b[L[1]])[0]+K[1]*J[1]+K[2]*J[2]);var K,J;return D.concat(Z)});return new Lr(b,A)}}class vr{constructor(t,u){this.min=t,this.max=u,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(t){const u=[t%2==0,t<2],p=se(this.min),m=se(this.max);for(let b=0;b<u.length;b++)p[b]=u[b]?this.min[b]:this.center[b],m[b]=u[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new vr(p,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<t.planes.length;m++){const b=t.planes[m];let A=0;for(let L=0;L<u.length;L++)a.b2(b,u[L])>=0&&A++;if(A===0)return 0;A!==u.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let L=0;L<t.points.length;L++){const D=t.points[L][m]-this.min[m];b=Math.min(b,D),A=Math.max(A,D)}if(A<0||b>this.max[m]-this.min[m])return 0}return 1}}class To{constructor(t=0,u=0,p=0,m=0){if(isNaN(t)||t<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=u,this.left=p,this.right=m}interpolate(t,u,p){return u.top!=null&&t.top!=null&&(this.top=a.y.number(t.top,u.top,p)),u.bottom!=null&&t.bottom!=null&&(this.bottom=a.y.number(t.bottom,u.bottom,p)),u.left!=null&&t.left!=null&&(this.left=a.y.number(t.left,u.left,p)),u.right!=null&&t.right!=null&&(this.right=a.y.number(t.right,u.right,p)),this}getCenter(t,u){const p=a.ac((this.left+t-this.right)/2,0,t),m=a.ac((this.top+u-this.bottom)/2,0,u);return new a.P(p,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new To(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const yl=85.051129;class Co{constructor(t,u,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=t||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new To,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new Co(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const u=-a.b3(t,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var A=m[0],L=m[1],D=m[2],Z=m[3],K=Math.sin(b),J=Math.cos(b);p[0]=A*J+D*K,p[1]=L*J+Z*K,p[2]=A*-K+D*J,p[3]=L*-K+Z*J}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const u=a.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const u=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.tileZoom=Math.max(0,Math.floor(u)),this.scale=this.zoomScale(u),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,u,p){this._unmodified=!1,this._edgeInsets.interpolate(t,u,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const u=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(t){const u=[new a.b4(0,t)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),A=this.pointCoordinate(new a.P(0,this.height)),L=Math.floor(Math.min(p.x,m.x,b.x,A.x)),D=Math.floor(Math.max(p.x,m.x,b.x,A.x)),Z=1;for(let K=L-Z;K<=D+Z;K++)K!==0&&u.push(new a.b4(K,t))}return u}coveringTiles(t){var u,p;let m=this.coveringZoomLevel(t);const b=m;if(t.minzoom!==void 0&&m<t.minzoom)return[];t.maxzoom!==void 0&&m>t.maxzoom&&(m=t.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),L=a.Z.fromLngLat(this.center),D=Math.pow(2,m),Z=[D*A.x,D*A.y,0],K=[D*L.x,D*L.y,0],J=Lr.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let ae=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ae=m);const _e=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,ke=Ce=>({aabb:new vr([Ce*D,0,0],[(Ce+1)*D,D,0]),zoom:0,x:0,y:0,wrap:Ce,fullyVisible:!1}),Ie=[],Oe=[],Fe=m,je=t.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)Ie.push(ke(-Ce)),Ie.push(ke(Ce));for(Ie.push(ke(0));Ie.length>0;){const Ce=Ie.pop(),He=Ce.x,Ye=Ce.y;let nt=Ce.fullyVisible;if(!nt){const Lt=Ce.aabb.intersects(J);if(Lt===0)continue;nt=Lt===2}const vt=t.terrain?Z:K,Ct=Ce.aabb.distanceX(vt),Ft=Ce.aabb.distanceY(vt),Vt=Math.max(Math.abs(Ct),Math.abs(Ft));if(Ce.zoom===Fe||Vt>_e+(1<<Fe-Ce.zoom)-2&&Ce.zoom>=ae){const Lt=Fe-Ce.zoom,Mt=Z[0]-.5-(He<<Lt),Jt=Z[1]-.5-(Ye<<Lt);Oe.push({tileID:new a.S(Ce.zoom===Fe?je:Ce.zoom,Ce.wrap,Ce.zoom,He,Ye),distanceSq:U([K[0]-.5-He,K[1]-.5-Ye]),tileDistanceToCamera:Math.sqrt(Mt*Mt+Jt*Jt)})}else for(let Lt=0;Lt<4;Lt++){const Mt=(He<<1)+Lt%2,Jt=(Ye<<1)+(Lt>>1),xi=Ce.zoom+1;let zt=Ce.aabb.quadrant(Lt);if(t.terrain){const Nt=new a.S(xi,Ce.wrap,xi,Mt,Jt),bi=t.terrain.getMinMaxElevation(Nt),gn=(u=bi.minElevation)!==null&&u!==void 0?u:this.elevation,Ai=(p=bi.maxElevation)!==null&&p!==void 0?p:this.elevation;zt=new vr([zt.min[0],zt.min[1],gn],[zt.max[0],zt.max[1],Ai])}Ie.push({aabb:zt,zoom:xi,x:Mt,y:Jt,wrap:Ce.wrap,fullyVisible:nt})}}return Oe.sort((Ce,He)=>Ce.distanceSq-He.distanceSq).map(Ce=>Ce.tileID)}resize(t,u){this.width=t,this.height=u,this.pixelsToGLUnits=[2/t,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const u=a.ac(t.lat,-85.051129,yl);return new a.P(a.O(t.lng)*this.worldSize,a.Q(u)*this.worldSize)}unproject(t){return new a.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const u=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,t),b=t.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const A=p+u-b,L=Math.cos(this._pitch)*this.cameraToCenterDistance/A/a.b5(1,m.lat),D=this.scaleZoom(L/this.tileSize);this._elevation=b,this._center=m,this.zoom=D}setLocationAtPoint(t,u){const p=this.pointCoordinate(u),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(t),A=new a.Z(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,u){return u?this.coordinatePoint(this.locationCoordinate(t),u.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,u){return this.coordinateLocation(this.pointCoordinate(t,u))}locationCoordinate(t){return a.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,u){if(u){const ae=u.pointCoordinate(t);if(ae!=null)return ae}const p=[t.x,t.y,0,1],m=[t.x,t.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const b=p[3],A=m[3],L=p[1]/b,D=m[1]/A,Z=p[2]/b,K=m[2]/A,J=Z===K?0:(0-Z)/(K-Z);return new a.Z(a.y.number(p[0]/b,m[0]/A,J)/this.worldSize,a.y.number(L,D,J)/this.worldSize)}coordinatePoint(t,u=0,p=this.pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,u,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new $e().extend(this.pointLocation(new a.P(0,t))).extend(this.pointLocation(new a.P(this.width,t))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new $e([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,yl])}calculateTileMatrix(t){const u=t.canonical,p=this.worldSize/this.zoomScale(u.z),m=u.x+Math.pow(2,u.z)*t.wrap,b=a.an(new Float64Array(16));return a.J(b,b,[m*p,u.y*p,0]),a.K(b,b,[p/a.X,p/a.X,1]),b}calculatePosMatrix(t,u=!1){const p=t.key,m=u?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=this.calculateTileMatrix(t);return a.L(b,u?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,b),m[p]=new Float32Array(b),m[p]}calculateFogMatrix(t){const u=t.key,p=this._fogMatrixCache;if(p[u])return p[u];const m=this.calculateTileMatrix(t);return a.L(m,this.fogMatrix,m),p[u]=new Float32Array(m),p[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,u){u=a.ac(+u,this.minZoom,this.maxZoom);const p={center:new a.N(t.lng,t.lat),zoom:u};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const Ce=179.9999999999;m=[-Ce,Ce]}const b=this.tileSize*this.zoomScale(p.zoom);let A=0,L=b,D=0,Z=b,K=0,J=0;const{x:ae,y:_e}=this.size;if(this.latRange){const Ce=this.latRange;A=a.Q(Ce[1])*b,L=a.Q(Ce[0])*b,L-A<_e&&(K=_e/(L-A))}m&&(D=a.b3(a.O(m[0])*b,0,b),Z=a.b3(a.O(m[1])*b,0,b),Z<D&&(Z+=b),Z-D<ae&&(J=ae/(Z-D)));const{x:ke,y:Ie}=this.project.call({worldSize:b},t);let Oe,Fe;const je=Math.max(J||0,K||0);if(je){const Ce=new a.P(J?(Z+D)/2:ke,K?(L+A)/2:Ie);return p.center=this.unproject.call({worldSize:b},Ce).wrap(),p.zoom+=this.scaleZoom(je),p}if(this.latRange){const Ce=_e/2;Ie-Ce<A&&(Fe=A+Ce),Ie+Ce>L&&(Fe=L-Ce)}if(m){const Ce=(D+Z)/2;let He=ke;this._renderWorldCopies&&(He=a.b3(ke,Ce-b/2,Ce+b/2));const Ye=ae/2;He-Ye<D&&(Oe=D+Ye),He+Ye>Z&&(Oe=Z-Ye)}if(Oe!==void 0||Fe!==void 0){const Ce=new a.P(Oe??ke,Fe??Ie);p.center=this.unproject.call({worldSize:b},Ce).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:u,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=u,this.zoom=p,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,u=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.K(m,m,[this.width/2,-this.height/2,1]),a.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.K(m,m,[1,-1,1]),a.J(m,m,[-1,-1,0]),a.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),A=Math.min(this.elevation,this.minElevationForCurrentTile),L=b-A*this._pixelPerMeter/Math.cos(this._pitch),D=A<0?L:b,Z=Math.PI/2+this._pitch,K=this._fov*(.5+t.y/this.height),J=Math.sin(K)*D/Math.sin(a.ac(Math.PI-Z-K,.01,Math.PI-.01)),ae=this.getHorizon(),_e=2*Math.atan(ae/this.cameraToCenterDistance)*(.5+t.y/(2*ae)),ke=Math.sin(_e)*D/Math.sin(a.ac(Math.PI-Z-_e,.01,Math.PI-.01)),Ie=Math.min(J,ke);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Ie+D),this.nearZ=this.height/50,m=new Float64Array(16),a.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-t.x/this.width,m[9]=2*t.y/this.height,this.projectionMatrix=a.ae(m),a.K(m,m,[1,-1,1]),a.J(m,m,[0,0,-this.cameraToCenterDistance]),a.b7(m,m,this._pitch),a.ad(m,m,this.angle),a.J(m,m,[-u,-p,0]),this.mercatorMatrix=a.K([],m,[this.worldSize,this.worldSize,this.worldSize]),a.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,m),a.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=a.as([],m),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,b,this.farZ),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-u,-p,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,m);const Oe=this.width%2/2,Fe=this.height%2/2,je=Math.cos(this.angle),Ce=Math.sin(this.angle),He=u-Math.round(u)+je*Oe+Ce*Fe,Ye=p-Math.round(p)+je*Fe+Ce*Oe,nt=new Float64Array(m);if(a.J(nt,nt,[He>.5?He-1:He,Ye>.5?Ye-1:Ye,0]),this.alignedModelViewProjectionMatrix=nt,m=a.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.P(0,0)),u=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.af(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,t))}getCameraQueryGeometry(t){const u=this.getCameraPoint();if(t.length===1)return[t[0],u];{let p=u.x,m=u.y,b=u.x,A=u.y;for(const L of t)p=Math.min(p,L.x),m=Math.min(m,L.y),b=Math.max(b,L.x),A=Math.max(A,L.y);return[new a.P(p,m),new a.P(b,m),new a.P(b,A),new a.P(p,A),new a.P(p,m)]}}lngLatToCameraDepth(t,u){const p=this.locationCoordinate(t),m=[p.x*this.worldSize,p.y*this.worldSize,u,1];return a.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function ta(v,t){let u,p=!1,m=null,b=null;const A=()=>{m=null,p&&(v.apply(b,u),m=setTimeout(A,t),p=!1)};return(...L)=>(p=!0,b=this,u=L,m||A(),m)}class Da{constructor(t){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(u.length>=3&&!u.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(u.length===0)return;const p=u.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let A=window.location.href.replace(/(#.+)?$/,b);A=A.replace("&&","&"),window.history.replaceState(window.history.state,null,A)},this._updateHash=ta(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const u=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),A=Math.round(u.lng*b)/b,L=Math.round(u.lat*b)/b,D=this._map.getBearing(),Z=this._map.getPitch();let K="";if(K+=t?`/${A}/${L}/${p}`:`${p}/${L}/${A}`,(D||Z)&&(K+="/"+Math.round(10*D)/10),Z&&(K+=`/${Math.round(Z)}`),this._hashName){const J=this._hashName;let ae=!1;const _e=window.location.hash.slice(1).split("&").map(ke=>{const Ie=ke.split("=")[0];return Ie===J?(ae=!0,`${Ie}=${K}`):ke}).filter(ke=>ke);return ae||_e.push(`${J}=${K}`),`#${_e.join("&")}`}return`#${K}`}}const Fa={linearity:.3,easing:a.b8(0,0,.3,1)},bl=a.e({deceleration:2500,maxSpeed:1400},Fa),_u=a.e({deceleration:20,maxSpeed:1400},Fa),vl=a.e({deceleration:1e3,maxSpeed:360},Fa),so=a.e({deceleration:1e3,maxSpeed:90},Fa);class Eo{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,u=y.now();for(;t.length>0&&u-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(u.pan.mag()){const b=na(u.pan.mag(),p,a.e({},bl,t||{}));m.offset=u.pan.mult(b.amount/u.pan.mag()),m.center=this._map.transform.center,ia(m,b)}if(u.zoom){const b=na(u.zoom,p,_u);m.zoom=this._map.transform.zoom+b.amount,ia(m,b)}if(u.bearing){const b=na(u.bearing,p,vl);m.bearing=this._map.transform.bearing+a.ac(b.amount,-179,179),ia(m,b)}if(u.pitch){const b=na(u.pitch,p,so);m.pitch=this._map.transform.pitch+b.amount,ia(m,b)}if(m.zoom||m.bearing){const b=u.pinchAround===void 0?u.around:u.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ia(v,t){(!v.duration||v.duration<t.duration)&&(v.duration=t.duration,v.easing=t.easing)}function na(v,t,u){const{maxSpeed:p,linearity:m,deceleration:b}=u,A=a.ac(v*m/(t/1e3),-p,p),L=Math.abs(A)/(b*m);return{easing:u.easing,duration:1e3*L,amount:A*(L/2)}}class Pn extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,p,m={}){const b=C.mousePos(u.getCanvas(),p),A=u.unproject(b);super(t,a.e({point:b,lngLat:A,originalEvent:p},m)),this._defaultPrevented=!1,this.target=u}}class Ne extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,p){const m=t==="touchend"?p.changedTouches:p.touches,b=C.touchPos(u.getCanvasContainer(),m),A=b.map(D=>u.unproject(D)),L=b.reduce((D,Z,K,J)=>D.add(Z.div(J.length)),new a.P(0,0));super(t,{points:b,point:L,lngLats:A,lngLat:u.unproject(L),originalEvent:p}),this._defaultPrevented=!1}}class F extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class oe{constructor(t,u){this._map=t,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new F(t.type,this._map,t))}mousedown(t,u){return this._mousedownPos=u,this._firePreventable(new Pn(t.type,this._map,t))}mouseup(t){this._map.fire(new Pn(t.type,this._map,t))}click(t,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Pn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Pn(t.type,this._map,t))}mouseover(t){this._map.fire(new Pn(t.type,this._map,t))}mouseout(t){this._map.fire(new Pn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ne(t.type,this._map,t))}touchmove(t){this._map.fire(new Ne(t.type,this._map,t))}touchend(t){this._map.fire(new Ne(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ne(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Re{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Pn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Pn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mt{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(a.P.convert(t),this._map.terrain)}}class It{constructor(t,u){this._map=t,this._tr=new mt(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,u){this.isEnabled()&&t.shiftKey&&t.button===0&&(C.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(t,u){if(!this._active)return;const p=u;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(m.x,p.x),A=Math.max(m.x,p.x),L=Math.min(m.y,p.y),D=Math.max(m.y,p.y);C.setTransform(this._box,`translate(${b}px,${L}px)`),this._box.style.width=A-b+"px",this._box.style.height=D-L+"px"}mouseupWindow(t,u){if(!this._active||t.button!==0)return;const p=this._startPos,m=u;if(this.reset(),C.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,u){return this._map.fire(new a.k(t,{originalEvent:u}))}}function Xt(v,t){if(v.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${t.length}`);const u={};for(let p=0;p<v.length;p++)u[v[p].identifier]=t[p];return u}class Hi{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new a.P(0,0);for(const A of m)b._add(A);return b.div(m.length)}(u),this.touches=Xt(p,u)))}touchmove(t,u,p){if(this.aborted||!this.centroid)return;const m=Xt(p,u);for(const b in this.touches){const A=m[b];(!A||A.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,u,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class cn{constructor(t){this.singleTap=new Hi(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,u,p){this.singleTap.touchstart(t,u,p)}touchmove(t,u,p){this.singleTap.touchmove(t,u,p)}touchend(t,u,p){const m=this.singleTap.touchend(t,u,p);if(m){const b=t.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(m)<30;if(b&&A||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class On{constructor(t){this._tr=new mt(t),this._zoomIn=new cn({numTouches:1,numTaps:2}),this._zoomOut=new cn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,u,p){this._zoomIn.touchstart(t,u,p),this._zoomOut.touchstart(t,u,p)}touchmove(t,u,p){this._zoomIn.touchmove(t,u,p),this._zoomOut.touchmove(t,u,p)}touchend(t,u,p){const m=this._zoomIn.touchend(t,u,p),b=this._zoomOut.touchend(t,u,p),A=this._tr;return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(m)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class In{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const u=this._moveFunction(...t);if(u.bearingDelta||u.pitchDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(t,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=u.length?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,u){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const m=u.length?u[0]:u;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&C.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const wr={0:1,2:2};class zr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const u=C.mouseButton(t);this._eventButton=u}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(u,p){const m=wr[p];return u.buttons===void 0||(u.buttons&m)!==m}(t,this._eventButton)}isValidEndEvent(t){return C.mouseButton(t)===this._eventButton}}class Wr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ss=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=t=>{t.preventDefault()}},xr=({enable:v,clickTolerance:t,bearingDegreesPerPixelMoved:u=.8})=>{const p=new zr({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new In({clickTolerance:t,move:(m,b)=>({bearingDelta:(b.x-m.x)*u}),moveStateManager:p,enable:v,assignEvents:ss})},oo=({enable:v,clickTolerance:t,pitchDegreesPerPixelMoved:u=-.5})=>{const p=new zr({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new In({clickTolerance:t,move:(m,b)=>({pitchDelta:(b.y-m.y)*u}),moveStateManager:p,enable:v,assignEvents:ss})};class os{constructor(t,u){this._clickTolerance=t.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,u,p){return this._calculateTransform(t,u,p)}touchmove(t,u,p){if(this._active){if(!this._shouldBePrevented(p.length))return t.preventDefault(),this._calculateTransform(t,u,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,u,p){this._calculateTransform(t,u,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,u,p){p.length>0&&(this._active=!0);const m=Xt(p,u),b=new a.P(0,0),A=new a.P(0,0);let L=0;for(const Z in m){const K=m[Z],J=this._touches[Z];J&&(b._add(K),A._add(K.sub(J)),L++,m[Z]=K)}if(this._touches=m,this._shouldBePrevented(L)||!A.mag())return;const D=A.div(L);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(L),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ra{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(t,u,p){if(!this._firstTwoTouches)return;t.preventDefault();const[m,b]=this._firstTwoTouches,A=Gr(p,u,m),L=Gr(p,u,b);if(!A||!L)return;const D=this._aroundCenter?null:A.add(L).div(2);return this._move([A,L],D,t)}touchend(t,u,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,A=Gr(p,u,m),L=Gr(p,u,b);A&&L||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Gr(v,t,u){for(let p=0;p<v.length;p++)if(v[p].identifier===u)return t[p]}function wl(v,t){return Math.log(v/t)/Math.LN2}class yu extends Ra{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,u){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(wl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wl(this._distance,p),pinchAround:u}}}function bu(v,t){return 180*v.angleWith(t)/Math.PI}class vu extends Ra{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,u,p){const m=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bu(this._vector,m),pinchAround:u}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const u=25/(Math.PI*this._minDiameter)*360,p=bu(t,this._startVector);return Math.abs(p)<u}}function pc(v){return Math.abs(v.y)>Math.abs(v.x)}class xl extends Ra{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,u,p){super.touchstart(t,u,p),this._currentTouchCount=p.length}_start(t){this._lastPoints=t,pc(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,u,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,u,p){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,b=u.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=t.y>0==u.y>0;return pc(t)&&pc(u)&&A}}const kh={panStep:100,bearingStep:15,pitchStep:10};class as{constructor(t){this._tr=new mt(t);const u=kh;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let u=0,p=0,m=0,b=0,A=0;switch(t.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),A=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:L=>{const D=this._tr;L.easeTo({duration:300,easeId:"keyboardHandler",easing:Rs,zoom:u?Math.round(D.zoom)+u*(t.shiftKey?2:1):D.zoom,bearing:D.bearing+p*this._bearingStep,pitch:D.pitch+m*this._pitchStep,offset:[-b*this._panStep,-A*this._panStep],center:D.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rs(v){return v*(2-v)}const wu=4.000244140625;class _s{constructor(t,u){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=t,this._tr=new mt(t),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let u=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=y.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,u!==0&&u%wu==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),t.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=t,this._delta-=u,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=C.mousePos(this._map.getCanvas(),t),p=this._tr;this._around=u.y>p.transform.height/2-p.transform.getHorizon()?a.N.convert(this._aroundCenter?p.center:p.unproject(u)):a.N.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>wu?this._wheelZoomRate:this._defaultZoomRate;let Z=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&Z!==0&&(Z=1/Z);const K=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(K*Z))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,p=this._startZoom,m=this._easing;let b,A=!1;const L=y.now()-this._lastWheelEventTime;if(this._type==="wheel"&&p&&m&&L){const D=Math.min(L/200,1),Z=m(D);b=a.y.number(p,u,Z),D<1?this._frameId||(this._frameId=!0):A=!0}else b=u,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let u=a.b9;if(this._prevEase){const p=this._prevEase,m=(y.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),A=.27/Math.sqrt(b*b+1e-4)*.01,L=Math.sqrt(.0729-A*A);u=a.b8(A,L,.25,1)}return this._prevEase={start:y.now(),duration:t,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ra{constructor(t,u){this._clickZoom=t,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pf{constructor(t){this._tr=new mt(t),this.reset()}reset(){this._active=!1}dblclick(t,u){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lf{constructor(){this._tap=new cn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,u,p){if(!this._swipePoint)if(this._tapTime){const m=u[0],b=t.timeStamp-this._tapTime<500,A=this._tapPoint.dist(m)<30;b&&A?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(t,u,p)}touchmove(t,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=u[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,u,p)}touchend(t,u,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(t,u,p);m&&(this._tapTime=t.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sh{constructor(t,u,p){this._el=t,this._mousePan=u,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Th{constructor(t,u,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=u,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xu{constructor(t,u,p,m){this._el=t,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ba{constructor(t,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",t);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=u,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,u){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:t,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ls=v=>v.zoom||v.drag||v.pitch||v.rotate;class Zt extends a.k{}function mc(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class ku{constructor(t,u){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=m.type==="renderFrame"?void 0:m,L={needsRenderFrame:!1},D={},Z={},K=m.touches,J=K?this._getMapTouches(K):void 0,ae=J?C.touchPos(this._map.getCanvas(),J):C.mousePos(this._map.getCanvas(),m);for(const{handlerName:Ie,handler:Oe,allowed:Fe}of this._handlers){if(!Oe.isEnabled())continue;let je;this._blockedByActive(Z,Fe,Ie)?Oe.reset():Oe[b||m.type]&&(je=Oe[b||m.type](m,ae,J),this.mergeHandlerResult(L,D,je,Ie,A),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Oe.isActive())&&(Z[Ie]=Oe)}const _e={};for(const Ie in this._previousActiveHandlers)Z[Ie]||(_e[Ie]=A);this._previousActiveHandlers=Z,(Object.keys(_e).length||mc(L))&&(this._changes.push([L,D,_e]),this._triggerRenderFrame()),(Object.keys(Z).length||mc(L))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=L;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Eo(t),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,A]of this._listeners)C.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[t,u,p]of this._listeners)C.removeEventListener(t,u,t===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new oe(u,t));const m=u.boxZoom=new It(u,t);this._add("boxZoom",m),t.interactive&&t.boxZoom&&m.enable();const b=u.cooperativeGestures=new Ba(u,t.cooperativeGestures);this._add("cooperativeGestures",b),t.cooperativeGestures&&b.enable();const A=new On(u),L=new Pf(u);u.doubleClickZoom=new ra(L,A),this._add("tapZoom",A),this._add("clickZoom",L),t.interactive&&t.doubleClickZoom&&u.doubleClickZoom.enable();const D=new Lf;this._add("tapDragZoom",D);const Z=u.touchPitch=new xl(u);this._add("touchPitch",Z),t.interactive&&t.touchPitch&&u.touchPitch.enable(t.touchPitch);const K=xr(t),J=oo(t);u.dragRotate=new Th(t,K,J),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]),t.interactive&&t.dragRotate&&u.dragRotate.enable();const ae=(({enable:je,clickTolerance:Ce})=>{const He=new zr({checkCorrectEvent:Ye=>C.mouseButton(Ye)===0&&!Ye.ctrlKey});return new In({clickTolerance:Ce,move:(Ye,nt)=>({around:nt,panDelta:nt.sub(Ye)}),activateOnStart:!0,moveStateManager:He,enable:je,assignEvents:ss})})(t),_e=new os(t,u);u.dragPan=new Sh(p,ae,_e),this._add("mousePan",ae),this._add("touchPan",_e,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&u.dragPan.enable(t.dragPan);const ke=new vu,Ie=new yu;u.touchZoomRotate=new xu(p,Ie,ke,D),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&u.touchZoomRotate.enable(t.touchZoomRotate);const Oe=u.scrollZoom=new _s(u,()=>this._triggerRenderFrame());this._add("scrollZoom",Oe,["mousePan"]),t.interactive&&t.scrollZoom&&u.scrollZoom.enable(t.scrollZoom);const Fe=u.keyboard=new as(u);this._add("keyboard",Fe),t.interactive&&t.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new Re(u))}_add(t,u,p){this._handlers.push({handlerName:t,handler:u,allowed:p}),this._handlersById[t]=u}stop(t){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ls(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,u,p){for(const m in t)if(m!==p&&(!u||u.indexOf(m)<0))return!0;return!1}_getMapTouches(t){const u=[];for(const p of t)this._el.contains(p.target)&&u.push(p);return u}mergeHandlerResult(t,u,p,m,b){if(!p)return;a.e(t,p);const A={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(u.zoom=A),p.panDelta!==void 0&&(u.drag=A),p.pitchDelta!==void 0&&(u.pitch=A),p.bearingDelta!==void 0&&(u.rotate=A)}_applyChanges(){const t={},u={},p={};for(const[m,b,A]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),a.e(u,b),a.e(p,A);this._updateMapTransform(t,u,p),this._changes=[]}_updateMapTransform(t,u,p){const m=this._map,b=m._getTransformForUpdate(),A=m.terrain;if(!(mc(t)||A&&this._terrainMovement))return this._fireEvents(u,p,!0);let{panDelta:L,zoomDelta:D,bearingDelta:Z,pitchDelta:K,around:J,pinchAround:ae}=t;ae!==void 0&&(J=ae),m._stop(!0),J=J||m.transform.centerPoint;const _e=b.pointLocation(L?J.sub(L):J);Z&&(b.bearing+=Z),K&&(b.pitch+=K),D&&(b.zoom+=D),A?this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(L)):b.setLocationAtPoint(_e,J):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(_e,J)):b.setLocationAtPoint(_e,J),m._applyUpdatedTransform(b),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(u,p,!0)}_fireEvents(t,u,p){const m=ls(this._eventsInProgress),b=ls(t),A={};for(const J in t){const{originalEvent:ae}=t[J];this._eventsInProgress[J]||(A[`${J}start`]=ae),this._eventsInProgress[J]=t[J]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const J in A)this._fireEvent(J,A[J]);b&&this._fireEvent("move",b.originalEvent);for(const J in t){const{originalEvent:ae}=t[J];this._fireEvent(J,ae)}const L={};let D;for(const J in this._eventsInProgress){const{handlerName:ae,originalEvent:_e}=this._eventsInProgress[J];this._handlersById[ae].isActive()||(delete this._eventsInProgress[J],D=u[ae]||_e,L[`${J}end`]=D)}for(const J in L)this._fireEvent(J,L[J]);const Z=ls(this._eventsInProgress),K=(m||b)&&!Z;if(K&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const J=this._map._getTransformForUpdate();J.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(J)}if(p&&K){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=_e=>_e!==0&&-this._bearingSnap<_e&&_e<this._bearingSnap;!J||!J.essential&&y.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:D})),ae(this._map.getBearing())&&this._map.resetNorth()):(ae(J.bearing||this._map.getBearing())&&(J.bearing=0),J.freezeElevation=!0,this._map.easeTo(J,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(t,u){this._map.fire(new a.k(t,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Zt("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ch extends a.E{constructor(t,u){super(),this._renderFrameCallback=()=>{const p=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=u.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,u){return this.jumpTo({center:t},u)}panBy(t,u,p){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.e({offset:t},u),p)}panTo(t,u,p){return this.easeTo(a.e({center:t},u),p)}getZoom(){return this.transform.zoom}setZoom(t,u){return this.jumpTo({zoom:t},u),this}zoomTo(t,u,p){return this.easeTo(a.e({zoom:t},u),p)}zoomIn(t,u){return this.zoomTo(this.getZoom()+1,t,u),this}zoomOut(t,u){return this.zoomTo(this.getZoom()-1,t,u),this}getBearing(){return this.transform.bearing}setBearing(t,u){return this.jumpTo({bearing:t},u),this}getPadding(){return this.transform.padding}setPadding(t,u){return this.jumpTo({padding:t},u),this}rotateTo(t,u,p){return this.easeTo(a.e({bearing:t},u),p)}resetNorth(t,u){return this.rotateTo(0,a.e({duration:1e3},t),u),this}resetNorthPitch(t,u){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},t),u),this}snapToNorth(t,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,u):this}getPitch(){return this.transform.pitch}setPitch(t,u){return this.jumpTo({pitch:t},u),this}cameraForBounds(t,u){t=$e.convert(t).adjustAntiMeridian();const p=u&&u.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,u)}_cameraForBoxAndBearing(t,u,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Lt=m.padding;m.padding={top:Lt,bottom:Lt,right:Lt,left:Lt}}m.padding=a.e(b,m.padding);const A=this.transform,L=A.padding,D=new $e(t,u),Z=A.project(D.getNorthWest()),K=A.project(D.getNorthEast()),J=A.project(D.getSouthEast()),ae=A.project(D.getSouthWest()),_e=a.ba(-p),ke=Z.rotate(_e),Ie=K.rotate(_e),Oe=J.rotate(_e),Fe=ae.rotate(_e),je=new a.P(Math.max(ke.x,Ie.x,Fe.x,Oe.x),Math.max(ke.y,Ie.y,Fe.y,Oe.y)),Ce=new a.P(Math.min(ke.x,Ie.x,Fe.x,Oe.x),Math.min(ke.y,Ie.y,Fe.y,Oe.y)),He=je.sub(Ce),Ye=(A.width-(L.left+L.right+m.padding.left+m.padding.right))/He.x,nt=(A.height-(L.top+L.bottom+m.padding.top+m.padding.bottom))/He.y;if(nt<0||Ye<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const vt=Math.min(A.scaleZoom(A.scale*Math.min(Ye,nt)),m.maxZoom),Ct=a.P.convert(m.offset),Ft=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.ba(p)),Vt=Ct.add(Ft).mult(A.scale/A.zoomScale(vt));return{center:A.unproject(Z.add(J).div(2).sub(Vt)),zoom:vt,bearing:p}}fitBounds(t,u,p){return this._fitInternal(this.cameraForBounds(t,u),u,p)}fitScreenCoordinates(t,u,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(t)),this.transform.pointLocation(a.P.convert(u)),p,m),m,b)}_fitInternal(t,u,p){return t?(delete(u=a.e(t,u)).padding,u.linear?this.easeTo(u,p):this.flyTo(u,p)):this}jumpTo(t,u){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,A=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(m=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=a.N.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(b=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(A=!0,p.pitch=+t.pitch),t.padding==null||p.isPaddingEqual(t.padding)||(p.padding=t.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",u)).fire(new a.k("move",u)),m&&this.fire(new a.k("zoomstart",u)).fire(new a.k("zoom",u)).fire(new a.k("zoomend",u)),b&&this.fire(new a.k("rotatestart",u)).fire(new a.k("rotate",u)).fire(new a.k("rotateend",u)),A&&this.fire(new a.k("pitchstart",u)).fire(new a.k("pitch",u)).fire(new a.k("pitchend",u)),this.fire(new a.k("moveend",u))}calculateCameraOptionsFromTo(t,u,p,m=0){const b=a.Z.fromLngLat(t,u),A=a.Z.fromLngLat(p,m),L=A.x-b.x,D=A.y-b.y,Z=A.z-b.z,K=Math.hypot(L,D,Z);if(K===0)throw new Error("Can't calculate camera options with same From and To");const J=Math.hypot(L,D),ae=this.transform.scaleZoom(this.transform.cameraToCenterDistance/K/this.transform.tileSize),_e=180*Math.atan2(L,-D)/Math.PI;let ke=180*Math.acos(J/K)/Math.PI;return ke=Z<0?90-ke:90+ke,{center:A.toLngLat(),zoom:ae,pitch:ke,bearing:_e}}easeTo(t,u){var p;this._stop(!1,t.easeId),((t=a.e({offset:[0,0],duration:500,easing:a.b9},t)).animate===!1||!t.essential&&y.prefersReducedMotion)&&(t.duration=0);const m=this._getTransformForUpdate(),b=m.zoom,A=m.bearing,L=m.pitch,D=m.padding,Z="bearing"in t?this._normalizeBearing(t.bearing,A):A,K="pitch"in t?+t.pitch:L,J="padding"in t?t.padding:m.padding,ae=a.P.convert(t.offset);let _e=m.centerPoint.add(ae);const ke=m.pointLocation(_e),{center:Ie,zoom:Oe}=m.getConstrained(a.N.convert(t.center||ke),(p=t.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(Ie,m);const Fe=m.project(ke),je=m.project(Ie).sub(Fe),Ce=m.zoomScale(Oe-b);let He,Ye;t.around&&(He=a.N.convert(t.around),Ye=m.locationPoint(He));const nt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Oe!==b,this._rotating=this._rotating||A!==Z,this._pitching=this._pitching||K!==L,this._padding=!m.isPaddingEqual(J),this._easeId=t.easeId,this._prepareEase(u,t.noMoveStart,nt),this.terrain&&this._prepareElevation(Ie),this._ease(vt=>{if(this._zooming&&(m.zoom=a.y.number(b,Oe,vt)),this._rotating&&(m.bearing=a.y.number(A,Z,vt)),this._pitching&&(m.pitch=a.y.number(L,K,vt)),this._padding&&(m.interpolatePadding(D,J,vt),_e=m.centerPoint.add(ae)),this.terrain&&!t.freezeElevation&&this._updateElevation(vt),He)m.setLocationAtPoint(He,Ye);else{const Ct=m.zoomScale(m.zoom-b),Ft=Oe>b?Math.min(2,Ce):Math.max(.5,Ce),Vt=Math.pow(Ft,1-vt),Lt=m.unproject(Fe.add(je.mult(vt*Vt)).mult(Ct));m.setLocationAtPoint(m.renderWorldCopies?Lt.wrap():Lt,_e)}this._applyUpdatedTransform(m),this._fireMoveEvents(u)},vt=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(u,vt)},t),this}_prepareEase(t,u,p={}){this._moving=!0,u||p.moving||this.fire(new a.k("movestart",t)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&u!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(p-(u-(p*t+this._elevationStart))/(1-t)),this._elevationTarget=u}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){const u=t.getCameraPosition(),p=this.terrain.getElevationForLngLatZoom(u.lngLat,t.zoom);if(u.altitude<p){const m=this.calculateCameraOptionsFromTo(u.lngLat,p,t.center,t.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(t){const u=[];if(this.terrain&&u.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&u.push(m=>this.transformCameraUpdate(m)),!u.length)return;const p=t.clone();for(const m of u){const b=p.clone(),{center:A,zoom:L,pitch:D,bearing:Z,elevation:K}=m(b);A&&(b.center=A),L!==void 0&&(b.zoom=L),D!==void 0&&(b.pitch=D),Z!==void 0&&(b.bearing=Z),K!==void 0&&(b.elevation=K),p.apply(b)}this.transform.apply(p)}_fireMoveEvents(t){this.fire(new a.k("move",t)),this._zooming&&this.fire(new a.k("zoom",t)),this._rotating&&this.fire(new a.k("rotate",t)),this._pitching&&this.fire(new a.k("pitch",t))}_afterEase(t,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",t)),m&&this.fire(new a.k("rotateend",t)),b&&this.fire(new a.k("pitchend",t)),this.fire(new a.k("moveend",t))}flyTo(t,u){var p;if(!t.essential&&y.prefersReducedMotion){const Nt=a.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Nt,u)}this.stop(),t=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},t);const m=this._getTransformForUpdate(),b=m.zoom,A=m.bearing,L=m.pitch,D=m.padding,Z="bearing"in t?this._normalizeBearing(t.bearing,A):A,K="pitch"in t?+t.pitch:L,J="padding"in t?t.padding:m.padding,ae=a.P.convert(t.offset);let _e=m.centerPoint.add(ae);const ke=m.pointLocation(_e),{center:Ie,zoom:Oe}=m.getConstrained(a.N.convert(t.center||ke),(p=t.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(Ie,m);const Fe=m.zoomScale(Oe-b),je=m.project(ke),Ce=m.project(Ie).sub(je);let He=t.curve;const Ye=Math.max(m.width,m.height),nt=Ye/Fe,vt=Ce.mag();if("minZoom"in t){const Nt=a.ac(Math.min(t.minZoom,b,Oe),m.minZoom,m.maxZoom),bi=Ye/m.zoomScale(Nt-b);He=Math.sqrt(bi/vt*2)}const Ct=He*He;function Ft(Nt){const bi=(nt*nt-Ye*Ye+(Nt?-1:1)*Ct*Ct*vt*vt)/(2*(Nt?nt:Ye)*Ct*vt);return Math.log(Math.sqrt(bi*bi+1)-bi)}function Vt(Nt){return(Math.exp(Nt)-Math.exp(-Nt))/2}function Lt(Nt){return(Math.exp(Nt)+Math.exp(-Nt))/2}const Mt=Ft(!1);let Jt=function(Nt){return Lt(Mt)/Lt(Mt+He*Nt)},xi=function(Nt){return Ye*((Lt(Mt)*(Vt(bi=Mt+He*Nt)/Lt(bi))-Vt(Mt))/Ct)/vt;var bi},zt=(Ft(!0)-Mt)/He;if(Math.abs(vt)<1e-6||!isFinite(zt)){if(Math.abs(Ye-nt)<1e-6)return this.easeTo(t,u);const Nt=nt<Ye?-1:1;zt=Math.abs(Math.log(nt/Ye))/He,xi=()=>0,Jt=bi=>Math.exp(Nt*He*bi)}return t.duration="duration"in t?+t.duration:1e3*zt/("screenSpeed"in t?+t.screenSpeed/He:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=A!==Z,this._pitching=K!==L,this._padding=!m.isPaddingEqual(J),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Ie),this._ease(Nt=>{const bi=Nt*zt,gn=1/Jt(bi);m.zoom=Nt===1?Oe:b+m.scaleZoom(gn),this._rotating&&(m.bearing=a.y.number(A,Z,Nt)),this._pitching&&(m.pitch=a.y.number(L,K,Nt)),this._padding&&(m.interpolatePadding(D,J,Nt),_e=m.centerPoint.add(ae)),this.terrain&&!t.freezeElevation&&this._updateElevation(Nt);const Ai=Nt===1?Ie:m.unproject(je.add(Ce.mult(xi(bi))).mult(gn));m.setLocationAtPoint(m.renderWorldCopies?Ai.wrap():Ai,_e),this._applyUpdatedTransform(m),this._fireMoveEvents(u)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,u){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,u)}return t||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(t,u,p){p.animate===!1||p.duration===0?(t(1),u()):(this._easeStart=y.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,u){t=a.b3(t,-180,180);const p=Math.abs(t-u);return Math.abs(t-360-u)<p&&(t-=360),Math.abs(t+360-u)<p&&(t+=360),t}_normalizeCenter(t,u){if(!u.renderWorldCopies||u.lngRange)return;const p=t.lng-u.center.lng;t.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Na={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ja{constructor(t=Na){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,u){const p=this._map._getUIString(`AttributionControl.${u}`);t.title=p,t.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const u=this._map.style.sourceCaches;for(const m in u){const b=u[m];if(b.used||b.usedForTerrain){const A=b.getSource();A.attribution&&t.indexOf(A.attribution)<0&&t.push(A.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,b)=>m.length-b.length),t=t.filter((m,b)=>{for(let A=b+1;A<t.length;A++)if(t[A].indexOf(m)>=0)return!1;return!0});const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Su{constructor(t={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const p=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const u=C.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class qi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const u=++this._id;return this._queue.push({callback:t,id:u,cancelled:!1}),u}remove(t){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const m of p)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Tu=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class zf extends a.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,u){this.sourceCache.update(t,u),this._renderableTilesKeys=[];const p={};for(const m of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aP(m.posMatrix,0,a.X,0,a.X,0,1),this._tiles[m.key]=new Cn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(t){for(const u in this._tiles){const p=this._tiles[u];(!t||p.tileID.equals(t)||p.tileID.isChildOf(t)||t.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const u={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(t.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16),a.aP(b.posMatrix,0,a.X,0,a.X,0,1),u[p]=b}else if(m.canonical.isChildOf(t.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16);const A=m.canonical.z-t.canonical.z,L=m.canonical.x-(m.canonical.x>>A<<A),D=m.canonical.y-(m.canonical.y>>A<<A),Z=a.X>>A;a.aP(b.posMatrix,0,Z,0,Z,0,1),a.J(b.posMatrix,b.posMatrix,[-L*Z,-D*Z,0]),u[p]=b}else if(t.canonical.isChildOf(m.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16);const A=t.canonical.z-m.canonical.z,L=t.canonical.x-(t.canonical.x>>A<<A),D=t.canonical.y-(t.canonical.y>>A<<A),Z=a.X>>A;a.aP(b.posMatrix,0,a.X,0,a.X,0,1),a.J(b.posMatrix,b.posMatrix,[L*Z,D*Z,0]),a.K(b.posMatrix,b.posMatrix,[1/2**A,1/2**A,0]),u[p]=b}}return u}getSourceTile(t,u){const p=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!b||!b.dem)&&u)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(t.scaledTo(m--).key);return b}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(u=>u.timeAdded>=t)}}class Cu{constructor(t,u,p){this.painter=t,this.sourceCache=new zf(u),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,u,p,m=a.X){var b;if(!(u>=0&&u<m&&p>=0&&p<m))return 0;const A=this.getTerrainData(t),L=(b=A.tile)===null||b===void 0?void 0:b.dem;if(!L)return 0;const D=function(ke,Ie,Oe){var Fe=Ie[0],je=Ie[1];return ke[0]=Oe[0]*Fe+Oe[4]*je+Oe[12],ke[1]=Oe[1]*Fe+Oe[5]*je+Oe[13],ke}([],[u/m*a.X,p/m*a.X],A.u_terrain_matrix),Z=[D[0]*L.dim,D[1]*L.dim],K=Math.floor(Z[0]),J=Math.floor(Z[1]),ae=Z[0]-K,_e=Z[1]-J;return L.get(K,J)*(1-ae)*(1-_e)+L.get(K+1,J)*ae*(1-_e)+L.get(K,J+1)*(1-ae)*_e+L.get(K+1,J+1)*ae*_e}getElevationForLngLatZoom(t,u){if(!a.bb(u,t.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(t,u);return this.getElevation(p,m%a.X,b%a.X,a.X)}getElevation(t,u,p,m=a.X){return this.getDEMElevation(t,u,p,m)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new O(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new O(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const u=this.sourceCache.getSourceTile(t,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const m=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new O(m,u.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),u.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const p=u&&u+u.tileID.key+t.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=t.canonical.z-u.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?b=t.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=t.canonical.x-(t.canonical.x>>b<<b),L=t.canonical.y-(t.canonical.y>>b<<b),D=a.bc(new Float64Array(16),[1/(a.X<<b),1/(a.X<<b),0]);a.J(D,D,[A*a.X,L*a.X,0]),this._demMatrixCache[t.key]={matrix:D,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(t){const u=this.painter,p=u.width/devicePixelRatio,m=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new O(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new O(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,A=0;b<this._coordsTextureSize;b++)for(let L=0;L<this._coordsTextureSize;L++,A+=4)u[A+0]=255&L,u[A+1]=255&b,u[A+2]=L>>8<<4|b>>8,u[A+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),m=new O(t,p,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),A=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),L=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,L-A-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null);const D=u[0]+(u[2]>>4<<8),Z=u[1]+((15&u[2])<<8),K=this.coordsIndex[255-u[3]],J=K&&this.sourceCache.getTileByID(K);if(!J)return null;const ae=this._coordsTextureSize,_e=(1<<J.tileID.canonical.z)*ae;return new a.Z((J.tileID.canonical.x*ae+D)/_e+J.tileID.wrap,(J.tileID.canonical.y*ae+Z)/_e,this.getElevation(J.tileID,D,Z,ae))}depthAtPoint(t){const u=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,u=new a.bd,p=new a.aY,m=this.meshSize,b=a.X/m,A=m*m;for(let J=0;J<=m;J++)for(let ae=0;ae<=m;ae++)u.emplaceBack(ae*b,J*b,0);for(let J=0;J<A;J+=m+1)for(let ae=0;ae<m;ae++)p.emplaceBack(ae+J,m+ae+J+1,m+ae+J+2),p.emplaceBack(ae+J,m+ae+J+2,ae+J+1);const L=u.length,D=L+2*(m+1);for(const J of[0,1])for(let ae=0;ae<=m;ae++)for(const _e of[0,1])u.emplaceBack(ae*b,J*a.X,_e);for(let J=0;J<2*m;J+=2)p.emplaceBack(D+J,D+J+1,D+J+3),p.emplaceBack(D+J,D+J+3,D+J+2),p.emplaceBack(L+J,L+J+3,L+J+1),p.emplaceBack(L+J,L+J+2,L+J+3);const Z=u.length,K=Z+2*(m+1);for(const J of[0,1])for(let ae=0;ae<=m;ae++)for(const _e of[0,1])u.emplaceBack(J*a.X,ae*b,_e);for(let J=0;J<2*m;J+=2)p.emplaceBack(Z+J,Z+J+1,Z+J+3),p.emplaceBack(Z+J,Z+J+3,Z+J+2),p.emplaceBack(K+J,K+J+3,K+J+1),p.emplaceBack(K+J,K+J+2,K+J+3);return this._mesh=new So(t.createVertexBuffer(u,Tu.members),t.createIndexBuffer(p),a.a0.simpleSegment(0,0,u.length,p.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*a.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,u){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(t,u);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(t){const u=this.getTerrainData(t).tile,p={minElevation:null,maxElevation:null};return u&&u.dem&&(p.minElevation=u.dem.min*this.exaggeration,p.maxElevation=u.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(t,u){const p=a.Z.fromLngLat(t.wrap()),m=(1<<u)*a.X,b=p.x*m,A=p.y*m,L=Math.floor(b/a.X),D=Math.floor(A/a.X);return{tileID:new a.S(u,0,u,L,D),mercatorX:b,mercatorY:A}}}class Of{constructor(t,u,p){this._context=t,this._size=u,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new O(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(p.texture),{id:t,fbo:u,texture:p,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>t.id!==u),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Ua={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Eh{constructor(t,u){this.painter=t,this.terrain=u,this.pool=new Of(t.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(p=>!t._layers[p].isHidden(u)),this._coordsDescendingInv={};for(const p in t.sourceCaches){this._coordsDescendingInv[p]={};const m=t.sourceCaches[p].getVisibleCoordinates();for(const b of m){const A=this.terrain.sourceCache.getTerrainCoords(b);for(const L in A)this._coordsDescendingInv[p][L]||(this._coordsDescendingInv[p][L]=[]),this._coordsDescendingInv[p][L].push(A[L])}}this._coordsDescendingInvStr={};for(const p of t._order){const m=t._layers[p],b=m.source;if(Ua[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const A in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][A]=this._coordsDescendingInv[b][A].map(L=>L.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const u=t.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ua[u]&&(this._prevType&&Ua[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(t.id),!m))return!0;if(Ua[this._prevType]||Ua[u]&&m){this._prevType=u;const b=this._stacks.length-1,A=this._stacks[b]||[];for(const L of this._renderableTiles){if(this.pool.isFull()&&(_l(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(L),L.rtt[b]){const Z=this.pool.getObjectForId(L.rtt[b].id);if(Z.stamp===L.rtt[b].stamp){this.pool.useObject(Z);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),L.rtt[b]={id:D.id,stamp:D.stamp},p.context.bindFramebuffer.set(D.fbo.framebuffer),p.context.clear({color:a.aM.transparent,stencil:0}),p.currentStencilSource=void 0;for(let Z=0;Z<A.length;Z++){const K=p.style._layers[A[Z]],J=K.source?this._coordsDescendingInv[K.source][L.tileID.key]:[L.tileID];p.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),p._renderTileClippingMasks(K,J),p.renderLayer(p,p.style.sourceCaches[K.source],K,J),K.source&&(L.rttCoords[K.source]=this._coordsDescendingInvStr[K.source][L.tileID.key])}}return _l(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ua[u]}return!1}}const Eu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ih=_,Df={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Na,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Iu=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},Ff={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rf{constructor(t,u,p=!1){this.mousedown=A=>{this.startMouse(a.e({},A,{ctrlKey:!0,preventDefault:()=>A.preventDefault()}),C.mousePos(this.element,A)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.moveMouse(A,C.mousePos(this.element,A))},this.mouseup=A=>{this.mouseRotate.dragEnd(A),this.mousePitch&&this.mousePitch.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,A.targetTouches)[0],this.startTouch(A,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,A.targetTouches)[0],this.moveTouch(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=t.dragRotate._mouseRotate.getClickTolerance(),b=t.dragRotate._mousePitch.getClickTolerance();this.element=u,this.mouseRotate=xr({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:A,clickTolerance:L,bearingDegreesPerPixelMoved:D=.8})=>{const Z=new Wr;return new In({clickTolerance:L,move:(K,J)=>({bearingDelta:(J.x-K.x)*D}),moveStateManager:Z,enable:A,assignEvents:Iu})})({clickTolerance:m,enable:!0}),this.map=t,p&&(this.mousePitch=oo({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:A,clickTolerance:L,pitchDegreesPerPixelMoved:D=-.5})=>{const Z=new Wr;return new In({clickTolerance:L,move:(K,J)=>({pitchDelta:(J.y-K.y)*D}),moveStateManager:Z,enable:A,assignEvents:Iu})})({clickTolerance:b,enable:!0})),C.addEventListener(u,"mousedown",this.mousedown),C.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(u,"touchcancel",this.reset)}startMouse(t,u){this.mouseRotate.dragStart(t,u),this.mousePitch&&this.mousePitch.dragStart(t,u),C.disableDrag()}startTouch(t,u){this.touchRotate.dragStart(t,u),this.touchPitch&&this.touchPitch.dragStart(t,u),C.disableDrag()}moveMouse(t,u){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(t,u)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(t,u)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(t,u){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(t,u)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(t,u)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const t=this.element;C.removeEventListener(t,"mousedown",this.mousedown),C.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let Hr;function mn(v,t,u){const p=new a.N(v.lng,v.lat);if(v=new a.N(v.lng,v.lat),t){const m=new a.N(v.lng-360,v.lat),b=new a.N(v.lng+360,v.lat),A=u.locationPoint(v).distSqr(t);u.locationPoint(m).distSqr(t)<A?v=m:u.locationPoint(b).distSqr(t)<A&&(v=b)}for(;Math.abs(v.lng-u.center.lng)>180;){const m=u.locationPoint(v);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;v.lng>u.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&u.locationPoint(v).y>u.height/2-u.getHorizon()?v:p}const Va={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gc(v,t,u){const p=v.classList;for(const m in Va)p.remove(`maplibregl-${u}-anchor-${m}`);p.add(`maplibregl-${u}-anchor-${t}`)}class _c extends a.E{constructor(t){if(super(),this._onKeyPress=u=>{const p=u.code,m=u.charCode||u.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=u=>{const p=u.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=u=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?mn(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${Va[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${b}`),y.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div");const u=C.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${p}px`),u.setAttributeNS(null,"width",`${m}px`),u.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=C.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const A=C.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const L=C.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Fe of D){const je=C.createNS("http://www.w3.org/2000/svg","ellipse");je.setAttributeNS(null,"opacity","0.04"),je.setAttributeNS(null,"cx","10.5"),je.setAttributeNS(null,"cy","5.80029008"),je.setAttributeNS(null,"rx",Fe.rx),je.setAttributeNS(null,"ry",Fe.ry),L.appendChild(je)}const Z=C.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const K=C.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(K);const J=C.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"fill","#000000");const ae=C.createNS("http://www.w3.org/2000/svg","path");ae.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),J.appendChild(ae);const _e=C.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_e.setAttributeNS(null,"fill","#FFFFFF");const ke=C.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ie=C.createNS("http://www.w3.org/2000/svg","circle");Ie.setAttributeNS(null,"fill","#000000"),Ie.setAttributeNS(null,"opacity","0.25"),Ie.setAttributeNS(null,"cx","5.5"),Ie.setAttributeNS(null,"cy","5.5"),Ie.setAttributeNS(null,"r","5.4999962");const Oe=C.createNS("http://www.w3.org/2000/svg","circle");Oe.setAttributeNS(null,"fill","#FFFFFF"),Oe.setAttributeNS(null,"cx","5.5"),Oe.setAttributeNS(null,"cy","5.5"),Oe.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Ie),ke.appendChild(Oe),A.appendChild(L),A.appendChild(Z),A.appendChild(J),A.appendChild(_e),A.appendChild(ke),u.appendChild(A),u.setAttributeNS(null,"height",p*this._scale+"px"),u.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(u),this._offset=a.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),gc(this._element,this._anchor,"marker"),t&&t.className)for(const u of t.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var u,p;if(!(!((u=this._map)===null||u===void 0)&&u.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),A=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,A)-b<.006)return void(this._element.style.opacity=this._opacity);const L=-this._offset.y/m.transform._pixelPerMeter,D=Math.sin(m.getPitch()*Math.PI/180)*L,Z=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),K=m.transform.lngLatToCameraDepth(this._lngLat,A+D)-Z>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&K&&this._popup.remove(),this._element.style.opacity=K?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,u){return t===void 0&&u===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const Ah={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let kl=0,Sl=!1;const Bs={maxWidth:100,unit:"metric"};function Tl(v,t,u){const p=u&&u.maxWidth||100,m=v._container.clientHeight/2,b=v.unproject([0,m]),A=v.unproject([p,m]),L=b.distanceTo(A);if(u&&u.unit==="imperial"){const D=3.2808*L;D>5280?Kt(t,p,D/5280,v._getUIString("ScaleControl.Miles")):Kt(t,p,D,v._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Kt(t,p,L/1852,v._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Kt(t,p,L/1e3,v._getUIString("ScaleControl.Kilometers")):Kt(t,p,L,v._getUIString("ScaleControl.Meters"))}function Kt(v,t,u,p){const m=function(b){const A=Math.pow(10,`${Math.floor(b)}`.length-1);let L=b/A;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(D){const Z=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*Z)/Z}(L),A*L}(u);v.style.width=t*(m/u)+"px",v.innerHTML=`${m}&nbsp;${p}`}const di={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},yc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bc(v){if(v){if(typeof v=="number"){const t=Math.round(Math.abs(v)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,v),"top-left":new a.P(t,t),"top-right":new a.P(-t,t),bottom:new a.P(0,-v),"bottom-left":new a.P(t,-t),"bottom-right":new a.P(-t,-t),left:new a.P(v,0),right:new a.P(-v,0)}}if(v instanceof a.P||Array.isArray(v)){const t=a.P.convert(v);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.P.convert(v.center||[0,0]),top:a.P.convert(v.top||[0,0]),"top-left":a.P.convert(v["top-left"]||[0,0]),"top-right":a.P.convert(v["top-right"]||[0,0]),bottom:a.P.convert(v.bottom||[0,0]),"bottom-left":a.P.convert(v["bottom-left"]||[0,0]),"bottom-right":a.P.convert(v["bottom-right"]||[0,0]),left:a.P.convert(v.left||[0,0]),right:a.P.convert(v.right||[0,0])}}return bc(new a.P(0,0))}const Au=_;h.AJAXError=a.bh,h.Evented=a.E,h.LngLat=a.N,h.MercatorCoordinate=a.Z,h.Point=a.P,h.addProtocol=a.bi,h.config=a.a,h.removeProtocol=a.bj,h.AttributionControl=ja,h.BoxZoomHandler=It,h.CanvasSource=dt,h.CooperativeGesturesHandler=Ba,h.DoubleClickZoomHandler=ra,h.DragPanHandler=Sh,h.DragRotateHandler=Th,h.EdgeInsets=To,h.FullscreenControl=class extends a.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var t;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=u==null?void 0:u.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},h.GeoJSONSource=X,h.GeolocateControl=class extends a.E{constructor(v){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const u=new a.N(t.coords.longitude,t.coords.latitude),p=t.coords.accuracy,m=this._map.getBearing(),b=a.e({bearing:m},this.options.fitBoundsOptions),A=$e.fromLngLat(u,p);this._map.fitBounds(A,b,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const u=new a.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Sl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new _c({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _c({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},Ah,v)}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(t=!1){if(Hr!==void 0&&!t)return Hr;if(window.navigator.permissions===void 0)return Hr=!!window.navigator.geolocation,Hr;try{Hr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Hr=!!window.navigator.geolocation}return Hr})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,kl=0,Sl=!1}_isOutOfMapMaxBounds(v){const t=this._map.getMaxBounds(),u=v.coords;return t&&(u.longitude<t.getWest()||u.longitude>t.getEast()||u.latitude<t.getSouth()||u.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),t=v.getSouthEast(),u=v.getNorthEast(),p=t.distanceTo(u),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":kl--,Sl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),kl++,kl>1?(v={maximumAge:6e5,timeout:0},Sl=!0):(v=this.options.positionOptions,Sl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},h.Hash=Da,h.ImageSource=Me,h.KeyboardHandler=as,h.LngLatBounds=$e,h.LogoControl=Su,h.Map=class extends Ch{constructor(v){a.bf.mark(a.bg.create);const t=Object.assign(Object.assign({},Df),v);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Co(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new qi,this._controls=[],this._mapId=a.a4(),this._contextLost=u=>{u.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:u}))},this._contextRestored=u=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:u}))},this._onMapScroll=u=>{if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer===!0,this._antialias=t.antialias===!0,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles===!0,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions===!0,this._collectResourceTiming=t.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Eu),t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=t.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new Y(t.transformRequest),typeof t.container=="string"){if(this._container=document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let u=!1;const p=ta(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{u?p(m):u=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ku(this,t),this._hash=t.hash&&new Da(typeof t.hash=="string"&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,a.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new ja(typeof t.attributionControl=="boolean"?void 0:t.attributionControl)),t.maplibreLogo&&this.addControl(new Su,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new a.k(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new a.k(`${u.dataType}dataloading`,u))}),this.on("dataabort",u=>{this.fire(new a.k("sourcedataabort",u))})}_getMapId(){return this._mapId}addControl(v,t){if(t===void 0&&(t=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(v);return t>-1&&this._controls.splice(t,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,t,u,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,t,u,p)}resize(v){var t;const u=this._containerDimensions(),p=u[0],m=u[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const L=this.painter.context.gl;this._maxCanvasSize=[L.drawingBufferWidth,L.drawingBufferHeight];const D=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,D),this.painter.resize(p,m,D)}this.transform.resize(p,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(p,m);const A=!this._moving;return A&&(this.stop(),this.fire(new a.k("movestart",v)).fire(new a.k("move",v))),this.fire(new a.k("resize",v)),A&&this.fire(new a.k("moveend",v)),this}_getClampedPixelRatio(v,t){const{0:u,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=v*m,A=t*m;return Math.min(b>u?u/b:1,A>p?p/A:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds($e.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(a.N.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(a.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,t,u){if(v==="mouseenter"||v==="mouseover"){let p=!1;return{layers:t,listener:u,delegates:{mousemove:b=>{const A=t.filter(D=>this.getLayer(D)),L=A.length!==0?this.queryRenderedFeatures(b.point,{layers:A}):[];L.length?p||(p=!0,u.call(this,new Pn(v,this,b.originalEvent,{features:L}))):p=!1},mouseout:()=>{p=!1}}}}if(v==="mouseleave"||v==="mouseout"){let p=!1;return{layers:t,listener:u,delegates:{mousemove:A=>{const L=t.filter(D=>this.getLayer(D));(L.length!==0?this.queryRenderedFeatures(A.point,{layers:L}):[]).length?p=!0:p&&(p=!1,u.call(this,new Pn(v,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,u.call(this,new Pn(v,this,A.originalEvent)))}}}}{const p=m=>{const b=t.filter(L=>this.getLayer(L)),A=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];A.length&&(m.features=A,u.call(this,m),delete m.features)};return{layers:t,listener:u,delegates:{[v]:p}}}}_saveDelegatedListener(v,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(t)}_removeDelegatedListener(v,t,u){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const p=this._delegatedListeners[v];for(let m=0;m<p.length;m++){const b=p[m];if(b.listener===u&&b.layers.length===t.length&&b.layers.every(A=>t.includes(A))){for(const A in b.delegates)this.off(A,b.delegates[A]);return void p.splice(m,1)}}}on(v,t,u){if(u===void 0)return super.on(v,t);const p=this._createDelegatedListener(v,typeof t=="string"?[t]:t,u);this._saveDelegatedListener(v,p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(v,t,u){if(u===void 0)return super.once(v,t);const p=typeof t=="string"?[t]:t,m=this._createDelegatedListener(v,p,u);for(const b in m.delegates){const A=m.delegates[b];m.delegates[b]=(...L)=>{this._removeDelegatedListener(v,p,u),A(...L)}}this._saveDelegatedListener(v,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(v,t,u){return u===void 0?super.off(v,t):(this._removeDelegatedListener(v,typeof t=="string"?[t]:t,u),this)}queryRenderedFeatures(v,t){if(!this.style)return[];let u;const p=v instanceof a.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(p?{}:v)||{},m instanceof a.P||typeof m[0]=="number")u=[a.P.convert(m)];else{const b=a.P.convert(m[0]),A=a.P.convert(m[1]);u=[b,new a.P(A.x,b.y),A,new a.P(b.x,A.y),b]}return this.style.queryRenderedFeatures(u,t,this.transform)}querySourceFeatures(v,t){return this.style.querySourceFeatures(v,t)}setStyle(v,t){return(t=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(v,t))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const t=this._locale[v];if(t==null)throw new Error(`Missing UI string '${v}'`);return t}_updateStyle(v,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,t));const u=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new wa(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,t,u):this.style.loadJSON(v,t,u),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,t){if(typeof v=="string"){const u=this._requestManager.transformRequest(v,"Style");a.h(u,new AbortController).then(p=>{this._updateDiff(p.data,t)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof v=="object"&&this._updateDiff(v,t)}_updateDiff(v,t){try{this.style.setState(v,t)&&this._update(!0)}catch(u){a.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(v,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(v,t){return this._lazyInitEmptyStyle(),this.style.addSource(v,t),this._update(!0)}isSourceLoaded(v){const t=this.style&&this.style.sourceCaches[v];if(t!==void 0)return t.loaded();this.fire(new a.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const t=this.style.sourceCaches[v.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&t.reload();for(const u in this.style._layers){const p=this.style._layers[u];p.type==="hillshade"&&p.source===v.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Cu(this.painter,t,v),this.painter.renderToTexture=new Eh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=u=>{u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:v})),this}getTerrain(){var v,t;return(t=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const t in v){const u=v[t]._tiles;for(const p in u){const m=u[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,t,u={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:A,content:L,textFitWidth:D,textFitHeight:Z}=u;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||a.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:K,height:J,data:ae}=t,_e=t;return this.style.addImage(v,{data:new a.R({width:K,height:J},new Uint8Array(ae)),pixelRatio:p,stretchX:b,stretchY:A,content:L,textFitWidth:D,textFitHeight:Z,sdf:m,version:0,userImage:_e}),_e.onAdd&&_e.onAdd(this,v),this}}{const{width:K,height:J,data:ae}=y.getImageData(t);this.style.addImage(v,{data:new a.R({width:K,height:J},ae),pixelRatio:p,stretchX:b,stretchY:A,content:L,textFitWidth:D,textFitHeight:Z,sdf:m,version:0})}}updateImage(v,t){const u=this.style.getImage(v);if(!u)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||a.b(t)?y.getImageData(t):t,{width:m,height:b,data:A}=p;if(m===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==u.data.width||b!==u.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const L=!(t instanceof HTMLImageElement||a.b(t));return u.data.replace(A,L),this.style.updateImage(v,u),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return V.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,t){return this._lazyInitEmptyStyle(),this.style.addLayer(v,t),this._update(!0)}moveLayer(v,t){return this.style.moveLayer(v,t),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,t,u){return this.style.setLayerZoomRange(v,t,u),this._update(!0)}setFilter(v,t,u={}){return this.style.setFilter(v,t,u),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,t,u,p={}){return this.style.setPaintProperty(v,t,u,p),this._update(!0)}getPaintProperty(v,t){return this.style.getPaintProperty(v,t)}setLayoutProperty(v,t,u,p={}){return this.style.setLayoutProperty(v,t,u,p),this._update(!0)}getLayoutProperty(v,t){return this.style.getLayoutProperty(v,t)}setGlyphs(v,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,t,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,t,u,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,t,u=>{u||this._update(!0)}),this}setLight(v,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(v){return this._lazyInitEmptyStyle(),this.style.setSky(v),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,t){return this.style.setFeatureState(v,t),this._update()}removeFeatureState(v,t){return this.style.removeFeatureState(v,t),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,t=0;return this._container&&(v=this._container.clientWidth||400,t=this._container.clientHeight||300),[v,t]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const t=this._canvasContainer=C.create("div","maplibregl-canvas-container",v);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),p=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],p);const m=this._controlContainer=C.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{b[A]=C.create("div",`maplibregl-ctrl-${A} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,t,u){this._canvas.width=Math.floor(u*v),this._canvas.height=Math.floor(u*t),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{t={requestedAttributes:v},p&&(t.statusMessage=p.statusMessage,t.type=p.type)},{once:!0});const u=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!u){const p="Failed to initialize WebGL";throw t?(t.message=p,new Error(JSON.stringify(t))):new Error(p)}this.painter=new Oa(u,this.transform),E.testSupport(u)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=y.now();this.style.zoomHistory.update(m,b);const A=new a.z(m,{now:b,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=A.crossFadingFactor();L===1&&L===this._crossFadingFactor||(u=!0,this._crossFadingFactor=L),this.style.update(A)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(v=>{a.bf.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Ih}getCameraTargetElevation(){return this.transform.elevation}},h.MapMouseEvent=Pn,h.MapTouchEvent=Ne,h.MapWheelEvent=F,h.Marker=_c,h.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const t=this._map.getZoom(),u=t===this._map.getMaxZoom(),p=t===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,u)=>{const p=this._map._getUIString(`NavigationControl.${u}`);t.title=p,t.setAttribute("aria-label",p)},this.options=a.e({},Ff,v),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,t){const u=C.create("button",v,this._container);return u.type="button",u.addEventListener("click",t),u}},h.Popup=class extends a.E{constructor(v){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const L of this.options.className.split(" "))this._container.classList.add(L);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?mn(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!t)return;const p=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=bc(this.options.offset);if(!m){const L=this._container.offsetWidth,D=this._container.offsetHeight;let Z;Z=p.y+b.bottom.y<D?["top"]:p.y>this._map.transform.height-D?["bottom"]:[],p.x<L/2?Z.push("left"):p.x>this._map.transform.width-L/2&&Z.push("right"),m=Z.length===0?"bottom":Z.join("-")}let A=p.add(b[m]);this.options.subpixelPositioning||(A=A.round()),C.setTransform(this._container,`${Va[m]} translate(${A.x}px,${A.y}px)`),gc(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(di),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=a.N.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const t=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=v;p=u.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(yc);v&&v.focus()}},h.RasterDEMTileSource=fe,h.RasterTileSource=it,h.ScaleControl=class{constructor(v){this._onMove=()=>{Tl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Tl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Bs),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},h.ScrollZoomHandler=_s,h.Style=wa,h.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},h.TwoFingersTouchPitchHandler=xl,h.TwoFingersTouchRotateHandler=vu,h.TwoFingersTouchZoomHandler=yu,h.TwoFingersTouchZoomRotateHandler=xu,h.VectorTileSource=yt,h.VideoSource=Ze,h.addSourceType=(v,t)=>a._(void 0,void 0,void 0,function*(){if(Ci(v))throw new Error(`A source type called "${v}" already exists.`);((u,p)=>{st[u]=p})(v,t)}),h.clearPrewarmedResources=function(){const v=Ht;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Je),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},h.getRTLTextPluginStatus=function(){return Bi().getRTLTextPluginStatus()},h.getVersion=function(){return Au},h.getWorkerCount=function(){return wt.workerCount},h.getWorkerUrl=function(){return a.a.WORKER_URL},h.importScriptInWorkers=function(v){return Ti().broadcast("IS",v)},h.prewarm=function(){Mi().acquire(Je)},h.setMaxParallelImageRequests=function(v){a.a.MAX_PARALLEL_IMAGE_REQUESTS=v},h.setRTLTextPlugin=function(v,t){return Bi().setRTLTextPlugin(v,t)},h.setWorkerCount=function(v){wt.workerCount=v},h.setWorkerUrl=function(v){a.a.WORKER_URL=v}});var d=n;return d})})(X0);var nx=X0.exports;const Gs=F1(nx);function Pg(r){let e;return n=>{if(n)for(let o in n){let c=e==null?void 0:e[o],d=n[o];c!==d&&r(o,d,c)}else if(e)for(let o in e)r(o,void 0,e[o]);e=n}}function rx(r,...e){let n=[r];for(let o of e)if(o)Array.isArray(o)&&o[0]===r?n.push(...o.slice(1)):n.push(o);else continue;if(n.length!==1)return n.length===2?n[1]:n}function sx(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}var Wl=ox;function ox(r){var e,n,o;if(r){if(Array.isArray(r)){for(e=[],n=r.length,o=0;o<n;o++){var c=r[o];c!=null&&e.push(c)}return e}if(typeof r=="object"){e={};var d=Object.keys(r);for(n=d.length,o=0;o<n;o++){var h=d[o],a=r[h];a!=null&&(e[h]=a)}return e}}}function Lg(r){let e=r[0],n,o,c=zg(r);return{c(){c.c(),n=Mn()},m(d,h){c.m(d,h),be(d,n,h),o=!0},p(d,h){h[0]&1&&Yt(e,e=d[0])?(nn(),De(c,1,1,Ot),rn(),c=zg(d),c.c(),Pe(c,1),c.m(n.parentNode,n)):c.p(d,h)},i(d){o||(Pe(c),o=!0)},o(d){De(c),o=!1},d(d){d&&ye(n),c.d(d)}}}function zg(r){let e;const n=r[36].default,o=wn(n,r,r[35],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d[1]&16)&&kn(o,n,c,c[35],e?xn(n,c[35],d,null):Sn(c[35]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function ax(r){let e,n,o=r[0]&&Lg(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),be(c,e,d),n=!0},p(c,d){c[0]?o?(o.p(c,d),d[0]&1&&Pe(o,1)):(o=Lg(c),o.c(),Pe(o,1),o.m(e.parentNode,e)):o&&(nn(),De(o,1,1,()=>{o=null}),rn())},i(c){n||(Pe(o),n=!0)},o(c){De(o),n=!1},d(c){c&&ye(e),o&&o.d(c)}}}function lx(r,e,n){let o,c,d,h,a,_,S,k,y,C,E,T,{$$slots:M={},$$scope:R}=e,{id:N=vh("layer")}=e,{source:z=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:Y=void 0}=e,{beforeLayerType:se=void 0}=e,{type:$}=e,{paint:te=void 0}=e,{layout:U=void 0}=e,{filter:j=void 0}=e,{applyToClusters:G=void 0}=e,{minzoom:O=void 0}=e,{maxzoom:W=void 0}=e,{manageHoverState:le=!1}=e,{hovered:de=null}=e,{interactive:ve=!0}=e,{hoverCursor:pe=void 0}=e,{eventsIfTopMost:we=!1}=e;const Te=sl(),{map:Ae,source:ct,self:We,minzoom:pt,maxzoom:kt,eventTopMost:Je,layerInfo:wt}=ix();Bt(r,Ae,Xe=>n(31,y=Xe)),Bt(r,ct,Xe=>n(32,C=Xe)),Bt(r,We,Xe=>n(0,k=Xe)),Bt(r,pt,Xe=>n(34,T=Xe)),Bt(r,kt,Xe=>n(33,E=Xe)),ps(()=>{k&&y&&(wt.delete(k),y==null||y.removeLayer(k))});let Tt;function Ht(Xe){var yi,yt;if(!ve||!k||!y||we&&Je(Xe)!==k)return;let Pt=Xe.features??[],ni=(yt=(yi=Pt[0])==null?void 0:yi.properties)==null?void 0:yt.cluster_id,$e={event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt};Te(Xe.type,$e)}function li(Xe){var yi,yt;if(!ve||!k||!y||we&&Je(Xe)!==k)return;pe&&(y.getCanvas().style.cursor=pe);let Pt=Xe.features??[];n(6,de=Pt[0]??null);let ni=(yt=(yi=Pt[0])==null?void 0:yi.properties)==null?void 0:yt.cluster_id;Te("mouseenter",{event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt})}function Mi(Xe){var yi,yt,it;if(!ve||!y)return;if(we&&Je(Xe)!==k){n(6,de=null),le&&Tt!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:V,id:Tt},{hover:!1}),Tt=void 0);return}y.getCanvas().style.cursor=pe;let Pt=Xe.features??[],ni=(yt=(yi=Pt[0])==null?void 0:yi.properties)==null?void 0:yt.cluster_id,$e=(it=Pt[0])==null?void 0:it.id;$e!==Tt&&(le&&(Tt!==void 0&&(y==null||y.setFeatureState({source:a,id:Tt,sourceLayer:V},{hover:!1})),y==null||y.setFeatureState({source:a,id:$e,sourceLayer:V},{hover:!0})),Tt=$e,n(6,de=Pt[0]??null)),Te("mousemove",{event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt})}function Pi(Xe){if(!(!ve||!k||!y)){if(pe&&(y.getCanvas().style.cursor=""),n(6,de=null),le&&Tt!==void 0){const Pt={source:a,id:Tt,sourceLayer:V};y==null||y.setFeatureState(Pt,{hover:!1}),Tt=void 0}Te("mouseleave",{map:y,layer:k,source:a})}}let Ti=!0;function At(Xe){y&&(y.off("click",Xe,Ht),y.off("dblclick",Xe,Ht),y.off("contextmenu",Xe,Ht),y.off("mouseenter",Xe,li),y.off("mousemove",Xe,Mi),y.off("mouseleave",Xe,Pi))}return ps(()=>{y&&k&&At(k)}),r.$$set=Xe=>{"id"in Xe&&n(7,N=Xe.id),"source"in Xe&&n(8,z=Xe.source),"sourceLayer"in Xe&&n(9,V=Xe.sourceLayer),"beforeId"in Xe&&n(10,Y=Xe.beforeId),"beforeLayerType"in Xe&&n(11,se=Xe.beforeLayerType),"type"in Xe&&n(12,$=Xe.type),"paint"in Xe&&n(13,te=Xe.paint),"layout"in Xe&&n(14,U=Xe.layout),"filter"in Xe&&n(15,j=Xe.filter),"applyToClusters"in Xe&&n(16,G=Xe.applyToClusters),"minzoom"in Xe&&n(17,O=Xe.minzoom),"maxzoom"in Xe&&n(18,W=Xe.maxzoom),"manageHoverState"in Xe&&n(19,le=Xe.manageHoverState),"hovered"in Xe&&n(6,de=Xe.hovered),"interactive"in Xe&&n(20,ve=Xe.interactive),"hoverCursor"in Xe&&n(21,pe=Xe.hoverCursor),"eventsIfTopMost"in Xe&&n(22,we=Xe.eventsIfTopMost),"$$scope"in Xe&&n(35,R=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,o=sx(G)),r.$$.dirty[0]&1073774592&&n(24,c=rx("all",o,j)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,d=O??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,h=W??E),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,a=z||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&k!==N&&a){k&&(At(k),wt.delete(k));let Xe=Y;if(!Y&&se){let Pt=y.getStyle().layers,ni=typeof se=="function"?se:yi=>yi.type===se,$e=Pt==null?void 0:Pt.find(ni);$e&&(Xe=$e.id)}Qi(We,k=N,k),y.addLayer(Wl({id:k,type:$,source:a,"source-layer":V,filter:c,paint:te,layout:U,minzoom:d,maxzoom:h}),Xe),n(23,Ti=!0),y.on("click",k,Ht),y.on("dblclick",k,Ht),y.on("contextmenu",k,Ht),y.on("mouseenter",k,li),y.on("mousemove",k,Mi),y.on("mouseleave",k,Pi)}r.$$.dirty[0]&1048577&&k&&wt.set(k,{interactive:ve}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,_=k?Pg((Xe,Pt)=>y==null?void 0:y.setPaintProperty(k,Xe,Pt)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,S=k?Pg((Xe,Pt)=>y==null?void 0:y.setLayoutProperty(k,Xe,Pt)):void 0),r.$$.dirty[0]&268443648&&(_==null||_(te)),r.$$.dirty[0]&134234112&&(S==null||S(U)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(y==null||y.setLayerZoomRange(k,d,h)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(Ti?n(23,Ti=!1):y==null||y.setFilter(k,c))},[k,Ae,ct,We,pt,kt,de,N,z,V,Y,se,$,te,U,j,G,O,W,le,ve,pe,we,Ti,c,h,d,S,_,a,o,y,C,E,T,R,M]}let bp=class extends ai{constructor(e){super(),oi(this,e,lx,ax,Yt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function cx(r){let e;const n=r[16].default,o=wn(n,r,r[24],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&16777216)&&kn(o,n,c,c[24],e?xn(n,c[24],d,null):Sn(c[24]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function ux(r){let e,n,o;function c(h){r[17](h)}let d={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[cx]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new bp({props:d}),mi.push(()=>Ri(e,"hovered",c)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.applyToClusters=h[9]),a&1024&&(_.minzoom=h[10]),a&2048&&(_.maxzoom=h[11]),a&4096&&(_.hoverCursor=h[12]),a&8192&&(_.manageHoverState=h[13]),a&16384&&(_.eventsIfTopMost=h[14]),a&32768&&(_.interactive=h[15]),a&16777216&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function hx(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=vh("circle")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:Y=!0}=e;function se(W){z=W,n(0,z)}function $(W){Di.call(this,r,W)}function te(W){Di.call(this,r,W)}function U(W){Di.call(this,r,W)}function j(W){Di.call(this,r,W)}function G(W){Di.call(this,r,W)}function O(W){Di.call(this,r,W)}return r.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,h=W.source),"sourceLayer"in W&&n(3,a=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,S=W.beforeLayerType),"paint"in W&&n(6,k=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,C=W.filter),"applyToClusters"in W&&n(9,E=W.applyToClusters),"minzoom"in W&&n(10,T=W.minzoom),"maxzoom"in W&&n(11,M=W.maxzoom),"hoverCursor"in W&&n(12,R=W.hoverCursor),"manageHoverState"in W&&n(13,N=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,V=W.eventsIfTopMost),"interactive"in W&&n(15,Y=W.interactive),"$$scope"in W&&n(24,c=W.$$scope)},[z,d,h,a,_,S,k,y,C,E,T,M,R,N,V,Y,o,se,$,te,U,j,G,O,c]}let fx=class extends ai{constructor(e){super(),oi(this,e,hx,ux,Yt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function dx(r){let e;const n=r[15].default,o=wn(n,r,r[23],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&8388608)&&kn(o,n,c,c[23],e?xn(n,c[23],d,null):Sn(c[23]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function px(r){let e,n,o;function c(h){r[16](h)}let d={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[dx]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new bp({props:d}),mi.push(()=>Ri(e,"hovered",c)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.minzoom=h[9]),a&1024&&(_.maxzoom=h[10]),a&2048&&(_.hoverCursor=h[11]),a&4096&&(_.manageHoverState=h[12]),a&8192&&(_.eventsIfTopMost=h[13]),a&16384&&(_.interactive=h[14]),a&8388608&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function mx(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=vh("fill")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:R=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:V=!0}=e;function Y(O){N=O,n(0,N)}function se(O){Di.call(this,r,O)}function $(O){Di.call(this,r,O)}function te(O){Di.call(this,r,O)}function U(O){Di.call(this,r,O)}function j(O){Di.call(this,r,O)}function G(O){Di.call(this,r,O)}return r.$$set=O=>{"id"in O&&n(1,d=O.id),"source"in O&&n(2,h=O.source),"sourceLayer"in O&&n(3,a=O.sourceLayer),"beforeId"in O&&n(4,_=O.beforeId),"beforeLayerType"in O&&n(5,S=O.beforeLayerType),"paint"in O&&n(6,k=O.paint),"layout"in O&&n(7,y=O.layout),"filter"in O&&n(8,C=O.filter),"minzoom"in O&&n(9,E=O.minzoom),"maxzoom"in O&&n(10,T=O.maxzoom),"hoverCursor"in O&&n(11,M=O.hoverCursor),"manageHoverState"in O&&n(12,R=O.manageHoverState),"hovered"in O&&n(0,N=O.hovered),"eventsIfTopMost"in O&&n(13,z=O.eventsIfTopMost),"interactive"in O&&n(14,V=O.interactive),"$$scope"in O&&n(23,c=O.$$scope)},[N,d,h,a,_,S,k,y,C,E,T,M,R,z,V,o,Y,se,$,te,U,j,G,c]}let gx=class extends ai{constructor(e){super(),oi(this,e,mx,px,Yt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function _x(r,e,n,o,c){let d=!1;r.getSource(e)&&(d=!0,r.removeSource(e));const h=()=>{o(e)&&(r.addSource(e,n),c())};if(d){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):h())};a()}else h()}function yx(r,e,n){p0().then(()=>{let o=a0(r);if(!o)return;o.getSource(e)===n&&o.removeSource(e)})}function Og(r){let e=r[0],n,o,c=Dg(r);return{c(){c.c(),n=Mn()},m(d,h){c.m(d,h),be(d,n,h),o=!0},p(d,h){h&1&&Yt(e,e=d[0])?(nn(),De(c,1,1,Ot),rn(),c=Dg(d),c.c(),Pe(c,1),c.m(n.parentNode,n)):c.p(d,h)},i(d){o||(Pe(c),o=!0)},o(d){De(c),o=!1},d(d){d&&ye(n),c.d(d)}}}function Dg(r){let e;const n=r[15].default,o=wn(n,r,r[14],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&16384)&&kn(o,n,c,c[14],e?xn(n,c[14],d,null):Sn(c[14]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function bx(r){let e,n,o=r[0]&&Og(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),be(c,e,d),n=!0},p(c,[d]){c[0]?o?(o.p(c,d),d&1&&Pe(o,1)):(o=Og(c),o.c(),Pe(o,1),o.m(e.parentNode,e)):o&&(nn(),De(o,1,1,()=>{o=null}),rn())},i(c){n||(Pe(o),n=!0)},o(c){De(o),n=!1},d(c){c&&ye(e),o&&o.d(c)}}}function vx(r,e,n){let o,c,d,{$$slots:h={},$$scope:a}=e,{id:_=vh("geojson")}=e,{data:S}=e,{generateId:k=!1}=e,{promoteId:y=void 0}=e,{filter:C=void 0}=e,{lineMetrics:E=void 0}=e,{cluster:T=void 0}=e;const{map:M,cluster:R,self:N}=tx();Bt(r,M,Y=>n(13,c=Y)),Bt(r,R,Y=>n(16,d=Y)),Bt(r,N,Y=>n(0,o=Y));let z,V=!0;return ps(()=>{o&&z&&c&&(yx(M,o,z),Qi(N,o=null,o),n(11,z=void 0))}),r.$$set=Y=>{"id"in Y&&n(4,_=Y.id),"data"in Y&&n(5,S=Y.data),"generateId"in Y&&n(6,k=Y.generateId),"promoteId"in Y&&n(7,y=Y.promoteId),"filter"in Y&&n(8,C=Y.filter),"lineMetrics"in Y&&n(9,E=Y.lineMetrics),"cluster"in Y&&n(10,T=Y.cluster),"$$scope"in Y&&n(14,a=Y.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Qi(R,d=T,d),r.$$.dirty&12273&&c&&o!==_&&(Qi(N,o=_,o),_x(c,o,Wl({type:"geojson",data:S,filter:C,lineMetrics:E,generateId:k,promoteId:y,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties}),Y=>c&&Y===o,()=>{o&&(n(11,z=c==null?void 0:c.getSource(o)),n(12,V=!0))})),r.$$.dirty&8208&&(c==null||c.on("style.load",()=>{n(11,z=c==null?void 0:c.getSource(_))})),r.$$.dirty&6176&&z&&(V?n(12,V=!1):z.setData(S)),r.$$.dirty&3072&&(z==null||z.setClusterOptions(Wl({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[o,M,R,N,_,S,k,y,C,E,T,z,V,c,a,h]}let wx=class extends ai{constructor(e){super(),oi(this,e,vx,bx,Yt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}};function xx(r){let e;const n=r[15].default,o=wn(n,r,r[23],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&8388608)&&kn(o,n,c,c[23],e?xn(n,c[23],d,null):Sn(c[23]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function kx(r){let e,n,o;function c(h){r[16](h)}let d={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[xx]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new bp({props:d}),mi.push(()=>Ri(e,"hovered",c)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.minzoom=h[9]),a&1024&&(_.maxzoom=h[10]),a&2048&&(_.hoverCursor=h[11]),a&4096&&(_.manageHoverState=h[12]),a&8192&&(_.eventsIfTopMost=h[13]),a&16384&&(_.interactive=h[14]),a&8388608&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function Sx(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=vh("line")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:R=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:V=!0}=e;function Y(O){N=O,n(0,N)}function se(O){Di.call(this,r,O)}function $(O){Di.call(this,r,O)}function te(O){Di.call(this,r,O)}function U(O){Di.call(this,r,O)}function j(O){Di.call(this,r,O)}function G(O){Di.call(this,r,O)}return r.$$set=O=>{"id"in O&&n(1,d=O.id),"source"in O&&n(2,h=O.source),"sourceLayer"in O&&n(3,a=O.sourceLayer),"beforeId"in O&&n(4,_=O.beforeId),"beforeLayerType"in O&&n(5,S=O.beforeLayerType),"paint"in O&&n(6,k=O.paint),"layout"in O&&n(7,y=O.layout),"filter"in O&&n(8,C=O.filter),"minzoom"in O&&n(9,E=O.minzoom),"maxzoom"in O&&n(10,T=O.maxzoom),"hoverCursor"in O&&n(11,M=O.hoverCursor),"manageHoverState"in O&&n(12,R=O.manageHoverState),"hovered"in O&&n(0,N=O.hovered),"eventsIfTopMost"in O&&n(13,z=O.eventsIfTopMost),"interactive"in O&&n(14,V=O.interactive),"$$scope"in O&&n(23,c=O.$$scope)},[N,d,h,a,_,S,k,y,C,E,T,M,R,z,V,o,Y,se,$,te,U,j,G,c]}let Tx=class extends ai{constructor(e){super(),oi(this,e,Sx,kx,Yt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};var Nc=vp;function vp(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?Fg(r,e):{}.toString.call(r)=="[object Set]"?Fg(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?Ex(r,e):Cx(r,e)}function Cx(r,e){return r.toString()===e.toString()}function Fg(r,e){var n=r.length;if(n!=e.length)return!1;for(var o=0;o<n;o++)if(!vp(r[o],e[o]))return!1;return!0}function Ex(r,e){var n=Object.keys(r),o=n.length;if(o!=Object.keys(e).length)return!1;for(var c=0;c<o;c++){var d=n[c];if(!(e.hasOwnProperty(d)&&vp(r[d],e[d])))return!1}return!0}var wh=Uint8Array,J0=Uint16Array,Ix=Int32Array,Ax=new wh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Mx=new wh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Y0=function(r,e){for(var n=new J0(31),o=0;o<31;++o)n[o]=e+=1<<r[o-1];for(var c=new Ix(n[30]),o=1;o<30;++o)for(var d=n[o];d<n[o+1];++d)c[d]=d-n[o]<<5|o;return{b:n,r:c}},Q0=Y0(Ax,2),Px=Q0.b,Lx=Q0.r;Px[28]=258,Lx[258]=28;Y0(Mx,0);var zx=new J0(32768);for(ln=0;ln<32768;++ln)ua=(ln&43690)>>1|(ln&21845)<<1,ua=(ua&52428)>>2|(ua&13107)<<2,ua=(ua&61680)>>4|(ua&3855)<<4,zx[ln]=((ua&65280)>>8|(ua&255)<<8)>>1;var ua,ln,Tf=new wh(288);for(ln=0;ln<144;++ln)Tf[ln]=8;var ln;for(ln=144;ln<256;++ln)Tf[ln]=9;var ln;for(ln=256;ln<280;++ln)Tf[ln]=7;var ln;for(ln=280;ln<288;++ln)Tf[ln]=8;var ln,Ox=new wh(32);for(ln=0;ln<32;++ln)Ox[ln]=5;var ln,Dx=new wh(0),Fx=typeof TextDecoder<"u"&&new TextDecoder,Rx=0;try{Fx.decode(Dx,{stream:!0}),Rx=1}catch{}function Bx(r){let e,n,o,c,d,h;return e=new gx({props:{id:"edit-polygon-fill",filter:qw,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),o=new Tx({props:{id:"edit-polygon-lines",filter:Zw,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),d=new fx({props:{id:"edit-polygon-vertices",filter:Ww,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment),c=Ue(),lt(d.$$.fragment)},m(a,_){ot(e,a,_),be(a,n,_),ot(o,a,_),be(a,c,_),ot(d,a,_),h=!0},p:Ot,i(a){h||(Pe(e.$$.fragment,a),Pe(o.$$.fragment,a),Pe(d.$$.fragment,a),h=!0)},o(a){De(e.$$.fragment,a),De(o.$$.fragment,a),De(d.$$.fragment,a),h=!1},d(a){a&&(ye(n),ye(c)),at(e,a),at(o,a),at(d,a)}}}function Nx(r){let e,n;return e=new wx({props:{data:r[0],$$slots:{default:[Bx]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,[c]){const d={};c&1&&(d.data=o[0]),c&2&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function jx(r,e,n){let o;return Bt(r,Z0,c=>n(0,o=c)),[o]}class Ux extends ai{constructor(e){super(),oi(this,e,jx,Nx,Yt,{})}}const Vx=r=>({}),Rg=r=>({}),qx=r=>({}),Bg=r=>({}),Zx=r=>({}),Ng=r=>({});function Wx(r){let e,n,o,c,d,h,a,_;const S=r[1].top,k=wn(S,r,r[0],Ng),y=r[1].left,C=wn(y,r,r[0],Bg),E=r[1].main,T=wn(E,r,r[0],Rg);return{c(){e=xe("div"),n=xe("div"),k&&k.c(),o=Ue(),c=xe("div"),d=xe("div"),C&&C.c(),h=Ue(),a=xe("div"),T&&T.c(),he(n,"class","top svelte-29q570"),he(d,"class","left svelte-29q570"),he(a,"class","main svelte-29q570"),he(c,"class","content svelte-29q570"),he(e,"class","flex-container svelte-29q570")},m(M,R){be(M,e,R),ce(e,n),k&&k.m(n,null),ce(e,o),ce(e,c),ce(c,d),C&&C.m(d,null),ce(c,h),ce(c,a),T&&T.m(a,null),_=!0},p(M,[R]){k&&k.p&&(!_||R&1)&&kn(k,S,M,M[0],_?xn(S,M[0],R,Zx):Sn(M[0]),Ng),C&&C.p&&(!_||R&1)&&kn(C,y,M,M[0],_?xn(y,M[0],R,qx):Sn(M[0]),Bg),T&&T.p&&(!_||R&1)&&kn(T,E,M,M[0],_?xn(E,M[0],R,Vx):Sn(M[0]),Rg)},i(M){_||(Pe(k,M),Pe(C,M),Pe(T,M),_=!0)},o(M){De(k,M),De(C,M),De(T,M),_=!1},d(M){M&&ye(e),k&&k.d(M),C&&C.d(M),T&&T.d(M)}}}function Gx(r,e,n){let{$$slots:o={},$$scope:c}=e;return r.$$set=d=>{"$$scope"in d&&n(0,c=d.$$scope)},[c,o]}class Hx extends ai{constructor(e){super(),oi(this,e,Gx,Wx,Yt,{})}}const Xx=r=>({}),jg=r=>({}),Kx=r=>({}),Ug=r=>({}),Jx=r=>({}),Vg=r=>({});function Yx(r){let e,n,o,c,d,h;const a=r[4].top,_=wn(a,r,r[3],Vg),S=r[4].sidebar,k=wn(S,r,r[3],Ug),y=r[4].map,C=wn(y,r,r[3],jg);return{c(){e=xe("div"),_&&_.c(),n=Ue(),o=xe("div"),k&&k.c(),c=Ue(),d=xe("div"),C&&C.c()},m(E,T){be(E,e,T),_&&_.m(e,null),r[5](e),be(E,n,T),be(E,o,T),k&&k.m(o,null),r[6](o),be(E,c,T),be(E,d,T),C&&C.m(d,null),r[7](d),h=!0},p(E,[T]){_&&_.p&&(!h||T&8)&&kn(_,a,E,E[3],h?xn(a,E[3],T,Jx):Sn(E[3]),Vg),k&&k.p&&(!h||T&8)&&kn(k,S,E,E[3],h?xn(S,E[3],T,Kx):Sn(E[3]),Ug),C&&C.p&&(!h||T&8)&&kn(C,y,E,E[3],h?xn(y,E[3],T,Xx):Sn(E[3]),jg)},i(E){h||(Pe(_,E),Pe(k,E),Pe(C,E),h=!0)},o(E){De(_,E),De(k,E),De(C,E),h=!1},d(E){E&&(ye(e),ye(n),ye(o),ye(c),ye(d)),_&&_.d(E),r[5](null),k&&k.d(E),r[6](null),C&&C.d(E),r[7](null)}}}function Qx(r,e,n){let o,c,d;Bt(r,qg,y=>n(0,o=y)),Bt(r,Wd,y=>n(1,c=y)),Bt(r,Gd,y=>n(2,d=y));let{$$slots:h={},$$scope:a}=e;function _(y){mi[y?"unshift":"push"](()=>{o=y,qg.set(o)})}function S(y){mi[y?"unshift":"push"](()=>{c=y,Wd.set(c)})}function k(y){mi[y?"unshift":"push"](()=>{d=y,Gd.set(d)})}return r.$$set=y=>{"$$scope"in y&&n(3,a=y.$$scope)},[o,c,d,a,h,_,S,k]}class xh extends ai{constructor(e){super(),oi(this,e,Qx,Yx,Yt,{})}}let qg=vn(null),Wd=vn(null),Gd=vn(null);function $x(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return U0(r,o=>{n[0]>o[0]&&(n[0]=o[0]),n[1]>o[1]&&(n[1]=o[1]),n[2]<o[0]&&(n[2]=o[0]),n[3]<o[1]&&(n[3]=o[1])}),n}var e2=$x,t2=Object.defineProperty,i2=(r,e,n)=>e in r?t2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,gi=(r,e,n)=>i2(r,typeof e!="symbol"?e+"":e,n);function fh(){}function $0(r){return r()}function Zg(){return Object.create(null)}function Cf(r){r.forEach($0)}function eb(r){return typeof r=="function"}function n2(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function r2(r){return Object.keys(r).length===0}function s2(r,e){r.appendChild(e)}function o2(r,e,n){r.insertBefore(e,n||null)}function tb(r){r.parentNode&&r.parentNode.removeChild(r)}function Wg(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function tl(r,e,n){n==null?r.removeAttribute(e):r.getAttribute(e)!==n&&r.setAttribute(e,n)}function a2(r){return Array.from(r.childNodes)}function nf(r,e,n){r.classList.toggle(e,!!n)}let wp;function ah(r){wp=r}const qc=[],Gg=[];let Kc=[];const Hg=[],l2=Promise.resolve();let Hd=!1;function c2(){Hd||(Hd=!0,l2.then(ib))}function Xd(r){Kc.push(r)}const Pd=new Set;let jc=0;function ib(){if(jc!==0)return;const r=wp;do{try{for(;jc<qc.length;){const e=qc[jc];jc++,ah(e),u2(e.$$)}}catch(e){throw qc.length=0,jc=0,e}for(ah(null),qc.length=0,jc=0;Gg.length;)Gg.pop()();for(let e=0;e<Kc.length;e+=1){const n=Kc[e];Pd.has(n)||(Pd.add(n),n())}Kc.length=0}while(qc.length);for(;Hg.length;)Hg.pop()();Hd=!1,Pd.clear(),ah(r)}function u2(r){if(r.fragment!==null){r.update(),Cf(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Xd)}}function h2(r){const e=[],n=[];Kc.forEach(o=>r.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),Kc=e}const f2=new Set;function d2(r,e){r&&r.i&&(f2.delete(r),r.i(e))}function p2(r,e,n){const{fragment:o,after_update:c}=r.$$;o&&o.m(e,n),Xd(()=>{const d=r.$$.on_mount.map($0).filter(eb);r.$$.on_destroy?r.$$.on_destroy.push(...d):Cf(d),r.$$.on_mount=[]}),c.forEach(Xd)}function m2(r,e){const n=r.$$;n.fragment!==null&&(h2(n.after_update),Cf(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function g2(r,e){r.$$.dirty[0]===-1&&(qc.push(r),c2(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function _2(r,e,n,o,c,d,h=null,a=[-1]){const _=wp;ah(r);const S=r.$$={fragment:null,ctx:[],props:d,update:fh,not_equal:c,bound:Zg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Zg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};h&&h(S.root);let k=!1;if(S.ctx=n?n(r,e.props||{},(y,C,...E)=>{const T=E.length?E[0]:C;return S.ctx&&c(S.ctx[y],S.ctx[y]=T)&&(!S.skip_bound&&S.bound[y]&&S.bound[y](T),k&&g2(r,y)),C}):[],S.update(),k=!0,Cf(S.before_update),S.fragment=o?o(S.ctx):!1,e.target){if(e.hydrate){const y=a2(e.target);S.fragment&&S.fragment.l(y),y.forEach(tb)}else S.fragment&&S.fragment.c();e.intro&&d2(r.$$.fragment),p2(r,e.target,e.anchor),ib()}ah(_)}class y2{constructor(){gi(this,"$$"),gi(this,"$$set")}$destroy(){m2(this,1),this.$destroy=fh}$on(e,n){if(!eb(n))return fh;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const c=o.indexOf(n);c!==-1&&o.splice(c,1)}}$set(e){this.$$set&&!r2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const b2="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(b2);function v2(r){let e,n,o;return{c(){e=Wg("svg"),n=Wg("path"),tl(n,"stroke-width","4"),tl(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),tl(n,"class","svelte-gzo3ar"),tl(e,"width",o=r[0]==="list"?20:void 0),tl(e,"viewBox","0 0 70 85"),tl(e,"fill","none"),tl(e,"class","svelte-gzo3ar"),nf(e,"in-map",r[0]!=="list"),nf(e,"list-icon",r[0]==="list")},m(c,d){o2(c,e,d),s2(e,n)},p(c,[d]){d&1&&o!==(o=c[0]==="list"?20:void 0)&&tl(e,"width",o),d&1&&nf(e,"in-map",c[0]!=="list"),d&1&&nf(e,"list-icon",c[0]==="list")},i:fh,o:fh,d(c){c&&tb(e)}}}function w2(r,e,n){let{displayIn:o}=e;return r.$$set=c=>{"displayIn"in c&&n(0,o=c.displayIn)},[o]}class x2 extends y2{constructor(e){super(),_2(this,e,w2,v2,n2,{displayIn:0})}}function Xg(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}const k2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],S2={decimalLatitude:40.123,decimalLongitude:-74.123},T2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],C2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function E2(){const r=[];return k2.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...S2})}),[...r,...T2,...C2]}const I2=E2();I2.map(r=>r.verbatimCoordinates);function dh(r,e,n={}){const o={type:"Feature"};return(n.id===0||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=e||{},o.geometry=r,o}function xp(r,e,n={}){for(const o of r){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let c=0;c<o[o.length-1].length;c++)if(o[o.length-1][c]!==o[0][c])throw new Error("First and last Position are not equivalent.")}return dh({type:"Polygon",coordinates:r},e,n)}function ph(r,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=r,n}function nb(r,e,n={}){return dh({type:"MultiPolygon",coordinates:r},e,n)}var A2=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Ld=Math.ceil,Zs=Math.floor,ds="[BigNumber Error] ",Kg=ds+"Number primitive has more than 15 significant digits: ",uo=1e14,Oi=14,Jg=9007199254740991,zd=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],il=1e7,Cs=1e9;function rb(r){var e,n,o,c=z.prototype={constructor:z,toString:null,valueOf:null},d=new z(1),h=20,a=4,_=-7,S=21,k=-1e7,y=1e7,C=!1,E=1,T=0,M={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},R="0123456789abcdefghijklmnopqrstuvwxyz",N=!0;function z(U,j){var G,O,W,le,de,ve,pe,we,Te=this;if(!(Te instanceof z))return new z(U,j);if(j==null){if(U&&U._isBigNumber===!0){Te.s=U.s,!U.c||U.e>y?Te.c=Te.e=null:U.e<k?Te.c=[Te.e=0]:(Te.e=U.e,Te.c=U.c.slice());return}if((ve=typeof U=="number")&&U*0==0){if(Te.s=1/U<0?(U=-U,-1):1,U===~~U){for(le=0,de=U;de>=10;de/=10,le++);le>y?Te.c=Te.e=null:(Te.e=le,Te.c=[U]);return}we=String(U)}else{if(!A2.test(we=String(U)))return o(Te,we,ve);Te.s=we.charCodeAt(0)==45?(we=we.slice(1),-1):1}(le=we.indexOf("."))>-1&&(we=we.replace(".","")),(de=we.search(/e/i))>0?(le<0&&(le=de),le+=+we.slice(de+1),we=we.substring(0,de)):le<0&&(le=we.length)}else{if(Fn(j,2,R.length,"Base"),j==10&&N)return Te=new z(U),$(Te,h+Te.e+1,a);if(we=String(U),ve=typeof U=="number"){if(U*0!=0)return o(Te,we,ve,j);if(Te.s=1/U<0?(we=we.slice(1),-1):1,z.DEBUG&&we.replace(/^0\.0*|\./,"").length>15)throw Error(Kg+U)}else Te.s=we.charCodeAt(0)===45?(we=we.slice(1),-1):1;for(G=R.slice(0,j),le=de=0,pe=we.length;de<pe;de++)if(G.indexOf(O=we.charAt(de))<0){if(O=="."){if(de>le){le=pe;continue}}else if(!W&&(we==we.toUpperCase()&&(we=we.toLowerCase())||we==we.toLowerCase()&&(we=we.toUpperCase()))){W=!0,de=-1,le=0;continue}return o(Te,String(U),ve,j)}ve=!1,we=n(we,j,10,Te.s),(le=we.indexOf("."))>-1?we=we.replace(".",""):le=we.length}for(de=0;we.charCodeAt(de)===48;de++);for(pe=we.length;we.charCodeAt(--pe)===48;);if(we=we.slice(de,++pe)){if(pe-=de,ve&&z.DEBUG&&pe>15&&(U>Jg||U!==Zs(U)))throw Error(Kg+Te.s*U);if((le=le-de-1)>y)Te.c=Te.e=null;else if(le<k)Te.c=[Te.e=0];else{if(Te.e=le,Te.c=[],de=(le+1)%Oi,le<0&&(de+=Oi),de<pe){for(de&&Te.c.push(+we.slice(0,de)),pe-=Oi;de<pe;)Te.c.push(+we.slice(de,de+=Oi));de=Oi-(we=we.slice(de)).length}else de-=pe;for(;de--;we+="0");Te.c.push(+we)}}else Te.c=[Te.e=0]}z.clone=rb,z.ROUND_UP=0,z.ROUND_DOWN=1,z.ROUND_CEIL=2,z.ROUND_FLOOR=3,z.ROUND_HALF_UP=4,z.ROUND_HALF_DOWN=5,z.ROUND_HALF_EVEN=6,z.ROUND_HALF_CEIL=7,z.ROUND_HALF_FLOOR=8,z.EUCLID=9,z.config=z.set=function(U){var j,G;if(U!=null)if(typeof U=="object"){if(U.hasOwnProperty(j="DECIMAL_PLACES")&&(G=U[j],Fn(G,0,Cs,j),h=G),U.hasOwnProperty(j="ROUNDING_MODE")&&(G=U[j],Fn(G,0,8,j),a=G),U.hasOwnProperty(j="EXPONENTIAL_AT")&&(G=U[j],G&&G.pop?(Fn(G[0],-1e9,0,j),Fn(G[1],0,Cs,j),_=G[0],S=G[1]):(Fn(G,-1e9,Cs,j),_=-(S=G<0?-G:G))),U.hasOwnProperty(j="RANGE"))if(G=U[j],G&&G.pop)Fn(G[0],-1e9,-1,j),Fn(G[1],1,Cs,j),k=G[0],y=G[1];else if(Fn(G,-1e9,Cs,j),G)k=-(y=G<0?-G:G);else throw Error(ds+j+" cannot be zero: "+G);if(U.hasOwnProperty(j="CRYPTO"))if(G=U[j],G===!!G)if(G)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))C=G;else throw C=!G,Error(ds+"crypto unavailable");else C=G;else throw Error(ds+j+" not true or false: "+G);if(U.hasOwnProperty(j="MODULO_MODE")&&(G=U[j],Fn(G,0,9,j),E=G),U.hasOwnProperty(j="POW_PRECISION")&&(G=U[j],Fn(G,0,Cs,j),T=G),U.hasOwnProperty(j="FORMAT"))if(G=U[j],typeof G=="object")M=G;else throw Error(ds+j+" not an object: "+G);if(U.hasOwnProperty(j="ALPHABET"))if(G=U[j],typeof G=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(G))N=G.slice(0,10)=="0123456789",R=G;else throw Error(ds+j+" invalid: "+G)}else throw Error(ds+"Object expected: "+U);return{DECIMAL_PLACES:h,ROUNDING_MODE:a,EXPONENTIAL_AT:[_,S],RANGE:[k,y],CRYPTO:C,MODULO_MODE:E,POW_PRECISION:T,FORMAT:M,ALPHABET:R}},z.isBigNumber=function(U){if(!U||U._isBigNumber!==!0)return!1;if(!z.DEBUG)return!0;var j,G,O=U.c,W=U.e,le=U.s;e:if({}.toString.call(O)=="[object Array]"){if((le===1||le===-1)&&W>=-1e9&&W<=Cs&&W===Zs(W)){if(O[0]===0){if(W===0&&O.length===1)return!0;break e}if(j=(W+1)%Oi,j<1&&(j+=Oi),String(O[0]).length==j){for(j=0;j<O.length;j++)if(G=O[j],G<0||G>=uo||G!==Zs(G))break e;if(G!==0)return!0}}}else if(O===null&&W===null&&(le===null||le===1||le===-1))return!0;throw Error(ds+"Invalid BigNumber: "+U)},z.maximum=z.max=function(){return Y(arguments,-1)},z.minimum=z.min=function(){return Y(arguments,1)},z.random=function(){var U=9007199254740992,j=Math.random()*U&2097151?function(){return Zs(Math.random()*U)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(G){var O,W,le,de,ve,pe=0,we=[],Te=new z(d);if(G==null?G=h:Fn(G,0,Cs),de=Ld(G/Oi),C)if(crypto.getRandomValues){for(O=crypto.getRandomValues(new Uint32Array(de*=2));pe<de;)ve=O[pe]*131072+(O[pe+1]>>>11),ve>=9e15?(W=crypto.getRandomValues(new Uint32Array(2)),O[pe]=W[0],O[pe+1]=W[1]):(we.push(ve%1e14),pe+=2);pe=de/2}else if(crypto.randomBytes){for(O=crypto.randomBytes(de*=7);pe<de;)ve=(O[pe]&31)*281474976710656+O[pe+1]*1099511627776+O[pe+2]*4294967296+O[pe+3]*16777216+(O[pe+4]<<16)+(O[pe+5]<<8)+O[pe+6],ve>=9e15?crypto.randomBytes(7).copy(O,pe):(we.push(ve%1e14),pe+=7);pe=de/7}else throw C=!1,Error(ds+"crypto unavailable");if(!C)for(;pe<de;)ve=j(),ve<9e15&&(we[pe++]=ve%1e14);for(de=we[--pe],G%=Oi,de&&G&&(ve=zd[Oi-G],we[pe]=Zs(de/ve)*ve);we[pe]===0;we.pop(),pe--);if(pe<0)we=[le=0];else{for(le=-1;we[0]===0;we.splice(0,1),le-=Oi);for(pe=1,ve=we[0];ve>=10;ve/=10,pe++);pe<Oi&&(le-=Oi-pe)}return Te.e=le,Te.c=we,Te}}(),z.sum=function(){for(var U=1,j=arguments,G=new z(j[0]);U<j.length;)G=G.plus(j[U++]);return G},n=function(){var U="0123456789";function j(G,O,W,le){for(var de,ve=[0],pe,we=0,Te=G.length;we<Te;){for(pe=ve.length;pe--;ve[pe]*=O);for(ve[0]+=le.indexOf(G.charAt(we++)),de=0;de<ve.length;de++)ve[de]>W-1&&(ve[de+1]==null&&(ve[de+1]=0),ve[de+1]+=ve[de]/W|0,ve[de]%=W)}return ve.reverse()}return function(G,O,W,le,de){var ve,pe,we,Te,Ae,ct,We,pt,kt=G.indexOf("."),Je=h,wt=a;for(kt>=0&&(Te=T,T=0,G=G.replace(".",""),pt=new z(O),ct=pt.pow(G.length-kt),T=Te,pt.c=j(ha(Vs(ct.c),ct.e,"0"),10,W,U),pt.e=pt.c.length),We=j(G,O,W,de?(ve=R,U):(ve=U,R)),we=Te=We.length;We[--Te]==0;We.pop());if(!We[0])return ve.charAt(0);if(kt<0?--we:(ct.c=We,ct.e=we,ct.s=le,ct=e(ct,pt,Je,wt,W),We=ct.c,Ae=ct.r,we=ct.e),pe=we+Je+1,kt=We[pe],Te=W/2,Ae=Ae||pe<0||We[pe+1]!=null,Ae=wt<4?(kt!=null||Ae)&&(wt==0||wt==(ct.s<0?3:2)):kt>Te||kt==Te&&(wt==4||Ae||wt==6&&We[pe-1]&1||wt==(ct.s<0?8:7)),pe<1||!We[0])G=Ae?ha(ve.charAt(1),-Je,ve.charAt(0)):ve.charAt(0);else{if(We.length=pe,Ae)for(--W;++We[--pe]>W;)We[pe]=0,pe||(++we,We=[1].concat(We));for(Te=We.length;!We[--Te];);for(kt=0,G="";kt<=Te;G+=ve.charAt(We[kt++]));G=ha(G,we,ve.charAt(0))}return G}}(),e=function(){function U(O,W,le){var de,ve,pe,we,Te=0,Ae=O.length,ct=W%il,We=W/il|0;for(O=O.slice();Ae--;)pe=O[Ae]%il,we=O[Ae]/il|0,de=We*pe+we*ct,ve=ct*pe+de%il*il+Te,Te=(ve/le|0)+(de/il|0)+We*we,O[Ae]=ve%le;return Te&&(O=[Te].concat(O)),O}function j(O,W,le,de){var ve,pe;if(le!=de)pe=le>de?1:-1;else for(ve=pe=0;ve<le;ve++)if(O[ve]!=W[ve]){pe=O[ve]>W[ve]?1:-1;break}return pe}function G(O,W,le,de){for(var ve=0;le--;)O[le]-=ve,ve=O[le]<W[le]?1:0,O[le]=ve*de+O[le]-W[le];for(;!O[0]&&O.length>1;O.splice(0,1));}return function(O,W,le,de,ve){var pe,we,Te,Ae,ct,We,pt,kt,Je,wt,Tt,Ht,li,Mi,Pi,Ti,At,Xe=O.s==W.s?1:-1,Pt=O.c,ni=W.c;if(!Pt||!Pt[0]||!ni||!ni[0])return new z(!O.s||!W.s||(Pt?ni&&Pt[0]==ni[0]:!ni)?NaN:Pt&&Pt[0]==0||!ni?Xe*0:Xe/0);for(kt=new z(Xe),Je=kt.c=[],we=O.e-W.e,Xe=le+we+1,ve||(ve=uo,we=Ws(O.e/Oi)-Ws(W.e/Oi),Xe=Xe/Oi|0),Te=0;ni[Te]==(Pt[Te]||0);Te++);if(ni[Te]>(Pt[Te]||0)&&we--,Xe<0)Je.push(1),Ae=!0;else{for(Mi=Pt.length,Ti=ni.length,Te=0,Xe+=2,ct=Zs(ve/(ni[0]+1)),ct>1&&(ni=U(ni,ct,ve),Pt=U(Pt,ct,ve),Ti=ni.length,Mi=Pt.length),li=Ti,wt=Pt.slice(0,Ti),Tt=wt.length;Tt<Ti;wt[Tt++]=0);At=ni.slice(),At=[0].concat(At),Pi=ni[0],ni[1]>=ve/2&&Pi++;do{if(ct=0,pe=j(ni,wt,Ti,Tt),pe<0){if(Ht=wt[0],Ti!=Tt&&(Ht=Ht*ve+(wt[1]||0)),ct=Zs(Ht/Pi),ct>1)for(ct>=ve&&(ct=ve-1),We=U(ni,ct,ve),pt=We.length,Tt=wt.length;j(We,wt,pt,Tt)==1;)ct--,G(We,Ti<pt?At:ni,pt,ve),pt=We.length,pe=1;else ct==0&&(pe=ct=1),We=ni.slice(),pt=We.length;if(pt<Tt&&(We=[0].concat(We)),G(wt,We,Tt,ve),Tt=wt.length,pe==-1)for(;j(ni,wt,Ti,Tt)<1;)ct++,G(wt,Ti<Tt?At:ni,Tt,ve),Tt=wt.length}else pe===0&&(ct++,wt=[0]);Je[Te++]=ct,wt[0]?wt[Tt++]=Pt[li]||0:(wt=[Pt[li]],Tt=1)}while((li++<Mi||wt[0]!=null)&&Xe--);Ae=wt[0]!=null,Je[0]||Je.splice(0,1)}if(ve==uo){for(Te=1,Xe=Je[0];Xe>=10;Xe/=10,Te++);$(kt,le+(kt.e=Te+we*Oi-1)+1,de,Ae)}else kt.e=we,kt.r=+Ae;return kt}}();function V(U,j,G,O){var W,le,de,ve,pe;if(G==null?G=a:Fn(G,0,8),!U.c)return U.toString();if(W=U.c[0],de=U.e,j==null)pe=Vs(U.c),pe=O==1||O==2&&(de<=_||de>=S)?sf(pe,de):ha(pe,de,"0");else if(U=$(new z(U),j,G),le=U.e,pe=Vs(U.c),ve=pe.length,O==1||O==2&&(j<=le||le<=_)){for(;ve<j;pe+="0",ve++);pe=sf(pe,le)}else if(j-=de,pe=ha(pe,le,"0"),le+1>ve){if(--j>0)for(pe+=".";j--;pe+="0");}else if(j+=le-ve,j>0)for(le+1==ve&&(pe+=".");j--;pe+="0");return U.s<0&&W?"-"+pe:pe}function Y(U,j){for(var G,O,W=1,le=new z(U[0]);W<U.length;W++)O=new z(U[W]),(!O.s||(G=Fl(le,O))===j||G===0&&le.s===j)&&(le=O);return le}function se(U,j,G){for(var O=1,W=j.length;!j[--W];j.pop());for(W=j[0];W>=10;W/=10,O++);return(G=O+G*Oi-1)>y?U.c=U.e=null:G<k?U.c=[U.e=0]:(U.e=G,U.c=j),U}o=function(){var U=/^(-?)0([xbo])(?=\w[\w.]*$)/i,j=/^([^.]+)\.$/,G=/^\.([^.]+)$/,O=/^-?(Infinity|NaN)$/,W=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(le,de,ve,pe){var we,Te=ve?de:de.replace(W,"");if(O.test(Te))le.s=isNaN(Te)?null:Te<0?-1:1;else{if(!ve&&(Te=Te.replace(U,function(Ae,ct,We){return we=(We=We.toLowerCase())=="x"?16:We=="b"?2:8,!pe||pe==we?ct:Ae}),pe&&(we=pe,Te=Te.replace(j,"$1").replace(G,"0.$1")),de!=Te))return new z(Te,we);if(z.DEBUG)throw Error(ds+"Not a"+(pe?" base "+pe:"")+" number: "+de);le.s=null}le.c=le.e=null}}();function $(U,j,G,O){var W,le,de,ve,pe,we,Te,Ae=U.c,ct=zd;if(Ae){e:{for(W=1,ve=Ae[0];ve>=10;ve/=10,W++);if(le=j-W,le<0)le+=Oi,de=j,pe=Ae[we=0],Te=Zs(pe/ct[W-de-1]%10);else if(we=Ld((le+1)/Oi),we>=Ae.length)if(O){for(;Ae.length<=we;Ae.push(0));pe=Te=0,W=1,le%=Oi,de=le-Oi+1}else break e;else{for(pe=ve=Ae[we],W=1;ve>=10;ve/=10,W++);le%=Oi,de=le-Oi+W,Te=de<0?0:Zs(pe/ct[W-de-1]%10)}if(O=O||j<0||Ae[we+1]!=null||(de<0?pe:pe%ct[W-de-1]),O=G<4?(Te||O)&&(G==0||G==(U.s<0?3:2)):Te>5||Te==5&&(G==4||O||G==6&&(le>0?de>0?pe/ct[W-de]:0:Ae[we-1])%10&1||G==(U.s<0?8:7)),j<1||!Ae[0])return Ae.length=0,O?(j-=U.e+1,Ae[0]=ct[(Oi-j%Oi)%Oi],U.e=-j||0):Ae[0]=U.e=0,U;if(le==0?(Ae.length=we,ve=1,we--):(Ae.length=we+1,ve=ct[Oi-le],Ae[we]=de>0?Zs(pe/ct[W-de]%ct[de])*ve:0),O)for(;;)if(we==0){for(le=1,de=Ae[0];de>=10;de/=10,le++);for(de=Ae[0]+=ve,ve=1;de>=10;de/=10,ve++);le!=ve&&(U.e++,Ae[0]==uo&&(Ae[0]=1));break}else{if(Ae[we]+=ve,Ae[we]!=uo)break;Ae[we--]=0,ve=1}for(le=Ae.length;Ae[--le]===0;Ae.pop());}U.e>y?U.c=U.e=null:U.e<k&&(U.c=[U.e=0])}return U}function te(U){var j,G=U.e;return G===null?U.toString():(j=Vs(U.c),j=G<=_||G>=S?sf(j,G):ha(j,G,"0"),U.s<0?"-"+j:j)}return c.absoluteValue=c.abs=function(){var U=new z(this);return U.s<0&&(U.s=1),U},c.comparedTo=function(U,j){return Fl(this,new z(U,j))},c.decimalPlaces=c.dp=function(U,j){var G,O,W,le=this;if(U!=null)return Fn(U,0,Cs),j==null?j=a:Fn(j,0,8),$(new z(le),U+le.e+1,j);if(!(G=le.c))return null;if(O=((W=G.length-1)-Ws(this.e/Oi))*Oi,W=G[W])for(;W%10==0;W/=10,O--);return O<0&&(O=0),O},c.dividedBy=c.div=function(U,j){return e(this,new z(U,j),h,a)},c.dividedToIntegerBy=c.idiv=function(U,j){return e(this,new z(U,j),0,1)},c.exponentiatedBy=c.pow=function(U,j){var G,O,W,le,de,ve,pe,we,Te,Ae=this;if(U=new z(U),U.c&&!U.isInteger())throw Error(ds+"Exponent not an integer: "+te(U));if(j!=null&&(j=new z(j)),ve=U.e>14,!Ae.c||!Ae.c[0]||Ae.c[0]==1&&!Ae.e&&Ae.c.length==1||!U.c||!U.c[0])return Te=new z(Math.pow(+te(Ae),ve?U.s*(2-rf(U)):+te(U))),j?Te.mod(j):Te;if(pe=U.s<0,j){if(j.c?!j.c[0]:!j.s)return new z(NaN);O=!pe&&Ae.isInteger()&&j.isInteger(),O&&(Ae=Ae.mod(j))}else{if(U.e>9&&(Ae.e>0||Ae.e<-1||(Ae.e==0?Ae.c[0]>1||ve&&Ae.c[1]>=24e7:Ae.c[0]<8e13||ve&&Ae.c[0]<=9999975e7)))return le=Ae.s<0&&rf(U)?-0:0,Ae.e>-1&&(le=1/le),new z(pe?1/le:le);T&&(le=Ld(T/Oi+2))}for(ve?(G=new z(.5),pe&&(U.s=1),we=rf(U)):(W=Math.abs(+te(U)),we=W%2),Te=new z(d);;){if(we){if(Te=Te.times(Ae),!Te.c)break;le?Te.c.length>le&&(Te.c.length=le):O&&(Te=Te.mod(j))}if(W){if(W=Zs(W/2),W===0)break;we=W%2}else if(U=U.times(G),$(U,U.e+1,1),U.e>14)we=rf(U);else{if(W=+te(U),W===0)break;we=W%2}Ae=Ae.times(Ae),le?Ae.c&&Ae.c.length>le&&(Ae.c.length=le):O&&(Ae=Ae.mod(j))}return O?Te:(pe&&(Te=d.div(Te)),j?Te.mod(j):le?$(Te,T,a,de):Te)},c.integerValue=function(U){var j=new z(this);return U==null?U=a:Fn(U,0,8),$(j,j.e+1,U)},c.isEqualTo=c.eq=function(U,j){return Fl(this,new z(U,j))===0},c.isFinite=function(){return!!this.c},c.isGreaterThan=c.gt=function(U,j){return Fl(this,new z(U,j))>0},c.isGreaterThanOrEqualTo=c.gte=function(U,j){return(j=Fl(this,new z(U,j)))===1||j===0},c.isInteger=function(){return!!this.c&&Ws(this.e/Oi)>this.c.length-2},c.isLessThan=c.lt=function(U,j){return Fl(this,new z(U,j))<0},c.isLessThanOrEqualTo=c.lte=function(U,j){return(j=Fl(this,new z(U,j)))===-1||j===0},c.isNaN=function(){return!this.s},c.isNegative=function(){return this.s<0},c.isPositive=function(){return this.s>0},c.isZero=function(){return!!this.c&&this.c[0]==0},c.minus=function(U,j){var G,O,W,le,de=this,ve=de.s;if(U=new z(U,j),j=U.s,!ve||!j)return new z(NaN);if(ve!=j)return U.s=-j,de.plus(U);var pe=de.e/Oi,we=U.e/Oi,Te=de.c,Ae=U.c;if(!pe||!we){if(!Te||!Ae)return Te?(U.s=-j,U):new z(Ae?de:NaN);if(!Te[0]||!Ae[0])return Ae[0]?(U.s=-j,U):new z(Te[0]?de:a==3?-0:0)}if(pe=Ws(pe),we=Ws(we),Te=Te.slice(),ve=pe-we){for((le=ve<0)?(ve=-ve,W=Te):(we=pe,W=Ae),W.reverse(),j=ve;j--;W.push(0));W.reverse()}else for(O=(le=(ve=Te.length)<(j=Ae.length))?ve:j,ve=j=0;j<O;j++)if(Te[j]!=Ae[j]){le=Te[j]<Ae[j];break}if(le&&(W=Te,Te=Ae,Ae=W,U.s=-U.s),j=(O=Ae.length)-(G=Te.length),j>0)for(;j--;Te[G++]=0);for(j=uo-1;O>ve;){if(Te[--O]<Ae[O]){for(G=O;G&&!Te[--G];Te[G]=j);--Te[G],Te[O]+=uo}Te[O]-=Ae[O]}for(;Te[0]==0;Te.splice(0,1),--we);return Te[0]?se(U,Te,we):(U.s=a==3?-1:1,U.c=[U.e=0],U)},c.modulo=c.mod=function(U,j){var G,O,W=this;return U=new z(U,j),!W.c||!U.s||U.c&&!U.c[0]?new z(NaN):!U.c||W.c&&!W.c[0]?new z(W):(E==9?(O=U.s,U.s=1,G=e(W,U,0,3),U.s=O,G.s*=O):G=e(W,U,0,E),U=W.minus(G.times(U)),!U.c[0]&&E==1&&(U.s=W.s),U)},c.multipliedBy=c.times=function(U,j){var G,O,W,le,de,ve,pe,we,Te,Ae,ct,We,pt,kt,Je,wt=this,Tt=wt.c,Ht=(U=new z(U,j)).c;if(!Tt||!Ht||!Tt[0]||!Ht[0])return!wt.s||!U.s||Tt&&!Tt[0]&&!Ht||Ht&&!Ht[0]&&!Tt?U.c=U.e=U.s=null:(U.s*=wt.s,!Tt||!Ht?U.c=U.e=null:(U.c=[0],U.e=0)),U;for(O=Ws(wt.e/Oi)+Ws(U.e/Oi),U.s*=wt.s,pe=Tt.length,Ae=Ht.length,pe<Ae&&(pt=Tt,Tt=Ht,Ht=pt,W=pe,pe=Ae,Ae=W),W=pe+Ae,pt=[];W--;pt.push(0));for(kt=uo,Je=il,W=Ae;--W>=0;){for(G=0,ct=Ht[W]%Je,We=Ht[W]/Je|0,de=pe,le=W+de;le>W;)we=Tt[--de]%Je,Te=Tt[de]/Je|0,ve=We*we+Te*ct,we=ct*we+ve%Je*Je+pt[le]+G,G=(we/kt|0)+(ve/Je|0)+We*Te,pt[le--]=we%kt;pt[le]=G}return G?++O:pt.splice(0,1),se(U,pt,O)},c.negated=function(){var U=new z(this);return U.s=-U.s||null,U},c.plus=function(U,j){var G,O=this,W=O.s;if(U=new z(U,j),j=U.s,!W||!j)return new z(NaN);if(W!=j)return U.s=-j,O.minus(U);var le=O.e/Oi,de=U.e/Oi,ve=O.c,pe=U.c;if(!le||!de){if(!ve||!pe)return new z(W/0);if(!ve[0]||!pe[0])return pe[0]?U:new z(ve[0]?O:W*0)}if(le=Ws(le),de=Ws(de),ve=ve.slice(),W=le-de){for(W>0?(de=le,G=pe):(W=-W,G=ve),G.reverse();W--;G.push(0));G.reverse()}for(W=ve.length,j=pe.length,W-j<0&&(G=pe,pe=ve,ve=G,j=W),W=0;j;)W=(ve[--j]=ve[j]+pe[j]+W)/uo|0,ve[j]=uo===ve[j]?0:ve[j]%uo;return W&&(ve=[W].concat(ve),++de),se(U,ve,de)},c.precision=c.sd=function(U,j){var G,O,W,le=this;if(U!=null&&U!==!!U)return Fn(U,1,Cs),j==null?j=a:Fn(j,0,8),$(new z(le),U,j);if(!(G=le.c))return null;if(W=G.length-1,O=W*Oi+1,W=G[W]){for(;W%10==0;W/=10,O--);for(W=G[0];W>=10;W/=10,O++);}return U&&le.e+1>O&&(O=le.e+1),O},c.shiftedBy=function(U){return Fn(U,-9007199254740991,Jg),this.times("1e"+U)},c.squareRoot=c.sqrt=function(){var U,j,G,O,W,le=this,de=le.c,ve=le.s,pe=le.e,we=h+4,Te=new z("0.5");if(ve!==1||!de||!de[0])return new z(!ve||ve<0&&(!de||de[0])?NaN:de?le:1/0);if(ve=Math.sqrt(+te(le)),ve==0||ve==1/0?(j=Vs(de),(j.length+pe)%2==0&&(j+="0"),ve=Math.sqrt(+j),pe=Ws((pe+1)/2)-(pe<0||pe%2),ve==1/0?j="5e"+pe:(j=ve.toExponential(),j=j.slice(0,j.indexOf("e")+1)+pe),G=new z(j)):G=new z(ve+""),G.c[0]){for(pe=G.e,ve=pe+we,ve<3&&(ve=0);;)if(W=G,G=Te.times(W.plus(e(le,W,we,1))),Vs(W.c).slice(0,ve)===(j=Vs(G.c)).slice(0,ve))if(G.e<pe&&--ve,j=j.slice(ve-3,ve+1),j=="9999"||!O&&j=="4999"){if(!O&&($(W,W.e+h+2,0),W.times(W).eq(le))){G=W;break}we+=4,ve+=4,O=1}else{(!+j||!+j.slice(1)&&j.charAt(0)=="5")&&($(G,G.e+h+2,1),U=!G.times(G).eq(le));break}}return $(G,G.e+h+1,a,U)},c.toExponential=function(U,j){return U!=null&&(Fn(U,0,Cs),U++),V(this,U,j,1)},c.toFixed=function(U,j){return U!=null&&(Fn(U,0,Cs),U=U+this.e+1),V(this,U,j)},c.toFormat=function(U,j,G){var O,W=this;if(G==null)U!=null&&j&&typeof j=="object"?(G=j,j=null):U&&typeof U=="object"?(G=U,U=j=null):G=M;else if(typeof G!="object")throw Error(ds+"Argument not an object: "+G);if(O=W.toFixed(U,j),W.c){var le,de=O.split("."),ve=+G.groupSize,pe=+G.secondaryGroupSize,we=G.groupSeparator||"",Te=de[0],Ae=de[1],ct=W.s<0,We=ct?Te.slice(1):Te,pt=We.length;if(pe&&(le=ve,ve=pe,pe=le,pt-=le),ve>0&&pt>0){for(le=pt%ve||ve,Te=We.substr(0,le);le<pt;le+=ve)Te+=we+We.substr(le,ve);pe>0&&(Te+=we+We.slice(le)),ct&&(Te="-"+Te)}O=Ae?Te+(G.decimalSeparator||"")+((pe=+G.fractionGroupSize)?Ae.replace(new RegExp("\\d{"+pe+"}\\B","g"),"$&"+(G.fractionGroupSeparator||"")):Ae):Te}return(G.prefix||"")+O+(G.suffix||"")},c.toFraction=function(U){var j,G,O,W,le,de,ve,pe,we,Te,Ae,ct,We=this,pt=We.c;if(U!=null&&(ve=new z(U),!ve.isInteger()&&(ve.c||ve.s!==1)||ve.lt(d)))throw Error(ds+"Argument "+(ve.isInteger()?"out of range: ":"not an integer: ")+te(ve));if(!pt)return new z(We);for(j=new z(d),we=G=new z(d),O=pe=new z(d),ct=Vs(pt),le=j.e=ct.length-We.e-1,j.c[0]=zd[(de=le%Oi)<0?Oi+de:de],U=!U||ve.comparedTo(j)>0?le>0?j:we:ve,de=y,y=1/0,ve=new z(ct),pe.c[0]=0;Te=e(ve,j,0,1),W=G.plus(Te.times(O)),W.comparedTo(U)!=1;)G=O,O=W,we=pe.plus(Te.times(W=we)),pe=W,j=ve.minus(Te.times(W=j)),ve=W;return W=e(U.minus(G),O,0,1),pe=pe.plus(W.times(we)),G=G.plus(W.times(O)),pe.s=we.s=We.s,le=le*2,Ae=e(we,O,le,a).minus(We).abs().comparedTo(e(pe,G,le,a).minus(We).abs())<1?[we,O]:[pe,G],y=de,Ae},c.toNumber=function(){return+te(this)},c.toPrecision=function(U,j){return U!=null&&Fn(U,1,Cs),V(this,U,j,2)},c.toString=function(U){var j,G=this,O=G.s,W=G.e;return W===null?O?(j="Infinity",O<0&&(j="-"+j)):j="NaN":(U==null?j=W<=_||W>=S?sf(Vs(G.c),W):ha(Vs(G.c),W,"0"):U===10&&N?(G=$(new z(G),h+W+1,a),j=ha(Vs(G.c),G.e,"0")):(Fn(U,2,R.length,"Base"),j=n(ha(Vs(G.c),W,"0"),10,U,O,!0)),O<0&&G.c[0]&&(j="-"+j)),j},c.valueOf=c.toJSON=function(){return te(this)},c._isBigNumber=!0,c[Symbol.toStringTag]="BigNumber",c[Symbol.for("nodejs.util.inspect.custom")]=c.valueOf,r!=null&&z.set(r),z}function Ws(r){var e=r|0;return r>0||r===e?e:e-1}function Vs(r){for(var e,n,o=1,c=r.length,d=r[0]+"";o<c;){for(e=r[o++]+"",n=Oi-e.length;n--;e="0"+e);d+=e}for(c=d.length;d.charCodeAt(--c)===48;);return d.slice(0,c+1||1)}function Fl(r,e){var n,o,c=r.c,d=e.c,h=r.s,a=e.s,_=r.e,S=e.e;if(!h||!a)return null;if(n=c&&!c[0],o=d&&!d[0],n||o)return n?o?0:-a:h;if(h!=a)return h;if(n=h<0,o=_==S,!c||!d)return o?0:!c^n?1:-1;if(!o)return _>S^n?1:-1;for(a=(_=c.length)<(S=d.length)?_:S,h=0;h<a;h++)if(c[h]!=d[h])return c[h]>d[h]^n?1:-1;return _==S?0:_>S^n?1:-1}function Fn(r,e,n,o){if(r<e||r>n||r!==Zs(r))throw Error(ds+(o||"Argument")+(typeof r=="number"?r<e||r>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(r))}function rf(r){var e=r.c.length-1;return Ws(r.e/Oi)==e&&r.c[e]%2!=0}function sf(r,e){return(r.length>1?r.charAt(0)+"."+r.slice(1):r)+(e<0?"e":"e+")+e}function ha(r,e,n){var o,c;if(e<0){for(c=n+".";++e;c+=n);r=c+r}else if(o=r.length,++e>o){for(c=n,e-=o;--e;c+=n);r+=c}else e<o&&(r=r.slice(0,e)+"."+r.slice(e));return r}var Fo=rb(),M2=class{constructor(r){gi(this,"key"),gi(this,"left",null),gi(this,"right",null),this.key=r}},Ku=class extends M2{constructor(r){super(r)}},P2=class{constructor(){gi(this,"size",0),gi(this,"modificationCount",0),gi(this,"splayCount",0)}splay(r){const e=this.root;if(e==null)return this.compare(r,r),-1;let n=null,o=null,c=null,d=null,h=e;const a=this.compare;let _;for(;;)if(_=a(h.key,r),_>0){let S=h.left;if(S==null||(_=a(S.key,r),_>0&&(h.left=S.right,S.right=h,h=S,S=h.left,S==null)))break;n==null?o=h:n.left=h,n=h,h=S}else if(_<0){let S=h.right;if(S==null||(_=a(S.key,r),_<0&&(h.right=S.left,S.left=h,h=S,S=h.right,S==null)))break;c==null?d=h:c.right=h,c=h,h=S}else break;return c!=null&&(c.right=h.left,h.left=d),n!=null&&(n.left=h.right,h.right=o),this.root!==h&&(this.root=h,this.splayCount++),_}splayMin(r){let e=r,n=e.left;for(;n!=null;){const o=n;e.left=o.right,o.right=e,e=o,n=e.left}return e}splayMax(r){let e=r,n=e.right;for(;n!=null;){const o=n;e.right=o.left,o.left=e,e=o,n=e.right}return e}_delete(r){if(this.root==null||this.splay(r)!=0)return null;let e=this.root;const n=e,o=e.left;if(this.size--,o==null)this.root=e.right;else{const c=e.right;e=this.splayMax(o),e.right=c,this.root=e}return this.modificationCount++,n}addNewRoot(r,e){this.size++,this.modificationCount++;const n=this.root;if(n==null){this.root=r;return}e<0?(r.left=n,r.right=n.right,n.right=null):(r.right=n,r.left=n.left,n.left=null),this.root=r}_first(){const r=this.root;return r==null?null:(this.root=this.splayMin(r),this.root)}_last(){const r=this.root;return r==null?null:(this.root=this.splayMax(r),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(r){return this.validKey(r)&&this.splay(r)==0}defaultCompare(){return(r,e)=>r<e?-1:r>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:r=>{this.root=r},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:r=>{this.splayCount=r},splay:r=>this.splay(r),has:r=>this.has(r)}}},Yg,Qg,gf=class eh extends P2{constructor(e,n){super(),gi(this,"root",null),gi(this,"compare"),gi(this,"validKey"),gi(this,Yg,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=n??(o=>o!=null&&o!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const n of e)this.delete(n)}forEach(e){const n=this[Symbol.iterator]();let o;for(;o=n.next(),!o.done;)e(o.value,o.value,this)}add(e){const n=this.splay(e);return n!=0&&this.addNewRoot(new Ku(e),n),this}addAndReturn(e){const n=this.splay(e);return n!=0&&this.addNewRoot(new Ku(e),n),this.root.key}addAll(e){for(const n of e)this.add(n)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let n=this.root.left;if(n==null)return null;let o=n.right;for(;o!=null;)n=o,o=n.right;return n.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let n=this.root.right;if(n==null)return null;let o=n.left;for(;o!=null;)n=o,o=n.left;return n.key}retainAll(e){const n=new eh(this.compare,this.validKey),o=this.modificationCount;for(const c of e){if(o!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(c)&&this.splay(c)==0&&n.add(this.root.key)}n.size!=this.size&&(this.root=n.root,this.size=n.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const n=new eh(this.compare,this.validKey);for(const o of this)e.has(o)&&n.add(o);return n}difference(e){const n=new eh(this.compare,this.validKey);for(const o of this)e.has(o)||n.add(o);return n}union(e){const n=this.clone();return n.addAll(e),n}clone(){const e=new eh(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function n(c,d){let h,a;do{if(h=c.left,a=c.right,h!=null){const _=new Ku(h.key);d.left=_,n(h,_)}if(a!=null){const _=new Ku(a.key);d.right=_,c=a,d=_}}while(a!=null)}const o=new Ku(e.key);return n(e,o),o}toSet(){return this.clone()}entries(){return new z2(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Qg=Symbol.iterator,Yg=Symbol.toStringTag,Qg)](){return new L2(this.wrap())}},sb=class{constructor(r){gi(this,"tree"),gi(this,"path",new Array),gi(this,"modificationCount",null),gi(this,"splayCount"),this.tree=r,this.splayCount=r.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const r=this.path[this.path.length-1];return this.getValue(r)}rebuildPath(r){this.path.splice(0,this.path.length),this.tree.splay(r),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(r){for(;r!=null;)this.path.push(r),r=r.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let n=this.tree.getRoot();for(;n!=null;)this.path.push(n),n=n.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let r=this.path[this.path.length-1],e=r.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===r;)r=this.path.pop();return this.path.length>0}},L2=class extends sb{getValue(r){return r.key}},z2=class extends sb{getValue(r){return[r.key,r.key]}},ob=r=>()=>r,Kd=r=>{const e=r?(n,o)=>o.minus(n).abs().isLessThanOrEqualTo(r):ob(!1);return(n,o)=>e(n,o)?0:n.comparedTo(o)};function O2(r){const e=r?(n,o,c,d,h)=>n.exponentiatedBy(2).isLessThanOrEqualTo(d.minus(o).exponentiatedBy(2).plus(h.minus(c).exponentiatedBy(2)).times(r)):ob(!1);return(n,o,c)=>{const d=n.x,h=n.y,a=c.x,_=c.y,S=h.minus(_).times(o.x.minus(a)).minus(d.minus(a).times(o.y.minus(_)));return e(S,d,h,a,_)?0:S.comparedTo(0)}}var D2=r=>r,F2=r=>{if(r){const e=new gf(Kd(r)),n=new gf(Kd(r)),o=(d,h)=>h.addAndReturn(d),c=d=>({x:o(d.x,e),y:o(d.y,n)});return c({x:new Fo(0),y:new Fo(0)}),c}return D2},Jd=r=>({set:e=>{ma=Jd(e)},reset:()=>Jd(r),compare:Kd(r),snap:F2(r),orient:O2(r)}),ma=Jd(),Ju=(r,e)=>r.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(r.ur.x)&&r.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(r.ur.y),Yd=(r,e)=>{if(e.ur.x.isLessThan(r.ll.x)||r.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(r.ll.y)||r.ur.y.isLessThan(e.ll.y))return null;const n=r.ll.x.isLessThan(e.ll.x)?e.ll.x:r.ll.x,o=r.ur.x.isLessThan(e.ur.x)?r.ur.x:e.ur.x,c=r.ll.y.isLessThan(e.ll.y)?e.ll.y:r.ll.y,d=r.ur.y.isLessThan(e.ur.y)?r.ur.y:e.ur.y;return{ll:{x:n,y:c},ur:{x:o,y:d}}},hf=(r,e)=>r.x.times(e.y).minus(r.y.times(e.x)),ab=(r,e)=>r.x.times(e.x).plus(r.y.times(e.y)),_f=r=>ab(r,r).sqrt(),R2=(r,e,n)=>{const o={x:e.x.minus(r.x),y:e.y.minus(r.y)},c={x:n.x.minus(r.x),y:n.y.minus(r.y)};return hf(c,o).div(_f(c)).div(_f(o))},B2=(r,e,n)=>{const o={x:e.x.minus(r.x),y:e.y.minus(r.y)},c={x:n.x.minus(r.x),y:n.y.minus(r.y)};return ab(c,o).div(_f(c)).div(_f(o))},$g=(r,e,n)=>e.y.isZero()?null:{x:r.x.plus(e.x.div(e.y).times(n.minus(r.y))),y:n},e_=(r,e,n)=>e.x.isZero()?null:{x:n,y:r.y.plus(e.y.div(e.x).times(n.minus(r.x)))},N2=(r,e,n,o)=>{if(e.x.isZero())return e_(n,o,r.x);if(o.x.isZero())return e_(r,e,n.x);if(e.y.isZero())return $g(n,o,r.y);if(o.y.isZero())return $g(r,e,n.y);const c=hf(e,o);if(c.isZero())return null;const d={x:n.x.minus(r.x),y:n.y.minus(r.y)},h=hf(d,e).div(c),a=hf(d,o).div(c),_=r.x.plus(a.times(e.x)),S=n.x.plus(h.times(o.x)),k=r.y.plus(a.times(e.y)),y=n.y.plus(h.times(o.y)),C=_.plus(S).div(2),E=k.plus(y).div(2);return{x:C,y:E}},Do=class lb{constructor(e,n){gi(this,"point"),gi(this,"isLeft"),gi(this,"segment"),gi(this,"otherSE"),gi(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}static compare(e,n){const o=lb.comparePoints(e.point,n.point);return o!==0?o:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:bf.compare(e.segment,n.segment))}static comparePoints(e,n){return e.x.isLessThan(n.x)?-1:e.x.isGreaterThan(n.x)?1:e.y.isLessThan(n.y)?-1:e.y.isGreaterThan(n.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const n=e.point.events;for(let o=0,c=n.length;o<c;o++){const d=n[o];this.point.events.push(d),d.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let n=0;n<e;n++){const o=this.point.events[n];if(o.segment.consumedBy===void 0)for(let c=n+1;c<e;c++){const d=this.point.events[c];d.consumedBy===void 0&&o.otherSE.point.events===d.otherSE.point.events&&o.segment.consume(d.segment)}}}getAvailableLinkedEvents(){const e=[];for(let n=0,o=this.point.events.length;n<o;n++){const c=this.point.events[n];c!==this&&!c.segment.ringOut&&c.segment.isInResult()&&e.push(c)}return e}getLeftmostComparator(e){const n=new Map,o=c=>{const d=c.otherSE;n.set(c,{sine:R2(this.point,e.point,d.point),cosine:B2(this.point,e.point,d.point)})};return(c,d)=>{n.has(c)||o(c),n.has(d)||o(d);const{sine:h,cosine:a}=n.get(c),{sine:_,cosine:S}=n.get(d);return h.isGreaterThanOrEqualTo(0)&&_.isGreaterThanOrEqualTo(0)?a.isLessThan(S)?1:a.isGreaterThan(S)?-1:0:h.isLessThan(0)&&_.isLessThan(0)?a.isLessThan(S)?-1:a.isGreaterThan(S)?1:0:_.isLessThan(h)?-1:_.isGreaterThan(h)?1:0}}},j2=class Qd{constructor(e){gi(this,"events"),gi(this,"poly"),gi(this,"_isExteriorRing"),gi(this,"_enclosingRing"),this.events=e;for(let n=0,o=e.length;n<o;n++)e[n].segment.ringOut=this;this.poly=null}static factory(e){const n=[];for(let o=0,c=e.length;o<c;o++){const d=e[o];if(!d.isInResult()||d.ringOut)continue;let h=null,a=d.leftSE,_=d.rightSE;const S=[a],k=a.point,y=[];for(;h=a,a=_,S.push(a),a.point!==k;)for(;;){const C=a.getAvailableLinkedEvents();if(C.length===0){const M=S[0].point,R=S[S.length-1].point;throw new Error(`Unable to complete output ring starting at [${M.x}, ${M.y}]. Last matching segment found ends at [${R.x}, ${R.y}].`)}if(C.length===1){_=C[0].otherSE;break}let E=null;for(let M=0,R=y.length;M<R;M++)if(y[M].point===a.point){E=M;break}if(E!==null){const M=y.splice(E)[0],R=S.splice(M.index);R.unshift(R[0].otherSE),n.push(new Qd(R.reverse()));continue}y.push({index:S.length,point:a.point});const T=a.getLeftmostComparator(h);_=C.sort(T)[0].otherSE;break}n.push(new Qd(S))}return n}getGeom(){let e=this.events[0].point;const n=[e];for(let S=1,k=this.events.length-1;S<k;S++){const y=this.events[S].point,C=this.events[S+1].point;ma.orient(y,e,C)!==0&&(n.push(y),e=y)}if(n.length===1)return null;const o=n[0],c=n[1];ma.orient(o,e,c)===0&&n.shift(),n.push(n[0]);const d=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:n.length-1,a=this.isExteriorRing()?n.length:-1,_=[];for(let S=h;S!=a;S+=d)_.push([n[S].x.toNumber(),n[S].y.toNumber()]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,n;let o=this.events[0];for(let h=1,a=this.events.length;h<a;h++){const _=this.events[h];Do.compare(o,_)>0&&(o=_)}let c=o.segment.prevInResult(),d=c?c.prevInResult():null;for(;;){if(!c)return null;if(!d)return c.ringOut;if(d.ringOut!==c.ringOut)return((e=d.ringOut)==null?void 0:e.enclosingRing())!==c.ringOut?c.ringOut:(n=c.ringOut)==null?void 0:n.enclosingRing();c=d.prevInResult(),d=c?c.prevInResult():null}}},t_=class{constructor(r){gi(this,"exteriorRing"),gi(this,"interiorRings"),this.exteriorRing=r,r.poly=this,this.interiorRings=[]}addInterior(r){this.interiorRings.push(r),r.poly=this}getGeom(){const r=this.exteriorRing.getGeom();if(r===null)return null;const e=[r];for(let n=0,o=this.interiorRings.length;n<o;n++){const c=this.interiorRings[n].getGeom();c!==null&&e.push(c)}return e}},U2=class{constructor(r){gi(this,"rings"),gi(this,"polys"),this.rings=r,this.polys=this._composePolys(r)}getGeom(){const r=[];for(let e=0,n=this.polys.length;e<n;e++){const o=this.polys[e].getGeom();o!==null&&r.push(o)}return r}_composePolys(r){var e;const n=[];for(let o=0,c=r.length;o<c;o++){const d=r[o];if(!d.poly)if(d.isExteriorRing())n.push(new t_(d));else{const h=d.enclosingRing();h!=null&&h.poly||n.push(new t_(h)),(e=h==null?void 0:h.poly)==null||e.addInterior(d)}}return n}},V2=class{constructor(r,e=bf.compare){gi(this,"queue"),gi(this,"tree"),gi(this,"segments"),this.queue=r,this.tree=new gf(e),this.segments=[]}process(r){const e=r.segment,n=[];if(r.consumedBy)return r.isLeft?this.queue.delete(r.otherSE):this.tree.delete(e),n;r.isLeft&&this.tree.add(e);let o=e,c=e;do o=this.tree.lastBefore(o);while(o!=null&&o.consumedBy!=null);do c=this.tree.firstAfter(c);while(c!=null&&c.consumedBy!=null);if(r.isLeft){let d=null;if(o){const a=o.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(d=a),!o.isAnEndpoint(a))){const _=this._splitSafely(o,a);for(let S=0,k=_.length;S<k;S++)n.push(_[S])}}let h=null;if(c){const a=c.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(h=a),!c.isAnEndpoint(a))){const _=this._splitSafely(c,a);for(let S=0,k=_.length;S<k;S++)n.push(_[S])}}if(d!==null||h!==null){let a=null;d===null?a=h:h===null?a=d:a=Do.comparePoints(d,h)<=0?d:h,this.queue.delete(e.rightSE),n.push(e.rightSE);const _=e.split(a);for(let S=0,k=_.length;S<k;S++)n.push(_[S])}n.length>0?(this.tree.delete(e),n.push(r)):(this.segments.push(e),e.prev=o)}else{if(o&&c){const d=o.getIntersection(c);if(d!==null){if(!o.isAnEndpoint(d)){const h=this._splitSafely(o,d);for(let a=0,_=h.length;a<_;a++)n.push(h[a])}if(!c.isAnEndpoint(d)){const h=this._splitSafely(c,d);for(let a=0,_=h.length;a<_;a++)n.push(h[a])}}}this.tree.delete(e)}return n}_splitSafely(r,e){this.tree.delete(r);const n=r.rightSE;this.queue.delete(n);const o=r.split(e);return o.push(n),r.consumedBy===void 0&&this.tree.add(r),o}},q2=class{constructor(){gi(this,"type"),gi(this,"numMultiPolys")}run(r,e,n){th.type=r;const o=[new n_(e,!0)];for(let _=0,S=n.length;_<S;_++)o.push(new n_(n[_],!1));if(th.numMultiPolys=o.length,th.type==="difference"){const _=o[0];let S=1;for(;S<o.length;)Yd(o[S].bbox,_.bbox)!==null?S++:o.splice(S,1)}if(th.type==="intersection")for(let _=0,S=o.length;_<S;_++){const k=o[_];for(let y=_+1,C=o.length;y<C;y++)if(Yd(k.bbox,o[y].bbox)===null)return[]}const c=new gf(Do.compare);for(let _=0,S=o.length;_<S;_++){const k=o[_].getSweepEvents();for(let y=0,C=k.length;y<C;y++)c.add(k[y])}const d=new V2(c);let h=null;for(c.size!=0&&(h=c.first(),c.delete(h));h;){const _=d.process(h);for(let S=0,k=_.length;S<k;S++){const y=_[S];y.consumedBy===void 0&&c.add(y)}c.size!=0?(h=c.first(),c.delete(h)):h=null}ma.reset();const a=j2.factory(d.segments);return new U2(a).getGeom()}},th=new q2,yf=th,Z2=0,bf=class ff{constructor(e,n,o,c){gi(this,"id"),gi(this,"leftSE"),gi(this,"rightSE"),gi(this,"rings"),gi(this,"windings"),gi(this,"ringOut"),gi(this,"consumedBy"),gi(this,"prev"),gi(this,"_prevInResult"),gi(this,"_beforeState"),gi(this,"_afterState"),gi(this,"_isInResult"),this.id=++Z2,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=o,this.windings=c}static compare(e,n){const o=e.leftSE.point.x,c=n.leftSE.point.x,d=e.rightSE.point.x,h=n.rightSE.point.x;if(h.isLessThan(o))return 1;if(d.isLessThan(c))return-1;const a=e.leftSE.point.y,_=n.leftSE.point.y,S=e.rightSE.point.y,k=n.rightSE.point.y;if(o.isLessThan(c)){if(_.isLessThan(a)&&_.isLessThan(S))return 1;if(_.isGreaterThan(a)&&_.isGreaterThan(S))return-1;const y=e.comparePoint(n.leftSE.point);if(y<0)return 1;if(y>0)return-1;const C=n.comparePoint(e.rightSE.point);return C!==0?C:-1}if(o.isGreaterThan(c)){if(a.isLessThan(_)&&a.isLessThan(k))return-1;if(a.isGreaterThan(_)&&a.isGreaterThan(k))return 1;const y=n.comparePoint(e.leftSE.point);if(y!==0)return y;const C=e.comparePoint(n.rightSE.point);return C<0?1:C>0?-1:1}if(a.isLessThan(_))return-1;if(a.isGreaterThan(_))return 1;if(d.isLessThan(h)){const y=n.comparePoint(e.rightSE.point);if(y!==0)return y}if(d.isGreaterThan(h)){const y=e.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(!d.eq(h)){const y=S.minus(a),C=d.minus(o),E=k.minus(_),T=h.minus(c);if(y.isGreaterThan(C)&&E.isLessThan(T))return 1;if(y.isLessThan(C)&&E.isGreaterThan(T))return-1}return d.isGreaterThan(h)?1:d.isLessThan(h)||S.isLessThan(k)?-1:S.isGreaterThan(k)?1:e.id<n.id?-1:e.id>n.id?1:0}static fromRing(e,n,o){let c,d,h;const a=Do.comparePoints(e,n);if(a<0)c=e,d=n,h=1;else if(a>0)c=n,d=e,h=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new Do(c,!0),S=new Do(d,!1);return new ff(_,S,[o],[h])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(n)?e:n},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(n)?e:n}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return ma.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const n=this.bbox(),o=e.bbox(),c=Yd(n,o);if(c===null)return null;const d=this.leftSE.point,h=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,S=Ju(n,a)&&this.comparePoint(a)===0,k=Ju(o,d)&&e.comparePoint(d)===0,y=Ju(n,_)&&this.comparePoint(_)===0,C=Ju(o,h)&&e.comparePoint(h)===0;if(k&&S)return C&&!y?h:!C&&y?_:null;if(k)return y&&d.x.eq(_.x)&&d.y.eq(_.y)?null:d;if(S)return C&&h.x.eq(a.x)&&h.y.eq(a.y)?null:a;if(C&&y)return null;if(C)return h;if(y)return _;const E=N2(d,this.vector(),a,e.vector());return E===null||!Ju(c,E)?null:ma.snap(E)}split(e){const n=[],o=e.events!==void 0,c=new Do(e,!0),d=new Do(e,!1),h=this.rightSE;this.replaceRightSE(d),n.push(d),n.push(c);const a=new ff(c,h,this.rings.slice(),this.windings.slice());return Do.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Do.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(c.checkForConsuming(),d.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}consume(e){let n=this,o=e;for(;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;const c=ff.compare(n,o);if(c!==0){if(c>0){const d=n;n=o,o=d}if(n.prev===o){const d=n;n=o,o=d}for(let d=0,h=o.rings.length;d<h;d++){const a=o.rings[d],_=o.windings[d],S=n.rings.indexOf(a);S===-1?(n.rings.push(a),n.windings.push(_)):n.windings[S]+=_}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,o=this._afterState.windings,c=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const S=this.rings[a],k=this.windings[a],y=n.indexOf(S);y===-1?(n.push(S),o.push(k)):o[y]+=k}const d=[],h=[];for(let a=0,_=n.length;a<_;a++){if(o[a]===0)continue;const S=n[a],k=S.poly;if(h.indexOf(k)===-1)if(S.isExterior)d.push(k);else{h.indexOf(k)===-1&&h.push(k);const y=d.indexOf(S.poly);y!==-1&&d.splice(y,1)}}for(let a=0,_=d.length;a<_;a++){const S=d[a].multiPoly;c.indexOf(S)===-1&&c.push(S)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(yf.type){case"union":{const o=e.length===0,c=n.length===0;this._isInResult=o!==c;break}case"intersection":{let o,c;e.length<n.length?(o=e.length,c=n.length):(o=n.length,c=e.length),this._isInResult=c===yf.numMultiPolys&&o<c;break}case"xor":{const o=Math.abs(e.length-n.length);this._isInResult=o%2===1;break}case"difference":{const o=c=>c.length===1&&c[0].isSubject;this._isInResult=o(e)!==o(n);break}}return this._isInResult}},i_=class{constructor(r,e,n){if(gi(this,"poly"),gi(this,"isExterior"),gi(this,"segments"),gi(this,"bbox"),!Array.isArray(r)||r.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=n,this.segments=[],typeof r[0][0]!="number"||typeof r[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const o=ma.snap({x:new Fo(r[0][0]),y:new Fo(r[0][1])});this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};let c=o;for(let d=1,h=r.length;d<h;d++){if(typeof r[d][0]!="number"||typeof r[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=ma.snap({x:new Fo(r[d][0]),y:new Fo(r[d][1])});a.x.eq(c.x)&&a.y.eq(c.y)||(this.segments.push(bf.fromRing(c,a,this)),a.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.x),a.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.y),a.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.x),a.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.y),c=a)}(!o.x.eq(c.x)||!o.y.eq(c.y))&&this.segments.push(bf.fromRing(c,o,this))}getSweepEvents(){const r=[];for(let e=0,n=this.segments.length;e<n;e++){const o=this.segments[e];r.push(o.leftSE),r.push(o.rightSE)}return r}},W2=class{constructor(r,e){if(gi(this,"multiPoly"),gi(this,"exteriorRing"),gi(this,"interiorRings"),gi(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new i_(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,o=r.length;n<o;n++){const c=new i_(r[n],this,!1);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.interiorRings.push(c)}this.multiPoly=e}getSweepEvents(){const r=this.exteriorRing.getSweepEvents();for(let e=0,n=this.interiorRings.length;e<n;e++){const o=this.interiorRings[e].getSweepEvents();for(let c=0,d=o.length;c<d;c++)r.push(o[c])}return r}},n_=class{constructor(r,e){if(gi(this,"isSubject"),gi(this,"polys"),gi(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof r[0][0][0]=="number"&&(r=[r])}catch{}this.polys=[],this.bbox={ll:{x:new Fo(Number.POSITIVE_INFINITY),y:new Fo(Number.POSITIVE_INFINITY)},ur:{x:new Fo(Number.NEGATIVE_INFINITY),y:new Fo(Number.NEGATIVE_INFINITY)}};for(let n=0,o=r.length;n<o;n++){const c=new W2(r[n],this);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.polys.push(c)}this.isSubject=e}getSweepEvents(){const r=[];for(let e=0,n=this.polys.length;e<n;e++){const o=this.polys[e].getSweepEvents();for(let c=0,d=o.length;c<d;c++)r.push(o[c])}return r}},G2=(r,...e)=>yf.run("union",r,e),H2=(r,...e)=>yf.run("difference",r,e);ma.set;function cb(r,e,n){if(r!==null)for(var o,c,d,h,a,_,S,k=0,y=0,C,E=r.type,T=E==="FeatureCollection",M=E==="Feature",R=T?r.features.length:1,N=0;N<R;N++){S=T?r.features[N].geometry:M?r.geometry:r,C=S?S.type==="GeometryCollection":!1,a=C?S.geometries.length:1;for(var z=0;z<a;z++){var V=0,Y=0;if(h=C?S.geometries[z]:S,h!==null){_=h.coordinates;var se=h.type;switch(k=0,se){case null:break;case"Point":if(e(_,y,N,V,Y)===!1)return!1;y++,V++;break;case"LineString":case"MultiPoint":for(o=0;o<_.length;o++){if(e(_[o],y,N,V,Y)===!1)return!1;y++,se==="MultiPoint"&&V++}se==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(o=0;o<_.length;o++){for(c=0;c<_[o].length-k;c++){if(e(_[o][c],y,N,V,Y)===!1)return!1;y++}se==="MultiLineString"&&V++,se==="Polygon"&&Y++}se==="Polygon"&&V++;break;case"MultiPolygon":for(o=0;o<_.length;o++){for(Y=0,c=0;c<_[o].length;c++){for(d=0;d<_[o][c].length-k;d++){if(e(_[o][c][d],y,N,V,Y)===!1)return!1;y++}Y++}V++}break;case"GeometryCollection":for(o=0;o<h.geometries.length;o++)if(cb(h.geometries[o],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function kp(r,e){var n,o,c,d,h,a,_,S,k,y,C=0,E=r.type==="FeatureCollection",T=r.type==="Feature",M=E?r.features.length:1;for(n=0;n<M;n++){for(a=E?r.features[n].geometry:T?r.geometry:r,S=E?r.features[n].properties:T?r.properties:{},k=E?r.features[n].bbox:T?r.bbox:void 0,y=E?r.features[n].id:T?r.id:void 0,_=a?a.type==="GeometryCollection":!1,h=_?a.geometries.length:1,c=0;c<h;c++){if(d=_?a.geometries[c]:a,d===null){if(e(null,C,S,k,y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(d,C,S,k,y)===!1)return!1;break}case"GeometryCollection":{for(o=0;o<d.geometries.length;o++)if(e(d.geometries[o],C,S,k,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function X2(r,e){kp(r,function(n,o,c,d,h){var a=n===null?null:n.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(dh(n,c,{bbox:d,id:h}),o,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var k=n.coordinates[S],y={type:_,coordinates:k};if(e(dh(y,c),o,S)===!1)return!1}})}function K2(r,e={}){const n=[];if(kp(r,c=>{n.push(c.coordinates)}),n.length<2)throw new Error("Must have at least 2 geometries");const o=G2(n[0],...n.slice(1));return o.length===0?null:o.length===1?xp(o[0],e.properties):nb(o,e.properties)}var ub=K2;function J2(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return cb(r,o=>{n[0]>o[0]&&(n[0]=o[0]),n[1]>o[1]&&(n[1]=o[1]),n[2]<o[0]&&(n[2]=o[0]),n[3]<o[1]&&(n[3]=o[1])}),n}var r_=J2;function Y2(r){const e=[];if(kp(r,c=>{e.push(c.coordinates)}),e.length<2)throw new Error("Must have at least two features");const n=r.features[0].properties||{},o=H2(e[0],...e.slice(1));return o.length===0?null:o.length===1?xp(o[0],n):nb(o,n)}var Q2=Y2;function $2(r){if(!r)throw new Error("geojson is required");var e=[];return X2(r,function(n){e.push(n)}),ph(e)}var ek=$2;function s_(r,e){const n=Q2(ph([xp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!n)return;n.properties={isMask:!0};const o=Xg(r_(r)),c=(o[2]-o[0])/360/1e3,d=o[0]<-180,h=o[2]>180,a=ek(r);if(a.features.length>1&&(d||h))for(const _ of a.features){const S=Xg(r_(_));if(h&&S[0]<-180+c)for(const k of _.geometry.coordinates)for(const y of k)y[0]+=360-c;if(d&&S[2]>180-c)for(const k of _.geometry.coordinates)for(const y of k)y[0]-=360-c}e(ph([a.features.length<2?r:ub(a)??r,n]))}const o_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},of="mtlr-gc-full-geom",a_="mtlr-gc-full-geom-fill",l_="mtlr-gc-full-geom-line";function tk(r,e,n=!0,o=!0,c={},d={},h=o_){let a;const _=[];let S,k,y;function C(){if(!r.loaded){r.once("load",C);return}const R=h?h===!0?o_:h:void 0;if(!(R!=null&&R.fill)&&!(R!=null&&R.line))return;const N=r.getSource(of);if(N)N.setData(y??ph([]));else if(y)r.addSource(of,{type:"geojson",data:y});else return;!r.getLayer(a_)&&R!=null&&R.fill&&r.addLayer({...R==null?void 0:R.fill,id:a_,type:"fill",source:of}),!r.getLayer(l_)&&R!=null&&R.line&&r.addLayer({...R==null?void 0:R.line,id:l_,type:"line",source:of})}function E(R){y=R,C()}r.on("styledata",()=>{setTimeout(()=>{y&&C()})});const T=R=>{a==null||a({type:"mapClick",coordinates:[R.lngLat.lng,R.lngLat.lat]})};function M(R=!1){if(!e)throw new Error;const N=document.createElement("div");return R&&N.classList.add("marker-interactive"),new x2({props:{displayIn:"maplibre"},target:N}),new e.Marker({element:N,offset:[1,-13]})}return{setEventHandler(R){R?(a=R,r.on("click",T)):(a=void 0,r.off("click",T))},flyTo(R,N){r.flyTo({center:R,...N?{zoom:N}:{},...c})},fitBounds(R,N,z){r.fitBounds([[R[0],R[1]],[R[2],R[3]]],{padding:N,...z?{maxZoom:z}:{},...d})},indicateReverse(R){r.getCanvasContainer().style.cursor=R?"crosshair":""},setReverseMarker(R){!e||!n||(k?R?k.setLngLat(R):(k.remove(),k=void 0):R&&(n instanceof Function?k=n(r)??void 0:(k=(typeof n=="object"?new e.Marker(n):M()).setLngLat(R).addTo(r),k.getElement().classList.add("marker-reverse"))))},setFeatures(R,N,z){for(const V of _)V.remove();if(_.length=0,E(void 0),!!e){e:if(N){let V=!1;if(N.geometry.type==="GeometryCollection"){const Y=N.geometry.geometries.filter(se=>se.type==="Polygon"||se.type==="MultiPolygon");t:if(Y.length>0){const se=ub(ph(Y.map($=>dh($))));if(!se)break t;s_({...N,geometry:se.geometry},E),V=!0}else{const se=N.geometry.geometries.filter($=>$.type==="LineString"||$.type==="MultiLineString");se.length>0&&(E({...N,geometry:{type:"GeometryCollection",geometries:se}}),V=!0)}}if(!V){if(N.geometry.type==="Polygon"||N.geometry.type==="MultiPolygon")s_(N,E);else if(N.geometry.type==="LineString"||N.geometry.type==="MultiLineString"){E(N);break e}}if(!z&&!N.geometry.type.endsWith("Point"))break e;if(n instanceof Function){const Y=n(r,N);Y&&_.push(Y)}else n&&_.push(typeof n=="object"?new e.Marker(n):M().setLngLat(N.center).addTo(r))}if(o)for(const V of R??[]){if(V===N)continue;let Y;if(o instanceof Function){if(Y=o(r,V),!Y)continue}else Y=(typeof o=="object"?new e.Marker(o):M(!0)).setLngLat(V.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(V.place_type[0]==="reverse"?V.place_name:V.place_name.replace(/,.*/,""))).addTo(r);const se=Y.getElement();se.addEventListener("click",$=>{$.stopPropagation(),a==null||a({type:"markerClick",id:V.id})}),se.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:V.id}),Y.togglePopup()}),se.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:V.id}),Y.togglePopup()}),_.push(Y)}}},setSelectedMarker(R){S&&S.getElement().classList.toggle("marker-selected",!1),S=R>-1?_[R]:void 0,S==null||S.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const R=r.getCenter();return[r.getZoom(),R.lng,R.lat]}}}function ik(r){let e,n;return{c(){e=da("svg"),n=da("path"),he(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),he(e,"viewBox","0 0 14 14"),he(e,"width","13"),he(e,"height","13"),he(e,"class","svelte-en2qvf")},m(o,c){be(o,e,c),ce(e,n)},p:Ot,i:Ot,o:Ot,d(o){o&&ye(e)}}}class hb extends ai{constructor(e){super(),oi(this,e,null,ik,Yt,{})}}function nk(r){let e,n;return{c(){e=da("svg"),n=da("path"),he(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),he(e,"viewBox","0 0 30 30"),he(e,"fill","none"),he(e,"xmlns","http://www.w3.org/2000/svg"),he(e,"class","svelte-d2loi5")},m(o,c){be(o,e,c),ce(e,n)},p:Ot,i:Ot,o:Ot,d(o){o&&ye(e)}}}class fb extends ai{constructor(e){super(),oi(this,e,null,nk,Yt,{})}}function rk(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[3]+"area.svg")||he(e,"src",n),he(e,"alt",r[7]),he(e,"title",r[7]),he(e,"class","svelte-w9y5n9")},m(o,c){be(o,e,c)},p(o,c){c&8&&!Gn(e.src,n=o[3]+"area.svg")&&he(e,"src",n),c&128&&he(e,"alt",o[7]),c&128&&he(e,"title",o[7])},d(o){o&&ye(e)}}}function sk(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[3]+"reverse.svg")||he(e,"src",n),he(e,"alt",r[7]),he(e,"title",r[7]),he(e,"class","svelte-w9y5n9")},m(o,c){be(o,e,c)},p(o,c){c&8&&!Gn(e.src,n=o[3]+"reverse.svg")&&he(e,"src",n),c&128&&he(e,"alt",o[7]),c&128&&he(e,"title",o[7])},d(o){o&&ye(e)}}}function ok(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[3]+"poi.svg")||he(e,"src",n),he(e,"alt",r[7]),he(e,"title",r[7]),he(e,"class","svelte-w9y5n9")},m(o,c){be(o,e,c)},p(o,c){c&8&&!Gn(e.src,n=o[3]+"poi.svg")&&he(e,"src",n),c&128&&he(e,"alt",o[7]),c&128&&he(e,"title",o[7])},d(o){o&&ye(e)}}}function ak(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[3]+"postal_code.svg")||he(e,"src",n),he(e,"alt",r[7]),he(e,"title",r[7]),he(e,"class","svelte-w9y5n9")},m(o,c){be(o,e,c)},p(o,c){c&8&&!Gn(e.src,n=o[3]+"postal_code.svg")&&he(e,"src",n),c&128&&he(e,"alt",o[7]),c&128&&he(e,"title",o[7])},d(o){o&&ye(e)}}}function lk(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[3]+"street.svg")||he(e,"src",n),he(e,"alt",r[7]),he(e,"title",r[7]),he(e,"class","svelte-w9y5n9")},m(o,c){be(o,e,c)},p(o,c){c&8&&!Gn(e.src,n=o[3]+"street.svg")&&he(e,"src",n),c&128&&he(e,"alt",o[7]),c&128&&he(e,"title",o[7])},d(o){o&&ye(e)}}}function ck(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[3]+"road.svg")||he(e,"src",n),he(e,"alt",r[7]),he(e,"title",r[7]),he(e,"class","svelte-w9y5n9")},m(o,c){be(o,e,c)},p(o,c){c&8&&!Gn(e.src,n=o[3]+"road.svg")&&he(e,"src",n),c&128&&he(e,"alt",o[7]),c&128&&he(e,"title",o[7])},d(o){o&&ye(e)}}}function uk(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[3]+"housenumber.svg")||he(e,"src",n),he(e,"alt",r[7]),he(e,"title",r[7]),he(e,"class","svelte-w9y5n9")},m(o,c){be(o,e,c)},p(o,c){c&8&&!Gn(e.src,n=o[3]+"housenumber.svg")&&he(e,"src",n),c&128&&he(e,"alt",o[7]),c&128&&he(e,"title",o[7])},d(o){o&&ye(e)}}}function hk(r){let e,n,o,c;return{c(){e=xe("img"),Gn(e.src,n=r[5])||he(e,"src",n),he(e,"alt",r[4]),he(e,"title",r[7]),he(e,"class","svelte-w9y5n9")},m(d,h){be(d,e,h),o||(c=Ut(e,"error",r[14]),o=!0)},p(d,h){h&32&&!Gn(e.src,n=d[5])&&he(e,"src",n),h&16&&he(e,"alt",d[4]),h&128&&he(e,"title",d[7])},d(d){d&&ye(e),o=!1,c()}}}function fk(r){let e,n;return{c(){e=xe("div"),he(e,"class","sprite-icon svelte-w9y5n9"),he(e,"style",n=`
        width: ${r[6].width/qs}px;
        height: ${r[6].height/qs}px;
        background-image: url(${r[3]}sprite${$d}.png);
        background-position: -${r[6].x/qs}px -${r[6].y/qs}px;
        background-size: ${ho.width/qs}px ${ho.height/qs}px;
      `),he(e,"title",r[7])},m(o,c){be(o,e,c)},p(o,c){c&72&&n!==(n=`
        width: ${o[6].width/qs}px;
        height: ${o[6].height/qs}px;
        background-image: url(${o[3]}sprite${$d}.png);
        background-position: -${o[6].x/qs}px -${o[6].y/qs}px;
        background-size: ${ho.width/qs}px ${ho.height/qs}px;
      `)&&he(e,"style",n),c&128&&he(e,"title",o[7])},d(o){o&&ye(e)}}}function c_(r){let e,n;return{c(){e=xe("span"),n=gt(r[7]),he(e,"class","secondary svelte-w9y5n9")},m(o,c){be(o,e,c),ce(e,n)},p(o,c){c&128&&_i(n,o[7])},d(o){o&&ye(e)}}}function dk(r){let e,n,o,c,d,h,a,_,S,k=(r[8]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,C,E=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[8],T,M,R=(r[8]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",N,z,V,Y,se,$;function te(O,W){return W&1&&(n=null),W&1&&(o=null),W&1&&(c=null),W&1&&(d=null),ho&&O[6]?fk:O[5]?hk:O[0].address?uk:(n==null&&(n=!!O[0].id.startsWith("road.")),n?ck:(o==null&&(o=!!O[0].id.startsWith("address.")),o?lk:(c==null&&(c=!!O[0].id.startsWith("postal_code.")),c?ak:(d==null&&(d=!!O[0].id.startsWith("poi.")),d?ok:O[8]?sk:rk))))}let U=te(r,-1),j=U(r),G=E&&c_(r);return{c(){e=xe("li"),j.c(),h=Ue(),a=xe("span"),_=xe("span"),S=xe("span"),y=gt(k),C=Ue(),G&&G.c(),T=Ue(),M=xe("span"),N=gt(R),he(S,"class","primary svelte-w9y5n9"),he(_,"class","svelte-w9y5n9"),he(M,"class","line2 svelte-w9y5n9"),he(a,"class","texts svelte-w9y5n9"),he(e,"tabindex","-1"),he(e,"role","option"),he(e,"aria-selected",z=r[1]==="selected"),he(e,"aria-checked",V=r[1]==="picked"),he(e,"class",Y=Yc(r[1])+" svelte-w9y5n9")},m(O,W){be(O,e,W),j.m(e,null),ce(e,h),ce(e,a),ce(a,_),ce(_,S),ce(S,y),ce(_,C),G&&G.m(_,null),ce(a,T),ce(a,M),ce(M,N),se||($=[Ut(e,"mouseenter",r[13]),Ut(e,"focus",r[15]),Ut(e,"click",r[16])],se=!0)},p(O,[W]){U===(U=te(O,W))&&j?j.p(O,W):(j.d(1),j=U(O),j&&(j.c(),j.m(e,h))),W&257&&k!==(k=(O[8]?O[0].place_name:O[0].place_name.replace(/,.*/,""))+"")&&_i(y,k),W&293&&(E=O[2]==="always"||O[2]!=="never"&&!O[0].address&&!O[0].id.startsWith("road.")&&!O[0].id.startsWith("address.")&&!O[0].id.startsWith("postal_code.")&&(!O[0].id.startsWith("poi.")||!O[5])&&!O[8]),E?G?G.p(O,W):(G=c_(O),G.c(),G.m(_,null)):G&&(G.d(1),G=null),W&257&&R!==(R=(O[8]?"":O[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&_i(N,R),W&2&&z!==(z=O[1]==="selected")&&he(e,"aria-selected",z),W&2&&V!==(V=O[1]==="picked")&&he(e,"aria-checked",V),W&2&&Y!==(Y=Yc(O[1])+" svelte-w9y5n9")&&he(e,"class",Y)},i:Ot,o:Ot,d(O){O&&ye(e),j.d(),G&&G.d(),se=!1,jn($)}}}const db=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,$d=db?"@2x":"",qs=db?2:1;let ho,af;function pk(r,e,n){let o,c,d,{feature:h}=e,{style:a="default"}=e,{showPlaceType:_}=e,{missingIconsCache:S}=e,{iconsBaseUrl:k}=e;const y=sl();let C,E,T,M;function R(){af??(af=fetch(`${k}sprite${$d}.json`).then(U=>U.json()).then(U=>{ho=U}).catch(()=>{ho=null}))}function N(){E&&S.add(E),z()}function z(){ho!==void 0?V():(R(),af==null||af.then(V))}function V(){do{if(M--,n(4,C=o==null?void 0:o[M]),n(6,T=C?ho==null?void 0:ho.icons[C]:void 0),T)break;n(5,E=C?k+C.replace(/ /g,"_")+".svg":void 0)}while(M>-1&&(!E||S.has(E)))}function Y(U){Di.call(this,r,U)}const se=()=>N(),$=()=>y("select",void 0),te=U=>{document.activeElement!==U.target&&y("select",void 0)};return r.$$set=U=>{"feature"in U&&n(0,h=U.feature),"style"in U&&n(1,a=U.style),"showPlaceType"in U&&n(2,_=U.showPlaceType),"missingIconsCache"in U&&n(11,S=U.missingIconsCache),"iconsBaseUrl"in U&&n(3,k=U.iconsBaseUrl)},r.$$.update=()=>{var U,j,G,O,W;r.$$.dirty&1&&n(12,o=(U=h.properties)==null?void 0:U.categories),r.$$.dirty&1&&n(8,c=h.place_type[0]==="reverse"),r.$$.dirty&1&&n(7,d=((G=(j=h.properties)==null?void 0:j.categories)==null?void 0:G.join(", "))??((W=(O=h.properties)==null?void 0:O.place_type_name)==null?void 0:W[0])??h.place_type[0]),r.$$.dirty&4096&&(M=(o==null?void 0:o.length)??0,z())},[h,a,_,k,C,E,T,d,c,y,N,S,o,Y,se,$,te]}class mk extends ai{constructor(e){super(),oi(this,e,pk,dk,Yt,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function gk(r){let e;return{c(){e=xe("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',he(e,"class","svelte-1ocfouu")},m(n,o){be(n,e,o)},p:Ot,i:Ot,o:Ot,d(n){n&&ye(e)}}}class _k extends ai{constructor(e){super(),oi(this,e,null,gk,Yt,{})}}function yk(r){let e,n;return{c(){e=da("svg"),n=da("path"),he(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),he(e,"viewBox","0 0 60.006 21.412"),he(e,"width","14"),he(e,"height","20"),he(e,"class","svelte-en2qvf")},m(o,c){be(o,e,c),ce(e,n)},p:Ot,i:Ot,o:Ot,d(o){o&&ye(e)}}}class bk extends ai{constructor(e){super(),oi(this,e,null,yk,Yt,{})}}function vk(r){let e,n,o;return{c(){e=da("svg"),n=da("circle"),o=da("path"),he(n,"cx","4.789"),he(n,"cy","4.787"),he(n,"r","3.85"),he(n,"class","svelte-1aq105l"),he(o,"d","M12.063 12.063 7.635 7.635"),he(o,"class","svelte-1aq105l"),he(e,"xmlns","http://www.w3.org/2000/svg"),he(e,"width","13"),he(e,"height","13"),he(e,"viewBox","0 0 13 13"),he(e,"class","svelte-1aq105l")},m(c,d){be(c,e,d),ce(e,n),ce(e,o)},p:Ot,i:Ot,o:Ot,d(c){c&&ye(e)}}}class wk extends ai{constructor(e){super(),oi(this,e,null,vk,Yt,{})}}function xk(r,e,n){const o=e[1],c=e[0],d=o-c;return r===o&&n?r:((r-c)%d+d)%d+c}function u_(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Yu;async function kk(r,e,n){const o=r==null?void 0:r.getCenterAndZoom();for(const c of e??[])if(!(o&&(c.minZoom!=null&&c.minZoom>o[0]||c.maxZoom!=null&&c.maxZoom<o[0]))){if(c.type==="fixed")return c.coordinates.join(",");e:if(c.type==="client-geolocation"){if(Yu&&c.cachedLocationExpiry&&Yu.time+c.cachedLocationExpiry>Date.now()){if(!Yu.coords)break e;return Yu.coords}let d;try{return d=await new Promise((h,a)=>{n.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{h([_.coords.longitude,_.coords.latitude].map(S=>S.toFixed(6)).join(","))},_=>{a(_)},c)}),d}catch{}finally{c.cachedLocationExpiry&&(Yu={time:Date.now(),coords:d})}if(n.signal.aborted)return}if(c.type==="server-geolocation")return"ip";if(o&&c.type==="map-center")return o[1].toFixed(6)+","+o[2].toFixed(6)}}const Sk=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,h_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,f_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,d_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,p_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,m_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function Tk(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(E=>Number(E.trim())),n=Number(e[0]),o=Number(e[1]),c=Math.abs(n),d=Math.abs(o),h=n>0?"N":"S",a=o>0?"E":"W";let _;r=="DD"&&(_=`${c} ${h}, ${d} ${a}`);const S=Math.floor(c),k=Math.floor(d),y=(c-S)*60,C=(d-k)*60;if(r=="DM"){let E=g_(y,3).toFixed(3).padStart(6,"0"),T=g_(C,3).toFixed(3).padStart(6,"0");E.endsWith(".000")&&T.endsWith(".000")&&(E=E.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),_=`${S} ${E}' ${h}, ${k} ${T}' ${a}`}if(r=="DMS"){const E=Math.floor(y),T=Math.floor(C);let M=((y-E)*60).toFixed(1).padStart(4,"0"),R=((C-T)*60).toFixed(1).padStart(4,"0");const N=E.toString().padStart(2,"0"),z=T.toString().padStart(2,"0");M.endsWith(".0")&&R.endsWith(".0")&&(M=M.replace(/\.0$/,""),R=R.replace(/\.0$/,"")),_=`${S} ${N}' ${M}" ${h}, ${k} ${z}' ${R}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function g_(r,e){const n=Math.pow(10,e);return Math.round((r+Number.EPSILON)*n)/n}function Sp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let n=null,o=null,c="",d="",h=null,a=[],_=!1;if(Sk.test(r))throw new Error("invalid coordinate value");if(h_.test(r))if(a=h_.exec(r),_=Qu(a),_)n=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(n*=-1),o=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(o*=-1),h="DM";else throw new Error("invalid coordinate format");else if(f_.test(r))if(a=f_.exec(r),_=Qu(a),_){if(n=a[2],o=a[6],n.includes(",")&&(n=n.replace(",",".")),o.includes(",")&&(o=o.replace(",",".")),h="DD",Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(o))==Number(o))throw new Error("integer only coordinate provided");a[1]?(c=a[1],d=a[5]):a[4]&&(c=a[4],d=a[8])}else throw new Error("invalid decimal coordinate format");else if(d_.test(r))if(a=d_.exec(r),_=Qu(a),_)n=Math.abs(parseInt(a[2])),a[4]&&(n+=a[4]/60,h="DM"),a[6]&&(n+=a[6].replace(",",".")/3600,h="DMS"),parseInt(a[2])<0&&(n=-1*n),o=Math.abs(parseInt(a[9])),a[11]&&(o+=a[11]/60),a[13]&&(o+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(o=-1*o),a[1]?(c=a[1],d=a[8]):a[7]&&(c=a[7],d=a[14]);else throw new Error("invalid DMS coordinates format");else if(p_.test(r))if(a=p_.exec(r),_=Qu(a),_)n=Math.abs(parseInt(a[2])),a[4]&&(n+=a[4]/60,h="DM"),a[6]&&(n+=a[6]/3600,h="DMS"),parseInt(a[2])<0&&(n=-1*n),o=Math.abs(parseInt(a[10])),a[12]&&(o+=a[12]/60),a[14]&&(o+=a[14]/3600),parseInt(a[10])<0&&(o=-1*o),a[1]?(c=a[1],d=a[9]):a[8]&&(c=a[8],d=a[16]);else throw new Error("invalid DMS coordinates format");else if(m_.test(r)){if(a=m_.exec(r),_=Qu(a),a.filter(S=>S).length<=5)throw new Error("invalid coordinates format");if(_)n=Math.abs(parseInt(a[2])),a[4]&&(n+=a[4].replace(",",".")/60,h="DM"),a[6]&&(n+=a[6].replace(",",".")/3600,h="DMS"),parseInt(a[2])<0&&(n=-1*n),o=Math.abs(parseInt(a[10])),a[12]&&(o+=a[12].replace(",",".")/60),a[14]&&(o+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(o=-1*o),a[1]?(c=a[1],d=a[9]):a[8]&&(c=a[8],d=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(o)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if(c&&!d||!c&&d)throw new Error("invalid coordinates value");if(c&&c==d)throw new Error("invalid coordinates format");n.toString().includes(",")&&(n=n.replace(",",".")),o.toString().includes(",")&&(o=o.replace(",","."));let S=/S|SOUTH/i;S.test(c)&&n>0&&(n=-1*n),S=/W|WEST/i,S.test(d)&&o>0&&(o=-1*o);const k=a[0].trim();let y,C;const E=/[,/;\u0020]/g,T=k.match(E);if(T==null){const N=Math.floor(r.length/2);y=k.substring(0,N).trim(),C=k.substring(N).trim()}else{let N;T.length%2==1?N=Math.floor(T.length/2):N=T.length/2-1;let z=0;if(N==0)z=k.indexOf(T[0]),y=k.substring(0,z).trim(),C=k.substring(z+1).trim();else{let V=0,Y=0;for(;V<=N;)z=k.indexOf(T[V],Y),Y=z+1,V++;y=k.substring(0,z).trim(),C=k.substring(z+1).trim()}}const M=y.split(".");if(M.length==2&&M[1]==0&&M[1].length!=2)throw new Error("invalid coordinates format");const R=C.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return n=Number(Number(n).toFixed(e)),o=Number(Number(o).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:y,verbatimLongitude:C,decimalLatitude:n,decimalLongitude:o,decimalCoordinates:`${n},${o}`,originalFormat:h,closeEnough:Ck,toCoordinateFormat:Tk})}else throw new Error("coordinates pattern match failed")}function Qu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,o=/[eastsouthnorthwest]+/i,c=e.length/2;for(let d=0;d<c;d++){const h=e[d],a=e[d+c],_=n.test(h)&&n.test(a),S=o.test(h)&&o.test(a),k=h==a;if(!(h==null&&a==null)){if(h==null||a==null)return!1;if(_||S||k)continue;return!1}}return!0}function __(r,e){const n=Math.abs(r-e);return Number(n.toFixed(6))<=1e-5}function Ck(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return __(this.decimalLatitude,Number(e[0]))&&__(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const Ek=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Sp.to=Ek;const Ik=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Ak={decimalLatitude:40.123,decimalLongitude:-74.123},Mk=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],Pk=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Lk(){const r=[];return Ik.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...Ak})}),[...r,...Mk,...Pk]}const zk=Lk();Sp.formats=zk.map(r=>r.verbatimCoordinates);const Ok=Sp;function y_(r,e,n){const o=r.slice();return o[97]=e[n],o[99]=n,o}function b_(r){let e,n,o,c,d;return n=new hb({}),{c(){e=xe("button"),lt(n.$$.fragment),he(e,"type","button"),he(e,"title",r[3]),he(e,"class","svelte-bz0zu3")},m(h,a){be(h,e,a),ot(n,e,null),o=!0,c||(d=Ut(e,"click",r[78]),c=!0)},p(h,a){(!o||a[0]&8)&&he(e,"title",h[3])},i(h){o||(Pe(n.$$.fragment,h),o=!0)},o(h){De(n.$$.fragment,h),o=!1},d(h){h&&ye(e),at(n),c=!1,d()}}}function v_(r){let e,n;return e=new _k({}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function w_(r){let e,n,o,c,d;return n=new bk({}),{c(){e=xe("button"),lt(n.$$.fragment),he(e,"type","button"),he(e,"title",r[10]),he(e,"class","svelte-bz0zu3"),gr(e,"active",r[0])},m(h,a){be(h,e,a),ot(n,e,null),o=!0,c||(d=Ut(e,"click",r[79]),c=!0)},p(h,a){(!o||a[0]&1024)&&he(e,"title",h[10]),(!o||a[0]&1)&&gr(e,"active",h[0])},i(h){o||(Pe(n.$$.fragment,h),o=!0)},o(h){De(n.$$.fragment,h),o=!1},d(h){h&&ye(e),at(n),c=!1,d()}}}function Dk(r){let e,n=[],o=new Map,c,d,h,a=Ni(r[13]);const _=S=>S[97].id+(S[97].address?","+S[97].address:"");for(let S=0;S<a.length;S+=1){let k=y_(r,a,S),y=_(k);o.set(y,n[S]=x_(y,k))}return{c(){e=xe("ul");for(let S=0;S<n.length;S+=1)n[S].c();he(e,"class","options svelte-bz0zu3"),he(e,"role","listbox")},m(S,k){be(S,e,k);for(let y=0;y<n.length;y+=1)n[y]&&n[y].m(e,null);c=!0,d||(h=[Ut(e,"mouseleave",r[27]),Ut(e,"blur",r[83]),Ut(e,"keydown",r[23])],d=!0)},p(S,k){k[0]&102823936&&(a=Ni(S[13]),nn(),n=z1(n,k,_,1,S,a,o,e,L1,x_,null,y_),rn())},i(S){if(!c){for(let k=0;k<a.length;k+=1)Pe(n[k]);c=!0}},o(S){for(let k=0;k<n.length;k+=1)De(n[k]);c=!1},d(S){S&&ye(e);for(let k=0;k<n.length;k+=1)n[k].d();d=!1,jn(h)}}}function Fk(r){let e,n,o,c,d,h;return n=new fb({}),{c(){e=xe("div"),lt(n.$$.fragment),o=Ue(),c=xe("div"),d=gt(r[8]),he(c,"class","svelte-bz0zu3"),he(e,"class","no-results svelte-bz0zu3")},m(a,_){be(a,e,_),ot(n,e,null),ce(e,o),ce(e,c),ce(c,d),h=!0},p(a,_){(!h||_[0]&256)&&_i(d,a[8])},i(a){h||(Pe(n.$$.fragment,a),h=!0)},o(a){De(n.$$.fragment,a),h=!1},d(a){a&&ye(e),at(n)}}}function Rk(r){let e="",n;return{c(){n=gt(e)},m(o,c){be(o,n,c)},p:Ot,i:Ot,o:Ot,d(o){o&&ye(n)}}}function Bk(r){let e,n,o,c,d,h,a,_,S,k,y;return n=new fb({}),_=new hb({}),{c(){e=xe("div"),lt(n.$$.fragment),o=Ue(),c=xe("div"),d=gt(r[7]),h=Ue(),a=xe("button"),lt(_.$$.fragment),he(c,"class","svelte-bz0zu3"),he(a,"class","svelte-bz0zu3"),he(e,"class","error svelte-bz0zu3")},m(C,E){be(C,e,E),ot(n,e,null),ce(e,o),ce(e,c),ce(c,d),ce(e,h),ce(e,a),ot(_,a,null),S=!0,k||(y=Ut(a,"click",r[80]),k=!0)},p(C,E){(!S||E[0]&128)&&_i(d,C[7])},i(C){S||(Pe(n.$$.fragment,C),Pe(_.$$.fragment,C),S=!0)},o(C){De(n.$$.fragment,C),De(_.$$.fragment,C),S=!1},d(C){C&&ye(e),at(n),at(_),k=!1,y()}}}function x_(r,e){var a;let n,o,c;function d(){return e[81](e[99])}function h(){return e[82](e[97])}return o=new mk({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((a=e[14])==null?void 0:a.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),o.$on("mouseenter",d),o.$on("select",h),{key:r,first:null,c(){n=Mn(),lt(o.$$.fragment),this.first=n},m(_,S){be(_,n,S),ot(o,_,S),c=!0},p(_,S){var y;e=_;const k={};S[0]&8192&&(k.feature=e[97]),S[0]&2048&&(k.showPlaceType=e[11]),S[0]&57344&&(k.style=e[15]===e[99]?"selected":((y=e[14])==null?void 0:y.id)===e[97].id?"picked":"default"),S[0]&4096&&(k.iconsBaseUrl=e[12]),o.$set(k)},i(_){c||(Pe(o.$$.fragment,_),c=!0)},o(_){De(o.$$.fragment,_),c=!1},d(_){_&&ye(n),at(o,_)}}}function Nk(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N,z,V,Y=!1;d=new wk({});let se=!r[20]&&b_(r),$=r[20]&&v_(),te=r[6]==="button"&&w_(r);const U=r[70].default,j=wn(U,r,r[69],null),G=[Bk,Rk,Fk,Dk],O=[];function W(le,de){var ve,pe;return le[19]?0:!le[16]&&!le[4]?1:((ve=le[13])==null?void 0:ve.length)===0?2:(pe=le[13])!=null&&pe.length&&(le[16]||le[4])?3:-1}return~(T=W(r))&&(M=O[T]=G[T](r)),{c(){e=Ue(),n=xe("form"),o=xe("div"),c=xe("button"),lt(d.$$.fragment),h=Ue(),a=xe("input"),_=Ue(),S=xe("div"),se&&se.c(),k=Ue(),$&&$.c(),y=Ue(),te&&te.c(),C=Ue(),j&&j.c(),E=Ue(),M&&M.c(),he(c,"class","search-button svelte-bz0zu3"),he(c,"type","button"),he(a,"placeholder",r[9]),he(a,"aria-label",r[9]),he(a,"class","svelte-bz0zu3"),he(S,"class","clear-button-container svelte-bz0zu3"),gr(S,"displayable",r[1]!==""),he(o,"class","input-group svelte-bz0zu3"),he(n,"class",R=Yc(r[2])+" svelte-bz0zu3"),gr(n,"can-collapse",r[5]&&r[1]==="")},m(le,de){be(le,e,de),be(le,n,de),ce(n,o),ce(o,c),ot(d,c,null),ce(o,h),ce(o,a),r[72](a),mr(a,r[1]),ce(o,_),ce(o,S),se&&se.m(S,null),ce(S,k),$&&$.m(S,null),ce(o,y),te&&te.m(o,null),ce(o,C),j&&j.m(o,null),ce(n,E),~T&&O[T].m(n,null),N=!0,z||(V=[Ut(c,"click",r[71]),Ut(a,"input",r[73]),Ut(a,"focus",r[74]),Ut(a,"blur",r[75]),Ut(a,"click",r[76]),Ut(a,"keydown",r[23]),Ut(a,"input",r[24]),Ut(a,"change",r[77]),Ut(n,"submit",rp(r[22]))],z=!0)},p(le,de){(!N||de[0]&512)&&he(a,"placeholder",le[9]),(!N||de[0]&512)&&he(a,"aria-label",le[9]),de[0]&2&&a.value!==le[1]&&mr(a,le[1]),le[20]?se&&(nn(),De(se,1,1,()=>{se=null}),rn()):se?(se.p(le,de),de[0]&1048576&&Pe(se,1)):(se=b_(le),se.c(),Pe(se,1),se.m(S,k)),le[20]?$?de[0]&1048576&&Pe($,1):($=v_(),$.c(),Pe($,1),$.m(S,null)):$&&(nn(),De($,1,1,()=>{$=null}),rn()),(!N||de[0]&2)&&gr(S,"displayable",le[1]!==""),le[6]==="button"?te?(te.p(le,de),de[0]&64&&Pe(te,1)):(te=w_(le),te.c(),Pe(te,1),te.m(o,C)):te&&(nn(),De(te,1,1,()=>{te=null}),rn()),j&&j.p&&(!N||de[2]&128)&&kn(j,U,le,le[69],N?xn(U,le[69],de,null):Sn(le[69]),null);let ve=T;T=W(le),T===ve?~T&&O[T].p(le,de):(M&&(nn(),De(O[ve],1,1,()=>{O[ve]=null}),rn()),~T?(M=O[T],M?M.p(le,de):(M=O[T]=G[T](le),M.c()),Pe(M,1),M.m(n,null)):M=null),(!N||de[0]&4&&R!==(R=Yc(le[2])+" svelte-bz0zu3"))&&he(n,"class",R),(!N||de[0]&38)&&gr(n,"can-collapse",le[5]&&le[1]==="")},i(le){N||(Pe(Y),Pe(d.$$.fragment,le),Pe(se),Pe($),Pe(te),Pe(j,le),Pe(M),N=!0)},o(le){De(Y),De(d.$$.fragment,le),De(se),De($),De(te),De(j,le),De(M),N=!1},d(le){le&&(ye(e),ye(n)),at(d),r[72](null),se&&se.d(),$&&$.d(),te&&te.d(),j&&j.d(le),~T&&O[T].d(),z=!1,jn(V)}}}function jk(r,e,n){let o,c,d,{$$slots:h={},$$scope:a}=e;const _={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:S=void 0}=e,{apiKey:k=void 0}=e,{bbox:y=void 0}=e,{clearButtonTitle:C="clear"}=e,{clearOnBlur:E=!1}=e,{clearListOnPick:T=!1}=e,{keepListOpen:M=!1}=e,{collapsed:R=!1}=e,{country:N=void 0}=e,{debounceSearch:z=200}=e,{enableReverse:V="never"}=e,{errorMessage:Y="Something went wrong"}=e,{filter:se=()=>!0}=e,{flyTo:$=!0}=e,{fuzzyMatch:te=!0}=e,{language:U=void 0}=e,{limit:j=void 0}=e;const G=41415112612;let{reverseGeocodingLimit:O=G}=e,{mapController:W=void 0}=e,{minLength:le=2}=e,{noResultsMessage:de="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ve="Search"}=e,{proximity:pe=[{type:"server-geolocation"}]}=e,{reverseActive:we=V==="always"}=e,{reverseButtonTitle:Te="toggle reverse geocoding"}=e,{searchValue:Ae=""}=e,{pickedResultStyle:ct="full-geometry"}=e,{showPlaceType:We="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:kt=!0}=e,{flyToSelected:Je=!1}=e,{markerOnSelected:wt=!0}=e,{types:Tt=void 0}=e;const Ht=[];let{reverseGeocodingTypes:li=Ht}=e,{exhaustiveReverseGeocoding:Mi=!1}=e,{excludeTypes:Pi=!1}=e;const Ti=void 0;let{reverseGeocodingExcludeTypes:At=Ti}=e,{zoom:Xe=_}=e,{apiUrl:Pt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:ni={}}=e,{iconsBaseUrl:$e="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=e,{adjustUrlQuery:yi=()=>{}}=e,{adjustUrl:yt=()=>{}}=e;function it(Ke){ft.focus(Ke)}function fe(){ft.blur()}function X(Ke,pi=!0,ki=!1){n(1,Ae=Ke),pi?(n(15,Wt=-1),yr()):(Se(void 0,!ki,ki),setTimeout(()=>{ft.focus(),ft.select()}))}function Q(){n(13,Ze=void 0),n(14,st=void 0),n(15,Wt=-1)}function Me(){n(64,dt=[]),n(14,st=void 0)}let Ze,dt,st,Ci="",ft,Wt=-1,Ei,Bi=[],Cn,St,ui,ii,sn=!1;const _r=new Set,ci=sl();ps(()=>{W&&(W.setEventHandler(void 0),W.indicateReverse(!1),W.setSelectedMarker(-1),W.setFeatures(void 0,void 0,!1))});function yr(Ke){if(n(17,sn=!1),St&&(clearTimeout(St),St=void 0),Wt>-1&&Ze)n(14,st=Ze[Wt]),n(1,Ae=st.place_type[0]==="reverse"?st.place_name:st.place_name.replace(/,.*/,"")),n(19,Ei=void 0),n(64,dt=void 0),n(15,Wt=-1);else if(Ae){const pi=Ke||!br(Ae);Ar(Ae,{exact:!0}).then(()=>{n(64,dt=Ze),n(14,st=void 0),pi&&Mr()}).catch(ki=>n(19,Ei=ki))}}function br(Ke){try{return Ok(Ke,6)}catch{return!1}}async function Ar(Ke,{byId:pi=!1,exact:ki=!1}={}){var Ki,Ji,Un;n(19,Ei=void 0),Cn==null||Cn.abort();const Ui=new AbortController;n(20,Cn=Ui);try{const si=br(Ke),es=new URL(Pt+"/"+encodeURIComponent(si?si.decimalLongitude+","+si.decimalLatitude:Ke)+".json"),Hn=es.searchParams;U!==void 0&&Hn.set("language",Array.isArray(U)?U.join(","):U??"");const[Vn]=(W==null?void 0:W.getCenterAndZoom())??[];let pn=(Ki=!si||li===Ht?Tt:li)==null?void 0:Ki.map(Ii=>typeof Ii=="string"?Ii:Vn===void 0||(Ii[0]??0)<=Vn&&Vn<(Ii[1]??1/0)?Ii[2]:void 0).filter(Ii=>Ii!==void 0);pn&&(pn=[...new Set(pn)],Hn.set("types",pn.join(",")));const ba=!si||At===Ti?Pi:At;if(ba&&Hn.set("excludeTypes",String(ba)),y&&Hn.set("bbox",y.map(Ii=>Ii.toFixed(6)).join(",")),N&&Hn.set("country",Array.isArray(N)?N.join(","):N),!pi&&!si){const Ii=await kk(W,pe,Ui);Ii&&Hn.set("proximity",Ii),(ki||!pt)&&Hn.set("autocomplete","false"),Hn.set("fuzzyMatch",String(te))}const zn=O===G?j:O;zn!==void 0&&zn>1&&(pn==null?void 0:pn.length)!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),si?(zn===1||zn!==void 0&&(Mi||(pn==null?void 0:pn.length)===1))&&Hn.set("limit",String(zn)):j!==void 0&&Hn.set("limit",String(j)),k&&Hn.set("key",k),yi(Hn),yt(es);const Xn=es.searchParams.get("types")===""&&es.searchParams.get("excludeTypes")!=="true",Ur=es.toString();if(Ur===Ci){pi?(T&&n(13,Ze=void 0),n(14,st=Bi[0])):(n(13,Ze=Bi),((Ji=Ze[Wt])==null?void 0:Ji.id)!==(c==null?void 0:c.id)&&n(15,Wt=-1));return}Ci=Ur;let Rn;if(Xn)Rn={type:"FeatureCollection",features:[]};else{const Ii=await fetch(Ur,{signal:Ui.signal,...ni});if(!Ii.ok)throw new Error(await Ii.text());Rn=await Ii.json()}ci("response",{url:Ur,featureCollection:Rn}),pi?(T&&n(13,Ze=void 0),n(14,st=Rn.features[0]),Bi=[st]):(n(13,Ze=Rn.features.filter(se)),si&&Ze.unshift({type:"Feature",properties:{},id:"reverse_"+si.decimalLongitude+"_"+si.decimalLatitude,text:si.decimalLatitude+", "+si.decimalLongitude,place_name:si.decimalLatitude+", "+si.decimalLongitude,place_type:["reverse"],center:[si.decimalLongitude,si.decimalLatitude],bbox:[si.decimalLongitude,si.decimalLatitude,si.decimalLongitude,si.decimalLatitude],geometry:{type:"Point",coordinates:[si.decimalLongitude,si.decimalLatitude]}}),Bi=Ze,((Un=Ze[Wt])==null?void 0:Un.id)!==(c==null?void 0:c.id)&&n(15,Wt=-1),si&&ft.focus())}catch(si){if(si&&typeof si=="object"&&"name"in si&&si.name==="AbortError")return;throw si}finally{Ui===Cn&&n(20,Cn=void 0)}}function Mr(){var Ui;if(!(dt!=null&&dt.length)||!$)return;const Ke=[180,90,-180,-90],pi=!dt.some(Ki=>!Ki.matching_text);let ki;for(const Ki of dt){const Ji=ie(Ki);if(ki=ki===void 0?Ji:Ji===void 0?ki:Math.max(ki,Ji),pi||!Ki.matching_text)for(const Un of[0,1,2,3])Ke[Un]=Math[Un<2?"min":"max"](Ke[Un],((Ui=Ki.bbox)==null?void 0:Ui[Un])??Ki.center[Un%2])}W&&dt.length>0&&(st&&Ke[0]===Ke[2]&&Ke[1]===Ke[3]?W.flyTo(st.center,ie(st)):W.fitBounds(u_(Ke),50,ki))}function Le(){!st||!W||(!st.bbox||st.bbox[0]===st.bbox[2]&&st.bbox[1]===st.bbox[3]?W.flyTo(st.center,ie(st)):W.fitBounds(u_(st.bbox),50,ie(st)))}function ie(Ke){var ki;if(!Ke.bbox||Ke.bbox[0]!==Ke.bbox[2]&&Ke.bbox[1]!==Ke.bbox[3])return;const pi=Ke.id.replace(/\..*/,"");return(Array.isArray((ki=Ke.properties)==null?void 0:ki.categories)?Ke.properties.categories.reduce((Ui,Ki)=>{const Ji=Xe[pi+"."+Ki];return Ui===void 0?Ji:Ji===void 0?Ui:Math.max(Ui,Ji)},void 0):void 0)??Xe[pi]}function ne(Ke){n(0,we=V==="always"),n(13,Ze=void 0),n(14,st=void 0),n(15,Wt=-1),X(Ke[1].toFixed(6)+", "+xk(Ke[0],[-180,180],!0).toFixed(6),!1,!0)}function me(Ke){if(!Ze)return;let pi=Ke.key==="ArrowDown"?1:Ke.key==="ArrowUp"?-1:0;pi&&(ft.focus(),n(17,sn=!0),Ke.preventDefault(),st&&Wt===-1&&n(15,Wt=Ze.findIndex(ki=>ki.id===(st==null?void 0:st.id))),Wt===(st||kt?0:-1)&&pi===-1&&n(15,Wt=Ze.length),n(15,Wt+=pi),Wt>=Ze.length&&n(15,Wt=-1),Wt<0&&(st||kt)&&n(15,Wt=0))}function Se(Ke,pi=!0,ki=!1){if(n(19,Ei=void 0),n(14,st=void 0),n(17,sn=!0),pt||ki){if(St&&clearTimeout(St),Ae.length<le)return;const Ui=Ae;St=window.setTimeout(()=>{Ar(Ui).catch(Ki=>n(19,Ei=Ki))},pi?z:0)}else n(13,Ze=void 0),n(19,Ei=void 0)}function Ve(Ke){st&&(st==null?void 0:st.id)===(Ke==null?void 0:Ke.id)?Le():(n(14,st=Ke),n(1,Ae=Ke.place_name))}function Ge(Ke){n(15,Wt=Ke)}function et(){(!kt||st)&&n(15,Wt=-1),Je&&Le()}const Be=()=>ft.focus();function ut(Ke){mi[Ke?"unshift":"push"](()=>{ft=Ke,n(18,ft)})}function bt(){Ae=this.value,n(1,Ae),n(17,sn),n(31,E),n(16,ui)}const rt=()=>n(17,sn=!0),Et=()=>n(17,sn=!1),Qt=()=>n(17,sn=!0),ri=()=>n(14,st=void 0),ji=()=>{n(1,Ae=""),n(14,st=void 0),ft.focus()},wi=()=>n(0,we=!we),zi=()=>n(19,Ei=void 0),Si=Ke=>Ge(Ke),hn=Ke=>Ve(Ke),fn=()=>{};return r.$$set=Ke=>{"class"in Ke&&n(2,S=Ke.class),"apiKey"in Ke&&n(29,k=Ke.apiKey),"bbox"in Ke&&n(30,y=Ke.bbox),"clearButtonTitle"in Ke&&n(3,C=Ke.clearButtonTitle),"clearOnBlur"in Ke&&n(31,E=Ke.clearOnBlur),"clearListOnPick"in Ke&&n(32,T=Ke.clearListOnPick),"keepListOpen"in Ke&&n(4,M=Ke.keepListOpen),"collapsed"in Ke&&n(5,R=Ke.collapsed),"country"in Ke&&n(33,N=Ke.country),"debounceSearch"in Ke&&n(34,z=Ke.debounceSearch),"enableReverse"in Ke&&n(6,V=Ke.enableReverse),"errorMessage"in Ke&&n(7,Y=Ke.errorMessage),"filter"in Ke&&n(35,se=Ke.filter),"flyTo"in Ke&&n(36,$=Ke.flyTo),"fuzzyMatch"in Ke&&n(37,te=Ke.fuzzyMatch),"language"in Ke&&n(38,U=Ke.language),"limit"in Ke&&n(39,j=Ke.limit),"reverseGeocodingLimit"in Ke&&n(40,O=Ke.reverseGeocodingLimit),"mapController"in Ke&&n(41,W=Ke.mapController),"minLength"in Ke&&n(42,le=Ke.minLength),"noResultsMessage"in Ke&&n(8,de=Ke.noResultsMessage),"placeholder"in Ke&&n(9,ve=Ke.placeholder),"proximity"in Ke&&n(43,pe=Ke.proximity),"reverseActive"in Ke&&n(0,we=Ke.reverseActive),"reverseButtonTitle"in Ke&&n(10,Te=Ke.reverseButtonTitle),"searchValue"in Ke&&n(1,Ae=Ke.searchValue),"pickedResultStyle"in Ke&&n(44,ct=Ke.pickedResultStyle),"showPlaceType"in Ke&&n(11,We=Ke.showPlaceType),"showResultsWhileTyping"in Ke&&n(45,pt=Ke.showResultsWhileTyping),"selectFirst"in Ke&&n(46,kt=Ke.selectFirst),"flyToSelected"in Ke&&n(47,Je=Ke.flyToSelected),"markerOnSelected"in Ke&&n(48,wt=Ke.markerOnSelected),"types"in Ke&&n(49,Tt=Ke.types),"reverseGeocodingTypes"in Ke&&n(50,li=Ke.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in Ke&&n(51,Mi=Ke.exhaustiveReverseGeocoding),"excludeTypes"in Ke&&n(52,Pi=Ke.excludeTypes),"reverseGeocodingExcludeTypes"in Ke&&n(53,At=Ke.reverseGeocodingExcludeTypes),"zoom"in Ke&&n(54,Xe=Ke.zoom),"apiUrl"in Ke&&n(55,Pt=Ke.apiUrl),"fetchParameters"in Ke&&n(56,ni=Ke.fetchParameters),"iconsBaseUrl"in Ke&&n(12,$e=Ke.iconsBaseUrl),"adjustUrlQuery"in Ke&&n(57,yi=Ke.adjustUrlQuery),"adjustUrl"in Ke&&n(58,yt=Ke.adjustUrl),"$$scope"in Ke&&n(69,a=Ke.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&64&&n(0,we=V==="always"),r.$$.dirty[0]&16384|r.$$.dirty[1]&8192&&ct!=="marker-only"&&st&&!st.address&&st.geometry.type==="Point"&&st.place_type[0]!=="reverse"&&Ar(st.id,{byId:!0}).catch(Ke=>n(19,Ei=Ke)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1058|r.$$.dirty[2]&8&&(W&&st&&st.id!==ii&&$&&(Le(),T&&n(13,Ze=void 0),n(64,dt=void 0),n(15,Wt=-1)),n(65,ii=st==null?void 0:st.id)),r.$$.dirty[0]&196608|r.$$.dirty[1]&1&&setTimeout(()=>{n(16,ui=sn),E&&!ui&&n(1,Ae="")}),r.$$.dirty[0]&8194|r.$$.dirty[1]&2048&&Ae.length<le&&(n(13,Ze=void 0),n(19,Ei=void 0),n(64,dt=Ze)),r.$$.dirty[0]&57344|r.$$.dirty[1]&32768&&kt&&Ze!=null&&Ze.length&&Wt==-1&&!st&&n(15,Wt=0),r.$$.dirty[0]&8192|r.$$.dirty[2]&4&&dt!==Ze&&n(64,dt=void 0),r.$$.dirty[0]&73729|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&W&&W.setEventHandler(Ke=>{switch(Ke.type){case"mapClick":we&&ne(Ke.coordinates);break;case"markerClick":{const pi=Ze==null?void 0:Ze.find(ki=>ki.id===Ke.id);pi&&Ve(pi)}break;case"markerMouseEnter":dt&&n(15,Wt=ui?(Ze==null?void 0:Ze.findIndex(pi=>pi.id===Ke.id))??-1:-1);break;case"markerMouseLeave":dt&&n(15,Wt=-1);break}}),r.$$.dirty[0]&40960&&n(66,c=Ze==null?void 0:Ze[Wt]),r.$$.dirty[1]&66592|r.$$.dirty[2]&16&&W&&c&&$&&Je&&W.flyTo(c.center,ie(c)),r.$$.dirty[1]&8192&&n(68,o=ct==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&132096|r.$$.dirty[2]&64&&(wt||W==null||W.setFeatures(void 0,void 0,o)),r.$$.dirty[0]&16384|r.$$.dirty[1]&132096|r.$$.dirty[2]&84&&W&&wt&&!dt&&(W.setFeatures(c?[c]:void 0,st,o),W.setSelectedMarker(c?0:-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1024|r.$$.dirty[2]&68&&W&&W.setFeatures(dt,st,o),r.$$.dirty[0]&32768|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&dt&&W&&W.setSelectedMarker(Wt),r.$$.dirty[0]&2|r.$$.dirty[1]&1024&&W){const Ke=br(Ae);W.setReverseMarker(Ke?[Ke.decimalLongitude,Ke.decimalLatitude]:void 0)}r.$$.dirty[2]&16&&ci("select",{feature:c}),r.$$.dirty[0]&16384&&ci("pick",{feature:st}),r.$$.dirty[0]&73744&&n(67,d=!!(Ze!=null&&Ze.length)&&(ui||M)),r.$$.dirty[2]&32&&ci("optionsvisibilitychange",{optionsVisible:d}),r.$$.dirty[0]&8192&&ci("featureslisted",{features:Ze}),r.$$.dirty[2]&4&&ci("featuresmarked",{features:dt}),r.$$.dirty[0]&1&&ci("reversetoggle",{reverse:we}),r.$$.dirty[0]&2&&ci("querychange",{query:Ae}),r.$$.dirty[0]&1|r.$$.dirty[1]&1024&&W&&W.indicateReverse(we)},[we,Ae,S,C,M,R,V,Y,de,ve,Te,We,$e,Ze,st,Wt,ui,sn,ft,Ei,Cn,_r,yr,me,Se,Ve,Ge,et,_,k,y,E,T,N,z,se,$,te,U,j,O,W,le,pe,ct,pt,kt,Je,wt,Tt,li,Mi,Pi,At,Xe,Pt,ni,yi,yt,it,fe,X,Q,Me,dt,ii,c,d,o,a,h,Be,ut,bt,rt,Et,Qt,ri,ji,wi,zi,Si,hn,fn]}class Uk extends ai{constructor(e){super(),oi(this,e,jk,Nk,Yt,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}}function k_(r){let e,n,o;return n=new Uk({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=xe("div"),lt(n.$$.fragment),he(e,"class","svelte-ixhnie")},m(c,d){be(c,e,d),ot(n,e,null),o=!0},p(c,d){const h={};d&4&&(h.mapController=c[2]),d&1&&(h.apiKey=c[0]),d&2&&(h.country=c[1]),n.$set(h)},i(c){o||(Pe(n.$$.fragment,c),o=!0)},o(c){De(n.$$.fragment,c),o=!1},d(c){c&&ye(e),at(n)}}}function Vk(r){let e,n,o=r[2]&&k_(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),be(c,e,d),n=!0},p(c,[d]){c[2]?o?(o.p(c,d),d&4&&Pe(o,1)):(o=k_(c),o.c(),Pe(o,1),o.m(e.parentNode,e)):o&&(nn(),De(o,1,1,()=>{o=null}),rn())},i(c){n||(Pe(o),n=!0)},o(c){De(o),n=!1},d(c){c&&ye(e),o&&o.d(c)}}}function qk(r,e,n){let o,{apiKey:c}=e,{map:d}=e,{country:h}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(S){return S?tk(S,Gs,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=S=>{"apiKey"in S&&n(0,c=S.apiKey),"map"in S&&n(4,d=S.map),"country"in S&&n(1,h=S.country)},r.$$.update=()=>{r.$$.dirty&16&&n(2,o=_(d))},[c,h,o,a,d]}class Zk extends ai{constructor(e){super(),oi(this,e,qk,Vk,Yt,{apiKey:0,map:4,country:1})}}let Wk=Date.now();function su(r){return`${r}-${Wk++}`}const Tp=Symbol.for("svelte-maplibre");function al(){return h0(Tp)}function Gk(r){let e=new WeakMap;return n=>{var h;let o=e.get(n.originalEvent);if(o!==void 0)return o;let d=(h=n.target.queryRenderedFeatures(n.point).find(a=>{var _;return(_=r.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:h.layer.id;return e.set(n.originalEvent,d),d}}function Hk(){let r=new Map;return op(Tp,{map:vn(null),source:Md(null),layer:Md(null),popupTarget:Md(null),cluster:vn(),loadedImages:vn(new Set),minzoom:vn(0),maxzoom:vn(24),layerEvent:vn(null),layerInfo:r,eventTopMost:Gk(r),markerClickManager:new Yk})}function S_(r){return{subscribe:r.subscribe}}function pb({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:o=!1}){let c=al(),d=vn(null),h=S_(d),a={...c,[r]:S_(d)};if(e&&(a.popupTarget=h),o){let _=vn(null);a.layerEvent=_,c.layerEvent=_}return n&&(a.cluster=vn()),op(Tp,a),{...c,self:d}}function Xk(){return pb({key:"source",setCluster:!0})}function Kk(r=!0){return pb({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Jk(r){return"layerType"in r&&r.layerType==="deckgl"}class Yk{constructor(){Wn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const n of this._handlers)n(e)}}function T_(r){let e;return n=>{if(n)for(let o in n){let c=e==null?void 0:e[o],d=n[o];c!==d&&r(o,d,c)}else if(e)for(let o in e)r(o,void 0,e[o]);e=n}}function Qk(r,...e){let n=[r];for(let o of e)if(o)Array.isArray(o)&&o[0]===r?n.push(...o.slice(1)):n.push(o);else continue;if(n.length!==1)return n.length===2?n[1]:n}function $k(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function mh(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}function C_(r){let e=r[0],n,o,c=E_(r);return{c(){c.c(),n=Mn()},m(d,h){c.m(d,h),be(d,n,h),o=!0},p(d,h){h[0]&1&&Yt(e,e=d[0])?(nn(),De(c,1,1,Ot),rn(),c=E_(d),c.c(),Pe(c,1),c.m(n.parentNode,n)):c.p(d,h)},i(d){o||(Pe(c),o=!0)},o(d){De(c),o=!1},d(d){d&&ye(n),c.d(d)}}}function E_(r){let e;const n=r[36].default,o=wn(n,r,r[35],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d[1]&16)&&kn(o,n,c,c[35],e?xn(n,c[35],d,null):Sn(c[35]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function eS(r){let e,n,o=r[0]&&C_(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),be(c,e,d),n=!0},p(c,d){c[0]?o?(o.p(c,d),d[0]&1&&Pe(o,1)):(o=C_(c),o.c(),Pe(o,1),o.m(e.parentNode,e)):o&&(nn(),De(o,1,1,()=>{o=null}),rn())},i(c){n||(Pe(o),n=!0)},o(c){De(o),n=!1},d(c){c&&ye(e),o&&o.d(c)}}}function tS(r,e,n){let o,c,d,h,a,_,S,k,y,C,E,T,{$$slots:M={},$$scope:R}=e,{id:N=su("layer")}=e,{source:z=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:Y=void 0}=e,{beforeLayerType:se=void 0}=e,{type:$}=e,{paint:te=void 0}=e,{layout:U=void 0}=e,{filter:j=void 0}=e,{applyToClusters:G=void 0}=e,{minzoom:O=void 0}=e,{maxzoom:W=void 0}=e,{manageHoverState:le=!1}=e,{hovered:de=null}=e,{interactive:ve=!0}=e,{hoverCursor:pe=void 0}=e,{eventsIfTopMost:we=!1}=e;const Te=sl(),{map:Ae,source:ct,self:We,minzoom:pt,maxzoom:kt,eventTopMost:Je,layerInfo:wt}=Kk();Bt(r,Ae,Xe=>n(31,y=Xe)),Bt(r,ct,Xe=>n(32,C=Xe)),Bt(r,We,Xe=>n(0,k=Xe)),Bt(r,pt,Xe=>n(34,T=Xe)),Bt(r,kt,Xe=>n(33,E=Xe)),ps(()=>{k&&y&&(wt.delete(k),y==null||y.removeLayer(k))});let Tt;function Ht(Xe){var yi,yt;if(!ve||!k||!y||we&&Je(Xe)!==k)return;let Pt=Xe.features??[],ni=(yt=(yi=Pt[0])==null?void 0:yi.properties)==null?void 0:yt.cluster_id,$e={event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt};Te(Xe.type,$e)}function li(Xe){var yi,yt;if(!ve||!k||!y||we&&Je(Xe)!==k)return;pe&&(y.getCanvas().style.cursor=pe);let Pt=Xe.features??[];n(6,de=Pt[0]??null);let ni=(yt=(yi=Pt[0])==null?void 0:yi.properties)==null?void 0:yt.cluster_id;Te("mouseenter",{event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt})}function Mi(Xe){var yi,yt,it;if(!ve||!y)return;if(we&&Je(Xe)!==k){n(6,de=null),le&&Tt!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:V,id:Tt},{hover:!1}),Tt=void 0);return}y.getCanvas().style.cursor=pe;let Pt=Xe.features??[],ni=(yt=(yi=Pt[0])==null?void 0:yi.properties)==null?void 0:yt.cluster_id,$e=(it=Pt[0])==null?void 0:it.id;$e!==Tt&&(le&&(Tt!==void 0&&(y==null||y.setFeatureState({source:a,id:Tt,sourceLayer:V},{hover:!1})),y==null||y.setFeatureState({source:a,id:$e,sourceLayer:V},{hover:!0})),Tt=$e,n(6,de=Pt[0]??null)),Te("mousemove",{event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt})}function Pi(Xe){if(!(!ve||!k||!y)){if(pe&&(y.getCanvas().style.cursor=""),n(6,de=null),le&&Tt!==void 0){const Pt={source:a,id:Tt,sourceLayer:V};y==null||y.setFeatureState(Pt,{hover:!1}),Tt=void 0}Te("mouseleave",{map:y,layer:k,source:a})}}let Ti=!0;function At(Xe){y&&(y.off("click",Xe,Ht),y.off("dblclick",Xe,Ht),y.off("contextmenu",Xe,Ht),y.off("mouseenter",Xe,li),y.off("mousemove",Xe,Mi),y.off("mouseleave",Xe,Pi))}return ps(()=>{y&&k&&At(k)}),r.$$set=Xe=>{"id"in Xe&&n(7,N=Xe.id),"source"in Xe&&n(8,z=Xe.source),"sourceLayer"in Xe&&n(9,V=Xe.sourceLayer),"beforeId"in Xe&&n(10,Y=Xe.beforeId),"beforeLayerType"in Xe&&n(11,se=Xe.beforeLayerType),"type"in Xe&&n(12,$=Xe.type),"paint"in Xe&&n(13,te=Xe.paint),"layout"in Xe&&n(14,U=Xe.layout),"filter"in Xe&&n(15,j=Xe.filter),"applyToClusters"in Xe&&n(16,G=Xe.applyToClusters),"minzoom"in Xe&&n(17,O=Xe.minzoom),"maxzoom"in Xe&&n(18,W=Xe.maxzoom),"manageHoverState"in Xe&&n(19,le=Xe.manageHoverState),"hovered"in Xe&&n(6,de=Xe.hovered),"interactive"in Xe&&n(20,ve=Xe.interactive),"hoverCursor"in Xe&&n(21,pe=Xe.hoverCursor),"eventsIfTopMost"in Xe&&n(22,we=Xe.eventsIfTopMost),"$$scope"in Xe&&n(35,R=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,o=$k(G)),r.$$.dirty[0]&1073774592&&n(24,c=Qk("all",o,j)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,d=O??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,h=W??E),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,a=z||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&k!==N&&a){k&&(At(k),wt.delete(k));let Xe=Y;if(!Y&&se){let Pt=y.getStyle().layers,ni=typeof se=="function"?se:yi=>yi.type===se,$e=Pt==null?void 0:Pt.find(ni);$e&&(Xe=$e.id)}Qi(We,k=N,k),y.addLayer(Wl({id:k,type:$,source:a,"source-layer":V,filter:c,paint:te,layout:U,minzoom:d,maxzoom:h}),Xe),n(23,Ti=!0),y.on("click",k,Ht),y.on("dblclick",k,Ht),y.on("contextmenu",k,Ht),y.on("mouseenter",k,li),y.on("mousemove",k,Mi),y.on("mouseleave",k,Pi)}r.$$.dirty[0]&1048577&&k&&wt.set(k,{interactive:ve}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,_=k?T_((Xe,Pt)=>{y!=null&&y.style._loaded?y.setPaintProperty(k,Xe,Pt):y==null||y.once("styledata",()=>y==null?void 0:y.setPaintProperty(k,Xe,Pt))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,S=k?T_((Xe,Pt)=>{y!=null&&y.style._loaded?y.setLayoutProperty(k,Xe,Pt):y==null||y.once("styledata",()=>y==null?void 0:y.setLayoutProperty(k,Xe,Pt))}):void 0),r.$$.dirty[0]&268443648&&(_==null||_(te)),r.$$.dirty[0]&134234112&&(S==null||S(U)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(y==null||y.setLayerZoomRange(k,d,h)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(Ti?n(23,Ti=!1):y==null||y.setFilter(k,c))},[k,Ae,ct,We,pt,kt,de,N,z,V,Y,se,$,te,U,j,G,O,W,le,ve,pe,we,Ti,c,h,d,S,_,a,o,y,C,E,T,R,M]}class Ef extends ai{constructor(e){super(),oi(this,e,tS,eS,Yt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function iS(r){let e;const n=r[16].default,o=wn(n,r,r[24],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&16777216)&&kn(o,n,c,c[24],e?xn(n,c[24],d,null):Sn(c[24]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function nS(r){let e,n,o;function c(h){r[17](h)}let d={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[iS]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new Ef({props:d}),mi.push(()=>Ri(e,"hovered",c)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.applyToClusters=h[9]),a&1024&&(_.minzoom=h[10]),a&2048&&(_.maxzoom=h[11]),a&4096&&(_.hoverCursor=h[12]),a&8192&&(_.manageHoverState=h[13]),a&16384&&(_.eventsIfTopMost=h[14]),a&32768&&(_.interactive=h[15]),a&16777216&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function rS(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=su("circle")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:Y=!0}=e;function se(W){z=W,n(0,z)}function $(W){Di.call(this,r,W)}function te(W){Di.call(this,r,W)}function U(W){Di.call(this,r,W)}function j(W){Di.call(this,r,W)}function G(W){Di.call(this,r,W)}function O(W){Di.call(this,r,W)}return r.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,h=W.source),"sourceLayer"in W&&n(3,a=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,S=W.beforeLayerType),"paint"in W&&n(6,k=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,C=W.filter),"applyToClusters"in W&&n(9,E=W.applyToClusters),"minzoom"in W&&n(10,T=W.minzoom),"maxzoom"in W&&n(11,M=W.maxzoom),"hoverCursor"in W&&n(12,R=W.hoverCursor),"manageHoverState"in W&&n(13,N=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,V=W.eventsIfTopMost),"interactive"in W&&n(15,Y=W.interactive),"$$scope"in W&&n(24,c=W.$$scope)},[z,d,h,a,_,S,k,y,C,E,T,M,R,N,V,Y,o,se,$,te,U,j,G,O,c]}class Gl extends ai{constructor(e){super(),oi(this,e,rS,nS,Yt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function sS(r){let e,n;const o=r[7].default,c=wn(o,r,r[6],null);return{c(){e=xe("div"),c&&c.c(),he(e,"class",r[1]),gr(e,"maplibregl-ctrl",r[0])},m(d,h){be(d,e,h),c&&c.m(e,null),r[8](e),n=!0},p(d,[h]){c&&c.p&&(!n||h&64)&&kn(c,o,d,d[6],n?xn(o,d[6],h,null):Sn(d[6]),null),(!n||h&2)&&he(e,"class",d[1]),(!n||h&3)&&gr(e,"maplibregl-ctrl",d[0])},i(d){n||(Pe(c,d),n=!0)},o(d){De(c,d),n=!1},d(d){d&&ye(e),c&&c.d(d),r[8](null)}}}function oS(r,e,n){let o,{$$slots:c={},$$scope:d}=e,{defaultStyling:h=!0}=e,{position:a="top-right"}=e,{class:_=void 0}=e;const{map:S}=al();Bt(r,S,E=>n(5,o=E));let k,y={onAdd(){return k},onRemove(){var E;(E=k==null?void 0:k.parentNode)==null||E.removeChild(k)}};ps(()=>{o==null||o.removeControl(y)});function C(E){mi[E?"unshift":"push"](()=>{k=E,n(2,k)})}return r.$$set=E=>{"defaultStyling"in E&&n(0,h=E.defaultStyling),"position"in E&&n(4,a=E.position),"class"in E&&n(1,_=E.class),"$$scope"in E&&n(6,d=E.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&o&&k&&o.addControl(y,a)},[h,_,k,S,a,o,d,c,C]}class aS extends ai{constructor(e){super(),oi(this,e,oS,sS,Yt,{defaultStyling:0,position:4,class:1})}}function lS(r){let e;const n=r[15].default,o=wn(n,r,r[23],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&8388608)&&kn(o,n,c,c[23],e?xn(n,c[23],d,null):Sn(c[23]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function cS(r){let e,n,o;function c(h){r[16](h)}let d={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[lS]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new Ef({props:d}),mi.push(()=>Ri(e,"hovered",c)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.minzoom=h[9]),a&1024&&(_.maxzoom=h[10]),a&2048&&(_.hoverCursor=h[11]),a&4096&&(_.manageHoverState=h[12]),a&8192&&(_.eventsIfTopMost=h[13]),a&16384&&(_.interactive=h[14]),a&8388608&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function uS(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=su("fill")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:R=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:V=!0}=e;function Y(O){N=O,n(0,N)}function se(O){Di.call(this,r,O)}function $(O){Di.call(this,r,O)}function te(O){Di.call(this,r,O)}function U(O){Di.call(this,r,O)}function j(O){Di.call(this,r,O)}function G(O){Di.call(this,r,O)}return r.$$set=O=>{"id"in O&&n(1,d=O.id),"source"in O&&n(2,h=O.source),"sourceLayer"in O&&n(3,a=O.sourceLayer),"beforeId"in O&&n(4,_=O.beforeId),"beforeLayerType"in O&&n(5,S=O.beforeLayerType),"paint"in O&&n(6,k=O.paint),"layout"in O&&n(7,y=O.layout),"filter"in O&&n(8,C=O.filter),"minzoom"in O&&n(9,E=O.minzoom),"maxzoom"in O&&n(10,T=O.maxzoom),"hoverCursor"in O&&n(11,M=O.hoverCursor),"manageHoverState"in O&&n(12,R=O.manageHoverState),"hovered"in O&&n(0,N=O.hovered),"eventsIfTopMost"in O&&n(13,z=O.eventsIfTopMost),"interactive"in O&&n(14,V=O.interactive),"$$scope"in O&&n(23,c=O.$$scope)},[N,d,h,a,_,S,k,y,C,E,T,M,R,z,V,o,Y,se,$,te,U,j,G,c]}class hS extends ai{constructor(e){super(),oi(this,e,uS,cS,Yt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function fS(r,e,n){let o;const{map:c}=al();Bt(r,c,_=>n(4,o=_));let{position:d="top-left"}=e,{container:h=void 0}=e,a=null;return ps(()=>{o!=null&&o.loaded()&&a&&o.removeControl(a)}),r.$$set=_=>{"position"in _&&n(1,d=_.position),"container"in _&&n(2,h=_.container)},r.$$.update=()=>{if(r.$$.dirty&30&&o&&!a){let _;typeof h=="string"?_=document.querySelector(h)??void 0:_=h,n(3,a=new Gs.FullscreenControl({container:_})),o.addControl(a,d)}},[c,d,h,a,o]}class dS extends ai{constructor(e){super(),oi(this,e,fS,null,Yt,{position:1,container:2})}}function pS(r,e,n,o,c){let d=!1;r.getSource(e)&&(d=!0,r.removeSource(e));const h=()=>{o(e)&&(r.addSource(e,n),c())};if(d){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):h())};a()}else h()}function mS(r,e,n){p0().then(()=>{let o=a0(r);if(!o)return;o.getSource(e)===n&&o.removeSource(e)})}function I_(r){let e=r[0],n,o,c=A_(r);return{c(){c.c(),n=Mn()},m(d,h){c.m(d,h),be(d,n,h),o=!0},p(d,h){h&1&&Yt(e,e=d[0])?(nn(),De(c,1,1,Ot),rn(),c=A_(d),c.c(),Pe(c,1),c.m(n.parentNode,n)):c.p(d,h)},i(d){o||(Pe(c),o=!0)},o(d){De(c),o=!1},d(d){d&&ye(n),c.d(d)}}}function A_(r){let e;const n=r[19].default,o=wn(n,r,r[18],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&262144)&&kn(o,n,c,c[18],e?xn(n,c[18],d,null):Sn(c[18]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function gS(r){let e,n,o=r[0]&&I_(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),be(c,e,d),n=!0},p(c,[d]){c[0]?o?(o.p(c,d),d&1&&Pe(o,1)):(o=I_(c),o.c(),Pe(o,1),o.m(e.parentNode,e)):o&&(nn(),De(o,1,1,()=>{o=null}),rn())},i(c){n||(Pe(o),n=!0)},o(c){De(o),n=!1},d(c){c&&ye(e),o&&o.d(c)}}}function _S(r,e,n){let o,c,d,{$$slots:h={},$$scope:a}=e,{id:_=su("geojson")}=e,{data:S}=e,{generateId:k=!1}=e,{promoteId:y=void 0}=e,{filter:C=void 0}=e,{lineMetrics:E=void 0}=e,{cluster:T=void 0}=e,{maxzoom:M=void 0}=e,{attribution:R=void 0}=e,{buffer:N=void 0}=e,{tolerance:z=void 0}=e;const{map:V,cluster:Y,self:se}=Xk();Bt(r,V,U=>n(17,c=U)),Bt(r,Y,U=>n(20,d=U)),Bt(r,se,U=>n(0,o=U));let $,te=!0;return ps(()=>{o&&$&&c&&(mS(V,o,$),Qi(se,o=null,o),n(15,$=void 0))}),r.$$set=U=>{"id"in U&&n(4,_=U.id),"data"in U&&n(5,S=U.data),"generateId"in U&&n(6,k=U.generateId),"promoteId"in U&&n(7,y=U.promoteId),"filter"in U&&n(8,C=U.filter),"lineMetrics"in U&&n(9,E=U.lineMetrics),"cluster"in U&&n(10,T=U.cluster),"maxzoom"in U&&n(11,M=U.maxzoom),"attribution"in U&&n(12,R=U.attribution),"buffer"in U&&n(13,N=U.buffer),"tolerance"in U&&n(14,z=U.tolerance),"$$scope"in U&&n(18,a=U.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Qi(Y,d=T,d),r.$$.dirty&196593&&c&&o!==_&&(Qi(se,o=_,o),pS(c,o,Wl({type:"geojson",data:S,filter:C,lineMetrics:E,generateId:k,promoteId:y,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties,maxzoom:M,attribution:R,buffer:N,tolerance:z}),U=>c&&U===o,()=>{o&&(n(15,$=c==null?void 0:c.getSource(o)),n(16,te=!0))})),r.$$.dirty&131088&&(c==null||c.on("style.load",()=>{n(15,$=c==null?void 0:c.getSource(_))})),r.$$.dirty&98336&&$&&(te?n(16,te=!1):$.setData(S)),r.$$.dirty&33792&&($==null||$.setClusterOptions(Wl({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[o,V,Y,se,_,S,k,y,C,E,T,M,R,N,z,$,te,c,a,h]}class Ir extends ai{constructor(e){super(),oi(this,e,_S,gS,Yt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function yS(r,e,n){let o;const{map:c}=al();Bt(r,c,C=>n(8,o=C));let{position:d="top-left"}=e,{positionOptions:h=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:S=!0}=e,{showUserLocation:k=!0}=e,{control:y=null}=e;return ps(()=>{o!=null&&o.loaded()&&y&&o.removeControl(y)}),r.$$set=C=>{"position"in C&&n(2,d=C.position),"positionOptions"in C&&n(3,h=C.positionOptions),"fitBoundsOptions"in C&&n(4,a=C.fitBoundsOptions),"trackUserLocation"in C&&n(5,_=C.trackUserLocation),"showAccuracyCircle"in C&&n(6,S=C.showAccuracyCircle),"showUserLocation"in C&&n(7,k=C.showUserLocation),"control"in C&&n(1,y=C.control)},r.$$.update=()=>{r.$$.dirty&510&&o&&!y&&(n(1,y=new Gs.GeolocateControl({positionOptions:h,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:S,showUserLocation:k})),o.addControl(y,d))},[c,y,d,h,a,_,S,k,o]}class bS extends ai{constructor(e){super(),oi(this,e,yS,null,Yt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function vS(r){let e;const n=r[15].default,o=wn(n,r,r[23],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&8388608)&&kn(o,n,c,c[23],e?xn(n,c[23],d,null):Sn(c[23]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function wS(r){let e,n,o;function c(h){r[16](h)}let d={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[vS]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new Ef({props:d}),mi.push(()=>Ri(e,"hovered",c)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.minzoom=h[9]),a&1024&&(_.maxzoom=h[10]),a&2048&&(_.hoverCursor=h[11]),a&4096&&(_.manageHoverState=h[12]),a&8192&&(_.eventsIfTopMost=h[13]),a&16384&&(_.interactive=h[14]),a&8388608&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function xS(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=su("line")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:R=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:V=!0}=e;function Y(O){N=O,n(0,N)}function se(O){Di.call(this,r,O)}function $(O){Di.call(this,r,O)}function te(O){Di.call(this,r,O)}function U(O){Di.call(this,r,O)}function j(O){Di.call(this,r,O)}function G(O){Di.call(this,r,O)}return r.$$set=O=>{"id"in O&&n(1,d=O.id),"source"in O&&n(2,h=O.source),"sourceLayer"in O&&n(3,a=O.sourceLayer),"beforeId"in O&&n(4,_=O.beforeId),"beforeLayerType"in O&&n(5,S=O.beforeLayerType),"paint"in O&&n(6,k=O.paint),"layout"in O&&n(7,y=O.layout),"filter"in O&&n(8,C=O.filter),"minzoom"in O&&n(9,E=O.minzoom),"maxzoom"in O&&n(10,T=O.maxzoom),"hoverCursor"in O&&n(11,M=O.hoverCursor),"manageHoverState"in O&&n(12,R=O.manageHoverState),"hovered"in O&&n(0,N=O.hovered),"eventsIfTopMost"in O&&n(13,z=O.eventsIfTopMost),"interactive"in O&&n(14,V=O.interactive),"$$scope"in O&&n(23,c=O.$$scope)},[N,d,h,a,_,S,k,y,C,E,T,M,R,z,V,o,Y,se,$,te,U,j,G,c]}class ga extends ai{constructor(e){super(),oi(this,e,xS,wS,Yt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function kS(r,e,n){let o;const c=sl();let{layer:d=void 0}=e;const{map:h}=al();Bt(r,h,k=>n(2,o=k));function a(k){c(k.type,{...k,map:h})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],S=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ps(()=>{if(o)if(d)for(const k of _)o.off(k,d,a);else for(const k of S)o.off(k,a)}),r.$$set=k=>{"layer"in k&&n(1,d=k.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&o)if(d)for(const k of _)o.on(k,d,a);else for(const k of S)o.on(k,a)},[h,d,o]}class mb extends ai{constructor(e){super(),oi(this,e,kS,null,Yt,{layer:1})}}function SS(r){let e=r.getCenter(),n=Math.round(r.getZoom()*100)/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,o),d=Math.round(e.lat*c)/c,h=Math.round(e.lng*c)/c,a=`${n}/${d}/${h}`,_=r.getBearing(),S=r.getPitch();return(_||S)&&(a+=`/${Math.round(_*10)/10}`),S&&(a+=`/${Math.round(S)}`),`#${a}`}function TS(r){return r.replace("#","").split("/").map(parseFloat)}function CS(r,e,n){let o;const{map:c}=al();Bt(r,c,k=>n(6,o=k));let{position:d="top-left"}=e,{showCompass:h=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,S=null;return ps(()=>{o!=null&&o.loaded()&&S&&o.removeControl(S)}),r.$$set=k=>{"position"in k&&n(1,d=k.position),"showCompass"in k&&n(2,h=k.showCompass),"showZoom"in k&&n(3,a=k.showZoom),"visualizePitch"in k&&n(4,_=k.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&o&&!S&&(n(5,S=new Gs.NavigationControl({showCompass:h,showZoom:a,visualizePitch:_})),o.addControl(S,d))},[c,d,h,a,_,S,o]}class gb extends ai{constructor(e){super(),oi(this,e,CS,null,Yt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function ES(r,e,n){let o;const{map:c}=al();Bt(r,c,S=>n(5,o=S));let{position:d="bottom-left"}=e,{maxWidth:h=void 0}=e,{unit:a="metric"}=e,_=null;return ps(()=>{o!=null&&o.loaded()&&_&&o.removeControl(_)}),r.$$set=S=>{"position"in S&&n(1,d=S.position),"maxWidth"in S&&n(2,h=S.maxWidth),"unit"in S&&n(3,a=S.unit)},r.$$.update=()=>{r.$$.dirty&62&&o&&!_&&(n(4,_=new Gs.ScaleControl({maxWidth:h,unit:a})),o.addControl(_,d))},[c,d,h,a,_,o]}class _b extends ai{constructor(e){super(),oi(this,e,ES,null,Yt,{position:1,maxWidth:2,unit:3})}}const{window:IS}=c0,AS=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),M_=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function P_(r){let e,n,o=r[3]&&L_(r);const c=r[46].default,d=wn(c,r,r[45],M_);return{c(){o&&o.c(),e=Ue(),d&&d.c()},m(h,a){o&&o.m(h,a),be(h,e,a),d&&d.m(h,a),n=!0},p(h,a){h[3]?o?(o.p(h,a),a[0]&8&&Pe(o,1)):(o=L_(h),o.c(),Pe(o,1),o.m(e.parentNode,e)):o&&(nn(),De(o,1,1,()=>{o=null}),rn()),d&&d.p&&(!n||a[0]&112|a[1]&16384)&&kn(d,c,h,h[45],n?xn(c,h[45],a,AS):Sn(h[45]),M_)},i(h){n||(Pe(o),Pe(d,h),n=!0)},o(h){De(o),De(d,h),n=!1},d(h){h&&ye(e),o&&o.d(h),d&&d.d(h)}}}function L_(r){let e,n,o,c,d,h,a,_;return e=new gb({props:{position:r[7]}}),o=new bS({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),d=new dS({props:{position:r[7]}}),a=new _b({props:{position:r[7]}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment),c=Ue(),lt(d.$$.fragment),h=Ue(),lt(a.$$.fragment)},m(S,k){ot(e,S,k),be(S,n,k),ot(o,S,k),be(S,c,k),ot(d,S,k),be(S,h,k),ot(a,S,k),_=!0},p(S,k){const y={};k[0]&128&&(y.position=S[7]),e.$set(y);const C={};k[0]&128&&(C.position=S[7]),o.$set(C);const E={};k[0]&128&&(E.position=S[7]),d.$set(E);const T={};k[0]&128&&(T.position=S[7]),a.$set(T)},i(S){_||(Pe(e.$$.fragment,S),Pe(o.$$.fragment,S),Pe(d.$$.fragment,S),Pe(a.$$.fragment,S),_=!0)},o(S){De(e.$$.fragment,S),De(o.$$.fragment,S),De(d.$$.fragment,S),De(a.$$.fragment,S),_=!1},d(S){S&&(ye(n),ye(c),ye(h)),at(e,S),at(o,S),at(d,S),at(a,S)}}}function MS(r){let e,n,o,c,d,h=r[4]&&r[0]&&P_(r);return{c(){e=xe("div"),h&&h.c(),he(e,"class",n=Yc(r[2])+" svelte-p00lfq"),he(e,"data-testid","map-container"),gr(e,"expand-map",!r[2])},m(a,_){be(a,e,_),h&&h.m(e,null),r[47](e),o=!0,c||(d=[Ut(IS,"hashchange",r[11]),S1(r[10].call(null,e))],c=!0)},p(a,_){a[4]&&a[0]?h?(h.p(a,_),_[0]&17&&Pe(h,1)):(h=P_(a),h.c(),Pe(h,1),h.m(e,null)):h&&(nn(),De(h,1,1,()=>{h=null}),rn()),(!o||_[0]&4&&n!==(n=Yc(a[2])+" svelte-p00lfq"))&&he(e,"class",n),(!o||_[0]&4)&&gr(e,"expand-map",!a[2])},i(a){o||(Pe(h),o=!0)},o(a){De(h),o=!1},d(a){a&&ye(e),h&&h.d(),r[47](null),c=!1,jn(d)}}}function PS(r,e,n){let o,c,d,h,{$$slots:a={},$$scope:_}=e,{map:S=null}=e,{mapContainer:k=void 0}=e,{class:y=void 0}=e,{style:C}=e,{diffStyleUpdates:E=!1}=e,{center:T=void 0}=e,{zoom:M=void 0}=e,{pitch:R=0}=e,{bearing:N=0}=e,{bounds:z=void 0}=e,{hash:V=!1}=e,{updateHash:Y=it=>{window.history.replaceState(window.history.state,"",it)}}=e,{loaded:se=!1}=e,{minZoom:$=0}=e,{maxZoom:te=22}=e,{minPitch:U=0}=e,{maxPitch:j=60}=e,{renderWorldCopies:G=void 0}=e,{dragPan:O=void 0}=e,{dragRotate:W=void 0}=e,{pitchWithRotate:le=void 0}=e,{antialias:de=void 0}=e,{zoomOnDoubleClick:ve=!0}=e,{locale:pe=void 0}=e,{interactive:we=!0}=e,{attributionControl:Te=!0}=e,{cooperativeGestures:Ae=!1}=e,{preserveDrawingBuffer:ct=!1}=e,{maxBounds:We=void 0}=e,{images:pt=[]}=e,{standardControls:kt=!1}=e,{filterLayers:Je=void 0}=e,{transformRequest:wt=void 0}=e;const Tt=sl(),{map:Ht,loadedImages:li}=Hk();Bt(r,Ht,it=>n(4,d=it)),Bt(r,li,it=>n(5,h=it));let Mi=new Set;async function Pi(it,fe=!1){if(d&&!(!d.loaded()&&!fe))if("url"in it){Mi.add(it.id);try{let X=await d.loadImage(it.url);d==null||d.addImage(it.id,X.data,it.options),h.add(it.id),li.set(h)}catch(X){Tt("error",X)}finally{Mi.delete(it.id)}}else d.addImage(it.id,it.data,it.options),h.add(it.id),li.set(h)}let Ti,At,Xe,Pt;function ni(it){return yi(),Qi(Ht,d=new Gs.Map(Wl({container:it,style:C,locale:pe,center:T,zoom:M,pitch:R,bearing:N,minZoom:$,maxZoom:te,minPitch:U,maxPitch:j,renderWorldCopies:G,dragPan:O,dragRotate:W,pitchWithRotate:le,antialias:de,interactive:we,preserveDrawingBuffer:ct,maxBounds:We,bounds:z,attributionControl:Te,transformRequest:wt,cooperativeGestures:Ae})),d),d.on("load",fe=>{fe.target.getContainer().setAttribute("data-testid","map"),fe.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,se=!0),Tt("load",d)}),d.on("error",fe=>Tt("error",{...fe,map:d})),d.on("movestart",fe=>Tt("movestart",{...fe,map:d})),d.on("moveend",fe=>{if(n(12,T=fe.target.getCenter()),n(13,M=fe.target.getZoom()),n(14,R=fe.target.getPitch()),n(15,N=fe.target.getBearing()),n(16,z=fe.target.getBounds()),Tt("moveend",{...fe,map:d}),V){let X=new URL(window.location.href.replace(/(#.+)?$/,SS(d)));Y(X)}}),d.on("click",fe=>Tt("click",{...fe,map:d})),d.on("dblclick",fe=>Tt("dblclick",{...fe,map:d})),d.on("contextmenu",fe=>Tt("contextmenu",{...fe,map:d})),d.on("zoomstart",fe=>Tt("zoomstart",{...fe,map:d})),d.on("zoom",fe=>{Tt("zoom",{...fe,map:d})}),d.on("zoomend",fe=>{Tt("zoomend",{...fe,map:d})}),d.on("style.load",()=>{if(d){const fe=d.getStyle();if(n(42,Ti=fe.layers.map(X=>X.id)),n(43,At=Object.keys(fe.sources)),Pt)for(const[X,Q]of Object.entries(Pt))d.addSource(X,Q);if(Xe)for(const X of Xe)d.addLayer(X);for(const X of pt)Pi(X,!0)}}),d.on("styledata",fe=>{if(d&&Je){const X=d.getStyle().layers;if(X)for(let Q of X)Je(Q)||d.setLayoutProperty(Q.id,"visibility","none")}Tt("styledata",{...fe,map:d})}),{destroy(){n(0,se=!1),d==null||d.remove(),Qi(Ht,d=null,d)}}}let $e=C;function yi(){if(V){let it=TS(window.location.hash);if(it.some(isNaN))return;it.length>=3&&(n(13,M=it[0]),n(12,T=[it[2],it[1]])),it.length==5&&(n(15,N=it[3]),n(14,R=it[4]))}}function yt(it){mi[it?"unshift":"push"](()=>{k=it,n(1,k)})}return r.$$set=it=>{"map"in it&&n(17,S=it.map),"mapContainer"in it&&n(1,k=it.mapContainer),"class"in it&&n(2,y=it.class),"style"in it&&n(18,C=it.style),"diffStyleUpdates"in it&&n(19,E=it.diffStyleUpdates),"center"in it&&n(12,T=it.center),"zoom"in it&&n(13,M=it.zoom),"pitch"in it&&n(14,R=it.pitch),"bearing"in it&&n(15,N=it.bearing),"bounds"in it&&n(16,z=it.bounds),"hash"in it&&n(20,V=it.hash),"updateHash"in it&&n(21,Y=it.updateHash),"loaded"in it&&n(0,se=it.loaded),"minZoom"in it&&n(22,$=it.minZoom),"maxZoom"in it&&n(23,te=it.maxZoom),"minPitch"in it&&n(24,U=it.minPitch),"maxPitch"in it&&n(25,j=it.maxPitch),"renderWorldCopies"in it&&n(26,G=it.renderWorldCopies),"dragPan"in it&&n(27,O=it.dragPan),"dragRotate"in it&&n(28,W=it.dragRotate),"pitchWithRotate"in it&&n(29,le=it.pitchWithRotate),"antialias"in it&&n(30,de=it.antialias),"zoomOnDoubleClick"in it&&n(31,ve=it.zoomOnDoubleClick),"locale"in it&&n(32,pe=it.locale),"interactive"in it&&n(33,we=it.interactive),"attributionControl"in it&&n(34,Te=it.attributionControl),"cooperativeGestures"in it&&n(35,Ae=it.cooperativeGestures),"preserveDrawingBuffer"in it&&n(36,ct=it.preserveDrawingBuffer),"maxBounds"in it&&n(37,We=it.maxBounds),"images"in it&&n(38,pt=it.images),"standardControls"in it&&n(3,kt=it.standardControls),"filterLayers"in it&&n(39,Je=it.filterLayers),"transformRequest"in it&&n(40,wt=it.transformRequest),"$$scope"in it&&n(45,_=it.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&n(7,o=typeof kt=="boolean"?void 0:kt),r.$$.dirty[0]&16&&n(17,S=d),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&d&&!Nc(C,$e)){const it=d.getStyle();if(Ti&&(Xe=it.layers.filter(fe=>!Ti.includes(fe.id))),At){const fe=Object.keys(it.sources).filter(X=>!At.includes(X));Pt={};for(const X of fe)Pt[X]=it.sources[X]}n(44,$e=C),d.setStyle(C,{diff:E}),Qi(li,h=new Set,h),n(41,Mi=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&se&&d!=null&&d.loaded())for(let it of pt)!h.has(it.id)&&!Mi.has(it.id)&&!d.hasImage(it.id)&&Pi(it);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&n(6,c=pt.every(it=>h.has(it.id))),r.$$.dirty[0]&61456&&d){let it={};T!=null&&!Nc(T,d==null?void 0:d.getCenter())&&(it.center=T),M!=null&&!Nc(M,d==null?void 0:d.getZoom())&&(it.zoom=M),N!=null&&!Nc(N,d==null?void 0:d.getBearing())&&(it.bearing=N),R!=null&&!Nc(R,d==null?void 0:d.getPitch())&&(it.pitch=R),Object.keys(it).length&&d.easeTo(it)}r.$$.dirty[0]&65552&&z&&!Nc(z,d==null?void 0:d.getBounds())&&(d==null||d.fitBounds(z)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(ve?d==null||d.doubleClickZoom.enable():d==null||d.doubleClickZoom.disable())},[se,k,y,kt,d,h,c,o,Ht,li,ni,yi,T,M,R,N,z,S,C,E,V,Y,$,te,U,j,G,O,W,le,de,ve,pe,we,Te,Ae,ct,We,pt,Je,wt,Mi,Ti,At,$e,_,a,yt]}class LS extends ai{constructor(e){super(),oi(this,e,PS,MS,Yt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const zS=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),z_=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[32]}};function O_(r){var c;let e,n,o=(((c=r[4])==null?void 0:c.length)||r[3]instanceof Gs.Marker)&&D_(r);return{c(){e=xe("div"),o&&o.c()},m(d,h){be(d,e,h),o&&o.m(e,null),r[33](e),n=!0},p(d,h){var a;(a=d[4])!=null&&a.length||d[3]instanceof Gs.Marker?o?(o.p(d,h),h[0]&24&&Pe(o,1)):(o=D_(d),o.c(),Pe(o,1),o.m(e,null)):o&&(nn(),De(o,1,1,()=>{o=null}),rn())},i(d){n||(Pe(o),n=!0)},o(d){De(o),n=!1},d(d){d&&ye(e),o&&o.d(),r[33](null)}}}function D_(r){let e;const n=r[31].default,o=wn(n,r,r[30],z_);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d[0]&1073741845)&&kn(o,n,c,c[30],e?xn(n,c[30],d,zS):Sn(c[30]),z_)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function OS(r){let e,n,o=r[9].default&&O_(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),be(c,e,d),n=!0},p(c,d){c[9].default?o?(o.p(c,d),d[0]&512&&Pe(o,1)):(o=O_(c),o.c(),Pe(o,1),o.m(e.parentNode,e)):o&&(nn(),De(o,1,1,()=>{o=null}),rn())},i(c){n||(Pe(o),n=!0)},o(c){De(o),n=!1},d(c){c&&ye(e),o&&o.d(c)}}}function DS(r,e,n){let o,c,d,h,a,_,{$$slots:S={},$$scope:k}=e;const y=k1(S);let{closeButton:C=void 0}=e,{closeOnClickOutside:E=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:M=!1}=e,{openOn:R="click"}=e,{openIfTopMost:N=!0}=e,{canOpen:z=void 0}=e,{focusAfterOpen:V=!0}=e,{anchor:Y=void 0}=e,{offset:se=void 0}=e,{popupClass:$=void 0}=e,{maxWidth:te=void 0}=e,{lngLat:U=void 0}=e,{html:j=void 0}=e,{open:G=!1}=e;const O=sl(),{map:W,popupTarget:le,layerEvent:de,layer:ve,eventTopMost:pe,markerClickManager:we}=al();Bt(r,W,yt=>n(2,d=yt)),Bt(r,le,yt=>n(3,a=yt)),Bt(r,de,yt=>n(29,h=yt)),Bt(r,ve,yt=>n(36,_=yt));const Te=["click","dblclick","contextmenu"];let Ae,ct=!1,We;function pt(){if(!Ae)return;let yt=Ae.getElement();!yt||yt===We||(We=yt,R==="hover"&&(We.style.pointerEvents="none"),We.addEventListener("mouseenter",()=>{n(25,ct=!0)},{passive:!0}),We.addEventListener("mouseleave",()=>{n(25,ct=!1)},{passive:!0}),We.addEventListener("click",()=>{T&&n(0,G=!1)},{passive:!0}))}sp(()=>{if(d)return d.on("click",Xe),d.on("contextmenu",Xe),we.add(Pt),typeof a=="string"&&(d.on("click",a,Ht),d.on("dblclick",a,Ht),d.on("contextmenu",a,Ht),d.on("mousemove",a,At),d.on("mouseleave",a,Ti),d.on("touchstart",a,Mi),d.on("touchend",a,Pi)),()=>{d!=null&&d.loaded()&&(Ae==null||Ae.remove(),d.off("click",Xe),d.off("contextmenu",Xe),we.remove(Pt),a instanceof Gs.Marker?a.getPopup()===Ae&&a.setPopup(void 0):typeof a=="string"&&(d.off("click",a,Ht),d.off("dblclick",a,Ht),d.off("contextmenu",a,Ht),d.off("mousemove",a,At),d.off("mouseleave",a,Ti),d.off("touchstart",a,Mi),d.off("touchend",a,Pi)))}});function kt(yt){return N?!("marker"in yt)&&!Jk(yt)&&pe(yt)!==_:!1}let Je=null,wt="normal";function Tt(yt){"layerType"in yt&&yt.layerType==="deckgl"?(n(10,U=yt.coordinate),n(4,Je=yt.object?[yt.object]:null)):(n(10,U=yt.lngLat),n(4,Je=yt.features??[]))}function Ht(yt){yt.type!==R||kt(yt)||(Tt(yt),setTimeout(()=>n(0,G=!0)))}let li=null;function Mi(yt){li=yt.point}function Pi(yt){if(!li||R!=="hover")return;let it=li.dist(yt.point);li=null,it<3&&(n(10,U=yt.lngLat),n(4,Je=yt.features??[]),Ae.isOpen()?n(26,wt="justOpened"):(n(26,wt="opening"),n(0,G=!0)))}function Ti(yt){R!=="hover"||li||wt!=="normal"||(n(0,G=!1),n(4,Je=null))}function At(yt){if(!(R!=="hover"||li||wt!=="normal")){if(kt(yt)){n(0,G=!1),n(4,Je=null);return}if(n(0,G=!0),n(4,Je=yt.features??[]),n(10,U=yt.lngLat),z&&!z(yt.features??[])){n(0,G=!1);return}}}function Xe(yt){if(wt==="justOpened"){n(26,wt="normal");return}if(!E)return;let it=[We,a instanceof Gs.Marker?a==null?void 0:a.getElement():null];G&&Ae.isOpen()&&!it.some(fe=>fe==null?void 0:fe.contains(yt.originalEvent.target))&&(yt.type==="contextmenu"&&R==="contextmenu"||yt.type!=="contextmenu")&&n(0,G=!1)}function Pt(yt){E&&G&&Ae.isOpen()&&yt.marker!==a&&n(0,G=!1)}ps(()=>{d&&(Ae!=null&&Ae.isOpen())&&Ae.remove()});let ni;const $e=()=>n(0,G=!1);function yi(yt){mi[yt?"unshift":"push"](()=>{ni=yt,n(1,ni)})}return r.$$set=yt=>{"closeButton"in yt&&n(11,C=yt.closeButton),"closeOnClickOutside"in yt&&n(12,E=yt.closeOnClickOutside),"closeOnClickInside"in yt&&n(13,T=yt.closeOnClickInside),"closeOnMove"in yt&&n(14,M=yt.closeOnMove),"openOn"in yt&&n(15,R=yt.openOn),"openIfTopMost"in yt&&n(16,N=yt.openIfTopMost),"canOpen"in yt&&n(17,z=yt.canOpen),"focusAfterOpen"in yt&&n(18,V=yt.focusAfterOpen),"anchor"in yt&&n(19,Y=yt.anchor),"offset"in yt&&n(20,se=yt.offset),"popupClass"in yt&&n(21,$=yt.popupClass),"maxWidth"in yt&&n(22,te=yt.maxWidth),"lngLat"in yt&&n(10,U=yt.lngLat),"html"in yt&&n(23,j=yt.html),"open"in yt&&n(0,G=yt.open),"$$scope"in yt&&n(30,k=yt.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(28,o=C??(!E&&!T)),r.$$.dirty[0]&293355520&&(Ae||(n(24,Ae=new Gs.Popup({closeButton:o,closeOnClick:!1,closeOnMove:M,focusAfterOpen:V,maxWidth:te,className:$,anchor:Y,offset:se})),We=Ae.getElement(),Ae.on("open",()=>{n(0,G=!0),pt(),O("open",Ae)}),Ae.on("close",()=>{n(0,G=!1),O("close",Ae)}),Ae.on("hover",()=>{O("hover",Ae)}))),r.$$.dirty[0]&16809992&&Ae&&a instanceof Gs.Marker&&(R==="click"?a.setPopup(Ae):a.getPopup()===Ae&&a.setPopup(void 0)),r.$$.dirty[0]&536903680&&Te.includes(R)&&(h==null?void 0:h.type)===R&&(Ht(h),Qi(de,h=null,h)),r.$$.dirty[0]&536903680&&n(27,c=R==="hover"&&((h==null?void 0:h.type)==="mousemove"||(h==null?void 0:h.type)==="mouseenter")),r.$$.dirty[0]&704675840&&R==="hover"&&de&&(c&&h&&Tt(h),n(0,G=(c||ct)??!1)),r.$$.dirty[0]&25165826&&(ni?Ae.setDOMContent(ni):j&&Ae.setHTML(j)),r.$$.dirty[0]&16778240&&U&&Ae.setLngLat(U),r.$$.dirty[0]&83886085&&d){let yt=Ae.isOpen();G&&!yt?(Ae.addTo(d),wt==="opening"&&n(26,wt="justOpened")):!G&&yt&&Ae.remove()}},[G,ni,d,a,Je,W,le,de,ve,y,U,C,E,T,M,R,N,z,V,Y,se,$,te,j,Ae,ct,wt,c,o,h,k,S,$e,yi]}class Cp extends ai{constructor(e){super(),oi(this,e,DS,OS,Yt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,canOpen:17,focusAfterOpen:18,anchor:19,offset:20,popupClass:21,maxWidth:22,lngLat:10,html:23,open:0},null,[-1,-1])}}function FS(r){let e;const n=r[16].default,o=wn(n,r,r[24],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&16777216)&&kn(o,n,c,c[24],e?xn(n,c[24],d,null):Sn(c[24]),null)},i(c){e||(Pe(o,c),e=!0)},o(c){De(o,c),e=!1},d(c){o&&o.d(c)}}}function RS(r){let e,n,o;function c(h){r[17](h)}let d={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[FS]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new Ef({props:d}),mi.push(()=>Ri(e,"hovered",c)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.applyToClusters=h[9]),a&1024&&(_.minzoom=h[10]),a&2048&&(_.maxzoom=h[11]),a&4096&&(_.hoverCursor=h[12]),a&8192&&(_.manageHoverState=h[13]),a&16384&&(_.eventsIfTopMost=h[14]),a&32768&&(_.interactive=h[15]),a&16777216&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function BS(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=su("symbol")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k=void 0}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:Y=!0}=e;function se(W){z=W,n(0,z)}function $(W){Di.call(this,r,W)}function te(W){Di.call(this,r,W)}function U(W){Di.call(this,r,W)}function j(W){Di.call(this,r,W)}function G(W){Di.call(this,r,W)}function O(W){Di.call(this,r,W)}return r.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,h=W.source),"sourceLayer"in W&&n(3,a=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,S=W.beforeLayerType),"paint"in W&&n(6,k=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,C=W.filter),"applyToClusters"in W&&n(9,E=W.applyToClusters),"minzoom"in W&&n(10,T=W.minzoom),"maxzoom"in W&&n(11,M=W.maxzoom),"hoverCursor"in W&&n(12,R=W.hoverCursor),"manageHoverState"in W&&n(13,N=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,V=W.eventsIfTopMost),"interactive"in W&&n(15,Y=W.interactive),"$$scope"in W&&n(24,c=W.$$scope)},[z,d,h,a,_,S,k,y,C,E,T,M,R,N,V,Y,o,se,$,te,U,j,G,O,c]}class If extends ai{constructor(e){super(),oi(this,e,BS,RS,Yt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function NS(r){let e,n,o,c;return e=new gb({props:{showCompass:!1}}),o=new _b({}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment)},m(d,h){ot(e,d,h),be(d,n,h),ot(o,d,h),c=!0},p:Ot,i(d){c||(Pe(e.$$.fragment,d),Pe(o.$$.fragment,d),c=!0)},o(d){De(e.$$.fragment,d),De(o.$$.fragment,d),c=!1},d(d){d&&ye(n),at(e,d),at(o,d)}}}function jS(r,e,n){let{map:o}=e;return r.$$set=c=>{"map"in c&&n(0,o=c.map)},r.$$.update=()=>{r.$$.dirty&1&&o&&(o.keyboard.disableRotation(),o.dragRotate.disable(),o.touchZoomRotate.disableRotation())},[o]}class US extends ai{constructor(e){super(),oi(this,e,jS,NS,Yt,{map:0})}}const ep=["==",["geometry-type"],"LineString"],yb=["==",["geometry-type"],"Point"];function gh(r,e,n){let o=["match",r];for(let[c,d]of Object.entries(e))o.push(c),o.push(d);return o.push(n),o}function or(){return{type:"FeatureCollection",features:[]}}function bb(r){return e2(r)}let Zc="MZEJTanw3WpxRvt7qDfo",F_=`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${Zc}`,vb={Blank:{version:8,sources:{},layers:[],glyphs:F_},"Maptiler Streets":`https://api.maptiler.com/maps/streets-v2/style.json?key=${Zc}`,"Maptiler Dataviz":`https://api.maptiler.com/maps/dataviz/style.json?key=${Zc}`,"Maptiler Hybrid":`https://api.maptiler.com/maps/hybrid/style.json?key=${Zc}`,"Maptiler OpenStreetMap":`https://api.maptiler.com/maps/openstreetmap/style.json?key=${Zc}`,"Maptiler OS Open Zoomstack":`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${Zc}`,"ESRI World Imagery":{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"ESRI &copy; <a href='http://www.esri.com' target='_blank'>ESRI</a>",minzoom:0,maxzoom:18}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:F_}};function VS(r){let e,n,o,c,d,h,a;const _=r[2].default,S=wn(_,r,r[1],null);return{c(){e=xe("div"),n=xe("label"),o=xe("input"),c=Ue(),S&&S.c(),he(o,"class","form-check-input"),he(o,"type","checkbox"),he(n,"class","form-check-label"),he(e,"class","form-check")},m(k,y){be(k,e,y),ce(e,n),ce(n,o),o.checked=r[0],ce(n,c),S&&S.m(n,null),d=!0,h||(a=Ut(o,"change",r[3]),h=!0)},p(k,[y]){y&1&&(o.checked=k[0]),S&&S.p&&(!d||y&2)&&kn(S,_,k,k[1],d?xn(_,k[1],y,null):Sn(k[1]),null)},i(k){d||(Pe(S,k),d=!0)},o(k){De(S,k),d=!1},d(k){k&&ye(e),S&&S.d(k),h=!1,a()}}}function qS(r,e,n){let{$$slots:o={},$$scope:c}=e,{checked:d}=e;function h(){d=this.checked,n(0,d)}return r.$$set=a=>{"checked"in a&&n(0,d=a.checked),"$$scope"in a&&n(1,c=a.$$scope)},[d,c,o,h]}class Qn extends ai{constructor(e){super(),oi(this,e,qS,VS,Yt,{checked:0})}}function R_(r){let e,n,o,c=r[1]!=null&&B_(r);return{c(){e=xe("div"),n=gt(r[0]),o=Ue(),c&&c.c(),he(e,"class","cover svelte-1w7hi45")},m(d,h){be(d,e,h),ce(e,n),ce(e,o),c&&c.m(e,null)},p(d,h){h&1&&_i(n,d[0]),d[1]!=null?c?c.p(d,h):(c=B_(d),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(d){d&&ye(e),c&&c.d()}}}function B_(r){let e,n;return{c(){e=xe("div"),n=xe("progress"),n.value=r[1],tn(n,"width","100%")},m(o,c){be(o,e,c),ce(e,n)},p(o,c){c&2&&(n.value=o[1])},d(o){o&&ye(e)}}}function ZS(r){let e,n=r[0]&&R_(r);return{c(){n&&n.c(),e=Mn()},m(o,c){n&&n.m(o,c),be(o,e,c)},p(o,[c]){o[0]?n?n.p(o,c):(n=R_(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Ot,o:Ot,d(o){o&&ye(e),n&&n.d(o)}}}function WS(r,e,n){let{loading:o}=e,{progress:c=null}=e;return r.$$set=d=>{"loading"in d&&n(0,o=d.loading),"progress"in d&&n(1,c=d.progress)},[o,c]}class Hl extends ai{constructor(e){super(),oi(this,e,WS,ZS,Yt,{loading:0,progress:1})}}function GS(r){let e,n,o,c,d;const h=r[5].default,a=wn(h,r,r[4],null);return{c(){e=xe("dialog"),n=xe("div"),a&&a.c(),he(n,"class","svelte-y9d9eu"),he(e,"class","svelte-y9d9eu")},m(_,S){be(_,e,S),ce(e,n),a&&a.m(n,null),r[6](e),o=!0,c||(d=[Ut(e,"click",T1(r[1])),Ut(e,"keydown",r[2])],c=!0)},p(_,[S]){a&&a.p&&(!o||S&16)&&kn(a,h,_,_[4],o?xn(h,_[4],S,null):Sn(_[4]),null)},i(_){o||(Pe(a,_),o=!0)},o(_){De(a,_),o=!1},d(_){_&&ye(e),a&&a.d(_),r[6](null),c=!1,jn(d)}}}function HS(r,e,n){let{$$slots:o={},$$scope:c}=e,{show:d=!1}=e,h;function a(k){k.target==h&&n(3,d=!1)}function _(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),n(3,d=!1))}function S(k){mi[k?"unshift":"push"](()=>{h=k,n(0,h)})}return r.$$set=k=>{"show"in k&&n(3,d=k.show),"$$scope"in k&&n(4,c=k.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&h&&(d?h.showModal():h.close())},[h,a,_,d,c,o,S]}let Af=class extends ai{constructor(e){super(),oi(this,e,HS,GS,Yt,{show:3})}};function N_(r,e,n){const o=r.slice();return o[4]=e[n][0],o[5]=e[n][1],o}function j_(r){let e,n,o,c,d=r[4]+"",h,a;return{c(){e=xe("div"),n=xe("span"),c=Ue(),h=gt(d),a=Ue(),he(n,"class",o="color-swatch "+r[1]+" svelte-1enycr6"),tn(n,"background",r[5]),tn(e,"display","flex"),tn(e,"align-items","center"),tn(e,"gap","6px")},m(_,S){be(_,e,S),ce(e,n),ce(e,c),ce(e,h),ce(e,a)},p(_,S){S&2&&o!==(o="color-swatch "+_[1]+" svelte-1enycr6")&&he(n,"class",o),S&1&&tn(n,"background",_[5]),S&1&&d!==(d=_[4]+"")&&_i(h,d)},d(_){_&&ye(e)}}}function XS(r){let e,n=Ni(Object.entries(r[0])),o=[];for(let c=0;c<n.length;c+=1)o[c]=j_(N_(r,n,c));return{c(){e=xe("div");for(let c=0;c<o.length;c+=1)o[c].c();tn(e,"display","grid"),tn(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),tn(e,"gap","10px")},m(c,d){be(c,e,d);for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(e,null)},p(c,[d]){if(d&3){n=Ni(Object.entries(c[0]));let h;for(h=0;h<n.length;h+=1){const a=N_(c,n,h);o[h]?o[h].p(a,d):(o[h]=j_(a),o[h].c(),o[h].m(e,null))}for(;h<o.length;h+=1)o[h].d(1);o.length=n.length}d&4&&tn(e,"grid-template-columns","repeat(auto-fill, calc("+c[2]+" - 10px))")},i:Ot,o:Ot,d(c){c&&ye(e),$n(o,c)}}}function KS(r,e,n){let o,{labelColors:c}=e,{swatchClass:d="rectangle"}=e,{itemsPerRow:h=2}=e;return r.$$set=a=>{"labelColors"in a&&n(0,c=a.labelColors),"swatchClass"in a&&n(1,d=a.swatchClass),"itemsPerRow"in a&&n(3,h=a.itemsPerRow)},r.$$.update=()=>{r.$$.dirty&8&&n(2,o=`${100/h}%`)},[c,d,o,h]}class Ep extends ai{constructor(e){super(),oi(this,e,KS,XS,Yt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function Ip(r,e){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function Hc(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}function JS(r){let e,n,o,c,d,h,a;return{c(){e=xe("button"),e.textContent="Import current view",n=Ue(),o=xe("p"),o.textContent="or...",c=Ue(),d=xe("button"),d.textContent="Draw an area to import on the map",he(e,"class","btn btn-primary"),he(e,"type","button"),he(o,"class","fst-italic my-3"),he(d,"class","btn btn-primary"),he(d,"type","button")},m(_,S){be(_,e,S),be(_,n,S),be(_,o,S),be(_,c,S),be(_,d,S),h||(a=[Ut(e,"click",r[2]),Ut(d,"click",r[3])],h=!0)},p:Ot,i:Ot,o:Ot,d(_){_&&(ye(e),ye(n),ye(o),ye(c),ye(d)),h=!1,jn(a)}}}function YS(r){let e,n;return e=new Qw({props:{polygonTool:r[0]}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&1&&(d.polygonTool=o[0]),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function QS(r){let e;return{c(){e=gt("Save a copy of the osm.xml after importing")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function $S(r){let e,n,o,c,d,h;const a=[YS,JS],_=[];function S(C,E){return C[0]?0:1}e=S(r),n=_[e]=a[e](r);function k(C){r[5](C)}let y={$$slots:{default:[QS]},$$scope:{ctx:r}};return r[1]!==void 0&&(y.checked=r[1]),c=new Qn({props:y}),mi.push(()=>Ri(c,"checked",k)),{c(){n.c(),o=Ue(),lt(c.$$.fragment)},m(C,E){_[e].m(C,E),be(C,o,E),ot(c,C,E),h=!0},p(C,[E]){let T=e;e=S(C),e===T?_[e].p(C,E):(nn(),De(_[T],1,1,()=>{_[T]=null}),rn(),n=_[e],n?n.p(C,E):(n=_[e]=a[e](C),n.c()),Pe(n,1),n.m(o.parentNode,o));const M={};E&512&&(M.$$scope={dirty:E,ctx:C}),!d&&E&2&&(d=!0,M.checked=C[1],Fi(()=>d=!1)),c.$set(M)},i(C){h||(Pe(n),Pe(c.$$.fragment,C),h=!0)},o(C){De(n),De(c.$$.fragment,C),h=!1},d(C){C&&ye(o),_[e].d(C),at(c,C)}}}function $u(r){return[r.lng,r.lat]}function eT(r,e,n){let{map:o}=e;const c=sl();let d=null,h=!1;async function a(C){try{c("loading","Loading from Overpass");let T=await(await fetch(wb(C))).text();h&&Ip("osm.xml",T),c("gotXml",{xml:T,boundary:C})}catch(E){c("error",E.toString())}}function _(){let C=o.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[$u(C.getSouthWest()),$u(C.getNorthWest()),$u(C.getNorthEast()),$u(C.getSouthEast()),$u(C.getSouthWest())]],type:"Polygon"}}}async function S(){if(o){if(o.getZoom()<13){c("error","Zoom in more to import");return}await a(_())}}function k(){o&&(n(0,d=new Hw(o)),d.startNew(),d.addEventListenerSuccess(async C=>{n(0,d=null),await a(C)}),d.addEventListenerFailure(()=>{n(0,d=null)}))}function y(C){h=C,n(1,h)}return r.$$set=C=>{"map"in C&&n(4,o=C.map)},[d,h,S,k,o,y]}class tT extends ai{constructor(e){super(),oi(this,e,eT,$S,Yt,{map:4})}}function wb(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[o,c]of r.geometry.coordinates[0])e+=`${c} ${o} `;else if(r.geometry.type=="MultiPolygon")for(let[o,c]of r.geometry.coordinates[0][0])e+=`${c} ${o} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}let fi,ih=null;function Jc(){return(ih===null||ih.byteLength===0)&&(ih=new Uint8Array(fi.memory.buffer)),ih}let df=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});df.decode();const iT=2146435072;let Od=0;function nT(r,e){return Od+=e,Od>=iT&&(df=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),df.decode(),Od=e),df.decode(Jc().subarray(r,r+e))}function jr(r,e){return r=r>>>0,nT(r,e)}function nl(r){return r==null}let Rl=null;function Oo(){return(Rl===null||Rl.buffer.detached===!0||Rl.buffer.detached===void 0&&Rl.buffer!==fi.memory.buffer)&&(Rl=new DataView(fi.memory.buffer)),Rl}function tp(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const c=r.description;return c==null?"Symbol":`Symbol(${c})`}if(e=="function"){const c=r.name;return typeof c=="string"&&c.length>0?`Function(${c})`:"Function"}if(Array.isArray(r)){const c=r.length;let d="[";c>0&&(d+=tp(r[0]));for(let h=1;h<c;h++)d+=", "+tp(r[h]);return d+="]",d}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let o;if(n&&n.length>1)o=n[1];else return toString.call(r);if(o=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:o}let Vl=0;const lh=new TextEncoder;"encodeInto"in lh||(lh.encodeInto=function(r,e){const n=lh.encode(r);return e.set(n),{read:r.length,written:n.length}});function Dd(r,e,n){if(n===void 0){const a=lh.encode(r),_=e(a.length,1)>>>0;return Jc().subarray(_,_+a.length).set(a),Vl=a.length,_}let o=r.length,c=e(o,1)>>>0;const d=Jc();let h=0;for(;h<o;h++){const a=r.charCodeAt(h);if(a>127)break;d[c+h]=a}if(h!==o){h!==0&&(r=r.slice(h)),c=n(c,o,o=h+r.length*3,1)>>>0;const a=Jc().subarray(c+h,c+o),_=lh.encodeInto(r,a);h+=_.written,c=n(c,o,h,1)>>>0}return Vl=h,c}function rT(r){const e=fi.__externref_table_alloc();return fi.__wbindgen_externrefs.set(e,r),e}function Fd(r,e){try{return r.apply(this,e)}catch(n){const o=rT(n);fi.__wbindgen_exn_store(o)}}function sT(r,e){return r=r>>>0,Jc().subarray(r/1,r/1+e)}function sr(r){const e=fi.__wbindgen_externrefs.get(r);return fi.__externref_table_dealloc(r),e}function oT(r,e){const n=e(r.length*1,1)>>>0;return Jc().set(r,n/1),Vl=r.length,n}const U_=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>fi.__wbg_speedwalk_free(r>>>0,1));class _h{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,U_.unregister(this),e}free(){const e=this.__destroy_into_raw();fi.__wbg_speedwalk_free(e,0)}get timestamp(){const e=fi.__wbg_get_speedwalk_timestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}set timestamp(e){fi.__wbg_set_speedwalk_timestamp(this.__wbg_ptr,!nl(e),nl(e)?BigInt(0):e)}editClear(){fi.speedwalk_editClear(this.__wbg_ptr)}getMetrics(){let e,n;try{const d=fi.speedwalk_getMetrics(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,sr(d[2]);return e=o,n=c,jr(o,c)}finally{fi.__wbindgen_free(e,n,1)}}getBoundary(){let e,n;try{const d=fi.speedwalk_getBoundary(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,sr(d[2]);return e=o,n=c,jr(o,c)}finally{fi.__wbindgen_free(e,n,1)}}editSetTags(e,n){const o=fi.speedwalk_editSetTags(this.__wbg_ptr,e,n);if(o[1])throw sr(o[0])}getRoadSides(){let e,n;try{const d=fi.speedwalk_getRoadSides(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,sr(d[2]);return e=o,n=c,jr(o,c)}finally{fi.__wbindgen_free(e,n,1)}}editAssumeTags(e){const n=fi.speedwalk_editAssumeTags(this.__wbg_ptr,e);if(n[1])throw sr(n[0])}getOsmTimestamp(){const e=fi.speedwalk_getOsmTimestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}toOsmChangeJson(){let e,n;try{const d=fi.speedwalk_toOsmChangeJson(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,sr(d[2]);return e=o,n=c,jr(o,c)}finally{fi.__wbindgen_free(e,n,1)}}getSideLocations(e){let n,o;try{const h=fi.speedwalk_getSideLocations(this.__wbg_ptr,e);var c=h[0],d=h[1];if(h[3])throw c=0,d=0,sr(h[2]);return n=c,o=d,jr(c,d)}finally{fi.__wbindgen_free(n,o,1)}}exportNetwork(e){let n,o;try{const h=fi.speedwalk_exportNetwork(this.__wbg_ptr,e);var c=h[0],d=h[1];if(h[3])throw c=0,d=0,sr(h[2]);return n=c,o=d,jr(c,d)}finally{fi.__wbindgen_free(n,o,1)}}auditCrossings(e){let n,o;try{const h=fi.speedwalk_auditCrossings(this.__wbg_ptr,e);var c=h[0],d=h[1];if(h[3])throw c=0,d=0,sr(h[2]);return n=c,o=d,jr(c,d)}finally{fi.__wbindgen_free(n,o,1)}}editAddNewCrossing(e,n){const o=fi.speedwalk_editAddNewCrossing(this.__wbg_ptr,e,n);if(o[1])throw sr(o[0])}editMakeAllSidewalks(e){const n=fi.speedwalk_editMakeAllSidewalks(this.__wbg_ptr,e);if(n[1])throw sr(n[0])}editConnectAllCrossings(){const e=fi.speedwalk_editConnectAllCrossings(this.__wbg_ptr);if(e[1])throw sr(e[0])}findConnectedComponents(e){let n,o;try{const h=fi.speedwalk_findConnectedComponents(this.__wbg_ptr,e);var c=h[0],d=h[1];if(h[3])throw c=0,d=0,sr(h[2]);return n=c,o=d,jr(c,d)}finally{fi.__wbindgen_free(n,o,1)}}editGenerateMissingCrossings(e){const n=fi.speedwalk_editGenerateMissingCrossings(this.__wbg_ptr,e);if(n[1])throw sr(n[0])}constructor(e,n){const o=oT(e,fi.__wbindgen_malloc),c=Vl,d=fi.speedwalk_new(o,c,n);if(d[2])throw sr(d[1]);return this.__wbg_ptr=d[0]>>>0,U_.register(this,this.__wbg_ptr,this),this}toOsc(){let e,n;try{const o=fi.speedwalk_toOsc(this.__wbg_ptr);return e=o[0],n=o[1],jr(o[0],o[1])}finally{fi.__wbindgen_free(e,n,1)}}getWays(){let e,n;try{const d=fi.speedwalk_getWays(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,sr(d[2]);return e=o,n=c,jr(o,c)}finally{fi.__wbindgen_free(e,n,1)}}editUndo(){const e=fi.speedwalk_editUndo(this.__wbg_ptr);if(e[1])throw sr(e[0])}getEdits(){let e,n;try{const d=fi.speedwalk_getEdits(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,sr(d[2]);return e=o,n=c,jr(o,c)}finally{fi.__wbindgen_free(e,n,1)}}getNodes(){let e,n;try{const d=fi.speedwalk_getNodes(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,sr(d[2]);return e=o,n=c,jr(o,c)}finally{fi.__wbindgen_free(e,n,1)}}}Symbol.dispose&&(_h.prototype[Symbol.dispose]=_h.prototype.free);const aT=new Set(["basic","cors","default"]);async function lT(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(o){if(r.ok&&aT.has(r.type)&&r.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function cT(){const r={};return r.wbg={},r.wbg.__wbg_Error_e83987f665cf5504=function(e,n){return Error(jr(e,n))},r.wbg.__wbg___wbindgen_bigint_get_as_i64_f3ebc5a755000afd=function(e,n){const o=n,c=typeof o=="bigint"?o:void 0;Oo().setBigInt64(e+8*1,nl(c)?BigInt(0):c,!0),Oo().setInt32(e+4*0,!nl(c),!0)},r.wbg.__wbg___wbindgen_boolean_get_6d5a1ee65bab5f68=function(e){const n=e,o=typeof n=="boolean"?n:void 0;return nl(o)?16777215:o?1:0},r.wbg.__wbg___wbindgen_debug_string_df47ffb5e35e6763=function(e,n){const o=tp(n),c=Dd(o,fi.__wbindgen_malloc,fi.__wbindgen_realloc),d=Vl;Oo().setInt32(e+4*1,d,!0),Oo().setInt32(e+4*0,c,!0)},r.wbg.__wbg___wbindgen_in_bb933bd9e1b3bc0f=function(e,n){return e in n},r.wbg.__wbg___wbindgen_is_bigint_cb320707dcd35f0b=function(e){return typeof e=="bigint"},r.wbg.__wbg___wbindgen_is_function_ee8a6c5833c90377=function(e){return typeof e=="function"},r.wbg.__wbg___wbindgen_is_object_c818261d21f283a4=function(e){const n=e;return typeof n=="object"&&n!==null},r.wbg.__wbg___wbindgen_is_string_fbb76cb2940daafd=function(e){return typeof e=="string"},r.wbg.__wbg___wbindgen_is_undefined_2d472862bd29a478=function(e){return e===void 0},r.wbg.__wbg___wbindgen_jsval_eq_6b13ab83478b1c50=function(e,n){return e===n},r.wbg.__wbg___wbindgen_jsval_loose_eq_b664b38a2f582147=function(e,n){return e==n},r.wbg.__wbg___wbindgen_number_get_a20bf9b85341449d=function(e,n){const o=n,c=typeof o=="number"?o:void 0;Oo().setFloat64(e+8*1,nl(c)?0:c,!0),Oo().setInt32(e+4*0,!nl(c),!0)},r.wbg.__wbg___wbindgen_string_get_e4f06c90489ad01b=function(e,n){const o=n,c=typeof o=="string"?o:void 0;var d=nl(c)?0:Dd(c,fi.__wbindgen_malloc,fi.__wbindgen_realloc),h=Vl;Oo().setInt32(e+4*1,h,!0),Oo().setInt32(e+4*0,d,!0)},r.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(e,n){throw new Error(jr(e,n))},r.wbg.__wbg_call_e762c39fa8ea36bf=function(){return Fd(function(e,n){return e.call(n)},arguments)},r.wbg.__wbg_debug_f4b0c59db649db48=function(e){console.debug(e)},r.wbg.__wbg_done_2042aa2670fb1db1=function(e){return e.done},r.wbg.__wbg_entries_e171b586f8f6bdbf=function(e){return Object.entries(e)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,n){let o,c;try{o=e,c=n,console.error(jr(e,n))}finally{fi.__wbindgen_free(o,c,1)}},r.wbg.__wbg_error_a7f8fbb0523dae15=function(e){console.error(e)},r.wbg.__wbg_get_7bed016f185add81=function(e,n){return e[n>>>0]},r.wbg.__wbg_get_efcb449f58ec27c2=function(){return Fd(function(e,n){return Reflect.get(e,n)},arguments)},r.wbg.__wbg_get_with_ref_key_1dc361bd10053bfe=function(e,n){return e[n]},r.wbg.__wbg_info_e674a11f4f50cc0c=function(e){console.info(e)},r.wbg.__wbg_instanceof_ArrayBuffer_70beb1189ca63b38=function(e){let n;try{n=e instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_instanceof_Map_8579b5e2ab5437c7=function(e){let n;try{n=e instanceof Map}catch{n=!1}return n},r.wbg.__wbg_instanceof_Uint8Array_20c8e73002f7af98=function(e){let n;try{n=e instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbg_isArray_96e0af9891d0945d=function(e){return Array.isArray(e)},r.wbg.__wbg_isSafeInteger_d216eda7911dde36=function(e){return Number.isSafeInteger(e)},r.wbg.__wbg_iterator_e5822695327a3c39=function(){return Symbol.iterator},r.wbg.__wbg_length_69bca3cb64fc8748=function(e){return e.length},r.wbg.__wbg_length_cdd215e10d9dd507=function(e){return e.length},r.wbg.__wbg_log_8cec76766b8c0e33=function(e){console.log(e)},r.wbg.__wbg_new_5a79be3ab53b8aa5=function(e){return new Uint8Array(e)},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_next_020810e0ae8ebcb0=function(){return Fd(function(e){return e.next()},arguments)},r.wbg.__wbg_next_2c826fe5dfec6b6a=function(e){return e.next},r.wbg.__wbg_prototypesetcall_2a6620b6922694b2=function(e,n,o){Uint8Array.prototype.set.call(sT(e,n),o)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,n){const o=n.stack,c=Dd(o,fi.__wbindgen_malloc,fi.__wbindgen_realloc),d=Vl;Oo().setInt32(e+4*1,d,!0),Oo().setInt32(e+4*0,c,!0)},r.wbg.__wbg_value_692627309814bb8c=function(e){return e.value},r.wbg.__wbg_warn_1d74dddbe2fd1dbb=function(e){console.warn(e)},r.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,n){return jr(e,n)},r.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(e){return BigInt.asUintN(64,e)},r.wbg.__wbindgen_cast_9ae0607507abb057=function(e){return e},r.wbg.__wbindgen_init_externref_table=function(){const e=fi.__wbindgen_externrefs,n=e.grow(4);e.set(0,void 0),e.set(n+0,void 0),e.set(n+1,null),e.set(n+2,!0),e.set(n+3,!1)},r}function uT(r,e){return fi=r.exports,xb.__wbindgen_wasm_module=e,Rl=null,ih=null,fi.__wbindgen_start(),fi}async function xb(r){if(fi!==void 0)return fi;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("/speedwalk/assets/backend_bg-DlAQQQ9F.wasm",import.meta.url));const e=cT();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:o}=await lT(await r,e);return uT(n,o)}let ya=vn(null),er=vn(null),Yr=vn(0),ch=vn(!1),uh=vn(),ip=vn({kind:"sidewalks"}),vf=vn(!1),wf=vn(!1),Nl=vn({include:"OnlyExplicitFootways",ignore_deadends:!1}),rl=vn(JSON.parse(JSON.stringify(vb)));function hT(r){return r.reduce((e,n)=>e+n,0)}function nu(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+" km"}async function fo(){await new Promise(r=>{requestAnimationFrame(()=>{requestAnimationFrame(r)})})}function fT(r){let e,n,o,c,d,h,a,_,S,k,y,C;return S=new tT({props:{map:Hc(r[2])}}),S.$on("gotXml",r[4]),S.$on("loading",r[6]),S.$on("error",r[7]),{c(){e=xe("div"),n=xe("div"),o=xe("label"),c=gt(`Load an osm.pbf or osm.xml file
        `),d=xe("input"),h=Ue(),a=xe("p"),a.textContent="or...",_=Ue(),lt(S.$$.fragment),he(d,"class","form-control"),he(d,"type","file"),he(o,"class","form-label"),he(a,"class","fst-italic my-3"),he(e,"slot","sidebar")},m(E,T){be(E,e,T),ce(e,n),ce(n,o),ce(o,c),ce(o,d),r[5](d),ce(e,h),ce(e,a),ce(e,_),ot(S,e,null),k=!0,y||(C=Ut(d,"change",r[3]),y=!0)},p(E,T){const M={};T&4&&(M.map=Hc(E[2])),S.$set(M)},i(E){k||(Pe(S.$$.fragment,E),k=!0)},o(E){De(S.$$.fragment,E),k=!1},d(E){E&&ye(e),r[5](null),at(S),y=!1,C()}}}function dT(r){let e,n,o;return n=new Ux({}),{c(){e=xe("div"),lt(n.$$.fragment),he(e,"slot","map")},m(c,d){be(c,e,d),ot(n,e,null),o=!0},p:Ot,i(c){o||(Pe(n.$$.fragment,c),o=!0)},o(c){De(n.$$.fragment,c),o=!1},d(c){c&&ye(e),at(n)}}}function pT(r){let e,n,o,c;return e=new Hl({props:{loading:r[0]}}),o=new xh({props:{$$slots:{map:[dT],sidebar:[fT]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment)},m(d,h){ot(e,d,h),be(d,n,h),ot(o,d,h),c=!0},p(d,[h]){const a={};h&1&&(a.loading=d[0]),e.$set(a);const _={};h&1031&&(_.$$scope={dirty:h,ctx:d}),o.$set(_)},i(d){c||(Pe(e.$$.fragment,d),Pe(o.$$.fragment,d),c=!0)},o(d){De(e.$$.fragment,d),De(o.$$.fragment,d),c=!1},d(d){d&&ye(n),at(e,d),at(o,d)}}}function mT(r,e,n){let o,c;Bt(r,er,E=>n(8,o=E)),Bt(r,ya,E=>n(2,c=E));let d="",h;async function a(E){try{n(0,d="Loading from file"),await fo();let T=await h.files[0].arrayBuffer();Qi(er,o=new _h(new Uint8Array(T),null),o),S()}catch(T){window.alert(`Bad input file: ${T}`)}finally{n(0,d="")}}async function _(E){try{n(0,d="Processing Overpass data"),await fo();let T=new TextEncoder().encode(E.detail.xml);Qi(er,o=new _h(new Uint8Array(T),E.detail.boundary),o),S()}catch(T){window.alert(`Couldn't import from Overpass: ${T}`)}finally{n(0,d="")}}function S(){c.fitBounds(bb(JSON.parse(o.getNodes())),{animate:!1,padding:10})}function k(E){mi[E?"unshift":"push"](()=>{h=E,n(1,h)})}return[d,h,c,a,_,k,E=>n(0,d=E.detail),E=>window.alert(E.detail)]}class gT extends ai{constructor(e){super(),oi(this,e,mT,pT,Yt,{})}}const _T="/speedwalk/assets/favicon-DMAVMD4u.ico",yT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAApElEQVRIS+XUQQqAIBAFUOcgnaEIul/tO1kQdYau0AHsC64y4n9BIWozG/lPx0lzhT8rnO9+BnjvZ7T0NLOJbS3dIoQ3CD1i8MgiNBCCgbQou4JIQEQ61I1FZCAiPerKIFmAgmQDERlQl7eTJAAu0rMj+LAuma76gLJ7HFZvEQsgnJqkrEtmw8NmZQDh5X40NVw6Qa3HrtxzzU7XfZ18ySr0feACKA1QGcdX8MgAAAAASUVORK5CYII=";function V_(r,e,n){const o=r.slice();return o[14]=e[n],o}function q_(r){let e,n,o,c=r[14].name+"",d,h,a;function _(){return r[7](r[14])}return{c(){e=xe("div"),n=xe("button"),o=gt("Remove "),d=gt(c),he(n,"class","btn btn-danger mb-3")},m(S,k){be(S,e,k),ce(e,n),ce(n,o),ce(n,d),h||(a=Ut(n,"click",_),h=!0)},p(S,k){r=S,k&2&&c!==(c=r[14].name+"")&&_i(d,c)},d(S){S&&ye(e),h=!1,a()}}}function bT(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N,z,V,Y,se,$,te,U,j,G,O,W,le,de,ve,pe,we,Te,Ae=Ni(r[1]),ct=[];for(let We=0;We<Ae.length;We+=1)ct[We]=q_(V_(r,Ae,We));return{c(){e=xe("h1"),e.textContent="Customize basemaps",n=Ue();for(let We=0;We<ct.length;We+=1)ct[We].c();o=Ue(),c=xe("div"),d=xe("div"),d.textContent="Add a basemap",h=Ue(),a=xe("div"),_=xe("p"),_.textContent=`You can add custom basemaps if you know a tile URL and that the imagery
        has a license allowing it to be used for editing OSM.`,S=Ue(),k=xe("ul"),k.innerHTML=`<li><a href="https://github.com/osmlab/editor-layer-index" target="_blank">editor-layer-index</a>
          is a great reference, or you could check in iD or JOSM and figure out which
          one you like to use for your area.</li> <li>If you copy a URL from there, you may need to manually substitute some
          parts of the URL to make it work.</li> <li><b>{zoom}</b>
          
          <b>{z}</b></li> <li><b>{proj}</b>
          
          <b>{EPSG:3857}</b></li> <li><b>{width}</b>
          
          <b>256</b></li> <li><b>{height}</b>
          
          <b>256</b></li> <li><b>{bbox}</b>
          
          <b>{bbox-epsg-3857}</b></li> <li>Some sources have CORS restrictions and won&#39;t work</li>`,y=Ue(),C=xe("div"),E=xe("label"),T=gt(`Name:
          `),M=xe("input"),R=Ue(),N=xe("div"),z=xe("label"),V=gt(`Tile URL:
          `),Y=xe("textarea"),se=Ue(),$=xe("div"),te=xe("label"),U=gt(`Attribution:
          `),j=xe("input"),G=Ue(),O=xe("button"),W=gt("Add basemap"),de=Ue(),ve=xe("div"),pe=xe("button"),pe.textContent="Done",he(d,"class","card-header"),he(M,"class","form-control"),he(M,"type","text"),he(E,"class","form-label"),he(Y,"class","form-control"),he(Y,"rows","3"),he(Y,"cols","80"),he(z,"class","form-label"),he(j,"class","form-control"),he(j,"type","text"),he(te,"class","form-label"),he(O,"class","btn btn-primary"),O.disabled=le=!r[2]||!r[3]||!r[4],he(a,"class","card-body"),he(c,"class","card"),he(pe,"class","btn btn-primary"),he(ve,"class","mt-5")},m(We,pt){be(We,e,pt),be(We,n,pt);for(let kt=0;kt<ct.length;kt+=1)ct[kt]&&ct[kt].m(We,pt);be(We,o,pt),be(We,c,pt),ce(c,d),ce(c,h),ce(c,a),ce(a,_),ce(a,S),ce(a,k),ce(a,y),ce(a,C),ce(C,E),ce(E,T),ce(E,M),mr(M,r[2]),ce(a,R),ce(a,N),ce(N,z),ce(z,V),ce(z,Y),mr(Y,r[3]),ce(a,se),ce(a,$),ce($,te),ce(te,U),ce(te,j),mr(j,r[4]),ce(a,G),ce(a,O),ce(O,W),be(We,de,pt),be(We,ve,pt),ce(ve,pe),we||(Te=[Ut(M,"input",r[8]),Ut(Y,"input",r[9]),Ut(j,"input",r[10]),Ut(O,"click",r[5]),Ut(pe,"click",r[11])],we=!0)},p(We,pt){if(pt&66){Ae=Ni(We[1]);let kt;for(kt=0;kt<Ae.length;kt+=1){const Je=V_(We,Ae,kt);ct[kt]?ct[kt].p(Je,pt):(ct[kt]=q_(Je),ct[kt].c(),ct[kt].m(o.parentNode,o))}for(;kt<ct.length;kt+=1)ct[kt].d(1);ct.length=Ae.length}pt&4&&M.value!==We[2]&&mr(M,We[2]),pt&8&&mr(Y,We[3]),pt&16&&j.value!==We[4]&&mr(j,We[4]),pt&28&&le!==(le=!We[2]||!We[3]||!We[4])&&(O.disabled=le)},d(We){We&&(ye(e),ye(n),ye(o),ye(c),ye(de),ye(ve)),$n(ct,We),we=!1,jn(Te)}}}function vT(r){let e,n,o;function c(h){r[12](h)}let d={$$slots:{default:[bT]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.show=r[0]),e=new Af({props:d}),mi.push(()=>Ri(e,"show",c)),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,[a]){const _={};a&131103&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.show=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}let Rd="speedwalk-custom-basemaps";function Z_(r,e){return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[r],tileSize:256,attribution:e}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"},{id:"Road labels",type:"background",layout:{visibility:"none"}}],glyphs:"https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=MZEJTanw3WpxRvt7qDfo"}}function wT(r,e,n){let o;Bt(r,rl,N=>n(13,o=N));let{show:c}=e,d=JSON.parse(window.localStorage.getItem(Rd)||"[]");for(let N of d)Qi(rl,o[N.name]=Z_(N.tileURL,N.attribution),o);rl.set(o);let h="",a="",_="";function S(){d.push({name:h,tileURL:a,attribution:_}),n(1,d),window.localStorage.setItem(Rd,JSON.stringify(d)),Qi(rl,o[h]=Z_(a,_),o),rl.set(o),n(2,h=""),n(3,a=""),n(4,_="")}function k(N){n(1,d=d.filter(z=>z.name!=N)),window.localStorage.setItem(Rd,JSON.stringify(d)),delete o[N],rl.set(o)}const y=N=>k(N.name);function C(){h=this.value,n(2,h)}function E(){a=this.value,n(3,a)}function T(){_=this.value,n(4,_)}const M=()=>n(0,c=!1);function R(N){c=N,n(0,c)}return r.$$set=N=>{"show"in N&&n(0,c=N.show)},[c,d,h,a,_,S,k,y,C,E,T,M,R]}class xT extends ai{constructor(e){super(),oi(this,e,wT,vT,Yt,{show:0})}}function W_(r,e,n){const o=r.slice();return o[11]=e[n],o}function G_(r,e,n){const o=r.slice();return o[11]=e[n],o}function H_(r){let e,n,o=r[11]+"",c,d,h;function a(){return r[7](r[11])}return{c(){e=xe("li"),n=xe("button"),c=gt(o),he(n,"class","dropdown-item"),he(n,"type","button"),gr(n,"active",r[0]===r[11])},m(_,S){be(_,e,S),ce(e,n),ce(n,c),d||(h=Ut(n,"click",a),d=!0)},p(_,S){r=_,S&2&&o!==(o=r[11]+"")&&_i(c,o),S&3&&gr(n,"active",r[0]===r[11])},d(_){_&&ye(e),d=!1,h()}}}function X_(r){let e,n,o,c=Ni(r[4]),d=[];for(let h=0;h<c.length;h+=1)d[h]=K_(W_(r,c,h));return{c(){e=xe("li"),e.innerHTML='<hr class="dropdown-divider"/>',n=Ue();for(let h=0;h<d.length;h+=1)d[h].c();o=Mn()},m(h,a){be(h,e,a),be(h,n,a);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(h,a);be(h,o,a)},p(h,a){if(a&17){c=Ni(h[4]);let _;for(_=0;_<c.length;_+=1){const S=W_(h,c,_);d[_]?d[_].p(S,a):(d[_]=K_(S),d[_].c(),d[_].m(o.parentNode,o))}for(;_<d.length;_+=1)d[_].d(1);d.length=c.length}},d(h){h&&(ye(e),ye(n),ye(o)),$n(d,h)}}}function K_(r){let e,n,o=r[11]+"",c,d,h,a;function _(){return r[8](r[11])}return{c(){e=xe("li"),n=xe("button"),c=gt(o),d=Ue(),he(n,"class","dropdown-item"),he(n,"type","button"),gr(n,"active",r[0]===r[11])},m(S,k){be(S,e,k),ce(e,n),ce(n,c),ce(e,d),h||(a=Ut(n,"click",_),h=!0)},p(S,k){r=S,k&16&&o!==(o=r[11]+"")&&_i(c,o),k&17&&gr(n,"active",r[0]===r[11])},d(S){S&&ye(e),h=!1,a()}}}function kT(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N,z,V=Ni(r[1]),Y=[];for(let U=0;U<V.length;U+=1)Y[U]=H_(G_(r,V,U));let se=r[4].length>0&&X_(r);function $(U){r[10](U)}let te={};return r[2]!==void 0&&(te.show=r[2]),T=new xT({props:te}),mi.push(()=>Ri(T,"show",$)),{c(){e=xe("div"),n=xe("div"),o=xe("button"),c=gt(r[3]),d=Ue(),h=xe("ul");for(let U=0;U<Y.length;U+=1)Y[U].c();a=Ue(),se&&se.c(),_=Ue(),S=xe("li"),S.innerHTML='<hr class="dropdown-divider"/>',k=Ue(),y=xe("li"),C=xe("button"),C.innerHTML=`<i class="fa-solid fa-square-plus me-2"></i>
          Add custom basemap`,E=Ue(),lt(T.$$.fragment),he(o,"class","btn btn-outline-secondary dropdown-toggle basemap-button svelte-1tcv6sd"),he(o,"type","button"),he(o,"data-bs-toggle","dropdown"),he(o,"aria-expanded","false"),he(C,"class","dropdown-item"),he(C,"type","button"),he(h,"class","dropdown-menu"),he(n,"class","btn-group"),he(e,"class","basemap-selector svelte-1tcv6sd")},m(U,j){be(U,e,j),ce(e,n),ce(n,o),ce(o,c),ce(n,d),ce(n,h);for(let G=0;G<Y.length;G+=1)Y[G]&&Y[G].m(h,null);ce(h,a),se&&se.m(h,null),ce(h,_),ce(h,S),ce(h,k),ce(h,y),ce(y,C),be(U,E,j),ot(T,U,j),R=!0,N||(z=Ut(C,"click",r[9]),N=!0)},p(U,[j]){if((!R||j&8)&&_i(c,U[3]),j&3){V=Ni(U[1]);let O;for(O=0;O<V.length;O+=1){const W=G_(U,V,O);Y[O]?Y[O].p(W,j):(Y[O]=H_(W),Y[O].c(),Y[O].m(h,a))}for(;O<Y.length;O+=1)Y[O].d(1);Y.length=V.length}U[4].length>0?se?se.p(U,j):(se=X_(U),se.c(),se.m(h,_)):se&&(se.d(1),se=null);const G={};!M&&j&4&&(M=!0,G.show=U[2],Fi(()=>M=!1)),T.$set(G)},i(U){R||(Pe(T.$$.fragment,U),R=!0)},o(U){De(T.$$.fragment,U),R=!1},d(U){U&&(ye(e),ye(E)),$n(Y,U),se&&se.d(),at(T,U),N=!1,z()}}}function ST(r,e,n){let o,c,d,h,a;Bt(r,rl,T=>n(6,a=T));let{basemap:_}=e,S=!1;const k=T=>n(0,_=T),y=T=>n(0,_=T),C=()=>n(2,S=!0);function E(T){S=T,n(2,S)}return r.$$set=T=>{"basemap"in T&&n(0,_=T.basemap)},r.$$.update=()=>{r.$$.dirty&64&&n(5,c=Object.keys(a)),r.$$.dirty&34&&n(4,d=c.filter(T=>!o.includes(T))),r.$$.dirty&33&&n(3,h=_||c[0]||"")},n(1,o=Object.keys(vb)),[_,o,S,h,d,c,a,k,y,C,E]}class TT extends ai{constructor(e){super(),oi(this,e,ST,kT,Yt,{basemap:0})}}function kb(r){if(!r)return null;const e=r.getCenter();return{lat:e.lat,lng:e.lng,zoom:r.getZoom()}}function CT(r,e,n){const o=new URLSearchParams;return o.append("map",`${Math.round(r)}/${e.toFixed(6)}/${n.toFixed(6)}`),`https://www.openstreetmap.org/#${o.toString()}`}function Sb(r,e,n){const o=new URLSearchParams;return o.append("map",`${Math.round(r)}/${e.toFixed(6)}/${n.toFixed(6)}`),`https://www.openstreetmap.org/edit?editor=id#${o.toString()}`}function ET(r,e,n){const o=new URLSearchParams;return o.append("map",`${Math.round(r)}/${e.toFixed(6)}/${n.toFixed(6)}`),o.append("disable_features","boundaries"),o.append("hashtags","Speedwalk"),`https://kyle.kiwi/iD/#${o.toString()}`}function IT(r,e,n){const o=new URLSearchParams;return o.append("map",`${Math.round(r)}/${e.toFixed(6)}/${n.toFixed(6)}`),o.append("disable_features","boundaries"),o.append("hashtags","Speedwalk"),`https://rapideditor.org/edit#${o.toString()}`}function AT(r,e,n,o){return`http://127.0.0.1:8111/load_and_zoom?left=${r.toFixed(6)}&right=${e.toFixed(6)}&top=${n.toFixed(6)}&bottom=${o.toFixed(6)}`}function MT(r){const e=r.getBounds();return AT(e.getWest(),e.getEast(),e.getNorth(),e.getSouth())}function PT(r,e,n){const o=new URL("https://www.mapillary.com/app/");return o.searchParams.set("lat",String(e)),o.searchParams.set("lng",String(n)),o.searchParams.set("z",String(Math.round(r))),o.toString()}function J_(r,e,n){const o=r.slice();return o[4]=e[n],o}function Y_(r){let e,n,o,c,d;function h(){return r[2](r[4])}return{c(){e=xe("li"),n=xe("a"),n.textContent=`${r[4]}`,o=Ue(),he(n,"class","dropdown-item"),he(n,"href","#")},m(a,_){be(a,e,_),ce(e,n),ce(e,o),c||(d=Ut(n,"click",rp(h)),c=!0)},p(a,_){r=a},d(a){a&&ye(e),c=!1,d()}}}function LT(r){let e,n,o,c,d=Ni(r[0]),h=[];for(let a=0;a<d.length;a+=1)h[a]=Y_(J_(r,d,a));return{c(){e=xe("div"),n=xe("button"),n.innerHTML='<i class="fa-solid fa-pen"></i>',o=Ue(),c=xe("ul");for(let a=0;a<h.length;a+=1)h[a].c();he(n,"class","btn btn-outline-secondary dropdown-toggle"),he(n,"type","button"),he(n,"data-bs-toggle","dropdown"),he(n,"aria-expanded","false"),he(n,"title","Open in OSM editors"),he(c,"class","dropdown-menu"),he(e,"class","btn-group")},m(a,_){be(a,e,_),ce(e,n),ce(e,o),ce(e,c);for(let S=0;S<h.length;S+=1)h[S]&&h[S].m(c,null)},p(a,[_]){if(_&3){d=Ni(a[0]);let S;for(S=0;S<d.length;S+=1){const k=J_(a,d,S);h[S]?h[S].p(k,_):(h[S]=Y_(k),h[S].c(),h[S].m(c,null))}for(;S<h.length;S+=1)h[S].d(1);h.length=d.length}},i:Ot,o:Ot,d(a){a&&ye(e),$n(h,a)}}}function zT(r,e,n){let o;Bt(r,ya,a=>n(3,o=a));const c=["OSM","iD","Kiwid","Rapid","JOSM","Mapillary"];function d(a){const _=kb(o);if(!(!o||!_))return{OSM:CT(_.zoom,_.lat,_.lng),iD:Sb(_.zoom,_.lat,_.lng),Kiwid:ET(_.zoom,_.lat,_.lng),Rapid:IT(_.zoom,_.lat,_.lng),JOSM:MT(o),Mapillary:PT(_.zoom,_.lat,_.lng)}[a]}return[c,d,a=>window.open(d(a),"_blank","noopener,noreferrer")]}class OT extends ai{constructor(e){super(),oi(this,e,zT,LT,Yt,{})}}function DT(r){let e,n,o,c,d;const h=r[6].default,a=wn(h,r,r[5],null);return{c(){e=xe("dialog"),n=xe("div"),a&&a.c(),he(n,"class","svelte-y9d9eu"),he(e,"closedby","none"),he(e,"class","svelte-y9d9eu")},m(_,S){be(_,e,S),ce(e,n),a&&a.m(n,null),r[7](e),o=!0,c||(d=[Ut(e,"click",r[1]),Ut(e,"keydown",r[2])],c=!0)},p(_,[S]){a&&a.p&&(!o||S&32)&&kn(a,h,_,_[5],o?xn(h,_[5],S,null):Sn(_[5]),null)},i(_){o||(Pe(a,_),o=!0)},o(_){De(a,_),o=!1},d(_){_&&ye(e),a&&a.d(_),r[7](null),c=!1,jn(d)}}}function FT(r,e,n){let{$$slots:o={},$$scope:c}=e,{show:d}=e,{closeable:h=!0}=e,a;function _(y){y.target==a&&(y.stopPropagation(),h&&n(3,d=!1))}function S(y){(y.key=="Escape"||y.key=="Enter")&&(y.stopPropagation(),h&&n(3,d=!1))}function k(y){mi[y?"unshift":"push"](()=>{a=y,n(0,a)})}return r.$$set=y=>{"show"in y&&n(3,d=y.show),"closeable"in y&&n(4,h=y.closeable),"$$scope"in y&&n(5,c=y.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&a&&(d?a.showModal():a.close())},[a,_,S,d,h,c,o,k]}class Q_ extends ai{constructor(e){super(),oi(this,e,FT,DT,Yt,{show:3,closeable:4})}}function $_(r){let e;return{c(){e=gt("You may be contacted later when this problem has been fixed.")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function RT(r){let e,n,o,c,d,h,a,_,S=r[5]&&r[8]&&$_();return{c(){e=xe("h2"),e.textContent="Report a problem",n=Ue(),o=xe("p"),c=gt(`Done, thank you for submitting.
    `),S&&S.c(),d=Ue(),h=xe("button"),h.textContent="OK",he(h,"class","btn btn-primary")},m(k,y){be(k,e,y),be(k,n,y),be(k,o,y),ce(o,c),S&&S.m(o,null),be(k,d,y),be(k,h,y),a||(_=Ut(h,"click",r[12]),a=!0)},p(k,y){k[5]&&k[8]?S||(S=$_(),S.c(),S.m(o,null)):S&&(S.d(1),S=null)},d(k){k&&(ye(e),ye(n),ye(o),ye(d),ye(h)),S&&S.d(),a=!1,_()}}}function BT(r){let e;return{c(){e=gt("Include screenshot")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function ey(r){let e,n,o;function c(h){r[16](h)}let d={$$slots:{default:[NT]},$$scope:{ctx:r}};return r[5]!==void 0&&(d.checked=r[5]),e=new Qn({props:d}),mi.push(()=>Ri(e,"checked",c)),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,a){const _={};a&4194560&&(_.$$scope={dirty:a,ctx:h}),!n&&a&32&&(n=!0,_.checked=h[5],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function NT(r){let e,n=r[8].name+"",o,c;return{c(){e=gt("Include your OSM username ("),o=gt(n),c=gt(`) in the report and be
      contacted when the problem is fixed`)},m(d,h){be(d,e,h),be(d,o,h),be(d,c,h)},p(d,h){h&256&&n!==(n=d[8].name+"")&&_i(o,n)},d(d){d&&(ye(e),ye(o),ye(c))}}}function ty(r){let e;function n(d,h){return d[1]?UT:jT}let o=n(r),c=o(r);return{c(){e=xe("div"),c.c(),he(e,"class","img-container mb-3 svelte-3bvulg")},m(d,h){be(d,e,h),c.m(e,null)},p(d,h){o===(o=n(d))&&c?c.p(d,h):(c.d(1),c=o(d),c&&(c.c(),c.m(e,null)))},d(d){d&&ye(e),c.d()}}}function jT(r){let e;return{c(){e=xe("p"),e.textContent="Loading screenshot... (sometimes you have to cancel and try again)"},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function UT(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[1])||he(e,"src",n),he(e,"alt","Screenshot"),he(e,"class","svelte-3bvulg")},m(o,c){be(o,e,c)},p(o,c){c&2&&!Gn(e.src,n=o[1])&&he(e,"src",n)},d(o){o&&ye(e)}}}function VT(r){let e,n,o,c,d;return{c(){e=xe("button"),n=gt("Submit report"),he(e,"class","btn btn-primary me-3"),e.disabled=o=!r[7]},m(h,a){be(h,e,a),ce(e,n),c||(d=Ut(e,"click",r[9]),c=!0)},p(h,a){a&128&&o!==(o=!h[7])&&(e.disabled=o)},d(h){h&&ye(e),c=!1,d()}}}function qT(r){let e;return{c(){e=xe("button"),e.innerHTML=`<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
        Submit report`,he(e,"class","btn btn-primary me-3"),e.disabled=!0},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function ZT(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N,z,V,Y,se,$,te;function U(ve){r[15](ve)}let j={$$slots:{default:[BT]},$$scope:{ctx:r}};r[6]!==void 0&&(j.checked=r[6]),E=new Qn({props:j}),mi.push(()=>Ri(E,"checked",U));let G=r[8]&&ey(r),O=r[6]&&ty(r);function W(ve,pe){return ve[3]?qT:VT}let le=W(r),de=le(r);return{c(){e=xe("div"),n=xe("h2"),n.textContent="Report a problem",o=Ue(),c=xe("button"),d=Ue(),h=xe("p"),h.textContent="You can report a problem with Speedwalk.",a=Ue(),_=xe("fieldset"),S=xe("legend"),S.innerHTML=`Please describe the problem
      <br/>
      (if it&#39;s not obvious from the screenshot below)`,k=Ue(),y=xe("textarea"),C=Ue(),lt(E.$$.fragment),M=Ue(),G&&G.c(),R=Ue(),O&&O.c(),N=Ue(),z=xe("div"),de.c(),V=Ue(),Y=xe("button"),Y.textContent="Cancel",he(c,"class","btn-close"),he(c,"aria-label","Close"),he(e,"class","d-flex justify-content-between"),he(y,"class","form-control"),he(y,"rows","4"),he(y,"placeholder","Details"),he(_,"class","mb-3"),he(Y,"class","btn btn-secondary"),he(z,"class","d-flex")},m(ve,pe){be(ve,e,pe),ce(e,n),ce(e,o),ce(e,c),be(ve,d,pe),be(ve,h,pe),be(ve,a,pe),be(ve,_,pe),ce(_,S),ce(_,k),ce(_,y),mr(y,r[0]),be(ve,C,pe),ot(E,ve,pe),be(ve,M,pe),G&&G.m(ve,pe),be(ve,R,pe),O&&O.m(ve,pe),be(ve,N,pe),be(ve,z,pe),de.m(z,null),ce(z,V),ce(z,Y),se=!0,$||(te=[Ut(c,"click",r[10]),Ut(y,"input",r[14]),Ut(Y,"click",r[10])],$=!0)},p(ve,pe){pe&1&&mr(y,ve[0]);const we={};pe&4194304&&(we.$$scope={dirty:pe,ctx:ve}),!T&&pe&64&&(T=!0,we.checked=ve[6],Fi(()=>T=!1)),E.$set(we),ve[8]?G?(G.p(ve,pe),pe&256&&Pe(G,1)):(G=ey(ve),G.c(),Pe(G,1),G.m(R.parentNode,R)):G&&(nn(),De(G,1,1,()=>{G=null}),rn()),ve[6]?O?O.p(ve,pe):(O=ty(ve),O.c(),O.m(N.parentNode,N)):O&&(O.d(1),O=null),le===(le=W(ve))&&de?de.p(ve,pe):(de.d(1),de=le(ve),de&&(de.c(),de.m(z,V)))},i(ve){se||(Pe(E.$$.fragment,ve),Pe(G),se=!0)},o(ve){De(E.$$.fragment,ve),De(G),se=!1},d(ve){ve&&(ye(e),ye(d),ye(h),ye(a),ye(_),ye(C),ye(M),ye(R),ye(N),ye(z)),at(E,ve),G&&G.d(ve),O&&O.d(ve),de.d(),$=!1,jn(te)}}}function WT(r){let e,n,o,c,d,h;function a(y){r[13](y)}let _={$$slots:{default:[RT]},$$scope:{ctx:r}};r[4]!==void 0&&(_.show=r[4]),e=new Q_({props:_}),mi.push(()=>Ri(e,"show",a));function S(y){r[17](y)}let k={closeable:!1,$$slots:{default:[ZT]},$$scope:{ctx:r}};return r[2]!==void 0&&(k.show=r[2]),c=new Q_({props:k}),mi.push(()=>Ri(c,"show",S)),{c(){lt(e.$$.fragment),o=Ue(),lt(c.$$.fragment)},m(y,C){ot(e,y,C),be(y,o,C),ot(c,y,C),h=!0},p(y,[C]){const E={};C&4194608&&(E.$$scope={dirty:C,ctx:y}),!n&&C&16&&(n=!0,E.show=y[4],Fi(()=>n=!1)),e.$set(E);const T={};C&4194795&&(T.$$scope={dirty:C,ctx:y}),!d&&C&4&&(d=!0,T.show=y[2],Fi(()=>d=!1)),c.$set(T)},i(y){h||(Pe(e.$$.fragment,y),Pe(c.$$.fragment,y),h=!0)},o(y){De(e.$$.fragment,y),De(c.$$.fragment,y),h=!1},d(y){y&&ye(o),at(e,y),at(c,y)}}}function GT(r){return new Promise((e,n)=>{r.redraw(),r.once("idle",()=>{r.getCanvas().toBlob(o=>{o?e(o):n("no blob")})})})}function HT(r){return new Promise((e,n)=>{let o=new FileReader;o.readAsDataURL(r),o.onloadend=function(){o.result?e(o.result):n("base64 failed")}})}function XT(r){let e=r.getCenter(),n=Math.round(r.getZoom()*100)/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,o),d=Math.round(e.lat*c)/c,h=Math.round(e.lng*c)/c,a=`${n}/${d}/${h}`,_=r.getBearing(),S=r.getPitch();return(_||S)&&(a+=`/${Math.round(_*10)/10}`),S&&(a+=`/${Math.round(S)}`),`#${a}`}function KT(r,e,n){let o,c,d;Bt(r,uh,j=>n(8,c=j)),Bt(r,ya,j=>n(20,d=j));let h=!1,a=!1,_=!1;function S(){d&&R()}let k="",y={},C=!1,E=!0,T,M;async function R(){n(2,h=!0),y={url:window.location.toString(),viewport:XT(d)},T=await GT(d),n(1,M=URL.createObjectURL(T))}async function N(){let j=null;C&&c&&(j=c.name);let G=null;E&&T&&(G=await HT(T));let O={...y,details:k,screenshot:G,username:j};try{n(3,a=!0);let W=await fetch("https://walknet.abstreet.uk/problems/speedwalk_problems",{method:"POST",body:JSON.stringify(O),headers:{"Content-Type":"application/json"}});if(!W.ok)throw new Error(`Bad response: ${W.status}`)}catch(W){window.alert(`Failed to report a problem: ${W}`),n(3,a=!1);return}n(3,a=!1),z(),n(4,_=!0)}function z(){n(2,h=!1),n(0,k=""),y={},T=void 0,M&&(URL.revokeObjectURL(M),n(1,M=void 0))}const V=()=>n(4,_=!1);function Y(j){_=j,n(4,_)}function se(){k=this.value,n(0,k)}function $(j){E=j,n(6,E)}function te(j){C=j,n(5,C)}function U(j){h=j,n(2,h)}return r.$$.update=()=>{r.$$.dirty&3&&n(7,o=k||M)},[k,M,h,a,_,C,E,o,c,N,z,S,V,Y,se,$,te,U]}class JT extends ai{constructor(e){super(),oi(this,e,KT,WT,Yt,{triggerStart:11})}get triggerStart(){return this.$$.ctx[11]}}function iy(r){let e,n,o,c;return{c(){e=xe("div"),n=xe("button"),n.innerHTML='<i class="fa-solid fa-triangle-exclamation"></i> <span class="report-problem-text svelte-17rnyo3">Report problem</span>',he(n,"class","btn btn-secondary report-problem-btn svelte-17rnyo3"),he(e,"class","report-problem-wrapper svelte-17rnyo3")},m(d,h){be(d,e,h),ce(e,n),o||(c=Ut(n,"click",r[2]),o=!0)},p:Ot,d(d){d&&ye(e),o=!1,c()}}}function YT(r){let e,n,o,c=r[1]&&iy(r),d={};return n=new JT({props:d}),r[3](n),{c(){c&&c.c(),e=Ue(),lt(n.$$.fragment)},m(h,a){c&&c.m(h,a),be(h,e,a),ot(n,h,a),o=!0},p(h,[a]){h[1]?c?c.p(h,a):(c=iy(h),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);const _={};n.$set(_)},i(h){o||(Pe(n.$$.fragment,h),o=!0)},o(h){De(n.$$.fragment,h),o=!1},d(h){h&&ye(e),c&&c.d(h),r[3](null),at(n,h)}}}function QT(r,e,n){let o;Bt(r,ya,a=>n(1,o=a));let c=null;const d=()=>{c==null||c.triggerStart()};function h(a){mi[a?"unshift":"push"](()=>{c=a,n(0,c)})}return[c,o,d,h]}class $T extends ai{constructor(e){super(),oi(this,e,QT,YT,Yt,{})}}function eC(r){let e,n,o,c,d,h,a,_;function S(y){r[2](y)}let k={};return r[0]!==void 0&&(k.basemap=r[0]),n=new TT({props:k}),mi.push(()=>Ri(n,"basemap",S)),d=new OT({}),a=new $T({}),{c(){e=xe("div"),lt(n.$$.fragment),c=Ue(),lt(d.$$.fragment),h=Ue(),lt(a.$$.fragment),he(e,"class","action-bar svelte-nu94fm"),tn(e,"bottom",r[1])},m(y,C){be(y,e,C),ot(n,e,null),ce(e,c),ot(d,e,null),ce(e,h),ot(a,e,null),_=!0},p(y,[C]){const E={};!o&&C&1&&(o=!0,E.basemap=y[0],Fi(()=>o=!1)),n.$set(E),C&2&&tn(e,"bottom",y[1])},i(y){_||(Pe(n.$$.fragment,y),Pe(d.$$.fragment,y),Pe(a.$$.fragment,y),_=!0)},o(y){De(n.$$.fragment,y),De(d.$$.fragment,y),De(a.$$.fragment,y),_=!1},d(y){y&&ye(e),at(n),at(d),at(a)}}}function tC(r,e,n){let{basemap:o}=e,{bottom:c="60px"}=e;function d(h){o=h,n(0,o)}return r.$$set=h=>{"basemap"in h&&n(0,o=h.basemap),"bottom"in h&&n(1,c=h.bottom)},[o,c,d]}class iC extends ai{constructor(e){super(),oi(this,e,tC,eC,Yt,{basemap:0,bottom:1})}}let Xl={RoadWithSeparate:"purple",RoadWithTags:"blue",RoadWithoutSidewalksExplicit:"#8B4000",RoadWithoutSidewalksImplicit:"orange",RoadUnknown:"#ff69b4",Sidewalk:"black",Crossing:"green",Other:"grey"},ny={RoadWithSeparate:"With separate sidewalks",RoadWithTags:"With tagged sidewalks",RoadWithoutSidewalksExplicit:"Tagged as no sidewalks",RoadWithoutSidewalksImplicit:"Assumed as no sidewalks",RoadUnknown:"Totally unknown",Sidewalk:"Separate sidewalk",Crossing:"Crossing",Other:"Other"};function fa(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,gh(["get","kind"],{Sidewalk:4+r,Crossing:5+r,Other:5+r},7+r),20,gh(["get","kind"],{Sidewalk:7+r,Crossing:10+r,Other:10+r},24+r)]}function nC(r){let e,n,o,c;return e=new ga({props:{id:"pinned",beforeId:"Road labels",paint:{"line-width":fa(10),"line-color":"cyan","line-opacity":.5}}}),o=new If({props:{minzoom:12,layout:{"icon-image":"arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0}}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment)},m(d,h){ot(e,d,h),be(d,n,h),ot(o,d,h),c=!0},p:Ot,i(d){c||(Pe(e.$$.fragment,d),Pe(o.$$.fragment,d),c=!0)},o(d){De(e.$$.fragment,d),De(o.$$.fragment,d),c=!1},d(d){d&&ye(n),at(e,d),at(o,d)}}}function rC(r){let e,n;return e=new ga({props:{id:"snapped-to-pinned",beforeId:"Road labels",paint:{"line-width":fa(10),"line-color":"blue","line-opacity":.5,"line-offset":["case",["get","left"],-5,5]}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p:Ot,i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function sC(r){let e,n;return e=new ga({props:{id:"ways",beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",filter:r[5],paint:{"line-width":fa(0),"line-color":gh(["get","kind"],Xl,"cyan")}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&32&&(d.filter=o[5]),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function oC(r){let e,n;return e=new If({props:{minzoom:16,paint:{"text-color":"white","text-halo-color":"black","text-halo-width":2},layout:{visibility:r[3]?"visible":"none","text-field":["get","sidewalks"],"text-size":15,"symbol-placement":"line","symbol-spacing":30,"text-allow-overlap":!0,"text-rotation-alignment":"viewport"}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&8&&(d.layout={visibility:o[3]?"visible":"none","text-field":["get","sidewalks"],"text-size":15,"symbol-placement":"line","symbol-spacing":30,"text-allow-overlap":!0,"text-rotation-alignment":"viewport"}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function ry(r){let e,n;return e=new Ir({props:{data:r[6]?JSON.parse(r[6].getRoadSides()):or(),$$slots:{default:[oC]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&64&&(d.data=o[6]?JSON.parse(o[6].getRoadSides()):or()),c&65544&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function aC(r){let e,n;return e=new If({props:{id:"pinned-sides",paint:{"text-color":"black","text-halo-color":"cyan","text-halo-width":4},layout:{"text-field":["get","side"],"text-size":16,"symbol-placement":"line"}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p:Ot,i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function lC(r){let e,n;return e=new If({props:{id:"pinned-node-order",paint:{"text-color":"white","text-halo-color":"blue","text-halo-width":5},layout:{"text-field":["get","idx"],"text-size":16,visibility:r[8]?"visible":"none"}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&256&&(d.layout={"text-field":["get","idx"],"text-size":16,visibility:o[8]?"visible":"none"}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function cC(r){let e,n,o,c;return e=new Gl({props:{filter:yb,paint:{"circle-radius":20,"circle-color":["get","color"],"circle-opacity":.5},layout:{visibility:r[2]?"visible":"none"}}}),o=new ga({props:{filter:ep,paint:{"line-width":fa(5),"line-color":["get","color"],"line-opacity":.5},layout:{visibility:r[2]?"visible":"none"}}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment)},m(d,h){ot(e,d,h),be(d,n,h),ot(o,d,h),c=!0},p(d,h){const a={};h&4&&(a.layout={visibility:d[2]?"visible":"none"}),e.$set(a);const _={};h&4&&(_.layout={visibility:d[2]?"visible":"none"}),o.$set(_)},i(d){c||(Pe(e.$$.fragment,d),Pe(o.$$.fragment,d),c=!0)},o(d){De(e.$$.fragment,d),De(o.$$.fragment,d),c=!1},d(d){d&&ye(n),at(e,d),at(o,d)}}}function uC(r){let e,n,o,c,d,h,a,_,S=r[9],k,y,C,E,T,M,R;e=new mb({}),e.$on("click",r[10]),o=new Ir({props:{data:r[0]||or(),$$slots:{default:[nC]},$$scope:{ctx:r}}}),d=new Ir({props:{data:r[12](r[0],r[8]),$$slots:{default:[rC]},$$scope:{ctx:r}}}),a=new Ir({props:{data:r[4],$$slots:{default:[sC]},$$scope:{ctx:r}}});let N=ry(r);return y=new Ir({props:{data:r[7],$$slots:{default:[aC]},$$scope:{ctx:r}}}),E=new Ir({props:{data:r[11](r[0]),$$slots:{default:[lC]},$$scope:{ctx:r}}}),M=new Ir({props:{data:r[1],$$slots:{default:[cC]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment),c=Ue(),lt(d.$$.fragment),h=Ue(),lt(a.$$.fragment),_=Ue(),N.c(),k=Ue(),lt(y.$$.fragment),C=Ue(),lt(E.$$.fragment),T=Ue(),lt(M.$$.fragment)},m(z,V){ot(e,z,V),be(z,n,V),ot(o,z,V),be(z,c,V),ot(d,z,V),be(z,h,V),ot(a,z,V),be(z,_,V),N.m(z,V),be(z,k,V),ot(y,z,V),be(z,C,V),ot(E,z,V),be(z,T,V),ot(M,z,V),R=!0},p(z,[V]){const Y={};V&1&&(Y.data=z[0]||or()),V&65536&&(Y.$$scope={dirty:V,ctx:z}),o.$set(Y);const se={};V&257&&(se.data=z[12](z[0],z[8])),V&65536&&(se.$$scope={dirty:V,ctx:z}),d.$set(se);const $={};V&16&&($.data=z[4]),V&65568&&($.$$scope={dirty:V,ctx:z}),a.$set($),V&512&&Yt(S,S=z[9])?(nn(),De(N,1,1,Ot),rn(),N=ry(z),N.c(),Pe(N,1),N.m(k.parentNode,k)):N.p(z,V);const te={};V&128&&(te.data=z[7]),V&65536&&(te.$$scope={dirty:V,ctx:z}),y.$set(te);const U={};V&1&&(U.data=z[11](z[0])),V&65792&&(U.$$scope={dirty:V,ctx:z}),E.$set(U);const j={};V&2&&(j.data=z[1]),V&65540&&(j.$$scope={dirty:V,ctx:z}),M.$set(j)},i(z){R||(Pe(e.$$.fragment,z),Pe(o.$$.fragment,z),Pe(d.$$.fragment,z),Pe(a.$$.fragment,z),Pe(N),Pe(y.$$.fragment,z),Pe(E.$$.fragment,z),Pe(M.$$.fragment,z),R=!0)},o(z){De(e.$$.fragment,z),De(o.$$.fragment,z),De(d.$$.fragment,z),De(a.$$.fragment,z),De(N),De(y.$$.fragment,z),De(E.$$.fragment,z),De(M.$$.fragment,z),R=!1},d(z){z&&(ye(n),ye(c),ye(h),ye(_),ye(k),ye(C),ye(T)),at(e,z),at(o,z),at(d,z),at(a,z),N.d(z),at(y,z),at(E,z),at(M,z)}}}function hC(r,e,n){let o,c,d,h,a;Bt(r,er,V=>n(6,c=V)),Bt(r,ya,V=>n(14,d=V)),Bt(r,wf,V=>n(8,h=V)),Bt(r,Yr,V=>n(9,a=V));let{pinnedWay:_}=e,{drawProblemDetails:S}=e,{showProblemDetails:k}=e,{showRoadSides:y}=e,{nodes:C}=e,{ways:E}=e,{filterWays:T}=e;function M(V){n(0,_=null);for(let Y of d.queryRenderedFeatures(V.detail.point,{layers:["ways"]})){n(0,_=E.features.find(se=>se.id==Y.id));break}}function R(V){let Y=or();if(V)for(let se of V.properties.problems)Y.features=[...Y.features,...se.details];return Y}function N(V){let Y=or();if(V)for(let[se,$]of V.properties.node_ids.entries()){let te=C.features.find(U=>U.properties.id==$);Y.features.push({type:"Feature",geometry:te.geometry,properties:{idx:se}})}return Y}function z(V,Y){if(!V||!Y)return or();let se=parseInt(V.properties.tags["tmp:closest_way"]);if(!se)return or();for(let $ of E.features)if($.properties.id==se){let te=JSON.parse(JSON.stringify($));return te.properties.left=V.properties.tags["tmp:side"]=="Left",{type:"FeatureCollection",features:[te]}}return or()}return r.$$set=V=>{"pinnedWay"in V&&n(0,_=V.pinnedWay),"drawProblemDetails"in V&&n(1,S=V.drawProblemDetails),"showProblemDetails"in V&&n(2,k=V.showProblemDetails),"showRoadSides"in V&&n(3,y=V.showRoadSides),"nodes"in V&&n(13,C=V.nodes),"ways"in V&&n(4,E=V.ways),"filterWays"in V&&n(5,T=V.filterWays)},r.$$.update=()=>{r.$$.dirty&65&&n(7,o=c&&_?JSON.parse(c.getSideLocations(BigInt(_.properties.id))):or()),r.$$.dirty&1&&n(1,S=R(_))},[_,S,k,y,E,T,c,o,h,a,M,N,z,C]}class fC extends ai{constructor(e){super(),oi(this,e,hC,uC,Yt,{pinnedWay:0,drawProblemDetails:1,showProblemDetails:2,showRoadSides:3,nodes:13,ways:4,filterWays:5})}}const Er=[];for(let r=0;r<256;++r)Er.push((r+256).toString(16).slice(1));function dC(r,e=0){return(Er[r[e+0]]+Er[r[e+1]]+Er[r[e+2]]+Er[r[e+3]]+"-"+Er[r[e+4]]+Er[r[e+5]]+"-"+Er[r[e+6]]+Er[r[e+7]]+"-"+Er[r[e+8]]+Er[r[e+9]]+"-"+Er[r[e+10]]+Er[r[e+11]]+Er[r[e+12]]+Er[r[e+13]]+Er[r[e+14]]+Er[r[e+15]]).toLowerCase()}let Bd;const pC=new Uint8Array(16);function mC(){if(!Bd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Bd=crypto.getRandomValues.bind(crypto)}return Bd(pC)}const gC=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),sy={randomUUID:gC};function _C(r,e,n){var c;r=r||{};const o=r.random??((c=r.rng)==null?void 0:c.call(r))??mC();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,dC(o)}function yC(r,e,n){return sy.randomUUID&&!r?sy.randomUUID():_C(r)}const bC=r=>({}),oy=r=>({}),vC=r=>({}),ay=r=>({});function wC(r){let e,n,o,c,d,h,a,_;const S=r[3].header,k=wn(S,r,r[2],ay),y=r[3].body,C=wn(y,r,r[2],oy);return{c(){e=xe("div"),n=xe("div"),o=xe("div"),c=xe("button"),k&&k.c(),d=Ue(),h=xe("div"),a=xe("div"),C&&C.c(),he(c,"class","accordion-button"),he(c,"type","button"),he(c,"data-bs-toggle","collapse"),he(c,"data-bs-target",`#${r[1]}`),he(c,"aria-expanded","true"),he(c,"aria-controls",r[1]),he(o,"class","accordion-header"),he(a,"class","accordion-body"),he(h,"id",r[1]),he(h,"class","accordion-collapse collapse"),gr(h,"show",r[0]),he(n,"class","accordion-item"),he(e,"class","accordion mb-3")},m(E,T){be(E,e,T),ce(e,n),ce(n,o),ce(o,c),k&&k.m(c,null),ce(n,d),ce(n,h),ce(h,a),C&&C.m(a,null),_=!0},p(E,[T]){k&&k.p&&(!_||T&4)&&kn(k,S,E,E[2],_?xn(S,E[2],T,vC):Sn(E[2]),ay),C&&C.p&&(!_||T&4)&&kn(C,y,E,E[2],_?xn(y,E[2],T,bC):Sn(E[2]),oy),(!_||T&1)&&gr(h,"show",E[0])},i(E){_||(Pe(k,E),Pe(C,E),_=!0)},o(E){De(k,E),De(C,E),_=!1},d(E){E&&ye(e),k&&k.d(E),C&&C.d(E)}}}function xC(r,e,n){let{$$slots:o={},$$scope:c}=e,{open:d=!0}=e,h=yC();return r.$$set=a=>{"open"in a&&n(0,d=a.open),"$$scope"in a&&n(2,c=a.$$scope)},[d,h,c,o]}class _a extends ai{constructor(e){super(),oi(this,e,xC,wC,Yt,{open:0})}}function ly(r,e,n){const o=r.slice();return o[13]=e[n][0],o[14]=e[n][1],o}function kC(r){let e;return{c(){e=xe("div"),e.textContent="Problems",he(e,"slot","header")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function cy(r){let e,n=r[13]+"",o,c,d=r[14]+"",h,a,_,S;return{c(){e=xe("option"),o=gt(n),c=gt(" ("),h=gt(d),a=gt(`)
        `),e.__value=_=r[13],mr(e,e.__value),e.disabled=S=r[14]==0},m(k,y){be(k,e,y),ce(e,o),ce(e,c),ce(e,h),ce(e,a)},p(k,y){y&4&&n!==(n=k[13]+"")&&_i(o,n),y&4&&d!==(d=k[14]+"")&&_i(h,d),y&4&&_!==(_=k[13])&&(e.__value=_,mr(e,e.__value)),y&4&&S!==(S=k[14]==0)&&(e.disabled=S)},d(k){k&&ye(e)}}}function uy(r){let e,n,o=r[2][r[1]]+"",c,d,h,a=r[0].features.length>0&&hy(r);return{c(){e=xe("div"),n=xe("p"),c=gt(o),d=gt(" problems"),h=Ue(),a&&a.c(),he(n,"class","problem-count svelte-d7yah8"),he(e,"class","problem-header svelte-d7yah8")},m(_,S){be(_,e,S),ce(e,n),ce(n,c),ce(n,d),ce(e,h),a&&a.m(e,null)},p(_,S){S&6&&o!==(o=_[2][_[1]]+"")&&_i(c,o),_[0].features.length>0?a?a.p(_,S):(a=hy(_),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(_){_&&ye(e),a&&a.d()}}}function hy(r){let e,n,o;return{c(){e=xe("button"),e.textContent="Pick next",he(e,"class","btn btn-sm btn-primary")},m(c,d){be(c,e,d),n||(o=Ut(e,"click",r[3]),n=!0)},p:Ot,d(c){c&&ye(e),n=!1,o()}}}function SC(r){let e;return{c(){e=xe("p"),e.textContent=`These roads have separate sidewalks tagged on one side, but the other
        side is unspecified or not drawn separately. Be consistent on each road
        and use another editor to draw separate sidewalks on both sides.`},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function TC(r){let e;return{c(){e=xe("p"),e.innerHTML=`<i>sidewalk=separate</i>
        is ambiguous. Update the tagging to specify if there are separate sidewalks
        on both sides or just one.`},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function CC(r){let e,n,o,c,d;return{c(){e=xe("p"),e.textContent=`These roads aren't tagged as having separate sidewalks, but it looks
        like there's a parallel separate sidewalk already mapped.`,n=Ue(),o=xe("ol"),o.innerHTML=`<li>Check each segment. If separate sidewalks are already there, update
          the tagging here.</li> <li>If the separate sidewalks don&#39;t cover the entire length of the road,
          ideally go finish drawing the separate sidewalks in another tool, then
          update the tagging on the road.</li>`,c=Ue(),d=xe("p"),d.textContent="There are false positives. Check the full length of the road."},m(h,a){be(h,e,a),be(h,n,a),be(h,o,a),be(h,c,a),be(h,d,a)},d(h){h&&(ye(e),ye(n),ye(o),ye(c),ye(d))}}}function EC(r){let e,n,o;return{c(){e=xe("p"),e.innerHTML=`Here are footways with a crossing node, but the way needs to be split
        and tagged as <i>footway=crossing</i>
        .`,n=Ue(),o=xe("ol"),o.innerHTML=`<li>Open in another editor</li> <li>Split the way around the crossing</li> <li>Tag <i>footway=crossing</i>
          on the smaller segment</li> <li>Refresh the data here to verify</li>`},m(c,d){be(c,e,d),be(c,n,d),be(c,o,d)},d(c){c&&(ye(e),ye(n),ye(o))}}}function IC(r){let e,n,o,c,d;return{c(){e=xe("p"),e.textContent=`Here are places where part of a road has separate sidewalks tagged, but
        then the next part of the road doesn't. It's best to be consistent about
        separate sidewalks along the entire length of a road. To fix:`,n=Ue(),o=xe("ol"),o.innerHTML=`<li>Go map separate sidewalks along the entire road (in another editor)</li> <li>Update the road tagging to indicate those separate sidewalks (here or
          in another editor)</li> <li>Refresh the data here to verify</li>`,c=Ue(),d=xe("p"),d.textContent=`(This problem is detected when the road names are the same, so there are
        some false positives you can ignore.)`},m(h,a){be(h,e,a),be(h,n,a),be(h,o,a),be(h,c,a),be(h,d,a)},d(h){h&&(ye(e),ye(n),ye(o),ye(c),ye(d))}}}function AC(r){let e;return{c(){e=xe("p"),e.textContent=`When a crossing way hits a road, the node should be tagged as a
        crossing. Instructions to fix are TODO.`},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function MC(r){let e,n,o,c,d,h,a,_=Ni(Object.entries(r[2])),S=[];for(let T=0;T<_.length;T+=1)S[T]=cy(ly(r,_,T));let k=r[1]&&uy(r);function y(T,M){if(T[1]=="missing crossing node")return AC;if(T[1]=="separate sidewalks should be continued here")return IC;if(T[1]=="missing footway=crossing")return EC;if(T[1]=="possible separate sidewalk near way without it tagged")return CC;if(T[1]=="sidewalk=separate is ambiguous about the side")return TC;if(T[1]=="sidewalk:left and sidewalk:right should each be tagged as separate or no")return SC}let C=y(r),E=C&&C(r);return{c(){e=xe("div"),n=xe("select"),o=xe("option"),o.textContent="Show a type of problem";for(let T=0;T<S.length;T+=1)S[T].c();c=Ue(),k&&k.c(),d=Ue(),E&&E.c(),o.__value="",mr(o,o.__value),he(n,"class","form-select"),r[1]===void 0&&pf(()=>r[7].call(n)),he(e,"slot","body")},m(T,M){be(T,e,M),ce(e,n),ce(n,o);for(let R=0;R<S.length;R+=1)S[R]&&S[R].m(n,null);dg(n,r[1],!0),ce(e,c),k&&k.m(e,null),ce(e,d),E&&E.m(e,null),h||(a=Ut(n,"change",r[7]),h=!0)},p(T,M){if(M&4){_=Ni(Object.entries(T[2]));let R;for(R=0;R<_.length;R+=1){const N=ly(T,_,R);S[R]?S[R].p(N,M):(S[R]=cy(N),S[R].c(),S[R].m(n,null))}for(;R<S.length;R+=1)S[R].d(1);S.length=_.length}M&6&&dg(n,T[1]),T[1]?k?k.p(T,M):(k=uy(T),k.c(),k.m(e,d)):k&&(k.d(1),k=null),C!==(C=y(T))&&(E&&E.d(1),E=C&&C(T),E&&(E.c(),E.m(e,null)))},d(T){T&&ye(e),$n(S,T),k&&k.d(),E&&E.d(),h=!1,a()}}}function PC(r){let e,n;return e=new _a({props:{$$slots:{body:[MC],header:[kC]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,[c]){const d={};c&131079&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function LC(r,e,n){let o,c;Bt(r,ya,R=>n(8,c=R));let{nodes:d}=e,{ways:h}=e,{drawProblems:a}=e,_=["missing crossing node","separate sidewalks should be continued here"],S=["missing footway=crossing","possible separate sidewalk near way without it tagged","sidewalk=separate is ambiguous about the side","sidewalk:left and sidewalk:right should each be tagged as separate or no"],k="",y=0;function C(R,N){let z={};for(let V of[..._,...S])z[V]=0;for(let V of[...d.features,...h.features])for(let Y of V.properties.problems)z[Y.note]+=1;return z}function E(R,N,z){let V={type:"FeatureCollection",features:[]};for(let Y of[...d.features,...h.features])Y.properties.problems.some(se=>se.note==k)&&V.features.push(Y);return V}function T(){if(!c||!k||a.features.length===0)return;const R=a.features[y];n(6,y=(y+1)%a.features.length);try{if(R.geometry.type==="Point"){const N=R.geometry.coordinates;c.flyTo({center:[N[0],N[1]],zoom:19,animate:!0})}else{const N=bb(R);c.fitBounds(N,{animate:!0,padding:50})}}catch(N){console.error("Error focusing on problem:",N)}}function M(){k=I1(this),n(1,k),n(2,o),n(4,d),n(5,h)}return r.$$set=R=>{"nodes"in R&&n(4,d=R.nodes),"ways"in R&&n(5,h=R.ways),"drawProblems"in R&&n(0,a=R.drawProblems)},r.$$.update=()=>{r.$$.dirty&48&&n(2,o=C()),r.$$.dirty&50&&n(0,a=E()),r.$$.dirty&2&&k&&n(6,y=0),r.$$.dirty&65&&y>=a.features.length&&a.features.length>0&&n(6,y=0)},[a,k,o,T,d,h,y,M]}class zC extends ai{constructor(e){super(),oi(this,e,LC,PC,Yt,{nodes:4,ways:5,drawProblems:0})}}function OC(r){let e,n,o,c,d,h;return e=new Gl({props:{filter:yb,paint:{"circle-radius":10,"circle-color":"red","circle-opacity":.5,"circle-stroke-color":"black","circle-stroke-width":1}}}),o=new ga({props:{filter:ep,maxzoom:16,paint:{"line-width":fa(15),"line-color":"red","line-opacity":r[2],"line-blur":5},layout:{visibility:r[1]?"none":"visible"}}}),d=new ga({props:{filter:ep,beforeId:"Road labels",minzoom:16,paint:{"line-width":fa(20),"line-color":"red","line-opacity":r[2],"line-blur":5},layout:{visibility:r[1]?"none":"visible"}}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment),c=Ue(),lt(d.$$.fragment)},m(a,_){ot(e,a,_),be(a,n,_),ot(o,a,_),be(a,c,_),ot(d,a,_),h=!0},p(a,_){const S={};_&4&&(S.paint={"line-width":fa(15),"line-color":"red","line-opacity":a[2],"line-blur":5}),_&2&&(S.layout={visibility:a[1]?"none":"visible"}),o.$set(S);const k={};_&4&&(k.paint={"line-width":fa(20),"line-color":"red","line-opacity":a[2],"line-blur":5}),_&2&&(k.layout={visibility:a[1]?"none":"visible"}),d.$set(k)},i(a){h||(Pe(e.$$.fragment,a),Pe(o.$$.fragment,a),Pe(d.$$.fragment,a),h=!0)},o(a){De(e.$$.fragment,a),De(o.$$.fragment,a),De(d.$$.fragment,a),h=!1},d(a){a&&(ye(n),ye(c)),at(e,a),at(o,a),at(d,a)}}}function DC(r){let e,n;return e=new Ir({props:{data:r[0],$$slots:{default:[OC]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,[c]){const d={};c&1&&(d.data=o[0]),c&22&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function FC(r,e,n){let{drawProblems:o}=e,{pinnedWay:c}=e,d=.5;function h(a){let _=2500,S=.35,k=.85,y=(Math.sin(a/_*Math.PI*2)+1)/2;n(2,d=S+y*(k-S)),requestAnimationFrame(h)}return requestAnimationFrame(h),r.$$set=a=>{"drawProblems"in a&&n(0,o=a.drawProblems),"pinnedWay"in a&&n(1,c=a.pinnedWay)},[o,c,d]}class RC extends ai{constructor(e){super(),oi(this,e,FC,DC,Yt,{drawProblems:0,pinnedWay:1})}}function lf(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Tb={exports:{}};(function(r,e){(function(n){r.exports=n()})(function(){return function(){function n(o,c,d){function h(S,k){if(!c[S]){if(!o[S]){var y=typeof lf=="function"&&lf;if(!k&&y)return y(S,!0);if(a)return a(S,!0);var C=new Error("Cannot find module '"+S+"'");throw C.code="MODULE_NOT_FOUND",C}var E=c[S]={exports:{}};o[S][0].call(E.exports,function(T){var M=o[S][1][T];return h(M||T)},E,E.exports,n,o,c,d)}return c[S].exports}for(var a=typeof lf=="function"&&lf,_=0;_<d.length;_++)h(d[_]);return h}return n}()({1:[function(n,o,c){c.byteLength=C,c.toByteArray=T,c.fromByteArray=N;for(var d=[],h=[],a=typeof Uint8Array<"u"?Uint8Array:Array,_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=0,k=_.length;S<k;++S)d[S]=_[S],h[_.charCodeAt(S)]=S;h[45]=62,h[95]=63;function y(z){var V=z.length;if(V%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Y=z.indexOf("=");Y===-1&&(Y=V);var se=Y===V?0:4-Y%4;return[Y,se]}function C(z){var V=y(z),Y=V[0],se=V[1];return(Y+se)*3/4-se}function E(z,V,Y){return(V+Y)*3/4-Y}function T(z){var V,Y=y(z),se=Y[0],$=Y[1],te=new a(E(z,se,$)),U=0,j=$>0?se-4:se,G;for(G=0;G<j;G+=4)V=h[z.charCodeAt(G)]<<18|h[z.charCodeAt(G+1)]<<12|h[z.charCodeAt(G+2)]<<6|h[z.charCodeAt(G+3)],te[U++]=V>>16&255,te[U++]=V>>8&255,te[U++]=V&255;return $===2&&(V=h[z.charCodeAt(G)]<<2|h[z.charCodeAt(G+1)]>>4,te[U++]=V&255),$===1&&(V=h[z.charCodeAt(G)]<<10|h[z.charCodeAt(G+1)]<<4|h[z.charCodeAt(G+2)]>>2,te[U++]=V>>8&255,te[U++]=V&255),te}function M(z){return d[z>>18&63]+d[z>>12&63]+d[z>>6&63]+d[z&63]}function R(z,V,Y){for(var se,$=[],te=V;te<Y;te+=3)se=(z[te]<<16&16711680)+(z[te+1]<<8&65280)+(z[te+2]&255),$.push(M(se));return $.join("")}function N(z){for(var V,Y=z.length,se=Y%3,$=[],te=16383,U=0,j=Y-se;U<j;U+=te)$.push(R(z,U,U+te>j?j:U+te));return se===1?(V=z[Y-1],$.push(d[V>>2]+d[V<<4&63]+"==")):se===2&&(V=(z[Y-2]<<8)+z[Y-1],$.push(d[V>>10]+d[V>>4&63]+d[V<<2&63]+"=")),$.join("")}},{}],2:[function(n,o,c){(function(d){(function(){var h=n("base64-js"),a=n("ieee754");c.Buffer=y,c.SlowBuffer=se,c.INSPECT_MAX_BYTES=50;var _=2147483647;c.kMaxLength=_,y.TYPED_ARRAY_SUPPORT=S(),!y.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function S(){try{var fe=new Uint8Array(1);return fe.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},fe.foo()===42}catch{return!1}}Object.defineProperty(y.prototype,"parent",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.buffer}}),Object.defineProperty(y.prototype,"offset",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.byteOffset}});function k(fe){if(fe>_)throw new RangeError('The value "'+fe+'" is invalid for option "size"');var X=new Uint8Array(fe);return X.__proto__=y.prototype,X}function y(fe,X,Q){if(typeof fe=="number"){if(typeof X=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return M(fe)}return C(fe,X,Q)}typeof Symbol<"u"&&Symbol.species!=null&&y[Symbol.species]===y&&Object.defineProperty(y,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),y.poolSize=8192;function C(fe,X,Q){if(typeof fe=="string")return R(fe,X);if(ArrayBuffer.isView(fe))return N(fe);if(fe==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof fe);if(yt(fe,ArrayBuffer)||fe&&yt(fe.buffer,ArrayBuffer))return z(fe,X,Q);if(typeof fe=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var Me=fe.valueOf&&fe.valueOf();if(Me!=null&&Me!==fe)return y.from(Me,X,Q);var Ze=V(fe);if(Ze)return Ze;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof fe[Symbol.toPrimitive]=="function")return y.from(fe[Symbol.toPrimitive]("string"),X,Q);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof fe)}y.from=function(fe,X,Q){return C(fe,X,Q)},y.prototype.__proto__=Uint8Array.prototype,y.__proto__=Uint8Array;function E(fe){if(typeof fe!="number")throw new TypeError('"size" argument must be of type number');if(fe<0)throw new RangeError('The value "'+fe+'" is invalid for option "size"')}function T(fe,X,Q){return E(fe),fe<=0?k(fe):X!==void 0?typeof Q=="string"?k(fe).fill(X,Q):k(fe).fill(X):k(fe)}y.alloc=function(fe,X,Q){return T(fe,X,Q)};function M(fe){return E(fe),k(fe<0?0:Y(fe)|0)}y.allocUnsafe=function(fe){return M(fe)},y.allocUnsafeSlow=function(fe){return M(fe)};function R(fe,X){if((typeof X!="string"||X==="")&&(X="utf8"),!y.isEncoding(X))throw new TypeError("Unknown encoding: "+X);var Q=$(fe,X)|0,Me=k(Q),Ze=Me.write(fe,X);return Ze!==Q&&(Me=Me.slice(0,Ze)),Me}function N(fe){for(var X=fe.length<0?0:Y(fe.length)|0,Q=k(X),Me=0;Me<X;Me+=1)Q[Me]=fe[Me]&255;return Q}function z(fe,X,Q){if(X<0||fe.byteLength<X)throw new RangeError('"offset" is outside of buffer bounds');if(fe.byteLength<X+(Q||0))throw new RangeError('"length" is outside of buffer bounds');var Me;return X===void 0&&Q===void 0?Me=new Uint8Array(fe):Q===void 0?Me=new Uint8Array(fe,X):Me=new Uint8Array(fe,X,Q),Me.__proto__=y.prototype,Me}function V(fe){if(y.isBuffer(fe)){var X=Y(fe.length)|0,Q=k(X);return Q.length===0||fe.copy(Q,0,0,X),Q}if(fe.length!==void 0)return typeof fe.length!="number"||it(fe.length)?k(0):N(fe);if(fe.type==="Buffer"&&Array.isArray(fe.data))return N(fe.data)}function Y(fe){if(fe>=_)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+_.toString(16)+" bytes");return fe|0}function se(fe){return+fe!=fe&&(fe=0),y.alloc(+fe)}y.isBuffer=function(X){return X!=null&&X._isBuffer===!0&&X!==y.prototype},y.compare=function(X,Q){if(yt(X,Uint8Array)&&(X=y.from(X,X.offset,X.byteLength)),yt(Q,Uint8Array)&&(Q=y.from(Q,Q.offset,Q.byteLength)),!y.isBuffer(X)||!y.isBuffer(Q))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(X===Q)return 0;for(var Me=X.length,Ze=Q.length,dt=0,st=Math.min(Me,Ze);dt<st;++dt)if(X[dt]!==Q[dt]){Me=X[dt],Ze=Q[dt];break}return Me<Ze?-1:Ze<Me?1:0},y.isEncoding=function(X){switch(String(X).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},y.concat=function(X,Q){if(!Array.isArray(X))throw new TypeError('"list" argument must be an Array of Buffers');if(X.length===0)return y.alloc(0);var Me;if(Q===void 0)for(Q=0,Me=0;Me<X.length;++Me)Q+=X[Me].length;var Ze=y.allocUnsafe(Q),dt=0;for(Me=0;Me<X.length;++Me){var st=X[Me];if(yt(st,Uint8Array)&&(st=y.from(st)),!y.isBuffer(st))throw new TypeError('"list" argument must be an Array of Buffers');st.copy(Ze,dt),dt+=st.length}return Ze};function $(fe,X){if(y.isBuffer(fe))return fe.length;if(ArrayBuffer.isView(fe)||yt(fe,ArrayBuffer))return fe.byteLength;if(typeof fe!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof fe);var Q=fe.length,Me=arguments.length>2&&arguments[2]===!0;if(!Me&&Q===0)return 0;for(var Ze=!1;;)switch(X){case"ascii":case"latin1":case"binary":return Q;case"utf8":case"utf-8":return Xe(fe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q*2;case"hex":return Q>>>1;case"base64":return $e(fe).length;default:if(Ze)return Me?-1:Xe(fe).length;X=(""+X).toLowerCase(),Ze=!0}}y.byteLength=$;function te(fe,X,Q){var Me=!1;if((X===void 0||X<0)&&(X=0),X>this.length||((Q===void 0||Q>this.length)&&(Q=this.length),Q<=0)||(Q>>>=0,X>>>=0,Q<=X))return"";for(fe||(fe="utf8");;)switch(fe){case"hex":return kt(this,X,Q);case"utf8":case"utf-8":return Te(this,X,Q);case"ascii":return We(this,X,Q);case"latin1":case"binary":return pt(this,X,Q);case"base64":return we(this,X,Q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Je(this,X,Q);default:if(Me)throw new TypeError("Unknown encoding: "+fe);fe=(fe+"").toLowerCase(),Me=!0}}y.prototype._isBuffer=!0;function U(fe,X,Q){var Me=fe[X];fe[X]=fe[Q],fe[Q]=Me}y.prototype.swap16=function(){var X=this.length;if(X%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Q=0;Q<X;Q+=2)U(this,Q,Q+1);return this},y.prototype.swap32=function(){var X=this.length;if(X%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Q=0;Q<X;Q+=4)U(this,Q,Q+3),U(this,Q+1,Q+2);return this},y.prototype.swap64=function(){var X=this.length;if(X%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Q=0;Q<X;Q+=8)U(this,Q,Q+7),U(this,Q+1,Q+6),U(this,Q+2,Q+5),U(this,Q+3,Q+4);return this},y.prototype.toString=function(){var X=this.length;return X===0?"":arguments.length===0?Te(this,0,X):te.apply(this,arguments)},y.prototype.toLocaleString=y.prototype.toString,y.prototype.equals=function(X){if(!y.isBuffer(X))throw new TypeError("Argument must be a Buffer");return this===X?!0:y.compare(this,X)===0},y.prototype.inspect=function(){var X="",Q=c.INSPECT_MAX_BYTES;return X=this.toString("hex",0,Q).replace(/(.{2})/g,"$1 ").trim(),this.length>Q&&(X+=" ... "),"<Buffer "+X+">"},y.prototype.compare=function(X,Q,Me,Ze,dt){if(yt(X,Uint8Array)&&(X=y.from(X,X.offset,X.byteLength)),!y.isBuffer(X))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof X);if(Q===void 0&&(Q=0),Me===void 0&&(Me=X?X.length:0),Ze===void 0&&(Ze=0),dt===void 0&&(dt=this.length),Q<0||Me>X.length||Ze<0||dt>this.length)throw new RangeError("out of range index");if(Ze>=dt&&Q>=Me)return 0;if(Ze>=dt)return-1;if(Q>=Me)return 1;if(Q>>>=0,Me>>>=0,Ze>>>=0,dt>>>=0,this===X)return 0;for(var st=dt-Ze,Ci=Me-Q,ft=Math.min(st,Ci),Wt=this.slice(Ze,dt),Ei=X.slice(Q,Me),Bi=0;Bi<ft;++Bi)if(Wt[Bi]!==Ei[Bi]){st=Wt[Bi],Ci=Ei[Bi];break}return st<Ci?-1:Ci<st?1:0};function j(fe,X,Q,Me,Ze){if(fe.length===0)return-1;if(typeof Q=="string"?(Me=Q,Q=0):Q>2147483647?Q=2147483647:Q<-2147483648&&(Q=-2147483648),Q=+Q,it(Q)&&(Q=Ze?0:fe.length-1),Q<0&&(Q=fe.length+Q),Q>=fe.length){if(Ze)return-1;Q=fe.length-1}else if(Q<0)if(Ze)Q=0;else return-1;if(typeof X=="string"&&(X=y.from(X,Me)),y.isBuffer(X))return X.length===0?-1:G(fe,X,Q,Me,Ze);if(typeof X=="number")return X=X&255,typeof Uint8Array.prototype.indexOf=="function"?Ze?Uint8Array.prototype.indexOf.call(fe,X,Q):Uint8Array.prototype.lastIndexOf.call(fe,X,Q):G(fe,[X],Q,Me,Ze);throw new TypeError("val must be string, number or Buffer")}function G(fe,X,Q,Me,Ze){var dt=1,st=fe.length,Ci=X.length;if(Me!==void 0&&(Me=String(Me).toLowerCase(),Me==="ucs2"||Me==="ucs-2"||Me==="utf16le"||Me==="utf-16le")){if(fe.length<2||X.length<2)return-1;dt=2,st/=2,Ci/=2,Q/=2}function ft(St,ui){return dt===1?St[ui]:St.readUInt16BE(ui*dt)}var Wt;if(Ze){var Ei=-1;for(Wt=Q;Wt<st;Wt++)if(ft(fe,Wt)===ft(X,Ei===-1?0:Wt-Ei)){if(Ei===-1&&(Ei=Wt),Wt-Ei+1===Ci)return Ei*dt}else Ei!==-1&&(Wt-=Wt-Ei),Ei=-1}else for(Q+Ci>st&&(Q=st-Ci),Wt=Q;Wt>=0;Wt--){for(var Bi=!0,Cn=0;Cn<Ci;Cn++)if(ft(fe,Wt+Cn)!==ft(X,Cn)){Bi=!1;break}if(Bi)return Wt}return-1}y.prototype.includes=function(X,Q,Me){return this.indexOf(X,Q,Me)!==-1},y.prototype.indexOf=function(X,Q,Me){return j(this,X,Q,Me,!0)},y.prototype.lastIndexOf=function(X,Q,Me){return j(this,X,Q,Me,!1)};function O(fe,X,Q,Me){Q=Number(Q)||0;var Ze=fe.length-Q;Me?(Me=Number(Me),Me>Ze&&(Me=Ze)):Me=Ze;var dt=X.length;Me>dt/2&&(Me=dt/2);for(var st=0;st<Me;++st){var Ci=parseInt(X.substr(st*2,2),16);if(it(Ci))return st;fe[Q+st]=Ci}return st}function W(fe,X,Q,Me){return yi(Xe(X,fe.length-Q),fe,Q,Me)}function le(fe,X,Q,Me){return yi(Pt(X),fe,Q,Me)}function de(fe,X,Q,Me){return le(fe,X,Q,Me)}function ve(fe,X,Q,Me){return yi($e(X),fe,Q,Me)}function pe(fe,X,Q,Me){return yi(ni(X,fe.length-Q),fe,Q,Me)}y.prototype.write=function(X,Q,Me,Ze){if(Q===void 0)Ze="utf8",Me=this.length,Q=0;else if(Me===void 0&&typeof Q=="string")Ze=Q,Me=this.length,Q=0;else if(isFinite(Q))Q=Q>>>0,isFinite(Me)?(Me=Me>>>0,Ze===void 0&&(Ze="utf8")):(Ze=Me,Me=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var dt=this.length-Q;if((Me===void 0||Me>dt)&&(Me=dt),X.length>0&&(Me<0||Q<0)||Q>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ze||(Ze="utf8");for(var st=!1;;)switch(Ze){case"hex":return O(this,X,Q,Me);case"utf8":case"utf-8":return W(this,X,Q,Me);case"ascii":return le(this,X,Q,Me);case"latin1":case"binary":return de(this,X,Q,Me);case"base64":return ve(this,X,Q,Me);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pe(this,X,Q,Me);default:if(st)throw new TypeError("Unknown encoding: "+Ze);Ze=(""+Ze).toLowerCase(),st=!0}},y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function we(fe,X,Q){return X===0&&Q===fe.length?h.fromByteArray(fe):h.fromByteArray(fe.slice(X,Q))}function Te(fe,X,Q){Q=Math.min(fe.length,Q);for(var Me=[],Ze=X;Ze<Q;){var dt=fe[Ze],st=null,Ci=dt>239?4:dt>223?3:dt>191?2:1;if(Ze+Ci<=Q){var ft,Wt,Ei,Bi;switch(Ci){case 1:dt<128&&(st=dt);break;case 2:ft=fe[Ze+1],(ft&192)===128&&(Bi=(dt&31)<<6|ft&63,Bi>127&&(st=Bi));break;case 3:ft=fe[Ze+1],Wt=fe[Ze+2],(ft&192)===128&&(Wt&192)===128&&(Bi=(dt&15)<<12|(ft&63)<<6|Wt&63,Bi>2047&&(Bi<55296||Bi>57343)&&(st=Bi));break;case 4:ft=fe[Ze+1],Wt=fe[Ze+2],Ei=fe[Ze+3],(ft&192)===128&&(Wt&192)===128&&(Ei&192)===128&&(Bi=(dt&15)<<18|(ft&63)<<12|(Wt&63)<<6|Ei&63,Bi>65535&&Bi<1114112&&(st=Bi))}}st===null?(st=65533,Ci=1):st>65535&&(st-=65536,Me.push(st>>>10&1023|55296),st=56320|st&1023),Me.push(st),Ze+=Ci}return ct(Me)}var Ae=4096;function ct(fe){var X=fe.length;if(X<=Ae)return String.fromCharCode.apply(String,fe);for(var Q="",Me=0;Me<X;)Q+=String.fromCharCode.apply(String,fe.slice(Me,Me+=Ae));return Q}function We(fe,X,Q){var Me="";Q=Math.min(fe.length,Q);for(var Ze=X;Ze<Q;++Ze)Me+=String.fromCharCode(fe[Ze]&127);return Me}function pt(fe,X,Q){var Me="";Q=Math.min(fe.length,Q);for(var Ze=X;Ze<Q;++Ze)Me+=String.fromCharCode(fe[Ze]);return Me}function kt(fe,X,Q){var Me=fe.length;(!X||X<0)&&(X=0),(!Q||Q<0||Q>Me)&&(Q=Me);for(var Ze="",dt=X;dt<Q;++dt)Ze+=At(fe[dt]);return Ze}function Je(fe,X,Q){for(var Me=fe.slice(X,Q),Ze="",dt=0;dt<Me.length;dt+=2)Ze+=String.fromCharCode(Me[dt]+Me[dt+1]*256);return Ze}y.prototype.slice=function(X,Q){var Me=this.length;X=~~X,Q=Q===void 0?Me:~~Q,X<0?(X+=Me,X<0&&(X=0)):X>Me&&(X=Me),Q<0?(Q+=Me,Q<0&&(Q=0)):Q>Me&&(Q=Me),Q<X&&(Q=X);var Ze=this.subarray(X,Q);return Ze.__proto__=y.prototype,Ze};function wt(fe,X,Q){if(fe%1!==0||fe<0)throw new RangeError("offset is not uint");if(fe+X>Q)throw new RangeError("Trying to access beyond buffer length")}y.prototype.readUIntLE=function(X,Q,Me){X=X>>>0,Q=Q>>>0,Me||wt(X,Q,this.length);for(var Ze=this[X],dt=1,st=0;++st<Q&&(dt*=256);)Ze+=this[X+st]*dt;return Ze},y.prototype.readUIntBE=function(X,Q,Me){X=X>>>0,Q=Q>>>0,Me||wt(X,Q,this.length);for(var Ze=this[X+--Q],dt=1;Q>0&&(dt*=256);)Ze+=this[X+--Q]*dt;return Ze},y.prototype.readUInt8=function(X,Q){return X=X>>>0,Q||wt(X,1,this.length),this[X]},y.prototype.readUInt16LE=function(X,Q){return X=X>>>0,Q||wt(X,2,this.length),this[X]|this[X+1]<<8},y.prototype.readUInt16BE=function(X,Q){return X=X>>>0,Q||wt(X,2,this.length),this[X]<<8|this[X+1]},y.prototype.readUInt32LE=function(X,Q){return X=X>>>0,Q||wt(X,4,this.length),(this[X]|this[X+1]<<8|this[X+2]<<16)+this[X+3]*16777216},y.prototype.readUInt32BE=function(X,Q){return X=X>>>0,Q||wt(X,4,this.length),this[X]*16777216+(this[X+1]<<16|this[X+2]<<8|this[X+3])},y.prototype.readIntLE=function(X,Q,Me){X=X>>>0,Q=Q>>>0,Me||wt(X,Q,this.length);for(var Ze=this[X],dt=1,st=0;++st<Q&&(dt*=256);)Ze+=this[X+st]*dt;return dt*=128,Ze>=dt&&(Ze-=Math.pow(2,8*Q)),Ze},y.prototype.readIntBE=function(X,Q,Me){X=X>>>0,Q=Q>>>0,Me||wt(X,Q,this.length);for(var Ze=Q,dt=1,st=this[X+--Ze];Ze>0&&(dt*=256);)st+=this[X+--Ze]*dt;return dt*=128,st>=dt&&(st-=Math.pow(2,8*Q)),st},y.prototype.readInt8=function(X,Q){return X=X>>>0,Q||wt(X,1,this.length),this[X]&128?(255-this[X]+1)*-1:this[X]},y.prototype.readInt16LE=function(X,Q){X=X>>>0,Q||wt(X,2,this.length);var Me=this[X]|this[X+1]<<8;return Me&32768?Me|4294901760:Me},y.prototype.readInt16BE=function(X,Q){X=X>>>0,Q||wt(X,2,this.length);var Me=this[X+1]|this[X]<<8;return Me&32768?Me|4294901760:Me},y.prototype.readInt32LE=function(X,Q){return X=X>>>0,Q||wt(X,4,this.length),this[X]|this[X+1]<<8|this[X+2]<<16|this[X+3]<<24},y.prototype.readInt32BE=function(X,Q){return X=X>>>0,Q||wt(X,4,this.length),this[X]<<24|this[X+1]<<16|this[X+2]<<8|this[X+3]},y.prototype.readFloatLE=function(X,Q){return X=X>>>0,Q||wt(X,4,this.length),a.read(this,X,!0,23,4)},y.prototype.readFloatBE=function(X,Q){return X=X>>>0,Q||wt(X,4,this.length),a.read(this,X,!1,23,4)},y.prototype.readDoubleLE=function(X,Q){return X=X>>>0,Q||wt(X,8,this.length),a.read(this,X,!0,52,8)},y.prototype.readDoubleBE=function(X,Q){return X=X>>>0,Q||wt(X,8,this.length),a.read(this,X,!1,52,8)};function Tt(fe,X,Q,Me,Ze,dt){if(!y.isBuffer(fe))throw new TypeError('"buffer" argument must be a Buffer instance');if(X>Ze||X<dt)throw new RangeError('"value" argument is out of bounds');if(Q+Me>fe.length)throw new RangeError("Index out of range")}y.prototype.writeUIntLE=function(X,Q,Me,Ze){if(X=+X,Q=Q>>>0,Me=Me>>>0,!Ze){var dt=Math.pow(2,8*Me)-1;Tt(this,X,Q,Me,dt,0)}var st=1,Ci=0;for(this[Q]=X&255;++Ci<Me&&(st*=256);)this[Q+Ci]=X/st&255;return Q+Me},y.prototype.writeUIntBE=function(X,Q,Me,Ze){if(X=+X,Q=Q>>>0,Me=Me>>>0,!Ze){var dt=Math.pow(2,8*Me)-1;Tt(this,X,Q,Me,dt,0)}var st=Me-1,Ci=1;for(this[Q+st]=X&255;--st>=0&&(Ci*=256);)this[Q+st]=X/Ci&255;return Q+Me},y.prototype.writeUInt8=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,1,255,0),this[Q]=X&255,Q+1},y.prototype.writeUInt16LE=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,2,65535,0),this[Q]=X&255,this[Q+1]=X>>>8,Q+2},y.prototype.writeUInt16BE=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,2,65535,0),this[Q]=X>>>8,this[Q+1]=X&255,Q+2},y.prototype.writeUInt32LE=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,4,4294967295,0),this[Q+3]=X>>>24,this[Q+2]=X>>>16,this[Q+1]=X>>>8,this[Q]=X&255,Q+4},y.prototype.writeUInt32BE=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,4,4294967295,0),this[Q]=X>>>24,this[Q+1]=X>>>16,this[Q+2]=X>>>8,this[Q+3]=X&255,Q+4},y.prototype.writeIntLE=function(X,Q,Me,Ze){if(X=+X,Q=Q>>>0,!Ze){var dt=Math.pow(2,8*Me-1);Tt(this,X,Q,Me,dt-1,-dt)}var st=0,Ci=1,ft=0;for(this[Q]=X&255;++st<Me&&(Ci*=256);)X<0&&ft===0&&this[Q+st-1]!==0&&(ft=1),this[Q+st]=(X/Ci>>0)-ft&255;return Q+Me},y.prototype.writeIntBE=function(X,Q,Me,Ze){if(X=+X,Q=Q>>>0,!Ze){var dt=Math.pow(2,8*Me-1);Tt(this,X,Q,Me,dt-1,-dt)}var st=Me-1,Ci=1,ft=0;for(this[Q+st]=X&255;--st>=0&&(Ci*=256);)X<0&&ft===0&&this[Q+st+1]!==0&&(ft=1),this[Q+st]=(X/Ci>>0)-ft&255;return Q+Me},y.prototype.writeInt8=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,1,127,-128),X<0&&(X=255+X+1),this[Q]=X&255,Q+1},y.prototype.writeInt16LE=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,2,32767,-32768),this[Q]=X&255,this[Q+1]=X>>>8,Q+2},y.prototype.writeInt16BE=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,2,32767,-32768),this[Q]=X>>>8,this[Q+1]=X&255,Q+2},y.prototype.writeInt32LE=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,4,2147483647,-2147483648),this[Q]=X&255,this[Q+1]=X>>>8,this[Q+2]=X>>>16,this[Q+3]=X>>>24,Q+4},y.prototype.writeInt32BE=function(X,Q,Me){return X=+X,Q=Q>>>0,Me||Tt(this,X,Q,4,2147483647,-2147483648),X<0&&(X=4294967295+X+1),this[Q]=X>>>24,this[Q+1]=X>>>16,this[Q+2]=X>>>8,this[Q+3]=X&255,Q+4};function Ht(fe,X,Q,Me,Ze,dt){if(Q+Me>fe.length)throw new RangeError("Index out of range");if(Q<0)throw new RangeError("Index out of range")}function li(fe,X,Q,Me,Ze){return X=+X,Q=Q>>>0,Ze||Ht(fe,X,Q,4),a.write(fe,X,Q,Me,23,4),Q+4}y.prototype.writeFloatLE=function(X,Q,Me){return li(this,X,Q,!0,Me)},y.prototype.writeFloatBE=function(X,Q,Me){return li(this,X,Q,!1,Me)};function Mi(fe,X,Q,Me,Ze){return X=+X,Q=Q>>>0,Ze||Ht(fe,X,Q,8),a.write(fe,X,Q,Me,52,8),Q+8}y.prototype.writeDoubleLE=function(X,Q,Me){return Mi(this,X,Q,!0,Me)},y.prototype.writeDoubleBE=function(X,Q,Me){return Mi(this,X,Q,!1,Me)},y.prototype.copy=function(X,Q,Me,Ze){if(!y.isBuffer(X))throw new TypeError("argument should be a Buffer");if(Me||(Me=0),!Ze&&Ze!==0&&(Ze=this.length),Q>=X.length&&(Q=X.length),Q||(Q=0),Ze>0&&Ze<Me&&(Ze=Me),Ze===Me||X.length===0||this.length===0)return 0;if(Q<0)throw new RangeError("targetStart out of bounds");if(Me<0||Me>=this.length)throw new RangeError("Index out of range");if(Ze<0)throw new RangeError("sourceEnd out of bounds");Ze>this.length&&(Ze=this.length),X.length-Q<Ze-Me&&(Ze=X.length-Q+Me);var dt=Ze-Me;if(this===X&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(Q,Me,Ze);else if(this===X&&Me<Q&&Q<Ze)for(var st=dt-1;st>=0;--st)X[st+Q]=this[st+Me];else Uint8Array.prototype.set.call(X,this.subarray(Me,Ze),Q);return dt},y.prototype.fill=function(X,Q,Me,Ze){if(typeof X=="string"){if(typeof Q=="string"?(Ze=Q,Q=0,Me=this.length):typeof Me=="string"&&(Ze=Me,Me=this.length),Ze!==void 0&&typeof Ze!="string")throw new TypeError("encoding must be a string");if(typeof Ze=="string"&&!y.isEncoding(Ze))throw new TypeError("Unknown encoding: "+Ze);if(X.length===1){var dt=X.charCodeAt(0);(Ze==="utf8"&&dt<128||Ze==="latin1")&&(X=dt)}}else typeof X=="number"&&(X=X&255);if(Q<0||this.length<Q||this.length<Me)throw new RangeError("Out of range index");if(Me<=Q)return this;Q=Q>>>0,Me=Me===void 0?this.length:Me>>>0,X||(X=0);var st;if(typeof X=="number")for(st=Q;st<Me;++st)this[st]=X;else{var Ci=y.isBuffer(X)?X:y.from(X,Ze),ft=Ci.length;if(ft===0)throw new TypeError('The value "'+X+'" is invalid for argument "value"');for(st=0;st<Me-Q;++st)this[st+Q]=Ci[st%ft]}return this};var Pi=/[^+/0-9A-Za-z-_]/g;function Ti(fe){if(fe=fe.split("=")[0],fe=fe.trim().replace(Pi,""),fe.length<2)return"";for(;fe.length%4!==0;)fe=fe+"=";return fe}function At(fe){return fe<16?"0"+fe.toString(16):fe.toString(16)}function Xe(fe,X){X=X||1/0;for(var Q,Me=fe.length,Ze=null,dt=[],st=0;st<Me;++st){if(Q=fe.charCodeAt(st),Q>55295&&Q<57344){if(!Ze){if(Q>56319){(X-=3)>-1&&dt.push(239,191,189);continue}else if(st+1===Me){(X-=3)>-1&&dt.push(239,191,189);continue}Ze=Q;continue}if(Q<56320){(X-=3)>-1&&dt.push(239,191,189),Ze=Q;continue}Q=(Ze-55296<<10|Q-56320)+65536}else Ze&&(X-=3)>-1&&dt.push(239,191,189);if(Ze=null,Q<128){if((X-=1)<0)break;dt.push(Q)}else if(Q<2048){if((X-=2)<0)break;dt.push(Q>>6|192,Q&63|128)}else if(Q<65536){if((X-=3)<0)break;dt.push(Q>>12|224,Q>>6&63|128,Q&63|128)}else if(Q<1114112){if((X-=4)<0)break;dt.push(Q>>18|240,Q>>12&63|128,Q>>6&63|128,Q&63|128)}else throw new Error("Invalid code point")}return dt}function Pt(fe){for(var X=[],Q=0;Q<fe.length;++Q)X.push(fe.charCodeAt(Q)&255);return X}function ni(fe,X){for(var Q,Me,Ze,dt=[],st=0;st<fe.length&&!((X-=2)<0);++st)Q=fe.charCodeAt(st),Me=Q>>8,Ze=Q%256,dt.push(Ze),dt.push(Me);return dt}function $e(fe){return h.toByteArray(Ti(fe))}function yi(fe,X,Q,Me){for(var Ze=0;Ze<Me&&!(Ze+Q>=X.length||Ze>=fe.length);++Ze)X[Ze+Q]=fe[Ze];return Ze}function yt(fe,X){return fe instanceof X||fe!=null&&fe.constructor!=null&&fe.constructor.name!=null&&fe.constructor.name===X.name}function it(fe){return fe!==fe}}).call(this)}).call(this,n("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:14}],3:[function(n,o,c){const d=n("./validator"),h=n("./xmlparser/XMLParser"),a=n("./xmlbuilder/json2xml");o.exports={XMLParser:h,XMLValidator:d,XMLBuilder:a}},{"./validator":5,"./xmlbuilder/json2xml":6,"./xmlparser/XMLParser":11}],4:[function(n,o,c){const d=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",h=d+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",a="["+d+"]["+h+"]*",_=new RegExp("^"+a+"$"),S=function(y,C){const E=[];let T=C.exec(y);for(;T;){const M=[];M.startIndex=C.lastIndex-T[0].length;const R=T.length;for(let N=0;N<R;N++)M.push(T[N]);E.push(M),T=C.exec(y)}return E},k=function(y){const C=_.exec(y);return!(C===null||typeof C>"u")};c.isExist=function(y){return typeof y<"u"},c.isEmptyObject=function(y){return Object.keys(y).length===0},c.merge=function(y,C,E){if(C){const T=Object.keys(C),M=T.length;for(let R=0;R<M;R++)E==="strict"?y[T[R]]=[C[T[R]]]:y[T[R]]=C[T[R]]}},c.getValue=function(y){return c.isExist(y)?y:""},c.isName=k,c.getAllMatches=S,c.nameRegexp=a},{}],5:[function(n,o,c){const d=n("./util"),h={allowBooleanAttributes:!1,unpairedTags:[]};c.validate=function($,te){te=Object.assign({},h,te);const U=[];let j=!1,G=!1;$[0]==="\uFEFF"&&($=$.substr(1));for(let O=0;O<$.length;O++)if($[O]==="<"&&$[O+1]==="?"){if(O+=2,O=_($,O),O.err)return O}else if($[O]==="<"){let W=O;if(O++,$[O]==="!"){O=S($,O);continue}else{let le=!1;$[O]==="/"&&(le=!0,O++);let de="";for(;O<$.length&&$[O]!==">"&&$[O]!==" "&&$[O]!=="	"&&$[O]!==`
`&&$[O]!=="\r";O++)de+=$[O];if(de=de.trim(),de[de.length-1]==="/"&&(de=de.substring(0,de.length-1),O--),!V(de)){let we;return de.trim().length===0?we="Invalid space after '<'.":we="Tag '"+de+"' is an invalid name.",N("InvalidTag",we,Y($,O))}const ve=C($,O);if(ve===!1)return N("InvalidAttr","Attributes for '"+de+"' have open quote.",Y($,O));let pe=ve.value;if(O=ve.index,pe[pe.length-1]==="/"){const we=O-pe.length;pe=pe.substring(0,pe.length-1);const Te=T(pe,te);if(Te===!0)j=!0;else return N(Te.err.code,Te.err.msg,Y($,we+Te.err.line))}else if(le)if(ve.tagClosed){if(pe.trim().length>0)return N("InvalidTag","Closing tag '"+de+"' can't have attributes or invalid starting.",Y($,W));if(U.length===0)return N("InvalidTag","Closing tag '"+de+"' has not been opened.",Y($,W));{const we=U.pop();if(de!==we.tagName){let Te=Y($,we.tagStartPos);return N("InvalidTag","Expected closing tag '"+we.tagName+"' (opened in line "+Te.line+", col "+Te.col+") instead of closing tag '"+de+"'.",Y($,W))}U.length==0&&(G=!0)}}else return N("InvalidTag","Closing tag '"+de+"' doesn't have proper closing.",Y($,O));else{const we=T(pe,te);if(we!==!0)return N(we.err.code,we.err.msg,Y($,O-pe.length+we.err.line));if(G===!0)return N("InvalidXml","Multiple possible root nodes found.",Y($,O));te.unpairedTags.indexOf(de)!==-1||U.push({tagName:de,tagStartPos:W}),j=!0}for(O++;O<$.length;O++)if($[O]==="<")if($[O+1]==="!"){O++,O=S($,O);continue}else if($[O+1]==="?"){if(O=_($,++O),O.err)return O}else break;else if($[O]==="&"){const we=R($,O);if(we==-1)return N("InvalidChar","char '&' is not expected.",Y($,O));O=we}else if(G===!0&&!a($[O]))return N("InvalidXml","Extra text at the end",Y($,O));$[O]==="<"&&O--}}else{if(a($[O]))continue;return N("InvalidChar","char '"+$[O]+"' is not expected.",Y($,O))}if(j){if(U.length==1)return N("InvalidTag","Unclosed tag '"+U[0].tagName+"'.",Y($,U[0].tagStartPos));if(U.length>0)return N("InvalidXml","Invalid '"+JSON.stringify(U.map(O=>O.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return N("InvalidXml","Start tag expected.",1);return!0};function a($){return $===" "||$==="	"||$===`
`||$==="\r"}function _($,te){const U=te;for(;te<$.length;te++)if($[te]=="?"||$[te]==" "){const j=$.substr(U,te-U);if(te>5&&j==="xml")return N("InvalidXml","XML declaration allowed only at the start of the document.",Y($,te));if($[te]=="?"&&$[te+1]==">"){te++;break}else continue}return te}function S($,te){if($.length>te+5&&$[te+1]==="-"&&$[te+2]==="-"){for(te+=3;te<$.length;te++)if($[te]==="-"&&$[te+1]==="-"&&$[te+2]===">"){te+=2;break}}else if($.length>te+8&&$[te+1]==="D"&&$[te+2]==="O"&&$[te+3]==="C"&&$[te+4]==="T"&&$[te+5]==="Y"&&$[te+6]==="P"&&$[te+7]==="E"){let U=1;for(te+=8;te<$.length;te++)if($[te]==="<")U++;else if($[te]===">"&&(U--,U===0))break}else if($.length>te+9&&$[te+1]==="["&&$[te+2]==="C"&&$[te+3]==="D"&&$[te+4]==="A"&&$[te+5]==="T"&&$[te+6]==="A"&&$[te+7]==="["){for(te+=8;te<$.length;te++)if($[te]==="]"&&$[te+1]==="]"&&$[te+2]===">"){te+=2;break}}return te}const k='"',y="'";function C($,te){let U="",j="",G=!1;for(;te<$.length;te++){if($[te]===k||$[te]===y)j===""?j=$[te]:j!==$[te]||(j="");else if($[te]===">"&&j===""){G=!0;break}U+=$[te]}return j!==""?!1:{value:U,index:te,tagClosed:G}}const E=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function T($,te){const U=d.getAllMatches($,E),j={};for(let G=0;G<U.length;G++){if(U[G][1].length===0)return N("InvalidAttr","Attribute '"+U[G][2]+"' has no space in starting.",se(U[G]));if(U[G][3]!==void 0&&U[G][4]===void 0)return N("InvalidAttr","Attribute '"+U[G][2]+"' is without value.",se(U[G]));if(U[G][3]===void 0&&!te.allowBooleanAttributes)return N("InvalidAttr","boolean attribute '"+U[G][2]+"' is not allowed.",se(U[G]));const O=U[G][2];if(!z(O))return N("InvalidAttr","Attribute '"+O+"' is an invalid name.",se(U[G]));if(!j.hasOwnProperty(O))j[O]=1;else return N("InvalidAttr","Attribute '"+O+"' is repeated.",se(U[G]))}return!0}function M($,te){let U=/\d/;for($[te]==="x"&&(te++,U=/[\da-fA-F]/);te<$.length;te++){if($[te]===";")return te;if(!$[te].match(U))break}return-1}function R($,te){if(te++,$[te]===";")return-1;if($[te]==="#")return te++,M($,te);let U=0;for(;te<$.length;te++,U++)if(!($[te].match(/\w/)&&U<20)){if($[te]===";")break;return-1}return te}function N($,te,U){return{err:{code:$,msg:te,line:U.line||U,col:U.col}}}function z($){return d.isName($)}function V($){return d.isName($)}function Y($,te){const U=$.substring(0,te).split(/\r?\n/);return{line:U.length,col:U[U.length-1].length+1}}function se($){return $.startIndex+$[1].length}},{"./util":4}],6:[function(n,o,c){const d=n("./orderedJs2Xml"),h={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(y,C){return C},attributeValueProcessor:function(y,C){return C},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function a(y){this.options=Object.assign({},h,y),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=k),this.processTextOrObjNode=_,this.options.format?(this.indentate=S,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}a.prototype.build=function(y){return this.options.preserveOrder?d(y,this.options):(Array.isArray(y)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(y={[this.options.arrayNodeName]:y}),this.j2x(y,0).val)},a.prototype.j2x=function(y,C){let E="",T="";for(let M in y)if(Object.prototype.hasOwnProperty.call(y,M))if(typeof y[M]>"u")this.isAttribute(M)&&(T+="");else if(y[M]===null)this.isAttribute(M)?T+="":M[0]==="?"?T+=this.indentate(C)+"<"+M+"?"+this.tagEndChar:T+=this.indentate(C)+"<"+M+"/"+this.tagEndChar;else if(y[M]instanceof Date)T+=this.buildTextValNode(y[M],M,"",C);else if(typeof y[M]!="object"){const R=this.isAttribute(M);if(R)E+=this.buildAttrPairStr(R,""+y[M]);else if(M===this.options.textNodeName){let N=this.options.tagValueProcessor(M,""+y[M]);T+=this.replaceEntitiesValue(N)}else T+=this.buildTextValNode(y[M],M,"",C)}else if(Array.isArray(y[M])){const R=y[M].length;let N="",z="";for(let V=0;V<R;V++){const Y=y[M][V];if(!(typeof Y>"u"))if(Y===null)M[0]==="?"?T+=this.indentate(C)+"<"+M+"?"+this.tagEndChar:T+=this.indentate(C)+"<"+M+"/"+this.tagEndChar;else if(typeof Y=="object")if(this.options.oneListGroup){const se=this.j2x(Y,C+1);N+=se.val,this.options.attributesGroupName&&Y.hasOwnProperty(this.options.attributesGroupName)&&(z+=se.attrStr)}else N+=this.processTextOrObjNode(Y,M,C);else if(this.options.oneListGroup){let se=this.options.tagValueProcessor(M,Y);se=this.replaceEntitiesValue(se),N+=se}else N+=this.buildTextValNode(Y,M,"",C)}this.options.oneListGroup&&(N=this.buildObjectNode(N,M,z,C)),T+=N}else if(this.options.attributesGroupName&&M===this.options.attributesGroupName){const R=Object.keys(y[M]),N=R.length;for(let z=0;z<N;z++)E+=this.buildAttrPairStr(R[z],""+y[M][R[z]])}else T+=this.processTextOrObjNode(y[M],M,C);return{attrStr:E,val:T}},a.prototype.buildAttrPairStr=function(y,C){return C=this.options.attributeValueProcessor(y,""+C),C=this.replaceEntitiesValue(C),this.options.suppressBooleanAttributes&&C==="true"?" "+y:" "+y+'="'+C+'"'};function _(y,C,E){const T=this.j2x(y,E+1);return y[this.options.textNodeName]!==void 0&&Object.keys(y).length===1?this.buildTextValNode(y[this.options.textNodeName],C,T.attrStr,E):this.buildObjectNode(T.val,C,T.attrStr,E)}a.prototype.buildObjectNode=function(y,C,E,T){if(y==="")return C[0]==="?"?this.indentate(T)+"<"+C+E+"?"+this.tagEndChar:this.indentate(T)+"<"+C+E+this.closeTag(C)+this.tagEndChar;{let M="</"+C+this.tagEndChar,R="";return C[0]==="?"&&(R="?",M=""),(E||E==="")&&y.indexOf("<")===-1?this.indentate(T)+"<"+C+E+R+">"+y+M:this.options.commentPropName!==!1&&C===this.options.commentPropName&&R.length===0?this.indentate(T)+`<!--${y}-->`+this.newLine:this.indentate(T)+"<"+C+E+R+this.tagEndChar+y+this.indentate(T)+M}},a.prototype.closeTag=function(y){let C="";return this.options.unpairedTags.indexOf(y)!==-1?this.options.suppressUnpairedNode||(C="/"):this.options.suppressEmptyNode?C="/":C=`></${y}`,C},a.prototype.buildTextValNode=function(y,C,E,T){if(this.options.cdataPropName!==!1&&C===this.options.cdataPropName)return this.indentate(T)+`<![CDATA[${y}]]>`+this.newLine;if(this.options.commentPropName!==!1&&C===this.options.commentPropName)return this.indentate(T)+`<!--${y}-->`+this.newLine;if(C[0]==="?")return this.indentate(T)+"<"+C+E+"?"+this.tagEndChar;{let M=this.options.tagValueProcessor(C,y);return M=this.replaceEntitiesValue(M),M===""?this.indentate(T)+"<"+C+E+this.closeTag(C)+this.tagEndChar:this.indentate(T)+"<"+C+E+">"+M+"</"+C+this.tagEndChar}},a.prototype.replaceEntitiesValue=function(y){if(y&&y.length>0&&this.options.processEntities)for(let C=0;C<this.options.entities.length;C++){const E=this.options.entities[C];y=y.replace(E.regex,E.val)}return y};function S(y){return this.options.indentBy.repeat(y)}function k(y){return y.startsWith(this.options.attributeNamePrefix)&&y!==this.options.textNodeName?y.substr(this.attrPrefixLen):!1}o.exports=a},{"./orderedJs2Xml":7}],7:[function(n,o,c){const d=`
`;function h(C,E){let T="";return E.format&&E.indentBy.length>0&&(T=d),a(C,E,"",T)}function a(C,E,T,M){let R="",N=!1;for(let z=0;z<C.length;z++){const V=C[z],Y=_(V);if(Y===void 0)continue;let se="";if(T.length===0?se=Y:se=`${T}.${Y}`,Y===E.textNodeName){let G=V[Y];k(se,E)||(G=E.tagValueProcessor(Y,G),G=y(G,E)),N&&(R+=M),R+=G,N=!1;continue}else if(Y===E.cdataPropName){N&&(R+=M),R+=`<![CDATA[${V[Y][0][E.textNodeName]}]]>`,N=!1;continue}else if(Y===E.commentPropName){R+=M+`<!--${V[Y][0][E.textNodeName]}-->`,N=!0;continue}else if(Y[0]==="?"){const G=S(V[":@"],E),O=Y==="?xml"?"":M;let W=V[Y][0][E.textNodeName];W=W.length!==0?" "+W:"",R+=O+`<${Y}${W}${G}?>`,N=!0;continue}let $=M;$!==""&&($+=E.indentBy);const te=S(V[":@"],E),U=M+`<${Y}${te}`,j=a(V[Y],E,se,$);E.unpairedTags.indexOf(Y)!==-1?E.suppressUnpairedNode?R+=U+">":R+=U+"/>":(!j||j.length===0)&&E.suppressEmptyNode?R+=U+"/>":j&&j.endsWith(">")?R+=U+`>${j}${M}</${Y}>`:(R+=U+">",j&&M!==""&&(j.includes("/>")||j.includes("</"))?R+=M+E.indentBy+j+M:R+=j,R+=`</${Y}>`),N=!0}return R}function _(C){const E=Object.keys(C);for(let T=0;T<E.length;T++){const M=E[T];if(C.hasOwnProperty(M)&&M!==":@")return M}}function S(C,E){let T="";if(C&&!E.ignoreAttributes)for(let M in C){if(!C.hasOwnProperty(M))continue;let R=E.attributeValueProcessor(M,C[M]);R=y(R,E),R===!0&&E.suppressBooleanAttributes?T+=` ${M.substr(E.attributeNamePrefix.length)}`:T+=` ${M.substr(E.attributeNamePrefix.length)}="${R}"`}return T}function k(C,E){C=C.substr(0,C.length-E.textNodeName.length-1);let T=C.substr(C.lastIndexOf(".")+1);for(let M in E.stopNodes)if(E.stopNodes[M]===C||E.stopNodes[M]==="*."+T)return!0;return!1}function y(C,E){if(C&&C.length>0&&E.processEntities)for(let T=0;T<E.entities.length;T++){const M=E.entities[T];C=C.replace(M.regex,M.val)}return C}o.exports=h},{}],8:[function(n,o,c){const d=n("../util");function h(T,M){const R={};if(T[M+3]==="O"&&T[M+4]==="C"&&T[M+5]==="T"&&T[M+6]==="Y"&&T[M+7]==="P"&&T[M+8]==="E"){M=M+9;let N=1,z=!1,V=!1,Y="";for(;M<T.length;M++)if(T[M]==="<"&&!V){if(z&&S(T,M))M+=7,[entityName,val,M]=a(T,M+1),val.indexOf("&")===-1&&(R[E(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(z&&k(T,M))M+=8;else if(z&&y(T,M))M+=8;else if(z&&C(T,M))M+=9;else if(_)V=!0;else throw new Error("Invalid DOCTYPE");N++,Y=""}else if(T[M]===">"){if(V?T[M-1]==="-"&&T[M-2]==="-"&&(V=!1,N--):N--,N===0)break}else T[M]==="["?z=!0:Y+=T[M];if(N!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:R,i:M}}function a(T,M){let R="";for(;M<T.length&&T[M]!=="'"&&T[M]!=='"';M++)R+=T[M];if(R=R.trim(),R.indexOf(" ")!==-1)throw new Error("External entites are not supported");const N=T[M++];let z="";for(;M<T.length&&T[M]!==N;M++)z+=T[M];return[R,z,M]}function _(T,M){return T[M+1]==="!"&&T[M+2]==="-"&&T[M+3]==="-"}function S(T,M){return T[M+1]==="!"&&T[M+2]==="E"&&T[M+3]==="N"&&T[M+4]==="T"&&T[M+5]==="I"&&T[M+6]==="T"&&T[M+7]==="Y"}function k(T,M){return T[M+1]==="!"&&T[M+2]==="E"&&T[M+3]==="L"&&T[M+4]==="E"&&T[M+5]==="M"&&T[M+6]==="E"&&T[M+7]==="N"&&T[M+8]==="T"}function y(T,M){return T[M+1]==="!"&&T[M+2]==="A"&&T[M+3]==="T"&&T[M+4]==="T"&&T[M+5]==="L"&&T[M+6]==="I"&&T[M+7]==="S"&&T[M+8]==="T"}function C(T,M){return T[M+1]==="!"&&T[M+2]==="N"&&T[M+3]==="O"&&T[M+4]==="T"&&T[M+5]==="A"&&T[M+6]==="T"&&T[M+7]==="I"&&T[M+8]==="O"&&T[M+9]==="N"}function E(T){if(d.isName(T))return T;throw new Error(`Invalid entity name ${T}`)}o.exports=h},{"../util":4}],9:[function(n,o,c){const d={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(a,_){return _},attributeValueProcessor:function(a,_){return _},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(a,_,S){return a}},h=function(a){return Object.assign({},d,a)};c.buildOptions=h,c.defaultOptions=d},{}],10:[function(n,o,c){const d=n("../util"),h=n("./xmlNode"),a=n("./DocTypeReader"),_=n("strnum");class S{constructor(G){this.options=G,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(O,W)=>String.fromCharCode(Number.parseInt(W,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(O,W)=>String.fromCharCode(Number.parseInt(W,16))}},this.addExternalEntities=k,this.parseXml=M,this.parseTextData=y,this.resolveNameSpace=C,this.buildAttributesMap=T,this.isItStopNode=V,this.replaceEntitiesValue=N,this.readStopNodeData=te,this.saveTextToParentTag=z,this.addChild=R}}function k(j){const G=Object.keys(j);for(let O=0;O<G.length;O++){const W=G[O];this.lastEntities[W]={regex:new RegExp("&"+W+";","g"),val:j[W]}}}function y(j,G,O,W,le,de,ve){if(j!==void 0&&(this.options.trimValues&&!W&&(j=j.trim()),j.length>0)){ve||(j=this.replaceEntitiesValue(j));const pe=this.options.tagValueProcessor(G,j,O,le,de);return pe==null?j:typeof pe!=typeof j||pe!==j?pe:this.options.trimValues?U(j,this.options.parseTagValue,this.options.numberParseOptions):j.trim()===j?U(j,this.options.parseTagValue,this.options.numberParseOptions):j}}function C(j){if(this.options.removeNSPrefix){const G=j.split(":"),O=j.charAt(0)==="/"?"/":"";if(G[0]==="xmlns")return"";G.length===2&&(j=O+G[1])}return j}const E=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function T(j,G,O){if(!this.options.ignoreAttributes&&typeof j=="string"){const W=d.getAllMatches(j,E),le=W.length,de={};for(let ve=0;ve<le;ve++){const pe=this.resolveNameSpace(W[ve][1]);let we=W[ve][4],Te=this.options.attributeNamePrefix+pe;if(pe.length)if(this.options.transformAttributeName&&(Te=this.options.transformAttributeName(Te)),Te==="__proto__"&&(Te="#__proto__"),we!==void 0){this.options.trimValues&&(we=we.trim()),we=this.replaceEntitiesValue(we);const Ae=this.options.attributeValueProcessor(pe,we,G);Ae==null?de[Te]=we:typeof Ae!=typeof we||Ae!==we?de[Te]=Ae:de[Te]=U(we,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(de[Te]=!0)}if(!Object.keys(de).length)return;if(this.options.attributesGroupName){const ve={};return ve[this.options.attributesGroupName]=de,ve}return de}}const M=function(j){j=j.replace(/\r\n?/g,`
`);const G=new h("!xml");let O=G,W="",le="";for(let de=0;de<j.length;de++)if(j[de]==="<")if(j[de+1]==="/"){const pe=se(j,">",de,"Closing Tag is not closed.");let we=j.substring(de+2,pe).trim();if(this.options.removeNSPrefix){const ct=we.indexOf(":");ct!==-1&&(we=we.substr(ct+1))}this.options.transformTagName&&(we=this.options.transformTagName(we)),O&&(W=this.saveTextToParentTag(W,O,le));const Te=le.substring(le.lastIndexOf(".")+1);if(we&&this.options.unpairedTags.indexOf(we)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${we}>`);let Ae=0;Te&&this.options.unpairedTags.indexOf(Te)!==-1?(Ae=le.lastIndexOf(".",le.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Ae=le.lastIndexOf("."),le=le.substring(0,Ae),O=this.tagsNodeStack.pop(),W="",de=pe}else if(j[de+1]==="?"){let pe=$(j,de,!1,"?>");if(!pe)throw new Error("Pi Tag is not closed.");if(W=this.saveTextToParentTag(W,O,le),!(this.options.ignoreDeclaration&&pe.tagName==="?xml"||this.options.ignorePiTags)){const we=new h(pe.tagName);we.add(this.options.textNodeName,""),pe.tagName!==pe.tagExp&&pe.attrExpPresent&&(we[":@"]=this.buildAttributesMap(pe.tagExp,le,pe.tagName)),this.addChild(O,we,le)}de=pe.closeIndex+1}else if(j.substr(de+1,3)==="!--"){const pe=se(j,"-->",de+4,"Comment is not closed.");if(this.options.commentPropName){const we=j.substring(de+4,pe-2);W=this.saveTextToParentTag(W,O,le),O.add(this.options.commentPropName,[{[this.options.textNodeName]:we}])}de=pe}else if(j.substr(de+1,2)==="!D"){const pe=a(j,de);this.docTypeEntities=pe.entities,de=pe.i}else if(j.substr(de+1,2)==="!["){const pe=se(j,"]]>",de,"CDATA is not closed.")-2,we=j.substring(de+9,pe);W=this.saveTextToParentTag(W,O,le);let Te=this.parseTextData(we,O.tagname,le,!0,!1,!0,!0);Te==null&&(Te=""),this.options.cdataPropName?O.add(this.options.cdataPropName,[{[this.options.textNodeName]:we}]):O.add(this.options.textNodeName,Te),de=pe+2}else{let pe=$(j,de,this.options.removeNSPrefix),we=pe.tagName;const Te=pe.rawTagName;let Ae=pe.tagExp,ct=pe.attrExpPresent,We=pe.closeIndex;this.options.transformTagName&&(we=this.options.transformTagName(we)),O&&W&&O.tagname!=="!xml"&&(W=this.saveTextToParentTag(W,O,le,!1));const pt=O;if(pt&&this.options.unpairedTags.indexOf(pt.tagname)!==-1&&(O=this.tagsNodeStack.pop(),le=le.substring(0,le.lastIndexOf("."))),we!==G.tagname&&(le+=le?"."+we:we),this.isItStopNode(this.options.stopNodes,le,we)){let kt="";if(Ae.length>0&&Ae.lastIndexOf("/")===Ae.length-1)we[we.length-1]==="/"?(we=we.substr(0,we.length-1),le=le.substr(0,le.length-1),Ae=we):Ae=Ae.substr(0,Ae.length-1),de=pe.closeIndex;else if(this.options.unpairedTags.indexOf(we)!==-1)de=pe.closeIndex;else{const wt=this.readStopNodeData(j,Te,We+1);if(!wt)throw new Error(`Unexpected end of ${Te}`);de=wt.i,kt=wt.tagContent}const Je=new h(we);we!==Ae&&ct&&(Je[":@"]=this.buildAttributesMap(Ae,le,we)),kt&&(kt=this.parseTextData(kt,we,le,!0,ct,!0,!0)),le=le.substr(0,le.lastIndexOf(".")),Je.add(this.options.textNodeName,kt),this.addChild(O,Je,le)}else{if(Ae.length>0&&Ae.lastIndexOf("/")===Ae.length-1){we[we.length-1]==="/"?(we=we.substr(0,we.length-1),le=le.substr(0,le.length-1),Ae=we):Ae=Ae.substr(0,Ae.length-1),this.options.transformTagName&&(we=this.options.transformTagName(we));const kt=new h(we);we!==Ae&&ct&&(kt[":@"]=this.buildAttributesMap(Ae,le,we)),this.addChild(O,kt,le),le=le.substr(0,le.lastIndexOf("."))}else{const kt=new h(we);this.tagsNodeStack.push(O),we!==Ae&&ct&&(kt[":@"]=this.buildAttributesMap(Ae,le,we)),this.addChild(O,kt,le),O=kt}W="",de=We}}else W+=j[de];return G.child};function R(j,G,O){const W=this.options.updateTag(G.tagname,O,G[":@"]);W===!1||(typeof W=="string"&&(G.tagname=W),j.addChild(G))}const N=function(j){if(this.options.processEntities){for(let G in this.docTypeEntities){const O=this.docTypeEntities[G];j=j.replace(O.regx,O.val)}for(let G in this.lastEntities){const O=this.lastEntities[G];j=j.replace(O.regex,O.val)}if(this.options.htmlEntities)for(let G in this.htmlEntities){const O=this.htmlEntities[G];j=j.replace(O.regex,O.val)}j=j.replace(this.ampEntity.regex,this.ampEntity.val)}return j};function z(j,G,O,W){return j&&(W===void 0&&(W=Object.keys(G.child).length===0),j=this.parseTextData(j,G.tagname,O,!1,G[":@"]?Object.keys(G[":@"]).length!==0:!1,W),j!==void 0&&j!==""&&G.add(this.options.textNodeName,j),j=""),j}function V(j,G,O){const W="*."+O;for(const le in j){const de=j[le];if(W===de||G===de)return!0}return!1}function Y(j,G,O=">"){let W,le="";for(let de=G;de<j.length;de++){let ve=j[de];if(W)ve===W&&(W="");else if(ve==='"'||ve==="'")W=ve;else if(ve===O[0])if(O[1]){if(j[de+1]===O[1])return{data:le,index:de}}else return{data:le,index:de};else ve==="	"&&(ve=" ");le+=ve}}function se(j,G,O,W){const le=j.indexOf(G,O);if(le===-1)throw new Error(W);return le+G.length-1}function $(j,G,O,W=">"){const le=Y(j,G+1,W);if(!le)return;let de=le.data;const ve=le.index,pe=de.search(/\s/);let we=de,Te=!0;pe!==-1&&(we=de.substring(0,pe),de=de.substring(pe+1).trimStart());const Ae=we;if(O){const ct=we.indexOf(":");ct!==-1&&(we=we.substr(ct+1),Te=we!==le.data.substr(ct+1))}return{tagName:we,tagExp:de,closeIndex:ve,attrExpPresent:Te,rawTagName:Ae}}function te(j,G,O){const W=O;let le=1;for(;O<j.length;O++)if(j[O]==="<")if(j[O+1]==="/"){const de=se(j,">",O,`${G} is not closed`);if(j.substring(O+2,de).trim()===G&&(le--,le===0))return{tagContent:j.substring(W,O),i:de};O=de}else if(j[O+1]==="?")O=se(j,"?>",O+1,"StopNode is not closed.");else if(j.substr(O+1,3)==="!--")O=se(j,"-->",O+3,"StopNode is not closed.");else if(j.substr(O+1,2)==="![")O=se(j,"]]>",O,"StopNode is not closed.")-2;else{const de=$(j,O,">");de&&((de&&de.tagName)===G&&de.tagExp[de.tagExp.length-1]!=="/"&&le++,O=de.closeIndex)}}function U(j,G,O){if(G&&typeof j=="string"){const W=j.trim();return W==="true"?!0:W==="false"?!1:_(j,O)}else return d.isExist(j)?j:""}o.exports=S},{"../util":4,"./DocTypeReader":8,"./xmlNode":13,strnum:15}],11:[function(n,o,c){const{buildOptions:d}=n("./OptionsBuilder"),h=n("./OrderedObjParser"),{prettify:a}=n("./node2json"),_=n("../validator");class S{constructor(y){this.externalEntities={},this.options=d(y)}parse(y,C){if(typeof y!="string")if(y.toString)y=y.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(C){C===!0&&(C={});const M=_.validate(y,C);if(M!==!0)throw Error(`${M.err.msg}:${M.err.line}:${M.err.col}`)}const E=new h(this.options);E.addExternalEntities(this.externalEntities);const T=E.parseXml(y);return this.options.preserveOrder||T===void 0?T:a(T,this.options)}addEntity(y,C){if(C.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(y.indexOf("&")!==-1||y.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(C==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[y]=C}}o.exports=S},{"../validator":5,"./OptionsBuilder":9,"./OrderedObjParser":10,"./node2json":12}],12:[function(n,o,c){function d(k,y){return h(k,y)}function h(k,y,C){let E;const T={};for(let M=0;M<k.length;M++){const R=k[M],N=a(R);let z="";if(C===void 0?z=N:z=C+"."+N,N===y.textNodeName)E===void 0?E=R[N]:E+=""+R[N];else{if(N===void 0)continue;if(R[N]){let V=h(R[N],y,z);const Y=S(V,y);R[":@"]?_(V,R[":@"],z,y):Object.keys(V).length===1&&V[y.textNodeName]!==void 0&&!y.alwaysCreateTextNode?V=V[y.textNodeName]:Object.keys(V).length===0&&(y.alwaysCreateTextNode?V[y.textNodeName]="":V=""),T[N]!==void 0&&T.hasOwnProperty(N)?(Array.isArray(T[N])||(T[N]=[T[N]]),T[N].push(V)):y.isArray(N,z,Y)?T[N]=[V]:T[N]=V}}}return typeof E=="string"?E.length>0&&(T[y.textNodeName]=E):E!==void 0&&(T[y.textNodeName]=E),T}function a(k){const y=Object.keys(k);for(let C=0;C<y.length;C++){const E=y[C];if(E!==":@")return E}}function _(k,y,C,E){if(y){const T=Object.keys(y),M=T.length;for(let R=0;R<M;R++){const N=T[R];E.isArray(N,C+"."+N,!0,!0)?k[N]=[y[N]]:k[N]=y[N]}}}function S(k,y){const{textNodeName:C}=y,E=Object.keys(k).length;return!!(E===0||E===1&&(k[C]||typeof k[C]=="boolean"||k[C]===0))}c.prettify=d},{}],13:[function(n,o,c){class d{constructor(a){this.tagname=a,this.child=[],this[":@"]={}}add(a,_){a==="__proto__"&&(a="#__proto__"),this.child.push({[a]:_})}addChild(a){a.tagname==="__proto__"&&(a.tagname="#__proto__"),a[":@"]&&Object.keys(a[":@"]).length>0?this.child.push({[a.tagname]:a.child,":@":a[":@"]}):this.child.push({[a.tagname]:a.child})}}o.exports=d},{}],14:[function(n,o,c){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */c.read=function(d,h,a,_,S){var k,y,C=S*8-_-1,E=(1<<C)-1,T=E>>1,M=-7,R=a?S-1:0,N=a?-1:1,z=d[h+R];for(R+=N,k=z&(1<<-M)-1,z>>=-M,M+=C;M>0;k=k*256+d[h+R],R+=N,M-=8);for(y=k&(1<<-M)-1,k>>=-M,M+=_;M>0;y=y*256+d[h+R],R+=N,M-=8);if(k===0)k=1-T;else{if(k===E)return y?NaN:(z?-1:1)*(1/0);y=y+Math.pow(2,_),k=k-T}return(z?-1:1)*y*Math.pow(2,k-_)},c.write=function(d,h,a,_,S,k){var y,C,E,T=k*8-S-1,M=(1<<T)-1,R=M>>1,N=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=_?0:k-1,V=_?1:-1,Y=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(C=isNaN(h)?1:0,y=M):(y=Math.floor(Math.log(h)/Math.LN2),h*(E=Math.pow(2,-y))<1&&(y--,E*=2),y+R>=1?h+=N/E:h+=N*Math.pow(2,1-R),h*E>=2&&(y++,E/=2),y+R>=M?(C=0,y=M):y+R>=1?(C=(h*E-1)*Math.pow(2,S),y=y+R):(C=h*Math.pow(2,R-1)*Math.pow(2,S),y=0));S>=8;d[a+z]=C&255,z+=V,C/=256,S-=8);for(y=y<<S|C,T+=S;T>0;d[a+z]=y&255,z+=V,y/=256,T-=8);d[a+z-V]|=Y*128}},{}],15:[function(n,o,c){const d=/^[-+]?0x[a-fA-F0-9]+$/,h=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const a={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function _(k,y={}){if(y=Object.assign({},a,y),!k||typeof k!="string")return k;let C=k.trim();if(y.skipLike!==void 0&&y.skipLike.test(C))return k;if(y.hex&&d.test(C))return Number.parseInt(C,16);{const E=h.exec(C);if(E){const T=E[1],M=E[2];let R=S(E[3]);const N=E[4]||E[6];if(!y.leadingZeros&&M.length>0&&T&&C[2]!==".")return k;if(!y.leadingZeros&&M.length>0&&!T&&C[1]!==".")return k;{const z=Number(C),V=""+z;return V.search(/[eE]/)!==-1||N?y.eNotation?z:k:C.indexOf(".")!==-1?V==="0"&&R===""||V===R||T&&V==="-"+R?z:k:M?R===V||T+R===V?z:k:C===V||C===T+V?z:k}}else return k}}function S(k){return k&&k.indexOf(".")!==-1&&(k=k.replace(/0+$/,""),k==="."?k="0":k[0]==="."?k="0"+k:k[k.length-1]==="."&&(k=k.substr(0,k.length-1))),k}o.exports=_},{}],16:[function(n,o,c){o.exports={name:"osm-api",version:"3.3.0",contributors:["Kyle Hensel (https://github.com/k-yle)"],description:" Javascript/Typescript wrapper around the OpenStreetMap API",main:"dist",unpkg:"dist/index.min.js",types:"dist/src/index.d.ts",license:"MIT",files:["dist"],keywords:["osm","openstreetmap","openstreetmap api"],repository:"https://github.com/osmlab/osm-api-js",scripts:{build:"rm -rf dist && tsc --emitDeclarationOnly && rm -rf dist/__tests__ && browserify -s OSM src/index.ts -p tsify > dist/index.js && uglifyjs dist/index.js > dist/index.min.js",lint:"eslint .",test:"vitest",trypublish:"npm publish --provenance || true"},engines:{node:">=18"},dependencies:{"@types/geojson":"^7946.0.13","fast-xml-parser":"^4.4.1"},devDependencies:{"@types/node":"^22.5.5",browserify:"^17.0.0",eslint:"^9.10.0","eslint-config-kyle":"^25.0.0-beta3",tsify:"^5.0.4",typescript:"^5.6.2","uglify-js":"^3.19.3",vitest:"^2.1.1"},prettier:{trailingComma:"es5"}}},{}],17:[function(n,o,c){(function(d){(function(){var h=this&&this.__awaiter||function(C,E,T,M){function R(N){return N instanceof T?N:new T(function(z){z(N)})}return new(T||(T=Promise))(function(N,z){function V($){try{se(M.next($))}catch(te){z(te)}}function Y($){try{se(M.throw($))}catch(te){z(te)}}function se($){$.done?N($.value):R($.value).then(V,Y)}se((M=M.apply(C,E||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.osmFetch=y;const a=n("../auth"),_=n("../config"),S=n("./_xml"),k=C=>typeof btoa>"u"?d.from(C,"binary").toString("base64"):btoa(C);function y(C,E,T){return h(this,void 0,void 0,function*(){const{apiUrl:M,authHeader:R,basicAuth:N,userAgent:z}=(0,_.getConfig)(),V=N&&`Basic ${k(`${N.username}:${N.password}`)}`,Y=(0,a.getAuthToken)()&&`Bearer ${(0,a.getAuthToken)()}`;let se=new URLSearchParams(E).toString();se&&(se=`?${se}`);const $=yield fetch(`${M}/api${C}${se}`,Object.assign(Object.assign({},T),{headers:Object.assign({Authorization:R||V||Y||"","User-Agent":z},T==null?void 0:T.headers)})),te=$.headers.get("Content-Type");if(te!=null&&te.startsWith("application/xml")){const j=yield $.text();return yield S.xmlParser.parse(j)}if(te!=null&&te.startsWith("application/json"))return $.json();if($.ok)return yield $.text();const U=new Error(`OSM API: ${yield $.text()}`);throw U.cause=$.status,U})}}).call(this)}).call(this,n("buffer").Buffer)},{"../auth":58,"../config":60,"./_xml":18,buffer:2}],18:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.xmlParser=void 0;const d=n("fast-xml-parser");c.xmlParser=new d.XMLParser({ignoreAttributes:!1,attributesGroupName:"$",attributeNamePrefix:"",isArray:h=>h!=="$"})},{"fast-xml-parser":3}],19:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.createChangesetMetaXml=a,c.createOsmChangeXml=S;const d=n("fast-xml-parser"),h=new d.XMLBuilder({ignoreAttributes:!1,attributeNamePrefix:"$",format:!0,suppressEmptyNode:!0,suppressBooleanAttributes:!1});function a(k){return h.build({osm:{changeset:{tag:Object.entries(k).map(([y,C])=>({$k:y,$v:C}))}}})}const _=(k,y,C)=>{const E=["node","way","relation"];return C==="delete"&&E.reverse(),y.reduce((T,M)=>{const R={$id:M.id,$version:C==="create"?0:M.version,$changeset:k,tag:Object.entries(M.tags||{}).map(([N,z])=>({$k:N,$v:z}))};switch(M.type){case"node":{const N=Object.assign(Object.assign({},R),{$lat:M.lat,$lon:M.lon});return Object.assign(Object.assign({},T),{node:[...T.node,N]})}case"way":{if(!M.nodes)throw new Error("Way has no nodes");const N=Object.assign(Object.assign({},R),{nd:M.nodes.map(z=>({$ref:z}))});return Object.assign(Object.assign({},T),{way:[...T.way,N]})}case"relation":{if(!M.members)throw new Error("Relation has no members");const N=Object.assign(Object.assign({},R),{member:M.members.map(z=>({$type:z.type,$ref:z.ref,$role:z.role}))});return Object.assign(Object.assign({},T),{relation:[...T.relation,N]})}default:return T}},Object.fromEntries(E.map(T=>[T,[]])))};function S(k,y,C){return h.build({osmChange:{$version:"0.6",$generator:"osm-api-js",changeset:C?{tag:Object.entries(C).map(([E,T])=>({$k:E,$v:T}))}:void 0,create:[_(k,y.create,"create")],modify:[_(k,y.modify,"modify")],delete:[Object.assign({"$if-unused":!0},_(k,y.delete,"delete"))]}})}},{"fast-xml-parser":3}],20:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.parseOsmChangeJson=S,c.parseOsmChangeXml=k;const d=n("../_xml");function h(y){if(y!=null&&y.tag)return Object.fromEntries(y.tag.map(C=>[C.$.k,C.$.v]))}function a(y){return{changeset:+y.$.changeset,id:+y.$.id,timestamp:y.$.timestamp,uid:+y.$.uid,user:y.$.user,version:+y.$.version,tags:h(y)}}const _=y=>{const C=[];if(y.node){const E=y.node.map(T=>Object.assign(Object.assign({type:"node"},a(T)),{lat:+T.$.lat,lon:+T.$.lon}));C.push(...E)}if(y.way){const E=y.way.map(T=>{var M;return Object.assign(Object.assign({type:"way"},a(T)),{nodes:((M=T.nd)===null||M===void 0?void 0:M.map(R=>+R.$.ref))||[]})});C.push(...E)}if(y.relation){const E=y.relation.map(T=>{var M;return Object.assign(Object.assign({type:"relation"},a(T)),{members:((M=T.member)===null||M===void 0?void 0:M.map(R=>({ref:+R.$.ref,role:R.$.role,type:R.$.type})))||[]})});C.push(...E)}return C};function S(y){var C,E,T,M;const R=h((C=y.osmChange[0].changeset)===null||C===void 0?void 0:C[0]),N={create:((E=y.osmChange[0].create)===null||E===void 0?void 0:E.flatMap(_))||[],modify:((T=y.osmChange[0].modify)===null||T===void 0?void 0:T.flatMap(_))||[],delete:((M=y.osmChange[0].delete)===null||M===void 0?void 0:M.flatMap(_))||[]};return R&&(N.changeset=R),N}function k(y){const C=d.xmlParser.parse(y);return S(C)}},{"../_xml":18}],21:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.getOsmChangeSize=_,c.chunkOsmChange=S;const d=["create","modify","delete"],h=["create-node","create-way","create-relation","delete-relation","delete-way","delete-node","modify-node","modify-way","modify-relation"],a=()=>({create:[],modify:[],delete:[]});function _(k){return k.create.length+k.modify.length+k.delete.length}function S(k,y){var C;const E=(C=y==null?void 0:y.api.changesets.maximum_elements)!==null&&C!==void 0?C:S.DEFAULT_LIMIT;if(_(k)<=E)return[k];const T={};for(const z of d)for(const V of k[z]){const Y=`${z}-${V.type}`;T[Y]||(T[Y]=[]),T[Y].push(V)}const M=[a()];function R(){var z;for(const V of h){const Y=V.split("-")[0],se=(z=T[V])===null||z===void 0?void 0:z.pop();if(se)return{action:Y,feature:se}}}let N;for(;N=R();){const z=M[0];z[N.action].push(N.feature),_(z)>=E&&M.unshift(a())}return M.reverse()}S.DEFAULT_LIMIT=1e4},{}],22:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(M){M(T)})}return new(y||(y=Promise))(function(T,M){function R(V){try{z(C.next(V))}catch(Y){M(Y)}}function N(V){try{z(C.throw(V))}catch(Y){M(Y)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.createChangesetComment=_;const h=n("../_osmFetch"),a=n("./getChangesets");function _(S,k,y){return d(this,void 0,void 0,function*(){const C=yield(0,h.osmFetch)(`/0.6/changeset/${S}/comment.json`,void 0,Object.assign(Object.assign({},y),{method:"POST",body:`text=${encodeURIComponent(k)}`,headers:Object.assign(Object.assign({},y==null?void 0:y.headers),{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"})}));return(0,a.mapRawChangeset)(C.changeset)})}},{"../_osmFetch":17,"./getChangesets":24}],23:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(M){M(T)})}return new(y||(y=Promise))(function(T,M){function R(V){try{z(C.next(V))}catch(Y){M(Y)}}function N(V){try{z(C.throw(V))}catch(Y){M(Y)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getChangesetDiff=_;const h=n("../_osmFetch"),a=n("./_parseOsmChangeXml");function _(S,k){return d(this,void 0,void 0,function*(){const y=yield(0,h.osmFetch)(`/0.6/changeset/${S}/download`,void 0,k);return(0,a.parseOsmChangeJson)(y)})}},{"../_osmFetch":17,"./_parseOsmChangeXml":20}],24:[function(n,o,c){var d=this&&this.__awaiter||function(y,C,E,T){function M(R){return R instanceof E?R:new E(function(N){N(R)})}return new(E||(E=Promise))(function(R,N){function z(se){try{Y(T.next(se))}catch($){N($)}}function V(se){try{Y(T.throw(se))}catch($){N($)}}function Y(se){se.done?R(se.value):M(se.value).then(z,V)}Y((T=T.apply(y,C||[])).next())})},h=this&&this.__rest||function(y,C){var E={};for(var T in y)Object.prototype.hasOwnProperty.call(y,T)&&C.indexOf(T)<0&&(E[T]=y[T]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var M=0,T=Object.getOwnPropertySymbols(y);M<T.length;M++)C.indexOf(T[M])<0&&Object.prototype.propertyIsEnumerable.call(y,T[M])&&(E[T[M]]=y[T[M]]);return E};Object.defineProperty(c,"__esModule",{value:!0}),c.mapRawChangeset=void 0,c.listChangesets=S,c.getChangeset=k;const a=n("../_osmFetch"),_=y=>{var{comments:C}=y,E=h(y,["comments"]);return Object.assign(Object.assign({},E),{created_at:new Date(E.created_at),closed_at:E.closed_at?new Date(E.closed_at):void 0,discussion:C==null?void 0:C.map(T=>Object.assign(Object.assign({},T),{date:new Date(T.date),uid:`${T.uid}`}))})};c.mapRawChangeset=_;function S(y,C){return d(this,void 0,void 0,function*(){const{only:E}=y,T=h(y,["only"]);return(yield(0,a.osmFetch)("/0.6/changesets.json",Object.assign(Object.assign({},E&&{[E]:!0}),T),C)).changesets.map(c.mapRawChangeset)})}function k(y){return d(this,arguments,void 0,function*(C,E=!0,T){const M=yield(0,a.osmFetch)(`/0.6/changeset/${C}.json`,E?{include_discussion:1}:{},T);return(0,c.mapRawChangeset)(M.changeset)})}},{"../_osmFetch":17}],25:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(S,k,y,C){C===void 0&&(C=y);var E=Object.getOwnPropertyDescriptor(k,y);(!E||("get"in E?!k.__esModule:E.writable||E.configurable))&&(E={enumerable:!0,get:function(){return k[y]}}),Object.defineProperty(S,C,E)}:function(S,k,y,C){C===void 0&&(C=y),S[C]=k[y]}),h=this&&this.__exportStar||function(S,k){for(var y in S)y!=="default"&&!Object.prototype.hasOwnProperty.call(k,y)&&d(k,S,y)};Object.defineProperty(c,"__esModule",{value:!0}),c.createOsmChangeXml=c.parseOsmChangeXml=void 0,h(n("./chunkOsmChange"),c),h(n("./createChangesetComment"),c),h(n("./getChangesetDiff"),c),h(n("./getChangesets"),c),h(n("./subscription"),c),h(n("./uploadChangeset"),c);var a=n("./_parseOsmChangeXml");Object.defineProperty(c,"parseOsmChangeXml",{enumerable:!0,get:function(){return a.parseOsmChangeXml}});var _=n("./_createOsmChangeXml");Object.defineProperty(c,"createOsmChangeXml",{enumerable:!0,get:function(){return _.createOsmChangeXml}})},{"./_createOsmChangeXml":19,"./_parseOsmChangeXml":20,"./chunkOsmChange":21,"./createChangesetComment":22,"./getChangesetDiff":23,"./getChangesets":24,"./subscription":26,"./uploadChangeset":27}],26:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(M){M(T)})}return new(y||(y=Promise))(function(T,M){function R(V){try{z(C.next(V))}catch(Y){M(Y)}}function N(V){try{z(C.throw(V))}catch(Y){M(Y)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.subscribeToChangeset=a,c.unsubscribeFromChangeset=_;const h=n("../_osmFetch");function a(S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/changeset/${S}/subscribe`,{},Object.assign(Object.assign({},k),{method:"POST"}))})}function _(S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/changeset/${S}/unsubscribe`,{},Object.assign(Object.assign({},k),{method:"POST"}))})}},{"../_osmFetch":17}],27:[function(n,o,c){var d=this&&this.__awaiter||function(E,T,M,R){function N(z){return z instanceof M?z:new M(function(V){V(z)})}return new(M||(M=Promise))(function(z,V){function Y(te){try{$(R.next(te))}catch(U){V(U)}}function se(te){try{$(R.throw(te))}catch(U){V(U)}}function $(te){te.done?z(te.value):N(te.value).then(Y,se)}$((R=R.apply(E,T||[])).next())})},h=this&&this.__rest||function(E,T){var M={};for(var R in E)Object.prototype.hasOwnProperty.call(E,R)&&T.indexOf(R)<0&&(M[R]=E[R]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,R=Object.getOwnPropertySymbols(E);N<R.length;N++)T.indexOf(R[N])<0&&Object.prototype.propertyIsEnumerable.call(E,R[N])&&(M[R[N]]=E[R[N]]);return M};Object.defineProperty(c,"__esModule",{value:!0}),c.compress=y,c.uploadChangeset=C;const a=n("../_osmFetch"),_=n("../../../package.json"),S=n("./_createOsmChangeXml"),k=n("./chunkOsmChange");function y(E){if(!globalThis.CompressionStream)return;const T=new Response(E).body.pipeThrough(new CompressionStream("gzip"));return new Response(T).blob()}function C(E,T,M){return d(this,void 0,void 0,function*(){const R=M||{},{onChunk:N,onProgress:z,disableCompression:V}=R,Y=h(R,["onChunk","onProgress","disableCompression"]),se=(0,k.chunkOsmChange)(T),$=[],te=(0,k.getOsmChangeSize)(T);for(const[U,j]of se.entries()){let G=E;se.length>1&&(N?G=N({featureCount:te,changesetIndex:U,changesetTotal:se.length}):G.chunk=`${U+1}/${se.length}`),G.created_by||(G.created_by=`osm-api-js ${_.version}`),z==null||z({phase:"upload",step:U+1,total:se.length});const O=+(yield(0,a.osmFetch)("/0.6/changeset/create",void 0,Object.assign(Object.assign({},Y),{method:"PUT",body:(0,S.createChangesetMetaXml)(G),headers:Object.assign(Object.assign({},Y.headers),{"content-type":"application/xml; charset=utf-8"})}))),W=(0,S.createOsmChangeXml)(O,j),le=!V&&(yield y(W));yield(0,a.osmFetch)(`/0.6/changeset/${O}/upload`,void 0,Object.assign(Object.assign({},Y),{method:"POST",body:le||W,headers:Object.assign(Object.assign(Object.assign({},Y.headers),le&&{"Content-Encoding":"gzip"}),{"content-type":"application/xml; charset=utf-8"})})),yield(0,a.osmFetch)(`/0.6/changeset/${O}/close`,void 0,Object.assign(Object.assign({},Y),{method:"PUT"})),$.push(O)}return $[0]})}},{"../../../package.json":16,"../_osmFetch":17,"./_createOsmChangeXml":19,"./chunkOsmChange":21}],28:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.createUserBlock=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/user_blocks.json",_,Object.assign(Object.assign({},S),{method:"POST"}))).user_block})}},{"../_osmFetch":17}],29:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getUserBlock=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user_blocks/${_}.json`,{},S)).user_block})}},{"../_osmFetch":17}],30:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(M){M(T)})}return new(y||(y=Promise))(function(T,M){function R(V){try{z(C.next(V))}catch(Y){M(Y)}}function N(V){try{z(C.throw(V))}catch(Y){M(Y)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.hideChangesetComment=_;const h=n("../_osmFetch"),a=n("../changesets");function _(S,k,y){return d(this,void 0,void 0,function*(){const C=yield(0,h.osmFetch)(`/0.6/changeset_comments/${S}/visibility.json`,{},Object.assign(Object.assign({},y),{method:k==="unhide"?"POST":"DELETE"}));return(0,a.mapRawChangeset)(C.changeset)})}},{"../_osmFetch":17,"../changesets":25}],31:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(M){M(T)})}return new(y||(y=Promise))(function(T,M){function R(V){try{z(C.next(V))}catch(Y){M(Y)}}function N(V){try{z(C.throw(V))}catch(Y){M(Y)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.hideNote=_;const h=n("../_osmFetch"),a=n("../notes");function _(S,k,y){return d(this,void 0,void 0,function*(){const C=yield(0,h.osmFetch)(`/0.6/notes/${S}.json`,k?{text:k}:{},Object.assign(Object.assign({},y),{method:"DELETE"}));return(0,a.featureToNote)(C)})}},{"../_osmFetch":17,"../notes":48}],32:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./createUserBlock"),c),h(n("./getUserBlock"),c),h(n("./hideChangesetComment"),c),h(n("./hideNote"),c),h(n("./redactFeature"),c)},{"./createUserBlock":28,"./getUserBlock":29,"./hideChangesetComment":30,"./hideNote":31,"./redactFeature":33}],33:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.redactFeature=a;const h=n("../_osmFetch");function a(_,S){return d(this,arguments,void 0,function*({featureType:k,featureId:y,featureVersion:C,redactionId:E},T){yield(0,h.osmFetch)(`/0.6/${k}/${y}/${C}/redact`,E?{redaction:E}:{},Object.assign(Object.assign({},T),{method:"POST"}))})}},{"../_osmFetch":17}],34:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(M){M(T)})}return new(y||(y=Promise))(function(T,M){function R(V){try{z(C.next(V))}catch(Y){M(Y)}}function N(V){try{z(C.throw(V))}catch(Y){M(Y)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getApiCapabilities=a,c.getCapabilities=_;const h=n("./_osmFetch");function a(S){return d(this,void 0,void 0,function*(){return(0,h.osmFetch)("/capabilities.json",void 0,S)})}function _(){return d(this,void 0,void 0,function*(){const S=yield a();return{limits:{maxArea:S.api.area.maximum,maxNoteArea:S.api.note_area.maximum,maxTracepointPerPage:S.api.tracepoints.per_page,maxWayNodes:S.api.waynodes.maximum,maxChangesetElements:S.api.changesets.maximum_elements,maxTimeout:S.api.timeout.seconds},policy:{imageryBlacklist:S.policy.imagery.blacklist.map(y=>y.regex)}}})}},{"./_osmFetch":17}],35:[function(n,o,c){var d=this&&this.__awaiter||function(E,T,M,R){function N(z){return z instanceof M?z:new M(function(V){V(z)})}return new(M||(M=Promise))(function(z,V){function Y(te){try{$(R.next(te))}catch(U){V(U)}}function se(te){try{$(R.throw(te))}catch(U){V(U)}}function $(te){te.done?z(te.value):N(te.value).then(Y,se)}$((R=R.apply(E,T||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getFeature=a,c.getFeatures=_,c.getFeatureAtVersion=S,c.getFeatureHistory=k,c.getWaysForNode=y,c.getRelationsForElement=C;const h=n("./_osmFetch");function a(E,T,M,R){return d(this,void 0,void 0,function*(){const N=M&&E!=="node"?"/full":"";return(yield(0,h.osmFetch)(`/0.6/${E}/${T}${N}.json`,void 0,R)).elements})}function _(E,T,M){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/${E}s.json?${E}s=${T.join(",")}`,void 0,M)).elements})}function S(E,T,M,R){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/${E}/${T}/${M}.json`,void 0,R)).elements[0]})}function k(E,T,M){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/${E}/${T}/history.json`,void 0,M)).elements})}function y(E,T){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/node/${E}/ways.json`,void 0,T)).elements})}function C(E,T,M){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/${E}/${T}/relations.json`,void 0,M)).elements})}},{"./_osmFetch":17}],36:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getMapData=a;const h=n("./_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/map.json",{bbox:_},S)).elements})}},{"./_osmFetch":17}],37:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getPermissions=a;const h=n("./_osmFetch");function a(_){return d(this,void 0,void 0,function*(){return(0,h.osmFetch)("/0.6/permissions.json",void 0,_)})}},{"./_osmFetch":17}],38:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getUIdFromDisplayName=a;const h=n("./changesets");function a(_){return d(this,void 0,void 0,function*(){const S=yield(0,h.listChangesets)({display_name:_});if(!S.length)throw new Error("Could not get uid because the user has never edited the map");return S[0].uid})}},{"./changesets":25}],39:[function(n,o,c){var d=this&&this.__awaiter||function(y,C,E,T){function M(R){return R instanceof E?R:new E(function(N){N(R)})}return new(E||(E=Promise))(function(R,N){function z(se){try{Y(T.next(se))}catch($){N($)}}function V(se){try{Y(T.throw(se))}catch($){N($)}}function Y(se){se.done?R(se.value):M(se.value).then(z,V)}Y((T=T.apply(y,C||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getUser=a,c.getUsers=_,c.getUserBlockById=S,c.getOwnUserBlocks=k;const h=n("./_osmFetch");function a(y,C){return d(this,void 0,void 0,function*(){const E=yield(0,h.osmFetch)(`/0.6/user/${y==="me"?"details":y}.json`,void 0,C);return Object.assign(Object.assign({},E.user),{account_created:new Date(E.user.account_created)})})}function _(y,C){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/users",{users:y},C)).users.map(T=>Object.assign(Object.assign({},T),{account_created:new Date(T.account_created)}))})}function S(y,C){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user_blocks/${y}.json`,void 0,C)).user_block})}function k(y){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/user/blocks/active",void 0,y)).user_blocks})}},{"./_osmFetch":17}],40:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./changesets"),c),h(n("./dwg"),c),h(n("./messages"),c),h(n("./notes"),c),h(n("./preferences"),c),h(n("./getCapabilities"),c),h(n("./getFeature"),c),h(n("./getMapData"),c),h(n("./getPermissions"),c),h(n("./getUIdFromDisplayName"),c),h(n("./getUser"),c)},{"./changesets":25,"./dwg":32,"./getCapabilities":34,"./getFeature":35,"./getMapData":36,"./getPermissions":37,"./getUIdFromDisplayName":38,"./getUser":39,"./messages":43,"./notes":48,"./preferences":53}],41:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.deleteMessage=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user/messages/${_}.json`,{},Object.assign(Object.assign({},S),{method:"DELETE"}))).message})}},{"../_osmFetch":17}],42:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getMessage=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user/messages/${_}.json`,void 0,S)).message})}},{"../_osmFetch":17}],43:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./deleteMessage"),c),h(n("./getMessage"),c),h(n("./listMessages"),c),h(n("./sendMessage"),c),h(n("./updateMessageReadStatus"),c)},{"./deleteMessage":41,"./getMessage":42,"./listMessages":44,"./sendMessage":45,"./updateMessageReadStatus":46}],44:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.listMessages=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user/messages/${_}.json`,void 0,S)).messages})}},{"../_osmFetch":17}],45:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.sendMessage=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/user/messages.json",_,Object.assign(Object.assign({},S),{method:"POST"}))).message})}},{"../_osmFetch":17}],46:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.updateMessageReadStatus=a;const h=n("../_osmFetch");function a(_,S,k){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user/messages/${_}.json`,{read_status:S},Object.assign(Object.assign({},k),{method:"POST"}))).message})}},{"../_osmFetch":17}],47:[function(n,o,c){var d=this&&this.__awaiter||function(C,E,T,M){function R(N){return N instanceof T?N:new T(function(z){z(N)})}return new(T||(T=Promise))(function(N,z){function V($){try{se(M.next($))}catch(te){z(te)}}function Y($){try{se(M.throw($))}catch(te){z(te)}}function se($){$.done?N($.value):R($.value).then(V,Y)}se((M=M.apply(C,E||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.featureToNote=void 0,c.getNotesForQuery=S,c.getNotesForArea=k,c.getNote=y;const h=n("../_osmFetch"),a=C=>{const[E,T]=C.geometry.coordinates;return Object.assign(Object.assign({},C.properties),{location:{lat:T,lng:E}})};c.featureToNote=a;function _(C,E,T){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/notes${E?"/search":""}.json`,C,T)).features.map(c.featureToNote)})}function S(C,E){return _(C,!0,E)}function k(C,E){return _({bbox:C},!1,E)}function y(C,E){return d(this,void 0,void 0,function*(){const T=yield(0,h.osmFetch)(`/0.6/notes/${C}.json`,void 0,E);return(0,c.featureToNote)(T)})}},{"../_osmFetch":17}],48:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./getNotes"),c),h(n("./noteActions"),c),h(n("./subscription"),c)},{"./getNotes":47,"./noteActions":49,"./subscription":50}],49:[function(n,o,c){var d=this&&this.__awaiter||function(C,E,T,M){function R(N){return N instanceof T?N:new T(function(z){z(N)})}return new(T||(T=Promise))(function(N,z){function V($){try{se(M.next($))}catch(te){z(te)}}function Y($){try{se(M.throw($))}catch(te){z(te)}}function se($){$.done?N($.value):R($.value).then(V,Y)}se((M=M.apply(C,E||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.createNote=_,c.commentOnNote=S,c.closeNote=k,c.reopenNote=y;const h=n("../_osmFetch"),a=n("./getNotes");function _(C,E,T,M){return d(this,void 0,void 0,function*(){const R=yield(0,h.osmFetch)("/0.6/notes.json",{lat:C,lon:E,text:T},Object.assign(Object.assign({},M),{method:"POST"}));return(0,a.featureToNote)(R)})}function S(C,E,T){return d(this,void 0,void 0,function*(){const M=yield(0,h.osmFetch)(`/0.6/notes/${C}/comment.json`,E?{text:E}:{},Object.assign(Object.assign({},T),{method:"POST"}));return(0,a.featureToNote)(M)})}function k(C,E,T){return d(this,void 0,void 0,function*(){const M=yield(0,h.osmFetch)(`/0.6/notes/${C}/close.json`,E?{text:E}:{},Object.assign(Object.assign({},T),{method:"POST"}));return(0,a.featureToNote)(M)})}function y(C,E,T){return d(this,void 0,void 0,function*(){const M=yield(0,h.osmFetch)(`/0.6/notes/${C}/reopen.json`,E?{text:E}:{},Object.assign(Object.assign({},T),{method:"POST"}));return(0,a.featureToNote)(M)})}},{"../_osmFetch":17,"./getNotes":47}],50:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(M){M(T)})}return new(y||(y=Promise))(function(T,M){function R(V){try{z(C.next(V))}catch(Y){M(Y)}}function N(V){try{z(C.throw(V))}catch(Y){M(Y)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.subscribeToNote=a,c.unsubscribeFromNote=_;const h=n("../_osmFetch");function a(S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/notes/${S}/subscription`,{},Object.assign(Object.assign({},k),{method:"POST"}))})}function _(S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/notes/${S}/subscription`,{},Object.assign(Object.assign({},k),{method:"DELETE"}))})}},{"../_osmFetch":17}],51:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.deletePreferences=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/user/preferences/${_}.json`,{},Object.assign(Object.assign({},S),{method:"DELETE"}))})}},{"../_osmFetch":17}],52:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getPreferences=a;const h=n("../_osmFetch");function a(_){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/user/preferences.json",void 0,_)).preferences})}},{"../_osmFetch":17}],53:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./deletePreferences"),c),h(n("./getPreferences"),c),h(n("./updatePreferences"),c)},{"./deletePreferences":51,"./getPreferences":52,"./updatePreferences":54}],54:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.updatePreferences=a;const h=n("../_osmFetch");function a(_,S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/user/preferences/${_}.json`,{},Object.assign(Object.assign({},k),{method:"PUT",body:S}))})}},{"../_osmFetch":17}],55:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.createPopup=h;const d="osm-api-auth-complete";function h(a){let _=!1;return new Promise(S=>{const[k,y]=[600,550],C=Object.entries({width:k,height:y,left:window.screen.width/2-k/2,top:window.screen.height/2-y/2}).map(([R,N])=>`${R}=${N}`).join(","),E=window.open("about:blank","oauth_window",C);if(!E)throw new Error("Popup was blocked");E.location=a;const T=new BroadcastChannel(d),M=R=>{_||(S(R.data),_=!0,T.removeEventListener("message",M),T.close())};T.addEventListener("message",M)})}},{}],56:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function M(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(M,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.exchangeCode=a;const h=n("./helpers");function a(_,S){return d(this,arguments,void 0,function*(k,{options:y,pkceVerifier:C,state:E}){const T=new URL(k).searchParams,M=T.get("error_description"),R=T.get("code"),N=T.get("state");if(M)throw new Error(M);if(!R)throw new Error("No code in OAuth response");if(!C||!E)throw new Error("No login in progress");if(E!==N)throw new Error("State Mismatch");const z={grant_type:"authorization_code",code:R,redirect_uri:y.redirectUrl,client_id:y.clientId,code_verifier:C},V=`${(0,h.getOAuthBaseUrl)()}/oauth2/token?${new URLSearchParams(z).toString()}`,se=yield(yield fetch(V,{method:"POST",body:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if("error_description"in se)throw new Error(se.error_description);const $={issuedAt:new Date(se.created_at*1e3).toISOString(),accessToken:se.access_token,scopes:se.scope.split(" ")};return localStorage.setItem("__osmAuth",JSON.stringify($)),$})}},{"./helpers":57}],57:[function(n,o,c){var d=this&&this.__awaiter||function(k,y,C,E){function T(M){return M instanceof C?M:new C(function(R){R(M)})}return new(C||(C=Promise))(function(M,R){function N(Y){try{V(E.next(Y))}catch(se){R(se)}}function z(Y){try{V(E.throw(Y))}catch(se){R(se)}}function V(Y){Y.done?M(Y.value):T(Y.value).then(N,z)}V((E=E.apply(k,y||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.sha256=a,c.getRandomString=_,c.getOAuthBaseUrl=S;const h=n("../config");function a(k){return d(this,void 0,void 0,function*(){const y=new TextEncoder().encode(k),C=yield window.crypto.subtle.digest("SHA-256",y);return btoa(String.fromCharCode(...new Uint8Array(C))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")})}function _(){return[...window.crypto.getRandomValues(new Uint32Array(32))].map(k=>`0${k.toString(16)}`.slice(-2)).join("")}function S(){let k=(0,h.getConfig)().apiUrl;return k==="https://api.openstreetmap.org"&&(k="https://www.openstreetmap.org"),k}},{"../config":60}],58:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./oauth2"),c)},{"./oauth2":59}],59:[function(n,o,c){var d=this&&this.__awaiter||function(E,T,M,R){function N(z){return z instanceof M?z:new M(function(V){V(z)})}return new(M||(M=Promise))(function(z,V){function Y(te){try{$(R.next(te))}catch(U){V(U)}}function se(te){try{$(R.throw(te))}catch(U){V(U)}}function $(te){te.done?z(te.value):N(te.value).then(Y,se)}$((R=R.apply(E,T||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.isLoggedIn=c.getAuthToken=c.authReady=void 0,c.login=S,c.logout=C;const h=n("./createPopup"),a=n("./exchangeCode"),_=n("./helpers");function S(E){return d(this,void 0,void 0,function*(){if(!E.redirectUrl)throw new Error("You must include the 'redirectUrl' option");if(!E.clientId)throw new Error("You must include the 'clientId' option");if(!E.scopes)throw new Error("You must include the 'scopes' option");const T=(0,_.getRandomString)(),M=(0,_.getRandomString)(),R=yield(0,_.sha256)(M),N={scope:E.scopes.join(" "),include_granted_scopes:"true",response_type:"code",state:T,redirect_uri:E.redirectUrl,client_id:E.clientId,code_challenge_method:"S256",code_challenge:R},z=`/oauth2/authorize?${new URLSearchParams(N).toString()}`,V=E.switchUser?`/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(z)}`)}`:z,Y=(0,_.getOAuthBaseUrl)()+V,se={state:T,pkceVerifier:M,options:E};if(E.mode==="popup"){const $=yield(0,h.createPopup)(Y);return(0,a.exchangeCode)($,se)}if(E.mode==="redirect"){localStorage.setItem("__osmAuthTemp",JSON.stringify(se)),window.location.replace(Y);return}throw new Error("options.mode must be 'popup' or 'redirect'")})}c.authReady=d(void 0,void 0,void 0,function*(){if(typeof window>"u")return;const E=window.location.href,T=localStorage.getItem("__osmAuthTemp");if(new URL(E).searchParams.get("code")&&T)try{const M=JSON.parse(T);yield(0,a.exchangeCode)(E,M),localStorage.removeItem("__osmAuthTemp")}catch(M){console.error("OSM Auth Error",M)}});const k=()=>{try{const E=localStorage.getItem("__osmAuth");return E?JSON.parse(E).accessToken:void 0}catch{return}};c.getAuthToken=k;const y=()=>!!(0,c.getAuthToken)();c.isLoggedIn=y;function C(){localStorage.removeItem("__osmAuth")}},{"./createPopup":55,"./exchangeCode":56,"./helpers":57}],60:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.getConfig=void 0,c.configure=a;const d={apiUrl:"https://api.openstreetmap.org",userAgent:"https://github.com/osmlab/osm-api-js"},h=()=>d;c.getConfig=h;function a(_){Object.assign(d,_)}},{}],61:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./api"),c),h(n("./auth"),c),h(n("./config"),c),h(n("./types"),c)},{"./api":40,"./auth":58,"./config":60,"./types":65}],62:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0})},{}],63:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],64:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],65:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./changesets"),c),h(n("./features"),c),h(n("./general"),c),h(n("./messages"),c),h(n("./notes"),c),h(n("./osmPatch"),c),h(n("./user"),c)},{"./changesets":62,"./features":63,"./general":64,"./messages":66,"./notes":67,"./osmPatch":68,"./user":69}],66:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],67:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],68:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],69:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}]},{},[61])(61)})})(Tb);var nh=Tb.exports;const{window:BC}=c0;function NC(r){let e,n=r[0].length+"",o,c,d=r[0].length==1?"edit":"edits",h;return{c(){e=xe("div"),o=gt(n),c=Ue(),h=gt(d),he(e,"slot","header")},m(a,_){be(a,e,_),ce(e,o),ce(e,c),ce(e,h)},p(a,_){_&1&&n!==(n=a[0].length+"")&&_i(o,n),_&1&&d!==(d=a[0].length==1?"edit":"edits")&&_i(h,d)},d(a){a&&ye(e)}}}function fy(r){let e,n,o,c,d,h=r[0].length+"",a,_,S,k,y,C,E,T,M,R,N,z,V,Y,se,$=r[1]+1+"",te,U,j=r[0].length+"",G,O,W,le,de,ve,pe,we=JSON.stringify(r[0][r[1]])+"",Te,Ae,ct;return{c(){e=xe("div"),n=xe("button"),n.textContent="Clear edits",o=Ue(),c=xe("button"),d=gt("Undo ("),a=gt(h),_=gt(")"),k=Ue(),y=xe("div"),C=xe("button"),C.textContent="Download .osc",E=Ue(),T=xe("button"),T.textContent="Upload changeset",M=Ue(),R=xe("div"),N=xe("button"),z=gt("Previous"),Y=Ue(),se=xe("span"),te=gt($),U=gt(" / "),G=gt(j),O=Ue(),W=xe("button"),le=gt("Next"),ve=Ue(),pe=xe("p"),Te=gt(we),he(n,"class","btn btn-danger"),he(c,"class","btn btn-danger"),c.disabled=S=r[0].length==0,he(e,"class","mb-1"),he(C,"class","btn btn-secondary"),he(T,"class","btn btn-secondary"),he(y,"class","mb-1"),he(N,"class","btn btn-secondary"),N.disabled=V=r[1]==0,he(W,"class","btn btn-secondary"),W.disabled=de=r[1]==r[0].length-1,tn(R,"display","flex"),tn(R,"justify-content","space-between")},m(We,pt){be(We,e,pt),ce(e,n),ce(e,o),ce(e,c),ce(c,d),ce(c,a),ce(c,_),be(We,k,pt),be(We,y,pt),ce(y,C),ce(y,E),ce(y,T),be(We,M,pt),be(We,R,pt),ce(R,N),ce(N,z),ce(R,Y),ce(R,se),ce(se,te),ce(se,U),ce(se,G),ce(R,O),ce(R,W),ce(W,le),be(We,ve,pt),be(We,pe,pt),ce(pe,Te),Ae||(ct=[Ut(n,"click",r[5]),Ut(c,"click",r[6]),Ut(C,"click",r[7]),Ut(T,"click",r[8]),Ut(N,"click",r[3]),Ut(W,"click",r[4])],Ae=!0)},p(We,pt){pt&1&&h!==(h=We[0].length+"")&&_i(a,h),pt&1&&S!==(S=We[0].length==0)&&(c.disabled=S),pt&2&&V!==(V=We[1]==0)&&(N.disabled=V),pt&2&&$!==($=We[1]+1+"")&&_i(te,$),pt&1&&j!==(j=We[0].length+"")&&_i(G,j),pt&3&&de!==(de=We[1]==We[0].length-1)&&(W.disabled=de),pt&3&&we!==(we=JSON.stringify(We[0][We[1]])+"")&&_i(Te,we)},d(We){We&&(ye(e),ye(k),ye(y),ye(M),ye(R),ye(ve),ye(pe)),Ae=!1,jn(ct)}}}function jC(r){let e,n=r[0].length>0&&fy(r);return{c(){e=xe("div"),n&&n.c(),he(e,"slot","body")},m(o,c){be(o,e,c),n&&n.m(e,null)},p(o,c){o[0].length>0?n?n.p(o,c):(n=fy(o),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(o){o&&ye(e),n&&n.d()}}}function UC(r){let e,n,o,c,d,h;return e=new Hl({props:{loading:r[2]}}),o=new _a({props:{$$slots:{body:[jC],header:[NC]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment)},m(a,_){ot(e,a,_),be(a,n,_),ot(o,a,_),c=!0,d||(h=Ut(BC,"keydown",r[9]),d=!0)},p(a,[_]){const S={};_&4&&(S.loading=a[2]),e.$set(S);const k={};_&16387&&(k.$$scope={dirty:_,ctx:a}),o.$set(k)},i(a){c||(Pe(e.$$.fragment,a),Pe(o.$$.fragment,a),c=!0)},o(a){De(e.$$.fragment,a),De(o.$$.fragment,a),c=!1},d(a){a&&ye(n),at(e,a),at(o,a),d=!1,h()}}}function VC(r,e,n){let o,c,d,h;Bt(r,ch,N=>n(12,o=N)),Bt(r,er,N=>n(10,c=N)),Bt(r,uh,N=>n(13,d=N)),Bt(r,Yr,N=>n(11,h=N));let a=[],_=0,S="";function k(){n(1,_--,_)}function y(){n(1,_++,_)}async function C(){if(window.confirm("Do you really want to clear your edits?")){n(2,S="Clearing edits"),await fo();try{c.editClear(),Qi(Yr,h++,h)}finally{n(2,S="")}}}async function E(){n(2,S="Undoing last edit"),await fo();try{c.editUndo(),Qi(Yr,h++,h)}finally{n(2,S="")}}function T(){Ip("changes.osc",c.toOsc())}async function M(){if(!d){window.alert("You have to log in first");return}if(a.some(z=>!("SetTags"in z))){window.alert("You've done a bulk operation. You should NOT upload this to OSM -- it's only for testing or usage in you own tool that consumes OSM data.");return}if(!window.confirm("Do you really know what you're doing and want to upload this?"))return;let N=window.prompt("Please describe this changeset");if(N)try{let z=await nh.uploadChangeset({created_by:"Speedwalk",comment:N},JSON.parse(c.toOsmChangeJson()));window.open(`https://www.openstreetmap.org/changeset/${z}`,"_blank"),Qi(er,c=null,c),Qi(ch,o=!1,o)}catch(z){window.alert(`Upload failed: ${z}`)}}async function R(N){N.key=="z"&&N.ctrlKey&&a.length>0&&await E()}return r.$$.update=()=>{r.$$.dirty&3073&&h>0&&(n(0,a=c?JSON.parse(c.getEdits()):[]),n(1,_=0),Qi(ch,o=a.length>0,o))},[a,_,S,k,y,C,E,T,M,R,c,h]}class qC extends ai{constructor(e){super(),oi(this,e,VC,UC,Yt,{})}}function ZC(r){var z;let e,n,o,c,d,h,a,_,S,k,y,C,E=dy((z=r[1])==null?void 0:z.getOsmTimestamp())+"",T,M,R,N;return e=new Hl({props:{loading:r[0]}}),{c(){lt(e.$$.fragment),n=Ue(),o=xe("hr"),c=Ue(),d=xe("div"),h=xe("div"),a=xe("button"),a.textContent="Load another area",_=Ue(),S=xe("button"),S.textContent="Refresh OSM data",k=Ue(),y=xe("p"),C=gt("OSM data is from "),T=gt(E),he(o,"class","my-4"),he(a,"class","btn btn-secondary"),he(S,"class","btn btn-secondary"),he(h,"class","d-flex gap-2 mb-3"),he(d,"class","mt-4")},m(V,Y){ot(e,V,Y),be(V,n,Y),be(V,o,Y),be(V,c,Y),be(V,d,Y),ce(d,h),ce(h,a),ce(h,_),ce(h,S),ce(d,k),ce(d,y),ce(y,C),ce(y,T),M=!0,R||(N=[Ut(a,"click",r[2]),Ut(S,"click",r[3])],R=!0)},p(V,[Y]){var $;const se={};Y&1&&(se.loading=V[0]),e.$set(se),(!M||Y&2)&&E!==(E=dy(($=V[1])==null?void 0:$.getOsmTimestamp())+"")&&_i(T,E)},i(V){M||(Pe(e.$$.fragment,V),M=!0)},o(V){De(e.$$.fragment,V),M=!1},d(V){V&&(ye(n),ye(o),ye(c),ye(d)),at(e,V),R=!1,jn(N)}}}function dy(r){if(r){let e=new Date(1e3*Number(r));return`${e.toLocaleString()} (${WC(e)} ago)`}return"unknown"}function WC(r){let e=Date.now()-r.getTime(),n=Math.floor(e/1e3),o=Math.floor(n/60),c=Math.floor(o/60),d=Math.floor(c/24);return d?d==1?"1 day":`${d} days`:c?c==1?"1 hour":`${c} hours`:o?o==1?"1 minute":`${o} minutes`:"a few seconds"}function GC(r,e,n){let o,c;Bt(r,er,_=>n(1,o=_)),Bt(r,ch,_=>n(4,c=_));let d="";function h(){c&&!window.confirm("Changing areas will discard your current edits. Do you want to clear the edits?")||(Qi(er,o=null,o),Qi(ch,c=!1,c))}async function a(){if(!(c&&!window.confirm("Refreshing OSM data will discard your current edits. Do you want to clear the edits?")))try{n(0,d="Grabbing new OSM data from Overpass");let _=JSON.parse(o.getBoundary()),S=wb(_),k=await fetch(S);if(!k.ok)throw new Error(`Overpass failed: ${k}`);let y=await k.bytes();n(0,d="Processing Overpass data"),await fo(),Qi(er,o=new _h(new Uint8Array(y),_),o)}catch(_){window.alert(`Couldn't import from Overpass: ${_}`)}finally{n(0,d="")}}return[d,o,h,a]}class Mf extends ai{constructor(e){super(),oi(this,e,GC,ZC,Yt,{})}}function HC(r){let e,n,o;return{c(){e=xe("button"),e.textContent="Bulk operations",he(e,"class","btn btn-secondary")},m(c,d){be(c,e,d),n||(o=Ut(e,"click",r[11]),n=!0)},p:Ot,i:Ot,o:Ot,d(c){c&&ye(e),n=!1,o()}}}function XC(r){let e,n;return e=new _a({props:{$$slots:{body:[QC],header:[KC]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&65548&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function KC(r){let e;return{c(){e=xe("div"),e.textContent="Bulk operations",he(e,"slot","header")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function JC(r){let e;return{c(){e=gt("Drive on the left")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function YC(r){let e;return{c(){e=gt("Only for major roads")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function QC(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N,z,V,Y,se,$,te;function U(W){r[9](W)}let j={$$slots:{default:[JC]},$$scope:{ctx:r}};r[2]!==void 0&&(j.checked=r[2]),h=new Qn({props:j}),mi.push(()=>Ri(h,"checked",U));function G(W){r[10](W)}let O={$$slots:{default:[YC]},$$scope:{ctx:r}};return r[3]!==void 0&&(O.checked=r[3]),M=new Qn({props:O}),mi.push(()=>Ri(M,"checked",G)),{c(){e=xe("div"),n=xe("div"),o=xe("div"),o.textContent="Assume old-style tags on one-ways",c=Ue(),d=xe("div"),lt(h.$$.fragment),_=Ue(),S=xe("button"),S.textContent="Autoset tags on one-ways",k=Ue(),y=xe("div"),C=xe("div"),C.textContent="Make all sidewalks",E=Ue(),T=xe("div"),lt(M.$$.fragment),N=Ue(),z=xe("button"),z.textContent="Make sidewalks",V=Ue(),Y=xe("button"),Y.textContent="Connect all crossing nodes",he(o,"class","card-header"),he(S,"class","btn btn-secondary"),he(d,"class","card-body"),he(n,"class","card mb-3"),he(C,"class","card-header"),he(z,"class","btn btn-secondary"),he(T,"class","card-body"),he(y,"class","card mb-3"),he(Y,"class","btn btn-secondary"),he(e,"slot","body")},m(W,le){be(W,e,le),ce(e,n),ce(n,o),ce(n,c),ce(n,d),ot(h,d,null),ce(d,_),ce(d,S),ce(e,k),ce(e,y),ce(y,C),ce(y,E),ce(y,T),ot(M,T,null),ce(T,N),ce(T,z),ce(e,V),ce(e,Y),se=!0,$||(te=[Ut(S,"click",r[8]),Ut(z,"click",r[6]),Ut(Y,"click",r[7])],$=!0)},p(W,le){const de={};le&65536&&(de.$$scope={dirty:le,ctx:W}),!a&&le&4&&(a=!0,de.checked=W[2],Fi(()=>a=!1)),h.$set(de);const ve={};le&65536&&(ve.$$scope={dirty:le,ctx:W}),!R&&le&8&&(R=!0,ve.checked=W[3],Fi(()=>R=!1)),M.$set(ve)},i(W){se||(Pe(h.$$.fragment,W),Pe(M.$$.fragment,W),se=!0)},o(W){De(h.$$.fragment,W),De(M.$$.fragment,W),se=!1},d(W){W&&ye(e),at(h),at(M),$=!1,jn(te)}}}function $C(r){let e,n,o,c,d,h,a,_,S;return{c(){e=xe("h2"),e.textContent="Bulk operations",n=Ue(),o=xe("p"),o.innerHTML=`Speedwalk has some experimental features that can automatically generate
    separate sidewalks on roads tagged with <i>sidewalk = left,right,both</i>
    . This is intended for use in routers and other tools that require separate sidewalks.
    This generation is very error-prone and not meant to ever replace mapping sidewalks
    properly, just as a stop-gap for areas with low coverage. Feel free to test it
    out, but do not ever upload the results to OSM.`,c=Ue(),d=xe("button"),d.textContent="I understand",h=Ue(),a=xe("button"),a.textContent="Cancel",he(d,"class","btn btn-primary"),he(a,"class","btn btn-secondary")},m(k,y){be(k,e,y),be(k,n,y),be(k,o,y),be(k,c,y),be(k,d,y),be(k,h,y),be(k,a,y),_||(S=[Ut(d,"click",r[5]),Ut(a,"click",r[12])],_=!0)},p:Ot,d(k){k&&(ye(e),ye(n),ye(o),ye(c),ye(d),ye(h),ye(a)),_=!1,jn(S)}}}function eE(r){let e,n,o,c,d,h,a,_;e=new Hl({props:{loading:r[1]}});const S=[XC,HC],k=[];function y(T,M){return T[4]?0:1}o=y(r),c=k[o]=S[o](r);function C(T){r[13](T)}let E={$$slots:{default:[$C]},$$scope:{ctx:r}};return r[0]!==void 0&&(E.show=r[0]),h=new Af({props:E}),mi.push(()=>Ri(h,"show",C)),{c(){lt(e.$$.fragment),n=Ue(),c.c(),d=Ue(),lt(h.$$.fragment)},m(T,M){ot(e,T,M),be(T,n,M),k[o].m(T,M),be(T,d,M),ot(h,T,M),_=!0},p(T,[M]){const R={};M&2&&(R.loading=T[1]),e.$set(R);let N=o;o=y(T),o===N?k[o].p(T,M):(nn(),De(k[N],1,1,()=>{k[N]=null}),rn(),c=k[o],c?c.p(T,M):(c=k[o]=S[o](T),c.c()),Pe(c,1),c.m(d.parentNode,d));const z={};M&65537&&(z.$$scope={dirty:M,ctx:T}),!a&&M&1&&(a=!0,z.show=T[0],Fi(()=>a=!1)),h.$set(z)},i(T){_||(Pe(e.$$.fragment,T),Pe(c),Pe(h.$$.fragment,T),_=!0)},o(T){De(e.$$.fragment,T),De(c),De(h.$$.fragment,T),_=!1},d(T){T&&(ye(n),ye(d)),at(e,T),k[o].d(T),at(h,T)}}}function tE(r,e,n){let o,c,d;Bt(r,Yr,V=>n(14,o=V)),Bt(r,er,V=>n(15,c=V)),Bt(r,vf,V=>n(4,d=V));let h=!1;function a(){Qi(vf,d=!0,d),n(0,h=!1)}let _="",S=!0,k=!0;async function y(){n(1,_="Generating sidewalks"),await fo();try{c.editMakeAllSidewalks(k),Qi(Yr,o++,o)}catch(V){window.alert(`Error: ${V}`)}finally{n(1,_="")}}async function C(){n(1,_="Connecting crossings"),await fo();try{c.editConnectAllCrossings(),Qi(Yr,o++,o)}catch(V){window.alert(`Error: ${V}`)}finally{n(1,_="")}}async function E(){n(1,_="Inferring sidewalks around one-ways"),await fo();try{c.editAssumeTags(S),Qi(Yr,o++,o)}catch(V){window.alert(`Error: ${V}`)}finally{n(1,_="")}}function T(V){S=V,n(2,S)}function M(V){k=V,n(3,k)}const R=()=>n(0,h=!0),N=()=>n(0,h=!1);function z(V){h=V,n(0,h)}return[h,_,S,k,d,a,y,C,E,T,M,R,N,z]}let iE=class extends ai{constructor(e){super(),oi(this,e,tE,eE,Yt,{})}};function py(r,e,n){const o=r.slice();return o[11]=e[n][0],o[12]=e[n][1],o[13]=e,o[14]=n,o}function my(r,e,n){const o=r.slice();return o[11]=e[n][0],o[12]=e[n][1],o[15]=e,o[16]=n,o}function gy(r,e,n){const o=r.slice();o[11]=e[n][0],o[17]=e[n][1];const c=o[1].total_length_meters[o[11]];return o[18]=c,o}function _y(r){let e;return{c(){e=xe("span"),he(e,"class","svelte-m98wcc"),tn(e,"width",`${100*r[18]/r[2]}%`),tn(e,"height","100%"),tn(e,"background-color",Xl[r[11]])},m(n,o){be(n,e,o)},p(n,o){o&6&&tn(e,"width",`${100*n[18]/n[2]}%`)},d(n){n&&ye(e)}}}function nE(r){let e,n,o=r[12]+"",c,d,h=nu(r[1].total_length_meters[r[11]])+"",a;return{c(){e=xe("span"),n=Ue(),c=gt(o),d=gt(": "),a=gt(h),he(e,"class","color-swatch svelte-m98wcc"),tn(e,"background",Xl[r[11]])},m(_,S){be(_,e,S),be(_,n,S),be(_,c,S),be(_,d,S),be(_,a,S)},p(_,S){S&2&&h!==(h=nu(_[1].total_length_meters[_[11]])+"")&&_i(a,h)},d(_){_&&(ye(e),ye(n),ye(c),ye(d),ye(a))}}}function yy(r){let e,n,o,c;function d(a){r[8](a,r[11])}let h={$$slots:{default:[nE]},$$scope:{ctx:r}};return r[0][r[11]]!==void 0&&(h.checked=r[0][r[11]]),n=new Qn({props:h}),mi.push(()=>Ri(n,"checked",d)),{c(){e=xe("div"),lt(n.$$.fragment),tn(e,"display","flex"),tn(e,"align-items","center"),tn(e,"gap","6px")},m(a,_){be(a,e,_),ot(n,e,null),c=!0},p(a,_){r=a;const S={};_&1026&&(S.$$scope={dirty:_,ctx:r}),!o&&_&9&&(o=!0,S.checked=r[0][r[11]],Fi(()=>o=!1)),n.$set(S)},i(a){c||(Pe(n.$$.fragment,a),c=!0)},o(a){De(n.$$.fragment,a),c=!1},d(a){a&&ye(e),at(n)}}}function rE(r){let e,n,o=r[12]+"",c,d,h=nu(r[1].total_length_meters[r[11]])+"",a;return{c(){e=xe("span"),n=Ue(),c=gt(o),d=gt(": "),a=gt(h),he(e,"class","color-swatch svelte-m98wcc"),tn(e,"background",Xl[r[11]])},m(_,S){be(_,e,S),be(_,n,S),be(_,c,S),be(_,d,S),be(_,a,S)},p(_,S){S&2&&h!==(h=nu(_[1].total_length_meters[_[11]])+"")&&_i(a,h)},d(_){_&&(ye(e),ye(n),ye(c),ye(d),ye(a))}}}function by(r){let e,n,o,c,d;function h(_){r[9](_,r[11])}let a={$$slots:{default:[rE]},$$scope:{ctx:r}};return r[0][r[11]]!==void 0&&(a.checked=r[0][r[11]]),n=new Qn({props:a}),mi.push(()=>Ri(n,"checked",h)),{c(){e=xe("div"),lt(n.$$.fragment),c=Ue(),tn(e,"display","flex"),tn(e,"align-items","center"),tn(e,"gap","6px")},m(_,S){be(_,e,S),ot(n,e,null),ce(e,c),d=!0},p(_,S){r=_;const k={};S&1026&&(k.$$scope={dirty:S,ctx:r}),!o&&S&17&&(o=!0,k.checked=r[0][r[11]],Fi(()=>o=!1)),n.$set(k)},i(_){d||(Pe(n.$$.fragment,_),d=!0)},o(_){De(n.$$.fragment,_),d=!1},d(_){_&&ye(e),at(n)}}}function sE(r){let e,n,o,c,d,h,a,_,S,k,y,C,E=Ni(r[3]),T=[];for(let te=0;te<E.length;te+=1)T[te]=_y(gy(r,E,te));let M=Ni(r[3]),R=[];for(let te=0;te<M.length;te+=1)R[te]=yy(my(r,M,te));const N=te=>De(R[te],1,1,()=>{R[te]=null}),z=r[7].default,V=wn(z,r,r[10],null);let Y=Ni(r[4]),se=[];for(let te=0;te<Y.length;te+=1)se[te]=by(py(r,Y,te));const $=te=>De(se[te],1,1,()=>{se[te]=null});return{c(){e=xe("div"),n=xe("div"),n.textContent="Roads",o=Ue(),c=xe("div"),d=xe("div");for(let te=0;te<T.length;te+=1)T[te].c();h=Ue();for(let te=0;te<R.length;te+=1)R[te].c();a=Ue(),_=xe("div"),S=Ue(),V&&V.c(),k=Ue();for(let te=0;te<se.length;te+=1)se[te].c();y=Mn(),he(n,"class","card-header"),he(d,"class","row mb-1 svelte-m98wcc"),he(_,"class","mb-3"),he(c,"class","card-body"),he(e,"class","card mb-3")},m(te,U){be(te,e,U),ce(e,n),ce(e,o),ce(e,c),ce(c,d);for(let j=0;j<T.length;j+=1)T[j]&&T[j].m(d,null);ce(c,h);for(let j=0;j<R.length;j+=1)R[j]&&R[j].m(c,null);ce(c,a),ce(c,_),ce(c,S),V&&V.m(c,null),be(te,k,U);for(let j=0;j<se.length;j+=1)se[j]&&se[j].m(te,U);be(te,y,U),C=!0},p(te,[U]){if(U&14){E=Ni(te[3]);let j;for(j=0;j<E.length;j+=1){const G=gy(te,E,j);T[j]?T[j].p(G,U):(T[j]=_y(G),T[j].c(),T[j].m(d,null))}for(;j<T.length;j+=1)T[j].d(1);T.length=E.length}if(U&11){M=Ni(te[3]);let j;for(j=0;j<M.length;j+=1){const G=my(te,M,j);R[j]?(R[j].p(G,U),Pe(R[j],1)):(R[j]=yy(G),R[j].c(),Pe(R[j],1),R[j].m(c,a))}for(nn(),j=M.length;j<R.length;j+=1)N(j);rn()}if(V&&V.p&&(!C||U&1024)&&kn(V,z,te,te[10],C?xn(z,te[10],U,null):Sn(te[10]),null),U&19){Y=Ni(te[4]);let j;for(j=0;j<Y.length;j+=1){const G=py(te,Y,j);se[j]?(se[j].p(G,U),Pe(se[j],1)):(se[j]=by(G),se[j].c(),Pe(se[j],1),se[j].m(y.parentNode,y))}for(nn(),j=Y.length;j<se.length;j+=1)$(j);rn()}},i(te){if(!C){for(let U=0;U<M.length;U+=1)Pe(R[U]);Pe(V,te);for(let U=0;U<Y.length;U+=1)Pe(se[U]);C=!0}},o(te){R=R.filter(Boolean);for(let U=0;U<R.length;U+=1)De(R[U]);De(V,te),se=se.filter(Boolean);for(let U=0;U<se.length;U+=1)De(se[U]);C=!1},d(te){te&&(ye(e),ye(k),ye(y)),$n(T,te),$n(R,te),V&&V.d(te),$n(se,te)}}}function oE(r,e,n){let o,c,d;Bt(r,er,T=>n(5,c=T)),Bt(r,Yr,T=>n(6,d=T));let{$$slots:h={},$$scope:a}=e,{showKinds:_}=e,S=[["RoadWithSeparate","With separate sidewalks"],["RoadWithTags","With tagged sidewalks"],["RoadWithoutSidewalksExplicit","Tagged as no sidewalks"],["RoadWithoutSidewalksImplicit","Assumed as no sidewalks"],["RoadUnknown","Totally unknown"]],k=[["Sidewalk","Sidewalks"],["Crossing","Crossings"],["Other","Other"]],y=JSON.parse(c.getMetrics());function C(T,M){r.$$.not_equal(_[M],T)&&(_[M]=T,n(0,_))}function E(T,M){r.$$.not_equal(_[M],T)&&(_[M]=T,n(0,_))}return r.$$set=T=>{"showKinds"in T&&n(0,_=T.showKinds),"$$scope"in T&&n(10,a=T.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&d&&c&&n(1,y=JSON.parse(c.getMetrics())),r.$$.dirty&2&&n(2,o=hT(S.map(([T,M])=>y.total_length_meters[T])))},[_,y,o,S,k,c,d,h,C,E,a]}class aE extends ai{constructor(e){super(),oi(this,e,oE,sE,Yt,{showKinds:0})}}function vy(r,e,n){const o=r.slice();return o[14]=e[n][0],o[15]=e[n][1],o}function wy(r,e,n){const o=r.slice();return o[18]=e[n][0],o[19]=e[n][1],o}function xy(r,e,n){const o=r.slice();return o[18]=e[n][0],o[19]=e[n][1],o}function ky(r,e,n){const o=r.slice();return o[14]=e[n][0],o[15]=e[n][1],o}function Sy(r,e,n){const o=r.slice();return o[26]=e[n],o}function Ty(r){let e,n,o,c,d,h,a=Ni(r[1].properties.problems),_=[];for(let k=0;k<a.length;k+=1)_[k]=Cy(Sy(r,a,k));let S=r[2].features.length&&Ey(r);return d=new Ep({props:{labelColors:Object.fromEntries(r[2].features.map(Oy)),itemsPerRow:1}}),{c(){e=xe("u"),e.textContent="Problems:",n=Ue();for(let k=0;k<_.length;k+=1)_[k].c();o=Ue(),S&&S.c(),c=Ue(),lt(d.$$.fragment)},m(k,y){be(k,e,y),be(k,n,y);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(k,y);be(k,o,y),S&&S.m(k,y),be(k,c,y),ot(d,k,y),h=!0},p(k,y){if(y&2){a=Ni(k[1].properties.problems);let E;for(E=0;E<a.length;E+=1){const T=Sy(k,a,E);_[E]?_[E].p(T,y):(_[E]=Cy(T),_[E].c(),_[E].m(o.parentNode,o))}for(;E<_.length;E+=1)_[E].d(1);_.length=a.length}k[2].features.length?S?(S.p(k,y),y&4&&Pe(S,1)):(S=Ey(k),S.c(),Pe(S,1),S.m(c.parentNode,c)):S&&(nn(),De(S,1,1,()=>{S=null}),rn());const C={};y&4&&(C.labelColors=Object.fromEntries(k[2].features.map(Oy))),d.$set(C)},i(k){h||(Pe(S),Pe(d.$$.fragment,k),h=!0)},o(k){De(S),De(d.$$.fragment,k),h=!1},d(k){k&&(ye(e),ye(n),ye(o),ye(c)),$n(_,k),S&&S.d(k),at(d,k)}}}function Cy(r){let e,n=r[26].note+"",o;return{c(){e=xe("p"),o=gt(n)},m(c,d){be(c,e,d),ce(e,o)},p(c,d){d&2&&n!==(n=c[26].note+"")&&_i(o,n)},d(c){c&&ye(e)}}}function Ey(r){let e,n,o;function c(h){r[9](h)}let d={$$slots:{default:[lE]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.checked=r[0]),e=new Qn({props:d}),mi.push(()=>Ri(e,"checked",c)),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,a){const _={};a&536870912&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.checked=h[0],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function lE(r){let e;return{c(){e=gt("Show problem details")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function cE(r){let e,n,o,c=Ni(r[7].entries()),d=[];for(let h=0;h<c.length;h+=1)d[h]=Iy(wy(r,c,h));return{c(){e=xe("u"),e.textContent="Set these tags",n=Ue();for(let h=0;h<d.length;h+=1)d[h].c();o=Mn()},m(h,a){be(h,e,a),be(h,n,a);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(h,a);be(h,o,a)},p(h,a){if(a&160){c=Ni(h[7].entries());let _;for(_=0;_<c.length;_+=1){const S=wy(h,c,_);d[_]?d[_].p(S,a):(d[_]=Iy(S),d[_].c(),d[_].m(o.parentNode,o))}for(;_<d.length;_+=1)d[_].d(1);d.length=c.length}},d(h){h&&(ye(e),ye(n),ye(o)),$n(d,h)}}}function uE(r){let e,n,o,c,d,h,a,_=Ni(Object.entries(r[1].properties.tags)),S=[];for(let C=0;C<_.length;C+=1)S[C]=My(ky(r,_,C));let k=Ni(r[6].entries()),y=[];for(let C=0;C<k.length;C+=1)y[C]=Py(xy(r,k,C));return{c(){e=xe("u"),e.textContent="Current sidewalk tags",n=Ue(),o=xe("ul");for(let C=0;C<S.length;C+=1)S[C].c();c=Ue(),d=xe("u"),d.textContent="Override to these tags",h=Ue();for(let C=0;C<y.length;C+=1)y[C].c();a=Mn()},m(C,E){be(C,e,E),be(C,n,E),be(C,o,E);for(let T=0;T<S.length;T+=1)S[T]&&S[T].m(o,null);be(C,c,E),be(C,d,E),be(C,h,E);for(let T=0;T<y.length;T+=1)y[T]&&y[T].m(C,E);be(C,a,E)},p(C,E){if(E&2){_=Ni(Object.entries(C[1].properties.tags));let T;for(T=0;T<_.length;T+=1){const M=ky(C,_,T);S[T]?S[T].p(M,E):(S[T]=My(M),S[T].c(),S[T].m(o,null))}for(;T<S.length;T+=1)S[T].d(1);S.length=_.length}if(E&96){k=Ni(C[6].entries());let T;for(T=0;T<k.length;T+=1){const M=xy(C,k,T);y[T]?y[T].p(M,E):(y[T]=Py(M),y[T].c(),y[T].m(a.parentNode,a))}for(;T<y.length;T+=1)y[T].d(1);y.length=k.length}},d(C){C&&(ye(e),ye(n),ye(o),ye(c),ye(d),ye(h),ye(a)),$n(S,C),$n(y,C)}}}function Iy(r){let e,n,o,c,d=r[19].map(dE).join(", ")+"",h,a,_,S;function k(){return r[11](r[19])}return{c(){e=xe("div"),n=xe("button"),o=xe("kbd"),o.textContent=`${r[18]+1}`,c=Ue(),h=gt(d),a=Ue(),he(n,"class","btn btn-secondary mb-1")},m(y,C){be(y,e,C),ce(e,n),ce(n,o),ce(n,c),ce(n,h),ce(e,a),_||(S=Ut(n,"click",k),_=!0)},p(y,C){r=y},d(y){y&&ye(e),_=!1,S()}}}function Ay(r){let e,n=r[14]+"",o,c,d=r[15]+"",h;return{c(){e=xe("li"),o=gt(n),c=gt(" = "),h=gt(d)},m(a,_){be(a,e,_),ce(e,o),ce(e,c),ce(e,h)},p(a,_){_&2&&n!==(n=a[14]+"")&&_i(o,n),_&2&&d!==(d=a[15]+"")&&_i(h,d)},d(a){a&&ye(e)}}}function My(r){let e=r[14].startsWith("sidewalk"),n,o=e&&Ay(r);return{c(){o&&o.c(),n=Mn()},m(c,d){o&&o.m(c,d),be(c,n,d)},p(c,d){d&2&&(e=c[14].startsWith("sidewalk")),e?o?o.p(c,d):(o=Ay(c),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(c){c&&ye(n),o&&o.d(c)}}}function Py(r){let e,n,o,c,d=r[19].map(fE).join(", ")+"",h,a,_,S;function k(){return r[10](r[19])}return{c(){e=xe("div"),n=xe("button"),o=xe("kbd"),o.textContent=`${r[18]+1}`,c=Ue(),h=gt(d),a=Ue(),he(n,"class","btn btn-secondary mb-1")},m(y,C){be(y,e,C),ce(e,n),ce(n,o),ce(n,c),ce(n,h),ce(e,a),_||(S=Ut(n,"click",k),_=!0)},p(y,C){r=y},d(y){y&&ye(e),_=!1,S()}}}function Ly(r){let e,n,o=r[14]+"",c,d,h,a=r[15]+"",_,S;return{c(){e=xe("tr"),n=xe("td"),c=gt(o),d=Ue(),h=xe("td"),_=gt(a),S=Ue()},m(k,y){be(k,e,y),ce(e,n),ce(n,c),ce(e,d),ce(e,h),ce(h,_),ce(e,S)},p(k,y){y&2&&o!==(o=k[14]+"")&&_i(c,o),y&2&&a!==(a=k[15]+"")&&_i(_,a)},d(k){k&&ye(e)}}}function zy(r){let e,n,o=r[1].properties.node_ids.join(", ")+"",c;return{c(){e=xe("p"),n=gt("Nodes: "),c=gt(o)},m(d,h){be(d,e,h),ce(e,n),ce(e,c)},p(d,h){h&2&&o!==(o=d[1].properties.node_ids.join(", ")+"")&&_i(c,o)},d(d){d&&ye(e)}}}function hE(r){let e,n,o,c,d,h,a=r[1].properties.id+"",_,S,k,y,C,E,T,M=ny[r[1].properties.kind]+"",R,N,z,V,Y,se,$,te,U,j,G,O,W,le;e=new Hl({props:{loading:r[3]}});let de=r[1].properties.problems.length&&Ty(r);function ve(We,pt){if(pt&2&&(Y=null),Y==null&&(Y=!!We[1].properties.kind.startsWith("Road")),Y)return uE;if(We[1].properties.kind=="Sidewalk"||We[1].properties.kind=="Other")return cE}let pe=ve(r,-1),we=pe&&pe(r),Te=Ni(Object.entries(r[1].properties.tags)),Ae=[];for(let We=0;We<Te.length;We+=1)Ae[We]=Ly(vy(r,Te,We));let ct=r[4]&&zy(r);return{c(){lt(e.$$.fragment),n=Ue(),o=xe("div"),c=xe("div"),d=xe("a"),h=gt("Way "),_=gt(a),k=gt(`
    (
    `),y=xe("a"),C=xe("i"),T=gt(`
    ) : `),R=gt(M),N=Ue(),z=xe("div"),de&&de.c(),V=Ue(),we&&we.c(),se=Ue(),$=xe("table"),te=xe("thead"),te.innerHTML="<tr><th>Key</th> <th>Value</th></tr>",U=Ue(),j=xe("tbody");for(let We=0;We<Ae.length;We+=1)Ae[We].c();G=Ue(),ct&&ct.c(),he(d,"href",S="https://www.openstreetmap.org/way/"+r[1].properties.id),he(d,"target","_blank"),he(C,"class","fa-solid fa-pencil"),he(y,"href",E="https://www.openstreetmap.org/edit?way="+r[1].properties.id),he(y,"target","_blank"),he(c,"class","card-header"),he($,"class","table table-bordered"),he(z,"class","card-body"),he(o,"class","card mb-5")},m(We,pt){ot(e,We,pt),be(We,n,pt),be(We,o,pt),ce(o,c),ce(c,d),ce(d,h),ce(d,_),ce(c,k),ce(c,y),ce(y,C),ce(c,T),ce(c,R),ce(o,N),ce(o,z),de&&de.m(z,null),ce(z,V),we&&we.m(z,null),ce(z,se),ce(z,$),ce($,te),ce($,U),ce($,j);for(let kt=0;kt<Ae.length;kt+=1)Ae[kt]&&Ae[kt].m(j,null);ce(z,G),ct&&ct.m(z,null),O=!0,W||(le=Ut(window,"keypress",r[8]),W=!0)},p(We,[pt]){const kt={};if(pt&8&&(kt.loading=We[3]),e.$set(kt),(!O||pt&2)&&a!==(a=We[1].properties.id+"")&&_i(_,a),(!O||pt&2&&S!==(S="https://www.openstreetmap.org/way/"+We[1].properties.id))&&he(d,"href",S),(!O||pt&2&&E!==(E="https://www.openstreetmap.org/edit?way="+We[1].properties.id))&&he(y,"href",E),(!O||pt&2)&&M!==(M=ny[We[1].properties.kind]+"")&&_i(R,M),We[1].properties.problems.length?de?(de.p(We,pt),pt&2&&Pe(de,1)):(de=Ty(We),de.c(),Pe(de,1),de.m(z,V)):de&&(nn(),De(de,1,1,()=>{de=null}),rn()),pe===(pe=ve(We,pt))&&we?we.p(We,pt):(we&&we.d(1),we=pe&&pe(We),we&&(we.c(),we.m(z,se))),pt&2){Te=Ni(Object.entries(We[1].properties.tags));let Je;for(Je=0;Je<Te.length;Je+=1){const wt=vy(We,Te,Je);Ae[Je]?Ae[Je].p(wt,pt):(Ae[Je]=Ly(wt),Ae[Je].c(),Ae[Je].m(j,null))}for(;Je<Ae.length;Je+=1)Ae[Je].d(1);Ae.length=Te.length}We[4]?ct?ct.p(We,pt):(ct=zy(We),ct.c(),ct.m(z,null)):ct&&(ct.d(1),ct=null)},i(We){O||(Pe(e.$$.fragment,We),Pe(de),O=!0)},o(We){De(e.$$.fragment,We),De(de),O=!1},d(We){We&&(ye(n),ye(o)),at(e,We),de&&de.d(),we&&we.d(),$n(Ae,We),ct&&ct.d(),W=!1,le()}}}const Oy=r=>[r.properties.label,r.properties.color],fE=r=>`${r[0]} = ${r[1]}`,dE=r=>`${r[0]} = ${r[1]}`;function pE(r,e,n){let o,c,d;Bt(r,Yr,N=>n(12,o=N)),Bt(r,er,N=>n(13,c=N)),Bt(r,wf,N=>n(4,d=N));let{pinnedWay:h}=e,{drawProblemDetails:a}=e,{showProblemDetails:_}=e,S="";async function k(N){n(3,S="Setting tags"),await fo();try{c.editSetTags(BigInt(h.properties.id),N),Qi(Yr,o++,o)}finally{n(3,S="")}}let y=[[["sidewalk:both","separate"]],[["sidewalk:left","separate"],["sidewalk:right","no"]],[["sidewalk:right","separate"],["sidewalk:left","no"]],[["sidewalk","both"]],[["sidewalk","left"]],[["sidewalk","right"]],[["sidewalk","no"]]],C=[[["footway","sidewalk"]],[["footway","crossing"]]];async function E(N){let z=[];h.properties.kind.startsWith("Road")?z=y:(h.properties.kind=="Sidewalk"||h.properties.kind=="Other")&&(z=C);let V=parseInt(N.key);Number.isInteger(V)&&V<=z.length&&await k(z[V-1])}function T(N){_=N,n(0,_)}const M=N=>k(N),R=N=>k(N);return r.$$set=N=>{"pinnedWay"in N&&n(1,h=N.pinnedWay),"drawProblemDetails"in N&&n(2,a=N.drawProblemDetails),"showProblemDetails"in N&&n(0,_=N.showProblemDetails)},[_,h,a,S,d,k,y,C,E,T,M,R]}class mE extends ai{constructor(e){super(),oi(this,e,pE,hE,Yt,{pinnedWay:1,drawProblemDetails:2,showProblemDetails:0})}}function Dy(r){var o;const e=((o=r[29])==null?void 0:o.properties)??{};r[30]=e;const n=JSON.parse(r[30].problems);r[31]=n}function Fy(r,e,n){const o=r.slice();return o[32]=e[n],o}function Ry(r,e,n){const o=r.slice();return o[35]=e[n][0],o[36]=e[n][1],o}function By(r){let e,n,o;function c(h){r[26](h)}let d={pinnedWay:r[2],drawProblemDetails:r[9]};return r[8]!==void 0&&(d.showProblemDetails=r[8]),e=new mE({props:d}),mi.push(()=>Ri(e,"showProblemDetails",c)),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,a){const _={};a[0]&4&&(_.pinnedWay=h[2]),a[0]&512&&(_.drawProblemDetails=h[9]),!n&&a[0]&256&&(n=!0,_.showProblemDetails=h[8],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function gE(r){let e,n,o,c,d,h,a,_,S,k,y;n=new qC({});function C(M){r[25](M)}let E={nodes:r[0],ways:r[1]};r[12]!==void 0&&(E.drawProblems=r[12]),c=new zC({props:E}),mi.push(()=>Ri(c,"drawProblems",C));let T=r[2]&&By(r);return _=new iE({}),k=new Mf({}),{c(){e=xe("div"),lt(n.$$.fragment),o=Ue(),lt(c.$$.fragment),h=Ue(),T&&T.c(),a=Ue(),lt(_.$$.fragment),S=Ue(),lt(k.$$.fragment),he(e,"slot","sidebar")},m(M,R){be(M,e,R),ot(n,e,null),ce(e,o),ot(c,e,null),ce(e,h),T&&T.m(e,null),ce(e,a),ot(_,e,null),ce(e,S),ot(k,e,null),y=!0},p(M,R){const N={};R[0]&1&&(N.nodes=M[0]),R[0]&2&&(N.ways=M[1]),!d&&R[0]&4096&&(d=!0,N.drawProblems=M[12],Fi(()=>d=!1)),c.$set(N),M[2]?T?(T.p(M,R),R[0]&4&&Pe(T,1)):(T=By(M),T.c(),Pe(T,1),T.m(e,a)):T&&(nn(),De(T,1,1,()=>{T=null}),rn())},i(M){y||(Pe(n.$$.fragment,M),Pe(c.$$.fragment,M),Pe(T),Pe(_.$$.fragment,M),Pe(k.$$.fragment,M),y=!0)},o(M){De(n.$$.fragment,M),De(c.$$.fragment,M),De(T),De(_.$$.fragment,M),De(k.$$.fragment,M),y=!1},d(M){M&&ye(e),at(n),at(c),T&&T.d(),at(_),at(k)}}}function Ny(r){let e,n,o=r[35]+"",c,d,h,a=r[36]+"",_,S;return{c(){e=xe("tr"),n=xe("td"),c=gt(o),d=Ue(),h=xe("td"),_=gt(a),S=Ue()},m(k,y){be(k,e,y),ce(e,n),ce(n,c),ce(e,d),ce(e,h),ce(h,_),ce(e,S)},p(k,y){y[0]&536870912&&o!==(o=k[35]+"")&&_i(c,o),y[0]&536870912&&a!==(a=k[36]+"")&&_i(_,a)},d(k){k&&ye(e)}}}function jy(r){let e,n,o,c=Ni(r[31]),d=[];for(let h=0;h<c.length;h+=1)d[h]=Uy(Fy(r,c,h));return{c(){e=xe("u"),e.textContent="Problems:",n=Ue();for(let h=0;h<d.length;h+=1)d[h].c();o=Mn()},m(h,a){be(h,e,a),be(h,n,a);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(h,a);be(h,o,a)},p(h,a){if(a[0]&536870912){c=Ni(h[31]);let _;for(_=0;_<c.length;_+=1){const S=Fy(h,c,_);d[_]?d[_].p(S,a):(d[_]=Uy(S),d[_].c(),d[_].m(o.parentNode,o))}for(;_<d.length;_+=1)d[_].d(1);d.length=c.length}},d(h){h&&(ye(e),ye(n),ye(o)),$n(d,h)}}}function Uy(r){let e,n=r[32].note+"",o;return{c(){e=xe("p"),o=gt(n)},m(c,d){be(c,e,d),ce(e,o)},p(c,d){d[0]&536870912&&n!==(n=c[32].note+"")&&_i(o,n)},d(c){c&&ye(e)}}}function _E(r){Dy(r);let e,n,o=r[30].id+"",c,d,h,a,_=r[30].way_ids+"",S,k,y,C,E,T,M=Ni(Object.entries(JSON.parse(r[30].tags||"{}"))),R=[];for(let z=0;z<M.length;z+=1)R[z]=Ny(Ry(r,M,z));let N=r[31].length&&jy(r);return{c(){e=xe("h4"),n=gt("Node "),c=gt(o),d=Ue(),h=xe("p"),a=gt("Ways: "),S=gt(_),k=Ue(),y=xe("table"),C=xe("tbody");for(let z=0;z<R.length;z+=1)R[z].c();E=Ue(),N&&N.c(),T=Mn(),he(y,"class","table table-bordered")},m(z,V){be(z,e,V),ce(e,n),ce(e,c),be(z,d,V),be(z,h,V),ce(h,a),ce(h,S),be(z,k,V),be(z,y,V),ce(y,C);for(let Y=0;Y<R.length;Y+=1)R[Y]&&R[Y].m(C,null);be(z,E,V),N&&N.m(z,V),be(z,T,V)},p(z,V){if(Dy(z),V[0]&536870912&&o!==(o=z[30].id+"")&&_i(c,o),V[0]&536870912&&_!==(_=z[30].way_ids+"")&&_i(S,_),V[0]&536870912){M=Ni(Object.entries(JSON.parse(z[30].tags||"{}")));let Y;for(Y=0;Y<M.length;Y+=1){const se=Ry(z,M,Y);R[Y]?R[Y].p(se,V):(R[Y]=Ny(se),R[Y].c(),R[Y].m(C,null))}for(;Y<R.length;Y+=1)R[Y].d(1);R.length=M.length}z[31].length?N?N.p(z,V):(N=jy(z),N.c(),N.m(T.parentNode,T)):N&&(N.d(1),N=null)},d(z){z&&(ye(e),ye(d),ye(h),ye(k),ye(y),ye(E),ye(T)),$n(R,z),N&&N.d(z)}}}function yE(r){let e,n;return e=new Cp({props:{openOn:"hover",$$slots:{default:[_E,({data:o})=>({29:o}),({data:o})=>[o?536870912:0]]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c[0]&536870912|c[1]&256&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function bE(r){let e,n;return e=new Gl({props:{id:"nodes",beforeId:"Road labels",manageHoverState:!0,paint:{"circle-radius":7,"circle-color":["case",["get","is_crossing"],"yellow","grey"],"circle-opacity":["case",["boolean",["get","is_crossing"]],r[4]?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1},layout:{visibility:r[3]?"visible":"none"},$$slots:{default:[yE]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c[0]&16&&(d.paint={"circle-radius":7,"circle-color":["case",["get","is_crossing"],"yellow","grey"],"circle-opacity":["case",["boolean",["get","is_crossing"]],o[4]?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1}),c[0]&8&&(d.layout={visibility:o[3]?"visible":"none"}),c[1]&256&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function vE(r){let e;return{c(){e=xe("div"),e.textContent="Layers",he(e,"slot","header")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function wE(r){let e;return{c(){e=gt("Debug mode")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function xE(r){let e;return{c(){e=gt("Nodes")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function kE(r){let e;return{c(){e=gt("Only modified objects")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function SE(r){let e;return{c(){e=gt("Only show major roads")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function TE(r){let e;return{c(){e=gt("Show service roads")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function CE(r){let e;return{c(){e=gt("Show each side with sidewalks  or not ")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function EE(r){let e,n,o,c,d,h,a,_,S;function k(R){r[21](R)}let y={$$slots:{default:[SE]},$$scope:{ctx:r}};r[5]!==void 0&&(y.checked=r[5]),e=new Qn({props:y}),mi.push(()=>Ri(e,"checked",k));function C(R){r[22](R)}let E={$$slots:{default:[TE]},$$scope:{ctx:r}};r[6]!==void 0&&(E.checked=r[6]),c=new Qn({props:E}),mi.push(()=>Ri(c,"checked",C));function T(R){r[23](R)}let M={$$slots:{default:[CE]},$$scope:{ctx:r}};return r[10]!==void 0&&(M.checked=r[10]),a=new Qn({props:M}),mi.push(()=>Ri(a,"checked",T)),{c(){lt(e.$$.fragment),o=Ue(),lt(c.$$.fragment),h=Ue(),lt(a.$$.fragment)},m(R,N){ot(e,R,N),be(R,o,N),ot(c,R,N),be(R,h,N),ot(a,R,N),S=!0},p(R,N){const z={};N[1]&256&&(z.$$scope={dirty:N,ctx:R}),!n&&N[0]&32&&(n=!0,z.checked=R[5],Fi(()=>n=!1)),e.$set(z);const V={};N[1]&256&&(V.$$scope={dirty:N,ctx:R}),!d&&N[0]&64&&(d=!0,V.checked=R[6],Fi(()=>d=!1)),c.$set(V);const Y={};N[1]&256&&(Y.$$scope={dirty:N,ctx:R}),!_&&N[0]&1024&&(_=!0,Y.checked=R[10],Fi(()=>_=!1)),a.$set(Y)},i(R){S||(Pe(e.$$.fragment,R),Pe(c.$$.fragment,R),Pe(a.$$.fragment,R),S=!0)},o(R){De(e.$$.fragment,R),De(c.$$.fragment,R),De(a.$$.fragment,R),S=!1},d(R){R&&(ye(o),ye(h)),at(e,R),at(c,R),at(a,R)}}}function IE(r){let e,n,o,c,d,h,a,_,S,k,y,C,E;function T($){r[18]($)}let M={$$slots:{default:[wE]},$$scope:{ctx:r}};r[13]!==void 0&&(M.checked=r[13]),n=new Qn({props:M}),mi.push(()=>Ri(n,"checked",T));function R($){r[19]($)}let N={$$slots:{default:[xE]},$$scope:{ctx:r}};r[3]!==void 0&&(N.checked=r[3]),d=new Qn({props:N}),mi.push(()=>Ri(d,"checked",R));function z($){r[20]($)}let V={$$slots:{default:[kE]},$$scope:{ctx:r}};r[4]!==void 0&&(V.checked=r[4]),_=new Qn({props:V}),mi.push(()=>Ri(_,"checked",z));function Y($){r[24]($)}let se={$$slots:{default:[EE]},$$scope:{ctx:r}};return r[7]!==void 0&&(se.showKinds=r[7]),y=new aE({props:se}),mi.push(()=>Ri(y,"showKinds",Y)),{c(){e=xe("div"),lt(n.$$.fragment),c=Ue(),lt(d.$$.fragment),a=Ue(),lt(_.$$.fragment),k=Ue(),lt(y.$$.fragment),he(e,"slot","body")},m($,te){be($,e,te),ot(n,e,null),ce(e,c),ot(d,e,null),ce(e,a),ot(_,e,null),ce(e,k),ot(y,e,null),E=!0},p($,te){const U={};te[1]&256&&(U.$$scope={dirty:te,ctx:$}),!o&&te[0]&8192&&(o=!0,U.checked=$[13],Fi(()=>o=!1)),n.$set(U);const j={};te[1]&256&&(j.$$scope={dirty:te,ctx:$}),!h&&te[0]&8&&(h=!0,j.checked=$[3],Fi(()=>h=!1)),d.$set(j);const G={};te[1]&256&&(G.$$scope={dirty:te,ctx:$}),!S&&te[0]&16&&(S=!0,G.checked=$[4],Fi(()=>S=!1)),_.$set(G);const O={};te[0]&1120|te[1]&256&&(O.$$scope={dirty:te,ctx:$}),!C&&te[0]&128&&(C=!0,O.showKinds=$[7],Fi(()=>C=!1)),y.$set(O)},i($){E||(Pe(n.$$.fragment,$),Pe(d.$$.fragment,$),Pe(_.$$.fragment,$),Pe(y.$$.fragment,$),E=!0)},o($){De(n.$$.fragment,$),De(d.$$.fragment,$),De(_.$$.fragment,$),De(y.$$.fragment,$),E=!1},d($){$&&ye(e),at(n),at(d),at(_),at(y)}}}function AE(r){let e,n;return e=new _a({props:{$$slots:{body:[IE],header:[vE]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c[0]&9464|c[1]&256&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function ME(r){let e,n,o,c,d,h,a,_,S,k,y;function C(M){r[16](M)}function E(M){r[17](M)}let T={showProblemDetails:r[8],nodes:r[0],ways:r[1],showRoadSides:r[10],filterWays:r[14](r[5],r[4],r[6],r[7])};return r[2]!==void 0&&(T.pinnedWay=r[2]),r[9]!==void 0&&(T.drawProblemDetails=r[9]),n=new fC({props:T}),mi.push(()=>Ri(n,"pinnedWay",C)),mi.push(()=>Ri(n,"drawProblemDetails",E)),h=new RC({props:{drawProblems:r[12],pinnedWay:r[2]}}),_=new Ir({props:{data:r[0],$$slots:{default:[bE]},$$scope:{ctx:r}}}),k=new aS({props:{position:"top-right",$$slots:{default:[AE]},$$scope:{ctx:r}}}),{c(){e=xe("div"),lt(n.$$.fragment),d=Ue(),lt(h.$$.fragment),a=Ue(),lt(_.$$.fragment),S=Ue(),lt(k.$$.fragment),he(e,"slot","map")},m(M,R){be(M,e,R),ot(n,e,null),ce(e,d),ot(h,e,null),ce(e,a),ot(_,e,null),ce(e,S),ot(k,e,null),y=!0},p(M,R){const N={};R[0]&256&&(N.showProblemDetails=M[8]),R[0]&1&&(N.nodes=M[0]),R[0]&2&&(N.ways=M[1]),R[0]&1024&&(N.showRoadSides=M[10]),R[0]&240&&(N.filterWays=M[14](M[5],M[4],M[6],M[7])),!o&&R[0]&4&&(o=!0,N.pinnedWay=M[2],Fi(()=>o=!1)),!c&&R[0]&512&&(c=!0,N.drawProblemDetails=M[9],Fi(()=>c=!1)),n.$set(N);const z={};R[0]&4096&&(z.drawProblems=M[12]),R[0]&4&&(z.pinnedWay=M[2]),h.$set(z);const V={};R[0]&1&&(V.data=M[0]),R[0]&24|R[1]&256&&(V.$$scope={dirty:R,ctx:M}),_.$set(V);const Y={};R[0]&9464|R[1]&256&&(Y.$$scope={dirty:R,ctx:M}),k.$set(Y)},i(M){y||(Pe(n.$$.fragment,M),Pe(h.$$.fragment,M),Pe(_.$$.fragment,M),Pe(k.$$.fragment,M),y=!0)},o(M){De(n.$$.fragment,M),De(h.$$.fragment,M),De(_.$$.fragment,M),De(k.$$.fragment,M),y=!1},d(M){M&&ye(e),at(n),at(h),at(_),at(k)}}}function PE(r){let e,n,o,c;return e=new Hl({props:{loading:r[11]}}),o=new xh({props:{$$slots:{map:[ME],sidebar:[gE]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment)},m(d,h){ot(e,d,h),be(d,n,h),ot(o,d,h),c=!0},p(d,h){const a={};h[0]&2048&&(a.loading=d[11]),e.$set(a);const _={};h[0]&14335|h[1]&256&&(_.$$scope={dirty:h,ctx:d}),o.$set(_)},i(d){c||(Pe(e.$$.fragment,d),Pe(o.$$.fragment,d),c=!0)},o(d){De(e.$$.fragment,d),De(o.$$.fragment,d),c=!1},d(d){d&&ye(n),at(e,d),at(o,d)}}}function LE(r,e,n){let o,c,d;Bt(r,er,pe=>n(27,o=pe)),Bt(r,Yr,pe=>n(15,c=pe)),Bt(r,wf,pe=>n(13,d=pe));let h={type:"FeatureCollection",features:[]},a={type:"FeatureCollection",features:[]},_=null,S=!1,k=!1,y=!1,C=!0,E=Object.fromEntries(Object.keys(Xl).map(pe=>[pe,!0])),T=!0,M=or(),R=!1,N="",z=or();async function V(pe){n(11,N="Recalculating model"),await fo();try{n(0,h=JSON.parse(o.getNodes())),n(1,a=JSON.parse(o.getWays()))}finally{n(11,N="")}if(_){let we=_.id;n(2,_=a.features.find(Te=>Te.id==we))}}function Y(pe,we,Te,Ae){let ct=[];return y&&ct.push(["any",["in",["get","kind"],["literal",["Sidewalk","Crossing","Other"]]],["get","is_severance"]]),C||ct.push(["!",["get","is_service"]]),k&&ct.push(["get","modified"]),ct.push(["in",["get","kind"],["literal",Object.entries(E).filter(We=>We[1]).map(We=>We[0])]]),["all",...ct]}function se(pe){_=pe,n(2,_)}function $(pe){M=pe,n(9,M)}function te(pe){d=pe,wf.set(d)}function U(pe){S=pe,n(3,S)}function j(pe){k=pe,n(4,k)}function G(pe){y=pe,n(5,y)}function O(pe){C=pe,n(6,C)}function W(pe){R=pe,n(10,R)}function le(pe){E=pe,n(7,E)}function de(pe){z=pe,n(12,z)}function ve(pe){T=pe,n(8,T)}return r.$$.update=()=>{r.$$.dirty[0]&32768&&V()},[h,a,_,S,k,y,C,E,T,M,R,N,z,d,Y,c,se,$,te,U,j,G,O,W,le,de,ve]}class zE extends ai{constructor(e){super(),oi(this,e,LE,PE,Yt,{},null,[-1,-1])}}function OE(r){let e,n,o;return{c(){e=xe("button"),e.textContent="Bulk operations",he(e,"class","btn btn-secondary")},m(c,d){be(c,e,d),n||(o=Ut(e,"click",r[6]),n=!0)},p:Ot,i:Ot,o:Ot,d(c){c&&ye(e),n=!1,o()}}}function DE(r){let e,n;return e=new _a({props:{$$slots:{body:[RE],header:[FE]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&2048&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function FE(r){let e;return{c(){e=xe("div"),e.textContent="Bulk operations",he(e,"slot","header")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function RE(r){let e,n,o,c;return{c(){e=xe("div"),n=xe("button"),n.textContent="Generate imaginary crossings where they're missing",he(n,"class","btn btn-secondary"),he(e,"slot","body")},m(d,h){be(d,e,h),ce(e,n),o||(c=Ut(n,"click",r[4]),o=!0)},p:Ot,d(d){d&&ye(e),o=!1,c()}}}function BE(r){let e,n,o,c,d,h,a,_,S;return{c(){e=xe("h2"),e.textContent="Bulk operations",n=Ue(),o=xe("p"),o.innerHTML=`Speedwalk has some experimental features that can automatically generate
    crossing nodes on every arm of a junction where they&#39;re expected. This is
    intended <b>only</b>
    for use in other projects to study the potential benefits of having more crossings.
    Do not ever upload the results of this to OSM.`,c=Ue(),d=xe("button"),d.textContent="I understand",h=Ue(),a=xe("button"),a.textContent="Cancel",he(d,"class","btn btn-primary"),he(a,"class","btn btn-secondary")},m(k,y){be(k,e,y),be(k,n,y),be(k,o,y),be(k,c,y),be(k,d,y),be(k,h,y),be(k,a,y),_||(S=[Ut(d,"click",r[3]),Ut(a,"click",r[7])],_=!0)},p:Ot,d(k){k&&(ye(e),ye(n),ye(o),ye(c),ye(d),ye(h),ye(a)),_=!1,jn(S)}}}function NE(r){let e,n,o,c,d,h,a,_;e=new Hl({props:{loading:r[1]}});const S=[DE,OE],k=[];function y(T,M){return T[2]?0:1}o=y(r),c=k[o]=S[o](r);function C(T){r[8](T)}let E={$$slots:{default:[BE]},$$scope:{ctx:r}};return r[0]!==void 0&&(E.show=r[0]),h=new Af({props:E}),mi.push(()=>Ri(h,"show",C)),{c(){lt(e.$$.fragment),n=Ue(),c.c(),d=Ue(),lt(h.$$.fragment)},m(T,M){ot(e,T,M),be(T,n,M),k[o].m(T,M),be(T,d,M),ot(h,T,M),_=!0},p(T,[M]){const R={};M&2&&(R.loading=T[1]),e.$set(R);let N=o;o=y(T),o===N?k[o].p(T,M):(nn(),De(k[N],1,1,()=>{k[N]=null}),rn(),c=k[o],c?c.p(T,M):(c=k[o]=S[o](T),c.c()),Pe(c,1),c.m(d.parentNode,d));const z={};M&2049&&(z.$$scope={dirty:M,ctx:T}),!a&&M&1&&(a=!0,z.show=T[0],Fi(()=>a=!1)),h.$set(z)},i(T){_||(Pe(e.$$.fragment,T),Pe(c),Pe(h.$$.fragment,T),_=!0)},o(T){De(e.$$.fragment,T),De(c),De(h.$$.fragment,T),_=!1},d(T){T&&(ye(n),ye(d)),at(e,T),k[o].d(T),at(h,T)}}}function jE(r,e,n){let o,c,d;Bt(r,Yr,T=>n(9,o=T)),Bt(r,er,T=>n(10,c=T)),Bt(r,vf,T=>n(2,d=T));let{options:h}=e,a=!1;function _(){Qi(vf,d=!0,d),n(0,a=!1)}let S="";async function k(){n(1,S="Generating missing crossings"),await fo();try{c.editGenerateMissingCrossings(h),Qi(Yr,o++,o)}catch(T){window.alert(`Error: ${T}`)}finally{n(1,S="")}}const y=()=>n(0,a=!0),C=()=>n(0,a=!1);function E(T){a=T,n(0,a)}return r.$$set=T=>{"options"in T&&n(5,h=T.options)},[a,S,d,_,k,h,y,C,E]}class UE extends ai{constructor(e){super(),oi(this,e,jE,NE,Yt,{options:5})}}function Vy(r){var n;const e=((n=r[4])==null?void 0:n.properties)??{};r[24]=e}function qy(r,e,n){const o=r.slice();return o[25]=e[n][0],o[26]=e[n][1],o}function Zy(r){let e,n,o=r[9].features.length-r[6]+"",c,d,h,a,_,S=r[8]==1?"crossing":"crossings",k,y,C,E,T,M,R,N=r[0].max_distance+"",z,V,Y=r[6]>0&&Wy(r),se=r[7]>0&&Gy(r);return{c(){e=xe("p"),n=gt("Junction has "),c=gt(o),d=gt(` arms
        `),Y&&Y.c(),h=gt(`,
        `),a=gt(r[8]),_=Ue(),k=gt(S),y=Ue(),se&&se.c(),C=gt("."),E=Ue(),T=xe("p"),M=xe("i"),R=gt("Arms are up to "),z=gt(N),V=gt(`m away from the junction along
          the same OSM way. If the way is split before a crossing, the crossing
          won't be counted. Only the first crossing is counted per arm.`),he(T,"class","mb-3")},m($,te){be($,e,te),ce(e,n),ce(e,c),ce(e,d),Y&&Y.m(e,null),ce(e,h),ce(e,a),ce(e,_),ce(e,k),ce(e,y),se&&se.m(e,null),ce(e,C),be($,E,te),be($,T,te),ce(T,M),ce(M,R),ce(M,z),ce(M,V)},p($,te){te&576&&o!==(o=$[9].features.length-$[6]+"")&&_i(c,o),$[6]>0?Y?Y.p($,te):(Y=Wy($),Y.c(),Y.m(e,h)):Y&&(Y.d(1),Y=null),te&256&&_i(a,$[8]),te&256&&S!==(S=$[8]==1?"crossing":"crossings")&&_i(k,S),$[7]>0?se?se.p($,te):(se=Gy($),se.c(),se.m(e,C)):se&&(se.d(1),se=null),te&1&&N!==(N=$[0].max_distance+"")&&_i(z,N)},d($){$&&(ye(e),ye(E),ye(T)),Y&&Y.d(),se&&se.d()}}}function Wy(r){let e,n,o,c=r[6]==1?"arm":"arms",d,h;return{c(){e=gt("(plus "),n=gt(r[6]),o=Ue(),d=gt(c),h=gt(` not expected to have crossings)
        `)},m(a,_){be(a,e,_),be(a,n,_),be(a,o,_),be(a,d,_),be(a,h,_)},p(a,_){_&64&&_i(n,a[6]),_&64&&c!==(c=a[6]==1?"arm":"arms")&&_i(d,c)},d(a){a&&(ye(e),ye(n),ye(o),ye(d),ye(h))}}}function Gy(r){let e,n,o,c=r[7]==1?"non-crossing":"non-crossings",d,h;return{c(){e=gt(", "),n=gt(r[7]),o=gt(" explicit "),d=gt(c),h=Ue()},m(a,_){be(a,e,_),be(a,n,_),be(a,o,_),be(a,d,_),be(a,h,_)},p(a,_){_&128&&_i(n,a[7]),_&128&&c!==(c=a[7]==1?"non-crossing":"non-crossings")&&_i(d,c)},d(a){a&&(ye(e),ye(n),ye(o),ye(d),ye(h))}}}function VE(r){let e;return{c(){e=xe("div"),e.textContent="Settings",he(e,"slot","header")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function qE(r){let e;return{c(){e=gt("Only junctions on major roads")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function ZE(r){let e,n,o,c,d;return{c(){e=gt("Ignore "),n=xe("code"),n.textContent="service",o=gt(`
          ,
          `),c=xe("code"),c.textContent="track",d=gt(`
          roads`)},m(h,a){be(h,e,a),be(h,n,a),be(h,o,a),be(h,c,a),be(h,d,a)},p:Ot,d(h){h&&(ye(e),ye(n),ye(o),ye(c),ye(d))}}}function WE(r){let e;return{c(){e=gt("Ignore cycleways")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function GE(r){let e,n,o,c;return{c(){e=gt("Ignore "),n=xe("code"),n.textContent="footway",o=gt(`
          and
          `),c=xe("code"),c.textContent="path"},m(d,h){be(d,e,h),be(d,n,h),be(d,o,h),be(d,c,h)},p:Ot,d(d){d&&(ye(e),ye(n),ye(o),ye(c))}}}function HE(r){let e;return{c(){e=gt("Don't expect crossings on roundabouts")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function XE(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N,z,V,Y,se,$,te;function U(Te){r[16](Te)}let j={$$slots:{default:[qE]},$$scope:{ctx:r}};r[0].only_major_roads!==void 0&&(j.checked=r[0].only_major_roads),n=new Qn({props:j}),mi.push(()=>Ri(n,"checked",U));function G(Te){r[17](Te)}let O={$$slots:{default:[ZE]},$$scope:{ctx:r}};r[0].ignore_utility_roads!==void 0&&(O.checked=r[0].ignore_utility_roads),d=new Qn({props:O}),mi.push(()=>Ri(d,"checked",G));function W(Te){r[18](Te)}let le={$$slots:{default:[WE]},$$scope:{ctx:r}};r[0].ignore_cycleways!==void 0&&(le.checked=r[0].ignore_cycleways),_=new Qn({props:le}),mi.push(()=>Ri(_,"checked",W));function de(Te){r[19](Te)}let ve={$$slots:{default:[GE]},$$scope:{ctx:r}};r[0].ignore_footways!==void 0&&(ve.checked=r[0].ignore_footways),y=new Qn({props:ve}),mi.push(()=>Ri(y,"checked",de));function pe(Te){r[20](Te)}let we={$$slots:{default:[HE]},$$scope:{ctx:r}};return r[0].ignore_roundabouts!==void 0&&(we.checked=r[0].ignore_roundabouts),T=new Qn({props:we}),mi.push(()=>Ri(T,"checked",pe)),{c(){e=xe("div"),lt(n.$$.fragment),c=Ue(),lt(d.$$.fragment),a=Ue(),lt(_.$$.fragment),k=Ue(),lt(y.$$.fragment),E=Ue(),lt(T.$$.fragment),R=Ue(),N=xe("div"),z=xe("label"),V=gt(`How far away can a crossing be? (m):
            `),Y=xe("input"),he(Y,"class","form-control"),he(Y,"type","number"),he(Y,"min","1"),he(Y,"max","100"),he(z,"class","form-label"),he(e,"slot","body")},m(Te,Ae){be(Te,e,Ae),ot(n,e,null),ce(e,c),ot(d,e,null),ce(e,a),ot(_,e,null),ce(e,k),ot(y,e,null),ce(e,E),ot(T,e,null),ce(e,R),ce(e,N),ce(N,z),ce(z,V),ce(z,Y),mr(Y,r[0].max_distance),se=!0,$||(te=Ut(Y,"input",r[21]),$=!0)},p(Te,Ae){const ct={};Ae&536870912&&(ct.$$scope={dirty:Ae,ctx:Te}),!o&&Ae&1&&(o=!0,ct.checked=Te[0].only_major_roads,Fi(()=>o=!1)),n.$set(ct);const We={};Ae&536870912&&(We.$$scope={dirty:Ae,ctx:Te}),!h&&Ae&1&&(h=!0,We.checked=Te[0].ignore_utility_roads,Fi(()=>h=!1)),d.$set(We);const pt={};Ae&536870912&&(pt.$$scope={dirty:Ae,ctx:Te}),!S&&Ae&1&&(S=!0,pt.checked=Te[0].ignore_cycleways,Fi(()=>S=!1)),_.$set(pt);const kt={};Ae&536870912&&(kt.$$scope={dirty:Ae,ctx:Te}),!C&&Ae&1&&(C=!0,kt.checked=Te[0].ignore_footways,Fi(()=>C=!1)),y.$set(kt);const Je={};Ae&536870912&&(Je.$$scope={dirty:Ae,ctx:Te}),!M&&Ae&1&&(M=!0,Je.checked=Te[0].ignore_roundabouts,Fi(()=>M=!1)),T.$set(Je),Ae&1&&u0(Y.value)!==Te[0].max_distance&&mr(Y,Te[0].max_distance)},i(Te){se||(Pe(n.$$.fragment,Te),Pe(d.$$.fragment,Te),Pe(_.$$.fragment,Te),Pe(y.$$.fragment,Te),Pe(T.$$.fragment,Te),se=!0)},o(Te){De(n.$$.fragment,Te),De(d.$$.fragment,Te),De(_.$$.fragment,Te),De(y.$$.fragment,Te),De(T.$$.fragment,Te),se=!1},d(Te){Te&&ye(e),at(n),at(d),at(_),at(y),at(T),$=!1,te()}}}function KE(r){let e;return{c(){e=xe("div"),e.textContent="Legend",he(e,"slot","header")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function JE(r){let e,n,o;return n=new Ep({props:{labelColors:r[12],itemsPerRow:1,swatchClass:"circle"}}),{c(){e=xe("div"),lt(n.$$.fragment),he(e,"slot","body")},m(c,d){be(c,e,d),ot(n,e,null),o=!0},p:Ot,i(c){o||(Pe(n.$$.fragment,c),o=!0)},o(c){De(n.$$.fragment,c),o=!1},d(c){c&&ye(e),at(n)}}}function YE(r){let e,n,o,c,d=r[10].toLocaleString()+"",h,a,_=r[4].features.length.toLocaleString()+"",S,k,y,C,E,T,M,R,N,z,V,Y,se,$,te,U,j=r[1]&&Zy(r);return N=new _a({props:{$$slots:{body:[XE],header:[VE]},$$scope:{ctx:r}}}),V=new _a({props:{$$slots:{body:[JE],header:[KE]},$$scope:{ctx:r}}}),se=new UE({props:{options:r[0]}}),te=new Mf({}),{c(){e=xe("div"),n=xe("h4"),n.textContent="Crossings audit",o=Ue(),c=xe("p"),h=gt(d),a=gt(" / "),S=gt(_),k=gt(`
      junctions have all possible crossings mapped`),y=Ue(),j&&j.c(),C=Ue(),E=xe("hr"),T=Ue(),M=xe("p"),M.innerHTML=`For each junction shown, this tool looks for crossing nodes on each arm
      (road) of the junction. Please map a crossing node on each arm by clicking
      to open in iD, then refreshing data here to check. If there&#39;s no way to
      cross an arm, use <a href="https://wiki.openstreetmap.org/wiki/Tag:crossing=no" target="_blank">crossing=no</a>
      to indicate a lack of a crossing. Please ignore cases where you would not expect
      any crossing to be (and report a bug to improve this tool).`,R=Ue(),lt(N.$$.fragment),z=Ue(),lt(V.$$.fragment),Y=Ue(),lt(se.$$.fragment),$=Ue(),lt(te.$$.fragment),he(e,"slot","sidebar")},m(G,O){be(G,e,O),ce(e,n),ce(e,o),ce(e,c),ce(c,h),ce(c,a),ce(c,S),ce(c,k),ce(e,y),j&&j.m(e,null),ce(e,C),ce(e,E),ce(e,T),ce(e,M),ce(e,R),ot(N,e,null),ce(e,z),ot(V,e,null),ce(e,Y),ot(se,e,null),ce(e,$),ot(te,e,null),U=!0},p(G,O){(!U||O&1024)&&d!==(d=G[10].toLocaleString()+"")&&_i(h,d),(!U||O&16)&&_!==(_=G[4].features.length.toLocaleString()+"")&&_i(S,_),G[1]?j?j.p(G,O):(j=Zy(G),j.c(),j.m(e,C)):j&&(j.d(1),j=null);const W={};O&536870913&&(W.$$scope={dirty:O,ctx:G}),N.$set(W);const le={};O&536870912&&(le.$$scope={dirty:O,ctx:G}),V.$set(le);const de={};O&1&&(de.options=G[0]),se.$set(de)},i(G){U||(Pe(N.$$.fragment,G),Pe(V.$$.fragment,G),Pe(se.$$.fragment,G),Pe(te.$$.fragment,G),U=!0)},o(G){De(N.$$.fragment,G),De(V.$$.fragment,G),De(se.$$.fragment,G),De(te.$$.fragment,G),U=!1},d(G){G&&ye(e),j&&j.d(),at(N),at(V),at(se),at(te)}}}function QE(r){let e,n,o;function c(h){r[15](h)}let d={manageHoverState:!0,paint:{"circle-radius":15,"circle-color":["case",["get","complete"],r[12]["Fully mapped junction"],r[12]["Junction to audit"]],"circle-opacity":mh(.5,1),"circle-stroke-color":"black","circle-stroke-width":3},hoverCursor:"pointer"};return r[1]!==void 0&&(d.hovered=r[1]),e=new Gl({props:d}),mi.push(()=>Ri(e,"hovered",c)),e.$on("click",r[11]),{c(){lt(e.$$.fragment)},m(h,a){ot(e,h,a),o=!0},p(h,a){const _={};!n&&a&2&&(n=!0,_.hovered=h[1],Fi(()=>n=!1)),e.$set(_)},i(h){o||(Pe(e.$$.fragment,h),o=!0)},o(h){De(e.$$.fragment,h),o=!1},d(h){at(e,h)}}}function $E(r){let e,n;return e=new ga({props:{paint:{"line-width":6,"line-color":["case",["get","has_crossing"],"blue","red"]}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p:Ot,i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function Hy(r){let e,n,o=r[25]+"",c,d,h,a=r[26]+"",_,S;return{c(){e=xe("tr"),n=xe("td"),c=gt(o),d=Ue(),h=xe("td"),_=gt(a),S=Ue()},m(k,y){be(k,e,y),ce(e,n),ce(n,c),ce(e,d),ce(e,h),ce(h,_),ce(e,S)},p(k,y){y&16&&o!==(o=k[25]+"")&&_i(c,o),y&16&&a!==(a=k[26]+"")&&_i(_,a)},d(k){k&&ye(e)}}}function e3(r){Vy(r);let e,n,o=r[24].id+"",c,d,h,a,_=Ni(Object.entries(JSON.parse(r[24].tags||"{}"))),S=[];for(let k=0;k<_.length;k+=1)S[k]=Hy(qy(r,_,k));return{c(){e=xe("h4"),n=gt("Node "),c=gt(o),d=Ue(),h=xe("table"),a=xe("tbody");for(let k=0;k<S.length;k+=1)S[k].c();he(h,"class","table table-bordered")},m(k,y){be(k,e,y),ce(e,n),ce(e,c),be(k,d,y),be(k,h,y),ce(h,a);for(let C=0;C<S.length;C+=1)S[C]&&S[C].m(a,null)},p(k,y){if(Vy(k),y&16&&o!==(o=k[24].id+"")&&_i(c,o),y&16){_=Ni(Object.entries(JSON.parse(k[24].tags||"{}")));let C;for(C=0;C<_.length;C+=1){const E=qy(k,_,C);S[C]?S[C].p(E,y):(S[C]=Hy(E),S[C].c(),S[C].m(a,null))}for(;C<S.length;C+=1)S[C].d(1);S.length=_.length}},d(k){k&&(ye(e),ye(d),ye(h)),$n(S,k)}}}function t3(r){let e,n;return e=new Cp({props:{openOn:"hover",$$slots:{default:[e3,({data:o})=>({4:o}),({data:o})=>o?16:0]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&536870928&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function i3(r){let e,n;return e=new Gl({props:{manageHoverState:!0,paint:{"circle-radius":7,"circle-color":["case",["get","is_explicit_crossing_no"],r[12]["crossing=no"],["get","is_imaginary_crossing"],r[12]["crossing=imaginary"],r[12].Crossing],"circle-opacity":mh(.3,1),"circle-stroke-color":"black","circle-stroke-width":1},$$slots:{default:[t3]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&536870928&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function n3(r){let e,n;return e=new Gl({props:{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"black","circle-stroke-width":3}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p:Ot,i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function r3(r){let e,n;return e=new Gl({props:{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"purple","circle-stroke-width":3}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p:Ot,i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function s3(r){let e,n,o,c,d,h,a,_,S,k,y;return n=new Ir({props:{data:r[4],generateId:!0,$$slots:{default:[QE]},$$scope:{ctx:r}}}),c=new Ir({props:{data:r[9],$$slots:{default:[$E]},$$scope:{ctx:r}}}),h=new Ir({props:{data:r[5],generateId:!0,$$slots:{default:[i3]},$$scope:{ctx:r}}}),_=new Ir({props:{data:r[3],$$slots:{default:[n3]},$$scope:{ctx:r}}}),k=new Ir({props:{data:r[2],$$slots:{default:[r3]},$$scope:{ctx:r}}}),{c(){e=xe("div"),lt(n.$$.fragment),o=Ue(),lt(c.$$.fragment),d=Ue(),lt(h.$$.fragment),a=Ue(),lt(_.$$.fragment),S=Ue(),lt(k.$$.fragment),he(e,"slot","map")},m(C,E){be(C,e,E),ot(n,e,null),ce(e,o),ot(c,e,null),ce(e,d),ot(h,e,null),ce(e,a),ot(_,e,null),ce(e,S),ot(k,e,null),y=!0},p(C,E){const T={};E&16&&(T.data=C[4]),E&536870914&&(T.$$scope={dirty:E,ctx:C}),n.$set(T);const M={};E&512&&(M.data=C[9]),E&536870912&&(M.$$scope={dirty:E,ctx:C}),c.$set(M);const R={};E&32&&(R.data=C[5]),E&536870928&&(R.$$scope={dirty:E,ctx:C}),h.$set(R);const N={};E&8&&(N.data=C[3]),E&536870912&&(N.$$scope={dirty:E,ctx:C}),_.$set(N);const z={};E&4&&(z.data=C[2]),E&536870912&&(z.$$scope={dirty:E,ctx:C}),k.$set(z)},i(C){y||(Pe(n.$$.fragment,C),Pe(c.$$.fragment,C),Pe(h.$$.fragment,C),Pe(_.$$.fragment,C),Pe(k.$$.fragment,C),y=!0)},o(C){De(n.$$.fragment,C),De(c.$$.fragment,C),De(h.$$.fragment,C),De(_.$$.fragment,C),De(k.$$.fragment,C),y=!1},d(C){C&&ye(e),at(n),at(c),at(h),at(_),at(k)}}}function o3(r){let e,n;return e=new xh({props:{$$slots:{map:[s3],sidebar:[YE]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,[c]){const d={};c&536872959&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function a3(r,e,n){let o,c,d,h,a,_,S,k,y,C,E,T;Bt(r,ya,O=>n(22,C=O)),Bt(r,er,O=>n(13,E=O)),Bt(r,Yr,O=>n(14,T=O));let M={only_major_roads:!0,ignore_utility_roads:!0,ignore_cycleways:!0,ignore_footways:!0,ignore_roundabouts:!0,max_distance:30},R=null;function N(O){if(!E)return or();let W=JSON.parse(E.getNodes());return W.features=W.features.filter(le=>le.properties.is_crossing||le.properties.is_explicit_crossing_no),W}function z(){let O=kb(C);if(O){let W=Sb(O.zoom,O.lat,O.lng);window.open(W,"_blank","noopener,noreferrer")}}let V={"Junction to audit":"black","Fully mapped junction":"green",Crossing:"yellow","crossing=no":"purple","crossing=imaginary":"cyan"};function Y(O){R=O,n(1,R)}function se(O){r.$$.not_equal(M.only_major_roads,O)&&(M.only_major_roads=O,n(0,M))}function $(O){r.$$.not_equal(M.ignore_utility_roads,O)&&(M.ignore_utility_roads=O,n(0,M))}function te(O){r.$$.not_equal(M.ignore_cycleways,O)&&(M.ignore_cycleways=O,n(0,M))}function U(O){r.$$.not_equal(M.ignore_footways,O)&&(M.ignore_footways=O,n(0,M))}function j(O){r.$$.not_equal(M.ignore_roundabouts,O)&&(M.ignore_roundabouts=O,n(0,M))}function G(){M.max_distance=u0(this.value),n(0,M)}return r.$$.update=()=>{r.$$.dirty&24577&&n(4,o=E&&M.max_distance&&T>=0?JSON.parse(E.auditCrossings(M)):or()),r.$$.dirty&16&&n(10,c=o.features.filter(O=>O.properties.complete).length),r.$$.dirty&2&&n(9,d=R?JSON.parse(R.properties.arms):or()),r.$$.dirty&2&&n(3,h=R?JSON.parse(R.properties.crossings):or()),r.$$.dirty&2&&n(2,a=R?JSON.parse(R.properties.explicit_non_crossings):or()),r.$$.dirty&8&&n(8,_=h.features.length),r.$$.dirty&4&&n(7,S=a.features.length),r.$$.dirty&2&&n(6,k=R?R.properties.number_ignored_arms:0),r.$$.dirty&16384&&n(5,y=N())},[M,R,a,h,o,y,k,S,_,d,c,z,V,E,T,Y,se,$,te,U,j,G]}class l3 extends ai{constructor(e){super(),oi(this,e,a3,o3,Yt,{})}}function c3(r){let e;return{c(){e=gt("Ignore deadends under 10m")},m(n,o){be(n,e,o)},d(n){n&&ye(e)}}}function u3(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N,z,V,Y,se,$,te;function U(G){r[5](G)}let j={$$slots:{default:[c3]},$$scope:{ctx:r}};return r[0].ignore_deadends!==void 0&&(j.checked=r[0].ignore_deadends),z=new Qn({props:j}),mi.push(()=>Ri(z,"checked",U)),se=C1(r[2][0]),{c(){e=xe("div"),n=xe("div"),o=xe("div"),c=xe("label"),d=xe("input"),h=gt(`
        Everything`),a=Ue(),_=xe("div"),S=xe("label"),k=xe("input"),y=gt(`
        Only footways`),C=Ue(),E=xe("div"),T=xe("label"),M=xe("input"),R=gt(`
        Anything routeable for walking`),N=Ue(),lt(z.$$.fragment),he(d,"class","form-check-input"),he(d,"type","radio"),d.__value="Everything",mr(d,d.__value),he(c,"class","form-check-label"),he(o,"class","form-check"),he(k,"class","form-check-input"),he(k,"type","radio"),k.__value="OnlyExplicitFootways",mr(k,k.__value),he(S,"class","form-check-label"),he(_,"class","form-check"),he(M,"class","form-check-input"),he(M,"type","radio"),M.__value="RouteableNetwork",mr(M,M.__value),he(T,"class","form-check-label"),he(E,"class","form-check mb-3"),he(n,"class","card-body"),he(e,"class","card"),se.p(d,k,M)},m(G,O){be(G,e,O),ce(e,n),ce(n,o),ce(o,c),ce(c,d),d.checked=d.__value===r[0].include,ce(c,h),ce(n,a),ce(n,_),ce(_,S),ce(S,k),k.checked=k.__value===r[0].include,ce(S,y),ce(n,C),ce(n,E),ce(E,T),ce(T,M),M.checked=M.__value===r[0].include,ce(T,R),ce(n,N),ot(z,n,null),Y=!0,$||(te=[Ut(d,"change",r[1]),Ut(k,"change",r[3]),Ut(M,"change",r[4])],$=!0)},p(G,[O]){O&1&&(d.checked=d.__value===G[0].include),O&1&&(k.checked=k.__value===G[0].include),O&1&&(M.checked=M.__value===G[0].include);const W={};O&64&&(W.$$scope={dirty:O,ctx:G}),!V&&O&1&&(V=!0,W.checked=G[0].ignore_deadends,Fi(()=>V=!1)),z.$set(W)},i(G){Y||(Pe(z.$$.fragment,G),Y=!0)},o(G){De(z.$$.fragment,G),Y=!1},d(G){G&&ye(e),at(z),se.r(),$=!1,jn(te)}}}function h3(r,e,n){let o;Bt(r,Nl,S=>n(0,o=S));const c=[[]];function d(){o.include=this.__value,Nl.set(o)}function h(){o.include=this.__value,Nl.set(o)}function a(){o.include=this.__value,Nl.set(o)}function _(S){r.$$.not_equal(o.ignore_deadends,S)&&(o.ignore_deadends=S,Nl.set(o))}return[o,d,c,h,a,_]}class Cb extends ai{constructor(e){super(),oi(this,e,h3,u3,Yt,{})}}function Xy(r,e,n){const o=r.slice();return o[11]=e[n],o[13]=n,o}function Ky(r){let e,n,o=nu(r[11])+"",c,d,h,a;function _(){return r[9](r[13])}return{c(){e=xe("li"),n=xe("a"),c=gt(o),d=Ue(),he(n,"href","#"),tn(n,"color",r[3][r[13]%r[3].length])},m(S,k){be(S,e,k),ce(e,n),ce(n,c),ce(e,d),h||(a=Ut(n,"click",rp(_)),h=!0)},p(S,k){r=S,k&2&&o!==(o=nu(r[11])+"")&&_i(c,o)},d(S){S&&ye(e),h=!1,a()}}}function f3(r){let e,n,o,c,d,h,a,_,S,k,y;h=new Cb({});let C=Ni(r[1].component_lengths),E=[];for(let T=0;T<C.length;T+=1)E[T]=Ky(Xy(r,C,T));return k=new Mf({}),{c(){e=xe("div"),n=xe("h4"),n.textContent="Network disconnections",o=Ue(),c=xe("p"),c.textContent="This shows where the network is disconnected. Click a piece to see it.",d=Ue(),lt(h.$$.fragment),a=Ue(),_=xe("ul");for(let T=0;T<E.length;T+=1)E[T].c();S=Ue(),lt(k.$$.fragment),he(e,"slot","sidebar")},m(T,M){be(T,e,M),ce(e,n),ce(e,o),ce(e,c),ce(e,d),ot(h,e,null),ce(e,a),ce(e,_);for(let R=0;R<E.length;R+=1)E[R]&&E[R].m(_,null);ce(e,S),ot(k,e,null),y=!0},p(T,M){if(M&15){C=Ni(T[1].component_lengths);let R;for(R=0;R<C.length;R+=1){const N=Xy(T,C,R);E[R]?E[R].p(N,M):(E[R]=Ky(N),E[R].c(),E[R].m(_,null))}for(;R<E.length;R+=1)E[R].d(1);E.length=C.length}},i(T){y||(Pe(h.$$.fragment,T),Pe(k.$$.fragment,T),y=!0)},o(T){De(h.$$.fragment,T),De(k.$$.fragment,T),y=!1},d(T){T&&ye(e),at(h),$n(E,T),at(k)}}}function d3(r){let e,n;return e=new ga({props:{id:"disconnections",paint:{"line-width":mh(5,10),"line-color":r[4](r[0])},manageHoverState:!0,hoverCursor:"pointer"}}),e.$on("click",r[5]),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&1&&(d.paint={"line-width":mh(5,10),"line-color":o[4](o[0])}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function p3(r){let e,n,o,c,d;return n=new mb({}),n.$on("click",r[6]),c=new Ir({props:{data:r[1],generateId:!0,$$slots:{default:[d3]},$$scope:{ctx:r}}}),{c(){e=xe("div"),lt(n.$$.fragment),o=Ue(),lt(c.$$.fragment),he(e,"slot","map")},m(h,a){be(h,e,a),ot(n,e,null),ce(e,o),ot(c,e,null),d=!0},p(h,a){const _={};a&2&&(_.data=h[1]),a&16385&&(_.$$scope={dirty:a,ctx:h}),c.$set(_)},i(h){d||(Pe(n.$$.fragment,h),Pe(c.$$.fragment,h),d=!0)},o(h){De(n.$$.fragment,h),De(c.$$.fragment,h),d=!1},d(h){h&&ye(e),at(n),at(c)}}}function m3(r){let e,n;return e=new xh({props:{$$slots:{map:[p3],sidebar:[f3]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,[c]){const d={};c&16391&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function g3(r,e,n){let o,c,d,h;Bt(r,ya,T=>n(2,c=T)),Bt(r,Nl,T=>n(7,d=T)),Bt(r,er,T=>n(8,h=T));let a=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],_=gh(["to-string",["%",["get","component"],a.length]],Object.fromEntries(a.map((T,M)=>[M.toString(),T])),"black"),S=null;function k(T){return T==null?_:["case",["==",["get","component"],T],_,"black"]}function y(T){n(0,S=T.detail.features[0].properties.component)}function C(T){c.queryRenderedFeatures(T.detail.point,{layers:["disconnections"]}).length==0&&n(0,S=null)}const E=T=>{c==null||c.fitBounds(o.component_bboxes[T]),n(0,S=T)};return r.$$.update=()=>{r.$$.dirty&384&&n(1,o=h?JSON.parse(h.findConnectedComponents(d)):{...or(),component_lengths:[]})},[S,o,c,a,k,y,C,d,h,E]}class _3 extends ai{constructor(e){super(),oi(this,e,g3,m3,Yt,{})}}function Jy(r,e,n){const o=r.slice();return o[5]=e[n][0],o[6]=e[n][1],o}function y3(r){let e;return{c(){e=xe("div"),e.textContent="Details",he(e,"slot","header")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function b3(r){let e;return{c(){e=xe("div"),e.innerHTML=`<p>The output will have a LineString for each edge in the network. An
          edge goes between exactly two graph nodes, so one OSM way usually
          becomes many edges. Each LineString will have these properties:</p> <ul><li><b>node1</b>
            : The OSM node ID of the beginning of the edge. This is safer to use
            to form a graph than the first coordinate.</li> <li><b>node2</b>
            : The OSM node ID of the end of the edge. This is safer to use to form
            a graph than the last coordinate.</li> <li><b>way</b>
            : The OSM way ID where this edge comes from.</li> <li><b>kind</b>
            : Speedwalk&#39;s classification of this edge</li> <li>Each tag from the OSM way will appear as a key and value</li></ul> <p>Note OSM IDs will be negative if you have run bulk operations and
          generated synthetic sidewalks or crossings.</p>`,he(e,"slot","body")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function v3(r){let e;return{c(){e=xe("div"),e.textContent="Legend",he(e,"slot","header")},m(n,o){be(n,e,o)},p:Ot,d(n){n&&ye(e)}}}function w3(r){let e,n,o;return n=new Ep({props:{labelColors:Xl,itemsPerRow:1}}),{c(){e=xe("div"),lt(n.$$.fragment),he(e,"slot","body")},m(c,d){be(c,e,d),ot(n,e,null),o=!0},p:Ot,i(c){o||(Pe(n.$$.fragment,c),o=!0)},o(c){De(n.$$.fragment,c),o=!1},d(c){c&&ye(e),at(n)}}}function x3(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N;return h=new Cb({}),k=new _a({props:{open:!1,$$slots:{body:[b3],header:[y3]},$$scope:{ctx:r}}}),C=new _a({props:{$$slots:{body:[w3],header:[v3]},$$scope:{ctx:r}}}),T=new Mf({}),{c(){e=xe("div"),n=xe("h4"),n.textContent="Export network",o=Ue(),c=xe("p"),c.textContent="You can export the routeable walking network as a GeoJSON file.",d=Ue(),lt(h.$$.fragment),a=Ue(),_=xe("button"),_.textContent="Download GeoJSON",S=Ue(),lt(k.$$.fragment),y=Ue(),lt(C.$$.fragment),E=Ue(),lt(T.$$.fragment),he(_,"class","btn btn-primary mt-3 mb-3"),he(e,"slot","sidebar")},m(z,V){be(z,e,V),ce(e,n),ce(e,o),ce(e,c),ce(e,d),ot(h,e,null),ce(e,a),ce(e,_),ce(e,S),ot(k,e,null),ce(e,y),ot(C,e,null),ce(e,E),ot(T,e,null),M=!0,R||(N=Ut(_,"click",r[1]),R=!0)},p(z,V){const Y={};V&512&&(Y.$$scope={dirty:V,ctx:z}),k.$set(Y);const se={};V&512&&(se.$$scope={dirty:V,ctx:z}),C.$set(se)},i(z){M||(Pe(h.$$.fragment,z),Pe(k.$$.fragment,z),Pe(C.$$.fragment,z),Pe(T.$$.fragment,z),M=!0)},o(z){De(h.$$.fragment,z),De(k.$$.fragment,z),De(C.$$.fragment,z),De(T.$$.fragment,z),M=!1},d(z){z&&ye(e),at(h),at(k),at(C),at(T),R=!1,N()}}}function Yy(r){let e,n,o=r[5]+"",c,d,h,a=r[6]+"",_,S;return{c(){e=xe("tr"),n=xe("td"),c=gt(o),d=Ue(),h=xe("td"),_=gt(a),S=Ue()},m(k,y){be(k,e,y),ce(e,n),ce(n,c),ce(e,d),ce(e,h),ce(h,_),ce(e,S)},p(k,y){y&16&&o!==(o=k[5]+"")&&_i(c,o),y&16&&a!==(a=k[6]+"")&&_i(_,a)},d(k){k&&ye(e)}}}function k3(r){let e,n,o=Ni(Object.entries(Hc(Hc(r[4]).properties))),c=[];for(let d=0;d<o.length;d+=1)c[d]=Yy(Jy(r,o,d));return{c(){e=xe("table"),n=xe("tbody");for(let d=0;d<c.length;d+=1)c[d].c();he(e,"class","table table-bordered")},m(d,h){be(d,e,h),ce(e,n);for(let a=0;a<c.length;a+=1)c[a]&&c[a].m(n,null)},p(d,h){if(h&16){o=Ni(Object.entries(Hc(Hc(d[4]).properties)));let a;for(a=0;a<o.length;a+=1){const _=Jy(d,o,a);c[a]?c[a].p(_,h):(c[a]=Yy(_),c[a].c(),c[a].m(n,null))}for(;a<c.length;a+=1)c[a].d(1);c.length=o.length}},d(d){d&&ye(e),$n(c,d)}}}function S3(r){let e,n;return e=new Cp({props:{openOn:"hover",$$slots:{default:[k3,({data:o})=>({4:o}),({data:o})=>o?16:0]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&528&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function T3(r){let e,n;return e=new ga({props:{manageHoverState:!0,paint:{"line-width":fa(0),"line-color":gh(["get","kind"],Xl,"cyan"),"line-opacity":mh(1,.5)},$$slots:{default:[S3]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,c){const d={};c&512&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function C3(r){let e,n,o;return n=new Ir({props:{data:r[0],generateId:!0,$$slots:{default:[T3]},$$scope:{ctx:r}}}),{c(){e=xe("div"),lt(n.$$.fragment),he(e,"slot","map")},m(c,d){be(c,e,d),ot(n,e,null),o=!0},p(c,d){const h={};d&1&&(h.data=c[0]),d&512&&(h.$$scope={dirty:d,ctx:c}),n.$set(h)},i(c){o||(Pe(n.$$.fragment,c),o=!0)},o(c){De(n.$$.fragment,c),o=!1},d(c){c&&ye(e),at(n)}}}function E3(r){let e,n;return e=new xh({props:{$$slots:{map:[C3],sidebar:[x3]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,[c]){const d={};c&513&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function I3(r,e,n){let o,c,d;Bt(r,Nl,a=>n(2,c=a)),Bt(r,er,a=>n(3,d=a));function h(){Ip("network.geojson",JSON.stringify(o))}return r.$$.update=()=>{r.$$.dirty&12&&n(0,o=d?JSON.parse(d.exportNetwork(c)):or())},[o,h,c,d]}class A3 extends ai{constructor(e){super(),oi(this,e,I3,E3,Yt,{})}}function M3(r){let e,n;return e=new hS({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p:Ot,i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function P3(r){let e,n;return e=new Ir({props:{data:r[0],$$slots:{default:[M3]},$$scope:{ctx:r}}}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p(o,[c]){const d={};c&8&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function L3(r,e,n){let o;Bt(r,er,h=>n(1,o=h));let c=JSON.parse(o.getBoundary());return[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],c.geometry.coordinates[0]]}}]}class z3 extends ai{constructor(e){super(),oi(this,e,L3,P3,Yt,{})}}function O3(r){let e,n,o;return{c(){e=xe("button"),e.textContent="Login to OSM",he(e,"class","btn btn-primary")},m(c,d){be(c,e,d),n||(o=Ut(e,"click",r[1]),n=!0)},p:Ot,d(c){c&&ye(e),n=!1,o()}}}function D3(r){let e,n,o,c=r[0].name+"",d,h,a,_,S,k,y,C=r[0].avatarUrl&&Qy(r);return{c(){e=xe("div"),n=xe("button"),C&&C.c(),o=Ue(),d=gt(c),h=Ue(),a=xe("ul"),_=xe("li"),S=xe("a"),S.textContent="Logout",he(n,"class","btn btn-outline-secondary dropdown-toggle"),he(n,"data-bs-toggle","dropdown"),he(n,"aria-expanded","false"),he(S,"class","dropdown-item"),he(S,"href","#"),he(a,"class","dropdown-menu"),he(e,"class","nav-item dropdown")},m(E,T){be(E,e,T),ce(e,n),C&&C.m(n,null),ce(n,o),ce(n,d),ce(e,h),ce(e,a),ce(a,_),ce(_,S),k||(y=Ut(S,"click",r[2]),k=!0)},p(E,T){E[0].avatarUrl?C?C.p(E,T):(C=Qy(E),C.c(),C.m(n,o)):C&&(C.d(1),C=null),T&1&&c!==(c=E[0].name+"")&&_i(d,c)},d(E){E&&ye(e),C&&C.d(),k=!1,y()}}}function Qy(r){let e,n;return{c(){e=xe("img"),Gn(e.src,n=r[0].avatarUrl)||he(e,"src",n),he(e,"alt","OSM avatar"),he(e,"height","30")},m(o,c){be(o,e,c)},p(o,c){c&1&&!Gn(e.src,n=o[0].avatarUrl)&&he(e,"src",n)},d(o){o&&ye(e)}}}function F3(r){let e;function n(d,h){return d[0]?D3:O3}let o=n(r),c=o(r);return{c(){c.c(),e=Mn()},m(d,h){c.m(d,h),be(d,e,h)},p(d,[h]){o===(o=n(d))&&c?c.p(d,h):(c.d(1),c=o(d),c&&(c.c(),c.m(e.parentNode,e)))},i:Ot,o:Ot,d(d){d&&ye(e),c.d(d)}}}function R3(r,e,n){let o;Bt(r,uh,a=>n(0,o=a)),sp(c);async function c(){var a;if(nh.isLoggedIn()){let _=await nh.getUser("me");Qi(uh,o={name:_.display_name,uid:_.id,avatarUrl:((a=_.img)==null?void 0:a.href)||""},o)}}async function d(){try{await nh.login({mode:"popup",clientId:"vyCV0t-IiskqNBgpiHvuSAmf2nC8K-zfByeFL6XtAzc",redirectUrl:`${window.location.origin}/speedwalk/land.html`,scopes:["read_prefs","write_api"]}),await c()}catch(a){window.alert(`Login failed: ${a}`)}}async function h(){Qi(uh,o=void 0,o),await nh.logout()}return[o,d,h]}class B3 extends ai{constructor(e){super(),oi(this,e,R3,F3,Yt,{})}}const N3="/speedwalk/assets/logo-3MjkCCFo.svg";function $y(r,e,n){const o=r.slice();return o[8]=e[n][0],o[9]=e[n][1],o}function e0(r){let e,n=Ni(r[3]),o=[];for(let c=0;c<n.length;c+=1)o[c]=t0($y(r,n,c));return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=Mn()},m(c,d){for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(c,d);be(c,e,d)},p(c,d){if(d&12){n=Ni(c[3]);let h;for(h=0;h<n.length;h+=1){const a=$y(c,n,h);o[h]?o[h].p(a,d):(o[h]=t0(a),o[h].c(),o[h].m(e.parentNode,e))}for(;h<o.length;h+=1)o[h].d(1);o.length=n.length}},d(c){c&&ye(e),$n(o,c)}}}function t0(r){let e,n,o,c,d;function h(){return r[4](r[8])}return{c(){e=xe("li"),n=xe("a"),n.textContent=`${r[9]}`,o=Ue(),he(n,"class","nav-link"),he(n,"href","#"),gr(n,"active",JSON.stringify(r[2])==JSON.stringify(r[8])),he(e,"class","nav-item")},m(a,_){be(a,e,_),ce(e,n),ce(e,o),c||(d=Ut(n,"click",h),c=!0)},p(a,_){r=a,_&12&&gr(n,"active",JSON.stringify(r[2])==JSON.stringify(r[8]))},d(a){a&&ye(e),c=!1,d()}}}function j3(r){let e,n,o,c,d,h,a,_,S;return{c(){e=xe("h1"),e.textContent="Welcome to Speedwalk",n=Ue(),o=xe("p"),o.innerHTML=`This tool helps you quickly assess how sidewalks are mapped in OSM. You can
    find and fix common tagging problems. The tool assumes you understand the
    correct <a href="https://wiki.openstreetmap.org/wiki/Sidewalks" target="_blank">sidewalk mapping conventions</a>
    . If you are unsure about some edits you make, you can download the changeset
    file and check in JOSM, rather than uploading directly.`,c=Ue(),d=xe("p"),d.innerHTML=`This is an <a href="https://github.com/a-b-street/speedwalk" target="_blank">open source project</a>
    developed without funding by
    <a href="https://abstreet.uk" target="_blank">A/B Street Ltd</a>
    . Please file a Github issue or contact
    <a href="mailto:dustin@abstreet.uk" target="_blank">dustin@abstreet.uk</a>
    with feedback.
    <b>This is an alpha tool; there will be problems!</b>`,h=Ue(),a=xe("button"),a.textContent="Start",he(a,"class","btn btn-primary")},m(k,y){be(k,e,y),be(k,n,y),be(k,o,y),be(k,c,y),be(k,d,y),be(k,h,y),be(k,a,y),_||(S=Ut(a,"click",r[6]),_=!0)},p:Ot,d(k){k&&(ye(e),ye(n),ye(o),ye(c),ye(d),ye(h),ye(a)),_=!1,S()}}}function U3(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,M,R,N,z=r[1]&&e0(r);y=new B3({});function V(se){r[7](se)}let Y={$$slots:{default:[j3]},$$scope:{ctx:r}};return r[0]!==void 0&&(Y.show=r[0]),E=new Af({props:Y}),mi.push(()=>Ri(E,"show",V)),{c(){e=xe("ul"),n=xe("img"),c=Ue(),d=xe("h3"),d.textContent="Speedwalk",h=Ue(),z&&z.c(),a=Ue(),_=xe("li"),S=xe("a"),S.innerHTML=`<i class="fa-solid fa-circle-info"></i>
      About`,k=Ue(),lt(y.$$.fragment),C=Ue(),lt(E.$$.fragment),Gn(n.src,o=N3)||he(n,"src",o),tn(n,"height","30px"),he(n,"alt","A/B Street logo"),he(S,"class","nav-link"),he(S,"href","#"),he(_,"class","nav-item ms-auto"),he(e,"class","nav nav-underline")},m(se,$){be(se,e,$),ce(e,n),ce(e,c),ce(e,d),ce(e,h),z&&z.m(e,null),ce(e,a),ce(e,_),ce(_,S),ce(e,k),ot(y,e,null),be(se,C,$),ot(E,se,$),M=!0,R||(N=Ut(S,"click",r[5]),R=!0)},p(se,[$]){se[1]?z?z.p(se,$):(z=e0(se),z.c(),z.m(e,a)):z&&(z.d(1),z=null);const te={};$&4097&&(te.$$scope={dirty:$,ctx:se}),!T&&$&1&&(T=!0,te.show=se[0],Fi(()=>T=!1)),E.$set(te)},i(se){M||(Pe(y.$$.fragment,se),Pe(E.$$.fragment,se),M=!0)},o(se){De(y.$$.fragment,se),De(E.$$.fragment,se),M=!1},d(se){se&&(ye(e),ye(C)),z&&z.d(),at(y),at(E,se),R=!1,N()}}}function V3(r,e,n){let o,c;Bt(r,er,y=>n(1,o=y)),Bt(r,ip,y=>n(2,c=y));let d=!1,h=[[{kind:"sidewalks"},"Sidewalks"],[{kind:"crossings"},"Crossings"],[{kind:"disconnections"},"Network disconnections"],[{kind:"export"},"Export"]];const a=y=>Qi(ip,c=y,c),_=()=>n(0,d=!0),S=()=>n(0,d=!1);function k(y){d=y,n(0,d)}return[d,o,c,h,a,_,S,k]}class q3 extends ai{constructor(e){super(),oi(this,e,V3,U3,Yt,{})}}function Z3(r){let e,n,o;return n=new q3({}),{c(){e=xe("div"),lt(n.$$.fragment),he(e,"slot","top")},m(c,d){be(c,e,d),ot(n,e,null),o=!0},p:Ot,i(c){o||(Pe(n.$$.fragment,c),o=!0)},o(c){De(n.$$.fragment,c),o=!1},d(c){c&&ye(e),at(n)}}}function i0(r){let e;return{c(){e=xe("div")},m(n,o){be(n,e,o),r[13](e)},p:Ot,d(n){n&&ye(e),r[13](null)}}}function W3(r){let e,n=r[0]&&i0(r);return{c(){e=xe("div"),n&&n.c(),he(e,"class","p-3"),he(e,"slot","left")},m(o,c){be(o,e,c),n&&n.m(e,null)},p(o,c){o[0]?n?n.p(o,c):(n=i0(o),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(o){o&&ye(e),n&&n.d()}}}function n0(r){let e,n,o,c,d,h;const a=[H3,G3],_=[];function S(k,y){return k[5]?0:1}return o=S(r),c=_[o]=a[o](r),{c(){e=xe("div"),n=Ue(),c.c(),d=Mn()},m(k,y){be(k,e,y),r[10](e),be(k,n,y),_[o].m(k,y),be(k,d,y),h=!0},p(k,y){let C=o;o=S(k),o===C?_[o].p(k,y):(nn(),De(_[C],1,1,()=>{_[C]=null}),rn(),c=_[o],c?c.p(k,y):(c=_[o]=a[o](k),c.c()),Pe(c,1),c.m(d.parentNode,d))},i(k){h||(Pe(c),h=!0)},o(k){De(c),h=!1},d(k){k&&(ye(e),ye(n),ye(d)),r[10](null),_[o].d(k)}}}function G3(r){let e,n;return e=new gT({}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},p:Ot,i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function H3(r){let e,n,o=r[6],c,d;e=new z3({});let h=r0(r);return{c(){lt(e.$$.fragment),n=Ue(),h.c(),c=Mn()},m(a,_){ot(e,a,_),be(a,n,_),h.m(a,_),be(a,c,_),d=!0},p(a,_){_&64&&Yt(o,o=a[6])?(nn(),De(h,1,1,Ot),rn(),h=r0(a),h.c(),Pe(h,1),h.m(c.parentNode,c)):h.p(a,_)},i(a){d||(Pe(e.$$.fragment,a),Pe(h),d=!0)},o(a){De(e.$$.fragment,a),De(h),d=!1},d(a){a&&(ye(n),ye(c)),at(e,a),h.d(a)}}}function X3(r){let e,n;return e=new A3({}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function K3(r){let e,n;return e=new _3({}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function J3(r){let e,n;return e=new l3({}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function Y3(r){let e,n;return e=new zE({}),{c(){lt(e.$$.fragment)},m(o,c){ot(e,o,c),n=!0},i(o){n||(Pe(e.$$.fragment,o),n=!0)},o(o){De(e.$$.fragment,o),n=!1},d(o){at(e,o)}}}function r0(r){let e,n,o,c;const d=[Y3,J3,K3,X3],h=[];function a(_,S){return _[6].kind=="sidewalks"?0:_[6].kind=="crossings"?1:_[6].kind=="disconnections"?2:_[6].kind=="export"?3:-1}return~(e=a(r))&&(n=h[e]=d[e](r)),{c(){n&&n.c(),o=Mn()},m(_,S){~e&&h[e].m(_,S),be(_,o,S),c=!0},p(_,S){let k=e;e=a(_),e!==k&&(n&&(nn(),De(h[k],1,1,()=>{h[k]=null}),rn()),~e?(n=h[e],n||(n=h[e]=d[e](_),n.c()),Pe(n,1),n.m(o.parentNode,o)):n=null)},i(_){c||(Pe(n),c=!0)},o(_){De(n),c=!1},d(_){_&&ye(o),~e&&h[e].d(_)}}}function Q3(r){let e,n,o,c,d,h,a,_,S;e=new US({props:{map:r[0]}}),o=new Zk({props:{map:r[0],country:void 0,apiKey:"MZEJTanw3WpxRvt7qDfo"}});function k(E){r[9](E)}let y={};r[3]!==void 0&&(y.basemap=r[3]),d=new iC({props:y}),mi.push(()=>Ri(d,"basemap",k));let C=r[0]&&n0(r);return{c(){lt(e.$$.fragment),n=Ue(),lt(o.$$.fragment),c=Ue(),lt(d.$$.fragment),a=Ue(),C&&C.c(),_=Mn()},m(E,T){ot(e,E,T),be(E,n,T),ot(o,E,T),be(E,c,T),ot(d,E,T),be(E,a,T),C&&C.m(E,T),be(E,_,T),S=!0},p(E,T){const M={};T&1&&(M.map=E[0]),e.$set(M);const R={};T&1&&(R.map=E[0]),o.$set(R);const N={};!h&&T&8&&(h=!0,N.basemap=E[3],Fi(()=>h=!1)),d.$set(N),E[0]?C?(C.p(E,T),T&1&&Pe(C,1)):(C=n0(E),C.c(),Pe(C,1),C.m(_.parentNode,_)):C&&(nn(),De(C,1,1,()=>{C=null}),rn())},i(E){S||(Pe(e.$$.fragment,E),Pe(o.$$.fragment,E),Pe(d.$$.fragment,E),Pe(C),S=!0)},o(E){De(e.$$.fragment,E),De(o.$$.fragment,E),De(d.$$.fragment,E),De(C),S=!1},d(E){E&&(ye(n),ye(c),ye(a),ye(_)),at(e,E),at(o,E),at(d,E),C&&C.d(E)}}}function $3(r){let e,n,o,c;function d(a){r[11](a)}let h={style:r[4][r[3]],hash:!0,images:[{id:"arrow",url:yT}],$$slots:{default:[Q3]},$$scope:{ctx:r}};return r[0]!==void 0&&(h.map=r[0]),n=new LS({props:h}),mi.push(()=>Ri(n,"map",d)),n.$on("error",r[12]),{c(){e=xe("div"),lt(n.$$.fragment),he(e,"slot","main"),tn(e,"position","relative"),tn(e,"width","100%"),tn(e,"height","100vh")},m(a,_){be(a,e,_),ot(n,e,null),c=!0},p(a,_){const S={};_&24&&(S.style=a[4][a[3]]),_&16493&&(S.$$scope={dirty:_,ctx:a}),!o&&_&1&&(o=!0,S.map=a[0],Fi(()=>o=!1)),n.$set(S)},i(a){c||(Pe(n.$$.fragment,a),c=!0)},o(a){De(n.$$.fragment,a),c=!1},d(a){a&&ye(e),at(n)}}}function eI(r){let e,n,o,c;return o=new Hx({props:{$$slots:{main:[$3],left:[W3],top:[Z3]},$$scope:{ctx:r}}}),{c(){e=xe("link"),n=Ue(),lt(o.$$.fragment),he(e,"rel","icon"),he(e,"type","image/x-icon"),he(e,"href",_T)},m(d,h){ce(document.head,e),be(d,n,h),ot(o,d,h),c=!0},p(d,[h]){const a={};h&16511&&(a.$$scope={dirty:h,ctx:d}),o.$set(a)},i(d){c||(Pe(o.$$.fragment,d),c=!0)},o(d){De(o.$$.fragment,d),c=!1},d(d){d&&ye(n),ye(e),at(o,d)}}}function tI(r,e,n){let o,c,d,h,a;Bt(r,Gd,N=>n(7,o=N)),Bt(r,Wd,N=>n(8,c=N)),Bt(r,rl,N=>n(4,d=N)),Bt(r,er,N=>n(5,h=N)),Bt(r,ip,N=>n(6,a=N));let _,S="Maptiler OpenStreetMap";sp(async()=>{await xb()});let k,y;function C(N){S=N,n(3,S)}function E(N){mi[N?"unshift":"push"](()=>{y=N,n(2,y),n(7,o)})}function T(N){_=N,n(0,_)}const M=N=>{console.log(N.detail.error)};function R(N){mi[N?"unshift":"push"](()=>{k=N,n(1,k),n(8,c)})}return r.$$.update=()=>{r.$$.dirty&1&&_&&ya.set(_),r.$$.dirty&258&&k&&c&&(n(1,k.innerHTML="",k),k.appendChild(c)),r.$$.dirty&132&&y&&o&&(n(2,y.innerHTML="",y),y.appendChild(o))},[_,k,y,S,d,h,a,o,c,C,E,T,M,R]}class iI extends ai{constructor(e){super(),oi(this,e,tI,eI,Yt,{})}}new iI({target:document.getElementById("app")});
