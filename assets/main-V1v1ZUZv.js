var g1=Object.defineProperty;var _1=(r,e,n)=>e in r?g1(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var Zn=(r,e,n)=>_1(r,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function n(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(c){if(c.ep)return;c.ep=!0;const d=n(c);fetch(c.href,d)}})();function Ut(){}function y1(r,e){for(const n in e)r[n]=e[n];return r}function s0(r){return r()}function hg(){return Object.create(null)}function Gn(r){r.forEach(s0)}function tp(r){return typeof r=="function"}function $t(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let $h;function Wn(r,e){return r===e?!0:($h||($h=document.createElement("a")),$h.href=e,r===$h.href)}function b1(r){return Object.keys(r).length===0}function o0(r,...e){if(r==null){for(const o of e)o(void 0);return Ut}const n=r.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function a0(r){let e;return o0(r,n=>e=n)(),e}function jt(r,e,n){r.$$.on_destroy.push(o0(e,n))}function wn(r,e,n,o){if(r){const c=l0(r,e,n,o);return r[0](c)}}function l0(r,e,n,o){return r[1]&&o?y1(n.ctx.slice(),r[1](o(e))):n.ctx}function xn(r,e,n,o){if(r[2]&&o){const c=r[2](o(n));if(e.dirty===void 0)return c;if(typeof c=="object"){const d=[],h=Math.max(e.dirty.length,c.length);for(let a=0;a<h;a+=1)d[a]=e.dirty[a]|c[a];return d}return e.dirty|c}return e.dirty}function kn(r,e,n,o,c,d){if(c){const h=l0(e,n,o,d);r.p(h,c)}}function Sn(r){if(r.ctx.length>32){const e=[],n=r.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function v1(r){const e={};for(const n in r)e[n]=!0;return e}function Kc(r){return r??""}function tn(r,e,n){return r.set(n),e}function w1(r){return r&&tp(r.destroy)?r.destroy:Ut}const c0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function he(r,e){r.appendChild(e)}function we(r,e,n){r.insertBefore(e,n||null)}function ve(r){r.parentNode&&r.parentNode.removeChild(r)}function Qn(r,e){for(let n=0;n<r.length;n+=1)r[n]&&r[n].d(e)}function ke(r){return document.createElement(r)}function da(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function vt(r){return document.createTextNode(r)}function qe(){return vt(" ")}function Mn(){return vt("")}function Zt(r,e,n,o){return r.addEventListener(e,n,o),()=>r.removeEventListener(e,n,o)}function ip(r){return function(e){return e.preventDefault(),r.call(this,e)}}function x1(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function fe(r,e,n){n==null?r.removeAttribute(e):r.getAttribute(e)!==n&&r.setAttribute(e,n)}function k1(r){let e;return{p(...n){e=n,e.forEach(o=>r.push(o))},r(){e.forEach(n=>r.splice(r.indexOf(n),1))}}}function S1(r){return Array.from(r.childNodes)}function vi(r,e){e=""+e,r.data!==e&&(r.data=e)}function jr(r,e){r.value=e??""}function en(r,e,n,o){n==null?r.style.removeProperty(e):r.style.setProperty(e,n,"")}function fg(r,e,n){for(let o=0;o<r.options.length;o+=1){const c=r.options[o];if(c.__value===e){c.selected=!0;return}}(!n||e!==void 0)&&(r.selectedIndex=-1)}function T1(r){const e=r.querySelector(":checked");return e&&e.__value}function pr(r,e,n){r.classList.toggle(e,!!n)}function C1(r,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(r,{detail:e,bubbles:n,cancelable:o})}let hh;function rh(r){hh=r}function yh(){if(!hh)throw new Error("Function called outside component initialization");return hh}function np(r){yh().$$.on_mount.push(r)}function ds(r){yh().$$.on_destroy.push(r)}function nl(){const r=yh();return(e,n,{cancelable:o=!1}={})=>{const c=r.$$.callbacks[e];if(c){const d=C1(e,n,{cancelable:o});return c.slice().forEach(h=>{h.call(r,d)}),!d.defaultPrevented}return!0}}function rp(r,e){return yh().$$.context.set(r,e),e}function u0(r){return yh().$$.context.get(r)}function Di(r,e){const n=r.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}const Nc=[],gi=[];let Gc=[];const Rd=[],h0=Promise.resolve();let Bd=!1;function f0(){Bd||(Bd=!0,h0.then(p0))}function d0(){return f0(),h0}function pf(r){Gc.push(r)}function qi(r){Rd.push(r)}const Td=new Set;let Dc=0;function p0(){if(Dc!==0)return;const r=hh;do{try{for(;Dc<Nc.length;){const e=Nc[Dc];Dc++,rh(e),E1(e.$$)}}catch(e){throw Nc.length=0,Dc=0,e}for(rh(null),Nc.length=0,Dc=0;gi.length;)gi.pop()();for(let e=0;e<Gc.length;e+=1){const n=Gc[e];Td.has(n)||(Td.add(n),n())}Gc.length=0}while(Nc.length);for(;Rd.length;)Rd.pop()();Bd=!1,Td.clear(),rh(r)}function E1(r){if(r.fragment!==null){r.update(),Gn(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(pf)}}function I1(r){const e=[],n=[];Gc.forEach(o=>r.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),Gc=e}const cf=new Set;let Nl;function an(){Nl={r:0,c:[],p:Nl}}function ln(){Nl.r||Gn(Nl.c),Nl=Nl.p}function Le(r,e){r&&r.i&&(cf.delete(r),r.i(e))}function Be(r,e,n,o){if(r&&r.o){if(cf.has(r))return;cf.add(r),Nl.c.push(()=>{cf.delete(r),o&&(n&&r.d(1),o())}),r.o(e)}else o&&o()}function Ri(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function A1(r,e){Be(r,1,1,()=>{e.delete(r.key)})}function M1(r,e,n,o,c,d,h,a,_,S,k,y){let C=r.length,E=d.length,T=C;const L={};for(;T--;)L[r[T].key]=T;const R=[],N=new Map,z=new Map,V=[];for(T=E;T--;){const ne=y(c,d,T),j=n(ne);let U=h.get(j);U?V.push(()=>U.p(ne,e)):(U=S(j,ne),U.c()),N.set(j,R[T]=U),j in L&&z.set(j,Math.abs(T-L[j]))}const Q=new Set,oe=new Set;function ee(ne){Le(ne,1),ne.m(a,k),h.set(ne.key,ne),k=ne.first,E--}for(;C&&E;){const ne=R[E-1],j=r[C-1],U=ne.key,X=j.key;ne===j?(k=ne.first,C--,E--):N.has(X)?!h.has(U)||Q.has(U)?ee(ne):oe.has(X)?C--:z.get(U)>z.get(X)?(oe.add(U),ee(ne)):(Q.add(X),C--):(_(j,h),C--)}for(;C--;){const ne=r[C];N.has(ne.key)||_(ne,h)}for(;E;)ee(R[E-1]);return Gn(V),R}function Zi(r,e,n){const o=r.$$.props[e];o!==void 0&&(r.$$.bound[o]=n,n(r.$$.ctx[o]))}function ht(r){r&&r.c()}function ct(r,e,n){const{fragment:o,after_update:c}=r.$$;o&&o.m(e,n),pf(()=>{const d=r.$$.on_mount.map(s0).filter(tp);r.$$.on_destroy?r.$$.on_destroy.push(...d):Gn(d),r.$$.on_mount=[]}),c.forEach(pf)}function ut(r,e){const n=r.$$;n.fragment!==null&&(I1(n.after_update),Gn(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function P1(r,e){r.$$.dirty[0]===-1&&(Nc.push(r),f0(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function li(r,e,n,o,c,d,h=null,a=[-1]){const _=hh;rh(r);const S=r.$$={fragment:null,ctx:[],props:d,update:Ut,not_equal:c,bound:hg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:hg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};h&&h(S.root);let k=!1;if(S.ctx=n?n(r,e.props||{},(y,C,...E)=>{const T=E.length?E[0]:C;return S.ctx&&c(S.ctx[y],S.ctx[y]=T)&&(!S.skip_bound&&S.bound[y]&&S.bound[y](T),k&&P1(r,y)),C}):[],S.update(),k=!0,Gn(S.before_update),S.fragment=o?o(S.ctx):!1,e.target){if(e.hydrate){const y=S1(e.target);S.fragment&&S.fragment.l(y),y.forEach(ve)}else S.fragment&&S.fragment.c();e.intro&&Le(r.$$.fragment),ct(r,e.target,e.anchor),p0()}rh(_)}class ci{constructor(){Zn(this,"$$");Zn(this,"$$set")}$destroy(){ut(this,1),this.$destroy=Ut}$on(e,n){if(!tp(n))return Ut;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const c=o.indexOf(n);c!==-1&&o.splice(c,1)}}$set(e){this.$$set&&!b1(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const L1="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(L1);var m0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z1(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function O1(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var n=function o(){return this instanceof o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(r).forEach(function(o){var c=Object.getOwnPropertyDescriptor(r,o);Object.defineProperty(n,o,c.get?c:{enumerable:!0,get:function(){return r[o]}})}),n}var D1={exports:{}},Yr="top",Cs="bottom",Es="right",Qr="left",wf="auto",nu=[Yr,Cs,Es,Qr],Vl="start",Jc="end",g0="clippingParents",sp="viewport",jc="popper",_0="reference",Nd=nu.reduce(function(r,e){return r.concat([e+"-"+Vl,e+"-"+Jc])},[]),op=[].concat(nu,[wf]).reduce(function(r,e){return r.concat([e,e+"-"+Vl,e+"-"+Jc])},[]),y0="beforeRead",b0="read",v0="afterRead",w0="beforeMain",x0="main",k0="afterMain",S0="beforeWrite",T0="write",C0="afterWrite",E0=[y0,b0,v0,w0,x0,k0,S0,T0,C0];function Bo(r){return r?(r.nodeName||"").toLowerCase():null}function Is(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function ql(r){var e=Is(r).Element;return r instanceof e||r instanceof Element}function Hs(r){var e=Is(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function ap(r){if(typeof ShadowRoot>"u")return!1;var e=Is(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function F1(r){var e=r.state;Object.keys(e.elements).forEach(function(n){var o=e.styles[n]||{},c=e.attributes[n]||{},d=e.elements[n];!Hs(d)||!Bo(d)||(Object.assign(d.style,o),Object.keys(c).forEach(function(h){var a=c[h];a===!1?d.removeAttribute(h):d.setAttribute(h,a===!0?"":a)}))})}function R1(r){var e=r.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(o){var c=e.elements[o],d=e.attributes[o]||{},h=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:n[o]),a=h.reduce(function(_,S){return _[S]="",_},{});!Hs(c)||!Bo(c)||(Object.assign(c.style,a),Object.keys(d).forEach(function(_){c.removeAttribute(_)}))})}}const lp={name:"applyStyles",enabled:!0,phase:"write",fn:F1,effect:R1,requires:["computeStyles"]};function Fo(r){return r.split("-")[0]}var jl=Math.max,mf=Math.min,Yc=Math.round;function jd(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function I0(){return!/^((?!chrome|android).)*safari/i.test(jd())}function Qc(r,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var o=r.getBoundingClientRect(),c=1,d=1;e&&Hs(r)&&(c=r.offsetWidth>0&&Yc(o.width)/r.offsetWidth||1,d=r.offsetHeight>0&&Yc(o.height)/r.offsetHeight||1);var h=ql(r)?Is(r):window,a=h.visualViewport,_=!I0()&&n,S=(o.left+(_&&a?a.offsetLeft:0))/c,k=(o.top+(_&&a?a.offsetTop:0))/d,y=o.width/c,C=o.height/d;return{width:y,height:C,top:k,right:S+y,bottom:k+C,left:S,x:S,y:k}}function cp(r){var e=Qc(r),n=r.offsetWidth,o=r.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:r.offsetLeft,y:r.offsetTop,width:n,height:o}}function A0(r,e){var n=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(n&&ap(n)){var o=e;do{if(o&&r.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function pa(r){return Is(r).getComputedStyle(r)}function B1(r){return["table","td","th"].indexOf(Bo(r))>=0}function rl(r){return((ql(r)?r.ownerDocument:r.document)||window.document).documentElement}function xf(r){return Bo(r)==="html"?r:r.assignedSlot||r.parentNode||(ap(r)?r.host:null)||rl(r)}function dg(r){return!Hs(r)||pa(r).position==="fixed"?null:r.offsetParent}function N1(r){var e=/firefox/i.test(jd()),n=/Trident/i.test(jd());if(n&&Hs(r)){var o=pa(r);if(o.position==="fixed")return null}var c=xf(r);for(ap(c)&&(c=c.host);Hs(c)&&["html","body"].indexOf(Bo(c))<0;){var d=pa(c);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||e&&d.willChange==="filter"||e&&d.filter&&d.filter!=="none")return c;c=c.parentNode}return null}function bh(r){for(var e=Is(r),n=dg(r);n&&B1(n)&&pa(n).position==="static";)n=dg(n);return n&&(Bo(n)==="html"||Bo(n)==="body"&&pa(n).position==="static")?e:n||N1(r)||e}function up(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function sh(r,e,n){return jl(r,mf(e,n))}function j1(r,e,n){var o=sh(r,e,n);return o>n?n:o}function M0(){return{top:0,right:0,bottom:0,left:0}}function P0(r){return Object.assign({},M0(),r)}function L0(r,e){return e.reduce(function(n,o){return n[o]=r,n},{})}var U1=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,P0(typeof e!="number"?e:L0(e,nu))};function V1(r){var e,n=r.state,o=r.name,c=r.options,d=n.elements.arrow,h=n.modifiersData.popperOffsets,a=Fo(n.placement),_=up(a),S=[Qr,Es].indexOf(a)>=0,k=S?"height":"width";if(!(!d||!h)){var y=U1(c.padding,n),C=cp(d),E=_==="y"?Yr:Qr,T=_==="y"?Cs:Es,L=n.rects.reference[k]+n.rects.reference[_]-h[_]-n.rects.popper[k],R=h[_]-n.rects.reference[_],N=bh(d),z=N?_==="y"?N.clientHeight||0:N.clientWidth||0:0,V=L/2-R/2,Q=y[E],oe=z-C[k]-y[T],ee=z/2-C[k]/2+V,ne=sh(Q,ee,oe),j=_;n.modifiersData[o]=(e={},e[j]=ne,e.centerOffset=ne-ee,e)}}function q1(r){var e=r.state,n=r.options,o=n.element,c=o===void 0?"[data-popper-arrow]":o;c!=null&&(typeof c=="string"&&(c=e.elements.popper.querySelector(c),!c)||A0(e.elements.popper,c)&&(e.elements.arrow=c))}const z0={name:"arrow",enabled:!0,phase:"main",fn:V1,effect:q1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function $c(r){return r.split("-")[1]}var Z1={top:"auto",right:"auto",bottom:"auto",left:"auto"};function W1(r,e){var n=r.x,o=r.y,c=e.devicePixelRatio||1;return{x:Yc(n*c)/c||0,y:Yc(o*c)/c||0}}function pg(r){var e,n=r.popper,o=r.popperRect,c=r.placement,d=r.variation,h=r.offsets,a=r.position,_=r.gpuAcceleration,S=r.adaptive,k=r.roundOffsets,y=r.isFixed,C=h.x,E=C===void 0?0:C,T=h.y,L=T===void 0?0:T,R=typeof k=="function"?k({x:E,y:L}):{x:E,y:L};E=R.x,L=R.y;var N=h.hasOwnProperty("x"),z=h.hasOwnProperty("y"),V=Qr,Q=Yr,oe=window;if(S){var ee=bh(n),ne="clientHeight",j="clientWidth";if(ee===Is(n)&&(ee=rl(n),pa(ee).position!=="static"&&a==="absolute"&&(ne="scrollHeight",j="scrollWidth")),ee=ee,c===Yr||(c===Qr||c===Es)&&d===Jc){Q=Cs;var U=y&&ee===oe&&oe.visualViewport?oe.visualViewport.height:ee[ne];L-=U-o.height,L*=_?1:-1}if(c===Qr||(c===Yr||c===Cs)&&d===Jc){V=Es;var X=y&&ee===oe&&oe.visualViewport?oe.visualViewport.width:ee[j];E-=X-o.width,E*=_?1:-1}}var B=Object.assign({position:a},S&&Z1),W=k===!0?W1({x:E,y:L},Is(n)):{x:E,y:L};if(E=W.x,L=W.y,_){var ce;return Object.assign({},B,(ce={},ce[Q]=z?"0":"",ce[V]=N?"0":"",ce.transform=(oe.devicePixelRatio||1)<=1?"translate("+E+"px, "+L+"px)":"translate3d("+E+"px, "+L+"px, 0)",ce))}return Object.assign({},B,(e={},e[Q]=z?L+"px":"",e[V]=N?E+"px":"",e.transform="",e))}function G1(r){var e=r.state,n=r.options,o=n.gpuAcceleration,c=o===void 0?!0:o,d=n.adaptive,h=d===void 0?!0:d,a=n.roundOffsets,_=a===void 0?!0:a,S={placement:Fo(e.placement),variation:$c(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:c,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,pg(Object.assign({},S,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:h,roundOffsets:_})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,pg(Object.assign({},S,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:_})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const hp={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:G1,data:{}};var ef={passive:!0};function H1(r){var e=r.state,n=r.instance,o=r.options,c=o.scroll,d=c===void 0?!0:c,h=o.resize,a=h===void 0?!0:h,_=Is(e.elements.popper),S=[].concat(e.scrollParents.reference,e.scrollParents.popper);return d&&S.forEach(function(k){k.addEventListener("scroll",n.update,ef)}),a&&_.addEventListener("resize",n.update,ef),function(){d&&S.forEach(function(k){k.removeEventListener("scroll",n.update,ef)}),a&&_.removeEventListener("resize",n.update,ef)}}const fp={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:H1,data:{}};var X1={left:"right",right:"left",bottom:"top",top:"bottom"};function uf(r){return r.replace(/left|right|bottom|top/g,function(e){return X1[e]})}var K1={start:"end",end:"start"};function mg(r){return r.replace(/start|end/g,function(e){return K1[e]})}function dp(r){var e=Is(r),n=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:n,scrollTop:o}}function pp(r){return Qc(rl(r)).left+dp(r).scrollLeft}function J1(r,e){var n=Is(r),o=rl(r),c=n.visualViewport,d=o.clientWidth,h=o.clientHeight,a=0,_=0;if(c){d=c.width,h=c.height;var S=I0();(S||!S&&e==="fixed")&&(a=c.offsetLeft,_=c.offsetTop)}return{width:d,height:h,x:a+pp(r),y:_}}function Y1(r){var e,n=rl(r),o=dp(r),c=(e=r.ownerDocument)==null?void 0:e.body,d=jl(n.scrollWidth,n.clientWidth,c?c.scrollWidth:0,c?c.clientWidth:0),h=jl(n.scrollHeight,n.clientHeight,c?c.scrollHeight:0,c?c.clientHeight:0),a=-o.scrollLeft+pp(r),_=-o.scrollTop;return pa(c||n).direction==="rtl"&&(a+=jl(n.clientWidth,c?c.clientWidth:0)-d),{width:d,height:h,x:a,y:_}}function mp(r){var e=pa(r),n=e.overflow,o=e.overflowX,c=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+c+o)}function O0(r){return["html","body","#document"].indexOf(Bo(r))>=0?r.ownerDocument.body:Hs(r)&&mp(r)?r:O0(xf(r))}function oh(r,e){var n;e===void 0&&(e=[]);var o=O0(r),c=o===((n=r.ownerDocument)==null?void 0:n.body),d=Is(o),h=c?[d].concat(d.visualViewport||[],mp(o)?o:[]):o,a=e.concat(h);return c?a:a.concat(oh(xf(h)))}function Ud(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function Q1(r,e){var n=Qc(r,!1,e==="fixed");return n.top=n.top+r.clientTop,n.left=n.left+r.clientLeft,n.bottom=n.top+r.clientHeight,n.right=n.left+r.clientWidth,n.width=r.clientWidth,n.height=r.clientHeight,n.x=n.left,n.y=n.top,n}function gg(r,e,n){return e===sp?Ud(J1(r,n)):ql(e)?Q1(e,n):Ud(Y1(rl(r)))}function $1(r){var e=oh(xf(r)),n=["absolute","fixed"].indexOf(pa(r).position)>=0,o=n&&Hs(r)?bh(r):r;return ql(o)?e.filter(function(c){return ql(c)&&A0(c,o)&&Bo(c)!=="body"}):[]}function ew(r,e,n,o){var c=e==="clippingParents"?$1(r):[].concat(e),d=[].concat(c,[n]),h=d[0],a=d.reduce(function(_,S){var k=gg(r,S,o);return _.top=jl(k.top,_.top),_.right=mf(k.right,_.right),_.bottom=mf(k.bottom,_.bottom),_.left=jl(k.left,_.left),_},gg(r,h,o));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function D0(r){var e=r.reference,n=r.element,o=r.placement,c=o?Fo(o):null,d=o?$c(o):null,h=e.x+e.width/2-n.width/2,a=e.y+e.height/2-n.height/2,_;switch(c){case Yr:_={x:h,y:e.y-n.height};break;case Cs:_={x:h,y:e.y+e.height};break;case Es:_={x:e.x+e.width,y:a};break;case Qr:_={x:e.x-n.width,y:a};break;default:_={x:e.x,y:e.y}}var S=c?up(c):null;if(S!=null){var k=S==="y"?"height":"width";switch(d){case Vl:_[S]=_[S]-(e[k]/2-n[k]/2);break;case Jc:_[S]=_[S]+(e[k]/2-n[k]/2);break}}return _}function eu(r,e){e===void 0&&(e={});var n=e,o=n.placement,c=o===void 0?r.placement:o,d=n.strategy,h=d===void 0?r.strategy:d,a=n.boundary,_=a===void 0?g0:a,S=n.rootBoundary,k=S===void 0?sp:S,y=n.elementContext,C=y===void 0?jc:y,E=n.altBoundary,T=E===void 0?!1:E,L=n.padding,R=L===void 0?0:L,N=P0(typeof R!="number"?R:L0(R,nu)),z=C===jc?_0:jc,V=r.rects.popper,Q=r.elements[T?z:C],oe=ew(ql(Q)?Q:Q.contextElement||rl(r.elements.popper),_,k,h),ee=Qc(r.elements.reference),ne=D0({reference:ee,element:V,placement:c}),j=Ud(Object.assign({},V,ne)),U=C===jc?j:ee,X={top:oe.top-U.top+N.top,bottom:U.bottom-oe.bottom+N.bottom,left:oe.left-U.left+N.left,right:U.right-oe.right+N.right},B=r.modifiersData.offset;if(C===jc&&B){var W=B[c];Object.keys(X).forEach(function(ce){var pe=[Es,Cs].indexOf(ce)>=0?1:-1,be=[Yr,Cs].indexOf(ce)>=0?"y":"x";X[ce]+=W[be]*pe})}return X}function tw(r,e){e===void 0&&(e={});var n=e,o=n.placement,c=n.boundary,d=n.rootBoundary,h=n.padding,a=n.flipVariations,_=n.allowedAutoPlacements,S=_===void 0?op:_,k=$c(o),y=k?a?Nd:Nd.filter(function(T){return $c(T)===k}):nu,C=y.filter(function(T){return S.indexOf(T)>=0});C.length===0&&(C=y);var E=C.reduce(function(T,L){return T[L]=eu(r,{placement:L,boundary:c,rootBoundary:d,padding:h})[Fo(L)],T},{});return Object.keys(E).sort(function(T,L){return E[T]-E[L]})}function iw(r){if(Fo(r)===wf)return[];var e=uf(r);return[mg(r),e,mg(e)]}function nw(r){var e=r.state,n=r.options,o=r.name;if(!e.modifiersData[o]._skip){for(var c=n.mainAxis,d=c===void 0?!0:c,h=n.altAxis,a=h===void 0?!0:h,_=n.fallbackPlacements,S=n.padding,k=n.boundary,y=n.rootBoundary,C=n.altBoundary,E=n.flipVariations,T=E===void 0?!0:E,L=n.allowedAutoPlacements,R=e.options.placement,N=Fo(R),z=N===R,V=_||(z||!T?[uf(R)]:iw(R)),Q=[R].concat(V).reduce(function($e,wt){return $e.concat(Fo(wt)===wf?tw(e,{placement:wt,boundary:k,rootBoundary:y,padding:S,flipVariations:T,allowedAutoPlacements:L}):wt)},[]),oe=e.rects.reference,ee=e.rects.popper,ne=new Map,j=!0,U=Q[0],X=0;X<Q.length;X++){var B=Q[X],W=Fo(B),ce=$c(B)===Vl,pe=[Yr,Cs].indexOf(W)>=0,be=pe?"width":"height",de=eu(e,{placement:B,boundary:k,rootBoundary:y,altBoundary:C,padding:S}),ye=pe?ce?Es:Qr:ce?Cs:Yr;oe[be]>ee[be]&&(ye=uf(ye));var Ie=uf(ye),Me=[];if(d&&Me.push(de[W]<=0),a&&Me.push(de[ye]<=0,de[Ie]<=0),Me.every(function($e){return $e})){U=B,j=!1;break}ne.set(B,Me)}if(j)for(var ot=T?3:1,We=function(wt){var St=Q.find(function(Ht){var oi=ne.get(Ht);if(oi)return oi.slice(0,wt).every(function(Mi){return Mi})});if(St)return U=St,"break"},pt=ot;pt>0;pt--){var Tt=We(pt);if(Tt==="break")break}e.placement!==U&&(e.modifiersData[o]._skip=!0,e.placement=U,e.reset=!0)}}const F0={name:"flip",enabled:!0,phase:"main",fn:nw,requiresIfExists:["offset"],data:{_skip:!1}};function _g(r,e,n){return n===void 0&&(n={x:0,y:0}),{top:r.top-e.height-n.y,right:r.right-e.width+n.x,bottom:r.bottom-e.height+n.y,left:r.left-e.width-n.x}}function yg(r){return[Yr,Es,Cs,Qr].some(function(e){return r[e]>=0})}function rw(r){var e=r.state,n=r.name,o=e.rects.reference,c=e.rects.popper,d=e.modifiersData.preventOverflow,h=eu(e,{elementContext:"reference"}),a=eu(e,{altBoundary:!0}),_=_g(h,o),S=_g(a,c,d),k=yg(_),y=yg(S);e.modifiersData[n]={referenceClippingOffsets:_,popperEscapeOffsets:S,isReferenceHidden:k,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":k,"data-popper-escaped":y})}const R0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:rw};function sw(r,e,n){var o=Fo(r),c=[Qr,Yr].indexOf(o)>=0?-1:1,d=typeof n=="function"?n(Object.assign({},e,{placement:r})):n,h=d[0],a=d[1];return h=h||0,a=(a||0)*c,[Qr,Es].indexOf(o)>=0?{x:a,y:h}:{x:h,y:a}}function ow(r){var e=r.state,n=r.options,o=r.name,c=n.offset,d=c===void 0?[0,0]:c,h=op.reduce(function(k,y){return k[y]=sw(y,e.rects,d),k},{}),a=h[e.placement],_=a.x,S=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=_,e.modifiersData.popperOffsets.y+=S),e.modifiersData[o]=h}const B0={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:ow};function aw(r){var e=r.state,n=r.name;e.modifiersData[n]=D0({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const gp={name:"popperOffsets",enabled:!0,phase:"read",fn:aw,data:{}};function lw(r){return r==="x"?"y":"x"}function cw(r){var e=r.state,n=r.options,o=r.name,c=n.mainAxis,d=c===void 0?!0:c,h=n.altAxis,a=h===void 0?!1:h,_=n.boundary,S=n.rootBoundary,k=n.altBoundary,y=n.padding,C=n.tether,E=C===void 0?!0:C,T=n.tetherOffset,L=T===void 0?0:T,R=eu(e,{boundary:_,rootBoundary:S,padding:y,altBoundary:k}),N=Fo(e.placement),z=$c(e.placement),V=!z,Q=up(N),oe=lw(Q),ee=e.modifiersData.popperOffsets,ne=e.rects.reference,j=e.rects.popper,U=typeof L=="function"?L(Object.assign({},e.rects,{placement:e.placement})):L,X=typeof U=="number"?{mainAxis:U,altAxis:U}:Object.assign({mainAxis:0,altAxis:0},U),B=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,W={x:0,y:0};if(ee){if(d){var ce,pe=Q==="y"?Yr:Qr,be=Q==="y"?Cs:Es,de=Q==="y"?"height":"width",ye=ee[Q],Ie=ye+R[pe],Me=ye-R[be],ot=E?-j[de]/2:0,We=z===Vl?ne[de]:j[de],pt=z===Vl?-j[de]:-ne[de],Tt=e.elements.arrow,$e=E&&Tt?cp(Tt):{width:0,height:0},wt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:M0(),St=wt[pe],Ht=wt[be],oi=sh(0,ne[de],$e[de]),Mi=V?ne[de]/2-ot-oi-St-X.mainAxis:We-oi-St-X.mainAxis,Pi=V?-ne[de]/2+ot+oi+Ht+X.mainAxis:pt+oi+Ht+X.mainAxis,Ti=e.elements.arrow&&bh(e.elements.arrow),At=Ti?Q==="y"?Ti.clientTop||0:Ti.clientLeft||0:0,Xe=(ce=B==null?void 0:B[Q])!=null?ce:0,Pt=ye+Mi-Xe-At,ni=ye+Pi-Xe,Qe=sh(E?mf(Ie,Pt):Ie,ye,E?jl(Me,ni):Me);ee[Q]=Qe,W[Q]=Qe-ye}if(a){var _i,_t=Q==="x"?Yr:Qr,it=Q==="x"?Cs:Es,ue=ee[oe],H=oe==="y"?"height":"width",Y=ue+R[_t],Ae=ue-R[it],Ze=[Yr,Qr].indexOf(N)!==-1,dt=(_i=B==null?void 0:B[oe])!=null?_i:0,st=Ze?Y:ue-ne[H]-j[H]-dt+X.altAxis,Ci=Ze?ue+ne[H]+j[H]-dt-X.altAxis:Ae,ft=E&&Ze?j1(st,ue,Ci):sh(E?st:Y,ue,E?Ci:Ae);ee[oe]=ft,W[oe]=ft-ue}e.modifiersData[o]=W}}const N0={name:"preventOverflow",enabled:!0,phase:"main",fn:cw,requiresIfExists:["offset"]};function uw(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function hw(r){return r===Is(r)||!Hs(r)?dp(r):uw(r)}function fw(r){var e=r.getBoundingClientRect(),n=Yc(e.width)/r.offsetWidth||1,o=Yc(e.height)/r.offsetHeight||1;return n!==1||o!==1}function dw(r,e,n){n===void 0&&(n=!1);var o=Hs(e),c=Hs(e)&&fw(e),d=rl(e),h=Qc(r,c,n),a={scrollLeft:0,scrollTop:0},_={x:0,y:0};return(o||!o&&!n)&&((Bo(e)!=="body"||mp(d))&&(a=hw(e)),Hs(e)?(_=Qc(e,!0),_.x+=e.clientLeft,_.y+=e.clientTop):d&&(_.x=pp(d))),{x:h.left+a.scrollLeft-_.x,y:h.top+a.scrollTop-_.y,width:h.width,height:h.height}}function pw(r){var e=new Map,n=new Set,o=[];r.forEach(function(d){e.set(d.name,d)});function c(d){n.add(d.name);var h=[].concat(d.requires||[],d.requiresIfExists||[]);h.forEach(function(a){if(!n.has(a)){var _=e.get(a);_&&c(_)}}),o.push(d)}return r.forEach(function(d){n.has(d.name)||c(d)}),o}function mw(r){var e=pw(r);return E0.reduce(function(n,o){return n.concat(e.filter(function(c){return c.phase===o}))},[])}function gw(r){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(r())})})),e}}function _w(r){var e=r.reduce(function(n,o){var c=n[o.name];return n[o.name]=c?Object.assign({},c,o,{options:Object.assign({},c.options,o.options),data:Object.assign({},c.data,o.data)}):o,n},{});return Object.keys(e).map(function(n){return e[n]})}var bg={placement:"bottom",modifiers:[],strategy:"absolute"};function vg(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function kf(r){r===void 0&&(r={});var e=r,n=e.defaultModifiers,o=n===void 0?[]:n,c=e.defaultOptions,d=c===void 0?bg:c;return function(a,_,S){S===void 0&&(S=d);var k={placement:"bottom",orderedModifiers:[],options:Object.assign({},bg,d),modifiersData:{},elements:{reference:a,popper:_},attributes:{},styles:{}},y=[],C=!1,E={state:k,setOptions:function(N){var z=typeof N=="function"?N(k.options):N;L(),k.options=Object.assign({},d,k.options,z),k.scrollParents={reference:ql(a)?oh(a):a.contextElement?oh(a.contextElement):[],popper:oh(_)};var V=mw(_w([].concat(o,k.options.modifiers)));return k.orderedModifiers=V.filter(function(Q){return Q.enabled}),T(),E.update()},forceUpdate:function(){if(!C){var N=k.elements,z=N.reference,V=N.popper;if(vg(z,V)){k.rects={reference:dw(z,bh(V),k.options.strategy==="fixed"),popper:cp(V)},k.reset=!1,k.placement=k.options.placement,k.orderedModifiers.forEach(function(X){return k.modifiersData[X.name]=Object.assign({},X.data)});for(var Q=0;Q<k.orderedModifiers.length;Q++){if(k.reset===!0){k.reset=!1,Q=-1;continue}var oe=k.orderedModifiers[Q],ee=oe.fn,ne=oe.options,j=ne===void 0?{}:ne,U=oe.name;typeof ee=="function"&&(k=ee({state:k,options:j,name:U,instance:E})||k)}}}},update:gw(function(){return new Promise(function(R){E.forceUpdate(),R(k)})}),destroy:function(){L(),C=!0}};if(!vg(a,_))return E;E.setOptions(S).then(function(R){!C&&S.onFirstUpdate&&S.onFirstUpdate(R)});function T(){k.orderedModifiers.forEach(function(R){var N=R.name,z=R.options,V=z===void 0?{}:z,Q=R.effect;if(typeof Q=="function"){var oe=Q({state:k,name:N,instance:E,options:V}),ee=function(){};y.push(oe||ee)}})}function L(){y.forEach(function(R){return R()}),y=[]}return E}}var yw=kf(),bw=[fp,gp,hp,lp],vw=kf({defaultModifiers:bw}),ww=[fp,gp,hp,lp,B0,F0,N0,z0,R0],xw=kf({defaultModifiers:ww});const kw=Object.freeze(Object.defineProperty({__proto__:null,afterMain:k0,afterRead:v0,afterWrite:C0,applyStyles:lp,arrow:z0,auto:wf,basePlacements:nu,beforeMain:w0,beforeRead:y0,beforeWrite:S0,bottom:Cs,clippingParents:g0,computeStyles:hp,createPopper:xw,createPopperBase:yw,createPopperLite:vw,detectOverflow:eu,end:Jc,eventListeners:fp,flip:F0,hide:R0,left:Qr,main:x0,modifierPhases:E0,offset:B0,placements:op,popper:jc,popperGenerator:kf,popperOffsets:gp,preventOverflow:N0,read:b0,reference:_0,right:Es,start:Vl,top:Yr,variationPlacements:Nd,viewport:sp,write:T0},Symbol.toStringTag,{value:"Module"})),Sw=O1(kw);/*!
  * Bootstrap v5.3.8 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(r,e){(function(n,o){r.exports=o(Sw)})(m0,function(n){function o(Ne){const D=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(Ne){for(const se in Ne)if(se!=="default"){const Fe=Object.getOwnPropertyDescriptor(Ne,se);Object.defineProperty(D,se,Fe.get?Fe:{enumerable:!0,get:()=>Ne[se]})}}return D.default=Ne,Object.freeze(D)}const c=o(n),d=new Map,h={set(Ne,D,se){d.has(Ne)||d.set(Ne,new Map);const Fe=d.get(Ne);Fe.has(D)||Fe.size===0?Fe.set(D,se):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(Fe.keys())[0]}.`)},get:(Ne,D)=>d.has(Ne)&&d.get(Ne).get(D)||null,remove(Ne,D){if(!d.has(Ne))return;const se=d.get(Ne);se.delete(D),se.size===0&&d.delete(Ne)}},a="transitionend",_=Ne=>(Ne&&window.CSS&&window.CSS.escape&&(Ne=Ne.replace(/#([^\s"#']+)/g,(D,se)=>`#${CSS.escape(se)}`)),Ne),S=Ne=>Ne==null?`${Ne}`:Object.prototype.toString.call(Ne).match(/\s([a-z]+)/i)[1].toLowerCase(),k=Ne=>{Ne.dispatchEvent(new Event(a))},y=Ne=>!(!Ne||typeof Ne!="object")&&(Ne.jquery!==void 0&&(Ne=Ne[0]),Ne.nodeType!==void 0),C=Ne=>y(Ne)?Ne.jquery?Ne[0]:Ne:typeof Ne=="string"&&Ne.length>0?document.querySelector(_(Ne)):null,E=Ne=>{if(!y(Ne)||Ne.getClientRects().length===0)return!1;const D=getComputedStyle(Ne).getPropertyValue("visibility")==="visible",se=Ne.closest("details:not([open])");if(!se)return D;if(se!==Ne){const Fe=Ne.closest("summary");if(Fe&&Fe.parentNode!==se||Fe===null)return!1}return D},T=Ne=>!Ne||Ne.nodeType!==Node.ELEMENT_NODE||!!Ne.classList.contains("disabled")||(Ne.disabled!==void 0?Ne.disabled:Ne.hasAttribute("disabled")&&Ne.getAttribute("disabled")!=="false"),L=Ne=>{if(!document.documentElement.attachShadow)return null;if(typeof Ne.getRootNode=="function"){const D=Ne.getRootNode();return D instanceof ShadowRoot?D:null}return Ne instanceof ShadowRoot?Ne:Ne.parentNode?L(Ne.parentNode):null},R=()=>{},N=Ne=>{Ne.offsetHeight},z=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,V=[],Q=()=>document.documentElement.dir==="rtl",oe=Ne=>{var D;D=()=>{const se=z();if(se){const Fe=Ne.NAME,mt=se.fn[Fe];se.fn[Fe]=Ne.jQueryInterface,se.fn[Fe].Constructor=Ne,se.fn[Fe].noConflict=()=>(se.fn[Fe]=mt,Ne.jQueryInterface)}},document.readyState==="loading"?(V.length||document.addEventListener("DOMContentLoaded",()=>{for(const se of V)se()}),V.push(D)):D()},ee=(Ne,D=[],se=Ne)=>typeof Ne=="function"?Ne.call(...D):se,ne=(Ne,D,se=!0)=>{if(!se)return void ee(Ne);const Fe=(Xt=>{if(!Xt)return 0;let{transitionDuration:Hi,transitionDelay:cn}=window.getComputedStyle(Xt);const On=Number.parseFloat(Hi),In=Number.parseFloat(cn);return On||In?(Hi=Hi.split(",")[0],cn=cn.split(",")[0],1e3*(Number.parseFloat(Hi)+Number.parseFloat(cn))):0})(D)+5;let mt=!1;const It=({target:Xt})=>{Xt===D&&(mt=!0,D.removeEventListener(a,It),ee(Ne))};D.addEventListener(a,It),setTimeout(()=>{mt||k(D)},Fe)},j=(Ne,D,se,Fe)=>{const mt=Ne.length;let It=Ne.indexOf(D);return It===-1?!se&&Fe?Ne[mt-1]:Ne[0]:(It+=se?1:-1,Fe&&(It=(It+mt)%mt),Ne[Math.max(0,Math.min(It,mt-1))])},U=/[^.]*(?=\..*)\.|.*/,X=/\..*/,B=/::\d+$/,W={};let ce=1;const pe={mouseenter:"mouseover",mouseleave:"mouseout"},be=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function de(Ne,D){return D&&`${D}::${ce++}`||Ne.uidEvent||ce++}function ye(Ne){const D=de(Ne);return Ne.uidEvent=D,W[D]=W[D]||{},W[D]}function Ie(Ne,D,se=null){return Object.values(Ne).find(Fe=>Fe.callable===D&&Fe.delegationSelector===se)}function Me(Ne,D,se){const Fe=typeof D=="string",mt=Fe?se:D||se;let It=Tt(Ne);return be.has(It)||(It=Ne),[Fe,mt,It]}function ot(Ne,D,se,Fe,mt){if(typeof D!="string"||!Ne)return;let[It,Xt,Hi]=Me(D,se,Fe);D in pe&&(Xt=(rs=>function(wr){if(!wr.relatedTarget||wr.relatedTarget!==wr.delegateTarget&&!wr.delegateTarget.contains(wr.relatedTarget))return rs.call(this,wr)})(Xt));const cn=ye(Ne),On=cn[Hi]||(cn[Hi]={}),In=Ie(On,Xt,It?se:null);if(In)return void(In.oneOff=In.oneOff&&mt);const vr=de(Xt,D.replace(U,"")),Lr=It?function(Wr,rs,wr){return function oo(ss){const Da=Wr.querySelectorAll(rs);for(let{target:Gr}=ss;Gr&&Gr!==this;Gr=Gr.parentNode)for(const vl of Da)if(vl===Gr)return wt(ss,{delegateTarget:Gr}),oo.oneOff&&$e.off(Wr,ss.type,rs,wr),wr.apply(Gr,[ss])}}(Ne,se,Xt):function(Wr,rs){return function wr(oo){return wt(oo,{delegateTarget:Wr}),wr.oneOff&&$e.off(Wr,oo.type,rs),rs.apply(Wr,[oo])}}(Ne,Xt);Lr.delegationSelector=It?se:null,Lr.callable=Xt,Lr.oneOff=mt,Lr.uidEvent=vr,On[vr]=Lr,Ne.addEventListener(Hi,Lr,It)}function We(Ne,D,se,Fe,mt){const It=Ie(D[se],Fe,mt);It&&(Ne.removeEventListener(se,It,!!mt),delete D[se][It.uidEvent])}function pt(Ne,D,se,Fe){const mt=D[se]||{};for(const[It,Xt]of Object.entries(mt))It.includes(Fe)&&We(Ne,D,se,Xt.callable,Xt.delegationSelector)}function Tt(Ne){return Ne=Ne.replace(X,""),pe[Ne]||Ne}const $e={on(Ne,D,se,Fe){ot(Ne,D,se,Fe,!1)},one(Ne,D,se,Fe){ot(Ne,D,se,Fe,!0)},off(Ne,D,se,Fe){if(typeof D!="string"||!Ne)return;const[mt,It,Xt]=Me(D,se,Fe),Hi=Xt!==D,cn=ye(Ne),On=cn[Xt]||{},In=D.startsWith(".");if(It===void 0){if(In)for(const vr of Object.keys(cn))pt(Ne,cn,vr,D.slice(1));for(const[vr,Lr]of Object.entries(On)){const Wr=vr.replace(B,"");Hi&&!D.includes(Wr)||We(Ne,cn,Xt,Lr.callable,Lr.delegationSelector)}}else{if(!Object.keys(On).length)return;We(Ne,cn,Xt,It,mt?se:null)}},trigger(Ne,D,se){if(typeof D!="string"||!Ne)return null;const Fe=z();let mt=null,It=!0,Xt=!0,Hi=!1;D!==Tt(D)&&Fe&&(mt=Fe.Event(D,se),Fe(Ne).trigger(mt),It=!mt.isPropagationStopped(),Xt=!mt.isImmediatePropagationStopped(),Hi=mt.isDefaultPrevented());const cn=wt(new Event(D,{bubbles:It,cancelable:!0}),se);return Hi&&cn.preventDefault(),Xt&&Ne.dispatchEvent(cn),cn.defaultPrevented&&mt&&mt.preventDefault(),cn}};function wt(Ne,D={}){for(const[se,Fe]of Object.entries(D))try{Ne[se]=Fe}catch{Object.defineProperty(Ne,se,{configurable:!0,get:()=>Fe})}return Ne}function St(Ne){if(Ne==="true")return!0;if(Ne==="false")return!1;if(Ne===Number(Ne).toString())return Number(Ne);if(Ne===""||Ne==="null")return null;if(typeof Ne!="string")return Ne;try{return JSON.parse(decodeURIComponent(Ne))}catch{return Ne}}function Ht(Ne){return Ne.replace(/[A-Z]/g,D=>`-${D.toLowerCase()}`)}const oi={setDataAttribute(Ne,D,se){Ne.setAttribute(`data-bs-${Ht(D)}`,se)},removeDataAttribute(Ne,D){Ne.removeAttribute(`data-bs-${Ht(D)}`)},getDataAttributes(Ne){if(!Ne)return{};const D={},se=Object.keys(Ne.dataset).filter(Fe=>Fe.startsWith("bs")&&!Fe.startsWith("bsConfig"));for(const Fe of se){let mt=Fe.replace(/^bs/,"");mt=mt.charAt(0).toLowerCase()+mt.slice(1),D[mt]=St(Ne.dataset[Fe])}return D},getDataAttribute:(Ne,D)=>St(Ne.getAttribute(`data-bs-${Ht(D)}`))};class Mi{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(D){return D=this._mergeConfigObj(D),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}_configAfterMerge(D){return D}_mergeConfigObj(D,se){const Fe=y(se)?oi.getDataAttribute(se,"config"):{};return{...this.constructor.Default,...typeof Fe=="object"?Fe:{},...y(se)?oi.getDataAttributes(se):{},...typeof D=="object"?D:{}}}_typeCheckConfig(D,se=this.constructor.DefaultType){for(const[Fe,mt]of Object.entries(se)){const It=D[Fe],Xt=y(It)?"element":S(It);if(!new RegExp(mt).test(Xt))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${Fe}" provided type "${Xt}" but expected type "${mt}".`)}}}class Pi extends Mi{constructor(D,se){super(),(D=C(D))&&(this._element=D,this._config=this._getConfig(se),h.set(this._element,this.constructor.DATA_KEY,this))}dispose(){h.remove(this._element,this.constructor.DATA_KEY),$e.off(this._element,this.constructor.EVENT_KEY);for(const D of Object.getOwnPropertyNames(this))this[D]=null}_queueCallback(D,se,Fe=!0){ne(D,se,Fe)}_getConfig(D){return D=this._mergeConfigObj(D,this._element),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}static getInstance(D){return h.get(C(D),this.DATA_KEY)}static getOrCreateInstance(D,se={}){return this.getInstance(D)||new this(D,typeof se=="object"?se:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(D){return`${D}${this.EVENT_KEY}`}}const Ti=Ne=>{let D=Ne.getAttribute("data-bs-target");if(!D||D==="#"){let se=Ne.getAttribute("href");if(!se||!se.includes("#")&&!se.startsWith("."))return null;se.includes("#")&&!se.startsWith("#")&&(se=`#${se.split("#")[1]}`),D=se&&se!=="#"?se.trim():null}return D?D.split(",").map(se=>_(se)).join(","):null},At={find:(Ne,D=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(D,Ne)),findOne:(Ne,D=document.documentElement)=>Element.prototype.querySelector.call(D,Ne),children:(Ne,D)=>[].concat(...Ne.children).filter(se=>se.matches(D)),parents(Ne,D){const se=[];let Fe=Ne.parentNode.closest(D);for(;Fe;)se.push(Fe),Fe=Fe.parentNode.closest(D);return se},prev(Ne,D){let se=Ne.previousElementSibling;for(;se;){if(se.matches(D))return[se];se=se.previousElementSibling}return[]},next(Ne,D){let se=Ne.nextElementSibling;for(;se;){if(se.matches(D))return[se];se=se.nextElementSibling}return[]},focusableChildren(Ne){const D=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(se=>`${se}:not([tabindex^="-"])`).join(",");return this.find(D,Ne).filter(se=>!T(se)&&E(se))},getSelectorFromElement(Ne){const D=Ti(Ne);return D&&At.findOne(D)?D:null},getElementFromSelector(Ne){const D=Ti(Ne);return D?At.findOne(D):null},getMultipleElementsFromSelector(Ne){const D=Ti(Ne);return D?At.find(D):[]}},Xe=(Ne,D="hide")=>{const se=`click.dismiss${Ne.EVENT_KEY}`,Fe=Ne.NAME;$e.on(document,se,`[data-bs-dismiss="${Fe}"]`,function(mt){if(["A","AREA"].includes(this.tagName)&&mt.preventDefault(),T(this))return;const It=At.getElementFromSelector(this)||this.closest(`.${Fe}`);Ne.getOrCreateInstance(It)[D]()})},Pt=".bs.alert",ni=`close${Pt}`,Qe=`closed${Pt}`;class _i extends Pi{static get NAME(){return"alert"}close(){if($e.trigger(this._element,ni).defaultPrevented)return;this._element.classList.remove("show");const D=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,D)}_destroyElement(){this._element.remove(),$e.trigger(this._element,Qe),this.dispose()}static jQueryInterface(D){return this.each(function(){const se=_i.getOrCreateInstance(this);if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D](this)}})}}Xe(_i,"close"),oe(_i);const _t='[data-bs-toggle="button"]';class it extends Pi{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(D){return this.each(function(){const se=it.getOrCreateInstance(this);D==="toggle"&&se[D]()})}}$e.on(document,"click.bs.button.data-api",_t,Ne=>{Ne.preventDefault();const D=Ne.target.closest(_t);it.getOrCreateInstance(D).toggle()}),oe(it);const ue=".bs.swipe",H=`touchstart${ue}`,Y=`touchmove${ue}`,Ae=`touchend${ue}`,Ze=`pointerdown${ue}`,dt=`pointerup${ue}`,st={endCallback:null,leftCallback:null,rightCallback:null},Ci={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class ft extends Mi{constructor(D,se){super(),this._element=D,D&&ft.isSupported()&&(this._config=this._getConfig(se),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return st}static get DefaultType(){return Ci}static get NAME(){return"swipe"}dispose(){$e.off(this._element,ue)}_start(D){this._supportPointerEvents?this._eventIsPointerPenTouch(D)&&(this._deltaX=D.clientX):this._deltaX=D.touches[0].clientX}_end(D){this._eventIsPointerPenTouch(D)&&(this._deltaX=D.clientX-this._deltaX),this._handleSwipe(),ee(this._config.endCallback)}_move(D){this._deltaX=D.touches&&D.touches.length>1?0:D.touches[0].clientX-this._deltaX}_handleSwipe(){const D=Math.abs(this._deltaX);if(D<=40)return;const se=D/this._deltaX;this._deltaX=0,se&&ee(se>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?($e.on(this._element,Ze,D=>this._start(D)),$e.on(this._element,dt,D=>this._end(D)),this._element.classList.add("pointer-event")):($e.on(this._element,H,D=>this._start(D)),$e.on(this._element,Y,D=>this._move(D)),$e.on(this._element,Ae,D=>this._end(D)))}_eventIsPointerPenTouch(D){return this._supportPointerEvents&&(D.pointerType==="pen"||D.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Wt=".bs.carousel",Ei=".data-api",Fi="ArrowLeft",Cn="ArrowRight",kt="next",ui="prev",ii="left",nn="right",gr=`slide${Wt}`,ai=`slid${Wt}`,_r=`keydown${Wt}`,yr=`mouseenter${Wt}`,Ir=`mouseleave${Wt}`,Ar=`dragstart${Wt}`,Pe=`load${Wt}${Ei}`,te=`click${Wt}${Ei}`,ie="carousel",me="active",Se=".active",Ue=".carousel-item",Ge=Se+Ue,et={[Fi]:nn,[Cn]:ii},Re={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},at={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class yt extends Pi{constructor(D,se){super(D,se),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=At.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===ie&&this.cycle()}static get Default(){return Re}static get DefaultType(){return at}static get NAME(){return"carousel"}next(){this._slide(kt)}nextWhenVisible(){!document.hidden&&E(this._element)&&this.next()}prev(){this._slide(ui)}pause(){this._isSliding&&k(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?$e.one(this._element,ai,()=>this.cycle()):this.cycle())}to(D){const se=this._getItems();if(D>se.length-1||D<0)return;if(this._isSliding)return void $e.one(this._element,ai,()=>this.to(D));const Fe=this._getItemIndex(this._getActive());if(Fe===D)return;const mt=D>Fe?kt:ui;this._slide(mt,se[D])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(D){return D.defaultInterval=D.interval,D}_addEventListeners(){this._config.keyboard&&$e.on(this._element,_r,D=>this._keydown(D)),this._config.pause==="hover"&&($e.on(this._element,yr,()=>this.pause()),$e.on(this._element,Ir,()=>this._maybeEnableCycle())),this._config.touch&&ft.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const se of At.find(".carousel-item img",this._element))$e.on(se,Ar,Fe=>Fe.preventDefault());const D={leftCallback:()=>this._slide(this._directionToOrder(ii)),rightCallback:()=>this._slide(this._directionToOrder(nn)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new ft(this._element,D)}_keydown(D){if(/input|textarea/i.test(D.target.tagName))return;const se=et[D.key];se&&(D.preventDefault(),this._slide(this._directionToOrder(se)))}_getItemIndex(D){return this._getItems().indexOf(D)}_setActiveIndicatorElement(D){if(!this._indicatorsElement)return;const se=At.findOne(Se,this._indicatorsElement);se.classList.remove(me),se.removeAttribute("aria-current");const Fe=At.findOne(`[data-bs-slide-to="${D}"]`,this._indicatorsElement);Fe&&(Fe.classList.add(me),Fe.setAttribute("aria-current","true"))}_updateInterval(){const D=this._activeElement||this._getActive();if(!D)return;const se=Number.parseInt(D.getAttribute("data-bs-interval"),10);this._config.interval=se||this._config.defaultInterval}_slide(D,se=null){if(this._isSliding)return;const Fe=this._getActive(),mt=D===kt,It=se||j(this._getItems(),Fe,mt,this._config.wrap);if(It===Fe)return;const Xt=this._getItemIndex(It),Hi=vr=>$e.trigger(this._element,vr,{relatedTarget:It,direction:this._orderToDirection(D),from:this._getItemIndex(Fe),to:Xt});if(Hi(gr).defaultPrevented||!Fe||!It)return;const cn=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Xt),this._activeElement=It;const On=mt?"carousel-item-start":"carousel-item-end",In=mt?"carousel-item-next":"carousel-item-prev";It.classList.add(In),N(It),Fe.classList.add(On),It.classList.add(On),this._queueCallback(()=>{It.classList.remove(On,In),It.classList.add(me),Fe.classList.remove(me,In,On),this._isSliding=!1,Hi(ai)},Fe,this._isAnimated()),cn&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return At.findOne(Ge,this._element)}_getItems(){return At.find(Ue,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(D){return Q()?D===ii?ui:kt:D===ii?kt:ui}_orderToDirection(D){return Q()?D===ui?ii:nn:D===ui?nn:ii}static jQueryInterface(D){return this.each(function(){const se=yt.getOrCreateInstance(this,D);if(typeof D!="number"){if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D]()}}else se.to(D)})}}$e.on(document,te,"[data-bs-slide], [data-bs-slide-to]",function(Ne){const D=At.getElementFromSelector(this);if(!D||!D.classList.contains(ie))return;Ne.preventDefault();const se=yt.getOrCreateInstance(D),Fe=this.getAttribute("data-bs-slide-to");return Fe?(se.to(Fe),void se._maybeEnableCycle()):oi.getDataAttribute(this,"slide")==="next"?(se.next(),void se._maybeEnableCycle()):(se.prev(),void se._maybeEnableCycle())}),$e.on(window,Pe,()=>{const Ne=At.find('[data-bs-ride="carousel"]');for(const D of Ne)yt.getOrCreateInstance(D)}),oe(yt);const rt=".bs.collapse",Et=`show${rt}`,Yt=`shown${rt}`,ri=`hide${rt}`,Bi=`hidden${rt}`,wi=`click${rt}.data-api`,zi="show",Si="collapse",hn="collapsing",fn=`:scope .${Si} .${Si}`,Ke='[data-bs-toggle="collapse"]',pi={parent:null,toggle:!0},ki={parent:"(null|element)",toggle:"boolean"};class Ni extends Pi{constructor(D,se){super(D,se),this._isTransitioning=!1,this._triggerArray=[];const Fe=At.find(Ke);for(const mt of Fe){const It=At.getSelectorFromElement(mt),Xt=At.find(It).filter(Hi=>Hi===this._element);It!==null&&Xt.length&&this._triggerArray.push(mt)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return pi}static get DefaultType(){return ki}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let D=[];if(this._config.parent&&(D=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(mt=>mt!==this._element).map(mt=>Ni.getOrCreateInstance(mt,{toggle:!1}))),D.length&&D[0]._isTransitioning||$e.trigger(this._element,Et).defaultPrevented)return;for(const mt of D)mt.hide();const se=this._getDimension();this._element.classList.remove(Si),this._element.classList.add(hn),this._element.style[se]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const Fe=`scroll${se[0].toUpperCase()+se.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(hn),this._element.classList.add(Si,zi),this._element.style[se]="",$e.trigger(this._element,Yt)},this._element,!0),this._element.style[se]=`${this._element[Fe]}px`}hide(){if(this._isTransitioning||!this._isShown()||$e.trigger(this._element,ri).defaultPrevented)return;const D=this._getDimension();this._element.style[D]=`${this._element.getBoundingClientRect()[D]}px`,N(this._element),this._element.classList.add(hn),this._element.classList.remove(Si,zi);for(const se of this._triggerArray){const Fe=At.getElementFromSelector(se);Fe&&!this._isShown(Fe)&&this._addAriaAndCollapsedClass([se],!1)}this._isTransitioning=!0,this._element.style[D]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(hn),this._element.classList.add(Si),$e.trigger(this._element,Bi)},this._element,!0)}_isShown(D=this._element){return D.classList.contains(zi)}_configAfterMerge(D){return D.toggle=!!D.toggle,D.parent=C(D.parent),D}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const D=this._getFirstLevelChildren(Ke);for(const se of D){const Fe=At.getElementFromSelector(se);Fe&&this._addAriaAndCollapsedClass([se],this._isShown(Fe))}}_getFirstLevelChildren(D){const se=At.find(fn,this._config.parent);return At.find(D,this._config.parent).filter(Fe=>!se.includes(Fe))}_addAriaAndCollapsedClass(D,se){if(D.length)for(const Fe of D)Fe.classList.toggle("collapsed",!se),Fe.setAttribute("aria-expanded",se)}static jQueryInterface(D){const se={};return typeof D=="string"&&/show|hide/.test(D)&&(se.toggle=!1),this.each(function(){const Fe=Ni.getOrCreateInstance(this,se);if(typeof D=="string"){if(Fe[D]===void 0)throw new TypeError(`No method named "${D}"`);Fe[D]()}})}}$e.on(document,wi,Ke,function(Ne){(Ne.target.tagName==="A"||Ne.delegateTarget&&Ne.delegateTarget.tagName==="A")&&Ne.preventDefault();for(const D of At.getMultipleElementsFromSelector(this))Ni.getOrCreateInstance(D,{toggle:!1}).toggle()}),oe(Ni);const Ki="dropdown",Ji=".bs.dropdown",jn=".data-api",si="ArrowUp",$r="ArrowDown",Hn=`hide${Ji}`,Un=`hidden${Ji}`,pn=`show${Ji}`,_a=`shown${Ji}`,zn=`click${Ji}${jn}`,Xn=`keydown${Ji}${jn}`,Ur=`keyup${Ji}${jn}`,Rn="show",Ii='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',No=`${Ii}.${Rn}`,rr=".dropdown-menu",En=Q()?"top-end":"top-start",ya=Q()?"top-start":"top-end",Vr=Q()?"bottom-end":"bottom-start",al=Q()?"bottom-start":"bottom-end",qr=Q()?"left-start":"right-start",ou=Q()?"right-start":"left-start",ba={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Xs={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Bn extends Pi{constructor(D,se){super(D,se),this._popper=null,this._parent=this._element.parentNode,this._menu=At.next(this._element,rr)[0]||At.prev(this._element,rr)[0]||At.findOne(rr,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return ba}static get DefaultType(){return Xs}static get NAME(){return Ki}toggle(){return this._isShown()?this.hide():this.show()}show(){if(T(this._element)||this._isShown())return;const D={relatedTarget:this._element};if(!$e.trigger(this._element,pn,D).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const se of[].concat(...document.body.children))$e.on(se,"mouseover",R);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Rn),this._element.classList.add(Rn),$e.trigger(this._element,_a,D)}}hide(){if(T(this._element)||!this._isShown())return;const D={relatedTarget:this._element};this._completeHide(D)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(D){if(!$e.trigger(this._element,Hn,D).defaultPrevented){if("ontouchstart"in document.documentElement)for(const se of[].concat(...document.body.children))$e.off(se,"mouseover",R);this._popper&&this._popper.destroy(),this._menu.classList.remove(Rn),this._element.classList.remove(Rn),this._element.setAttribute("aria-expanded","false"),oi.removeDataAttribute(this._menu,"popper"),$e.trigger(this._element,Un,D)}}_getConfig(D){if(typeof(D=super._getConfig(D)).reference=="object"&&!y(D.reference)&&typeof D.reference.getBoundingClientRect!="function")throw new TypeError(`${Ki.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return D}_createPopper(){if(c===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let D=this._element;this._config.reference==="parent"?D=this._parent:y(this._config.reference)?D=C(this._config.reference):typeof this._config.reference=="object"&&(D=this._config.reference);const se=this._getPopperConfig();this._popper=c.createPopper(D,this._menu,se)}_isShown(){return this._menu.classList.contains(Rn)}_getPlacement(){const D=this._parent;if(D.classList.contains("dropend"))return qr;if(D.classList.contains("dropstart"))return ou;if(D.classList.contains("dropup-center"))return"top";if(D.classList.contains("dropdown-center"))return"bottom";const se=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return D.classList.contains("dropup")?se?ya:En:se?al:Vr}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:D}=this._config;return typeof D=="string"?D.split(",").map(se=>Number.parseInt(se,10)):typeof D=="function"?se=>D(se,this._element):D}_getPopperConfig(){const D={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(oi.setDataAttribute(this._menu,"popper","static"),D.modifiers=[{name:"applyStyles",enabled:!1}]),{...D,...ee(this._config.popperConfig,[void 0,D])}}_selectMenuItem({key:D,target:se}){const Fe=At.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(mt=>E(mt));Fe.length&&j(Fe,se,D===$r,!Fe.includes(se)).focus()}static jQueryInterface(D){return this.each(function(){const se=Bn.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0)throw new TypeError(`No method named "${D}"`);se[D]()}})}static clearMenus(D){if(D.button===2||D.type==="keyup"&&D.key!=="Tab")return;const se=At.find(No);for(const Fe of se){const mt=Bn.getInstance(Fe);if(!mt||mt._config.autoClose===!1)continue;const It=D.composedPath(),Xt=It.includes(mt._menu);if(It.includes(mt._element)||mt._config.autoClose==="inside"&&!Xt||mt._config.autoClose==="outside"&&Xt||mt._menu.contains(D.target)&&(D.type==="keyup"&&D.key==="Tab"||/input|select|option|textarea|form/i.test(D.target.tagName)))continue;const Hi={relatedTarget:mt._element};D.type==="click"&&(Hi.clickEvent=D),mt._completeHide(Hi)}}static dataApiKeydownHandler(D){const se=/input|textarea/i.test(D.target.tagName),Fe=D.key==="Escape",mt=[si,$r].includes(D.key);if(!mt&&!Fe||se&&!Fe)return;D.preventDefault();const It=this.matches(Ii)?this:At.prev(this,Ii)[0]||At.next(this,Ii)[0]||At.findOne(Ii,D.delegateTarget.parentNode),Xt=Bn.getOrCreateInstance(It);if(mt)return D.stopPropagation(),Xt.show(),void Xt._selectMenuItem(D);Xt._isShown()&&(D.stopPropagation(),Xt.hide(),It.focus())}}$e.on(document,Xn,Ii,Bn.dataApiKeydownHandler),$e.on(document,Xn,rr,Bn.dataApiKeydownHandler),$e.on(document,zn,Bn.clearMenus),$e.on(document,Ur,Bn.clearMenus),$e.on(document,zn,Ii,function(Ne){Ne.preventDefault(),Bn.getOrCreateInstance(this).toggle()}),oe(Bn);const Gi="backdrop",va="show",wa=`mousedown.bs.${Gi}`,fo={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},ll={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class jo extends Mi{constructor(D){super(),this._config=this._getConfig(D),this._isAppended=!1,this._element=null}static get Default(){return fo}static get DefaultType(){return ll}static get NAME(){return Gi}show(D){if(!this._config.isVisible)return void ee(D);this._append();const se=this._getElement();this._config.isAnimated&&N(se),se.classList.add(va),this._emulateAnimation(()=>{ee(D)})}hide(D){this._config.isVisible?(this._getElement().classList.remove(va),this._emulateAnimation(()=>{this.dispose(),ee(D)})):ee(D)}dispose(){this._isAppended&&($e.off(this._element,wa),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const D=document.createElement("div");D.className=this._config.className,this._config.isAnimated&&D.classList.add("fade"),this._element=D}return this._element}_configAfterMerge(D){return D.rootElement=C(D.rootElement),D}_append(){if(this._isAppended)return;const D=this._getElement();this._config.rootElement.append(D),$e.on(D,wa,()=>{ee(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(D){ne(D,this._getElement(),this._config.isAnimated)}}const As=".bs.focustrap",xa=`focusin${As}`,po=`keydown.tab${As}`,cl="backward",au={autofocus:!0,trapElement:null},Hl={autofocus:"boolean",trapElement:"element"};class Xl extends Mi{constructor(D){super(),this._config=this._getConfig(D),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return au}static get DefaultType(){return Hl}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),$e.off(document,As),$e.on(document,xa,D=>this._handleFocusin(D)),$e.on(document,po,D=>this._handleKeydown(D)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,$e.off(document,As))}_handleFocusin(D){const{trapElement:se}=this._config;if(D.target===document||D.target===se||se.contains(D.target))return;const Fe=At.focusableChildren(se);Fe.length===0?se.focus():this._lastTabNavDirection===cl?Fe[Fe.length-1].focus():Fe[0].focus()}_handleKeydown(D){D.key==="Tab"&&(this._lastTabNavDirection=D.shiftKey?cl:"forward")}}const Ms=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",mo=".sticky-top",Vn="padding-right",$n="margin-right";class go{constructor(){this._element=document.body}getWidth(){const D=document.documentElement.clientWidth;return Math.abs(window.innerWidth-D)}hide(){const D=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Vn,se=>se+D),this._setElementAttributes(Ms,Vn,se=>se+D),this._setElementAttributes(mo,$n,se=>se-D)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Vn),this._resetElementAttributes(Ms,Vn),this._resetElementAttributes(mo,$n)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(D,se,Fe){const mt=this.getWidth();this._applyManipulationCallback(D,It=>{if(It!==this._element&&window.innerWidth>It.clientWidth+mt)return;this._saveInitialAttribute(It,se);const Xt=window.getComputedStyle(It).getPropertyValue(se);It.style.setProperty(se,`${Fe(Number.parseFloat(Xt))}px`)})}_saveInitialAttribute(D,se){const Fe=D.style.getPropertyValue(se);Fe&&oi.setDataAttribute(D,se,Fe)}_resetElementAttributes(D,se){this._applyManipulationCallback(D,Fe=>{const mt=oi.getDataAttribute(Fe,se);mt!==null?(oi.removeDataAttribute(Fe,se),Fe.style.setProperty(se,mt)):Fe.style.removeProperty(se)})}_applyManipulationCallback(D,se){if(y(D))se(D);else for(const Fe of At.find(D,this._element))se(Fe)}}const er=".bs.modal",ka=`hide${er}`,Kl=`hidePrevented${er}`,Ks=`hidden${er}`,Jl=`show${er}`,Yl=`shown${er}`,Ql=`resize${er}`,lu=`click.dismiss${er}`,cu=`mousedown.dismiss${er}`,$l=`keydown.dismiss${er}`,Uo=`click${er}.data-api`,Sa="modal-open",Vo="show",qo="modal-static",ul={backdrop:!0,focus:!0,keyboard:!0},es={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Js extends Pi{constructor(D,se){super(D,se),this._dialog=At.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new go,this._addEventListeners()}static get Default(){return ul}static get DefaultType(){return es}static get NAME(){return"modal"}toggle(D){return this._isShown?this.hide():this.show(D)}show(D){this._isShown||this._isTransitioning||$e.trigger(this._element,Jl,{relatedTarget:D}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Sa),this._adjustDialog(),this._backdrop.show(()=>this._showElement(D)))}hide(){this._isShown&&!this._isTransitioning&&($e.trigger(this._element,ka).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Vo),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){$e.off(window,er),$e.off(this._dialog,er),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new jo({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Xl({trapElement:this._element})}_showElement(D){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const se=At.findOne(".modal-body",this._dialog);se&&(se.scrollTop=0),N(this._element),this._element.classList.add(Vo),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,$e.trigger(this._element,Yl,{relatedTarget:D})},this._dialog,this._isAnimated())}_addEventListeners(){$e.on(this._element,$l,D=>{D.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),$e.on(window,Ql,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),$e.on(this._element,cu,D=>{$e.one(this._element,lu,se=>{this._element===D.target&&this._element===se.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Sa),this._resetAdjustments(),this._scrollBar.reset(),$e.trigger(this._element,Ks)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if($e.trigger(this._element,Kl).defaultPrevented)return;const D=this._element.scrollHeight>document.documentElement.clientHeight,se=this._element.style.overflowY;se==="hidden"||this._element.classList.contains(qo)||(D||(this._element.style.overflowY="hidden"),this._element.classList.add(qo),this._queueCallback(()=>{this._element.classList.remove(qo),this._queueCallback(()=>{this._element.style.overflowY=se},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const D=this._element.scrollHeight>document.documentElement.clientHeight,se=this._scrollBar.getWidth(),Fe=se>0;if(Fe&&!D){const mt=Q()?"paddingLeft":"paddingRight";this._element.style[mt]=`${se}px`}if(!Fe&&D){const mt=Q()?"paddingRight":"paddingLeft";this._element.style[mt]=`${se}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(D,se){return this.each(function(){const Fe=Js.getOrCreateInstance(this,D);if(typeof D=="string"){if(Fe[D]===void 0)throw new TypeError(`No method named "${D}"`);Fe[D](se)}})}}$e.on(document,Uo,'[data-bs-toggle="modal"]',function(Ne){const D=At.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&Ne.preventDefault(),$e.one(D,Jl,Fe=>{Fe.defaultPrevented||$e.one(D,Ks,()=>{E(this)&&this.focus()})});const se=At.findOne(".modal.show");se&&Js.getInstance(se).hide(),Js.getOrCreateInstance(D).toggle(this)}),Xe(Js),oe(Js);const Zr=".bs.offcanvas",Ps=".data-api",Ls=`load${Zr}${Ps}`,Xi="show",Zo="showing",ec="hiding",Ys=".offcanvas.show",uu=`show${Zr}`,tc=`shown${Zr}`,hu=`hide${Zr}`,hl=`hidePrevented${Zr}`,Ta=`hidden${Zr}`,ic=`resize${Zr}`,nc=`click${Zr}${Ps}`,rc=`keydown.dismiss${Zr}`,sc={backdrop:!0,keyboard:!0,scroll:!1},Qs={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class ts extends Pi{constructor(D,se){super(D,se),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return sc}static get DefaultType(){return Qs}static get NAME(){return"offcanvas"}toggle(D){return this._isShown?this.hide():this.show(D)}show(D){this._isShown||$e.trigger(this._element,uu,{relatedTarget:D}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new go().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Zo),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Xi),this._element.classList.remove(Zo),$e.trigger(this._element,tc,{relatedTarget:D})},this._element,!0))}hide(){this._isShown&&($e.trigger(this._element,hu).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(ec),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Xi,ec),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new go().reset(),$e.trigger(this._element,Ta)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const D=!!this._config.backdrop;return new jo({className:"offcanvas-backdrop",isVisible:D,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:D?()=>{this._config.backdrop!=="static"?this.hide():$e.trigger(this._element,hl)}:null})}_initializeFocusTrap(){return new Xl({trapElement:this._element})}_addEventListeners(){$e.on(this._element,rc,D=>{D.key==="Escape"&&(this._config.keyboard?this.hide():$e.trigger(this._element,hl))})}static jQueryInterface(D){return this.each(function(){const se=ts.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D](this)}})}}$e.on(document,nc,'[data-bs-toggle="offcanvas"]',function(Ne){const D=At.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&Ne.preventDefault(),T(this))return;$e.one(D,Ta,()=>{E(this)&&this.focus()});const se=At.findOne(Ys);se&&se!==D&&ts.getInstance(se).hide(),ts.getOrCreateInstance(D).toggle(this)}),$e.on(window,Ls,()=>{for(const Ne of At.find(Ys))ts.getOrCreateInstance(Ne).show()}),$e.on(window,ic,()=>{for(const Ne of At.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(Ne).position!=="fixed"&&ts.getOrCreateInstance(Ne).hide()}),Xe(ts),oe(ts);const oc={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},ac=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Wo=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,fu=(Ne,D)=>{const se=Ne.nodeName.toLowerCase();return D.includes(se)?!ac.has(se)||!!Wo.test(Ne.nodeValue):D.filter(Fe=>Fe instanceof RegExp).some(Fe=>Fe.test(se))},Ca={allowList:oc,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},du={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},pu={entry:"(string|element|function|null)",selector:"(string|element)"};class lc extends Mi{constructor(D){super(),this._config=this._getConfig(D)}static get Default(){return Ca}static get DefaultType(){return du}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(D=>this._resolvePossibleFunction(D)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(D){return this._checkContent(D),this._config.content={...this._config.content,...D},this}toHtml(){const D=document.createElement("div");D.innerHTML=this._maybeSanitize(this._config.template);for(const[mt,It]of Object.entries(this._config.content))this._setContent(D,It,mt);const se=D.children[0],Fe=this._resolvePossibleFunction(this._config.extraClass);return Fe&&se.classList.add(...Fe.split(" ")),se}_typeCheckConfig(D){super._typeCheckConfig(D),this._checkContent(D.content)}_checkContent(D){for(const[se,Fe]of Object.entries(D))super._typeCheckConfig({selector:se,entry:Fe},pu)}_setContent(D,se,Fe){const mt=At.findOne(Fe,D);mt&&((se=this._resolvePossibleFunction(se))?y(se)?this._putElementInTemplate(C(se),mt):this._config.html?mt.innerHTML=this._maybeSanitize(se):mt.textContent=se:mt.remove())}_maybeSanitize(D){return this._config.sanitize?function(se,Fe,mt){if(!se.length)return se;if(mt&&typeof mt=="function")return mt(se);const It=new window.DOMParser().parseFromString(se,"text/html"),Xt=[].concat(...It.body.querySelectorAll("*"));for(const Hi of Xt){const cn=Hi.nodeName.toLowerCase();if(!Object.keys(Fe).includes(cn)){Hi.remove();continue}const On=[].concat(...Hi.attributes),In=[].concat(Fe["*"]||[],Fe[cn]||[]);for(const vr of On)fu(vr,In)||Hi.removeAttribute(vr.nodeName)}return It.body.innerHTML}(D,this._config.allowList,this._config.sanitizeFn):D}_resolvePossibleFunction(D){return ee(D,[void 0,this])}_putElementInTemplate(D,se){if(this._config.html)return se.innerHTML="",void se.append(D);se.textContent=D.textContent}}const cc=new Set(["sanitize","allowList","sanitizeFn"]),Ea="fade",_o="show",uc=".tooltip-inner",Go=".modal",is="hide.bs.modal",$s="hover",Ho="focus",Xo="click",Ia={AUTO:"auto",TOP:"top",RIGHT:Q()?"left":"right",BOTTOM:"bottom",LEFT:Q()?"right":"left"},fl={allowList:oc,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},eo={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class ps extends Pi{constructor(D,se){if(c===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(D,se),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return fl}static get DefaultType(){return eo}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),$e.off(this._element.closest(Go),is,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const D=$e.trigger(this._element,this.constructor.eventName("show")),se=(L(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(D.defaultPrevented||!se)return;this._disposePopper();const Fe=this._getTipElement();this._element.setAttribute("aria-describedby",Fe.getAttribute("id"));const{container:mt}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(mt.append(Fe),$e.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(Fe),Fe.classList.add(_o),"ontouchstart"in document.documentElement)for(const It of[].concat(...document.body.children))$e.on(It,"mouseover",R);this._queueCallback(()=>{$e.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!$e.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(_o),"ontouchstart"in document.documentElement)for(const D of[].concat(...document.body.children))$e.off(D,"mouseover",R);this._activeTrigger[Xo]=!1,this._activeTrigger[Ho]=!1,this._activeTrigger[$s]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),$e.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(D){const se=this._getTemplateFactory(D).toHtml();if(!se)return null;se.classList.remove(Ea,_o),se.classList.add(`bs-${this.constructor.NAME}-auto`);const Fe=(mt=>{do mt+=Math.floor(1e6*Math.random());while(document.getElementById(mt));return mt})(this.constructor.NAME).toString();return se.setAttribute("id",Fe),this._isAnimated()&&se.classList.add(Ea),se}setContent(D){this._newContent=D,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(D){return this._templateFactory?this._templateFactory.changeContent(D):this._templateFactory=new lc({...this._config,content:D,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[uc]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(D){return this.constructor.getOrCreateInstance(D.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Ea)}_isShown(){return this.tip&&this.tip.classList.contains(_o)}_createPopper(D){const se=ee(this._config.placement,[this,D,this._element]),Fe=Ia[se.toUpperCase()];return c.createPopper(this._element,D,this._getPopperConfig(Fe))}_getOffset(){const{offset:D}=this._config;return typeof D=="string"?D.split(",").map(se=>Number.parseInt(se,10)):typeof D=="function"?se=>D(se,this._element):D}_resolvePossibleFunction(D){return ee(D,[this._element,this._element])}_getPopperConfig(D){const se={placement:D,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:Fe=>{this._getTipElement().setAttribute("data-popper-placement",Fe.state.placement)}}]};return{...se,...ee(this._config.popperConfig,[void 0,se])}}_setListeners(){const D=this._config.trigger.split(" ");for(const se of D)if(se==="click")$e.on(this._element,this.constructor.eventName("click"),this._config.selector,Fe=>{const mt=this._initializeOnDelegatedTarget(Fe);mt._activeTrigger[Xo]=!(mt._isShown()&&mt._activeTrigger[Xo]),mt.toggle()});else if(se!=="manual"){const Fe=se===$s?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),mt=se===$s?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");$e.on(this._element,Fe,this._config.selector,It=>{const Xt=this._initializeOnDelegatedTarget(It);Xt._activeTrigger[It.type==="focusin"?Ho:$s]=!0,Xt._enter()}),$e.on(this._element,mt,this._config.selector,It=>{const Xt=this._initializeOnDelegatedTarget(It);Xt._activeTrigger[It.type==="focusout"?Ho:$s]=Xt._element.contains(It.relatedTarget),Xt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},$e.on(this._element.closest(Go),is,this._hideModalHandler)}_fixTitle(){const D=this._element.getAttribute("title");D&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",D),this._element.setAttribute("data-bs-original-title",D),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(D,se){clearTimeout(this._timeout),this._timeout=setTimeout(D,se)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(D){const se=oi.getDataAttributes(this._element);for(const Fe of Object.keys(se))cc.has(Fe)&&delete se[Fe];return D={...se,...typeof D=="object"&&D?D:{}},D=this._mergeConfigObj(D),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}_configAfterMerge(D){return D.container=D.container===!1?document.body:C(D.container),typeof D.delay=="number"&&(D.delay={show:D.delay,hide:D.delay}),typeof D.title=="number"&&(D.title=D.title.toString()),typeof D.content=="number"&&(D.content=D.content.toString()),D}_getDelegateConfig(){const D={};for(const[se,Fe]of Object.entries(this._config))this.constructor.Default[se]!==Fe&&(D[se]=Fe);return D.selector=!1,D.trigger="manual",D}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(D){return this.each(function(){const se=ps.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0)throw new TypeError(`No method named "${D}"`);se[D]()}})}}oe(ps);const mu=".popover-header",Tn=".popover-body",gu={...ps.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Li={...ps.DefaultType,content:"(null|string|element|function)"};class to extends ps{static get Default(){return gu}static get DefaultType(){return Li}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[mu]:this._getTitle(),[Tn]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(D){return this.each(function(){const se=to.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0)throw new TypeError(`No method named "${D}"`);se[D]()}})}}oe(to);const Qi=".bs.scrollspy",$i=`activate${Qi}`,zs=`click${Qi}`,Ko=`load${Qi}.data-api`,ns="active",Jo="[href]",Os=".nav-link",yo=`${Os}, .nav-item > ${Os}, .list-group-item`,Mr={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},dl={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class io extends Pi{constructor(D,se){super(D,se),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Mr}static get DefaultType(){return dl}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const D of this._observableSections.values())this._observer.observe(D)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(D){return D.target=C(D.target)||document.body,D.rootMargin=D.offset?`${D.offset}px 0px -30%`:D.rootMargin,typeof D.threshold=="string"&&(D.threshold=D.threshold.split(",").map(se=>Number.parseFloat(se))),D}_maybeEnableSmoothScroll(){this._config.smoothScroll&&($e.off(this._config.target,zs),$e.on(this._config.target,zs,Jo,D=>{const se=this._observableSections.get(D.target.hash);if(se){D.preventDefault();const Fe=this._rootElement||window,mt=se.offsetTop-this._element.offsetTop;if(Fe.scrollTo)return void Fe.scrollTo({top:mt,behavior:"smooth"});Fe.scrollTop=mt}}))}_getNewObserver(){const D={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(se=>this._observerCallback(se),D)}_observerCallback(D){const se=Xt=>this._targetLinks.get(`#${Xt.target.id}`),Fe=Xt=>{this._previousScrollData.visibleEntryTop=Xt.target.offsetTop,this._process(se(Xt))},mt=(this._rootElement||document.documentElement).scrollTop,It=mt>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=mt;for(const Xt of D){if(!Xt.isIntersecting){this._activeTarget=null,this._clearActiveClass(se(Xt));continue}const Hi=Xt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(It&&Hi){if(Fe(Xt),!mt)return}else It||Hi||Fe(Xt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const D=At.find(Jo,this._config.target);for(const se of D){if(!se.hash||T(se))continue;const Fe=At.findOne(decodeURI(se.hash),this._element);E(Fe)&&(this._targetLinks.set(decodeURI(se.hash),se),this._observableSections.set(se.hash,Fe))}}_process(D){this._activeTarget!==D&&(this._clearActiveClass(this._config.target),this._activeTarget=D,D.classList.add(ns),this._activateParents(D),$e.trigger(this._element,$i,{relatedTarget:D}))}_activateParents(D){if(D.classList.contains("dropdown-item"))At.findOne(".dropdown-toggle",D.closest(".dropdown")).classList.add(ns);else for(const se of At.parents(D,".nav, .list-group"))for(const Fe of At.prev(se,yo))Fe.classList.add(ns)}_clearActiveClass(D){D.classList.remove(ns);const se=At.find(`${Jo}.${ns}`,D);for(const Fe of se)Fe.classList.remove(ns)}static jQueryInterface(D){return this.each(function(){const se=io.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D]()}})}}$e.on(window,Ko,()=>{for(const Ne of At.find('[data-bs-spy="scroll"]'))io.getOrCreateInstance(Ne)}),oe(io);const ms=".bs.tab",no=`hide${ms}`,Yo=`hidden${ms}`,Qo=`show${ms}`,bo=`shown${ms}`,$o=`click${ms}`,Aa=`keydown${ms}`,vo=`load${ms}`,wo="ArrowLeft",pl="ArrowRight",ml="ArrowUp",Wi="ArrowDown",xo="Home",hc="End",Ds="active",ro="fade",Ma="show",ea=".dropdown-toggle",Pa=`:not(${ea})`,gl='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',ko=`.nav-link${Pa}, .list-group-item${Pa}, [role="tab"]${Pa}, ${gl}`,La=`.${Ds}[data-bs-toggle="tab"], .${Ds}[data-bs-toggle="pill"], .${Ds}[data-bs-toggle="list"]`;class Pr extends Pi{constructor(D){super(D),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),$e.on(this._element,Aa,se=>this._keydown(se)))}static get NAME(){return"tab"}show(){const D=this._element;if(this._elemIsActive(D))return;const se=this._getActiveElem(),Fe=se?$e.trigger(se,no,{relatedTarget:D}):null;$e.trigger(D,Qo,{relatedTarget:se}).defaultPrevented||Fe&&Fe.defaultPrevented||(this._deactivate(se,D),this._activate(D,se))}_activate(D,se){D&&(D.classList.add(Ds),this._activate(At.getElementFromSelector(D)),this._queueCallback(()=>{D.getAttribute("role")==="tab"?(D.removeAttribute("tabindex"),D.setAttribute("aria-selected",!0),this._toggleDropDown(D,!0),$e.trigger(D,bo,{relatedTarget:se})):D.classList.add(Ma)},D,D.classList.contains(ro)))}_deactivate(D,se){D&&(D.classList.remove(Ds),D.blur(),this._deactivate(At.getElementFromSelector(D)),this._queueCallback(()=>{D.getAttribute("role")==="tab"?(D.setAttribute("aria-selected",!1),D.setAttribute("tabindex","-1"),this._toggleDropDown(D,!1),$e.trigger(D,Yo,{relatedTarget:se})):D.classList.remove(Ma)},D,D.classList.contains(ro)))}_keydown(D){if(![wo,pl,ml,Wi,xo,hc].includes(D.key))return;D.stopPropagation(),D.preventDefault();const se=this._getChildren().filter(mt=>!T(mt));let Fe;if([xo,hc].includes(D.key))Fe=se[D.key===xo?0:se.length-1];else{const mt=[pl,Wi].includes(D.key);Fe=j(se,D.target,mt,!0)}Fe&&(Fe.focus({preventScroll:!0}),Pr.getOrCreateInstance(Fe).show())}_getChildren(){return At.find(ko,this._parent)}_getActiveElem(){return this._getChildren().find(D=>this._elemIsActive(D))||null}_setInitialAttributes(D,se){this._setAttributeIfNotExists(D,"role","tablist");for(const Fe of se)this._setInitialAttributesOnChild(Fe)}_setInitialAttributesOnChild(D){D=this._getInnerElement(D);const se=this._elemIsActive(D),Fe=this._getOuterElement(D);D.setAttribute("aria-selected",se),Fe!==D&&this._setAttributeIfNotExists(Fe,"role","presentation"),se||D.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(D,"role","tab"),this._setInitialAttributesOnTargetPanel(D)}_setInitialAttributesOnTargetPanel(D){const se=At.getElementFromSelector(D);se&&(this._setAttributeIfNotExists(se,"role","tabpanel"),D.id&&this._setAttributeIfNotExists(se,"aria-labelledby",`${D.id}`))}_toggleDropDown(D,se){const Fe=this._getOuterElement(D);if(!Fe.classList.contains("dropdown"))return;const mt=(It,Xt)=>{const Hi=At.findOne(It,Fe);Hi&&Hi.classList.toggle(Xt,se)};mt(ea,Ds),mt(".dropdown-menu",Ma),Fe.setAttribute("aria-expanded",se)}_setAttributeIfNotExists(D,se,Fe){D.hasAttribute(se)||D.setAttribute(se,Fe)}_elemIsActive(D){return D.classList.contains(Ds)}_getInnerElement(D){return D.matches(ko)?D:At.findOne(ko,D)}_getOuterElement(D){return D.closest(".nav-item, .list-group-item")||D}static jQueryInterface(D){return this.each(function(){const se=Pr.getOrCreateInstance(this);if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D]()}})}}$e.on(document,$o,gl,function(Ne){["A","AREA"].includes(this.tagName)&&Ne.preventDefault(),T(this)||Pr.getOrCreateInstance(this).show()}),$e.on(window,vo,()=>{for(const Ne of At.find(La))Pr.getOrCreateInstance(Ne)}),oe(Pr);const br=".bs.toast",So=`mouseover${br}`,_l=`mouseout${br}`,To=`focusin${br}`,ta=`focusout${br}`,za=`hide${br}`,Oa=`hidden${br}`,yl=`show${br}`,_u=`shown${br}`,bl="hide",so="show",Co="showing",ia={animation:"boolean",autohide:"boolean",delay:"number"},na={animation:!0,autohide:!0,delay:5e3};class Pn extends Pi{constructor(D,se){super(D,se),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return na}static get DefaultType(){return ia}static get NAME(){return"toast"}show(){$e.trigger(this._element,yl).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(bl),N(this._element),this._element.classList.add(so,Co),this._queueCallback(()=>{this._element.classList.remove(Co),$e.trigger(this._element,_u),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&($e.trigger(this._element,za).defaultPrevented||(this._element.classList.add(Co),this._queueCallback(()=>{this._element.classList.add(bl),this._element.classList.remove(Co,so),$e.trigger(this._element,Oa)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(so),super.dispose()}isShown(){return this._element.classList.contains(so)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(D,se){switch(D.type){case"mouseover":case"mouseout":this._hasMouseInteraction=se;break;case"focusin":case"focusout":this._hasKeyboardInteraction=se}if(se)return void this._clearTimeout();const Fe=D.relatedTarget;this._element===Fe||this._element.contains(Fe)||this._maybeScheduleHide()}_setListeners(){$e.on(this._element,So,D=>this._onInteraction(D,!0)),$e.on(this._element,_l,D=>this._onInteraction(D,!1)),$e.on(this._element,To,D=>this._onInteraction(D,!0)),$e.on(this._element,ta,D=>this._onInteraction(D,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(D){return this.each(function(){const se=Pn.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0)throw new TypeError(`No method named "${D}"`);se[D](this)}})}}return Xe(Pn),oe(Pn),{Alert:_i,Button:it,Carousel:yt,Collapse:Ni,Dropdown:Bn,Modal:Js,Offcanvas:ts,Popover:to,ScrollSpy:io,Tab:Pr,Toast:Pn,Tooltip:ps}})})(D1);var Ss=63710088e-1,Tw={centimeters:Ss*100,centimetres:Ss*100,degrees:360/(2*Math.PI),feet:Ss*3.28084,inches:Ss*39.37,kilometers:Ss/1e3,kilometres:Ss/1e3,meters:Ss,metres:Ss,miles:Ss/1609.344,millimeters:Ss*1e3,millimetres:Ss*1e3,nauticalmiles:Ss/1852,radians:1,yards:Ss*1.0936};function Vd(r,e,n={}){const o={type:"Feature"};return(n.id===0||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=e||{},o.geometry=r,o}function tf(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!xg(r[0])||!xg(r[1]))throw new Error("coordinates must contain numbers");return Vd({type:"Point",coordinates:r},e,n)}function Cw(r,e="kilometers"){const n=Tw[e];if(!n)throw new Error(e+" units is invalid");return r*n}function wg(r){return r%(2*Math.PI)*180/Math.PI}function qc(r){return r%360*Math.PI/180}function xg(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Zc(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ew(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Rl(r,e,n={}){var o=Zc(r),c=Zc(e),d=qc(c[1]-o[1]),h=qc(c[0]-o[0]),a=qc(o[1]),_=qc(c[1]),S=Math.pow(Math.sin(d/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(a)*Math.cos(_);return Cw(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)),n.units)}function j0(r,e,n){if(r!==null)for(var o,c,d,h,a,_,S,k=0,y=0,C,E=r.type,T=E==="FeatureCollection",L=E==="Feature",R=T?r.features.length:1,N=0;N<R;N++){S=T?r.features[N].geometry:L?r.geometry:r,C=S?S.type==="GeometryCollection":!1,a=C?S.geometries.length:1;for(var z=0;z<a;z++){var V=0,Q=0;if(h=C?S.geometries[z]:S,h!==null){_=h.coordinates;var oe=h.type;switch(k=0,oe){case null:break;case"Point":if(e(_,y,N,V,Q)===!1)return!1;y++,V++;break;case"LineString":case"MultiPoint":for(o=0;o<_.length;o++){if(e(_[o],y,N,V,Q)===!1)return!1;y++,oe==="MultiPoint"&&V++}oe==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(o=0;o<_.length;o++){for(c=0;c<_[o].length-k;c++){if(e(_[o][c],y,N,V,Q)===!1)return!1;y++}oe==="MultiLineString"&&V++,oe==="Polygon"&&Q++}oe==="Polygon"&&V++;break;case"MultiPolygon":for(o=0;o<_.length;o++){for(Q=0,c=0;c<_[o].length;c++){for(d=0;d<_[o][c].length-k;d++){if(e(_[o][c][d],y,N,V,Q)===!1)return!1;y++}Q++}V++}break;case"GeometryCollection":for(o=0;o<h.geometries.length;o++)if(j0(h.geometries[o],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Iw(r,e){var n,o,c,d,h,a,_,S,k,y,C=0,E=r.type==="FeatureCollection",T=r.type==="Feature",L=E?r.features.length:1;for(n=0;n<L;n++){for(a=E?r.features[n].geometry:T?r.geometry:r,S=E?r.features[n].properties:T?r.properties:{},k=E?r.features[n].bbox:T?r.bbox:void 0,y=E?r.features[n].id:T?r.id:void 0,_=a?a.type==="GeometryCollection":!1,h=_?a.geometries.length:1,c=0;c<h;c++){if(d=_?a.geometries[c]:a,d===null){if(e(null,C,S,k,y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(d,C,S,k,y)===!1)return!1;break}case"GeometryCollection":{for(o=0;o<d.geometries.length;o++)if(e(d.geometries[o],C,S,k,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function Aw(r,e){Iw(r,function(n,o,c,d,h){var a=n===null?null:n.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Vd(n,c,{bbox:d,id:h}),o,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var k=n.coordinates[S],y={type:_,coordinates:k};if(e(Vd(y,c),o,S)===!1)return!1}})}var Mw=Object.defineProperty,Pw=Object.defineProperties,Lw=Object.getOwnPropertyDescriptors,kg=Object.getOwnPropertySymbols,zw=Object.prototype.hasOwnProperty,Ow=Object.prototype.propertyIsEnumerable,Sg=(r,e,n)=>e in r?Mw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,Tg=(r,e)=>{for(var n in e||(e={}))zw.call(e,n)&&Sg(r,n,e[n]);if(kg)for(var n of kg(e))Ow.call(e,n)&&Sg(r,n,e[n]);return r},Cg=(r,e)=>Pw(r,Lw(e));function Dw(r,e,n={}){if(!r||!e)throw new Error("lines and pt are required arguments");const o=Zc(e);let c=tf([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),d=0;return Aw(r,function(h,a,_){const S=Ew(h);for(let k=0;k<S.length-1;k++){const y=tf(S[k]);y.properties.dist=Rl(e,y,n);const C=Zc(y),E=tf(S[k+1]);E.properties.dist=Rl(e,E,n);const T=Zc(E),L=Rl(y,E,n);let R,N;C[0]===o[0]&&C[1]===o[1]?[R,,N]=[C,void 0,!1]:T[0]===o[0]&&T[1]===o[1]?[R,,N]=[T,void 0,!0]:[R,,N]=Bw(y.geometry.coordinates,E.geometry.coordinates,Zc(e));let z;R&&(z=tf(R,{dist:Rl(e,R,n),multiFeatureIndex:_,location:d+Rl(y,R,n)})),z&&z.properties.dist<c.properties.dist&&(c=Cg(Tg({},z),{properties:Cg(Tg({},z.properties),{index:N?k+1:k})})),d+=L}}),c}function Fw(r,e){const[n,o,c]=r,[d,h,a]=e;return n*d+o*h+c*a}function Rw(r,e){const[n,o,c]=r,[d,h,a]=e;return[o*a-c*h,c*d-n*a,n*h-o*d]}function Eg(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2))}function zl(r,e){const n=Fw(r,e)/(Eg(r)*Eg(e));return Math.acos(Math.min(Math.max(n,-1),1))}function Cd(r){const e=qc(r[1]),n=qc(r[0]);return[Math.cos(e)*Math.cos(n),Math.cos(e)*Math.sin(n),Math.sin(e)]}function Ol(r){const[e,n,o]=r,c=wg(Math.asin(o));return[wg(Math.atan2(n,e)),c]}function Bw(r,e,n){const o=Cd(r),c=Cd(e),d=Cd(n),[h,a,_]=d,[S,k,y]=Rw(o,c),C=k*_-y*a,E=y*h-S*_,T=S*a-k*h,L=T*k-E*y,R=C*y-T*S,N=E*S-C*k,z=1/Math.sqrt(Math.pow(L,2)+Math.pow(R,2)+Math.pow(N,2)),V=[L*z,R*z,N*z],Q=[-1*L*z,-1*R*z,-1*N*z],oe=zl(o,c),ee=zl(o,V),ne=zl(c,V),j=zl(o,Q),U=zl(c,Q);let X;return ee<j&&ee<U||ne<j&&ne<U?X=V:X=Q,zl(o,X)>oe||zl(c,X)>oe?Rl(Ol(X),Ol(o))<=Rl(Ol(X),Ol(c))?[Ol(o),!0,!1]:[Ol(c),!1,!0]:[Ol(X),!1,!1]}var Nw=Dw;const jw=["==",["geometry-type"],"Polygon"],Uw=["==",["geometry-type"],"LineString"],Vw=["==",["geometry-type"],"Point"];function U0(){return{type:"FeatureCollection",features:[]}}function Ed(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:V0(r)}}}function V0(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Fc=[];function Id(r,e){return{subscribe:vn(r,e).subscribe}}function vn(r,e=Ut){let n;const o=new Set;function c(a){if($t(r,a)&&(r=a,n)){const _=!Fc.length;for(const S of o)S[1](),Fc.push(S,r);if(_){for(let S=0;S<Fc.length;S+=2)Fc[S][0](Fc[S+1]);Fc.length=0}}}function d(a){c(a(r))}function h(a,_=Ut){const S=[a,_];return o.add(S),o.size===1&&(n=e(c,d)||Ut),a(r),()=>{o.delete(S),o.size===0&&n&&(n(),n=null)}}return{set:c,update:d,subscribe:h}}const q0=vn(U0()),Z0=vn(0),qw=100;class Zw{constructor(e){Zn(this,"map");Zn(this,"active");Zn(this,"eventListenersSuccess");Zn(this,"eventListenersUpdated");Zn(this,"eventListenersFailure");Zn(this,"points");Zn(this,"cursor");Zn(this,"hover");Zn(this,"dragFrom");Zn(this,"previousStates");Zn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-e.lngLat.lng,o=this.dragFrom[1]-e.lngLat.lat;for(let c of this.points)c[0]-=n,c[1]-=o}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Zn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(Ig(this.points).forEach((o,c)=>{n.push([c+1,Nw(o,this.cursor).properties.dist])}),n.sort((o,c)=>o[1]-c[1]),n.length>0){let o=n[0][0];this.points.splice(o,0,this.cursor.geometry.coordinates),this.hover=o}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Zn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Ed(e.lngLat.toArray()),this.onClick(e),this.finish())});Zn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Zn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Zn(this,"onKeypress",e=>{if(!this.active)return;let n=e.target.tagName;n=="INPUT"||n=="TEXTAREA"||(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Zn(this,"onKeyDown",e=>{if(!this.active)return;let n=e.target.tagName;n=="INPUT"||n=="TEXTAREA"||e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersSuccess)n(e);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=U0();this.points.forEach((c,d)=>{let h=Ed(c);h.properties.hover=this.hover==d,h.properties.idx=d,e.features.push(h)}),e.features=e.features.concat(Ig(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",e.features.push(n)),q0.set(e);let o="crosshair";this.hover!=null&&(o=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=o,Z0.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersUpdated)n(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Ed(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(V0),n=[JSON.parse(JSON.stringify(e))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>qw&&this.previousStates.shift()}}function Ig(r){let e=[];for(let n=0;n<r.length-1;n++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[n],r[n+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function Ww(r){let e,n,o;return{c(){e=vt("Undo ("),n=vt(r[1]),o=vt(")")},m(c,d){we(c,e,d),we(c,n,d),we(c,o,d)},p(c,d){d&2&&vi(n,c[1])},d(c){c&&(ve(e),ve(n),ve(o))}}}function Gw(r){let e;return{c(){e=vt("Undo")},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function Hw(r){let e,n,o,c,d,h,a,_,S,k,y;function C(L,R){return L[1]==0?Gw:Ww}let E=C(r),T=E(r);return{c(){e=ke("div"),n=ke("button"),n.textContent="Finish",o=qe(),c=ke("button"),c.textContent="Cancel",d=qe(),h=ke("button"),T.c(),_=qe(),S=ke("ul"),S.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,h.disabled=a=r[1]==0,en(e,"display","flex"),en(e,"justify-content","space-between")},m(L,R){we(L,e,R),he(e,n),he(e,o),he(e,c),he(e,d),he(e,h),T.m(h,null),we(L,_,R),we(L,S,R),k||(y=[Zt(n,"click",r[2]),Zt(c,"click",r[3]),Zt(h,"click",r[4])],k=!0)},p(L,[R]){E===(E=C(L))&&T?T.p(L,R):(T.d(1),T=E(L),T&&(T.c(),T.m(h,null))),R&2&&a!==(a=L[1]==0)&&(h.disabled=a)},i:Ut,o:Ut,d(L){L&&(ve(e),ve(_),ve(S)),T.d(),k=!1,Gn(y)}}}function Xw(r,e,n){let o;jt(r,Z0,_=>n(1,o=_));let{polygonTool:c}=e;const d=()=>c.finish(),h=()=>c.cancel(),a=()=>c.undo();return r.$$set=_=>{"polygonTool"in _&&n(0,c=_.polygonTool)},[c,o,d,h,a]}class Kw extends ci{constructor(e){super(),li(this,e,Xw,Hw,$t,{polygonTool:0})}}let Jw=Date.now();function vh(r){return`${r}-${Jw++}`}const W0=Symbol.for("svelte-maplibre");function Yw(){return u0(W0)}function Ag(r){return{subscribe:r.subscribe}}function G0({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:o=!1}){let c=Yw(),d=vn(null),h=Ag(d),a={...c,[r]:Ag(d)};if(e&&(a.popupTarget=h),o){let _=vn(null);a.layerEvent=_,c.layerEvent=_}return n&&(a.cluster=vn()),rp(W0,a),{...c,self:d}}function Qw(){return G0({key:"source",setCluster:!0})}function $w(r=!0){return G0({key:"layer",setPopupTarget:r,setMouseEvent:r})}var H0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,e){(function(n,o){r.exports=o()})(m0,function(){var n={},o={};function c(h,a,_){if(o[h]=_,h==="index"){var S="var sharedModule = {}; ("+o.shared+")(sharedModule); ("+o.worker+")(sharedModule);",k={};return o.shared(k),o.index(n,k),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([S],{type:"text/javascript"}))),n}}c("shared",["exports"],function(h){function a(s,i,l,f){return new(l||(l=Promise))(function(g,w){function x(F){try{M(f.next(F))}catch(q){w(q)}}function I(F){try{M(f.throw(F))}catch(q){w(q)}}function M(F){var q;F.done?g(F.value):(q=F.value,q instanceof l?q:new l(function(G){G(q)})).then(x,I)}M((f=f.apply(s,i||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var S=k;function k(s,i){this.x=s,this.y=i}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,l=s.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),l=Math.sin(s),f=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=f,this},_rotateAround:function(s,i){var l=Math.cos(s),f=Math.sin(s),g=i.y+f*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-f*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var y=_(S),C=E;function E(s,i,l,f){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=f}E.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,f=0;f<8;f++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var w=this.sampleCurveDerivativeX(l);if(Math.abs(w)<1e-6)break;l-=g/w}var x=0,I=1;for(l=s,f=0;f<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));f++)s>g?x=l:I=l,l=.5*(I-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var T=_(C);let L,R;function N(){return L==null&&(L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),L}function z(){if(R==null&&(R=!1,N())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let f=0;f<5*5;f++){const g=4*f;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(f%5,Math.floor(f/5),1,1)}const l=i.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&l[f]!==f){R=!0;break}}}return R||!1}function V(s,i,l,f){const g=new T(s,i,l,f);return w=>g.solve(w)}const Q=V(.25,.1,.25,1);function oe(s,i,l){return Math.min(l,Math.max(i,s))}function ee(s,i,l){const f=l-i,g=((s-i)%f+f)%f+i;return g===i?l:g}function ne(s,...i){for(const l of i)for(const f in l)s[f]=l[f];return s}let j=1;function U(s,i,l){const f={};for(const g in s)f[g]=i.call(this,s[g],g,s);return f}function X(s,i,l){const f={};for(const g in s)i.call(this,s[g],g,s)&&(f[g]=s[g]);return f}function B(s){return Array.isArray(s)?s.map(B):typeof s=="object"&&s?U(s,B):s}const W={};function ce(s){W[s]||(typeof console<"u"&&console.warn(s),W[s]=!0)}function pe(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}function be(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let de=null;function ye(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Me(s,i,l,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const I=x.startsWith("BGR"),M=new Uint8ClampedArray(f*g*4);if(yield w.copyTo(M,function(F,q,G,$,re){const le=4*Math.max(-q,0),ge=(Math.max(0,G)-G)*$*4+le,Ce=4*$,ze=Math.max(0,q),tt=Math.max(0,G);return{rect:{x:ze,y:tt,width:Math.min(F.width,q+$)-ze,height:Math.min(F.height,G+re)-tt},layout:[{offset:ge,stride:Ce}]}}(s,i,l,f,g)),I)for(let F=0;F<M.length;F+=4){const q=M[F];M[F]=M[F+2],M[F+2]=q}return M}finally{w.close()}})}let ot,We;const pt="AbortError";function Tt(){return new Error(pt)}const $e={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function wt(s){return $e.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const St="global-dispatcher";class Ht extends Error{constructor(i,l,f,g){super(`AJAXError: ${l} (${i}): ${f}`),this.status=i,this.statusText=l,this.url=f,this.body=g}}const oi=()=>be(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Mi=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=wt(s.url);if(f)return f(s,i);if(be(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:St},i)}if(!(/^file:/.test(l=s.url)||/^file:/.test(oi())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:oi(),signal:g.signal});f.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const F=yield x.blob();throw new Ht(x.status,x.statusText,f.url,F)}let I;I=f.type==="arrayBuffer"||f.type==="image"?x.arrayBuffer():f.type==="json"?x.json():x.text();const M=yield I;if(g.signal.aborted)throw Tt();return{data:M,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,i);if(be(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:St},i)}var l;return function(f,g){return new Promise((w,x)=>{var I;const M=new XMLHttpRequest;M.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(M.responseType="arraybuffer");for(const F in f.headers)M.setRequestHeader(F,f.headers[F]);f.type==="json"&&(M.responseType="text",!((I=f.headers)===null||I===void 0)&&I.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=f.credentials==="include",M.onerror=()=>{x(new Error(M.statusText))},M.onload=()=>{if(!g.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let F=M.response;if(f.type==="json")try{F=JSON.parse(M.response)}catch(q){return void x(q)}w({data:F,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const F=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});x(new Ht(M.status,M.statusText,f.url,F))}},g.signal.addEventListener("abort",()=>{M.abort(),x(Tt())}),M.send(f.body)})}(s,i)};function Pi(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function Ti(s,i,l){l[s]&&l[s].indexOf(i)!==-1||(l[s]=l[s]||[],l[s].push(i))}function At(s,i,l){if(l&&l[s]){const f=l[s].indexOf(i);f!==-1&&l[s].splice(f,1)}}class Xe{constructor(i,l={}){ne(this,l),this.type=i}}class Pt extends Xe{constructor(i,l={}){super("error",ne({error:i},l))}}class ni{on(i,l){return this._listeners=this._listeners||{},Ti(i,l,this._listeners),this}off(i,l){return At(i,l,this._listeners),At(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ti(i,l,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,l){typeof i=="string"&&(i=new Xe(i,l||{}));const f=i.type;if(this.listens(f)){i.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const I of g)I.call(this,i);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const I of w)At(f,I,this._oneTimeListeners),I.call(this,i);const x=this._eventedParent;x&&(ne(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof Pt&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var Qe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const _i=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _t(s,i){const l={};for(const f in s)f!=="ref"&&(l[f]=s[f]);return _i.forEach(f=>{f in i&&(l[f]=i[f])}),l}function it(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let l=0;l<s.length;l++)if(!it(s[l],i[l]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const l in s)if(!it(s[l],i[l]))return!1;return!0}return s===i}function ue(s,i){s.push(i)}function H(s,i,l){ue(l,{command:"addSource",args:[s,i[s]]})}function Y(s,i,l){ue(i,{command:"removeSource",args:[s]}),l[s]=!0}function Ae(s,i,l,f){Y(s,l,f),H(s,i,l)}function Ze(s,i,l){let f;for(f in s[l])if(Object.prototype.hasOwnProperty.call(s[l],f)&&f!=="data"&&!it(s[l][f],i[l][f]))return!1;for(f in i[l])if(Object.prototype.hasOwnProperty.call(i[l],f)&&f!=="data"&&!it(s[l][f],i[l][f]))return!1;return!0}function dt(s,i,l,f,g,w){s=s||{},i=i||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(it(s[x],i[x])||l.push({command:w,args:[f,x,i[x],g]}));for(const x in i)Object.prototype.hasOwnProperty.call(i,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(it(s[x],i[x])||l.push({command:w,args:[f,x,i[x],g]}))}function st(s){return s.id}function Ci(s,i){return s[i.id]=i,s}class ft{constructor(i,l,f,g){this.message=(i?`${i}: `:"")+f,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function Wt(s,...i){for(const l of i)for(const f in l)s[f]=l[f];return s}class Ei extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Fi{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[f,g]of l)this.bindings[f]=g}concat(i){return new Fi(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Cn={kind:"null"},kt={kind:"number"},ui={kind:"string"},ii={kind:"boolean"},nn={kind:"color"},gr={kind:"object"},ai={kind:"value"},_r={kind:"collator"},yr={kind:"formatted"},Ir={kind:"padding"},Ar={kind:"resolvedImage"},Pe={kind:"variableAnchorOffsetCollection"};function te(s,i){return{kind:"array",itemType:s,N:i}}function ie(s){if(s.kind==="array"){const i=ie(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const me=[Cn,kt,ui,ii,nn,yr,gr,te(ai),Ir,Ar,Pe];function Se(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Se(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const l of me)if(!Se(l,i))return null}}return`Expected ${ie(s)} but found ${ie(i)} instead.`}function Ue(s,i){return i.some(l=>l.kind===s.kind)}function Ge(s,i){return i.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}function et(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const Re=.96422,at=.82521,yt=4/29,rt=6/29,Et=3*rt*rt,Yt=rt*rt*rt,ri=Math.PI/180,Bi=180/Math.PI;function wi(s){return(s%=360)<0&&(s+=360),s}function zi([s,i,l,f]){let g,w;const x=hn((.2225045*(s=Si(s))+.7168786*(i=Si(i))+.0606169*(l=Si(l)))/1);s===i&&i===l?g=w=x:(g=hn((.4360747*s+.3850649*i+.1430804*l)/Re),w=hn((.0139322*s+.0971045*i+.7141733*l)/at));const I=116*x-16;return[I<0?0:I,500*(g-x),200*(x-w),f]}function Si(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function hn(s){return s>Yt?Math.pow(s,1/3):s/Et+yt}function fn([s,i,l,f]){let g=(s+16)/116,w=isNaN(i)?g:g+i/500,x=isNaN(l)?g:g-l/200;return g=1*pi(g),w=Re*pi(w),x=at*pi(x),[Ke(3.1338561*w-1.6168667*g-.4906146*x),Ke(-.9787684*w+1.9161415*g+.033454*x),Ke(.0719453*w-.2289914*g+1.4052427*x),f]}function Ke(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function pi(s){return s>rt?s*s*s:Et*(s-yt)}function ki(s){return parseInt(s.padEnd(2,s),16)/255}function Ni(s,i){return Ki(i?s/100:s,0,1)}function Ki(s,i,l){return Math.min(Math.max(i,s),l)}function Ji(s){return!s.some(Number.isNaN)}const jn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class si{constructor(i,l,f,g=1,w=!0){this.r=i,this.g=l,this.b=f,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,l,f,g]))}static parse(i){if(i instanceof si)return i;if(typeof i!="string")return;const l=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=jn[f];if(g){const[x,I,M]=g;return[x/255,I/255,M/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let I=1;return[ki(f.slice(I,I+=x)),ki(f.slice(I,I+=x)),ki(f.slice(I,I+=x)),ki(f.slice(I,I+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[I,M,F,q,G,$,re,le,ge,Ce,ze,tt]=x,Ve=[q||" ",re||" ",Ce].join("");if(Ve==="  "||Ve==="  /"||Ve===",,"||Ve===",,,"){const Ye=[F,$,ge].join(""),lt=Ye==="%%%"?100:Ye===""?255:0;if(lt){const xt=[Ki(+M/lt,0,1),Ki(+G/lt,0,1),Ki(+le/lt,0,1),ze?Ni(+ze,tt):1];if(Ji(xt))return xt}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,I,M,F,q,G,$,re,le]=w,ge=[M||" ",q||" ",$].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const Ce=[+I,Ki(+F,0,100),Ki(+G,0,100),re?Ni(+re,le):1];if(Ji(Ce))return function([ze,tt,Ve,Ye]){function lt(xt){const Bt=(xt+ze/30)%12,hi=tt*Math.min(Ve,1-Ve);return Ve-hi*Math.max(-1,Math.min(Bt-3,9-Bt,1))}return ze=wi(ze),tt/=100,Ve/=100,[lt(0),lt(8),lt(4),Ye]}(Ce)}}}(i);return l?new si(...l,!1):void 0}get rgb(){const{r:i,g:l,b:f,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[i/w,l/w,f/w,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[l,f,g,w]=zi(i),x=Math.sqrt(f*f+g*g);return[Math.round(1e4*x)?wi(Math.atan2(g,f)*Bi):NaN,x,l,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zi(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){const[i,l,f,g]=this.rgb;return`rgba(${[i,l,f].map(w=>Math.round(255*w)).join(",")},${g})`}}si.black=new si(0,0,0,1),si.white=new si(1,1,1,1),si.transparent=new si(0,0,0,0),si.red=new si(1,0,0,1);class $r{constructor(i,l,f){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hn{constructor(i,l,f,g,w){this.text=i,this.image=l,this.scale=f,this.fontStack=g,this.textColor=w}}class Un{constructor(i){this.sections=i}static fromString(i){return new Un([new Hn(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Un?i:Un.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class pn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof pn)return i;if(typeof i=="number")return new pn([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new pn(i)}}toString(){return JSON.stringify(this.values)}}const _a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class zn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof zn)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){const f=i[l],g=i[l+1];if(typeof f!="string"||!_a.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new zn(i)}}toString(){return JSON.stringify(this.values)}}class Xn{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Xn({name:i,available:!1}):null}}function Ur(s,i,l,f){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,i,l,f]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rn(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof si||s instanceof $r||s instanceof Un||s instanceof pn||s instanceof zn||s instanceof Xn)return!0;if(Array.isArray(s)){for(const i of s)if(!Rn(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!Rn(s[i]))return!1;return!0}return!1}function Ii(s){if(s===null)return Cn;if(typeof s=="string")return ui;if(typeof s=="boolean")return ii;if(typeof s=="number")return kt;if(s instanceof si)return nn;if(s instanceof $r)return _r;if(s instanceof Un)return yr;if(s instanceof pn)return Ir;if(s instanceof zn)return Pe;if(s instanceof Xn)return Ar;if(Array.isArray(s)){const i=s.length;let l;for(const f of s){const g=Ii(f);if(l){if(l===g)continue;l=ai;break}l=g}return te(l||ai,i)}return gr}function No(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof si||s instanceof Un||s instanceof pn||s instanceof zn||s instanceof Xn?s.toString():JSON.stringify(s)}class rr{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Rn(i[1]))return l.error("invalid value");const f=i[1];let g=Ii(f);const w=l.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new rr(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class En{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ya={string:ui,number:kt,boolean:ii,object:gr};class Vr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let f,g=1;const w=i[0];if(w==="array"){let I,M;if(i.length>2){const F=i[1];if(typeof F!="string"||!(F in ya)||F==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);I=ya[F],g++}else I=ai;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=i[2],g++}f=te(I,M)}else{if(!ya[w])throw new Error(`Types doesn't contain name = ${w}`);f=ya[w]}const x=[];for(;g<i.length;g++){const I=l.parse(i[g],g,ai);if(!I)return null;x.push(I)}return new Vr(f,x)}evaluate(i){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(i);if(!Se(this.type,Ii(f)))return f;if(l===this.args.length-1)throw new En(`Expected value to be of type ${ie(this.type)}, but found ${ie(Ii(f))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const al={"to-boolean":ii,"to-color":nn,"to-number":kt,"to-string":ui};class qr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const f=i[0];if(!al[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&i.length!==2)return l.error("Expected one argument.");const g=al[f],w=[];for(let x=1;x<i.length;x++){const I=l.parse(i[x],x,ai);if(!I)return null;w.push(I)}return new qr(g,w)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,f;for(const g of this.args){if(l=g.evaluate(i),f=null,l instanceof si)return l;if(typeof l=="string"){const w=i.parseColor(l);if(w)return w}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Ur(l[0],l[1],l[2],l[3]),!f))return new si(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new En(f||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const f of this.args){l=f.evaluate(i);const g=pn.parse(l);if(g)return g}throw new En(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const f of this.args){l=f.evaluate(i);const g=zn.parse(l);if(g)return g}throw new En(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const f of this.args){if(l=f.evaluate(i),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new En(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Un.fromString(No(this.args[0].evaluate(i)));case"resolvedImage":return Xn.fromString(No(this.args[0].evaluate(i)));default:return No(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const ou=["Unknown","Point","LineString","Polygon"];class ba{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ou[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=si.parse(i)),l}}class Xs{constructor(i,l,f=[],g,w=new Fi,x=[]){this.registry=i,this.path=f,this.key=f.map(I=>`[${I}]`).join(""),this.scope=w,this.errors=x,this.expectedType=g,this._isConstant=l}parse(i,l,f,g,w={}){return l?this.concat(l,f,g)._parse(i,w):this._parse(i,w)}_parse(i,l){function f(g,w,x){return x==="assert"?new Vr(w,[g]):x==="coerce"?new qr(w,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let x=w.parse(i,this);if(!x)return null;if(this.expectedType){const I=this.expectedType,M=x.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||M.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(I.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(I,M))return null}else x=f(x,I,l.typeAnnotation||"coerce");else x=f(x,I,l.typeAnnotation||"coerce");else x=f(x,I,l.typeAnnotation||"coerce");else x=f(x,I,l.typeAnnotation||"assert")}if(!(x instanceof rr)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const I=new ba;try{x=new rr(x.type,x.evaluate(I))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,f){const g=typeof i=="number"?this.path.concat(i):this.path,w=f?this.scope.concat(f):this.scope;return new Xs(this.registry,this._isConstant,g,l||null,w,this.errors)}error(i,...l){const f=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ei(f,i))}checkSubtype(i,l){const f=Se(i,l);return f&&this.error(f),f}}class Bn{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let w=1;w<i.length-1;w+=2){const x=i[w];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",w);const I=l.parse(i[w+1],w+1);if(!I)return null;f.push([x,I])}const g=l.parse(i[i.length-1],i.length-1,l.expectedType,f);return g?new Bn(f,g):null}outputDefined(){return this.result.outputDefined()}}class Gi{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const f=i[1];return l.scope.has(f)?new Gi(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class va{constructor(i,l,f){this.type=i,this.index=l,this.input=f}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,kt),g=l.parse(i[2],2,te(l.expectedType||ai));return f&&g?new va(g.type.itemType,f,g):null}evaluate(i){const l=this.index.evaluate(i),f=this.input.evaluate(i);if(l<0)throw new En(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new En(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new En(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class wa{constructor(i,l){this.type=ii,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,ai),g=l.parse(i[2],2,ai);return f&&g?Ue(f.type,[ii,ui,kt,Cn,ai])?new wa(f,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ie(f.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!Ge(l,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${ie(Ii(l))} instead.`);if(!Ge(f,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${ie(Ii(f))} instead.`);return f.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class fo{constructor(i,l,f){this.type=kt,this.needle=i,this.haystack=l,this.fromIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,ai),g=l.parse(i[2],2,ai);if(!f||!g)return null;if(!Ue(f.type,[ii,ui,kt,Cn,ai]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ie(f.type)} instead`);if(i.length===4){const w=l.parse(i[3],3,kt);return w?new fo(f,g,w):null}return new fo(f,g)}evaluate(i){const l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!Ge(l,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${ie(Ii(l))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(i)),Ge(f,["string"])){const w=f.indexOf(l,g);return w===-1?-1:[...f.slice(0,w)].length}if(Ge(f,["array"]))return f.indexOf(l,g);throw new En(`Expected second argument to be of type array or string, but found ${ie(Ii(f))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class ll{constructor(i,l,f,g,w,x){this.inputType=i,this.type=l,this.input=f,this.cases=g,this.outputs=w,this.otherwise=x}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let f,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const w={},x=[];for(let F=2;F<i.length-1;F+=2){let q=i[F];const G=i[F+1];Array.isArray(q)||(q=[q]);const $=l.concat(F);if(q.length===0)return $.error("Expected at least one branch label.");for(const le of q){if(typeof le!="number"&&typeof le!="string")return $.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof le=="number"&&Math.floor(le)!==le)return $.error("Numeric branch labels must be integer values.");if(f){if($.checkSubtype(f,Ii(le)))return null}else f=Ii(le);if(w[String(le)]!==void 0)return $.error("Branch labels must be unique.");w[String(le)]=x.length}const re=l.parse(G,F,g);if(!re)return null;g=g||re.type,x.push(re)}const I=l.parse(i[1],1,ai);if(!I)return null;const M=l.parse(i[i.length-1],i.length-1,g);return M?I.type.kind!=="value"&&l.concat(1).checkSubtype(f,I.type)?null:new ll(f,g,I,w,x,M):null}evaluate(i){const l=this.input.evaluate(i);return(Ii(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class jo{constructor(i,l,f){this.type=i,this.branches=l,this.otherwise=f}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);const g=[];for(let x=1;x<i.length-1;x+=2){const I=l.parse(i[x],x,ii);if(!I)return null;const M=l.parse(i[x+1],x+1,f);if(!M)return null;g.push([I,M]),f=f||M.type}const w=l.parse(i[i.length-1],i.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new jo(f,g,w)}evaluate(i){for(const[l,f]of this.branches)if(l.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,f]of this.branches)i(l),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class As{constructor(i,l,f,g){this.type=i,this.input=l,this.beginIndex=f,this.endIndex=g}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,ai),g=l.parse(i[2],2,kt);if(!f||!g)return null;if(!Ue(f.type,[te(ai),ui,ai]))return l.error(`Expected first argument to be of type array or string, but found ${ie(f.type)} instead`);if(i.length===4){const w=l.parse(i[3],3,kt);return w?new As(f.type,f,g,w):null}return new As(f.type,f,g)}evaluate(i){const l=this.input.evaluate(i),f=this.beginIndex.evaluate(i);let g;if(this.endIndex&&(g=this.endIndex.evaluate(i)),Ge(l,["string"]))return[...l].slice(f,g).join("");if(Ge(l,["array"]))return l.slice(f,g);throw new En(`Expected first argument to be of type array or string, but found ${ie(Ii(l))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function xa(s,i){const l=s.length-1;let f,g,w=0,x=l,I=0;for(;w<=x;)if(I=Math.floor((w+x)/2),f=s[I],g=s[I+1],f<=i){if(I===l||i<g)return I;w=I+1}else{if(!(f>i))throw new En("Input is not a number.");x=I-1}return 0}class po{constructor(i,l,f){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[g,w]of f)this.labels.push(g),this.outputs.push(w)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(i[1],1,kt);if(!f)return null;const g=[];let w=null;l.expectedType&&l.expectedType.kind!=="value"&&(w=l.expectedType);for(let x=1;x<i.length;x+=2){const I=x===1?-1/0:i[x],M=i[x+1],F=x,q=x+1;if(typeof I!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(g.length&&g[g.length-1][0]>=I)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const G=l.parse(M,q,w);if(!G)return null;w=w||G.type,g.push([I,G])}return new po(w,f,g)}evaluate(i){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return f[0].evaluate(i);const w=l.length;return g>=l[w-1]?f[w-1].evaluate(i):f[xa(l,g)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function cl(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var au=Hl;function Hl(s,i,l,f){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=f}Hl.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,f=0;f<8;f++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var w=this.sampleCurveDerivativeX(l);if(Math.abs(w)<1e-6)break;l-=g/w}var x=0,I=1;for(l=s,f=0;f<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));f++)s>g?x=l:I=l,l=.5*(I-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Xl=cl(au);function Ms(s,i,l){return s+l*(i-s)}function mo(s,i,l){return s.map((f,g)=>Ms(f,i[g],l))}const Vn={number:Ms,color:function(s,i,l,f="rgb"){switch(f){case"rgb":{const[g,w,x,I]=mo(s.rgb,i.rgb,l);return new si(g,w,x,I,!1)}case"hcl":{const[g,w,x,I]=s.hcl,[M,F,q,G]=i.hcl;let $,re;if(isNaN(g)||isNaN(M))isNaN(g)?isNaN(M)?$=NaN:($=M,x!==1&&x!==0||(re=F)):($=g,q!==1&&q!==0||(re=w));else{let tt=M-g;M>g&&tt>180?tt-=360:M<g&&g-M>180&&(tt+=360),$=g+l*tt}const[le,ge,Ce,ze]=function([tt,Ve,Ye,lt]){return tt=isNaN(tt)?0:tt*ri,fn([Ye,Math.cos(tt)*Ve,Math.sin(tt)*Ve,lt])}([$,re??Ms(w,F,l),Ms(x,q,l),Ms(I,G,l)]);return new si(le,ge,Ce,ze,!1)}case"lab":{const[g,w,x,I]=fn(mo(s.lab,i.lab,l));return new si(g,w,x,I,!1)}}},array:mo,padding:function(s,i,l){return new pn(mo(s.values,i.values,l))},variableAnchorOffsetCollection:function(s,i,l){const f=s.values,g=i.values;if(f.length!==g.length)throw new En(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const w=[];for(let x=0;x<f.length;x+=2){if(f[x]!==g[x])throw new En(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${f[x]}, to[${x}]: ${g[x]}`);w.push(f[x]);const[I,M]=f[x+1],[F,q]=g[x+1];w.push([Ms(I,F,l),Ms(M,q,l)])}return new zn(w)}};class $n{constructor(i,l,f,g,w){this.type=i,this.operator=l,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[x,I]of w)this.labels.push(x),this.outputs.push(I)}static interpolationFactor(i,l,f,g){let w=0;if(i.name==="exponential")w=go(l,i.base,f,g);else if(i.name==="linear")w=go(l,1,f,g);else if(i.name==="cubic-bezier"){const x=i.controlPoints;w=new Xl(x[0],x[1],x[2],x[3]).solve(go(l,1,f,g))}return w}static parse(i,l){let[f,g,w,...x]=i;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const F=g[1];if(typeof F!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:F}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const F=g.slice(1);if(F.length!==4||F.some(q=>typeof q!="number"||q<0||q>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:F}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(w=l.parse(w,2,kt),!w)return null;const I=[];let M=null;f==="interpolate-hcl"||f==="interpolate-lab"?M=nn:l.expectedType&&l.expectedType.kind!=="value"&&(M=l.expectedType);for(let F=0;F<x.length;F+=2){const q=x[F],G=x[F+1],$=F+3,re=F+4;if(typeof q!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(I.length&&I[I.length-1][0]>=q)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const le=l.parse(G,re,M);if(!le)return null;M=M||le.type,I.push([q,le])}return et(M,kt)||et(M,nn)||et(M,Ir)||et(M,Pe)||et(M,te(kt))?new $n(M,f,g,w,I):l.error(`Type ${ie(M)} is not interpolatable.`)}evaluate(i){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return f[0].evaluate(i);const w=l.length;if(g>=l[w-1])return f[w-1].evaluate(i);const x=xa(l,g),I=$n.interpolationFactor(this.interpolation,g,l[x],l[x+1]),M=f[x].evaluate(i),F=f[x+1].evaluate(i);switch(this.operator){case"interpolate":return Vn[this.type.kind](M,F,I);case"interpolate-hcl":return Vn.color(M,F,I,"hcl");case"interpolate-lab":return Vn.color(M,F,I,"lab")}}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function go(s,i,l,f){const g=f-l,w=s-l;return g===0?0:i===1?w/g:(Math.pow(i,w)-1)/(Math.pow(i,g)-1)}class er{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let f=null;const g=l.expectedType;g&&g.kind!=="value"&&(f=g);const w=[];for(const I of i.slice(1)){const M=l.parse(I,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!M)return null;f=f||M.type,w.push(M)}if(!f)throw new Error("No output type");const x=g&&w.some(I=>Se(g,I.type));return new er(x?ai:f,w)}evaluate(i){let l,f=null,g=0;for(const w of this.args)if(g++,f=w.evaluate(i),f&&f instanceof Xn&&!f.available&&(l||(l=f.name),f=null,g===this.args.length&&(f=l)),f!==null)break;return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function ka(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Kl(s,i,l,f){return f.compare(i,l)===0}function Ks(s,i,l){const f=s!=="=="&&s!=="!=";return class X0{constructor(w,x,I){this.type=ii,this.lhs=w,this.rhs=x,this.collator=I,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const I=w[0];let M=x.parse(w[1],1,ai);if(!M)return null;if(!ka(I,M.type))return x.concat(1).error(`"${I}" comparisons are not supported for type '${ie(M.type)}'.`);let F=x.parse(w[2],2,ai);if(!F)return null;if(!ka(I,F.type))return x.concat(2).error(`"${I}" comparisons are not supported for type '${ie(F.type)}'.`);if(M.type.kind!==F.type.kind&&M.type.kind!=="value"&&F.type.kind!=="value")return x.error(`Cannot compare types '${ie(M.type)}' and '${ie(F.type)}'.`);f&&(M.type.kind==="value"&&F.type.kind!=="value"?M=new Vr(F.type,[M]):M.type.kind!=="value"&&F.type.kind==="value"&&(F=new Vr(M.type,[F])));let q=null;if(w.length===4){if(M.type.kind!=="string"&&F.type.kind!=="string"&&M.type.kind!=="value"&&F.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(q=x.parse(w[3],3,_r),!q)return null}return new X0(M,F,q)}evaluate(w){const x=this.lhs.evaluate(w),I=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const M=Ii(x),F=Ii(I);if(M.kind!==F.kind||M.kind!=="string"&&M.kind!=="number")throw new En(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${M.kind}, ${F.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const M=Ii(x),F=Ii(I);if(M.kind!=="string"||F.kind!=="string")return i(w,x,I)}return this.collator?l(w,x,I,this.collator.evaluate(w)):i(w,x,I)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Jl=Ks("==",function(s,i,l){return i===l},Kl),Yl=Ks("!=",function(s,i,l){return i!==l},function(s,i,l,f){return!Kl(0,i,l,f)}),Ql=Ks("<",function(s,i,l){return i<l},function(s,i,l,f){return f.compare(i,l)<0}),lu=Ks(">",function(s,i,l){return i>l},function(s,i,l,f){return f.compare(i,l)>0}),cu=Ks("<=",function(s,i,l){return i<=l},function(s,i,l,f){return f.compare(i,l)<=0}),$l=Ks(">=",function(s,i,l){return i>=l},function(s,i,l,f){return f.compare(i,l)>=0});class Uo{constructor(i,l,f){this.type=_r,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const f=i[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");const g=l.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,ii);if(!g)return null;const w=l.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,ii);if(!w)return null;let x=null;return f.locale&&(x=l.parse(f.locale,1,ui),!x)?null:new Uo(g,w,x)}evaluate(i){return new $r(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class Sa{constructor(i,l,f,g,w){this.type=ui,this.number=i,this.locale=l,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const f=l.parse(i[1],1,kt);if(!f)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=l.parse(g.locale,1,ui),!w))return null;let x=null;if(g.currency&&(x=l.parse(g.currency,1,ui),!x))return null;let I=null;if(g["min-fraction-digits"]&&(I=l.parse(g["min-fraction-digits"],1,kt),!I))return null;let M=null;return g["max-fraction-digits"]&&(M=l.parse(g["max-fraction-digits"],1,kt),!M)?null:new Sa(f,w,x,I,M)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Vo{constructor(i){this.type=yr,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");const g=[];let w=!1;for(let x=1;x<=i.length-1;++x){const I=i[x];if(w&&typeof I=="object"&&!Array.isArray(I)){w=!1;let M=null;if(I["font-scale"]&&(M=l.parse(I["font-scale"],1,kt),!M))return null;let F=null;if(I["text-font"]&&(F=l.parse(I["text-font"],1,te(ui)),!F))return null;let q=null;if(I["text-color"]&&(q=l.parse(I["text-color"],1,nn),!q))return null;const G=g[g.length-1];G.scale=M,G.font=F,G.textColor=q}else{const M=l.parse(i[x],1,ai);if(!M)return null;const F=M.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:M,scale:null,font:null,textColor:null})}}return new Vo(g)}evaluate(i){return new Un(this.sections.map(l=>{const f=l.content.evaluate(i);return Ii(f)===Ar?new Hn("",f,null,null,null):new Hn(No(f),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}}class qo{constructor(i){this.type=Ar,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const f=l.parse(i[1],1,ui);return f?new qo(f):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),f=Xn.fromString(l);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(l)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}}class ul{constructor(i){this.type=kt,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=l.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${ie(f.type)} instead.`):new ul(f):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new En(`Expected value to be of type string or array, but found ${ie(Ii(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const es=8192;function Js(s,i){const l=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(l*g*es),Math.round(f*g*es)]}function Zr(s,i){const l=Math.pow(2,i.z);return[(g=(s[0]/es+i.x)/l,360*g-180),(f=(s[1]/es+i.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,g}function Ps(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function Ls(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Xi(s,i,l){const f=s[0]-i[0],g=s[1]-i[1],w=s[0]-l[0],x=s[1]-l[1];return f*x-w*g==0&&f*w<=0&&g*x<=0}function Zo(s,i,l,f){return(g=[f[0]-l[0],f[1]-l[1]])[0]*(w=[i[0]-s[0],i[1]-s[1]])[1]-g[1]*w[0]!=0&&!(!hl(s,i,l,f)||!hl(l,f,s,i));var g,w}function ec(s,i,l){for(const f of l)for(let g=0;g<f.length-1;++g)if(Zo(s,i,f[g],f[g+1]))return!0;return!1}function Ys(s,i,l=!1){let f=!1;for(const I of i)for(let M=0;M<I.length-1;M++){if(Xi(s,I[M],I[M+1]))return l;(w=I[M])[1]>(g=s)[1]!=(x=I[M+1])[1]>g[1]&&g[0]<(x[0]-w[0])*(g[1]-w[1])/(x[1]-w[1])+w[0]&&(f=!f)}var g,w,x;return f}function uu(s,i){for(const l of i)if(Ys(s,l))return!0;return!1}function tc(s,i){for(const l of s)if(!Ys(l,i))return!1;for(let l=0;l<s.length-1;++l)if(ec(s[l],s[l+1],i))return!1;return!0}function hu(s,i){for(const l of i)if(tc(s,l))return!0;return!1}function hl(s,i,l,f){const g=f[0]-l[0],w=f[1]-l[1],x=(s[0]-l[0])*w-g*(s[1]-l[1]),I=(i[0]-l[0])*w-g*(i[1]-l[1]);return x>0&&I<0||x<0&&I>0}function Ta(s,i,l){const f=[];for(let g=0;g<s.length;g++){const w=[];for(let x=0;x<s[g].length;x++){const I=Js(s[g][x],l);Ps(i,I),w.push(I)}f.push(w)}return f}function ic(s,i,l){const f=[];for(let g=0;g<s.length;g++){const w=Ta(s[g],i,l);f.push(w)}return f}function nc(s,i,l,f){if(s[0]<l[0]||s[0]>l[2]){const g=.5*f;let w=s[0]-l[0]>g?-f:l[0]-s[0]>g?f:0;w===0&&(w=s[0]-l[2]>g?-f:l[2]-s[0]>g?f:0),s[0]+=w}Ps(i,s)}function rc(s,i,l,f){const g=Math.pow(2,f.z)*es,w=[f.x*es,f.y*es],x=[];for(const I of s)for(const M of I){const F=[M.x+w[0],M.y+w[1]];nc(F,i,l,g),x.push(F)}return x}function sc(s,i,l,f){const g=Math.pow(2,f.z)*es,w=[f.x*es,f.y*es],x=[];for(const M of s){const F=[];for(const q of M){const G=[q.x+w[0],q.y+w[1]];Ps(i,G),F.push(G)}x.push(F)}if(i[2]-i[0]<=g/2){(I=i)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const M of x)for(const F of M)nc(F,i,l,g)}var I;return x}class Qs{constructor(i,l){this.type=ii,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Rn(i[1])){const f=i[1];if(f.type==="FeatureCollection"){const g=[];for(const w of f.features){const{type:x,coordinates:I}=w.geometry;x==="Polygon"&&g.push(I),x==="MultiPolygon"&&g.push(...I)}if(g.length)return new Qs(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Qs(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Qs(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(f.type==="Polygon"){const I=Ta(f.coordinates,w,x),M=rc(l.geometry(),g,w,x);if(!Ls(g,w))return!1;for(const F of M)if(!Ys(F,I))return!1}if(f.type==="MultiPolygon"){const I=ic(f.coordinates,w,x),M=rc(l.geometry(),g,w,x);if(!Ls(g,w))return!1;for(const F of M)if(!uu(F,I))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(f.type==="Polygon"){const I=Ta(f.coordinates,w,x),M=sc(l.geometry(),g,w,x);if(!Ls(g,w))return!1;for(const F of M)if(!tc(F,I))return!1}if(f.type==="MultiPolygon"){const I=ic(f.coordinates,w,x),M=sc(l.geometry(),g,w,x);if(!Ls(g,w))return!1;for(const F of M)if(!hu(F,I))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ts=class{constructor(s=[],i=(l,f)=>l<f?-1:l>f?1:0){if(this.data=s,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:i,compare:l}=this,f=i[s];for(;s>0;){const g=s-1>>1,w=i[g];if(l(f,w)>=0)break;i[s]=w,s=g}i[s]=f}_down(s){const{data:i,compare:l}=this,f=this.length>>1,g=i[s];for(;s<f;){let w=1+(s<<1);const x=w+1;if(x<this.length&&l(i[x],i[w])<0&&(w=x),l(i[w],g)>=0)break;i[s]=i[w],s=w}i[s]=g}};function oc(s,i,l,f,g){ac(s,i,l,f||s.length-1,g||fu)}function ac(s,i,l,f,g){for(;f>l;){if(f-l>600){var w=f-l+1,x=i-l+1,I=Math.log(w),M=.5*Math.exp(2*I/3),F=.5*Math.sqrt(I*M*(w-M)/w)*(x-w/2<0?-1:1);ac(s,i,Math.max(l,Math.floor(i-x*M/w+F)),Math.min(f,Math.floor(i+(w-x)*M/w+F)),g)}var q=s[i],G=l,$=f;for(Wo(s,l,i),g(s[f],q)>0&&Wo(s,l,f);G<$;){for(Wo(s,G,$),G++,$--;g(s[G],q)<0;)G++;for(;g(s[$],q)>0;)$--}g(s[l],q)===0?Wo(s,l,$):Wo(s,++$,f),$<=i&&(l=$+1),i<=$&&(f=$-1)}}function Wo(s,i,l){var f=s[i];s[i]=s[l],s[l]=f}function fu(s,i){return s<i?-1:s>i?1:0}function Ca(s,i){if(s.length<=1)return[s];const l=[];let f,g;for(const w of s){const x=pu(w);x!==0&&(w.area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(f&&l.push(f),f=[w]):f.push(w))}if(f&&l.push(f),i>1)for(let w=0;w<l.length;w++)l[w].length<=i||(oc(l[w],i,1,l[w].length-1,du),l[w]=l[w].slice(0,i));return l}function du(s,i){return i.area-s.area}function pu(s){let i=0;for(let l,f,g=0,w=s.length,x=w-1;g<w;x=g++)l=s[g],f=s[x],i+=(f.x-l.x)*(l.y+f.y);return i}const lc=1/298.257223563,cc=lc*(2-lc),Ea=Math.PI/180;class _o{constructor(i){const l=6378.137*Ea*1e3,f=Math.cos(i*Ea),g=1/(1-cc*(1-f*f)),w=Math.sqrt(g);this.kx=l*w*f,this.ky=l*w*g*(1-cc)}distance(i,l){const f=this.wrap(i[0]-l[0])*this.kx,g=(i[1]-l[1])*this.ky;return Math.sqrt(f*f+g*g)}pointOnLine(i,l){let f,g,w,x,I=1/0;for(let M=0;M<i.length-1;M++){let F=i[M][0],q=i[M][1],G=this.wrap(i[M+1][0]-F)*this.kx,$=(i[M+1][1]-q)*this.ky,re=0;G===0&&$===0||(re=(this.wrap(l[0]-F)*this.kx*G+(l[1]-q)*this.ky*$)/(G*G+$*$),re>1?(F=i[M+1][0],q=i[M+1][1]):re>0&&(F+=G/this.kx*re,q+=$/this.ky*re)),G=this.wrap(l[0]-F)*this.kx,$=(l[1]-q)*this.ky;const le=G*G+$*$;le<I&&(I=le,f=F,g=q,w=M,x=re)}return{point:[f,g],index:w,t:Math.max(0,Math.min(1,x))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function uc(s,i){return i[0]-s[0]}function Go(s){return s[1]-s[0]+1}function is(s,i){return s[1]>=s[0]&&s[1]<i}function $s(s,i){if(s[0]>s[1])return[null,null];const l=Go(s);if(i){if(l===2)return[s,null];const g=Math.floor(l/2);return[[s[0],s[0]+g],[s[0]+g,s[1]]]}if(l===1)return[s,null];const f=Math.floor(l/2)-1;return[[s[0],s[0]+f],[s[0]+f+1,s[1]]]}function Ho(s,i){if(!is(i,s.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let f=i[0];f<=i[1];++f)Ps(l,s[f]);return l}function Xo(s){const i=[1/0,1/0,-1/0,-1/0];for(const l of s)for(const f of l)Ps(i,f);return i}function Ia(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function fl(s,i,l){if(!Ia(s)||!Ia(i))return NaN;let f=0,g=0;return s[2]<i[0]&&(f=i[0]-s[2]),s[0]>i[2]&&(f=s[0]-i[2]),s[1]>i[3]&&(g=s[1]-i[3]),s[3]<i[1]&&(g=i[1]-s[3]),l.distance([0,0],[f,g])}function eo(s,i,l){const f=l.pointOnLine(i,s);return l.distance(s,f.point)}function ps(s,i,l,f,g){const w=Math.min(eo(s,[l,f],g),eo(i,[l,f],g)),x=Math.min(eo(l,[s,i],g),eo(f,[s,i],g));return Math.min(w,x)}function mu(s,i,l,f,g){if(!is(i,s.length)||!is(f,l.length))return 1/0;let w=1/0;for(let x=i[0];x<i[1];++x){const I=s[x],M=s[x+1];for(let F=f[0];F<f[1];++F){const q=l[F],G=l[F+1];if(Zo(I,M,q,G))return 0;w=Math.min(w,ps(I,M,q,G,g))}}return w}function Tn(s,i,l,f,g){if(!is(i,s.length)||!is(f,l.length))return NaN;let w=1/0;for(let x=i[0];x<=i[1];++x)for(let I=f[0];I<=f[1];++I)if(w=Math.min(w,g.distance(s[x],l[I])),w===0)return w;return w}function gu(s,i,l){if(Ys(s,i,!0))return 0;let f=1/0;for(const g of i){const w=g[0],x=g[g.length-1];if(w!==x&&(f=Math.min(f,eo(s,[x,w],l)),f===0))return f;const I=l.pointOnLine(g,s);if(f=Math.min(f,l.distance(s,I.point)),f===0)return f}return f}function Li(s,i,l,f){if(!is(i,s.length))return NaN;for(let w=i[0];w<=i[1];++w)if(Ys(s[w],l,!0))return 0;let g=1/0;for(let w=i[0];w<i[1];++w){const x=s[w],I=s[w+1];for(const M of l)for(let F=0,q=M.length,G=q-1;F<q;G=F++){const $=M[G],re=M[F];if(Zo(x,I,$,re))return 0;g=Math.min(g,ps(x,I,$,re,f))}}return g}function to(s,i){for(const l of s)for(const f of l)if(Ys(f,i,!0))return!0;return!1}function Qi(s,i,l,f=1/0){const g=Xo(s),w=Xo(i);if(f!==1/0&&fl(g,w,l)>=f)return f;if(Ls(g,w)){if(to(s,i))return 0}else if(to(i,s))return 0;let x=1/0;for(const I of s)for(let M=0,F=I.length,q=F-1;M<F;q=M++){const G=I[q],$=I[M];for(const re of i)for(let le=0,ge=re.length,Ce=ge-1;le<ge;Ce=le++){const ze=re[Ce],tt=re[le];if(Zo(G,$,ze,tt))return 0;x=Math.min(x,ps(G,$,ze,tt,l))}}return x}function $i(s,i,l,f,g,w){if(!w)return;const x=fl(Ho(f,w),g,l);x<i&&s.push([x,w,[0,0]])}function zs(s,i,l,f,g,w,x){if(!w||!x)return;const I=fl(Ho(f,w),Ho(g,x),l);I<i&&s.push([I,w,x])}function Ko(s,i,l,f,g=1/0){let w=Math.min(f.distance(s[0],l[0][0]),g);if(w===0)return w;const x=new ts([[0,[0,s.length-1],[0,0]]],uc),I=Xo(l);for(;x.length>0;){const M=x.pop();if(M[0]>=w)continue;const F=M[1],q=i?50:100;if(Go(F)<=q){if(!is(F,s.length))return NaN;if(i){const G=Li(s,F,l,f);if(isNaN(G)||G===0)return G;w=Math.min(w,G)}else for(let G=F[0];G<=F[1];++G){const $=gu(s[G],l,f);if(w=Math.min(w,$),w===0)return 0}}else{const G=$s(F,i);$i(x,w,f,s,I,G[0]),$i(x,w,f,s,I,G[1])}}return w}function ns(s,i,l,f,g,w=1/0){let x=Math.min(w,g.distance(s[0],l[0]));if(x===0)return x;const I=new ts([[0,[0,s.length-1],[0,l.length-1]]],uc);for(;I.length>0;){const M=I.pop();if(M[0]>=x)continue;const F=M[1],q=M[2],G=i?50:100,$=f?50:100;if(Go(F)<=G&&Go(q)<=$){if(!is(F,s.length)&&is(q,l.length))return NaN;let re;if(i&&f)re=mu(s,F,l,q,g),x=Math.min(x,re);else if(i&&!f){const le=s.slice(F[0],F[1]+1);for(let ge=q[0];ge<=q[1];++ge)if(re=eo(l[ge],le,g),x=Math.min(x,re),x===0)return x}else if(!i&&f){const le=l.slice(q[0],q[1]+1);for(let ge=F[0];ge<=F[1];++ge)if(re=eo(s[ge],le,g),x=Math.min(x,re),x===0)return x}else re=Tn(s,F,l,q,g),x=Math.min(x,re)}else{const re=$s(F,i),le=$s(q,f);zs(I,x,g,s,l,re[0],le[0]),zs(I,x,g,s,l,re[0],le[1]),zs(I,x,g,s,l,re[1],le[0]),zs(I,x,g,s,l,re[1],le[1])}}return x}function Jo(s){return s.type==="MultiPolygon"?s.coordinates.map(i=>({type:"Polygon",coordinates:i})):s.type==="MultiLineString"?s.coordinates.map(i=>({type:"LineString",coordinates:i})):s.type==="MultiPoint"?s.coordinates.map(i=>({type:"Point",coordinates:i})):[s]}class Os{constructor(i,l){this.type=kt,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Rn(i[1])){const f=i[1];if(f.type==="FeatureCollection")return new Os(f,f.features.map(g=>Jo(g.geometry)).flat());if(f.type==="Feature")return new Os(f,Jo(f.geometry));if("type"in f&&"coordinates"in f)return new Os(f,Jo(f))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,f){const g=l.geometry(),w=g.flat().map(M=>Zr([M.x,M.y],l.canonical));if(g.length===0)return NaN;const x=new _o(w[0][1]);let I=1/0;for(const M of f){switch(M.type){case"Point":I=Math.min(I,ns(w,!1,[M.coordinates],!1,x,I));break;case"LineString":I=Math.min(I,ns(w,!1,M.coordinates,!0,x,I));break;case"Polygon":I=Math.min(I,Ko(w,!1,M.coordinates,x,I))}if(I===0)return I}return I}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,f){const g=l.geometry(),w=g.flat().map(M=>Zr([M.x,M.y],l.canonical));if(g.length===0)return NaN;const x=new _o(w[0][1]);let I=1/0;for(const M of f){switch(M.type){case"Point":I=Math.min(I,ns(w,!0,[M.coordinates],!1,x,I));break;case"LineString":I=Math.min(I,ns(w,!0,M.coordinates,!0,x,I));break;case"Polygon":I=Math.min(I,Ko(w,!0,M.coordinates,x,I))}if(I===0)return I}return I}(i,this.geometries);if(i.geometryType()==="Polygon")return function(l,f){const g=l.geometry();if(g.length===0||g[0].length===0)return NaN;const w=Ca(g,0).map(M=>M.map(F=>F.map(q=>Zr([q.x,q.y],l.canonical)))),x=new _o(w[0][0][0][1]);let I=1/0;for(const M of f)for(const F of w){switch(M.type){case"Point":I=Math.min(I,Ko([M.coordinates],!1,F,x,I));break;case"LineString":I=Math.min(I,Ko(M.coordinates,!0,F,x,I));break;case"Polygon":I=Math.min(I,Qi(F,M.coordinates,x,I))}if(I===0)return I}return I}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const yo={"==":Jl,"!=":Yl,">":lu,"<":Ql,">=":$l,"<=":cu,array:Vr,at:va,boolean:Vr,case:jo,coalesce:er,collator:Uo,format:Vo,image:qo,in:wa,"index-of":fo,interpolate:$n,"interpolate-hcl":$n,"interpolate-lab":$n,length:ul,let:Bn,literal:rr,match:ll,number:Vr,"number-format":Sa,object:Vr,slice:As,step:po,string:Vr,"to-boolean":qr,"to-color":qr,"to-number":qr,"to-string":qr,var:Gi,within:Qs,distance:Os};class Mr{constructor(i,l,f,g){this.name=i,this.type=l,this._evaluate=f,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const f=i[0],g=Mr.definitions[f];if(!g)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,I=x.filter(([F])=>!Array.isArray(F)||F.length===i.length-1);let M=null;for(const[F,q]of I){M=new Xs(l.registry,Yo,l.path,null,l.scope);const G=[];let $=!1;for(let re=1;re<i.length;re++){const le=i[re],ge=Array.isArray(F)?F[re-1]:F.type,Ce=M.parse(le,1+G.length,ge);if(!Ce){$=!0;break}G.push(Ce)}if(!$)if(Array.isArray(F)&&F.length!==G.length)M.error(`Expected ${F.length} arguments, but found ${G.length} instead.`);else{for(let re=0;re<G.length;re++){const le=Array.isArray(F)?F[re]:F.type,ge=G[re];M.concat(re+1).checkSubtype(le,ge.type)}if(M.errors.length===0)return new Mr(f,w,q,G)}}if(I.length===1)l.errors.push(...M.errors);else{const F=(I.length?I:x).map(([G])=>{return $=G,Array.isArray($)?`(${$.map(ie).join(", ")})`:`(${ie($.type)}...)`;var $}).join(" | "),q=[];for(let G=1;G<i.length;G++){const $=l.parse(i[G],1+q.length);if(!$)return null;q.push(ie($.type))}l.error(`Expected arguments of type ${F}, but found (${q.join(", ")}) instead.`)}return null}static register(i,l){Mr.definitions=l;for(const f in l)i[f]=Mr}}function dl(s,[i,l,f,g]){i=i.evaluate(s),l=l.evaluate(s),f=f.evaluate(s);const w=g?g.evaluate(s):1,x=Ur(i,l,f,w);if(x)throw new En(x);return new si(i/255,l/255,f/255,w,!1)}function io(s,i){return s in i}function ms(s,i){const l=i[s];return l===void 0?null:l}function no(s){return{type:s}}function Yo(s){if(s instanceof Gi)return Yo(s.boundExpression);if(s instanceof Mr&&s.name==="error"||s instanceof Uo||s instanceof Qs||s instanceof Os)return!1;const i=s instanceof qr||s instanceof Vr;let l=!0;return s.eachChild(f=>{l=i?l&&Yo(f):l&&f instanceof rr}),!!l&&Qo(s)&&$o(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Qo(s){if(s instanceof Mr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Qs||s instanceof Os)return!1;let i=!0;return s.eachChild(l=>{i&&!Qo(l)&&(i=!1)}),i}function bo(s){if(s instanceof Mr&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(l=>{i&&!bo(l)&&(i=!1)}),i}function $o(s,i){if(s instanceof Mr&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(f=>{l&&!$o(f,i)&&(l=!1)}),l}function Aa(s){return{result:"success",value:s}}function vo(s){return{result:"error",value:s}}function wo(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function pl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ml(s){return!!s.expression&&s.expression.interpolated}function Wi(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function xo(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function hc(s){return s}function Ds(s,i){const l=i.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",g=f||!(f||s.property!==void 0),w=s.type||(ml(i)?"exponential":"interval");if(l||i.type==="padding"){const q=l?si.parse:pn.parse;(s=Wt({},s)).stops&&(s.stops=s.stops.map(G=>[G[0],q(G[1])])),s.default=q(s.default?s.default:i.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let I,M,F;if(w==="exponential")I=Pa;else if(w==="interval")I=ea;else if(w==="categorical"){I=Ma,M=Object.create(null);for(const q of s.stops)M[q[0]]=q[1];F=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);I=gl}if(f){const q={},G=[];for(let le=0;le<s.stops.length;le++){const ge=s.stops[le],Ce=ge[0].zoom;q[Ce]===void 0&&(q[Ce]={zoom:Ce,type:s.type,property:s.property,default:s.default,stops:[]},G.push(Ce)),q[Ce].stops.push([ge[0].value,ge[1]])}const $=[];for(const le of G)$.push([q[le].zoom,Ds(q[le],i)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:$n.interpolationFactor.bind(void 0,re),zoomStops:$.map(le=>le[0]),evaluate:({zoom:le},ge)=>Pa({stops:$,base:s.base},i,le).evaluate(le,ge)}}if(g){const q=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:q,interpolationFactor:$n.interpolationFactor.bind(void 0,q),zoomStops:s.stops.map(G=>G[0]),evaluate:({zoom:G})=>I(s,i,G,M,F)}}return{kind:"source",evaluate(q,G){const $=G&&G.properties?G.properties[s.property]:void 0;return $===void 0?ro(s.default,i.default):I(s,i,$,M,F)}}}function ro(s,i,l){return s!==void 0?s:i!==void 0?i:l!==void 0?l:void 0}function Ma(s,i,l,f,g){return ro(typeof l===g?f[l]:void 0,s.default,i.default)}function ea(s,i,l){if(Wi(l)!=="number")return ro(s.default,i.default);const f=s.stops.length;if(f===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[f-1][0])return s.stops[f-1][1];const g=xa(s.stops.map(w=>w[0]),l);return s.stops[g][1]}function Pa(s,i,l){const f=s.base!==void 0?s.base:1;if(Wi(l)!=="number")return ro(s.default,i.default);const g=s.stops.length;if(g===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[g-1][0])return s.stops[g-1][1];const w=xa(s.stops.map(q=>q[0]),l),x=function(q,G,$,re){const le=re-$,ge=q-$;return le===0?0:G===1?ge/le:(Math.pow(G,ge)-1)/(Math.pow(G,le)-1)}(l,f,s.stops[w][0],s.stops[w+1][0]),I=s.stops[w][1],M=s.stops[w+1][1],F=Vn[i.type]||hc;return typeof I.evaluate=="function"?{evaluate(...q){const G=I.evaluate.apply(void 0,q),$=M.evaluate.apply(void 0,q);if(G!==void 0&&$!==void 0)return F(G,$,x,s.colorSpace)}}:F(I,M,x,s.colorSpace)}function gl(s,i,l){switch(i.type){case"color":l=si.parse(l);break;case"formatted":l=Un.fromString(l.toString());break;case"resolvedImage":l=Xn.fromString(l.toString());break;case"padding":l=pn.parse(l);break;default:Wi(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0)}return ro(l,s.default,i.default)}Mr.register(yo,{error:[{kind:"error"},[ui],(s,[i])=>{throw new En(i.evaluate(s))}],typeof:[ui,[ai],(s,[i])=>ie(Ii(i.evaluate(s)))],"to-rgba":[te(kt,4),[nn],(s,[i])=>{const[l,f,g,w]=i.evaluate(s).rgb;return[255*l,255*f,255*g,w]}],rgb:[nn,[kt,kt,kt],dl],rgba:[nn,[kt,kt,kt,kt],dl],has:{type:ii,overloads:[[[ui],(s,[i])=>io(i.evaluate(s),s.properties())],[[ui,gr],(s,[i,l])=>io(i.evaluate(s),l.evaluate(s))]]},get:{type:ai,overloads:[[[ui],(s,[i])=>ms(i.evaluate(s),s.properties())],[[ui,gr],(s,[i,l])=>ms(i.evaluate(s),l.evaluate(s))]]},"feature-state":[ai,[ui],(s,[i])=>ms(i.evaluate(s),s.featureState||{})],properties:[gr,[],s=>s.properties()],"geometry-type":[ui,[],s=>s.geometryType()],id:[ai,[],s=>s.id()],zoom:[kt,[],s=>s.globals.zoom],"heatmap-density":[kt,[],s=>s.globals.heatmapDensity||0],"line-progress":[kt,[],s=>s.globals.lineProgress||0],accumulated:[ai,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[kt,no(kt),(s,i)=>{let l=0;for(const f of i)l+=f.evaluate(s);return l}],"*":[kt,no(kt),(s,i)=>{let l=1;for(const f of i)l*=f.evaluate(s);return l}],"-":{type:kt,overloads:[[[kt,kt],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[kt],(s,[i])=>-i.evaluate(s)]]},"/":[kt,[kt,kt],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[kt,[kt,kt],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[kt,[],()=>Math.LN2],pi:[kt,[],()=>Math.PI],e:[kt,[],()=>Math.E],"^":[kt,[kt,kt],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[kt,[kt],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[kt,[kt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[kt,[kt],(s,[i])=>Math.log(i.evaluate(s))],log2:[kt,[kt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[kt,[kt],(s,[i])=>Math.sin(i.evaluate(s))],cos:[kt,[kt],(s,[i])=>Math.cos(i.evaluate(s))],tan:[kt,[kt],(s,[i])=>Math.tan(i.evaluate(s))],asin:[kt,[kt],(s,[i])=>Math.asin(i.evaluate(s))],acos:[kt,[kt],(s,[i])=>Math.acos(i.evaluate(s))],atan:[kt,[kt],(s,[i])=>Math.atan(i.evaluate(s))],min:[kt,no(kt),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[kt,no(kt),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[kt,[kt],(s,[i])=>Math.abs(i.evaluate(s))],round:[kt,[kt],(s,[i])=>{const l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[kt,[kt],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[kt,[kt],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[ii,[ui,ai],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[ii,[ai],(s,[i])=>s.id()===i.value],"filter-type-==":[ii,[ui],(s,[i])=>s.geometryType()===i.value],"filter-<":[ii,[ui,ai],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f<g}],"filter-id-<":[ii,[ai],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l<f}],"filter->":[ii,[ui,ai],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f>g}],"filter-id->":[ii,[ai],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l>f}],"filter-<=":[ii,[ui,ai],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[ii,[ai],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l<=f}],"filter->=":[ii,[ui,ai],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[ii,[ai],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l>=f}],"filter-has":[ii,[ai],(s,[i])=>i.value in s.properties()],"filter-has-id":[ii,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ii,[te(ui)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[ii,[te(ai)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[ii,[ui,te(ai)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[ii,[ui,te(ai)],(s,[i,l])=>function(f,g,w,x){for(;w<=x;){const I=w+x>>1;if(g[I]===f)return!0;g[I]>f?x=I-1:w=I+1}return!1}(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:ii,overloads:[[[ii,ii],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[no(ii),(s,i)=>{for(const l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:ii,overloads:[[[ii,ii],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[no(ii),(s,i)=>{for(const l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[ii,[ii],(s,[i])=>!i.evaluate(s)],"is-supported-script":[ii,[ui],(s,[i])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(i.evaluate(s))}],upcase:[ui,[ui],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[ui,[ui],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[ui,no(ai),(s,i)=>i.map(l=>No(l.evaluate(s))).join("")],"resolved-locale":[ui,[_r],(s,[i])=>i.evaluate(s).resolvedLocale()]});class ko{constructor(i,l){var f;this.expression=i,this._warningHistory={},this._evaluator=new ba,this._defaultValue=l?(f=l).type==="color"&&xo(f.default)?new si(0,0,0,0):f.type==="color"?si.parse(f.default)||null:f.type==="padding"?pn.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?zn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,f,g,w,x){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(i,l,f,g,w,x){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new En(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function La(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in yo}function Pr(s,i){const l=new Xs(yo,Yo,[],i?function(g){const w={color:nn,string:ui,number:kt,enum:ui,boolean:ii,formatted:yr,padding:Ir,resolvedImage:Ar,variableAnchorOffsetCollection:Pe};return g.type==="array"?te(w[g.value]||ai,g.length):w[g.type]}(i):void 0),f=l.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Aa(new ko(f,i)):vo(l.errors)}class br{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!bo(l.expression)}evaluateWithoutErrorHandling(i,l,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,g,w,x)}evaluate(i,l,f,g,w,x){return this._styleExpression.evaluate(i,l,f,g,w,x)}}class So{constructor(i,l,f,g){this.kind=i,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!bo(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,l,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,g,w,x)}evaluate(i,l,f,g,w,x){return this._styleExpression.evaluate(i,l,f,g,w,x)}interpolationFactor(i,l,f){return this.interpolationType?$n.interpolationFactor(this.interpolationType,i,l,f):0}}function _l(s,i){const l=Pr(s,i);if(l.result==="error")return l;const f=l.value.expression,g=Qo(f);if(!g&&!wo(i))return vo([new Ei("","data expressions not supported")]);const w=$o(f,["zoom"]);if(!w&&!pl(i))return vo([new Ei("","zoom expressions not supported")]);const x=ta(f);return x||w?x instanceof Ei?vo([x]):x instanceof $n&&!ml(i)?vo([new Ei("",'"interpolate" expressions cannot be used with this property')]):Aa(x?new So(g?"camera":"composite",l.value,x.labels,x instanceof $n?x.interpolation:void 0):new br(g?"constant":"source",l.value)):vo([new Ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class To{constructor(i,l){this._parameters=i,this._specification=l,Wt(this,Ds(this._parameters,this._specification))}static deserialize(i){return new To(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ta(s){let i=null;if(s instanceof Bn)i=ta(s.result);else if(s instanceof er){for(const l of s.args)if(i=ta(l),i)break}else(s instanceof po||s instanceof $n)&&s.input instanceof Mr&&s.input.name==="zoom"&&(i=s);return i instanceof Ei||s.eachChild(l=>{const f=ta(l);f instanceof Ei?i=f:!i&&f?i=new Ei("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new Ei("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function za(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!za(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Oa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function yl(s){if(s==null)return{filter:()=>!0,needGeometry:!1};za(s)||(s=so(s));const i=Pr(s,Oa);if(i.result==="error")throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,f,g)=>i.value.evaluate(l,f,{},g),needGeometry:bl(s)}}function _u(s,i){return s<i?-1:s>i?1:0}function bl(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let i=1;i<s.length;i++)if(bl(s[i]))return!0;return!1}function so(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?Co(s[1],s[2],"=="):i==="!="?Pn(Co(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Co(s[1],s[2],i):i==="any"?(l=s.slice(1),["any"].concat(l.map(so))):i==="all"?["all"].concat(s.slice(1).map(so)):i==="none"?["all"].concat(s.slice(1).map(so).map(Pn)):i==="in"?ia(s[1],s.slice(2)):i==="!in"?Pn(ia(s[1],s.slice(2))):i==="has"?na(s[1]):i!=="!has"||Pn(na(s[1]));var l}function Co(s,i,l){switch(s){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,s,i]}}function ia(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",s,["literal",i.sort(_u)]]:["filter-in-small",s,["literal",i]]}}function na(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Pn(s){return["!",s]}function Ne(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const w of s)g+=`${Ne(w)},`;return`${g}]`}const l=Object.keys(s).sort();let f="{";for(let g=0;g<l.length;g++)f+=`${JSON.stringify(l[g])}:${Ne(s[l[g]])},`;return`${f}}`}function D(s){let i="";for(const l of _i)i+=`/${Ne(s[l])}`;return i}function se(s){const i=s.value;return i?[new ft(s.key,i,"constants have been deprecated as of v8")]:[]}function Fe(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function mt(s){if(Array.isArray(s))return s.map(mt);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const l in s)i[l]=mt(s[l]);return i}return Fe(s)}function It(s){const i=s.key,l=s.value,f=s.valueSpec||{},g=s.objectElementValidators||{},w=s.style,x=s.styleSpec,I=s.validateSpec;let M=[];const F=Wi(l);if(F!=="object")return[new ft(i,l,`object expected, ${F} found`)];for(const q in l){const G=q.split(".")[0],$=f[G]||f["*"];let re;if(g[G])re=g[G];else if(f[G])re=I;else if(g["*"])re=g["*"];else{if(!f["*"]){M.push(new ft(i,l[q],`unknown property "${q}"`));continue}re=I}M=M.concat(re({key:(i&&`${i}.`)+q,value:l[q],valueSpec:$,style:w,styleSpec:x,object:l,objectKey:q,validateSpec:I},l))}for(const q in f)g[q]||f[q].required&&f[q].default===void 0&&l[q]===void 0&&M.push(new ft(i,l,`missing required property "${q}"`));return M}function Xt(s){const i=s.value,l=s.valueSpec,f=s.style,g=s.styleSpec,w=s.key,x=s.arrayElementValidator||s.validateSpec;if(Wi(i)!=="array")return[new ft(w,i,`array expected, ${Wi(i)} found`)];if(l.length&&i.length!==l.length)return[new ft(w,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new ft(w,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let I={type:l.value,values:l.values};g.$version<7&&(I.function=l.function),Wi(l.value)==="object"&&(I=l.value);let M=[];for(let F=0;F<i.length;F++)M=M.concat(x({array:i,arrayIndex:F,value:i[F],valueSpec:I,validateSpec:s.validateSpec,style:f,styleSpec:g,key:`${w}[${F}]`}));return M}function Hi(s){const i=s.key,l=s.value,f=s.valueSpec;let g=Wi(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new ft(i,l,`number expected, ${g} found`)]:"minimum"in f&&l<f.minimum?[new ft(i,l,`${l} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&l>f.maximum?[new ft(i,l,`${l} is greater than the maximum value ${f.maximum}`)]:[]}function cn(s){const i=s.valueSpec,l=Fe(s.value.type);let f,g,w,x={};const I=l!=="categorical"&&s.value.property===void 0,M=!I,F=Wi(s.value.stops)==="array"&&Wi(s.value.stops[0])==="array"&&Wi(s.value.stops[0][0])==="object",q=It({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(re){if(l==="identity")return[new ft(re.key,re.value,'identity function may not have a "stops" property')];let le=[];const ge=re.value;return le=le.concat(Xt({key:re.key,value:ge,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:G})),Wi(ge)==="array"&&ge.length===0&&le.push(new ft(re.key,ge,"array must have at least one stop")),le},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:i,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return l==="identity"&&I&&q.push(new ft(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||q.push(new ft(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!ml(s.valueSpec)&&q.push(new ft(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(M&&!wo(s.valueSpec)?q.push(new ft(s.key,s.value,"property functions not supported")):I&&!pl(s.valueSpec)&&q.push(new ft(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!F||s.value.property!==void 0||q.push(new ft(s.key,s.value,'"property" property is required')),q;function G(re){let le=[];const ge=re.value,Ce=re.key;if(Wi(ge)!=="array")return[new ft(Ce,ge,`array expected, ${Wi(ge)} found`)];if(ge.length!==2)return[new ft(Ce,ge,`array length 2 expected, length ${ge.length} found`)];if(F){if(Wi(ge[0])!=="object")return[new ft(Ce,ge,`object expected, ${Wi(ge[0])} found`)];if(ge[0].zoom===void 0)return[new ft(Ce,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new ft(Ce,ge,"object stop key must have value")];if(w&&w>Fe(ge[0].zoom))return[new ft(Ce,ge[0].zoom,"stop zoom values must appear in ascending order")];Fe(ge[0].zoom)!==w&&(w=Fe(ge[0].zoom),g=void 0,x={}),le=le.concat(It({key:`${Ce}[0]`,value:ge[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:Hi,value:$}}))}else le=le.concat($({key:`${Ce}[0]`,value:ge[0],validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},ge));return La(mt(ge[1]))?le.concat([new ft(`${Ce}[1]`,ge[1],"expressions are not allowed in function stops.")]):le.concat(re.validateSpec({key:`${Ce}[1]`,value:ge[1],valueSpec:i,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function $(re,le){const ge=Wi(re.value),Ce=Fe(re.value),ze=re.value!==null?re.value:le;if(f){if(ge!==f)return[new ft(re.key,ze,`${ge} stop domain type must match previous stop domain type ${f}`)]}else f=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean")return[new ft(re.key,ze,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&l!=="categorical"){let tt=`number expected, ${ge} found`;return wo(i)&&l===void 0&&(tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(re.key,ze,tt)]}return l!=="categorical"||ge!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?l!=="categorical"&&ge==="number"&&g!==void 0&&Ce<g?[new ft(re.key,ze,"stop domain values must appear in ascending order")]:(g=Ce,l==="categorical"&&Ce in x?[new ft(re.key,ze,"stop domain values must be unique")]:(x[Ce]=!0,[])):[new ft(re.key,ze,`integer expected, found ${Ce}`)]}}function On(s){const i=(s.expressionContext==="property"?_l:Pr)(mt(s.value),s.valueSpec);if(i.result==="error")return i.value.map(f=>new ft(`${s.key}${f.key}`,s.value,f.message));const l=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new ft(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!bo(l))return[new ft(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!bo(l))return[new ft(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!$o(l,["zoom","feature-state"]))return[new ft(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Qo(l))return[new ft(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function In(s){const i=s.key,l=s.value,f=s.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Fe(l))===-1&&g.push(new ft(i,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(Fe(l))===-1&&g.push(new ft(i,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function vr(s){return za(mt(s.value))?On(Wt({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lr(s)}function Lr(s){const i=s.value,l=s.key;if(Wi(i)!=="array")return[new ft(l,i,`array expected, ${Wi(i)} found`)];const f=s.styleSpec;let g,w=[];if(i.length<1)return[new ft(l,i,"filter array must have at least 1 element")];switch(w=w.concat(In({key:`${l}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),Fe(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Fe(i[1])==="$type"&&w.push(new ft(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new ft(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Wi(i[1]),g!=="string"&&w.push(new ft(`${l}[1]`,i[1],`string expected, ${g} found`)));for(let x=2;x<i.length;x++)g=Wi(i[x]),Fe(i[1])==="$type"?w=w.concat(In({key:`${l}[${x}]`,value:i[x],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new ft(`${l}[${x}]`,i[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)w=w.concat(Lr({key:`${l}[${x}]`,value:i[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Wi(i[1]),i.length!==2?w.push(new ft(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new ft(`${l}[1]`,i[1],`string expected, ${g} found`))}return w}function Wr(s,i){const l=s.key,f=s.validateSpec,g=s.style,w=s.styleSpec,x=s.value,I=s.objectKey,M=w[`${i}_${s.layerType}`];if(!M)return[];const F=I.match(/^(.*)-transition$/);if(i==="paint"&&F&&M[F[1]]&&M[F[1]].transition)return f({key:l,value:x,valueSpec:w.transition,style:g,styleSpec:w});const q=s.valueSpec||M[I];if(!q)return[new ft(l,x,`unknown property "${I}"`)];let G;if(Wi(x)==="string"&&wo(q)&&!q.tokens&&(G=/^{([^}]+)}$/.exec(x)))return[new ft(l,x,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const $=[];return s.layerType==="symbol"&&(I==="text-field"&&g&&!g.glyphs&&$.push(new ft(l,x,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&xo(mt(x))&&Fe(x.type)==="identity"&&$.push(new ft(l,x,'"text-font" does not support identity functions'))),$.concat(f({key:s.key,value:x,valueSpec:q,style:g,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:I}))}function rs(s){return Wr(s,"paint")}function wr(s){return Wr(s,"layout")}function oo(s){let i=[];const l=s.value,f=s.key,g=s.style,w=s.styleSpec;l.type||l.ref||i.push(new ft(f,l,'either "type" or "ref" is required'));let x=Fe(l.type);const I=Fe(l.ref);if(l.id){const M=Fe(l.id);for(let F=0;F<s.arrayIndex;F++){const q=g.layers[F];Fe(q.id)===M&&i.push(new ft(f,l.id,`duplicate layer id "${l.id}", previously used at line ${q.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach(F=>{F in l&&i.push(new ft(f,l[F],`"${F}" is prohibited for ref layers`))}),g.layers.forEach(F=>{Fe(F.id)===I&&(M=F)}),M?M.ref?i.push(new ft(f,l.ref,"ref cannot reference another ref layer")):x=Fe(M.type):i.push(new ft(f,l.ref,`ref layer "${I}" not found`))}else if(x!=="background")if(l.source){const M=g.sources&&g.sources[l.source],F=M&&Fe(M.type);M?F==="vector"&&x==="raster"?i.push(new ft(f,l.source,`layer "${l.id}" requires a raster source`)):F!=="raster-dem"&&x==="hillshade"?i.push(new ft(f,l.source,`layer "${l.id}" requires a raster-dem source`)):F==="raster"&&x!=="raster"?i.push(new ft(f,l.source,`layer "${l.id}" requires a vector source`)):F!=="vector"||l["source-layer"]?F==="raster-dem"&&x!=="hillshade"?i.push(new ft(f,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!l.paint||!l.paint["line-gradient"]||F==="geojson"&&M.lineMetrics||i.push(new ft(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ft(f,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new ft(f,l.source,`source "${l.source}" not found`))}else i.push(new ft(f,l,'missing required property "source"'));return i=i.concat(It({key:f,value:l,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:l.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"}),filter:vr,layout:M=>It({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":F=>wr(Wt({layerType:x},F))}}),paint:M=>It({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":F=>rs(Wt({layerType:x},F))}})}})),i}function ss(s){const i=s.value,l=s.key,f=Wi(i);return f!=="string"?[new ft(l,i,`string expected, ${f} found`)]:[]}const Da={promoteId:function({key:s,value:i}){if(Wi(i)==="string")return ss({key:s,value:i});{const l=[];for(const f in i)l.push(...ss({key:`${s}.${f}`,value:i[f]}));return l}}};function Gr(s){const i=s.value,l=s.key,f=s.styleSpec,g=s.style,w=s.validateSpec;if(!i.type)return[new ft(l,i,'"type" is required')];const x=Fe(i.type);let I;switch(x){case"vector":case"raster":return I=It({key:l,value:i,valueSpec:f[`source_${x.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:Da,validateSpec:w}),I;case"raster-dem":return I=function(M){var F;const q=(F=M.sourceName)!==null&&F!==void 0?F:"",G=M.value,$=M.styleSpec,re=$.source_raster_dem,le=M.style;let ge=[];const Ce=Wi(G);if(G===void 0)return ge;if(Ce!=="object")return ge.push(new ft("source_raster_dem",G,`object expected, ${Ce} found`)),ge;const ze=Fe(G.encoding)==="custom",tt=["redFactor","greenFactor","blueFactor","baseShift"],Ve=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Ye in G)!ze&&tt.includes(Ye)?ge.push(new ft(Ye,G[Ye],`In "${q}": "${Ye}" is only valid when "encoding" is set to "custom". ${Ve} encoding found`)):re[Ye]?ge=ge.concat(M.validateSpec({key:Ye,value:G[Ye],valueSpec:re[Ye],validateSpec:M.validateSpec,style:le,styleSpec:$})):ge.push(new ft(Ye,G[Ye],`unknown property "${Ye}"`));return ge}({sourceName:l,value:i,style:s.style,styleSpec:f,validateSpec:w}),I;case"geojson":if(I=It({key:l,value:i,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:w,objectElementValidators:Da}),i.cluster)for(const M in i.clusterProperties){const[F,q]=i.clusterProperties[M],G=typeof F=="string"?[F,["accumulated"],["get",M]]:F;I.push(...On({key:`${l}.${M}.map`,value:q,expressionContext:"cluster-map"})),I.push(...On({key:`${l}.${M}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return I;case"video":return It({key:l,value:i,valueSpec:f.source_video,style:g,validateSpec:w,styleSpec:f});case"image":return It({key:l,value:i,valueSpec:f.source_image,style:g,validateSpec:w,styleSpec:f});case"canvas":return[new ft(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return In({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function vl(s){const i=s.value,l=s.styleSpec,f=l.light,g=s.style;let w=[];const x=Wi(i);if(i===void 0)return w;if(x!=="object")return w=w.concat([new ft("light",i,`object expected, ${x} found`)]),w;for(const I in i){const M=I.match(/^(.*)-transition$/);w=w.concat(M&&f[M[1]]&&f[M[1]].transition?s.validateSpec({key:I,value:i[I],valueSpec:l.transition,validateSpec:s.validateSpec,style:g,styleSpec:l}):f[I]?s.validateSpec({key:I,value:i[I],valueSpec:f[I],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new ft(I,i[I],`unknown property "${I}"`)])}return w}function yu(s){const i=s.value,l=s.styleSpec,f=l.sky,g=s.style,w=Wi(i);if(i===void 0)return[];if(w!=="object")return[new ft("sky",i,`object expected, ${w} found`)];let x=[];for(const I in i)x=x.concat(f[I]?s.validateSpec({key:I,value:i[I],valueSpec:f[I],style:g,styleSpec:l}):[new ft(I,i[I],`unknown property "${I}"`)]);return x}function bu(s){const i=s.value,l=s.styleSpec,f=l.terrain,g=s.style;let w=[];const x=Wi(i);if(i===void 0)return w;if(x!=="object")return w=w.concat([new ft("terrain",i,`object expected, ${x} found`)]),w;for(const I in i)w=w.concat(f[I]?s.validateSpec({key:I,value:i[I],valueSpec:f[I],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new ft(I,i[I],`unknown property "${I}"`)]);return w}function vu(s){let i=[];const l=s.value,f=s.key;if(Array.isArray(l)){const g=[],w=[];for(const x in l)l[x].id&&g.includes(l[x].id)&&i.push(new ft(f,l,`all the sprites' ids must be unique, but ${l[x].id} is duplicated`)),g.push(l[x].id),l[x].url&&w.includes(l[x].url)&&i.push(new ft(f,l,`all the sprites' URLs must be unique, but ${l[x].url} is duplicated`)),w.push(l[x].url),i=i.concat(It({key:`${f}[${x}]`,value:l[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return ss({key:f,value:l})}const fc={"*":()=>[],array:Xt,boolean:function(s){const i=s.value,l=s.key,f=Wi(i);return f!=="boolean"?[new ft(l,i,`boolean expected, ${f} found`)]:[]},number:Hi,color:function(s){const i=s.key,l=s.value,f=Wi(l);return f!=="string"?[new ft(i,l,`color expected, ${f} found`)]:si.parse(String(l))?[]:[new ft(i,l,`color expected, "${l}" found`)]},constants:se,enum:In,filter:vr,function:cn,layer:oo,object:It,source:Gr,light:vl,sky:yu,terrain:bu,projection:function(s){const i=s.value,l=s.styleSpec,f=l.projection,g=s.style,w=Wi(i);if(i===void 0)return[];if(w!=="object")return[new ft("projection",i,`object expected, ${w} found`)];let x=[];for(const I in i)x=x.concat(f[I]?s.validateSpec({key:I,value:i[I],valueSpec:f[I],style:g,styleSpec:l}):[new ft(I,i[I],`unknown property "${I}"`)]);return x},string:ss,formatted:function(s){return ss(s).length===0?[]:On(s)},resolvedImage:function(s){return ss(s).length===0?[]:On(s)},padding:function(s){const i=s.key,l=s.value;if(Wi(l)==="array"){if(l.length<1||l.length>4)return[new ft(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const f={type:"number"};let g=[];for(let w=0;w<l.length;w++)g=g.concat(s.validateSpec({key:`${i}[${w}]`,value:l[w],validateSpec:s.validateSpec,valueSpec:f}));return g}return Hi({key:i,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,l=s.value,f=Wi(l),g=s.styleSpec;if(f!=="array"||l.length<1||l.length%2!=0)return[new ft(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<l.length;x+=2)w=w.concat(In({key:`${i}[${x}]`,value:l[x],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Xt({key:`${i}[${x+1}]`,value:l[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return w},sprite:vu};function wl(s){const i=s.value,l=s.valueSpec,f=s.styleSpec;return s.validateSpec=wl,l.expression&&xo(Fe(i))?cn(s):l.expression&&La(mt(i))?On(s):l.type&&fc[l.type]?fc[l.type](s):It(Wt({},s,{valueSpec:l.type?f[l.type]:l}))}function kh(s){const i=s.value,l=s.key,f=ss(s);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new ft(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new ft(l,i,'"glyphs" url must include a "{range}" token'))),f}function os(s,i=Qe){let l=[];return l=l.concat(wl({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:wl,objectElementValidators:{glyphs:kh,"*":()=>[]}})),s.constants&&(l=l.concat(se({key:"constants",value:s.constants}))),wu(l)}function Fs(s){return function(i){return s({...i,validateSpec:wl})}}function wu(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function gs(s){return function(...i){return wu(s.apply(this,i))}}os.source=gs(Fs(Gr)),os.sprite=gs(Fs(vu)),os.glyphs=gs(Fs(kh)),os.light=gs(Fs(vl)),os.sky=gs(Fs(yu)),os.terrain=gs(Fs(bu)),os.layer=gs(Fs(oo)),os.filter=gs(Fs(vr)),os.paintProperty=gs(Fs(rs)),os.layoutProperty=gs(Fs(wr));const ra=os,Af=ra.light,Mf=ra.sky,Sh=ra.paintProperty,Th=ra.layoutProperty;function xu(s,i){let l=!1;if(i&&i.length)for(const f of i)s.fire(new Pt(new Error(f.message))),l=!0;return l}class Fa{constructor(i,l,f){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(l=x[1])+2*(f=x[2]);for(let M=0;M<this.d*this.d;M++){const F=x[3+M],q=x[3+M+1];g.push(F===q?null:x.subarray(F,q))}const I=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],I),this.bboxes=x.subarray(I),this.insert=this._insertReadonly}else{this.d=l+2*f;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=f,this.scale=l/i,this.uid=0;const w=f/l*i;this.min=-w,this.max=i+w}insert(i,l,f,g,w){this._forEachCell(l,f,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,f,g,w,x){this.cells[w].push(x)}query(i,l,f,g,w){const x=this.min,I=this.max;if(i<=x&&l<=x&&I<=f&&I<=g&&!w)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(i,l,f,g,this._queryCell,M,{},w),M}}_queryCell(i,l,f,g,w,x,I,M){const F=this.cells[w];if(F!==null){const q=this.keys,G=this.bboxes;for(let $=0;$<F.length;$++){const re=F[$];if(I[re]===void 0){const le=4*re;(M?M(G[le+0],G[le+1],G[le+2],G[le+3]):i<=G[le+2]&&l<=G[le+3]&&f>=G[le+0]&&g>=G[le+1])?(I[re]=!0,x.push(q[re])):I[re]=!1}}}}_forEachCell(i,l,f,g,w,x,I,M){const F=this._convertToCellCoord(i),q=this._convertToCellCoord(l),G=this._convertToCellCoord(f),$=this._convertToCellCoord(g);for(let re=F;re<=G;re++)for(let le=q;le<=$;le++){const ge=this.d*le+re;if((!M||M(this._convertFromCellCoord(re),this._convertFromCellCoord(le),this._convertFromCellCoord(re+1),this._convertFromCellCoord(le+1)))&&w.call(this,i,l,f,g,ge,x,I,M))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const g=new Int32Array(l+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=l;for(let x=0;x<i.length;x++){const I=i[x];g[3+x]=w,g.set(I,w),w+=I.length}return g[3+i.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+i.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(i,l){const f=i.toArrayBuffer();return l&&l.push(f),{buffer:f}}static deserialize(i){return new Fa(i.buffer)}}const as={};function qt(s,i,l={}){if(as[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),as[s]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}qt("Object",Object),qt("TransferableGridIndex",Fa),qt("Color",si),qt("Error",Error),qt("AJAXError",Ht),qt("ResolvedImage",Xn),qt("StylePropertyFunction",To),qt("StyleExpression",ko,{omit:["_evaluator"]}),qt("ZoomDependentExpression",So),qt("ZoomConstantExpression",br),qt("CompoundExpression",Mr,{omit:["_evaluate"]});for(const s in yo)yo[s]._classRegistryKey||qt(`Expression_${s}`,yo[s]);function dc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function ku(s){return s.$name||s.constructor._classRegistryKey}function Ch(s){return!function(i){if(i===null||typeof i!="object")return!1;const l=ku(i);return!(!l||l==="Object")}(s)&&(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||dc(s)||ye(s)||ArrayBuffer.isView(s)||s instanceof ImageData)}function Ra(s,i){if(Ch(s))return(dc(s)||ye(s))&&i&&i.push(s),ArrayBuffer.isView(s)&&i&&i.push(s.buffer),s instanceof ImageData&&i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const w=[];for(const x of s)w.push(Ra(x,i));return w}if(typeof s!="object")throw new Error("can't serialize object of type "+typeof s);const l=ku(s);if(!l)throw new Error(`can't serialize object of unregistered class ${s.constructor.name}`);if(!as[l])throw new Error(`${l} is not registered.`);const{klass:f}=as[l],g=f.serialize?f.serialize(s,i):{};if(f.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||as[l].omit.indexOf(w)>=0)continue;const x=s[w];g[w]=as[l].shallow.indexOf(w)>=0?x:Ra(x,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(g.$name=l),g}function Ba(s){if(Ch(s))return s;if(Array.isArray(s))return s.map(Ba);if(typeof s!="object")throw new Error("can't deserialize object of type "+typeof s);const i=ku(s)||"Object";if(!as[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=as[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(s);const f=Object.create(l.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const w=s[g];f[g]=as[i].shallow.indexOf(g)>=0?w:Ba(w)}return f}class Su{constructor(){this.first=!0}update(i,l){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const Ui={"Latin-1 Supplement":s=>s>=128&&s<=255,"Hangul Jamo":s=>s>=4352&&s<=4607,Khmer:s=>s>=6016&&s<=6143,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Katakana:s=>s>=12448&&s<=12543,Kanbun:s=>s>=12688&&s<=12703,"CJK Strokes":s=>s>=12736&&s<=12783,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"Private Use Area":s=>s>=57344&&s<=63743,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Tu(s){for(const i of s)if(Eu(i.charCodeAt(0)))return!0;return!1}function Pf(s){for(const i of s)if(!Na(i.charCodeAt(0)))return!1;return!0}function Cu(s){const i=s.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(i.join("|"),"u")}const Lf=Cu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Na(s){return!Lf.test(String.fromCodePoint(s))}const Eh=Cu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Eu(s){return!(s!==746&&s!==747&&(s<4352||!(Ui["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Ui["CJK Compatibility"](s)||Ui["CJK Strokes"](s)||!(!Ui["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Ui["Enclosed CJK Letters and Months"](s)||Ui["Ideographic Description Characters"](s)||Ui.Kanbun(s)||Ui.Katakana(s)&&s!==12540||!(!Ui["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Ui["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Ui["Vertical Forms"](s)||Ui["Yijing Hexagram Symbols"](s)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(s))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(s))||Eh.test(String.fromCodePoint(s)))))}function Ih(s){return!(Eu(s)||function(i){return!!(Ui["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Ui["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Ui["Letterlike Symbols"](i)||Ui["Number Forms"](i)||Ui["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Ui["Control Pictures"](i)&&i!==9251||Ui["Optical Character Recognition"](i)||Ui["Enclosed Alphanumerics"](i)||Ui["Geometric Shapes"](i)||Ui["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Ui["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Ui["CJK Symbols and Punctuation"](i)||Ui.Katakana(i)||Ui["Private Use Area"](i)||Ui["CJK Compatibility Forms"](i)||Ui["Small Form Variants"](i)||Ui["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}const zf=Cu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Iu(s){return zf.test(String.fromCodePoint(s))}function Of(s,i){return!(!i&&Iu(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Ui.Khmer(s))}function Df(s){for(const i of s)if(Iu(i.charCodeAt(0)))return!0;return!1}const Hr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class mn{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Su,this.transition={})}isSupportedScript(i){return function(l,f){for(const g of l)if(!Of(g.charCodeAt(0),f))return!1;return!0}(i,Hr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*l}}}class ja{constructor(i,l){this.property=i,this.value=l,this.expression=function(f,g){if(xo(f))return new To(f,g);if(La(f)){const w=_l(f,g);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=f;return g.type==="color"&&typeof f=="string"?w=si.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=zn.parse(f)):w=pn.parse(f),{kind:"constant",evaluate:()=>w}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,f){return this.property.possiblyEvaluate(this,i,l,f)}}class pc{constructor(i){this.property=i,this.value=new ja(i,void 0)}transitioned(i,l){return new Ah(this.property,this.value,l,ne({},i.transition,this.transition),i.now)}untransitioned(){return new Ah(this.property,this.value,null,{},0)}}class mc{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return B(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new pc(this._values[i].property)),this._values[i].value=new ja(this._values[i].property,l===null?void 0:B(l))}getTransition(i){return B(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new pc(this._values[i].property)),this._values[i].transition=B(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(i[l]=f);const g=this.getTransition(l);g!==void 0&&(i[`${l}-transition`]=g)}return i}transitioned(i,l){const f=new xl(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(i,l._values[g]);return f}untransitioned(){const i=new xl(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Ah{constructor(i,l,f,g,w){this.property=i,this.value=l,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(i,l,f){const g=i.now||0,w=this.value.possiblyEvaluate(i,l,f),x=this.prior;if(x){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return x.possiblyEvaluate(i,l,f);{const I=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,l,f),w,function(M){if(M<=0)return 0;if(M>=1)return 1;const F=M*M,q=F*M;return 4*(M<.5?q:3*(M-F)+q-.75)}(I))}}return w}}class xl{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,f){const g=new Sl(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(i,l,f);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class kl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return B(this._values[i].value)}setValue(i,l){this._values[i]=new ja(this._values[i].property,l===null?void 0:B(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(i[l]=f)}return i}possiblyEvaluate(i,l,f){const g=new Sl(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(i,l,f);return g}}class Rs{constructor(i,l,f){this.property=i,this.value=l,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,f,g){return this.property.evaluate(this.value,this.parameters,i,l,f,g)}}class Sl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Kt{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,f){const g=Vn[this.specification.type];return g?g(i,l,f):i}}class fi{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,f,g){return new Rs(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},f,g)}:i.expression,l)}interpolate(i,l,f){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new Rs(this,{kind:"constant",value:void 0},i.parameters);const g=Vn[this.specification.type];if(g){const w=g(i.value.value,l.value.value,f);return new Rs(this,{kind:"constant",value:w},i.parameters)}return i}evaluate(i,l,f,g,w,x){return i.kind==="constant"?i.value:i.evaluate(l,f,g,w,x)}}class gc extends fi{possiblyEvaluate(i,l,f,g){if(i.value===void 0)return new Rs(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){const w=i.expression.evaluate(l,null,{},f,g),x=i.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,I=this._calculate(x,x,x,l);return new Rs(this,{kind:"constant",value:I},l)}if(i.expression.kind==="camera"){const w=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new Rs(this,{kind:"constant",value:w},l)}return new Rs(this,i.expression,l)}evaluate(i,l,f,g,w,x){if(i.kind==="source"){const I=i.evaluate(l,f,g,w,x);return this._calculate(I,I,I,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},f,g),i.evaluate({zoom:Math.floor(l.zoom)},f,g),i.evaluate({zoom:Math.floor(l.zoom)+1},f,g),l):i.value}_calculate(i,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:f,to:l}}interpolate(i){return i}}class _c{constructor(i){this.specification=i}possiblyEvaluate(i,l,f,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const w=i.expression.evaluate(l,null,{},f,g);return this._calculate(w,w,w,l)}return this._calculate(i.expression.evaluate(new mn(Math.floor(l.zoom-1),l)),i.expression.evaluate(new mn(Math.floor(l.zoom),l)),i.expression.evaluate(new mn(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:f,to:l}}interpolate(i){return i}}class Au{constructor(i){this.specification=i}possiblyEvaluate(i,l,f,g){return!!i.expression.evaluate(l,null,{},f,g)}interpolate(){return!1}}class v{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const f=i[l];f.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new ja(f,void 0),w=this.defaultTransitionablePropertyValues[l]=new pc(f);this.defaultTransitioningPropertyValues[l]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}qt("DataDrivenProperty",fi),qt("DataConstantProperty",Kt),qt("CrossFadedDataDrivenProperty",gc),qt("CrossFadedProperty",_c),qt("ColorRampProperty",Au);const t="-transition";class u extends ni{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new kl(l.layout)),l.paint)){this._transitionablePaint=new mc(l.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Sl(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,f={}){l!=null&&this._validate(Th,`layers.${this.id}.layout.${i}`,i,l,f)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(t)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,f={}){if(l!=null&&this._validate(Sh,`layers.${this.id}.paint.${i}`,i,l,f))return!1;if(i.endsWith(t))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[i],w=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),I=g.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const M=this._transitionablePaint._values[i].value;return M.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(i,I,M)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),X(i,(l,f)=>!(l===void 0||f==="layout"&&!Object.keys(l).length||f==="paint"&&!Object.keys(l).length))}_validate(i,l,f,g,w={}){return(!w||w.validate!==!1)&&xu(this,i.call(ra,{key:l,layerType:this.type,objectKey:f,value:g,styleSpec:Qe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Rs&&wo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class b{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function A(s,i=1){let l=0,f=0;return{members:s.map(g=>{const w=p[g.type].BYTES_PER_ELEMENT,x=l=P(l,Math.max(i,w)),I=g.components||1;return f=Math.max(f,w),l+=w*I,{name:g.name,type:g.type,components:I,offset:x}}),size:P(l,Math.max(f,i)),alignment:i}}function P(s,i){return Math.ceil(s/i)*i}class O extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.int16[g+0]=l,this.int16[g+1]=f,i}}O.prototype.bytesPerElement=4,qt("StructArrayLayout2i4",O);class Z extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=3*i;return this.int16[w+0]=l,this.int16[w+1]=f,this.int16[w+2]=g,i}}Z.prototype.bytesPerElement=6,qt("StructArrayLayout3i6",Z);class K extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,g)}emplace(i,l,f,g,w){const x=4*i;return this.int16[x+0]=l,this.int16[x+1]=f,this.int16[x+2]=g,this.int16[x+3]=w,i}}K.prototype.bytesPerElement=8,qt("StructArrayLayout4i8",K);class J extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x){const I=this.length;return this.resize(I+1),this.emplace(I,i,l,f,g,w,x)}emplace(i,l,f,g,w,x,I){const M=6*i;return this.int16[M+0]=l,this.int16[M+1]=f,this.int16[M+2]=g,this.int16[M+3]=w,this.int16[M+4]=x,this.int16[M+5]=I,i}}J.prototype.bytesPerElement=12,qt("StructArrayLayout2i4i12",J);class ae extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x){const I=this.length;return this.resize(I+1),this.emplace(I,i,l,f,g,w,x)}emplace(i,l,f,g,w,x,I){const M=4*i,F=8*i;return this.int16[M+0]=l,this.int16[M+1]=f,this.uint8[F+4]=g,this.uint8[F+5]=w,this.uint8[F+6]=x,this.uint8[F+7]=I,i}}ae.prototype.bytesPerElement=8,qt("StructArrayLayout2i4ub8",ae);class _e extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.float32[g+0]=l,this.float32[g+1]=f,i}}_e.prototype.bytesPerElement=8,qt("StructArrayLayout2f8",_e);class xe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,M,F,q){const G=this.length;return this.resize(G+1),this.emplace(G,i,l,f,g,w,x,I,M,F,q)}emplace(i,l,f,g,w,x,I,M,F,q,G){const $=10*i;return this.uint16[$+0]=l,this.uint16[$+1]=f,this.uint16[$+2]=g,this.uint16[$+3]=w,this.uint16[$+4]=x,this.uint16[$+5]=I,this.uint16[$+6]=M,this.uint16[$+7]=F,this.uint16[$+8]=q,this.uint16[$+9]=G,i}}xe.prototype.bytesPerElement=20,qt("StructArrayLayout10ui20",xe);class Ee extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,M,F,q,G,$){const re=this.length;return this.resize(re+1),this.emplace(re,i,l,f,g,w,x,I,M,F,q,G,$)}emplace(i,l,f,g,w,x,I,M,F,q,G,$,re){const le=12*i;return this.int16[le+0]=l,this.int16[le+1]=f,this.int16[le+2]=g,this.int16[le+3]=w,this.uint16[le+4]=x,this.uint16[le+5]=I,this.uint16[le+6]=M,this.uint16[le+7]=F,this.int16[le+8]=q,this.int16[le+9]=G,this.int16[le+10]=$,this.int16[le+11]=re,i}}Ee.prototype.bytesPerElement=24,qt("StructArrayLayout4i4ui4i24",Ee);class Oe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=3*i;return this.float32[w+0]=l,this.float32[w+1]=f,this.float32[w+2]=g,i}}Oe.prototype.bytesPerElement=12,qt("StructArrayLayout3f12",Oe);class De extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}De.prototype.bytesPerElement=4,qt("StructArrayLayout1ul4",De);class je extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,M,F){const q=this.length;return this.resize(q+1),this.emplace(q,i,l,f,g,w,x,I,M,F)}emplace(i,l,f,g,w,x,I,M,F,q){const G=10*i,$=5*i;return this.int16[G+0]=l,this.int16[G+1]=f,this.int16[G+2]=g,this.int16[G+3]=w,this.int16[G+4]=x,this.int16[G+5]=I,this.uint32[$+3]=M,this.uint16[G+8]=F,this.uint16[G+9]=q,i}}je.prototype.bytesPerElement=20,qt("StructArrayLayout6i1ul2ui20",je);class Te extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x){const I=this.length;return this.resize(I+1),this.emplace(I,i,l,f,g,w,x)}emplace(i,l,f,g,w,x,I){const M=6*i;return this.int16[M+0]=l,this.int16[M+1]=f,this.int16[M+2]=g,this.int16[M+3]=w,this.int16[M+4]=x,this.int16[M+5]=I,i}}Te.prototype.bytesPerElement=12,qt("StructArrayLayout2i2i2i12",Te);class He extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,f,g,w)}emplace(i,l,f,g,w,x){const I=4*i,M=8*i;return this.float32[I+0]=l,this.float32[I+1]=f,this.float32[I+2]=g,this.int16[M+6]=w,this.int16[M+7]=x,i}}He.prototype.bytesPerElement=16,qt("StructArrayLayout2f1f2i16",He);class Je extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x){const I=this.length;return this.resize(I+1),this.emplace(I,i,l,f,g,w,x)}emplace(i,l,f,g,w,x,I){const M=16*i,F=4*i,q=8*i;return this.uint8[M+0]=l,this.uint8[M+1]=f,this.float32[F+1]=g,this.float32[F+2]=w,this.int16[q+6]=x,this.int16[q+7]=I,i}}Je.prototype.bytesPerElement=16,qt("StructArrayLayout2ub2f2i16",Je);class nt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=3*i;return this.uint16[w+0]=l,this.uint16[w+1]=f,this.uint16[w+2]=g,i}}nt.prototype.bytesPerElement=6,qt("StructArrayLayout3ui6",nt);class bt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,M,F,q,G,$,re,le,ge,Ce,ze){const tt=this.length;return this.resize(tt+1),this.emplace(tt,i,l,f,g,w,x,I,M,F,q,G,$,re,le,ge,Ce,ze)}emplace(i,l,f,g,w,x,I,M,F,q,G,$,re,le,ge,Ce,ze,tt){const Ve=24*i,Ye=12*i,lt=48*i;return this.int16[Ve+0]=l,this.int16[Ve+1]=f,this.uint16[Ve+2]=g,this.uint16[Ve+3]=w,this.uint32[Ye+2]=x,this.uint32[Ye+3]=I,this.uint32[Ye+4]=M,this.uint16[Ve+10]=F,this.uint16[Ve+11]=q,this.uint16[Ve+12]=G,this.float32[Ye+7]=$,this.float32[Ye+8]=re,this.uint8[lt+36]=le,this.uint8[lt+37]=ge,this.uint8[lt+38]=Ce,this.uint32[Ye+10]=ze,this.int16[Ve+22]=tt,i}}bt.prototype.bytesPerElement=48,qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",bt);class Ct extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g,w,x,I,M,F,q,G,$,re,le,ge,Ce,ze,tt,Ve,Ye,lt,xt,Bt,hi,Ft,Ot,ei,Gt){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,i,l,f,g,w,x,I,M,F,q,G,$,re,le,ge,Ce,ze,tt,Ve,Ye,lt,xt,Bt,hi,Ft,Ot,ei,Gt)}emplace(i,l,f,g,w,x,I,M,F,q,G,$,re,le,ge,Ce,ze,tt,Ve,Ye,lt,xt,Bt,hi,Ft,Ot,ei,Gt,Vt){const gt=32*i,ti=16*i;return this.int16[gt+0]=l,this.int16[gt+1]=f,this.int16[gt+2]=g,this.int16[gt+3]=w,this.int16[gt+4]=x,this.int16[gt+5]=I,this.int16[gt+6]=M,this.int16[gt+7]=F,this.uint16[gt+8]=q,this.uint16[gt+9]=G,this.uint16[gt+10]=$,this.uint16[gt+11]=re,this.uint16[gt+12]=le,this.uint16[gt+13]=ge,this.uint16[gt+14]=Ce,this.uint16[gt+15]=ze,this.uint16[gt+16]=tt,this.uint16[gt+17]=Ve,this.uint16[gt+18]=Ye,this.uint16[gt+19]=lt,this.uint16[gt+20]=xt,this.uint16[gt+21]=Bt,this.uint16[gt+22]=hi,this.uint32[ti+12]=Ft,this.float32[ti+13]=Ot,this.float32[ti+14]=ei,this.uint16[gt+30]=Gt,this.uint16[gt+31]=Vt,i}}Ct.prototype.bytesPerElement=64,qt("StructArrayLayout8i15ui1ul2f2ui64",Ct);class Dt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Dt.prototype.bytesPerElement=4,qt("StructArrayLayout1f4",Dt);class Nt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=3*i;return this.uint16[6*i+0]=l,this.float32[w+1]=f,this.float32[w+2]=g,i}}Nt.prototype.bytesPerElement=12,qt("StructArrayLayout1ui2f12",Nt);class Lt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const w=4*i;return this.uint32[2*i+0]=l,this.uint16[w+2]=f,this.uint16[w+3]=g,i}}Lt.prototype.bytesPerElement=8,qt("StructArrayLayout1ul2ui8",Lt);class Mt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.uint16[g+0]=l,this.uint16[g+1]=f,i}}Mt.prototype.bytesPerElement=4,qt("StructArrayLayout2ui4",Mt);class Jt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}Jt.prototype.bytesPerElement=2,qt("StructArrayLayout1ui2",Jt);class xi extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,g)}emplace(i,l,f,g,w){const x=4*i;return this.float32[x+0]=l,this.float32[x+1]=f,this.float32[x+2]=g,this.float32[x+3]=w,i}}xi.prototype.bytesPerElement=16,qt("StructArrayLayout4f16",xi);class zt extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}zt.prototype.size=20;class Rt extends je{get(i){return new zt(this,i)}}qt("CollisionBoxArray",Rt);class yi extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}yi.prototype.size=48;class gn extends bt{get(i){return new yi(this,i)}}qt("PlacedSymbolArray",gn);class Ai extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ai.prototype.size=64;class ji extends Ct{get(i){return new Ai(this,i)}}qt("SymbolInstanceArray",ji);class _n extends Dt{getoffsetX(i){return this.float32[1*i+0]}}qt("GlyphOffsetArray",_n);class sr extends Z{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}qt("SymbolLineVertexArray",sr);class _s extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}_s.prototype.size=12;class yn extends Nt{get(i){return new _s(this,i)}}qt("TextAnchorOffsetArray",yn);class zr extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}zr.prototype.size=8;class xr extends Lt{get(i){return new zr(this,i)}}qt("FeatureIndexArray",xr);class or extends O{}class kr extends O{}class Bs extends O{}class Ua extends J{}class yc extends ae{}class Va extends _e{}class ls extends xe{}class bc extends Ee{}class Mu extends Oe{}class cs extends De{}class us extends Te{}class Eo extends Je{}class ys extends nt{}class tr extends Mt{}const ar=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xr}=ar;class Vi{constructor(i=[]){this.segments=i}prepareSegment(i,l,f,g){let w=this.segments[this.segments.length-1];return i>Vi.MAX_VERTEX_ARRAY_LENGTH&&ce(`Max vertices per segment is ${Vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!w||w.vertexLength+i>Vi.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:l.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,f,g){return new Vi([{vertexOffset:i,primitiveOffset:l,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function sa(s,i){return 256*(s=oe(Math.floor(s),0,255))+oe(Math.floor(i),0,255)}Vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt("SegmentVector",Vi);const qa=A([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Za={exports:{}},Mh={exports:{}};Mh.exports=function(s,i){var l,f,g,w,x,I,M,F;for(f=s.length-(l=3&s.length),g=i,x=3432918353,I=461845907,F=0;F<f;)M=255&s.charCodeAt(F)|(255&s.charCodeAt(++F))<<8|(255&s.charCodeAt(++F))<<16|(255&s.charCodeAt(++F))<<24,++F,g=27492+(65535&(w=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*I+(((M>>>16)*I&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&s.charCodeAt(F+2))<<16;case 2:M^=(255&s.charCodeAt(F+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&s.charCodeAt(F)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*I+(((M>>>16)*I&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Ff=Mh.exports,Ph={exports:{}};Ph.exports=function(s,i){for(var l,f=s.length,g=i^f,w=0;f>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:g^=(255&s.charCodeAt(w+2))<<16;case 2:g^=(255&s.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Io=Ff,Lh=Ph.exports;Za.exports=Io,Za.exports.murmur3=Io,Za.exports.murmur2=Lh;var vc=_(Za.exports);class Tl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,f,g){this.ids.push(wc(i)),this.positions.push(l,f,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=wc(i);let f=0,g=this.ids.length-1;for(;f<g;){const x=f+g>>1;this.ids[x]>=l?g=x:f=x+1}const w=[];for(;this.ids[f]===l;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(i,l){const f=new Float64Array(i.ids),g=new Uint32Array(i.positions);return xc(f,g,0,f.length-1),l&&l.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(i){const l=new Tl;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function wc(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:vc(String(s))}function xc(s,i,l,f){for(;l<f;){const g=s[l+f>>1];let w=l-1,x=f+1;for(;;){do w++;while(s[w]<g);do x--;while(s[x]>g);if(w>=x)break;Wa(s,w,x),Wa(i,3*w,3*x),Wa(i,3*w+1,3*x+1),Wa(i,3*w+2,3*x+2)}x-l<f-x?(xc(s,i,l,x),l=x+1):(xc(s,i,x+1,f),f=x)}}function Wa(s,i,l){const f=s[i];s[i]=s[l],s[l]=f}qt("FeaturePositionMap",Tl);class Cl{constructor(i,l){this.gl=i.gl,this.location=l}}class zh extends Cl{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ip extends Cl{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Ap extends Cl{constructor(i,l){super(i,l),this.current=si.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Sb=new Float32Array(16);function Rf(s){return[sa(255*s.r,255*s.g),sa(255*s.b,255*s.a)]}class Pu{constructor(i,l,f){this.value=i,this.uniformNames=l.map(g=>`u_${g}`),this.type=f}setUniform(i,l,f){i.set(f.constantOr(this.value))}getBinding(i,l,f){return this.type==="color"?new Ap(i,l):new zh(i,l)}}class kc{constructor(i,l){this.uniformNames=l.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,f,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&i.set(w)}getBinding(i,l,f){return f.substr(0,9)==="u_pattern"?new Ip(i,l):new zh(i,l)}}class oa{constructor(i,l,f,g){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,l,f,g,w){const x=this.paintVertexArray.length,I=this.expression.evaluate(new mn(0),l,{},g,[],w);this.paintVertexArray.resize(i),this._setPaintValue(x,i,I)}updatePaintArray(i,l,f,g){const w=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(i,l,w)}_setPaintValue(i,l,f){if(this.type==="color"){const g=Rf(f);for(let w=i;w<l;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ao{constructor(i,l,f,g,w,x){this.expression=i,this.uniformNames=l.map(I=>`u_${I}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=l.map(I=>({name:`a_${I}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,l,f,g,w){const x=this.expression.evaluate(new mn(this.zoom),l,{},g,[],w),I=this.expression.evaluate(new mn(this.zoom+1),l,{},g,[],w),M=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(M,i,x,I)}updatePaintArray(i,l,f,g){const w=this.expression.evaluate({zoom:this.zoom},f,g),x=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(i,l,w,x)}_setPaintValue(i,l,f,g){if(this.type==="color"){const w=Rf(f),x=Rf(g);for(let I=i;I<l;I++)this.paintVertexArray.emplace(I,w[0],w[1],x[0],x[1])}else{for(let w=i;w<l;w++)this.paintVertexArray.emplace(w,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=oe(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,l,f){return new zh(i,l)}}class Ga{constructor(i,l,f,g,w,x){this.expression=i,this.type=l,this.useIntegerZoom=f,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(i,l,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,l.patterns&&l.patterns[this.layerId],f)}updatePaintArray(i,l,f,g,w){this._setPaintValues(i,l,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(i,l,f,g){if(!g||!f)return;const{min:w,mid:x,max:I}=f,M=g[w],F=g[x],q=g[I];if(M&&F&&q)for(let G=i;G<l;G++)this.zoomInPaintVertexArray.emplace(G,F.tl[0],F.tl[1],F.br[0],F.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],F.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,F.tl[0],F.tl[1],F.br[0],F.br[1],q.tl[0],q.tl[1],q.br[0],q.br[1],F.pixelRatio,q.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,qa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,qa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Mp{constructor(i,l,f){this.binders={},this._buffers=[];const g=[];for(const w in i.paint._values){if(!f(w))continue;const x=i.paint.get(w);if(!(x instanceof Rs&&wo(x.property.specification)))continue;const I=Tb(w,i.type),M=x.value,F=x.property.specification.type,q=x.property.useIntegerZoom,G=x.property.specification["property-type"],$=G==="cross-faded"||G==="cross-faded-data-driven";if(M.kind==="constant")this.binders[w]=$?new kc(M.value,I):new Pu(M.value,I,F),g.push(`/u_${w}`);else if(M.kind==="source"||$){const re=Pp(w,F,"source");this.binders[w]=$?new Ga(M,F,q,l,re,i.id):new oa(M,I,F,re),g.push(`/a_${w}`)}else{const re=Pp(w,F,"composite");this.binders[w]=new ao(M,I,F,q,l,re),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof oa||l instanceof ao?l.maxValue:0}populatePaintArrays(i,l,f,g,w){for(const x in this.binders){const I=this.binders[x];(I instanceof oa||I instanceof ao||I instanceof Ga)&&I.populatePaintArray(i,l,f,g,w)}}setConstantPatternPositions(i,l){for(const f in this.binders){const g=this.binders[f];g instanceof kc&&g.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,f,g,w){let x=!1;for(const I in i){const M=l.getPositions(I);for(const F of M){const q=f.feature(F.index);for(const G in this.binders){const $=this.binders[G];if(($ instanceof oa||$ instanceof ao||$ instanceof Ga)&&$.expression.isStateDependent===!0){const re=g.paint.get(G);$.expression=re.value,$.updatePaintArray(F.start,F.end,q,i[I],w),x=!0}}}}return x}defines(){const i=[];for(const l in this.binders){const f=this.binders[l];(f instanceof Pu||f instanceof kc)&&i.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof oa||f instanceof ao)for(let g=0;g<f.paintVertexAttributes.length;g++)i.push(f.paintVertexAttributes[g].name);else if(f instanceof Ga)for(let g=0;g<qa.members.length;g++)i.push(qa.members[g].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof Pu||f instanceof kc||f instanceof ao)for(const g of f.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const f=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof Pu||w instanceof kc||w instanceof ao){for(const x of w.uniformNames)if(l[x]){const I=w.getBinding(i,l[x],x);f.push({name:x,property:g,binding:I})}}}return f}setUniforms(i,l,f,g){for(const{name:w,property:x,binding:I}of l)this.binders[x].setUniform(I,g,f.get(x),w)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const f=this.binders[l];if(i&&f instanceof Ga){const g=i.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof oa||f instanceof ao)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const l in this.binders){const f=this.binders[l];(f instanceof oa||f instanceof ao||f instanceof Ga)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof oa||l instanceof ao||l instanceof Ga)&&l.destroy()}}}class El{constructor(i,l,f=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new Mp(g,l,f);this.needsUpload=!1,this._featureMap=new Tl,this._bufferOffset=0}populatePaintArrays(i,l,f,g,w,x){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(i,l,g,w,x);l.id!==void 0&&this._featureMap.add(l.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,f,g){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(i,this._featureMap,l,w,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Tb(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Pp(s,i,l){const f={color:{source:_e,composite:xi},number:{source:Dt,composite:_e}},g=function(w){return{"line-pattern":{source:ls,composite:ls},"fill-pattern":{source:ls,composite:ls},"fill-extrusion-pattern":{source:ls,composite:ls}}[w]}(s);return g&&g[l]||f[i][l]}qt("ConstantBinder",Pu),qt("CrossFadedConstantBinder",kc),qt("SourceExpressionBinder",oa),qt("CrossFadedCompositeBinder",Ga),qt("CompositeExpressionBinder",ao),qt("ProgramConfiguration",Mp,{omit:["_buffers"]}),qt("ProgramConfigurationSet",El);const Nn=8192,Bf=Math.pow(2,14)-1,Lp=-Bf-1;function Il(s){const i=Nn/s.extent,l=s.loadGeometry();for(let f=0;f<l.length;f++){const g=l[f];for(let w=0;w<g.length;w++){const x=g[w],I=Math.round(x.x*i),M=Math.round(x.y*i);x.x=oe(I,Lp,Bf),x.y=oe(M,Lp,Bf),(I<x.x||I>x.x+1||M<x.y||M>x.y+1)&&ce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Al(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?Il(s):[]}}function Oh(s,i,l,f,g){s.emplaceBack(2*i+(f+1)/2,2*l+(g+1)/2)}class Nf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new kr,this.indexArray=new ys,this.segments=new Vi,this.programConfigurations=new El(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){const g=this.layers[0],w=[];let x=null,I=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),I=!x.isConstant());for(const{feature:M,id:F,index:q,sourceLayerIndex:G}of i){const $=this.layers[0]._featureFilter.needGeometry,re=Al(M,$);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),re,f))continue;const le=I?x.evaluate(re,{},f):void 0,ge={id:F,properties:M.properties,type:M.type,sourceLayerIndex:G,index:q,geometry:$?re.geometry:Il(M),patterns:{},sortKey:le};w.push(ge)}I&&w.sort((M,F)=>M.sortKey-F.sortKey);for(const M of w){const{geometry:F,index:q,sourceLayerIndex:G}=M,$=i[q].feature;this.addFeature(M,F,q,f),l.featureIndex.insert($,F,q,G,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Xr),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,f,g){for(const w of l)for(const x of w){const I=x.x,M=x.y;if(I<0||I>=Nn||M<0||M>=Nn)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),q=F.vertexLength;Oh(this.layoutVertexArray,I,M,-1,-1),Oh(this.layoutVertexArray,I,M,1,-1),Oh(this.layoutVertexArray,I,M,1,1),Oh(this.layoutVertexArray,I,M,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},g)}}function zp(s,i){for(let l=0;l<s.length;l++)if(Sc(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(Sc(s,i[l]))return!0;return!!jf(s,i)}function Cb(s,i,l){return!!Sc(s,i)||!!Uf(i,s,l)}function Op(s,i){if(s.length===1)return Fp(i,s[0]);for(let l=0;l<i.length;l++){const f=i[l];for(let g=0;g<f.length;g++)if(Sc(s,f[g]))return!0}for(let l=0;l<s.length;l++)if(Fp(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(jf(s,i[l]))return!0;return!1}function Eb(s,i,l){if(s.length>1){if(jf(s,i))return!0;for(let f=0;f<i.length;f++)if(Uf(i[f],s,l))return!0}for(let f=0;f<s.length;f++)if(Uf(s[f],i,l))return!0;return!1}function jf(s,i){if(s.length===0||i.length===0)return!1;for(let l=0;l<s.length-1;l++){const f=s[l],g=s[l+1];for(let w=0;w<i.length-1;w++)if(Ib(f,g,i[w],i[w+1]))return!0}return!1}function Ib(s,i,l,f){return pe(s,l,f)!==pe(i,l,f)&&pe(s,i,l)!==pe(s,i,f)}function Uf(s,i,l){const f=l*l;if(i.length===1)return s.distSqr(i[0])<f;for(let g=1;g<i.length;g++)if(Dp(s,i[g-1],i[g])<f)return!0;return!1}function Dp(s,i,l){const f=i.distSqr(l);if(f===0)return s.distSqr(i);const g=((s.x-i.x)*(l.x-i.x)+(s.y-i.y)*(l.y-i.y))/f;return s.distSqr(g<0?i:g>1?l:l.sub(i)._mult(g)._add(i))}function Fp(s,i){let l,f,g,w=!1;for(let x=0;x<s.length;x++){l=s[x];for(let I=0,M=l.length-1;I<l.length;M=I++)f=l[I],g=l[M],f.y>i.y!=g.y>i.y&&i.x<(g.x-f.x)*(i.y-f.y)/(g.y-f.y)+f.x&&(w=!w)}return w}function Sc(s,i){let l=!1;for(let f=0,g=s.length-1;f<s.length;g=f++){const w=s[f],x=s[g];w.y>i.y!=x.y>i.y&&i.x<(x.x-w.x)*(i.y-w.y)/(x.y-w.y)+w.x&&(l=!l)}return l}function Ab(s,i,l){const f=l[0],g=l[2];if(s.x<f.x&&i.x<f.x||s.x>g.x&&i.x>g.x||s.y<f.y&&i.y<f.y||s.y>g.y&&i.y>g.y)return!1;const w=pe(s,i,l[0]);return w!==pe(s,i,l[1])||w!==pe(s,i,l[2])||w!==pe(s,i,l[3])}function Lu(s,i,l){const f=i.paint.get(s).value;return f.kind==="constant"?f.value:l.programConfigurations.get(i.id).getMaxValue(s)}function Dh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Fh(s,i,l,f,g){if(!i[0]&&!i[1])return s;const w=y.convert(i)._mult(g);l==="viewport"&&w._rotate(-f);const x=[];for(let I=0;I<s.length;I++)x.push(s[I].sub(w));return x}let Rp,Bp;qt("CircleBucket",Nf,{omit:["layers"]});var Mb={get paint(){return Bp=Bp||new v({"circle-radius":new fi(Qe.paint_circle["circle-radius"]),"circle-color":new fi(Qe.paint_circle["circle-color"]),"circle-blur":new fi(Qe.paint_circle["circle-blur"]),"circle-opacity":new fi(Qe.paint_circle["circle-opacity"]),"circle-translate":new Kt(Qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Kt(Qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Kt(Qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Kt(Qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fi(Qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fi(Qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fi(Qe.paint_circle["circle-stroke-opacity"])})},get layout(){return Rp=Rp||new v({"circle-sort-key":new fi(Qe.layout_circle["circle-sort-key"])})}},Or=1e-6,Tc=typeof Float32Array<"u"?Float32Array:Array;function Vf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Np(s,i,l){var f=i[0],g=i[1],w=i[2],x=i[3],I=i[4],M=i[5],F=i[6],q=i[7],G=i[8],$=i[9],re=i[10],le=i[11],ge=i[12],Ce=i[13],ze=i[14],tt=i[15],Ve=l[0],Ye=l[1],lt=l[2],xt=l[3];return s[0]=Ve*f+Ye*I+lt*G+xt*ge,s[1]=Ve*g+Ye*M+lt*$+xt*Ce,s[2]=Ve*w+Ye*F+lt*re+xt*ze,s[3]=Ve*x+Ye*q+lt*le+xt*tt,s[4]=(Ve=l[4])*f+(Ye=l[5])*I+(lt=l[6])*G+(xt=l[7])*ge,s[5]=Ve*g+Ye*M+lt*$+xt*Ce,s[6]=Ve*w+Ye*F+lt*re+xt*ze,s[7]=Ve*x+Ye*q+lt*le+xt*tt,s[8]=(Ve=l[8])*f+(Ye=l[9])*I+(lt=l[10])*G+(xt=l[11])*ge,s[9]=Ve*g+Ye*M+lt*$+xt*Ce,s[10]=Ve*w+Ye*F+lt*re+xt*ze,s[11]=Ve*x+Ye*q+lt*le+xt*tt,s[12]=(Ve=l[12])*f+(Ye=l[13])*I+(lt=l[14])*G+(xt=l[15])*ge,s[13]=Ve*g+Ye*M+lt*$+xt*Ce,s[14]=Ve*w+Ye*F+lt*re+xt*ze,s[15]=Ve*x+Ye*q+lt*le+xt*tt,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var zu,Pb=Np;function Rh(s,i,l){var f=i[0],g=i[1],w=i[2],x=i[3];return s[0]=l[0]*f+l[4]*g+l[8]*w+l[12]*x,s[1]=l[1]*f+l[5]*g+l[9]*w+l[13]*x,s[2]=l[2]*f+l[6]*g+l[10]*w+l[14]*x,s[3]=l[3]*f+l[7]*g+l[11]*w+l[15]*x,s}zu=new Tc(4),Tc!=Float32Array&&(zu[0]=0,zu[1]=0,zu[2]=0,zu[3]=0);class Lb extends u{constructor(i){super(i,Mb)}createBucket(i){return new Nf(i)}queryRadius(i){const l=i;return Lu("circle-radius",this,l)+Lu("circle-stroke-width",this,l)+Dh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,l,f,g,w,x,I,M){const F=Fh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,I),q=this.paint.get("circle-radius").evaluate(l,f)+this.paint.get("circle-stroke-width").evaluate(l,f),G=this.paint.get("circle-pitch-alignment")==="map",$=G?F:function(le,ge){return le.map(Ce=>jp(Ce,ge))}(F,M),re=G?q*I:q;for(const le of g)for(const ge of le){const Ce=G?ge:jp(ge,M);let ze=re;const tt=Rh([],[ge.x,ge.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ze*=tt[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ze*=x.cameraToCenterDistance/tt[3]),Cb($,Ce,ze))return!0}return!1}}function jp(s,i){const l=Rh([],[s.x,s.y,0,1],i);return new y(l[0]/l[3],l[1]/l[3])}class Up extends Nf{}let Vp;qt("HeatmapBucket",Up,{omit:["layers"]});var zb={get paint(){return Vp=Vp||new v({"heatmap-radius":new fi(Qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fi(Qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Kt(Qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Au(Qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Kt(Qe.paint_heatmap["heatmap-opacity"])})}};function qf(s,{width:i,height:l},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*l*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*l*f}`)}else g=new Uint8Array(i*l*f);return s.width=i,s.height=l,s.data=g,s}function qp(s,{width:i,height:l},f){if(i===s.width&&l===s.height)return;const g=qf({},{width:i,height:l},f);Zf(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,l)},f),s.width=i,s.height=l,s.data=g.data}function Zf(s,i,l,f,g,w){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||l.x>s.width-g.width||l.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||f.x>i.width-g.width||f.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,I=i.data;if(x===I)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<g.height;M++){const F=((l.y+M)*s.width+l.x)*w,q=((f.y+M)*i.width+f.x)*w;for(let G=0;G<g.width*w;G++)I[q+G]=x[F+G]}return i}class Ou{constructor(i,l){qf(this,i,1,l)}resize(i){qp(this,i,1)}clone(){return new Ou({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,f,g,w){Zf(i,l,f,g,w,1)}}class bs{constructor(i,l){qf(this,i,4,l)}resize(i){qp(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new bs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,f,g,w){Zf(i,l,f,g,w,4)}}function Zp(s){const i={},l=s.resolution||256,f=s.clips?s.clips.length:1,g=s.image||new bs({width:l,height:f});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const w=(x,I,M)=>{i[s.evaluationKey]=M;const F=s.expression.evaluate(i);g.data[x+I+0]=Math.floor(255*F.r/F.a),g.data[x+I+1]=Math.floor(255*F.g/F.a),g.data[x+I+2]=Math.floor(255*F.b/F.a),g.data[x+I+3]=Math.floor(255*F.a)};if(s.clips)for(let x=0,I=0;x<f;++x,I+=4*l)for(let M=0,F=0;M<l;M++,F+=4){const q=M/(l-1),{start:G,end:$}=s.clips[x];w(I,F,G*(1-q)+$*q)}else for(let x=0,I=0;x<l;x++,I+=4)w(0,I,x/(l-1));return g}qt("AlphaImage",Ou),qt("RGBAImage",bs);const Wf="big-fb";class Ob extends u{createBucket(i){return new Up(i)}constructor(i){super(i,zb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Wf)&&this.heatmapFbos.delete(Wf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Wp;var Db={get paint(){return Wp=Wp||new v({"hillshade-illumination-direction":new Kt(Qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Kt(Qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Kt(Qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Kt(Qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Kt(Qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Kt(Qe.paint_hillshade["hillshade-accent-color"])})}};class Fb extends u{constructor(i){super(i,Db)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Rb=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bb}=Rb;function Gp(s,i,l=2){const f=i&&i.length,g=f?i[0]*l:s.length;let w=Hp(s,0,g,l,!0);const x=[];if(!w||w.next===w.prev)return x;let I,M,F;if(f&&(w=function(q,G,$,re){const le=[];for(let ge=0,Ce=G.length;ge<Ce;ge++){const ze=Hp(q,G[ge]*re,ge<Ce-1?G[ge+1]*re:q.length,re,!1);ze===ze.next&&(ze.steiner=!0),le.push(Gb(ze))}le.sort(qb);for(let ge=0;ge<le.length;ge++)$=Zb(le[ge],$);return $}(s,i,w,l)),s.length>80*l){I=1/0,M=1/0;let q=-1/0,G=-1/0;for(let $=l;$<g;$+=l){const re=s[$],le=s[$+1];re<I&&(I=re),le<M&&(M=le),re>q&&(q=re),le>G&&(G=le)}F=Math.max(q-I,G-M),F=F!==0?32767/F:0}return Du(w,x,l,I,M,F,0),x}function Hp(s,i,l,f,g){let w;if(g===function(x,I,M,F){let q=0;for(let G=I,$=M-F;G<M;G+=F)q+=(x[$]-x[G])*(x[G+1]+x[$+1]),$=G;return q}(s,i,l,f)>0)for(let x=i;x<l;x+=f)w=Jp(x/f|0,s[x],s[x+1],w);else for(let x=l-f;x>=i;x-=f)w=Jp(x/f|0,s[x],s[x+1],w);return w&&Bh(w,w.next)&&(Ru(w),w=w.next),w}function Ml(s,i){if(!s)return s;i||(i=s);let l,f=s;do if(l=!1,f.steiner||!Bh(f,f.next)&&Dn(f.prev,f,f.next)!==0)f=f.next;else{if(Ru(f),f=i=f.prev,f===f.next)break;l=!0}while(l||f!==i);return i}function Du(s,i,l,f,g,w,x){if(!s)return;!x&&w&&function(M,F,q,G){let $=M;do $.z===0&&($.z=Gf($.x,$.y,F,q,G)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==M);$.prevZ.nextZ=null,$.prevZ=null,function(re){let le,ge=1;do{let Ce,ze=re;re=null;let tt=null;for(le=0;ze;){le++;let Ve=ze,Ye=0;for(let xt=0;xt<ge&&(Ye++,Ve=Ve.nextZ,Ve);xt++);let lt=ge;for(;Ye>0||lt>0&&Ve;)Ye!==0&&(lt===0||!Ve||ze.z<=Ve.z)?(Ce=ze,ze=ze.nextZ,Ye--):(Ce=Ve,Ve=Ve.nextZ,lt--),tt?tt.nextZ=Ce:re=Ce,Ce.prevZ=tt,tt=Ce;ze=Ve}tt.nextZ=null,ge*=2}while(le>1)}($)}(s,f,g,w);let I=s;for(;s.prev!==s.next;){const M=s.prev,F=s.next;if(w?jb(s,f,g,w):Nb(s))i.push(M.i,s.i,F.i),Ru(s),s=F.next,I=F.next;else if((s=F)===I){x?x===1?Du(s=Ub(Ml(s),i),i,l,f,g,w,2):x===2&&Vb(s,i,l,f,g,w):Du(Ml(s),i,l,f,g,w,1);break}}}function Nb(s){const i=s.prev,l=s,f=s.next;if(Dn(i,l,f)>=0)return!1;const g=i.x,w=l.x,x=f.x,I=i.y,M=l.y,F=f.y,q=g<w?g<x?g:x:w<x?w:x,G=I<M?I<F?I:F:M<F?M:F,$=g>w?g>x?g:x:w>x?w:x,re=I>M?I>F?I:F:M>F?M:F;let le=f.next;for(;le!==i;){if(le.x>=q&&le.x<=$&&le.y>=G&&le.y<=re&&Cc(g,I,w,M,x,F,le.x,le.y)&&Dn(le.prev,le,le.next)>=0)return!1;le=le.next}return!0}function jb(s,i,l,f){const g=s.prev,w=s,x=s.next;if(Dn(g,w,x)>=0)return!1;const I=g.x,M=w.x,F=x.x,q=g.y,G=w.y,$=x.y,re=I<M?I<F?I:F:M<F?M:F,le=q<G?q<$?q:$:G<$?G:$,ge=I>M?I>F?I:F:M>F?M:F,Ce=q>G?q>$?q:$:G>$?G:$,ze=Gf(re,le,i,l,f),tt=Gf(ge,Ce,i,l,f);let Ve=s.prevZ,Ye=s.nextZ;for(;Ve&&Ve.z>=ze&&Ye&&Ye.z<=tt;){if(Ve.x>=re&&Ve.x<=ge&&Ve.y>=le&&Ve.y<=Ce&&Ve!==g&&Ve!==x&&Cc(I,q,M,G,F,$,Ve.x,Ve.y)&&Dn(Ve.prev,Ve,Ve.next)>=0||(Ve=Ve.prevZ,Ye.x>=re&&Ye.x<=ge&&Ye.y>=le&&Ye.y<=Ce&&Ye!==g&&Ye!==x&&Cc(I,q,M,G,F,$,Ye.x,Ye.y)&&Dn(Ye.prev,Ye,Ye.next)>=0))return!1;Ye=Ye.nextZ}for(;Ve&&Ve.z>=ze;){if(Ve.x>=re&&Ve.x<=ge&&Ve.y>=le&&Ve.y<=Ce&&Ve!==g&&Ve!==x&&Cc(I,q,M,G,F,$,Ve.x,Ve.y)&&Dn(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.prevZ}for(;Ye&&Ye.z<=tt;){if(Ye.x>=re&&Ye.x<=ge&&Ye.y>=le&&Ye.y<=Ce&&Ye!==g&&Ye!==x&&Cc(I,q,M,G,F,$,Ye.x,Ye.y)&&Dn(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.nextZ}return!0}function Ub(s,i){let l=s;do{const f=l.prev,g=l.next.next;!Bh(f,g)&&Xp(f,l,l.next,g)&&Fu(f,g)&&Fu(g,f)&&(i.push(f.i,l.i,g.i),Ru(l),Ru(l.next),l=s=g),l=l.next}while(l!==s);return Ml(l)}function Vb(s,i,l,f,g,w){let x=s;do{let I=x.next.next;for(;I!==x.prev;){if(x.i!==I.i&&Hb(x,I)){let M=Kp(x,I);return x=Ml(x,x.next),M=Ml(M,M.next),Du(x,i,l,f,g,w,0),void Du(M,i,l,f,g,w,0)}I=I.next}x=x.next}while(x!==s)}function qb(s,i){return s.x-i.x}function Zb(s,i){const l=function(g,w){let x=w;const I=g.x,M=g.y;let F,q=-1/0;do{if(M<=x.y&&M>=x.next.y&&x.next.y!==x.y){const ge=x.x+(M-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(ge<=I&&ge>q&&(q=ge,F=x.x<x.next.x?x:x.next,ge===I))return F}x=x.next}while(x!==w);if(!F)return null;const G=F,$=F.x,re=F.y;let le=1/0;x=F;do{if(I>=x.x&&x.x>=$&&I!==x.x&&Cc(M<re?I:q,M,$,re,M<re?q:I,M,x.x,x.y)){const ge=Math.abs(M-x.y)/(I-x.x);Fu(x,g)&&(ge<le||ge===le&&(x.x>F.x||x.x===F.x&&Wb(F,x)))&&(F=x,le=ge)}x=x.next}while(x!==G);return F}(s,i);if(!l)return i;const f=Kp(l,s);return Ml(f,f.next),Ml(l,l.next)}function Wb(s,i){return Dn(s.prev,s,i.prev)<0&&Dn(i.next,s,s.next)<0}function Gf(s,i,l,f,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Gb(s){let i=s,l=s;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==s);return l}function Cc(s,i,l,f,g,w,x,I){return(g-x)*(i-I)>=(s-x)*(w-I)&&(s-x)*(f-I)>=(l-x)*(i-I)&&(l-x)*(w-I)>=(g-x)*(f-I)}function Hb(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(l,f){let g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==f.i&&g.next.i!==f.i&&Xp(g,g.next,l,f))return!0;g=g.next}while(g!==l);return!1}(s,i)&&(Fu(s,i)&&Fu(i,s)&&function(l,f){let g=l,w=!1;const x=(l.x+f.x)/2,I=(l.y+f.y)/2;do g.y>I!=g.next.y>I&&g.next.y!==g.y&&x<(g.next.x-g.x)*(I-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==l);return w}(s,i)&&(Dn(s.prev,s,i.prev)||Dn(s,i.prev,i))||Bh(s,i)&&Dn(s.prev,s,s.next)>0&&Dn(i.prev,i,i.next)>0)}function Dn(s,i,l){return(i.y-s.y)*(l.x-i.x)-(i.x-s.x)*(l.y-i.y)}function Bh(s,i){return s.x===i.x&&s.y===i.y}function Xp(s,i,l,f){const g=jh(Dn(s,i,l)),w=jh(Dn(s,i,f)),x=jh(Dn(l,f,s)),I=jh(Dn(l,f,i));return g!==w&&x!==I||!(g!==0||!Nh(s,l,i))||!(w!==0||!Nh(s,f,i))||!(x!==0||!Nh(l,s,f))||!(I!==0||!Nh(l,i,f))}function Nh(s,i,l){return i.x<=Math.max(s.x,l.x)&&i.x>=Math.min(s.x,l.x)&&i.y<=Math.max(s.y,l.y)&&i.y>=Math.min(s.y,l.y)}function jh(s){return s>0?1:s<0?-1:0}function Fu(s,i){return Dn(s.prev,s,s.next)<0?Dn(s,i,s.next)>=0&&Dn(s,s.prev,i)>=0:Dn(s,i,s.prev)<0||Dn(s,s.next,i)<0}function Kp(s,i){const l=Hf(s.i,s.x,s.y),f=Hf(i.i,i.x,i.y),g=s.next,w=i.prev;return s.next=i,i.prev=s,l.next=g,g.prev=l,f.next=l,l.prev=f,w.next=f,f.prev=w,f}function Jp(s,i,l,f){const g=Hf(s,i,l);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Ru(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Hf(s,i,l){return{i:s,x:i,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Xf(s,i,l){const f=l.patternDependencies;let g=!1;for(const w of i){const x=w.paint.get(`${s}-pattern`);x.isConstant()||(g=!0);const I=x.constantOr(null);I&&(g=!0,f[I.to]=!0,f[I.from]=!0)}return g}function Kf(s,i,l,f,g){const w=g.patternDependencies;for(const x of i){const I=x.paint.get(`${s}-pattern`).value;if(I.kind!=="constant"){let M=I.evaluate({zoom:f-1},l,{},g.availableImages),F=I.evaluate({zoom:f},l,{},g.availableImages),q=I.evaluate({zoom:f+1},l,{},g.availableImages);M=M&&M.name?M.name:M,F=F&&F.name?F.name:F,q=q&&q.name?q.name:q,w[M]=!0,w[F]=!0,w[q]=!0,l.patterns[x.id]={min:M,mid:F,max:q}}}return l}class Jf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bs,this.indexArray=new ys,this.indexArray2=new tr,this.programConfigurations=new El(i.layers,i.zoom),this.segments=new Vi,this.segments2=new Vi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.hasPattern=Xf("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),x=[];for(const{feature:I,id:M,index:F,sourceLayerIndex:q}of i){const G=this.layers[0]._featureFilter.needGeometry,$=Al(I,G);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),$,f))continue;const re=w?g.evaluate($,{},f,l.availableImages):void 0,le={id:M,properties:I.properties,type:I.type,sourceLayerIndex:q,index:F,geometry:G?$.geometry:Il(I),patterns:{},sortKey:re};x.push(le)}w&&x.sort((I,M)=>I.sortKey-M.sortKey);for(const I of x){const{geometry:M,index:F,sourceLayerIndex:q}=I;if(this.hasPattern){const G=Kf("fill",this.layers,I,this.zoom,l);this.patternFeatures.push(G)}else this.addFeature(I,M,F,f,{});l.featureIndex.insert(i[F].feature,M,F,q,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}addFeatures(i,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Bb),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,f,g,w){for(const x of Ca(l,500)){let I=0;for(const re of x)I+=re.length;const M=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),F=M.vertexLength,q=[],G=[];for(const re of x){if(re.length===0)continue;re!==x[0]&&G.push(q.length/2);const le=this.segments2.prepareSegment(re.length,this.layoutVertexArray,this.indexArray2),ge=le.vertexLength;this.layoutVertexArray.emplaceBack(re[0].x,re[0].y),this.indexArray2.emplaceBack(ge+re.length-1,ge),q.push(re[0].x),q.push(re[0].y);for(let Ce=1;Ce<re.length;Ce++)this.layoutVertexArray.emplaceBack(re[Ce].x,re[Ce].y),this.indexArray2.emplaceBack(ge+Ce-1,ge+Ce),q.push(re[Ce].x),q.push(re[Ce].y);le.vertexLength+=re.length,le.primitiveLength+=re.length}const $=Gp(q,G);for(let re=0;re<$.length;re+=3)this.indexArray.emplaceBack(F+$[re],F+$[re+1],F+$[re+2]);M.vertexLength+=I,M.primitiveLength+=$.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,g)}}let Yp,Qp;qt("FillBucket",Jf,{omit:["layers","patternFeatures"]});var Xb={get paint(){return Qp=Qp||new v({"fill-antialias":new Kt(Qe.paint_fill["fill-antialias"]),"fill-opacity":new fi(Qe.paint_fill["fill-opacity"]),"fill-color":new fi(Qe.paint_fill["fill-color"]),"fill-outline-color":new fi(Qe.paint_fill["fill-outline-color"]),"fill-translate":new Kt(Qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Kt(Qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new gc(Qe.paint_fill["fill-pattern"])})},get layout(){return Yp=Yp||new v({"fill-sort-key":new fi(Qe.layout_fill["fill-sort-key"])})}};class Kb extends u{constructor(i){super(i,Xb)}recalculate(i,l){super.recalculate(i,l);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Jf(i)}queryRadius(){return Dh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,l,f,g,w,x,I){return Op(Fh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,I),g)}isTileClipped(){return!0}}const Jb=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Yb=A([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Qb}=Jb;var Ha={},$b=S,$p=Ec;function Ec(s,i,l,f,g){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=g,s.readFields(ev,this,i)}function ev(s,i,l){s==1?i.id=l.readVarint():s==2?function(f,g){for(var w=f.readVarint()+f.pos;f.pos<w;){var x=g._keys[f.readVarint()],I=g._values[f.readVarint()];g.properties[x]=I}}(l,i):s==3?i.type=l.readVarint():s==4&&(i._geometry=l.pos)}function tv(s){for(var i,l,f=0,g=0,w=s.length,x=w-1;g<w;x=g++)f+=((l=s[x]).x-(i=s[g]).x)*(i.y+l.y);return f}Ec.types=["Unknown","Point","LineString","Polygon"],Ec.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,l=s.readVarint()+s.pos,f=1,g=0,w=0,x=0,I=[];s.pos<l;){if(g<=0){var M=s.readVarint();f=7&M,g=M>>3}if(g--,f===1||f===2)w+=s.readSVarint(),x+=s.readSVarint(),f===1&&(i&&I.push(i),i=[]),i.push(new $b(w,x));else{if(f!==7)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&I.push(i),I},Ec.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,l=1,f=0,g=0,w=0,x=1/0,I=-1/0,M=1/0,F=-1/0;s.pos<i;){if(f<=0){var q=s.readVarint();l=7&q,f=q>>3}if(f--,l===1||l===2)(g+=s.readSVarint())<x&&(x=g),g>I&&(I=g),(w+=s.readSVarint())<M&&(M=w),w>F&&(F=w);else if(l!==7)throw new Error("unknown command "+l)}return[x,M,I,F]},Ec.prototype.toGeoJSON=function(s,i,l){var f,g,w=this.extent*Math.pow(2,l),x=this.extent*s,I=this.extent*i,M=this.loadGeometry(),F=Ec.types[this.type];function q(re){for(var le=0;le<re.length;le++){var ge=re[le];re[le]=[360*(ge.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(ge.y+I)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(f=0;f<M.length;f++)G[f]=M[f][0];q(M=G);break;case 2:for(f=0;f<M.length;f++)q(M[f]);break;case 3:for(M=function(re){var le=re.length;if(le<=1)return[re];for(var ge,Ce,ze=[],tt=0;tt<le;tt++){var Ve=tv(re[tt]);Ve!==0&&(Ce===void 0&&(Ce=Ve<0),Ce===Ve<0?(ge&&ze.push(ge),ge=[re[tt]]):ge.push(re[tt]))}return ge&&ze.push(ge),ze}(M),f=0;f<M.length;f++)for(g=0;g<M[f].length;g++)q(M[f][g])}M.length===1?M=M[0]:F="Multi"+F;var $={type:"Feature",geometry:{type:F,coordinates:M},properties:this.properties};return"id"in this&&($.id=this.id),$};var iv=$p,em=tm;function tm(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(nv,this,i),this.length=this._features.length}function nv(s,i,l){s===15?i.version=l.readVarint():s===1?i.name=l.readString():s===5?i.extent=l.readVarint():s===2?i._features.push(l.pos):s===3?i._keys.push(l.readString()):s===4&&i._values.push(function(f){for(var g=null,w=f.readVarint()+f.pos;f.pos<w;){var x=f.readVarint()>>3;g=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return g}(l))}tm.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new iv(this._pbf,i,this.extent,this._keys,this._values)};var rv=em;function sv(s,i,l){if(s===3){var f=new rv(l,l.readVarint()+l.pos);f.length&&(i[f.name]=f)}}Ha.VectorTile=function(s,i){this.layers=s.readFields(sv,{},i)},Ha.VectorTileFeature=$p,Ha.VectorTileLayer=em;const ov=Ha.VectorTileFeature.types,Yf=Math.pow(2,13);function Bu(s,i,l,f,g,w,x,I){s.emplaceBack(i,l,2*Math.floor(f*Yf)+x,g*Yf*2,w*Yf*2,Math.round(I))}class Qf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Ua,this.centroidVertexArray=new or,this.indexArray=new ys,this.programConfigurations=new El(i.layers,i.zoom),this.segments=new Vi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.features=[],this.hasPattern=Xf("fill-extrusion",this.layers,l);for(const{feature:g,id:w,index:x,sourceLayerIndex:I}of i){const M=this.layers[0]._featureFilter.needGeometry,F=Al(g,M);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),F,f))continue;const q={id:w,sourceLayerIndex:I,index:x,geometry:M?F.geometry:Il(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Kf("fill-extrusion",this.layers,q,this.zoom,l)):this.addFeature(q,q.geometry,x,f,{}),l.featureIndex.insert(g,q.geometry,x,I,this.index,!0)}}addFeatures(i,l,f){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,l,f)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Qb),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Yb.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,f,g,w){for(const x of Ca(l,500)){const I={x:0,y:0,vertexCount:0};let M=0;for(const le of x)M+=le.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const le of x){if(le.length===0||lv(le))continue;let ge=0;for(let Ce=0;Ce<le.length;Ce++){const ze=le[Ce];if(Ce>=1){const tt=le[Ce-1];if(!av(ze,tt)){F.vertexLength+4>Vi.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ve=ze.sub(tt)._perp()._unit(),Ye=tt.dist(ze);ge+Ye>32768&&(ge=0),Bu(this.layoutVertexArray,ze.x,ze.y,Ve.x,Ve.y,0,0,ge),Bu(this.layoutVertexArray,ze.x,ze.y,Ve.x,Ve.y,0,1,ge),I.x+=2*ze.x,I.y+=2*ze.y,I.vertexCount+=2,ge+=Ye,Bu(this.layoutVertexArray,tt.x,tt.y,Ve.x,Ve.y,0,0,ge),Bu(this.layoutVertexArray,tt.x,tt.y,Ve.x,Ve.y,0,1,ge),I.x+=2*tt.x,I.y+=2*tt.y,I.vertexCount+=2;const lt=F.vertexLength;this.indexArray.emplaceBack(lt,lt+2,lt+1),this.indexArray.emplaceBack(lt+1,lt+2,lt+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+M>Vi.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),ov[i.type]!=="Polygon")continue;const q=[],G=[],$=F.vertexLength;for(const le of x)if(le.length!==0){le!==x[0]&&G.push(q.length/2);for(let ge=0;ge<le.length;ge++){const Ce=le[ge];Bu(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),I.x+=Ce.x,I.y+=Ce.y,I.vertexCount+=1,q.push(Ce.x),q.push(Ce.y)}}const re=Gp(q,G);for(let le=0;le<re.length;le+=3)this.indexArray.emplaceBack($+re[le],$+re[le+2],$+re[le+1]);F.primitiveLength+=re.length/3,F.vertexLength+=M;for(let le=0;le<I.vertexCount;le++){const ge=Math.floor(I.x/I.vertexCount),Ce=Math.floor(I.y/I.vertexCount);this.centroidVertexArray.emplaceBack(ge,Ce)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,g)}}function av(s,i){return s.x===i.x&&(s.x<0||s.x>Nn)||s.y===i.y&&(s.y<0||s.y>Nn)}function lv(s){return s.every(i=>i.x<0)||s.every(i=>i.x>Nn)||s.every(i=>i.y<0)||s.every(i=>i.y>Nn)}let im;qt("FillExtrusionBucket",Qf,{omit:["layers","features"]});var cv={get paint(){return im=im||new v({"fill-extrusion-opacity":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fi(Qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gc(Qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fi(Qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fi(Qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Kt(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class uv extends u{constructor(i){super(i,cv)}createBucket(i){return new Qf(i)}queryRadius(){return Dh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,l,f,g,w,x,I,M){const F=Fh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,I),q=this.paint.get("fill-extrusion-height").evaluate(l,f),G=this.paint.get("fill-extrusion-base").evaluate(l,f),$=function(le,ge,Ce,ze){const tt=[];for(const Ve of le){const Ye=[Ve.x,Ve.y,0,1];Rh(Ye,Ye,ge),tt.push(new y(Ye[0]/Ye[3],Ye[1]/Ye[3]))}return tt}(F,M),re=function(le,ge,Ce,ze){const tt=[],Ve=[],Ye=ze[8]*ge,lt=ze[9]*ge,xt=ze[10]*ge,Bt=ze[11]*ge,hi=ze[8]*Ce,Ft=ze[9]*Ce,Ot=ze[10]*Ce,ei=ze[11]*Ce;for(const Gt of le){const Vt=[],gt=[];for(const ti of Gt){const Qt=ti.x,bi=ti.y,un=ze[0]*Qt+ze[4]*bi+ze[12],sn=ze[1]*Qt+ze[5]*bi+ze[13],Kn=ze[2]*Qt+ze[6]*bi+ze[14],Ns=ze[3]*Qt+ze[7]*bi+ze[15],cr=Kn+xt,Jn=Ns+Bt,Dr=un+hi,Fr=sn+Ft,Rr=Kn+Ot,Ln=Ns+ei,Yn=new y((un+Ye)/Jn,(sn+lt)/Jn);Yn.z=cr/Jn,Vt.push(Yn);const Sr=new y(Dr/Ln,Fr/Ln);Sr.z=Rr/Ln,gt.push(Sr)}tt.push(Vt),Ve.push(gt)}return[tt,Ve]}(g,G,q,M);return function(le,ge,Ce){let ze=1/0;Op(Ce,ge)&&(ze=nm(Ce,ge[0]));for(let tt=0;tt<ge.length;tt++){const Ve=ge[tt],Ye=le[tt];for(let lt=0;lt<Ve.length-1;lt++){const xt=Ve[lt],Bt=[xt,Ve[lt+1],Ye[lt+1],Ye[lt],xt];zp(Ce,Bt)&&(ze=Math.min(ze,nm(Ce,Bt)))}}return ze!==1/0&&ze}(re[0],re[1],$)}}function Nu(s,i){return s.x*i.x+s.y*i.y}function nm(s,i){if(s.length===1){let l=0;const f=i[l++];let g;for(;!g||f.equals(g);)if(g=i[l++],!g)return 1/0;for(;l<i.length;l++){const w=i[l],x=s[0],I=g.sub(f),M=w.sub(f),F=x.sub(f),q=Nu(I,I),G=Nu(I,M),$=Nu(M,M),re=Nu(F,I),le=Nu(F,M),ge=q*$-G*G,Ce=($*re-G*le)/ge,ze=(q*le-G*re)/ge,tt=f.z*(1-Ce-ze)+g.z*Ce+w.z*ze;if(isFinite(tt))return tt}return 1/0}{let l=1/0;for(const f of i)l=Math.min(l,f.z);return l}}const hv=A([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:fv}=hv,dv=A([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:pv}=dv,mv=Ha.VectorTileFeature.types,gv=Math.cos(Math.PI/180*37.5),rm=Math.pow(2,14)/.5;class $f{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new yc,this.layoutVertexArray2=new Va,this.indexArray=new ys,this.programConfigurations=new El(i.layers,i.zoom),this.segments=new Vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.hasPattern=Xf("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),x=[];for(const{feature:I,id:M,index:F,sourceLayerIndex:q}of i){const G=this.layers[0]._featureFilter.needGeometry,$=Al(I,G);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),$,f))continue;const re=w?g.evaluate($,{},f):void 0,le={id:M,properties:I.properties,type:I.type,sourceLayerIndex:q,index:F,geometry:G?$.geometry:Il(I),patterns:{},sortKey:re};x.push(le)}w&&x.sort((I,M)=>I.sortKey-M.sortKey);for(const I of x){const{geometry:M,index:F,sourceLayerIndex:q}=I;if(this.hasPattern){const G=Kf("line",this.layers,I,this.zoom,l);this.patternFeatures.push(G)}else this.addFeature(I,M,F,f,{});l.featureIndex.insert(i[F].feature,M,F,q,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}addFeatures(i,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,pv)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,fv),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,f,g,w){const x=this.layers[0].layout,I=x.get("line-join").evaluate(i,{}),M=x.get("line-cap"),F=x.get("line-miter-limit"),q=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const G of l)this.addLine(G,i,I,M,F,q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,g)}addLine(i,l,f,g,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ze=0;ze<i.length-1;ze++)this.totalDistance+=i[ze].dist(i[ze+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=mv[l.type]==="Polygon";let M=i.length;for(;M>=2&&i[M-1].equals(i[M-2]);)M--;let F=0;for(;F<M-1&&i[F].equals(i[F+1]);)F++;if(M<(I?3:2))return;f==="bevel"&&(w=1.05);const q=this.overscaling<=16?15*Nn/(512*this.overscaling):0,G=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let $,re,le,ge,Ce;this.e1=this.e2=-1,I&&($=i[M-2],Ce=i[F].sub($)._unit()._perp());for(let ze=F;ze<M;ze++){if(le=ze===M-1?I?i[F+1]:void 0:i[ze+1],le&&i[ze].equals(le))continue;Ce&&(ge=Ce),$&&(re=$),$=i[ze],Ce=le?le.sub($)._unit()._perp():ge,ge=ge||Ce;let tt=ge.add(Ce);tt.x===0&&tt.y===0||tt._unit();const Ve=ge.x*Ce.x+ge.y*Ce.y,Ye=tt.x*Ce.x+tt.y*Ce.y,lt=Ye!==0?1/Ye:1/0,xt=2*Math.sqrt(2-2*Ye),Bt=Ye<gv&&re&&le,hi=ge.x*Ce.y-ge.y*Ce.x>0;if(Bt&&ze>F){const ei=$.dist(re);if(ei>2*q){const Gt=$.sub($.sub(re)._mult(q/ei)._round());this.updateDistance(re,Gt),this.addCurrentVertex(Gt,ge,0,0,G),re=Gt}}const Ft=re&&le;let Ot=Ft?f:I?"butt":g;if(Ft&&Ot==="round"&&(lt<x?Ot="miter":lt<=2&&(Ot="fakeround")),Ot==="miter"&&lt>w&&(Ot="bevel"),Ot==="bevel"&&(lt>2&&(Ot="flipbevel"),lt<w&&(Ot="miter")),re&&this.updateDistance(re,$),Ot==="miter")tt._mult(lt),this.addCurrentVertex($,tt,0,0,G);else if(Ot==="flipbevel"){if(lt>100)tt=Ce.mult(-1);else{const ei=lt*ge.add(Ce).mag()/ge.sub(Ce).mag();tt._perp()._mult(ei*(hi?-1:1))}this.addCurrentVertex($,tt,0,0,G),this.addCurrentVertex($,tt.mult(-1),0,0,G)}else if(Ot==="bevel"||Ot==="fakeround"){const ei=-Math.sqrt(lt*lt-1),Gt=hi?ei:0,Vt=hi?0:ei;if(re&&this.addCurrentVertex($,ge,Gt,Vt,G),Ot==="fakeround"){const gt=Math.round(180*xt/Math.PI/20);for(let ti=1;ti<gt;ti++){let Qt=ti/gt;if(Qt!==.5){const un=Qt-.5;Qt+=Qt*un*(Qt-1)*((1.0904+Ve*(Ve*(3.55645-1.43519*Ve)-3.2452))*un*un+(.848013+Ve*(.215638*Ve-1.06021)))}const bi=Ce.sub(ge)._mult(Qt)._add(ge)._unit()._mult(hi?-1:1);this.addHalfVertex($,bi.x,bi.y,!1,hi,0,G)}}le&&this.addCurrentVertex($,Ce,-Gt,-Vt,G)}else if(Ot==="butt")this.addCurrentVertex($,tt,0,0,G);else if(Ot==="square"){const ei=re?1:-1;this.addCurrentVertex($,tt,ei,ei,G)}else Ot==="round"&&(re&&(this.addCurrentVertex($,ge,0,0,G),this.addCurrentVertex($,ge,1,1,G,!0)),le&&(this.addCurrentVertex($,Ce,-1,-1,G,!0),this.addCurrentVertex($,Ce,0,0,G)));if(Bt&&ze<M-1){const ei=$.dist(le);if(ei>2*q){const Gt=$.add(le.sub($)._mult(q/ei)._round());this.updateDistance($,Gt),this.addCurrentVertex(Gt,Ce,0,0,G),$=Gt}}}}addCurrentVertex(i,l,f,g,w,x=!1){const I=l.y*g-l.x,M=-l.y-l.x*g;this.addHalfVertex(i,l.x+l.y*f,l.y-l.x*f,x,!1,f,w),this.addHalfVertex(i,I,M,x,!0,-g,w),this.distance>rm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,f,g,w,x))}addHalfVertex({x:i,y:l},f,g,w,x,I,M){const F=.5*(this.lineClips?this.scaledDistance*(rm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(w?1:0),(l<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(I===0?0:I<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const q=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,q),M.primitiveLength++),x?this.e2=q:this.e1=q}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}let sm,om;qt("LineBucket",$f,{omit:["layers","patternFeatures"]});var am={get paint(){return om=om||new v({"line-opacity":new fi(Qe.paint_line["line-opacity"]),"line-color":new fi(Qe.paint_line["line-color"]),"line-translate":new Kt(Qe.paint_line["line-translate"]),"line-translate-anchor":new Kt(Qe.paint_line["line-translate-anchor"]),"line-width":new fi(Qe.paint_line["line-width"]),"line-gap-width":new fi(Qe.paint_line["line-gap-width"]),"line-offset":new fi(Qe.paint_line["line-offset"]),"line-blur":new fi(Qe.paint_line["line-blur"]),"line-dasharray":new _c(Qe.paint_line["line-dasharray"]),"line-pattern":new gc(Qe.paint_line["line-pattern"]),"line-gradient":new Au(Qe.paint_line["line-gradient"])})},get layout(){return sm=sm||new v({"line-cap":new Kt(Qe.layout_line["line-cap"]),"line-join":new fi(Qe.layout_line["line-join"]),"line-miter-limit":new Kt(Qe.layout_line["line-miter-limit"]),"line-round-limit":new Kt(Qe.layout_line["line-round-limit"]),"line-sort-key":new fi(Qe.layout_line["line-sort-key"])})}};class _v extends fi{possiblyEvaluate(i,l){return l=new mn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,f,g){return l=ne({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,f,g)}}let Uh;class yv extends u{constructor(i){super(i,am),this.gradientVersion=0,Uh||(Uh=new _v(am.paint.properties["line-width"].specification),Uh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof po,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=Uh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new $f(i)}queryRadius(i){const l=i,f=lm(Lu("line-width",this,l),Lu("line-gap-width",this,l)),g=Lu("line-offset",this,l);return f/2+Math.abs(g)+Dh(this.paint.get("line-translate"))}queryIntersectsFeature(i,l,f,g,w,x,I){const M=Fh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,I),F=I/2*lm(this.paint.get("line-width").evaluate(l,f),this.paint.get("line-gap-width").evaluate(l,f)),q=this.paint.get("line-offset").evaluate(l,f);return q&&(g=function(G,$){const re=[];for(let le=0;le<G.length;le++){const ge=G[le],Ce=[];for(let ze=0;ze<ge.length;ze++){const tt=ge[ze-1],Ve=ge[ze],Ye=ge[ze+1],lt=ze===0?new y(0,0):Ve.sub(tt)._unit()._perp(),xt=ze===ge.length-1?new y(0,0):Ye.sub(Ve)._unit()._perp(),Bt=lt._add(xt)._unit(),hi=Bt.x*xt.x+Bt.y*xt.y;hi!==0&&Bt._mult(1/hi),Ce.push(Bt._mult($)._add(Ve))}re.push(Ce)}return re}(g,q*I)),function(G,$,re){for(let le=0;le<$.length;le++){const ge=$[le];if(G.length>=3){for(let Ce=0;Ce<ge.length;Ce++)if(Sc(G,ge[Ce]))return!0}if(Eb(G,ge,re))return!0}return!1}(M,g,F)}isTileClipped(){return!0}}function lm(s,i){return i>0?i+2*s:s}const bv=A([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vv=A([{name:"a_projected_pos",components:3,type:"Float32"}],4);A([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wv=A([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);A([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const cm=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xv=A([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function kv(s,i,l){return s.sections.forEach(f=>{f.text=function(g,w,x){const I=w.layout.get("text-transform").evaluate(x,{});return I==="uppercase"?g=g.toLocaleUpperCase():I==="lowercase"&&(g=g.toLocaleLowerCase()),Hr.applyArabicShaping&&(g=Hr.applyArabicShaping(g)),g}(f.text,i,l)}),s}A([{name:"triangle",components:3,type:"Uint16"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),A([{type:"Float32",name:"offsetX"}]),A([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),A([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ju={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var qn=24,um=rn,hm=function(s,i,l,f,g){var w,x,I=8*g-f-1,M=(1<<I)-1,F=M>>1,q=-7,G=g-1,$=-1,re=s[i+G];for(G+=$,w=re&(1<<-q)-1,re>>=-q,q+=I;q>0;w=256*w+s[i+G],G+=$,q-=8);for(x=w&(1<<-q)-1,w>>=-q,q+=f;q>0;x=256*x+s[i+G],G+=$,q-=8);if(w===0)w=1-F;else{if(w===M)return x?NaN:1/0*(re?-1:1);x+=Math.pow(2,f),w-=F}return(re?-1:1)*x*Math.pow(2,w-f)},fm=function(s,i,l,f,g,w){var x,I,M,F=8*w-g-1,q=(1<<F)-1,G=q>>1,$=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=0,le=1,ge=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(I=isNaN(i)?1:0,x=q):(x=Math.floor(Math.log(i)/Math.LN2),i*(M=Math.pow(2,-x))<1&&(x--,M*=2),(i+=x+G>=1?$/M:$*Math.pow(2,1-G))*M>=2&&(x++,M/=2),x+G>=q?(I=0,x=q):x+G>=1?(I=(i*M-1)*Math.pow(2,g),x+=G):(I=i*Math.pow(2,G-1)*Math.pow(2,g),x=0));g>=8;s[l+re]=255&I,re+=le,I/=256,g-=8);for(x=x<<g|I,F+=g;F>0;s[l+re]=255&x,re+=le,x/=256,F-=8);s[l+re-le]|=128*ge};function rn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}rn.Varint=0,rn.Fixed64=1,rn.Bytes=2,rn.Fixed32=5;var ed=4294967296,dm=1/ed,pm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function aa(s){return s.type===rn.Bytes?s.readVarint()+s.pos:s.pos+1}function Ic(s,i,l){return l?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function mm(s,i,l){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(f);for(var g=l.pos-1;g>=s;g--)l.buf[g+f]=l.buf[g]}function Sv(s,i){for(var l=0;l<s.length;l++)i.writeVarint(s[l])}function Tv(s,i){for(var l=0;l<s.length;l++)i.writeSVarint(s[l])}function Cv(s,i){for(var l=0;l<s.length;l++)i.writeFloat(s[l])}function Ev(s,i){for(var l=0;l<s.length;l++)i.writeDouble(s[l])}function Iv(s,i){for(var l=0;l<s.length;l++)i.writeBoolean(s[l])}function Av(s,i){for(var l=0;l<s.length;l++)i.writeFixed32(s[l])}function Mv(s,i){for(var l=0;l<s.length;l++)i.writeSFixed32(s[l])}function Pv(s,i){for(var l=0;l<s.length;l++)i.writeFixed64(s[l])}function Lv(s,i){for(var l=0;l<s.length;l++)i.writeSFixed64(s[l])}function Vh(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Ac(s,i,l){s[l]=i,s[l+1]=i>>>8,s[l+2]=i>>>16,s[l+3]=i>>>24}function gm(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}rn.prototype={destroy:function(){this.buf=null},readFields:function(s,i,l){for(l=l||this.length;this.pos<l;){var f=this.readVarint(),g=f>>3,w=this.pos;this.type=7&f,s(g,i,this),this.pos===w&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Vh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=gm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Vh(this.buf,this.pos)+Vh(this.buf,this.pos+4)*ed;return this.pos+=8,s},readSFixed64:function(){var s=Vh(this.buf,this.pos)+gm(this.buf,this.pos+4)*ed;return this.pos+=8,s},readFloat:function(){var s=hm(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=hm(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,l,f=this.buf;return i=127&(l=f[this.pos++]),l<128?i:(i|=(127&(l=f[this.pos++]))<<7,l<128?i:(i|=(127&(l=f[this.pos++]))<<14,l<128?i:(i|=(127&(l=f[this.pos++]))<<21,l<128?i:function(g,w,x){var I,M,F=x.buf;if(I=(112&(M=F[x.pos++]))>>4,M<128||(I|=(127&(M=F[x.pos++]))<<3,M<128)||(I|=(127&(M=F[x.pos++]))<<10,M<128)||(I|=(127&(M=F[x.pos++]))<<17,M<128)||(I|=(127&(M=F[x.pos++]))<<24,M<128)||(I|=(1&(M=F[x.pos++]))<<31,M<128))return Ic(g,I,w);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&pm?function(l,f,g){return pm.decode(l.subarray(f,g))}(this.buf,i,s):function(l,f,g){for(var w="",x=f;x<g;){var I,M,F,q=l[x],G=null,$=q>239?4:q>223?3:q>191?2:1;if(x+$>g)break;$===1?q<128&&(G=q):$===2?(192&(I=l[x+1]))==128&&(G=(31&q)<<6|63&I)<=127&&(G=null):$===3?(M=l[x+2],(192&(I=l[x+1]))==128&&(192&M)==128&&((G=(15&q)<<12|(63&I)<<6|63&M)<=2047||G>=55296&&G<=57343)&&(G=null)):$===4&&(M=l[x+2],F=l[x+3],(192&(I=l[x+1]))==128&&(192&M)==128&&(192&F)==128&&((G=(15&q)<<18|(63&I)<<12|(63&M)<<6|63&F)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,$=1):G>65535&&(G-=65536,w+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),w+=String.fromCharCode(G),x+=$}return w}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==rn.Bytes)return s.push(this.readVarint(i));var l=aa(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==rn.Bytes)return s.push(this.readSVarint());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==rn.Bytes)return s.push(this.readBoolean());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==rn.Bytes)return s.push(this.readFloat());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==rn.Bytes)return s.push(this.readDouble());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==rn.Bytes)return s.push(this.readFixed32());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==rn.Bytes)return s.push(this.readSFixed32());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==rn.Bytes)return s.push(this.readFixed64());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==rn.Bytes)return s.push(this.readSFixed64());var i=aa(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===rn.Varint)for(;this.buf[this.pos++]>127;);else if(i===rn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===rn.Fixed32)this.pos+=4;else{if(i!==rn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Ac(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Ac(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Ac(this.buf,-1&s,this.pos),Ac(this.buf,Math.floor(s*dm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Ac(this.buf,-1&s,this.pos),Ac(this.buf,Math.floor(s*dm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,l){var f,g;if(i>=0?(f=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(w,x,I){I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,w>>>=7,I.buf[I.pos++]=127&w|128,I.buf[I.pos]=127&(w>>>=7)}(f,0,l),function(w,x){var I=(7&w)<<4;x.buf[x.pos++]|=I|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(g,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,g,w){for(var x,I,M=0;M<g.length;M++){if((x=g.charCodeAt(M))>55295&&x<57344){if(!I){x>56319||M+1===g.length?(f[w++]=239,f[w++]=191,f[w++]=189):I=x;continue}if(x<56320){f[w++]=239,f[w++]=191,f[w++]=189,I=x;continue}x=I-55296<<10|x-56320|65536,I=null}else I&&(f[w++]=239,f[w++]=191,f[w++]=189,I=null);x<128?f[w++]=x:(x<2048?f[w++]=x>>6|192:(x<65536?f[w++]=x>>12|224:(f[w++]=x>>18|240,f[w++]=x>>12&63|128),f[w++]=x>>6&63|128),f[w++]=63&x|128)}return w}(this.buf,s,this.pos);var l=this.pos-i;l>=128&&mm(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),fm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),fm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,i){this.pos++;var l=this.pos;s(i,this);var f=this.pos-l;f>=128&&mm(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,l){this.writeTag(s,rn.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,Sv,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,Tv,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,Iv,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,Cv,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,Ev,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,Av,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,Mv,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,Pv,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,Lv,i)},writeBytesField:function(s,i){this.writeTag(s,rn.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,rn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,rn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,rn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,rn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,rn.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,rn.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,rn.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,rn.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,rn.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var td=_(um);const id=3;function zv(s,i,l){s===1&&l.readMessage(Ov,i)}function Ov(s,i,l){if(s===3){const{id:f,bitmap:g,width:w,height:x,left:I,top:M,advance:F}=l.readMessage(Dv,{});i.push({id:f,bitmap:new Ou({width:w+2*id,height:x+2*id},g),metrics:{width:w,height:x,left:I,top:M,advance:F}})}}function Dv(s,i,l){s===1?i.id=l.readVarint():s===2?i.bitmap=l.readBytes():s===3?i.width=l.readVarint():s===4?i.height=l.readVarint():s===5?i.left=l.readSVarint():s===6?i.top=l.readSVarint():s===7&&(i.advance=l.readVarint())}const _m=id;function ym(s){let i=0,l=0;for(const x of s)i+=x.w*x.h,l=Math.max(l,x.w);s.sort((x,I)=>I.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let g=0,w=0;for(const x of s)for(let I=f.length-1;I>=0;I--){const M=f[I];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,w=Math.max(w,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===M.w&&x.h===M.h){const F=f.pop();I<f.length&&(f[I]=F)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(f.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:g,h:w,fill:i/(g*w)||0}}const Kr=1;class nd{constructor(i,{pixelRatio:l,version:f,stretchX:g,stretchY:w,content:x,textFitWidth:I,textFitHeight:M}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=g,this.stretchY=w,this.content=x,this.version=f,this.textFitWidth=I,this.textFitHeight=M}get tl(){return[this.paddedRect.x+Kr,this.paddedRect.y+Kr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Kr,this.paddedRect.y+this.paddedRect.h-Kr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Kr)/this.pixelRatio,(this.paddedRect.h-2*Kr)/this.pixelRatio]}}class bm{constructor(i,l){const f={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(i,f,w),this.addImages(l,g,w);const{w:x,h:I}=ym(w),M=new bs({width:x||1,height:I||1});for(const F in i){const q=i[F],G=f[F].paddedRect;bs.copy(q.data,M,{x:0,y:0},{x:G.x+Kr,y:G.y+Kr},q.data)}for(const F in l){const q=l[F],G=g[F].paddedRect,$=G.x+Kr,re=G.y+Kr,le=q.data.width,ge=q.data.height;bs.copy(q.data,M,{x:0,y:0},{x:$,y:re},q.data),bs.copy(q.data,M,{x:0,y:ge-1},{x:$,y:re-1},{width:le,height:1}),bs.copy(q.data,M,{x:0,y:0},{x:$,y:re+ge},{width:le,height:1}),bs.copy(q.data,M,{x:le-1,y:0},{x:$-1,y:re},{width:1,height:ge}),bs.copy(q.data,M,{x:0,y:0},{x:$+le,y:re},{width:1,height:ge})}this.image=M,this.iconPositions=f,this.patternPositions=g}addImages(i,l,f){for(const g in i){const w=i[g],x={x:0,y:0,w:w.data.width+2*Kr,h:w.data.height+2*Kr};f.push(x),l[g]=new nd(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),l)}patchUpdatedImage(i,l,f){if(!i||!l||i.version===l.version)return;i.version=l.version;const[g,w]=i.tl;f.update(l.data,void 0,{x:g,y:w})}}var Xa;qt("ImagePosition",nd),qt("ImageAtlas",bm),h.ah=void 0,(Xa=h.ah||(h.ah={}))[Xa.none=0]="none",Xa[Xa.horizontal=1]="horizontal",Xa[Xa.vertical=2]="vertical",Xa[Xa.horizontalOnly=3]="horizontalOnly";const Uu=-17;class Vu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const f=new Vu;return f.scale=i||1,f.fontStack=l,f}static forImage(i){const l=new Vu;return l.imageName=i,l}}class Mc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const f=new Mc;for(let g=0;g<i.sections.length;g++){const w=i.sections[g];w.image?f.addImageSection(w):f.addTextSection(w,l)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,w=i.charCodeAt(f-1)||null;l+=g&&Ih(g)&&!ju[i[f+1]]||w&&Ih(w)&&!ju[i[f-1]]||!ju[i[f]]?i[f]:ju[i[f]]}return l}(this.text)}trim(){let i=0;for(let f=0;f<this.text.length&&Zh[this.text.charCodeAt(f)];f++)i++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Zh[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const f=new Mc;return f.text=this.text.substring(i,l),f.sectionIndex=this.sectionIndex.slice(i,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(Vu.forText(i.scale,i.fontStack||l));const f=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(f)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void ce("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Vu.forImage(l)),this.sectionIndex.push(this.sections.length-1)):ce("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qh(s,i,l,f,g,w,x,I,M,F,q,G,$,re,le){const ge=Mc.fromFeature(s,g);let Ce;G===h.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:ze,processStyledBidirectionalText:tt}=Hr;if(ze&&ge.sections.length===1){Ce=[];const lt=ze(ge.toString(),rd(ge,F,w,i,f,re));for(const xt of lt){const Bt=new Mc;Bt.text=xt,Bt.sections=ge.sections;for(let hi=0;hi<xt.length;hi++)Bt.sectionIndex.push(0);Ce.push(Bt)}}else if(tt){Ce=[];const lt=tt(ge.text,ge.sectionIndex,rd(ge,F,w,i,f,re));for(const xt of lt){const Bt=new Mc;Bt.text=xt[0],Bt.sectionIndex=xt[1],Bt.sections=ge.sections,Ce.push(Bt)}}else Ce=function(lt,xt){const Bt=[],hi=lt.text;let Ft=0;for(const Ot of xt)Bt.push(lt.substring(Ft,Ot)),Ft=Ot;return Ft<hi.length&&Bt.push(lt.substring(Ft,hi.length)),Bt}(ge,rd(ge,F,w,i,f,re));const Ve=[],Ye={positionedLines:Ve,text:ge.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(lt,xt,Bt,hi,Ft,Ot,ei,Gt,Vt,gt,ti,Qt){let bi=0,un=Uu,sn=0,Kn=0;const Ns=Gt==="right"?1:Gt==="left"?0:.5;let cr=0;for(const Ln of Ft){Ln.trim();const Yn=Ln.getMaxScale(),Sr=(Yn-1)*qn,ur={positionedGlyphs:[],lineOffset:0};lt.positionedLines[cr]=ur;const Br=ur.positionedGlyphs;let hr=0;if(!Ln.length()){un+=Ot,++cr;continue}for(let Jr=0;Jr<Ln.length();Jr++){const Yi=Ln.getSection(Jr),dn=Ln.getSectionIndex(Jr),bn=Ln.getCharCode(Jr);let hs=0,An=null,Oc=null,Mo=null,Po=qn;const js=!(Vt===h.ah.horizontal||!ti&&!Eu(bn)||ti&&(Zh[bn]||(Jn=bn,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Jn)))));if(Yi.imageName){const xs=hi[Yi.imageName];if(!xs)continue;Mo=Yi.imageName,lt.iconsInText=lt.iconsInText||!0,Oc=xs.paddedRect;const ir=xs.displaySize;Yi.scale=Yi.scale*qn/Qt,An={width:ir[0],height:ir[1],left:Kr,top:-_m,advance:js?ir[1]:ir[0]},hs=Sr+(qn-ir[1]*Yi.scale),Po=An.advance;const la=js?ir[0]*Yi.scale-qn*Yn:ir[1]*Yi.scale-qn*Yn;la>0&&la>hr&&(hr=la)}else{const xs=Bt[Yi.fontStack],ir=xs&&xs[bn];if(ir&&ir.rect)Oc=ir.rect,An=ir.metrics;else{const la=xt[Yi.fontStack],Xu=la&&la[bn];if(!Xu)continue;An=Xu.metrics}hs=(Yn-Yi.scale)*qn}js?(lt.verticalizable=!0,Br.push({glyph:bn,imageName:Mo,x:bi,y:un+hs,vertical:js,scale:Yi.scale,fontStack:Yi.fontStack,sectionIndex:dn,metrics:An,rect:Oc}),bi+=Po*Yi.scale+gt):(Br.push({glyph:bn,imageName:Mo,x:bi,y:un+hs,vertical:js,scale:Yi.scale,fontStack:Yi.fontStack,sectionIndex:dn,metrics:An,rect:Oc}),bi+=An.advance*Yi.scale+gt)}Br.length!==0&&(sn=Math.max(bi-gt,sn),Nv(Br,0,Br.length-1,Ns,hr)),bi=0;const ws=Ot*Yn+hr;ur.lineOffset=Math.max(hr,Sr),un+=ws,Kn=Math.max(ws,Kn),++cr}var Jn;const Dr=un-Uu,{horizontalAlign:Fr,verticalAlign:Rr}=sd(ei);(function(Ln,Yn,Sr,ur,Br,hr,ws,Jr,Yi){const dn=(Yn-Sr)*Br;let bn=0;bn=hr!==ws?-Jr*ur-Uu:(-ur*Yi+.5)*ws;for(const hs of Ln)for(const An of hs.positionedGlyphs)An.x+=dn,An.y+=bn})(lt.positionedLines,Ns,Fr,Rr,sn,Kn,Ot,Dr,Ft.length),lt.top+=-Rr*Dr,lt.bottom=lt.top+Dr,lt.left+=-Fr*sn,lt.right=lt.left+sn}(Ye,i,l,f,Ce,x,I,M,G,F,$,le),!function(lt){for(const xt of lt)if(xt.positionedGlyphs.length!==0)return!1;return!0}(Ve)&&Ye}const Zh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Fv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Rv={40:!0};function vm(s,i,l,f,g,w){if(i.imageName){const x=f[i.imageName];return x?x.displaySize[0]*i.scale*qn/w+g:0}{const x=l[i.fontStack],I=x&&x[s];return I?I.metrics.advance*i.scale+g:0}}function wm(s,i,l,f){const g=Math.pow(s-i,2);return f?s<i?g/2:2*g:g+Math.abs(l)*l}function Bv(s,i,l){let f=0;return s===10&&(f-=1e4),l&&(f+=150),s!==40&&s!==65288||(f+=50),i!==41&&i!==65289||(f+=50),f}function xm(s,i,l,f,g,w){let x=null,I=wm(i,l,g,w);for(const M of f){const F=wm(i-M.x,l,g,w)+M.badness;F<=I&&(x=M,I=F)}return{index:s,x:i,priorBreak:x,badness:I}}function km(s){return s?km(s.priorBreak).concat(s.index):[]}function rd(s,i,l,f,g,w){if(!s)return[];const x=[],I=function(G,$,re,le,ge,Ce){let ze=0;for(let tt=0;tt<G.length();tt++){const Ve=G.getSection(tt);ze+=vm(G.getCharCode(tt),Ve,le,ge,$,Ce)}return ze/Math.max(1,Math.ceil(ze/re))}(s,i,l,f,g,w),M=s.text.indexOf("")>=0;let F=0;for(let G=0;G<s.length();G++){const $=s.getSection(G),re=s.getCharCode(G);if(Zh[re]||(F+=vm(re,$,f,g,i,w)),G<s.length()-1){const le=!((q=re)<11904)&&(!!Ui["CJK Compatibility Forms"](q)||!!Ui["CJK Compatibility"](q)||!!Ui["CJK Strokes"](q)||!!Ui["CJK Symbols and Punctuation"](q)||!!Ui["Enclosed CJK Letters and Months"](q)||!!Ui["Halfwidth and Fullwidth Forms"](q)||!!Ui["Ideographic Description Characters"](q)||!!Ui["Vertical Forms"](q)||Eh.test(String.fromCodePoint(q)));(Fv[re]||le||$.imageName||G!==s.length()-2&&Rv[s.getCharCode(G+1)])&&x.push(xm(G+1,F,I,x,Bv(re,s.getCharCode(G+1),le&&M),!1))}}var q;return km(xm(s.length(),F,I,x,0,!0))}function sd(s){let i=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function Nv(s,i,l,f,g){if(!f&&!g)return;const w=s[l],x=(s[l].x+w.metrics.advance*w.scale)*f;for(let I=i;I<=l;I++)s[I].x-=x,s[I].y+=g}function jv(s,i,l){const{horizontalAlign:f,verticalAlign:g}=sd(l),w=i[0]-s.displaySize[0]*f,x=i[1]-s.displaySize[1]*g;return{image:s,top:x,bottom:x+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function Sm(s){var i,l;let f=s.left,g=s.top,w=s.right-f,x=s.bottom-g;const I=(i=s.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",M=(l=s.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",F=(s.image.content[2]-s.image.content[0])/(s.image.content[3]-s.image.content[1]);if(M==="proportional"){if(I==="stretchOnly"&&w/x<F||I==="proportional"){const q=Math.ceil(x*F);f*=q/w,w=q}}else if(I==="proportional"&&M==="stretchOnly"&&F!==0&&w/x>F){const q=Math.ceil(w/F);g*=q/x,x=q}return{x1:f,y1:g,x2:f+w,y2:g+x}}function Tm(s,i,l,f,g,w){const x=s.image;let I;if(x.content){const Ce=x.content,ze=x.pixelRatio||1;I=[Ce[0]/ze,Ce[1]/ze,x.displaySize[0]-Ce[2]/ze,x.displaySize[1]-Ce[3]/ze]}const M=i.left*w,F=i.right*w;let q,G,$,re;l==="width"||l==="both"?(re=g[0]+M-f[3],G=g[0]+F+f[1]):(re=g[0]+(M+F-x.displaySize[0])/2,G=re+x.displaySize[0]);const le=i.top*w,ge=i.bottom*w;return l==="height"||l==="both"?(q=g[1]+le-f[0],$=g[1]+ge+f[2]):(q=g[1]+(le+ge-x.displaySize[1])/2,$=q+x.displaySize[1]),{image:x,top:q,right:G,bottom:$,left:re,collisionPadding:I}}const qu=255,Ao=128,Ka=qu*Ao;function Cm(s,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new mn(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=l;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let x=w;for(;x<f.length&&f[x]<s+1;)x++;x=Math.min(f.length-1,x);const I=f[w],M=f[x];return l.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:M,interpolationType:g}:{kind:"camera",minZoom:I,maxZoom:M,minSize:l.evaluate(new mn(I)),maxSize:l.evaluate(new mn(M)),interpolationType:g}}}function od(s,i,l){let f="never";const g=s.get(i);return g?f=g:s.get(l)&&(f="always"),f}const Uv=Ha.VectorTileFeature.types,Vv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wh(s,i,l,f,g,w,x,I,M,F,q,G,$){const re=I?Math.min(Ka,Math.round(I[0])):0,le=I?Math.min(Ka,Math.round(I[1])):0;s.emplaceBack(i,l,Math.round(32*f),Math.round(32*g),w,x,(re<<1)+(M?1:0),le,16*F,16*q,256*G,256*$)}function ad(s,i,l){s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l)}function qv(s){for(const i of s.sections)if(Df(i.text))return!0;return!1}class ld{constructor(i){this.layoutVertexArray=new bc,this.indexArray=new ys,this.programConfigurations=i,this.segments=new Vi,this.dynamicLayoutVertexArray=new Mu,this.opacityVertexArray=new cs,this.hasVisibleVertices=!1,this.placedSymbolArray=new gn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,bv.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,vv.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Vv,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qt("SymbolBuffers",ld);class cd{constructor(i,l,f){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new f,this.segments=new Vi,this.collisionVertexArray=new Eo}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,wv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qt("CollisionBuffers",cd);class Pc{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vf([]),this.placementViewportMatrix=Vf([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cm(this.zoom,l["text-size"]),this.iconSizeData=Cm(this.zoom,l["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=od(f,"text-overlap","text-allow-overlap")!=="never"||od(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(x=>h.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID}createArrays(){this.text=new ld(new El(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new ld(new El(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new _n,this.lineVertexArray=new sr,this.symbolInstances=new ji,this.textAnchorOffsets=new yn}calculateGlyphDependencies(i,l,f,g,w){for(let x=0;x<i.length;x++)if(l[i.charCodeAt(x)]=!0,(f||g)&&w){const I=ju[i.charAt(x)];I&&(l[I.charCodeAt(0)]=!0)}}populate(i,l,f){const g=this.layers[0],w=g.layout,x=w.get("text-font"),I=w.get("text-field"),M=w.get("icon-image"),F=(I.value.kind!=="constant"||I.value.value instanceof Un&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),q=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,G=w.get("symbol-sort-key");if(this.features=[],!F&&!q)return;const $=l.iconDependencies,re=l.glyphDependencies,le=l.availableImages,ge=new mn(this.zoom);for(const{feature:Ce,id:ze,index:tt,sourceLayerIndex:Ve}of i){const Ye=g._featureFilter.needGeometry,lt=Al(Ce,Ye);if(!g._featureFilter.filter(ge,lt,f))continue;let xt,Bt;if(Ye||(lt.geometry=Il(Ce)),F){const Ft=g.getValueAndResolveTokens("text-field",lt,f,le),Ot=Un.factory(Ft),ei=this.hasRTLText=this.hasRTLText||qv(Ot);(!ei||Hr.getRTLTextPluginStatus()==="unavailable"||ei&&Hr.isParsed())&&(xt=kv(Ot,g,lt))}if(q){const Ft=g.getValueAndResolveTokens("icon-image",lt,f,le);Bt=Ft instanceof Xn?Ft:Xn.fromString(Ft)}if(!xt&&!Bt)continue;const hi=this.sortFeaturesByKey?G.evaluate(lt,{},f):void 0;if(this.features.push({id:ze,text:xt,icon:Bt,index:tt,sourceLayerIndex:Ve,geometry:lt.geometry,properties:Ce.properties,type:Uv[Ce.type],sortKey:hi}),Bt&&($[Bt.name]=!0),xt){const Ft=x.evaluate(lt,{},f).join(","),Ot=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.ah.vertical)>=0;for(const ei of xt.sections)if(ei.image)$[ei.image.name]=!0;else{const Gt=Tu(xt.toString()),Vt=ei.fontStack||Ft,gt=re[Vt]=re[Vt]||{};this.calculateGlyphDependencies(ei.text,gt,Ot,this.allowVerticalPlacement,Gt)}}}w.get("symbol-placement")==="line"&&(this.features=function(Ce){const ze={},tt={},Ve=[];let Ye=0;function lt(Ft){Ve.push(Ce[Ft]),Ye++}function xt(Ft,Ot,ei){const Gt=tt[Ft];return delete tt[Ft],tt[Ot]=Gt,Ve[Gt].geometry[0].pop(),Ve[Gt].geometry[0]=Ve[Gt].geometry[0].concat(ei[0]),Gt}function Bt(Ft,Ot,ei){const Gt=ze[Ot];return delete ze[Ot],ze[Ft]=Gt,Ve[Gt].geometry[0].shift(),Ve[Gt].geometry[0]=ei[0].concat(Ve[Gt].geometry[0]),Gt}function hi(Ft,Ot,ei){const Gt=ei?Ot[0][Ot[0].length-1]:Ot[0][0];return`${Ft}:${Gt.x}:${Gt.y}`}for(let Ft=0;Ft<Ce.length;Ft++){const Ot=Ce[Ft],ei=Ot.geometry,Gt=Ot.text?Ot.text.toString():null;if(!Gt){lt(Ft);continue}const Vt=hi(Gt,ei),gt=hi(Gt,ei,!0);if(Vt in tt&&gt in ze&&tt[Vt]!==ze[gt]){const ti=Bt(Vt,gt,ei),Qt=xt(Vt,gt,Ve[ti].geometry);delete ze[Vt],delete tt[gt],tt[hi(Gt,Ve[Qt].geometry,!0)]=Qt,Ve[ti].geometry=null}else Vt in tt?xt(Vt,gt,ei):gt in ze?Bt(Vt,gt,ei):(lt(Ft),ze[Vt]=Ye-1,tt[gt]=Ye-1)}return Ve.filter(Ft=>Ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,ze)=>Ce.sortKey-ze.sortKey)}update(i,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,f),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const f=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(l[i.segment+1]),w=i.dist(l[i.segment]);const x={};for(let I=i.segment+1;I<l.length;I++)x[I]={x:l[I].x,y:l[I].y,tileUnitDistanceFromAnchor:g},I<l.length-1&&(g+=l[I+1].dist(l[I]));for(let I=i.segment||0;I>=0;I--)x[I]={x:l[I].x,y:l[I].y,tileUnitDistanceFromAnchor:w},I>0&&(w+=l[I-1].dist(l[I]));for(let I=0;I<l.length;I++){const M=x[I];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,l,f,g,w,x,I,M,F,q,G,$){const re=i.indexArray,le=i.layoutVertexArray,ge=i.segments.prepareSegment(4*l.length,le,re,this.canOverlap?x.sortKey:void 0),Ce=this.glyphOffsetArray.length,ze=ge.vertexLength,tt=this.allowVerticalPlacement&&I===h.ah.vertical?Math.PI/2:0,Ve=x.text&&x.text.sections;for(let Ye=0;Ye<l.length;Ye++){const{tl:lt,tr:xt,bl:Bt,br:hi,tex:Ft,pixelOffsetTL:Ot,pixelOffsetBR:ei,minFontScaleX:Gt,minFontScaleY:Vt,glyphOffset:gt,isSDF:ti,sectionIndex:Qt}=l[Ye],bi=ge.vertexLength,un=gt[1];Wh(le,M.x,M.y,lt.x,un+lt.y,Ft.x,Ft.y,f,ti,Ot.x,Ot.y,Gt,Vt),Wh(le,M.x,M.y,xt.x,un+xt.y,Ft.x+Ft.w,Ft.y,f,ti,ei.x,Ot.y,Gt,Vt),Wh(le,M.x,M.y,Bt.x,un+Bt.y,Ft.x,Ft.y+Ft.h,f,ti,Ot.x,ei.y,Gt,Vt),Wh(le,M.x,M.y,hi.x,un+hi.y,Ft.x+Ft.w,Ft.y+Ft.h,f,ti,ei.x,ei.y,Gt,Vt),ad(i.dynamicLayoutVertexArray,M,tt),re.emplaceBack(bi,bi+1,bi+2),re.emplaceBack(bi+1,bi+2,bi+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),Ye!==l.length-1&&Qt===l[Ye+1].sectionIndex||i.programConfigurations.populatePaintArrays(le.length,x,x.index,{},$,Ve&&Ve[Qt])}i.placedSymbolArray.emplaceBack(M.x,M.y,Ce,this.glyphOffsetArray.length-Ce,ze,F,q,M.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],I,0,!1,0,G)}_addCollisionDebugVertex(i,l,f,g,w,x){return l.emplaceBack(0,0),i.emplaceBack(f.x,f.y,g,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(i,l,f,g,w,x,I){const M=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),F=M.vertexLength,q=w.layoutVertexArray,G=w.collisionVertexArray,$=I.anchorX,re=I.anchorY;this._addCollisionDebugVertex(q,G,x,$,re,new y(i,l)),this._addCollisionDebugVertex(q,G,x,$,re,new y(f,l)),this._addCollisionDebugVertex(q,G,x,$,re,new y(f,g)),this._addCollisionDebugVertex(q,G,x,$,re,new y(i,g)),M.vertexLength+=4;const le=w.indexArray;le.emplaceBack(F,F+1),le.emplaceBack(F+1,F+2),le.emplaceBack(F+2,F+3),le.emplaceBack(F+3,F),M.primitiveLength+=4}addDebugCollisionBoxes(i,l,f,g){for(let w=i;w<l;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cd(us,cm.members,tr),this.iconCollisionBox=new cd(us,cm.members,tr);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,f,g,w,x,I,M,F){const q={};for(let G=l;G<f;G++){const $=i.get(G);q.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},q.textFeatureIndex=$.featureIndex;break}for(let G=g;G<w;G++){const $=i.get(G);q.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},q.verticalTextFeatureIndex=$.featureIndex;break}for(let G=x;G<I;G++){const $=i.get(G);q.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},q.iconFeatureIndex=$.featureIndex;break}for(let G=M;G<F;G++){const $=i.get(G);q.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},q.verticalIconFeatureIndex=$.featureIndex;break}return q}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const f=i.placedSymbolArray.get(l),g=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<g;w+=4)i.indexArray.emplaceBack(w,w+1,w+2),i.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),f=Math.cos(i),g=[],w=[],x=[];for(let I=0;I<this.symbolInstances.length;++I){x.push(I);const M=this.symbolInstances.get(I);g.push(0|Math.round(l*M.anchorX+f*M.anchorY)),w.push(M.featureIndex)}return x.sort((I,M)=>g[I]-g[M]||w[M]-w[I]),x}addToSortKeyRanges(i,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,w,x)=>{g>=0&&x.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Em,Im;qt("SymbolBucket",Pc,{omit:["layers","collisionBoxArray","features","compareText"]}),Pc.MAX_GLYPHS=65535,Pc.addDynamicAttributes=ad;var ud={get paint(){return Im=Im||new v({"icon-opacity":new fi(Qe.paint_symbol["icon-opacity"]),"icon-color":new fi(Qe.paint_symbol["icon-color"]),"icon-halo-color":new fi(Qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new fi(Qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fi(Qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Kt(Qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Kt(Qe.paint_symbol["icon-translate-anchor"]),"text-opacity":new fi(Qe.paint_symbol["text-opacity"]),"text-color":new fi(Qe.paint_symbol["text-color"],{runtimeType:nn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new fi(Qe.paint_symbol["text-halo-color"]),"text-halo-width":new fi(Qe.paint_symbol["text-halo-width"]),"text-halo-blur":new fi(Qe.paint_symbol["text-halo-blur"]),"text-translate":new Kt(Qe.paint_symbol["text-translate"]),"text-translate-anchor":new Kt(Qe.paint_symbol["text-translate-anchor"])})},get layout(){return Em=Em||new v({"symbol-placement":new Kt(Qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Kt(Qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Kt(Qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fi(Qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Kt(Qe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Kt(Qe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Kt(Qe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Kt(Qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Kt(Qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Kt(Qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new fi(Qe.layout_symbol["icon-size"]),"icon-text-fit":new Kt(Qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kt(Qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new fi(Qe.layout_symbol["icon-image"]),"icon-rotate":new fi(Qe.layout_symbol["icon-rotate"]),"icon-padding":new fi(Qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Kt(Qe.layout_symbol["icon-keep-upright"]),"icon-offset":new fi(Qe.layout_symbol["icon-offset"]),"icon-anchor":new fi(Qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Kt(Qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Kt(Qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Kt(Qe.layout_symbol["text-rotation-alignment"]),"text-field":new fi(Qe.layout_symbol["text-field"]),"text-font":new fi(Qe.layout_symbol["text-font"]),"text-size":new fi(Qe.layout_symbol["text-size"]),"text-max-width":new fi(Qe.layout_symbol["text-max-width"]),"text-line-height":new Kt(Qe.layout_symbol["text-line-height"]),"text-letter-spacing":new fi(Qe.layout_symbol["text-letter-spacing"]),"text-justify":new fi(Qe.layout_symbol["text-justify"]),"text-radial-offset":new fi(Qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Kt(Qe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new fi(Qe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new fi(Qe.layout_symbol["text-anchor"]),"text-max-angle":new Kt(Qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Kt(Qe.layout_symbol["text-writing-mode"]),"text-rotate":new fi(Qe.layout_symbol["text-rotate"]),"text-padding":new Kt(Qe.layout_symbol["text-padding"]),"text-keep-upright":new Kt(Qe.layout_symbol["text-keep-upright"]),"text-transform":new fi(Qe.layout_symbol["text-transform"]),"text-offset":new fi(Qe.layout_symbol["text-offset"]),"text-allow-overlap":new Kt(Qe.layout_symbol["text-allow-overlap"]),"text-overlap":new Kt(Qe.layout_symbol["text-overlap"]),"text-ignore-placement":new Kt(Qe.layout_symbol["text-ignore-placement"]),"text-optional":new Kt(Qe.layout_symbol["text-optional"])})}};class Am{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Cn,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt("FormatSectionOverride",Am,{omit:["defaultValue"]});class Gh extends u{constructor(i){super(i,ud)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const w of f)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,f,g){const w=this.layout.get(i).evaluate(l,{},f,g),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||La(x.value)||!w?w:function(I,M){return M.replace(/{([^{}]+)}/g,(F,q)=>I&&q in I?String(I[q]):"")}(l.properties,w)}createBucket(i){return new Pc(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of ud.paint.overridableProperties){if(!Gh.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),f=new Am(l),g=new ko(f,l.property.specification);let w=null;w=l.value.kind==="constant"||l.value.kind==="source"?new br("source",g):new So("composite",g,l.value.zoomStops),this.paint._values[i]=new Rs(l.property,w,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&Gh.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const f=i.get("text-field"),g=ud.paint.properties[l];let w=!1;const x=I=>{for(const M of I)if(g.overrides&&g.overrides.hasOverride(M))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Un)x(f.value.value.sections);else if(f.value.kind==="source"){const I=F=>{w||(F instanceof rr&&Ii(F.value)===yr?x(F.value.sections):F instanceof Vo?x(F.sections):F.eachChild(I))},M=f.value;M._styleExpression&&I(M._styleExpression.expression)}return w}}let Mm;var Zv={get paint(){return Mm=Mm||new v({"background-color":new Kt(Qe.paint_background["background-color"]),"background-pattern":new _c(Qe.paint_background["background-pattern"]),"background-opacity":new Kt(Qe.paint_background["background-opacity"])})}};class Wv extends u{constructor(i){super(i,Zv)}}let Pm;var Gv={get paint(){return Pm=Pm||new v({"raster-opacity":new Kt(Qe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Kt(Qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Kt(Qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Kt(Qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Kt(Qe.paint_raster["raster-saturation"]),"raster-contrast":new Kt(Qe.paint_raster["raster-contrast"]),"raster-resampling":new Kt(Qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Kt(Qe.paint_raster["raster-fade-duration"])})}};class Hv extends u{constructor(i){super(i,Gv)}}class Xv extends u{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Kv{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const hd=63710088e-1;class Ja{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ja(ee(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,f=this.lat*l,g=i.lat*l,w=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((i.lng-this.lng)*l);return hd*Math.acos(Math.min(w,1))}static convert(i){if(i instanceof Ja)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Ja(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Ja(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Lm=2*Math.PI*hd;function zm(s){return Lm*Math.cos(s*Math.PI/180)}function Om(s){return(180+s)/360}function Dm(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Fm(s,i){return s/zm(i)}function fd(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Zu{constructor(i,l,f=0){this.x=+i,this.y=+l,this.z=+f}static fromLngLat(i,l=0){const f=Ja.convert(i);return new Zu(Om(f.lng),Dm(f.lat),Fm(l,f.lat))}toLngLat(){return new Ja(360*this.x-180,fd(this.y))}toAltitude(){return this.z*zm(fd(this.y))}meterInMercatorCoordinateUnits(){return 1/Lm*(i=fd(this.y),1/Math.cos(i*Math.PI/180));var i}}function Rm(s,i,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class dd{constructor(i,l,f){if(!function(g,w,x){return!(g<0||g>25||x<0||x>=Math.pow(2,g)||w<0||w>=Math.pow(2,g))}(i,l,f))throw new Error(`x=${l}, y=${f}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=f,this.key=Wu(0,i,i,l,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,f){const g=(x=this.y,I=this.z,M=Rm(256*(w=this.x),256*(x=Math.pow(2,I)-x-1),I),F=Rm(256*(w+1),256*(x+1),I),M[0]+","+M[1]+","+F[0]+","+F[1]);var w,x,I,M,F;const q=function(G,$,re){let le,ge="";for(let Ce=G;Ce>0;Ce--)le=1<<Ce-1,ge+=($&le?1:0)+(re&le?2:0);return ge}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,q).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new y((i.x*l-this.x)*Nn,(i.y*l-this.y)*Nn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Bm{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Wu(i,l.z,l.z,l.x,l.y)}}class vs{constructor(i,l,f,g,w){if(i<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${f}`);this.overscaledZ=i,this.wrap=l,this.canonical=new dd(f,+g,+w),this.key=Wu(l,i,f,g,w)}clone(){return new vs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new vs(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vs(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-i;return i>this.canonical.z?Wu(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):Wu(this.wrap*+l,i,i,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new vs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new vs(l,this.wrap,l,f,g),new vs(l,this.wrap,l,f+1,g),new vs(l,this.wrap,l,f,g+1),new vs(l,this.wrap,l,f+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new vs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new vs(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Bm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Zu(i.x-this.wrap,i.y))}}function Wu(s,i,l,f,g){(s*=2)<0&&(s=-1*s-1);const w=1<<l;return(w*w*s+w*g+f).toString(36)+l.toString(36)+i.toString(36)}qt("CanonicalTileID",dd),qt("OverscaledTileID",vs,{omit:["posMatrix"]});class Nm{constructor(i,l,f,g=1,w=1,x=1,I=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void ce(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const M=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=x,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<M;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(M,F)]=this.data[this._idx(M-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,M)]=this.data[this._idx(F,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<M;F++)for(let q=0;q<M;q++){const G=this.get(F,q);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(i,l){const f=new Uint8Array(this.data.buffer),g=4*this._idx(i,l);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}unpack(i,l,f){return i*this.redFactor+l*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new bs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,w=l*this.dim+this.dim,x=f*this.dim,I=f*this.dim+this.dim;switch(l){case-1:g=w-1;break;case 1:w=g+1}switch(f){case-1:x=I-1;break;case 1:I=x+1}const M=-l*this.dim,F=-f*this.dim;for(let q=x;q<I;q++)for(let G=g;G<w;G++)this.data[this._idx(G,q)]=i.data[this._idx(G+M,q+F)]}}qt("DEMData",Nm);class jm{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const f=i[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Um{constructor(i,l,f,g,w){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=f,i._y=g,this.properties=i.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(i[l]=this[l]);return i}}class Vm{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Fa(Nn,16,0),this.grid3D=new Fa(Nn,16,0),this.featureIndexArray=new xr,this.promoteId=l}insert(i,l,f,g,w,x){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,w);const M=x?this.grid3D:this.grid;for(let F=0;F<l.length;F++){const q=l[F],G=[1/0,1/0,-1/0,-1/0];for(let $=0;$<q.length;$++){const re=q[$];G[0]=Math.min(G[0],re.x),G[1]=Math.min(G[1],re.y),G[2]=Math.max(G[2],re.x),G[3]=Math.max(G[3],re.y)}G[0]<Nn&&G[1]<Nn&&G[2]>=0&&G[3]>=0&&M.insert(I,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ha.VectorTile(new td(this.rawTileData)).layers,this.sourceLayerCoder=new jm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,f,g){this.loadVTLayers();const w=i.params||{},x=Nn/i.tileSize/i.scale,I=yl(w.filter),M=i.queryGeometry,F=i.queryPadding*x,q=Zm(M),G=this.grid.query(q.minX-F,q.minY-F,q.maxX+F,q.maxY+F),$=Zm(i.cameraQueryGeometry),re=this.grid3D.query($.minX-F,$.minY-F,$.maxX+F,$.maxY+F,(Ce,ze,tt,Ve)=>function(Ye,lt,xt,Bt,hi){for(const Ot of Ye)if(lt<=Ot.x&&xt<=Ot.y&&Bt>=Ot.x&&hi>=Ot.y)return!0;const Ft=[new y(lt,xt),new y(lt,hi),new y(Bt,hi),new y(Bt,xt)];if(Ye.length>2){for(const Ot of Ft)if(Sc(Ye,Ot))return!0}for(let Ot=0;Ot<Ye.length-1;Ot++)if(Ab(Ye[Ot],Ye[Ot+1],Ft))return!0;return!1}(i.cameraQueryGeometry,Ce-F,ze-F,tt+F,Ve+F));for(const Ce of re)G.push(Ce);G.sort(Jv);const le={};let ge;for(let Ce=0;Ce<G.length;Ce++){const ze=G[Ce];if(ze===ge)continue;ge=ze;const tt=this.featureIndexArray.get(ze);let Ve=null;this.loadMatchingFeature(le,tt.bucketIndex,tt.sourceLayerIndex,tt.featureIndex,I,w.layers,w.availableImages,l,f,g,(Ye,lt,xt)=>(Ve||(Ve=Il(Ye)),lt.queryIntersectsFeature(M,Ye,xt,Ve,this.z,i.transform,x,i.pixelPosMatrix)))}return le}loadMatchingFeature(i,l,f,g,w,x,I,M,F,q,G){const $=this.bucketLayerIDs[l];if(x&&!function(Ce,ze){for(let tt=0;tt<Ce.length;tt++)if(ze.indexOf(Ce[tt])>=0)return!0;return!1}(x,$))return;const re=this.sourceLayerCoder.decode(f),le=this.vtLayers[re].feature(g);if(w.needGeometry){const Ce=Al(le,!0);if(!w.filter(new mn(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!w.filter(new mn(this.tileID.overscaledZ),le))return;const ge=this.getId(le,re);for(let Ce=0;Ce<$.length;Ce++){const ze=$[Ce];if(x&&x.indexOf(ze)<0)continue;const tt=M[ze];if(!tt)continue;let Ve={};ge&&q&&(Ve=q.getState(tt.sourceLayer||"_geojsonTileLayer",ge));const Ye=ne({},F[ze]);Ye.paint=qm(Ye.paint,tt.paint,le,Ve,I),Ye.layout=qm(Ye.layout,tt.layout,le,Ve,I);const lt=!G||G(le,tt,Ve);if(!lt)continue;const xt=new Um(le,this.z,this.x,this.y,ge);xt.layer=Ye;let Bt=i[ze];Bt===void 0&&(Bt=i[ze]=[]),Bt.push({featureIndex:g,feature:xt,intersectionZ:lt})}}lookupSymbolFeatures(i,l,f,g,w,x,I,M){const F={};this.loadVTLayers();const q=yl(w);for(const G of i)this.loadMatchingFeature(F,f,g,G,q,x,I,M,l);return F}hasLayer(i){for(const l of this.bucketLayerIDs)for(const f of l)if(i===f)return!0;return!1}getId(i,l){let f=i.id;return this.promoteId&&(f=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof f=="boolean"&&(f=Number(f))),f}}function qm(s,i,l,f,g){return U(s,(w,x)=>{const I=i instanceof Sl?i.get(x):null;return I&&I.evaluate?I.evaluate(l,f,g):I})}function Zm(s){let i=1/0,l=1/0,f=-1/0,g=-1/0;for(const w of s)i=Math.min(i,w.x),l=Math.min(l,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);return{minX:i,minY:l,maxX:f,maxY:g}}function Jv(s,i){return i-s}function Wm(s,i,l,f,g){const w=[];for(let x=0;x<s.length;x++){const I=s[x];let M;for(let F=0;F<I.length-1;F++){let q=I[F],G=I[F+1];q.x<i&&G.x<i||(q.x<i?q=new y(i,q.y+(i-q.x)/(G.x-q.x)*(G.y-q.y))._round():G.x<i&&(G=new y(i,q.y+(i-q.x)/(G.x-q.x)*(G.y-q.y))._round()),q.y<l&&G.y<l||(q.y<l?q=new y(q.x+(l-q.y)/(G.y-q.y)*(G.x-q.x),l)._round():G.y<l&&(G=new y(q.x+(l-q.y)/(G.y-q.y)*(G.x-q.x),l)._round()),q.x>=f&&G.x>=f||(q.x>=f?q=new y(f,q.y+(f-q.x)/(G.x-q.x)*(G.y-q.y))._round():G.x>=f&&(G=new y(f,q.y+(f-q.x)/(G.x-q.x)*(G.y-q.y))._round()),q.y>=g&&G.y>=g||(q.y>=g?q=new y(q.x+(g-q.y)/(G.y-q.y)*(G.x-q.x),g)._round():G.y>=g&&(G=new y(q.x+(g-q.y)/(G.y-q.y)*(G.x-q.x),g)._round()),M&&q.equals(M[M.length-1])||(M=[q],w.push(M)),M.push(G)))))}}return w}qt("FeatureIndex",Vm,{omit:["rawTileData","sourceLayerCoder"]});class Ya extends y{constructor(i,l,f,g){super(i,l),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new Ya(this.x,this.y,this.angle,this.segment)}}function Gm(s,i,l,f,g){if(i.segment===void 0||l===0)return!0;let w=i,x=i.segment+1,I=0;for(;I>-l/2;){if(x--,x<0)return!1;I-=s[x].dist(w),w=s[x]}I+=s[x].dist(s[x+1]),x++;const M=[];let F=0;for(;I<l/2;){const q=s[x],G=s[x+1];if(!G)return!1;let $=s[x-1].angleTo(q)-q.angleTo(G);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:I,angleDelta:$}),F+=$;I-M[0].distance>f;)F-=M.shift().angleDelta;if(F>g)return!1;x++,I+=q.dist(G)}return!0}function Hm(s){let i=0;for(let l=0;l<s.length-1;l++)i+=s[l].dist(s[l+1]);return i}function Xm(s,i,l){return s?.6*i*l:0}function Km(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function Yv(s,i,l,f,g,w){const x=Xm(l,g,w),I=Km(l,f)*w;let M=0;const F=Hm(s)/2;for(let q=0;q<s.length-1;q++){const G=s[q],$=s[q+1],re=G.dist($);if(M+re>F){const le=(F-M)/re,ge=Vn.number(G.x,$.x,le),Ce=Vn.number(G.y,$.y,le),ze=new Ya(ge,Ce,$.angleTo(G),q);return ze._round(),!x||Gm(s,ze,I,x,i)?ze:void 0}M+=re}}function Qv(s,i,l,f,g,w,x,I,M){const F=Xm(f,w,x),q=Km(f,g),G=q*x,$=s[0].x===0||s[0].x===M||s[0].y===0||s[0].y===M;return i-G<i/4&&(i=G+i/4),Jm(s,$?i/2*I%i:(q/2+2*w)*x*I%i,i,F,l,G,$,!1,M)}function Jm(s,i,l,f,g,w,x,I,M){const F=w/2,q=Hm(s);let G=0,$=i-l,re=[];for(let le=0;le<s.length-1;le++){const ge=s[le],Ce=s[le+1],ze=ge.dist(Ce),tt=Ce.angleTo(ge);for(;$+l<G+ze;){$+=l;const Ve=($-G)/ze,Ye=Vn.number(ge.x,Ce.x,Ve),lt=Vn.number(ge.y,Ce.y,Ve);if(Ye>=0&&Ye<M&&lt>=0&&lt<M&&$-F>=0&&$+F<=q){const xt=new Ya(Ye,lt,tt,le);xt._round(),f&&!Gm(s,xt,w,f,g)||re.push(xt)}}G+=ze}return I||re.length||x||(re=Jm(s,G/2,l,f,g,w,x,!0,M)),re}qt("Anchor",Ya);const Lc=Kr;function Ym(s,i,l,f){const g=[],w=s.image,x=w.pixelRatio,I=w.paddedRect.w-2*Lc,M=w.paddedRect.h-2*Lc;let F={x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};const q=w.stretchX||[[0,I]],G=w.stretchY||[[0,M]],$=(gt,ti)=>gt+ti[1]-ti[0],re=q.reduce($,0),le=G.reduce($,0),ge=I-re,Ce=M-le;let ze=0,tt=re,Ve=0,Ye=le,lt=0,xt=ge,Bt=0,hi=Ce;if(w.content&&f){const gt=w.content,ti=gt[2]-gt[0],Qt=gt[3]-gt[1];(w.textFitWidth||w.textFitHeight)&&(F=Sm(s)),ze=Hh(q,0,gt[0]),Ve=Hh(G,0,gt[1]),tt=Hh(q,gt[0],gt[2]),Ye=Hh(G,gt[1],gt[3]),lt=gt[0]-ze,Bt=gt[1]-Ve,xt=ti-tt,hi=Qt-Ye}const Ft=F.x1,Ot=F.y1,ei=F.x2-Ft,Gt=F.y2-Ot,Vt=(gt,ti,Qt,bi)=>{const un=Xh(gt.stretch-ze,tt,ei,Ft),sn=Kh(gt.fixed-lt,xt,gt.stretch,re),Kn=Xh(ti.stretch-Ve,Ye,Gt,Ot),Ns=Kh(ti.fixed-Bt,hi,ti.stretch,le),cr=Xh(Qt.stretch-ze,tt,ei,Ft),Jn=Kh(Qt.fixed-lt,xt,Qt.stretch,re),Dr=Xh(bi.stretch-Ve,Ye,Gt,Ot),Fr=Kh(bi.fixed-Bt,hi,bi.stretch,le),Rr=new y(un,Kn),Ln=new y(cr,Kn),Yn=new y(cr,Dr),Sr=new y(un,Dr),ur=new y(sn/x,Ns/x),Br=new y(Jn/x,Fr/x),hr=i*Math.PI/180;if(hr){const Yi=Math.sin(hr),dn=Math.cos(hr),bn=[dn,-Yi,Yi,dn];Rr._matMult(bn),Ln._matMult(bn),Sr._matMult(bn),Yn._matMult(bn)}const ws=gt.stretch+gt.fixed,Jr=ti.stretch+ti.fixed;return{tl:Rr,tr:Ln,bl:Sr,br:Yn,tex:{x:w.paddedRect.x+Lc+ws,y:w.paddedRect.y+Lc+Jr,w:Qt.stretch+Qt.fixed-ws,h:bi.stretch+bi.fixed-Jr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ur,pixelOffsetBR:Br,minFontScaleX:xt/x/ei,minFontScaleY:hi/x/Gt,isSDF:l}};if(f&&(w.stretchX||w.stretchY)){const gt=Qm(q,ge,re),ti=Qm(G,Ce,le);for(let Qt=0;Qt<gt.length-1;Qt++){const bi=gt[Qt],un=gt[Qt+1];for(let sn=0;sn<ti.length-1;sn++)g.push(Vt(bi,ti[sn],un,ti[sn+1]))}}else g.push(Vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:M+1}));return g}function Hh(s,i,l){let f=0;for(const g of s)f+=Math.max(i,Math.min(l,g[1]))-Math.max(i,Math.min(l,g[0]));return f}function Qm(s,i,l){const f=[{fixed:-Lc,stretch:0}];for(const[g,w]of s){const x=f[f.length-1];f.push({fixed:g-x.stretch,stretch:x.stretch}),f.push({fixed:g-x.stretch,stretch:x.stretch+(w-g)})}return f.push({fixed:i+Lc,stretch:l}),f}function Xh(s,i,l,f){return s/i*l+f}function Kh(s,i,l,f){return s-i*l/f}class Jh{constructor(i,l,f,g,w,x,I,M,F,q){var G;if(this.boxStartIndex=i.length,F){let $=x.top,re=x.bottom;const le=x.collisionPadding;le&&($-=le[1],re+=le[3]);let ge=re-$;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{const $=!((G=x.image)===null||G===void 0)&&G.content&&(x.image.textFitWidth||x.image.textFitHeight)?Sm(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};$.y1=$.y1*I-M[0],$.y2=$.y2*I+M[2],$.x1=$.x1*I-M[3],$.x2=$.x2*I+M[1];const re=x.collisionPadding;if(re&&($.x1-=re[0]*I,$.y1-=re[1]*I,$.x2+=re[2]*I,$.y2+=re[3]*I),q){const le=new y($.x1,$.y1),ge=new y($.x2,$.y1),Ce=new y($.x1,$.y2),ze=new y($.x2,$.y2),tt=q*Math.PI/180;le._rotate(tt),ge._rotate(tt),Ce._rotate(tt),ze._rotate(tt),$.x1=Math.min(le.x,ge.x,Ce.x,ze.x),$.x2=Math.max(le.x,ge.x,Ce.x,ze.x),$.y1=Math.min(le.y,ge.y,Ce.y,ze.y),$.y2=Math.max(le.y,ge.y,Ce.y,ze.y)}i.emplaceBack(l.x,l.y,$.x1,$.y1,$.x2,$.y2,f,g,w)}this.boxEndIndex=i.length}}class $v{constructor(i=[],l=(f,g)=>f<g?-1:f>g?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:f}=this,g=l[i];for(;i>0;){const w=i-1>>1,x=l[w];if(f(g,x)>=0)break;l[i]=x,i=w}l[i]=g}_down(i){const{data:l,compare:f}=this,g=this.length>>1,w=l[i];for(;i<g;){let x=1+(i<<1);const I=x+1;if(I<this.length&&f(l[I],l[x])<0&&(x=I),f(l[x],w)>=0)break;l[i]=l[x],i=x}l[i]=w}}function e1(s,i=1,l=!1){let f=1/0,g=1/0,w=-1/0,x=-1/0;const I=s[0];for(let re=0;re<I.length;re++){const le=I[re];(!re||le.x<f)&&(f=le.x),(!re||le.y<g)&&(g=le.y),(!re||le.x>w)&&(w=le.x),(!re||le.y>x)&&(x=le.y)}const M=Math.min(w-f,x-g);let F=M/2;const q=new $v([],t1);if(M===0)return new y(f,g);for(let re=f;re<w;re+=M)for(let le=g;le<x;le+=M)q.push(new zc(re+F,le+F,F,s));let G=function(re){let le=0,ge=0,Ce=0;const ze=re[0];for(let tt=0,Ve=ze.length,Ye=Ve-1;tt<Ve;Ye=tt++){const lt=ze[tt],xt=ze[Ye],Bt=lt.x*xt.y-xt.x*lt.y;ge+=(lt.x+xt.x)*Bt,Ce+=(lt.y+xt.y)*Bt,le+=3*Bt}return new zc(ge/le,Ce/le,0,re)}(s),$=q.length;for(;q.length;){const re=q.pop();(re.d>G.d||!G.d)&&(G=re,l&&console.log("found best %d after %d probes",Math.round(1e4*re.d)/1e4,$)),re.max-G.d<=i||(F=re.h/2,q.push(new zc(re.p.x-F,re.p.y-F,F,s)),q.push(new zc(re.p.x+F,re.p.y-F,F,s)),q.push(new zc(re.p.x-F,re.p.y+F,F,s)),q.push(new zc(re.p.x+F,re.p.y+F,F,s)),$+=4)}return l&&(console.log(`num probes: ${$}`),console.log(`best distance: ${G.d}`)),G.p}function t1(s,i){return i.max-s.max}function zc(s,i,l,f){this.p=new y(s,i),this.h=l,this.d=function(g,w){let x=!1,I=1/0;for(let M=0;M<w.length;M++){const F=w[M];for(let q=0,G=F.length,$=G-1;q<G;$=q++){const re=F[q],le=F[$];re.y>g.y!=le.y>g.y&&g.x<(le.x-re.x)*(g.y-re.y)/(le.y-re.y)+re.x&&(x=!x),I=Math.min(I,Dp(g,re,le))}}return(x?1:-1)*Math.sqrt(I)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var lr;h.aq=void 0,(lr=h.aq||(h.aq={}))[lr.center=1]="center",lr[lr.left=2]="left",lr[lr.right=3]="right",lr[lr.top=4]="top",lr[lr.bottom=5]="bottom",lr[lr["top-left"]=6]="top-left",lr[lr["top-right"]=7]="top-right",lr[lr["bottom-left"]=8]="bottom-left",lr[lr["bottom-right"]=9]="bottom-right";const Qa=7,pd=Number.POSITIVE_INFINITY;function $m(s,i){return i[1]!==pd?function(l,f,g){let w=0,x=0;switch(f=Math.abs(f),g=Math.abs(g),l){case"top-right":case"top-left":case"top":x=g-Qa;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+Qa}switch(l){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,x]}(s,i[0],i[1]):function(l,f){let g=0,w=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(l){case"top-right":case"top-left":w=x-Qa;break;case"bottom-right":case"bottom-left":w=-x+Qa;break;case"bottom":w=-f+Qa;break;case"top":w=f-Qa}switch(l){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=f;break;case"right":g=-f}return[g,w]}(s,i[0])}function eg(s,i,l){var f;const g=s.layout,w=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(i,{},l);if(w){const I=w.values,M=[];for(let F=0;F<I.length;F+=2){const q=M[F]=I[F],G=I[F+1].map($=>$*qn);q.startsWith("top")?G[1]-=Qa:q.startsWith("bottom")&&(G[1]+=Qa),M[F+1]=G}return new zn(M)}const x=g.get("text-variable-anchor");if(x){let I;I=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},l)*qn,pd]:g.get("text-offset").evaluate(i,{},l).map(F=>F*qn);const M=[];for(const F of x)M.push(F,$m(F,I));return new zn(M)}return null}function md(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function i1(s,i,l,f,g,w,x,I,M,F,q){let G=w.textMaxSize.evaluate(i,{});G===void 0&&(G=x);const $=s.layers[0].layout,re=$.get("icon-offset").evaluate(i,{},q),le=ig(l.horizontal),ge=x/24,Ce=s.tilePixelRatio*ge,ze=s.tilePixelRatio*G/24,tt=s.tilePixelRatio*I,Ve=s.tilePixelRatio*$.get("symbol-spacing"),Ye=$.get("text-padding")*s.tilePixelRatio,lt=function(gt,ti,Qt,bi=1){const un=gt.get("icon-padding").evaluate(ti,{},Qt),sn=un&&un.values;return[sn[0]*bi,sn[1]*bi,sn[2]*bi,sn[3]*bi]}($,i,q,s.tilePixelRatio),xt=$.get("text-max-angle")/180*Math.PI,Bt=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",hi=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Ft=$.get("symbol-placement"),Ot=Ve/2,ei=$.get("icon-text-fit");let Gt;f&&ei!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(Gt=Tm(f,l.vertical,ei,$.get("icon-text-fit-padding"),re,ge)),le&&(f=Tm(f,le,ei,$.get("icon-text-fit-padding"),re,ge)));const Vt=(gt,ti)=>{ti.x<0||ti.x>=Nn||ti.y<0||ti.y>=Nn||function(Qt,bi,un,sn,Kn,Ns,cr,Jn,Dr,Fr,Rr,Ln,Yn,Sr,ur,Br,hr,ws,Jr,Yi,dn,bn,hs,An,Oc){const Mo=Qt.addToLineVertexArray(bi,un);let Po,js,xs,ir,la=0,Xu=0,og=0,ag=0,kd=-1,Sd=-1;const ca={};let lg=vc("");if(Qt.allowVerticalPlacement&&sn.vertical){const Tr=Jn.layout.get("text-rotate").evaluate(dn,{},An)+90;xs=new Jh(Dr,bi,Fr,Rr,Ln,sn.vertical,Yn,Sr,ur,Tr),cr&&(ir=new Jh(Dr,bi,Fr,Rr,Ln,cr,hr,ws,ur,Tr))}if(Kn){const Tr=Jn.layout.get("icon-rotate").evaluate(dn,{}),ks=Jn.layout.get("icon-text-fit")!=="none",Pl=Ym(Kn,Tr,hs,ks),co=cr?Ym(cr,Tr,hs,ks):void 0;js=new Jh(Dr,bi,Fr,Rr,Ln,Kn,hr,ws,!1,Tr),la=4*Pl.length;const Ll=Qt.iconSizeData;let Lo=null;Ll.kind==="source"?(Lo=[Ao*Jn.layout.get("icon-size").evaluate(dn,{})],Lo[0]>Ka&&ce(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${qu}. Reduce your "icon-size".`)):Ll.kind==="composite"&&(Lo=[Ao*bn.compositeIconSizes[0].evaluate(dn,{},An),Ao*bn.compositeIconSizes[1].evaluate(dn,{},An)],(Lo[0]>Ka||Lo[1]>Ka)&&ce(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${qu}. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,Pl,Lo,Yi,Jr,dn,h.ah.none,bi,Mo.lineStartIndex,Mo.lineLength,-1,An),kd=Qt.icon.placedSymbolArray.length-1,co&&(Xu=4*co.length,Qt.addSymbols(Qt.icon,co,Lo,Yi,Jr,dn,h.ah.vertical,bi,Mo.lineStartIndex,Mo.lineLength,-1,An),Sd=Qt.icon.placedSymbolArray.length-1)}const cg=Object.keys(sn.horizontal);for(const Tr of cg){const ks=sn.horizontal[Tr];if(!Po){lg=vc(ks.text);const co=Jn.layout.get("text-rotate").evaluate(dn,{},An);Po=new Jh(Dr,bi,Fr,Rr,Ln,ks,Yn,Sr,ur,co)}const Pl=ks.positionedLines.length===1;if(og+=tg(Qt,bi,ks,Ns,Jn,ur,dn,Br,Mo,sn.vertical?h.ah.horizontal:h.ah.horizontalOnly,Pl?cg:[Tr],ca,kd,bn,An),Pl)break}sn.vertical&&(ag+=tg(Qt,bi,sn.vertical,Ns,Jn,ur,dn,Br,Mo,h.ah.vertical,["vertical"],ca,Sd,bn,An));const s1=Po?Po.boxStartIndex:Qt.collisionBoxArray.length,o1=Po?Po.boxEndIndex:Qt.collisionBoxArray.length,a1=xs?xs.boxStartIndex:Qt.collisionBoxArray.length,l1=xs?xs.boxEndIndex:Qt.collisionBoxArray.length,c1=js?js.boxStartIndex:Qt.collisionBoxArray.length,u1=js?js.boxEndIndex:Qt.collisionBoxArray.length,h1=ir?ir.boxStartIndex:Qt.collisionBoxArray.length,f1=ir?ir.boxEndIndex:Qt.collisionBoxArray.length;let lo=-1;const Qh=(Tr,ks)=>Tr&&Tr.circleDiameter?Math.max(Tr.circleDiameter,ks):ks;lo=Qh(Po,lo),lo=Qh(xs,lo),lo=Qh(js,lo),lo=Qh(ir,lo);const ug=lo>-1?1:0;ug&&(lo*=Oc/qn),Qt.glyphOffsetArray.length>=Pc.MAX_GLYPHS&&ce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dn.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,dn.sortKey);const d1=eg(Jn,dn,An),[p1,m1]=function(Tr,ks){const Pl=Tr.length,co=ks==null?void 0:ks.values;if((co==null?void 0:co.length)>0)for(let Ll=0;Ll<co.length;Ll+=2){const Lo=co[Ll+1];Tr.emplaceBack(h.aq[co[Ll]],Lo[0],Lo[1])}return[Pl,Tr.length]}(Qt.textAnchorOffsets,d1);Qt.symbolInstances.emplaceBack(bi.x,bi.y,ca.right>=0?ca.right:-1,ca.center>=0?ca.center:-1,ca.left>=0?ca.left:-1,ca.vertical||-1,kd,Sd,lg,s1,o1,a1,l1,c1,u1,h1,f1,Fr,og,ag,la,Xu,ug,0,Yn,lo,p1,m1)}(s,ti,gt,l,f,g,Gt,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,Ce,[Ye,Ye,Ye,Ye],Bt,M,tt,lt,hi,re,i,w,F,q,x)};if(Ft==="line")for(const gt of Wm(i.geometry,0,0,Nn,Nn)){const ti=Qv(gt,Ve,xt,l.vertical||le,f,24,ze,s.overscaling,Nn);for(const Qt of ti)le&&n1(s,le.text,Ot,Qt)||Vt(gt,Qt)}else if(Ft==="line-center"){for(const gt of i.geometry)if(gt.length>1){const ti=Yv(gt,xt,l.vertical||le,f,24,ze);ti&&Vt(gt,ti)}}else if(i.type==="Polygon")for(const gt of Ca(i.geometry,0)){const ti=e1(gt,16);Vt(gt[0],new Ya(ti.x,ti.y,0))}else if(i.type==="LineString")for(const gt of i.geometry)Vt(gt,new Ya(gt[0].x,gt[0].y,0));else if(i.type==="Point")for(const gt of i.geometry)for(const ti of gt)Vt([ti],new Ya(ti.x,ti.y,0))}function tg(s,i,l,f,g,w,x,I,M,F,q,G,$,re,le){const ge=function(tt,Ve,Ye,lt,xt,Bt,hi,Ft){const Ot=lt.layout.get("text-rotate").evaluate(Bt,{})*Math.PI/180,ei=[];for(const Gt of Ve.positionedLines)for(const Vt of Gt.positionedGlyphs){if(!Vt.rect)continue;const gt=Vt.rect||{};let ti=_m+1,Qt=!0,bi=1,un=0;const sn=(xt||Ft)&&Vt.vertical,Kn=Vt.metrics.advance*Vt.scale/2;if(Ft&&Ve.verticalizable&&(un=Gt.lineOffset/2-(Vt.imageName?-(qn-Vt.metrics.width*Vt.scale)/2:(Vt.scale-1)*qn)),Vt.imageName){const Yi=hi[Vt.imageName];Qt=Yi.sdf,bi=Yi.pixelRatio,ti=Kr/bi}const Ns=xt?[Vt.x+Kn,Vt.y]:[0,0];let cr=xt?[0,0]:[Vt.x+Kn+Ye[0],Vt.y+Ye[1]-un],Jn=[0,0];sn&&(Jn=cr,cr=[0,0]);const Dr=Vt.metrics.isDoubleResolution?2:1,Fr=(Vt.metrics.left-ti)*Vt.scale-Kn+cr[0],Rr=(-Vt.metrics.top-ti)*Vt.scale+cr[1],Ln=Fr+gt.w/Dr*Vt.scale/bi,Yn=Rr+gt.h/Dr*Vt.scale/bi,Sr=new y(Fr,Rr),ur=new y(Ln,Rr),Br=new y(Fr,Yn),hr=new y(Ln,Yn);if(sn){const Yi=new y(-Kn,Kn-Uu),dn=-Math.PI/2,bn=qn/2-Kn,hs=new y(5-Uu-bn,-(Vt.imageName?bn:0)),An=new y(...Jn);Sr._rotateAround(dn,Yi)._add(hs)._add(An),ur._rotateAround(dn,Yi)._add(hs)._add(An),Br._rotateAround(dn,Yi)._add(hs)._add(An),hr._rotateAround(dn,Yi)._add(hs)._add(An)}if(Ot){const Yi=Math.sin(Ot),dn=Math.cos(Ot),bn=[dn,-Yi,Yi,dn];Sr._matMult(bn),ur._matMult(bn),Br._matMult(bn),hr._matMult(bn)}const ws=new y(0,0),Jr=new y(0,0);ei.push({tl:Sr,tr:ur,bl:Br,br:hr,tex:gt,writingMode:Ve.writingMode,glyphOffset:Ns,sectionIndex:Vt.sectionIndex,isSDF:Qt,pixelOffsetTL:ws,pixelOffsetBR:Jr,minFontScaleX:0,minFontScaleY:0})}return ei}(0,l,I,g,w,x,f,s.allowVerticalPlacement),Ce=s.textSizeData;let ze=null;Ce.kind==="source"?(ze=[Ao*g.layout.get("text-size").evaluate(x,{})],ze[0]>Ka&&ce(`${s.layerIds[0]}: Value for "text-size" is >= ${qu}. Reduce your "text-size".`)):Ce.kind==="composite"&&(ze=[Ao*re.compositeTextSizes[0].evaluate(x,{},le),Ao*re.compositeTextSizes[1].evaluate(x,{},le)],(ze[0]>Ka||ze[1]>Ka)&&ce(`${s.layerIds[0]}: Value for "text-size" is >= ${qu}. Reduce your "text-size".`)),s.addSymbols(s.text,ge,ze,I,w,x,F,i,M.lineStartIndex,M.lineLength,$,le);for(const tt of q)G[tt]=s.text.placedSymbolArray.length-1;return 4*ge.length}function ig(s){for(const i in s)return s[i];return null}function n1(s,i,l,f){const g=s.compareText;if(i in g){const w=g[i];for(let x=w.length-1;x>=0;x--)if(f.dist(w[x])<l)return!0}else g[i]=[];return g[i].push(f),!1}const ng=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gd{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,f]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=ng[15&f];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(i,2,1),[I]=new Uint32Array(i,4,1);return new gd(I,x,w,i)}constructor(i,l=64,f=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const w=ng.indexOf(this.ArrayType),x=2*i*this.ArrayType.BYTES_PER_ELEMENT,I=i*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-I%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+I+M,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+x+I+M),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+I+M,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=l,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return _d(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:I}=this,M=[0,w.length-1,0],F=[];for(;M.length;){const q=M.pop()||0,G=M.pop()||0,$=M.pop()||0;if(G-$<=I){for(let Ce=$;Ce<=G;Ce++){const ze=x[2*Ce],tt=x[2*Ce+1];ze>=i&&ze<=f&&tt>=l&&tt<=g&&F.push(w[Ce])}continue}const re=$+G>>1,le=x[2*re],ge=x[2*re+1];le>=i&&le<=f&&ge>=l&&ge<=g&&F.push(w[re]),(q===0?i<=le:l<=ge)&&(M.push($),M.push(re-1),M.push(1-q)),(q===0?f>=le:g>=ge)&&(M.push(re+1),M.push(G),M.push(1-q))}return F}within(i,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:x}=this,I=[0,g.length-1,0],M=[],F=f*f;for(;I.length;){const q=I.pop()||0,G=I.pop()||0,$=I.pop()||0;if(G-$<=x){for(let Ce=$;Ce<=G;Ce++)sg(w[2*Ce],w[2*Ce+1],i,l)<=F&&M.push(g[Ce]);continue}const re=$+G>>1,le=w[2*re],ge=w[2*re+1];sg(le,ge,i,l)<=F&&M.push(g[re]),(q===0?i-f<=le:l-f<=ge)&&(I.push($),I.push(re-1),I.push(1-q)),(q===0?i+f>=le:l+f>=ge)&&(I.push(re+1),I.push(G),I.push(1-q))}return M}}function _d(s,i,l,f,g,w){if(g-f<=l)return;const x=f+g>>1;rg(s,i,x,f,g,w),_d(s,i,l,f,x-1,1-w),_d(s,i,l,x+1,g,1-w)}function rg(s,i,l,f,g,w){for(;g>f;){if(g-f>600){const F=g-f+1,q=l-f+1,G=Math.log(F),$=.5*Math.exp(2*G/3),re=.5*Math.sqrt(G*$*(F-$)/F)*(q-F/2<0?-1:1);rg(s,i,l,Math.max(f,Math.floor(l-q*$/F+re)),Math.min(g,Math.floor(l+(F-q)*$/F+re)),w)}const x=i[2*l+w];let I=f,M=g;for(Gu(s,i,f,l),i[2*g+w]>x&&Gu(s,i,f,g);I<M;){for(Gu(s,i,I,M),I++,M--;i[2*I+w]<x;)I++;for(;i[2*M+w]>x;)M--}i[2*f+w]===x?Gu(s,i,f,M):(M++,Gu(s,i,M,g)),M<=l&&(f=M+1),l<=M&&(g=M-1)}}function Gu(s,i,l,f){yd(s,l,f),yd(i,2*l,2*f),yd(i,2*l+1,2*f+1)}function yd(s,i,l){const f=s[i];s[i]=s[l],s[l]=f}function sg(s,i,l,f){const g=s-l,w=i-f;return g*g+w*w}var bd;h.bg=void 0,(bd=h.bg||(h.bg={})).create="create",bd.load="load",bd.fullLoad="fullLoad";let Yh=null,Hu=[];const vd=1e3/60,wd="loadTime",xd="fullLoadTime",r1={mark(s){performance.mark(s)},frame(s){const i=s;Yh!=null&&Hu.push(i-Yh),Yh=i},clearMetrics(){Yh=null,Hu=[],performance.clearMeasures(wd),performance.clearMeasures(xd);for(const s in h.bg)performance.clearMarks(h.bg[s])},getPerformanceMetrics(){performance.measure(wd,h.bg.create,h.bg.load),performance.measure(xd,h.bg.create,h.bg.fullLoad);const s=performance.getEntriesByName(wd)[0].duration,i=performance.getEntriesByName(xd)[0].duration,l=Hu.length,f=1/(Hu.reduce((w,x)=>w+x,0)/l/1e3),g=Hu.filter(w=>w>vd).reduce((w,x)=>w+(x-vd)/vd,0);return{loadTime:s,fullLoadTime:i,fps:f,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};h.$=class extends K{},h.A=Tc,h.B=Mf,h.C=function(s){if(de==null){const i=s.navigator?s.navigator.userAgent:null;de=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return de},h.D=Kt,h.E=ni,h.F=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Kv(()=>this.process()),this.subscription=function(l,f,g,w){return l.addEventListener(f,g,!1),{unsubscribe:()=>{l.removeEventListener(f,g,!1)}}}(this.target,"message",l=>this.receive(l)),this.globalScope=be(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((l,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:l,reject:f},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const I={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const w=[],x=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Ra(s.data,w)});this.target.postMessage(x,{transfer:w})})}receive(s){const i=s.data,l=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[l];const f=this.abortControllers[l];return delete this.abortControllers[l],void(f&&f.abort())}if(be(self)||i.mustQueue)return this.tasks[l]=i,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(Ba(i.error)):g.resolve(Ba(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Ba(i.data),f=new AbortController;this.abortControllers[s]=f;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,l,f);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,l){const f=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Ra(i):null,data:Ra(l,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},h.G=St,h.H=function(){var s=new Tc(16);return Tc!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},h.I=nd,h.J=function(s,i,l){var f,g,w,x,I,M,F,q,G,$,re,le,ge=l[0],Ce=l[1],ze=l[2];return i===s?(s[12]=i[0]*ge+i[4]*Ce+i[8]*ze+i[12],s[13]=i[1]*ge+i[5]*Ce+i[9]*ze+i[13],s[14]=i[2]*ge+i[6]*Ce+i[10]*ze+i[14],s[15]=i[3]*ge+i[7]*Ce+i[11]*ze+i[15]):(g=i[1],w=i[2],x=i[3],I=i[4],M=i[5],F=i[6],q=i[7],G=i[8],$=i[9],re=i[10],le=i[11],s[0]=f=i[0],s[1]=g,s[2]=w,s[3]=x,s[4]=I,s[5]=M,s[6]=F,s[7]=q,s[8]=G,s[9]=$,s[10]=re,s[11]=le,s[12]=f*ge+I*Ce+G*ze+i[12],s[13]=g*ge+M*Ce+$*ze+i[13],s[14]=w*ge+F*Ce+re*ze+i[14],s[15]=x*ge+q*Ce+le*ze+i[15]),s},h.K=function(s,i,l){var f=l[0],g=l[1],w=l[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*w,s[9]=i[9]*w,s[10]=i[10]*w,s[11]=i[11]*w,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},h.L=Np,h.M=function(s,i){const l={};for(let f=0;f<i.length;f++){const g=i[f];g in s&&(l[g]=s[g])}return l},h.N=Ja,h.O=Om,h.P=y,h.Q=Dm,h.R=bs,h.S=vs,h.T=mc,h.U=N,h.V=z,h.W=Me,h.X=Nn,h.Y=A,h.Z=Zu,h._=a,h.a=$e,h.a$=function(s,i){var l=s[0],f=s[1],g=s[2],w=s[3],x=s[4],I=s[5],M=s[6],F=s[7],q=s[8],G=s[9],$=s[10],re=s[11],le=s[12],ge=s[13],Ce=s[14],ze=s[15],tt=i[0],Ve=i[1],Ye=i[2],lt=i[3],xt=i[4],Bt=i[5],hi=i[6],Ft=i[7],Ot=i[8],ei=i[9],Gt=i[10],Vt=i[11],gt=i[12],ti=i[13],Qt=i[14],bi=i[15];return Math.abs(l-tt)<=Or*Math.max(1,Math.abs(l),Math.abs(tt))&&Math.abs(f-Ve)<=Or*Math.max(1,Math.abs(f),Math.abs(Ve))&&Math.abs(g-Ye)<=Or*Math.max(1,Math.abs(g),Math.abs(Ye))&&Math.abs(w-lt)<=Or*Math.max(1,Math.abs(w),Math.abs(lt))&&Math.abs(x-xt)<=Or*Math.max(1,Math.abs(x),Math.abs(xt))&&Math.abs(I-Bt)<=Or*Math.max(1,Math.abs(I),Math.abs(Bt))&&Math.abs(M-hi)<=Or*Math.max(1,Math.abs(M),Math.abs(hi))&&Math.abs(F-Ft)<=Or*Math.max(1,Math.abs(F),Math.abs(Ft))&&Math.abs(q-Ot)<=Or*Math.max(1,Math.abs(q),Math.abs(Ot))&&Math.abs(G-ei)<=Or*Math.max(1,Math.abs(G),Math.abs(ei))&&Math.abs($-Gt)<=Or*Math.max(1,Math.abs($),Math.abs(Gt))&&Math.abs(re-Vt)<=Or*Math.max(1,Math.abs(re),Math.abs(Vt))&&Math.abs(le-gt)<=Or*Math.max(1,Math.abs(le),Math.abs(gt))&&Math.abs(ge-ti)<=Or*Math.max(1,Math.abs(ge),Math.abs(ti))&&Math.abs(Ce-Qt)<=Or*Math.max(1,Math.abs(Ce),Math.abs(Qt))&&Math.abs(ze-bi)<=Or*Math.max(1,Math.abs(ze),Math.abs(bi))},h.a0=Vi,h.a1=dd,h.a2=ft,h.a3=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(l=>{i.onloadstart=()=>{l(i)};for(const f of s){const g=window.document.createElement("source");Pi(f)||(i.crossOrigin="Anonymous"),g.src=f,i.appendChild(g)}})},h.a4=function(){return j++},h.a5=Rt,h.a6=Pc,h.a7=yl,h.a8=Al,h.a9=Um,h.aA=function(s){if(s.type==="custom")return new Xv(s);switch(s.type){case"background":return new Wv(s);case"circle":return new Lb(s);case"fill":return new Kb(s);case"fill-extrusion":return new uv(s);case"heatmap":return new Ob(s);case"hillshade":return new Fb(s);case"line":return new yv(s);case"raster":return new Hv(s);case"symbol":return new Gh(s)}},h.aB=B,h.aC=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let l=[];try{if(!it(s.version,i.version))return[{command:"setStyle",args:[i]}];it(s.center,i.center)||l.push({command:"setCenter",args:[i.center]}),it(s.zoom,i.zoom)||l.push({command:"setZoom",args:[i.zoom]}),it(s.bearing,i.bearing)||l.push({command:"setBearing",args:[i.bearing]}),it(s.pitch,i.pitch)||l.push({command:"setPitch",args:[i.pitch]}),it(s.sprite,i.sprite)||l.push({command:"setSprite",args:[i.sprite]}),it(s.glyphs,i.glyphs)||l.push({command:"setGlyphs",args:[i.glyphs]}),it(s.transition,i.transition)||l.push({command:"setTransition",args:[i.transition]}),it(s.light,i.light)||l.push({command:"setLight",args:[i.light]}),it(s.terrain,i.terrain)||l.push({command:"setTerrain",args:[i.terrain]}),it(s.sky,i.sky)||l.push({command:"setSky",args:[i.sky]}),it(s.projection,i.projection)||l.push({command:"setProjection",args:[i.projection]});const f={},g=[];(function(x,I,M,F){let q;for(q in I=I||{},x=x||{})Object.prototype.hasOwnProperty.call(x,q)&&(Object.prototype.hasOwnProperty.call(I,q)||Y(q,M,F));for(q in I)Object.prototype.hasOwnProperty.call(I,q)&&(Object.prototype.hasOwnProperty.call(x,q)?it(x[q],I[q])||(x[q].type==="geojson"&&I[q].type==="geojson"&&Ze(x,I,q)?ue(M,{command:"setGeoJSONSourceData",args:[q,I[q].data]}):Ae(q,I,M,F)):H(q,I,M))})(s.sources,i.sources,g,f);const w=[];s.layers&&s.layers.forEach(x=>{"source"in x&&f[x.source]?l.push({command:"removeLayer",args:[x.id]}):w.push(x)}),l=l.concat(g),function(x,I,M){I=I||[];const F=(x=x||[]).map(st),q=I.map(st),G=x.reduce(Ci,{}),$=I.reduce(Ci,{}),re=F.slice(),le=Object.create(null);let ge,Ce,ze,tt,Ve;for(let Ye=0,lt=0;Ye<F.length;Ye++)ge=F[Ye],Object.prototype.hasOwnProperty.call($,ge)?lt++:(ue(M,{command:"removeLayer",args:[ge]}),re.splice(re.indexOf(ge,lt),1));for(let Ye=0,lt=0;Ye<q.length;Ye++)ge=q[q.length-1-Ye],re[re.length-1-Ye]!==ge&&(Object.prototype.hasOwnProperty.call(G,ge)?(ue(M,{command:"removeLayer",args:[ge]}),re.splice(re.lastIndexOf(ge,re.length-lt),1)):lt++,tt=re[re.length-Ye],ue(M,{command:"addLayer",args:[$[ge],tt]}),re.splice(re.length-Ye,0,ge),le[ge]=!0);for(let Ye=0;Ye<q.length;Ye++)if(ge=q[Ye],Ce=G[ge],ze=$[ge],!le[ge]&&!it(Ce,ze))if(it(Ce.source,ze.source)&&it(Ce["source-layer"],ze["source-layer"])&&it(Ce.type,ze.type)){for(Ve in dt(Ce.layout,ze.layout,M,ge,null,"setLayoutProperty"),dt(Ce.paint,ze.paint,M,ge,null,"setPaintProperty"),it(Ce.filter,ze.filter)||ue(M,{command:"setFilter",args:[ge,ze.filter]}),it(Ce.minzoom,ze.minzoom)&&it(Ce.maxzoom,ze.maxzoom)||ue(M,{command:"setLayerZoomRange",args:[ge,ze.minzoom,ze.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?dt(Ce[Ve],ze[Ve],M,ge,Ve.slice(6),"setPaintProperty"):it(Ce[Ve],ze[Ve])||ue(M,{command:"setLayerProperty",args:[ge,Ve,ze[Ve]]}));for(Ve in ze)Object.prototype.hasOwnProperty.call(ze,Ve)&&!Object.prototype.hasOwnProperty.call(Ce,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?dt(Ce[Ve],ze[Ve],M,ge,Ve.slice(6),"setPaintProperty"):it(Ce[Ve],ze[Ve])||ue(M,{command:"setLayerProperty",args:[ge,Ve,ze[Ve]]}))}else ue(M,{command:"removeLayer",args:[ge]}),tt=re[re.lastIndexOf(ge)+1],ue(M,{command:"addLayer",args:[ze,tt]})}(w,i.layers,l)}catch(f){console.warn("Unable to compute style diff:",f),l=[{command:"setStyle",args:[i]}]}return l},h.aD=function(s){const i=[],l=s.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},h.aE=function s(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let f=0;f<i.length;f++)if(!s(i[f],l[f]))return!1;return!0}if(typeof i=="object"&&i!==null&&l!==null){if(typeof l!="object"||Object.keys(i).length!==Object.keys(l).length)return!1;for(const f in i)if(!s(i[f],l[f]))return!1;return!0}return i===l},h.aF=U,h.aG=X,h.aH=class extends Cl{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},h.aI=zh,h.aJ=class extends Cl{constructor(s,i){super(s,i),this.current=Sb}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},h.aK=Ip,h.aL=Ap,h.aM=si,h.aN=class extends Cl{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},h.aO=class extends Cl{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},h.aP=function(s,i,l,f,g,w,x){var I=1/(i-l),M=1/(f-g),F=1/(w-x);return s[0]=-2*I,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*M,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*F,s[11]=0,s[12]=(i+l)*I,s[13]=(g+f)*M,s[14]=(x+w)*F,s[15]=1,s},h.aQ=Pb,h.aR=class extends He{},h.aS=xv,h.aT=class extends nt{},h.aU=Wf,h.aV=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},h.aW=Zp,h.aX=or,h.aY=ys,h.aZ=class extends Jt{},h.a_=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},h.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,g,w)=>{const x=g||w;return i[f]=!x||x.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},h.ab=function(s,i){const l=[];for(const f in s)f in i||l.push(f);return l},h.ac=oe,h.ad=function(s,i,l){var f=Math.sin(l),g=Math.cos(l),w=i[0],x=i[1],I=i[2],M=i[3],F=i[4],q=i[5],G=i[6],$=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*g+F*f,s[1]=x*g+q*f,s[2]=I*g+G*f,s[3]=M*g+$*f,s[4]=F*g-w*f,s[5]=q*g-x*f,s[6]=G*g-I*f,s[7]=$*g-M*f,s},h.ae=function(s){var i=new Tc(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},h.af=Rh,h.ag=function(s,i){let l=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:x}=s,I=g?oe($n.interpolationFactor(g,i,w,x),0,1):0;s.kind==="camera"?f=Vn.number(s.minSize,s.maxSize,I):l=I}return{uSizeT:l,uSize:f}},h.ai=function(s,{uSize:i,uSizeT:l},{lowerSize:f,upperSize:g}){return s.kind==="source"?f/Ao:s.kind==="composite"?Vn.number(f/Ao,g/Ao,l):i},h.aj=ad,h.ak=function(s,i,l,f){const g=i.y-s.y,w=i.x-s.x,x=f.y-l.y,I=f.x-l.x,M=x*w-I*g;if(M===0)return null;const F=(I*(s.y-l.y)-x*(s.x-l.x))/M;return new y(s.x+F*w,s.y+F*g)},h.al=Wm,h.am=zp,h.an=Vf,h.ao=function(s){let i=1/0,l=1/0,f=-1/0,g=-1/0;for(const w of s)i=Math.min(i,w.x),l=Math.min(l,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);return[i,l,f,g]},h.ap=qn,h.ar=od,h.as=function(s,i){var l=i[0],f=i[1],g=i[2],w=i[3],x=i[4],I=i[5],M=i[6],F=i[7],q=i[8],G=i[9],$=i[10],re=i[11],le=i[12],ge=i[13],Ce=i[14],ze=i[15],tt=l*I-f*x,Ve=l*M-g*x,Ye=l*F-w*x,lt=f*M-g*I,xt=f*F-w*I,Bt=g*F-w*M,hi=q*ge-G*le,Ft=q*Ce-$*le,Ot=q*ze-re*le,ei=G*Ce-$*ge,Gt=G*ze-re*ge,Vt=$*ze-re*Ce,gt=tt*Vt-Ve*Gt+Ye*ei+lt*Ot-xt*Ft+Bt*hi;return gt?(s[0]=(I*Vt-M*Gt+F*ei)*(gt=1/gt),s[1]=(g*Gt-f*Vt-w*ei)*gt,s[2]=(ge*Bt-Ce*xt+ze*lt)*gt,s[3]=($*xt-G*Bt-re*lt)*gt,s[4]=(M*Ot-x*Vt-F*Ft)*gt,s[5]=(l*Vt-g*Ot+w*Ft)*gt,s[6]=(Ce*Ye-le*Bt-ze*Ve)*gt,s[7]=(q*Bt-$*Ye+re*Ve)*gt,s[8]=(x*Gt-I*Ot+F*hi)*gt,s[9]=(f*Ot-l*Gt-w*hi)*gt,s[10]=(le*xt-ge*Ye+ze*tt)*gt,s[11]=(G*Ye-q*xt-re*tt)*gt,s[12]=(I*Ft-x*ei-M*hi)*gt,s[13]=(l*ei-f*Ft+g*hi)*gt,s[14]=(ge*Ve-le*lt-Ce*tt)*gt,s[15]=(q*lt-G*Ve+$*tt)*gt,s):null},h.at=md,h.au=sd,h.av=gd,h.aw=function(){const s={},i=Qe.$version;for(const l in Qe.$root){const f=Qe.$root[l];if(f.required){let g=null;g=l==="version"?i:f.type==="array"?[]:{},g!=null&&(s[l]=g)}}return s},h.ax=Su,h.ay=oi,h.az=function(s){s=s.slice();const i=Object.create(null);for(let l=0;l<s.length;l++)i[s[l].id]=s[l];for(let l=0;l<s.length;l++)"ref"in s[l]&&(s[l]=_t(s[l],i[s[l].ref]));return s},h.b=ye,h.b0=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},h.b1=function(s,i,l){return s[0]=i[0]*l[0],s[1]=i[1]*l[1],s[2]=i[2]*l[2],s[3]=i[3]*l[3],s},h.b2=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},h.b3=ee,h.b4=Bm,h.b5=Fm,h.b6=function(s,i,l,f,g){var w,x=1/Math.tan(i/2);return s[0]=x/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+f)*(w=1/(f-g)),s[14]=2*g*f*w):(s[10]=-1,s[14]=-2*f),s},h.b7=function(s,i,l){var f=Math.sin(l),g=Math.cos(l),w=i[4],x=i[5],I=i[6],M=i[7],F=i[8],q=i[9],G=i[10],$=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=w*g+F*f,s[5]=x*g+q*f,s[6]=I*g+G*f,s[7]=M*g+$*f,s[8]=F*g-w*f,s[9]=q*g-x*f,s[10]=G*g-I*f,s[11]=$*g-M*f,s},h.b8=V,h.b9=Q,h.bA=um,h.bB=function(s){return s.message===pt},h.bC=Pr,h.bD=Hr,h.ba=function(s){return s*Math.PI/180},h.bb=function(s,i){const{x:l,y:f}=Zu.fromLngLat(i);return!(s<0||s>25||f<0||f>=1||l<0||l>=1)},h.bc=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},h.bd=class extends Z{},h.be=hd,h.bf=r1,h.bh=Ht,h.bi=function(s,i){$e.REGISTERED_PROTOCOLS[s]=i},h.bj=function(s){delete $e.REGISTERED_PROTOCOLS[s]},h.bk=function(s,i){const l={};for(let g=0;g<s.length;g++){const w=i&&i[s[g].id]||D(s[g]);i&&(i[s[g].id]=w);let x=l[w];x||(x=l[w]=[]),x.push(s[g])}const f=[];for(const g in l)f.push(l[g]);return f},h.bl=qt,h.bm=jm,h.bn=Vm,h.bo=bm,h.bp=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Nn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],l=i.layout,f=i._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new mn(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new mn(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new mn(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:q}=s.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new mn(F),s.canonical),f["text-size"].possiblyEvaluate(new mn(q),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:q}=s.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new mn(F),s.canonical),f["icon-size"].possiblyEvaluate(new mn(q),s.canonical)]}const w=l.get("text-line-height")*qn,x=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",I=l.get("text-keep-upright"),M=l.get("text-size");for(const F of s.bucket.features){const q=l.get("text-font").evaluate(F,{},s.canonical).join(","),G=M.evaluate(F,{},s.canonical),$=g.layoutTextSize.evaluate(F,{},s.canonical),re=g.layoutIconSize.evaluate(F,{},s.canonical),le={horizontal:{},vertical:void 0},ge=F.text;let Ce,ze=[0,0];if(ge){const Ye=ge.toString(),lt=l.get("text-letter-spacing").evaluate(F,{},s.canonical)*qn,xt=Pf(Ye)?lt:0,Bt=l.get("text-anchor").evaluate(F,{},s.canonical),hi=eg(i,F,s.canonical);if(!hi){const Gt=l.get("text-radial-offset").evaluate(F,{},s.canonical);ze=Gt?$m(Bt,[Gt*qn,pd]):l.get("text-offset").evaluate(F,{},s.canonical).map(Vt=>Vt*qn)}let Ft=x?"center":l.get("text-justify").evaluate(F,{},s.canonical);const Ot=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(F,{},s.canonical)*qn:1/0,ei=()=>{s.bucket.allowVerticalPlacement&&Tu(Ye)&&(le.vertical=qh(ge,s.glyphMap,s.glyphPositions,s.imagePositions,q,Ot,w,Bt,"left",xt,ze,h.ah.vertical,!0,$,G))};if(!x&&hi){const Gt=new Set;if(Ft==="auto")for(let gt=0;gt<hi.values.length;gt+=2)Gt.add(md(hi.values[gt]));else Gt.add(Ft);let Vt=!1;for(const gt of Gt)if(!le.horizontal[gt])if(Vt)le.horizontal[gt]=le.horizontal[0];else{const ti=qh(ge,s.glyphMap,s.glyphPositions,s.imagePositions,q,Ot,w,"center",gt,xt,ze,h.ah.horizontal,!1,$,G);ti&&(le.horizontal[gt]=ti,Vt=ti.positionedLines.length===1)}ei()}else{Ft==="auto"&&(Ft=md(Bt));const Gt=qh(ge,s.glyphMap,s.glyphPositions,s.imagePositions,q,Ot,w,Bt,Ft,xt,ze,h.ah.horizontal,!1,$,G);Gt&&(le.horizontal[Ft]=Gt),ei(),Tu(Ye)&&x&&I&&(le.vertical=qh(ge,s.glyphMap,s.glyphPositions,s.imagePositions,q,Ot,w,Bt,Ft,xt,ze,h.ah.vertical,!1,$,G))}}let tt=!1;if(F.icon&&F.icon.name){const Ye=s.imageMap[F.icon.name];Ye&&(Ce=jv(s.imagePositions[F.icon.name],l.get("icon-offset").evaluate(F,{},s.canonical),l.get("icon-anchor").evaluate(F,{},s.canonical)),tt=!!Ye.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=tt:s.bucket.sdfIcons!==tt&&ce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==s.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Ve=ig(le.horizontal)||le.vertical;s.bucket.iconsInText=!!Ve&&Ve.iconsInText,(Ve||Ce)&&i1(s.bucket,F,le,Ce,s.imageMap,g,$,re,ze,tt,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},h.bq=$f,h.br=Jf,h.bs=Qf,h.bt=Ha,h.bu=td,h.bv=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},h.bw=function(s,i,l,f,g){return a(this,void 0,void 0,function*(){if(z())try{return yield Me(s,i,l,f,g)}catch{}return function(w,x,I,M,F){const q=w.width,G=w.height;ot&&We||(ot=new OffscreenCanvas(q,G),We=ot.getContext("2d",{willReadFrequently:!0})),ot.width=q,ot.height=G,We.drawImage(w,0,0,q,G);const $=We.getImageData(x,I,M,F);return We.clearRect(0,0,q,G),$.data}(s,i,l,f,g)})},h.bx=Nm,h.by=_,h.bz=S,h.c=Tt,h.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),h.e=ne,h.f=s=>new Promise((i,l)=>{const f=new Image;f.onload=()=>{i(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Ie})},f.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(g):Ie}),h.g=wt,h.h=(s,i)=>Mi(ne(s,{type:"json"}),i),h.i=be,h.j=Pt,h.k=Xe,h.l=(s,i)=>Mi(ne(s,{type:"arrayBuffer"}),i),h.m=Mi,h.n=function(s){return new td(s).readFields(zv,[])},h.o=Ou,h.p=ym,h.q=v,h.r=Af,h.s=Pi,h.t=xu,h.u=ra,h.v=Qe,h.w=ce,h.x=function([s,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(l),y:s*Math.sin(i)*Math.sin(l),z:s*Math.cos(l)}},h.y=Vn,h.z=mn}),c("worker",["./shared"],function(h){class a{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,ie){for(const Se of te){this._layerConfigs[Se.id]=Se;const Ue=this._layers[Se.id]=h.aA(Se);Ue._featureFilter=h.a7(Ue.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(const Se of ie)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const me=h.bk(Object.values(this._layerConfigs),this.keyCache);for(const Se of me){const Ue=Se.map(rt=>this._layers[rt.id]),Ge=Ue[0];if(Ge.visibility==="none")continue;const et=Ge.source||"";let Re=this.familiesBySource[et];Re||(Re=this.familiesBySource[et]={});const at=Ge.sourceLayer||"_geojsonTileLayer";let yt=Re[at];yt||(yt=Re[at]=[]),yt.push(Ue)}}}class _{constructor(te){const ie={},me=[];for(const et in te){const Re=te[et],at=ie[et]={};for(const yt in Re){const rt=Re[+yt];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Et={x:0,y:0,w:rt.bitmap.width+2,h:rt.bitmap.height+2};me.push(Et),at[yt]={rect:Et,metrics:rt.metrics}}}const{w:Se,h:Ue}=h.p(me),Ge=new h.o({width:Se||1,height:Ue||1});for(const et in te){const Re=te[et];for(const at in Re){const yt=Re[+at];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const rt=ie[et][at].rect;h.o.copy(yt.bitmap,Ge,{x:0,y:0},{x:rt.x+1,y:rt.y+1},yt.bitmap)}}this.image=Ge,this.positions=ie}}h.bl("GlyphAtlas",_);class S{constructor(te){this.tileID=new h.S(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.uid=te.uid,this.zoom=te.zoom,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.returnDependencies=!!te.returnDependencies,this.promoteId=te.promoteId,this.inFlightDependencies=[]}parse(te,ie,me,Se){return h._(this,void 0,void 0,function*(){this.status="parsing",this.data=te,this.collisionBoxArray=new h.a5;const Ue=new h.bm(Object.keys(te.layers).sort()),Ge=new h.bn(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const et={},Re={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},at=ie.familiesBySource[this.source];for(const Ke in at){const pi=te.layers[Ke];if(!pi)continue;pi.version===1&&h.w(`Vector tile source "${this.source}" layer "${Ke}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ki=Ue.encode(Ke),Ni=[];for(let Ki=0;Ki<pi.length;Ki++){const Ji=pi.feature(Ki),jn=Ge.getId(Ji,Ke);Ni.push({feature:Ji,id:jn,index:Ki,sourceLayerIndex:ki})}for(const Ki of at[Ke]){const Ji=Ki[0];Ji.source!==this.source&&h.w(`layer.source = ${Ji.source} does not equal this.source = ${this.source}`),Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility!=="none"&&(k(Ki,this.zoom,me),(et[Ji.id]=Ji.createBucket({index:Ge.bucketLayerIDs.length,layers:Ki,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ki,sourceID:this.source})).populate(Ni,Re,this.tileID.canonical),Ge.bucketLayerIDs.push(Ki.map(jn=>jn.id)))}}const yt=h.aF(Re.glyphDependencies,Ke=>Object.keys(Ke).map(Number));this.inFlightDependencies.forEach(Ke=>Ke==null?void 0:Ke.abort()),this.inFlightDependencies=[];let rt=Promise.resolve({});if(Object.keys(yt).length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),rt=Se.sendAsync({type:"GG",data:{stacks:yt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ke)}const Et=Object.keys(Re.iconDependencies);let Yt=Promise.resolve({});if(Et.length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),Yt=Se.sendAsync({type:"GI",data:{icons:Et,source:this.source,tileID:this.tileID,type:"icons"}},Ke)}const ri=Object.keys(Re.patternDependencies);let Bi=Promise.resolve({});if(ri.length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),Bi=Se.sendAsync({type:"GI",data:{icons:ri,source:this.source,tileID:this.tileID,type:"patterns"}},Ke)}const[wi,zi,Si]=yield Promise.all([rt,Yt,Bi]),hn=new _(wi),fn=new h.bo(zi,Si);for(const Ke in et){const pi=et[Ke];pi instanceof h.a6?(k(pi.layers,this.zoom,me),h.bp({bucket:pi,glyphMap:wi,glyphPositions:hn.positions,imageMap:zi,imagePositions:fn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):pi.hasPattern&&(pi instanceof h.bq||pi instanceof h.br||pi instanceof h.bs)&&(k(pi.layers,this.zoom,me),pi.addFeatures(Re,this.tileID.canonical,fn.patternPositions))}return this.status="done",{buckets:Object.values(et).filter(Ke=>!Ke.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hn.image,imageAtlas:fn,glyphMap:this.returnDependencies?wi:null,iconMap:this.returnDependencies?zi:null,glyphPositions:this.returnDependencies?hn.positions:null}})}}function k(Pe,te,ie){const me=new h.z(te);for(const Se of Pe)Se.recalculate(me,ie)}class y{constructor(te,ie,me){this.actor=te,this.layerIndex=ie,this.availableImages=me,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(te,ie){return h._(this,void 0,void 0,function*(){const me=yield h.l(te.request,ie);try{return{vectorTile:new h.bt.VectorTile(new h.bu(me.data)),rawData:me.data,cacheControl:me.cacheControl,expires:me.expires}}catch(Se){const Ue=new Uint8Array(me.data);let Ge=`Unable to parse the tile at ${te.request.url}, `;throw Ge+=Ue[0]===31&&Ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(Ge)}})}loadTile(te){return h._(this,void 0,void 0,function*(){const ie=te.uid,me=!!(te&&te.request&&te.request.collectResourceTiming)&&new h.bv(te.request),Se=new S(te);this.loading[ie]=Se;const Ue=new AbortController;Se.abort=Ue;try{const Ge=yield this.loadVectorTile(te,Ue);if(delete this.loading[ie],!Ge)return null;const et=Ge.rawData,Re={};Ge.expires&&(Re.expires=Ge.expires),Ge.cacheControl&&(Re.cacheControl=Ge.cacheControl);const at={};if(me){const rt=me.finish();rt&&(at.resourceTiming=JSON.parse(JSON.stringify(rt)))}Se.vectorTile=Ge.vectorTile;const yt=Se.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ie]=Se,this.fetching[ie]={rawTileData:et,cacheControl:Re,resourceTiming:at};try{const rt=yield yt;return h.e({rawTileData:et.slice(0)},rt,Re,at)}finally{delete this.fetching[ie]}}catch(Ge){throw delete this.loading[ie],Se.status="done",this.loaded[ie]=Se,Ge}})}reloadTile(te){return h._(this,void 0,void 0,function*(){const ie=te.uid;if(!this.loaded||!this.loaded[ie])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const me=this.loaded[ie];if(me.showCollisionBoxes=te.showCollisionBoxes,me.status==="parsing"){const Se=yield me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ue;if(this.fetching[ie]){const{rawTileData:Ge,cacheControl:et,resourceTiming:Re}=this.fetching[ie];delete this.fetching[ie],Ue=h.e({rawTileData:Ge.slice(0)},Se,et,Re)}else Ue=Se;return Ue}if(me.status==="done"&&me.vectorTile)return me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(te){return h._(this,void 0,void 0,function*(){const ie=this.loading,me=te.uid;ie&&ie[me]&&ie[me].abort&&(ie[me].abort.abort(),delete ie[me])})}removeTile(te){return h._(this,void 0,void 0,function*(){this.loaded&&this.loaded[te.uid]&&delete this.loaded[te.uid]})}}class C{constructor(){this.loaded={}}loadTile(te){return h._(this,void 0,void 0,function*(){const{uid:ie,encoding:me,rawImageData:Se,redFactor:Ue,greenFactor:Ge,blueFactor:et,baseShift:Re}=te,at=Se.width+2,yt=Se.height+2,rt=h.b(Se)?new h.R({width:at,height:yt},yield h.bw(Se,-1,-1,at,yt)):Se,Et=new h.bx(ie,rt,me,Ue,Ge,et,Re);return this.loaded=this.loaded||{},this.loaded[ie]=Et,Et})}removeTile(te){const ie=this.loaded,me=te.uid;ie&&ie[me]&&delete ie[me]}}function E(Pe,te){if(Pe.length!==0){T(Pe[0],te);for(var ie=1;ie<Pe.length;ie++)T(Pe[ie],!te)}}function T(Pe,te){for(var ie=0,me=0,Se=0,Ue=Pe.length,Ge=Ue-1;Se<Ue;Ge=Se++){var et=(Pe[Se][0]-Pe[Ge][0])*(Pe[Ge][1]+Pe[Se][1]),Re=ie+et;me+=Math.abs(ie)>=Math.abs(et)?ie-Re+et:et-Re+ie,ie=Re}ie+me>=0!=!!te&&Pe.reverse()}var L=h.by(function Pe(te,ie){var me,Se=te&&te.type;if(Se==="FeatureCollection")for(me=0;me<te.features.length;me++)Pe(te.features[me],ie);else if(Se==="GeometryCollection")for(me=0;me<te.geometries.length;me++)Pe(te.geometries[me],ie);else if(Se==="Feature")Pe(te.geometry,ie);else if(Se==="Polygon")E(te.coordinates,ie);else if(Se==="MultiPolygon")for(me=0;me<te.coordinates.length;me++)E(te.coordinates[me],ie);return te});const R=h.bt.VectorTileFeature.prototype.toGeoJSON;var N={exports:{}},z=h.bz,V=h.bt.VectorTileFeature,Q=oe;function oe(Pe,te){this.options=te||{},this.features=Pe,this.length=Pe.length}function ee(Pe,te){this.id=typeof Pe.id=="number"?Pe.id:void 0,this.type=Pe.type,this.rawGeometry=Pe.type===1?[Pe.geometry]:Pe.geometry,this.properties=Pe.tags,this.extent=te||4096}oe.prototype.feature=function(Pe){return new ee(this.features[Pe],this.options.extent)},ee.prototype.loadGeometry=function(){var Pe=this.rawGeometry;this.geometry=[];for(var te=0;te<Pe.length;te++){for(var ie=Pe[te],me=[],Se=0;Se<ie.length;Se++)me.push(new z(ie[Se][0],ie[Se][1]));this.geometry.push(me)}return this.geometry},ee.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Pe=this.geometry,te=1/0,ie=-1/0,me=1/0,Se=-1/0,Ue=0;Ue<Pe.length;Ue++)for(var Ge=Pe[Ue],et=0;et<Ge.length;et++){var Re=Ge[et];te=Math.min(te,Re.x),ie=Math.max(ie,Re.x),me=Math.min(me,Re.y),Se=Math.max(Se,Re.y)}return[te,me,ie,Se]},ee.prototype.toGeoJSON=V.prototype.toGeoJSON;var ne=h.bA,j=Q;function U(Pe){var te=new ne;return function(ie,me){for(var Se in ie.layers)me.writeMessage(3,X,ie.layers[Se])}(Pe,te),te.finish()}function X(Pe,te){var ie;te.writeVarintField(15,Pe.version||1),te.writeStringField(1,Pe.name||""),te.writeVarintField(5,Pe.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<Pe.length;ie++)me.feature=Pe.feature(ie),te.writeMessage(2,B,me);var Se=me.keys;for(ie=0;ie<Se.length;ie++)te.writeStringField(3,Se[ie]);var Ue=me.values;for(ie=0;ie<Ue.length;ie++)te.writeMessage(4,de,Ue[ie])}function B(Pe,te){var ie=Pe.feature;ie.id!==void 0&&te.writeVarintField(1,ie.id),te.writeMessage(2,W,Pe),te.writeVarintField(3,ie.type),te.writeMessage(4,be,ie)}function W(Pe,te){var ie=Pe.feature,me=Pe.keys,Se=Pe.values,Ue=Pe.keycache,Ge=Pe.valuecache;for(var et in ie.properties){var Re=ie.properties[et],at=Ue[et];if(Re!==null){at===void 0&&(me.push(et),Ue[et]=at=me.length-1),te.writeVarint(at);var yt=typeof Re;yt!=="string"&&yt!=="boolean"&&yt!=="number"&&(Re=JSON.stringify(Re));var rt=yt+":"+Re,Et=Ge[rt];Et===void 0&&(Se.push(Re),Ge[rt]=Et=Se.length-1),te.writeVarint(Et)}}}function ce(Pe,te){return(te<<3)+(7&Pe)}function pe(Pe){return Pe<<1^Pe>>31}function be(Pe,te){for(var ie=Pe.loadGeometry(),me=Pe.type,Se=0,Ue=0,Ge=ie.length,et=0;et<Ge;et++){var Re=ie[et],at=1;me===1&&(at=Re.length),te.writeVarint(ce(1,at));for(var yt=me===3?Re.length-1:Re.length,rt=0;rt<yt;rt++){rt===1&&me!==1&&te.writeVarint(ce(2,yt-1));var Et=Re[rt].x-Se,Yt=Re[rt].y-Ue;te.writeVarint(pe(Et)),te.writeVarint(pe(Yt)),Se+=Et,Ue+=Yt}me===3&&te.writeVarint(ce(7,1))}}function de(Pe,te){var ie=typeof Pe;ie==="string"?te.writeStringField(1,Pe):ie==="boolean"?te.writeBooleanField(7,Pe):ie==="number"&&(Pe%1!=0?te.writeDoubleField(3,Pe):Pe<0?te.writeSVarintField(6,Pe):te.writeVarintField(5,Pe))}N.exports=U,N.exports.fromVectorTileJs=U,N.exports.fromGeojsonVt=function(Pe,te){te=te||{};var ie={};for(var me in Pe)ie[me]=new j(Pe[me].features,te),ie[me].name=me,ie[me].version=te.version,ie[me].extent=te.extent;return U({layers:ie})},N.exports.GeoJSONWrapper=j;var ye=h.by(N.exports);const Ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pe=>Pe},Me=Math.fround||(ot=new Float32Array(1),Pe=>(ot[0]=+Pe,ot[0]));var ot;const We=3,pt=5,Tt=6;class $e{constructor(te){this.options=Object.assign(Object.create(Ie),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ie,minZoom:me,maxZoom:Se}=this.options;ie&&console.time("total time");const Ue=`prepare ${te.length} points`;ie&&console.time(Ue),this.points=te;const Ge=[];for(let Re=0;Re<te.length;Re++){const at=te[Re];if(!at.geometry)continue;const[yt,rt]=at.geometry.coordinates,Et=Me(Ht(yt)),Yt=Me(oi(rt));Ge.push(Et,Yt,1/0,Re,-1,1),this.options.reduce&&Ge.push(0)}let et=this.trees[Se+1]=this._createTree(Ge);ie&&console.timeEnd(Ue);for(let Re=Se;Re>=me;Re--){const at=+Date.now();et=this.trees[Re]=this._createTree(this._cluster(et,Re)),ie&&console.log("z%d: %d clusters in %dms",Re,et.numItems,+Date.now()-at)}return ie&&console.timeEnd("total time"),this}getClusters(te,ie){let me=((te[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,te[1]));let Ue=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)me=-180,Ue=180;else if(me>Ue){const rt=this.getClusters([me,Se,180,Ge],ie),Et=this.getClusters([-180,Se,Ue,Ge],ie);return rt.concat(Et)}const et=this.trees[this._limitZoom(ie)],Re=et.range(Ht(me),oi(Ge),Ht(Ue),oi(Se)),at=et.data,yt=[];for(const rt of Re){const Et=this.stride*rt;yt.push(at[Et+pt]>1?wt(at,Et,this.clusterProps):this.points[at[Et+We]])}return yt}getChildren(te){const ie=this._getOriginId(te),me=this._getOriginZoom(te),Se="No cluster with the specified id.",Ue=this.trees[me];if(!Ue)throw new Error(Se);const Ge=Ue.data;if(ie*this.stride>=Ge.length)throw new Error(Se);const et=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Re=Ue.within(Ge[ie*this.stride],Ge[ie*this.stride+1],et),at=[];for(const yt of Re){const rt=yt*this.stride;Ge[rt+4]===te&&at.push(Ge[rt+pt]>1?wt(Ge,rt,this.clusterProps):this.points[Ge[rt+We]])}if(at.length===0)throw new Error(Se);return at}getLeaves(te,ie,me){const Se=[];return this._appendLeaves(Se,te,ie=ie||10,me=me||0,0),Se}getTile(te,ie,me){const Se=this.trees[this._limitZoom(te)],Ue=Math.pow(2,te),{extent:Ge,radius:et}=this.options,Re=et/Ge,at=(me-Re)/Ue,yt=(me+1+Re)/Ue,rt={features:[]};return this._addTileFeatures(Se.range((ie-Re)/Ue,at,(ie+1+Re)/Ue,yt),Se.data,ie,me,Ue,rt),ie===0&&this._addTileFeatures(Se.range(1-Re/Ue,at,1,yt),Se.data,Ue,me,Ue,rt),ie===Ue-1&&this._addTileFeatures(Se.range(0,at,Re/Ue,yt),Se.data,-1,me,Ue,rt),rt.features.length?rt:null}getClusterExpansionZoom(te){let ie=this._getOriginZoom(te)-1;for(;ie<=this.options.maxZoom;){const me=this.getChildren(te);if(ie++,me.length!==1)break;te=me[0].properties.cluster_id}return ie}_appendLeaves(te,ie,me,Se,Ue){const Ge=this.getChildren(ie);for(const et of Ge){const Re=et.properties;if(Re&&Re.cluster?Ue+Re.point_count<=Se?Ue+=Re.point_count:Ue=this._appendLeaves(te,Re.cluster_id,me,Se,Ue):Ue<Se?Ue++:te.push(et),te.length===me)break}return Ue}_createTree(te){const ie=new h.av(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<te.length;me+=this.stride)ie.add(te[me],te[me+1]);return ie.finish(),ie.data=te,ie}_addTileFeatures(te,ie,me,Se,Ue,Ge){for(const et of te){const Re=et*this.stride,at=ie[Re+pt]>1;let yt,rt,Et;if(at)yt=St(ie,Re,this.clusterProps),rt=ie[Re],Et=ie[Re+1];else{const Bi=this.points[ie[Re+We]];yt=Bi.properties;const[wi,zi]=Bi.geometry.coordinates;rt=Ht(wi),Et=oi(zi)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(rt*Ue-me)),Math.round(this.options.extent*(Et*Ue-Se))]],tags:yt};let ri;ri=at||this.options.generateId?ie[Re+We]:this.points[ie[Re+We]].id,ri!==void 0&&(Yt.id=ri),Ge.features.push(Yt)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ie){const{radius:me,extent:Se,reduce:Ue,minPoints:Ge}=this.options,et=me/(Se*Math.pow(2,ie)),Re=te.data,at=[],yt=this.stride;for(let rt=0;rt<Re.length;rt+=yt){if(Re[rt+2]<=ie)continue;Re[rt+2]=ie;const Et=Re[rt],Yt=Re[rt+1],ri=te.within(Re[rt],Re[rt+1],et),Bi=Re[rt+pt];let wi=Bi;for(const zi of ri){const Si=zi*yt;Re[Si+2]>ie&&(wi+=Re[Si+pt])}if(wi>Bi&&wi>=Ge){let zi,Si=Et*Bi,hn=Yt*Bi,fn=-1;const Ke=((rt/yt|0)<<5)+(ie+1)+this.points.length;for(const pi of ri){const ki=pi*yt;if(Re[ki+2]<=ie)continue;Re[ki+2]=ie;const Ni=Re[ki+pt];Si+=Re[ki]*Ni,hn+=Re[ki+1]*Ni,Re[ki+4]=Ke,Ue&&(zi||(zi=this._map(Re,rt,!0),fn=this.clusterProps.length,this.clusterProps.push(zi)),Ue(zi,this._map(Re,ki)))}Re[rt+4]=Ke,at.push(Si/wi,hn/wi,1/0,Ke,-1,wi),Ue&&at.push(fn)}else{for(let zi=0;zi<yt;zi++)at.push(Re[rt+zi]);if(wi>1)for(const zi of ri){const Si=zi*yt;if(!(Re[Si+2]<=ie)){Re[Si+2]=ie;for(let hn=0;hn<yt;hn++)at.push(Re[Si+hn])}}}}return at}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ie,me){if(te[ie+pt]>1){const Ge=this.clusterProps[te[ie+Tt]];return me?Object.assign({},Ge):Ge}const Se=this.points[te[ie+We]].properties,Ue=this.options.map(Se);return me&&Ue===Se?Object.assign({},Ue):Ue}}function wt(Pe,te,ie){return{type:"Feature",id:Pe[te+We],properties:St(Pe,te,ie),geometry:{type:"Point",coordinates:[(me=Pe[te],360*(me-.5)),Mi(Pe[te+1])]}};var me}function St(Pe,te,ie){const me=Pe[te+pt],Se=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ue=Pe[te+Tt],Ge=Ue===-1?{}:Object.assign({},ie[Ue]);return Object.assign(Ge,{cluster:!0,cluster_id:Pe[te+We],point_count:me,point_count_abbreviated:Se})}function Ht(Pe){return Pe/360+.5}function oi(Pe){const te=Math.sin(Pe*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Mi(Pe){const te=(180-360*Pe)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Pi(Pe,te,ie,me){let Se=me;const Ue=te+(ie-te>>1);let Ge,et=ie-te;const Re=Pe[te],at=Pe[te+1],yt=Pe[ie],rt=Pe[ie+1];for(let Et=te+3;Et<ie;Et+=3){const Yt=Ti(Pe[Et],Pe[Et+1],Re,at,yt,rt);if(Yt>Se)Ge=Et,Se=Yt;else if(Yt===Se){const ri=Math.abs(Et-Ue);ri<et&&(Ge=Et,et=ri)}}Se>me&&(Ge-te>3&&Pi(Pe,te,Ge,me),Pe[Ge+2]=Se,ie-Ge>3&&Pi(Pe,Ge,ie,me))}function Ti(Pe,te,ie,me,Se,Ue){let Ge=Se-ie,et=Ue-me;if(Ge!==0||et!==0){const Re=((Pe-ie)*Ge+(te-me)*et)/(Ge*Ge+et*et);Re>1?(ie=Se,me=Ue):Re>0&&(ie+=Ge*Re,me+=et*Re)}return Ge=Pe-ie,et=te-me,Ge*Ge+et*et}function At(Pe,te,ie,me){const Se={id:Pe??null,type:te,geometry:ie,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")Xe(Se,ie);else if(te==="Polygon")Xe(Se,ie[0]);else if(te==="MultiLineString")for(const Ue of ie)Xe(Se,Ue);else if(te==="MultiPolygon")for(const Ue of ie)Xe(Se,Ue[0]);return Se}function Xe(Pe,te){for(let ie=0;ie<te.length;ie+=3)Pe.minX=Math.min(Pe.minX,te[ie]),Pe.minY=Math.min(Pe.minY,te[ie+1]),Pe.maxX=Math.max(Pe.maxX,te[ie]),Pe.maxY=Math.max(Pe.maxY,te[ie+1])}function Pt(Pe,te,ie,me){if(!te.geometry)return;const Se=te.geometry.coordinates;if(Se&&Se.length===0)return;const Ue=te.geometry.type,Ge=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let et=[],Re=te.id;if(ie.promoteId?Re=te.properties[ie.promoteId]:ie.generateId&&(Re=me||0),Ue==="Point")ni(Se,et);else if(Ue==="MultiPoint")for(const at of Se)ni(at,et);else if(Ue==="LineString")Qe(Se,et,Ge,!1);else if(Ue==="MultiLineString"){if(ie.lineMetrics){for(const at of Se)et=[],Qe(at,et,Ge,!1),Pe.push(At(Re,"LineString",et,te.properties));return}_i(Se,et,Ge,!1)}else if(Ue==="Polygon")_i(Se,et,Ge,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(const at of te.geometry.geometries)Pt(Pe,{id:Re,geometry:at,properties:te.properties},ie,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const at of Se){const yt=[];_i(at,yt,Ge,!0),et.push(yt)}}Pe.push(At(Re,Ue,et,te.properties))}function ni(Pe,te){te.push(_t(Pe[0]),it(Pe[1]),0)}function Qe(Pe,te,ie,me){let Se,Ue,Ge=0;for(let Re=0;Re<Pe.length;Re++){const at=_t(Pe[Re][0]),yt=it(Pe[Re][1]);te.push(at,yt,0),Re>0&&(Ge+=me?(Se*yt-at*Ue)/2:Math.sqrt(Math.pow(at-Se,2)+Math.pow(yt-Ue,2))),Se=at,Ue=yt}const et=te.length-3;te[2]=1,Pi(te,0,et,ie),te[et+2]=1,te.size=Math.abs(Ge),te.start=0,te.end=te.size}function _i(Pe,te,ie,me){for(let Se=0;Se<Pe.length;Se++){const Ue=[];Qe(Pe[Se],Ue,ie,me),te.push(Ue)}}function _t(Pe){return Pe/360+.5}function it(Pe){const te=Math.sin(Pe*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function ue(Pe,te,ie,me,Se,Ue,Ge,et){if(me/=te,Ue>=(ie/=te)&&Ge<me)return Pe;if(Ge<ie||Ue>=me)return null;const Re=[];for(const at of Pe){const yt=at.geometry;let rt=at.type;const Et=Se===0?at.minX:at.minY,Yt=Se===0?at.maxX:at.maxY;if(Et>=ie&&Yt<me){Re.push(at);continue}if(Yt<ie||Et>=me)continue;let ri=[];if(rt==="Point"||rt==="MultiPoint")H(yt,ri,ie,me,Se);else if(rt==="LineString")Y(yt,ri,ie,me,Se,!1,et.lineMetrics);else if(rt==="MultiLineString")Ze(yt,ri,ie,me,Se,!1);else if(rt==="Polygon")Ze(yt,ri,ie,me,Se,!0);else if(rt==="MultiPolygon")for(const Bi of yt){const wi=[];Ze(Bi,wi,ie,me,Se,!0),wi.length&&ri.push(wi)}if(ri.length){if(et.lineMetrics&&rt==="LineString"){for(const Bi of ri)Re.push(At(at.id,rt,Bi,at.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(ri.length===1?(rt="LineString",ri=ri[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=ri.length===3?"Point":"MultiPoint"),Re.push(At(at.id,rt,ri,at.tags))}}return Re.length?Re:null}function H(Pe,te,ie,me,Se){for(let Ue=0;Ue<Pe.length;Ue+=3){const Ge=Pe[Ue+Se];Ge>=ie&&Ge<=me&&dt(te,Pe[Ue],Pe[Ue+1],Pe[Ue+2])}}function Y(Pe,te,ie,me,Se,Ue,Ge){let et=Ae(Pe);const Re=Se===0?st:Ci;let at,yt,rt=Pe.start;for(let wi=0;wi<Pe.length-3;wi+=3){const zi=Pe[wi],Si=Pe[wi+1],hn=Pe[wi+2],fn=Pe[wi+3],Ke=Pe[wi+4],pi=Se===0?zi:Si,ki=Se===0?fn:Ke;let Ni=!1;Ge&&(at=Math.sqrt(Math.pow(zi-fn,2)+Math.pow(Si-Ke,2))),pi<ie?ki>ie&&(yt=Re(et,zi,Si,fn,Ke,ie),Ge&&(et.start=rt+at*yt)):pi>me?ki<me&&(yt=Re(et,zi,Si,fn,Ke,me),Ge&&(et.start=rt+at*yt)):dt(et,zi,Si,hn),ki<ie&&pi>=ie&&(yt=Re(et,zi,Si,fn,Ke,ie),Ni=!0),ki>me&&pi<=me&&(yt=Re(et,zi,Si,fn,Ke,me),Ni=!0),!Ue&&Ni&&(Ge&&(et.end=rt+at*yt),te.push(et),et=Ae(Pe)),Ge&&(rt+=at)}let Et=Pe.length-3;const Yt=Pe[Et],ri=Pe[Et+1],Bi=Se===0?Yt:ri;Bi>=ie&&Bi<=me&&dt(et,Yt,ri,Pe[Et+2]),Et=et.length-3,Ue&&Et>=3&&(et[Et]!==et[0]||et[Et+1]!==et[1])&&dt(et,et[0],et[1],et[2]),et.length&&te.push(et)}function Ae(Pe){const te=[];return te.size=Pe.size,te.start=Pe.start,te.end=Pe.end,te}function Ze(Pe,te,ie,me,Se,Ue){for(const Ge of Pe)Y(Ge,te,ie,me,Se,Ue,!1)}function dt(Pe,te,ie,me){Pe.push(te,ie,me)}function st(Pe,te,ie,me,Se,Ue){const Ge=(Ue-te)/(me-te);return dt(Pe,Ue,ie+(Se-ie)*Ge,1),Ge}function Ci(Pe,te,ie,me,Se,Ue){const Ge=(Ue-ie)/(Se-ie);return dt(Pe,te+(me-te)*Ge,Ue,1),Ge}function ft(Pe,te){const ie=[];for(let me=0;me<Pe.length;me++){const Se=Pe[me],Ue=Se.type;let Ge;if(Ue==="Point"||Ue==="MultiPoint"||Ue==="LineString")Ge=Wt(Se.geometry,te);else if(Ue==="MultiLineString"||Ue==="Polygon"){Ge=[];for(const et of Se.geometry)Ge.push(Wt(et,te))}else if(Ue==="MultiPolygon"){Ge=[];for(const et of Se.geometry){const Re=[];for(const at of et)Re.push(Wt(at,te));Ge.push(Re)}}ie.push(At(Se.id,Ue,Ge,Se.tags))}return ie}function Wt(Pe,te){const ie=[];ie.size=Pe.size,Pe.start!==void 0&&(ie.start=Pe.start,ie.end=Pe.end);for(let me=0;me<Pe.length;me+=3)ie.push(Pe[me]+te,Pe[me+1],Pe[me+2]);return ie}function Ei(Pe,te){if(Pe.transformed)return Pe;const ie=1<<Pe.z,me=Pe.x,Se=Pe.y;for(const Ue of Pe.features){const Ge=Ue.geometry,et=Ue.type;if(Ue.geometry=[],et===1)for(let Re=0;Re<Ge.length;Re+=2)Ue.geometry.push(Fi(Ge[Re],Ge[Re+1],te,ie,me,Se));else for(let Re=0;Re<Ge.length;Re++){const at=[];for(let yt=0;yt<Ge[Re].length;yt+=2)at.push(Fi(Ge[Re][yt],Ge[Re][yt+1],te,ie,me,Se));Ue.geometry.push(at)}}return Pe.transformed=!0,Pe}function Fi(Pe,te,ie,me,Se,Ue){return[Math.round(ie*(Pe*me-Se)),Math.round(ie*(te*me-Ue))]}function Cn(Pe,te,ie,me,Se){const Ue=te===Se.maxZoom?0:Se.tolerance/((1<<te)*Se.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:Pe.length,source:null,x:ie,y:me,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of Pe)kt(Ge,et,Ue,Se);return Ge}function kt(Pe,te,ie,me){const Se=te.geometry,Ue=te.type,Ge=[];if(Pe.minX=Math.min(Pe.minX,te.minX),Pe.minY=Math.min(Pe.minY,te.minY),Pe.maxX=Math.max(Pe.maxX,te.maxX),Pe.maxY=Math.max(Pe.maxY,te.maxY),Ue==="Point"||Ue==="MultiPoint")for(let et=0;et<Se.length;et+=3)Ge.push(Se[et],Se[et+1]),Pe.numPoints++,Pe.numSimplified++;else if(Ue==="LineString")ui(Ge,Se,Pe,ie,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(let et=0;et<Se.length;et++)ui(Ge,Se[et],Pe,ie,Ue==="Polygon",et===0);else if(Ue==="MultiPolygon")for(let et=0;et<Se.length;et++){const Re=Se[et];for(let at=0;at<Re.length;at++)ui(Ge,Re[at],Pe,ie,!0,at===0)}if(Ge.length){let et=te.tags||null;if(Ue==="LineString"&&me.lineMetrics){et={};for(const at in te.tags)et[at]=te.tags[at];et.mapbox_clip_start=Se.start/Se.size,et.mapbox_clip_end=Se.end/Se.size}const Re={geometry:Ge,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:et};te.id!==null&&(Re.id=te.id),Pe.features.push(Re)}}function ui(Pe,te,ie,me,Se,Ue){const Ge=me*me;if(me>0&&te.size<(Se?Ge:me))return void(ie.numPoints+=te.length/3);const et=[];for(let Re=0;Re<te.length;Re+=3)(me===0||te[Re+2]>Ge)&&(ie.numSimplified++,et.push(te[Re],te[Re+1])),ie.numPoints++;Se&&function(Re,at){let yt=0;for(let rt=0,Et=Re.length,Yt=Et-2;rt<Et;Yt=rt,rt+=2)yt+=(Re[rt]-Re[Yt])*(Re[rt+1]+Re[Yt+1]);if(yt>0===at)for(let rt=0,Et=Re.length;rt<Et/2;rt+=2){const Yt=Re[rt],ri=Re[rt+1];Re[rt]=Re[Et-2-rt],Re[rt+1]=Re[Et-1-rt],Re[Et-2-rt]=Yt,Re[Et-1-rt]=ri}}(et,Ue),Pe.push(et)}const ii={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class nn{constructor(te,ie){const me=(ie=this.options=function(Ue,Ge){for(const et in Ge)Ue[et]=Ge[et];return Ue}(Object.create(ii),ie)).debug;if(me&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=function(Ue,Ge){const et=[];if(Ue.type==="FeatureCollection")for(let Re=0;Re<Ue.features.length;Re++)Pt(et,Ue.features[Re],Ge,Re);else Pt(et,Ue.type==="Feature"?Ue:{geometry:Ue},Ge);return et}(te,ie);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=function(Ue,Ge){const et=Ge.buffer/Ge.extent;let Re=Ue;const at=ue(Ue,1,-1-et,et,0,-1,2,Ge),yt=ue(Ue,1,1-et,2+et,0,-1,2,Ge);return(at||yt)&&(Re=ue(Ue,1,-et,1+et,0,-1,2,Ge)||[],at&&(Re=ft(at,1).concat(Re)),yt&&(Re=Re.concat(ft(yt,-1)))),Re}(Se,ie),Se.length&&this.splitTile(Se,0,0,0),me&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,ie,me,Se,Ue,Ge,et){const Re=[te,ie,me,Se],at=this.options,yt=at.debug;for(;Re.length;){Se=Re.pop(),me=Re.pop(),ie=Re.pop(),te=Re.pop();const rt=1<<ie,Et=gr(ie,me,Se);let Yt=this.tiles[Et];if(!Yt&&(yt>1&&console.time("creation"),Yt=this.tiles[Et]=Cn(te,ie,me,Se,at),this.tileCoords.push({z:ie,x:me,y:Se}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,me,Se,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));const Ni=`z${ie}`;this.stats[Ni]=(this.stats[Ni]||0)+1,this.total++}if(Yt.source=te,Ue==null){if(ie===at.indexMaxZoom||Yt.numPoints<=at.indexMaxPoints)continue}else{if(ie===at.maxZoom||ie===Ue)continue;if(Ue!=null){const Ni=Ue-ie;if(me!==Ge>>Ni||Se!==et>>Ni)continue}}if(Yt.source=null,te.length===0)continue;yt>1&&console.time("clipping");const ri=.5*at.buffer/at.extent,Bi=.5-ri,wi=.5+ri,zi=1+ri;let Si=null,hn=null,fn=null,Ke=null,pi=ue(te,rt,me-ri,me+wi,0,Yt.minX,Yt.maxX,at),ki=ue(te,rt,me+Bi,me+zi,0,Yt.minX,Yt.maxX,at);te=null,pi&&(Si=ue(pi,rt,Se-ri,Se+wi,1,Yt.minY,Yt.maxY,at),hn=ue(pi,rt,Se+Bi,Se+zi,1,Yt.minY,Yt.maxY,at),pi=null),ki&&(fn=ue(ki,rt,Se-ri,Se+wi,1,Yt.minY,Yt.maxY,at),Ke=ue(ki,rt,Se+Bi,Se+zi,1,Yt.minY,Yt.maxY,at),ki=null),yt>1&&console.timeEnd("clipping"),Re.push(Si||[],ie+1,2*me,2*Se),Re.push(hn||[],ie+1,2*me,2*Se+1),Re.push(fn||[],ie+1,2*me+1,2*Se),Re.push(Ke||[],ie+1,2*me+1,2*Se+1)}}getTile(te,ie,me){te=+te,ie=+ie,me=+me;const Se=this.options,{extent:Ue,debug:Ge}=Se;if(te<0||te>24)return null;const et=1<<te,Re=gr(te,ie=ie+et&et-1,me);if(this.tiles[Re])return Ei(this.tiles[Re],Ue);Ge>1&&console.log("drilling down to z%d-%d-%d",te,ie,me);let at,yt=te,rt=ie,Et=me;for(;!at&&yt>0;)yt--,rt>>=1,Et>>=1,at=this.tiles[gr(yt,rt,Et)];return at&&at.source?(Ge>1&&(console.log("found parent tile z%d-%d-%d",yt,rt,Et),console.time("drilling down")),this.splitTile(at.source,yt,rt,Et,te,ie,me),Ge>1&&console.timeEnd("drilling down"),this.tiles[Re]?Ei(this.tiles[Re],Ue):null):null}}function gr(Pe,te,ie){return 32*((1<<Pe)*ie+te)+Pe}function ai(Pe,te){return te?Pe.properties[te]:Pe.id}function _r(Pe,te){if(Pe==null)return!0;if(Pe.type==="Feature")return ai(Pe,te)!=null;if(Pe.type==="FeatureCollection"){const ie=new Set;for(const me of Pe.features){const Se=ai(me,te);if(Se==null||ie.has(Se))return!1;ie.add(Se)}return!0}return!1}function yr(Pe,te){const ie=new Map;if(Pe!=null)if(Pe.type==="Feature")ie.set(ai(Pe,te),Pe);else for(const me of Pe.features)ie.set(ai(me,te),me);return ie}class Ir extends y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(te,ie){return h._(this,void 0,void 0,function*(){const me=te.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!Se)return null;const Ue=new class{constructor(et){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.X,this.length=et.length,this._features=et}feature(et){return new class{constructor(Re){this._feature=Re,this.extent=h.X,this.type=Re.type,this.properties=Re.tags,"id"in Re&&!isNaN(Re.id)&&(this.id=parseInt(Re.id,10))}loadGeometry(){if(this._feature.type===1){const Re=[];for(const at of this._feature.geometry)Re.push([new h.P(at[0],at[1])]);return Re}{const Re=[];for(const at of this._feature.geometry){const yt=[];for(const rt of at)yt.push(new h.P(rt[0],rt[1]));Re.push(yt)}return Re}}toGeoJSON(Re,at,yt){return R.call(this,Re,at,yt)}}(this._features[et])}}(Se.features);let Ge=ye(Ue);return Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),{vectorTile:Ue,rawData:Ge.buffer}})}loadData(te){return h._(this,void 0,void 0,function*(){var ie;(ie=this._pendingRequest)===null||ie===void 0||ie.abort();const me=!!(te&&te.request&&te.request.collectResourceTiming)&&new h.bv(te.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(te,this._pendingRequest),this._geoJSONIndex=te.cluster?new $e(function({superclusterOptions:Ge,clusterProperties:et}){if(!et||!Ge)return Ge;const Re={},at={},yt={accumulated:null,zoom:0},rt={properties:null},Et=Object.keys(et);for(const Yt of Et){const[ri,Bi]=et[Yt],wi=h.bC(Bi),zi=h.bC(typeof ri=="string"?[ri,["accumulated"],["get",Yt]]:ri);Re[Yt]=wi.value,at[Yt]=zi.value}return Ge.map=Yt=>{rt.properties=Yt;const ri={};for(const Bi of Et)ri[Bi]=Re[Bi].evaluate(yt,rt);return ri},Ge.reduce=(Yt,ri)=>{rt.properties=ri;for(const Bi of Et)yt.accumulated=Yt[Bi],Yt[Bi]=at[Bi].evaluate(yt,rt)},Ge}(te)).load((yield this._pendingData).features):(Se=yield this._pendingData,new nn(Se,te.geojsonVtOptions)),this.loaded={};const Ue={};if(me){const Ge=me.finish();Ge&&(Ue.resourceTiming={},Ue.resourceTiming[te.source]=JSON.parse(JSON.stringify(Ge)))}return Ue}catch(Ue){if(delete this._pendingRequest,h.bB(Ue))return{abandoned:!0};throw Ue}var Se})}getData(){return h._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(te){const ie=this.loaded;return ie&&ie[te.uid]?super.reloadTile(te):this.loadTile(te)}loadAndProcessGeoJSON(te,ie){return h._(this,void 0,void 0,function*(){let me=yield this.loadGeoJSON(te,ie);if(delete this._pendingRequest,typeof me!="object")throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(L(me,!0),te.filter){const Se=h.bC(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(Ge=>`${Ge.key}: ${Ge.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(Ge=>Se.value.evaluate({zoom:0},Ge))}}return me})}loadGeoJSON(te,ie){return h._(this,void 0,void 0,function*(){const{promoteId:me}=te;if(te.request){const Se=yield h.h(te.request,ie);return this._dataUpdateable=_r(Se.data,me)?yr(Se.data,me):void 0,Se.data}if(typeof te.data=="string")try{const Se=JSON.parse(te.data);return this._dataUpdateable=_r(Se,me)?yr(Se,me):void 0,Se}catch{throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`)}if(!te.dataDiff)throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${te.source}`);return function(Se,Ue,Ge){var et,Re,at,yt;if(Ue.removeAll&&Se.clear(),Ue.remove)for(const rt of Ue.remove)Se.delete(rt);if(Ue.add)for(const rt of Ue.add){const Et=ai(rt,Ge);Et!=null&&Se.set(Et,rt)}if(Ue.update)for(const rt of Ue.update){let Et=Se.get(rt.id);if(Et==null)continue;const Yt=!rt.removeAllProperties&&(((et=rt.removeProperties)===null||et===void 0?void 0:et.length)>0||((Re=rt.addOrUpdateProperties)===null||Re===void 0?void 0:Re.length)>0);if((rt.newGeometry||rt.removeAllProperties||Yt)&&(Et=Object.assign({},Et),Se.set(rt.id,Et),Yt&&(Et.properties=Object.assign({},Et.properties))),rt.newGeometry&&(Et.geometry=rt.newGeometry),rt.removeAllProperties)Et.properties={};else if(((at=rt.removeProperties)===null||at===void 0?void 0:at.length)>0)for(const ri of rt.removeProperties)Object.prototype.hasOwnProperty.call(Et.properties,ri)&&delete Et.properties[ri];if(((yt=rt.addOrUpdateProperties)===null||yt===void 0?void 0:yt.length)>0)for(const{key:ri,value:Bi}of rt.addOrUpdateProperties)Et.properties[ri]=Bi}}(this._dataUpdateable,te.dataDiff,me),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(te){return h._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(te){return this._geoJSONIndex.getClusterExpansionZoom(te.clusterId)}getClusterChildren(te){return this._geoJSONIndex.getChildren(te.clusterId)}getClusterLeaves(te){return this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset)}}class Ar{constructor(te){this.self=te,this.actor=new h.F(te),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ie,me)=>{if(this.externalWorkerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.externalWorkerSourceTypes[ie]=me},this.self.addProtocol=h.bi,this.self.removeProtocol=h.bj,this.self.registerRTLTextPlugin=ie=>{if(h.bD.isParsed())throw new Error("RTL text plugin already registered.");h.bD.setMethods(ie)},this.actor.registerMessageHandler("LDT",(ie,me)=>this._getDEMWorkerSource(ie,me.source).loadTile(me)),this.actor.registerMessageHandler("RDT",(ie,me)=>h._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ie,me.source).removeTile(me)})),this.actor.registerMessageHandler("GCEZ",(ie,me)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,me.type,me.source).getClusterExpansionZoom(me)})),this.actor.registerMessageHandler("GCC",(ie,me)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,me.type,me.source).getClusterChildren(me)})),this.actor.registerMessageHandler("GCL",(ie,me)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,me.type,me.source).getClusterLeaves(me)})),this.actor.registerMessageHandler("LD",(ie,me)=>this._getWorkerSource(ie,me.type,me.source).loadData(me)),this.actor.registerMessageHandler("GD",(ie,me)=>this._getWorkerSource(ie,me.type,me.source).getData()),this.actor.registerMessageHandler("LT",(ie,me)=>this._getWorkerSource(ie,me.type,me.source).loadTile(me)),this.actor.registerMessageHandler("RT",(ie,me)=>this._getWorkerSource(ie,me.type,me.source).reloadTile(me)),this.actor.registerMessageHandler("AT",(ie,me)=>this._getWorkerSource(ie,me.type,me.source).abortTile(me)),this.actor.registerMessageHandler("RMT",(ie,me)=>this._getWorkerSource(ie,me.type,me.source).removeTile(me)),this.actor.registerMessageHandler("RS",(ie,me)=>h._(this,void 0,void 0,function*(){if(!this.workerSources[ie]||!this.workerSources[ie][me.type]||!this.workerSources[ie][me.type][me.source])return;const Se=this.workerSources[ie][me.type][me.source];delete this.workerSources[ie][me.type][me.source],Se.removeSource!==void 0&&Se.removeSource(me)})),this.actor.registerMessageHandler("RM",ie=>h._(this,void 0,void 0,function*(){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie]})),this.actor.registerMessageHandler("SR",(ie,me)=>h._(this,void 0,void 0,function*(){this.referrer=me})),this.actor.registerMessageHandler("SRPS",(ie,me)=>this._syncRTLPluginState(ie,me)),this.actor.registerMessageHandler("IS",(ie,me)=>h._(this,void 0,void 0,function*(){this.self.importScripts(me)})),this.actor.registerMessageHandler("SI",(ie,me)=>this._setImages(ie,me)),this.actor.registerMessageHandler("UL",(ie,me)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(ie).update(me.layers,me.removedIds)})),this.actor.registerMessageHandler("SL",(ie,me)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(ie).replace(me)}))}_setImages(te,ie){return h._(this,void 0,void 0,function*(){this.availableImages[te]=ie;for(const me in this.workerSources[te]){const Se=this.workerSources[te][me];for(const Ue in Se)Se[Ue].availableImages=ie}})}_syncRTLPluginState(te,ie){return h._(this,void 0,void 0,function*(){if(h.bD.isParsed())return h.bD.getState();if(ie.pluginStatus!=="loading")return h.bD.setState(ie),ie;const me=ie.pluginURL;if(this.self.importScripts(me),h.bD.isParsed()){const Se={pluginStatus:"loaded",pluginURL:me};return h.bD.setState(Se),Se}throw h.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${me}`)})}_getAvailableImages(te){let ie=this.availableImages[te];return ie||(ie=[]),ie}_getLayerIndex(te){let ie=this.layerIndexes[te];return ie||(ie=this.layerIndexes[te]=new a),ie}_getWorkerSource(te,ie,me){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][ie]||(this.workerSources[te][ie]={}),!this.workerSources[te][ie][me]){const Se={sendAsync:(Ue,Ge)=>(Ue.targetMapId=te,this.actor.sendAsync(Ue,Ge))};switch(ie){case"vector":this.workerSources[te][ie][me]=new y(Se,this._getLayerIndex(te),this._getAvailableImages(te));break;case"geojson":this.workerSources[te][ie][me]=new Ir(Se,this._getLayerIndex(te),this._getAvailableImages(te));break;default:this.workerSources[te][ie][me]=new this.externalWorkerSourceTypes[ie](Se,this._getLayerIndex(te),this._getAvailableImages(te))}}return this.workerSources[te][ie][me]}_getDEMWorkerSource(te,ie){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][ie]||(this.demWorkerSources[te][ie]=new C),this.demWorkerSources[te][ie]}}return h.i(self)&&(self.worker=new Ar(self)),Ar}),c("index",["exports","./shared"],function(h,a){var _="4.7.1";let S,k;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((t,u)=>{const p=requestAnimationFrame(t);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),u(a.c())})}),getImageData(v,t=0){return this.getImageCanvasContext(v).getImageData(-t,-t,v.width+2*t,v.height+2*t)},getImageCanvasContext(v){const t=window.document.createElement("canvas"),u=t.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return t.width=v.width,t.height=v.height,u.drawImage(v,0,0,v.width,v.height),u},resolveURL:v=>(S||(S=document.createElement("a")),S.href=v,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class C{static testProp(t){if(!C.docStyle)return t[0];for(let u=0;u<t.length;u++)if(t[u]in C.docStyle)return t[u];return t[0]}static create(t,u,p){const m=window.document.createElement(t);return u!==void 0&&(m.className=u),p&&p.appendChild(m),m}static createNS(t,u){return window.document.createElementNS(t,u)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(t,u){t.style[C.transformProp]=u}static addEventListener(t,u,p,m={}){t.addEventListener(u,p,"passive"in m?m:m.capture)}static removeEventListener(t,u,p,m={}){t.removeEventListener(u,p,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(t){const u=t.getBoundingClientRect();return{x:u.width/t.offsetWidth||1,y:u.height/t.offsetHeight||1,boundingClientRect:u}}static getPoint(t,u,p){const m=u.boundingClientRect;return new a.P((p.clientX-m.left)/u.x-t.clientLeft,(p.clientY-m.top)/u.y-t.clientTop)}static mousePos(t,u){const p=C.getScale(t);return C.getPoint(t,p,u)}static touchPos(t,u){const p=[],m=C.getScale(t);for(let b=0;b<u.length;b++)p.push(C.getPoint(t,m,u[b]));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const E={supported:!1,testSupport:function(v){!R&&L&&(N?z(v):T=v)}};let T,L,R=!1,N=!1;function z(v){const t=v.createTexture();v.bindTexture(v.TEXTURE_2D,t);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,L),v.isContextLost())return;E.supported=!0}catch{}v.deleteTexture(t),R=!0}var V;typeof document<"u"&&(L=document.createElement("img"),L.onload=()=>{T&&z(T),T=null,N=!0},L.onerror=()=>{R=!0,T=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let t,u,p,m;v.resetRequestQueue=()=>{t=[],u=0,p=0,m={}},v.addThrottleControl=O=>{const Z=p++;return m[Z]=O,Z},v.removeThrottleControl=O=>{delete m[O],A()},v.getImage=(O,Z,K=!0)=>new Promise((J,ae)=>{E.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),a.e(O,{type:"image"}),t.push({abortController:Z,requestParameters:O,supportImageRefresh:K,state:"queued",onError:_e=>{ae(_e)},onSuccess:_e=>{J(_e)}}),A()});const b=O=>a._(this,void 0,void 0,function*(){O.state="running";const{requestParameters:Z,supportImageRefresh:K,onError:J,onSuccess:ae,abortController:_e}=O,xe=K===!1&&!a.i(self)&&!a.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce((De,je)=>De&&je==="accept",!0));u++;const Ee=xe?P(Z,_e):a.m(Z,_e);try{const De=yield Ee;delete O.abortController,O.state="completed",De.data instanceof HTMLImageElement||a.b(De.data)?ae(De):De.data&&ae({data:yield(Oe=De.data,typeof createImageBitmap=="function"?a.d(Oe):a.f(Oe)),cacheControl:De.cacheControl,expires:De.expires})}catch(De){delete O.abortController,J(De)}finally{u--,A()}var Oe}),A=()=>{const O=(()=>{for(const Z of Object.keys(m))if(m[Z]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=u;Z<O&&t.length>0;Z++){const K=t.shift();K.abortController.signal.aborted?Z--:b(K)}},P=(O,Z)=>new Promise((K,J)=>{const ae=new Image,_e=O.url,xe=O.credentials;xe&&xe==="include"?ae.crossOrigin="use-credentials":(xe&&xe==="same-origin"||!a.s(_e))&&(ae.crossOrigin="anonymous"),Z.signal.addEventListener("abort",()=>{ae.src="",J(a.c())}),ae.fetchPriority="high",ae.onload=()=>{ae.onerror=ae.onload=null,K({data:ae})},ae.onerror=()=>{ae.onerror=ae.onload=null,Z.signal.aborted||J(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ae.src=_e})}(V||(V={})),V.resetRequestQueue();class Q{constructor(t){this._transformRequestFn=t}transformRequest(t,u){return this._transformRequestFn&&this._transformRequestFn(t,u)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function oe(v){var t=new a.A(3);return t[0]=v[0],t[1]=v[1],t[2]=v[2],t}var ee,ne=function(v,t,u){return v[0]=t[0]-u[0],v[1]=t[1]-u[1],v[2]=t[2]-u[2],v};ee=new a.A(3),a.A!=Float32Array&&(ee[0]=0,ee[1]=0,ee[2]=0);var j=function(v){var t=v[0],u=v[1];return t*t+u*u};function U(v){const t=[];if(typeof v=="string")t.push({id:"default",url:v});else if(v&&v.length>0){const u=[];for(const{id:p,url:m}of v){const b=`${p}${m}`;u.indexOf(b)===-1&&(u.push(b),t.push({id:p,url:m}))}}return t}function X(v,t,u){const p=v.split("?");return p[0]+=`${t}${u}`,p.join("?")}(function(){var v=new a.A(2);a.A!=Float32Array&&(v[0]=0,v[1]=0)})();class B{constructor(t,u,p,m){this.context=t,this.format=p,this.texture=t.gl.createTexture(),this.update(u,m)}update(t,u,p){const{width:m,height:b}=t,A=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:P}=this,{gl:O}=P;if(this.useMipmap=!!(u&&u.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!u||u.premultiply!==!1)),A)this.size=[m,b],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.b(t)?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,t):O.texImage2D(O.TEXTURE_2D,0,this.format,m,b,0,this.format,O.UNSIGNED_BYTE,t.data);else{const{x:Z,y:K}=p||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.b(t)?O.texSubImage2D(O.TEXTURE_2D,0,Z,K,O.RGBA,O.UNSIGNED_BYTE,t):O.texSubImage2D(O.TEXTURE_2D,0,Z,K,m,b,O.RGBA,O.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)}bind(t,u,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),t!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,t),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||t),this.filter=t),u!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function W(v){const{userImage:t}=v;return!!(t&&t.render&&t.render())&&(v.data.replace(new Uint8Array(t.data.buffer)),!0)}class ce extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:u,promiseResolve:p}of this.requestors)p(this._getImagesForIds(u));this.requestors=[]}}getImage(t){const u=this.images[t];if(u&&!u.data&&u.spriteData){const p=u.spriteData;u.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),u.spriteData=null}return u}addImage(t,u){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,u)&&(this.images[t]=u)}_validate(t,u){let p=!0;const m=u.data||u.spriteData;return this._validateStretch(u.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new a.j(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,u){if(!t)return!0;let p=0;for(const m of t){if(m[0]<p||m[1]<m[0]||u<m[1])return!1;p=m[1]}return!0}_validateContent(t,u){if(!t)return!0;if(t.length!==4)return!1;const p=u.spriteData,m=p&&p.width||u.data.width,b=p&&p.height||u.data.height;return!(t[0]<0||m<t[0]||t[1]<0||b<t[1]||t[2]<0||m<t[2]||t[3]<0||b<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,u,p=!0){const m=this.getImage(t);if(p&&(m.data.width!==u.data.width||m.data.height!==u.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=m.version+1,this.images[t]=u,this.updatedImages[t]=!0}removeImage(t){const u=this.images[t];delete this.images[t],delete this.patterns[t],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((u,p)=>{let m=!0;if(!this.isLoaded())for(const b of t)this.images[b]||(m=!1);this.isLoaded()||m?u(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:u})})}_getImagesForIds(t){const u={};for(const p of t){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?u[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:t,height:u}=this.atlasImage;return{width:t,height:u}}getPattern(t){const u=this.patterns[t],p=this.getImage(t);if(!p)return null;if(u&&u.position.version===p.version)return u.position;if(u)u.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new a.I(m,p);this.patterns[t]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const u=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new B(t,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:u,h:p}=a.p(t),m=this.atlasImage;m.resize({width:u||1,height:p||1});for(const b in this.patterns){const{bin:A}=this.patterns[b],P=A.x+1,O=A.y+1,Z=this.getImage(b).data,K=Z.width,J=Z.height;a.R.copy(Z,m,{x:0,y:0},{x:P,y:O},{width:K,height:J}),a.R.copy(Z,m,{x:0,y:J-1},{x:P,y:O-1},{width:K,height:1}),a.R.copy(Z,m,{x:0,y:0},{x:P,y:O+J},{width:K,height:1}),a.R.copy(Z,m,{x:K-1,y:0},{x:P-1,y:O},{width:1,height:J}),a.R.copy(Z,m,{x:0,y:0},{x:P+K,y:O},{width:1,height:J})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const u of t){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const p=this.getImage(u);p||a.w(`Image with ID: "${u}" was not found`),W(p)&&this.updateImage(u,p)}}}const pe=1e20;function be(v,t,u,p,m,b,A,P,O){for(let Z=t;Z<t+p;Z++)de(v,u*b+Z,b,m,A,P,O);for(let Z=u;Z<u+m;Z++)de(v,Z*b+t,1,p,A,P,O)}function de(v,t,u,p,m,b,A){b[0]=0,A[0]=-pe,A[1]=pe,m[0]=v[t];for(let P=1,O=0,Z=0;P<p;P++){m[P]=v[t+P*u];const K=P*P;do{const J=b[O];Z=(m[P]-m[J]+K-J*J)/(P-J)/2}while(Z<=A[O]&&--O>-1);O++,b[O]=P,A[O]=Z,A[O+1]=pe}for(let P=0,O=0;P<p;P++){for(;A[O+1]<P;)O++;const Z=b[O],K=P-Z;v[t+P*u]=m[Z]+K*K}}class ye{constructor(t,u){this.requestManager=t,this.localIdeographFontFamily=u,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return a._(this,void 0,void 0,function*(){const u=[];for(const b in t)for(const A of t[b])u.push(this._getAndCacheGlyphsPromise(b,A));const p=yield Promise.all(u),m={};for(const{stack:b,id:A,glyph:P}of p)m[b]||(m[b]={}),m[b][A]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return m})}_getAndCacheGlyphsPromise(t,u){return a._(this,void 0,void 0,function*(){let p=this.entries[t];p||(p=this.entries[t]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[u];if(m!==void 0)return{stack:t,id:u,glyph:m};if(m=this._tinySDF(p,t,u),m)return p.glyphs[u]=m,{stack:t,id:u,glyph:m};const b=Math.floor(u/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:t,id:u,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const P=ye.loadGlyphRange(t,b,this.url,this.requestManager);p.requests[b]=P}const A=yield p.requests[b];for(const P in A)this._doesCharSupportLocalGlyph(+P)||(p.glyphs[+P]=A[+P]);return p.ranges[b]=!0,{stack:t,id:u,glyph:A[u]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))}_tinySDF(t,u,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=t.tinySDF;if(!b){let P="400";/bold/i.test(u)?P="900":/medium/i.test(u)?P="500":/light/i.test(u)&&(P="200"),b=t.tinySDF=new ye.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:P})}const A=b.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}ye.loadGlyphRange=function(v,t,u,p){return a._(this,void 0,void 0,function*(){const m=256*t,b=m+255,A=p.transformRequest(u.replace("{fontstack}",v).replace("{range}",`${m}-${b}`),"Glyphs"),P=yield a.l(A,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${t}, ${m}-${b}`);const O={};for(const Z of a.n(P.data))O[Z.id]=Z;return O})},ye.TinySDF=class{constructor({fontSize:v=24,buffer:t=3,radius:u=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:A="normal"}={}){this.buffer=t,this.cutoff=p,this.radius=u;const P=this.size=v+4*t,O=this._createCanvas(P),Z=this.ctx=O.getContext("2d",{willReadFrequently:!0});Z.font=`${A} ${b} ${v}px ${m}`,Z.textBaseline="alphabetic",Z.textAlign="left",Z.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(v){const t=document.createElement("canvas");return t.width=t.height=v,t}draw(v){const{width:t,actualBoundingBoxAscent:u,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(v),A=Math.ceil(u),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),O=Math.min(this.size-this.buffer,A+Math.ceil(p)),Z=P+2*this.buffer,K=O+2*this.buffer,J=Math.max(Z*K,0),ae=new Uint8ClampedArray(J),_e={data:ae,width:Z,height:K,glyphWidth:P,glyphHeight:O,glyphTop:A,glyphLeft:0,glyphAdvance:t};if(P===0||O===0)return _e;const{ctx:xe,buffer:Ee,gridInner:Oe,gridOuter:De}=this;xe.clearRect(Ee,Ee,P,O),xe.fillText(v,Ee,Ee+A);const je=xe.getImageData(Ee,Ee,P,O);De.fill(pe,0,J),Oe.fill(0,0,J);for(let Te=0;Te<O;Te++)for(let He=0;He<P;He++){const Je=je.data[4*(Te*P+He)+3]/255;if(Je===0)continue;const nt=(Te+Ee)*Z+He+Ee;if(Je===1)De[nt]=0,Oe[nt]=pe;else{const bt=.5-Je;De[nt]=bt>0?bt*bt:0,Oe[nt]=bt<0?bt*bt:0}}be(De,0,0,Z,K,Z,this.f,this.v,this.z),be(Oe,Ee,Ee,P,O,Z,this.f,this.v,this.z);for(let Te=0;Te<J;Te++){const He=Math.sqrt(De[Te])-Math.sqrt(Oe[Te]);ae[Te]=Math.round(255-255*(He/this.radius+this.cutoff))}return _e}};class Ie{constructor(){this.specification=a.v.light.position}possiblyEvaluate(t,u){return a.x(t.expression.evaluate(u))}interpolate(t,u,p){return{x:a.y.number(t.x,u.x,p),y:a.y.number(t.y,u.y,p),z:a.y.number(t.z,u.z,p)}}}let Me;class ot extends a.E{constructor(t){super(),Me=Me||new a.q({anchor:new a.D(a.v.light.anchor),position:new Ie,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Me),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,u={}){if(!this._validate(a.r,t,u))for(const p in t){const m=t[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,u,p){return(!p||p.validate!==!1)&&a.t(this,t.call(a.u,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const We=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class pt extends a.E{constructor(t){super(),this._transitionable=new a.T(We),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(t,u={}){if(!this._validate(a.B,t,u)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in t){const m=t[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,u,p={}){return(p==null?void 0:p.validate)!==!1&&a.t(this,t.call(a.u,a.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Tt{constructor(t,u){this.width=t,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,u){const p=t.join(",")+String(u);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(t,u)),this.dashEntry[p]}getDashRanges(t,u,p){const m=[];let b=t.length%2==1?-t[t.length-1]*p:0,A=t[0]*p,P=!0;m.push({left:b,right:A,isDash:P,zeroLength:t[0]===0});let O=t[0];for(let Z=1;Z<t.length;Z++){P=!P;const K=t[Z];b=O*p,O+=K,A=O*p,m.push({left:b,right:A,isDash:P,zeroLength:K===0})}return m}addRoundDash(t,u,p){const m=u/2;for(let b=-p;b<=p;b++){const A=this.width*(this.nextRow+p+b);let P=0,O=t[P];for(let Z=0;Z<this.width;Z++){Z/O.right>1&&(O=t[++P]);const K=Math.abs(Z-O.left),J=Math.abs(Z-O.right),ae=Math.min(K,J);let _e;const xe=b/p*(m+1);if(O.isDash){const Ee=m-Math.abs(xe);_e=Math.sqrt(ae*ae+Ee*Ee)}else _e=m-Math.sqrt(ae*ae+xe*xe);this.data[A+Z]=Math.max(0,Math.min(255,_e+128))}}}addRegularDash(t){for(let P=t.length-1;P>=0;--P){const O=t[P],Z=t[P+1];O.zeroLength?t.splice(P,1):Z&&Z.isDash===O.isDash&&(Z.left=O.left,t.splice(P,1))}const u=t[0],p=t[t.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const m=this.width*this.nextRow;let b=0,A=t[b];for(let P=0;P<this.width;P++){P/A.right>1&&(A=t[++b]);const O=Math.abs(P-A.left),Z=Math.abs(P-A.right),K=Math.min(O,Z);this.data[m+P]=Math.max(0,Math.min(255,(A.isDash?K:-K)+128))}}addDash(t,u){const p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let P=0;P<t.length;P++)b+=t[P];if(b!==0){const P=this.width/b,O=this.getDashRanges(t,this.width,P);u?this.addRoundDash(O,P,p):this.addRegularDash(O)}const A={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,A}bind(t){const u=t.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const $e="maplibre_preloaded_worker_pool";class wt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$e]}numActive(){return Object.keys(this.active).length}}const St=Math.floor(y.hardwareConcurrency/2);let Ht,oi;function Mi(){return Ht||(Ht=new wt),Ht}wt.workerCount=a.C(globalThis)?Math.max(Math.min(St,3),1):1;class Pi{constructor(t,u){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u;const p=this.workerPool.acquire(u);for(let m=0;m<p.length;m++){const b=new a.F(p[m],u);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,u){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:t,data:u}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,u){for(const p of this.actors)p.registerMessageHandler(t,u)}}function Ti(){return oi||(oi=new Pi(Mi(),a.G),oi.registerMessageHandler("GR",(v,t,u)=>a.m(t,u))),oi}function At(v,t){const u=a.H();return a.J(u,u,[1,1,0]),a.K(u,u,[.5*v.width,.5*v.height,1]),a.L(u,u,v.calculatePosMatrix(t.toUnwrapped()))}function Xe(v,t,u,p,m,b){const A=function(J,ae,_e){if(J)for(const xe of J){const Ee=ae[xe];if(Ee&&Ee.source===_e&&Ee.type==="fill-extrusion")return!0}else for(const xe in ae){const Ee=ae[xe];if(Ee.source===_e&&Ee.type==="fill-extrusion")return!0}return!1}(m&&m.layers,t,v.id),P=b.maxPitchScaleFactor(),O=v.tilesIn(p,P,A);O.sort(Pt);const Z=[];for(const J of O)Z.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(t,u,v._state,J.queryGeometry,J.cameraQueryGeometry,J.scale,m,b,P,At(v.transform,J.tileID))});const K=function(J){const ae={},_e={};for(const xe of J){const Ee=xe.queryResults,Oe=xe.wrappedTileID,De=_e[Oe]=_e[Oe]||{};for(const je in Ee){const Te=Ee[je],He=De[je]=De[je]||{},Je=ae[je]=ae[je]||[];for(const nt of Te)He[nt.featureIndex]||(He[nt.featureIndex]=!0,Je.push(nt))}}return ae}(Z);for(const J in K)K[J].forEach(ae=>{const _e=ae.feature,xe=v.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=xe});return K}function Pt(v,t){const u=v.tileID,p=t.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}function ni(v,t,u){return a._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield a.h(t.transformRequest(v.url,"Source"),u)).data:yield y.frameAsync(u),!p)return null;const m=a.M(a.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class Qe{constructor(t,u){t&&(u?this.setSouthWest(t).setNorthEast(u):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof a.N?new a.N(t.lng,t.lat):a.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof a.N?new a.N(t.lng,t.lat):a.N.convert(t),this}extend(t){const u=this._sw,p=this._ne;let m,b;if(t instanceof a.N)m=t,b=t;else{if(!(t instanceof Qe))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Qe.convert(t)):this.extend(a.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(a.N.convert(t)):this;if(m=t._sw,b=t._ne,!m||!b)return this}return u||p?(u.lng=Math.min(m.lng,u.lng),u.lat=Math.min(m.lat,u.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new a.N(m.lng,m.lat),this._ne=new a.N(b.lng,b.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:u,lat:p}=a.N.convert(t);let m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(t){return t instanceof Qe?t:t&&new Qe(t)}static fromLngLat(t,u=0){const p=360*u/40075017,m=p/Math.cos(Math.PI/180*t.lat);return new Qe(new a.N(t.lng-m,t.lat-p),new a.N(t.lng+m,t.lat+p))}adjustAntiMeridian(){const t=new a.N(this._sw.lng,this._sw.lat),u=new a.N(this._ne.lng,this._ne.lat);return new Qe(t,t.lng>u.lng?new a.N(u.lng+360,u.lat):u)}}class _i{constructor(t,u,p){this.bounds=Qe.convert(this.validateBounds(t)),this.minzoom=u||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const u=Math.pow(2,t.z),p=Math.floor(a.O(this.bounds.getWest())*u),m=Math.floor(a.Q(this.bounds.getNorth())*u),b=Math.ceil(a.O(this.bounds.getEast())*u),A=Math.ceil(a.Q(this.bounds.getSouth())*u);return t.x>=p&&t.x<b&&t.y>=m&&t.y<A}}class _t extends a.E{constructor(t,u,p,m){if(super(),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(u,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ni(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(a.e(this,t),t.bounds&&(this.tileBounds=new _i(t.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new a.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(t){return a._(this,void 0,void 0,function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(u,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((b,A)=>{t.reloadPromise={resolve:b,reject:A}})}else t.actor=this.dispatcher.getActor(),m="LT";t.abortController=new AbortController;try{const b=yield t.actor.sendAsync({type:m,data:p},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,b)}catch(b){if(delete t.abortController,t.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,u){if(u&&u.resourceTiming&&(t.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&t.setExpiryData(u),t.loadVectorData(u,this.map.painter),t.reloadPromise){const p=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(p.resolve).catch(p.reject)}}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class it extends a.E{constructor(t,u,p,m){super(),this.id=t,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},u),a.e(this,a.M(u,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ni(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(a.e(this,t),t.bounds&&(this.tileBounds=new _i(t.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new a.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return a.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return a._(this,void 0,void 0,function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const p=yield V.getImage(this.map._requestManager.transformRequest(u,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,A=p.data;t.texture=this.map.painter.getTileTexture(A.width),t.texture?t.texture.update(A,{useMipmap:!0}):(t.texture=new B(m,A,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}})}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class ue extends it{constructor(t,u,p,m){super(t,u,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(t){return a._(this,void 0,void 0,function*(){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(u,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const m=yield V.getImage(p,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&t.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const A=a.b(b)&&a.U()?b:yield this.readImageNow(b),P={type:this.type,uid:t.uid,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const O=yield t.actor.sendAsync({type:"LDT",data:P});t.dem=O,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(m){if(delete t.abortController,t.aborted)t.state="unloaded";else if(m)throw t.state="errored",m}})}readImageNow(t){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const u=t.width+2,p=t.height+2;try{return new a.R({width:u,height:p},yield a.W(t,-1,-1,u,p))}catch{}}return y.getImageData(t,1)})}_getNeighboringTiles(t){const u=t.canonical,p=Math.pow(2,u.z),m=(u.x-1+p)%p,b=u.x===0?t.wrap-1:t.wrap,A=(u.x+1+p)%p,P=u.x+1===p?t.wrap+1:t.wrap,O={};return O[new a.S(t.overscaledZ,b,u.z,m,u.y).key]={backfilled:!1},O[new a.S(t.overscaledZ,P,u.z,A,u.y).key]={backfilled:!1},u.y>0&&(O[new a.S(t.overscaledZ,b,u.z,m,u.y-1).key]={backfilled:!1},O[new a.S(t.overscaledZ,t.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},O[new a.S(t.overscaledZ,P,u.z,A,u.y-1).key]={backfilled:!1}),u.y+1<p&&(O[new a.S(t.overscaledZ,b,u.z,m,u.y+1).key]={backfilled:!1},O[new a.S(t.overscaledZ,t.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},O[new a.S(t.overscaledZ,P,u.z,A,u.y+1).key]={backfilled:!1}),O}unloadTile(t){return a._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class H extends a.E{constructor(t,u,p,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=u.data,this._options=a.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const b=a.X/this.tileSize;u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*b,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*b,extent:a.X,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:a.X,radius:(u.clusterRadius||50)*b,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return a._(this,void 0,void 0,function*(){const t=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,u,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:u,offset:p}})}_updateWorkerData(t){return a._(this,void 0,void 0,function*(){const u=a.e({type:this.type},this.workerOptions);t?u.dataDiff=t:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(y.resolveURL(this._data),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:u});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(b,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(t){return a._(this,void 0,void 0,function*(){const u=t.actor?"RT":"LT";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const m=yield this.actor.sendAsync({type:u,data:p},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(m,this.map.painter,u==="RT")})}abortTile(t){return a._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return a._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Y=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ae extends a.E{constructor(t,u,p,m){super(),this.id=t,this.dispatcher=p,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=u}load(t){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield V.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,t&&(this.coordinates=t),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new a.j(u))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const u=t.map(a.Z.fromLngLat);this.tileID=function(m){let b=1/0,A=1/0,P=-1/0,O=-1/0;for(const ae of m)b=Math.min(b,ae.x),A=Math.min(A,ae.y),P=Math.max(P,ae.x),O=Math.max(O,ae.y);const Z=Math.max(P-b,O-A),K=Math.max(0,Math.floor(-Math.log(Z)/Math.LN2)),J=Math.pow(2,K);return new a.a1(K,Math.floor((b+P)/2*J),Math.floor((A+O)/2*J))}(u),this.minzoom=this.maxzoom=this.tileID.z;const p=u.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.X,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.X),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,u=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new B(t,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ze extends Ae{constructor(t,u,p,m){super(t,u,p,m),this.roundZoom=!0,this.type="video",this.options=u}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const u of t.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield a.a3(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new a.j(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const u=this.video.seekable;t<u.start(0)||t>u.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,u=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new B(t,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class dt extends Ae{constructor(t,u,p,m){super(t,u,p,m),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(A=>typeof A!="number"))||this.fire(new a.j(new a.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${t}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,p=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new B(u,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const st={},Ci=v=>{switch(v){case"geojson":return H;case"image":return Ae;case"raster":return it;case"raster-dem":return ue;case"vector":return _t;case"video":return Ze;case"canvas":return dt}return st[v]},ft="RTLPluginLoaded";class Wt extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ti()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return a._(this,arguments,void 0,function*(u,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ft))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ei=null;function Fi(){return Ei||(Ei=new Wt),Ei}class Cn{constructor(t,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=a.a4(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const u=t+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,b){const A={};if(!b)return A;for(const P of m){const O=P.layerIds.map(Z=>b.getLayer(Z)).filter(Boolean);if(O.length!==0){P.layers=O,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(Z=>O.filter(K=>K.id===Z)[0]));for(const Z of O)A[Z.id]=P}}return A}(t.buckets,u.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a6){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a6&&b.hasRTLText){this.hasRTLText=!0,Fi().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(t)}const u=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new B(t,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new B(t,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,u,p,m,b,A,P,O,Z,K){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:A,tileSize:this.tileSize,pixelPosMatrix:K,transform:O,params:P,queryPadding:this.queryPadding*Z},t,u,p):{}}querySourceFeatures(t,u){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=u&&u.sourceLayer?u.sourceLayer:"",A=m._geojsonTileLayer||m[b];if(!A)return;const P=a.a7(u&&u.filter),{z:O,x:Z,y:K}=this.tileID.canonical,J={z:O,x:Z,y:K};for(let ae=0;ae<A.length;ae++){const _e=A.feature(ae);if(P.needGeometry){const Oe=a.a8(_e,!0);if(!P.filter(new a.z(this.tileID.overscaledZ),Oe,this.tileID.canonical))continue}else if(!P.filter(new a.z(this.tileID.overscaledZ),_e))continue;const xe=p.getId(_e,b),Ee=new a.a9(_e,O,Z,K,xe);Ee.tile=J,t.push(Ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const u=this.expirationTime;if(t.cacheControl){const p=a.aa(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{const b=this.expirationTime-u;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!u.style.hasLayer(m))continue;const b=this.buckets[m],A=b.layers[0].sourceLayer||"_geojsonTileLayer",P=p[A],O=t[A];if(!P||!O||Object.keys(O).length===0)continue;b.update(O,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Z=u&&u.style&&u.style.getLayer(m);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=y.now()+t}setDependencies(t,u){const p={};for(const m of u)p[m]=!0;this.dependencies[t]=p}hasDependency(t,u){for(const p of t){const m=this.dependencies[p];if(m){for(const b of u)if(m[b])return!0}}return!1}}class kt{constructor(t,u){this.max=t,this.onRemove=u,this.reset()}reset(){for(const t in this.data)for(const u of this.data[t])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(t,u,p){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:u,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const u=this.data[t].shift();return u.timeout&&clearTimeout(u.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),u.value}getByKey(t){const u=this.data[t];return u?u[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,u){if(!this.has(t))return this;const p=t.wrapped().key,m=u===void 0?0:this.data[p].indexOf(u),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(t){const u=[];for(const p in this.data)for(const m of this.data[p])t(m.value)||u.push(m);for(const p of u)this.remove(p.value.tileID,p)}}class ui{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,u,p){const m=String(u);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},a.e(this.stateChanges[t][m],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==m&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const b in this.state[t][m])p[b]||(this.deletedStates[t][m][b]=null)}else for(const b in p)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][b]===null&&delete this.deletedStates[t][m][b]}removeFeatureState(t,u,p){if(this.deletedStates[t]===null)return;const m=String(u);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&u!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][p]=null);else if(u!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(p in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][p]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,u){const p=String(u),m=a.e({},(this.state[t]||{})[p],(this.stateChanges[t]||{})[p]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][u];if(b===null)return{};for(const A in b)delete m[A]}return m}initializeTileState(t,u){t.setFeatureState(this.state,u)}coalesceChanges(t,u){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const A in this.stateChanges[m])this.state[m][A]||(this.state[m][A]={}),a.e(this.state[m][A],this.stateChanges[m][A]),b[A]=this.state[m][A];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const A in this.state[m])b[A]={},this.state[m][A]={};else for(const A in this.deletedStates[m]){if(this.deletedStates[m][A]===null)this.state[m][A]={};else for(const P of Object.keys(this.deletedStates[m][A]))delete this.state[m][A][P];b[A]=this.state[m][A]}p[m]=p[m]||{},a.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in t)t[m].setFeatureState(p,u)}}class ii extends a.E{constructor(t,u,p){super(),this.id=t,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,A,P)=>{const O=new(Ci(b.type))(m,b,A,P);if(O.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${O.id}`);return O})(t,u,p,this),this._tiles={},this._cache=new kt(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ui,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const u=this._tiles[t];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,u,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,u,p)}catch(m){t.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new a.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const p=this._tiles[u];p.upload(t),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(nn).map(t=>t.key)}getRenderableIds(t){const u=[];for(const p in this._tiles)this._isIdRenderable(p,t)&&u.push(this._tiles[p]);return t?u.sort((p,m)=>{const b=p.tileID,A=m.tileID,P=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),O=new a.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-A.overscaledZ||O.y-P.y||O.x-P.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(nn).map(p=>p.key)}hasRenderableParent(t){const u=this.findLoadedParent(t,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(t,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(u||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,u){return a._(this,void 0,void 0,function*(){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=u),yield this._loadTile(p,t,u))})}_tileLoaded(t,u,p){t.timeAdded=y.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(u,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const u=this.getRenderableIds();for(let m=0;m<u.length;m++){const b=u[m];if(t.neighboringTiles&&t.neighboringTiles[b]){const A=this.getTileByID(b);p(t,A),p(A,t)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let A=b.tileID.canonical.x-m.tileID.canonical.x;const P=b.tileID.canonical.y-m.tileID.canonical.y,O=Math.pow(2,m.tileID.canonical.z),Z=b.tileID.key;A===0&&P===0||Math.abs(P)>1||(Math.abs(A)>1&&(Math.abs(A+O)===1?A+=O:Math.abs(A-O)===1&&(A-=O)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,A,P),m.neighboringTiles&&m.neighboringTiles[Z]&&(m.neighboringTiles[Z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,u,p,m){for(const b in this._tiles){let A=this._tiles[b];if(m[b]||!A.hasData()||A.tileID.overscaledZ<=u||A.tileID.overscaledZ>p)continue;let P=A.tileID;for(;A&&A.tileID.overscaledZ>u+1;){const Z=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[Z.key],A&&A.hasData()&&(P=Z)}let O=P;for(;O.overscaledZ>u;)if(O=O.scaledTo(O.overscaledZ-1),t[O.key]){m[P.key]=P;break}}}findLoadedParent(t,u){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=u?p:null}for(let p=t.overscaledZ-1;p>=u;p--){const m=t.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const u=this._tiles[t.key];return u&&u.hasData()?u:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const u=Math.ceil(t.width/this._source.tileSize)+1,p=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(u*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(t){const u=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,u){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(t,u,p,m,b,A){const P={},O={},Z=Object.keys(t),K=y.now();for(const J of Z){const ae=t[J],_e=this._tiles[J];if(!_e||_e.fadeEndTime!==0&&_e.fadeEndTime<=K)continue;const xe=this.findLoadedParent(ae,u),Ee=this.findLoadedSibling(ae),Oe=xe||Ee||null;Oe&&(this._addTile(Oe.tileID),P[Oe.tileID.key]=Oe.tileID),O[J]=ae}this._retainLoadedChildren(O,m,p,t);for(const J in P)t[J]||(this._coveredTiles[J]=!0,t[J]=P[J]);if(A){const J={},ae={};for(const _e of b)this._tiles[_e.key].hasData()?J[_e.key]=_e:ae[_e.key]=_e;for(const _e in ae){const xe=ae[_e].children(this._source.maxzoom);this._tiles[xe[0].key]&&this._tiles[xe[1].key]&&this._tiles[xe[2].key]&&this._tiles[xe[3].key]&&(J[xe[0].key]=t[xe[0].key]=xe[0],J[xe[1].key]=t[xe[1].key]=xe[1],J[xe[2].key]=t[xe[2].key]=xe[2],J[xe[3].key]=t[xe[3].key]=xe[3],delete ae[_e])}for(const _e in ae){const xe=ae[_e],Ee=this.findLoadedParent(xe,this._source.minzoom),Oe=this.findLoadedSibling(xe),De=Ee||Oe||null;if(De){J[De.tileID.key]=t[De.tileID.key]=De.tileID;for(const je in J)J[je].isChildOf(De.tileID)&&delete J[je]}}for(const _e in this._tiles)J[_e]||(this._coveredTiles[_e]=!0)}}update(t,u){if(!this._sourceLoaded||this._paused)return;let p;this.transform=t,this.terrain=u,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new a.S(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y)):(p=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(p=p.filter(K=>this._source.hasTile(K)))):p=[];const m=t.coveringZoomLevel(this._source),b=Math.max(m-ii.maxOverzooming,this._source.minzoom),A=Math.max(m+ii.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const K={};for(const J of p)if(J.canonical.z>this._source.minzoom){const ae=J.scaledTo(J.canonical.z-1);K[ae.key]=ae;const _e=J.scaledTo(Math.max(this._source.minzoom,Math.min(J.canonical.z,5)));K[_e.key]=_e}p=p.concat(Object.values(K))}const P=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const O=this._updateRetainedTiles(p,m);gr(this._source.type)&&this._updateCoveredAndRetainedTiles(O,b,A,m,p,u);for(const K in O)this._tiles[K].clearFadeHold();const Z=a.ab(this._tiles,O);for(const K of Z){const J=this._tiles[K];J.hasSymbolBuckets&&!J.holdingForFade()?J.setHoldDuration(this.map._fadeDuration):J.hasSymbolBuckets&&!J.symbolFadeFinished()||this._removeTile(K)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,u){var p;const m={},b={},A=Math.max(u-ii.maxOverzooming,this._source.minzoom),P=Math.max(u+ii.maxUnderzooming,this._source.minzoom),O={};for(const Z of t){const K=this._addTile(Z);m[Z.key]=Z,K.hasData()||u<this._source.maxzoom&&(O[Z.key]=Z)}this._retainLoadedChildren(O,u,P,m);for(const Z of t){let K=this._tiles[Z.key];if(K.hasData())continue;if(u+1>this._source.maxzoom){const ae=Z.children(this._source.maxzoom)[0],_e=this.getTile(ae);if(_e&&_e.hasData()){m[ae.key]=ae;continue}}else{const ae=Z.children(this._source.maxzoom);if(m[ae[0].key]&&m[ae[1].key]&&m[ae[2].key]&&m[ae[3].key])continue}let J=K.wasRequested();for(let ae=Z.overscaledZ-1;ae>=A;--ae){const _e=Z.scaledTo(ae);if(b[_e.key])break;if(b[_e.key]=!0,K=this.getTile(_e),!K&&J&&(K=this._addTile(_e)),K){const xe=K.hasData();if((xe||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||J)&&(m[_e.key]=_e),J=K.wasRequested(),xe)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const u=[];let p,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}u.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of u)this._loadedParentTiles[b]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const u=this._tiles[t].tileID,p=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=p}}_addTile(t){let u=this._tiles[t.key];if(u)return u;u=this._cache.getAndRemove(t),u&&(this._setTileReloadTimer(t.key,u),u.tileID=t,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,u)));const p=u;return u||(u=new Cn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(u,t.key,u.state)),u.uses++,this._tiles[t.key]=u,p||this._source.fire(new a.k("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(t,u){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=u.getExpiryTimeout();p&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},p))}_removeTile(t){const u=this._tiles[t];u&&(u.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(t){const u=t.sourceDataType;t.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&u==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,u,p){const m=[],b=this.transform;if(!b)return m;const A=p?b.getCameraQueryGeometry(t):t,P=t.map(xe=>b.pointCoordinate(xe,this.terrain)),O=A.map(xe=>b.pointCoordinate(xe,this.terrain)),Z=this.getIds();let K=1/0,J=1/0,ae=-1/0,_e=-1/0;for(const xe of O)K=Math.min(K,xe.x),J=Math.min(J,xe.y),ae=Math.max(ae,xe.x),_e=Math.max(_e,xe.y);for(let xe=0;xe<Z.length;xe++){const Ee=this._tiles[Z[xe]];if(Ee.holdingForFade())continue;const Oe=Ee.tileID,De=Math.pow(2,b.zoom-Ee.tileID.overscaledZ),je=u*Ee.queryPadding*a.X/Ee.tileSize/De,Te=[Oe.getTilePoint(new a.Z(K,J)),Oe.getTilePoint(new a.Z(ae,_e))];if(Te[0].x-je<a.X&&Te[0].y-je<a.X&&Te[1].x+je>=0&&Te[1].y+je>=0){const He=P.map(nt=>Oe.getTilePoint(nt)),Je=O.map(nt=>Oe.getTilePoint(nt));m.push({tile:Ee,tileID:Oe,queryGeometry:He,cameraQueryGeometry:Je,scale:De})}}return m}getVisibleCoordinates(t){const u=this.getRenderableIds(t).map(p=>this._tiles[p].tileID);for(const p of u)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(gr(this._source.type)){const t=y.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=t)return!0}return!1}setFeatureState(t,u,p){this._state.updateState(t=t||"_geojsonTileLayer",u,p)}removeFeatureState(t,u,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",u,p)}getFeatureState(t,u){return this._state.getState(t=t||"_geojsonTileLayer",u)}setDependencies(t,u,p){const m=this._tiles[t];m&&m.setDependencies(u,p)}reloadTilesForDependencies(t,u){for(const p in this._tiles)this._tiles[p].hasDependency(t,u)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(t,u))}}function nn(v,t){const u=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return v.overscaledZ-t.overscaledZ||p-u||t.canonical.y-v.canonical.y||t.canonical.x-v.canonical.x}function gr(v){return v==="raster"||v==="image"||v==="video"}ii.maxOverzooming=10,ii.maxUnderzooming=3;class ai{constructor(t,u){this.reset(t,u)}reset(t,u){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ac(t,0,1);let u=1,p=this._distances[u];const m=t*this.paddedLength+this.padding;for(;p<m&&u<this._distances.length;)p=this._distances[++u];const b=u-1,A=this._distances[b],P=p-A,O=P>0?(m-A)/P:0;return this.points[b].mult(1-O).add(this.points[u].mult(O))}}function _r(v,t){let u=!0;return v==="always"||v!=="never"&&t!=="never"||(u=!1),u}class yr{constructor(t,u,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(u/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=u,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,u,p,m,b){this._forEachCell(u,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(t,u,p,m){this._forEachCell(u-m,p-m,u+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(u),this.circles.push(p),this.circles.push(m)}_insertBoxCell(t,u,p,m,b,A){this.boxCells[b].push(A)}_insertCircleCell(t,u,p,m,b,A){this.circleCells[b].push(A)}_query(t,u,p,m,b,A,P){if(p<0||t>this.width||m<0||u>this.height)return[];const O=[];if(t<=0&&u<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:t,y1:u,x2:p,y2:m}];for(let Z=0;Z<this.boxKeys.length;Z++)O.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const K=this.circles[3*Z],J=this.circles[3*Z+1],ae=this.circles[3*Z+2];O.push({key:this.circleKeys[Z],x1:K-ae,y1:J-ae,x2:K+ae,y2:J+ae})}}else this._forEachCell(t,u,p,m,this._queryCell,O,{hitTest:b,overlapMode:A,seenUids:{box:{},circle:{}}},P);return O}query(t,u,p,m){return this._query(t,u,p,m,!1,null)}hitTest(t,u,p,m,b,A){return this._query(t,u,p,m,!0,b,A).length>0}hitTestCircle(t,u,p,m,b){const A=t-p,P=t+p,O=u-p,Z=u+p;if(P<0||A>this.width||Z<0||O>this.height)return!1;const K=[];return this._forEachCell(A,O,P,Z,this._queryCellCircle,K,{hitTest:!0,overlapMode:m,circle:{x:t,y:u,radius:p},seenUids:{box:{},circle:{}}},b),K.length>0}_queryCell(t,u,p,m,b,A,P,O){const{seenUids:Z,hitTest:K,overlapMode:J}=P,ae=this.boxCells[b];if(ae!==null){const xe=this.bboxes;for(const Ee of ae)if(!Z.box[Ee]){Z.box[Ee]=!0;const Oe=4*Ee,De=this.boxKeys[Ee];if(t<=xe[Oe+2]&&u<=xe[Oe+3]&&p>=xe[Oe+0]&&m>=xe[Oe+1]&&(!O||O(De))&&(!K||!_r(J,De.overlapMode))&&(A.push({key:De,x1:xe[Oe],y1:xe[Oe+1],x2:xe[Oe+2],y2:xe[Oe+3]}),K))return!0}}const _e=this.circleCells[b];if(_e!==null){const xe=this.circles;for(const Ee of _e)if(!Z.circle[Ee]){Z.circle[Ee]=!0;const Oe=3*Ee,De=this.circleKeys[Ee];if(this._circleAndRectCollide(xe[Oe],xe[Oe+1],xe[Oe+2],t,u,p,m)&&(!O||O(De))&&(!K||!_r(J,De.overlapMode))){const je=xe[Oe],Te=xe[Oe+1],He=xe[Oe+2];if(A.push({key:De,x1:je-He,y1:Te-He,x2:je+He,y2:Te+He}),K)return!0}}}return!1}_queryCellCircle(t,u,p,m,b,A,P,O){const{circle:Z,seenUids:K,overlapMode:J}=P,ae=this.boxCells[b];if(ae!==null){const xe=this.bboxes;for(const Ee of ae)if(!K.box[Ee]){K.box[Ee]=!0;const Oe=4*Ee,De=this.boxKeys[Ee];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,xe[Oe+0],xe[Oe+1],xe[Oe+2],xe[Oe+3])&&(!O||O(De))&&!_r(J,De.overlapMode))return A.push(!0),!0}}const _e=this.circleCells[b];if(_e!==null){const xe=this.circles;for(const Ee of _e)if(!K.circle[Ee]){K.circle[Ee]=!0;const Oe=3*Ee,De=this.circleKeys[Ee];if(this._circlesCollide(xe[Oe],xe[Oe+1],xe[Oe+2],Z.x,Z.y,Z.radius)&&(!O||O(De))&&!_r(J,De.overlapMode))return A.push(!0),!0}}}_forEachCell(t,u,p,m,b,A,P,O){const Z=this._convertToXCellCoord(t),K=this._convertToYCellCoord(u),J=this._convertToXCellCoord(p),ae=this._convertToYCellCoord(m);for(let _e=Z;_e<=J;_e++)for(let xe=K;xe<=ae;xe++)if(b.call(this,t,u,p,m,this.xCellCount*xe+_e,A,P,O))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,u,p,m,b,A){const P=m-t,O=b-u,Z=p+A;return Z*Z>P*P+O*O}_circleAndRectCollide(t,u,p,m,b,A,P){const O=(A-m)/2,Z=Math.abs(t-(m+O));if(Z>O+p)return!1;const K=(P-b)/2,J=Math.abs(u-(b+K));if(J>K+p)return!1;if(Z<=O||J<=K)return!0;const ae=Z-O,_e=J-K;return ae*ae+_e*_e<=p*p}}function Ir(v,t,u,p,m){const b=a.H();return t?(a.K(b,b,[1/m,1/m,1]),u||a.ad(b,b,p.angle)):a.L(b,p.labelPlaneMatrix,v),b}function Ar(v,t,u,p,m){if(t){const b=a.ae(v);return a.K(b,b,[m,m,1]),u||a.ad(b,b,-p.angle),b}return p.glCoordMatrix}function Pe(v,t,u,p){let m;p?(m=[v,t,p(v,t),1],a.af(m,m,u)):(m=[v,t,0,1],Bi(m,m,u));const b=m[3];return{point:new a.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function te(v,t){return .5+v/t*.5}function ie(v,t){return v.x>=-t[0]&&v.x<=t[0]&&v.y>=-t[1]&&v.y<=t[1]}function me(v,t,u,p,m,b,A,P,O,Z,K,J,ae,_e,xe){const Ee=p?v.textSizeData:v.iconSizeData,Oe=a.ag(Ee,u.transform.zoom),De=[256/u.width*2+1,256/u.height*2+1],je=p?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;je.clear();const Te=v.lineVertexArray,He=p?v.text.placedSymbolArray:v.icon.placedSymbolArray,Je=u.transform.width/u.transform.height;let nt=!1;for(let bt=0;bt<He.length;bt++){const Ct=He.get(bt);if(Ct.hidden||Ct.writingMode===a.ah.vertical&&!nt){ri(Ct.numGlyphs,je);continue}nt=!1;const Dt=Pe(Ct.anchorX,Ct.anchorY,t,xe);if(!ie(Dt.point,De)){ri(Ct.numGlyphs,je);continue}const Nt=te(u.transform.cameraToCenterDistance,Dt.signedDistanceFromCamera),Lt=a.ai(Ee,Oe,Ct),Mt=A?Lt/Nt:Lt*Nt,Jt={getElevation:xe,labelPlaneMatrix:m,lineVertexArray:Te,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:Z,tileAnchorPoint:new a.P(Ct.anchorX,Ct.anchorY),unwrappedTileID:K,width:J,height:ae,translation:_e},xi=Ge(Jt,Ct,Mt,!1,P,t,b,v.glyphOffsetArray,je,Je,O);nt=xi.useVertical,(xi.notEnoughRoom||nt||xi.needsFlipping&&Ge(Jt,Ct,Mt,!0,P,t,b,v.glyphOffsetArray,je,Je,O).notEnoughRoom)&&ri(Ct.numGlyphs,je)}p?v.text.dynamicLayoutVertexBuffer.updateData(je):v.icon.dynamicLayoutVertexBuffer.updateData(je)}function Se(v,t,u,p,m,b,A,P){const O=b.glyphStartIndex+b.numGlyphs,Z=b.lineStartIndex,K=b.lineStartIndex+b.lineLength,J=t.getoffsetX(b.glyphStartIndex),ae=t.getoffsetX(O-1),_e=Et(v*J,u,p,m,b.segment,Z,K,P,A);if(!_e)return null;const xe=Et(v*ae,u,p,m,b.segment,Z,K,P,A);return xe?P.projectionCache.anyProjectionOccluded?null:{first:_e,last:xe}:null}function Ue(v,t,u,p){return v===a.ah.horizontal&&Math.abs(u.y-t.y)>Math.abs(u.x-t.x)*p?{useVertical:!0}:(v===a.ah.vertical?t.y<u.y:t.x>u.x)?{needsFlipping:!0}:null}function Ge(v,t,u,p,m,b,A,P,O,Z,K){const J=u/24,ae=t.lineOffsetX*J,_e=t.lineOffsetY*J;let xe;if(t.numGlyphs>1){const Ee=t.glyphStartIndex+t.numGlyphs,Oe=t.lineStartIndex,De=t.lineStartIndex+t.lineLength,je=Se(J,P,ae,_e,p,t,K,v);if(!je)return{notEnoughRoom:!0};const Te=Pe(je.first.point.x,je.first.point.y,A,v.getElevation).point,He=Pe(je.last.point.x,je.last.point.y,A,v.getElevation).point;if(m&&!p){const Je=Ue(t.writingMode,Te,He,Z);if(Je)return Je}xe=[je.first];for(let Je=t.glyphStartIndex+1;Je<Ee-1;Je++)xe.push(Et(J*P.getoffsetX(Je),ae,_e,p,t.segment,Oe,De,v,K));xe.push(je.last)}else{if(m&&!p){const Oe=Pe(v.tileAnchorPoint.x,v.tileAnchorPoint.y,b,v.getElevation).point,De=t.lineStartIndex+t.segment+1,je=new a.P(v.lineVertexArray.getx(De),v.lineVertexArray.gety(De)),Te=Pe(je.x,je.y,b,v.getElevation),He=Te.signedDistanceFromCamera>0?Te.point:function(nt,bt,Ct,Dt,Nt,Lt){return et(nt,bt,Ct,1,Nt,Lt)}(v.tileAnchorPoint,je,Oe,0,b,v),Je=Ue(t.writingMode,Oe,He,Z);if(Je)return Je}const Ee=Et(J*P.getoffsetX(t.glyphStartIndex),ae,_e,p,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,v,K);if(!Ee||v.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};xe=[Ee]}for(const Ee of xe)a.aj(O,Ee.point,Ee.angle);return{}}function et(v,t,u,p,m,b){const A=v.add(v.sub(t)._unit()),P=m!==void 0?Pe(A.x,A.y,m,b.getElevation).point:at(A.x,A.y,b).point,O=u.sub(P);return u.add(O._mult(p/O.mag()))}function Re(v,t,u){const p=t.projectionCache;if(p.projections[v])return p.projections[v];const m=new a.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),b=at(m.x,m.y,t);if(b.signedDistanceFromCamera>0)return p.projections[v]=b.point,p.anyProjectionOccluded=p.anyProjectionOccluded||b.isOccluded,b.point;const A=v-u.direction;return function(P,O,Z,K,J){return et(P,O,Z,K,void 0,J)}(u.distanceFromAnchor===0?t.tileAnchorPoint:new a.P(t.lineVertexArray.getx(A),t.lineVertexArray.gety(A)),m,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,t)}function at(v,t,u){const p=v+u.translation[0],m=t+u.translation[1];let b;return!u.pitchWithMap&&u.projection.useSpecialProjectionForSymbols?(b=u.projection.projectTileCoordinates(p,m,u.unwrappedTileID,u.getElevation),b.point.x=(.5*b.point.x+.5)*u.width,b.point.y=(.5*-b.point.y+.5)*u.height):(b=Pe(p,m,u.labelPlaneMatrix,u.getElevation),b.isOccluded=!1),b}function yt(v,t,u){return v._unit()._perp()._mult(t*u)}function rt(v,t,u,p,m,b,A,P,O){if(P.projectionCache.offsets[v])return P.projectionCache.offsets[v];const Z=u.add(t);if(v+O.direction<p||v+O.direction>=m)return P.projectionCache.offsets[v]=Z,Z;const K=Re(v+O.direction,P,O),J=yt(K.sub(u),A,O.direction),ae=u.add(J),_e=K.add(J);return P.projectionCache.offsets[v]=a.ak(b,Z,ae,_e)||Z,P.projectionCache.offsets[v]}function Et(v,t,u,p,m,b,A,P,O){const Z=p?v-t:v+t;let K=Z>0?1:-1,J=0;p&&(K*=-1,J=Math.PI),K<0&&(J+=Math.PI);let ae,_e=K>0?b+m:b+m+1;P.projectionCache.cachedAnchorPoint?ae=P.projectionCache.cachedAnchorPoint:(ae=at(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=ae);let xe,Ee,Oe=ae,De=ae,je=0,Te=0;const He=Math.abs(Z),Je=[];let nt;for(;je+Te<=He;){if(_e+=K,_e<b||_e>=A)return null;je+=Te,De=Oe,Ee=xe;const Dt={absOffsetX:He,direction:K,distanceFromAnchor:je,previousVertex:De};if(Oe=Re(_e,P,Dt),u===0)Je.push(De),nt=Oe.sub(De);else{let Nt;const Lt=Oe.sub(De);Nt=Lt.mag()===0?yt(Re(_e+K,P,Dt).sub(Oe),u,K):yt(Lt,u,K),Ee||(Ee=De.add(Nt)),xe=rt(_e,Nt,Oe,b,A,Ee,u,P,Dt),Je.push(Ee),nt=xe.sub(Ee)}Te=nt.mag()}const bt=nt._mult((He-je)/Te)._add(Ee||De),Ct=J+Math.atan2(Oe.y-De.y,Oe.x-De.x);return Je.push(bt),{point:bt,angle:O?Ct:0,path:Je}}const Yt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ri(v,t){for(let u=0;u<v;u++){const p=t.length;t.resize(p+4),t.float32.set(Yt,3*p)}}function Bi(v,t,u){const p=t[0],m=t[1];return v[0]=u[0]*p+u[4]*m+u[12],v[1]=u[1]*p+u[5]*m+u[13],v[3]=u[3]*p+u[7]*m+u[15],v}const wi=100;class zi{constructor(t,u,p=new yr(t.width+200,t.height+200,25),m=new yr(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=u,this.grid=p,this.ignoredGrid=m,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+wi,this.screenBottomBoundary=t.height+wi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,u,p,m,b,A,P,O,Z,K,J){const ae=t.anchorPointX+O[0],_e=t.anchorPointY+O[1],xe=this.projectAndGetPerspectiveRatio(m,ae,_e,b,K),Ee=p*xe.perspectiveRatio;let Oe;if(A||P)Oe=this._projectCollisionBox(t,Ee,m,b,A,P,O,xe,K,J);else{const Je=xe.point.x+(J?J.x*Ee:0),nt=xe.point.y+(J?J.y*Ee:0);Oe={allPointsOccluded:!1,box:[Je+t.x1*Ee,nt+t.y1*Ee,Je+t.x2*Ee,nt+t.y2*Ee]}}const[De,je,Te,He]=Oe.box;return this.mapProjection.useSpecialProjectionForSymbols&&(A?Oe.allPointsOccluded:this.mapProjection.isOccluded(ae,_e,b))||xe.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(De,je,Te,He)||u!=="always"&&this.grid.hitTest(De,je,Te,He,u,Z)?{box:[De,je,Te,He],placeable:!1,offscreen:!1}:{box:[De,je,Te,He],placeable:!0,offscreen:this.isOffscreen(De,je,Te,He)}}placeCollisionCircles(t,u,p,m,b,A,P,O,Z,K,J,ae,_e,xe,Ee,Oe){const De=[],je=new a.P(u.anchorX,u.anchorY),Te=this.getPerspectiveRatio(A,je.x,je.y,P,Oe),He=(J?b/Te:b*Te)/a.ap,Je={getElevation:Oe,labelPlaneMatrix:O,lineVertexArray:p,pitchWithMap:J,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:je,unwrappedTileID:P,width:this.transform.width,height:this.transform.height,translation:Ee},nt=Se(He,m,u.lineOffsetX*He,u.lineOffsetY*He,!1,u,!1,Je);let bt=!1,Ct=!1,Dt=!0;if(nt){const Nt=.5*_e*Te+xe,Lt=new a.P(-100,-100),Mt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Jt=new ai,xi=nt.first,zt=nt.last;let Rt=[];for(let Ai=xi.path.length-1;Ai>=1;Ai--)Rt.push(xi.path[Ai]);for(let Ai=1;Ai<zt.path.length;Ai++)Rt.push(zt.path[Ai]);const yi=2.5*Nt;if(Z){const Ai=this.projectPathToScreenSpace(Rt,Je,Z);Rt=Ai.some(ji=>ji.signedDistanceFromCamera<=0)?[]:Ai.map(ji=>ji.point)}let gn=[];if(Rt.length>0){const Ai=Rt[0].clone(),ji=Rt[0].clone();for(let _n=1;_n<Rt.length;_n++)Ai.x=Math.min(Ai.x,Rt[_n].x),Ai.y=Math.min(Ai.y,Rt[_n].y),ji.x=Math.max(ji.x,Rt[_n].x),ji.y=Math.max(ji.y,Rt[_n].y);gn=Ai.x>=Lt.x&&ji.x<=Mt.x&&Ai.y>=Lt.y&&ji.y<=Mt.y?[Rt]:ji.x<Lt.x||Ai.x>Mt.x||ji.y<Lt.y||Ai.y>Mt.y?[]:a.al([Rt],Lt.x,Lt.y,Mt.x,Mt.y)}for(const Ai of gn){Jt.reset(Ai,.25*Nt);let ji=0;ji=Jt.length<=.5*Nt?1:Math.ceil(Jt.paddedLength/yi)+1;for(let _n=0;_n<ji;_n++){const sr=_n/Math.max(ji-1,1),_s=Jt.lerp(sr),yn=_s.x+wi,zr=_s.y+wi;De.push(yn,zr,Nt,0);const xr=yn-Nt,or=zr-Nt,kr=yn+Nt,Bs=zr+Nt;if(Dt=Dt&&this.isOffscreen(xr,or,kr,Bs),Ct=Ct||this.isInsideGrid(xr,or,kr,Bs),t!=="always"&&this.grid.hitTestCircle(yn,zr,Nt,t,ae)&&(bt=!0,!K))return{circles:[],offscreen:!1,collisionDetected:bt}}}}return{circles:!K&&bt||!Ct||Te<this.perspectiveRatioCutoff?[]:De,offscreen:Dt,collisionDetected:bt}}projectPathToScreenSpace(t,u,p){return t.map(m=>Pe(m.x,m.y,p,u.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let p=1/0,m=1/0,b=-1/0,A=-1/0;for(const K of t){const J=new a.P(K.x+wi,K.y+wi);p=Math.min(p,J.x),m=Math.min(m,J.y),b=Math.max(b,J.x),A=Math.max(A,J.y),u.push(J)}const P=this.grid.query(p,m,b,A).concat(this.ignoredGrid.query(p,m,b,A)),O={},Z={};for(const K of P){const J=K.key;if(O[J.bucketInstanceId]===void 0&&(O[J.bucketInstanceId]={}),O[J.bucketInstanceId][J.featureIndex])continue;const ae=[new a.P(K.x1,K.y1),new a.P(K.x2,K.y1),new a.P(K.x2,K.y2),new a.P(K.x1,K.y2)];a.am(u,ae)&&(O[J.bucketInstanceId][J.featureIndex]=!0,Z[J.bucketInstanceId]===void 0&&(Z[J.bucketInstanceId]=[]),Z[J.bucketInstanceId].push(J.featureIndex))}return Z}insertCollisionBox(t,u,p,m,b,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:u},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,u,p,m,b,A){const P=p?this.ignoredGrid:this.grid,O={bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:u};for(let Z=0;Z<t.length;Z+=4)P.insertCircle(O,t[Z],t[Z+1],t[Z+2])}projectAndGetPerspectiveRatio(t,u,p,m,b){let A;b?(A=[u,p,b(u,p),1],a.af(A,A,t)):(A=[u,p,0,1],Bi(A,A,t));const P=A[3];return{point:new a.P((A[0]/P+1)/2*this.transform.width+wi,(-A[1]/P+1)/2*this.transform.height+wi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}getPerspectiveRatio(t,u,p,m,b){const A=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(u,p,m,b):Pe(u,p,t,b);return .5+this.transform.cameraToCenterDistance/A.signedDistanceFromCamera*.5}isOffscreen(t,u,p,m){return p<wi||t>=this.screenRightBoundary||m<wi||u>this.screenBottomBoundary}isInsideGrid(t,u,p,m){return p>=0&&t<this.gridRightBoundary&&m>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const t=a.an([]);return a.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,u,p,m,b,A,P,O,Z,K){let J=new a.P(1,0),ae=new a.P(0,1);const _e=new a.P(t.anchorPointX+P[0],t.anchorPointY+P[1]);if(A&&!b){const Dt=this.projectAndGetPerspectiveRatio(p,_e.x+1,_e.y,m,Z).point.sub(O.point).unit(),Nt=Math.atan(Dt.y/Dt.x)+(Dt.x<0?Math.PI:0),Lt=Math.sin(Nt),Mt=Math.cos(Nt);J=new a.P(Mt,Lt),ae=new a.P(-Lt,Mt)}else if(!A&&b){const Dt=-this.transform.angle,Nt=Math.sin(Dt),Lt=Math.cos(Dt);J=new a.P(Lt,Nt),ae=new a.P(-Nt,Lt)}let xe=O.point,Ee=u;if(b){xe=_e;const Dt=this.transform.zoom-Math.floor(this.transform.zoom);Ee=Math.pow(2,-Dt),Ee*=this.mapProjection.getPitchedTextCorrection(this.transform,_e,m),K||(Ee*=a.ac(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}K&&(xe=xe.add(J.mult(K.x*Ee)).add(ae.mult(K.y*Ee)));const Oe=t.x1*Ee,De=t.x2*Ee,je=(Oe+De)/2,Te=t.y1*Ee,He=t.y2*Ee,Je=(Te+He)/2,nt=[{offsetX:Oe,offsetY:Te},{offsetX:je,offsetY:Te},{offsetX:De,offsetY:Te},{offsetX:De,offsetY:Je},{offsetX:De,offsetY:He},{offsetX:je,offsetY:He},{offsetX:Oe,offsetY:He},{offsetX:Oe,offsetY:Je}];let bt=[];for(const{offsetX:Dt,offsetY:Nt}of nt)bt.push(new a.P(xe.x+J.x*Dt+ae.x*Nt,xe.y+J.y*Dt+ae.y*Nt));let Ct=!1;if(b){const Dt=bt.map(Nt=>this.projectAndGetPerspectiveRatio(p,Nt.x,Nt.y,m,Z));Ct=Dt.some(Nt=>!Nt.isOccluded),bt=Dt.map(Nt=>Nt.point)}else Ct=!0;return{box:a.ao(bt),allPointsOccluded:!Ct}}}function Si(v,t,u){return t*(a.X/(v.tileSize*Math.pow(2,u-v.tileID.overscaledZ)))}class hn{constructor(t,u,p,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?u:-u))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class fn{constructor(t,u,p,m,b){this.text=new hn(t?t.text:null,u,p,b),this.icon=new hn(t?t.icon:null,u,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ke{constructor(t,u,p){this.text=t,this.icon=u,this.skipFade=p}}class pi{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class ki{constructor(t,u,p,m,b){this.bucketInstanceId=t,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class Ni{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const u=++this.maxGroupID;this.collisionGroups[t]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[t]}}function Ki(v,t,u,p,m){const{horizontalAlign:b,verticalAlign:A}=a.au(v);return new a.P(-(b-.5)*t+p[0]*m,-(A-.5)*u+p[1]*m)}class Ji{constructor(t,u,p,m,b,A){this.transform=t.clone(),this.terrain=p,this.collisionIndex=new zi(this.transform,u),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Ni(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const u=this.terrain;return u?(p,m)=>u.getElevation(t,p,m):null}getBucketParts(t,u,p,m){const b=p.getBucket(u),A=p.latestFeatureIndex;if(!b||!A||u.id!==b.layerIds[0])return;const P=p.collisionBoxArray,O=b.layers[0].layout,Z=b.layers[0].paint,K=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),J=p.tileSize/a.X,ae=p.tileID.toUnwrapped(),_e=this.transform.calculatePosMatrix(ae),xe=O.get("text-pitch-alignment")==="map",Ee=O.get("text-rotation-alignment")==="map",Oe=Si(p,1,this.transform.zoom),De=this.collisionIndex.mapProjection.translatePosition(this.transform,p,Z.get("text-translate"),Z.get("text-translate-anchor")),je=this.collisionIndex.mapProjection.translatePosition(this.transform,p,Z.get("icon-translate"),Z.get("icon-translate-anchor")),Te=Ir(_e,xe,Ee,this.transform,Oe);let He=null;if(xe){const nt=Ar(_e,xe,Ee,this.transform,Oe);He=a.L([],this.transform.labelPlaneMatrix,nt)}this.retainedQueryData[b.bucketInstanceId]=new ki(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,p.tileID);const Je={bucket:b,layout:O,translationText:De,translationIcon:je,posMatrix:_e,unwrappedTileID:ae,textLabelPlaneMatrix:Te,labelToScreenMatrix:He,scale:K,textPixelRatio:J,holdingForFade:p.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:a.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const nt of b.sortKeyRanges){const{sortKey:bt,symbolInstanceStart:Ct,symbolInstanceEnd:Dt}=nt;t.push({sortKey:bt,symbolInstanceStart:Ct,symbolInstanceEnd:Dt,parameters:Je})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Je})}attemptAnchorPlacement(t,u,p,m,b,A,P,O,Z,K,J,ae,_e,xe,Ee,Oe,De,je,Te){const He=a.aq[t.textAnchor],Je=[t.textOffset0,t.textOffset1],nt=Ki(He,p,m,Je,b),bt=this.collisionIndex.placeCollisionBox(u,ae,O,Z,K,P,A,Oe,J.predicate,Te,nt);if((!je||this.collisionIndex.placeCollisionBox(je,ae,O,Z,K,P,A,De,J.predicate,Te,nt).placeable)&&bt.placeable){let Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(Ct=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),_e.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[_e.crossTileID]={textOffset:Je,width:p,height:m,anchor:He,textBoxScale:b,prevAnchor:Ct},this.markUsedJustification(xe,He,_e,Ee),xe.allowVerticalPlacement&&(this.markUsedOrientation(xe,Ee,_e),this.placedOrientations[_e.crossTileID]=Ee),{shift:nt,placedGlyphBoxes:bt}}}placeLayerBucketPart(t,u,p){const{bucket:m,layout:b,translationText:A,translationIcon:P,posMatrix:O,unwrappedTileID:Z,textLabelPlaneMatrix:K,labelToScreenMatrix:J,textPixelRatio:ae,holdingForFade:_e,collisionBoxArray:xe,partiallyEvaluatedTextSize:Ee,collisionGroup:Oe}=t.parameters,De=b.get("text-optional"),je=b.get("icon-optional"),Te=a.ar(b,"text-overlap","text-allow-overlap"),He=Te==="always",Je=a.ar(b,"icon-overlap","icon-allow-overlap"),nt=Je==="always",bt=b.get("text-rotation-alignment")==="map",Ct=b.get("text-pitch-alignment")==="map",Dt=b.get("icon-text-fit")!=="none",Nt=b.get("symbol-z-order")==="viewport-y",Lt=He&&(nt||!m.hasIconData()||je),Mt=nt&&(He||!m.hasTextData()||De);!m.collisionArrays&&xe&&m.deserializeCollisionBoxes(xe);const Jt=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),xi=(zt,Rt,yi)=>{var gn,Ai;if(u[zt.crossTileID])return;if(_e)return void(this.placements[zt.crossTileID]=new Ke(!1,!1,!1));let ji=!1,_n=!1,sr=!0,_s=null,yn={box:null,placeable:!1,offscreen:null},zr={placeable:!1},xr=null,or=null,kr=null,Bs=0,Ua=0,yc=0;Rt.textFeatureIndex?Bs=Rt.textFeatureIndex:zt.useRuntimeCollisionCircles&&(Bs=zt.featureIndex),Rt.verticalTextFeatureIndex&&(Ua=Rt.verticalTextFeatureIndex);const Va=Rt.textBox;if(Va){const cs=tr=>{let ar=a.ah.horizontal;if(m.allowVerticalPlacement&&!tr&&this.prevPlacement){const Xr=this.prevPlacement.placedOrientations[zt.crossTileID];Xr&&(this.placedOrientations[zt.crossTileID]=Xr,ar=Xr,this.markUsedOrientation(m,ar,zt))}return ar},us=(tr,ar)=>{if(m.allowVerticalPlacement&&zt.numVerticalGlyphVertices>0&&Rt.verticalTextBox){for(const Xr of m.writingModes)if(Xr===a.ah.vertical?(yn=ar(),zr=yn):yn=tr(),yn&&yn.placeable)break}else yn=tr()},Eo=zt.textAnchorOffsetStartIndex,ys=zt.textAnchorOffsetEndIndex;if(ys===Eo){const tr=(ar,Xr)=>{const Vi=this.collisionIndex.placeCollisionBox(ar,Te,ae,O,Z,Ct,bt,A,Oe.predicate,Jt);return Vi&&Vi.placeable&&(this.markUsedOrientation(m,Xr,zt),this.placedOrientations[zt.crossTileID]=Xr),Vi};us(()=>tr(Va,a.ah.horizontal),()=>{const ar=Rt.verticalTextBox;return m.allowVerticalPlacement&&zt.numVerticalGlyphVertices>0&&ar?tr(ar,a.ah.vertical):{box:null,offscreen:null}}),cs(yn&&yn.placeable)}else{let tr=a.aq[(Ai=(gn=this.prevPlacement)===null||gn===void 0?void 0:gn.variableOffsets[zt.crossTileID])===null||Ai===void 0?void 0:Ai.anchor];const ar=(Vi,sa,qa)=>{const Za=Vi.x2-Vi.x1,Mh=Vi.y2-Vi.y1,Ff=zt.textBoxScale,Ph=Dt&&Je==="never"?sa:null;let Io=null,Lh=Te==="never"?1:2,vc="never";tr&&Lh++;for(let Tl=0;Tl<Lh;Tl++){for(let wc=Eo;wc<ys;wc++){const xc=m.textAnchorOffsets.get(wc);if(tr&&xc.textAnchor!==tr)continue;const Wa=this.attemptAnchorPlacement(xc,Vi,Za,Mh,Ff,bt,Ct,ae,O,Z,Oe,vc,zt,m,qa,A,P,Ph,Jt);if(Wa&&(Io=Wa.placedGlyphBoxes,Io&&Io.placeable))return ji=!0,_s=Wa.shift,Io}tr?tr=null:vc=Te}return p&&!Io&&(Io={box:this.collisionIndex.placeCollisionBox(Va,"always",ae,O,Z,Ct,bt,A,Oe.predicate,Jt,new a.P(0,0)).box,offscreen:!1,placeable:!1}),Io};us(()=>ar(Va,Rt.iconBox,a.ah.horizontal),()=>{const Vi=Rt.verticalTextBox;return m.allowVerticalPlacement&&(!yn||!yn.placeable)&&zt.numVerticalGlyphVertices>0&&Vi?ar(Vi,Rt.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),yn&&(ji=yn.placeable,sr=yn.offscreen);const Xr=cs(yn&&yn.placeable);if(!ji&&this.prevPlacement){const Vi=this.prevPlacement.variableOffsets[zt.crossTileID];Vi&&(this.variableOffsets[zt.crossTileID]=Vi,this.markUsedJustification(m,Vi.anchor,zt,Xr))}}}if(xr=yn,ji=xr&&xr.placeable,sr=xr&&xr.offscreen,zt.useRuntimeCollisionCircles){const cs=m.text.placedSymbolArray.get(zt.centerJustifiedTextSymbolIndex),us=a.ai(m.textSizeData,Ee,cs),Eo=b.get("text-padding");or=this.collisionIndex.placeCollisionCircles(Te,cs,m.lineVertexArray,m.glyphOffsetArray,us,O,Z,K,J,p,Ct,Oe.predicate,zt.collisionCircleDiameter,Eo,A,Jt),or.circles.length&&or.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),ji=He||or.circles.length>0&&!or.collisionDetected,sr=sr&&or.offscreen}if(Rt.iconFeatureIndex&&(yc=Rt.iconFeatureIndex),Rt.iconBox){const cs=us=>this.collisionIndex.placeCollisionBox(us,Je,ae,O,Z,Ct,bt,P,Oe.predicate,Jt,Dt&&_s?_s:void 0);zr&&zr.placeable&&Rt.verticalIconBox?(kr=cs(Rt.verticalIconBox),_n=kr.placeable):(kr=cs(Rt.iconBox),_n=kr.placeable),sr=sr&&kr.offscreen}const ls=De||zt.numHorizontalGlyphVertices===0&&zt.numVerticalGlyphVertices===0,bc=je||zt.numIconVertices===0;ls||bc?bc?ls||(_n=_n&&ji):ji=_n&&ji:_n=ji=_n&&ji;const Mu=_n&&kr.placeable;if(ji&&xr.placeable&&this.collisionIndex.insertCollisionBox(xr.box,Te,b.get("text-ignore-placement"),m.bucketInstanceId,zr&&zr.placeable&&Ua?Ua:Bs,Oe.ID),Mu&&this.collisionIndex.insertCollisionBox(kr.box,Je,b.get("icon-ignore-placement"),m.bucketInstanceId,yc,Oe.ID),or&&ji&&this.collisionIndex.insertCollisionCircles(or.circles,Te,b.get("text-ignore-placement"),m.bucketInstanceId,Bs,Oe.ID),p&&this.storeCollisionData(m.bucketInstanceId,yi,Rt,xr,kr,or),zt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[zt.crossTileID]=new Ke(ji||Lt,_n||Mt,sr||m.justReloaded),u[zt.crossTileID]=!0};if(Nt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const zt=m.getSortedSymbolIndexes(this.transform.angle);for(let Rt=zt.length-1;Rt>=0;--Rt){const yi=zt[Rt];xi(m.symbolInstances.get(yi),m.collisionArrays[yi],yi)}}else for(let zt=t.symbolInstanceStart;zt<t.symbolInstanceEnd;zt++)xi(m.symbolInstances.get(zt),m.collisionArrays[zt],zt);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const zt=this.collisionCircleArrays[m.bucketInstanceId];a.as(zt.invProjMatrix,O),zt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(t,u,p,m,b,A){if(p.textBox||p.iconBox){let P,O;this.collisionBoxArrays.has(t)?P=this.collisionBoxArrays.get(t):(P=new Map,this.collisionBoxArrays.set(t,P)),P.has(u)?O=P.get(u):(O={text:null,icon:null},P.set(u,O)),p.textBox&&(O.text=m.box),p.iconBox&&(O.icon=b.box)}if(A){let P=this.collisionCircleArrays[t];P===void 0&&(P=this.collisionCircleArrays[t]=new pi);for(let O=0;O<A.circles.length;O+=4)P.circles.push(A.circles[O+0]),P.circles.push(A.circles[O+1]),P.circles.push(A.circles[O+2]),P.circles.push(A.collisionDetected?1:0)}}markUsedJustification(t,u,p,m){let b;b=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.at(u)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const P of A)P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=b>=0&&P!==b?0:p.crossTileID)}markUsedOrientation(t,u,p){const m=u===a.ah.horizontal||u===a.ah.horizontalOnly?u:0,b=u===a.ah.vertical?u:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const P of A)t.text.placedSymbolArray.get(P).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const m=u?u.symbolFadeChange(t):1,b=u?u.opacities:{},A=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(const O in this.placements){const Z=this.placements[O],K=b[O];K?(this.opacities[O]=new fn(K,m,Z.text,Z.icon),p=p||Z.text!==K.text.placed||Z.icon!==K.icon.placed):(this.opacities[O]=new fn(null,m,Z.text,Z.icon,Z.skipFade),p=p||Z.text||Z.icon)}for(const O in b){const Z=b[O];if(!this.opacities[O]){const K=new fn(Z,m,!1,!1);K.isHidden()||(this.opacities[O]=K,p=p||Z.text.placed||Z.icon.placed)}}for(const O in A)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=A[O]);for(const O in P)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=P[O]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:t)}updateLayerOpacities(t,u){const p={};for(const m of u){const b=m.getBucket(t);b&&m.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(t,u,p,m){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const b=t.layers[0],A=b.layout,P=new fn(null,0,!1,!1,!0),O=A.get("text-allow-overlap"),Z=A.get("icon-allow-overlap"),K=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),J=A.get("text-rotation-alignment")==="map",ae=A.get("text-pitch-alignment")==="map",_e=A.get("icon-text-fit")!=="none",xe=new fn(null,0,O&&(Z||!t.hasIconData()||A.get("icon-optional")),Z&&(O||!t.hasTextData()||A.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const Ee=(De,je,Te)=>{for(let He=0;He<je/4;He++)De.opacityVertexArray.emplaceBack(Te);De.hasVisibleVertices=De.hasVisibleVertices||Te!==Ur},Oe=this.collisionBoxArrays.get(t.bucketInstanceId);for(let De=0;De<t.symbolInstances.length;De++){const je=t.symbolInstances.get(De),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:He,crossTileID:Je}=je;let nt=this.opacities[Je];p[Je]?nt=P:nt||(nt=xe,this.opacities[Je]=nt),p[Je]=!0;const bt=je.numIconVertices>0,Ct=this.placedOrientations[je.crossTileID],Dt=Ct===a.ah.vertical,Nt=Ct===a.ah.horizontal||Ct===a.ah.horizontalOnly;if(Te>0||He>0){const Mt=Xn(nt.text);Ee(t.text,Te,Dt?Ur:Mt),Ee(t.text,He,Nt?Ur:Mt);const Jt=nt.text.isHidden();[je.rightJustifiedTextSymbolIndex,je.centerJustifiedTextSymbolIndex,je.leftJustifiedTextSymbolIndex].forEach(Rt=>{Rt>=0&&(t.text.placedSymbolArray.get(Rt).hidden=Jt||Dt?1:0)}),je.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(je.verticalPlacedTextSymbolIndex).hidden=Jt||Nt?1:0);const xi=this.variableOffsets[je.crossTileID];xi&&this.markUsedJustification(t,xi.anchor,je,Ct);const zt=this.placedOrientations[je.crossTileID];zt&&(this.markUsedJustification(t,"left",je,zt),this.markUsedOrientation(t,zt,je))}if(bt){const Mt=Xn(nt.icon),Jt=!(_e&&je.verticalPlacedIconSymbolIndex&&Dt);je.placedIconSymbolIndex>=0&&(Ee(t.icon,je.numIconVertices,Jt?Mt:Ur),t.icon.placedSymbolArray.get(je.placedIconSymbolIndex).hidden=nt.icon.isHidden()),je.verticalPlacedIconSymbolIndex>=0&&(Ee(t.icon,je.numVerticalIconVertices,Jt?Ur:Mt),t.icon.placedSymbolArray.get(je.verticalPlacedIconSymbolIndex).hidden=nt.icon.isHidden())}const Lt=Oe&&Oe.has(De)?Oe.get(De):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Mt=t.collisionArrays[De];if(Mt){let Jt=new a.P(0,0);if(Mt.textBox||Mt.verticalTextBox){let xi=!0;if(K){const zt=this.variableOffsets[Je];zt?(Jt=Ki(zt.anchor,zt.width,zt.height,zt.textOffset,zt.textBoxScale),J&&Jt._rotate(ae?this.transform.angle:-this.transform.angle)):xi=!1}if(Mt.textBox||Mt.verticalTextBox){let zt;Mt.textBox&&(zt=Dt),Mt.verticalTextBox&&(zt=Nt),jn(t.textCollisionBox.collisionVertexArray,nt.text.placed,!xi||zt,Lt.text,Jt.x,Jt.y)}}if(Mt.iconBox||Mt.verticalIconBox){const xi=!!(!Nt&&Mt.verticalIconBox);let zt;Mt.iconBox&&(zt=xi),Mt.verticalIconBox&&(zt=!xi),jn(t.iconCollisionBox.collisionVertexArray,nt.icon.placed,zt,Lt.icon,_e?Jt.x:0,_e?Jt.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=De.invProjMatrix,t.placementViewportMatrix=De.viewportMatrix,t.collisionCircleArray=De.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function jn(v,t,u,p,m,b){p&&p.length!==0||(p=[0,0,0,0]);const A=p[0]-wi,P=p[1]-wi,O=p[2]-wi,Z=p[3]-wi;v.emplaceBack(t?1:0,u?1:0,m||0,b||0,A,P),v.emplaceBack(t?1:0,u?1:0,m||0,b||0,O,P),v.emplaceBack(t?1:0,u?1:0,m||0,b||0,O,Z),v.emplaceBack(t?1:0,u?1:0,m||0,b||0,A,Z)}const si=Math.pow(2,25),$r=Math.pow(2,24),Hn=Math.pow(2,17),Un=Math.pow(2,16),pn=Math.pow(2,9),_a=Math.pow(2,8),zn=Math.pow(2,1);function Xn(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const t=v.placed?1:0,u=Math.floor(127*v.opacity);return u*si+t*$r+u*Hn+t*Un+u*pn+t*_a+u*zn+t}const Ur=0;function Rn(){return{isOccluded:(v,t,u)=>!1,getPitchedTextCorrection:(v,t,u)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(v,t,u,p){throw new Error("Not implemented.")},translatePosition:(v,t,u,p)=>function(m,b,A,P,O=!1){if(!A[0]&&!A[1])return[0,0];const Z=O?P==="map"?m.angle:0:P==="viewport"?-m.angle:0;if(Z){const K=Math.sin(Z),J=Math.cos(Z);A=[A[0]*J-A[1]*K,A[0]*K+A[1]*J]}return[O?A[0]:Si(b,A[0],m.zoom),O?A[1]:Si(b,A[1],m.zoom)]}(v,t,u,p),getCircleRadiusCorrection:v=>1}}class Ii{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,u,p,m,b){const A=this._bucketParts;for(;this._currentTileIndex<t.length;)if(u.getBucketParts(A,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((P,O)=>P.sortKey-O.sortKey));this._currentPartIndex<A.length;)if(u.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class No{constructor(t,u,p,m,b,A,P,O){this.placement=new Ji(t,Rn(),u,A,P,O),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,u,p){const m=y.now(),b=()=>!this._forceFullPlacement&&y.now()-m>2;for(;this._currentPlacementIndex>=0;){const A=u[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=P)&&(!A.maxzoom||A.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Ii(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const rr=512/a.X/2;class En{constructor(t,u,p){this.tileID=t,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<u.length;b++){const A=u.get(b),P=A.key,O=m.get(P);O?O.push(A):m.set(P,[A])}for(const[b,A]of m){const P={positions:A.map(O=>({x:Math.floor(O.anchorX*rr),y:Math.floor(O.anchorY*rr)})),crossTileIDs:A.map(O=>O.crossTileID)};if(P.positions.length>128){const O=new a.av(P.positions.length,16,Uint16Array);for(const{x:Z,y:K}of P.positions)O.add(Z,K);O.finish(),delete P.positions,P.index=O}this._symbolsByKey[b]=P}}getScaledCoordinates(t,u){const{x:p,y:m,z:b}=this.tileID.canonical,{x:A,y:P,z:O}=u.canonical,Z=rr/Math.pow(2,O-b),K=(P*a.X+t.anchorY)*Z,J=m*a.X*rr;return{x:Math.floor((A*a.X+t.anchorX)*Z-p*a.X*rr),y:Math.floor(K-J)}}findMatches(t,u,p){const m=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<t.length;b++){const A=t.get(b);if(A.crossTileID)continue;const P=this._symbolsByKey[A.key];if(!P)continue;const O=this.getScaledCoordinates(A,u);if(P.index){const Z=P.index.range(O.x-m,O.y-m,O.x+m,O.y+m).sort();for(const K of Z){const J=P.crossTileIDs[K];if(!p[J]){p[J]=!0,A.crossTileID=J;break}}}else if(P.positions)for(let Z=0;Z<P.positions.length;Z++){const K=P.positions[Z],J=P.crossTileIDs[Z];if(Math.abs(K.x-O.x)<=m&&Math.abs(K.y-O.y)<=m&&!p[J]){p[J]=!0,A.crossTileID=J;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ya{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const u=Math.round((t-this.lng)/360);if(u!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const A in m){const P=m[A];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),b[P.tileID.key]=P}this.indexes[p]=b}this.lng=t}addBucket(t,u,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const A=this.indexes[b];if(Number(b)>t.overscaledZ)for(const P in A){const O=A[P];O.tileID.isChildOf(t)&&O.findMatches(u.symbolInstances,t,m)}else{const P=A[t.scaledTo(Number(b)).key];P&&P.findMatches(u.symbolInstances,t,m)}}for(let b=0;b<u.symbolInstances.length;b++){const A=u.symbolInstances.get(b);A.crossTileID||(A.crossTileID=p.generate(),m[A.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new En(t,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(t,u){for(const p of u.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[t][m]}removeStaleBuckets(t){let u=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)t[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],u=!0)}return u}}class al{constructor(){this.layerIndexes={},this.crossTileIDs=new ya,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,u,p){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Vr);let b=!1;const A={};m.handleWrapJump(p);for(const P of u){const O=P.getBucket(t);O&&t.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(P.tileID,O,this.crossTileIDs)&&(b=!0),A[O.bucketInstanceId]=!0)}return m.removeStaleBuckets(A)&&(b=!0),b}pruneUnusedLayers(t){const u={};t.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}const qr=(v,t)=>a.t(v,t&&t.filter(u=>u.identifier!=="source.canvas")),ou=a.aw();class ba extends a.E{constructor(t,u={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=t,this.dispatcher=new Pi(Mi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new ce,this.imageManager.setEventedParent(this),this.glyphManager=new ye(t._requestManager,u.localIdeographFontFamily),this.lineAtlas=new Tt(256,512),this.crossTileSymbolIndex=new al,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),Fi().on(ft,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const A in this._layers){const P=this._layers[A];P.source===b.id&&this._validateLayer(P)}})}loadURL(t,u={},p){this.fire(new a.k("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const m=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;a.h(m,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,u,p)}).catch(A=>{this._loadStyleRequest=null,A&&!b.signal.aborted&&this.fire(new a.j(A))})}loadJSON(t,u={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(t,u,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(ou,{validate:!1})}_load(t,u,p){var m;const b=u.transformStyle?u.transformStyle(p,t):t;if(!u.validate||!qr(this,a.u(b))){this._loaded=!0,this.stylesheet=b;for(const A in b.sources)this.addSource(A,b.sources[A],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new ot(this.stylesheet.light),this.sky=new pt(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const t=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(u=>u.id),this._layers={},this._serializedLayers=null;for(const u of t){const p=a.aA(u);p.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=p}}_loadSprite(t,u=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,A,P,O){return a._(this,void 0,void 0,function*(){const Z=U(b),K=P>1?"@2x":"",J={},ae={};for(const{id:_e,url:xe}of Z){const Ee=A.transformRequest(X(xe,K,".json"),"SpriteJSON");J[_e]=a.h(Ee,O);const Oe=A.transformRequest(X(xe,K,".png"),"SpriteImage");ae[_e]=V.getImage(Oe,O)}return yield Promise.all([...Object.values(J),...Object.values(ae)]),function(_e,xe){return a._(this,void 0,void 0,function*(){const Ee={};for(const Oe in _e){Ee[Oe]={};const De=y.getImageCanvasContext((yield xe[Oe]).data),je=(yield _e[Oe]).data;for(const Te in je){const{width:He,height:Je,x:nt,y:bt,sdf:Ct,pixelRatio:Dt,stretchX:Nt,stretchY:Lt,content:Mt,textFitWidth:Jt,textFitHeight:xi}=je[Te];Ee[Oe][Te]={data:null,pixelRatio:Dt,sdf:Ct,stretchX:Nt,stretchY:Lt,content:Mt,textFitWidth:Jt,textFitHeight:xi,spriteData:{width:He,height:Je,x:nt,y:bt,context:De}}}}return Ee})}(J,ae)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const A in b){this._spritesImagesIds[A]=[];const P=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter(O=>!(O in b)):[];for(const O of P)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in b[A]){const Z=A==="default"?O:`${A}:${O}`;this._spritesImagesIds[A].push(Z),Z in this.imageManager.images?this.imageManager.updateImage(Z,b[A][O],!1):this.imageManager.addImage(Z,b[A][O]),u&&(this._changedImages[Z]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(t){const u=this.sourceCaches[t.source];if(!u)return;const p=t.sourceLayer;if(!p)return;const m=u.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,u=!1){const p=this._serializedAllLayers();if(!t||t.length===0)return Object.values(u?a.aB(p):p);const m=[];for(const b of t)if(p[b]){const A=u?a.aB(p[b]):p[b];m.push(A)}return m}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const u=Object.keys(this._layers);for(const p of u){const m=this._layers[p];m.type!=="custom"&&(t[p]=m.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const u=this._changed;if(u){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const A in this._updatedSources){const P=this._updatedSources[A];if(P==="reload")this._reloadSource(A);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,u&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,u={}){var p;this._checkLoaded();const m=this.serialize();if(t=u.transformStyle?u.transformStyle(m,t):t,((p=u.validate)===null||p===void 0||p)&&qr(this,a.u(t)))return!1;(t=a.aB(t)).layers=a.az(t.layers);const b=a.aC(m,t),A=this._getOperationsToPerform(b);if(A.unimplemented.length>0)throw new Error(`Unimplemented: ${A.unimplemented.join(", ")}.`);if(A.operations.length===0)return!1;for(const P of A.operations)P();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const u=[],p=[];for(const m of t)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":u.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":u.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":u.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":u.push(()=>{});break;default:p.push(m.command)}return{operations:u,unimplemented:p}}addImage(t,u){if(this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,u),this._afterImageUpdated(t)}updateImage(t,u){this.imageManager.updateImage(t,u)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,u,p={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(a.u.source,`sources.${t}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const m=this.sourceCaches[t]=new ii(t,u,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new a.j(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));const u=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],u.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,u){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const p=this.sourceCaches[t].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(u),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,u,p={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(t.type==="custom"){if(qr(this,a.aD(t)))return;b=a.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(m,t.source),t=a.aB(t),t=a.e(t,{source:m})),this._validate(a.u.layer,`layers.${m}`,t,{arrayIndex:-1},p))return;b=a.aA(t),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const A=u?this._order.indexOf(u):this._order.length;if(u&&A===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${u}".`)));else{if(this._order.splice(A,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const P=this._removedLayers[m];delete this._removedLayers[m],P.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,u){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===u)return;const p=this._order.indexOf(t);this._order.splice(p,1);const m=u?this._order.indexOf(u):this._order.length;u&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${t}" before non-existing layer "${u}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const u=this._layers[t];if(!u)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${t}".`)));u.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=u,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],u.onRemove&&u.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,u,p){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===u&&m.maxzoom===p||(u!=null&&(m.minzoom=u),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,u,p={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!a.aE(m.filter,u))return u==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.u.filter,`layers.${m.id}.filter`,u,null,p)||(m.filter=a.aB(u),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.aB(this.getLayer(t).filter)}setLayoutProperty(t,u,p,m={}){this._checkLoaded();const b=this.getLayer(t);b?a.aE(b.getLayoutProperty(u),p)||(b.setLayoutProperty(u,p,m),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,u){const p=this.getLayer(t);if(p)return p.getLayoutProperty(u);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,u,p,m={}){this._checkLoaded();const b=this.getLayer(t);b?a.aE(b.getPaintProperty(u),p)||(b.setPaintProperty(u,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,u){return this.getLayer(t).getPaintProperty(u)}setFeatureState(t,u){this._checkLoaded();const p=t.source,m=t.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const A=b.getSource().type;A==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||m?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,t.id,u)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,u){this._checkLoaded();const p=t.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,A=b==="vector"?t.sourceLayer:void 0;b!=="vector"||A?u&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(A,t.id,u):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const u=t.source,p=t.sourceLayer,m=this.sourceCaches[u];if(m!==void 0)return m.getSource().type!=="vector"||p?(t.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,t.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=a.aF(this.sourceCaches,b=>b.serialize()),u=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:t,layers:u,terrain:p},b=>b!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const u=A=>this._layers[A].type==="fill-extrusion",p={},m=[];for(let A=this._order.length-1;A>=0;A--){const P=this._order[A];if(u(P)){p[P]=A;for(const O of t){const Z=O[P];if(Z)for(const K of Z)m.push(K)}}}m.sort((A,P)=>P.intersectionZ-A.intersectionZ);const b=[];for(let A=this._order.length-1;A>=0;A--){const P=this._order[A];if(u(P))for(let O=m.length-1;O>=0;O--){const Z=m[O].feature;if(p[Z.layer.id]<A)break;b.push(Z),m.pop()}else for(const O of t){const Z=O[P];if(Z)for(const K of Z)b.push(K.feature)}}return b}queryRenderedFeatures(t,u,p){u&&u.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",u.filter,null,u);const m={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const P of u.layers){const O=this._layers[P];if(!O)return this.fire(new a.j(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];m[O.source]=!0}}const b=[];u.availableImages=this._availableImages;const A=this._serializedAllLayers();for(const P in this.sourceCaches)u.layers&&!m[P]||b.push(Xe(this.sourceCaches[P],this._layers,A,t,u,p));return this.placement&&b.push(function(P,O,Z,K,J,ae,_e){const xe={},Ee=ae.queryRenderedSymbols(K),Oe=[];for(const De of Object.keys(Ee).map(Number))Oe.push(_e[De]);Oe.sort(Pt);for(const De of Oe){const je=De.featureIndex.lookupSymbolFeatures(Ee[De.bucketInstanceId],O,De.bucketIndex,De.sourceLayerIndex,J.filter,J.layers,J.availableImages,P);for(const Te in je){const He=xe[Te]=xe[Te]||[],Je=je[Te];Je.sort((nt,bt)=>{const Ct=De.featureSortOrder;if(Ct){const Dt=Ct.indexOf(nt.featureIndex);return Ct.indexOf(bt.featureIndex)-Dt}return bt.featureIndex-nt.featureIndex});for(const nt of Je)He.push(nt)}}for(const De in xe)xe[De].forEach(je=>{const Te=je.feature,He=Z[P[De].source].getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=He});return xe}(this._layers,A,this.sourceCaches,t,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,u){u&&u.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",u.filter,null,u);const p=this.sourceCaches[t];return p?function(m,b){const A=m.getRenderableIds().map(Z=>m.getTileByID(Z)),P=[],O={};for(let Z=0;Z<A.length;Z++){const K=A[Z],J=K.tileID.canonical.key;O[J]||(O[J]=!0,K.querySourceFeatures(P,b))}return P}(p,u):[]}getLight(){return this.light.getLight()}setLight(t,u={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const A in t)if(!a.aE(t[A],p[A])){m=!0;break}if(!m)return;const b={now:y.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,u),this.light.updateTransitions(b)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,u={}){const p=this.getSky();let m=!1;if(!t&&!p)return;if(t&&!p)m=!0;else if(!t&&p)m=!0;else for(const A in t)if(!a.aE(t[A],p[A])){m=!0;break}if(!m)return;const b={now:y.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,u),this.sky.updateTransitions(b)}_validate(t,u,p,m,b={}){return(!b||b.validate!==!1)&&qr(this,t.call(a.u,a.e({key:u,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Fi().off(ft,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const p=this.sourceCaches[u];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const u in this.sourceCaches)this.sourceCaches[u].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,u,p,m,b=!1){let A=!1,P=!1;const O={};for(const Z of this._order){const K=this._layers[Z];if(K.type!=="symbol")continue;if(!O[K.source]){const ae=this.sourceCaches[K.source];O[K.source]=ae.getRenderableIds(!0).map(_e=>ae.getTileByID(_e)).sort((_e,xe)=>xe.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(xe.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(K,O[K.source],t.center.lng);A=A||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),t.zoom))&&(this.pauseablePlacement=new No(t,this.map.terrain,this._order,b,u,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A)for(const Z of this._order){const K=this._layers[Z];K.type==="symbol"&&this.placement.updateLayerOpacities(K,O[K.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,u){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,u.icons),p})}getGlyphs(t,u){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(u.stacks),m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,u={}){this._checkLoaded(),t&&this._validate(a.u.glyphs,"glyphs",t,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,u,p={},m){this._checkLoaded();const b=[{id:t,url:u}],A=[...U(this.stylesheet.sprite),...b];this._validate(a.u.sprite,"sprite",A,null,p)||(this.stylesheet.sprite=A,this._loadSprite(b,!0,m))}removeSprite(t){this._checkLoaded();const u=U(this.stylesheet.sprite);if(u.find(p=>p.id===t)){if(this._spritesImagesIds[t])for(const p of this._spritesImagesIds[t])this.imageManager.removeImage(p),this._changedImages[p]=!0;u.splice(u.findIndex(p=>p.id===t),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return U(this.stylesheet.sprite)}setSprite(t,u={},p){this._checkLoaded(),t&&this._validate(a.u.sprite,"sprite",t,null,u)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,p):(this._unloadSprite(),p&&p(null)))}}var Xs=a.Y([{name:"a_pos",type:"Int16",components:2}]);const Bn={prelude:Gi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Gi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Gi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Gi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Gi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Gi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Gi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Gi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Gi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Gi(v,t){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=t.match(/attribute ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=b?b.concat(m):m,P={};return{fragmentSource:v=v.replace(u,(O,Z,K,J,ae)=>(P[ae]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
varying ${K} ${J} ${ae};
#else
uniform ${K} ${J} u_${ae};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ae}
    ${K} ${J} ${ae} = u_${ae};
#endif
`)),vertexSource:t=t.replace(u,(O,Z,K,J,ae)=>{const _e=J==="float"?"vec2":"vec4",xe=ae.match(/color/)?"color":_e;return P[ae]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
uniform lowp float u_${ae}_t;
attribute ${K} ${_e} a_${ae};
varying ${K} ${J} ${ae};
#else
uniform ${K} ${J} u_${ae};
#endif
`:xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ae}
    ${ae} = a_${ae};
#else
    ${K} ${J} ${ae} = u_${ae};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ae}
    ${ae} = unpack_mix_${xe}(a_${ae}, u_${ae}_t);
#else
    ${K} ${J} ${ae} = u_${ae};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
uniform lowp float u_${ae}_t;
attribute ${K} ${_e} a_${ae};
#else
uniform ${K} ${J} u_${ae};
#endif
`:xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ae}
    ${K} ${J} ${ae} = a_${ae};
#else
    ${K} ${J} ${ae} = u_${ae};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ae}
    ${K} ${J} ${ae} = unpack_mix_${xe}(a_${ae}, u_${ae}_t);
#else
    ${K} ${J} ${ae} = u_${ae};
#endif
`}),staticAttributes:p,staticUniforms:A}}class va{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,u,p,m,b,A,P,O,Z){this.context=t;let K=this.boundPaintVertexBuffers.length!==m.length;for(let J=0;!K&&J<m.length;J++)this.boundPaintVertexBuffers[J]!==m[J]&&(K=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||K||this.boundIndexBuffer!==b||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==Z?this.freshBind(u,p,m,b,A,P,O,Z):(t.bindVertexArray.set(this.vao),P&&P.bind(),b&&b.dynamicDraw&&b.bind(),O&&O.bind(),Z&&Z.bind())}freshBind(t,u,p,m,b,A,P,O){const Z=t.numAttributes,K=this.context,J=K.gl;this.vao&&this.destroy(),this.vao=K.createVertexArray(),K.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=O,u.enableAttributes(J,t);for(const ae of p)ae.enableAttributes(J,t);A&&A.enableAttributes(J,t),P&&P.enableAttributes(J,t),O&&O.enableAttributes(J,t),u.bind(),u.setVertexAttribPointers(J,t,b);for(const ae of p)ae.bind(),ae.setVertexAttribPointers(J,t,b);A&&(A.bind(),A.setVertexAttribPointers(J,t,b)),m&&m.bind(),P&&(P.bind(),P.setVertexAttribPointers(J,t,b)),O&&(O.bind(),O.setVertexAttribPointers(J,t,b)),K.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const wa=(v,t,u,p,m)=>({u_matrix:v,u_texture:0,u_ele_delta:t,u_fog_matrix:u,u_fog_color:p?p.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?p.calculateFogBlendOpacity(m):0,u_horizon_color:p?p.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1});function fo(v){const t=[];for(let u=0;u<v.length;u++){if(v[u]===null)continue;const p=v[u].split(" ");t.push(p.pop())}return t}class ll{constructor(t,u,p,m,b,A){const P=t.gl;this.program=P.createProgram();const O=fo(u.staticAttributes),Z=p?p.getBinderAttributes():[],K=O.concat(Z),J=Bn.prelude.staticUniforms?fo(Bn.prelude.staticUniforms):[],ae=u.staticUniforms?fo(u.staticUniforms):[],_e=p?p.getBinderUniforms():[],xe=J.concat(ae).concat(_e),Ee=[];for(const nt of xe)Ee.indexOf(nt)<0&&Ee.push(nt);const Oe=p?p.defines():[];b&&Oe.push("#define OVERDRAW_INSPECTOR;"),A&&Oe.push("#define TERRAIN3D;");const De=Oe.concat(Bn.prelude.fragmentSource,u.fragmentSource).join(`
`),je=Oe.concat(Bn.prelude.vertexSource,u.vertexSource).join(`
`),Te=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Te,De),P.compileShader(Te),!P.getShaderParameter(Te,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(Te)}`);P.attachShader(this.program,Te);const He=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(He,je),P.compileShader(He),!P.getShaderParameter(He,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(He)}`);P.attachShader(this.program,He),this.attributes={};const Je={};this.numAttributes=K.length;for(let nt=0;nt<this.numAttributes;nt++)K[nt]&&(P.bindAttribLocation(this.program,nt,K[nt]),this.attributes[K[nt]]=nt);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(He),P.deleteShader(Te);for(let nt=0;nt<Ee.length;nt++){const bt=Ee[nt];if(bt&&!Je[bt]){const Ct=P.getUniformLocation(this.program,bt);Ct&&(Je[bt]=Ct)}}this.fixedUniforms=m(t,Je),this.terrainUniforms=((nt,bt)=>({u_depth:new a.aH(nt,bt.u_depth),u_terrain:new a.aH(nt,bt.u_terrain),u_terrain_dim:new a.aI(nt,bt.u_terrain_dim),u_terrain_matrix:new a.aJ(nt,bt.u_terrain_matrix),u_terrain_unpack:new a.aK(nt,bt.u_terrain_unpack),u_terrain_exaggeration:new a.aI(nt,bt.u_terrain_exaggeration)}))(t,Je),this.binderUniforms=p?p.getUniforms(t,Je):[]}draw(t,u,p,m,b,A,P,O,Z,K,J,ae,_e,xe,Ee,Oe,De,je){const Te=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(m),t.setColorMode(b),t.setCullFace(A),O){t.activeTexture.set(Te.TEXTURE2),Te.bindTexture(Te.TEXTURE_2D,O.depthTexture),t.activeTexture.set(Te.TEXTURE3),Te.bindTexture(Te.TEXTURE_2D,O.texture);for(const Je in this.terrainUniforms)this.terrainUniforms[Je].set(O[Je])}for(const Je in this.fixedUniforms)this.fixedUniforms[Je].set(P[Je]);Ee&&Ee.setUniforms(t,this.binderUniforms,_e,{zoom:xe});let He=0;switch(u){case Te.LINES:He=2;break;case Te.TRIANGLES:He=3;break;case Te.LINE_STRIP:He=1}for(const Je of ae.get()){const nt=Je.vaos||(Je.vaos={});(nt[Z]||(nt[Z]=new va)).bind(t,this,K,Ee?Ee.getPaintVertexBuffers():[],J,Je.vertexOffset,Oe,De,je),Te.drawElements(u,Je.primitiveLength*He,Te.UNSIGNED_SHORT,Je.primitiveOffset*He*2)}}}function jo(v,t,u){const p=1/Si(u,1,t.transform.tileZoom),m=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,t.transform.tileZoom)/m,A=b*(u.tileID.canonical.x+u.tileID.wrap*m),P=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[A>>16,P>>16],u_pixel_coord_lower:[65535&A,65535&P]}}const As=(v,t,u,p)=>{const m=t.style.light,b=m.properties.get("position"),A=[b.x,b.y,b.z],P=function(){var Z=new a.A(9);return a.A!=Float32Array&&(Z[1]=0,Z[2]=0,Z[3]=0,Z[5]=0,Z[6]=0,Z[7]=0),Z[0]=1,Z[4]=1,Z[8]=1,Z}();m.properties.get("anchor")==="viewport"&&function(Z,K){var J=Math.sin(K),ae=Math.cos(K);Z[0]=ae,Z[1]=J,Z[2]=0,Z[3]=-J,Z[4]=ae,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}(P,-t.transform.angle),function(Z,K,J){var ae=K[0],_e=K[1],xe=K[2];Z[0]=ae*J[0]+_e*J[3]+xe*J[6],Z[1]=ae*J[1]+_e*J[4]+xe*J[7],Z[2]=ae*J[2]+_e*J[5]+xe*J[8]}(A,A,P);const O=m.properties.get("color");return{u_matrix:v,u_lightpos:A,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+u,u_opacity:p}},xa=(v,t,u,p,m,b,A)=>a.e(As(v,t,u,p),jo(b,t,A),{u_height_factor:-Math.pow(2,m.overscaledZ)/A.tileSize/8}),po=v=>({u_matrix:v}),cl=(v,t,u,p)=>a.e(po(v),jo(u,t,p)),au=(v,t)=>({u_matrix:v,u_world:t}),Hl=(v,t,u,p,m)=>a.e(cl(v,t,u,p),{u_world:m}),Xl=(v,t,u,p)=>{const m=v.transform;let b,A;if(p.paint.get("circle-pitch-alignment")==="map"){const P=Si(u,1,m.zoom);b=!0,A=[P,P]}else b=!1,A=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(t.posMatrix,u,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:A}},Ms=(v,t,u)=>({u_matrix:v,u_inv_matrix:t,u_camera_to_center_distance:u.cameraToCenterDistance,u_viewport_size:[u.width,u.height]}),mo=(v,t,u=1)=>({u_matrix:v,u_color:t,u_overlay:0,u_overlay_scale:u}),Vn=v=>({u_matrix:v}),$n=(v,t,u,p)=>({u_matrix:v,u_extrude_scale:Si(t,1,u),u_intensity:p}),go=(v,t,u,p)=>{const m=a.H();a.aP(m,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:u,u_color_ramp:p,u_opacity:t.paint.get("heatmap-opacity")}};function er(v,t){const u=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new a.Z(0,p/u).toLngLat().lat,new a.Z(0,(p+1)/u).toLngLat().lat]}const ka=(v,t,u,p)=>{const m=v.transform;return{u_matrix:Ql(v,t,u,p),u_ratio:1/Si(t,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Kl=(v,t,u,p,m)=>a.e(ka(v,t,u,m),{u_image:0,u_image_height:p}),Ks=(v,t,u,p,m)=>{const b=v.transform,A=Yl(t,b);return{u_matrix:Ql(v,t,u,m),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Si(t,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Jl=(v,t,u,p,m,b)=>{const A=v.lineAtlas,P=Yl(t,v.transform),O=u.layout.get("line-cap")==="round",Z=A.getDash(p.from,O),K=A.getDash(p.to,O),J=Z.width*m.fromScale,ae=K.width*m.toScale;return a.e(ka(v,t,u,b),{u_patternscale_a:[P/J,-Z.height/2],u_patternscale_b:[P/ae,-K.height/2],u_sdfgamma:A.width/(256*Math.min(J,ae)*v.pixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:K.y,u_mix:m.t})};function Yl(v,t){return 1/Si(v,1,t.tileZoom)}function Ql(v,t,u,p){return v.translatePosMatrix(p?p.posMatrix:t.tileID.posMatrix,t,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const lu=(v,t,u,p,m)=>{return{u_matrix:v,u_tl_parent:t,u_scale_parent:u,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(A=m.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:cu(m.paint.get("raster-hue-rotate"))};var b,A};function cu(v){v*=Math.PI/180;const t=Math.sin(v),u=Math.cos(v);return[(2*u+1)/3,(-Math.sqrt(3)*t-u+1)/3,(Math.sqrt(3)*t-u+1)/3]}const $l=(v,t,u,p,m,b,A,P,O,Z,K,J,ae,_e)=>{const xe=A.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:xe.cameraToCenterDistance,u_pitch:xe.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:xe.width/xe.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:O,u_coord_matrix:Z,u_is_text:+J,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:ae,u_texture:0,u_translation:K,u_pitched_scale:_e}},Uo=(v,t,u,p,m,b,A,P,O,Z,K,J,ae,_e,xe)=>{const Ee=A.transform;return a.e($l(v,t,u,p,m,b,A,P,O,Z,K,J,ae,xe),{u_gamma_scale:p?Math.cos(Ee._pitch)*Ee.cameraToCenterDistance:1,u_device_pixel_ratio:A.pixelRatio,u_is_halo:1})},Sa=(v,t,u,p,m,b,A,P,O,Z,K,J,ae,_e)=>a.e(Uo(v,t,u,p,m,b,A,P,O,Z,K,!0,J,!0,_e),{u_texsize_icon:ae,u_texture_icon:1}),Vo=(v,t,u)=>({u_matrix:v,u_opacity:t,u_color:u}),qo=(v,t,u,p,m,b)=>a.e(function(A,P,O,Z){const K=O.imageManager.getPattern(A.from.toString()),J=O.imageManager.getPattern(A.to.toString()),{width:ae,height:_e}=O.imageManager.getPixelSize(),xe=Math.pow(2,Z.tileID.overscaledZ),Ee=Z.tileSize*Math.pow(2,O.transform.tileZoom)/xe,Oe=Ee*(Z.tileID.canonical.x+Z.tileID.wrap*xe),De=Ee*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:K.tl,u_pattern_br_a:K.br,u_pattern_tl_b:J.tl,u_pattern_br_b:J.br,u_texsize:[ae,_e],u_mix:P.t,u_pattern_size_a:K.displaySize,u_pattern_size_b:J.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/Si(Z,1,O.transform.tileZoom),u_pixel_coord_upper:[Oe>>16,De>>16],u_pixel_coord_lower:[65535&Oe,65535&De]}}(p,b,u,m),{u_matrix:v,u_opacity:t}),ul={fillExtrusion:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_lightpos:new a.aN(v,t.u_lightpos),u_lightintensity:new a.aI(v,t.u_lightintensity),u_lightcolor:new a.aN(v,t.u_lightcolor),u_vertical_gradient:new a.aI(v,t.u_vertical_gradient),u_opacity:new a.aI(v,t.u_opacity)}),fillExtrusionPattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_lightpos:new a.aN(v,t.u_lightpos),u_lightintensity:new a.aI(v,t.u_lightintensity),u_lightcolor:new a.aN(v,t.u_lightcolor),u_vertical_gradient:new a.aI(v,t.u_vertical_gradient),u_height_factor:new a.aI(v,t.u_height_factor),u_image:new a.aH(v,t.u_image),u_texsize:new a.aO(v,t.u_texsize),u_pixel_coord_upper:new a.aO(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,t.u_pixel_coord_lower),u_scale:new a.aN(v,t.u_scale),u_fade:new a.aI(v,t.u_fade),u_opacity:new a.aI(v,t.u_opacity)}),fill:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix)}),fillPattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_image:new a.aH(v,t.u_image),u_texsize:new a.aO(v,t.u_texsize),u_pixel_coord_upper:new a.aO(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,t.u_pixel_coord_lower),u_scale:new a.aN(v,t.u_scale),u_fade:new a.aI(v,t.u_fade)}),fillOutline:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_world:new a.aO(v,t.u_world)}),fillOutlinePattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_world:new a.aO(v,t.u_world),u_image:new a.aH(v,t.u_image),u_texsize:new a.aO(v,t.u_texsize),u_pixel_coord_upper:new a.aO(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,t.u_pixel_coord_lower),u_scale:new a.aN(v,t.u_scale),u_fade:new a.aI(v,t.u_fade)}),circle:(v,t)=>({u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_scale_with_map:new a.aH(v,t.u_scale_with_map),u_pitch_with_map:new a.aH(v,t.u_pitch_with_map),u_extrude_scale:new a.aO(v,t.u_extrude_scale),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_matrix:new a.aJ(v,t.u_matrix)}),collisionBox:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_pixel_extrude_scale:new a.aO(v,t.u_pixel_extrude_scale)}),collisionCircle:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_inv_matrix:new a.aJ(v,t.u_inv_matrix),u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_viewport_size:new a.aO(v,t.u_viewport_size)}),debug:(v,t)=>({u_color:new a.aL(v,t.u_color),u_matrix:new a.aJ(v,t.u_matrix),u_overlay:new a.aH(v,t.u_overlay),u_overlay_scale:new a.aI(v,t.u_overlay_scale)}),clippingMask:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix)}),heatmap:(v,t)=>({u_extrude_scale:new a.aI(v,t.u_extrude_scale),u_intensity:new a.aI(v,t.u_intensity),u_matrix:new a.aJ(v,t.u_matrix)}),heatmapTexture:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_world:new a.aO(v,t.u_world),u_image:new a.aH(v,t.u_image),u_color_ramp:new a.aH(v,t.u_color_ramp),u_opacity:new a.aI(v,t.u_opacity)}),hillshade:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_image:new a.aH(v,t.u_image),u_latrange:new a.aO(v,t.u_latrange),u_light:new a.aO(v,t.u_light),u_shadow:new a.aL(v,t.u_shadow),u_highlight:new a.aL(v,t.u_highlight),u_accent:new a.aL(v,t.u_accent)}),hillshadePrepare:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_image:new a.aH(v,t.u_image),u_dimension:new a.aO(v,t.u_dimension),u_zoom:new a.aI(v,t.u_zoom),u_unpack:new a.aK(v,t.u_unpack)}),line:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_ratio:new a.aI(v,t.u_ratio),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,t.u_units_to_pixels)}),lineGradient:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_ratio:new a.aI(v,t.u_ratio),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,t.u_units_to_pixels),u_image:new a.aH(v,t.u_image),u_image_height:new a.aI(v,t.u_image_height)}),linePattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_texsize:new a.aO(v,t.u_texsize),u_ratio:new a.aI(v,t.u_ratio),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_image:new a.aH(v,t.u_image),u_units_to_pixels:new a.aO(v,t.u_units_to_pixels),u_scale:new a.aN(v,t.u_scale),u_fade:new a.aI(v,t.u_fade)}),lineSDF:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_ratio:new a.aI(v,t.u_ratio),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,t.u_units_to_pixels),u_patternscale_a:new a.aO(v,t.u_patternscale_a),u_patternscale_b:new a.aO(v,t.u_patternscale_b),u_sdfgamma:new a.aI(v,t.u_sdfgamma),u_image:new a.aH(v,t.u_image),u_tex_y_a:new a.aI(v,t.u_tex_y_a),u_tex_y_b:new a.aI(v,t.u_tex_y_b),u_mix:new a.aI(v,t.u_mix)}),raster:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_tl_parent:new a.aO(v,t.u_tl_parent),u_scale_parent:new a.aI(v,t.u_scale_parent),u_buffer_scale:new a.aI(v,t.u_buffer_scale),u_fade_t:new a.aI(v,t.u_fade_t),u_opacity:new a.aI(v,t.u_opacity),u_image0:new a.aH(v,t.u_image0),u_image1:new a.aH(v,t.u_image1),u_brightness_low:new a.aI(v,t.u_brightness_low),u_brightness_high:new a.aI(v,t.u_brightness_high),u_saturation_factor:new a.aI(v,t.u_saturation_factor),u_contrast_factor:new a.aI(v,t.u_contrast_factor),u_spin_weights:new a.aN(v,t.u_spin_weights)}),symbolIcon:(v,t)=>({u_is_size_zoom_constant:new a.aH(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,t.u_is_size_feature_constant),u_size_t:new a.aI(v,t.u_size_t),u_size:new a.aI(v,t.u_size),u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_pitch:new a.aI(v,t.u_pitch),u_rotate_symbol:new a.aH(v,t.u_rotate_symbol),u_aspect_ratio:new a.aI(v,t.u_aspect_ratio),u_fade_change:new a.aI(v,t.u_fade_change),u_matrix:new a.aJ(v,t.u_matrix),u_label_plane_matrix:new a.aJ(v,t.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,t.u_coord_matrix),u_is_text:new a.aH(v,t.u_is_text),u_pitch_with_map:new a.aH(v,t.u_pitch_with_map),u_is_along_line:new a.aH(v,t.u_is_along_line),u_is_variable_anchor:new a.aH(v,t.u_is_variable_anchor),u_texsize:new a.aO(v,t.u_texsize),u_texture:new a.aH(v,t.u_texture),u_translation:new a.aO(v,t.u_translation),u_pitched_scale:new a.aI(v,t.u_pitched_scale)}),symbolSDF:(v,t)=>({u_is_size_zoom_constant:new a.aH(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,t.u_is_size_feature_constant),u_size_t:new a.aI(v,t.u_size_t),u_size:new a.aI(v,t.u_size),u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_pitch:new a.aI(v,t.u_pitch),u_rotate_symbol:new a.aH(v,t.u_rotate_symbol),u_aspect_ratio:new a.aI(v,t.u_aspect_ratio),u_fade_change:new a.aI(v,t.u_fade_change),u_matrix:new a.aJ(v,t.u_matrix),u_label_plane_matrix:new a.aJ(v,t.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,t.u_coord_matrix),u_is_text:new a.aH(v,t.u_is_text),u_pitch_with_map:new a.aH(v,t.u_pitch_with_map),u_is_along_line:new a.aH(v,t.u_is_along_line),u_is_variable_anchor:new a.aH(v,t.u_is_variable_anchor),u_texsize:new a.aO(v,t.u_texsize),u_texture:new a.aH(v,t.u_texture),u_gamma_scale:new a.aI(v,t.u_gamma_scale),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_is_halo:new a.aH(v,t.u_is_halo),u_translation:new a.aO(v,t.u_translation),u_pitched_scale:new a.aI(v,t.u_pitched_scale)}),symbolTextAndIcon:(v,t)=>({u_is_size_zoom_constant:new a.aH(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,t.u_is_size_feature_constant),u_size_t:new a.aI(v,t.u_size_t),u_size:new a.aI(v,t.u_size),u_camera_to_center_distance:new a.aI(v,t.u_camera_to_center_distance),u_pitch:new a.aI(v,t.u_pitch),u_rotate_symbol:new a.aH(v,t.u_rotate_symbol),u_aspect_ratio:new a.aI(v,t.u_aspect_ratio),u_fade_change:new a.aI(v,t.u_fade_change),u_matrix:new a.aJ(v,t.u_matrix),u_label_plane_matrix:new a.aJ(v,t.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,t.u_coord_matrix),u_is_text:new a.aH(v,t.u_is_text),u_pitch_with_map:new a.aH(v,t.u_pitch_with_map),u_is_along_line:new a.aH(v,t.u_is_along_line),u_is_variable_anchor:new a.aH(v,t.u_is_variable_anchor),u_texsize:new a.aO(v,t.u_texsize),u_texsize_icon:new a.aO(v,t.u_texsize_icon),u_texture:new a.aH(v,t.u_texture),u_texture_icon:new a.aH(v,t.u_texture_icon),u_gamma_scale:new a.aI(v,t.u_gamma_scale),u_device_pixel_ratio:new a.aI(v,t.u_device_pixel_ratio),u_is_halo:new a.aH(v,t.u_is_halo),u_translation:new a.aO(v,t.u_translation),u_pitched_scale:new a.aI(v,t.u_pitched_scale)}),background:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_opacity:new a.aI(v,t.u_opacity),u_color:new a.aL(v,t.u_color)}),backgroundPattern:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_opacity:new a.aI(v,t.u_opacity),u_image:new a.aH(v,t.u_image),u_pattern_tl_a:new a.aO(v,t.u_pattern_tl_a),u_pattern_br_a:new a.aO(v,t.u_pattern_br_a),u_pattern_tl_b:new a.aO(v,t.u_pattern_tl_b),u_pattern_br_b:new a.aO(v,t.u_pattern_br_b),u_texsize:new a.aO(v,t.u_texsize),u_mix:new a.aI(v,t.u_mix),u_pattern_size_a:new a.aO(v,t.u_pattern_size_a),u_pattern_size_b:new a.aO(v,t.u_pattern_size_b),u_scale_a:new a.aI(v,t.u_scale_a),u_scale_b:new a.aI(v,t.u_scale_b),u_pixel_coord_upper:new a.aO(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(v,t.u_tile_units_to_pixels)}),terrain:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_texture:new a.aH(v,t.u_texture),u_ele_delta:new a.aI(v,t.u_ele_delta),u_fog_matrix:new a.aJ(v,t.u_fog_matrix),u_fog_color:new a.aL(v,t.u_fog_color),u_fog_ground_blend:new a.aI(v,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(v,t.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(v,t.u_horizon_color),u_horizon_fog_blend:new a.aI(v,t.u_horizon_fog_blend)}),terrainDepth:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_ele_delta:new a.aI(v,t.u_ele_delta)}),terrainCoords:(v,t)=>({u_matrix:new a.aJ(v,t.u_matrix),u_texture:new a.aH(v,t.u_texture),u_terrain_coords_id:new a.aI(v,t.u_terrain_coords_id),u_ele_delta:new a.aI(v,t.u_ele_delta)}),sky:(v,t)=>({u_sky_color:new a.aL(v,t.u_sky_color),u_horizon_color:new a.aL(v,t.u_horizon_color),u_horizon:new a.aI(v,t.u_horizon),u_sky_horizon_blend:new a.aI(v,t.u_sky_horizon_blend)})};class es{constructor(t,u,p){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Js={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zr{constructor(t,u,p,m){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=m,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,u){for(let p=0;p<this.attributes.length;p++){const m=u.attributes[this.attributes[p].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,u,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],A=u.attributes[b.name];A!==void 0&&t.vertexAttribPointer(A,b.components,t[Js[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ps=new WeakMap;function Ls(v){var t;if(Ps.has(v))return Ps.get(v);{const u=(t=v.getParameter(v.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ps.set(v,u),u}}class Xi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zo extends Xi{getDefault(){return a.aM.transparent}set(t){const u=this.current;(t.r!==u.r||t.g!==u.g||t.b!==u.b||t.a!==u.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ec extends Xi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ys extends Xi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class uu extends Xi{getDefault(){return[!0,!0,!0,!0]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||t[3]!==u[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tc extends Xi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hu extends Xi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class hl extends Xi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const u=this.current;(t.func!==u.func||t.ref!==u.ref||t.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ta extends Xi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ic extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=t,this.dirty=!1}}class nc extends Xi{getDefault(){return[0,1]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class rc extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=t,this.dirty=!1}}class sc extends Xi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Qs extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.BLEND):u.disable(u.BLEND),this.current=t,this.dirty=!1}}class ts extends Xi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class oc extends Xi{getDefault(){return a.aM.transparent}set(t){const u=this.current;(t.r!==u.r||t.g!==u.g||t.b!==u.b||t.a!==u.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ac extends Xi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Wo extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;t?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=t,this.dirty=!1}}class fu extends Xi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ca extends Xi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class du extends Xi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class pu extends Xi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class lc extends Xi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const u=this.current;(t[0]!==u[0]||t[1]!==u[1]||t[2]!==u[2]||t[3]!==u[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cc extends Xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ea extends Xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _o extends Xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class uc extends Xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Go extends Xi{getDefault(){return null}set(t){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class is extends Xi{getDefault(){return null}set(t){var u;if(t===this.current&&!this.dirty)return;const p=this.gl;Ls(p)?p.bindVertexArray(t):(u=p.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class $s extends Xi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ho extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Xo extends Xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ia extends Xi{constructor(t,u){super(t),this.context=t,this.parent=u}getDefault(){return null}}class fl extends Ia{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class eo extends Ia{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ps extends Ia{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class mu{constructor(t,u,p,m,b){this.context=t,this.width=u,this.height=p;const A=t.gl,P=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new fl(t,P),m)this.depthAttachment=b?new ps(t,P):new eo(t,P);else if(b)throw new Error("Stencil cannot be set without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,u=this.colorAttachment.get();if(u&&t.deleteTexture(u),this.depthAttachment){const p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class Tn{constructor(t,u,p){this.blendFunction=t,this.blendColor=u,this.mask=p}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,a.aM.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,a.aM.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],a.aM.transparent,[!0,!0,!0,!0]);class gu{constructor(t){var u,p;if(this.gl=t,this.clearColor=new Zo(this),this.clearDepth=new ec(this),this.clearStencil=new Ys(this),this.colorMask=new uu(this),this.depthMask=new tc(this),this.stencilMask=new hu(this),this.stencilFunc=new hl(this),this.stencilOp=new Ta(this),this.stencilTest=new ic(this),this.depthRange=new nc(this),this.depthTest=new rc(this),this.depthFunc=new sc(this),this.blend=new Qs(this),this.blendFunc=new ts(this),this.blendColor=new oc(this),this.blendEquation=new ac(this),this.cullFace=new Wo(this),this.cullFaceSide=new fu(this),this.frontFace=new Ca(this),this.program=new du(this),this.activeTexture=new pu(this),this.viewport=new lc(this),this.bindFramebuffer=new cc(this),this.bindRenderbuffer=new Ea(this),this.bindTexture=new _o(this),this.bindVertexBuffer=new uc(this),this.bindElementBuffer=new Go(this),this.bindVertexArray=new is(this),this.pixelStoreUnpack=new $s(this),this.pixelStoreUnpackPremultiplyAlpha=new Ho(this),this.pixelStoreUnpackFlipY=new Xo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ls(t)){this.HALF_FLOAT=t.HALF_FLOAT;const m=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=t.RGBA16F)!==null&&u!==void 0?u:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=t.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const m=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,u){return new es(this,t,u)}createVertexBuffer(t,u,p){return new Zr(this,t,u,p)}createRenderbuffer(t,u,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,t,u,p),this.bindRenderbuffer.set(null),b}createFramebuffer(t,u,p,m){return new mu(this,t,u,p,m)}clear({color:t,depth:u,stencil:p}){const m=this.gl;let b=0;t&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.aE(t.blendFunction,Tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ls(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var u;return Ls(this.gl)?this.gl.deleteVertexArray(t):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Li{constructor(t,u,p){this.func=t,this.mask=u,this.range=p}}Li.ReadOnly=!1,Li.ReadWrite=!0,Li.disabled=new Li(519,Li.ReadOnly,[0,1]);const to=7680;class Qi{constructor(t,u,p,m,b,A){this.test=t,this.ref=u,this.mask=p,this.fail=m,this.depthFail=b,this.pass=A}}Qi.disabled=new Qi({func:519,mask:0},0,0,to,to,to);class $i{constructor(t,u,p){this.enable=t,this.mode=u,this.frontFace=p}}let zs;function Ko(v,t,u,p,m){const b=v.context,A=b.gl,P=v.useProgram("collisionBox"),O=[];let Z=0,K=0;for(let De=0;De<p.length;De++){const je=p[De],Te=t.getTile(je).getBucket(u);if(!Te)continue;const He=m?Te.textCollisionBox:Te.iconCollisionBox,Je=Te.collisionCircleArray;if(Je.length>0){const nt=a.H();a.aQ(nt,Te.placementInvProjMatrix,v.transform.glCoordMatrix),a.aQ(nt,nt,Te.placementViewportMatrix),O.push({circleArray:Je,circleOffset:K,transform:je.posMatrix,invTransform:nt,coord:je}),Z+=Je.length/4,K=Z}He&&P.draw(b,A.LINES,Li.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,{u_matrix:je.posMatrix,u_pixel_extrude_scale:[1/(J=v.transform).width,1/J.height]},v.style.map.terrain&&v.style.map.terrain.getTerrainData(je),u.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,v.transform.zoom,null,null,He.collisionVertexBuffer)}var J;if(!m||!O.length)return;const ae=v.useProgram("collisionCircle"),_e=new a.aR;_e.resize(4*Z),_e._trim();let xe=0;for(const De of O)for(let je=0;je<De.circleArray.length/4;je++){const Te=4*je,He=De.circleArray[Te+0],Je=De.circleArray[Te+1],nt=De.circleArray[Te+2],bt=De.circleArray[Te+3];_e.emplace(xe++,He,Je,nt,bt,0),_e.emplace(xe++,He,Je,nt,bt,1),_e.emplace(xe++,He,Je,nt,bt,2),_e.emplace(xe++,He,Je,nt,bt,3)}(!zs||zs.length<2*Z)&&(zs=function(De){const je=2*De,Te=new a.aT;Te.resize(je),Te._trim();for(let He=0;He<je;He++){const Je=6*He;Te.uint16[Je+0]=4*He+0,Te.uint16[Je+1]=4*He+1,Te.uint16[Je+2]=4*He+2,Te.uint16[Je+3]=4*He+2,Te.uint16[Je+4]=4*He+3,Te.uint16[Je+5]=4*He+0}return Te}(Z));const Ee=b.createIndexBuffer(zs,!0),Oe=b.createVertexBuffer(_e,a.aS.members,!0);for(const De of O){const je=Ms(De.transform,De.invTransform,v.transform);ae.draw(b,A.TRIANGLES,Li.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,je,v.style.map.terrain&&v.style.map.terrain.getTerrainData(De.coord),u.id,Oe,Ee,a.a0.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,v.transform.zoom,null,null,null)}Oe.destroy(),Ee.destroy()}$i.disabled=new $i(!1,1029,2305),$i.backCCW=new $i(!0,1029,2305);const ns=a.an(new Float32Array(16));function Jo(v,t,u,p,m,b){const{horizontalAlign:A,verticalAlign:P}=a.au(v);return new a.P((-(A-.5)*t/m+p[0])*b,(-(P-.5)*u/m+p[1])*b)}function Os(v,t,u,p,m,b){const A=t.tileAnchorPoint.add(new a.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let P=p.mult(b);u||(P=P.rotate(-m));const O=A.add(P);return Pe(O.x,O.y,t.labelPlaneMatrix,t.getElevation).point}if(u){const P=at(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(v),O=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return v.add(p.rotate(O))}return v.add(p)}function yo(v,t,u,p,m,b,A,P,O,Z,K,J,ae,_e){const xe=v.text.placedSymbolArray,Ee=v.text.dynamicLayoutVertexArray,Oe=v.icon.dynamicLayoutVertexArray,De={};Ee.clear();for(let je=0;je<xe.length;je++){const Te=xe.get(je),He=Te.hidden||!Te.crossTileID||v.allowVerticalPlacement&&!Te.placedOrientation?null:p[Te.crossTileID];if(He){const Je=new a.P(Te.anchorX,Te.anchorY),nt={getElevation:_e,width:m.width,height:m.height,labelPlaneMatrix:b,pitchWithMap:u,projection:K,tileAnchorPoint:Je,translation:J,unwrappedTileID:ae},bt=u?Pe(Je.x,Je.y,A,_e):at(Je.x,Je.y,nt),Ct=te(m.cameraToCenterDistance,bt.signedDistanceFromCamera);let Dt=a.ai(v.textSizeData,O,Te)*Ct/a.ap;u&&(Dt*=v.tilePixelRatio/P);const{width:Nt,height:Lt,anchor:Mt,textOffset:Jt,textBoxScale:xi}=He,zt=Jo(Mt,Nt,Lt,Jt,xi,Dt),Rt=K.getPitchedTextCorrection(m,Je.add(new a.P(J[0],J[1])),ae),yi=Os(bt.point,nt,t,zt,m.angle,Rt),gn=v.allowVerticalPlacement&&Te.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Ai=0;Ai<Te.numGlyphs;Ai++)a.aj(Ee,yi,gn);Z&&Te.associatedIconIndex>=0&&(De[Te.associatedIconIndex]={shiftedAnchor:yi,angle:gn})}else ri(Te.numGlyphs,Ee)}if(Z){Oe.clear();const je=v.icon.placedSymbolArray;for(let Te=0;Te<je.length;Te++){const He=je.get(Te);if(He.hidden)ri(He.numGlyphs,Oe);else{const Je=De[Te];if(Je)for(let nt=0;nt<He.numGlyphs;nt++)a.aj(Oe,Je.shiftedAnchor,Je.angle);else ri(He.numGlyphs,Oe)}}v.icon.dynamicLayoutVertexBuffer.updateData(Oe)}v.text.dynamicLayoutVertexBuffer.updateData(Ee)}function Mr(v,t,u){return u.iconsInText&&t?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function dl(v,t,u,p,m,b,A,P,O,Z,K,J){const ae=v.context,_e=ae.gl,xe=v.transform,Ee=Rn(),Oe=P==="map",De=O==="map",je=P!=="viewport"&&u.layout.get("symbol-placement")!=="point",Te=Oe&&!De&&!je,He=!De&&je,Je=!u.layout.get("symbol-sort-key").isConstant();let nt=!1;const bt=v.depthModeForSublayer(0,Li.ReadOnly),Ct=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Dt=[],Nt=Ee.getCircleRadiusCorrection(xe);for(const Lt of p){const Mt=t.getTile(Lt),Jt=Mt.getBucket(u);if(!Jt)continue;const xi=m?Jt.text:Jt.icon;if(!xi||!xi.segments.get().length||!xi.hasVisibleVertices)continue;const zt=xi.programConfigurations.get(u.id),Rt=m||Jt.sdfIcons,yi=m?Jt.textSizeData:Jt.iconSizeData,gn=De||xe.pitch!==0,Ai=v.useProgram(Mr(Rt,m,Jt),zt),ji=a.ag(yi,xe.zoom),_n=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Lt);let sr,_s,yn,zr,xr=[0,0],or=null;if(m)_s=Mt.glyphAtlasTexture,yn=_e.LINEAR,sr=Mt.glyphAtlasTexture.size,Jt.iconsInText&&(xr=Mt.imageAtlasTexture.size,or=Mt.imageAtlasTexture,zr=gn||v.options.rotating||v.options.zooming||yi.kind==="composite"||yi.kind==="camera"?_e.LINEAR:_e.NEAREST);else{const Vi=u.layout.get("icon-size").constantOr(0)!==1||Jt.iconsNeedLinear;_s=Mt.imageAtlasTexture,yn=Rt||v.options.rotating||v.options.zooming||Vi||gn?_e.LINEAR:_e.NEAREST,sr=Mt.imageAtlasTexture.size}const kr=Si(Mt,1,v.transform.zoom),Bs=He?Lt.posMatrix:ns,Ua=Ir(Bs,De,Oe,v.transform,kr),yc=Ar(Bs,De,Oe,v.transform,kr),Va=Ar(Lt.posMatrix,De,Oe,v.transform,kr),ls=Ee.translatePosition(v.transform,Mt,b,A),bc=Ct&&Jt.hasTextData(),Mu=u.layout.get("icon-text-fit")!=="none"&&bc&&Jt.hasIconData();if(je){const Vi=v.style.map.terrain?(qa,Za)=>v.style.map.terrain.getElevation(Lt,qa,Za):null,sa=u.layout.get("text-rotation-alignment")==="map";me(Jt,Lt.posMatrix,v,m,Ua,Va,De,Z,sa,Ee,Lt.toUnwrapped(),xe.width,xe.height,ls,Vi)}const cs=Lt.posMatrix,us=m&&Ct||Mu,Eo=je||us?ns:Ua,ys=yc,tr=Rt&&u.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ar;ar=Rt?Jt.iconsInText?Sa(yi.kind,ji,Te,De,je,us,v,cs,Eo,ys,ls,sr,xr,Nt):Uo(yi.kind,ji,Te,De,je,us,v,cs,Eo,ys,ls,m,sr,!0,Nt):$l(yi.kind,ji,Te,De,je,us,v,cs,Eo,ys,ls,m,sr,Nt);const Xr={program:Ai,buffers:xi,uniformValues:ar,atlasTexture:_s,atlasTextureIcon:or,atlasInterpolation:yn,atlasInterpolationIcon:zr,isSDF:Rt,hasHalo:tr};if(Je&&Jt.canOverlap){nt=!0;const Vi=xi.segments.get();for(const sa of Vi)Dt.push({segments:new a.a0([sa]),sortKey:sa.sortKey,state:Xr,terrainData:_n})}else Dt.push({segments:xi.segments,sortKey:0,state:Xr,terrainData:_n})}nt&&Dt.sort((Lt,Mt)=>Lt.sortKey-Mt.sortKey);for(const Lt of Dt){const Mt=Lt.state;if(ae.activeTexture.set(_e.TEXTURE0),Mt.atlasTexture.bind(Mt.atlasInterpolation,_e.CLAMP_TO_EDGE),Mt.atlasTextureIcon&&(ae.activeTexture.set(_e.TEXTURE1),Mt.atlasTextureIcon&&Mt.atlasTextureIcon.bind(Mt.atlasInterpolationIcon,_e.CLAMP_TO_EDGE)),Mt.isSDF){const Jt=Mt.uniformValues;Mt.hasHalo&&(Jt.u_is_halo=1,io(Mt.buffers,Lt.segments,u,v,Mt.program,bt,K,J,Jt,Lt.terrainData)),Jt.u_is_halo=0}io(Mt.buffers,Lt.segments,u,v,Mt.program,bt,K,J,Mt.uniformValues,Lt.terrainData)}}function io(v,t,u,p,m,b,A,P,O,Z){const K=p.context;m.draw(K,K.gl.TRIANGLES,b,A,P,$i.disabled,O,Z,u.id,v.layoutVertexBuffer,v.indexBuffer,t,u.paint,p.transform.zoom,v.programConfigurations.get(u.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function ms(v,t,u,p){const m=v.context,b=m.gl,A=Qi.disabled,P=new Tn([b.ONE,b.ONE],a.aM.transparent,[!0,!0,!0,!0]),O=t.getBucket(u);if(!O)return;const Z=p.key;let K=u.heatmapFbos.get(Z);K||(K=Yo(m,t.tileSize,t.tileSize),u.heatmapFbos.set(Z,K)),m.bindFramebuffer.set(K.framebuffer),m.viewport.set([0,0,t.tileSize,t.tileSize]),m.clear({color:a.aM.transparent});const J=O.programConfigurations.get(u.id),ae=v.useProgram("heatmap",J),_e=v.style.map.terrain.getTerrainData(p);ae.draw(m,b.TRIANGLES,Li.disabled,A,P,$i.disabled,$n(p.posMatrix,t,v.transform.zoom,u.paint.get("heatmap-intensity")),_e,u.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,u.paint,v.transform.zoom,J)}function no(v,t,u){const p=v.context,m=p.gl;p.setColorMode(v.colorModeForRenderPass());const b=Qo(p,t),A=u.key,P=t.heatmapFbos.get(A);P&&(p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,P.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),b.bind(m.LINEAR,m.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(p,m.TRIANGLES,Li.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,go(v,t,0,1),null,t.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,t.paint,v.transform.zoom),P.destroy(),t.heatmapFbos.delete(A))}function Yo(v,t,u){var p,m;const b=v.gl,A=b.createTexture();b.bindTexture(b.TEXTURE_2D,A),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const P=(p=v.HALF_FLOAT)!==null&&p!==void 0?p:b.UNSIGNED_BYTE,O=(m=v.RGBA16F)!==null&&m!==void 0?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,O,t,u,0,b.RGBA,P,null);const Z=v.createFramebuffer(t,u,!1,!1);return Z.colorAttachment.set(A),Z}function Qo(v,t){return t.colorRampTexture||(t.colorRampTexture=new B(v,t.colorRamp,v.gl.RGBA)),t.colorRampTexture}function bo(v,t,u,p,m){if(!u||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let A=b[u.to.toString()],P=b[u.from.toString()];if(!A&&P&&(A=P),!P&&A&&(P=A),!A||!P){const O=m.getPaintProperty(t);A=b[O],P=b[O]}A&&P&&v.setConstantPatternPositions(A,P)}function $o(v,t,u,p,m,b,A){const P=v.context.gl,O="fill-pattern",Z=u.paint.get(O),K=Z&&Z.constantOr(1),J=u.getCrossfadeParameters();let ae,_e,xe,Ee,Oe;A?(_e=K&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ae=P.LINES):(_e=K?"fillPattern":"fill",ae=P.TRIANGLES);const De=Z.constantOr(null);for(const je of p){const Te=t.getTile(je);if(K&&!Te.patternsLoaded())continue;const He=Te.getBucket(u);if(!He)continue;const Je=He.programConfigurations.get(u.id),nt=v.useProgram(_e,Je),bt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(je);K&&(v.context.activeTexture.set(P.TEXTURE0),Te.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Je.updatePaintBuffers(J)),bo(Je,O,De,Te,u);const Ct=bt?je:null,Dt=v.translatePosMatrix(Ct?Ct.posMatrix:je.posMatrix,Te,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(A){Ee=He.indexBuffer2,Oe=He.segments2;const Nt=[P.drawingBufferWidth,P.drawingBufferHeight];xe=_e==="fillOutlinePattern"&&K?Hl(Dt,v,J,Te,Nt):au(Dt,Nt)}else Ee=He.indexBuffer,Oe=He.segments,xe=K?cl(Dt,v,J,Te):po(Dt);nt.draw(v.context,ae,m,v.stencilModeForClipping(je),b,$i.disabled,xe,bt,u.id,He.layoutVertexBuffer,Ee,Oe,u.paint,v.transform.zoom,Je)}}function Aa(v,t,u,p,m,b,A){const P=v.context,O=P.gl,Z="fill-extrusion-pattern",K=u.paint.get(Z),J=K.constantOr(1),ae=u.getCrossfadeParameters(),_e=u.paint.get("fill-extrusion-opacity"),xe=K.constantOr(null);for(const Ee of p){const Oe=t.getTile(Ee),De=Oe.getBucket(u);if(!De)continue;const je=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ee),Te=De.programConfigurations.get(u.id),He=v.useProgram(J?"fillExtrusionPattern":"fillExtrusion",Te);J&&(v.context.activeTexture.set(O.TEXTURE0),Oe.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Te.updatePaintBuffers(ae)),bo(Te,Z,xe,Oe,u);const Je=v.translatePosMatrix(Ee.posMatrix,Oe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),nt=u.paint.get("fill-extrusion-vertical-gradient"),bt=J?xa(Je,v,nt,_e,Ee,ae,Oe):As(Je,v,nt,_e);He.draw(P,P.gl.TRIANGLES,m,b,A,$i.backCCW,bt,je,u.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,u.paint,v.transform.zoom,Te,v.style.map.terrain&&De.centroidVertexBuffer)}}function vo(v,t,u,p,m,b,A){const P=v.context,O=P.gl,Z=u.fbo;if(!Z)return;const K=v.useProgram("hillshade"),J=v.style.map.terrain&&v.style.map.terrain.getTerrainData(t);P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,Z.colorAttachment.get()),K.draw(P,O.TRIANGLES,m,b,A,$i.disabled,((ae,_e,xe,Ee)=>{const Oe=xe.paint.get("hillshade-shadow-color"),De=xe.paint.get("hillshade-highlight-color"),je=xe.paint.get("hillshade-accent-color");let Te=xe.paint.get("hillshade-illumination-direction")*(Math.PI/180);xe.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=ae.transform.angle);const He=!ae.options.moving;return{u_matrix:Ee?Ee.posMatrix:ae.transform.calculatePosMatrix(_e.tileID.toUnwrapped(),He),u_image:0,u_latrange:er(0,_e.tileID),u_light:[xe.paint.get("hillshade-exaggeration"),Te],u_shadow:Oe,u_highlight:De,u_accent:je}})(v,u,p,J?t:null),J,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function wo(v,t,u,p,m,b){const A=v.context,P=A.gl,O=t.dem;if(O&&O.data){const Z=O.dim,K=O.stride,J=O.getPixels();if(A.activeTexture.set(P.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||v.getTileTexture(K),t.demTexture){const _e=t.demTexture;_e.update(J,{premultiply:!1}),_e.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else t.demTexture=new B(A,J,P.RGBA,{premultiply:!1}),t.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);A.activeTexture.set(P.TEXTURE0);let ae=t.fbo;if(!ae){const _e=new B(A,{width:Z,height:Z,data:null},P.RGBA);_e.bind(P.LINEAR,P.CLAMP_TO_EDGE),ae=t.fbo=A.createFramebuffer(Z,Z,!0,!1),ae.colorAttachment.set(_e.texture)}A.bindFramebuffer.set(ae.framebuffer),A.viewport.set([0,0,Z,Z]),v.useProgram("hillshadePrepare").draw(A,P.TRIANGLES,p,m,b,$i.disabled,((_e,xe)=>{const Ee=xe.stride,Oe=a.H();return a.aP(Oe,0,a.X,-a.X,0,0,1),a.J(Oe,Oe,[0,-a.X,0]),{u_matrix:Oe,u_image:1,u_dimension:[Ee,Ee],u_zoom:_e.overscaledZ,u_unpack:xe.getUnpackVector()}})(t.tileID,O),null,u.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function pl(v,t,u,p,m,b){const A=p.paint.get("raster-fade-duration");if(!b&&A>0){const P=y.now(),O=(P-v.timeAdded)/A,Z=t?(P-t.timeAdded)/A:-1,K=u.getSource(),J=m.coveringZoomLevel({tileSize:K.tileSize,roundZoom:K.roundZoom}),ae=!t||Math.abs(t.tileID.overscaledZ-J)>Math.abs(v.tileID.overscaledZ-J),_e=ae&&v.refreshedUponExpiration?1:a.ac(ae?O:1-Z,0,1);return v.refreshedUponExpiration&&O>=1&&(v.refreshedUponExpiration=!1),t?{opacity:1,mix:1-_e}:{opacity:_e,mix:0}}return{opacity:1,mix:0}}const ml=new a.aM(1,0,0,1),Wi=new a.aM(0,1,0,1),xo=new a.aM(0,0,1,1),hc=new a.aM(1,0,1,1),Ds=new a.aM(0,1,1,1);function ro(v,t,u,p){ea(v,0,t+u/2,v.transform.width,u,p)}function Ma(v,t,u,p){ea(v,t-u/2,0,u,v.transform.height,p)}function ea(v,t,u,p,m,b){const A=v.context,P=A.gl;P.enable(P.SCISSOR_TEST),P.scissor(t*v.pixelRatio,u*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),A.clear({color:b}),P.disable(P.SCISSOR_TEST)}function Pa(v,t,u){const p=v.context,m=p.gl,b=u.posMatrix,A=v.useProgram("debug"),P=Li.disabled,O=Qi.disabled,Z=v.colorModeForRenderPass(),K="$debug",J=v.style.map.terrain&&v.style.map.terrain.getTerrainData(u);p.activeTexture.set(m.TEXTURE0);const ae=t.getTileByID(u.key).latestRawTileData,_e=Math.floor((ae&&ae.byteLength||0)/1024),xe=t.getTile(u).tileSize,Ee=512/Math.min(xe,512)*(u.overscaledZ/v.transform.zoom)*.5;let Oe=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Oe+=` => ${u.overscaledZ}`),function(De,je){De.initDebugOverlayCanvas();const Te=De.debugOverlayCanvas,He=De.context.gl,Je=De.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Te.width,Te.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(je,5,5),Je.strokeText(je,5,5),De.debugOverlayTexture.update(Te),De.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(v,`${Oe} ${_e}kB`),A.draw(p,m.TRIANGLES,P,O,Tn.alphaBlended,$i.disabled,mo(b,a.aM.transparent,Ee),null,K,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),A.draw(p,m.LINE_STRIP,P,O,Z,$i.disabled,mo(b,a.aM.red),J,K,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function gl(v,t,u){const p=v.context,m=p.gl,b=v.colorModeForRenderPass(),A=new Li(m.LEQUAL,Li.ReadWrite,v.depthRangeFor3D),P=v.useProgram("terrain"),O=t.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,v.width,v.height]);for(const Z of u){const K=v.renderToTexture.getTexture(Z),J=t.getTerrainData(Z.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,K.texture);const ae=v.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),_e=t.getMeshFrameDelta(v.transform.zoom),xe=v.transform.calculateFogMatrix(Z.tileID.toUnwrapped()),Ee=wa(ae,_e,xe,v.style.sky,v.transform.pitch);P.draw(p,m.TRIANGLES,A,Qi.disabled,b,$i.backCCW,Ee,J,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}class ko{constructor(t,u,p){this.vertexBuffer=t,this.indexBuffer=u,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class La{constructor(t,u){this.context=new gu(t),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ii.maxUnderzooming+ii.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new al}resize(t,u,p){if(this.width=Math.floor(t*p),this.height=Math.floor(u*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,u=new a.aX;u.emplaceBack(0,0),u.emplaceBack(a.X,0),u.emplaceBack(0,a.X),u.emplaceBack(a.X,a.X),this.tileExtentBuffer=t.createVertexBuffer(u,Xs.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const p=new a.aX;p.emplaceBack(0,0),p.emplaceBack(a.X,0),p.emplaceBack(0,a.X),p.emplaceBack(a.X,a.X),this.debugBuffer=t.createVertexBuffer(p,Xs.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const m=new a.$;m.emplaceBack(0,0,0,0),m.emplaceBack(a.X,0,a.X,0),m.emplaceBack(0,a.X,0,a.X),m.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=t.createVertexBuffer(m,Y.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const b=new a.aX;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,Xs.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const A=new a.aZ;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(A);const P=new a.aY;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(P);const O=this.context.gl;this.stencilClearMode=new Qi({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)}clearStencil(){const t=this.context,u=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.H();a.aP(p,0,this.width,this.height,0,0,1),a.K(p,p,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,u.TRIANGLES,Li.disabled,this.stencilClearMode,Tn.disabled,$i.disabled,Vn(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,u){if(this.currentStencilSource===t.source||!t.isTileClipped()||!u||!u.length)return;this.currentStencilSource=t.source;const p=this.context,m=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(Tn.disabled),p.setDepthMode(Li.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of u){const P=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A);b.draw(p,m.TRIANGLES,Li.disabled,new Qi({func:m.ALWAYS,mask:0},P,255,m.KEEP,m.KEEP,m.REPLACE),Tn.disabled,$i.disabled,Vn(A.posMatrix),O,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,u=this.context.gl;return new Qi({func:u.NOTEQUAL,mask:255},t,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(t){const u=this.context.gl;return new Qi({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(t){const u=this.context.gl,p=t.sort((A,P)=>P.overscaledZ-A.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const A={};for(let P=0;P<b;P++)A[P+m]=new Qi({func:u.GEQUAL,mask:255},P+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[A,p]}return[{[m]:Qi.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Tn([t.CONSTANT_COLOR,t.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tn.unblended:Tn.alphaBlended}depthModeForSublayer(t,u,p){if(!this.opaquePassEnabledForLayer())return Li.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Li(p||this.context.gl.LEQUAL,u,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,u){this.style=t,this.options=u,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},A={},P={};for(const O in m){const Z=m[O];Z.used&&Z.prepare(this.context),b[O]=Z.getVisibleCoordinates(),A[O]=b[O].slice().reverse(),P[O]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<p.length;O++)if(this.style._layers[p[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const O of p){const Z=this.style._layers[O];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const K=A[Z.source];(Z.type==="custom"||K.length)&&this.renderLayer(this,m[Z.source],Z,K)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(O,Z){const K=O.context,J=K.gl,ae=((De,je,Te)=>({u_sky_color:De.properties.get("sky-color"),u_horizon_color:De.properties.get("horizon-color"),u_horizon:(je.height/2+je.getHorizon())*Te,u_sky_horizon_blend:De.properties.get("sky-horizon-blend")*je.height/2*Te}))(Z,O.style.map.transform,O.pixelRatio),_e=new Li(J.LEQUAL,Li.ReadWrite,[0,1]),xe=Qi.disabled,Ee=O.colorModeForRenderPass(),Oe=O.useProgram("sky");if(!Z.mesh){const De=new a.aX;De.emplaceBack(-1,-1),De.emplaceBack(1,-1),De.emplaceBack(1,1),De.emplaceBack(-1,1);const je=new a.aY;je.emplaceBack(0,1,2),je.emplaceBack(0,2,3),Z.mesh=new ko(K.createVertexBuffer(De,Xs.members),K.createIndexBuffer(je),a.a0.simpleSegment(0,0,De.length,je.length))}Oe.draw(K,J.TRIANGLES,_e,xe,Ee,$i.disabled,ae,void 0,"sky",Z.mesh.vertexBuffer,Z.mesh.indexBuffer,Z.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[p[this.currentLayer]],Z=m[O.source],K=b[O.source];this._renderTileClippingMasks(O,K),this.renderLayer(this,Z,O,K)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const O=this.style._layers[p[this.currentLayer]],Z=m[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O))continue;const K=(O.type==="symbol"?P:A)[O.source];this._renderTileClippingMasks(O,b[O.source]),this.renderLayer(this,Z,O,K)}if(this.options.showTileBoundaries){const O=function(Z,K){let J=null;const ae=Object.values(Z._layers).flatMap(Oe=>Oe.source&&!Oe.isHidden(K)?[Z.sourceCaches[Oe.source]]:[]),_e=ae.filter(Oe=>Oe.getSource().type==="vector"),xe=ae.filter(Oe=>Oe.getSource().type!=="vector"),Ee=Oe=>{(!J||J.getSource().maxzoom<Oe.getSource().maxzoom)&&(J=Oe)};return _e.forEach(Oe=>Ee(Oe)),J||xe.forEach(Oe=>Ee(Oe)),J}(this.style,this.transform.zoom);O&&function(Z,K,J){for(let ae=0;ae<J.length;ae++)Pa(Z,K,J[ae])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const Z=O.transform.padding;ro(O,O.transform.height-(Z.top||0),3,ml),ro(O,Z.bottom||0,3,Wi),Ma(O,Z.left||0,3,xo),Ma(O,O.transform.width-(Z.right||0),3,hc);const K=O.transform.centerPoint;(function(J,ae,_e,xe){ea(J,ae-1,_e-10,2,20,xe),ea(J,ae-10,_e-1,20,2,xe)})(O,K.x,O.transform.height-K.y,Ds)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=t?!a.a_(u,p):!a.a$(u,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.b0(u,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,A){const P=b.context,O=P.gl,Z=Tn.unblended,K=new Li(O.LEQUAL,Li.ReadWrite,[0,1]),J=A.getTerrainMesh(),ae=A.sourceCache.getRenderableTiles(),_e=b.useProgram("terrainDepth");P.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),P.clear({color:a.aM.transparent,depth:1});for(const xe of ae){const Ee=A.getTerrainData(xe.tileID),Oe={u_matrix:b.transform.calculatePosMatrix(xe.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(b.transform.zoom)};_e.draw(P,O.TRIANGLES,K,Qi.disabled,Z,$i.backCCW,Oe,Ee,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,A){const P=b.context,O=P.gl,Z=Tn.unblended,K=new Li(O.LEQUAL,Li.ReadWrite,[0,1]),J=A.getTerrainMesh(),ae=A.getCoordsTexture(),_e=A.sourceCache.getRenderableTiles(),xe=b.useProgram("terrainCoords");P.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),P.clear({color:a.aM.transparent,depth:1}),A.coordsIndex=[];for(const Ee of _e){const Oe=A.getTerrainData(Ee.tileID);P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,ae.texture);const De={u_matrix:b.transform.calculatePosMatrix(Ee.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(b.transform.zoom)};xe.draw(P,O.TRIANGLES,K,Qi.disabled,Z,$i.backCCW,De,Oe,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),A.coordsIndex.push(Ee.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(t,u,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,A,P,O,Z){if(b.renderPass!=="translucent")return;const K=Qi.disabled,J=b.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ae,_e,xe,Ee,Oe,De,je,Te,He){const Je=_e.transform,nt=Rn(),bt=Oe==="map",Ct=De==="map";for(const Dt of ae){const Nt=Ee.getTile(Dt),Lt=Nt.getBucket(xe);if(!Lt||!Lt.text||!Lt.text.segments.get().length)continue;const Mt=a.ag(Lt.textSizeData,Je.zoom),Jt=Si(Nt,1,_e.transform.zoom),xi=Ir(Dt.posMatrix,Ct,bt,_e.transform,Jt),zt=xe.layout.get("icon-text-fit")!=="none"&&Lt.hasIconData();if(Mt){const Rt=Math.pow(2,Je.zoom-Nt.tileID.overscaledZ),yi=_e.style.map.terrain?(Ai,ji)=>_e.style.map.terrain.getElevation(Dt,Ai,ji):null,gn=nt.translatePosition(Je,Nt,je,Te);yo(Lt,bt,Ct,He,Je,xi,Dt.posMatrix,Rt,Mt,zt,nt,gn,Dt.toUnwrapped(),yi)}}}(O,b,P,A,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),Z),P.paint.get("icon-opacity").constantOr(1)!==0&&dl(b,A,P,O,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),K,J),P.paint.get("text-opacity").constantOr(1)!==0&&dl(b,A,P,O,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),K,J),A.map.showCollisionBoxes&&(Ko(b,A,P,O,!0),Ko(b,A,P,O,!1))})(t,u,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,A,P,O){if(b.renderPass!=="translucent")return;const Z=P.paint.get("circle-opacity"),K=P.paint.get("circle-stroke-width"),J=P.paint.get("circle-stroke-opacity"),ae=!P.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(K.constantOr(1)===0||J.constantOr(1)===0))return;const _e=b.context,xe=_e.gl,Ee=b.depthModeForSublayer(0,Li.ReadOnly),Oe=Qi.disabled,De=b.colorModeForRenderPass(),je=[];for(let Te=0;Te<O.length;Te++){const He=O[Te],Je=A.getTile(He),nt=Je.getBucket(P);if(!nt)continue;const bt=nt.programConfigurations.get(P.id),Ct=b.useProgram("circle",bt),Dt=nt.layoutVertexBuffer,Nt=nt.indexBuffer,Lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),Mt={programConfiguration:bt,program:Ct,layoutVertexBuffer:Dt,indexBuffer:Nt,uniformValues:Xl(b,He,Je,P),terrainData:Lt};if(ae){const Jt=nt.segments.get();for(const xi of Jt)je.push({segments:new a.a0([xi]),sortKey:xi.sortKey,state:Mt})}else je.push({segments:nt.segments,sortKey:0,state:Mt})}ae&&je.sort((Te,He)=>Te.sortKey-He.sortKey);for(const Te of je){const{programConfiguration:He,program:Je,layoutVertexBuffer:nt,indexBuffer:bt,uniformValues:Ct,terrainData:Dt}=Te.state;Je.draw(_e,xe.TRIANGLES,Ee,Oe,De,$i.disabled,Ct,Dt,P.id,nt,bt,Te.segments,P.paint,b.transform.zoom,He)}})(t,u,p,m);break;case"heatmap":(function(b,A,P,O){if(P.paint.get("heatmap-opacity")===0)return;const Z=b.context;if(b.style.map.terrain){for(const K of O){const J=A.getTile(K);A.hasRenderableParent(K)||(b.renderPass==="offscreen"?ms(b,J,P,K):b.renderPass==="translucent"&&no(b,P,K))}Z.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(K,J,ae,_e){const xe=K.context,Ee=xe.gl,Oe=Qi.disabled,De=new Tn([Ee.ONE,Ee.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function(je,Te,He){const Je=je.gl;je.activeTexture.set(Je.TEXTURE1),je.viewport.set([0,0,Te.width/4,Te.height/4]);let nt=He.heatmapFbos.get(a.aU);nt?(Je.bindTexture(Je.TEXTURE_2D,nt.colorAttachment.get()),je.bindFramebuffer.set(nt.framebuffer)):(nt=Yo(je,Te.width/4,Te.height/4),He.heatmapFbos.set(a.aU,nt))})(xe,K,ae),xe.clear({color:a.aM.transparent});for(let je=0;je<_e.length;je++){const Te=_e[je];if(J.hasRenderableParent(Te))continue;const He=J.getTile(Te),Je=He.getBucket(ae);if(!Je)continue;const nt=Je.programConfigurations.get(ae.id),bt=K.useProgram("heatmap",nt),{zoom:Ct}=K.transform;bt.draw(xe,Ee.TRIANGLES,Li.disabled,Oe,De,$i.disabled,$n(Te.posMatrix,He,Ct,ae.paint.get("heatmap-intensity")),null,ae.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,ae.paint,K.transform.zoom,nt)}xe.viewport.set([0,0,K.width,K.height])}(b,A,P,O):b.renderPass==="translucent"&&function(K,J){const ae=K.context,_e=ae.gl;ae.setColorMode(K.colorModeForRenderPass());const xe=J.heatmapFbos.get(a.aU);xe&&(ae.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,xe.colorAttachment.get()),ae.activeTexture.set(_e.TEXTURE1),Qo(ae,J).bind(_e.LINEAR,_e.CLAMP_TO_EDGE),K.useProgram("heatmapTexture").draw(ae,_e.TRIANGLES,Li.disabled,Qi.disabled,K.colorModeForRenderPass(),$i.disabled,go(K,J,0,1),null,J.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments,J.paint,K.transform.zoom))}(b,P)})(t,u,p,m);break;case"line":(function(b,A,P,O){if(b.renderPass!=="translucent")return;const Z=P.paint.get("line-opacity"),K=P.paint.get("line-width");if(Z.constantOr(1)===0||K.constantOr(1)===0)return;const J=b.depthModeForSublayer(0,Li.ReadOnly),ae=b.colorModeForRenderPass(),_e=P.paint.get("line-dasharray"),xe=P.paint.get("line-pattern"),Ee=xe.constantOr(1),Oe=P.paint.get("line-gradient"),De=P.getCrossfadeParameters(),je=Ee?"linePattern":_e?"lineSDF":Oe?"lineGradient":"line",Te=b.context,He=Te.gl;let Je=!0;for(const nt of O){const bt=A.getTile(nt);if(Ee&&!bt.patternsLoaded())continue;const Ct=bt.getBucket(P);if(!Ct)continue;const Dt=Ct.programConfigurations.get(P.id),Nt=b.context.program.get(),Lt=b.useProgram(je,Dt),Mt=Je||Lt.program!==Nt,Jt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(nt),xi=xe.constantOr(null);if(xi&&bt.imageAtlas){const yi=bt.imageAtlas,gn=yi.patternPositions[xi.to.toString()],Ai=yi.patternPositions[xi.from.toString()];gn&&Ai&&Dt.setConstantPatternPositions(gn,Ai)}const zt=Jt?nt:null,Rt=Ee?Ks(b,bt,P,De,zt):_e?Jl(b,bt,P,_e,De,zt):Oe?Kl(b,bt,P,Ct.lineClipsArray.length,zt):ka(b,bt,P,zt);if(Ee)Te.activeTexture.set(He.TEXTURE0),bt.imageAtlasTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE),Dt.updatePaintBuffers(De);else if(_e&&(Mt||b.lineAtlas.dirty))Te.activeTexture.set(He.TEXTURE0),b.lineAtlas.bind(Te);else if(Oe){const yi=Ct.gradients[P.id];let gn=yi.texture;if(P.gradientVersion!==yi.version){let Ai=256;if(P.stepInterpolant){const ji=A.getSource().maxzoom,_n=nt.canonical.z===ji?Math.ceil(1<<b.transform.maxZoom-nt.canonical.z):1;Ai=a.ac(a.aV(Ct.maxLineLength/a.X*1024*_n),256,Te.maxTextureSize)}yi.gradient=a.aW({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:Ai,image:yi.gradient||void 0,clips:Ct.lineClipsArray}),yi.texture?yi.texture.update(yi.gradient):yi.texture=new B(Te,yi.gradient,He.RGBA),yi.version=P.gradientVersion,gn=yi.texture}Te.activeTexture.set(He.TEXTURE0),gn.bind(P.stepInterpolant?He.NEAREST:He.LINEAR,He.CLAMP_TO_EDGE)}Lt.draw(Te,He.TRIANGLES,J,b.stencilModeForClipping(nt),ae,$i.disabled,Rt,Jt,P.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,P.paint,b.transform.zoom,Dt,Ct.layoutVertexBuffer2),Je=!1}})(t,u,p,m);break;case"fill":(function(b,A,P,O){const Z=P.paint.get("fill-color"),K=P.paint.get("fill-opacity");if(K.constantOr(1)===0)return;const J=b.colorModeForRenderPass(),ae=P.paint.get("fill-pattern"),_e=b.opaquePassEnabledForLayer()&&!ae.constantOr(1)&&Z.constantOr(a.aM.transparent).a===1&&K.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===_e){const xe=b.depthModeForSublayer(1,b.renderPass==="opaque"?Li.ReadWrite:Li.ReadOnly);$o(b,A,P,O,xe,J,!1)}if(b.renderPass==="translucent"&&P.paint.get("fill-antialias")){const xe=b.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Li.ReadOnly);$o(b,A,P,O,xe,J,!0)}})(t,u,p,m);break;case"fill-extrusion":(function(b,A,P,O){const Z=P.paint.get("fill-extrusion-opacity");if(Z!==0&&b.renderPass==="translucent"){const K=new Li(b.context.gl.LEQUAL,Li.ReadWrite,b.depthRangeFor3D);if(Z!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Aa(b,A,P,O,K,Qi.disabled,Tn.disabled),Aa(b,A,P,O,K,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const J=b.colorModeForRenderPass();Aa(b,A,P,O,K,Qi.disabled,J)}}})(t,u,p,m);break;case"hillshade":(function(b,A,P,O){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const Z=b.context,K=b.depthModeForSublayer(0,Li.ReadOnly),J=b.colorModeForRenderPass(),[ae,_e]=b.renderPass==="translucent"?b.stencilConfigForOverlap(O):[{},O];for(const xe of _e){const Ee=A.getTile(xe);Ee.needsHillshadePrepare!==void 0&&Ee.needsHillshadePrepare&&b.renderPass==="offscreen"?wo(b,Ee,P,K,Qi.disabled,J):b.renderPass==="translucent"&&vo(b,xe,Ee,P,K,ae[xe.overscaledZ],J)}Z.viewport.set([0,0,b.width,b.height])})(t,u,p,m);break;case"raster":(function(b,A,P,O){if(b.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!O.length)return;const Z=b.context,K=Z.gl,J=A.getSource(),ae=b.useProgram("raster"),_e=b.colorModeForRenderPass(),[xe,Ee]=J instanceof Ae?[{},O]:b.stencilConfigForOverlap(O),Oe=Ee[Ee.length-1].overscaledZ,De=!b.options.moving;for(const je of Ee){const Te=b.depthModeForSublayer(je.overscaledZ-Oe,P.paint.get("raster-opacity")===1?Li.ReadWrite:Li.ReadOnly,K.LESS),He=A.getTile(je);He.registerFadeDuration(P.paint.get("raster-fade-duration"));const Je=A.findLoadedParent(je,0),nt=A.findLoadedSibling(je),bt=pl(He,Je||nt||null,A,P,b.transform,b.style.map.terrain);let Ct,Dt;const Nt=P.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR;Z.activeTexture.set(K.TEXTURE0),He.texture.bind(Nt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(K.TEXTURE1),Je?(Je.texture.bind(Nt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),Ct=Math.pow(2,Je.tileID.overscaledZ-He.tileID.overscaledZ),Dt=[He.tileID.canonical.x*Ct%1,He.tileID.canonical.y*Ct%1]):He.texture.bind(Nt,K.CLAMP_TO_EDGE,K.LINEAR_MIPMAP_NEAREST),He.texture.useMipmap&&Z.extTextureFilterAnisotropic&&b.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const Lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(je),Mt=Lt?je:null,Jt=Mt?Mt.posMatrix:b.transform.calculatePosMatrix(je.toUnwrapped(),De),xi=lu(Jt,Dt||[0,0],Ct||1,bt,P);J instanceof Ae?ae.draw(Z,K.TRIANGLES,Te,Qi.disabled,_e,$i.disabled,xi,Lt,P.id,J.boundsBuffer,b.quadTriangleIndexBuffer,J.boundsSegments):ae.draw(Z,K.TRIANGLES,Te,xe[je.overscaledZ],_e,$i.disabled,xi,Lt,P.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(t,u,p,m);break;case"background":(function(b,A,P,O){const Z=P.paint.get("background-color"),K=P.paint.get("background-opacity");if(K===0)return;const J=b.context,ae=J.gl,_e=b.transform,xe=_e.tileSize,Ee=P.paint.get("background-pattern");if(b.isPatternMissing(Ee))return;const Oe=!Ee&&Z.a===1&&K===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==Oe)return;const De=Qi.disabled,je=b.depthModeForSublayer(0,Oe==="opaque"?Li.ReadWrite:Li.ReadOnly),Te=b.colorModeForRenderPass(),He=b.useProgram(Ee?"backgroundPattern":"background"),Je=O||_e.coveringTiles({tileSize:xe,terrain:b.style.map.terrain});Ee&&(J.activeTexture.set(ae.TEXTURE0),b.imageManager.bind(b.context));const nt=P.getCrossfadeParameters();for(const bt of Je){const Ct=O?bt.posMatrix:b.transform.calculatePosMatrix(bt.toUnwrapped()),Dt=Ee?qo(Ct,K,b,Ee,{tileID:bt,tileSize:xe},nt):Vo(Ct,K,Z),Nt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(bt);He.draw(J,ae.TRIANGLES,je,De,Te,$i.disabled,Dt,Nt,P.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(t,0,p,m);break;case"custom":(function(b,A,P){const O=b.context,Z=P.implementation;if(b.renderPass==="offscreen"){const K=Z.prerender;K&&(b.setCustomLayerDefaults(),O.setColorMode(b.colorModeForRenderPass()),K.call(Z,O.gl,b.transform.customLayerMatrix()),O.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),O.setColorMode(b.colorModeForRenderPass()),O.setStencilMode(Qi.disabled);const K=Z.renderingMode==="3d"?new Li(b.context.gl.LEQUAL,Li.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Li.ReadOnly);O.setDepthMode(K),Z.render(O.gl,b.transform.customLayerMatrix(),{farZ:b.transform.farZ,nearZ:b.transform.nearZ,fov:b.transform._fov,modelViewProjectionMatrix:b.transform.modelViewProjectionMatrix,projectionMatrix:b.transform.projectionMatrix}),O.setDirty(),b.setBaseState(),O.bindFramebuffer.set(null)}})(t,0,p)}}translatePosMatrix(t,u,p,m,b){if(!p[0]&&!p[1])return t;const A=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(A){const Z=Math.sin(A),K=Math.cos(A);p=[p[0]*K-p[1]*Z,p[0]*Z+p[1]*K]}const P=[b?p[0]:Si(u,p[0],this.transform.zoom),b?p[1]:Si(u,p[1],this.transform.zoom),0],O=new Float32Array(16);return a.J(O,t,P),O}saveTileTexture(t){const u=this._tileTextures[t.size[0]];u?u.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const u=this._tileTextures[t];return u&&u.length>0?u.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const u=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!u||!p}useProgram(t,u){this.cache=this.cache||{};const p=t+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new ll(this.context,Bn[t],u,ul[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new B(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:u}=this.context.gl;return this.width!==t||this.height!==u}}class Pr{constructor(t,u){this.points=t,this.planes=u}static fromInvProjectionMatrix(t,u,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const O=1/(P=a.af([],P,t))[3]/u*m;return a.b1(P,P,[O,O,1/P[3],O])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const O=function(ae,_e){var xe=_e[0],Ee=_e[1],Oe=_e[2],De=xe*xe+Ee*Ee+Oe*Oe;return De>0&&(De=1/Math.sqrt(De)),ae[0]=_e[0]*De,ae[1]=_e[1]*De,ae[2]=_e[2]*De,ae}([],function(ae,_e,xe){var Ee=_e[0],Oe=_e[1],De=_e[2],je=xe[0],Te=xe[1],He=xe[2];return ae[0]=Oe*He-De*Te,ae[1]=De*je-Ee*He,ae[2]=Ee*Te-Oe*je,ae}([],ne([],b[P[0]],b[P[1]]),ne([],b[P[2]],b[P[1]]))),Z=-((K=O)[0]*(J=b[P[1]])[0]+K[1]*J[1]+K[2]*J[2]);var K,J;return O.concat(Z)});return new Pr(b,A)}}class br{constructor(t,u){this.min=t,this.max=u,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(t){const u=[t%2==0,t<2],p=oe(this.min),m=oe(this.max);for(let b=0;b<u.length;b++)p[b]=u[b]?this.min[b]:this.center[b],m[b]=u[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new br(p,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<t.planes.length;m++){const b=t.planes[m];let A=0;for(let P=0;P<u.length;P++)a.b2(b,u[P])>=0&&A++;if(A===0)return 0;A!==u.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let P=0;P<t.points.length;P++){const O=t.points[P][m]-this.min[m];b=Math.min(b,O),A=Math.max(A,O)}if(A<0||b>this.max[m]-this.min[m])return 0}return 1}}class So{constructor(t=0,u=0,p=0,m=0){if(isNaN(t)||t<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=u,this.left=p,this.right=m}interpolate(t,u,p){return u.top!=null&&t.top!=null&&(this.top=a.y.number(t.top,u.top,p)),u.bottom!=null&&t.bottom!=null&&(this.bottom=a.y.number(t.bottom,u.bottom,p)),u.left!=null&&t.left!=null&&(this.left=a.y.number(t.left,u.left,p)),u.right!=null&&t.right!=null&&(this.right=a.y.number(t.right,u.right,p)),this}getCenter(t,u){const p=a.ac((this.left+t-this.right)/2,0,t),m=a.ac((this.top+u-this.bottom)/2,0,u);return new a.P(p,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new So(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const _l=85.051129;class To{constructor(t,u,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=t||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new So,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new To(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const u=-a.b3(t,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var A=m[0],P=m[1],O=m[2],Z=m[3],K=Math.sin(b),J=Math.cos(b);p[0]=A*J+O*K,p[1]=P*J+Z*K,p[2]=A*-K+O*J,p[3]=P*-K+Z*J}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const u=a.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const u=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.tileZoom=Math.max(0,Math.floor(u)),this.scale=this.zoomScale(u),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,u,p){this._unmodified=!1,this._edgeInsets.interpolate(t,u,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const u=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(t){const u=[new a.b4(0,t)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),A=this.pointCoordinate(new a.P(0,this.height)),P=Math.floor(Math.min(p.x,m.x,b.x,A.x)),O=Math.floor(Math.max(p.x,m.x,b.x,A.x)),Z=1;for(let K=P-Z;K<=O+Z;K++)K!==0&&u.push(new a.b4(K,t))}return u}coveringTiles(t){var u,p;let m=this.coveringZoomLevel(t);const b=m;if(t.minzoom!==void 0&&m<t.minzoom)return[];t.maxzoom!==void 0&&m>t.maxzoom&&(m=t.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),P=a.Z.fromLngLat(this.center),O=Math.pow(2,m),Z=[O*A.x,O*A.y,0],K=[O*P.x,O*P.y,0],J=Pr.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let ae=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ae=m);const _e=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,xe=Te=>({aabb:new br([Te*O,0,0],[(Te+1)*O,O,0]),zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),Ee=[],Oe=[],De=m,je=t.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let Te=1;Te<=3;Te++)Ee.push(xe(-Te)),Ee.push(xe(Te));for(Ee.push(xe(0));Ee.length>0;){const Te=Ee.pop(),He=Te.x,Je=Te.y;let nt=Te.fullyVisible;if(!nt){const Lt=Te.aabb.intersects(J);if(Lt===0)continue;nt=Lt===2}const bt=t.terrain?Z:K,Ct=Te.aabb.distanceX(bt),Dt=Te.aabb.distanceY(bt),Nt=Math.max(Math.abs(Ct),Math.abs(Dt));if(Te.zoom===De||Nt>_e+(1<<De-Te.zoom)-2&&Te.zoom>=ae){const Lt=De-Te.zoom,Mt=Z[0]-.5-(He<<Lt),Jt=Z[1]-.5-(Je<<Lt);Oe.push({tileID:new a.S(Te.zoom===De?je:Te.zoom,Te.wrap,Te.zoom,He,Je),distanceSq:j([K[0]-.5-He,K[1]-.5-Je]),tileDistanceToCamera:Math.sqrt(Mt*Mt+Jt*Jt)})}else for(let Lt=0;Lt<4;Lt++){const Mt=(He<<1)+Lt%2,Jt=(Je<<1)+(Lt>>1),xi=Te.zoom+1;let zt=Te.aabb.quadrant(Lt);if(t.terrain){const Rt=new a.S(xi,Te.wrap,xi,Mt,Jt),yi=t.terrain.getMinMaxElevation(Rt),gn=(u=yi.minElevation)!==null&&u!==void 0?u:this.elevation,Ai=(p=yi.maxElevation)!==null&&p!==void 0?p:this.elevation;zt=new br([zt.min[0],zt.min[1],gn],[zt.max[0],zt.max[1],Ai])}Ee.push({aabb:zt,zoom:xi,x:Mt,y:Jt,wrap:Te.wrap,fullyVisible:nt})}}return Oe.sort((Te,He)=>Te.distanceSq-He.distanceSq).map(Te=>Te.tileID)}resize(t,u){this.width=t,this.height=u,this.pixelsToGLUnits=[2/t,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const u=a.ac(t.lat,-85.051129,_l);return new a.P(a.O(t.lng)*this.worldSize,a.Q(u)*this.worldSize)}unproject(t){return new a.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const u=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,t),b=t.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const A=p+u-b,P=Math.cos(this._pitch)*this.cameraToCenterDistance/A/a.b5(1,m.lat),O=this.scaleZoom(P/this.tileSize);this._elevation=b,this._center=m,this.zoom=O}setLocationAtPoint(t,u){const p=this.pointCoordinate(u),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(t),A=new a.Z(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,u){return u?this.coordinatePoint(this.locationCoordinate(t),u.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,u){return this.coordinateLocation(this.pointCoordinate(t,u))}locationCoordinate(t){return a.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,u){if(u){const ae=u.pointCoordinate(t);if(ae!=null)return ae}const p=[t.x,t.y,0,1],m=[t.x,t.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const b=p[3],A=m[3],P=p[1]/b,O=m[1]/A,Z=p[2]/b,K=m[2]/A,J=Z===K?0:(0-Z)/(K-Z);return new a.Z(a.y.number(p[0]/b,m[0]/A,J)/this.worldSize,a.y.number(P,O,J)/this.worldSize)}coordinatePoint(t,u=0,p=this.pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,u,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Qe().extend(this.pointLocation(new a.P(0,t))).extend(this.pointLocation(new a.P(this.width,t))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Qe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,_l])}calculateTileMatrix(t){const u=t.canonical,p=this.worldSize/this.zoomScale(u.z),m=u.x+Math.pow(2,u.z)*t.wrap,b=a.an(new Float64Array(16));return a.J(b,b,[m*p,u.y*p,0]),a.K(b,b,[p/a.X,p/a.X,1]),b}calculatePosMatrix(t,u=!1){const p=t.key,m=u?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=this.calculateTileMatrix(t);return a.L(b,u?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,b),m[p]=new Float32Array(b),m[p]}calculateFogMatrix(t){const u=t.key,p=this._fogMatrixCache;if(p[u])return p[u];const m=this.calculateTileMatrix(t);return a.L(m,this.fogMatrix,m),p[u]=new Float32Array(m),p[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,u){u=a.ac(+u,this.minZoom,this.maxZoom);const p={center:new a.N(t.lng,t.lat),zoom:u};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const Te=179.9999999999;m=[-Te,Te]}const b=this.tileSize*this.zoomScale(p.zoom);let A=0,P=b,O=0,Z=b,K=0,J=0;const{x:ae,y:_e}=this.size;if(this.latRange){const Te=this.latRange;A=a.Q(Te[1])*b,P=a.Q(Te[0])*b,P-A<_e&&(K=_e/(P-A))}m&&(O=a.b3(a.O(m[0])*b,0,b),Z=a.b3(a.O(m[1])*b,0,b),Z<O&&(Z+=b),Z-O<ae&&(J=ae/(Z-O)));const{x:xe,y:Ee}=this.project.call({worldSize:b},t);let Oe,De;const je=Math.max(J||0,K||0);if(je){const Te=new a.P(J?(Z+O)/2:xe,K?(P+A)/2:Ee);return p.center=this.unproject.call({worldSize:b},Te).wrap(),p.zoom+=this.scaleZoom(je),p}if(this.latRange){const Te=_e/2;Ee-Te<A&&(De=A+Te),Ee+Te>P&&(De=P-Te)}if(m){const Te=(O+Z)/2;let He=xe;this._renderWorldCopies&&(He=a.b3(xe,Te-b/2,Te+b/2));const Je=ae/2;He-Je<O&&(Oe=O+Je),He+Je>Z&&(Oe=Z-Je)}if(Oe!==void 0||De!==void 0){const Te=new a.P(Oe??xe,De??Ee);p.center=this.unproject.call({worldSize:b},Te).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:u,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=u,this.zoom=p,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,u=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.K(m,m,[this.width/2,-this.height/2,1]),a.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.K(m,m,[1,-1,1]),a.J(m,m,[-1,-1,0]),a.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),A=Math.min(this.elevation,this.minElevationForCurrentTile),P=b-A*this._pixelPerMeter/Math.cos(this._pitch),O=A<0?P:b,Z=Math.PI/2+this._pitch,K=this._fov*(.5+t.y/this.height),J=Math.sin(K)*O/Math.sin(a.ac(Math.PI-Z-K,.01,Math.PI-.01)),ae=this.getHorizon(),_e=2*Math.atan(ae/this.cameraToCenterDistance)*(.5+t.y/(2*ae)),xe=Math.sin(_e)*O/Math.sin(a.ac(Math.PI-Z-_e,.01,Math.PI-.01)),Ee=Math.min(J,xe);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Ee+O),this.nearZ=this.height/50,m=new Float64Array(16),a.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-t.x/this.width,m[9]=2*t.y/this.height,this.projectionMatrix=a.ae(m),a.K(m,m,[1,-1,1]),a.J(m,m,[0,0,-this.cameraToCenterDistance]),a.b7(m,m,this._pitch),a.ad(m,m,this.angle),a.J(m,m,[-u,-p,0]),this.mercatorMatrix=a.K([],m,[this.worldSize,this.worldSize,this.worldSize]),a.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,m),a.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=a.as([],m),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,b,this.farZ),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-u,-p,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,m);const Oe=this.width%2/2,De=this.height%2/2,je=Math.cos(this.angle),Te=Math.sin(this.angle),He=u-Math.round(u)+je*Oe+Te*De,Je=p-Math.round(p)+je*De+Te*Oe,nt=new Float64Array(m);if(a.J(nt,nt,[He>.5?He-1:He,Je>.5?Je-1:Je,0]),this.alignedModelViewProjectionMatrix=nt,m=a.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.P(0,0)),u=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.af(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,t))}getCameraQueryGeometry(t){const u=this.getCameraPoint();if(t.length===1)return[t[0],u];{let p=u.x,m=u.y,b=u.x,A=u.y;for(const P of t)p=Math.min(p,P.x),m=Math.min(m,P.y),b=Math.max(b,P.x),A=Math.max(A,P.y);return[new a.P(p,m),new a.P(b,m),new a.P(b,A),new a.P(p,A),new a.P(p,m)]}}lngLatToCameraDepth(t,u){const p=this.locationCoordinate(t),m=[p.x*this.worldSize,p.y*this.worldSize,u,1];return a.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function ta(v,t){let u,p=!1,m=null,b=null;const A=()=>{m=null,p&&(v.apply(b,u),m=setTimeout(A,t),p=!1)};return(...P)=>(p=!0,b=this,u=P,m||A(),m)}class za{constructor(t){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(u.length>=3&&!u.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(u.length===0)return;const p=u.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let A=window.location.href.replace(/(#.+)?$/,b);A=A.replace("&&","&"),window.history.replaceState(window.history.state,null,A)},this._updateHash=ta(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const u=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),A=Math.round(u.lng*b)/b,P=Math.round(u.lat*b)/b,O=this._map.getBearing(),Z=this._map.getPitch();let K="";if(K+=t?`/${A}/${P}/${p}`:`${p}/${P}/${A}`,(O||Z)&&(K+="/"+Math.round(10*O)/10),Z&&(K+=`/${Math.round(Z)}`),this._hashName){const J=this._hashName;let ae=!1;const _e=window.location.hash.slice(1).split("&").map(xe=>{const Ee=xe.split("=")[0];return Ee===J?(ae=!0,`${Ee}=${K}`):xe}).filter(xe=>xe);return ae||_e.push(`${J}=${K}`),`#${_e.join("&")}`}return`#${K}`}}const Oa={linearity:.3,easing:a.b8(0,0,.3,1)},yl=a.e({deceleration:2500,maxSpeed:1400},Oa),_u=a.e({deceleration:20,maxSpeed:1400},Oa),bl=a.e({deceleration:1e3,maxSpeed:360},Oa),so=a.e({deceleration:1e3,maxSpeed:90},Oa);class Co{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,u=y.now();for(;t.length>0&&u-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(u.pan.mag()){const b=na(u.pan.mag(),p,a.e({},yl,t||{}));m.offset=u.pan.mult(b.amount/u.pan.mag()),m.center=this._map.transform.center,ia(m,b)}if(u.zoom){const b=na(u.zoom,p,_u);m.zoom=this._map.transform.zoom+b.amount,ia(m,b)}if(u.bearing){const b=na(u.bearing,p,bl);m.bearing=this._map.transform.bearing+a.ac(b.amount,-179,179),ia(m,b)}if(u.pitch){const b=na(u.pitch,p,so);m.pitch=this._map.transform.pitch+b.amount,ia(m,b)}if(m.zoom||m.bearing){const b=u.pinchAround===void 0?u.around:u.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ia(v,t){(!v.duration||v.duration<t.duration)&&(v.duration=t.duration,v.easing=t.easing)}function na(v,t,u){const{maxSpeed:p,linearity:m,deceleration:b}=u,A=a.ac(v*m/(t/1e3),-p,p),P=Math.abs(A)/(b*m);return{easing:u.easing,duration:1e3*P,amount:A*(P/2)}}class Pn extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,p,m={}){const b=C.mousePos(u.getCanvas(),p),A=u.unproject(b);super(t,a.e({point:b,lngLat:A,originalEvent:p},m)),this._defaultPrevented=!1,this.target=u}}class Ne extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,p){const m=t==="touchend"?p.changedTouches:p.touches,b=C.touchPos(u.getCanvasContainer(),m),A=b.map(O=>u.unproject(O)),P=b.reduce((O,Z,K,J)=>O.add(Z.div(J.length)),new a.P(0,0));super(t,{points:b,point:P,lngLats:A,lngLat:u.unproject(P),originalEvent:p}),this._defaultPrevented=!1}}class D extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,u,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class se{constructor(t,u){this._map=t,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new D(t.type,this._map,t))}mousedown(t,u){return this._mousedownPos=u,this._firePreventable(new Pn(t.type,this._map,t))}mouseup(t){this._map.fire(new Pn(t.type,this._map,t))}click(t,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Pn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Pn(t.type,this._map,t))}mouseover(t){this._map.fire(new Pn(t.type,this._map,t))}mouseout(t){this._map.fire(new Pn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ne(t.type,this._map,t))}touchmove(t){this._map.fire(new Ne(t.type,this._map,t))}touchend(t){this._map.fire(new Ne(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ne(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fe{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Pn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Pn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mt{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(a.P.convert(t),this._map.terrain)}}class It{constructor(t,u){this._map=t,this._tr=new mt(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,u){this.isEnabled()&&t.shiftKey&&t.button===0&&(C.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(t,u){if(!this._active)return;const p=u;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(m.x,p.x),A=Math.max(m.x,p.x),P=Math.min(m.y,p.y),O=Math.max(m.y,p.y);C.setTransform(this._box,`translate(${b}px,${P}px)`),this._box.style.width=A-b+"px",this._box.style.height=O-P+"px"}mouseupWindow(t,u){if(!this._active||t.button!==0)return;const p=this._startPos,m=u;if(this.reset(),C.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,u){return this._map.fire(new a.k(t,{originalEvent:u}))}}function Xt(v,t){if(v.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${t.length}`);const u={};for(let p=0;p<v.length;p++)u[v[p].identifier]=t[p];return u}class Hi{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new a.P(0,0);for(const A of m)b._add(A);return b.div(m.length)}(u),this.touches=Xt(p,u)))}touchmove(t,u,p){if(this.aborted||!this.centroid)return;const m=Xt(p,u);for(const b in this.touches){const A=m[b];(!A||A.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,u,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class cn{constructor(t){this.singleTap=new Hi(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,u,p){this.singleTap.touchstart(t,u,p)}touchmove(t,u,p){this.singleTap.touchmove(t,u,p)}touchend(t,u,p){const m=this.singleTap.touchend(t,u,p);if(m){const b=t.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(m)<30;if(b&&A||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class On{constructor(t){this._tr=new mt(t),this._zoomIn=new cn({numTouches:1,numTaps:2}),this._zoomOut=new cn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,u,p){this._zoomIn.touchstart(t,u,p),this._zoomOut.touchstart(t,u,p)}touchmove(t,u,p){this._zoomIn.touchmove(t,u,p),this._zoomOut.touchmove(t,u,p)}touchend(t,u,p){const m=this._zoomIn.touchend(t,u,p),b=this._zoomOut.touchend(t,u,p),A=this._tr;return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(m)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class In{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const u=this._moveFunction(...t);if(u.bearingDelta||u.pitchDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(t,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=u.length?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,u){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const m=u.length?u[0]:u;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&C.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const vr={0:1,2:2};class Lr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const u=C.mouseButton(t);this._eventButton=u}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(u,p){const m=vr[p];return u.buttons===void 0||(u.buttons&m)!==m}(t,this._eventButton)}isValidEndEvent(t){return C.mouseButton(t)===this._eventButton}}class Wr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const rs=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=t=>{t.preventDefault()}},wr=({enable:v,clickTolerance:t,bearingDegreesPerPixelMoved:u=.8})=>{const p=new Lr({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new In({clickTolerance:t,move:(m,b)=>({bearingDelta:(b.x-m.x)*u}),moveStateManager:p,enable:v,assignEvents:rs})},oo=({enable:v,clickTolerance:t,pitchDegreesPerPixelMoved:u=-.5})=>{const p=new Lr({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new In({clickTolerance:t,move:(m,b)=>({pitchDelta:(b.y-m.y)*u}),moveStateManager:p,enable:v,assignEvents:rs})};class ss{constructor(t,u){this._clickTolerance=t.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,u,p){return this._calculateTransform(t,u,p)}touchmove(t,u,p){if(this._active){if(!this._shouldBePrevented(p.length))return t.preventDefault(),this._calculateTransform(t,u,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,u,p){this._calculateTransform(t,u,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,u,p){p.length>0&&(this._active=!0);const m=Xt(p,u),b=new a.P(0,0),A=new a.P(0,0);let P=0;for(const Z in m){const K=m[Z],J=this._touches[Z];J&&(b._add(K),A._add(K.sub(J)),P++,m[Z]=K)}if(this._touches=m,this._shouldBePrevented(P)||!A.mag())return;const O=A.div(P);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(P),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Da{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(t,u,p){if(!this._firstTwoTouches)return;t.preventDefault();const[m,b]=this._firstTwoTouches,A=Gr(p,u,m),P=Gr(p,u,b);if(!A||!P)return;const O=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],O,t)}touchend(t,u,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,A=Gr(p,u,m),P=Gr(p,u,b);A&&P||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Gr(v,t,u){for(let p=0;p<v.length;p++)if(v[p].identifier===u)return t[p]}function vl(v,t){return Math.log(v/t)/Math.LN2}class yu extends Da{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,u){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(vl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vl(this._distance,p),pinchAround:u}}}function bu(v,t){return 180*v.angleWith(t)/Math.PI}class vu extends Da{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,u,p){const m=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bu(this._vector,m),pinchAround:u}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const u=25/(Math.PI*this._minDiameter)*360,p=bu(t,this._startVector);return Math.abs(p)<u}}function fc(v){return Math.abs(v.y)>Math.abs(v.x)}class wl extends Da{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,u,p){super.touchstart(t,u,p),this._currentTouchCount=p.length}_start(t){this._lastPoints=t,fc(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,u,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,u,p){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,b=u.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=t.y>0==u.y>0;return fc(t)&&fc(u)&&A}}const kh={panStep:100,bearingStep:15,pitchStep:10};class os{constructor(t){this._tr=new mt(t);const u=kh;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let u=0,p=0,m=0,b=0,A=0;switch(t.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),A=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:P=>{const O=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Fs,zoom:u?Math.round(O.zoom)+u*(t.shiftKey?2:1):O.zoom,bearing:O.bearing+p*this._bearingStep,pitch:O.pitch+m*this._pitchStep,offset:[-b*this._panStep,-A*this._panStep],center:O.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fs(v){return v*(2-v)}const wu=4.000244140625;class gs{constructor(t,u){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=t,this._tr=new mt(t),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let u=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=y.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,u!==0&&u%wu==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),t.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=t,this._delta-=u,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=C.mousePos(this._map.getCanvas(),t),p=this._tr;this._around=u.y>p.transform.height/2-p.transform.getHorizon()?a.N.convert(this._aroundCenter?p.center:p.unproject(u)):a.N.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>wu?this._wheelZoomRate:this._defaultZoomRate;let Z=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&Z!==0&&(Z=1/Z);const K=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(K*Z))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,p=this._startZoom,m=this._easing;let b,A=!1;const P=y.now()-this._lastWheelEventTime;if(this._type==="wheel"&&p&&m&&P){const O=Math.min(P/200,1),Z=m(O);b=a.y.number(p,u,Z),O<1?this._frameId||(this._frameId=!0):A=!0}else b=u,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let u=a.b9;if(this._prevEase){const p=this._prevEase,m=(y.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),A=.27/Math.sqrt(b*b+1e-4)*.01,P=Math.sqrt(.0729-A*A);u=a.b8(A,P,.25,1)}return this._prevEase={start:y.now(),duration:t,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ra{constructor(t,u){this._clickZoom=t,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Af{constructor(t){this._tr=new mt(t),this.reset()}reset(){this._active=!1}dblclick(t,u){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mf{constructor(){this._tap=new cn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,u,p){if(!this._swipePoint)if(this._tapTime){const m=u[0],b=t.timeStamp-this._tapTime<500,A=this._tapPoint.dist(m)<30;b&&A?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(t,u,p)}touchmove(t,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=u[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,u,p)}touchend(t,u,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(t,u,p);m&&(this._tapTime=t.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sh{constructor(t,u,p){this._el=t,this._mousePan=u,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Th{constructor(t,u,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=u,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xu{constructor(t,u,p,m){this._el=t,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Fa{constructor(t,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",t);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=u,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,u){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:t,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const as=v=>v.zoom||v.drag||v.pitch||v.rotate;class qt extends a.k{}function dc(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class ku{constructor(t,u){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=m.type==="renderFrame"?void 0:m,P={needsRenderFrame:!1},O={},Z={},K=m.touches,J=K?this._getMapTouches(K):void 0,ae=J?C.touchPos(this._map.getCanvas(),J):C.mousePos(this._map.getCanvas(),m);for(const{handlerName:Ee,handler:Oe,allowed:De}of this._handlers){if(!Oe.isEnabled())continue;let je;this._blockedByActive(Z,De,Ee)?Oe.reset():Oe[b||m.type]&&(je=Oe[b||m.type](m,ae,J),this.mergeHandlerResult(P,O,je,Ee,A),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Oe.isActive())&&(Z[Ee]=Oe)}const _e={};for(const Ee in this._previousActiveHandlers)Z[Ee]||(_e[Ee]=A);this._previousActiveHandlers=Z,(Object.keys(_e).length||dc(P))&&(this._changes.push([P,O,_e]),this._triggerRenderFrame()),(Object.keys(Z).length||dc(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:xe}=P;xe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],xe(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Co(t),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,A]of this._listeners)C.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[t,u,p]of this._listeners)C.removeEventListener(t,u,t===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new se(u,t));const m=u.boxZoom=new It(u,t);this._add("boxZoom",m),t.interactive&&t.boxZoom&&m.enable();const b=u.cooperativeGestures=new Fa(u,t.cooperativeGestures);this._add("cooperativeGestures",b),t.cooperativeGestures&&b.enable();const A=new On(u),P=new Af(u);u.doubleClickZoom=new ra(P,A),this._add("tapZoom",A),this._add("clickZoom",P),t.interactive&&t.doubleClickZoom&&u.doubleClickZoom.enable();const O=new Mf;this._add("tapDragZoom",O);const Z=u.touchPitch=new wl(u);this._add("touchPitch",Z),t.interactive&&t.touchPitch&&u.touchPitch.enable(t.touchPitch);const K=wr(t),J=oo(t);u.dragRotate=new Th(t,K,J),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]),t.interactive&&t.dragRotate&&u.dragRotate.enable();const ae=(({enable:je,clickTolerance:Te})=>{const He=new Lr({checkCorrectEvent:Je=>C.mouseButton(Je)===0&&!Je.ctrlKey});return new In({clickTolerance:Te,move:(Je,nt)=>({around:nt,panDelta:nt.sub(Je)}),activateOnStart:!0,moveStateManager:He,enable:je,assignEvents:rs})})(t),_e=new ss(t,u);u.dragPan=new Sh(p,ae,_e),this._add("mousePan",ae),this._add("touchPan",_e,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&u.dragPan.enable(t.dragPan);const xe=new vu,Ee=new yu;u.touchZoomRotate=new xu(p,Ee,xe,O),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",Ee,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&u.touchZoomRotate.enable(t.touchZoomRotate);const Oe=u.scrollZoom=new gs(u,()=>this._triggerRenderFrame());this._add("scrollZoom",Oe,["mousePan"]),t.interactive&&t.scrollZoom&&u.scrollZoom.enable(t.scrollZoom);const De=u.keyboard=new os(u);this._add("keyboard",De),t.interactive&&t.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new Fe(u))}_add(t,u,p){this._handlers.push({handlerName:t,handler:u,allowed:p}),this._handlersById[t]=u}stop(t){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!as(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,u,p){for(const m in t)if(m!==p&&(!u||u.indexOf(m)<0))return!0;return!1}_getMapTouches(t){const u=[];for(const p of t)this._el.contains(p.target)&&u.push(p);return u}mergeHandlerResult(t,u,p,m,b){if(!p)return;a.e(t,p);const A={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(u.zoom=A),p.panDelta!==void 0&&(u.drag=A),p.pitchDelta!==void 0&&(u.pitch=A),p.bearingDelta!==void 0&&(u.rotate=A)}_applyChanges(){const t={},u={},p={};for(const[m,b,A]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),a.e(u,b),a.e(p,A);this._updateMapTransform(t,u,p),this._changes=[]}_updateMapTransform(t,u,p){const m=this._map,b=m._getTransformForUpdate(),A=m.terrain;if(!(dc(t)||A&&this._terrainMovement))return this._fireEvents(u,p,!0);let{panDelta:P,zoomDelta:O,bearingDelta:Z,pitchDelta:K,around:J,pinchAround:ae}=t;ae!==void 0&&(J=ae),m._stop(!0),J=J||m.transform.centerPoint;const _e=b.pointLocation(P?J.sub(P):J);Z&&(b.bearing+=Z),K&&(b.pitch+=K),O&&(b.zoom+=O),A?this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(P)):b.setLocationAtPoint(_e,J):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(_e,J)):b.setLocationAtPoint(_e,J),m._applyUpdatedTransform(b),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(u,p,!0)}_fireEvents(t,u,p){const m=as(this._eventsInProgress),b=as(t),A={};for(const J in t){const{originalEvent:ae}=t[J];this._eventsInProgress[J]||(A[`${J}start`]=ae),this._eventsInProgress[J]=t[J]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const J in A)this._fireEvent(J,A[J]);b&&this._fireEvent("move",b.originalEvent);for(const J in t){const{originalEvent:ae}=t[J];this._fireEvent(J,ae)}const P={};let O;for(const J in this._eventsInProgress){const{handlerName:ae,originalEvent:_e}=this._eventsInProgress[J];this._handlersById[ae].isActive()||(delete this._eventsInProgress[J],O=u[ae]||_e,P[`${J}end`]=O)}for(const J in P)this._fireEvent(J,P[J]);const Z=as(this._eventsInProgress),K=(m||b)&&!Z;if(K&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const J=this._map._getTransformForUpdate();J.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(J)}if(p&&K){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=_e=>_e!==0&&-this._bearingSnap<_e&&_e<this._bearingSnap;!J||!J.essential&&y.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:O})),ae(this._map.getBearing())&&this._map.resetNorth()):(ae(J.bearing||this._map.getBearing())&&(J.bearing=0),J.freezeElevation=!0,this._map.easeTo(J,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(t,u){this._map.fire(new a.k(t,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new qt("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ch extends a.E{constructor(t,u){super(),this._renderFrameCallback=()=>{const p=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=u.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,u){return this.jumpTo({center:t},u)}panBy(t,u,p){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.e({offset:t},u),p)}panTo(t,u,p){return this.easeTo(a.e({center:t},u),p)}getZoom(){return this.transform.zoom}setZoom(t,u){return this.jumpTo({zoom:t},u),this}zoomTo(t,u,p){return this.easeTo(a.e({zoom:t},u),p)}zoomIn(t,u){return this.zoomTo(this.getZoom()+1,t,u),this}zoomOut(t,u){return this.zoomTo(this.getZoom()-1,t,u),this}getBearing(){return this.transform.bearing}setBearing(t,u){return this.jumpTo({bearing:t},u),this}getPadding(){return this.transform.padding}setPadding(t,u){return this.jumpTo({padding:t},u),this}rotateTo(t,u,p){return this.easeTo(a.e({bearing:t},u),p)}resetNorth(t,u){return this.rotateTo(0,a.e({duration:1e3},t),u),this}resetNorthPitch(t,u){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},t),u),this}snapToNorth(t,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,u):this}getPitch(){return this.transform.pitch}setPitch(t,u){return this.jumpTo({pitch:t},u),this}cameraForBounds(t,u){t=Qe.convert(t).adjustAntiMeridian();const p=u&&u.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,u)}_cameraForBoxAndBearing(t,u,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Lt=m.padding;m.padding={top:Lt,bottom:Lt,right:Lt,left:Lt}}m.padding=a.e(b,m.padding);const A=this.transform,P=A.padding,O=new Qe(t,u),Z=A.project(O.getNorthWest()),K=A.project(O.getNorthEast()),J=A.project(O.getSouthEast()),ae=A.project(O.getSouthWest()),_e=a.ba(-p),xe=Z.rotate(_e),Ee=K.rotate(_e),Oe=J.rotate(_e),De=ae.rotate(_e),je=new a.P(Math.max(xe.x,Ee.x,De.x,Oe.x),Math.max(xe.y,Ee.y,De.y,Oe.y)),Te=new a.P(Math.min(xe.x,Ee.x,De.x,Oe.x),Math.min(xe.y,Ee.y,De.y,Oe.y)),He=je.sub(Te),Je=(A.width-(P.left+P.right+m.padding.left+m.padding.right))/He.x,nt=(A.height-(P.top+P.bottom+m.padding.top+m.padding.bottom))/He.y;if(nt<0||Je<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const bt=Math.min(A.scaleZoom(A.scale*Math.min(Je,nt)),m.maxZoom),Ct=a.P.convert(m.offset),Dt=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.ba(p)),Nt=Ct.add(Dt).mult(A.scale/A.zoomScale(bt));return{center:A.unproject(Z.add(J).div(2).sub(Nt)),zoom:bt,bearing:p}}fitBounds(t,u,p){return this._fitInternal(this.cameraForBounds(t,u),u,p)}fitScreenCoordinates(t,u,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(t)),this.transform.pointLocation(a.P.convert(u)),p,m),m,b)}_fitInternal(t,u,p){return t?(delete(u=a.e(t,u)).padding,u.linear?this.easeTo(u,p):this.flyTo(u,p)):this}jumpTo(t,u){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,A=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(m=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=a.N.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(b=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(A=!0,p.pitch=+t.pitch),t.padding==null||p.isPaddingEqual(t.padding)||(p.padding=t.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",u)).fire(new a.k("move",u)),m&&this.fire(new a.k("zoomstart",u)).fire(new a.k("zoom",u)).fire(new a.k("zoomend",u)),b&&this.fire(new a.k("rotatestart",u)).fire(new a.k("rotate",u)).fire(new a.k("rotateend",u)),A&&this.fire(new a.k("pitchstart",u)).fire(new a.k("pitch",u)).fire(new a.k("pitchend",u)),this.fire(new a.k("moveend",u))}calculateCameraOptionsFromTo(t,u,p,m=0){const b=a.Z.fromLngLat(t,u),A=a.Z.fromLngLat(p,m),P=A.x-b.x,O=A.y-b.y,Z=A.z-b.z,K=Math.hypot(P,O,Z);if(K===0)throw new Error("Can't calculate camera options with same From and To");const J=Math.hypot(P,O),ae=this.transform.scaleZoom(this.transform.cameraToCenterDistance/K/this.transform.tileSize),_e=180*Math.atan2(P,-O)/Math.PI;let xe=180*Math.acos(J/K)/Math.PI;return xe=Z<0?90-xe:90+xe,{center:A.toLngLat(),zoom:ae,pitch:xe,bearing:_e}}easeTo(t,u){var p;this._stop(!1,t.easeId),((t=a.e({offset:[0,0],duration:500,easing:a.b9},t)).animate===!1||!t.essential&&y.prefersReducedMotion)&&(t.duration=0);const m=this._getTransformForUpdate(),b=m.zoom,A=m.bearing,P=m.pitch,O=m.padding,Z="bearing"in t?this._normalizeBearing(t.bearing,A):A,K="pitch"in t?+t.pitch:P,J="padding"in t?t.padding:m.padding,ae=a.P.convert(t.offset);let _e=m.centerPoint.add(ae);const xe=m.pointLocation(_e),{center:Ee,zoom:Oe}=m.getConstrained(a.N.convert(t.center||xe),(p=t.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(Ee,m);const De=m.project(xe),je=m.project(Ee).sub(De),Te=m.zoomScale(Oe-b);let He,Je;t.around&&(He=a.N.convert(t.around),Je=m.locationPoint(He));const nt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Oe!==b,this._rotating=this._rotating||A!==Z,this._pitching=this._pitching||K!==P,this._padding=!m.isPaddingEqual(J),this._easeId=t.easeId,this._prepareEase(u,t.noMoveStart,nt),this.terrain&&this._prepareElevation(Ee),this._ease(bt=>{if(this._zooming&&(m.zoom=a.y.number(b,Oe,bt)),this._rotating&&(m.bearing=a.y.number(A,Z,bt)),this._pitching&&(m.pitch=a.y.number(P,K,bt)),this._padding&&(m.interpolatePadding(O,J,bt),_e=m.centerPoint.add(ae)),this.terrain&&!t.freezeElevation&&this._updateElevation(bt),He)m.setLocationAtPoint(He,Je);else{const Ct=m.zoomScale(m.zoom-b),Dt=Oe>b?Math.min(2,Te):Math.max(.5,Te),Nt=Math.pow(Dt,1-bt),Lt=m.unproject(De.add(je.mult(bt*Nt)).mult(Ct));m.setLocationAtPoint(m.renderWorldCopies?Lt.wrap():Lt,_e)}this._applyUpdatedTransform(m),this._fireMoveEvents(u)},bt=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(u,bt)},t),this}_prepareEase(t,u,p={}){this._moving=!0,u||p.moving||this.fire(new a.k("movestart",t)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&u!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(p-(u-(p*t+this._elevationStart))/(1-t)),this._elevationTarget=u}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){const u=t.getCameraPosition(),p=this.terrain.getElevationForLngLatZoom(u.lngLat,t.zoom);if(u.altitude<p){const m=this.calculateCameraOptionsFromTo(u.lngLat,p,t.center,t.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(t){const u=[];if(this.terrain&&u.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&u.push(m=>this.transformCameraUpdate(m)),!u.length)return;const p=t.clone();for(const m of u){const b=p.clone(),{center:A,zoom:P,pitch:O,bearing:Z,elevation:K}=m(b);A&&(b.center=A),P!==void 0&&(b.zoom=P),O!==void 0&&(b.pitch=O),Z!==void 0&&(b.bearing=Z),K!==void 0&&(b.elevation=K),p.apply(b)}this.transform.apply(p)}_fireMoveEvents(t){this.fire(new a.k("move",t)),this._zooming&&this.fire(new a.k("zoom",t)),this._rotating&&this.fire(new a.k("rotate",t)),this._pitching&&this.fire(new a.k("pitch",t))}_afterEase(t,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",t)),m&&this.fire(new a.k("rotateend",t)),b&&this.fire(new a.k("pitchend",t)),this.fire(new a.k("moveend",t))}flyTo(t,u){var p;if(!t.essential&&y.prefersReducedMotion){const Rt=a.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rt,u)}this.stop(),t=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},t);const m=this._getTransformForUpdate(),b=m.zoom,A=m.bearing,P=m.pitch,O=m.padding,Z="bearing"in t?this._normalizeBearing(t.bearing,A):A,K="pitch"in t?+t.pitch:P,J="padding"in t?t.padding:m.padding,ae=a.P.convert(t.offset);let _e=m.centerPoint.add(ae);const xe=m.pointLocation(_e),{center:Ee,zoom:Oe}=m.getConstrained(a.N.convert(t.center||xe),(p=t.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(Ee,m);const De=m.zoomScale(Oe-b),je=m.project(xe),Te=m.project(Ee).sub(je);let He=t.curve;const Je=Math.max(m.width,m.height),nt=Je/De,bt=Te.mag();if("minZoom"in t){const Rt=a.ac(Math.min(t.minZoom,b,Oe),m.minZoom,m.maxZoom),yi=Je/m.zoomScale(Rt-b);He=Math.sqrt(yi/bt*2)}const Ct=He*He;function Dt(Rt){const yi=(nt*nt-Je*Je+(Rt?-1:1)*Ct*Ct*bt*bt)/(2*(Rt?nt:Je)*Ct*bt);return Math.log(Math.sqrt(yi*yi+1)-yi)}function Nt(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function Lt(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const Mt=Dt(!1);let Jt=function(Rt){return Lt(Mt)/Lt(Mt+He*Rt)},xi=function(Rt){return Je*((Lt(Mt)*(Nt(yi=Mt+He*Rt)/Lt(yi))-Nt(Mt))/Ct)/bt;var yi},zt=(Dt(!0)-Mt)/He;if(Math.abs(bt)<1e-6||!isFinite(zt)){if(Math.abs(Je-nt)<1e-6)return this.easeTo(t,u);const Rt=nt<Je?-1:1;zt=Math.abs(Math.log(nt/Je))/He,xi=()=>0,Jt=yi=>Math.exp(Rt*He*yi)}return t.duration="duration"in t?+t.duration:1e3*zt/("screenSpeed"in t?+t.screenSpeed/He:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=A!==Z,this._pitching=K!==P,this._padding=!m.isPaddingEqual(J),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Ee),this._ease(Rt=>{const yi=Rt*zt,gn=1/Jt(yi);m.zoom=Rt===1?Oe:b+m.scaleZoom(gn),this._rotating&&(m.bearing=a.y.number(A,Z,Rt)),this._pitching&&(m.pitch=a.y.number(P,K,Rt)),this._padding&&(m.interpolatePadding(O,J,Rt),_e=m.centerPoint.add(ae)),this.terrain&&!t.freezeElevation&&this._updateElevation(Rt);const Ai=Rt===1?Ee:m.unproject(je.add(Te.mult(xi(yi))).mult(gn));m.setLocationAtPoint(m.renderWorldCopies?Ai.wrap():Ai,_e),this._applyUpdatedTransform(m),this._fireMoveEvents(u)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,u){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,u)}return t||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(t,u,p){p.animate===!1||p.duration===0?(t(1),u()):(this._easeStart=y.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,u){t=a.b3(t,-180,180);const p=Math.abs(t-u);return Math.abs(t-360-u)<p&&(t-=360),Math.abs(t+360-u)<p&&(t+=360),t}_normalizeCenter(t,u){if(!u.renderWorldCopies||u.lngRange)return;const p=t.lng-u.center.lng;t.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Ra={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ba{constructor(t=Ra){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,u){const p=this._map._getUIString(`AttributionControl.${u}`);t.title=p,t.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const u=this._map.style.sourceCaches;for(const m in u){const b=u[m];if(b.used||b.usedForTerrain){const A=b.getSource();A.attribution&&t.indexOf(A.attribution)<0&&t.push(A.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,b)=>m.length-b.length),t=t.filter((m,b)=>{for(let A=b+1;A<t.length;A++)if(t[A].indexOf(m)>=0)return!1;return!0});const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Su{constructor(t={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const p=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const u=C.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ui{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const u=++this._id;return this._queue.push({callback:t,id:u,cancelled:!1}),u}remove(t){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const m of p)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Tu=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Pf extends a.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,u){this.sourceCache.update(t,u),this._renderableTilesKeys=[];const p={};for(const m of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aP(m.posMatrix,0,a.X,0,a.X,0,1),this._tiles[m.key]=new Cn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(t){for(const u in this._tiles){const p=this._tiles[u];(!t||p.tileID.equals(t)||p.tileID.isChildOf(t)||t.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const u={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(t.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16),a.aP(b.posMatrix,0,a.X,0,a.X,0,1),u[p]=b}else if(m.canonical.isChildOf(t.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16);const A=m.canonical.z-t.canonical.z,P=m.canonical.x-(m.canonical.x>>A<<A),O=m.canonical.y-(m.canonical.y>>A<<A),Z=a.X>>A;a.aP(b.posMatrix,0,Z,0,Z,0,1),a.J(b.posMatrix,b.posMatrix,[-P*Z,-O*Z,0]),u[p]=b}else if(t.canonical.isChildOf(m.canonical)){const b=t.clone();b.posMatrix=new Float64Array(16);const A=t.canonical.z-m.canonical.z,P=t.canonical.x-(t.canonical.x>>A<<A),O=t.canonical.y-(t.canonical.y>>A<<A),Z=a.X>>A;a.aP(b.posMatrix,0,a.X,0,a.X,0,1),a.J(b.posMatrix,b.posMatrix,[P*Z,O*Z,0]),a.K(b.posMatrix,b.posMatrix,[1/2**A,1/2**A,0]),u[p]=b}}return u}getSourceTile(t,u){const p=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!b||!b.dem)&&u)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(t.scaledTo(m--).key);return b}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(u=>u.timeAdded>=t)}}class Cu{constructor(t,u,p){this.painter=t,this.sourceCache=new Pf(u),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,u,p,m=a.X){var b;if(!(u>=0&&u<m&&p>=0&&p<m))return 0;const A=this.getTerrainData(t),P=(b=A.tile)===null||b===void 0?void 0:b.dem;if(!P)return 0;const O=function(xe,Ee,Oe){var De=Ee[0],je=Ee[1];return xe[0]=Oe[0]*De+Oe[4]*je+Oe[12],xe[1]=Oe[1]*De+Oe[5]*je+Oe[13],xe}([],[u/m*a.X,p/m*a.X],A.u_terrain_matrix),Z=[O[0]*P.dim,O[1]*P.dim],K=Math.floor(Z[0]),J=Math.floor(Z[1]),ae=Z[0]-K,_e=Z[1]-J;return P.get(K,J)*(1-ae)*(1-_e)+P.get(K+1,J)*ae*(1-_e)+P.get(K,J+1)*(1-ae)*_e+P.get(K+1,J+1)*ae*_e}getElevationForLngLatZoom(t,u){if(!a.bb(u,t.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(t,u);return this.getElevation(p,m%a.X,b%a.X,a.X)}getElevation(t,u,p,m=a.X){return this.getDEMElevation(t,u,p,m)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new B(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new B(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const u=this.sourceCache.getSourceTile(t,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const m=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new B(m,u.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),u.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const p=u&&u+u.tileID.key+t.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=t.canonical.z-u.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?b=t.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=t.canonical.x-(t.canonical.x>>b<<b),P=t.canonical.y-(t.canonical.y>>b<<b),O=a.bc(new Float64Array(16),[1/(a.X<<b),1/(a.X<<b),0]);a.J(O,O,[A*a.X,P*a.X,0]),this._demMatrixCache[t.key]={matrix:O,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(t){const u=this.painter,p=u.width/devicePixelRatio,m=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new B(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new B(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,A=0;b<this._coordsTextureSize;b++)for(let P=0;P<this._coordsTextureSize;P++,A+=4)u[A+0]=255&P,u[A+1]=255&b,u[A+2]=P>>8<<4|b>>8,u[A+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),m=new B(t,p,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),A=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,P-A-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null);const O=u[0]+(u[2]>>4<<8),Z=u[1]+((15&u[2])<<8),K=this.coordsIndex[255-u[3]],J=K&&this.sourceCache.getTileByID(K);if(!J)return null;const ae=this._coordsTextureSize,_e=(1<<J.tileID.canonical.z)*ae;return new a.Z((J.tileID.canonical.x*ae+O)/_e+J.tileID.wrap,(J.tileID.canonical.y*ae+Z)/_e,this.getElevation(J.tileID,O,Z,ae))}depthAtPoint(t){const u=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,u=new a.bd,p=new a.aY,m=this.meshSize,b=a.X/m,A=m*m;for(let J=0;J<=m;J++)for(let ae=0;ae<=m;ae++)u.emplaceBack(ae*b,J*b,0);for(let J=0;J<A;J+=m+1)for(let ae=0;ae<m;ae++)p.emplaceBack(ae+J,m+ae+J+1,m+ae+J+2),p.emplaceBack(ae+J,m+ae+J+2,ae+J+1);const P=u.length,O=P+2*(m+1);for(const J of[0,1])for(let ae=0;ae<=m;ae++)for(const _e of[0,1])u.emplaceBack(ae*b,J*a.X,_e);for(let J=0;J<2*m;J+=2)p.emplaceBack(O+J,O+J+1,O+J+3),p.emplaceBack(O+J,O+J+3,O+J+2),p.emplaceBack(P+J,P+J+3,P+J+1),p.emplaceBack(P+J,P+J+2,P+J+3);const Z=u.length,K=Z+2*(m+1);for(const J of[0,1])for(let ae=0;ae<=m;ae++)for(const _e of[0,1])u.emplaceBack(J*a.X,ae*b,_e);for(let J=0;J<2*m;J+=2)p.emplaceBack(Z+J,Z+J+1,Z+J+3),p.emplaceBack(Z+J,Z+J+3,Z+J+2),p.emplaceBack(K+J,K+J+3,K+J+1),p.emplaceBack(K+J,K+J+2,K+J+3);return this._mesh=new ko(t.createVertexBuffer(u,Tu.members),t.createIndexBuffer(p),a.a0.simpleSegment(0,0,u.length,p.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*a.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,u){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(t,u);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(t){const u=this.getTerrainData(t).tile,p={minElevation:null,maxElevation:null};return u&&u.dem&&(p.minElevation=u.dem.min*this.exaggeration,p.maxElevation=u.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(t,u){const p=a.Z.fromLngLat(t.wrap()),m=(1<<u)*a.X,b=p.x*m,A=p.y*m,P=Math.floor(b/a.X),O=Math.floor(A/a.X);return{tileID:new a.S(u,0,u,P,O),mercatorX:b,mercatorY:A}}}class Lf{constructor(t,u,p){this._context=t,this._size=u,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new B(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(p.texture),{id:t,fbo:u,texture:p,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>t.id!==u),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Na={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Eh{constructor(t,u){this.painter=t,this.terrain=u,this.pool=new Lf(t.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(p=>!t._layers[p].isHidden(u)),this._coordsDescendingInv={};for(const p in t.sourceCaches){this._coordsDescendingInv[p]={};const m=t.sourceCaches[p].getVisibleCoordinates();for(const b of m){const A=this.terrain.sourceCache.getTerrainCoords(b);for(const P in A)this._coordsDescendingInv[p][P]||(this._coordsDescendingInv[p][P]=[]),this._coordsDescendingInv[p][P].push(A[P])}}this._coordsDescendingInvStr={};for(const p of t._order){const m=t._layers[p],b=m.source;if(Na[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const A in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][A]=this._coordsDescendingInv[b][A].map(P=>P.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const u=t.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Na[u]&&(this._prevType&&Na[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(t.id),!m))return!0;if(Na[this._prevType]||Na[u]&&m){this._prevType=u;const b=this._stacks.length-1,A=this._stacks[b]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(gl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[b]){const Z=this.pool.getObjectForId(P.rtt[b].id);if(Z.stamp===P.rtt[b].stamp){this.pool.useObject(Z);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),P.rtt[b]={id:O.id,stamp:O.stamp},p.context.bindFramebuffer.set(O.fbo.framebuffer),p.context.clear({color:a.aM.transparent,stencil:0}),p.currentStencilSource=void 0;for(let Z=0;Z<A.length;Z++){const K=p.style._layers[A[Z]],J=K.source?this._coordsDescendingInv[K.source][P.tileID.key]:[P.tileID];p.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),p._renderTileClippingMasks(K,J),p.renderLayer(p,p.style.sourceCaches[K.source],K,J),K.source&&(P.rttCoords[K.source]=this._coordsDescendingInvStr[K.source][P.tileID.key])}}return gl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Na[u]}return!1}}const Eu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ih=_,zf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ra,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Iu=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},Of={showCompass:!0,showZoom:!0,visualizePitch:!1};class Df{constructor(t,u,p=!1){this.mousedown=A=>{this.startMouse(a.e({},A,{ctrlKey:!0,preventDefault:()=>A.preventDefault()}),C.mousePos(this.element,A)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.moveMouse(A,C.mousePos(this.element,A))},this.mouseup=A=>{this.mouseRotate.dragEnd(A),this.mousePitch&&this.mousePitch.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,A.targetTouches)[0],this.startTouch(A,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,A.targetTouches)[0],this.moveTouch(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=t.dragRotate._mouseRotate.getClickTolerance(),b=t.dragRotate._mousePitch.getClickTolerance();this.element=u,this.mouseRotate=wr({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:A,clickTolerance:P,bearingDegreesPerPixelMoved:O=.8})=>{const Z=new Wr;return new In({clickTolerance:P,move:(K,J)=>({bearingDelta:(J.x-K.x)*O}),moveStateManager:Z,enable:A,assignEvents:Iu})})({clickTolerance:m,enable:!0}),this.map=t,p&&(this.mousePitch=oo({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:A,clickTolerance:P,pitchDegreesPerPixelMoved:O=-.5})=>{const Z=new Wr;return new In({clickTolerance:P,move:(K,J)=>({pitchDelta:(J.y-K.y)*O}),moveStateManager:Z,enable:A,assignEvents:Iu})})({clickTolerance:b,enable:!0})),C.addEventListener(u,"mousedown",this.mousedown),C.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(u,"touchcancel",this.reset)}startMouse(t,u){this.mouseRotate.dragStart(t,u),this.mousePitch&&this.mousePitch.dragStart(t,u),C.disableDrag()}startTouch(t,u){this.touchRotate.dragStart(t,u),this.touchPitch&&this.touchPitch.dragStart(t,u),C.disableDrag()}moveMouse(t,u){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(t,u)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(t,u)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(t,u){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(t,u)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(t,u)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const t=this.element;C.removeEventListener(t,"mousedown",this.mousedown),C.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let Hr;function mn(v,t,u){const p=new a.N(v.lng,v.lat);if(v=new a.N(v.lng,v.lat),t){const m=new a.N(v.lng-360,v.lat),b=new a.N(v.lng+360,v.lat),A=u.locationPoint(v).distSqr(t);u.locationPoint(m).distSqr(t)<A?v=m:u.locationPoint(b).distSqr(t)<A&&(v=b)}for(;Math.abs(v.lng-u.center.lng)>180;){const m=u.locationPoint(v);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;v.lng>u.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&u.locationPoint(v).y>u.height/2-u.getHorizon()?v:p}const ja={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pc(v,t,u){const p=v.classList;for(const m in ja)p.remove(`maplibregl-${u}-anchor-${m}`);p.add(`maplibregl-${u}-anchor-${t}`)}class mc extends a.E{constructor(t){if(super(),this._onKeyPress=u=>{const p=u.code,m=u.charCode||u.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=u=>{const p=u.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=u=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?mn(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${ja[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${b}`),y.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div");const u=C.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${p}px`),u.setAttributeNS(null,"width",`${m}px`),u.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=C.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const A=C.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const P=C.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const De of O){const je=C.createNS("http://www.w3.org/2000/svg","ellipse");je.setAttributeNS(null,"opacity","0.04"),je.setAttributeNS(null,"cx","10.5"),je.setAttributeNS(null,"cy","5.80029008"),je.setAttributeNS(null,"rx",De.rx),je.setAttributeNS(null,"ry",De.ry),P.appendChild(je)}const Z=C.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const K=C.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(K);const J=C.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"fill","#000000");const ae=C.createNS("http://www.w3.org/2000/svg","path");ae.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),J.appendChild(ae);const _e=C.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_e.setAttributeNS(null,"fill","#FFFFFF");const xe=C.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ee=C.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#000000"),Ee.setAttributeNS(null,"opacity","0.25"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962");const Oe=C.createNS("http://www.w3.org/2000/svg","circle");Oe.setAttributeNS(null,"fill","#FFFFFF"),Oe.setAttributeNS(null,"cx","5.5"),Oe.setAttributeNS(null,"cy","5.5"),Oe.setAttributeNS(null,"r","5.4999962"),xe.appendChild(Ee),xe.appendChild(Oe),A.appendChild(P),A.appendChild(Z),A.appendChild(J),A.appendChild(_e),A.appendChild(xe),u.appendChild(A),u.setAttributeNS(null,"height",p*this._scale+"px"),u.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(u),this._offset=a.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),pc(this._element,this._anchor,"marker"),t&&t.className)for(const u of t.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var u,p;if(!(!((u=this._map)===null||u===void 0)&&u.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),A=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,A)-b<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/m.transform._pixelPerMeter,O=Math.sin(m.getPitch()*Math.PI/180)*P,Z=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),K=m.transform.lngLatToCameraDepth(this._lngLat,A+O)-Z>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&K&&this._popup.remove(),this._element.style.opacity=K?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,u){return t===void 0&&u===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const Ah={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let xl=0,kl=!1;const Rs={maxWidth:100,unit:"metric"};function Sl(v,t,u){const p=u&&u.maxWidth||100,m=v._container.clientHeight/2,b=v.unproject([0,m]),A=v.unproject([p,m]),P=b.distanceTo(A);if(u&&u.unit==="imperial"){const O=3.2808*P;O>5280?Kt(t,p,O/5280,v._getUIString("ScaleControl.Miles")):Kt(t,p,O,v._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Kt(t,p,P/1852,v._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Kt(t,p,P/1e3,v._getUIString("ScaleControl.Kilometers")):Kt(t,p,P,v._getUIString("ScaleControl.Meters"))}function Kt(v,t,u,p){const m=function(b){const A=Math.pow(10,`${Math.floor(b)}`.length-1);let P=b/A;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(O){const Z=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*Z)/Z}(P),A*P}(u);v.style.width=t*(m/u)+"px",v.innerHTML=`${m}&nbsp;${p}`}const fi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},gc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _c(v){if(v){if(typeof v=="number"){const t=Math.round(Math.abs(v)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,v),"top-left":new a.P(t,t),"top-right":new a.P(-t,t),bottom:new a.P(0,-v),"bottom-left":new a.P(t,-t),"bottom-right":new a.P(-t,-t),left:new a.P(v,0),right:new a.P(-v,0)}}if(v instanceof a.P||Array.isArray(v)){const t=a.P.convert(v);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.P.convert(v.center||[0,0]),top:a.P.convert(v.top||[0,0]),"top-left":a.P.convert(v["top-left"]||[0,0]),"top-right":a.P.convert(v["top-right"]||[0,0]),bottom:a.P.convert(v.bottom||[0,0]),"bottom-left":a.P.convert(v["bottom-left"]||[0,0]),"bottom-right":a.P.convert(v["bottom-right"]||[0,0]),left:a.P.convert(v.left||[0,0]),right:a.P.convert(v.right||[0,0])}}return _c(new a.P(0,0))}const Au=_;h.AJAXError=a.bh,h.Evented=a.E,h.LngLat=a.N,h.MercatorCoordinate=a.Z,h.Point=a.P,h.addProtocol=a.bi,h.config=a.a,h.removeProtocol=a.bj,h.AttributionControl=Ba,h.BoxZoomHandler=It,h.CanvasSource=dt,h.CooperativeGesturesHandler=Fa,h.DoubleClickZoomHandler=ra,h.DragPanHandler=Sh,h.DragRotateHandler=Th,h.EdgeInsets=So,h.FullscreenControl=class extends a.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var t;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=u==null?void 0:u.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},h.GeoJSONSource=H,h.GeolocateControl=class extends a.E{constructor(v){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const u=new a.N(t.coords.longitude,t.coords.latitude),p=t.coords.accuracy,m=this._map.getBearing(),b=a.e({bearing:m},this.options.fitBoundsOptions),A=Qe.fromLngLat(u,p);this._map.fitBounds(A,b,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const u=new a.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&kl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new mc({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new mc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},Ah,v)}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(t=!1){if(Hr!==void 0&&!t)return Hr;if(window.navigator.permissions===void 0)return Hr=!!window.navigator.geolocation,Hr;try{Hr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Hr=!!window.navigator.geolocation}return Hr})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xl=0,kl=!1}_isOutOfMapMaxBounds(v){const t=this._map.getMaxBounds(),u=v.coords;return t&&(u.longitude<t.getWest()||u.longitude>t.getEast()||u.latitude<t.getSouth()||u.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),t=v.getSouthEast(),u=v.getNorthEast(),p=t.distanceTo(u),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xl--,kl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xl++,xl>1?(v={maximumAge:6e5,timeout:0},kl=!0):(v=this.options.positionOptions,kl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},h.Hash=za,h.ImageSource=Ae,h.KeyboardHandler=os,h.LngLatBounds=Qe,h.LogoControl=Su,h.Map=class extends Ch{constructor(v){a.bf.mark(a.bg.create);const t=Object.assign(Object.assign({},zf),v);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new To(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ui,this._controls=[],this._mapId=a.a4(),this._contextLost=u=>{u.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:u}))},this._contextRestored=u=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:u}))},this._onMapScroll=u=>{if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer===!0,this._antialias=t.antialias===!0,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles===!0,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions===!0,this._collectResourceTiming=t.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Eu),t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=t.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new Q(t.transformRequest),typeof t.container=="string"){if(this._container=document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let u=!1;const p=ta(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{u?p(m):u=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ku(this,t),this._hash=t.hash&&new za(typeof t.hash=="string"&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,a.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Ba(typeof t.attributionControl=="boolean"?void 0:t.attributionControl)),t.maplibreLogo&&this.addControl(new Su,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new a.k(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new a.k(`${u.dataType}dataloading`,u))}),this.on("dataabort",u=>{this.fire(new a.k("sourcedataabort",u))})}_getMapId(){return this._mapId}addControl(v,t){if(t===void 0&&(t=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(v);return t>-1&&this._controls.splice(t,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,t,u,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,t,u,p)}resize(v){var t;const u=this._containerDimensions(),p=u[0],m=u[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const O=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,O),this.painter.resize(p,m,O)}this.transform.resize(p,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(p,m);const A=!this._moving;return A&&(this.stop(),this.fire(new a.k("movestart",v)).fire(new a.k("move",v))),this.fire(new a.k("resize",v)),A&&this.fire(new a.k("moveend",v)),this}_getClampedPixelRatio(v,t){const{0:u,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=v*m,A=t*m;return Math.min(b>u?u/b:1,A>p?p/A:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Qe.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(a.N.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(a.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,t,u){if(v==="mouseenter"||v==="mouseover"){let p=!1;return{layers:t,listener:u,delegates:{mousemove:b=>{const A=t.filter(O=>this.getLayer(O)),P=A.length!==0?this.queryRenderedFeatures(b.point,{layers:A}):[];P.length?p||(p=!0,u.call(this,new Pn(v,this,b.originalEvent,{features:P}))):p=!1},mouseout:()=>{p=!1}}}}if(v==="mouseleave"||v==="mouseout"){let p=!1;return{layers:t,listener:u,delegates:{mousemove:A=>{const P=t.filter(O=>this.getLayer(O));(P.length!==0?this.queryRenderedFeatures(A.point,{layers:P}):[]).length?p=!0:p&&(p=!1,u.call(this,new Pn(v,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,u.call(this,new Pn(v,this,A.originalEvent)))}}}}{const p=m=>{const b=t.filter(P=>this.getLayer(P)),A=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];A.length&&(m.features=A,u.call(this,m),delete m.features)};return{layers:t,listener:u,delegates:{[v]:p}}}}_saveDelegatedListener(v,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(t)}_removeDelegatedListener(v,t,u){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const p=this._delegatedListeners[v];for(let m=0;m<p.length;m++){const b=p[m];if(b.listener===u&&b.layers.length===t.length&&b.layers.every(A=>t.includes(A))){for(const A in b.delegates)this.off(A,b.delegates[A]);return void p.splice(m,1)}}}on(v,t,u){if(u===void 0)return super.on(v,t);const p=this._createDelegatedListener(v,typeof t=="string"?[t]:t,u);this._saveDelegatedListener(v,p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(v,t,u){if(u===void 0)return super.once(v,t);const p=typeof t=="string"?[t]:t,m=this._createDelegatedListener(v,p,u);for(const b in m.delegates){const A=m.delegates[b];m.delegates[b]=(...P)=>{this._removeDelegatedListener(v,p,u),A(...P)}}this._saveDelegatedListener(v,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(v,t,u){return u===void 0?super.off(v,t):(this._removeDelegatedListener(v,typeof t=="string"?[t]:t,u),this)}queryRenderedFeatures(v,t){if(!this.style)return[];let u;const p=v instanceof a.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(p?{}:v)||{},m instanceof a.P||typeof m[0]=="number")u=[a.P.convert(m)];else{const b=a.P.convert(m[0]),A=a.P.convert(m[1]);u=[b,new a.P(A.x,b.y),A,new a.P(b.x,A.y),b]}return this.style.queryRenderedFeatures(u,t,this.transform)}querySourceFeatures(v,t){return this.style.querySourceFeatures(v,t)}setStyle(v,t){return(t=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(v,t))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const t=this._locale[v];if(t==null)throw new Error(`Missing UI string '${v}'`);return t}_updateStyle(v,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,t));const u=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new ba(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,t,u):this.style.loadJSON(v,t,u),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ba(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,t){if(typeof v=="string"){const u=this._requestManager.transformRequest(v,"Style");a.h(u,new AbortController).then(p=>{this._updateDiff(p.data,t)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof v=="object"&&this._updateDiff(v,t)}_updateDiff(v,t){try{this.style.setState(v,t)&&this._update(!0)}catch(u){a.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(v,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(v,t){return this._lazyInitEmptyStyle(),this.style.addSource(v,t),this._update(!0)}isSourceLoaded(v){const t=this.style&&this.style.sourceCaches[v];if(t!==void 0)return t.loaded();this.fire(new a.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const t=this.style.sourceCaches[v.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&t.reload();for(const u in this.style._layers){const p=this.style._layers[u];p.type==="hillshade"&&p.source===v.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Cu(this.painter,t,v),this.painter.renderToTexture=new Eh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=u=>{u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:v})),this}getTerrain(){var v,t;return(t=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const t in v){const u=v[t]._tiles;for(const p in u){const m=u[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,t,u={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:A,content:P,textFitWidth:O,textFitHeight:Z}=u;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||a.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:K,height:J,data:ae}=t,_e=t;return this.style.addImage(v,{data:new a.R({width:K,height:J},new Uint8Array(ae)),pixelRatio:p,stretchX:b,stretchY:A,content:P,textFitWidth:O,textFitHeight:Z,sdf:m,version:0,userImage:_e}),_e.onAdd&&_e.onAdd(this,v),this}}{const{width:K,height:J,data:ae}=y.getImageData(t);this.style.addImage(v,{data:new a.R({width:K,height:J},ae),pixelRatio:p,stretchX:b,stretchY:A,content:P,textFitWidth:O,textFitHeight:Z,sdf:m,version:0})}}updateImage(v,t){const u=this.style.getImage(v);if(!u)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||a.b(t)?y.getImageData(t):t,{width:m,height:b,data:A}=p;if(m===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==u.data.width||b!==u.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(t instanceof HTMLImageElement||a.b(t));return u.data.replace(A,P),this.style.updateImage(v,u),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return V.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,t){return this._lazyInitEmptyStyle(),this.style.addLayer(v,t),this._update(!0)}moveLayer(v,t){return this.style.moveLayer(v,t),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,t,u){return this.style.setLayerZoomRange(v,t,u),this._update(!0)}setFilter(v,t,u={}){return this.style.setFilter(v,t,u),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,t,u,p={}){return this.style.setPaintProperty(v,t,u,p),this._update(!0)}getPaintProperty(v,t){return this.style.getPaintProperty(v,t)}setLayoutProperty(v,t,u,p={}){return this.style.setLayoutProperty(v,t,u,p),this._update(!0)}getLayoutProperty(v,t){return this.style.getLayoutProperty(v,t)}setGlyphs(v,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,t,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,t,u,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,t,u=>{u||this._update(!0)}),this}setLight(v,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(v){return this._lazyInitEmptyStyle(),this.style.setSky(v),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,t){return this.style.setFeatureState(v,t),this._update()}removeFeatureState(v,t){return this.style.removeFeatureState(v,t),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,t=0;return this._container&&(v=this._container.clientWidth||400,t=this._container.clientHeight||300),[v,t]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const t=this._canvasContainer=C.create("div","maplibregl-canvas-container",v);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),p=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],p);const m=this._controlContainer=C.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{b[A]=C.create("div",`maplibregl-ctrl-${A} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,t,u){this._canvas.width=Math.floor(u*v),this._canvas.height=Math.floor(u*t),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{t={requestedAttributes:v},p&&(t.statusMessage=p.statusMessage,t.type=p.type)},{once:!0});const u=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!u){const p="Failed to initialize WebGL";throw t?(t.message=p,new Error(JSON.stringify(t))):new Error(p)}this.painter=new La(u,this.transform),E.testSupport(u)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=y.now();this.style.zoomHistory.update(m,b);const A=new a.z(m,{now:b,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=A.crossFadingFactor();P===1&&P===this._crossFadingFactor||(u=!0,this._crossFadingFactor=P),this.style.update(A)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(v=>{a.bf.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Ih}getCameraTargetElevation(){return this.transform.elevation}},h.MapMouseEvent=Pn,h.MapTouchEvent=Ne,h.MapWheelEvent=D,h.Marker=mc,h.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const t=this._map.getZoom(),u=t===this._map.getMaxZoom(),p=t===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,u)=>{const p=this._map._getUIString(`NavigationControl.${u}`);t.title=p,t.setAttribute("aria-label",p)},this.options=a.e({},Of,v),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Df(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,t){const u=C.create("button",v,this._container);return u.type="button",u.addEventListener("click",t),u}},h.Popup=class extends a.E{constructor(v){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?mn(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!t)return;const p=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=_c(this.options.offset);if(!m){const P=this._container.offsetWidth,O=this._container.offsetHeight;let Z;Z=p.y+b.bottom.y<O?["top"]:p.y>this._map.transform.height-O?["bottom"]:[],p.x<P/2?Z.push("left"):p.x>this._map.transform.width-P/2&&Z.push("right"),m=Z.length===0?"bottom":Z.join("-")}let A=p.add(b[m]);this.options.subpixelPositioning||(A=A.round()),C.setTransform(this._container,`${ja[m]} translate(${A.x}px,${A.y}px)`),pc(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(fi),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=a.N.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const t=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=v;p=u.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(gc);v&&v.focus()}},h.RasterDEMTileSource=ue,h.RasterTileSource=it,h.ScaleControl=class{constructor(v){this._onMove=()=>{Sl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Sl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Rs),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},h.ScrollZoomHandler=gs,h.Style=ba,h.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},h.TwoFingersTouchPitchHandler=wl,h.TwoFingersTouchRotateHandler=vu,h.TwoFingersTouchZoomHandler=yu,h.TwoFingersTouchZoomRotateHandler=xu,h.VectorTileSource=_t,h.VideoSource=Ze,h.addSourceType=(v,t)=>a._(void 0,void 0,void 0,function*(){if(Ci(v))throw new Error(`A source type called "${v}" already exists.`);((u,p)=>{st[u]=p})(v,t)}),h.clearPrewarmedResources=function(){const v=Ht;v&&(v.isPreloaded()&&v.numActive()===1?(v.release($e),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},h.getRTLTextPluginStatus=function(){return Fi().getRTLTextPluginStatus()},h.getVersion=function(){return Au},h.getWorkerCount=function(){return wt.workerCount},h.getWorkerUrl=function(){return a.a.WORKER_URL},h.importScriptInWorkers=function(v){return Ti().broadcast("IS",v)},h.prewarm=function(){Mi().acquire($e)},h.setMaxParallelImageRequests=function(v){a.a.MAX_PARALLEL_IMAGE_REQUESTS=v},h.setRTLTextPlugin=function(v,t){return Fi().setRTLTextPlugin(v,t)},h.setWorkerCount=function(v){wt.workerCount=v},h.setWorkerUrl=function(v){a.a.WORKER_URL=v}});var d=n;return d})})(H0);var ex=H0.exports;const Ws=z1(ex);function Mg(r){let e;return n=>{if(n)for(let o in n){let c=e==null?void 0:e[o],d=n[o];c!==d&&r(o,d,c)}else if(e)for(let o in e)r(o,void 0,e[o]);e=n}}function tx(r,...e){let n=[r];for(let o of e)if(o)Array.isArray(o)&&o[0]===r?n.push(...o.slice(1)):n.push(o);else continue;if(n.length!==1)return n.length===2?n[1]:n}function ix(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}var Zl=nx;function nx(r){var e,n,o;if(r){if(Array.isArray(r)){for(e=[],n=r.length,o=0;o<n;o++){var c=r[o];c!=null&&e.push(c)}return e}if(typeof r=="object"){e={};var d=Object.keys(r);for(n=d.length,o=0;o<n;o++){var h=d[o],a=r[h];a!=null&&(e[h]=a)}return e}}}function Pg(r){let e=r[0],n,o,c=Lg(r);return{c(){c.c(),n=Mn()},m(d,h){c.m(d,h),we(d,n,h),o=!0},p(d,h){h[0]&1&&$t(e,e=d[0])?(an(),Be(c,1,1,Ut),ln(),c=Lg(d),c.c(),Le(c,1),c.m(n.parentNode,n)):c.p(d,h)},i(d){o||(Le(c),o=!0)},o(d){Be(c),o=!1},d(d){d&&ve(n),c.d(d)}}}function Lg(r){let e;const n=r[36].default,o=wn(n,r,r[35],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d[1]&16)&&kn(o,n,c,c[35],e?xn(n,c[35],d,null):Sn(c[35]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function rx(r){let e,n,o=r[0]&&Pg(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),we(c,e,d),n=!0},p(c,d){c[0]?o?(o.p(c,d),d[0]&1&&Le(o,1)):(o=Pg(c),o.c(),Le(o,1),o.m(e.parentNode,e)):o&&(an(),Be(o,1,1,()=>{o=null}),ln())},i(c){n||(Le(o),n=!0)},o(c){Be(o),n=!1},d(c){c&&ve(e),o&&o.d(c)}}}function sx(r,e,n){let o,c,d,h,a,_,S,k,y,C,E,T,{$$slots:L={},$$scope:R}=e,{id:N=vh("layer")}=e,{source:z=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:Q=void 0}=e,{beforeLayerType:oe=void 0}=e,{type:ee}=e,{paint:ne=void 0}=e,{layout:j=void 0}=e,{filter:U=void 0}=e,{applyToClusters:X=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:W=void 0}=e,{manageHoverState:ce=!1}=e,{hovered:pe=null}=e,{interactive:be=!0}=e,{hoverCursor:de=void 0}=e,{eventsIfTopMost:ye=!1}=e;const Ie=nl(),{map:Me,source:ot,self:We,minzoom:pt,maxzoom:Tt,eventTopMost:$e,layerInfo:wt}=$w();jt(r,Me,Xe=>n(31,y=Xe)),jt(r,ot,Xe=>n(32,C=Xe)),jt(r,We,Xe=>n(0,k=Xe)),jt(r,pt,Xe=>n(34,T=Xe)),jt(r,Tt,Xe=>n(33,E=Xe)),ds(()=>{k&&y&&(wt.delete(k),y==null||y.removeLayer(k))});let St;function Ht(Xe){var _i,_t;if(!be||!k||!y||ye&&$e(Xe)!==k)return;let Pt=Xe.features??[],ni=(_t=(_i=Pt[0])==null?void 0:_i.properties)==null?void 0:_t.cluster_id,Qe={event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt};Ie(Xe.type,Qe)}function oi(Xe){var _i,_t;if(!be||!k||!y||ye&&$e(Xe)!==k)return;de&&(y.getCanvas().style.cursor=de);let Pt=Xe.features??[];n(6,pe=Pt[0]??null);let ni=(_t=(_i=Pt[0])==null?void 0:_i.properties)==null?void 0:_t.cluster_id;Ie("mouseenter",{event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt})}function Mi(Xe){var _i,_t,it;if(!be||!y)return;if(ye&&$e(Xe)!==k){n(6,pe=null),ce&&St!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:V,id:St},{hover:!1}),St=void 0);return}y.getCanvas().style.cursor=de;let Pt=Xe.features??[],ni=(_t=(_i=Pt[0])==null?void 0:_i.properties)==null?void 0:_t.cluster_id,Qe=(it=Pt[0])==null?void 0:it.id;Qe!==St&&(ce&&(St!==void 0&&(y==null||y.setFeatureState({source:a,id:St,sourceLayer:V},{hover:!1})),y==null||y.setFeatureState({source:a,id:Qe,sourceLayer:V},{hover:!0})),St=Qe,n(6,pe=Pt[0]??null)),Ie("mousemove",{event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt})}function Pi(Xe){if(!(!be||!k||!y)){if(de&&(y.getCanvas().style.cursor=""),n(6,pe=null),ce&&St!==void 0){const Pt={source:a,id:St,sourceLayer:V};y==null||y.setFeatureState(Pt,{hover:!1}),St=void 0}Ie("mouseleave",{map:y,layer:k,source:a})}}let Ti=!0;function At(Xe){y&&(y.off("click",Xe,Ht),y.off("dblclick",Xe,Ht),y.off("contextmenu",Xe,Ht),y.off("mouseenter",Xe,oi),y.off("mousemove",Xe,Mi),y.off("mouseleave",Xe,Pi))}return ds(()=>{y&&k&&At(k)}),r.$$set=Xe=>{"id"in Xe&&n(7,N=Xe.id),"source"in Xe&&n(8,z=Xe.source),"sourceLayer"in Xe&&n(9,V=Xe.sourceLayer),"beforeId"in Xe&&n(10,Q=Xe.beforeId),"beforeLayerType"in Xe&&n(11,oe=Xe.beforeLayerType),"type"in Xe&&n(12,ee=Xe.type),"paint"in Xe&&n(13,ne=Xe.paint),"layout"in Xe&&n(14,j=Xe.layout),"filter"in Xe&&n(15,U=Xe.filter),"applyToClusters"in Xe&&n(16,X=Xe.applyToClusters),"minzoom"in Xe&&n(17,B=Xe.minzoom),"maxzoom"in Xe&&n(18,W=Xe.maxzoom),"manageHoverState"in Xe&&n(19,ce=Xe.manageHoverState),"hovered"in Xe&&n(6,pe=Xe.hovered),"interactive"in Xe&&n(20,be=Xe.interactive),"hoverCursor"in Xe&&n(21,de=Xe.hoverCursor),"eventsIfTopMost"in Xe&&n(22,ye=Xe.eventsIfTopMost),"$$scope"in Xe&&n(35,R=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,o=ix(X)),r.$$.dirty[0]&1073774592&&n(24,c=tx("all",o,U)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,d=B??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,h=W??E),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,a=z||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&k!==N&&a){k&&(At(k),wt.delete(k));let Xe=Q;if(!Q&&oe){let Pt=y.getStyle().layers,ni=typeof oe=="function"?oe:_i=>_i.type===oe,Qe=Pt==null?void 0:Pt.find(ni);Qe&&(Xe=Qe.id)}tn(We,k=N,k),y.addLayer(Zl({id:k,type:ee,source:a,"source-layer":V,filter:c,paint:ne,layout:j,minzoom:d,maxzoom:h}),Xe),n(23,Ti=!0),y.on("click",k,Ht),y.on("dblclick",k,Ht),y.on("contextmenu",k,Ht),y.on("mouseenter",k,oi),y.on("mousemove",k,Mi),y.on("mouseleave",k,Pi)}r.$$.dirty[0]&1048577&&k&&wt.set(k,{interactive:be}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,_=k?Mg((Xe,Pt)=>y==null?void 0:y.setPaintProperty(k,Xe,Pt)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,S=k?Mg((Xe,Pt)=>y==null?void 0:y.setLayoutProperty(k,Xe,Pt)):void 0),r.$$.dirty[0]&268443648&&(_==null||_(ne)),r.$$.dirty[0]&134234112&&(S==null||S(j)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(y==null||y.setLayerZoomRange(k,d,h)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(Ti?n(23,Ti=!1):y==null||y.setFilter(k,c))},[k,Me,ot,We,pt,Tt,pe,N,z,V,Q,oe,ee,ne,j,U,X,B,W,ce,be,de,ye,Ti,c,h,d,S,_,a,o,y,C,E,T,R,L]}let _p=class extends ci{constructor(e){super(),li(this,e,sx,rx,$t,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function ox(r){let e;const n=r[16].default,o=wn(n,r,r[24],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&16777216)&&kn(o,n,c,c[24],e?xn(n,c[24],d,null):Sn(c[24]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function ax(r){let e,n,o;function c(h){r[17](h)}let d={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[ox]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new _p({props:d}),gi.push(()=>Zi(e,"hovered",c)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.applyToClusters=h[9]),a&1024&&(_.minzoom=h[10]),a&2048&&(_.maxzoom=h[11]),a&4096&&(_.hoverCursor=h[12]),a&8192&&(_.manageHoverState=h[13]),a&16384&&(_.eventsIfTopMost=h[14]),a&32768&&(_.interactive=h[15]),a&16777216&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function lx(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=vh("circle")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:Q=!0}=e;function oe(W){z=W,n(0,z)}function ee(W){Di.call(this,r,W)}function ne(W){Di.call(this,r,W)}function j(W){Di.call(this,r,W)}function U(W){Di.call(this,r,W)}function X(W){Di.call(this,r,W)}function B(W){Di.call(this,r,W)}return r.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,h=W.source),"sourceLayer"in W&&n(3,a=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,S=W.beforeLayerType),"paint"in W&&n(6,k=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,C=W.filter),"applyToClusters"in W&&n(9,E=W.applyToClusters),"minzoom"in W&&n(10,T=W.minzoom),"maxzoom"in W&&n(11,L=W.maxzoom),"hoverCursor"in W&&n(12,R=W.hoverCursor),"manageHoverState"in W&&n(13,N=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,V=W.eventsIfTopMost),"interactive"in W&&n(15,Q=W.interactive),"$$scope"in W&&n(24,c=W.$$scope)},[z,d,h,a,_,S,k,y,C,E,T,L,R,N,V,Q,o,oe,ee,ne,j,U,X,B,c]}let cx=class extends ci{constructor(e){super(),li(this,e,lx,ax,$t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function ux(r){let e;const n=r[15].default,o=wn(n,r,r[23],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&8388608)&&kn(o,n,c,c[23],e?xn(n,c[23],d,null):Sn(c[23]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function hx(r){let e,n,o;function c(h){r[16](h)}let d={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[ux]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new _p({props:d}),gi.push(()=>Zi(e,"hovered",c)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.minzoom=h[9]),a&1024&&(_.maxzoom=h[10]),a&2048&&(_.hoverCursor=h[11]),a&4096&&(_.manageHoverState=h[12]),a&8192&&(_.eventsIfTopMost=h[13]),a&16384&&(_.interactive=h[14]),a&8388608&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function fx(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=vh("fill")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:R=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:V=!0}=e;function Q(B){N=B,n(0,N)}function oe(B){Di.call(this,r,B)}function ee(B){Di.call(this,r,B)}function ne(B){Di.call(this,r,B)}function j(B){Di.call(this,r,B)}function U(B){Di.call(this,r,B)}function X(B){Di.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,d=B.id),"source"in B&&n(2,h=B.source),"sourceLayer"in B&&n(3,a=B.sourceLayer),"beforeId"in B&&n(4,_=B.beforeId),"beforeLayerType"in B&&n(5,S=B.beforeLayerType),"paint"in B&&n(6,k=B.paint),"layout"in B&&n(7,y=B.layout),"filter"in B&&n(8,C=B.filter),"minzoom"in B&&n(9,E=B.minzoom),"maxzoom"in B&&n(10,T=B.maxzoom),"hoverCursor"in B&&n(11,L=B.hoverCursor),"manageHoverState"in B&&n(12,R=B.manageHoverState),"hovered"in B&&n(0,N=B.hovered),"eventsIfTopMost"in B&&n(13,z=B.eventsIfTopMost),"interactive"in B&&n(14,V=B.interactive),"$$scope"in B&&n(23,c=B.$$scope)},[N,d,h,a,_,S,k,y,C,E,T,L,R,z,V,o,Q,oe,ee,ne,j,U,X,c]}let dx=class extends ci{constructor(e){super(),li(this,e,fx,hx,$t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function px(r,e,n,o,c){let d=!1;r.getSource(e)&&(d=!0,r.removeSource(e));const h=()=>{o(e)&&(r.addSource(e,n),c())};if(d){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):h())};a()}else h()}function mx(r,e,n){d0().then(()=>{let o=a0(r);if(!o)return;o.getSource(e)===n&&o.removeSource(e)})}function zg(r){let e=r[0],n,o,c=Og(r);return{c(){c.c(),n=Mn()},m(d,h){c.m(d,h),we(d,n,h),o=!0},p(d,h){h&1&&$t(e,e=d[0])?(an(),Be(c,1,1,Ut),ln(),c=Og(d),c.c(),Le(c,1),c.m(n.parentNode,n)):c.p(d,h)},i(d){o||(Le(c),o=!0)},o(d){Be(c),o=!1},d(d){d&&ve(n),c.d(d)}}}function Og(r){let e;const n=r[15].default,o=wn(n,r,r[14],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&16384)&&kn(o,n,c,c[14],e?xn(n,c[14],d,null):Sn(c[14]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function gx(r){let e,n,o=r[0]&&zg(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),we(c,e,d),n=!0},p(c,[d]){c[0]?o?(o.p(c,d),d&1&&Le(o,1)):(o=zg(c),o.c(),Le(o,1),o.m(e.parentNode,e)):o&&(an(),Be(o,1,1,()=>{o=null}),ln())},i(c){n||(Le(o),n=!0)},o(c){Be(o),n=!1},d(c){c&&ve(e),o&&o.d(c)}}}function _x(r,e,n){let o,c,d,{$$slots:h={},$$scope:a}=e,{id:_=vh("geojson")}=e,{data:S}=e,{generateId:k=!1}=e,{promoteId:y=void 0}=e,{filter:C=void 0}=e,{lineMetrics:E=void 0}=e,{cluster:T=void 0}=e;const{map:L,cluster:R,self:N}=Qw();jt(r,L,Q=>n(13,c=Q)),jt(r,R,Q=>n(16,d=Q)),jt(r,N,Q=>n(0,o=Q));let z,V=!0;return ds(()=>{o&&z&&c&&(mx(L,o,z),tn(N,o=null,o),n(11,z=void 0))}),r.$$set=Q=>{"id"in Q&&n(4,_=Q.id),"data"in Q&&n(5,S=Q.data),"generateId"in Q&&n(6,k=Q.generateId),"promoteId"in Q&&n(7,y=Q.promoteId),"filter"in Q&&n(8,C=Q.filter),"lineMetrics"in Q&&n(9,E=Q.lineMetrics),"cluster"in Q&&n(10,T=Q.cluster),"$$scope"in Q&&n(14,a=Q.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&tn(R,d=T,d),r.$$.dirty&12273&&c&&o!==_&&(tn(N,o=_,o),px(c,o,Zl({type:"geojson",data:S,filter:C,lineMetrics:E,generateId:k,promoteId:y,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties}),Q=>c&&Q===o,()=>{o&&(n(11,z=c==null?void 0:c.getSource(o)),n(12,V=!0))})),r.$$.dirty&8208&&(c==null||c.on("style.load",()=>{n(11,z=c==null?void 0:c.getSource(_))})),r.$$.dirty&6176&&z&&(V?n(12,V=!1):z.setData(S)),r.$$.dirty&3072&&(z==null||z.setClusterOptions(Zl({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[o,L,R,N,_,S,k,y,C,E,T,z,V,c,a,h]}let yx=class extends ci{constructor(e){super(),li(this,e,_x,gx,$t,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}};function bx(r){let e;const n=r[15].default,o=wn(n,r,r[23],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&8388608)&&kn(o,n,c,c[23],e?xn(n,c[23],d,null):Sn(c[23]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function vx(r){let e,n,o;function c(h){r[16](h)}let d={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[bx]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new _p({props:d}),gi.push(()=>Zi(e,"hovered",c)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.minzoom=h[9]),a&1024&&(_.maxzoom=h[10]),a&2048&&(_.hoverCursor=h[11]),a&4096&&(_.manageHoverState=h[12]),a&8192&&(_.eventsIfTopMost=h[13]),a&16384&&(_.interactive=h[14]),a&8388608&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function wx(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=vh("line")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:R=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:V=!0}=e;function Q(B){N=B,n(0,N)}function oe(B){Di.call(this,r,B)}function ee(B){Di.call(this,r,B)}function ne(B){Di.call(this,r,B)}function j(B){Di.call(this,r,B)}function U(B){Di.call(this,r,B)}function X(B){Di.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,d=B.id),"source"in B&&n(2,h=B.source),"sourceLayer"in B&&n(3,a=B.sourceLayer),"beforeId"in B&&n(4,_=B.beforeId),"beforeLayerType"in B&&n(5,S=B.beforeLayerType),"paint"in B&&n(6,k=B.paint),"layout"in B&&n(7,y=B.layout),"filter"in B&&n(8,C=B.filter),"minzoom"in B&&n(9,E=B.minzoom),"maxzoom"in B&&n(10,T=B.maxzoom),"hoverCursor"in B&&n(11,L=B.hoverCursor),"manageHoverState"in B&&n(12,R=B.manageHoverState),"hovered"in B&&n(0,N=B.hovered),"eventsIfTopMost"in B&&n(13,z=B.eventsIfTopMost),"interactive"in B&&n(14,V=B.interactive),"$$scope"in B&&n(23,c=B.$$scope)},[N,d,h,a,_,S,k,y,C,E,T,L,R,z,V,o,Q,oe,ee,ne,j,U,X,c]}let xx=class extends ci{constructor(e){super(),li(this,e,wx,vx,$t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};var Rc=yp;function yp(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?Dg(r,e):{}.toString.call(r)=="[object Set]"?Dg(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?Sx(r,e):kx(r,e)}function kx(r,e){return r.toString()===e.toString()}function Dg(r,e){var n=r.length;if(n!=e.length)return!1;for(var o=0;o<n;o++)if(!yp(r[o],e[o]))return!1;return!0}function Sx(r,e){var n=Object.keys(r),o=n.length;if(o!=Object.keys(e).length)return!1;for(var c=0;c<o;c++){var d=n[c];if(!(e.hasOwnProperty(d)&&yp(r[d],e[d])))return!1}return!0}var wh=Uint8Array,K0=Uint16Array,Tx=Int32Array,Cx=new wh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ex=new wh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),J0=function(r,e){for(var n=new K0(31),o=0;o<31;++o)n[o]=e+=1<<r[o-1];for(var c=new Tx(n[30]),o=1;o<30;++o)for(var d=n[o];d<n[o+1];++d)c[d]=d-n[o]<<5|o;return{b:n,r:c}},Y0=J0(Cx,2),Ix=Y0.b,Ax=Y0.r;Ix[28]=258,Ax[258]=28;J0(Ex,0);var Mx=new K0(32768);for(on=0;on<32768;++on)ua=(on&43690)>>1|(on&21845)<<1,ua=(ua&52428)>>2|(ua&13107)<<2,ua=(ua&61680)>>4|(ua&3855)<<4,Mx[on]=((ua&65280)>>8|(ua&255)<<8)>>1;var ua,on,Sf=new wh(288);for(on=0;on<144;++on)Sf[on]=8;var on;for(on=144;on<256;++on)Sf[on]=9;var on;for(on=256;on<280;++on)Sf[on]=7;var on;for(on=280;on<288;++on)Sf[on]=8;var on,Px=new wh(32);for(on=0;on<32;++on)Px[on]=5;var on,Lx=new wh(0),zx=typeof TextDecoder<"u"&&new TextDecoder,Ox=0;try{zx.decode(Lx,{stream:!0}),Ox=1}catch{}function Dx(r){let e,n,o,c,d,h;return e=new dx({props:{id:"edit-polygon-fill",filter:jw,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),o=new xx({props:{id:"edit-polygon-lines",filter:Uw,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),d=new cx({props:{id:"edit-polygon-vertices",filter:Vw,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment),c=qe(),ht(d.$$.fragment)},m(a,_){ct(e,a,_),we(a,n,_),ct(o,a,_),we(a,c,_),ct(d,a,_),h=!0},p:Ut,i(a){h||(Le(e.$$.fragment,a),Le(o.$$.fragment,a),Le(d.$$.fragment,a),h=!0)},o(a){Be(e.$$.fragment,a),Be(o.$$.fragment,a),Be(d.$$.fragment,a),h=!1},d(a){a&&(ve(n),ve(c)),ut(e,a),ut(o,a),ut(d,a)}}}function Fx(r){let e,n;return e=new yx({props:{data:r[0],$$slots:{default:[Dx]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,[c]){const d={};c&1&&(d.data=o[0]),c&2&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function Rx(r,e,n){let o;return jt(r,q0,c=>n(0,o=c)),[o]}class Bx extends ci{constructor(e){super(),li(this,e,Rx,Fx,$t,{})}}const Nx=r=>({}),Fg=r=>({}),jx=r=>({}),Rg=r=>({}),Ux=r=>({}),Bg=r=>({});function Vx(r){let e,n,o,c,d,h,a,_;const S=r[1].top,k=wn(S,r,r[0],Bg),y=r[1].left,C=wn(y,r,r[0],Rg),E=r[1].main,T=wn(E,r,r[0],Fg);return{c(){e=ke("div"),n=ke("div"),k&&k.c(),o=qe(),c=ke("div"),d=ke("div"),C&&C.c(),h=qe(),a=ke("div"),T&&T.c(),fe(n,"class","top svelte-29q570"),fe(d,"class","left svelte-29q570"),fe(a,"class","main svelte-29q570"),fe(c,"class","content svelte-29q570"),fe(e,"class","flex-container svelte-29q570")},m(L,R){we(L,e,R),he(e,n),k&&k.m(n,null),he(e,o),he(e,c),he(c,d),C&&C.m(d,null),he(c,h),he(c,a),T&&T.m(a,null),_=!0},p(L,[R]){k&&k.p&&(!_||R&1)&&kn(k,S,L,L[0],_?xn(S,L[0],R,Ux):Sn(L[0]),Bg),C&&C.p&&(!_||R&1)&&kn(C,y,L,L[0],_?xn(y,L[0],R,jx):Sn(L[0]),Rg),T&&T.p&&(!_||R&1)&&kn(T,E,L,L[0],_?xn(E,L[0],R,Nx):Sn(L[0]),Fg)},i(L){_||(Le(k,L),Le(C,L),Le(T,L),_=!0)},o(L){Be(k,L),Be(C,L),Be(T,L),_=!1},d(L){L&&ve(e),k&&k.d(L),C&&C.d(L),T&&T.d(L)}}}function qx(r,e,n){let{$$slots:o={},$$scope:c}=e;return r.$$set=d=>{"$$scope"in d&&n(0,c=d.$$scope)},[c,o]}class Zx extends ci{constructor(e){super(),li(this,e,qx,Vx,$t,{})}}const Wx=r=>({}),Ng=r=>({}),Gx=r=>({}),jg=r=>({}),Hx=r=>({}),Ug=r=>({});function Xx(r){let e,n,o,c,d,h;const a=r[4].top,_=wn(a,r,r[3],Ug),S=r[4].sidebar,k=wn(S,r,r[3],jg),y=r[4].map,C=wn(y,r,r[3],Ng);return{c(){e=ke("div"),_&&_.c(),n=qe(),o=ke("div"),k&&k.c(),c=qe(),d=ke("div"),C&&C.c()},m(E,T){we(E,e,T),_&&_.m(e,null),r[5](e),we(E,n,T),we(E,o,T),k&&k.m(o,null),r[6](o),we(E,c,T),we(E,d,T),C&&C.m(d,null),r[7](d),h=!0},p(E,[T]){_&&_.p&&(!h||T&8)&&kn(_,a,E,E[3],h?xn(a,E[3],T,Hx):Sn(E[3]),Ug),k&&k.p&&(!h||T&8)&&kn(k,S,E,E[3],h?xn(S,E[3],T,Gx):Sn(E[3]),jg),C&&C.p&&(!h||T&8)&&kn(C,y,E,E[3],h?xn(y,E[3],T,Wx):Sn(E[3]),Ng)},i(E){h||(Le(_,E),Le(k,E),Le(C,E),h=!0)},o(E){Be(_,E),Be(k,E),Be(C,E),h=!1},d(E){E&&(ve(e),ve(n),ve(o),ve(c),ve(d)),_&&_.d(E),r[5](null),k&&k.d(E),r[6](null),C&&C.d(E),r[7](null)}}}function Kx(r,e,n){let o,c,d;jt(r,Vg,y=>n(0,o=y)),jt(r,qd,y=>n(1,c=y)),jt(r,Zd,y=>n(2,d=y));let{$$slots:h={},$$scope:a}=e;function _(y){gi[y?"unshift":"push"](()=>{o=y,Vg.set(o)})}function S(y){gi[y?"unshift":"push"](()=>{c=y,qd.set(c)})}function k(y){gi[y?"unshift":"push"](()=>{d=y,Zd.set(d)})}return r.$$set=y=>{"$$scope"in y&&n(3,a=y.$$scope)},[o,c,d,a,h,_,S,k]}class xh extends ci{constructor(e){super(),li(this,e,Kx,Xx,$t,{})}}let Vg=vn(null),qd=vn(null),Zd=vn(null);function Jx(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return j0(r,o=>{n[0]>o[0]&&(n[0]=o[0]),n[1]>o[1]&&(n[1]=o[1]),n[2]<o[0]&&(n[2]=o[0]),n[3]<o[1]&&(n[3]=o[1])}),n}var Yx=Jx,Qx=Object.defineProperty,$x=(r,e,n)=>e in r?Qx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,mi=(r,e,n)=>$x(r,typeof e!="symbol"?e+"":e,n);function fh(){}function Q0(r){return r()}function qg(){return Object.create(null)}function Tf(r){r.forEach(Q0)}function $0(r){return typeof r=="function"}function e2(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function t2(r){return Object.keys(r).length===0}function i2(r,e){r.appendChild(e)}function n2(r,e,n){r.insertBefore(e,n||null)}function eb(r){r.parentNode&&r.parentNode.removeChild(r)}function Zg(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function $a(r,e,n){n==null?r.removeAttribute(e):r.getAttribute(e)!==n&&r.setAttribute(e,n)}function r2(r){return Array.from(r.childNodes)}function nf(r,e,n){r.classList.toggle(e,!!n)}let bp;function ah(r){bp=r}const Uc=[],Wg=[];let Hc=[];const Gg=[],s2=Promise.resolve();let Wd=!1;function o2(){Wd||(Wd=!0,s2.then(tb))}function Gd(r){Hc.push(r)}const Ad=new Set;let Bc=0;function tb(){if(Bc!==0)return;const r=bp;do{try{for(;Bc<Uc.length;){const e=Uc[Bc];Bc++,ah(e),a2(e.$$)}}catch(e){throw Uc.length=0,Bc=0,e}for(ah(null),Uc.length=0,Bc=0;Wg.length;)Wg.pop()();for(let e=0;e<Hc.length;e+=1){const n=Hc[e];Ad.has(n)||(Ad.add(n),n())}Hc.length=0}while(Uc.length);for(;Gg.length;)Gg.pop()();Wd=!1,Ad.clear(),ah(r)}function a2(r){if(r.fragment!==null){r.update(),Tf(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Gd)}}function l2(r){const e=[],n=[];Hc.forEach(o=>r.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),Hc=e}const c2=new Set;function u2(r,e){r&&r.i&&(c2.delete(r),r.i(e))}function h2(r,e,n){const{fragment:o,after_update:c}=r.$$;o&&o.m(e,n),Gd(()=>{const d=r.$$.on_mount.map(Q0).filter($0);r.$$.on_destroy?r.$$.on_destroy.push(...d):Tf(d),r.$$.on_mount=[]}),c.forEach(Gd)}function f2(r,e){const n=r.$$;n.fragment!==null&&(l2(n.after_update),Tf(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function d2(r,e){r.$$.dirty[0]===-1&&(Uc.push(r),o2(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function p2(r,e,n,o,c,d,h=null,a=[-1]){const _=bp;ah(r);const S=r.$$={fragment:null,ctx:[],props:d,update:fh,not_equal:c,bound:qg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:qg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};h&&h(S.root);let k=!1;if(S.ctx=n?n(r,e.props||{},(y,C,...E)=>{const T=E.length?E[0]:C;return S.ctx&&c(S.ctx[y],S.ctx[y]=T)&&(!S.skip_bound&&S.bound[y]&&S.bound[y](T),k&&d2(r,y)),C}):[],S.update(),k=!0,Tf(S.before_update),S.fragment=o?o(S.ctx):!1,e.target){if(e.hydrate){const y=r2(e.target);S.fragment&&S.fragment.l(y),y.forEach(eb)}else S.fragment&&S.fragment.c();e.intro&&u2(r.$$.fragment),h2(r,e.target,e.anchor),tb()}ah(_)}class m2{constructor(){mi(this,"$$"),mi(this,"$$set")}$destroy(){f2(this,1),this.$destroy=fh}$on(e,n){if(!$0(n))return fh;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const c=o.indexOf(n);c!==-1&&o.splice(c,1)}}$set(e){this.$$set&&!t2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const g2="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(g2);function _2(r){let e,n,o;return{c(){e=Zg("svg"),n=Zg("path"),$a(n,"stroke-width","4"),$a(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),$a(n,"class","svelte-gzo3ar"),$a(e,"width",o=r[0]==="list"?20:void 0),$a(e,"viewBox","0 0 70 85"),$a(e,"fill","none"),$a(e,"class","svelte-gzo3ar"),nf(e,"in-map",r[0]!=="list"),nf(e,"list-icon",r[0]==="list")},m(c,d){n2(c,e,d),i2(e,n)},p(c,[d]){d&1&&o!==(o=c[0]==="list"?20:void 0)&&$a(e,"width",o),d&1&&nf(e,"in-map",c[0]!=="list"),d&1&&nf(e,"list-icon",c[0]==="list")},i:fh,o:fh,d(c){c&&eb(e)}}}function y2(r,e,n){let{displayIn:o}=e;return r.$$set=c=>{"displayIn"in c&&n(0,o=c.displayIn)},[o]}class b2 extends m2{constructor(e){super(),p2(this,e,y2,_2,e2,{displayIn:0})}}function Hg(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}const v2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],w2={decimalLatitude:40.123,decimalLongitude:-74.123},x2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],k2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function S2(){const r=[];return v2.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...w2})}),[...r,...x2,...k2]}const T2=S2();T2.map(r=>r.verbatimCoordinates);function dh(r,e,n={}){const o={type:"Feature"};return(n.id===0||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=e||{},o.geometry=r,o}function vp(r,e,n={}){for(const o of r){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let c=0;c<o[o.length-1].length;c++)if(o[o.length-1][c]!==o[0][c])throw new Error("First and last Position are not equivalent.")}return dh({type:"Polygon",coordinates:r},e,n)}function ph(r,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=r,n}function ib(r,e,n={}){return dh({type:"MultiPolygon",coordinates:r},e,n)}var C2=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Md=Math.ceil,qs=Math.floor,fs="[BigNumber Error] ",Xg=fs+"Number primitive has more than 15 significant digits: ",uo=1e14,Oi=14,Kg=9007199254740991,Pd=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],el=1e7,Ts=1e9;function nb(r){var e,n,o,c=z.prototype={constructor:z,toString:null,valueOf:null},d=new z(1),h=20,a=4,_=-7,S=21,k=-1e7,y=1e7,C=!1,E=1,T=0,L={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},R="0123456789abcdefghijklmnopqrstuvwxyz",N=!0;function z(j,U){var X,B,W,ce,pe,be,de,ye,Ie=this;if(!(Ie instanceof z))return new z(j,U);if(U==null){if(j&&j._isBigNumber===!0){Ie.s=j.s,!j.c||j.e>y?Ie.c=Ie.e=null:j.e<k?Ie.c=[Ie.e=0]:(Ie.e=j.e,Ie.c=j.c.slice());return}if((be=typeof j=="number")&&j*0==0){if(Ie.s=1/j<0?(j=-j,-1):1,j===~~j){for(ce=0,pe=j;pe>=10;pe/=10,ce++);ce>y?Ie.c=Ie.e=null:(Ie.e=ce,Ie.c=[j]);return}ye=String(j)}else{if(!C2.test(ye=String(j)))return o(Ie,ye,be);Ie.s=ye.charCodeAt(0)==45?(ye=ye.slice(1),-1):1}(ce=ye.indexOf("."))>-1&&(ye=ye.replace(".","")),(pe=ye.search(/e/i))>0?(ce<0&&(ce=pe),ce+=+ye.slice(pe+1),ye=ye.substring(0,pe)):ce<0&&(ce=ye.length)}else{if(Fn(U,2,R.length,"Base"),U==10&&N)return Ie=new z(j),ee(Ie,h+Ie.e+1,a);if(ye=String(j),be=typeof j=="number"){if(j*0!=0)return o(Ie,ye,be,U);if(Ie.s=1/j<0?(ye=ye.slice(1),-1):1,z.DEBUG&&ye.replace(/^0\.0*|\./,"").length>15)throw Error(Xg+j)}else Ie.s=ye.charCodeAt(0)===45?(ye=ye.slice(1),-1):1;for(X=R.slice(0,U),ce=pe=0,de=ye.length;pe<de;pe++)if(X.indexOf(B=ye.charAt(pe))<0){if(B=="."){if(pe>ce){ce=de;continue}}else if(!W&&(ye==ye.toUpperCase()&&(ye=ye.toLowerCase())||ye==ye.toLowerCase()&&(ye=ye.toUpperCase()))){W=!0,pe=-1,ce=0;continue}return o(Ie,String(j),be,U)}be=!1,ye=n(ye,U,10,Ie.s),(ce=ye.indexOf("."))>-1?ye=ye.replace(".",""):ce=ye.length}for(pe=0;ye.charCodeAt(pe)===48;pe++);for(de=ye.length;ye.charCodeAt(--de)===48;);if(ye=ye.slice(pe,++de)){if(de-=pe,be&&z.DEBUG&&de>15&&(j>Kg||j!==qs(j)))throw Error(Xg+Ie.s*j);if((ce=ce-pe-1)>y)Ie.c=Ie.e=null;else if(ce<k)Ie.c=[Ie.e=0];else{if(Ie.e=ce,Ie.c=[],pe=(ce+1)%Oi,ce<0&&(pe+=Oi),pe<de){for(pe&&Ie.c.push(+ye.slice(0,pe)),de-=Oi;pe<de;)Ie.c.push(+ye.slice(pe,pe+=Oi));pe=Oi-(ye=ye.slice(pe)).length}else pe-=de;for(;pe--;ye+="0");Ie.c.push(+ye)}}else Ie.c=[Ie.e=0]}z.clone=nb,z.ROUND_UP=0,z.ROUND_DOWN=1,z.ROUND_CEIL=2,z.ROUND_FLOOR=3,z.ROUND_HALF_UP=4,z.ROUND_HALF_DOWN=5,z.ROUND_HALF_EVEN=6,z.ROUND_HALF_CEIL=7,z.ROUND_HALF_FLOOR=8,z.EUCLID=9,z.config=z.set=function(j){var U,X;if(j!=null)if(typeof j=="object"){if(j.hasOwnProperty(U="DECIMAL_PLACES")&&(X=j[U],Fn(X,0,Ts,U),h=X),j.hasOwnProperty(U="ROUNDING_MODE")&&(X=j[U],Fn(X,0,8,U),a=X),j.hasOwnProperty(U="EXPONENTIAL_AT")&&(X=j[U],X&&X.pop?(Fn(X[0],-1e9,0,U),Fn(X[1],0,Ts,U),_=X[0],S=X[1]):(Fn(X,-1e9,Ts,U),_=-(S=X<0?-X:X))),j.hasOwnProperty(U="RANGE"))if(X=j[U],X&&X.pop)Fn(X[0],-1e9,-1,U),Fn(X[1],1,Ts,U),k=X[0],y=X[1];else if(Fn(X,-1e9,Ts,U),X)k=-(y=X<0?-X:X);else throw Error(fs+U+" cannot be zero: "+X);if(j.hasOwnProperty(U="CRYPTO"))if(X=j[U],X===!!X)if(X)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))C=X;else throw C=!X,Error(fs+"crypto unavailable");else C=X;else throw Error(fs+U+" not true or false: "+X);if(j.hasOwnProperty(U="MODULO_MODE")&&(X=j[U],Fn(X,0,9,U),E=X),j.hasOwnProperty(U="POW_PRECISION")&&(X=j[U],Fn(X,0,Ts,U),T=X),j.hasOwnProperty(U="FORMAT"))if(X=j[U],typeof X=="object")L=X;else throw Error(fs+U+" not an object: "+X);if(j.hasOwnProperty(U="ALPHABET"))if(X=j[U],typeof X=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(X))N=X.slice(0,10)=="0123456789",R=X;else throw Error(fs+U+" invalid: "+X)}else throw Error(fs+"Object expected: "+j);return{DECIMAL_PLACES:h,ROUNDING_MODE:a,EXPONENTIAL_AT:[_,S],RANGE:[k,y],CRYPTO:C,MODULO_MODE:E,POW_PRECISION:T,FORMAT:L,ALPHABET:R}},z.isBigNumber=function(j){if(!j||j._isBigNumber!==!0)return!1;if(!z.DEBUG)return!0;var U,X,B=j.c,W=j.e,ce=j.s;e:if({}.toString.call(B)=="[object Array]"){if((ce===1||ce===-1)&&W>=-1e9&&W<=Ts&&W===qs(W)){if(B[0]===0){if(W===0&&B.length===1)return!0;break e}if(U=(W+1)%Oi,U<1&&(U+=Oi),String(B[0]).length==U){for(U=0;U<B.length;U++)if(X=B[U],X<0||X>=uo||X!==qs(X))break e;if(X!==0)return!0}}}else if(B===null&&W===null&&(ce===null||ce===1||ce===-1))return!0;throw Error(fs+"Invalid BigNumber: "+j)},z.maximum=z.max=function(){return Q(arguments,-1)},z.minimum=z.min=function(){return Q(arguments,1)},z.random=function(){var j=9007199254740992,U=Math.random()*j&2097151?function(){return qs(Math.random()*j)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(X){var B,W,ce,pe,be,de=0,ye=[],Ie=new z(d);if(X==null?X=h:Fn(X,0,Ts),pe=Md(X/Oi),C)if(crypto.getRandomValues){for(B=crypto.getRandomValues(new Uint32Array(pe*=2));de<pe;)be=B[de]*131072+(B[de+1]>>>11),be>=9e15?(W=crypto.getRandomValues(new Uint32Array(2)),B[de]=W[0],B[de+1]=W[1]):(ye.push(be%1e14),de+=2);de=pe/2}else if(crypto.randomBytes){for(B=crypto.randomBytes(pe*=7);de<pe;)be=(B[de]&31)*281474976710656+B[de+1]*1099511627776+B[de+2]*4294967296+B[de+3]*16777216+(B[de+4]<<16)+(B[de+5]<<8)+B[de+6],be>=9e15?crypto.randomBytes(7).copy(B,de):(ye.push(be%1e14),de+=7);de=pe/7}else throw C=!1,Error(fs+"crypto unavailable");if(!C)for(;de<pe;)be=U(),be<9e15&&(ye[de++]=be%1e14);for(pe=ye[--de],X%=Oi,pe&&X&&(be=Pd[Oi-X],ye[de]=qs(pe/be)*be);ye[de]===0;ye.pop(),de--);if(de<0)ye=[ce=0];else{for(ce=-1;ye[0]===0;ye.splice(0,1),ce-=Oi);for(de=1,be=ye[0];be>=10;be/=10,de++);de<Oi&&(ce-=Oi-de)}return Ie.e=ce,Ie.c=ye,Ie}}(),z.sum=function(){for(var j=1,U=arguments,X=new z(U[0]);j<U.length;)X=X.plus(U[j++]);return X},n=function(){var j="0123456789";function U(X,B,W,ce){for(var pe,be=[0],de,ye=0,Ie=X.length;ye<Ie;){for(de=be.length;de--;be[de]*=B);for(be[0]+=ce.indexOf(X.charAt(ye++)),pe=0;pe<be.length;pe++)be[pe]>W-1&&(be[pe+1]==null&&(be[pe+1]=0),be[pe+1]+=be[pe]/W|0,be[pe]%=W)}return be.reverse()}return function(X,B,W,ce,pe){var be,de,ye,Ie,Me,ot,We,pt,Tt=X.indexOf("."),$e=h,wt=a;for(Tt>=0&&(Ie=T,T=0,X=X.replace(".",""),pt=new z(B),ot=pt.pow(X.length-Tt),T=Ie,pt.c=U(ha(Us(ot.c),ot.e,"0"),10,W,j),pt.e=pt.c.length),We=U(X,B,W,pe?(be=R,j):(be=j,R)),ye=Ie=We.length;We[--Ie]==0;We.pop());if(!We[0])return be.charAt(0);if(Tt<0?--ye:(ot.c=We,ot.e=ye,ot.s=ce,ot=e(ot,pt,$e,wt,W),We=ot.c,Me=ot.r,ye=ot.e),de=ye+$e+1,Tt=We[de],Ie=W/2,Me=Me||de<0||We[de+1]!=null,Me=wt<4?(Tt!=null||Me)&&(wt==0||wt==(ot.s<0?3:2)):Tt>Ie||Tt==Ie&&(wt==4||Me||wt==6&&We[de-1]&1||wt==(ot.s<0?8:7)),de<1||!We[0])X=Me?ha(be.charAt(1),-$e,be.charAt(0)):be.charAt(0);else{if(We.length=de,Me)for(--W;++We[--de]>W;)We[de]=0,de||(++ye,We=[1].concat(We));for(Ie=We.length;!We[--Ie];);for(Tt=0,X="";Tt<=Ie;X+=be.charAt(We[Tt++]));X=ha(X,ye,be.charAt(0))}return X}}(),e=function(){function j(B,W,ce){var pe,be,de,ye,Ie=0,Me=B.length,ot=W%el,We=W/el|0;for(B=B.slice();Me--;)de=B[Me]%el,ye=B[Me]/el|0,pe=We*de+ye*ot,be=ot*de+pe%el*el+Ie,Ie=(be/ce|0)+(pe/el|0)+We*ye,B[Me]=be%ce;return Ie&&(B=[Ie].concat(B)),B}function U(B,W,ce,pe){var be,de;if(ce!=pe)de=ce>pe?1:-1;else for(be=de=0;be<ce;be++)if(B[be]!=W[be]){de=B[be]>W[be]?1:-1;break}return de}function X(B,W,ce,pe){for(var be=0;ce--;)B[ce]-=be,be=B[ce]<W[ce]?1:0,B[ce]=be*pe+B[ce]-W[ce];for(;!B[0]&&B.length>1;B.splice(0,1));}return function(B,W,ce,pe,be){var de,ye,Ie,Me,ot,We,pt,Tt,$e,wt,St,Ht,oi,Mi,Pi,Ti,At,Xe=B.s==W.s?1:-1,Pt=B.c,ni=W.c;if(!Pt||!Pt[0]||!ni||!ni[0])return new z(!B.s||!W.s||(Pt?ni&&Pt[0]==ni[0]:!ni)?NaN:Pt&&Pt[0]==0||!ni?Xe*0:Xe/0);for(Tt=new z(Xe),$e=Tt.c=[],ye=B.e-W.e,Xe=ce+ye+1,be||(be=uo,ye=Zs(B.e/Oi)-Zs(W.e/Oi),Xe=Xe/Oi|0),Ie=0;ni[Ie]==(Pt[Ie]||0);Ie++);if(ni[Ie]>(Pt[Ie]||0)&&ye--,Xe<0)$e.push(1),Me=!0;else{for(Mi=Pt.length,Ti=ni.length,Ie=0,Xe+=2,ot=qs(be/(ni[0]+1)),ot>1&&(ni=j(ni,ot,be),Pt=j(Pt,ot,be),Ti=ni.length,Mi=Pt.length),oi=Ti,wt=Pt.slice(0,Ti),St=wt.length;St<Ti;wt[St++]=0);At=ni.slice(),At=[0].concat(At),Pi=ni[0],ni[1]>=be/2&&Pi++;do{if(ot=0,de=U(ni,wt,Ti,St),de<0){if(Ht=wt[0],Ti!=St&&(Ht=Ht*be+(wt[1]||0)),ot=qs(Ht/Pi),ot>1)for(ot>=be&&(ot=be-1),We=j(ni,ot,be),pt=We.length,St=wt.length;U(We,wt,pt,St)==1;)ot--,X(We,Ti<pt?At:ni,pt,be),pt=We.length,de=1;else ot==0&&(de=ot=1),We=ni.slice(),pt=We.length;if(pt<St&&(We=[0].concat(We)),X(wt,We,St,be),St=wt.length,de==-1)for(;U(ni,wt,Ti,St)<1;)ot++,X(wt,Ti<St?At:ni,St,be),St=wt.length}else de===0&&(ot++,wt=[0]);$e[Ie++]=ot,wt[0]?wt[St++]=Pt[oi]||0:(wt=[Pt[oi]],St=1)}while((oi++<Mi||wt[0]!=null)&&Xe--);Me=wt[0]!=null,$e[0]||$e.splice(0,1)}if(be==uo){for(Ie=1,Xe=$e[0];Xe>=10;Xe/=10,Ie++);ee(Tt,ce+(Tt.e=Ie+ye*Oi-1)+1,pe,Me)}else Tt.e=ye,Tt.r=+Me;return Tt}}();function V(j,U,X,B){var W,ce,pe,be,de;if(X==null?X=a:Fn(X,0,8),!j.c)return j.toString();if(W=j.c[0],pe=j.e,U==null)de=Us(j.c),de=B==1||B==2&&(pe<=_||pe>=S)?sf(de,pe):ha(de,pe,"0");else if(j=ee(new z(j),U,X),ce=j.e,de=Us(j.c),be=de.length,B==1||B==2&&(U<=ce||ce<=_)){for(;be<U;de+="0",be++);de=sf(de,ce)}else if(U-=pe,de=ha(de,ce,"0"),ce+1>be){if(--U>0)for(de+=".";U--;de+="0");}else if(U+=ce-be,U>0)for(ce+1==be&&(de+=".");U--;de+="0");return j.s<0&&W?"-"+de:de}function Q(j,U){for(var X,B,W=1,ce=new z(j[0]);W<j.length;W++)B=new z(j[W]),(!B.s||(X=Dl(ce,B))===U||X===0&&ce.s===U)&&(ce=B);return ce}function oe(j,U,X){for(var B=1,W=U.length;!U[--W];U.pop());for(W=U[0];W>=10;W/=10,B++);return(X=B+X*Oi-1)>y?j.c=j.e=null:X<k?j.c=[j.e=0]:(j.e=X,j.c=U),j}o=function(){var j=/^(-?)0([xbo])(?=\w[\w.]*$)/i,U=/^([^.]+)\.$/,X=/^\.([^.]+)$/,B=/^-?(Infinity|NaN)$/,W=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(ce,pe,be,de){var ye,Ie=be?pe:pe.replace(W,"");if(B.test(Ie))ce.s=isNaN(Ie)?null:Ie<0?-1:1;else{if(!be&&(Ie=Ie.replace(j,function(Me,ot,We){return ye=(We=We.toLowerCase())=="x"?16:We=="b"?2:8,!de||de==ye?ot:Me}),de&&(ye=de,Ie=Ie.replace(U,"$1").replace(X,"0.$1")),pe!=Ie))return new z(Ie,ye);if(z.DEBUG)throw Error(fs+"Not a"+(de?" base "+de:"")+" number: "+pe);ce.s=null}ce.c=ce.e=null}}();function ee(j,U,X,B){var W,ce,pe,be,de,ye,Ie,Me=j.c,ot=Pd;if(Me){e:{for(W=1,be=Me[0];be>=10;be/=10,W++);if(ce=U-W,ce<0)ce+=Oi,pe=U,de=Me[ye=0],Ie=qs(de/ot[W-pe-1]%10);else if(ye=Md((ce+1)/Oi),ye>=Me.length)if(B){for(;Me.length<=ye;Me.push(0));de=Ie=0,W=1,ce%=Oi,pe=ce-Oi+1}else break e;else{for(de=be=Me[ye],W=1;be>=10;be/=10,W++);ce%=Oi,pe=ce-Oi+W,Ie=pe<0?0:qs(de/ot[W-pe-1]%10)}if(B=B||U<0||Me[ye+1]!=null||(pe<0?de:de%ot[W-pe-1]),B=X<4?(Ie||B)&&(X==0||X==(j.s<0?3:2)):Ie>5||Ie==5&&(X==4||B||X==6&&(ce>0?pe>0?de/ot[W-pe]:0:Me[ye-1])%10&1||X==(j.s<0?8:7)),U<1||!Me[0])return Me.length=0,B?(U-=j.e+1,Me[0]=ot[(Oi-U%Oi)%Oi],j.e=-U||0):Me[0]=j.e=0,j;if(ce==0?(Me.length=ye,be=1,ye--):(Me.length=ye+1,be=ot[Oi-ce],Me[ye]=pe>0?qs(de/ot[W-pe]%ot[pe])*be:0),B)for(;;)if(ye==0){for(ce=1,pe=Me[0];pe>=10;pe/=10,ce++);for(pe=Me[0]+=be,be=1;pe>=10;pe/=10,be++);ce!=be&&(j.e++,Me[0]==uo&&(Me[0]=1));break}else{if(Me[ye]+=be,Me[ye]!=uo)break;Me[ye--]=0,be=1}for(ce=Me.length;Me[--ce]===0;Me.pop());}j.e>y?j.c=j.e=null:j.e<k&&(j.c=[j.e=0])}return j}function ne(j){var U,X=j.e;return X===null?j.toString():(U=Us(j.c),U=X<=_||X>=S?sf(U,X):ha(U,X,"0"),j.s<0?"-"+U:U)}return c.absoluteValue=c.abs=function(){var j=new z(this);return j.s<0&&(j.s=1),j},c.comparedTo=function(j,U){return Dl(this,new z(j,U))},c.decimalPlaces=c.dp=function(j,U){var X,B,W,ce=this;if(j!=null)return Fn(j,0,Ts),U==null?U=a:Fn(U,0,8),ee(new z(ce),j+ce.e+1,U);if(!(X=ce.c))return null;if(B=((W=X.length-1)-Zs(this.e/Oi))*Oi,W=X[W])for(;W%10==0;W/=10,B--);return B<0&&(B=0),B},c.dividedBy=c.div=function(j,U){return e(this,new z(j,U),h,a)},c.dividedToIntegerBy=c.idiv=function(j,U){return e(this,new z(j,U),0,1)},c.exponentiatedBy=c.pow=function(j,U){var X,B,W,ce,pe,be,de,ye,Ie,Me=this;if(j=new z(j),j.c&&!j.isInteger())throw Error(fs+"Exponent not an integer: "+ne(j));if(U!=null&&(U=new z(U)),be=j.e>14,!Me.c||!Me.c[0]||Me.c[0]==1&&!Me.e&&Me.c.length==1||!j.c||!j.c[0])return Ie=new z(Math.pow(+ne(Me),be?j.s*(2-rf(j)):+ne(j))),U?Ie.mod(U):Ie;if(de=j.s<0,U){if(U.c?!U.c[0]:!U.s)return new z(NaN);B=!de&&Me.isInteger()&&U.isInteger(),B&&(Me=Me.mod(U))}else{if(j.e>9&&(Me.e>0||Me.e<-1||(Me.e==0?Me.c[0]>1||be&&Me.c[1]>=24e7:Me.c[0]<8e13||be&&Me.c[0]<=9999975e7)))return ce=Me.s<0&&rf(j)?-0:0,Me.e>-1&&(ce=1/ce),new z(de?1/ce:ce);T&&(ce=Md(T/Oi+2))}for(be?(X=new z(.5),de&&(j.s=1),ye=rf(j)):(W=Math.abs(+ne(j)),ye=W%2),Ie=new z(d);;){if(ye){if(Ie=Ie.times(Me),!Ie.c)break;ce?Ie.c.length>ce&&(Ie.c.length=ce):B&&(Ie=Ie.mod(U))}if(W){if(W=qs(W/2),W===0)break;ye=W%2}else if(j=j.times(X),ee(j,j.e+1,1),j.e>14)ye=rf(j);else{if(W=+ne(j),W===0)break;ye=W%2}Me=Me.times(Me),ce?Me.c&&Me.c.length>ce&&(Me.c.length=ce):B&&(Me=Me.mod(U))}return B?Ie:(de&&(Ie=d.div(Ie)),U?Ie.mod(U):ce?ee(Ie,T,a,pe):Ie)},c.integerValue=function(j){var U=new z(this);return j==null?j=a:Fn(j,0,8),ee(U,U.e+1,j)},c.isEqualTo=c.eq=function(j,U){return Dl(this,new z(j,U))===0},c.isFinite=function(){return!!this.c},c.isGreaterThan=c.gt=function(j,U){return Dl(this,new z(j,U))>0},c.isGreaterThanOrEqualTo=c.gte=function(j,U){return(U=Dl(this,new z(j,U)))===1||U===0},c.isInteger=function(){return!!this.c&&Zs(this.e/Oi)>this.c.length-2},c.isLessThan=c.lt=function(j,U){return Dl(this,new z(j,U))<0},c.isLessThanOrEqualTo=c.lte=function(j,U){return(U=Dl(this,new z(j,U)))===-1||U===0},c.isNaN=function(){return!this.s},c.isNegative=function(){return this.s<0},c.isPositive=function(){return this.s>0},c.isZero=function(){return!!this.c&&this.c[0]==0},c.minus=function(j,U){var X,B,W,ce,pe=this,be=pe.s;if(j=new z(j,U),U=j.s,!be||!U)return new z(NaN);if(be!=U)return j.s=-U,pe.plus(j);var de=pe.e/Oi,ye=j.e/Oi,Ie=pe.c,Me=j.c;if(!de||!ye){if(!Ie||!Me)return Ie?(j.s=-U,j):new z(Me?pe:NaN);if(!Ie[0]||!Me[0])return Me[0]?(j.s=-U,j):new z(Ie[0]?pe:a==3?-0:0)}if(de=Zs(de),ye=Zs(ye),Ie=Ie.slice(),be=de-ye){for((ce=be<0)?(be=-be,W=Ie):(ye=de,W=Me),W.reverse(),U=be;U--;W.push(0));W.reverse()}else for(B=(ce=(be=Ie.length)<(U=Me.length))?be:U,be=U=0;U<B;U++)if(Ie[U]!=Me[U]){ce=Ie[U]<Me[U];break}if(ce&&(W=Ie,Ie=Me,Me=W,j.s=-j.s),U=(B=Me.length)-(X=Ie.length),U>0)for(;U--;Ie[X++]=0);for(U=uo-1;B>be;){if(Ie[--B]<Me[B]){for(X=B;X&&!Ie[--X];Ie[X]=U);--Ie[X],Ie[B]+=uo}Ie[B]-=Me[B]}for(;Ie[0]==0;Ie.splice(0,1),--ye);return Ie[0]?oe(j,Ie,ye):(j.s=a==3?-1:1,j.c=[j.e=0],j)},c.modulo=c.mod=function(j,U){var X,B,W=this;return j=new z(j,U),!W.c||!j.s||j.c&&!j.c[0]?new z(NaN):!j.c||W.c&&!W.c[0]?new z(W):(E==9?(B=j.s,j.s=1,X=e(W,j,0,3),j.s=B,X.s*=B):X=e(W,j,0,E),j=W.minus(X.times(j)),!j.c[0]&&E==1&&(j.s=W.s),j)},c.multipliedBy=c.times=function(j,U){var X,B,W,ce,pe,be,de,ye,Ie,Me,ot,We,pt,Tt,$e,wt=this,St=wt.c,Ht=(j=new z(j,U)).c;if(!St||!Ht||!St[0]||!Ht[0])return!wt.s||!j.s||St&&!St[0]&&!Ht||Ht&&!Ht[0]&&!St?j.c=j.e=j.s=null:(j.s*=wt.s,!St||!Ht?j.c=j.e=null:(j.c=[0],j.e=0)),j;for(B=Zs(wt.e/Oi)+Zs(j.e/Oi),j.s*=wt.s,de=St.length,Me=Ht.length,de<Me&&(pt=St,St=Ht,Ht=pt,W=de,de=Me,Me=W),W=de+Me,pt=[];W--;pt.push(0));for(Tt=uo,$e=el,W=Me;--W>=0;){for(X=0,ot=Ht[W]%$e,We=Ht[W]/$e|0,pe=de,ce=W+pe;ce>W;)ye=St[--pe]%$e,Ie=St[pe]/$e|0,be=We*ye+Ie*ot,ye=ot*ye+be%$e*$e+pt[ce]+X,X=(ye/Tt|0)+(be/$e|0)+We*Ie,pt[ce--]=ye%Tt;pt[ce]=X}return X?++B:pt.splice(0,1),oe(j,pt,B)},c.negated=function(){var j=new z(this);return j.s=-j.s||null,j},c.plus=function(j,U){var X,B=this,W=B.s;if(j=new z(j,U),U=j.s,!W||!U)return new z(NaN);if(W!=U)return j.s=-U,B.minus(j);var ce=B.e/Oi,pe=j.e/Oi,be=B.c,de=j.c;if(!ce||!pe){if(!be||!de)return new z(W/0);if(!be[0]||!de[0])return de[0]?j:new z(be[0]?B:W*0)}if(ce=Zs(ce),pe=Zs(pe),be=be.slice(),W=ce-pe){for(W>0?(pe=ce,X=de):(W=-W,X=be),X.reverse();W--;X.push(0));X.reverse()}for(W=be.length,U=de.length,W-U<0&&(X=de,de=be,be=X,U=W),W=0;U;)W=(be[--U]=be[U]+de[U]+W)/uo|0,be[U]=uo===be[U]?0:be[U]%uo;return W&&(be=[W].concat(be),++pe),oe(j,be,pe)},c.precision=c.sd=function(j,U){var X,B,W,ce=this;if(j!=null&&j!==!!j)return Fn(j,1,Ts),U==null?U=a:Fn(U,0,8),ee(new z(ce),j,U);if(!(X=ce.c))return null;if(W=X.length-1,B=W*Oi+1,W=X[W]){for(;W%10==0;W/=10,B--);for(W=X[0];W>=10;W/=10,B++);}return j&&ce.e+1>B&&(B=ce.e+1),B},c.shiftedBy=function(j){return Fn(j,-9007199254740991,Kg),this.times("1e"+j)},c.squareRoot=c.sqrt=function(){var j,U,X,B,W,ce=this,pe=ce.c,be=ce.s,de=ce.e,ye=h+4,Ie=new z("0.5");if(be!==1||!pe||!pe[0])return new z(!be||be<0&&(!pe||pe[0])?NaN:pe?ce:1/0);if(be=Math.sqrt(+ne(ce)),be==0||be==1/0?(U=Us(pe),(U.length+de)%2==0&&(U+="0"),be=Math.sqrt(+U),de=Zs((de+1)/2)-(de<0||de%2),be==1/0?U="5e"+de:(U=be.toExponential(),U=U.slice(0,U.indexOf("e")+1)+de),X=new z(U)):X=new z(be+""),X.c[0]){for(de=X.e,be=de+ye,be<3&&(be=0);;)if(W=X,X=Ie.times(W.plus(e(ce,W,ye,1))),Us(W.c).slice(0,be)===(U=Us(X.c)).slice(0,be))if(X.e<de&&--be,U=U.slice(be-3,be+1),U=="9999"||!B&&U=="4999"){if(!B&&(ee(W,W.e+h+2,0),W.times(W).eq(ce))){X=W;break}ye+=4,be+=4,B=1}else{(!+U||!+U.slice(1)&&U.charAt(0)=="5")&&(ee(X,X.e+h+2,1),j=!X.times(X).eq(ce));break}}return ee(X,X.e+h+1,a,j)},c.toExponential=function(j,U){return j!=null&&(Fn(j,0,Ts),j++),V(this,j,U,1)},c.toFixed=function(j,U){return j!=null&&(Fn(j,0,Ts),j=j+this.e+1),V(this,j,U)},c.toFormat=function(j,U,X){var B,W=this;if(X==null)j!=null&&U&&typeof U=="object"?(X=U,U=null):j&&typeof j=="object"?(X=j,j=U=null):X=L;else if(typeof X!="object")throw Error(fs+"Argument not an object: "+X);if(B=W.toFixed(j,U),W.c){var ce,pe=B.split("."),be=+X.groupSize,de=+X.secondaryGroupSize,ye=X.groupSeparator||"",Ie=pe[0],Me=pe[1],ot=W.s<0,We=ot?Ie.slice(1):Ie,pt=We.length;if(de&&(ce=be,be=de,de=ce,pt-=ce),be>0&&pt>0){for(ce=pt%be||be,Ie=We.substr(0,ce);ce<pt;ce+=be)Ie+=ye+We.substr(ce,be);de>0&&(Ie+=ye+We.slice(ce)),ot&&(Ie="-"+Ie)}B=Me?Ie+(X.decimalSeparator||"")+((de=+X.fractionGroupSize)?Me.replace(new RegExp("\\d{"+de+"}\\B","g"),"$&"+(X.fractionGroupSeparator||"")):Me):Ie}return(X.prefix||"")+B+(X.suffix||"")},c.toFraction=function(j){var U,X,B,W,ce,pe,be,de,ye,Ie,Me,ot,We=this,pt=We.c;if(j!=null&&(be=new z(j),!be.isInteger()&&(be.c||be.s!==1)||be.lt(d)))throw Error(fs+"Argument "+(be.isInteger()?"out of range: ":"not an integer: ")+ne(be));if(!pt)return new z(We);for(U=new z(d),ye=X=new z(d),B=de=new z(d),ot=Us(pt),ce=U.e=ot.length-We.e-1,U.c[0]=Pd[(pe=ce%Oi)<0?Oi+pe:pe],j=!j||be.comparedTo(U)>0?ce>0?U:ye:be,pe=y,y=1/0,be=new z(ot),de.c[0]=0;Ie=e(be,U,0,1),W=X.plus(Ie.times(B)),W.comparedTo(j)!=1;)X=B,B=W,ye=de.plus(Ie.times(W=ye)),de=W,U=be.minus(Ie.times(W=U)),be=W;return W=e(j.minus(X),B,0,1),de=de.plus(W.times(ye)),X=X.plus(W.times(B)),de.s=ye.s=We.s,ce=ce*2,Me=e(ye,B,ce,a).minus(We).abs().comparedTo(e(de,X,ce,a).minus(We).abs())<1?[ye,B]:[de,X],y=pe,Me},c.toNumber=function(){return+ne(this)},c.toPrecision=function(j,U){return j!=null&&Fn(j,1,Ts),V(this,j,U,2)},c.toString=function(j){var U,X=this,B=X.s,W=X.e;return W===null?B?(U="Infinity",B<0&&(U="-"+U)):U="NaN":(j==null?U=W<=_||W>=S?sf(Us(X.c),W):ha(Us(X.c),W,"0"):j===10&&N?(X=ee(new z(X),h+W+1,a),U=ha(Us(X.c),X.e,"0")):(Fn(j,2,R.length,"Base"),U=n(ha(Us(X.c),W,"0"),10,j,B,!0)),B<0&&X.c[0]&&(U="-"+U)),U},c.valueOf=c.toJSON=function(){return ne(this)},c._isBigNumber=!0,c[Symbol.toStringTag]="BigNumber",c[Symbol.for("nodejs.util.inspect.custom")]=c.valueOf,r!=null&&z.set(r),z}function Zs(r){var e=r|0;return r>0||r===e?e:e-1}function Us(r){for(var e,n,o=1,c=r.length,d=r[0]+"";o<c;){for(e=r[o++]+"",n=Oi-e.length;n--;e="0"+e);d+=e}for(c=d.length;d.charCodeAt(--c)===48;);return d.slice(0,c+1||1)}function Dl(r,e){var n,o,c=r.c,d=e.c,h=r.s,a=e.s,_=r.e,S=e.e;if(!h||!a)return null;if(n=c&&!c[0],o=d&&!d[0],n||o)return n?o?0:-a:h;if(h!=a)return h;if(n=h<0,o=_==S,!c||!d)return o?0:!c^n?1:-1;if(!o)return _>S^n?1:-1;for(a=(_=c.length)<(S=d.length)?_:S,h=0;h<a;h++)if(c[h]!=d[h])return c[h]>d[h]^n?1:-1;return _==S?0:_>S^n?1:-1}function Fn(r,e,n,o){if(r<e||r>n||r!==qs(r))throw Error(fs+(o||"Argument")+(typeof r=="number"?r<e||r>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(r))}function rf(r){var e=r.c.length-1;return Zs(r.e/Oi)==e&&r.c[e]%2!=0}function sf(r,e){return(r.length>1?r.charAt(0)+"."+r.slice(1):r)+(e<0?"e":"e+")+e}function ha(r,e,n){var o,c;if(e<0){for(c=n+".";++e;c+=n);r=c+r}else if(o=r.length,++e>o){for(c=n,e-=o;--e;c+=n);r+=c}else e<o&&(r=r.slice(0,e)+"."+r.slice(e));return r}var Do=nb(),E2=class{constructor(r){mi(this,"key"),mi(this,"left",null),mi(this,"right",null),this.key=r}},Ku=class extends E2{constructor(r){super(r)}},I2=class{constructor(){mi(this,"size",0),mi(this,"modificationCount",0),mi(this,"splayCount",0)}splay(r){const e=this.root;if(e==null)return this.compare(r,r),-1;let n=null,o=null,c=null,d=null,h=e;const a=this.compare;let _;for(;;)if(_=a(h.key,r),_>0){let S=h.left;if(S==null||(_=a(S.key,r),_>0&&(h.left=S.right,S.right=h,h=S,S=h.left,S==null)))break;n==null?o=h:n.left=h,n=h,h=S}else if(_<0){let S=h.right;if(S==null||(_=a(S.key,r),_<0&&(h.right=S.left,S.left=h,h=S,S=h.right,S==null)))break;c==null?d=h:c.right=h,c=h,h=S}else break;return c!=null&&(c.right=h.left,h.left=d),n!=null&&(n.left=h.right,h.right=o),this.root!==h&&(this.root=h,this.splayCount++),_}splayMin(r){let e=r,n=e.left;for(;n!=null;){const o=n;e.left=o.right,o.right=e,e=o,n=e.left}return e}splayMax(r){let e=r,n=e.right;for(;n!=null;){const o=n;e.right=o.left,o.left=e,e=o,n=e.right}return e}_delete(r){if(this.root==null||this.splay(r)!=0)return null;let e=this.root;const n=e,o=e.left;if(this.size--,o==null)this.root=e.right;else{const c=e.right;e=this.splayMax(o),e.right=c,this.root=e}return this.modificationCount++,n}addNewRoot(r,e){this.size++,this.modificationCount++;const n=this.root;if(n==null){this.root=r;return}e<0?(r.left=n,r.right=n.right,n.right=null):(r.right=n,r.left=n.left,n.left=null),this.root=r}_first(){const r=this.root;return r==null?null:(this.root=this.splayMin(r),this.root)}_last(){const r=this.root;return r==null?null:(this.root=this.splayMax(r),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(r){return this.validKey(r)&&this.splay(r)==0}defaultCompare(){return(r,e)=>r<e?-1:r>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:r=>{this.root=r},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:r=>{this.splayCount=r},splay:r=>this.splay(r),has:r=>this.has(r)}}},Jg,Yg,gf=class eh extends I2{constructor(e,n){super(),mi(this,"root",null),mi(this,"compare"),mi(this,"validKey"),mi(this,Jg,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=n??(o=>o!=null&&o!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const n of e)this.delete(n)}forEach(e){const n=this[Symbol.iterator]();let o;for(;o=n.next(),!o.done;)e(o.value,o.value,this)}add(e){const n=this.splay(e);return n!=0&&this.addNewRoot(new Ku(e),n),this}addAndReturn(e){const n=this.splay(e);return n!=0&&this.addNewRoot(new Ku(e),n),this.root.key}addAll(e){for(const n of e)this.add(n)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let n=this.root.left;if(n==null)return null;let o=n.right;for(;o!=null;)n=o,o=n.right;return n.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let n=this.root.right;if(n==null)return null;let o=n.left;for(;o!=null;)n=o,o=n.left;return n.key}retainAll(e){const n=new eh(this.compare,this.validKey),o=this.modificationCount;for(const c of e){if(o!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(c)&&this.splay(c)==0&&n.add(this.root.key)}n.size!=this.size&&(this.root=n.root,this.size=n.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const n=new eh(this.compare,this.validKey);for(const o of this)e.has(o)&&n.add(o);return n}difference(e){const n=new eh(this.compare,this.validKey);for(const o of this)e.has(o)||n.add(o);return n}union(e){const n=this.clone();return n.addAll(e),n}clone(){const e=new eh(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function n(c,d){let h,a;do{if(h=c.left,a=c.right,h!=null){const _=new Ku(h.key);d.left=_,n(h,_)}if(a!=null){const _=new Ku(a.key);d.right=_,c=a,d=_}}while(a!=null)}const o=new Ku(e.key);return n(e,o),o}toSet(){return this.clone()}entries(){return new M2(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Yg=Symbol.iterator,Jg=Symbol.toStringTag,Yg)](){return new A2(this.wrap())}},rb=class{constructor(r){mi(this,"tree"),mi(this,"path",new Array),mi(this,"modificationCount",null),mi(this,"splayCount"),this.tree=r,this.splayCount=r.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const r=this.path[this.path.length-1];return this.getValue(r)}rebuildPath(r){this.path.splice(0,this.path.length),this.tree.splay(r),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(r){for(;r!=null;)this.path.push(r),r=r.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let n=this.tree.getRoot();for(;n!=null;)this.path.push(n),n=n.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let r=this.path[this.path.length-1],e=r.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===r;)r=this.path.pop();return this.path.length>0}},A2=class extends rb{getValue(r){return r.key}},M2=class extends rb{getValue(r){return[r.key,r.key]}},sb=r=>()=>r,Hd=r=>{const e=r?(n,o)=>o.minus(n).abs().isLessThanOrEqualTo(r):sb(!1);return(n,o)=>e(n,o)?0:n.comparedTo(o)};function P2(r){const e=r?(n,o,c,d,h)=>n.exponentiatedBy(2).isLessThanOrEqualTo(d.minus(o).exponentiatedBy(2).plus(h.minus(c).exponentiatedBy(2)).times(r)):sb(!1);return(n,o,c)=>{const d=n.x,h=n.y,a=c.x,_=c.y,S=h.minus(_).times(o.x.minus(a)).minus(d.minus(a).times(o.y.minus(_)));return e(S,d,h,a,_)?0:S.comparedTo(0)}}var L2=r=>r,z2=r=>{if(r){const e=new gf(Hd(r)),n=new gf(Hd(r)),o=(d,h)=>h.addAndReturn(d),c=d=>({x:o(d.x,e),y:o(d.y,n)});return c({x:new Do(0),y:new Do(0)}),c}return L2},Xd=r=>({set:e=>{ma=Xd(e)},reset:()=>Xd(r),compare:Hd(r),snap:z2(r),orient:P2(r)}),ma=Xd(),Ju=(r,e)=>r.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(r.ur.x)&&r.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(r.ur.y),Kd=(r,e)=>{if(e.ur.x.isLessThan(r.ll.x)||r.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(r.ll.y)||r.ur.y.isLessThan(e.ll.y))return null;const n=r.ll.x.isLessThan(e.ll.x)?e.ll.x:r.ll.x,o=r.ur.x.isLessThan(e.ur.x)?r.ur.x:e.ur.x,c=r.ll.y.isLessThan(e.ll.y)?e.ll.y:r.ll.y,d=r.ur.y.isLessThan(e.ur.y)?r.ur.y:e.ur.y;return{ll:{x:n,y:c},ur:{x:o,y:d}}},hf=(r,e)=>r.x.times(e.y).minus(r.y.times(e.x)),ob=(r,e)=>r.x.times(e.x).plus(r.y.times(e.y)),_f=r=>ob(r,r).sqrt(),O2=(r,e,n)=>{const o={x:e.x.minus(r.x),y:e.y.minus(r.y)},c={x:n.x.minus(r.x),y:n.y.minus(r.y)};return hf(c,o).div(_f(c)).div(_f(o))},D2=(r,e,n)=>{const o={x:e.x.minus(r.x),y:e.y.minus(r.y)},c={x:n.x.minus(r.x),y:n.y.minus(r.y)};return ob(c,o).div(_f(c)).div(_f(o))},Qg=(r,e,n)=>e.y.isZero()?null:{x:r.x.plus(e.x.div(e.y).times(n.minus(r.y))),y:n},$g=(r,e,n)=>e.x.isZero()?null:{x:n,y:r.y.plus(e.y.div(e.x).times(n.minus(r.x)))},F2=(r,e,n,o)=>{if(e.x.isZero())return $g(n,o,r.x);if(o.x.isZero())return $g(r,e,n.x);if(e.y.isZero())return Qg(n,o,r.y);if(o.y.isZero())return Qg(r,e,n.y);const c=hf(e,o);if(c.isZero())return null;const d={x:n.x.minus(r.x),y:n.y.minus(r.y)},h=hf(d,e).div(c),a=hf(d,o).div(c),_=r.x.plus(a.times(e.x)),S=n.x.plus(h.times(o.x)),k=r.y.plus(a.times(e.y)),y=n.y.plus(h.times(o.y)),C=_.plus(S).div(2),E=k.plus(y).div(2);return{x:C,y:E}},Oo=class ab{constructor(e,n){mi(this,"point"),mi(this,"isLeft"),mi(this,"segment"),mi(this,"otherSE"),mi(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}static compare(e,n){const o=ab.comparePoints(e.point,n.point);return o!==0?o:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:bf.compare(e.segment,n.segment))}static comparePoints(e,n){return e.x.isLessThan(n.x)?-1:e.x.isGreaterThan(n.x)?1:e.y.isLessThan(n.y)?-1:e.y.isGreaterThan(n.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const n=e.point.events;for(let o=0,c=n.length;o<c;o++){const d=n[o];this.point.events.push(d),d.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let n=0;n<e;n++){const o=this.point.events[n];if(o.segment.consumedBy===void 0)for(let c=n+1;c<e;c++){const d=this.point.events[c];d.consumedBy===void 0&&o.otherSE.point.events===d.otherSE.point.events&&o.segment.consume(d.segment)}}}getAvailableLinkedEvents(){const e=[];for(let n=0,o=this.point.events.length;n<o;n++){const c=this.point.events[n];c!==this&&!c.segment.ringOut&&c.segment.isInResult()&&e.push(c)}return e}getLeftmostComparator(e){const n=new Map,o=c=>{const d=c.otherSE;n.set(c,{sine:O2(this.point,e.point,d.point),cosine:D2(this.point,e.point,d.point)})};return(c,d)=>{n.has(c)||o(c),n.has(d)||o(d);const{sine:h,cosine:a}=n.get(c),{sine:_,cosine:S}=n.get(d);return h.isGreaterThanOrEqualTo(0)&&_.isGreaterThanOrEqualTo(0)?a.isLessThan(S)?1:a.isGreaterThan(S)?-1:0:h.isLessThan(0)&&_.isLessThan(0)?a.isLessThan(S)?-1:a.isGreaterThan(S)?1:0:_.isLessThan(h)?-1:_.isGreaterThan(h)?1:0}}},R2=class Jd{constructor(e){mi(this,"events"),mi(this,"poly"),mi(this,"_isExteriorRing"),mi(this,"_enclosingRing"),this.events=e;for(let n=0,o=e.length;n<o;n++)e[n].segment.ringOut=this;this.poly=null}static factory(e){const n=[];for(let o=0,c=e.length;o<c;o++){const d=e[o];if(!d.isInResult()||d.ringOut)continue;let h=null,a=d.leftSE,_=d.rightSE;const S=[a],k=a.point,y=[];for(;h=a,a=_,S.push(a),a.point!==k;)for(;;){const C=a.getAvailableLinkedEvents();if(C.length===0){const L=S[0].point,R=S[S.length-1].point;throw new Error(`Unable to complete output ring starting at [${L.x}, ${L.y}]. Last matching segment found ends at [${R.x}, ${R.y}].`)}if(C.length===1){_=C[0].otherSE;break}let E=null;for(let L=0,R=y.length;L<R;L++)if(y[L].point===a.point){E=L;break}if(E!==null){const L=y.splice(E)[0],R=S.splice(L.index);R.unshift(R[0].otherSE),n.push(new Jd(R.reverse()));continue}y.push({index:S.length,point:a.point});const T=a.getLeftmostComparator(h);_=C.sort(T)[0].otherSE;break}n.push(new Jd(S))}return n}getGeom(){let e=this.events[0].point;const n=[e];for(let S=1,k=this.events.length-1;S<k;S++){const y=this.events[S].point,C=this.events[S+1].point;ma.orient(y,e,C)!==0&&(n.push(y),e=y)}if(n.length===1)return null;const o=n[0],c=n[1];ma.orient(o,e,c)===0&&n.shift(),n.push(n[0]);const d=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:n.length-1,a=this.isExteriorRing()?n.length:-1,_=[];for(let S=h;S!=a;S+=d)_.push([n[S].x.toNumber(),n[S].y.toNumber()]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,n;let o=this.events[0];for(let h=1,a=this.events.length;h<a;h++){const _=this.events[h];Oo.compare(o,_)>0&&(o=_)}let c=o.segment.prevInResult(),d=c?c.prevInResult():null;for(;;){if(!c)return null;if(!d)return c.ringOut;if(d.ringOut!==c.ringOut)return((e=d.ringOut)==null?void 0:e.enclosingRing())!==c.ringOut?c.ringOut:(n=c.ringOut)==null?void 0:n.enclosingRing();c=d.prevInResult(),d=c?c.prevInResult():null}}},e_=class{constructor(r){mi(this,"exteriorRing"),mi(this,"interiorRings"),this.exteriorRing=r,r.poly=this,this.interiorRings=[]}addInterior(r){this.interiorRings.push(r),r.poly=this}getGeom(){const r=this.exteriorRing.getGeom();if(r===null)return null;const e=[r];for(let n=0,o=this.interiorRings.length;n<o;n++){const c=this.interiorRings[n].getGeom();c!==null&&e.push(c)}return e}},B2=class{constructor(r){mi(this,"rings"),mi(this,"polys"),this.rings=r,this.polys=this._composePolys(r)}getGeom(){const r=[];for(let e=0,n=this.polys.length;e<n;e++){const o=this.polys[e].getGeom();o!==null&&r.push(o)}return r}_composePolys(r){var e;const n=[];for(let o=0,c=r.length;o<c;o++){const d=r[o];if(!d.poly)if(d.isExteriorRing())n.push(new e_(d));else{const h=d.enclosingRing();h!=null&&h.poly||n.push(new e_(h)),(e=h==null?void 0:h.poly)==null||e.addInterior(d)}}return n}},N2=class{constructor(r,e=bf.compare){mi(this,"queue"),mi(this,"tree"),mi(this,"segments"),this.queue=r,this.tree=new gf(e),this.segments=[]}process(r){const e=r.segment,n=[];if(r.consumedBy)return r.isLeft?this.queue.delete(r.otherSE):this.tree.delete(e),n;r.isLeft&&this.tree.add(e);let o=e,c=e;do o=this.tree.lastBefore(o);while(o!=null&&o.consumedBy!=null);do c=this.tree.firstAfter(c);while(c!=null&&c.consumedBy!=null);if(r.isLeft){let d=null;if(o){const a=o.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(d=a),!o.isAnEndpoint(a))){const _=this._splitSafely(o,a);for(let S=0,k=_.length;S<k;S++)n.push(_[S])}}let h=null;if(c){const a=c.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(h=a),!c.isAnEndpoint(a))){const _=this._splitSafely(c,a);for(let S=0,k=_.length;S<k;S++)n.push(_[S])}}if(d!==null||h!==null){let a=null;d===null?a=h:h===null?a=d:a=Oo.comparePoints(d,h)<=0?d:h,this.queue.delete(e.rightSE),n.push(e.rightSE);const _=e.split(a);for(let S=0,k=_.length;S<k;S++)n.push(_[S])}n.length>0?(this.tree.delete(e),n.push(r)):(this.segments.push(e),e.prev=o)}else{if(o&&c){const d=o.getIntersection(c);if(d!==null){if(!o.isAnEndpoint(d)){const h=this._splitSafely(o,d);for(let a=0,_=h.length;a<_;a++)n.push(h[a])}if(!c.isAnEndpoint(d)){const h=this._splitSafely(c,d);for(let a=0,_=h.length;a<_;a++)n.push(h[a])}}}this.tree.delete(e)}return n}_splitSafely(r,e){this.tree.delete(r);const n=r.rightSE;this.queue.delete(n);const o=r.split(e);return o.push(n),r.consumedBy===void 0&&this.tree.add(r),o}},j2=class{constructor(){mi(this,"type"),mi(this,"numMultiPolys")}run(r,e,n){th.type=r;const o=[new i_(e,!0)];for(let _=0,S=n.length;_<S;_++)o.push(new i_(n[_],!1));if(th.numMultiPolys=o.length,th.type==="difference"){const _=o[0];let S=1;for(;S<o.length;)Kd(o[S].bbox,_.bbox)!==null?S++:o.splice(S,1)}if(th.type==="intersection")for(let _=0,S=o.length;_<S;_++){const k=o[_];for(let y=_+1,C=o.length;y<C;y++)if(Kd(k.bbox,o[y].bbox)===null)return[]}const c=new gf(Oo.compare);for(let _=0,S=o.length;_<S;_++){const k=o[_].getSweepEvents();for(let y=0,C=k.length;y<C;y++)c.add(k[y])}const d=new N2(c);let h=null;for(c.size!=0&&(h=c.first(),c.delete(h));h;){const _=d.process(h);for(let S=0,k=_.length;S<k;S++){const y=_[S];y.consumedBy===void 0&&c.add(y)}c.size!=0?(h=c.first(),c.delete(h)):h=null}ma.reset();const a=R2.factory(d.segments);return new B2(a).getGeom()}},th=new j2,yf=th,U2=0,bf=class ff{constructor(e,n,o,c){mi(this,"id"),mi(this,"leftSE"),mi(this,"rightSE"),mi(this,"rings"),mi(this,"windings"),mi(this,"ringOut"),mi(this,"consumedBy"),mi(this,"prev"),mi(this,"_prevInResult"),mi(this,"_beforeState"),mi(this,"_afterState"),mi(this,"_isInResult"),this.id=++U2,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=o,this.windings=c}static compare(e,n){const o=e.leftSE.point.x,c=n.leftSE.point.x,d=e.rightSE.point.x,h=n.rightSE.point.x;if(h.isLessThan(o))return 1;if(d.isLessThan(c))return-1;const a=e.leftSE.point.y,_=n.leftSE.point.y,S=e.rightSE.point.y,k=n.rightSE.point.y;if(o.isLessThan(c)){if(_.isLessThan(a)&&_.isLessThan(S))return 1;if(_.isGreaterThan(a)&&_.isGreaterThan(S))return-1;const y=e.comparePoint(n.leftSE.point);if(y<0)return 1;if(y>0)return-1;const C=n.comparePoint(e.rightSE.point);return C!==0?C:-1}if(o.isGreaterThan(c)){if(a.isLessThan(_)&&a.isLessThan(k))return-1;if(a.isGreaterThan(_)&&a.isGreaterThan(k))return 1;const y=n.comparePoint(e.leftSE.point);if(y!==0)return y;const C=e.comparePoint(n.rightSE.point);return C<0?1:C>0?-1:1}if(a.isLessThan(_))return-1;if(a.isGreaterThan(_))return 1;if(d.isLessThan(h)){const y=n.comparePoint(e.rightSE.point);if(y!==0)return y}if(d.isGreaterThan(h)){const y=e.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(!d.eq(h)){const y=S.minus(a),C=d.minus(o),E=k.minus(_),T=h.minus(c);if(y.isGreaterThan(C)&&E.isLessThan(T))return 1;if(y.isLessThan(C)&&E.isGreaterThan(T))return-1}return d.isGreaterThan(h)?1:d.isLessThan(h)||S.isLessThan(k)?-1:S.isGreaterThan(k)?1:e.id<n.id?-1:e.id>n.id?1:0}static fromRing(e,n,o){let c,d,h;const a=Oo.comparePoints(e,n);if(a<0)c=e,d=n,h=1;else if(a>0)c=n,d=e,h=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new Oo(c,!0),S=new Oo(d,!1);return new ff(_,S,[o],[h])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(n)?e:n},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(n)?e:n}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return ma.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const n=this.bbox(),o=e.bbox(),c=Kd(n,o);if(c===null)return null;const d=this.leftSE.point,h=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,S=Ju(n,a)&&this.comparePoint(a)===0,k=Ju(o,d)&&e.comparePoint(d)===0,y=Ju(n,_)&&this.comparePoint(_)===0,C=Ju(o,h)&&e.comparePoint(h)===0;if(k&&S)return C&&!y?h:!C&&y?_:null;if(k)return y&&d.x.eq(_.x)&&d.y.eq(_.y)?null:d;if(S)return C&&h.x.eq(a.x)&&h.y.eq(a.y)?null:a;if(C&&y)return null;if(C)return h;if(y)return _;const E=F2(d,this.vector(),a,e.vector());return E===null||!Ju(c,E)?null:ma.snap(E)}split(e){const n=[],o=e.events!==void 0,c=new Oo(e,!0),d=new Oo(e,!1),h=this.rightSE;this.replaceRightSE(d),n.push(d),n.push(c);const a=new ff(c,h,this.rings.slice(),this.windings.slice());return Oo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Oo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(c.checkForConsuming(),d.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}consume(e){let n=this,o=e;for(;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;const c=ff.compare(n,o);if(c!==0){if(c>0){const d=n;n=o,o=d}if(n.prev===o){const d=n;n=o,o=d}for(let d=0,h=o.rings.length;d<h;d++){const a=o.rings[d],_=o.windings[d],S=n.rings.indexOf(a);S===-1?(n.rings.push(a),n.windings.push(_)):n.windings[S]+=_}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,o=this._afterState.windings,c=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const S=this.rings[a],k=this.windings[a],y=n.indexOf(S);y===-1?(n.push(S),o.push(k)):o[y]+=k}const d=[],h=[];for(let a=0,_=n.length;a<_;a++){if(o[a]===0)continue;const S=n[a],k=S.poly;if(h.indexOf(k)===-1)if(S.isExterior)d.push(k);else{h.indexOf(k)===-1&&h.push(k);const y=d.indexOf(S.poly);y!==-1&&d.splice(y,1)}}for(let a=0,_=d.length;a<_;a++){const S=d[a].multiPoly;c.indexOf(S)===-1&&c.push(S)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(yf.type){case"union":{const o=e.length===0,c=n.length===0;this._isInResult=o!==c;break}case"intersection":{let o,c;e.length<n.length?(o=e.length,c=n.length):(o=n.length,c=e.length),this._isInResult=c===yf.numMultiPolys&&o<c;break}case"xor":{const o=Math.abs(e.length-n.length);this._isInResult=o%2===1;break}case"difference":{const o=c=>c.length===1&&c[0].isSubject;this._isInResult=o(e)!==o(n);break}}return this._isInResult}},t_=class{constructor(r,e,n){if(mi(this,"poly"),mi(this,"isExterior"),mi(this,"segments"),mi(this,"bbox"),!Array.isArray(r)||r.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=n,this.segments=[],typeof r[0][0]!="number"||typeof r[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const o=ma.snap({x:new Do(r[0][0]),y:new Do(r[0][1])});this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};let c=o;for(let d=1,h=r.length;d<h;d++){if(typeof r[d][0]!="number"||typeof r[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=ma.snap({x:new Do(r[d][0]),y:new Do(r[d][1])});a.x.eq(c.x)&&a.y.eq(c.y)||(this.segments.push(bf.fromRing(c,a,this)),a.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.x),a.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.y),a.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.x),a.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.y),c=a)}(!o.x.eq(c.x)||!o.y.eq(c.y))&&this.segments.push(bf.fromRing(c,o,this))}getSweepEvents(){const r=[];for(let e=0,n=this.segments.length;e<n;e++){const o=this.segments[e];r.push(o.leftSE),r.push(o.rightSE)}return r}},V2=class{constructor(r,e){if(mi(this,"multiPoly"),mi(this,"exteriorRing"),mi(this,"interiorRings"),mi(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new t_(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,o=r.length;n<o;n++){const c=new t_(r[n],this,!1);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.interiorRings.push(c)}this.multiPoly=e}getSweepEvents(){const r=this.exteriorRing.getSweepEvents();for(let e=0,n=this.interiorRings.length;e<n;e++){const o=this.interiorRings[e].getSweepEvents();for(let c=0,d=o.length;c<d;c++)r.push(o[c])}return r}},i_=class{constructor(r,e){if(mi(this,"isSubject"),mi(this,"polys"),mi(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof r[0][0][0]=="number"&&(r=[r])}catch{}this.polys=[],this.bbox={ll:{x:new Do(Number.POSITIVE_INFINITY),y:new Do(Number.POSITIVE_INFINITY)},ur:{x:new Do(Number.NEGATIVE_INFINITY),y:new Do(Number.NEGATIVE_INFINITY)}};for(let n=0,o=r.length;n<o;n++){const c=new V2(r[n],this);c.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.bbox.ur.y),this.polys.push(c)}this.isSubject=e}getSweepEvents(){const r=[];for(let e=0,n=this.polys.length;e<n;e++){const o=this.polys[e].getSweepEvents();for(let c=0,d=o.length;c<d;c++)r.push(o[c])}return r}},q2=(r,...e)=>yf.run("union",r,e),Z2=(r,...e)=>yf.run("difference",r,e);ma.set;function lb(r,e,n){if(r!==null)for(var o,c,d,h,a,_,S,k=0,y=0,C,E=r.type,T=E==="FeatureCollection",L=E==="Feature",R=T?r.features.length:1,N=0;N<R;N++){S=T?r.features[N].geometry:L?r.geometry:r,C=S?S.type==="GeometryCollection":!1,a=C?S.geometries.length:1;for(var z=0;z<a;z++){var V=0,Q=0;if(h=C?S.geometries[z]:S,h!==null){_=h.coordinates;var oe=h.type;switch(k=0,oe){case null:break;case"Point":if(e(_,y,N,V,Q)===!1)return!1;y++,V++;break;case"LineString":case"MultiPoint":for(o=0;o<_.length;o++){if(e(_[o],y,N,V,Q)===!1)return!1;y++,oe==="MultiPoint"&&V++}oe==="LineString"&&V++;break;case"Polygon":case"MultiLineString":for(o=0;o<_.length;o++){for(c=0;c<_[o].length-k;c++){if(e(_[o][c],y,N,V,Q)===!1)return!1;y++}oe==="MultiLineString"&&V++,oe==="Polygon"&&Q++}oe==="Polygon"&&V++;break;case"MultiPolygon":for(o=0;o<_.length;o++){for(Q=0,c=0;c<_[o].length;c++){for(d=0;d<_[o][c].length-k;d++){if(e(_[o][c][d],y,N,V,Q)===!1)return!1;y++}Q++}V++}break;case"GeometryCollection":for(o=0;o<h.geometries.length;o++)if(lb(h.geometries[o],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function wp(r,e){var n,o,c,d,h,a,_,S,k,y,C=0,E=r.type==="FeatureCollection",T=r.type==="Feature",L=E?r.features.length:1;for(n=0;n<L;n++){for(a=E?r.features[n].geometry:T?r.geometry:r,S=E?r.features[n].properties:T?r.properties:{},k=E?r.features[n].bbox:T?r.bbox:void 0,y=E?r.features[n].id:T?r.id:void 0,_=a?a.type==="GeometryCollection":!1,h=_?a.geometries.length:1,c=0;c<h;c++){if(d=_?a.geometries[c]:a,d===null){if(e(null,C,S,k,y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(d,C,S,k,y)===!1)return!1;break}case"GeometryCollection":{for(o=0;o<d.geometries.length;o++)if(e(d.geometries[o],C,S,k,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function W2(r,e){wp(r,function(n,o,c,d,h){var a=n===null?null:n.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(dh(n,c,{bbox:d,id:h}),o,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var k=n.coordinates[S],y={type:_,coordinates:k};if(e(dh(y,c),o,S)===!1)return!1}})}function G2(r,e={}){const n=[];if(wp(r,c=>{n.push(c.coordinates)}),n.length<2)throw new Error("Must have at least 2 geometries");const o=q2(n[0],...n.slice(1));return o.length===0?null:o.length===1?vp(o[0],e.properties):ib(o,e.properties)}var cb=G2;function H2(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return lb(r,o=>{n[0]>o[0]&&(n[0]=o[0]),n[1]>o[1]&&(n[1]=o[1]),n[2]<o[0]&&(n[2]=o[0]),n[3]<o[1]&&(n[3]=o[1])}),n}var n_=H2;function X2(r){const e=[];if(wp(r,c=>{e.push(c.coordinates)}),e.length<2)throw new Error("Must have at least two features");const n=r.features[0].properties||{},o=Z2(e[0],...e.slice(1));return o.length===0?null:o.length===1?vp(o[0],n):ib(o,n)}var K2=X2;function J2(r){if(!r)throw new Error("geojson is required");var e=[];return W2(r,function(n){e.push(n)}),ph(e)}var Y2=J2;function r_(r,e){const n=K2(ph([vp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!n)return;n.properties={isMask:!0};const o=Hg(n_(r)),c=(o[2]-o[0])/360/1e3,d=o[0]<-180,h=o[2]>180,a=Y2(r);if(a.features.length>1&&(d||h))for(const _ of a.features){const S=Hg(n_(_));if(h&&S[0]<-180+c)for(const k of _.geometry.coordinates)for(const y of k)y[0]+=360-c;if(d&&S[2]>180-c)for(const k of _.geometry.coordinates)for(const y of k)y[0]-=360-c}e(ph([a.features.length<2?r:cb(a)??r,n]))}const s_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},of="mtlr-gc-full-geom",o_="mtlr-gc-full-geom-fill",a_="mtlr-gc-full-geom-line";function Q2(r,e,n=!0,o=!0,c={},d={},h=s_){let a;const _=[];let S,k,y;function C(){if(!r.loaded){r.once("load",C);return}const R=h?h===!0?s_:h:void 0;if(!(R!=null&&R.fill)&&!(R!=null&&R.line))return;const N=r.getSource(of);if(N)N.setData(y??ph([]));else if(y)r.addSource(of,{type:"geojson",data:y});else return;!r.getLayer(o_)&&R!=null&&R.fill&&r.addLayer({...R==null?void 0:R.fill,id:o_,type:"fill",source:of}),!r.getLayer(a_)&&R!=null&&R.line&&r.addLayer({...R==null?void 0:R.line,id:a_,type:"line",source:of})}function E(R){y=R,C()}r.on("styledata",()=>{setTimeout(()=>{y&&C()})});const T=R=>{a==null||a({type:"mapClick",coordinates:[R.lngLat.lng,R.lngLat.lat]})};function L(R=!1){if(!e)throw new Error;const N=document.createElement("div");return R&&N.classList.add("marker-interactive"),new b2({props:{displayIn:"maplibre"},target:N}),new e.Marker({element:N,offset:[1,-13]})}return{setEventHandler(R){R?(a=R,r.on("click",T)):(a=void 0,r.off("click",T))},flyTo(R,N){r.flyTo({center:R,...N?{zoom:N}:{},...c})},fitBounds(R,N,z){r.fitBounds([[R[0],R[1]],[R[2],R[3]]],{padding:N,...z?{maxZoom:z}:{},...d})},indicateReverse(R){r.getCanvasContainer().style.cursor=R?"crosshair":""},setReverseMarker(R){!e||!n||(k?R?k.setLngLat(R):(k.remove(),k=void 0):R&&(n instanceof Function?k=n(r)??void 0:(k=(typeof n=="object"?new e.Marker(n):L()).setLngLat(R).addTo(r),k.getElement().classList.add("marker-reverse"))))},setFeatures(R,N,z){for(const V of _)V.remove();if(_.length=0,E(void 0),!!e){e:if(N){let V=!1;if(N.geometry.type==="GeometryCollection"){const Q=N.geometry.geometries.filter(oe=>oe.type==="Polygon"||oe.type==="MultiPolygon");t:if(Q.length>0){const oe=cb(ph(Q.map(ee=>dh(ee))));if(!oe)break t;r_({...N,geometry:oe.geometry},E),V=!0}else{const oe=N.geometry.geometries.filter(ee=>ee.type==="LineString"||ee.type==="MultiLineString");oe.length>0&&(E({...N,geometry:{type:"GeometryCollection",geometries:oe}}),V=!0)}}if(!V){if(N.geometry.type==="Polygon"||N.geometry.type==="MultiPolygon")r_(N,E);else if(N.geometry.type==="LineString"||N.geometry.type==="MultiLineString"){E(N);break e}}if(!z&&!N.geometry.type.endsWith("Point"))break e;if(n instanceof Function){const Q=n(r,N);Q&&_.push(Q)}else n&&_.push(typeof n=="object"?new e.Marker(n):L().setLngLat(N.center).addTo(r))}if(o)for(const V of R??[]){if(V===N)continue;let Q;if(o instanceof Function){if(Q=o(r,V),!Q)continue}else Q=(typeof o=="object"?new e.Marker(o):L(!0)).setLngLat(V.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(V.place_type[0]==="reverse"?V.place_name:V.place_name.replace(/,.*/,""))).addTo(r);const oe=Q.getElement();oe.addEventListener("click",ee=>{ee.stopPropagation(),a==null||a({type:"markerClick",id:V.id})}),oe.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:V.id}),Q.togglePopup()}),oe.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:V.id}),Q.togglePopup()}),_.push(Q)}}},setSelectedMarker(R){S&&S.getElement().classList.toggle("marker-selected",!1),S=R>-1?_[R]:void 0,S==null||S.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const R=r.getCenter();return[r.getZoom(),R.lng,R.lat]}}}function $2(r){let e,n;return{c(){e=da("svg"),n=da("path"),fe(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),fe(e,"viewBox","0 0 14 14"),fe(e,"width","13"),fe(e,"height","13"),fe(e,"class","svelte-en2qvf")},m(o,c){we(o,e,c),he(e,n)},p:Ut,i:Ut,o:Ut,d(o){o&&ve(e)}}}class ub extends ci{constructor(e){super(),li(this,e,null,$2,$t,{})}}function ek(r){let e,n;return{c(){e=da("svg"),n=da("path"),fe(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),fe(e,"viewBox","0 0 30 30"),fe(e,"fill","none"),fe(e,"xmlns","http://www.w3.org/2000/svg"),fe(e,"class","svelte-d2loi5")},m(o,c){we(o,e,c),he(e,n)},p:Ut,i:Ut,o:Ut,d(o){o&&ve(e)}}}class hb extends ci{constructor(e){super(),li(this,e,null,ek,$t,{})}}function tk(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[3]+"area.svg")||fe(e,"src",n),fe(e,"alt",r[7]),fe(e,"title",r[7]),fe(e,"class","svelte-w9y5n9")},m(o,c){we(o,e,c)},p(o,c){c&8&&!Wn(e.src,n=o[3]+"area.svg")&&fe(e,"src",n),c&128&&fe(e,"alt",o[7]),c&128&&fe(e,"title",o[7])},d(o){o&&ve(e)}}}function ik(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[3]+"reverse.svg")||fe(e,"src",n),fe(e,"alt",r[7]),fe(e,"title",r[7]),fe(e,"class","svelte-w9y5n9")},m(o,c){we(o,e,c)},p(o,c){c&8&&!Wn(e.src,n=o[3]+"reverse.svg")&&fe(e,"src",n),c&128&&fe(e,"alt",o[7]),c&128&&fe(e,"title",o[7])},d(o){o&&ve(e)}}}function nk(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[3]+"poi.svg")||fe(e,"src",n),fe(e,"alt",r[7]),fe(e,"title",r[7]),fe(e,"class","svelte-w9y5n9")},m(o,c){we(o,e,c)},p(o,c){c&8&&!Wn(e.src,n=o[3]+"poi.svg")&&fe(e,"src",n),c&128&&fe(e,"alt",o[7]),c&128&&fe(e,"title",o[7])},d(o){o&&ve(e)}}}function rk(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[3]+"postal_code.svg")||fe(e,"src",n),fe(e,"alt",r[7]),fe(e,"title",r[7]),fe(e,"class","svelte-w9y5n9")},m(o,c){we(o,e,c)},p(o,c){c&8&&!Wn(e.src,n=o[3]+"postal_code.svg")&&fe(e,"src",n),c&128&&fe(e,"alt",o[7]),c&128&&fe(e,"title",o[7])},d(o){o&&ve(e)}}}function sk(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[3]+"street.svg")||fe(e,"src",n),fe(e,"alt",r[7]),fe(e,"title",r[7]),fe(e,"class","svelte-w9y5n9")},m(o,c){we(o,e,c)},p(o,c){c&8&&!Wn(e.src,n=o[3]+"street.svg")&&fe(e,"src",n),c&128&&fe(e,"alt",o[7]),c&128&&fe(e,"title",o[7])},d(o){o&&ve(e)}}}function ok(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[3]+"road.svg")||fe(e,"src",n),fe(e,"alt",r[7]),fe(e,"title",r[7]),fe(e,"class","svelte-w9y5n9")},m(o,c){we(o,e,c)},p(o,c){c&8&&!Wn(e.src,n=o[3]+"road.svg")&&fe(e,"src",n),c&128&&fe(e,"alt",o[7]),c&128&&fe(e,"title",o[7])},d(o){o&&ve(e)}}}function ak(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[3]+"housenumber.svg")||fe(e,"src",n),fe(e,"alt",r[7]),fe(e,"title",r[7]),fe(e,"class","svelte-w9y5n9")},m(o,c){we(o,e,c)},p(o,c){c&8&&!Wn(e.src,n=o[3]+"housenumber.svg")&&fe(e,"src",n),c&128&&fe(e,"alt",o[7]),c&128&&fe(e,"title",o[7])},d(o){o&&ve(e)}}}function lk(r){let e,n,o,c;return{c(){e=ke("img"),Wn(e.src,n=r[5])||fe(e,"src",n),fe(e,"alt",r[4]),fe(e,"title",r[7]),fe(e,"class","svelte-w9y5n9")},m(d,h){we(d,e,h),o||(c=Zt(e,"error",r[14]),o=!0)},p(d,h){h&32&&!Wn(e.src,n=d[5])&&fe(e,"src",n),h&16&&fe(e,"alt",d[4]),h&128&&fe(e,"title",d[7])},d(d){d&&ve(e),o=!1,c()}}}function ck(r){let e,n;return{c(){e=ke("div"),fe(e,"class","sprite-icon svelte-w9y5n9"),fe(e,"style",n=`
        width: ${r[6].width/Vs}px;
        height: ${r[6].height/Vs}px;
        background-image: url(${r[3]}sprite${Yd}.png);
        background-position: -${r[6].x/Vs}px -${r[6].y/Vs}px;
        background-size: ${ho.width/Vs}px ${ho.height/Vs}px;
      `),fe(e,"title",r[7])},m(o,c){we(o,e,c)},p(o,c){c&72&&n!==(n=`
        width: ${o[6].width/Vs}px;
        height: ${o[6].height/Vs}px;
        background-image: url(${o[3]}sprite${Yd}.png);
        background-position: -${o[6].x/Vs}px -${o[6].y/Vs}px;
        background-size: ${ho.width/Vs}px ${ho.height/Vs}px;
      `)&&fe(e,"style",n),c&128&&fe(e,"title",o[7])},d(o){o&&ve(e)}}}function l_(r){let e,n;return{c(){e=ke("span"),n=vt(r[7]),fe(e,"class","secondary svelte-w9y5n9")},m(o,c){we(o,e,c),he(e,n)},p(o,c){c&128&&vi(n,o[7])},d(o){o&&ve(e)}}}function uk(r){let e,n,o,c,d,h,a,_,S,k=(r[8]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,C,E=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[8],T,L,R=(r[8]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",N,z,V,Q,oe,ee;function ne(B,W){return W&1&&(n=null),W&1&&(o=null),W&1&&(c=null),W&1&&(d=null),ho&&B[6]?ck:B[5]?lk:B[0].address?ak:(n==null&&(n=!!B[0].id.startsWith("road.")),n?ok:(o==null&&(o=!!B[0].id.startsWith("address.")),o?sk:(c==null&&(c=!!B[0].id.startsWith("postal_code.")),c?rk:(d==null&&(d=!!B[0].id.startsWith("poi.")),d?nk:B[8]?ik:tk))))}let j=ne(r,-1),U=j(r),X=E&&l_(r);return{c(){e=ke("li"),U.c(),h=qe(),a=ke("span"),_=ke("span"),S=ke("span"),y=vt(k),C=qe(),X&&X.c(),T=qe(),L=ke("span"),N=vt(R),fe(S,"class","primary svelte-w9y5n9"),fe(_,"class","svelte-w9y5n9"),fe(L,"class","line2 svelte-w9y5n9"),fe(a,"class","texts svelte-w9y5n9"),fe(e,"tabindex","-1"),fe(e,"role","option"),fe(e,"aria-selected",z=r[1]==="selected"),fe(e,"aria-checked",V=r[1]==="picked"),fe(e,"class",Q=Kc(r[1])+" svelte-w9y5n9")},m(B,W){we(B,e,W),U.m(e,null),he(e,h),he(e,a),he(a,_),he(_,S),he(S,y),he(_,C),X&&X.m(_,null),he(a,T),he(a,L),he(L,N),oe||(ee=[Zt(e,"mouseenter",r[13]),Zt(e,"focus",r[15]),Zt(e,"click",r[16])],oe=!0)},p(B,[W]){j===(j=ne(B,W))&&U?U.p(B,W):(U.d(1),U=j(B),U&&(U.c(),U.m(e,h))),W&257&&k!==(k=(B[8]?B[0].place_name:B[0].place_name.replace(/,.*/,""))+"")&&vi(y,k),W&293&&(E=B[2]==="always"||B[2]!=="never"&&!B[0].address&&!B[0].id.startsWith("road.")&&!B[0].id.startsWith("address.")&&!B[0].id.startsWith("postal_code.")&&(!B[0].id.startsWith("poi.")||!B[5])&&!B[8]),E?X?X.p(B,W):(X=l_(B),X.c(),X.m(_,null)):X&&(X.d(1),X=null),W&257&&R!==(R=(B[8]?"":B[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&vi(N,R),W&2&&z!==(z=B[1]==="selected")&&fe(e,"aria-selected",z),W&2&&V!==(V=B[1]==="picked")&&fe(e,"aria-checked",V),W&2&&Q!==(Q=Kc(B[1])+" svelte-w9y5n9")&&fe(e,"class",Q)},i:Ut,o:Ut,d(B){B&&ve(e),U.d(),X&&X.d(),oe=!1,Gn(ee)}}}const fb=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,Yd=fb?"@2x":"",Vs=fb?2:1;let ho,af;function hk(r,e,n){let o,c,d,{feature:h}=e,{style:a="default"}=e,{showPlaceType:_}=e,{missingIconsCache:S}=e,{iconsBaseUrl:k}=e;const y=nl();let C,E,T,L;function R(){af??(af=fetch(`${k}sprite${Yd}.json`).then(j=>j.json()).then(j=>{ho=j}).catch(()=>{ho=null}))}function N(){E&&S.add(E),z()}function z(){ho!==void 0?V():(R(),af==null||af.then(V))}function V(){do{if(L--,n(4,C=o==null?void 0:o[L]),n(6,T=C?ho==null?void 0:ho.icons[C]:void 0),T)break;n(5,E=C?k+C.replace(/ /g,"_")+".svg":void 0)}while(L>-1&&(!E||S.has(E)))}function Q(j){Di.call(this,r,j)}const oe=()=>N(),ee=()=>y("select",void 0),ne=j=>{document.activeElement!==j.target&&y("select",void 0)};return r.$$set=j=>{"feature"in j&&n(0,h=j.feature),"style"in j&&n(1,a=j.style),"showPlaceType"in j&&n(2,_=j.showPlaceType),"missingIconsCache"in j&&n(11,S=j.missingIconsCache),"iconsBaseUrl"in j&&n(3,k=j.iconsBaseUrl)},r.$$.update=()=>{var j,U,X,B,W;r.$$.dirty&1&&n(12,o=(j=h.properties)==null?void 0:j.categories),r.$$.dirty&1&&n(8,c=h.place_type[0]==="reverse"),r.$$.dirty&1&&n(7,d=((X=(U=h.properties)==null?void 0:U.categories)==null?void 0:X.join(", "))??((W=(B=h.properties)==null?void 0:B.place_type_name)==null?void 0:W[0])??h.place_type[0]),r.$$.dirty&4096&&(L=(o==null?void 0:o.length)??0,z())},[h,a,_,k,C,E,T,d,c,y,N,S,o,Q,oe,ee,ne]}class fk extends ci{constructor(e){super(),li(this,e,hk,uk,$t,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function dk(r){let e;return{c(){e=ke("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',fe(e,"class","svelte-1ocfouu")},m(n,o){we(n,e,o)},p:Ut,i:Ut,o:Ut,d(n){n&&ve(e)}}}class pk extends ci{constructor(e){super(),li(this,e,null,dk,$t,{})}}function mk(r){let e,n;return{c(){e=da("svg"),n=da("path"),fe(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),fe(e,"viewBox","0 0 60.006 21.412"),fe(e,"width","14"),fe(e,"height","20"),fe(e,"class","svelte-en2qvf")},m(o,c){we(o,e,c),he(e,n)},p:Ut,i:Ut,o:Ut,d(o){o&&ve(e)}}}class gk extends ci{constructor(e){super(),li(this,e,null,mk,$t,{})}}function _k(r){let e,n,o;return{c(){e=da("svg"),n=da("circle"),o=da("path"),fe(n,"cx","4.789"),fe(n,"cy","4.787"),fe(n,"r","3.85"),fe(n,"class","svelte-1aq105l"),fe(o,"d","M12.063 12.063 7.635 7.635"),fe(o,"class","svelte-1aq105l"),fe(e,"xmlns","http://www.w3.org/2000/svg"),fe(e,"width","13"),fe(e,"height","13"),fe(e,"viewBox","0 0 13 13"),fe(e,"class","svelte-1aq105l")},m(c,d){we(c,e,d),he(e,n),he(e,o)},p:Ut,i:Ut,o:Ut,d(c){c&&ve(e)}}}class yk extends ci{constructor(e){super(),li(this,e,null,_k,$t,{})}}function bk(r,e,n){const o=e[1],c=e[0],d=o-c;return r===o&&n?r:((r-c)%d+d)%d+c}function c_(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Yu;async function vk(r,e,n){const o=r==null?void 0:r.getCenterAndZoom();for(const c of e??[])if(!(o&&(c.minZoom!=null&&c.minZoom>o[0]||c.maxZoom!=null&&c.maxZoom<o[0]))){if(c.type==="fixed")return c.coordinates.join(",");e:if(c.type==="client-geolocation"){if(Yu&&c.cachedLocationExpiry&&Yu.time+c.cachedLocationExpiry>Date.now()){if(!Yu.coords)break e;return Yu.coords}let d;try{return d=await new Promise((h,a)=>{n.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{h([_.coords.longitude,_.coords.latitude].map(S=>S.toFixed(6)).join(","))},_=>{a(_)},c)}),d}catch{}finally{c.cachedLocationExpiry&&(Yu={time:Date.now(),coords:d})}if(n.signal.aborted)return}if(c.type==="server-geolocation")return"ip";if(o&&c.type==="map-center")return o[1].toFixed(6)+","+o[2].toFixed(6)}}const wk=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,u_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,h_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,f_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,d_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,p_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function xk(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(E=>Number(E.trim())),n=Number(e[0]),o=Number(e[1]),c=Math.abs(n),d=Math.abs(o),h=n>0?"N":"S",a=o>0?"E":"W";let _;r=="DD"&&(_=`${c} ${h}, ${d} ${a}`);const S=Math.floor(c),k=Math.floor(d),y=(c-S)*60,C=(d-k)*60;if(r=="DM"){let E=m_(y,3).toFixed(3).padStart(6,"0"),T=m_(C,3).toFixed(3).padStart(6,"0");E.endsWith(".000")&&T.endsWith(".000")&&(E=E.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),_=`${S} ${E}' ${h}, ${k} ${T}' ${a}`}if(r=="DMS"){const E=Math.floor(y),T=Math.floor(C);let L=((y-E)*60).toFixed(1).padStart(4,"0"),R=((C-T)*60).toFixed(1).padStart(4,"0");const N=E.toString().padStart(2,"0"),z=T.toString().padStart(2,"0");L.endsWith(".0")&&R.endsWith(".0")&&(L=L.replace(/\.0$/,""),R=R.replace(/\.0$/,"")),_=`${S} ${N}' ${L}" ${h}, ${k} ${z}' ${R}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function m_(r,e){const n=Math.pow(10,e);return Math.round((r+Number.EPSILON)*n)/n}function xp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let n=null,o=null,c="",d="",h=null,a=[],_=!1;if(wk.test(r))throw new Error("invalid coordinate value");if(u_.test(r))if(a=u_.exec(r),_=Qu(a),_)n=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(n*=-1),o=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(o*=-1),h="DM";else throw new Error("invalid coordinate format");else if(h_.test(r))if(a=h_.exec(r),_=Qu(a),_){if(n=a[2],o=a[6],n.includes(",")&&(n=n.replace(",",".")),o.includes(",")&&(o=o.replace(",",".")),h="DD",Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(o))==Number(o))throw new Error("integer only coordinate provided");a[1]?(c=a[1],d=a[5]):a[4]&&(c=a[4],d=a[8])}else throw new Error("invalid decimal coordinate format");else if(f_.test(r))if(a=f_.exec(r),_=Qu(a),_)n=Math.abs(parseInt(a[2])),a[4]&&(n+=a[4]/60,h="DM"),a[6]&&(n+=a[6].replace(",",".")/3600,h="DMS"),parseInt(a[2])<0&&(n=-1*n),o=Math.abs(parseInt(a[9])),a[11]&&(o+=a[11]/60),a[13]&&(o+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(o=-1*o),a[1]?(c=a[1],d=a[8]):a[7]&&(c=a[7],d=a[14]);else throw new Error("invalid DMS coordinates format");else if(d_.test(r))if(a=d_.exec(r),_=Qu(a),_)n=Math.abs(parseInt(a[2])),a[4]&&(n+=a[4]/60,h="DM"),a[6]&&(n+=a[6]/3600,h="DMS"),parseInt(a[2])<0&&(n=-1*n),o=Math.abs(parseInt(a[10])),a[12]&&(o+=a[12]/60),a[14]&&(o+=a[14]/3600),parseInt(a[10])<0&&(o=-1*o),a[1]?(c=a[1],d=a[9]):a[8]&&(c=a[8],d=a[16]);else throw new Error("invalid DMS coordinates format");else if(p_.test(r)){if(a=p_.exec(r),_=Qu(a),a.filter(S=>S).length<=5)throw new Error("invalid coordinates format");if(_)n=Math.abs(parseInt(a[2])),a[4]&&(n+=a[4].replace(",",".")/60,h="DM"),a[6]&&(n+=a[6].replace(",",".")/3600,h="DMS"),parseInt(a[2])<0&&(n=-1*n),o=Math.abs(parseInt(a[10])),a[12]&&(o+=a[12].replace(",",".")/60),a[14]&&(o+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(o=-1*o),a[1]?(c=a[1],d=a[9]):a[8]&&(c=a[8],d=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(o)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if(c&&!d||!c&&d)throw new Error("invalid coordinates value");if(c&&c==d)throw new Error("invalid coordinates format");n.toString().includes(",")&&(n=n.replace(",",".")),o.toString().includes(",")&&(o=o.replace(",","."));let S=/S|SOUTH/i;S.test(c)&&n>0&&(n=-1*n),S=/W|WEST/i,S.test(d)&&o>0&&(o=-1*o);const k=a[0].trim();let y,C;const E=/[,/;\u0020]/g,T=k.match(E);if(T==null){const N=Math.floor(r.length/2);y=k.substring(0,N).trim(),C=k.substring(N).trim()}else{let N;T.length%2==1?N=Math.floor(T.length/2):N=T.length/2-1;let z=0;if(N==0)z=k.indexOf(T[0]),y=k.substring(0,z).trim(),C=k.substring(z+1).trim();else{let V=0,Q=0;for(;V<=N;)z=k.indexOf(T[V],Q),Q=z+1,V++;y=k.substring(0,z).trim(),C=k.substring(z+1).trim()}}const L=y.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");const R=C.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return n=Number(Number(n).toFixed(e)),o=Number(Number(o).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:y,verbatimLongitude:C,decimalLatitude:n,decimalLongitude:o,decimalCoordinates:`${n},${o}`,originalFormat:h,closeEnough:kk,toCoordinateFormat:xk})}else throw new Error("coordinates pattern match failed")}function Qu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,o=/[eastsouthnorthwest]+/i,c=e.length/2;for(let d=0;d<c;d++){const h=e[d],a=e[d+c],_=n.test(h)&&n.test(a),S=o.test(h)&&o.test(a),k=h==a;if(!(h==null&&a==null)){if(h==null||a==null)return!1;if(_||S||k)continue;return!1}}return!0}function g_(r,e){const n=Math.abs(r-e);return Number(n.toFixed(6))<=1e-5}function kk(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return g_(this.decimalLatitude,Number(e[0]))&&g_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const Sk=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});xp.to=Sk;const Tk=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Ck={decimalLatitude:40.123,decimalLongitude:-74.123},Ek=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],Ik=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Ak(){const r=[];return Tk.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...Ck})}),[...r,...Ek,...Ik]}const Mk=Ak();xp.formats=Mk.map(r=>r.verbatimCoordinates);const Pk=xp;function __(r,e,n){const o=r.slice();return o[97]=e[n],o[99]=n,o}function y_(r){let e,n,o,c,d;return n=new ub({}),{c(){e=ke("button"),ht(n.$$.fragment),fe(e,"type","button"),fe(e,"title",r[3]),fe(e,"class","svelte-bz0zu3")},m(h,a){we(h,e,a),ct(n,e,null),o=!0,c||(d=Zt(e,"click",r[78]),c=!0)},p(h,a){(!o||a[0]&8)&&fe(e,"title",h[3])},i(h){o||(Le(n.$$.fragment,h),o=!0)},o(h){Be(n.$$.fragment,h),o=!1},d(h){h&&ve(e),ut(n),c=!1,d()}}}function b_(r){let e,n;return e=new pk({}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function v_(r){let e,n,o,c,d;return n=new gk({}),{c(){e=ke("button"),ht(n.$$.fragment),fe(e,"type","button"),fe(e,"title",r[10]),fe(e,"class","svelte-bz0zu3"),pr(e,"active",r[0])},m(h,a){we(h,e,a),ct(n,e,null),o=!0,c||(d=Zt(e,"click",r[79]),c=!0)},p(h,a){(!o||a[0]&1024)&&fe(e,"title",h[10]),(!o||a[0]&1)&&pr(e,"active",h[0])},i(h){o||(Le(n.$$.fragment,h),o=!0)},o(h){Be(n.$$.fragment,h),o=!1},d(h){h&&ve(e),ut(n),c=!1,d()}}}function Lk(r){let e,n=[],o=new Map,c,d,h,a=Ri(r[13]);const _=S=>S[97].id+(S[97].address?","+S[97].address:"");for(let S=0;S<a.length;S+=1){let k=__(r,a,S),y=_(k);o.set(y,n[S]=w_(y,k))}return{c(){e=ke("ul");for(let S=0;S<n.length;S+=1)n[S].c();fe(e,"class","options svelte-bz0zu3"),fe(e,"role","listbox")},m(S,k){we(S,e,k);for(let y=0;y<n.length;y+=1)n[y]&&n[y].m(e,null);c=!0,d||(h=[Zt(e,"mouseleave",r[27]),Zt(e,"blur",r[83]),Zt(e,"keydown",r[23])],d=!0)},p(S,k){k[0]&102823936&&(a=Ri(S[13]),an(),n=M1(n,k,_,1,S,a,o,e,A1,w_,null,__),ln())},i(S){if(!c){for(let k=0;k<a.length;k+=1)Le(n[k]);c=!0}},o(S){for(let k=0;k<n.length;k+=1)Be(n[k]);c=!1},d(S){S&&ve(e);for(let k=0;k<n.length;k+=1)n[k].d();d=!1,Gn(h)}}}function zk(r){let e,n,o,c,d,h;return n=new hb({}),{c(){e=ke("div"),ht(n.$$.fragment),o=qe(),c=ke("div"),d=vt(r[8]),fe(c,"class","svelte-bz0zu3"),fe(e,"class","no-results svelte-bz0zu3")},m(a,_){we(a,e,_),ct(n,e,null),he(e,o),he(e,c),he(c,d),h=!0},p(a,_){(!h||_[0]&256)&&vi(d,a[8])},i(a){h||(Le(n.$$.fragment,a),h=!0)},o(a){Be(n.$$.fragment,a),h=!1},d(a){a&&ve(e),ut(n)}}}function Ok(r){let e="",n;return{c(){n=vt(e)},m(o,c){we(o,n,c)},p:Ut,i:Ut,o:Ut,d(o){o&&ve(n)}}}function Dk(r){let e,n,o,c,d,h,a,_,S,k,y;return n=new hb({}),_=new ub({}),{c(){e=ke("div"),ht(n.$$.fragment),o=qe(),c=ke("div"),d=vt(r[7]),h=qe(),a=ke("button"),ht(_.$$.fragment),fe(c,"class","svelte-bz0zu3"),fe(a,"class","svelte-bz0zu3"),fe(e,"class","error svelte-bz0zu3")},m(C,E){we(C,e,E),ct(n,e,null),he(e,o),he(e,c),he(c,d),he(e,h),he(e,a),ct(_,a,null),S=!0,k||(y=Zt(a,"click",r[80]),k=!0)},p(C,E){(!S||E[0]&128)&&vi(d,C[7])},i(C){S||(Le(n.$$.fragment,C),Le(_.$$.fragment,C),S=!0)},o(C){Be(n.$$.fragment,C),Be(_.$$.fragment,C),S=!1},d(C){C&&ve(e),ut(n),ut(_),k=!1,y()}}}function w_(r,e){var a;let n,o,c;function d(){return e[81](e[99])}function h(){return e[82](e[97])}return o=new fk({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((a=e[14])==null?void 0:a.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),o.$on("mouseenter",d),o.$on("select",h),{key:r,first:null,c(){n=Mn(),ht(o.$$.fragment),this.first=n},m(_,S){we(_,n,S),ct(o,_,S),c=!0},p(_,S){var y;e=_;const k={};S[0]&8192&&(k.feature=e[97]),S[0]&2048&&(k.showPlaceType=e[11]),S[0]&57344&&(k.style=e[15]===e[99]?"selected":((y=e[14])==null?void 0:y.id)===e[97].id?"picked":"default"),S[0]&4096&&(k.iconsBaseUrl=e[12]),o.$set(k)},i(_){c||(Le(o.$$.fragment,_),c=!0)},o(_){Be(o.$$.fragment,_),c=!1},d(_){_&&ve(n),ut(o,_)}}}function Fk(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,L,R,N,z,V,Q=!1;d=new yk({});let oe=!r[20]&&y_(r),ee=r[20]&&b_(),ne=r[6]==="button"&&v_(r);const j=r[70].default,U=wn(j,r,r[69],null),X=[Dk,Ok,zk,Lk],B=[];function W(ce,pe){var be,de;return ce[19]?0:!ce[16]&&!ce[4]?1:((be=ce[13])==null?void 0:be.length)===0?2:(de=ce[13])!=null&&de.length&&(ce[16]||ce[4])?3:-1}return~(T=W(r))&&(L=B[T]=X[T](r)),{c(){e=qe(),n=ke("form"),o=ke("div"),c=ke("button"),ht(d.$$.fragment),h=qe(),a=ke("input"),_=qe(),S=ke("div"),oe&&oe.c(),k=qe(),ee&&ee.c(),y=qe(),ne&&ne.c(),C=qe(),U&&U.c(),E=qe(),L&&L.c(),fe(c,"class","search-button svelte-bz0zu3"),fe(c,"type","button"),fe(a,"placeholder",r[9]),fe(a,"aria-label",r[9]),fe(a,"class","svelte-bz0zu3"),fe(S,"class","clear-button-container svelte-bz0zu3"),pr(S,"displayable",r[1]!==""),fe(o,"class","input-group svelte-bz0zu3"),fe(n,"class",R=Kc(r[2])+" svelte-bz0zu3"),pr(n,"can-collapse",r[5]&&r[1]==="")},m(ce,pe){we(ce,e,pe),we(ce,n,pe),he(n,o),he(o,c),ct(d,c,null),he(o,h),he(o,a),r[72](a),jr(a,r[1]),he(o,_),he(o,S),oe&&oe.m(S,null),he(S,k),ee&&ee.m(S,null),he(o,y),ne&&ne.m(o,null),he(o,C),U&&U.m(o,null),he(n,E),~T&&B[T].m(n,null),N=!0,z||(V=[Zt(c,"click",r[71]),Zt(a,"input",r[73]),Zt(a,"focus",r[74]),Zt(a,"blur",r[75]),Zt(a,"click",r[76]),Zt(a,"keydown",r[23]),Zt(a,"input",r[24]),Zt(a,"change",r[77]),Zt(n,"submit",ip(r[22]))],z=!0)},p(ce,pe){(!N||pe[0]&512)&&fe(a,"placeholder",ce[9]),(!N||pe[0]&512)&&fe(a,"aria-label",ce[9]),pe[0]&2&&a.value!==ce[1]&&jr(a,ce[1]),ce[20]?oe&&(an(),Be(oe,1,1,()=>{oe=null}),ln()):oe?(oe.p(ce,pe),pe[0]&1048576&&Le(oe,1)):(oe=y_(ce),oe.c(),Le(oe,1),oe.m(S,k)),ce[20]?ee?pe[0]&1048576&&Le(ee,1):(ee=b_(),ee.c(),Le(ee,1),ee.m(S,null)):ee&&(an(),Be(ee,1,1,()=>{ee=null}),ln()),(!N||pe[0]&2)&&pr(S,"displayable",ce[1]!==""),ce[6]==="button"?ne?(ne.p(ce,pe),pe[0]&64&&Le(ne,1)):(ne=v_(ce),ne.c(),Le(ne,1),ne.m(o,C)):ne&&(an(),Be(ne,1,1,()=>{ne=null}),ln()),U&&U.p&&(!N||pe[2]&128)&&kn(U,j,ce,ce[69],N?xn(j,ce[69],pe,null):Sn(ce[69]),null);let be=T;T=W(ce),T===be?~T&&B[T].p(ce,pe):(L&&(an(),Be(B[be],1,1,()=>{B[be]=null}),ln()),~T?(L=B[T],L?L.p(ce,pe):(L=B[T]=X[T](ce),L.c()),Le(L,1),L.m(n,null)):L=null),(!N||pe[0]&4&&R!==(R=Kc(ce[2])+" svelte-bz0zu3"))&&fe(n,"class",R),(!N||pe[0]&38)&&pr(n,"can-collapse",ce[5]&&ce[1]==="")},i(ce){N||(Le(Q),Le(d.$$.fragment,ce),Le(oe),Le(ee),Le(ne),Le(U,ce),Le(L),N=!0)},o(ce){Be(Q),Be(d.$$.fragment,ce),Be(oe),Be(ee),Be(ne),Be(U,ce),Be(L),N=!1},d(ce){ce&&(ve(e),ve(n)),ut(d),r[72](null),oe&&oe.d(),ee&&ee.d(),ne&&ne.d(),U&&U.d(ce),~T&&B[T].d(),z=!1,Gn(V)}}}function Rk(r,e,n){let o,c,d,{$$slots:h={},$$scope:a}=e;const _={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:S=void 0}=e,{apiKey:k=void 0}=e,{bbox:y=void 0}=e,{clearButtonTitle:C="clear"}=e,{clearOnBlur:E=!1}=e,{clearListOnPick:T=!1}=e,{keepListOpen:L=!1}=e,{collapsed:R=!1}=e,{country:N=void 0}=e,{debounceSearch:z=200}=e,{enableReverse:V="never"}=e,{errorMessage:Q="Something went wrong"}=e,{filter:oe=()=>!0}=e,{flyTo:ee=!0}=e,{fuzzyMatch:ne=!0}=e,{language:j=void 0}=e,{limit:U=void 0}=e;const X=41415112612;let{reverseGeocodingLimit:B=X}=e,{mapController:W=void 0}=e,{minLength:ce=2}=e,{noResultsMessage:pe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:be="Search"}=e,{proximity:de=[{type:"server-geolocation"}]}=e,{reverseActive:ye=V==="always"}=e,{reverseButtonTitle:Ie="toggle reverse geocoding"}=e,{searchValue:Me=""}=e,{pickedResultStyle:ot="full-geometry"}=e,{showPlaceType:We="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:Tt=!0}=e,{flyToSelected:$e=!1}=e,{markerOnSelected:wt=!0}=e,{types:St=void 0}=e;const Ht=[];let{reverseGeocodingTypes:oi=Ht}=e,{exhaustiveReverseGeocoding:Mi=!1}=e,{excludeTypes:Pi=!1}=e;const Ti=void 0;let{reverseGeocodingExcludeTypes:At=Ti}=e,{zoom:Xe=_}=e,{apiUrl:Pt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:ni={}}=e,{iconsBaseUrl:Qe="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=e,{adjustUrlQuery:_i=()=>{}}=e,{adjustUrl:_t=()=>{}}=e;function it(Ke){ft.focus(Ke)}function ue(){ft.blur()}function H(Ke,pi=!0,ki=!1){n(1,Me=Ke),pi?(n(15,Wt=-1),_r()):(Se(void 0,!ki,ki),setTimeout(()=>{ft.focus(),ft.select()}))}function Y(){n(13,Ze=void 0),n(14,st=void 0),n(15,Wt=-1)}function Ae(){n(64,dt=[]),n(14,st=void 0)}let Ze,dt,st,Ci="",ft,Wt=-1,Ei,Fi=[],Cn,kt,ui,ii,nn=!1;const gr=new Set,ai=nl();ds(()=>{W&&(W.setEventHandler(void 0),W.indicateReverse(!1),W.setSelectedMarker(-1),W.setFeatures(void 0,void 0,!1))});function _r(Ke){if(n(17,nn=!1),kt&&(clearTimeout(kt),kt=void 0),Wt>-1&&Ze)n(14,st=Ze[Wt]),n(1,Me=st.place_type[0]==="reverse"?st.place_name:st.place_name.replace(/,.*/,"")),n(19,Ei=void 0),n(64,dt=void 0),n(15,Wt=-1);else if(Me){const pi=Ke||!yr(Me);Ir(Me,{exact:!0}).then(()=>{n(64,dt=Ze),n(14,st=void 0),pi&&Ar()}).catch(ki=>n(19,Ei=ki))}}function yr(Ke){try{return Pk(Ke,6)}catch{return!1}}async function Ir(Ke,{byId:pi=!1,exact:ki=!1}={}){var Ki,Ji,jn;n(19,Ei=void 0),Cn==null||Cn.abort();const Ni=new AbortController;n(20,Cn=Ni);try{const si=yr(Ke),$r=new URL(Pt+"/"+encodeURIComponent(si?si.decimalLongitude+","+si.decimalLatitude:Ke)+".json"),Hn=$r.searchParams;j!==void 0&&Hn.set("language",Array.isArray(j)?j.join(","):j??"");const[Un]=(W==null?void 0:W.getCenterAndZoom())??[];let pn=(Ki=!si||oi===Ht?St:oi)==null?void 0:Ki.map(Ii=>typeof Ii=="string"?Ii:Un===void 0||(Ii[0]??0)<=Un&&Un<(Ii[1]??1/0)?Ii[2]:void 0).filter(Ii=>Ii!==void 0);pn&&(pn=[...new Set(pn)],Hn.set("types",pn.join(",")));const _a=!si||At===Ti?Pi:At;if(_a&&Hn.set("excludeTypes",String(_a)),y&&Hn.set("bbox",y.map(Ii=>Ii.toFixed(6)).join(",")),N&&Hn.set("country",Array.isArray(N)?N.join(","):N),!pi&&!si){const Ii=await vk(W,de,Ni);Ii&&Hn.set("proximity",Ii),(ki||!pt)&&Hn.set("autocomplete","false"),Hn.set("fuzzyMatch",String(ne))}const zn=B===X?U:B;zn!==void 0&&zn>1&&(pn==null?void 0:pn.length)!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),si?(zn===1||zn!==void 0&&(Mi||(pn==null?void 0:pn.length)===1))&&Hn.set("limit",String(zn)):U!==void 0&&Hn.set("limit",String(U)),k&&Hn.set("key",k),_i(Hn),_t($r);const Xn=$r.searchParams.get("types")===""&&$r.searchParams.get("excludeTypes")!=="true",Ur=$r.toString();if(Ur===Ci){pi?(T&&n(13,Ze=void 0),n(14,st=Fi[0])):(n(13,Ze=Fi),((Ji=Ze[Wt])==null?void 0:Ji.id)!==(c==null?void 0:c.id)&&n(15,Wt=-1));return}Ci=Ur;let Rn;if(Xn)Rn={type:"FeatureCollection",features:[]};else{const Ii=await fetch(Ur,{signal:Ni.signal,...ni});if(!Ii.ok)throw new Error(await Ii.text());Rn=await Ii.json()}ai("response",{url:Ur,featureCollection:Rn}),pi?(T&&n(13,Ze=void 0),n(14,st=Rn.features[0]),Fi=[st]):(n(13,Ze=Rn.features.filter(oe)),si&&Ze.unshift({type:"Feature",properties:{},id:"reverse_"+si.decimalLongitude+"_"+si.decimalLatitude,text:si.decimalLatitude+", "+si.decimalLongitude,place_name:si.decimalLatitude+", "+si.decimalLongitude,place_type:["reverse"],center:[si.decimalLongitude,si.decimalLatitude],bbox:[si.decimalLongitude,si.decimalLatitude,si.decimalLongitude,si.decimalLatitude],geometry:{type:"Point",coordinates:[si.decimalLongitude,si.decimalLatitude]}}),Fi=Ze,((jn=Ze[Wt])==null?void 0:jn.id)!==(c==null?void 0:c.id)&&n(15,Wt=-1),si&&ft.focus())}catch(si){if(si&&typeof si=="object"&&"name"in si&&si.name==="AbortError")return;throw si}finally{Ni===Cn&&n(20,Cn=void 0)}}function Ar(){var Ni;if(!(dt!=null&&dt.length)||!ee)return;const Ke=[180,90,-180,-90],pi=!dt.some(Ki=>!Ki.matching_text);let ki;for(const Ki of dt){const Ji=te(Ki);if(ki=ki===void 0?Ji:Ji===void 0?ki:Math.max(ki,Ji),pi||!Ki.matching_text)for(const jn of[0,1,2,3])Ke[jn]=Math[jn<2?"min":"max"](Ke[jn],((Ni=Ki.bbox)==null?void 0:Ni[jn])??Ki.center[jn%2])}W&&dt.length>0&&(st&&Ke[0]===Ke[2]&&Ke[1]===Ke[3]?W.flyTo(st.center,te(st)):W.fitBounds(c_(Ke),50,ki))}function Pe(){!st||!W||(!st.bbox||st.bbox[0]===st.bbox[2]&&st.bbox[1]===st.bbox[3]?W.flyTo(st.center,te(st)):W.fitBounds(c_(st.bbox),50,te(st)))}function te(Ke){var ki;if(!Ke.bbox||Ke.bbox[0]!==Ke.bbox[2]&&Ke.bbox[1]!==Ke.bbox[3])return;const pi=Ke.id.replace(/\..*/,"");return(Array.isArray((ki=Ke.properties)==null?void 0:ki.categories)?Ke.properties.categories.reduce((Ni,Ki)=>{const Ji=Xe[pi+"."+Ki];return Ni===void 0?Ji:Ji===void 0?Ni:Math.max(Ni,Ji)},void 0):void 0)??Xe[pi]}function ie(Ke){n(0,ye=V==="always"),n(13,Ze=void 0),n(14,st=void 0),n(15,Wt=-1),H(Ke[1].toFixed(6)+", "+bk(Ke[0],[-180,180],!0).toFixed(6),!1,!0)}function me(Ke){if(!Ze)return;let pi=Ke.key==="ArrowDown"?1:Ke.key==="ArrowUp"?-1:0;pi&&(ft.focus(),n(17,nn=!0),Ke.preventDefault(),st&&Wt===-1&&n(15,Wt=Ze.findIndex(ki=>ki.id===(st==null?void 0:st.id))),Wt===(st||Tt?0:-1)&&pi===-1&&n(15,Wt=Ze.length),n(15,Wt+=pi),Wt>=Ze.length&&n(15,Wt=-1),Wt<0&&(st||Tt)&&n(15,Wt=0))}function Se(Ke,pi=!0,ki=!1){if(n(19,Ei=void 0),n(14,st=void 0),n(17,nn=!0),pt||ki){if(kt&&clearTimeout(kt),Me.length<ce)return;const Ni=Me;kt=window.setTimeout(()=>{Ir(Ni).catch(Ki=>n(19,Ei=Ki))},pi?z:0)}else n(13,Ze=void 0),n(19,Ei=void 0)}function Ue(Ke){st&&(st==null?void 0:st.id)===(Ke==null?void 0:Ke.id)?Pe():(n(14,st=Ke),n(1,Me=Ke.place_name))}function Ge(Ke){n(15,Wt=Ke)}function et(){(!Tt||st)&&n(15,Wt=-1),$e&&Pe()}const Re=()=>ft.focus();function at(Ke){gi[Ke?"unshift":"push"](()=>{ft=Ke,n(18,ft)})}function yt(){Me=this.value,n(1,Me),n(17,nn),n(31,E),n(16,ui)}const rt=()=>n(17,nn=!0),Et=()=>n(17,nn=!1),Yt=()=>n(17,nn=!0),ri=()=>n(14,st=void 0),Bi=()=>{n(1,Me=""),n(14,st=void 0),ft.focus()},wi=()=>n(0,ye=!ye),zi=()=>n(19,Ei=void 0),Si=Ke=>Ge(Ke),hn=Ke=>Ue(Ke),fn=()=>{};return r.$$set=Ke=>{"class"in Ke&&n(2,S=Ke.class),"apiKey"in Ke&&n(29,k=Ke.apiKey),"bbox"in Ke&&n(30,y=Ke.bbox),"clearButtonTitle"in Ke&&n(3,C=Ke.clearButtonTitle),"clearOnBlur"in Ke&&n(31,E=Ke.clearOnBlur),"clearListOnPick"in Ke&&n(32,T=Ke.clearListOnPick),"keepListOpen"in Ke&&n(4,L=Ke.keepListOpen),"collapsed"in Ke&&n(5,R=Ke.collapsed),"country"in Ke&&n(33,N=Ke.country),"debounceSearch"in Ke&&n(34,z=Ke.debounceSearch),"enableReverse"in Ke&&n(6,V=Ke.enableReverse),"errorMessage"in Ke&&n(7,Q=Ke.errorMessage),"filter"in Ke&&n(35,oe=Ke.filter),"flyTo"in Ke&&n(36,ee=Ke.flyTo),"fuzzyMatch"in Ke&&n(37,ne=Ke.fuzzyMatch),"language"in Ke&&n(38,j=Ke.language),"limit"in Ke&&n(39,U=Ke.limit),"reverseGeocodingLimit"in Ke&&n(40,B=Ke.reverseGeocodingLimit),"mapController"in Ke&&n(41,W=Ke.mapController),"minLength"in Ke&&n(42,ce=Ke.minLength),"noResultsMessage"in Ke&&n(8,pe=Ke.noResultsMessage),"placeholder"in Ke&&n(9,be=Ke.placeholder),"proximity"in Ke&&n(43,de=Ke.proximity),"reverseActive"in Ke&&n(0,ye=Ke.reverseActive),"reverseButtonTitle"in Ke&&n(10,Ie=Ke.reverseButtonTitle),"searchValue"in Ke&&n(1,Me=Ke.searchValue),"pickedResultStyle"in Ke&&n(44,ot=Ke.pickedResultStyle),"showPlaceType"in Ke&&n(11,We=Ke.showPlaceType),"showResultsWhileTyping"in Ke&&n(45,pt=Ke.showResultsWhileTyping),"selectFirst"in Ke&&n(46,Tt=Ke.selectFirst),"flyToSelected"in Ke&&n(47,$e=Ke.flyToSelected),"markerOnSelected"in Ke&&n(48,wt=Ke.markerOnSelected),"types"in Ke&&n(49,St=Ke.types),"reverseGeocodingTypes"in Ke&&n(50,oi=Ke.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in Ke&&n(51,Mi=Ke.exhaustiveReverseGeocoding),"excludeTypes"in Ke&&n(52,Pi=Ke.excludeTypes),"reverseGeocodingExcludeTypes"in Ke&&n(53,At=Ke.reverseGeocodingExcludeTypes),"zoom"in Ke&&n(54,Xe=Ke.zoom),"apiUrl"in Ke&&n(55,Pt=Ke.apiUrl),"fetchParameters"in Ke&&n(56,ni=Ke.fetchParameters),"iconsBaseUrl"in Ke&&n(12,Qe=Ke.iconsBaseUrl),"adjustUrlQuery"in Ke&&n(57,_i=Ke.adjustUrlQuery),"adjustUrl"in Ke&&n(58,_t=Ke.adjustUrl),"$$scope"in Ke&&n(69,a=Ke.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&64&&n(0,ye=V==="always"),r.$$.dirty[0]&16384|r.$$.dirty[1]&8192&&ot!=="marker-only"&&st&&!st.address&&st.geometry.type==="Point"&&st.place_type[0]!=="reverse"&&Ir(st.id,{byId:!0}).catch(Ke=>n(19,Ei=Ke)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1058|r.$$.dirty[2]&8&&(W&&st&&st.id!==ii&&ee&&(Pe(),T&&n(13,Ze=void 0),n(64,dt=void 0),n(15,Wt=-1)),n(65,ii=st==null?void 0:st.id)),r.$$.dirty[0]&196608|r.$$.dirty[1]&1&&setTimeout(()=>{n(16,ui=nn),E&&!ui&&n(1,Me="")}),r.$$.dirty[0]&8194|r.$$.dirty[1]&2048&&Me.length<ce&&(n(13,Ze=void 0),n(19,Ei=void 0),n(64,dt=Ze)),r.$$.dirty[0]&57344|r.$$.dirty[1]&32768&&Tt&&Ze!=null&&Ze.length&&Wt==-1&&!st&&n(15,Wt=0),r.$$.dirty[0]&8192|r.$$.dirty[2]&4&&dt!==Ze&&n(64,dt=void 0),r.$$.dirty[0]&73729|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&W&&W.setEventHandler(Ke=>{switch(Ke.type){case"mapClick":ye&&ie(Ke.coordinates);break;case"markerClick":{const pi=Ze==null?void 0:Ze.find(ki=>ki.id===Ke.id);pi&&Ue(pi)}break;case"markerMouseEnter":dt&&n(15,Wt=ui?(Ze==null?void 0:Ze.findIndex(pi=>pi.id===Ke.id))??-1:-1);break;case"markerMouseLeave":dt&&n(15,Wt=-1);break}}),r.$$.dirty[0]&40960&&n(66,c=Ze==null?void 0:Ze[Wt]),r.$$.dirty[1]&66592|r.$$.dirty[2]&16&&W&&c&&ee&&$e&&W.flyTo(c.center,te(c)),r.$$.dirty[1]&8192&&n(68,o=ot==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&132096|r.$$.dirty[2]&64&&(wt||W==null||W.setFeatures(void 0,void 0,o)),r.$$.dirty[0]&16384|r.$$.dirty[1]&132096|r.$$.dirty[2]&84&&W&&wt&&!dt&&(W.setFeatures(c?[c]:void 0,st,o),W.setSelectedMarker(c?0:-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1024|r.$$.dirty[2]&68&&W&&W.setFeatures(dt,st,o),r.$$.dirty[0]&32768|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&dt&&W&&W.setSelectedMarker(Wt),r.$$.dirty[0]&2|r.$$.dirty[1]&1024&&W){const Ke=yr(Me);W.setReverseMarker(Ke?[Ke.decimalLongitude,Ke.decimalLatitude]:void 0)}r.$$.dirty[2]&16&&ai("select",{feature:c}),r.$$.dirty[0]&16384&&ai("pick",{feature:st}),r.$$.dirty[0]&73744&&n(67,d=!!(Ze!=null&&Ze.length)&&(ui||L)),r.$$.dirty[2]&32&&ai("optionsvisibilitychange",{optionsVisible:d}),r.$$.dirty[0]&8192&&ai("featureslisted",{features:Ze}),r.$$.dirty[2]&4&&ai("featuresmarked",{features:dt}),r.$$.dirty[0]&1&&ai("reversetoggle",{reverse:ye}),r.$$.dirty[0]&2&&ai("querychange",{query:Me}),r.$$.dirty[0]&1|r.$$.dirty[1]&1024&&W&&W.indicateReverse(ye)},[ye,Me,S,C,L,R,V,Q,pe,be,Ie,We,Qe,Ze,st,Wt,ui,nn,ft,Ei,Cn,gr,_r,me,Se,Ue,Ge,et,_,k,y,E,T,N,z,oe,ee,ne,j,U,B,W,ce,de,ot,pt,Tt,$e,wt,St,oi,Mi,Pi,At,Xe,Pt,ni,_i,_t,it,ue,H,Y,Ae,dt,ii,c,d,o,a,h,Re,at,yt,rt,Et,Yt,ri,Bi,wi,zi,Si,hn,fn]}class Bk extends ci{constructor(e){super(),li(this,e,Rk,Fk,$t,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}}function x_(r){let e,n,o;return n=new Bk({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=ke("div"),ht(n.$$.fragment),fe(e,"class","svelte-ixhnie")},m(c,d){we(c,e,d),ct(n,e,null),o=!0},p(c,d){const h={};d&4&&(h.mapController=c[2]),d&1&&(h.apiKey=c[0]),d&2&&(h.country=c[1]),n.$set(h)},i(c){o||(Le(n.$$.fragment,c),o=!0)},o(c){Be(n.$$.fragment,c),o=!1},d(c){c&&ve(e),ut(n)}}}function Nk(r){let e,n,o=r[2]&&x_(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),we(c,e,d),n=!0},p(c,[d]){c[2]?o?(o.p(c,d),d&4&&Le(o,1)):(o=x_(c),o.c(),Le(o,1),o.m(e.parentNode,e)):o&&(an(),Be(o,1,1,()=>{o=null}),ln())},i(c){n||(Le(o),n=!0)},o(c){Be(o),n=!1},d(c){c&&ve(e),o&&o.d(c)}}}function jk(r,e,n){let o,{apiKey:c}=e,{map:d}=e,{country:h}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(S){return S?Q2(S,Ws,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=S=>{"apiKey"in S&&n(0,c=S.apiKey),"map"in S&&n(4,d=S.map),"country"in S&&n(1,h=S.country)},r.$$.update=()=>{r.$$.dirty&16&&n(2,o=_(d))},[c,h,o,a,d]}class Uk extends ci{constructor(e){super(),li(this,e,jk,Nk,$t,{apiKey:0,map:4,country:1})}}let Vk=Date.now();function ru(r){return`${r}-${Vk++}`}const kp=Symbol.for("svelte-maplibre");function sl(){return u0(kp)}function qk(r){let e=new WeakMap;return n=>{var h;let o=e.get(n.originalEvent);if(o!==void 0)return o;let d=(h=n.target.queryRenderedFeatures(n.point).find(a=>{var _;return(_=r.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:h.layer.id;return e.set(n.originalEvent,d),d}}function Zk(){let r=new Map;return rp(kp,{map:vn(null),source:Id(null),layer:Id(null),popupTarget:Id(null),cluster:vn(),loadedImages:vn(new Set),minzoom:vn(0),maxzoom:vn(24),layerEvent:vn(null),layerInfo:r,eventTopMost:qk(r),markerClickManager:new Xk})}function k_(r){return{subscribe:r.subscribe}}function db({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:o=!1}){let c=sl(),d=vn(null),h=k_(d),a={...c,[r]:k_(d)};if(e&&(a.popupTarget=h),o){let _=vn(null);a.layerEvent=_,c.layerEvent=_}return n&&(a.cluster=vn()),rp(kp,a),{...c,self:d}}function Wk(){return db({key:"source",setCluster:!0})}function Gk(r=!0){return db({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Hk(r){return"layerType"in r&&r.layerType==="deckgl"}class Xk{constructor(){Zn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const n of this._handlers)n(e)}}function S_(r){let e;return n=>{if(n)for(let o in n){let c=e==null?void 0:e[o],d=n[o];c!==d&&r(o,d,c)}else if(e)for(let o in e)r(o,void 0,e[o]);e=n}}function Kk(r,...e){let n=[r];for(let o of e)if(o)Array.isArray(o)&&o[0]===r?n.push(...o.slice(1)):n.push(o);else continue;if(n.length!==1)return n.length===2?n[1]:n}function Jk(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function mh(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}function T_(r){let e=r[0],n,o,c=C_(r);return{c(){c.c(),n=Mn()},m(d,h){c.m(d,h),we(d,n,h),o=!0},p(d,h){h[0]&1&&$t(e,e=d[0])?(an(),Be(c,1,1,Ut),ln(),c=C_(d),c.c(),Le(c,1),c.m(n.parentNode,n)):c.p(d,h)},i(d){o||(Le(c),o=!0)},o(d){Be(c),o=!1},d(d){d&&ve(n),c.d(d)}}}function C_(r){let e;const n=r[36].default,o=wn(n,r,r[35],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d[1]&16)&&kn(o,n,c,c[35],e?xn(n,c[35],d,null):Sn(c[35]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function Yk(r){let e,n,o=r[0]&&T_(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),we(c,e,d),n=!0},p(c,d){c[0]?o?(o.p(c,d),d[0]&1&&Le(o,1)):(o=T_(c),o.c(),Le(o,1),o.m(e.parentNode,e)):o&&(an(),Be(o,1,1,()=>{o=null}),ln())},i(c){n||(Le(o),n=!0)},o(c){Be(o),n=!1},d(c){c&&ve(e),o&&o.d(c)}}}function Qk(r,e,n){let o,c,d,h,a,_,S,k,y,C,E,T,{$$slots:L={},$$scope:R}=e,{id:N=ru("layer")}=e,{source:z=void 0}=e,{sourceLayer:V=void 0}=e,{beforeId:Q=void 0}=e,{beforeLayerType:oe=void 0}=e,{type:ee}=e,{paint:ne=void 0}=e,{layout:j=void 0}=e,{filter:U=void 0}=e,{applyToClusters:X=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:W=void 0}=e,{manageHoverState:ce=!1}=e,{hovered:pe=null}=e,{interactive:be=!0}=e,{hoverCursor:de=void 0}=e,{eventsIfTopMost:ye=!1}=e;const Ie=nl(),{map:Me,source:ot,self:We,minzoom:pt,maxzoom:Tt,eventTopMost:$e,layerInfo:wt}=Gk();jt(r,Me,Xe=>n(31,y=Xe)),jt(r,ot,Xe=>n(32,C=Xe)),jt(r,We,Xe=>n(0,k=Xe)),jt(r,pt,Xe=>n(34,T=Xe)),jt(r,Tt,Xe=>n(33,E=Xe)),ds(()=>{k&&y&&(wt.delete(k),y==null||y.removeLayer(k))});let St;function Ht(Xe){var _i,_t;if(!be||!k||!y||ye&&$e(Xe)!==k)return;let Pt=Xe.features??[],ni=(_t=(_i=Pt[0])==null?void 0:_i.properties)==null?void 0:_t.cluster_id,Qe={event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt};Ie(Xe.type,Qe)}function oi(Xe){var _i,_t;if(!be||!k||!y||ye&&$e(Xe)!==k)return;de&&(y.getCanvas().style.cursor=de);let Pt=Xe.features??[];n(6,pe=Pt[0]??null);let ni=(_t=(_i=Pt[0])==null?void 0:_i.properties)==null?void 0:_t.cluster_id;Ie("mouseenter",{event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt})}function Mi(Xe){var _i,_t,it;if(!be||!y)return;if(ye&&$e(Xe)!==k){n(6,pe=null),ce&&St!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:V,id:St},{hover:!1}),St=void 0);return}y.getCanvas().style.cursor=de;let Pt=Xe.features??[],ni=(_t=(_i=Pt[0])==null?void 0:_i.properties)==null?void 0:_t.cluster_id,Qe=(it=Pt[0])==null?void 0:it.id;Qe!==St&&(ce&&(St!==void 0&&(y==null||y.setFeatureState({source:a,id:St,sourceLayer:V},{hover:!1})),y==null||y.setFeatureState({source:a,id:Qe,sourceLayer:V},{hover:!0})),St=Qe,n(6,pe=Pt[0]??null)),Ie("mousemove",{event:Xe,map:y,clusterId:ni,layer:k,source:a,features:Pt})}function Pi(Xe){if(!(!be||!k||!y)){if(de&&(y.getCanvas().style.cursor=""),n(6,pe=null),ce&&St!==void 0){const Pt={source:a,id:St,sourceLayer:V};y==null||y.setFeatureState(Pt,{hover:!1}),St=void 0}Ie("mouseleave",{map:y,layer:k,source:a})}}let Ti=!0;function At(Xe){y&&(y.off("click",Xe,Ht),y.off("dblclick",Xe,Ht),y.off("contextmenu",Xe,Ht),y.off("mouseenter",Xe,oi),y.off("mousemove",Xe,Mi),y.off("mouseleave",Xe,Pi))}return ds(()=>{y&&k&&At(k)}),r.$$set=Xe=>{"id"in Xe&&n(7,N=Xe.id),"source"in Xe&&n(8,z=Xe.source),"sourceLayer"in Xe&&n(9,V=Xe.sourceLayer),"beforeId"in Xe&&n(10,Q=Xe.beforeId),"beforeLayerType"in Xe&&n(11,oe=Xe.beforeLayerType),"type"in Xe&&n(12,ee=Xe.type),"paint"in Xe&&n(13,ne=Xe.paint),"layout"in Xe&&n(14,j=Xe.layout),"filter"in Xe&&n(15,U=Xe.filter),"applyToClusters"in Xe&&n(16,X=Xe.applyToClusters),"minzoom"in Xe&&n(17,B=Xe.minzoom),"maxzoom"in Xe&&n(18,W=Xe.maxzoom),"manageHoverState"in Xe&&n(19,ce=Xe.manageHoverState),"hovered"in Xe&&n(6,pe=Xe.hovered),"interactive"in Xe&&n(20,be=Xe.interactive),"hoverCursor"in Xe&&n(21,de=Xe.hoverCursor),"eventsIfTopMost"in Xe&&n(22,ye=Xe.eventsIfTopMost),"$$scope"in Xe&&n(35,R=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,o=Jk(X)),r.$$.dirty[0]&1073774592&&n(24,c=Kk("all",o,U)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,d=B??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,h=W??E),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,a=z||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&k!==N&&a){k&&(At(k),wt.delete(k));let Xe=Q;if(!Q&&oe){let Pt=y.getStyle().layers,ni=typeof oe=="function"?oe:_i=>_i.type===oe,Qe=Pt==null?void 0:Pt.find(ni);Qe&&(Xe=Qe.id)}tn(We,k=N,k),y.addLayer(Zl({id:k,type:ee,source:a,"source-layer":V,filter:c,paint:ne,layout:j,minzoom:d,maxzoom:h}),Xe),n(23,Ti=!0),y.on("click",k,Ht),y.on("dblclick",k,Ht),y.on("contextmenu",k,Ht),y.on("mouseenter",k,oi),y.on("mousemove",k,Mi),y.on("mouseleave",k,Pi)}r.$$.dirty[0]&1048577&&k&&wt.set(k,{interactive:be}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,_=k?S_((Xe,Pt)=>{y!=null&&y.style._loaded?y.setPaintProperty(k,Xe,Pt):y==null||y.once("styledata",()=>y==null?void 0:y.setPaintProperty(k,Xe,Pt))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,S=k?S_((Xe,Pt)=>{y!=null&&y.style._loaded?y.setLayoutProperty(k,Xe,Pt):y==null||y.once("styledata",()=>y==null?void 0:y.setLayoutProperty(k,Xe,Pt))}):void 0),r.$$.dirty[0]&268443648&&(_==null||_(ne)),r.$$.dirty[0]&134234112&&(S==null||S(j)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(y==null||y.setLayerZoomRange(k,d,h)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(Ti?n(23,Ti=!1):y==null||y.setFilter(k,c))},[k,Me,ot,We,pt,Tt,pe,N,z,V,Q,oe,ee,ne,j,U,X,B,W,ce,be,de,ye,Ti,c,h,d,S,_,a,o,y,C,E,T,R,L]}class Cf extends ci{constructor(e){super(),li(this,e,Qk,Yk,$t,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function $k(r){let e;const n=r[16].default,o=wn(n,r,r[24],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&16777216)&&kn(o,n,c,c[24],e?xn(n,c[24],d,null):Sn(c[24]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function eS(r){let e,n,o;function c(h){r[17](h)}let d={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[$k]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new Cf({props:d}),gi.push(()=>Zi(e,"hovered",c)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.applyToClusters=h[9]),a&1024&&(_.minzoom=h[10]),a&2048&&(_.maxzoom=h[11]),a&4096&&(_.hoverCursor=h[12]),a&8192&&(_.manageHoverState=h[13]),a&16384&&(_.eventsIfTopMost=h[14]),a&32768&&(_.interactive=h[15]),a&16777216&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function tS(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=ru("circle")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:Q=!0}=e;function oe(W){z=W,n(0,z)}function ee(W){Di.call(this,r,W)}function ne(W){Di.call(this,r,W)}function j(W){Di.call(this,r,W)}function U(W){Di.call(this,r,W)}function X(W){Di.call(this,r,W)}function B(W){Di.call(this,r,W)}return r.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,h=W.source),"sourceLayer"in W&&n(3,a=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,S=W.beforeLayerType),"paint"in W&&n(6,k=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,C=W.filter),"applyToClusters"in W&&n(9,E=W.applyToClusters),"minzoom"in W&&n(10,T=W.minzoom),"maxzoom"in W&&n(11,L=W.maxzoom),"hoverCursor"in W&&n(12,R=W.hoverCursor),"manageHoverState"in W&&n(13,N=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,V=W.eventsIfTopMost),"interactive"in W&&n(15,Q=W.interactive),"$$scope"in W&&n(24,c=W.$$scope)},[z,d,h,a,_,S,k,y,C,E,T,L,R,N,V,Q,o,oe,ee,ne,j,U,X,B,c]}class Wl extends ci{constructor(e){super(),li(this,e,tS,eS,$t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function iS(r){let e,n;const o=r[7].default,c=wn(o,r,r[6],null);return{c(){e=ke("div"),c&&c.c(),fe(e,"class",r[1]),pr(e,"maplibregl-ctrl",r[0])},m(d,h){we(d,e,h),c&&c.m(e,null),r[8](e),n=!0},p(d,[h]){c&&c.p&&(!n||h&64)&&kn(c,o,d,d[6],n?xn(o,d[6],h,null):Sn(d[6]),null),(!n||h&2)&&fe(e,"class",d[1]),(!n||h&3)&&pr(e,"maplibregl-ctrl",d[0])},i(d){n||(Le(c,d),n=!0)},o(d){Be(c,d),n=!1},d(d){d&&ve(e),c&&c.d(d),r[8](null)}}}function nS(r,e,n){let o,{$$slots:c={},$$scope:d}=e,{defaultStyling:h=!0}=e,{position:a="top-right"}=e,{class:_=void 0}=e;const{map:S}=sl();jt(r,S,E=>n(5,o=E));let k,y={onAdd(){return k},onRemove(){var E;(E=k==null?void 0:k.parentNode)==null||E.removeChild(k)}};ds(()=>{o==null||o.removeControl(y)});function C(E){gi[E?"unshift":"push"](()=>{k=E,n(2,k)})}return r.$$set=E=>{"defaultStyling"in E&&n(0,h=E.defaultStyling),"position"in E&&n(4,a=E.position),"class"in E&&n(1,_=E.class),"$$scope"in E&&n(6,d=E.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&o&&k&&o.addControl(y,a)},[h,_,k,S,a,o,d,c,C]}class rS extends ci{constructor(e){super(),li(this,e,nS,iS,$t,{defaultStyling:0,position:4,class:1})}}function sS(r){let e;const n=r[15].default,o=wn(n,r,r[23],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&8388608)&&kn(o,n,c,c[23],e?xn(n,c[23],d,null):Sn(c[23]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function oS(r){let e,n,o;function c(h){r[16](h)}let d={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[sS]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new Cf({props:d}),gi.push(()=>Zi(e,"hovered",c)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.minzoom=h[9]),a&1024&&(_.maxzoom=h[10]),a&2048&&(_.hoverCursor=h[11]),a&4096&&(_.manageHoverState=h[12]),a&8192&&(_.eventsIfTopMost=h[13]),a&16384&&(_.interactive=h[14]),a&8388608&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function aS(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=ru("fill")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:R=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:V=!0}=e;function Q(B){N=B,n(0,N)}function oe(B){Di.call(this,r,B)}function ee(B){Di.call(this,r,B)}function ne(B){Di.call(this,r,B)}function j(B){Di.call(this,r,B)}function U(B){Di.call(this,r,B)}function X(B){Di.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,d=B.id),"source"in B&&n(2,h=B.source),"sourceLayer"in B&&n(3,a=B.sourceLayer),"beforeId"in B&&n(4,_=B.beforeId),"beforeLayerType"in B&&n(5,S=B.beforeLayerType),"paint"in B&&n(6,k=B.paint),"layout"in B&&n(7,y=B.layout),"filter"in B&&n(8,C=B.filter),"minzoom"in B&&n(9,E=B.minzoom),"maxzoom"in B&&n(10,T=B.maxzoom),"hoverCursor"in B&&n(11,L=B.hoverCursor),"manageHoverState"in B&&n(12,R=B.manageHoverState),"hovered"in B&&n(0,N=B.hovered),"eventsIfTopMost"in B&&n(13,z=B.eventsIfTopMost),"interactive"in B&&n(14,V=B.interactive),"$$scope"in B&&n(23,c=B.$$scope)},[N,d,h,a,_,S,k,y,C,E,T,L,R,z,V,o,Q,oe,ee,ne,j,U,X,c]}class lS extends ci{constructor(e){super(),li(this,e,aS,oS,$t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function cS(r,e,n){let o;const{map:c}=sl();jt(r,c,_=>n(4,o=_));let{position:d="top-left"}=e,{container:h=void 0}=e,a=null;return ds(()=>{o!=null&&o.loaded()&&a&&o.removeControl(a)}),r.$$set=_=>{"position"in _&&n(1,d=_.position),"container"in _&&n(2,h=_.container)},r.$$.update=()=>{if(r.$$.dirty&30&&o&&!a){let _;typeof h=="string"?_=document.querySelector(h)??void 0:_=h,n(3,a=new Ws.FullscreenControl({container:_})),o.addControl(a,d)}},[c,d,h,a,o]}class uS extends ci{constructor(e){super(),li(this,e,cS,null,$t,{position:1,container:2})}}function hS(r,e,n,o,c){let d=!1;r.getSource(e)&&(d=!0,r.removeSource(e));const h=()=>{o(e)&&(r.addSource(e,n),c())};if(d){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):h())};a()}else h()}function fS(r,e,n){d0().then(()=>{let o=a0(r);if(!o)return;o.getSource(e)===n&&o.removeSource(e)})}function E_(r){let e=r[0],n,o,c=I_(r);return{c(){c.c(),n=Mn()},m(d,h){c.m(d,h),we(d,n,h),o=!0},p(d,h){h&1&&$t(e,e=d[0])?(an(),Be(c,1,1,Ut),ln(),c=I_(d),c.c(),Le(c,1),c.m(n.parentNode,n)):c.p(d,h)},i(d){o||(Le(c),o=!0)},o(d){Be(c),o=!1},d(d){d&&ve(n),c.d(d)}}}function I_(r){let e;const n=r[19].default,o=wn(n,r,r[18],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&262144)&&kn(o,n,c,c[18],e?xn(n,c[18],d,null):Sn(c[18]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function dS(r){let e,n,o=r[0]&&E_(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),we(c,e,d),n=!0},p(c,[d]){c[0]?o?(o.p(c,d),d&1&&Le(o,1)):(o=E_(c),o.c(),Le(o,1),o.m(e.parentNode,e)):o&&(an(),Be(o,1,1,()=>{o=null}),ln())},i(c){n||(Le(o),n=!0)},o(c){Be(o),n=!1},d(c){c&&ve(e),o&&o.d(c)}}}function pS(r,e,n){let o,c,d,{$$slots:h={},$$scope:a}=e,{id:_=ru("geojson")}=e,{data:S}=e,{generateId:k=!1}=e,{promoteId:y=void 0}=e,{filter:C=void 0}=e,{lineMetrics:E=void 0}=e,{cluster:T=void 0}=e,{maxzoom:L=void 0}=e,{attribution:R=void 0}=e,{buffer:N=void 0}=e,{tolerance:z=void 0}=e;const{map:V,cluster:Q,self:oe}=Wk();jt(r,V,j=>n(17,c=j)),jt(r,Q,j=>n(20,d=j)),jt(r,oe,j=>n(0,o=j));let ee,ne=!0;return ds(()=>{o&&ee&&c&&(fS(V,o,ee),tn(oe,o=null,o),n(15,ee=void 0))}),r.$$set=j=>{"id"in j&&n(4,_=j.id),"data"in j&&n(5,S=j.data),"generateId"in j&&n(6,k=j.generateId),"promoteId"in j&&n(7,y=j.promoteId),"filter"in j&&n(8,C=j.filter),"lineMetrics"in j&&n(9,E=j.lineMetrics),"cluster"in j&&n(10,T=j.cluster),"maxzoom"in j&&n(11,L=j.maxzoom),"attribution"in j&&n(12,R=j.attribution),"buffer"in j&&n(13,N=j.buffer),"tolerance"in j&&n(14,z=j.tolerance),"$$scope"in j&&n(18,a=j.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&tn(Q,d=T,d),r.$$.dirty&196593&&c&&o!==_&&(tn(oe,o=_,o),hS(c,o,Zl({type:"geojson",data:S,filter:C,lineMetrics:E,generateId:k,promoteId:y,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties,maxzoom:L,attribution:R,buffer:N,tolerance:z}),j=>c&&j===o,()=>{o&&(n(15,ee=c==null?void 0:c.getSource(o)),n(16,ne=!0))})),r.$$.dirty&131088&&(c==null||c.on("style.load",()=>{n(15,ee=c==null?void 0:c.getSource(_))})),r.$$.dirty&98336&&ee&&(ne?n(16,ne=!1):ee.setData(S)),r.$$.dirty&33792&&(ee==null||ee.setClusterOptions(Zl({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[o,V,Q,oe,_,S,k,y,C,E,T,L,R,N,z,ee,ne,c,a,h]}class Er extends ci{constructor(e){super(),li(this,e,pS,dS,$t,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function mS(r,e,n){let o;const{map:c}=sl();jt(r,c,C=>n(8,o=C));let{position:d="top-left"}=e,{positionOptions:h=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:S=!0}=e,{showUserLocation:k=!0}=e,{control:y=null}=e;return ds(()=>{o!=null&&o.loaded()&&y&&o.removeControl(y)}),r.$$set=C=>{"position"in C&&n(2,d=C.position),"positionOptions"in C&&n(3,h=C.positionOptions),"fitBoundsOptions"in C&&n(4,a=C.fitBoundsOptions),"trackUserLocation"in C&&n(5,_=C.trackUserLocation),"showAccuracyCircle"in C&&n(6,S=C.showAccuracyCircle),"showUserLocation"in C&&n(7,k=C.showUserLocation),"control"in C&&n(1,y=C.control)},r.$$.update=()=>{r.$$.dirty&510&&o&&!y&&(n(1,y=new Ws.GeolocateControl({positionOptions:h,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:S,showUserLocation:k})),o.addControl(y,d))},[c,y,d,h,a,_,S,k,o]}class gS extends ci{constructor(e){super(),li(this,e,mS,null,$t,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function _S(r){let e;const n=r[15].default,o=wn(n,r,r[23],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&8388608)&&kn(o,n,c,c[23],e?xn(n,c[23],d,null):Sn(c[23]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function yS(r){let e,n,o;function c(h){r[16](h)}let d={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[_S]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new Cf({props:d}),gi.push(()=>Zi(e,"hovered",c)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.minzoom=h[9]),a&1024&&(_.maxzoom=h[10]),a&2048&&(_.hoverCursor=h[11]),a&4096&&(_.manageHoverState=h[12]),a&8192&&(_.eventsIfTopMost=h[13]),a&16384&&(_.interactive=h[14]),a&8388608&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function bS(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=ru("line")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:R=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:z=!1}=e,{interactive:V=!0}=e;function Q(B){N=B,n(0,N)}function oe(B){Di.call(this,r,B)}function ee(B){Di.call(this,r,B)}function ne(B){Di.call(this,r,B)}function j(B){Di.call(this,r,B)}function U(B){Di.call(this,r,B)}function X(B){Di.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,d=B.id),"source"in B&&n(2,h=B.source),"sourceLayer"in B&&n(3,a=B.sourceLayer),"beforeId"in B&&n(4,_=B.beforeId),"beforeLayerType"in B&&n(5,S=B.beforeLayerType),"paint"in B&&n(6,k=B.paint),"layout"in B&&n(7,y=B.layout),"filter"in B&&n(8,C=B.filter),"minzoom"in B&&n(9,E=B.minzoom),"maxzoom"in B&&n(10,T=B.maxzoom),"hoverCursor"in B&&n(11,L=B.hoverCursor),"manageHoverState"in B&&n(12,R=B.manageHoverState),"hovered"in B&&n(0,N=B.hovered),"eventsIfTopMost"in B&&n(13,z=B.eventsIfTopMost),"interactive"in B&&n(14,V=B.interactive),"$$scope"in B&&n(23,c=B.$$scope)},[N,d,h,a,_,S,k,y,C,E,T,L,R,z,V,o,Q,oe,ee,ne,j,U,X,c]}class ga extends ci{constructor(e){super(),li(this,e,bS,yS,$t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function vS(r,e,n){let o;const c=nl();let{layer:d=void 0}=e;const{map:h}=sl();jt(r,h,k=>n(2,o=k));function a(k){c(k.type,{...k,map:h})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],S=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ds(()=>{if(o)if(d)for(const k of _)o.off(k,d,a);else for(const k of S)o.off(k,a)}),r.$$set=k=>{"layer"in k&&n(1,d=k.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&o)if(d)for(const k of _)o.on(k,d,a);else for(const k of S)o.on(k,a)},[h,d,o]}class pb extends ci{constructor(e){super(),li(this,e,vS,null,$t,{layer:1})}}function wS(r){let e=r.getCenter(),n=Math.round(r.getZoom()*100)/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,o),d=Math.round(e.lat*c)/c,h=Math.round(e.lng*c)/c,a=`${n}/${d}/${h}`,_=r.getBearing(),S=r.getPitch();return(_||S)&&(a+=`/${Math.round(_*10)/10}`),S&&(a+=`/${Math.round(S)}`),`#${a}`}function xS(r){return r.replace("#","").split("/").map(parseFloat)}function kS(r,e,n){let o;const{map:c}=sl();jt(r,c,k=>n(6,o=k));let{position:d="top-left"}=e,{showCompass:h=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,S=null;return ds(()=>{o!=null&&o.loaded()&&S&&o.removeControl(S)}),r.$$set=k=>{"position"in k&&n(1,d=k.position),"showCompass"in k&&n(2,h=k.showCompass),"showZoom"in k&&n(3,a=k.showZoom),"visualizePitch"in k&&n(4,_=k.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&o&&!S&&(n(5,S=new Ws.NavigationControl({showCompass:h,showZoom:a,visualizePitch:_})),o.addControl(S,d))},[c,d,h,a,_,S,o]}class mb extends ci{constructor(e){super(),li(this,e,kS,null,$t,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function SS(r,e,n){let o;const{map:c}=sl();jt(r,c,S=>n(5,o=S));let{position:d="bottom-left"}=e,{maxWidth:h=void 0}=e,{unit:a="metric"}=e,_=null;return ds(()=>{o!=null&&o.loaded()&&_&&o.removeControl(_)}),r.$$set=S=>{"position"in S&&n(1,d=S.position),"maxWidth"in S&&n(2,h=S.maxWidth),"unit"in S&&n(3,a=S.unit)},r.$$.update=()=>{r.$$.dirty&62&&o&&!_&&(n(4,_=new Ws.ScaleControl({maxWidth:h,unit:a})),o.addControl(_,d))},[c,d,h,a,_,o]}class gb extends ci{constructor(e){super(),li(this,e,SS,null,$t,{position:1,maxWidth:2,unit:3})}}const{window:TS}=c0,CS=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),A_=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function M_(r){let e,n,o=r[3]&&P_(r);const c=r[46].default,d=wn(c,r,r[45],A_);return{c(){o&&o.c(),e=qe(),d&&d.c()},m(h,a){o&&o.m(h,a),we(h,e,a),d&&d.m(h,a),n=!0},p(h,a){h[3]?o?(o.p(h,a),a[0]&8&&Le(o,1)):(o=P_(h),o.c(),Le(o,1),o.m(e.parentNode,e)):o&&(an(),Be(o,1,1,()=>{o=null}),ln()),d&&d.p&&(!n||a[0]&112|a[1]&16384)&&kn(d,c,h,h[45],n?xn(c,h[45],a,CS):Sn(h[45]),A_)},i(h){n||(Le(o),Le(d,h),n=!0)},o(h){Be(o),Be(d,h),n=!1},d(h){h&&ve(e),o&&o.d(h),d&&d.d(h)}}}function P_(r){let e,n,o,c,d,h,a,_;return e=new mb({props:{position:r[7]}}),o=new gS({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),d=new uS({props:{position:r[7]}}),a=new gb({props:{position:r[7]}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment),c=qe(),ht(d.$$.fragment),h=qe(),ht(a.$$.fragment)},m(S,k){ct(e,S,k),we(S,n,k),ct(o,S,k),we(S,c,k),ct(d,S,k),we(S,h,k),ct(a,S,k),_=!0},p(S,k){const y={};k[0]&128&&(y.position=S[7]),e.$set(y);const C={};k[0]&128&&(C.position=S[7]),o.$set(C);const E={};k[0]&128&&(E.position=S[7]),d.$set(E);const T={};k[0]&128&&(T.position=S[7]),a.$set(T)},i(S){_||(Le(e.$$.fragment,S),Le(o.$$.fragment,S),Le(d.$$.fragment,S),Le(a.$$.fragment,S),_=!0)},o(S){Be(e.$$.fragment,S),Be(o.$$.fragment,S),Be(d.$$.fragment,S),Be(a.$$.fragment,S),_=!1},d(S){S&&(ve(n),ve(c),ve(h)),ut(e,S),ut(o,S),ut(d,S),ut(a,S)}}}function ES(r){let e,n,o,c,d,h=r[4]&&r[0]&&M_(r);return{c(){e=ke("div"),h&&h.c(),fe(e,"class",n=Kc(r[2])+" svelte-p00lfq"),fe(e,"data-testid","map-container"),pr(e,"expand-map",!r[2])},m(a,_){we(a,e,_),h&&h.m(e,null),r[47](e),o=!0,c||(d=[Zt(TS,"hashchange",r[11]),w1(r[10].call(null,e))],c=!0)},p(a,_){a[4]&&a[0]?h?(h.p(a,_),_[0]&17&&Le(h,1)):(h=M_(a),h.c(),Le(h,1),h.m(e,null)):h&&(an(),Be(h,1,1,()=>{h=null}),ln()),(!o||_[0]&4&&n!==(n=Kc(a[2])+" svelte-p00lfq"))&&fe(e,"class",n),(!o||_[0]&4)&&pr(e,"expand-map",!a[2])},i(a){o||(Le(h),o=!0)},o(a){Be(h),o=!1},d(a){a&&ve(e),h&&h.d(),r[47](null),c=!1,Gn(d)}}}function IS(r,e,n){let o,c,d,h,{$$slots:a={},$$scope:_}=e,{map:S=null}=e,{mapContainer:k=void 0}=e,{class:y=void 0}=e,{style:C}=e,{diffStyleUpdates:E=!1}=e,{center:T=void 0}=e,{zoom:L=void 0}=e,{pitch:R=0}=e,{bearing:N=0}=e,{bounds:z=void 0}=e,{hash:V=!1}=e,{updateHash:Q=it=>{window.history.replaceState(window.history.state,"",it)}}=e,{loaded:oe=!1}=e,{minZoom:ee=0}=e,{maxZoom:ne=22}=e,{minPitch:j=0}=e,{maxPitch:U=60}=e,{renderWorldCopies:X=void 0}=e,{dragPan:B=void 0}=e,{dragRotate:W=void 0}=e,{pitchWithRotate:ce=void 0}=e,{antialias:pe=void 0}=e,{zoomOnDoubleClick:be=!0}=e,{locale:de=void 0}=e,{interactive:ye=!0}=e,{attributionControl:Ie=!0}=e,{cooperativeGestures:Me=!1}=e,{preserveDrawingBuffer:ot=!1}=e,{maxBounds:We=void 0}=e,{images:pt=[]}=e,{standardControls:Tt=!1}=e,{filterLayers:$e=void 0}=e,{transformRequest:wt=void 0}=e;const St=nl(),{map:Ht,loadedImages:oi}=Zk();jt(r,Ht,it=>n(4,d=it)),jt(r,oi,it=>n(5,h=it));let Mi=new Set;async function Pi(it,ue=!1){if(d&&!(!d.loaded()&&!ue))if("url"in it){Mi.add(it.id);try{let H=await d.loadImage(it.url);d==null||d.addImage(it.id,H.data,it.options),h.add(it.id),oi.set(h)}catch(H){St("error",H)}finally{Mi.delete(it.id)}}else d.addImage(it.id,it.data,it.options),h.add(it.id),oi.set(h)}let Ti,At,Xe,Pt;function ni(it){return _i(),tn(Ht,d=new Ws.Map(Zl({container:it,style:C,locale:de,center:T,zoom:L,pitch:R,bearing:N,minZoom:ee,maxZoom:ne,minPitch:j,maxPitch:U,renderWorldCopies:X,dragPan:B,dragRotate:W,pitchWithRotate:ce,antialias:pe,interactive:ye,preserveDrawingBuffer:ot,maxBounds:We,bounds:z,attributionControl:Ie,transformRequest:wt,cooperativeGestures:Me})),d),d.on("load",ue=>{ue.target.getContainer().setAttribute("data-testid","map"),ue.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,oe=!0),St("load",d)}),d.on("error",ue=>St("error",{...ue,map:d})),d.on("movestart",ue=>St("movestart",{...ue,map:d})),d.on("moveend",ue=>{if(n(12,T=ue.target.getCenter()),n(13,L=ue.target.getZoom()),n(14,R=ue.target.getPitch()),n(15,N=ue.target.getBearing()),n(16,z=ue.target.getBounds()),St("moveend",{...ue,map:d}),V){let H=new URL(window.location.href.replace(/(#.+)?$/,wS(d)));Q(H)}}),d.on("click",ue=>St("click",{...ue,map:d})),d.on("dblclick",ue=>St("dblclick",{...ue,map:d})),d.on("contextmenu",ue=>St("contextmenu",{...ue,map:d})),d.on("zoomstart",ue=>St("zoomstart",{...ue,map:d})),d.on("zoom",ue=>{St("zoom",{...ue,map:d})}),d.on("zoomend",ue=>{St("zoomend",{...ue,map:d})}),d.on("style.load",()=>{if(d){const ue=d.getStyle();if(n(42,Ti=ue.layers.map(H=>H.id)),n(43,At=Object.keys(ue.sources)),Pt)for(const[H,Y]of Object.entries(Pt))d.addSource(H,Y);if(Xe)for(const H of Xe)d.addLayer(H);for(const H of pt)Pi(H,!0)}}),d.on("styledata",ue=>{if(d&&$e){const H=d.getStyle().layers;if(H)for(let Y of H)$e(Y)||d.setLayoutProperty(Y.id,"visibility","none")}St("styledata",{...ue,map:d})}),{destroy(){n(0,oe=!1),d==null||d.remove(),tn(Ht,d=null,d)}}}let Qe=C;function _i(){if(V){let it=xS(window.location.hash);if(it.some(isNaN))return;it.length>=3&&(n(13,L=it[0]),n(12,T=[it[2],it[1]])),it.length==5&&(n(15,N=it[3]),n(14,R=it[4]))}}function _t(it){gi[it?"unshift":"push"](()=>{k=it,n(1,k)})}return r.$$set=it=>{"map"in it&&n(17,S=it.map),"mapContainer"in it&&n(1,k=it.mapContainer),"class"in it&&n(2,y=it.class),"style"in it&&n(18,C=it.style),"diffStyleUpdates"in it&&n(19,E=it.diffStyleUpdates),"center"in it&&n(12,T=it.center),"zoom"in it&&n(13,L=it.zoom),"pitch"in it&&n(14,R=it.pitch),"bearing"in it&&n(15,N=it.bearing),"bounds"in it&&n(16,z=it.bounds),"hash"in it&&n(20,V=it.hash),"updateHash"in it&&n(21,Q=it.updateHash),"loaded"in it&&n(0,oe=it.loaded),"minZoom"in it&&n(22,ee=it.minZoom),"maxZoom"in it&&n(23,ne=it.maxZoom),"minPitch"in it&&n(24,j=it.minPitch),"maxPitch"in it&&n(25,U=it.maxPitch),"renderWorldCopies"in it&&n(26,X=it.renderWorldCopies),"dragPan"in it&&n(27,B=it.dragPan),"dragRotate"in it&&n(28,W=it.dragRotate),"pitchWithRotate"in it&&n(29,ce=it.pitchWithRotate),"antialias"in it&&n(30,pe=it.antialias),"zoomOnDoubleClick"in it&&n(31,be=it.zoomOnDoubleClick),"locale"in it&&n(32,de=it.locale),"interactive"in it&&n(33,ye=it.interactive),"attributionControl"in it&&n(34,Ie=it.attributionControl),"cooperativeGestures"in it&&n(35,Me=it.cooperativeGestures),"preserveDrawingBuffer"in it&&n(36,ot=it.preserveDrawingBuffer),"maxBounds"in it&&n(37,We=it.maxBounds),"images"in it&&n(38,pt=it.images),"standardControls"in it&&n(3,Tt=it.standardControls),"filterLayers"in it&&n(39,$e=it.filterLayers),"transformRequest"in it&&n(40,wt=it.transformRequest),"$$scope"in it&&n(45,_=it.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&n(7,o=typeof Tt=="boolean"?void 0:Tt),r.$$.dirty[0]&16&&n(17,S=d),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&d&&!Rc(C,Qe)){const it=d.getStyle();if(Ti&&(Xe=it.layers.filter(ue=>!Ti.includes(ue.id))),At){const ue=Object.keys(it.sources).filter(H=>!At.includes(H));Pt={};for(const H of ue)Pt[H]=it.sources[H]}n(44,Qe=C),d.setStyle(C,{diff:E}),tn(oi,h=new Set,h),n(41,Mi=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&oe&&d!=null&&d.loaded())for(let it of pt)!h.has(it.id)&&!Mi.has(it.id)&&!d.hasImage(it.id)&&Pi(it);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&n(6,c=pt.every(it=>h.has(it.id))),r.$$.dirty[0]&61456&&d){let it={};T!=null&&!Rc(T,d==null?void 0:d.getCenter())&&(it.center=T),L!=null&&!Rc(L,d==null?void 0:d.getZoom())&&(it.zoom=L),N!=null&&!Rc(N,d==null?void 0:d.getBearing())&&(it.bearing=N),R!=null&&!Rc(R,d==null?void 0:d.getPitch())&&(it.pitch=R),Object.keys(it).length&&d.easeTo(it)}r.$$.dirty[0]&65552&&z&&!Rc(z,d==null?void 0:d.getBounds())&&(d==null||d.fitBounds(z)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(be?d==null||d.doubleClickZoom.enable():d==null||d.doubleClickZoom.disable())},[oe,k,y,Tt,d,h,c,o,Ht,oi,ni,_i,T,L,R,N,z,S,C,E,V,Q,ee,ne,j,U,X,B,W,ce,pe,be,de,ye,Ie,Me,ot,We,pt,$e,wt,Mi,Ti,At,Qe,_,a,_t]}class AS extends ci{constructor(e){super(),li(this,e,IS,ES,$t,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const MS=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),L_=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[32]}};function z_(r){var c;let e,n,o=(((c=r[4])==null?void 0:c.length)||r[3]instanceof Ws.Marker)&&O_(r);return{c(){e=ke("div"),o&&o.c()},m(d,h){we(d,e,h),o&&o.m(e,null),r[33](e),n=!0},p(d,h){var a;(a=d[4])!=null&&a.length||d[3]instanceof Ws.Marker?o?(o.p(d,h),h[0]&24&&Le(o,1)):(o=O_(d),o.c(),Le(o,1),o.m(e,null)):o&&(an(),Be(o,1,1,()=>{o=null}),ln())},i(d){n||(Le(o),n=!0)},o(d){Be(o),n=!1},d(d){d&&ve(e),o&&o.d(),r[33](null)}}}function O_(r){let e;const n=r[31].default,o=wn(n,r,r[30],L_);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d[0]&1073741845)&&kn(o,n,c,c[30],e?xn(n,c[30],d,MS):Sn(c[30]),L_)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function PS(r){let e,n,o=r[9].default&&z_(r);return{c(){o&&o.c(),e=Mn()},m(c,d){o&&o.m(c,d),we(c,e,d),n=!0},p(c,d){c[9].default?o?(o.p(c,d),d[0]&512&&Le(o,1)):(o=z_(c),o.c(),Le(o,1),o.m(e.parentNode,e)):o&&(an(),Be(o,1,1,()=>{o=null}),ln())},i(c){n||(Le(o),n=!0)},o(c){Be(o),n=!1},d(c){c&&ve(e),o&&o.d(c)}}}function LS(r,e,n){let o,c,d,h,a,_,{$$slots:S={},$$scope:k}=e;const y=v1(S);let{closeButton:C=void 0}=e,{closeOnClickOutside:E=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:L=!1}=e,{openOn:R="click"}=e,{openIfTopMost:N=!0}=e,{canOpen:z=void 0}=e,{focusAfterOpen:V=!0}=e,{anchor:Q=void 0}=e,{offset:oe=void 0}=e,{popupClass:ee=void 0}=e,{maxWidth:ne=void 0}=e,{lngLat:j=void 0}=e,{html:U=void 0}=e,{open:X=!1}=e;const B=nl(),{map:W,popupTarget:ce,layerEvent:pe,layer:be,eventTopMost:de,markerClickManager:ye}=sl();jt(r,W,_t=>n(2,d=_t)),jt(r,ce,_t=>n(3,a=_t)),jt(r,pe,_t=>n(29,h=_t)),jt(r,be,_t=>n(36,_=_t));const Ie=["click","dblclick","contextmenu"];let Me,ot=!1,We;function pt(){if(!Me)return;let _t=Me.getElement();!_t||_t===We||(We=_t,R==="hover"&&(We.style.pointerEvents="none"),We.addEventListener("mouseenter",()=>{n(25,ot=!0)},{passive:!0}),We.addEventListener("mouseleave",()=>{n(25,ot=!1)},{passive:!0}),We.addEventListener("click",()=>{T&&n(0,X=!1)},{passive:!0}))}np(()=>{if(d)return d.on("click",Xe),d.on("contextmenu",Xe),ye.add(Pt),typeof a=="string"&&(d.on("click",a,Ht),d.on("dblclick",a,Ht),d.on("contextmenu",a,Ht),d.on("mousemove",a,At),d.on("mouseleave",a,Ti),d.on("touchstart",a,Mi),d.on("touchend",a,Pi)),()=>{d!=null&&d.loaded()&&(Me==null||Me.remove(),d.off("click",Xe),d.off("contextmenu",Xe),ye.remove(Pt),a instanceof Ws.Marker?a.getPopup()===Me&&a.setPopup(void 0):typeof a=="string"&&(d.off("click",a,Ht),d.off("dblclick",a,Ht),d.off("contextmenu",a,Ht),d.off("mousemove",a,At),d.off("mouseleave",a,Ti),d.off("touchstart",a,Mi),d.off("touchend",a,Pi)))}});function Tt(_t){return N?!("marker"in _t)&&!Hk(_t)&&de(_t)!==_:!1}let $e=null,wt="normal";function St(_t){"layerType"in _t&&_t.layerType==="deckgl"?(n(10,j=_t.coordinate),n(4,$e=_t.object?[_t.object]:null)):(n(10,j=_t.lngLat),n(4,$e=_t.features??[]))}function Ht(_t){_t.type!==R||Tt(_t)||(St(_t),setTimeout(()=>n(0,X=!0)))}let oi=null;function Mi(_t){oi=_t.point}function Pi(_t){if(!oi||R!=="hover")return;let it=oi.dist(_t.point);oi=null,it<3&&(n(10,j=_t.lngLat),n(4,$e=_t.features??[]),Me.isOpen()?n(26,wt="justOpened"):(n(26,wt="opening"),n(0,X=!0)))}function Ti(_t){R!=="hover"||oi||wt!=="normal"||(n(0,X=!1),n(4,$e=null))}function At(_t){if(!(R!=="hover"||oi||wt!=="normal")){if(Tt(_t)){n(0,X=!1),n(4,$e=null);return}if(n(0,X=!0),n(4,$e=_t.features??[]),n(10,j=_t.lngLat),z&&!z(_t.features??[])){n(0,X=!1);return}}}function Xe(_t){if(wt==="justOpened"){n(26,wt="normal");return}if(!E)return;let it=[We,a instanceof Ws.Marker?a==null?void 0:a.getElement():null];X&&Me.isOpen()&&!it.some(ue=>ue==null?void 0:ue.contains(_t.originalEvent.target))&&(_t.type==="contextmenu"&&R==="contextmenu"||_t.type!=="contextmenu")&&n(0,X=!1)}function Pt(_t){E&&X&&Me.isOpen()&&_t.marker!==a&&n(0,X=!1)}ds(()=>{d&&(Me!=null&&Me.isOpen())&&Me.remove()});let ni;const Qe=()=>n(0,X=!1);function _i(_t){gi[_t?"unshift":"push"](()=>{ni=_t,n(1,ni)})}return r.$$set=_t=>{"closeButton"in _t&&n(11,C=_t.closeButton),"closeOnClickOutside"in _t&&n(12,E=_t.closeOnClickOutside),"closeOnClickInside"in _t&&n(13,T=_t.closeOnClickInside),"closeOnMove"in _t&&n(14,L=_t.closeOnMove),"openOn"in _t&&n(15,R=_t.openOn),"openIfTopMost"in _t&&n(16,N=_t.openIfTopMost),"canOpen"in _t&&n(17,z=_t.canOpen),"focusAfterOpen"in _t&&n(18,V=_t.focusAfterOpen),"anchor"in _t&&n(19,Q=_t.anchor),"offset"in _t&&n(20,oe=_t.offset),"popupClass"in _t&&n(21,ee=_t.popupClass),"maxWidth"in _t&&n(22,ne=_t.maxWidth),"lngLat"in _t&&n(10,j=_t.lngLat),"html"in _t&&n(23,U=_t.html),"open"in _t&&n(0,X=_t.open),"$$scope"in _t&&n(30,k=_t.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(28,o=C??(!E&&!T)),r.$$.dirty[0]&293355520&&(Me||(n(24,Me=new Ws.Popup({closeButton:o,closeOnClick:!1,closeOnMove:L,focusAfterOpen:V,maxWidth:ne,className:ee,anchor:Q,offset:oe})),We=Me.getElement(),Me.on("open",()=>{n(0,X=!0),pt(),B("open",Me)}),Me.on("close",()=>{n(0,X=!1),B("close",Me)}),Me.on("hover",()=>{B("hover",Me)}))),r.$$.dirty[0]&16809992&&Me&&a instanceof Ws.Marker&&(R==="click"?a.setPopup(Me):a.getPopup()===Me&&a.setPopup(void 0)),r.$$.dirty[0]&536903680&&Ie.includes(R)&&(h==null?void 0:h.type)===R&&(Ht(h),tn(pe,h=null,h)),r.$$.dirty[0]&536903680&&n(27,c=R==="hover"&&((h==null?void 0:h.type)==="mousemove"||(h==null?void 0:h.type)==="mouseenter")),r.$$.dirty[0]&704675840&&R==="hover"&&pe&&(c&&h&&St(h),n(0,X=(c||ot)??!1)),r.$$.dirty[0]&25165826&&(ni?Me.setDOMContent(ni):U&&Me.setHTML(U)),r.$$.dirty[0]&16778240&&j&&Me.setLngLat(j),r.$$.dirty[0]&83886085&&d){let _t=Me.isOpen();X&&!_t?(Me.addTo(d),wt==="opening"&&n(26,wt="justOpened")):!X&&_t&&Me.remove()}},[X,ni,d,a,$e,W,ce,pe,be,y,j,C,E,T,L,R,N,z,V,Q,oe,ee,ne,U,Me,ot,wt,c,o,h,k,S,Qe,_i]}class Sp extends ci{constructor(e){super(),li(this,e,LS,PS,$t,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,canOpen:17,focusAfterOpen:18,anchor:19,offset:20,popupClass:21,maxWidth:22,lngLat:10,html:23,open:0},null,[-1,-1])}}function zS(r){let e;const n=r[16].default,o=wn(n,r,r[24],null);return{c(){o&&o.c()},m(c,d){o&&o.m(c,d),e=!0},p(c,d){o&&o.p&&(!e||d&16777216)&&kn(o,n,c,c[24],e?xn(n,c[24],d,null):Sn(c[24]),null)},i(c){e||(Le(o,c),e=!0)},o(c){Be(o,c),e=!1},d(c){o&&o.d(c)}}}function OS(r){let e,n,o;function c(h){r[17](h)}let d={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[zS]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),e=new Cf({props:d}),gi.push(()=>Zi(e,"hovered",c)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,[a]){const _={};a&2&&(_.id=h[1]),a&4&&(_.source=h[2]),a&8&&(_.sourceLayer=h[3]),a&16&&(_.beforeId=h[4]),a&32&&(_.beforeLayerType=h[5]),a&64&&(_.paint=h[6]),a&128&&(_.layout=h[7]),a&256&&(_.filter=h[8]),a&512&&(_.applyToClusters=h[9]),a&1024&&(_.minzoom=h[10]),a&2048&&(_.maxzoom=h[11]),a&4096&&(_.hoverCursor=h[12]),a&8192&&(_.manageHoverState=h[13]),a&16384&&(_.eventsIfTopMost=h[14]),a&32768&&(_.interactive=h[15]),a&16777216&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.hovered=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function DS(r,e,n){let{$$slots:o={},$$scope:c}=e,{id:d=ru("symbol")}=e,{source:h=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:k=void 0}=e,{layout:y=void 0}=e,{filter:C=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:N=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:V=!1}=e,{interactive:Q=!0}=e;function oe(W){z=W,n(0,z)}function ee(W){Di.call(this,r,W)}function ne(W){Di.call(this,r,W)}function j(W){Di.call(this,r,W)}function U(W){Di.call(this,r,W)}function X(W){Di.call(this,r,W)}function B(W){Di.call(this,r,W)}return r.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,h=W.source),"sourceLayer"in W&&n(3,a=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,S=W.beforeLayerType),"paint"in W&&n(6,k=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,C=W.filter),"applyToClusters"in W&&n(9,E=W.applyToClusters),"minzoom"in W&&n(10,T=W.minzoom),"maxzoom"in W&&n(11,L=W.maxzoom),"hoverCursor"in W&&n(12,R=W.hoverCursor),"manageHoverState"in W&&n(13,N=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,V=W.eventsIfTopMost),"interactive"in W&&n(15,Q=W.interactive),"$$scope"in W&&n(24,c=W.$$scope)},[z,d,h,a,_,S,k,y,C,E,T,L,R,N,V,Q,o,oe,ee,ne,j,U,X,B,c]}class Ef extends ci{constructor(e){super(),li(this,e,DS,OS,$t,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function FS(r){let e,n,o,c;return e=new mb({props:{showCompass:!1}}),o=new gb({}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment)},m(d,h){ct(e,d,h),we(d,n,h),ct(o,d,h),c=!0},p:Ut,i(d){c||(Le(e.$$.fragment,d),Le(o.$$.fragment,d),c=!0)},o(d){Be(e.$$.fragment,d),Be(o.$$.fragment,d),c=!1},d(d){d&&ve(n),ut(e,d),ut(o,d)}}}function RS(r,e,n){let{map:o}=e;return r.$$set=c=>{"map"in c&&n(0,o=c.map)},r.$$.update=()=>{r.$$.dirty&1&&o&&(o.keyboard.disableRotation(),o.dragRotate.disable(),o.touchZoomRotate.disableRotation())},[o]}class BS extends ci{constructor(e){super(),li(this,e,RS,FS,$t,{map:0})}}const Qd=["==",["geometry-type"],"LineString"],_b=["==",["geometry-type"],"Point"];function gh(r,e,n){let o=["match",r];for(let[c,d]of Object.entries(e))o.push(c),o.push(d);return o.push(n),o}function dr(){return{type:"FeatureCollection",features:[]}}function yb(r){return Yx(r)}let Vc="MZEJTanw3WpxRvt7qDfo",D_=`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${Vc}`,bb={Blank:{version:8,sources:{},layers:[],glyphs:D_},"Maptiler Streets":`https://api.maptiler.com/maps/streets-v2/style.json?key=${Vc}`,"Maptiler Dataviz":`https://api.maptiler.com/maps/dataviz/style.json?key=${Vc}`,"Maptiler Hybrid":`https://api.maptiler.com/maps/hybrid/style.json?key=${Vc}`,"Maptiler OpenStreetMap":`https://api.maptiler.com/maps/openstreetmap/style.json?key=${Vc}`,"Maptiler OS Open Zoomstack":`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${Vc}`,"ESRI World Imagery":{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"ESRI &copy; <a href='http://www.esri.com' target='_blank'>ESRI</a>",minzoom:0,maxzoom:18}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:D_}};function NS(r){let e,n,o,c,d,h,a;const _=r[2].default,S=wn(_,r,r[1],null);return{c(){e=ke("div"),n=ke("label"),o=ke("input"),c=qe(),S&&S.c(),fe(o,"class","form-check-input"),fe(o,"type","checkbox"),fe(n,"class","form-check-label"),fe(e,"class","form-check")},m(k,y){we(k,e,y),he(e,n),he(n,o),o.checked=r[0],he(n,c),S&&S.m(n,null),d=!0,h||(a=Zt(o,"change",r[3]),h=!0)},p(k,[y]){y&1&&(o.checked=k[0]),S&&S.p&&(!d||y&2)&&kn(S,_,k,k[1],d?xn(_,k[1],y,null):Sn(k[1]),null)},i(k){d||(Le(S,k),d=!0)},o(k){Be(S,k),d=!1},d(k){k&&ve(e),S&&S.d(k),h=!1,a()}}}function jS(r,e,n){let{$$slots:o={},$$scope:c}=e,{checked:d}=e;function h(){d=this.checked,n(0,d)}return r.$$set=a=>{"checked"in a&&n(0,d=a.checked),"$$scope"in a&&n(1,c=a.$$scope)},[d,c,o,h]}class mr extends ci{constructor(e){super(),li(this,e,jS,NS,$t,{checked:0})}}function F_(r){let e,n,o,c=r[1]!=null&&R_(r);return{c(){e=ke("div"),n=vt(r[0]),o=qe(),c&&c.c(),fe(e,"class","cover svelte-1w7hi45")},m(d,h){we(d,e,h),he(e,n),he(e,o),c&&c.m(e,null)},p(d,h){h&1&&vi(n,d[0]),d[1]!=null?c?c.p(d,h):(c=R_(d),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},d(d){d&&ve(e),c&&c.d()}}}function R_(r){let e,n;return{c(){e=ke("div"),n=ke("progress"),n.value=r[1],en(n,"width","100%")},m(o,c){we(o,e,c),he(e,n)},p(o,c){c&2&&(n.value=o[1])},d(o){o&&ve(e)}}}function US(r){let e,n=r[0]&&F_(r);return{c(){n&&n.c(),e=Mn()},m(o,c){n&&n.m(o,c),we(o,e,c)},p(o,[c]){o[0]?n?n.p(o,c):(n=F_(o),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Ut,o:Ut,d(o){o&&ve(e),n&&n.d(o)}}}function VS(r,e,n){let{loading:o}=e,{progress:c=null}=e;return r.$$set=d=>{"loading"in d&&n(0,o=d.loading),"progress"in d&&n(1,c=d.progress)},[o,c]}class su extends ci{constructor(e){super(),li(this,e,VS,US,$t,{loading:0,progress:1})}}function qS(r){let e,n,o,c,d;const h=r[5].default,a=wn(h,r,r[4],null);return{c(){e=ke("dialog"),n=ke("div"),a&&a.c(),fe(n,"class","svelte-y9d9eu"),fe(e,"class","svelte-y9d9eu")},m(_,S){we(_,e,S),he(e,n),a&&a.m(n,null),r[6](e),o=!0,c||(d=[Zt(e,"click",x1(r[1])),Zt(e,"keydown",r[2])],c=!0)},p(_,[S]){a&&a.p&&(!o||S&16)&&kn(a,h,_,_[4],o?xn(h,_[4],S,null):Sn(_[4]),null)},i(_){o||(Le(a,_),o=!0)},o(_){Be(a,_),o=!1},d(_){_&&ve(e),a&&a.d(_),r[6](null),c=!1,Gn(d)}}}function ZS(r,e,n){let{$$slots:o={},$$scope:c}=e,{show:d=!1}=e,h;function a(k){k.target==h&&n(3,d=!1)}function _(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),n(3,d=!1))}function S(k){gi[k?"unshift":"push"](()=>{h=k,n(0,h)})}return r.$$set=k=>{"show"in k&&n(3,d=k.show),"$$scope"in k&&n(4,c=k.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&h&&(d?h.showModal():h.close())},[h,a,_,d,c,o,S]}let Tp=class extends ci{constructor(e){super(),li(this,e,ZS,qS,$t,{show:3})}};function B_(r,e,n){const o=r.slice();return o[4]=e[n][0],o[5]=e[n][1],o}function N_(r){let e,n,o,c,d=r[4]+"",h,a;return{c(){e=ke("div"),n=ke("span"),c=qe(),h=vt(d),a=qe(),fe(n,"class",o="color-swatch "+r[1]+" svelte-1enycr6"),en(n,"background",r[5]),en(e,"display","flex"),en(e,"align-items","center"),en(e,"gap","6px")},m(_,S){we(_,e,S),he(e,n),he(e,c),he(e,h),he(e,a)},p(_,S){S&2&&o!==(o="color-swatch "+_[1]+" svelte-1enycr6")&&fe(n,"class",o),S&1&&en(n,"background",_[5]),S&1&&d!==(d=_[4]+"")&&vi(h,d)},d(_){_&&ve(e)}}}function WS(r){let e,n=Ri(Object.entries(r[0])),o=[];for(let c=0;c<n.length;c+=1)o[c]=N_(B_(r,n,c));return{c(){e=ke("div");for(let c=0;c<o.length;c+=1)o[c].c();en(e,"display","grid"),en(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),en(e,"gap","10px")},m(c,d){we(c,e,d);for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(e,null)},p(c,[d]){if(d&3){n=Ri(Object.entries(c[0]));let h;for(h=0;h<n.length;h+=1){const a=B_(c,n,h);o[h]?o[h].p(a,d):(o[h]=N_(a),o[h].c(),o[h].m(e,null))}for(;h<o.length;h+=1)o[h].d(1);o.length=n.length}d&4&&en(e,"grid-template-columns","repeat(auto-fill, calc("+c[2]+" - 10px))")},i:Ut,o:Ut,d(c){c&&ve(e),Qn(o,c)}}}function GS(r,e,n){let o,{labelColors:c}=e,{swatchClass:d="rectangle"}=e,{itemsPerRow:h=2}=e;return r.$$set=a=>{"labelColors"in a&&n(0,c=a.labelColors),"swatchClass"in a&&n(1,d=a.swatchClass),"itemsPerRow"in a&&n(3,h=a.itemsPerRow)},r.$$.update=()=>{r.$$.dirty&8&&n(2,o=`${100/h}%`)},[c,d,o,h]}class Cp extends ci{constructor(e){super(),li(this,e,GS,WS,$t,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function Ep(r,e){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function Wc(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}function HS(r){let e,n,o,c,d,h,a;return{c(){e=ke("button"),e.textContent="Import current view",n=qe(),o=ke("p"),o.textContent="or...",c=qe(),d=ke("button"),d.textContent="Draw an area to import on the map",fe(e,"class","btn btn-primary"),fe(e,"type","button"),fe(o,"class","fst-italic my-3"),fe(d,"class","btn btn-primary"),fe(d,"type","button")},m(_,S){we(_,e,S),we(_,n,S),we(_,o,S),we(_,c,S),we(_,d,S),h||(a=[Zt(e,"click",r[2]),Zt(d,"click",r[3])],h=!0)},p:Ut,i:Ut,o:Ut,d(_){_&&(ve(e),ve(n),ve(o),ve(c),ve(d)),h=!1,Gn(a)}}}function XS(r){let e,n;return e=new Kw({props:{polygonTool:r[0]}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&1&&(d.polygonTool=o[0]),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function KS(r){let e;return{c(){e=vt("Save a copy of the osm.xml after importing")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function JS(r){let e,n,o,c,d,h;const a=[XS,HS],_=[];function S(C,E){return C[0]?0:1}e=S(r),n=_[e]=a[e](r);function k(C){r[5](C)}let y={$$slots:{default:[KS]},$$scope:{ctx:r}};return r[1]!==void 0&&(y.checked=r[1]),c=new mr({props:y}),gi.push(()=>Zi(c,"checked",k)),{c(){n.c(),o=qe(),ht(c.$$.fragment)},m(C,E){_[e].m(C,E),we(C,o,E),ct(c,C,E),h=!0},p(C,[E]){let T=e;e=S(C),e===T?_[e].p(C,E):(an(),Be(_[T],1,1,()=>{_[T]=null}),ln(),n=_[e],n?n.p(C,E):(n=_[e]=a[e](C),n.c()),Le(n,1),n.m(o.parentNode,o));const L={};E&512&&(L.$$scope={dirty:E,ctx:C}),!d&&E&2&&(d=!0,L.checked=C[1],qi(()=>d=!1)),c.$set(L)},i(C){h||(Le(n),Le(c.$$.fragment,C),h=!0)},o(C){Be(n),Be(c.$$.fragment,C),h=!1},d(C){C&&ve(o),_[e].d(C),ut(c,C)}}}function $u(r){return[r.lng,r.lat]}function YS(r,e,n){let{map:o}=e;const c=nl();let d=null,h=!1;async function a(C){try{c("loading","Loading from Overpass");let T=await(await fetch(vb(C))).text();h&&Ep("osm.xml",T),c("gotXml",{xml:T,boundary:C})}catch(E){c("error",E.toString())}}function _(){let C=o.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[$u(C.getSouthWest()),$u(C.getNorthWest()),$u(C.getNorthEast()),$u(C.getSouthEast()),$u(C.getSouthWest())]],type:"Polygon"}}}async function S(){if(o){if(o.getZoom()<13){c("error","Zoom in more to import");return}await a(_())}}function k(){o&&(n(0,d=new Zw(o)),d.startNew(),d.addEventListenerSuccess(async C=>{n(0,d=null),await a(C)}),d.addEventListenerFailure(()=>{n(0,d=null)}))}function y(C){h=C,n(1,h)}return r.$$set=C=>{"map"in C&&n(4,o=C.map)},[d,h,S,k,o,y]}class QS extends ci{constructor(e){super(),li(this,e,YS,JS,$t,{map:4})}}function vb(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[o,c]of r.geometry.coordinates[0])e+=`${c} ${o} `;else if(r.geometry.type=="MultiPolygon")for(let[o,c]of r.geometry.coordinates[0][0])e+=`${c} ${o} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}let di,ih=null;function Xc(){return(ih===null||ih.byteLength===0)&&(ih=new Uint8Array(di.memory.buffer)),ih}let df=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});df.decode();const $S=2146435072;let Ld=0;function eT(r,e){return Ld+=e,Ld>=$S&&(df=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),df.decode(),Ld=e),df.decode(Xc().subarray(r,r+e))}function Nr(r,e){return r=r>>>0,eT(r,e)}function tl(r){return r==null}let Fl=null;function zo(){return(Fl===null||Fl.buffer.detached===!0||Fl.buffer.detached===void 0&&Fl.buffer!==di.memory.buffer)&&(Fl=new DataView(di.memory.buffer)),Fl}function $d(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const c=r.description;return c==null?"Symbol":`Symbol(${c})`}if(e=="function"){const c=r.name;return typeof c=="string"&&c.length>0?`Function(${c})`:"Function"}if(Array.isArray(r)){const c=r.length;let d="[";c>0&&(d+=$d(r[0]));for(let h=1;h<c;h++)d+=", "+$d(r[h]);return d+="]",d}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let o;if(n&&n.length>1)o=n[1];else return toString.call(r);if(o=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:o}let Ul=0;const lh=new TextEncoder;"encodeInto"in lh||(lh.encodeInto=function(r,e){const n=lh.encode(r);return e.set(n),{read:r.length,written:n.length}});function zd(r,e,n){if(n===void 0){const a=lh.encode(r),_=e(a.length,1)>>>0;return Xc().subarray(_,_+a.length).set(a),Ul=a.length,_}let o=r.length,c=e(o,1)>>>0;const d=Xc();let h=0;for(;h<o;h++){const a=r.charCodeAt(h);if(a>127)break;d[c+h]=a}if(h!==o){h!==0&&(r=r.slice(h)),c=n(c,o,o=h+r.length*3,1)>>>0;const a=Xc().subarray(c+h,c+o),_=lh.encodeInto(r,a);h+=_.written,c=n(c,o,h,1)>>>0}return Ul=h,c}function tT(r){const e=di.__externref_table_alloc();return di.__wbindgen_externrefs.set(e,r),e}function Od(r,e){try{return r.apply(this,e)}catch(n){const o=tT(n);di.__wbindgen_exn_store(o)}}function iT(r,e){return r=r>>>0,Xc().subarray(r/1,r/1+e)}function fr(r){const e=di.__wbindgen_externrefs.get(r);return di.__externref_table_dealloc(r),e}function nT(r,e){const n=e(r.length*1,1)>>>0;return Xc().set(r,n/1),Ul=r.length,n}const j_=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>di.__wbg_speedwalk_free(r>>>0,1));class _h{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,j_.unregister(this),e}free(){const e=this.__destroy_into_raw();di.__wbg_speedwalk_free(e,0)}editClear(){di.speedwalk_editClear(this.__wbg_ptr)}getMetrics(){let e,n;try{const d=di.speedwalk_getMetrics(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,fr(d[2]);return e=o,n=c,Nr(o,c)}finally{di.__wbindgen_free(e,n,1)}}getBoundary(){let e,n;try{const d=di.speedwalk_getBoundary(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,fr(d[2]);return e=o,n=c,Nr(o,c)}finally{di.__wbindgen_free(e,n,1)}}editSetTags(e,n){const o=di.speedwalk_editSetTags(this.__wbg_ptr,e,n);if(o[1])throw fr(o[0])}getRoadSides(){let e,n;try{const d=di.speedwalk_getRoadSides(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,fr(d[2]);return e=o,n=c,Nr(o,c)}finally{di.__wbindgen_free(e,n,1)}}editAssumeTags(e){const n=di.speedwalk_editAssumeTags(this.__wbg_ptr,e);if(n[1])throw fr(n[0])}getOsmTimestamp(){const e=di.speedwalk_getOsmTimestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}toOsmChangeJson(){let e,n;try{const d=di.speedwalk_toOsmChangeJson(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,fr(d[2]);return e=o,n=c,Nr(o,c)}finally{di.__wbindgen_free(e,n,1)}}getSideLocations(e){let n,o;try{const h=di.speedwalk_getSideLocations(this.__wbg_ptr,e);var c=h[0],d=h[1];if(h[3])throw c=0,d=0,fr(h[2]);return n=c,o=d,Nr(c,d)}finally{di.__wbindgen_free(n,o,1)}}exportNetwork(e){let n,o;try{const h=di.speedwalk_exportNetwork(this.__wbg_ptr,e);var c=h[0],d=h[1];if(h[3])throw c=0,d=0,fr(h[2]);return n=c,o=d,Nr(c,d)}finally{di.__wbindgen_free(n,o,1)}}auditCrossings(e){let n,o;try{const h=di.speedwalk_auditCrossings(this.__wbg_ptr,e);var c=h[0],d=h[1];if(h[3])throw c=0,d=0,fr(h[2]);return n=c,o=d,Nr(c,d)}finally{di.__wbindgen_free(n,o,1)}}editAddNewCrossing(e,n){const o=di.speedwalk_editAddNewCrossing(this.__wbg_ptr,e,n);if(o[1])throw fr(o[0])}editMakeAllSidewalks(e){const n=di.speedwalk_editMakeAllSidewalks(this.__wbg_ptr,e);if(n[1])throw fr(n[0])}editConnectAllCrossings(){const e=di.speedwalk_editConnectAllCrossings(this.__wbg_ptr);if(e[1])throw fr(e[0])}findConnectedComponents(e){let n,o;try{const h=di.speedwalk_findConnectedComponents(this.__wbg_ptr,e);var c=h[0],d=h[1];if(h[3])throw c=0,d=0,fr(h[2]);return n=c,o=d,Nr(c,d)}finally{di.__wbindgen_free(n,o,1)}}constructor(e,n){const o=nT(e,di.__wbindgen_malloc),c=Ul,d=di.speedwalk_new(o,c,n);if(d[2])throw fr(d[1]);return this.__wbg_ptr=d[0]>>>0,j_.register(this,this.__wbg_ptr,this),this}toOsc(){let e,n;try{const o=di.speedwalk_toOsc(this.__wbg_ptr);return e=o[0],n=o[1],Nr(o[0],o[1])}finally{di.__wbindgen_free(e,n,1)}}getWays(){let e,n;try{const d=di.speedwalk_getWays(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,fr(d[2]);return e=o,n=c,Nr(o,c)}finally{di.__wbindgen_free(e,n,1)}}editUndo(){const e=di.speedwalk_editUndo(this.__wbg_ptr);if(e[1])throw fr(e[0])}getEdits(){let e,n;try{const d=di.speedwalk_getEdits(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,fr(d[2]);return e=o,n=c,Nr(o,c)}finally{di.__wbindgen_free(e,n,1)}}getNodes(){let e,n;try{const d=di.speedwalk_getNodes(this.__wbg_ptr);var o=d[0],c=d[1];if(d[3])throw o=0,c=0,fr(d[2]);return e=o,n=c,Nr(o,c)}finally{di.__wbindgen_free(e,n,1)}}get timestamp(){const e=di.__wbg_get_speedwalk_timestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}set timestamp(e){di.__wbg_set_speedwalk_timestamp(this.__wbg_ptr,!tl(e),tl(e)?BigInt(0):e)}}Symbol.dispose&&(_h.prototype[Symbol.dispose]=_h.prototype.free);const rT=new Set(["basic","cors","default"]);async function sT(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(o){if(r.ok&&rT.has(r.type)&&r.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function oT(){const r={};return r.wbg={},r.wbg.__wbg_Error_e83987f665cf5504=function(e,n){return Error(Nr(e,n))},r.wbg.__wbg___wbindgen_bigint_get_as_i64_f3ebc5a755000afd=function(e,n){const o=n,c=typeof o=="bigint"?o:void 0;zo().setBigInt64(e+8*1,tl(c)?BigInt(0):c,!0),zo().setInt32(e+4*0,!tl(c),!0)},r.wbg.__wbg___wbindgen_boolean_get_6d5a1ee65bab5f68=function(e){const n=e,o=typeof n=="boolean"?n:void 0;return tl(o)?16777215:o?1:0},r.wbg.__wbg___wbindgen_debug_string_df47ffb5e35e6763=function(e,n){const o=$d(n),c=zd(o,di.__wbindgen_malloc,di.__wbindgen_realloc),d=Ul;zo().setInt32(e+4*1,d,!0),zo().setInt32(e+4*0,c,!0)},r.wbg.__wbg___wbindgen_in_bb933bd9e1b3bc0f=function(e,n){return e in n},r.wbg.__wbg___wbindgen_is_bigint_cb320707dcd35f0b=function(e){return typeof e=="bigint"},r.wbg.__wbg___wbindgen_is_function_ee8a6c5833c90377=function(e){return typeof e=="function"},r.wbg.__wbg___wbindgen_is_object_c818261d21f283a4=function(e){const n=e;return typeof n=="object"&&n!==null},r.wbg.__wbg___wbindgen_is_string_fbb76cb2940daafd=function(e){return typeof e=="string"},r.wbg.__wbg___wbindgen_is_undefined_2d472862bd29a478=function(e){return e===void 0},r.wbg.__wbg___wbindgen_jsval_eq_6b13ab83478b1c50=function(e,n){return e===n},r.wbg.__wbg___wbindgen_jsval_loose_eq_b664b38a2f582147=function(e,n){return e==n},r.wbg.__wbg___wbindgen_number_get_a20bf9b85341449d=function(e,n){const o=n,c=typeof o=="number"?o:void 0;zo().setFloat64(e+8*1,tl(c)?0:c,!0),zo().setInt32(e+4*0,!tl(c),!0)},r.wbg.__wbg___wbindgen_string_get_e4f06c90489ad01b=function(e,n){const o=n,c=typeof o=="string"?o:void 0;var d=tl(c)?0:zd(c,di.__wbindgen_malloc,di.__wbindgen_realloc),h=Ul;zo().setInt32(e+4*1,h,!0),zo().setInt32(e+4*0,d,!0)},r.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(e,n){throw new Error(Nr(e,n))},r.wbg.__wbg_call_e762c39fa8ea36bf=function(){return Od(function(e,n){return e.call(n)},arguments)},r.wbg.__wbg_debug_f4b0c59db649db48=function(e){console.debug(e)},r.wbg.__wbg_done_2042aa2670fb1db1=function(e){return e.done},r.wbg.__wbg_entries_e171b586f8f6bdbf=function(e){return Object.entries(e)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,n){let o,c;try{o=e,c=n,console.error(Nr(e,n))}finally{di.__wbindgen_free(o,c,1)}},r.wbg.__wbg_error_a7f8fbb0523dae15=function(e){console.error(e)},r.wbg.__wbg_get_7bed016f185add81=function(e,n){return e[n>>>0]},r.wbg.__wbg_get_efcb449f58ec27c2=function(){return Od(function(e,n){return Reflect.get(e,n)},arguments)},r.wbg.__wbg_get_with_ref_key_1dc361bd10053bfe=function(e,n){return e[n]},r.wbg.__wbg_info_e674a11f4f50cc0c=function(e){console.info(e)},r.wbg.__wbg_instanceof_ArrayBuffer_70beb1189ca63b38=function(e){let n;try{n=e instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_instanceof_Map_8579b5e2ab5437c7=function(e){let n;try{n=e instanceof Map}catch{n=!1}return n},r.wbg.__wbg_instanceof_Uint8Array_20c8e73002f7af98=function(e){let n;try{n=e instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbg_isArray_96e0af9891d0945d=function(e){return Array.isArray(e)},r.wbg.__wbg_isSafeInteger_d216eda7911dde36=function(e){return Number.isSafeInteger(e)},r.wbg.__wbg_iterator_e5822695327a3c39=function(){return Symbol.iterator},r.wbg.__wbg_length_69bca3cb64fc8748=function(e){return e.length},r.wbg.__wbg_length_cdd215e10d9dd507=function(e){return e.length},r.wbg.__wbg_log_8cec76766b8c0e33=function(e){console.log(e)},r.wbg.__wbg_new_5a79be3ab53b8aa5=function(e){return new Uint8Array(e)},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_next_020810e0ae8ebcb0=function(){return Od(function(e){return e.next()},arguments)},r.wbg.__wbg_next_2c826fe5dfec6b6a=function(e){return e.next},r.wbg.__wbg_prototypesetcall_2a6620b6922694b2=function(e,n,o){Uint8Array.prototype.set.call(iT(e,n),o)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,n){const o=n.stack,c=zd(o,di.__wbindgen_malloc,di.__wbindgen_realloc),d=Ul;zo().setInt32(e+4*1,d,!0),zo().setInt32(e+4*0,c,!0)},r.wbg.__wbg_value_692627309814bb8c=function(e){return e.value},r.wbg.__wbg_warn_1d74dddbe2fd1dbb=function(e){console.warn(e)},r.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,n){return Nr(e,n)},r.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(e){return BigInt.asUintN(64,e)},r.wbg.__wbindgen_cast_9ae0607507abb057=function(e){return e},r.wbg.__wbindgen_init_externref_table=function(){const e=di.__wbindgen_externrefs,n=e.grow(4);e.set(0,void 0),e.set(n+0,void 0),e.set(n+1,null),e.set(n+2,!0),e.set(n+3,!1)},r}function aT(r,e){return di=r.exports,wb.__wbindgen_wasm_module=e,Fl=null,ih=null,di.__wbindgen_start(),di}async function wb(r){if(di!==void 0)return di;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("/speedwalk/assets/backend_bg-BRmr0tOt.wasm",import.meta.url));const e=oT();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:o}=await sT(await r,e);return aT(n,o)}let ol=vn(null),nr=vn(null),Gs=vn(0),ch=vn(!1),uh=vn(),ep=vn({kind:"sidewalks"}),U_=vn(!1),vf=vn(!1),Bl=vn({include:"OnlyExplicitFootways",ignore_deadends:!1}),il=vn(JSON.parse(JSON.stringify(bb)));function lT(r){return r.reduce((e,n)=>e+n,0)}function tu(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+" km"}async function Ro(){await new Promise(r=>{requestAnimationFrame(()=>{requestAnimationFrame(r)})})}function cT(r){let e,n,o,c,d,h,a,_,S,k,y,C;return S=new QS({props:{map:Wc(r[2])}}),S.$on("gotXml",r[4]),S.$on("loading",r[6]),S.$on("error",r[7]),{c(){e=ke("div"),n=ke("div"),o=ke("label"),c=vt(`Load an osm.pbf or osm.xml file
        `),d=ke("input"),h=qe(),a=ke("p"),a.textContent="or...",_=qe(),ht(S.$$.fragment),fe(d,"class","form-control"),fe(d,"type","file"),fe(o,"class","form-label"),fe(a,"class","fst-italic my-3"),fe(e,"slot","sidebar")},m(E,T){we(E,e,T),he(e,n),he(n,o),he(o,c),he(o,d),r[5](d),he(e,h),he(e,a),he(e,_),ct(S,e,null),k=!0,y||(C=Zt(d,"change",r[3]),y=!0)},p(E,T){const L={};T&4&&(L.map=Wc(E[2])),S.$set(L)},i(E){k||(Le(S.$$.fragment,E),k=!0)},o(E){Be(S.$$.fragment,E),k=!1},d(E){E&&ve(e),r[5](null),ut(S),y=!1,C()}}}function uT(r){let e,n,o;return n=new Bx({}),{c(){e=ke("div"),ht(n.$$.fragment),fe(e,"slot","map")},m(c,d){we(c,e,d),ct(n,e,null),o=!0},p:Ut,i(c){o||(Le(n.$$.fragment,c),o=!0)},o(c){Be(n.$$.fragment,c),o=!1},d(c){c&&ve(e),ut(n)}}}function hT(r){let e,n,o,c;return e=new su({props:{loading:r[0]}}),o=new xh({props:{$$slots:{map:[uT],sidebar:[cT]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment)},m(d,h){ct(e,d,h),we(d,n,h),ct(o,d,h),c=!0},p(d,[h]){const a={};h&1&&(a.loading=d[0]),e.$set(a);const _={};h&1031&&(_.$$scope={dirty:h,ctx:d}),o.$set(_)},i(d){c||(Le(e.$$.fragment,d),Le(o.$$.fragment,d),c=!0)},o(d){Be(e.$$.fragment,d),Be(o.$$.fragment,d),c=!1},d(d){d&&ve(n),ut(e,d),ut(o,d)}}}function fT(r,e,n){let o,c;jt(r,nr,E=>n(8,o=E)),jt(r,ol,E=>n(2,c=E));let d="",h;async function a(E){try{n(0,d="Loading from file"),await Ro();let T=await h.files[0].arrayBuffer();tn(nr,o=new _h(new Uint8Array(T),null),o),S()}catch(T){window.alert(`Bad input file: ${T}`)}finally{n(0,d="")}}async function _(E){try{n(0,d="Processing Overpass data"),await Ro();let T=new TextEncoder().encode(E.detail.xml);tn(nr,o=new _h(new Uint8Array(T),E.detail.boundary),o),S()}catch(T){window.alert(`Couldn't import from Overpass: ${T}`)}finally{n(0,d="")}}function S(){c.fitBounds(yb(JSON.parse(o.getNodes())),{animate:!1,padding:10})}function k(E){gi[E?"unshift":"push"](()=>{h=E,n(1,h)})}return[d,h,c,a,_,k,E=>n(0,d=E.detail),E=>window.alert(E.detail)]}class dT extends ci{constructor(e){super(),li(this,e,fT,hT,$t,{})}}const pT="/speedwalk/assets/favicon-DMAVMD4u.ico",mT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAApElEQVRIS+XUQQqAIBAFUOcgnaEIul/tO1kQdYau0AHsC64y4n9BIWozG/lPx0lzhT8rnO9+BnjvZ7T0NLOJbS3dIoQ3CD1i8MgiNBCCgbQou4JIQEQ61I1FZCAiPerKIFmAgmQDERlQl7eTJAAu0rMj+LAuma76gLJ7HFZvEQsgnJqkrEtmw8NmZQDh5X40NVw6Qa3HrtxzzU7XfZ18ySr0feACKA1QGcdX8MgAAAAASUVORK5CYII=";function V_(r,e,n){const o=r.slice();return o[14]=e[n],o}function q_(r){let e,n,o,c=r[14].name+"",d,h,a;function _(){return r[7](r[14])}return{c(){e=ke("div"),n=ke("button"),o=vt("Remove "),d=vt(c),fe(n,"class","btn btn-danger mb-3")},m(S,k){we(S,e,k),he(e,n),he(n,o),he(n,d),h||(a=Zt(n,"click",_),h=!0)},p(S,k){r=S,k&2&&c!==(c=r[14].name+"")&&vi(d,c)},d(S){S&&ve(e),h=!1,a()}}}function gT(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,L,R,N,z,V,Q,oe,ee,ne,j,U,X,B,W,ce,pe,be,de,ye,Ie,Me=Ri(r[1]),ot=[];for(let We=0;We<Me.length;We+=1)ot[We]=q_(V_(r,Me,We));return{c(){e=ke("h1"),e.textContent="Customize basemaps",n=qe();for(let We=0;We<ot.length;We+=1)ot[We].c();o=qe(),c=ke("div"),d=ke("div"),d.textContent="Add a basemap",h=qe(),a=ke("div"),_=ke("p"),_.textContent=`You can add custom basemaps if you know a tile URL and that the imagery
        has a license allowing it to be used for editing OSM.`,S=qe(),k=ke("ul"),k.innerHTML=`<li><a href="https://github.com/osmlab/editor-layer-index" target="_blank">editor-layer-index</a>
          is a great reference, or you could check in iD or JOSM and figure out which
          one you like to use for your area.</li> <li>If you copy a URL from there, you may need to manually substitute some
          parts of the URL to make it work.</li> <li><b>{zoom}</b>
          
          <b>{z}</b></li> <li><b>{proj}</b>
          
          <b>{EPSG:3857}</b></li> <li><b>{width}</b>
          
          <b>256</b></li> <li><b>{height}</b>
          
          <b>256</b></li> <li><b>{bbox}</b>
          
          <b>{bbox-epsg-3857}</b></li> <li>Some sources have CORS restrictions and won&#39;t work</li>`,y=qe(),C=ke("div"),E=ke("label"),T=vt(`Name:
          `),L=ke("input"),R=qe(),N=ke("div"),z=ke("label"),V=vt(`Tile URL:
          `),Q=ke("textarea"),oe=qe(),ee=ke("div"),ne=ke("label"),j=vt(`Attribution:
          `),U=ke("input"),X=qe(),B=ke("button"),W=vt("Add basemap"),pe=qe(),be=ke("div"),de=ke("button"),de.textContent="Done",fe(d,"class","card-header"),fe(L,"class","form-control"),fe(L,"type","text"),fe(E,"class","form-label"),fe(Q,"class","form-control"),fe(Q,"rows","3"),fe(Q,"cols","80"),fe(z,"class","form-label"),fe(U,"class","form-control"),fe(U,"type","text"),fe(ne,"class","form-label"),fe(B,"class","btn btn-primary"),B.disabled=ce=!r[2]||!r[3]||!r[4],fe(a,"class","card-body"),fe(c,"class","card"),fe(de,"class","btn btn-primary"),fe(be,"class","mt-5")},m(We,pt){we(We,e,pt),we(We,n,pt);for(let Tt=0;Tt<ot.length;Tt+=1)ot[Tt]&&ot[Tt].m(We,pt);we(We,o,pt),we(We,c,pt),he(c,d),he(c,h),he(c,a),he(a,_),he(a,S),he(a,k),he(a,y),he(a,C),he(C,E),he(E,T),he(E,L),jr(L,r[2]),he(a,R),he(a,N),he(N,z),he(z,V),he(z,Q),jr(Q,r[3]),he(a,oe),he(a,ee),he(ee,ne),he(ne,j),he(ne,U),jr(U,r[4]),he(a,X),he(a,B),he(B,W),we(We,pe,pt),we(We,be,pt),he(be,de),ye||(Ie=[Zt(L,"input",r[8]),Zt(Q,"input",r[9]),Zt(U,"input",r[10]),Zt(B,"click",r[5]),Zt(de,"click",r[11])],ye=!0)},p(We,pt){if(pt&66){Me=Ri(We[1]);let Tt;for(Tt=0;Tt<Me.length;Tt+=1){const $e=V_(We,Me,Tt);ot[Tt]?ot[Tt].p($e,pt):(ot[Tt]=q_($e),ot[Tt].c(),ot[Tt].m(o.parentNode,o))}for(;Tt<ot.length;Tt+=1)ot[Tt].d(1);ot.length=Me.length}pt&4&&L.value!==We[2]&&jr(L,We[2]),pt&8&&jr(Q,We[3]),pt&16&&U.value!==We[4]&&jr(U,We[4]),pt&28&&ce!==(ce=!We[2]||!We[3]||!We[4])&&(B.disabled=ce)},d(We){We&&(ve(e),ve(n),ve(o),ve(c),ve(pe),ve(be)),Qn(ot,We),ye=!1,Gn(Ie)}}}function _T(r){let e,n,o;function c(h){r[12](h)}let d={$$slots:{default:[gT]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.show=r[0]),e=new Tp({props:d}),gi.push(()=>Zi(e,"show",c)),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,[a]){const _={};a&131103&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.show=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}let Dd="speedwalk-custom-basemaps";function Z_(r,e){return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[r],tileSize:256,attribution:e}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"},{id:"Road labels",type:"background",layout:{visibility:"none"}}],glyphs:"https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=MZEJTanw3WpxRvt7qDfo"}}function yT(r,e,n){let o;jt(r,il,N=>n(13,o=N));let{show:c}=e,d=JSON.parse(window.localStorage.getItem(Dd)||"[]");for(let N of d)tn(il,o[N.name]=Z_(N.tileURL,N.attribution),o);il.set(o);let h="",a="",_="";function S(){d.push({name:h,tileURL:a,attribution:_}),n(1,d),window.localStorage.setItem(Dd,JSON.stringify(d)),tn(il,o[h]=Z_(a,_),o),il.set(o),n(2,h=""),n(3,a=""),n(4,_="")}function k(N){n(1,d=d.filter(z=>z.name!=N)),window.localStorage.setItem(Dd,JSON.stringify(d)),delete o[N],il.set(o)}const y=N=>k(N.name);function C(){h=this.value,n(2,h)}function E(){a=this.value,n(3,a)}function T(){_=this.value,n(4,_)}const L=()=>n(0,c=!1);function R(N){c=N,n(0,c)}return r.$$set=N=>{"show"in N&&n(0,c=N.show)},[c,d,h,a,_,S,k,y,C,E,T,L,R]}class bT extends ci{constructor(e){super(),li(this,e,yT,_T,$t,{show:0})}}function W_(r,e,n){const o=r.slice();return o[11]=e[n],o}function G_(r,e,n){const o=r.slice();return o[11]=e[n],o}function H_(r){let e,n,o=r[11]+"",c,d,h;function a(){return r[7](r[11])}return{c(){e=ke("li"),n=ke("button"),c=vt(o),fe(n,"class","dropdown-item"),fe(n,"type","button"),pr(n,"active",r[0]===r[11])},m(_,S){we(_,e,S),he(e,n),he(n,c),d||(h=Zt(n,"click",a),d=!0)},p(_,S){r=_,S&2&&o!==(o=r[11]+"")&&vi(c,o),S&3&&pr(n,"active",r[0]===r[11])},d(_){_&&ve(e),d=!1,h()}}}function X_(r){let e,n,o,c=Ri(r[4]),d=[];for(let h=0;h<c.length;h+=1)d[h]=K_(W_(r,c,h));return{c(){e=ke("li"),e.innerHTML='<hr class="dropdown-divider"/>',n=qe();for(let h=0;h<d.length;h+=1)d[h].c();o=Mn()},m(h,a){we(h,e,a),we(h,n,a);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(h,a);we(h,o,a)},p(h,a){if(a&17){c=Ri(h[4]);let _;for(_=0;_<c.length;_+=1){const S=W_(h,c,_);d[_]?d[_].p(S,a):(d[_]=K_(S),d[_].c(),d[_].m(o.parentNode,o))}for(;_<d.length;_+=1)d[_].d(1);d.length=c.length}},d(h){h&&(ve(e),ve(n),ve(o)),Qn(d,h)}}}function K_(r){let e,n,o=r[11]+"",c,d,h,a;function _(){return r[8](r[11])}return{c(){e=ke("li"),n=ke("button"),c=vt(o),d=qe(),fe(n,"class","dropdown-item"),fe(n,"type","button"),pr(n,"active",r[0]===r[11])},m(S,k){we(S,e,k),he(e,n),he(n,c),he(e,d),h||(a=Zt(n,"click",_),h=!0)},p(S,k){r=S,k&16&&o!==(o=r[11]+"")&&vi(c,o),k&17&&pr(n,"active",r[0]===r[11])},d(S){S&&ve(e),h=!1,a()}}}function vT(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,L,R,N,z,V=Ri(r[1]),Q=[];for(let j=0;j<V.length;j+=1)Q[j]=H_(G_(r,V,j));let oe=r[4].length>0&&X_(r);function ee(j){r[10](j)}let ne={};return r[2]!==void 0&&(ne.show=r[2]),T=new bT({props:ne}),gi.push(()=>Zi(T,"show",ee)),{c(){e=ke("div"),n=ke("div"),o=ke("button"),c=vt(r[3]),d=qe(),h=ke("ul");for(let j=0;j<Q.length;j+=1)Q[j].c();a=qe(),oe&&oe.c(),_=qe(),S=ke("li"),S.innerHTML='<hr class="dropdown-divider"/>',k=qe(),y=ke("li"),C=ke("button"),C.innerHTML=`<i class="fa-solid fa-square-plus me-2"></i>
          Add custom basemap`,E=qe(),ht(T.$$.fragment),fe(o,"class","btn btn-outline-secondary dropdown-toggle basemap-button svelte-1tcv6sd"),fe(o,"type","button"),fe(o,"data-bs-toggle","dropdown"),fe(o,"aria-expanded","false"),fe(C,"class","dropdown-item"),fe(C,"type","button"),fe(h,"class","dropdown-menu"),fe(n,"class","btn-group"),fe(e,"class","basemap-selector svelte-1tcv6sd")},m(j,U){we(j,e,U),he(e,n),he(n,o),he(o,c),he(n,d),he(n,h);for(let X=0;X<Q.length;X+=1)Q[X]&&Q[X].m(h,null);he(h,a),oe&&oe.m(h,null),he(h,_),he(h,S),he(h,k),he(h,y),he(y,C),we(j,E,U),ct(T,j,U),R=!0,N||(z=Zt(C,"click",r[9]),N=!0)},p(j,[U]){if((!R||U&8)&&vi(c,j[3]),U&3){V=Ri(j[1]);let B;for(B=0;B<V.length;B+=1){const W=G_(j,V,B);Q[B]?Q[B].p(W,U):(Q[B]=H_(W),Q[B].c(),Q[B].m(h,a))}for(;B<Q.length;B+=1)Q[B].d(1);Q.length=V.length}j[4].length>0?oe?oe.p(j,U):(oe=X_(j),oe.c(),oe.m(h,_)):oe&&(oe.d(1),oe=null);const X={};!L&&U&4&&(L=!0,X.show=j[2],qi(()=>L=!1)),T.$set(X)},i(j){R||(Le(T.$$.fragment,j),R=!0)},o(j){Be(T.$$.fragment,j),R=!1},d(j){j&&(ve(e),ve(E)),Qn(Q,j),oe&&oe.d(),ut(T,j),N=!1,z()}}}function wT(r,e,n){let o,c,d,h,a;jt(r,il,T=>n(6,a=T));let{basemap:_}=e,S=!1;const k=T=>n(0,_=T),y=T=>n(0,_=T),C=()=>n(2,S=!0);function E(T){S=T,n(2,S)}return r.$$set=T=>{"basemap"in T&&n(0,_=T.basemap)},r.$$.update=()=>{r.$$.dirty&64&&n(5,c=Object.keys(a)),r.$$.dirty&34&&n(4,d=c.filter(T=>!o.includes(T))),r.$$.dirty&33&&n(3,h=_||c[0]||"")},n(1,o=Object.keys(bb)),[_,o,S,h,d,c,a,k,y,C,E]}class xT extends ci{constructor(e){super(),li(this,e,wT,vT,$t,{basemap:0})}}function kT(r){if(!r)return null;const e=r.getCenter();return{lat:e.lat,lng:e.lng,zoom:r.getZoom()}}function ST(r,e,n){const o=new URLSearchParams;return o.append("map",`${Math.round(r)}/${e.toFixed(6)}/${n.toFixed(6)}`),`https://www.openstreetmap.org/#${o.toString()}`}function TT(r,e,n){const o=new URLSearchParams;return o.append("map",`${Math.round(r)}/${e.toFixed(6)}/${n.toFixed(6)}`),`https://www.openstreetmap.org/edit?editor=id#${o.toString()}`}function CT(r,e,n){const o=new URLSearchParams;return o.append("map",`${Math.round(r)}/${e.toFixed(6)}/${n.toFixed(6)}`),o.append("disable_features","boundaries"),o.append("hashtags","Speedwalk"),`https://kyle.kiwi/iD/#${o.toString()}`}function ET(r,e,n){const o=new URLSearchParams;return o.append("map",`${Math.round(r)}/${e.toFixed(6)}/${n.toFixed(6)}`),o.append("disable_features","boundaries"),o.append("hashtags","Speedwalk"),`https://rapideditor.org/edit#${o.toString()}`}function IT(r,e,n,o){return`http://127.0.0.1:8111/load_and_zoom?left=${r.toFixed(6)}&right=${e.toFixed(6)}&top=${n.toFixed(6)}&bottom=${o.toFixed(6)}`}function AT(r){const e=r.getBounds();return IT(e.getWest(),e.getEast(),e.getNorth(),e.getSouth())}function MT(r,e,n){const o=new URL("https://www.mapillary.com/app/");return o.searchParams.set("lat",String(e)),o.searchParams.set("lng",String(n)),o.searchParams.set("z",String(Math.round(r))),o.toString()}function J_(r,e,n){const o=r.slice();return o[4]=e[n],o}function Y_(r){let e,n,o,c,d;function h(){return r[2](r[4])}return{c(){e=ke("li"),n=ke("a"),n.textContent=`${r[4]}`,o=qe(),fe(n,"class","dropdown-item"),fe(n,"href","#")},m(a,_){we(a,e,_),he(e,n),he(e,o),c||(d=Zt(n,"click",ip(h)),c=!0)},p(a,_){r=a},d(a){a&&ve(e),c=!1,d()}}}function PT(r){let e,n,o,c,d=Ri(r[0]),h=[];for(let a=0;a<d.length;a+=1)h[a]=Y_(J_(r,d,a));return{c(){e=ke("div"),n=ke("button"),n.innerHTML='<i class="fa-solid fa-pen"></i>',o=qe(),c=ke("ul");for(let a=0;a<h.length;a+=1)h[a].c();fe(n,"class","btn btn-outline-secondary dropdown-toggle"),fe(n,"type","button"),fe(n,"data-bs-toggle","dropdown"),fe(n,"aria-expanded","false"),fe(n,"title","Open in OSM editors"),fe(c,"class","dropdown-menu"),fe(e,"class","btn-group")},m(a,_){we(a,e,_),he(e,n),he(e,o),he(e,c);for(let S=0;S<h.length;S+=1)h[S]&&h[S].m(c,null)},p(a,[_]){if(_&3){d=Ri(a[0]);let S;for(S=0;S<d.length;S+=1){const k=J_(a,d,S);h[S]?h[S].p(k,_):(h[S]=Y_(k),h[S].c(),h[S].m(c,null))}for(;S<h.length;S+=1)h[S].d(1);h.length=d.length}},i:Ut,o:Ut,d(a){a&&ve(e),Qn(h,a)}}}function LT(r,e,n){let o;jt(r,ol,a=>n(3,o=a));const c=["OSM","iD","Kiwid","Rapid","JOSM","Mapillary"];function d(a){const _=kT(o);if(!(!o||!_))return{OSM:ST(_.zoom,_.lat,_.lng),iD:TT(_.zoom,_.lat,_.lng),Kiwid:CT(_.zoom,_.lat,_.lng),Rapid:ET(_.zoom,_.lat,_.lng),JOSM:AT(o),Mapillary:MT(_.zoom,_.lat,_.lng)}[a]}return[c,d,a=>window.open(d(a),"_blank","noopener,noreferrer")]}class zT extends ci{constructor(e){super(),li(this,e,LT,PT,$t,{})}}function OT(r){let e,n,o,c,d;const h=r[6].default,a=wn(h,r,r[5],null);return{c(){e=ke("dialog"),n=ke("div"),a&&a.c(),fe(n,"class","svelte-y9d9eu"),fe(e,"closedby","none"),fe(e,"class","svelte-y9d9eu")},m(_,S){we(_,e,S),he(e,n),a&&a.m(n,null),r[7](e),o=!0,c||(d=[Zt(e,"click",r[1]),Zt(e,"keydown",r[2])],c=!0)},p(_,[S]){a&&a.p&&(!o||S&32)&&kn(a,h,_,_[5],o?xn(h,_[5],S,null):Sn(_[5]),null)},i(_){o||(Le(a,_),o=!0)},o(_){Be(a,_),o=!1},d(_){_&&ve(e),a&&a.d(_),r[7](null),c=!1,Gn(d)}}}function DT(r,e,n){let{$$slots:o={},$$scope:c}=e,{show:d}=e,{closeable:h=!0}=e,a;function _(y){y.target==a&&(y.stopPropagation(),h&&n(3,d=!1))}function S(y){(y.key=="Escape"||y.key=="Enter")&&(y.stopPropagation(),h&&n(3,d=!1))}function k(y){gi[y?"unshift":"push"](()=>{a=y,n(0,a)})}return r.$$set=y=>{"show"in y&&n(3,d=y.show),"closeable"in y&&n(4,h=y.closeable),"$$scope"in y&&n(5,c=y.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&a&&(d?a.showModal():a.close())},[a,_,S,d,h,c,o,k]}class Q_ extends ci{constructor(e){super(),li(this,e,DT,OT,$t,{show:3,closeable:4})}}function $_(r){let e;return{c(){e=vt("You may be contacted later when this problem has been fixed.")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function FT(r){let e,n,o,c,d,h,a,_,S=r[5]&&r[8]&&$_();return{c(){e=ke("h2"),e.textContent="Report a problem",n=qe(),o=ke("p"),c=vt(`Done, thank you for submitting.
    `),S&&S.c(),d=qe(),h=ke("button"),h.textContent="OK",fe(h,"class","btn btn-primary")},m(k,y){we(k,e,y),we(k,n,y),we(k,o,y),he(o,c),S&&S.m(o,null),we(k,d,y),we(k,h,y),a||(_=Zt(h,"click",r[12]),a=!0)},p(k,y){k[5]&&k[8]?S||(S=$_(),S.c(),S.m(o,null)):S&&(S.d(1),S=null)},d(k){k&&(ve(e),ve(n),ve(o),ve(d),ve(h)),S&&S.d(),a=!1,_()}}}function RT(r){let e;return{c(){e=vt("Include screenshot")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function ey(r){let e,n,o;function c(h){r[16](h)}let d={$$slots:{default:[BT]},$$scope:{ctx:r}};return r[5]!==void 0&&(d.checked=r[5]),e=new mr({props:d}),gi.push(()=>Zi(e,"checked",c)),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,a){const _={};a&4194560&&(_.$$scope={dirty:a,ctx:h}),!n&&a&32&&(n=!0,_.checked=h[5],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function BT(r){let e,n=r[8].name+"",o,c;return{c(){e=vt("Include your OSM username ("),o=vt(n),c=vt(`) in the report and be
      contacted when the problem is fixed`)},m(d,h){we(d,e,h),we(d,o,h),we(d,c,h)},p(d,h){h&256&&n!==(n=d[8].name+"")&&vi(o,n)},d(d){d&&(ve(e),ve(o),ve(c))}}}function ty(r){let e;function n(d,h){return d[1]?jT:NT}let o=n(r),c=o(r);return{c(){e=ke("div"),c.c(),fe(e,"class","img-container mb-3 svelte-3bvulg")},m(d,h){we(d,e,h),c.m(e,null)},p(d,h){o===(o=n(d))&&c?c.p(d,h):(c.d(1),c=o(d),c&&(c.c(),c.m(e,null)))},d(d){d&&ve(e),c.d()}}}function NT(r){let e;return{c(){e=ke("p"),e.textContent="Loading screenshot... (sometimes you have to cancel and try again)"},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function jT(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[1])||fe(e,"src",n),fe(e,"alt","Screenshot"),fe(e,"class","svelte-3bvulg")},m(o,c){we(o,e,c)},p(o,c){c&2&&!Wn(e.src,n=o[1])&&fe(e,"src",n)},d(o){o&&ve(e)}}}function UT(r){let e,n,o,c,d;return{c(){e=ke("button"),n=vt("Submit report"),fe(e,"class","btn btn-primary me-3"),e.disabled=o=!r[7]},m(h,a){we(h,e,a),he(e,n),c||(d=Zt(e,"click",r[9]),c=!0)},p(h,a){a&128&&o!==(o=!h[7])&&(e.disabled=o)},d(h){h&&ve(e),c=!1,d()}}}function VT(r){let e;return{c(){e=ke("button"),e.innerHTML=`<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
        Submit report`,fe(e,"class","btn btn-primary me-3"),e.disabled=!0},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function qT(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,L,R,N,z,V,Q,oe,ee,ne;function j(be){r[15](be)}let U={$$slots:{default:[RT]},$$scope:{ctx:r}};r[6]!==void 0&&(U.checked=r[6]),E=new mr({props:U}),gi.push(()=>Zi(E,"checked",j));let X=r[8]&&ey(r),B=r[6]&&ty(r);function W(be,de){return be[3]?VT:UT}let ce=W(r),pe=ce(r);return{c(){e=ke("div"),n=ke("h2"),n.textContent="Report a problem",o=qe(),c=ke("button"),d=qe(),h=ke("p"),h.textContent="You can report a problem with Speedwalk.",a=qe(),_=ke("fieldset"),S=ke("legend"),S.innerHTML=`Please describe the problem
      <br/>
      (if it&#39;s not obvious from the screenshot below)`,k=qe(),y=ke("textarea"),C=qe(),ht(E.$$.fragment),L=qe(),X&&X.c(),R=qe(),B&&B.c(),N=qe(),z=ke("div"),pe.c(),V=qe(),Q=ke("button"),Q.textContent="Cancel",fe(c,"class","btn-close"),fe(c,"aria-label","Close"),fe(e,"class","d-flex justify-content-between"),fe(y,"class","form-control"),fe(y,"rows","4"),fe(y,"placeholder","Details"),fe(_,"class","mb-3"),fe(Q,"class","btn btn-secondary"),fe(z,"class","d-flex")},m(be,de){we(be,e,de),he(e,n),he(e,o),he(e,c),we(be,d,de),we(be,h,de),we(be,a,de),we(be,_,de),he(_,S),he(_,k),he(_,y),jr(y,r[0]),we(be,C,de),ct(E,be,de),we(be,L,de),X&&X.m(be,de),we(be,R,de),B&&B.m(be,de),we(be,N,de),we(be,z,de),pe.m(z,null),he(z,V),he(z,Q),oe=!0,ee||(ne=[Zt(c,"click",r[10]),Zt(y,"input",r[14]),Zt(Q,"click",r[10])],ee=!0)},p(be,de){de&1&&jr(y,be[0]);const ye={};de&4194304&&(ye.$$scope={dirty:de,ctx:be}),!T&&de&64&&(T=!0,ye.checked=be[6],qi(()=>T=!1)),E.$set(ye),be[8]?X?(X.p(be,de),de&256&&Le(X,1)):(X=ey(be),X.c(),Le(X,1),X.m(R.parentNode,R)):X&&(an(),Be(X,1,1,()=>{X=null}),ln()),be[6]?B?B.p(be,de):(B=ty(be),B.c(),B.m(N.parentNode,N)):B&&(B.d(1),B=null),ce===(ce=W(be))&&pe?pe.p(be,de):(pe.d(1),pe=ce(be),pe&&(pe.c(),pe.m(z,V)))},i(be){oe||(Le(E.$$.fragment,be),Le(X),oe=!0)},o(be){Be(E.$$.fragment,be),Be(X),oe=!1},d(be){be&&(ve(e),ve(d),ve(h),ve(a),ve(_),ve(C),ve(L),ve(R),ve(N),ve(z)),ut(E,be),X&&X.d(be),B&&B.d(be),pe.d(),ee=!1,Gn(ne)}}}function ZT(r){let e,n,o,c,d,h;function a(y){r[13](y)}let _={$$slots:{default:[FT]},$$scope:{ctx:r}};r[4]!==void 0&&(_.show=r[4]),e=new Q_({props:_}),gi.push(()=>Zi(e,"show",a));function S(y){r[17](y)}let k={closeable:!1,$$slots:{default:[qT]},$$scope:{ctx:r}};return r[2]!==void 0&&(k.show=r[2]),c=new Q_({props:k}),gi.push(()=>Zi(c,"show",S)),{c(){ht(e.$$.fragment),o=qe(),ht(c.$$.fragment)},m(y,C){ct(e,y,C),we(y,o,C),ct(c,y,C),h=!0},p(y,[C]){const E={};C&4194608&&(E.$$scope={dirty:C,ctx:y}),!n&&C&16&&(n=!0,E.show=y[4],qi(()=>n=!1)),e.$set(E);const T={};C&4194795&&(T.$$scope={dirty:C,ctx:y}),!d&&C&4&&(d=!0,T.show=y[2],qi(()=>d=!1)),c.$set(T)},i(y){h||(Le(e.$$.fragment,y),Le(c.$$.fragment,y),h=!0)},o(y){Be(e.$$.fragment,y),Be(c.$$.fragment,y),h=!1},d(y){y&&ve(o),ut(e,y),ut(c,y)}}}function WT(r){return new Promise((e,n)=>{r.redraw(),r.once("idle",()=>{r.getCanvas().toBlob(o=>{o?e(o):n("no blob")})})})}function GT(r){return new Promise((e,n)=>{let o=new FileReader;o.readAsDataURL(r),o.onloadend=function(){o.result?e(o.result):n("base64 failed")}})}function HT(r){let e=r.getCenter(),n=Math.round(r.getZoom()*100)/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,o),d=Math.round(e.lat*c)/c,h=Math.round(e.lng*c)/c,a=`${n}/${d}/${h}`,_=r.getBearing(),S=r.getPitch();return(_||S)&&(a+=`/${Math.round(_*10)/10}`),S&&(a+=`/${Math.round(S)}`),`#${a}`}function XT(r,e,n){let o,c,d;jt(r,uh,U=>n(8,c=U)),jt(r,ol,U=>n(20,d=U));let h=!1,a=!1,_=!1;function S(){d&&R()}let k="",y={},C=!1,E=!0,T,L;async function R(){n(2,h=!0),y={url:window.location.toString(),viewport:HT(d)},T=await WT(d),n(1,L=URL.createObjectURL(T))}async function N(){let U=null;C&&c&&(U=c.name);let X=null;E&&T&&(X=await GT(T));let B={...y,details:k,screenshot:X,username:U};try{n(3,a=!0);let W=await fetch("https://walknet.abstreet.uk/problems/speedwalk_problems",{method:"POST",body:JSON.stringify(B),headers:{"Content-Type":"application/json"}});if(!W.ok)throw new Error(`Bad response: ${W.status}`)}catch(W){window.alert(`Failed to report a problem: ${W}`),n(3,a=!1);return}n(3,a=!1),z(),n(4,_=!0)}function z(){n(2,h=!1),n(0,k=""),y={},T=void 0,L&&(URL.revokeObjectURL(L),n(1,L=void 0))}const V=()=>n(4,_=!1);function Q(U){_=U,n(4,_)}function oe(){k=this.value,n(0,k)}function ee(U){E=U,n(6,E)}function ne(U){C=U,n(5,C)}function j(U){h=U,n(2,h)}return r.$$.update=()=>{r.$$.dirty&3&&n(7,o=k||L)},[k,L,h,a,_,C,E,o,c,N,z,S,V,Q,oe,ee,ne,j]}class KT extends ci{constructor(e){super(),li(this,e,XT,ZT,$t,{triggerStart:11})}get triggerStart(){return this.$$.ctx[11]}}function iy(r){let e,n,o,c;return{c(){e=ke("div"),n=ke("button"),n.innerHTML='<i class="fa-solid fa-triangle-exclamation"></i> <span class="report-problem-text svelte-17rnyo3">Report problem</span>',fe(n,"class","btn btn-secondary report-problem-btn svelte-17rnyo3"),fe(e,"class","report-problem-wrapper svelte-17rnyo3")},m(d,h){we(d,e,h),he(e,n),o||(c=Zt(n,"click",r[2]),o=!0)},p:Ut,d(d){d&&ve(e),o=!1,c()}}}function JT(r){let e,n,o,c=r[1]&&iy(r),d={};return n=new KT({props:d}),r[3](n),{c(){c&&c.c(),e=qe(),ht(n.$$.fragment)},m(h,a){c&&c.m(h,a),we(h,e,a),ct(n,h,a),o=!0},p(h,[a]){h[1]?c?c.p(h,a):(c=iy(h),c.c(),c.m(e.parentNode,e)):c&&(c.d(1),c=null);const _={};n.$set(_)},i(h){o||(Le(n.$$.fragment,h),o=!0)},o(h){Be(n.$$.fragment,h),o=!1},d(h){h&&ve(e),c&&c.d(h),r[3](null),ut(n,h)}}}function YT(r,e,n){let o;jt(r,ol,a=>n(1,o=a));let c=null;const d=()=>{c==null||c.triggerStart()};function h(a){gi[a?"unshift":"push"](()=>{c=a,n(0,c)})}return[c,o,d,h]}class QT extends ci{constructor(e){super(),li(this,e,YT,JT,$t,{})}}function $T(r){let e,n,o,c,d,h,a,_;function S(y){r[2](y)}let k={};return r[0]!==void 0&&(k.basemap=r[0]),n=new xT({props:k}),gi.push(()=>Zi(n,"basemap",S)),d=new zT({}),a=new QT({}),{c(){e=ke("div"),ht(n.$$.fragment),c=qe(),ht(d.$$.fragment),h=qe(),ht(a.$$.fragment),fe(e,"class","action-bar svelte-nu94fm"),en(e,"bottom",r[1])},m(y,C){we(y,e,C),ct(n,e,null),he(e,c),ct(d,e,null),he(e,h),ct(a,e,null),_=!0},p(y,[C]){const E={};!o&&C&1&&(o=!0,E.basemap=y[0],qi(()=>o=!1)),n.$set(E),C&2&&en(e,"bottom",y[1])},i(y){_||(Le(n.$$.fragment,y),Le(d.$$.fragment,y),Le(a.$$.fragment,y),_=!0)},o(y){Be(n.$$.fragment,y),Be(d.$$.fragment,y),Be(a.$$.fragment,y),_=!1},d(y){y&&ve(e),ut(n),ut(d),ut(a)}}}function eC(r,e,n){let{basemap:o}=e,{bottom:c="60px"}=e;function d(h){o=h,n(0,o)}return r.$$set=h=>{"basemap"in h&&n(0,o=h.basemap),"bottom"in h&&n(1,c=h.bottom)},[o,c,d]}class tC extends ci{constructor(e){super(),li(this,e,eC,$T,$t,{basemap:0,bottom:1})}}let Gl={RoadWithSeparate:"purple",RoadWithTags:"blue",RoadWithoutSidewalksExplicit:"#8B4000",RoadWithoutSidewalksImplicit:"orange",RoadUnknown:"#ff69b4",Sidewalk:"black",Crossing:"green",Other:"grey"},ny={RoadWithSeparate:"With separate sidewalks",RoadWithTags:"With tagged sidewalks",RoadWithoutSidewalksExplicit:"Tagged as no sidewalks",RoadWithoutSidewalksImplicit:"Assumed as no sidewalks",RoadUnknown:"Totally unknown",Sidewalk:"Separate sidewalk",Crossing:"Crossing",Other:"Other"};function fa(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,gh(["get","kind"],{Sidewalk:4+r,Crossing:5+r,Other:5+r},7+r),20,gh(["get","kind"],{Sidewalk:7+r,Crossing:10+r,Other:10+r},24+r)]}function iC(r){let e,n,o,c;return e=new ga({props:{id:"pinned",beforeId:"Road labels",paint:{"line-width":fa(10),"line-color":"cyan","line-opacity":.5}}}),o=new Ef({props:{minzoom:12,layout:{"icon-image":"arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0}}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment)},m(d,h){ct(e,d,h),we(d,n,h),ct(o,d,h),c=!0},p:Ut,i(d){c||(Le(e.$$.fragment,d),Le(o.$$.fragment,d),c=!0)},o(d){Be(e.$$.fragment,d),Be(o.$$.fragment,d),c=!1},d(d){d&&ve(n),ut(e,d),ut(o,d)}}}function nC(r){let e,n;return e=new ga({props:{id:"snapped-to-pinned",beforeId:"Road labels",paint:{"line-width":fa(10),"line-color":"blue","line-opacity":.5,"line-offset":["case",["get","left"],-5,5]}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p:Ut,i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function rC(r){let e,n;return e=new ga({props:{id:"ways",beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",filter:r[5],paint:{"line-width":fa(0),"line-color":gh(["get","kind"],Gl,"cyan")}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&32&&(d.filter=o[5]),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function sC(r){let e,n;return e=new Ef({props:{minzoom:16,paint:{"text-color":"white","text-halo-color":"black","text-halo-width":2},layout:{visibility:r[3]?"visible":"none","text-field":["get","sidewalks"],"text-size":15,"symbol-placement":"line","symbol-spacing":30,"text-allow-overlap":!0,"text-rotation-alignment":"viewport"}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&8&&(d.layout={visibility:o[3]?"visible":"none","text-field":["get","sidewalks"],"text-size":15,"symbol-placement":"line","symbol-spacing":30,"text-allow-overlap":!0,"text-rotation-alignment":"viewport"}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function ry(r){let e,n;return e=new Er({props:{data:r[6]?JSON.parse(r[6].getRoadSides()):dr(),$$slots:{default:[sC]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&64&&(d.data=o[6]?JSON.parse(o[6].getRoadSides()):dr()),c&65544&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function oC(r){let e,n;return e=new Ef({props:{id:"pinned-sides",paint:{"text-color":"black","text-halo-color":"cyan","text-halo-width":4},layout:{"text-field":["get","side"],"text-size":16,"symbol-placement":"line"}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p:Ut,i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function aC(r){let e,n;return e=new Ef({props:{id:"pinned-node-order",paint:{"text-color":"white","text-halo-color":"blue","text-halo-width":5},layout:{"text-field":["get","idx"],"text-size":16,visibility:r[8]?"visible":"none"}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&256&&(d.layout={"text-field":["get","idx"],"text-size":16,visibility:o[8]?"visible":"none"}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function lC(r){let e,n,o,c;return e=new Wl({props:{filter:_b,paint:{"circle-radius":20,"circle-color":["get","color"],"circle-opacity":.5},layout:{visibility:r[2]?"visible":"none"}}}),o=new ga({props:{filter:Qd,paint:{"line-width":fa(5),"line-color":["get","color"],"line-opacity":.5},layout:{visibility:r[2]?"visible":"none"}}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment)},m(d,h){ct(e,d,h),we(d,n,h),ct(o,d,h),c=!0},p(d,h){const a={};h&4&&(a.layout={visibility:d[2]?"visible":"none"}),e.$set(a);const _={};h&4&&(_.layout={visibility:d[2]?"visible":"none"}),o.$set(_)},i(d){c||(Le(e.$$.fragment,d),Le(o.$$.fragment,d),c=!0)},o(d){Be(e.$$.fragment,d),Be(o.$$.fragment,d),c=!1},d(d){d&&ve(n),ut(e,d),ut(o,d)}}}function cC(r){let e,n,o,c,d,h,a,_,S=r[9],k,y,C,E,T,L,R;e=new pb({}),e.$on("click",r[10]),o=new Er({props:{data:r[0]||dr(),$$slots:{default:[iC]},$$scope:{ctx:r}}}),d=new Er({props:{data:r[12](r[0],r[8]),$$slots:{default:[nC]},$$scope:{ctx:r}}}),a=new Er({props:{data:r[4],$$slots:{default:[rC]},$$scope:{ctx:r}}});let N=ry(r);return y=new Er({props:{data:r[7],$$slots:{default:[oC]},$$scope:{ctx:r}}}),E=new Er({props:{data:r[11](r[0]),$$slots:{default:[aC]},$$scope:{ctx:r}}}),L=new Er({props:{data:r[1],$$slots:{default:[lC]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment),c=qe(),ht(d.$$.fragment),h=qe(),ht(a.$$.fragment),_=qe(),N.c(),k=qe(),ht(y.$$.fragment),C=qe(),ht(E.$$.fragment),T=qe(),ht(L.$$.fragment)},m(z,V){ct(e,z,V),we(z,n,V),ct(o,z,V),we(z,c,V),ct(d,z,V),we(z,h,V),ct(a,z,V),we(z,_,V),N.m(z,V),we(z,k,V),ct(y,z,V),we(z,C,V),ct(E,z,V),we(z,T,V),ct(L,z,V),R=!0},p(z,[V]){const Q={};V&1&&(Q.data=z[0]||dr()),V&65536&&(Q.$$scope={dirty:V,ctx:z}),o.$set(Q);const oe={};V&257&&(oe.data=z[12](z[0],z[8])),V&65536&&(oe.$$scope={dirty:V,ctx:z}),d.$set(oe);const ee={};V&16&&(ee.data=z[4]),V&65568&&(ee.$$scope={dirty:V,ctx:z}),a.$set(ee),V&512&&$t(S,S=z[9])?(an(),Be(N,1,1,Ut),ln(),N=ry(z),N.c(),Le(N,1),N.m(k.parentNode,k)):N.p(z,V);const ne={};V&128&&(ne.data=z[7]),V&65536&&(ne.$$scope={dirty:V,ctx:z}),y.$set(ne);const j={};V&1&&(j.data=z[11](z[0])),V&65792&&(j.$$scope={dirty:V,ctx:z}),E.$set(j);const U={};V&2&&(U.data=z[1]),V&65540&&(U.$$scope={dirty:V,ctx:z}),L.$set(U)},i(z){R||(Le(e.$$.fragment,z),Le(o.$$.fragment,z),Le(d.$$.fragment,z),Le(a.$$.fragment,z),Le(N),Le(y.$$.fragment,z),Le(E.$$.fragment,z),Le(L.$$.fragment,z),R=!0)},o(z){Be(e.$$.fragment,z),Be(o.$$.fragment,z),Be(d.$$.fragment,z),Be(a.$$.fragment,z),Be(N),Be(y.$$.fragment,z),Be(E.$$.fragment,z),Be(L.$$.fragment,z),R=!1},d(z){z&&(ve(n),ve(c),ve(h),ve(_),ve(k),ve(C),ve(T)),ut(e,z),ut(o,z),ut(d,z),ut(a,z),N.d(z),ut(y,z),ut(E,z),ut(L,z)}}}function uC(r,e,n){let o,c,d,h,a;jt(r,nr,V=>n(6,c=V)),jt(r,ol,V=>n(14,d=V)),jt(r,vf,V=>n(8,h=V)),jt(r,Gs,V=>n(9,a=V));let{pinnedWay:_}=e,{drawProblemDetails:S}=e,{showProblemDetails:k}=e,{showRoadSides:y}=e,{nodes:C}=e,{ways:E}=e,{filterWays:T}=e;function L(V){n(0,_=null);for(let Q of d.queryRenderedFeatures(V.detail.point,{layers:["ways"]})){n(0,_=E.features.find(oe=>oe.id==Q.id));break}}function R(V){let Q=dr();if(V)for(let oe of V.properties.problems)Q.features=[...Q.features,...oe.details];return Q}function N(V){let Q=dr();if(V)for(let[oe,ee]of V.properties.node_ids.entries()){let ne=C.features.find(j=>j.properties.id==ee);Q.features.push({type:"Feature",geometry:ne.geometry,properties:{idx:oe}})}return Q}function z(V,Q){if(!V||!Q)return dr();let oe=parseInt(V.properties.tags["tmp:closest_way"]);if(!oe)return dr();for(let ee of E.features)if(ee.properties.id==oe){let ne=JSON.parse(JSON.stringify(ee));return ne.properties.left=V.properties.tags["tmp:side"]=="Left",{type:"FeatureCollection",features:[ne]}}return dr()}return r.$$set=V=>{"pinnedWay"in V&&n(0,_=V.pinnedWay),"drawProblemDetails"in V&&n(1,S=V.drawProblemDetails),"showProblemDetails"in V&&n(2,k=V.showProblemDetails),"showRoadSides"in V&&n(3,y=V.showRoadSides),"nodes"in V&&n(13,C=V.nodes),"ways"in V&&n(4,E=V.ways),"filterWays"in V&&n(5,T=V.filterWays)},r.$$.update=()=>{r.$$.dirty&65&&n(7,o=c&&_?JSON.parse(c.getSideLocations(BigInt(_.properties.id))):dr()),r.$$.dirty&1&&n(1,S=R(_))},[_,S,k,y,E,T,c,o,h,a,L,N,z,C]}class hC extends ci{constructor(e){super(),li(this,e,uC,cC,$t,{pinnedWay:0,drawProblemDetails:1,showProblemDetails:2,showRoadSides:3,nodes:13,ways:4,filterWays:5})}}const Cr=[];for(let r=0;r<256;++r)Cr.push((r+256).toString(16).slice(1));function fC(r,e=0){return(Cr[r[e+0]]+Cr[r[e+1]]+Cr[r[e+2]]+Cr[r[e+3]]+"-"+Cr[r[e+4]]+Cr[r[e+5]]+"-"+Cr[r[e+6]]+Cr[r[e+7]]+"-"+Cr[r[e+8]]+Cr[r[e+9]]+"-"+Cr[r[e+10]]+Cr[r[e+11]]+Cr[r[e+12]]+Cr[r[e+13]]+Cr[r[e+14]]+Cr[r[e+15]]).toLowerCase()}let Fd;const dC=new Uint8Array(16);function pC(){if(!Fd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Fd=crypto.getRandomValues.bind(crypto)}return Fd(dC)}const mC=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),sy={randomUUID:mC};function gC(r,e,n){var c;r=r||{};const o=r.random??((c=r.rng)==null?void 0:c.call(r))??pC();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,fC(o)}function _C(r,e,n){return sy.randomUUID&&!r?sy.randomUUID():gC(r)}const yC=r=>({}),oy=r=>({}),bC=r=>({}),ay=r=>({});function vC(r){let e,n,o,c,d,h,a,_;const S=r[3].header,k=wn(S,r,r[2],ay),y=r[3].body,C=wn(y,r,r[2],oy);return{c(){e=ke("div"),n=ke("div"),o=ke("div"),c=ke("button"),k&&k.c(),d=qe(),h=ke("div"),a=ke("div"),C&&C.c(),fe(c,"class","accordion-button"),fe(c,"type","button"),fe(c,"data-bs-toggle","collapse"),fe(c,"data-bs-target",`#${r[1]}`),fe(c,"aria-expanded","true"),fe(c,"aria-controls",r[1]),fe(o,"class","accordion-header"),fe(a,"class","accordion-body"),fe(h,"id",r[1]),fe(h,"class","accordion-collapse collapse"),pr(h,"show",r[0]),fe(n,"class","accordion-item"),fe(e,"class","accordion mb-3")},m(E,T){we(E,e,T),he(e,n),he(n,o),he(o,c),k&&k.m(c,null),he(n,d),he(n,h),he(h,a),C&&C.m(a,null),_=!0},p(E,[T]){k&&k.p&&(!_||T&4)&&kn(k,S,E,E[2],_?xn(S,E[2],T,bC):Sn(E[2]),ay),C&&C.p&&(!_||T&4)&&kn(C,y,E,E[2],_?xn(y,E[2],T,yC):Sn(E[2]),oy),(!_||T&1)&&pr(h,"show",E[0])},i(E){_||(Le(k,E),Le(C,E),_=!0)},o(E){Be(k,E),Be(C,E),_=!1},d(E){E&&ve(e),k&&k.d(E),C&&C.d(E)}}}function wC(r,e,n){let{$$slots:o={},$$scope:c}=e,{open:d=!0}=e,h=_C();return r.$$set=a=>{"open"in a&&n(0,d=a.open),"$$scope"in a&&n(2,c=a.$$scope)},[d,h,c,o]}class iu extends ci{constructor(e){super(),li(this,e,wC,vC,$t,{open:0})}}function ly(r,e,n){const o=r.slice();return o[13]=e[n][0],o[14]=e[n][1],o}function xC(r){let e;return{c(){e=ke("div"),e.textContent="Problems",fe(e,"slot","header")},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function cy(r){let e,n=r[13]+"",o,c,d=r[14]+"",h,a,_,S;return{c(){e=ke("option"),o=vt(n),c=vt(" ("),h=vt(d),a=vt(`)
        `),e.__value=_=r[13],jr(e,e.__value),e.disabled=S=r[14]==0},m(k,y){we(k,e,y),he(e,o),he(e,c),he(e,h),he(e,a)},p(k,y){y&4&&n!==(n=k[13]+"")&&vi(o,n),y&4&&d!==(d=k[14]+"")&&vi(h,d),y&4&&_!==(_=k[13])&&(e.__value=_,jr(e,e.__value)),y&4&&S!==(S=k[14]==0)&&(e.disabled=S)},d(k){k&&ve(e)}}}function uy(r){let e,n,o=r[2][r[1]]+"",c,d,h,a=r[0].features.length>0&&hy(r);return{c(){e=ke("div"),n=ke("p"),c=vt(o),d=vt(" problems"),h=qe(),a&&a.c(),fe(n,"class","problem-count svelte-d7yah8"),fe(e,"class","problem-header svelte-d7yah8")},m(_,S){we(_,e,S),he(e,n),he(n,c),he(n,d),he(e,h),a&&a.m(e,null)},p(_,S){S&6&&o!==(o=_[2][_[1]]+"")&&vi(c,o),_[0].features.length>0?a?a.p(_,S):(a=hy(_),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(_){_&&ve(e),a&&a.d()}}}function hy(r){let e,n,o;return{c(){e=ke("button"),e.textContent="Pick next",fe(e,"class","btn btn-sm btn-primary")},m(c,d){we(c,e,d),n||(o=Zt(e,"click",r[3]),n=!0)},p:Ut,d(c){c&&ve(e),n=!1,o()}}}function kC(r){let e;return{c(){e=ke("p"),e.textContent=`These roads have separate sidewalks tagged on one side, but the other
        side is unspecified or not drawn separately. Be consistent on each road
        and use another editor to draw separate sidewalks on both sides.`},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function SC(r){let e;return{c(){e=ke("p"),e.innerHTML=`<i>sidewalk=separate</i>
        is ambiguous. Update the tagging to specify if there are separate sidewalks
        on both sides or just one.`},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function TC(r){let e,n,o,c,d;return{c(){e=ke("p"),e.textContent=`These roads aren't tagged as having separate sidewalks, but it looks
        like there's a parallel separate sidewalk already mapped.`,n=qe(),o=ke("ol"),o.innerHTML=`<li>Check each segment. If separate sidewalks are already there, update
          the tagging here.</li> <li>If the separate sidewalks don&#39;t cover the entire length of the road,
          ideally go finish drawing the separate sidewalks in another tool, then
          update the tagging on the road.</li>`,c=qe(),d=ke("p"),d.textContent="There are false positives. Check the full length of the road."},m(h,a){we(h,e,a),we(h,n,a),we(h,o,a),we(h,c,a),we(h,d,a)},d(h){h&&(ve(e),ve(n),ve(o),ve(c),ve(d))}}}function CC(r){let e,n,o;return{c(){e=ke("p"),e.innerHTML=`Here are footways with a crossing node, but the way needs to be split
        and tagged as <i>footway=crossing</i>
        .`,n=qe(),o=ke("ol"),o.innerHTML=`<li>Open in another editor</li> <li>Split the way around the crossing</li> <li>Tag <i>footway=crossing</i>
          on the smaller segment</li> <li>Refresh the data here to verify</li>`},m(c,d){we(c,e,d),we(c,n,d),we(c,o,d)},d(c){c&&(ve(e),ve(n),ve(o))}}}function EC(r){let e,n,o,c,d;return{c(){e=ke("p"),e.textContent=`Here are places where part of a road has separate sidewalks tagged, but
        then the next part of the road doesn't. It's best to be consistent about
        separate sidewalks along the entire length of a road. To fix:`,n=qe(),o=ke("ol"),o.innerHTML=`<li>Go map separate sidewalks along the entire road (in another editor)</li> <li>Update the road tagging to indicate those separate sidewalks (here or
          in another editor)</li> <li>Refresh the data here to verify</li>`,c=qe(),d=ke("p"),d.textContent=`(This problem is detected when the road names are the same, so there are
        some false positives you can ignore.)`},m(h,a){we(h,e,a),we(h,n,a),we(h,o,a),we(h,c,a),we(h,d,a)},d(h){h&&(ve(e),ve(n),ve(o),ve(c),ve(d))}}}function IC(r){let e;return{c(){e=ke("p"),e.textContent=`When a crossing way hits a road, the node should be tagged as a
        crossing. Instructions to fix are TODO.`},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function AC(r){let e,n,o,c,d,h,a,_=Ri(Object.entries(r[2])),S=[];for(let T=0;T<_.length;T+=1)S[T]=cy(ly(r,_,T));let k=r[1]&&uy(r);function y(T,L){if(T[1]=="missing crossing node")return IC;if(T[1]=="separate sidewalks should be continued here")return EC;if(T[1]=="missing footway=crossing")return CC;if(T[1]=="possible separate sidewalk near way without it tagged")return TC;if(T[1]=="sidewalk=separate is ambiguous about the side")return SC;if(T[1]=="sidewalk:left and sidewalk:right should each be tagged as separate or no")return kC}let C=y(r),E=C&&C(r);return{c(){e=ke("div"),n=ke("select"),o=ke("option"),o.textContent="Show a type of problem";for(let T=0;T<S.length;T+=1)S[T].c();c=qe(),k&&k.c(),d=qe(),E&&E.c(),o.__value="",jr(o,o.__value),fe(n,"class","form-select"),r[1]===void 0&&pf(()=>r[7].call(n)),fe(e,"slot","body")},m(T,L){we(T,e,L),he(e,n),he(n,o);for(let R=0;R<S.length;R+=1)S[R]&&S[R].m(n,null);fg(n,r[1],!0),he(e,c),k&&k.m(e,null),he(e,d),E&&E.m(e,null),h||(a=Zt(n,"change",r[7]),h=!0)},p(T,L){if(L&4){_=Ri(Object.entries(T[2]));let R;for(R=0;R<_.length;R+=1){const N=ly(T,_,R);S[R]?S[R].p(N,L):(S[R]=cy(N),S[R].c(),S[R].m(n,null))}for(;R<S.length;R+=1)S[R].d(1);S.length=_.length}L&6&&fg(n,T[1]),T[1]?k?k.p(T,L):(k=uy(T),k.c(),k.m(e,d)):k&&(k.d(1),k=null),C!==(C=y(T))&&(E&&E.d(1),E=C&&C(T),E&&(E.c(),E.m(e,null)))},d(T){T&&ve(e),Qn(S,T),k&&k.d(),E&&E.d(),h=!1,a()}}}function MC(r){let e,n;return e=new iu({props:{$$slots:{body:[AC],header:[xC]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,[c]){const d={};c&131079&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function PC(r,e,n){let o,c;jt(r,ol,R=>n(8,c=R));let{nodes:d}=e,{ways:h}=e,{drawProblems:a}=e,_=["missing crossing node","separate sidewalks should be continued here"],S=["missing footway=crossing","possible separate sidewalk near way without it tagged","sidewalk=separate is ambiguous about the side","sidewalk:left and sidewalk:right should each be tagged as separate or no"],k="",y=0;function C(R,N){let z={};for(let V of[..._,...S])z[V]=0;for(let V of[...d.features,...h.features])for(let Q of V.properties.problems)z[Q.note]+=1;return z}function E(R,N,z){let V={type:"FeatureCollection",features:[]};for(let Q of[...d.features,...h.features])Q.properties.problems.some(oe=>oe.note==k)&&V.features.push(Q);return V}function T(){if(!c||!k||a.features.length===0)return;const R=a.features[y];n(6,y=(y+1)%a.features.length);try{if(R.geometry.type==="Point"){const N=R.geometry.coordinates;c.flyTo({center:[N[0],N[1]],zoom:19,animate:!0})}else{const N=yb(R);c.fitBounds(N,{animate:!0,padding:50})}}catch(N){console.error("Error focusing on problem:",N)}}function L(){k=T1(this),n(1,k),n(2,o),n(4,d),n(5,h)}return r.$$set=R=>{"nodes"in R&&n(4,d=R.nodes),"ways"in R&&n(5,h=R.ways),"drawProblems"in R&&n(0,a=R.drawProblems)},r.$$.update=()=>{r.$$.dirty&48&&n(2,o=C()),r.$$.dirty&50&&n(0,a=E()),r.$$.dirty&2&&k&&n(6,y=0),r.$$.dirty&65&&y>=a.features.length&&a.features.length>0&&n(6,y=0)},[a,k,o,T,d,h,y,L]}class LC extends ci{constructor(e){super(),li(this,e,PC,MC,$t,{nodes:4,ways:5,drawProblems:0})}}function zC(r){let e,n,o,c,d,h;return e=new Wl({props:{filter:_b,paint:{"circle-radius":10,"circle-color":"red","circle-opacity":.5,"circle-stroke-color":"black","circle-stroke-width":1}}}),o=new ga({props:{filter:Qd,maxzoom:16,paint:{"line-width":fa(15),"line-color":"red","line-opacity":r[2],"line-blur":5},layout:{visibility:r[1]?"none":"visible"}}}),d=new ga({props:{filter:Qd,beforeId:"Road labels",minzoom:16,paint:{"line-width":fa(20),"line-color":"red","line-opacity":r[2],"line-blur":5},layout:{visibility:r[1]?"none":"visible"}}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment),c=qe(),ht(d.$$.fragment)},m(a,_){ct(e,a,_),we(a,n,_),ct(o,a,_),we(a,c,_),ct(d,a,_),h=!0},p(a,_){const S={};_&4&&(S.paint={"line-width":fa(15),"line-color":"red","line-opacity":a[2],"line-blur":5}),_&2&&(S.layout={visibility:a[1]?"none":"visible"}),o.$set(S);const k={};_&4&&(k.paint={"line-width":fa(20),"line-color":"red","line-opacity":a[2],"line-blur":5}),_&2&&(k.layout={visibility:a[1]?"none":"visible"}),d.$set(k)},i(a){h||(Le(e.$$.fragment,a),Le(o.$$.fragment,a),Le(d.$$.fragment,a),h=!0)},o(a){Be(e.$$.fragment,a),Be(o.$$.fragment,a),Be(d.$$.fragment,a),h=!1},d(a){a&&(ve(n),ve(c)),ut(e,a),ut(o,a),ut(d,a)}}}function OC(r){let e,n;return e=new Er({props:{data:r[0],$$slots:{default:[zC]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,[c]){const d={};c&1&&(d.data=o[0]),c&22&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function DC(r,e,n){let{drawProblems:o}=e,{pinnedWay:c}=e,d=.5;function h(a){let _=2500,S=.35,k=.85,y=(Math.sin(a/_*Math.PI*2)+1)/2;n(2,d=S+y*(k-S)),requestAnimationFrame(h)}return requestAnimationFrame(h),r.$$set=a=>{"drawProblems"in a&&n(0,o=a.drawProblems),"pinnedWay"in a&&n(1,c=a.pinnedWay)},[o,c,d]}class FC extends ci{constructor(e){super(),li(this,e,DC,OC,$t,{drawProblems:0,pinnedWay:1})}}function lf(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xb={exports:{}};(function(r,e){(function(n){r.exports=n()})(function(){return function(){function n(o,c,d){function h(S,k){if(!c[S]){if(!o[S]){var y=typeof lf=="function"&&lf;if(!k&&y)return y(S,!0);if(a)return a(S,!0);var C=new Error("Cannot find module '"+S+"'");throw C.code="MODULE_NOT_FOUND",C}var E=c[S]={exports:{}};o[S][0].call(E.exports,function(T){var L=o[S][1][T];return h(L||T)},E,E.exports,n,o,c,d)}return c[S].exports}for(var a=typeof lf=="function"&&lf,_=0;_<d.length;_++)h(d[_]);return h}return n}()({1:[function(n,o,c){c.byteLength=C,c.toByteArray=T,c.fromByteArray=N;for(var d=[],h=[],a=typeof Uint8Array<"u"?Uint8Array:Array,_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=0,k=_.length;S<k;++S)d[S]=_[S],h[_.charCodeAt(S)]=S;h[45]=62,h[95]=63;function y(z){var V=z.length;if(V%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Q=z.indexOf("=");Q===-1&&(Q=V);var oe=Q===V?0:4-Q%4;return[Q,oe]}function C(z){var V=y(z),Q=V[0],oe=V[1];return(Q+oe)*3/4-oe}function E(z,V,Q){return(V+Q)*3/4-Q}function T(z){var V,Q=y(z),oe=Q[0],ee=Q[1],ne=new a(E(z,oe,ee)),j=0,U=ee>0?oe-4:oe,X;for(X=0;X<U;X+=4)V=h[z.charCodeAt(X)]<<18|h[z.charCodeAt(X+1)]<<12|h[z.charCodeAt(X+2)]<<6|h[z.charCodeAt(X+3)],ne[j++]=V>>16&255,ne[j++]=V>>8&255,ne[j++]=V&255;return ee===2&&(V=h[z.charCodeAt(X)]<<2|h[z.charCodeAt(X+1)]>>4,ne[j++]=V&255),ee===1&&(V=h[z.charCodeAt(X)]<<10|h[z.charCodeAt(X+1)]<<4|h[z.charCodeAt(X+2)]>>2,ne[j++]=V>>8&255,ne[j++]=V&255),ne}function L(z){return d[z>>18&63]+d[z>>12&63]+d[z>>6&63]+d[z&63]}function R(z,V,Q){for(var oe,ee=[],ne=V;ne<Q;ne+=3)oe=(z[ne]<<16&16711680)+(z[ne+1]<<8&65280)+(z[ne+2]&255),ee.push(L(oe));return ee.join("")}function N(z){for(var V,Q=z.length,oe=Q%3,ee=[],ne=16383,j=0,U=Q-oe;j<U;j+=ne)ee.push(R(z,j,j+ne>U?U:j+ne));return oe===1?(V=z[Q-1],ee.push(d[V>>2]+d[V<<4&63]+"==")):oe===2&&(V=(z[Q-2]<<8)+z[Q-1],ee.push(d[V>>10]+d[V>>4&63]+d[V<<2&63]+"=")),ee.join("")}},{}],2:[function(n,o,c){(function(d){(function(){var h=n("base64-js"),a=n("ieee754");c.Buffer=y,c.SlowBuffer=oe,c.INSPECT_MAX_BYTES=50;var _=2147483647;c.kMaxLength=_,y.TYPED_ARRAY_SUPPORT=S(),!y.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function S(){try{var ue=new Uint8Array(1);return ue.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},ue.foo()===42}catch{return!1}}Object.defineProperty(y.prototype,"parent",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.buffer}}),Object.defineProperty(y.prototype,"offset",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.byteOffset}});function k(ue){if(ue>_)throw new RangeError('The value "'+ue+'" is invalid for option "size"');var H=new Uint8Array(ue);return H.__proto__=y.prototype,H}function y(ue,H,Y){if(typeof ue=="number"){if(typeof H=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return L(ue)}return C(ue,H,Y)}typeof Symbol<"u"&&Symbol.species!=null&&y[Symbol.species]===y&&Object.defineProperty(y,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),y.poolSize=8192;function C(ue,H,Y){if(typeof ue=="string")return R(ue,H);if(ArrayBuffer.isView(ue))return N(ue);if(ue==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ue);if(_t(ue,ArrayBuffer)||ue&&_t(ue.buffer,ArrayBuffer))return z(ue,H,Y);if(typeof ue=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var Ae=ue.valueOf&&ue.valueOf();if(Ae!=null&&Ae!==ue)return y.from(Ae,H,Y);var Ze=V(ue);if(Ze)return Ze;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ue[Symbol.toPrimitive]=="function")return y.from(ue[Symbol.toPrimitive]("string"),H,Y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ue)}y.from=function(ue,H,Y){return C(ue,H,Y)},y.prototype.__proto__=Uint8Array.prototype,y.__proto__=Uint8Array;function E(ue){if(typeof ue!="number")throw new TypeError('"size" argument must be of type number');if(ue<0)throw new RangeError('The value "'+ue+'" is invalid for option "size"')}function T(ue,H,Y){return E(ue),ue<=0?k(ue):H!==void 0?typeof Y=="string"?k(ue).fill(H,Y):k(ue).fill(H):k(ue)}y.alloc=function(ue,H,Y){return T(ue,H,Y)};function L(ue){return E(ue),k(ue<0?0:Q(ue)|0)}y.allocUnsafe=function(ue){return L(ue)},y.allocUnsafeSlow=function(ue){return L(ue)};function R(ue,H){if((typeof H!="string"||H==="")&&(H="utf8"),!y.isEncoding(H))throw new TypeError("Unknown encoding: "+H);var Y=ee(ue,H)|0,Ae=k(Y),Ze=Ae.write(ue,H);return Ze!==Y&&(Ae=Ae.slice(0,Ze)),Ae}function N(ue){for(var H=ue.length<0?0:Q(ue.length)|0,Y=k(H),Ae=0;Ae<H;Ae+=1)Y[Ae]=ue[Ae]&255;return Y}function z(ue,H,Y){if(H<0||ue.byteLength<H)throw new RangeError('"offset" is outside of buffer bounds');if(ue.byteLength<H+(Y||0))throw new RangeError('"length" is outside of buffer bounds');var Ae;return H===void 0&&Y===void 0?Ae=new Uint8Array(ue):Y===void 0?Ae=new Uint8Array(ue,H):Ae=new Uint8Array(ue,H,Y),Ae.__proto__=y.prototype,Ae}function V(ue){if(y.isBuffer(ue)){var H=Q(ue.length)|0,Y=k(H);return Y.length===0||ue.copy(Y,0,0,H),Y}if(ue.length!==void 0)return typeof ue.length!="number"||it(ue.length)?k(0):N(ue);if(ue.type==="Buffer"&&Array.isArray(ue.data))return N(ue.data)}function Q(ue){if(ue>=_)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+_.toString(16)+" bytes");return ue|0}function oe(ue){return+ue!=ue&&(ue=0),y.alloc(+ue)}y.isBuffer=function(H){return H!=null&&H._isBuffer===!0&&H!==y.prototype},y.compare=function(H,Y){if(_t(H,Uint8Array)&&(H=y.from(H,H.offset,H.byteLength)),_t(Y,Uint8Array)&&(Y=y.from(Y,Y.offset,Y.byteLength)),!y.isBuffer(H)||!y.isBuffer(Y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(H===Y)return 0;for(var Ae=H.length,Ze=Y.length,dt=0,st=Math.min(Ae,Ze);dt<st;++dt)if(H[dt]!==Y[dt]){Ae=H[dt],Ze=Y[dt];break}return Ae<Ze?-1:Ze<Ae?1:0},y.isEncoding=function(H){switch(String(H).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},y.concat=function(H,Y){if(!Array.isArray(H))throw new TypeError('"list" argument must be an Array of Buffers');if(H.length===0)return y.alloc(0);var Ae;if(Y===void 0)for(Y=0,Ae=0;Ae<H.length;++Ae)Y+=H[Ae].length;var Ze=y.allocUnsafe(Y),dt=0;for(Ae=0;Ae<H.length;++Ae){var st=H[Ae];if(_t(st,Uint8Array)&&(st=y.from(st)),!y.isBuffer(st))throw new TypeError('"list" argument must be an Array of Buffers');st.copy(Ze,dt),dt+=st.length}return Ze};function ee(ue,H){if(y.isBuffer(ue))return ue.length;if(ArrayBuffer.isView(ue)||_t(ue,ArrayBuffer))return ue.byteLength;if(typeof ue!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ue);var Y=ue.length,Ae=arguments.length>2&&arguments[2]===!0;if(!Ae&&Y===0)return 0;for(var Ze=!1;;)switch(H){case"ascii":case"latin1":case"binary":return Y;case"utf8":case"utf-8":return Xe(ue).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y*2;case"hex":return Y>>>1;case"base64":return Qe(ue).length;default:if(Ze)return Ae?-1:Xe(ue).length;H=(""+H).toLowerCase(),Ze=!0}}y.byteLength=ee;function ne(ue,H,Y){var Ae=!1;if((H===void 0||H<0)&&(H=0),H>this.length||((Y===void 0||Y>this.length)&&(Y=this.length),Y<=0)||(Y>>>=0,H>>>=0,Y<=H))return"";for(ue||(ue="utf8");;)switch(ue){case"hex":return Tt(this,H,Y);case"utf8":case"utf-8":return Ie(this,H,Y);case"ascii":return We(this,H,Y);case"latin1":case"binary":return pt(this,H,Y);case"base64":return ye(this,H,Y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $e(this,H,Y);default:if(Ae)throw new TypeError("Unknown encoding: "+ue);ue=(ue+"").toLowerCase(),Ae=!0}}y.prototype._isBuffer=!0;function j(ue,H,Y){var Ae=ue[H];ue[H]=ue[Y],ue[Y]=Ae}y.prototype.swap16=function(){var H=this.length;if(H%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Y=0;Y<H;Y+=2)j(this,Y,Y+1);return this},y.prototype.swap32=function(){var H=this.length;if(H%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Y=0;Y<H;Y+=4)j(this,Y,Y+3),j(this,Y+1,Y+2);return this},y.prototype.swap64=function(){var H=this.length;if(H%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Y=0;Y<H;Y+=8)j(this,Y,Y+7),j(this,Y+1,Y+6),j(this,Y+2,Y+5),j(this,Y+3,Y+4);return this},y.prototype.toString=function(){var H=this.length;return H===0?"":arguments.length===0?Ie(this,0,H):ne.apply(this,arguments)},y.prototype.toLocaleString=y.prototype.toString,y.prototype.equals=function(H){if(!y.isBuffer(H))throw new TypeError("Argument must be a Buffer");return this===H?!0:y.compare(this,H)===0},y.prototype.inspect=function(){var H="",Y=c.INSPECT_MAX_BYTES;return H=this.toString("hex",0,Y).replace(/(.{2})/g,"$1 ").trim(),this.length>Y&&(H+=" ... "),"<Buffer "+H+">"},y.prototype.compare=function(H,Y,Ae,Ze,dt){if(_t(H,Uint8Array)&&(H=y.from(H,H.offset,H.byteLength)),!y.isBuffer(H))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof H);if(Y===void 0&&(Y=0),Ae===void 0&&(Ae=H?H.length:0),Ze===void 0&&(Ze=0),dt===void 0&&(dt=this.length),Y<0||Ae>H.length||Ze<0||dt>this.length)throw new RangeError("out of range index");if(Ze>=dt&&Y>=Ae)return 0;if(Ze>=dt)return-1;if(Y>=Ae)return 1;if(Y>>>=0,Ae>>>=0,Ze>>>=0,dt>>>=0,this===H)return 0;for(var st=dt-Ze,Ci=Ae-Y,ft=Math.min(st,Ci),Wt=this.slice(Ze,dt),Ei=H.slice(Y,Ae),Fi=0;Fi<ft;++Fi)if(Wt[Fi]!==Ei[Fi]){st=Wt[Fi],Ci=Ei[Fi];break}return st<Ci?-1:Ci<st?1:0};function U(ue,H,Y,Ae,Ze){if(ue.length===0)return-1;if(typeof Y=="string"?(Ae=Y,Y=0):Y>2147483647?Y=2147483647:Y<-2147483648&&(Y=-2147483648),Y=+Y,it(Y)&&(Y=Ze?0:ue.length-1),Y<0&&(Y=ue.length+Y),Y>=ue.length){if(Ze)return-1;Y=ue.length-1}else if(Y<0)if(Ze)Y=0;else return-1;if(typeof H=="string"&&(H=y.from(H,Ae)),y.isBuffer(H))return H.length===0?-1:X(ue,H,Y,Ae,Ze);if(typeof H=="number")return H=H&255,typeof Uint8Array.prototype.indexOf=="function"?Ze?Uint8Array.prototype.indexOf.call(ue,H,Y):Uint8Array.prototype.lastIndexOf.call(ue,H,Y):X(ue,[H],Y,Ae,Ze);throw new TypeError("val must be string, number or Buffer")}function X(ue,H,Y,Ae,Ze){var dt=1,st=ue.length,Ci=H.length;if(Ae!==void 0&&(Ae=String(Ae).toLowerCase(),Ae==="ucs2"||Ae==="ucs-2"||Ae==="utf16le"||Ae==="utf-16le")){if(ue.length<2||H.length<2)return-1;dt=2,st/=2,Ci/=2,Y/=2}function ft(kt,ui){return dt===1?kt[ui]:kt.readUInt16BE(ui*dt)}var Wt;if(Ze){var Ei=-1;for(Wt=Y;Wt<st;Wt++)if(ft(ue,Wt)===ft(H,Ei===-1?0:Wt-Ei)){if(Ei===-1&&(Ei=Wt),Wt-Ei+1===Ci)return Ei*dt}else Ei!==-1&&(Wt-=Wt-Ei),Ei=-1}else for(Y+Ci>st&&(Y=st-Ci),Wt=Y;Wt>=0;Wt--){for(var Fi=!0,Cn=0;Cn<Ci;Cn++)if(ft(ue,Wt+Cn)!==ft(H,Cn)){Fi=!1;break}if(Fi)return Wt}return-1}y.prototype.includes=function(H,Y,Ae){return this.indexOf(H,Y,Ae)!==-1},y.prototype.indexOf=function(H,Y,Ae){return U(this,H,Y,Ae,!0)},y.prototype.lastIndexOf=function(H,Y,Ae){return U(this,H,Y,Ae,!1)};function B(ue,H,Y,Ae){Y=Number(Y)||0;var Ze=ue.length-Y;Ae?(Ae=Number(Ae),Ae>Ze&&(Ae=Ze)):Ae=Ze;var dt=H.length;Ae>dt/2&&(Ae=dt/2);for(var st=0;st<Ae;++st){var Ci=parseInt(H.substr(st*2,2),16);if(it(Ci))return st;ue[Y+st]=Ci}return st}function W(ue,H,Y,Ae){return _i(Xe(H,ue.length-Y),ue,Y,Ae)}function ce(ue,H,Y,Ae){return _i(Pt(H),ue,Y,Ae)}function pe(ue,H,Y,Ae){return ce(ue,H,Y,Ae)}function be(ue,H,Y,Ae){return _i(Qe(H),ue,Y,Ae)}function de(ue,H,Y,Ae){return _i(ni(H,ue.length-Y),ue,Y,Ae)}y.prototype.write=function(H,Y,Ae,Ze){if(Y===void 0)Ze="utf8",Ae=this.length,Y=0;else if(Ae===void 0&&typeof Y=="string")Ze=Y,Ae=this.length,Y=0;else if(isFinite(Y))Y=Y>>>0,isFinite(Ae)?(Ae=Ae>>>0,Ze===void 0&&(Ze="utf8")):(Ze=Ae,Ae=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var dt=this.length-Y;if((Ae===void 0||Ae>dt)&&(Ae=dt),H.length>0&&(Ae<0||Y<0)||Y>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ze||(Ze="utf8");for(var st=!1;;)switch(Ze){case"hex":return B(this,H,Y,Ae);case"utf8":case"utf-8":return W(this,H,Y,Ae);case"ascii":return ce(this,H,Y,Ae);case"latin1":case"binary":return pe(this,H,Y,Ae);case"base64":return be(this,H,Y,Ae);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return de(this,H,Y,Ae);default:if(st)throw new TypeError("Unknown encoding: "+Ze);Ze=(""+Ze).toLowerCase(),st=!0}},y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ye(ue,H,Y){return H===0&&Y===ue.length?h.fromByteArray(ue):h.fromByteArray(ue.slice(H,Y))}function Ie(ue,H,Y){Y=Math.min(ue.length,Y);for(var Ae=[],Ze=H;Ze<Y;){var dt=ue[Ze],st=null,Ci=dt>239?4:dt>223?3:dt>191?2:1;if(Ze+Ci<=Y){var ft,Wt,Ei,Fi;switch(Ci){case 1:dt<128&&(st=dt);break;case 2:ft=ue[Ze+1],(ft&192)===128&&(Fi=(dt&31)<<6|ft&63,Fi>127&&(st=Fi));break;case 3:ft=ue[Ze+1],Wt=ue[Ze+2],(ft&192)===128&&(Wt&192)===128&&(Fi=(dt&15)<<12|(ft&63)<<6|Wt&63,Fi>2047&&(Fi<55296||Fi>57343)&&(st=Fi));break;case 4:ft=ue[Ze+1],Wt=ue[Ze+2],Ei=ue[Ze+3],(ft&192)===128&&(Wt&192)===128&&(Ei&192)===128&&(Fi=(dt&15)<<18|(ft&63)<<12|(Wt&63)<<6|Ei&63,Fi>65535&&Fi<1114112&&(st=Fi))}}st===null?(st=65533,Ci=1):st>65535&&(st-=65536,Ae.push(st>>>10&1023|55296),st=56320|st&1023),Ae.push(st),Ze+=Ci}return ot(Ae)}var Me=4096;function ot(ue){var H=ue.length;if(H<=Me)return String.fromCharCode.apply(String,ue);for(var Y="",Ae=0;Ae<H;)Y+=String.fromCharCode.apply(String,ue.slice(Ae,Ae+=Me));return Y}function We(ue,H,Y){var Ae="";Y=Math.min(ue.length,Y);for(var Ze=H;Ze<Y;++Ze)Ae+=String.fromCharCode(ue[Ze]&127);return Ae}function pt(ue,H,Y){var Ae="";Y=Math.min(ue.length,Y);for(var Ze=H;Ze<Y;++Ze)Ae+=String.fromCharCode(ue[Ze]);return Ae}function Tt(ue,H,Y){var Ae=ue.length;(!H||H<0)&&(H=0),(!Y||Y<0||Y>Ae)&&(Y=Ae);for(var Ze="",dt=H;dt<Y;++dt)Ze+=At(ue[dt]);return Ze}function $e(ue,H,Y){for(var Ae=ue.slice(H,Y),Ze="",dt=0;dt<Ae.length;dt+=2)Ze+=String.fromCharCode(Ae[dt]+Ae[dt+1]*256);return Ze}y.prototype.slice=function(H,Y){var Ae=this.length;H=~~H,Y=Y===void 0?Ae:~~Y,H<0?(H+=Ae,H<0&&(H=0)):H>Ae&&(H=Ae),Y<0?(Y+=Ae,Y<0&&(Y=0)):Y>Ae&&(Y=Ae),Y<H&&(Y=H);var Ze=this.subarray(H,Y);return Ze.__proto__=y.prototype,Ze};function wt(ue,H,Y){if(ue%1!==0||ue<0)throw new RangeError("offset is not uint");if(ue+H>Y)throw new RangeError("Trying to access beyond buffer length")}y.prototype.readUIntLE=function(H,Y,Ae){H=H>>>0,Y=Y>>>0,Ae||wt(H,Y,this.length);for(var Ze=this[H],dt=1,st=0;++st<Y&&(dt*=256);)Ze+=this[H+st]*dt;return Ze},y.prototype.readUIntBE=function(H,Y,Ae){H=H>>>0,Y=Y>>>0,Ae||wt(H,Y,this.length);for(var Ze=this[H+--Y],dt=1;Y>0&&(dt*=256);)Ze+=this[H+--Y]*dt;return Ze},y.prototype.readUInt8=function(H,Y){return H=H>>>0,Y||wt(H,1,this.length),this[H]},y.prototype.readUInt16LE=function(H,Y){return H=H>>>0,Y||wt(H,2,this.length),this[H]|this[H+1]<<8},y.prototype.readUInt16BE=function(H,Y){return H=H>>>0,Y||wt(H,2,this.length),this[H]<<8|this[H+1]},y.prototype.readUInt32LE=function(H,Y){return H=H>>>0,Y||wt(H,4,this.length),(this[H]|this[H+1]<<8|this[H+2]<<16)+this[H+3]*16777216},y.prototype.readUInt32BE=function(H,Y){return H=H>>>0,Y||wt(H,4,this.length),this[H]*16777216+(this[H+1]<<16|this[H+2]<<8|this[H+3])},y.prototype.readIntLE=function(H,Y,Ae){H=H>>>0,Y=Y>>>0,Ae||wt(H,Y,this.length);for(var Ze=this[H],dt=1,st=0;++st<Y&&(dt*=256);)Ze+=this[H+st]*dt;return dt*=128,Ze>=dt&&(Ze-=Math.pow(2,8*Y)),Ze},y.prototype.readIntBE=function(H,Y,Ae){H=H>>>0,Y=Y>>>0,Ae||wt(H,Y,this.length);for(var Ze=Y,dt=1,st=this[H+--Ze];Ze>0&&(dt*=256);)st+=this[H+--Ze]*dt;return dt*=128,st>=dt&&(st-=Math.pow(2,8*Y)),st},y.prototype.readInt8=function(H,Y){return H=H>>>0,Y||wt(H,1,this.length),this[H]&128?(255-this[H]+1)*-1:this[H]},y.prototype.readInt16LE=function(H,Y){H=H>>>0,Y||wt(H,2,this.length);var Ae=this[H]|this[H+1]<<8;return Ae&32768?Ae|4294901760:Ae},y.prototype.readInt16BE=function(H,Y){H=H>>>0,Y||wt(H,2,this.length);var Ae=this[H+1]|this[H]<<8;return Ae&32768?Ae|4294901760:Ae},y.prototype.readInt32LE=function(H,Y){return H=H>>>0,Y||wt(H,4,this.length),this[H]|this[H+1]<<8|this[H+2]<<16|this[H+3]<<24},y.prototype.readInt32BE=function(H,Y){return H=H>>>0,Y||wt(H,4,this.length),this[H]<<24|this[H+1]<<16|this[H+2]<<8|this[H+3]},y.prototype.readFloatLE=function(H,Y){return H=H>>>0,Y||wt(H,4,this.length),a.read(this,H,!0,23,4)},y.prototype.readFloatBE=function(H,Y){return H=H>>>0,Y||wt(H,4,this.length),a.read(this,H,!1,23,4)},y.prototype.readDoubleLE=function(H,Y){return H=H>>>0,Y||wt(H,8,this.length),a.read(this,H,!0,52,8)},y.prototype.readDoubleBE=function(H,Y){return H=H>>>0,Y||wt(H,8,this.length),a.read(this,H,!1,52,8)};function St(ue,H,Y,Ae,Ze,dt){if(!y.isBuffer(ue))throw new TypeError('"buffer" argument must be a Buffer instance');if(H>Ze||H<dt)throw new RangeError('"value" argument is out of bounds');if(Y+Ae>ue.length)throw new RangeError("Index out of range")}y.prototype.writeUIntLE=function(H,Y,Ae,Ze){if(H=+H,Y=Y>>>0,Ae=Ae>>>0,!Ze){var dt=Math.pow(2,8*Ae)-1;St(this,H,Y,Ae,dt,0)}var st=1,Ci=0;for(this[Y]=H&255;++Ci<Ae&&(st*=256);)this[Y+Ci]=H/st&255;return Y+Ae},y.prototype.writeUIntBE=function(H,Y,Ae,Ze){if(H=+H,Y=Y>>>0,Ae=Ae>>>0,!Ze){var dt=Math.pow(2,8*Ae)-1;St(this,H,Y,Ae,dt,0)}var st=Ae-1,Ci=1;for(this[Y+st]=H&255;--st>=0&&(Ci*=256);)this[Y+st]=H/Ci&255;return Y+Ae},y.prototype.writeUInt8=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,1,255,0),this[Y]=H&255,Y+1},y.prototype.writeUInt16LE=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,2,65535,0),this[Y]=H&255,this[Y+1]=H>>>8,Y+2},y.prototype.writeUInt16BE=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,2,65535,0),this[Y]=H>>>8,this[Y+1]=H&255,Y+2},y.prototype.writeUInt32LE=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,4,4294967295,0),this[Y+3]=H>>>24,this[Y+2]=H>>>16,this[Y+1]=H>>>8,this[Y]=H&255,Y+4},y.prototype.writeUInt32BE=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,4,4294967295,0),this[Y]=H>>>24,this[Y+1]=H>>>16,this[Y+2]=H>>>8,this[Y+3]=H&255,Y+4},y.prototype.writeIntLE=function(H,Y,Ae,Ze){if(H=+H,Y=Y>>>0,!Ze){var dt=Math.pow(2,8*Ae-1);St(this,H,Y,Ae,dt-1,-dt)}var st=0,Ci=1,ft=0;for(this[Y]=H&255;++st<Ae&&(Ci*=256);)H<0&&ft===0&&this[Y+st-1]!==0&&(ft=1),this[Y+st]=(H/Ci>>0)-ft&255;return Y+Ae},y.prototype.writeIntBE=function(H,Y,Ae,Ze){if(H=+H,Y=Y>>>0,!Ze){var dt=Math.pow(2,8*Ae-1);St(this,H,Y,Ae,dt-1,-dt)}var st=Ae-1,Ci=1,ft=0;for(this[Y+st]=H&255;--st>=0&&(Ci*=256);)H<0&&ft===0&&this[Y+st+1]!==0&&(ft=1),this[Y+st]=(H/Ci>>0)-ft&255;return Y+Ae},y.prototype.writeInt8=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,1,127,-128),H<0&&(H=255+H+1),this[Y]=H&255,Y+1},y.prototype.writeInt16LE=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,2,32767,-32768),this[Y]=H&255,this[Y+1]=H>>>8,Y+2},y.prototype.writeInt16BE=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,2,32767,-32768),this[Y]=H>>>8,this[Y+1]=H&255,Y+2},y.prototype.writeInt32LE=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,4,2147483647,-2147483648),this[Y]=H&255,this[Y+1]=H>>>8,this[Y+2]=H>>>16,this[Y+3]=H>>>24,Y+4},y.prototype.writeInt32BE=function(H,Y,Ae){return H=+H,Y=Y>>>0,Ae||St(this,H,Y,4,2147483647,-2147483648),H<0&&(H=4294967295+H+1),this[Y]=H>>>24,this[Y+1]=H>>>16,this[Y+2]=H>>>8,this[Y+3]=H&255,Y+4};function Ht(ue,H,Y,Ae,Ze,dt){if(Y+Ae>ue.length)throw new RangeError("Index out of range");if(Y<0)throw new RangeError("Index out of range")}function oi(ue,H,Y,Ae,Ze){return H=+H,Y=Y>>>0,Ze||Ht(ue,H,Y,4),a.write(ue,H,Y,Ae,23,4),Y+4}y.prototype.writeFloatLE=function(H,Y,Ae){return oi(this,H,Y,!0,Ae)},y.prototype.writeFloatBE=function(H,Y,Ae){return oi(this,H,Y,!1,Ae)};function Mi(ue,H,Y,Ae,Ze){return H=+H,Y=Y>>>0,Ze||Ht(ue,H,Y,8),a.write(ue,H,Y,Ae,52,8),Y+8}y.prototype.writeDoubleLE=function(H,Y,Ae){return Mi(this,H,Y,!0,Ae)},y.prototype.writeDoubleBE=function(H,Y,Ae){return Mi(this,H,Y,!1,Ae)},y.prototype.copy=function(H,Y,Ae,Ze){if(!y.isBuffer(H))throw new TypeError("argument should be a Buffer");if(Ae||(Ae=0),!Ze&&Ze!==0&&(Ze=this.length),Y>=H.length&&(Y=H.length),Y||(Y=0),Ze>0&&Ze<Ae&&(Ze=Ae),Ze===Ae||H.length===0||this.length===0)return 0;if(Y<0)throw new RangeError("targetStart out of bounds");if(Ae<0||Ae>=this.length)throw new RangeError("Index out of range");if(Ze<0)throw new RangeError("sourceEnd out of bounds");Ze>this.length&&(Ze=this.length),H.length-Y<Ze-Ae&&(Ze=H.length-Y+Ae);var dt=Ze-Ae;if(this===H&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(Y,Ae,Ze);else if(this===H&&Ae<Y&&Y<Ze)for(var st=dt-1;st>=0;--st)H[st+Y]=this[st+Ae];else Uint8Array.prototype.set.call(H,this.subarray(Ae,Ze),Y);return dt},y.prototype.fill=function(H,Y,Ae,Ze){if(typeof H=="string"){if(typeof Y=="string"?(Ze=Y,Y=0,Ae=this.length):typeof Ae=="string"&&(Ze=Ae,Ae=this.length),Ze!==void 0&&typeof Ze!="string")throw new TypeError("encoding must be a string");if(typeof Ze=="string"&&!y.isEncoding(Ze))throw new TypeError("Unknown encoding: "+Ze);if(H.length===1){var dt=H.charCodeAt(0);(Ze==="utf8"&&dt<128||Ze==="latin1")&&(H=dt)}}else typeof H=="number"&&(H=H&255);if(Y<0||this.length<Y||this.length<Ae)throw new RangeError("Out of range index");if(Ae<=Y)return this;Y=Y>>>0,Ae=Ae===void 0?this.length:Ae>>>0,H||(H=0);var st;if(typeof H=="number")for(st=Y;st<Ae;++st)this[st]=H;else{var Ci=y.isBuffer(H)?H:y.from(H,Ze),ft=Ci.length;if(ft===0)throw new TypeError('The value "'+H+'" is invalid for argument "value"');for(st=0;st<Ae-Y;++st)this[st+Y]=Ci[st%ft]}return this};var Pi=/[^+/0-9A-Za-z-_]/g;function Ti(ue){if(ue=ue.split("=")[0],ue=ue.trim().replace(Pi,""),ue.length<2)return"";for(;ue.length%4!==0;)ue=ue+"=";return ue}function At(ue){return ue<16?"0"+ue.toString(16):ue.toString(16)}function Xe(ue,H){H=H||1/0;for(var Y,Ae=ue.length,Ze=null,dt=[],st=0;st<Ae;++st){if(Y=ue.charCodeAt(st),Y>55295&&Y<57344){if(!Ze){if(Y>56319){(H-=3)>-1&&dt.push(239,191,189);continue}else if(st+1===Ae){(H-=3)>-1&&dt.push(239,191,189);continue}Ze=Y;continue}if(Y<56320){(H-=3)>-1&&dt.push(239,191,189),Ze=Y;continue}Y=(Ze-55296<<10|Y-56320)+65536}else Ze&&(H-=3)>-1&&dt.push(239,191,189);if(Ze=null,Y<128){if((H-=1)<0)break;dt.push(Y)}else if(Y<2048){if((H-=2)<0)break;dt.push(Y>>6|192,Y&63|128)}else if(Y<65536){if((H-=3)<0)break;dt.push(Y>>12|224,Y>>6&63|128,Y&63|128)}else if(Y<1114112){if((H-=4)<0)break;dt.push(Y>>18|240,Y>>12&63|128,Y>>6&63|128,Y&63|128)}else throw new Error("Invalid code point")}return dt}function Pt(ue){for(var H=[],Y=0;Y<ue.length;++Y)H.push(ue.charCodeAt(Y)&255);return H}function ni(ue,H){for(var Y,Ae,Ze,dt=[],st=0;st<ue.length&&!((H-=2)<0);++st)Y=ue.charCodeAt(st),Ae=Y>>8,Ze=Y%256,dt.push(Ze),dt.push(Ae);return dt}function Qe(ue){return h.toByteArray(Ti(ue))}function _i(ue,H,Y,Ae){for(var Ze=0;Ze<Ae&&!(Ze+Y>=H.length||Ze>=ue.length);++Ze)H[Ze+Y]=ue[Ze];return Ze}function _t(ue,H){return ue instanceof H||ue!=null&&ue.constructor!=null&&ue.constructor.name!=null&&ue.constructor.name===H.name}function it(ue){return ue!==ue}}).call(this)}).call(this,n("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:14}],3:[function(n,o,c){const d=n("./validator"),h=n("./xmlparser/XMLParser"),a=n("./xmlbuilder/json2xml");o.exports={XMLParser:h,XMLValidator:d,XMLBuilder:a}},{"./validator":5,"./xmlbuilder/json2xml":6,"./xmlparser/XMLParser":11}],4:[function(n,o,c){const d=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",h=d+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",a="["+d+"]["+h+"]*",_=new RegExp("^"+a+"$"),S=function(y,C){const E=[];let T=C.exec(y);for(;T;){const L=[];L.startIndex=C.lastIndex-T[0].length;const R=T.length;for(let N=0;N<R;N++)L.push(T[N]);E.push(L),T=C.exec(y)}return E},k=function(y){const C=_.exec(y);return!(C===null||typeof C>"u")};c.isExist=function(y){return typeof y<"u"},c.isEmptyObject=function(y){return Object.keys(y).length===0},c.merge=function(y,C,E){if(C){const T=Object.keys(C),L=T.length;for(let R=0;R<L;R++)E==="strict"?y[T[R]]=[C[T[R]]]:y[T[R]]=C[T[R]]}},c.getValue=function(y){return c.isExist(y)?y:""},c.isName=k,c.getAllMatches=S,c.nameRegexp=a},{}],5:[function(n,o,c){const d=n("./util"),h={allowBooleanAttributes:!1,unpairedTags:[]};c.validate=function(ee,ne){ne=Object.assign({},h,ne);const j=[];let U=!1,X=!1;ee[0]==="\uFEFF"&&(ee=ee.substr(1));for(let B=0;B<ee.length;B++)if(ee[B]==="<"&&ee[B+1]==="?"){if(B+=2,B=_(ee,B),B.err)return B}else if(ee[B]==="<"){let W=B;if(B++,ee[B]==="!"){B=S(ee,B);continue}else{let ce=!1;ee[B]==="/"&&(ce=!0,B++);let pe="";for(;B<ee.length&&ee[B]!==">"&&ee[B]!==" "&&ee[B]!=="	"&&ee[B]!==`
`&&ee[B]!=="\r";B++)pe+=ee[B];if(pe=pe.trim(),pe[pe.length-1]==="/"&&(pe=pe.substring(0,pe.length-1),B--),!V(pe)){let ye;return pe.trim().length===0?ye="Invalid space after '<'.":ye="Tag '"+pe+"' is an invalid name.",N("InvalidTag",ye,Q(ee,B))}const be=C(ee,B);if(be===!1)return N("InvalidAttr","Attributes for '"+pe+"' have open quote.",Q(ee,B));let de=be.value;if(B=be.index,de[de.length-1]==="/"){const ye=B-de.length;de=de.substring(0,de.length-1);const Ie=T(de,ne);if(Ie===!0)U=!0;else return N(Ie.err.code,Ie.err.msg,Q(ee,ye+Ie.err.line))}else if(ce)if(be.tagClosed){if(de.trim().length>0)return N("InvalidTag","Closing tag '"+pe+"' can't have attributes or invalid starting.",Q(ee,W));if(j.length===0)return N("InvalidTag","Closing tag '"+pe+"' has not been opened.",Q(ee,W));{const ye=j.pop();if(pe!==ye.tagName){let Ie=Q(ee,ye.tagStartPos);return N("InvalidTag","Expected closing tag '"+ye.tagName+"' (opened in line "+Ie.line+", col "+Ie.col+") instead of closing tag '"+pe+"'.",Q(ee,W))}j.length==0&&(X=!0)}}else return N("InvalidTag","Closing tag '"+pe+"' doesn't have proper closing.",Q(ee,B));else{const ye=T(de,ne);if(ye!==!0)return N(ye.err.code,ye.err.msg,Q(ee,B-de.length+ye.err.line));if(X===!0)return N("InvalidXml","Multiple possible root nodes found.",Q(ee,B));ne.unpairedTags.indexOf(pe)!==-1||j.push({tagName:pe,tagStartPos:W}),U=!0}for(B++;B<ee.length;B++)if(ee[B]==="<")if(ee[B+1]==="!"){B++,B=S(ee,B);continue}else if(ee[B+1]==="?"){if(B=_(ee,++B),B.err)return B}else break;else if(ee[B]==="&"){const ye=R(ee,B);if(ye==-1)return N("InvalidChar","char '&' is not expected.",Q(ee,B));B=ye}else if(X===!0&&!a(ee[B]))return N("InvalidXml","Extra text at the end",Q(ee,B));ee[B]==="<"&&B--}}else{if(a(ee[B]))continue;return N("InvalidChar","char '"+ee[B]+"' is not expected.",Q(ee,B))}if(U){if(j.length==1)return N("InvalidTag","Unclosed tag '"+j[0].tagName+"'.",Q(ee,j[0].tagStartPos));if(j.length>0)return N("InvalidXml","Invalid '"+JSON.stringify(j.map(B=>B.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return N("InvalidXml","Start tag expected.",1);return!0};function a(ee){return ee===" "||ee==="	"||ee===`
`||ee==="\r"}function _(ee,ne){const j=ne;for(;ne<ee.length;ne++)if(ee[ne]=="?"||ee[ne]==" "){const U=ee.substr(j,ne-j);if(ne>5&&U==="xml")return N("InvalidXml","XML declaration allowed only at the start of the document.",Q(ee,ne));if(ee[ne]=="?"&&ee[ne+1]==">"){ne++;break}else continue}return ne}function S(ee,ne){if(ee.length>ne+5&&ee[ne+1]==="-"&&ee[ne+2]==="-"){for(ne+=3;ne<ee.length;ne++)if(ee[ne]==="-"&&ee[ne+1]==="-"&&ee[ne+2]===">"){ne+=2;break}}else if(ee.length>ne+8&&ee[ne+1]==="D"&&ee[ne+2]==="O"&&ee[ne+3]==="C"&&ee[ne+4]==="T"&&ee[ne+5]==="Y"&&ee[ne+6]==="P"&&ee[ne+7]==="E"){let j=1;for(ne+=8;ne<ee.length;ne++)if(ee[ne]==="<")j++;else if(ee[ne]===">"&&(j--,j===0))break}else if(ee.length>ne+9&&ee[ne+1]==="["&&ee[ne+2]==="C"&&ee[ne+3]==="D"&&ee[ne+4]==="A"&&ee[ne+5]==="T"&&ee[ne+6]==="A"&&ee[ne+7]==="["){for(ne+=8;ne<ee.length;ne++)if(ee[ne]==="]"&&ee[ne+1]==="]"&&ee[ne+2]===">"){ne+=2;break}}return ne}const k='"',y="'";function C(ee,ne){let j="",U="",X=!1;for(;ne<ee.length;ne++){if(ee[ne]===k||ee[ne]===y)U===""?U=ee[ne]:U!==ee[ne]||(U="");else if(ee[ne]===">"&&U===""){X=!0;break}j+=ee[ne]}return U!==""?!1:{value:j,index:ne,tagClosed:X}}const E=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function T(ee,ne){const j=d.getAllMatches(ee,E),U={};for(let X=0;X<j.length;X++){if(j[X][1].length===0)return N("InvalidAttr","Attribute '"+j[X][2]+"' has no space in starting.",oe(j[X]));if(j[X][3]!==void 0&&j[X][4]===void 0)return N("InvalidAttr","Attribute '"+j[X][2]+"' is without value.",oe(j[X]));if(j[X][3]===void 0&&!ne.allowBooleanAttributes)return N("InvalidAttr","boolean attribute '"+j[X][2]+"' is not allowed.",oe(j[X]));const B=j[X][2];if(!z(B))return N("InvalidAttr","Attribute '"+B+"' is an invalid name.",oe(j[X]));if(!U.hasOwnProperty(B))U[B]=1;else return N("InvalidAttr","Attribute '"+B+"' is repeated.",oe(j[X]))}return!0}function L(ee,ne){let j=/\d/;for(ee[ne]==="x"&&(ne++,j=/[\da-fA-F]/);ne<ee.length;ne++){if(ee[ne]===";")return ne;if(!ee[ne].match(j))break}return-1}function R(ee,ne){if(ne++,ee[ne]===";")return-1;if(ee[ne]==="#")return ne++,L(ee,ne);let j=0;for(;ne<ee.length;ne++,j++)if(!(ee[ne].match(/\w/)&&j<20)){if(ee[ne]===";")break;return-1}return ne}function N(ee,ne,j){return{err:{code:ee,msg:ne,line:j.line||j,col:j.col}}}function z(ee){return d.isName(ee)}function V(ee){return d.isName(ee)}function Q(ee,ne){const j=ee.substring(0,ne).split(/\r?\n/);return{line:j.length,col:j[j.length-1].length+1}}function oe(ee){return ee.startIndex+ee[1].length}},{"./util":4}],6:[function(n,o,c){const d=n("./orderedJs2Xml"),h={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(y,C){return C},attributeValueProcessor:function(y,C){return C},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function a(y){this.options=Object.assign({},h,y),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=k),this.processTextOrObjNode=_,this.options.format?(this.indentate=S,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}a.prototype.build=function(y){return this.options.preserveOrder?d(y,this.options):(Array.isArray(y)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(y={[this.options.arrayNodeName]:y}),this.j2x(y,0).val)},a.prototype.j2x=function(y,C){let E="",T="";for(let L in y)if(Object.prototype.hasOwnProperty.call(y,L))if(typeof y[L]>"u")this.isAttribute(L)&&(T+="");else if(y[L]===null)this.isAttribute(L)?T+="":L[0]==="?"?T+=this.indentate(C)+"<"+L+"?"+this.tagEndChar:T+=this.indentate(C)+"<"+L+"/"+this.tagEndChar;else if(y[L]instanceof Date)T+=this.buildTextValNode(y[L],L,"",C);else if(typeof y[L]!="object"){const R=this.isAttribute(L);if(R)E+=this.buildAttrPairStr(R,""+y[L]);else if(L===this.options.textNodeName){let N=this.options.tagValueProcessor(L,""+y[L]);T+=this.replaceEntitiesValue(N)}else T+=this.buildTextValNode(y[L],L,"",C)}else if(Array.isArray(y[L])){const R=y[L].length;let N="",z="";for(let V=0;V<R;V++){const Q=y[L][V];if(!(typeof Q>"u"))if(Q===null)L[0]==="?"?T+=this.indentate(C)+"<"+L+"?"+this.tagEndChar:T+=this.indentate(C)+"<"+L+"/"+this.tagEndChar;else if(typeof Q=="object")if(this.options.oneListGroup){const oe=this.j2x(Q,C+1);N+=oe.val,this.options.attributesGroupName&&Q.hasOwnProperty(this.options.attributesGroupName)&&(z+=oe.attrStr)}else N+=this.processTextOrObjNode(Q,L,C);else if(this.options.oneListGroup){let oe=this.options.tagValueProcessor(L,Q);oe=this.replaceEntitiesValue(oe),N+=oe}else N+=this.buildTextValNode(Q,L,"",C)}this.options.oneListGroup&&(N=this.buildObjectNode(N,L,z,C)),T+=N}else if(this.options.attributesGroupName&&L===this.options.attributesGroupName){const R=Object.keys(y[L]),N=R.length;for(let z=0;z<N;z++)E+=this.buildAttrPairStr(R[z],""+y[L][R[z]])}else T+=this.processTextOrObjNode(y[L],L,C);return{attrStr:E,val:T}},a.prototype.buildAttrPairStr=function(y,C){return C=this.options.attributeValueProcessor(y,""+C),C=this.replaceEntitiesValue(C),this.options.suppressBooleanAttributes&&C==="true"?" "+y:" "+y+'="'+C+'"'};function _(y,C,E){const T=this.j2x(y,E+1);return y[this.options.textNodeName]!==void 0&&Object.keys(y).length===1?this.buildTextValNode(y[this.options.textNodeName],C,T.attrStr,E):this.buildObjectNode(T.val,C,T.attrStr,E)}a.prototype.buildObjectNode=function(y,C,E,T){if(y==="")return C[0]==="?"?this.indentate(T)+"<"+C+E+"?"+this.tagEndChar:this.indentate(T)+"<"+C+E+this.closeTag(C)+this.tagEndChar;{let L="</"+C+this.tagEndChar,R="";return C[0]==="?"&&(R="?",L=""),(E||E==="")&&y.indexOf("<")===-1?this.indentate(T)+"<"+C+E+R+">"+y+L:this.options.commentPropName!==!1&&C===this.options.commentPropName&&R.length===0?this.indentate(T)+`<!--${y}-->`+this.newLine:this.indentate(T)+"<"+C+E+R+this.tagEndChar+y+this.indentate(T)+L}},a.prototype.closeTag=function(y){let C="";return this.options.unpairedTags.indexOf(y)!==-1?this.options.suppressUnpairedNode||(C="/"):this.options.suppressEmptyNode?C="/":C=`></${y}`,C},a.prototype.buildTextValNode=function(y,C,E,T){if(this.options.cdataPropName!==!1&&C===this.options.cdataPropName)return this.indentate(T)+`<![CDATA[${y}]]>`+this.newLine;if(this.options.commentPropName!==!1&&C===this.options.commentPropName)return this.indentate(T)+`<!--${y}-->`+this.newLine;if(C[0]==="?")return this.indentate(T)+"<"+C+E+"?"+this.tagEndChar;{let L=this.options.tagValueProcessor(C,y);return L=this.replaceEntitiesValue(L),L===""?this.indentate(T)+"<"+C+E+this.closeTag(C)+this.tagEndChar:this.indentate(T)+"<"+C+E+">"+L+"</"+C+this.tagEndChar}},a.prototype.replaceEntitiesValue=function(y){if(y&&y.length>0&&this.options.processEntities)for(let C=0;C<this.options.entities.length;C++){const E=this.options.entities[C];y=y.replace(E.regex,E.val)}return y};function S(y){return this.options.indentBy.repeat(y)}function k(y){return y.startsWith(this.options.attributeNamePrefix)&&y!==this.options.textNodeName?y.substr(this.attrPrefixLen):!1}o.exports=a},{"./orderedJs2Xml":7}],7:[function(n,o,c){const d=`
`;function h(C,E){let T="";return E.format&&E.indentBy.length>0&&(T=d),a(C,E,"",T)}function a(C,E,T,L){let R="",N=!1;for(let z=0;z<C.length;z++){const V=C[z],Q=_(V);if(Q===void 0)continue;let oe="";if(T.length===0?oe=Q:oe=`${T}.${Q}`,Q===E.textNodeName){let X=V[Q];k(oe,E)||(X=E.tagValueProcessor(Q,X),X=y(X,E)),N&&(R+=L),R+=X,N=!1;continue}else if(Q===E.cdataPropName){N&&(R+=L),R+=`<![CDATA[${V[Q][0][E.textNodeName]}]]>`,N=!1;continue}else if(Q===E.commentPropName){R+=L+`<!--${V[Q][0][E.textNodeName]}-->`,N=!0;continue}else if(Q[0]==="?"){const X=S(V[":@"],E),B=Q==="?xml"?"":L;let W=V[Q][0][E.textNodeName];W=W.length!==0?" "+W:"",R+=B+`<${Q}${W}${X}?>`,N=!0;continue}let ee=L;ee!==""&&(ee+=E.indentBy);const ne=S(V[":@"],E),j=L+`<${Q}${ne}`,U=a(V[Q],E,oe,ee);E.unpairedTags.indexOf(Q)!==-1?E.suppressUnpairedNode?R+=j+">":R+=j+"/>":(!U||U.length===0)&&E.suppressEmptyNode?R+=j+"/>":U&&U.endsWith(">")?R+=j+`>${U}${L}</${Q}>`:(R+=j+">",U&&L!==""&&(U.includes("/>")||U.includes("</"))?R+=L+E.indentBy+U+L:R+=U,R+=`</${Q}>`),N=!0}return R}function _(C){const E=Object.keys(C);for(let T=0;T<E.length;T++){const L=E[T];if(C.hasOwnProperty(L)&&L!==":@")return L}}function S(C,E){let T="";if(C&&!E.ignoreAttributes)for(let L in C){if(!C.hasOwnProperty(L))continue;let R=E.attributeValueProcessor(L,C[L]);R=y(R,E),R===!0&&E.suppressBooleanAttributes?T+=` ${L.substr(E.attributeNamePrefix.length)}`:T+=` ${L.substr(E.attributeNamePrefix.length)}="${R}"`}return T}function k(C,E){C=C.substr(0,C.length-E.textNodeName.length-1);let T=C.substr(C.lastIndexOf(".")+1);for(let L in E.stopNodes)if(E.stopNodes[L]===C||E.stopNodes[L]==="*."+T)return!0;return!1}function y(C,E){if(C&&C.length>0&&E.processEntities)for(let T=0;T<E.entities.length;T++){const L=E.entities[T];C=C.replace(L.regex,L.val)}return C}o.exports=h},{}],8:[function(n,o,c){const d=n("../util");function h(T,L){const R={};if(T[L+3]==="O"&&T[L+4]==="C"&&T[L+5]==="T"&&T[L+6]==="Y"&&T[L+7]==="P"&&T[L+8]==="E"){L=L+9;let N=1,z=!1,V=!1,Q="";for(;L<T.length;L++)if(T[L]==="<"&&!V){if(z&&S(T,L))L+=7,[entityName,val,L]=a(T,L+1),val.indexOf("&")===-1&&(R[E(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(z&&k(T,L))L+=8;else if(z&&y(T,L))L+=8;else if(z&&C(T,L))L+=9;else if(_)V=!0;else throw new Error("Invalid DOCTYPE");N++,Q=""}else if(T[L]===">"){if(V?T[L-1]==="-"&&T[L-2]==="-"&&(V=!1,N--):N--,N===0)break}else T[L]==="["?z=!0:Q+=T[L];if(N!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:R,i:L}}function a(T,L){let R="";for(;L<T.length&&T[L]!=="'"&&T[L]!=='"';L++)R+=T[L];if(R=R.trim(),R.indexOf(" ")!==-1)throw new Error("External entites are not supported");const N=T[L++];let z="";for(;L<T.length&&T[L]!==N;L++)z+=T[L];return[R,z,L]}function _(T,L){return T[L+1]==="!"&&T[L+2]==="-"&&T[L+3]==="-"}function S(T,L){return T[L+1]==="!"&&T[L+2]==="E"&&T[L+3]==="N"&&T[L+4]==="T"&&T[L+5]==="I"&&T[L+6]==="T"&&T[L+7]==="Y"}function k(T,L){return T[L+1]==="!"&&T[L+2]==="E"&&T[L+3]==="L"&&T[L+4]==="E"&&T[L+5]==="M"&&T[L+6]==="E"&&T[L+7]==="N"&&T[L+8]==="T"}function y(T,L){return T[L+1]==="!"&&T[L+2]==="A"&&T[L+3]==="T"&&T[L+4]==="T"&&T[L+5]==="L"&&T[L+6]==="I"&&T[L+7]==="S"&&T[L+8]==="T"}function C(T,L){return T[L+1]==="!"&&T[L+2]==="N"&&T[L+3]==="O"&&T[L+4]==="T"&&T[L+5]==="A"&&T[L+6]==="T"&&T[L+7]==="I"&&T[L+8]==="O"&&T[L+9]==="N"}function E(T){if(d.isName(T))return T;throw new Error(`Invalid entity name ${T}`)}o.exports=h},{"../util":4}],9:[function(n,o,c){const d={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(a,_){return _},attributeValueProcessor:function(a,_){return _},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(a,_,S){return a}},h=function(a){return Object.assign({},d,a)};c.buildOptions=h,c.defaultOptions=d},{}],10:[function(n,o,c){const d=n("../util"),h=n("./xmlNode"),a=n("./DocTypeReader"),_=n("strnum");class S{constructor(X){this.options=X,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(B,W)=>String.fromCharCode(Number.parseInt(W,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(B,W)=>String.fromCharCode(Number.parseInt(W,16))}},this.addExternalEntities=k,this.parseXml=L,this.parseTextData=y,this.resolveNameSpace=C,this.buildAttributesMap=T,this.isItStopNode=V,this.replaceEntitiesValue=N,this.readStopNodeData=ne,this.saveTextToParentTag=z,this.addChild=R}}function k(U){const X=Object.keys(U);for(let B=0;B<X.length;B++){const W=X[B];this.lastEntities[W]={regex:new RegExp("&"+W+";","g"),val:U[W]}}}function y(U,X,B,W,ce,pe,be){if(U!==void 0&&(this.options.trimValues&&!W&&(U=U.trim()),U.length>0)){be||(U=this.replaceEntitiesValue(U));const de=this.options.tagValueProcessor(X,U,B,ce,pe);return de==null?U:typeof de!=typeof U||de!==U?de:this.options.trimValues?j(U,this.options.parseTagValue,this.options.numberParseOptions):U.trim()===U?j(U,this.options.parseTagValue,this.options.numberParseOptions):U}}function C(U){if(this.options.removeNSPrefix){const X=U.split(":"),B=U.charAt(0)==="/"?"/":"";if(X[0]==="xmlns")return"";X.length===2&&(U=B+X[1])}return U}const E=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function T(U,X,B){if(!this.options.ignoreAttributes&&typeof U=="string"){const W=d.getAllMatches(U,E),ce=W.length,pe={};for(let be=0;be<ce;be++){const de=this.resolveNameSpace(W[be][1]);let ye=W[be][4],Ie=this.options.attributeNamePrefix+de;if(de.length)if(this.options.transformAttributeName&&(Ie=this.options.transformAttributeName(Ie)),Ie==="__proto__"&&(Ie="#__proto__"),ye!==void 0){this.options.trimValues&&(ye=ye.trim()),ye=this.replaceEntitiesValue(ye);const Me=this.options.attributeValueProcessor(de,ye,X);Me==null?pe[Ie]=ye:typeof Me!=typeof ye||Me!==ye?pe[Ie]=Me:pe[Ie]=j(ye,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(pe[Ie]=!0)}if(!Object.keys(pe).length)return;if(this.options.attributesGroupName){const be={};return be[this.options.attributesGroupName]=pe,be}return pe}}const L=function(U){U=U.replace(/\r\n?/g,`
`);const X=new h("!xml");let B=X,W="",ce="";for(let pe=0;pe<U.length;pe++)if(U[pe]==="<")if(U[pe+1]==="/"){const de=oe(U,">",pe,"Closing Tag is not closed.");let ye=U.substring(pe+2,de).trim();if(this.options.removeNSPrefix){const ot=ye.indexOf(":");ot!==-1&&(ye=ye.substr(ot+1))}this.options.transformTagName&&(ye=this.options.transformTagName(ye)),B&&(W=this.saveTextToParentTag(W,B,ce));const Ie=ce.substring(ce.lastIndexOf(".")+1);if(ye&&this.options.unpairedTags.indexOf(ye)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${ye}>`);let Me=0;Ie&&this.options.unpairedTags.indexOf(Ie)!==-1?(Me=ce.lastIndexOf(".",ce.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Me=ce.lastIndexOf("."),ce=ce.substring(0,Me),B=this.tagsNodeStack.pop(),W="",pe=de}else if(U[pe+1]==="?"){let de=ee(U,pe,!1,"?>");if(!de)throw new Error("Pi Tag is not closed.");if(W=this.saveTextToParentTag(W,B,ce),!(this.options.ignoreDeclaration&&de.tagName==="?xml"||this.options.ignorePiTags)){const ye=new h(de.tagName);ye.add(this.options.textNodeName,""),de.tagName!==de.tagExp&&de.attrExpPresent&&(ye[":@"]=this.buildAttributesMap(de.tagExp,ce,de.tagName)),this.addChild(B,ye,ce)}pe=de.closeIndex+1}else if(U.substr(pe+1,3)==="!--"){const de=oe(U,"-->",pe+4,"Comment is not closed.");if(this.options.commentPropName){const ye=U.substring(pe+4,de-2);W=this.saveTextToParentTag(W,B,ce),B.add(this.options.commentPropName,[{[this.options.textNodeName]:ye}])}pe=de}else if(U.substr(pe+1,2)==="!D"){const de=a(U,pe);this.docTypeEntities=de.entities,pe=de.i}else if(U.substr(pe+1,2)==="!["){const de=oe(U,"]]>",pe,"CDATA is not closed.")-2,ye=U.substring(pe+9,de);W=this.saveTextToParentTag(W,B,ce);let Ie=this.parseTextData(ye,B.tagname,ce,!0,!1,!0,!0);Ie==null&&(Ie=""),this.options.cdataPropName?B.add(this.options.cdataPropName,[{[this.options.textNodeName]:ye}]):B.add(this.options.textNodeName,Ie),pe=de+2}else{let de=ee(U,pe,this.options.removeNSPrefix),ye=de.tagName;const Ie=de.rawTagName;let Me=de.tagExp,ot=de.attrExpPresent,We=de.closeIndex;this.options.transformTagName&&(ye=this.options.transformTagName(ye)),B&&W&&B.tagname!=="!xml"&&(W=this.saveTextToParentTag(W,B,ce,!1));const pt=B;if(pt&&this.options.unpairedTags.indexOf(pt.tagname)!==-1&&(B=this.tagsNodeStack.pop(),ce=ce.substring(0,ce.lastIndexOf("."))),ye!==X.tagname&&(ce+=ce?"."+ye:ye),this.isItStopNode(this.options.stopNodes,ce,ye)){let Tt="";if(Me.length>0&&Me.lastIndexOf("/")===Me.length-1)ye[ye.length-1]==="/"?(ye=ye.substr(0,ye.length-1),ce=ce.substr(0,ce.length-1),Me=ye):Me=Me.substr(0,Me.length-1),pe=de.closeIndex;else if(this.options.unpairedTags.indexOf(ye)!==-1)pe=de.closeIndex;else{const wt=this.readStopNodeData(U,Ie,We+1);if(!wt)throw new Error(`Unexpected end of ${Ie}`);pe=wt.i,Tt=wt.tagContent}const $e=new h(ye);ye!==Me&&ot&&($e[":@"]=this.buildAttributesMap(Me,ce,ye)),Tt&&(Tt=this.parseTextData(Tt,ye,ce,!0,ot,!0,!0)),ce=ce.substr(0,ce.lastIndexOf(".")),$e.add(this.options.textNodeName,Tt),this.addChild(B,$e,ce)}else{if(Me.length>0&&Me.lastIndexOf("/")===Me.length-1){ye[ye.length-1]==="/"?(ye=ye.substr(0,ye.length-1),ce=ce.substr(0,ce.length-1),Me=ye):Me=Me.substr(0,Me.length-1),this.options.transformTagName&&(ye=this.options.transformTagName(ye));const Tt=new h(ye);ye!==Me&&ot&&(Tt[":@"]=this.buildAttributesMap(Me,ce,ye)),this.addChild(B,Tt,ce),ce=ce.substr(0,ce.lastIndexOf("."))}else{const Tt=new h(ye);this.tagsNodeStack.push(B),ye!==Me&&ot&&(Tt[":@"]=this.buildAttributesMap(Me,ce,ye)),this.addChild(B,Tt,ce),B=Tt}W="",pe=We}}else W+=U[pe];return X.child};function R(U,X,B){const W=this.options.updateTag(X.tagname,B,X[":@"]);W===!1||(typeof W=="string"&&(X.tagname=W),U.addChild(X))}const N=function(U){if(this.options.processEntities){for(let X in this.docTypeEntities){const B=this.docTypeEntities[X];U=U.replace(B.regx,B.val)}for(let X in this.lastEntities){const B=this.lastEntities[X];U=U.replace(B.regex,B.val)}if(this.options.htmlEntities)for(let X in this.htmlEntities){const B=this.htmlEntities[X];U=U.replace(B.regex,B.val)}U=U.replace(this.ampEntity.regex,this.ampEntity.val)}return U};function z(U,X,B,W){return U&&(W===void 0&&(W=Object.keys(X.child).length===0),U=this.parseTextData(U,X.tagname,B,!1,X[":@"]?Object.keys(X[":@"]).length!==0:!1,W),U!==void 0&&U!==""&&X.add(this.options.textNodeName,U),U=""),U}function V(U,X,B){const W="*."+B;for(const ce in U){const pe=U[ce];if(W===pe||X===pe)return!0}return!1}function Q(U,X,B=">"){let W,ce="";for(let pe=X;pe<U.length;pe++){let be=U[pe];if(W)be===W&&(W="");else if(be==='"'||be==="'")W=be;else if(be===B[0])if(B[1]){if(U[pe+1]===B[1])return{data:ce,index:pe}}else return{data:ce,index:pe};else be==="	"&&(be=" ");ce+=be}}function oe(U,X,B,W){const ce=U.indexOf(X,B);if(ce===-1)throw new Error(W);return ce+X.length-1}function ee(U,X,B,W=">"){const ce=Q(U,X+1,W);if(!ce)return;let pe=ce.data;const be=ce.index,de=pe.search(/\s/);let ye=pe,Ie=!0;de!==-1&&(ye=pe.substring(0,de),pe=pe.substring(de+1).trimStart());const Me=ye;if(B){const ot=ye.indexOf(":");ot!==-1&&(ye=ye.substr(ot+1),Ie=ye!==ce.data.substr(ot+1))}return{tagName:ye,tagExp:pe,closeIndex:be,attrExpPresent:Ie,rawTagName:Me}}function ne(U,X,B){const W=B;let ce=1;for(;B<U.length;B++)if(U[B]==="<")if(U[B+1]==="/"){const pe=oe(U,">",B,`${X} is not closed`);if(U.substring(B+2,pe).trim()===X&&(ce--,ce===0))return{tagContent:U.substring(W,B),i:pe};B=pe}else if(U[B+1]==="?")B=oe(U,"?>",B+1,"StopNode is not closed.");else if(U.substr(B+1,3)==="!--")B=oe(U,"-->",B+3,"StopNode is not closed.");else if(U.substr(B+1,2)==="![")B=oe(U,"]]>",B,"StopNode is not closed.")-2;else{const pe=ee(U,B,">");pe&&((pe&&pe.tagName)===X&&pe.tagExp[pe.tagExp.length-1]!=="/"&&ce++,B=pe.closeIndex)}}function j(U,X,B){if(X&&typeof U=="string"){const W=U.trim();return W==="true"?!0:W==="false"?!1:_(U,B)}else return d.isExist(U)?U:""}o.exports=S},{"../util":4,"./DocTypeReader":8,"./xmlNode":13,strnum:15}],11:[function(n,o,c){const{buildOptions:d}=n("./OptionsBuilder"),h=n("./OrderedObjParser"),{prettify:a}=n("./node2json"),_=n("../validator");class S{constructor(y){this.externalEntities={},this.options=d(y)}parse(y,C){if(typeof y!="string")if(y.toString)y=y.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(C){C===!0&&(C={});const L=_.validate(y,C);if(L!==!0)throw Error(`${L.err.msg}:${L.err.line}:${L.err.col}`)}const E=new h(this.options);E.addExternalEntities(this.externalEntities);const T=E.parseXml(y);return this.options.preserveOrder||T===void 0?T:a(T,this.options)}addEntity(y,C){if(C.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(y.indexOf("&")!==-1||y.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(C==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[y]=C}}o.exports=S},{"../validator":5,"./OptionsBuilder":9,"./OrderedObjParser":10,"./node2json":12}],12:[function(n,o,c){function d(k,y){return h(k,y)}function h(k,y,C){let E;const T={};for(let L=0;L<k.length;L++){const R=k[L],N=a(R);let z="";if(C===void 0?z=N:z=C+"."+N,N===y.textNodeName)E===void 0?E=R[N]:E+=""+R[N];else{if(N===void 0)continue;if(R[N]){let V=h(R[N],y,z);const Q=S(V,y);R[":@"]?_(V,R[":@"],z,y):Object.keys(V).length===1&&V[y.textNodeName]!==void 0&&!y.alwaysCreateTextNode?V=V[y.textNodeName]:Object.keys(V).length===0&&(y.alwaysCreateTextNode?V[y.textNodeName]="":V=""),T[N]!==void 0&&T.hasOwnProperty(N)?(Array.isArray(T[N])||(T[N]=[T[N]]),T[N].push(V)):y.isArray(N,z,Q)?T[N]=[V]:T[N]=V}}}return typeof E=="string"?E.length>0&&(T[y.textNodeName]=E):E!==void 0&&(T[y.textNodeName]=E),T}function a(k){const y=Object.keys(k);for(let C=0;C<y.length;C++){const E=y[C];if(E!==":@")return E}}function _(k,y,C,E){if(y){const T=Object.keys(y),L=T.length;for(let R=0;R<L;R++){const N=T[R];E.isArray(N,C+"."+N,!0,!0)?k[N]=[y[N]]:k[N]=y[N]}}}function S(k,y){const{textNodeName:C}=y,E=Object.keys(k).length;return!!(E===0||E===1&&(k[C]||typeof k[C]=="boolean"||k[C]===0))}c.prettify=d},{}],13:[function(n,o,c){class d{constructor(a){this.tagname=a,this.child=[],this[":@"]={}}add(a,_){a==="__proto__"&&(a="#__proto__"),this.child.push({[a]:_})}addChild(a){a.tagname==="__proto__"&&(a.tagname="#__proto__"),a[":@"]&&Object.keys(a[":@"]).length>0?this.child.push({[a.tagname]:a.child,":@":a[":@"]}):this.child.push({[a.tagname]:a.child})}}o.exports=d},{}],14:[function(n,o,c){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */c.read=function(d,h,a,_,S){var k,y,C=S*8-_-1,E=(1<<C)-1,T=E>>1,L=-7,R=a?S-1:0,N=a?-1:1,z=d[h+R];for(R+=N,k=z&(1<<-L)-1,z>>=-L,L+=C;L>0;k=k*256+d[h+R],R+=N,L-=8);for(y=k&(1<<-L)-1,k>>=-L,L+=_;L>0;y=y*256+d[h+R],R+=N,L-=8);if(k===0)k=1-T;else{if(k===E)return y?NaN:(z?-1:1)*(1/0);y=y+Math.pow(2,_),k=k-T}return(z?-1:1)*y*Math.pow(2,k-_)},c.write=function(d,h,a,_,S,k){var y,C,E,T=k*8-S-1,L=(1<<T)-1,R=L>>1,N=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=_?0:k-1,V=_?1:-1,Q=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(C=isNaN(h)?1:0,y=L):(y=Math.floor(Math.log(h)/Math.LN2),h*(E=Math.pow(2,-y))<1&&(y--,E*=2),y+R>=1?h+=N/E:h+=N*Math.pow(2,1-R),h*E>=2&&(y++,E/=2),y+R>=L?(C=0,y=L):y+R>=1?(C=(h*E-1)*Math.pow(2,S),y=y+R):(C=h*Math.pow(2,R-1)*Math.pow(2,S),y=0));S>=8;d[a+z]=C&255,z+=V,C/=256,S-=8);for(y=y<<S|C,T+=S;T>0;d[a+z]=y&255,z+=V,y/=256,T-=8);d[a+z-V]|=Q*128}},{}],15:[function(n,o,c){const d=/^[-+]?0x[a-fA-F0-9]+$/,h=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const a={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function _(k,y={}){if(y=Object.assign({},a,y),!k||typeof k!="string")return k;let C=k.trim();if(y.skipLike!==void 0&&y.skipLike.test(C))return k;if(y.hex&&d.test(C))return Number.parseInt(C,16);{const E=h.exec(C);if(E){const T=E[1],L=E[2];let R=S(E[3]);const N=E[4]||E[6];if(!y.leadingZeros&&L.length>0&&T&&C[2]!==".")return k;if(!y.leadingZeros&&L.length>0&&!T&&C[1]!==".")return k;{const z=Number(C),V=""+z;return V.search(/[eE]/)!==-1||N?y.eNotation?z:k:C.indexOf(".")!==-1?V==="0"&&R===""||V===R||T&&V==="-"+R?z:k:L?R===V||T+R===V?z:k:C===V||C===T+V?z:k}}else return k}}function S(k){return k&&k.indexOf(".")!==-1&&(k=k.replace(/0+$/,""),k==="."?k="0":k[0]==="."?k="0"+k:k[k.length-1]==="."&&(k=k.substr(0,k.length-1))),k}o.exports=_},{}],16:[function(n,o,c){o.exports={name:"osm-api",version:"3.3.0",contributors:["Kyle Hensel (https://github.com/k-yle)"],description:" Javascript/Typescript wrapper around the OpenStreetMap API",main:"dist",unpkg:"dist/index.min.js",types:"dist/src/index.d.ts",license:"MIT",files:["dist"],keywords:["osm","openstreetmap","openstreetmap api"],repository:"https://github.com/osmlab/osm-api-js",scripts:{build:"rm -rf dist && tsc --emitDeclarationOnly && rm -rf dist/__tests__ && browserify -s OSM src/index.ts -p tsify > dist/index.js && uglifyjs dist/index.js > dist/index.min.js",lint:"eslint .",test:"vitest",trypublish:"npm publish --provenance || true"},engines:{node:">=18"},dependencies:{"@types/geojson":"^7946.0.13","fast-xml-parser":"^4.4.1"},devDependencies:{"@types/node":"^22.5.5",browserify:"^17.0.0",eslint:"^9.10.0","eslint-config-kyle":"^25.0.0-beta3",tsify:"^5.0.4",typescript:"^5.6.2","uglify-js":"^3.19.3",vitest:"^2.1.1"},prettier:{trailingComma:"es5"}}},{}],17:[function(n,o,c){(function(d){(function(){var h=this&&this.__awaiter||function(C,E,T,L){function R(N){return N instanceof T?N:new T(function(z){z(N)})}return new(T||(T=Promise))(function(N,z){function V(ee){try{oe(L.next(ee))}catch(ne){z(ne)}}function Q(ee){try{oe(L.throw(ee))}catch(ne){z(ne)}}function oe(ee){ee.done?N(ee.value):R(ee.value).then(V,Q)}oe((L=L.apply(C,E||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.osmFetch=y;const a=n("../auth"),_=n("../config"),S=n("./_xml"),k=C=>typeof btoa>"u"?d.from(C,"binary").toString("base64"):btoa(C);function y(C,E,T){return h(this,void 0,void 0,function*(){const{apiUrl:L,authHeader:R,basicAuth:N,userAgent:z}=(0,_.getConfig)(),V=N&&`Basic ${k(`${N.username}:${N.password}`)}`,Q=(0,a.getAuthToken)()&&`Bearer ${(0,a.getAuthToken)()}`;let oe=new URLSearchParams(E).toString();oe&&(oe=`?${oe}`);const ee=yield fetch(`${L}/api${C}${oe}`,Object.assign(Object.assign({},T),{headers:Object.assign({Authorization:R||V||Q||"","User-Agent":z},T==null?void 0:T.headers)})),ne=ee.headers.get("Content-Type");if(ne!=null&&ne.startsWith("application/xml")){const U=yield ee.text();return yield S.xmlParser.parse(U)}if(ne!=null&&ne.startsWith("application/json"))return ee.json();if(ee.ok)return yield ee.text();const j=new Error(`OSM API: ${yield ee.text()}`);throw j.cause=ee.status,j})}}).call(this)}).call(this,n("buffer").Buffer)},{"../auth":58,"../config":60,"./_xml":18,buffer:2}],18:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.xmlParser=void 0;const d=n("fast-xml-parser");c.xmlParser=new d.XMLParser({ignoreAttributes:!1,attributesGroupName:"$",attributeNamePrefix:"",isArray:h=>h!=="$"})},{"fast-xml-parser":3}],19:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.createChangesetMetaXml=a,c.createOsmChangeXml=S;const d=n("fast-xml-parser"),h=new d.XMLBuilder({ignoreAttributes:!1,attributeNamePrefix:"$",format:!0,suppressEmptyNode:!0,suppressBooleanAttributes:!1});function a(k){return h.build({osm:{changeset:{tag:Object.entries(k).map(([y,C])=>({$k:y,$v:C}))}}})}const _=(k,y,C)=>{const E=["node","way","relation"];return C==="delete"&&E.reverse(),y.reduce((T,L)=>{const R={$id:L.id,$version:C==="create"?0:L.version,$changeset:k,tag:Object.entries(L.tags||{}).map(([N,z])=>({$k:N,$v:z}))};switch(L.type){case"node":{const N=Object.assign(Object.assign({},R),{$lat:L.lat,$lon:L.lon});return Object.assign(Object.assign({},T),{node:[...T.node,N]})}case"way":{if(!L.nodes)throw new Error("Way has no nodes");const N=Object.assign(Object.assign({},R),{nd:L.nodes.map(z=>({$ref:z}))});return Object.assign(Object.assign({},T),{way:[...T.way,N]})}case"relation":{if(!L.members)throw new Error("Relation has no members");const N=Object.assign(Object.assign({},R),{member:L.members.map(z=>({$type:z.type,$ref:z.ref,$role:z.role}))});return Object.assign(Object.assign({},T),{relation:[...T.relation,N]})}default:return T}},Object.fromEntries(E.map(T=>[T,[]])))};function S(k,y,C){return h.build({osmChange:{$version:"0.6",$generator:"osm-api-js",changeset:C?{tag:Object.entries(C).map(([E,T])=>({$k:E,$v:T}))}:void 0,create:[_(k,y.create,"create")],modify:[_(k,y.modify,"modify")],delete:[Object.assign({"$if-unused":!0},_(k,y.delete,"delete"))]}})}},{"fast-xml-parser":3}],20:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.parseOsmChangeJson=S,c.parseOsmChangeXml=k;const d=n("../_xml");function h(y){if(y!=null&&y.tag)return Object.fromEntries(y.tag.map(C=>[C.$.k,C.$.v]))}function a(y){return{changeset:+y.$.changeset,id:+y.$.id,timestamp:y.$.timestamp,uid:+y.$.uid,user:y.$.user,version:+y.$.version,tags:h(y)}}const _=y=>{const C=[];if(y.node){const E=y.node.map(T=>Object.assign(Object.assign({type:"node"},a(T)),{lat:+T.$.lat,lon:+T.$.lon}));C.push(...E)}if(y.way){const E=y.way.map(T=>{var L;return Object.assign(Object.assign({type:"way"},a(T)),{nodes:((L=T.nd)===null||L===void 0?void 0:L.map(R=>+R.$.ref))||[]})});C.push(...E)}if(y.relation){const E=y.relation.map(T=>{var L;return Object.assign(Object.assign({type:"relation"},a(T)),{members:((L=T.member)===null||L===void 0?void 0:L.map(R=>({ref:+R.$.ref,role:R.$.role,type:R.$.type})))||[]})});C.push(...E)}return C};function S(y){var C,E,T,L;const R=h((C=y.osmChange[0].changeset)===null||C===void 0?void 0:C[0]),N={create:((E=y.osmChange[0].create)===null||E===void 0?void 0:E.flatMap(_))||[],modify:((T=y.osmChange[0].modify)===null||T===void 0?void 0:T.flatMap(_))||[],delete:((L=y.osmChange[0].delete)===null||L===void 0?void 0:L.flatMap(_))||[]};return R&&(N.changeset=R),N}function k(y){const C=d.xmlParser.parse(y);return S(C)}},{"../_xml":18}],21:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.getOsmChangeSize=_,c.chunkOsmChange=S;const d=["create","modify","delete"],h=["create-node","create-way","create-relation","delete-relation","delete-way","delete-node","modify-node","modify-way","modify-relation"],a=()=>({create:[],modify:[],delete:[]});function _(k){return k.create.length+k.modify.length+k.delete.length}function S(k,y){var C;const E=(C=y==null?void 0:y.api.changesets.maximum_elements)!==null&&C!==void 0?C:S.DEFAULT_LIMIT;if(_(k)<=E)return[k];const T={};for(const z of d)for(const V of k[z]){const Q=`${z}-${V.type}`;T[Q]||(T[Q]=[]),T[Q].push(V)}const L=[a()];function R(){var z;for(const V of h){const Q=V.split("-")[0],oe=(z=T[V])===null||z===void 0?void 0:z.pop();if(oe)return{action:Q,feature:oe}}}let N;for(;N=R();){const z=L[0];z[N.action].push(N.feature),_(z)>=E&&L.unshift(a())}return L.reverse()}S.DEFAULT_LIMIT=1e4},{}],22:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(L){L(T)})}return new(y||(y=Promise))(function(T,L){function R(V){try{z(C.next(V))}catch(Q){L(Q)}}function N(V){try{z(C.throw(V))}catch(Q){L(Q)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.createChangesetComment=_;const h=n("../_osmFetch"),a=n("./getChangesets");function _(S,k,y){return d(this,void 0,void 0,function*(){const C=yield(0,h.osmFetch)(`/0.6/changeset/${S}/comment.json`,void 0,Object.assign(Object.assign({},y),{method:"POST",body:`text=${encodeURIComponent(k)}`,headers:Object.assign(Object.assign({},y==null?void 0:y.headers),{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"})}));return(0,a.mapRawChangeset)(C.changeset)})}},{"../_osmFetch":17,"./getChangesets":24}],23:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(L){L(T)})}return new(y||(y=Promise))(function(T,L){function R(V){try{z(C.next(V))}catch(Q){L(Q)}}function N(V){try{z(C.throw(V))}catch(Q){L(Q)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getChangesetDiff=_;const h=n("../_osmFetch"),a=n("./_parseOsmChangeXml");function _(S,k){return d(this,void 0,void 0,function*(){const y=yield(0,h.osmFetch)(`/0.6/changeset/${S}/download`,void 0,k);return(0,a.parseOsmChangeJson)(y)})}},{"../_osmFetch":17,"./_parseOsmChangeXml":20}],24:[function(n,o,c){var d=this&&this.__awaiter||function(y,C,E,T){function L(R){return R instanceof E?R:new E(function(N){N(R)})}return new(E||(E=Promise))(function(R,N){function z(oe){try{Q(T.next(oe))}catch(ee){N(ee)}}function V(oe){try{Q(T.throw(oe))}catch(ee){N(ee)}}function Q(oe){oe.done?R(oe.value):L(oe.value).then(z,V)}Q((T=T.apply(y,C||[])).next())})},h=this&&this.__rest||function(y,C){var E={};for(var T in y)Object.prototype.hasOwnProperty.call(y,T)&&C.indexOf(T)<0&&(E[T]=y[T]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,T=Object.getOwnPropertySymbols(y);L<T.length;L++)C.indexOf(T[L])<0&&Object.prototype.propertyIsEnumerable.call(y,T[L])&&(E[T[L]]=y[T[L]]);return E};Object.defineProperty(c,"__esModule",{value:!0}),c.mapRawChangeset=void 0,c.listChangesets=S,c.getChangeset=k;const a=n("../_osmFetch"),_=y=>{var{comments:C}=y,E=h(y,["comments"]);return Object.assign(Object.assign({},E),{created_at:new Date(E.created_at),closed_at:E.closed_at?new Date(E.closed_at):void 0,discussion:C==null?void 0:C.map(T=>Object.assign(Object.assign({},T),{date:new Date(T.date),uid:`${T.uid}`}))})};c.mapRawChangeset=_;function S(y,C){return d(this,void 0,void 0,function*(){const{only:E}=y,T=h(y,["only"]);return(yield(0,a.osmFetch)("/0.6/changesets.json",Object.assign(Object.assign({},E&&{[E]:!0}),T),C)).changesets.map(c.mapRawChangeset)})}function k(y){return d(this,arguments,void 0,function*(C,E=!0,T){const L=yield(0,a.osmFetch)(`/0.6/changeset/${C}.json`,E?{include_discussion:1}:{},T);return(0,c.mapRawChangeset)(L.changeset)})}},{"../_osmFetch":17}],25:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(S,k,y,C){C===void 0&&(C=y);var E=Object.getOwnPropertyDescriptor(k,y);(!E||("get"in E?!k.__esModule:E.writable||E.configurable))&&(E={enumerable:!0,get:function(){return k[y]}}),Object.defineProperty(S,C,E)}:function(S,k,y,C){C===void 0&&(C=y),S[C]=k[y]}),h=this&&this.__exportStar||function(S,k){for(var y in S)y!=="default"&&!Object.prototype.hasOwnProperty.call(k,y)&&d(k,S,y)};Object.defineProperty(c,"__esModule",{value:!0}),c.createOsmChangeXml=c.parseOsmChangeXml=void 0,h(n("./chunkOsmChange"),c),h(n("./createChangesetComment"),c),h(n("./getChangesetDiff"),c),h(n("./getChangesets"),c),h(n("./subscription"),c),h(n("./uploadChangeset"),c);var a=n("./_parseOsmChangeXml");Object.defineProperty(c,"parseOsmChangeXml",{enumerable:!0,get:function(){return a.parseOsmChangeXml}});var _=n("./_createOsmChangeXml");Object.defineProperty(c,"createOsmChangeXml",{enumerable:!0,get:function(){return _.createOsmChangeXml}})},{"./_createOsmChangeXml":19,"./_parseOsmChangeXml":20,"./chunkOsmChange":21,"./createChangesetComment":22,"./getChangesetDiff":23,"./getChangesets":24,"./subscription":26,"./uploadChangeset":27}],26:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(L){L(T)})}return new(y||(y=Promise))(function(T,L){function R(V){try{z(C.next(V))}catch(Q){L(Q)}}function N(V){try{z(C.throw(V))}catch(Q){L(Q)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.subscribeToChangeset=a,c.unsubscribeFromChangeset=_;const h=n("../_osmFetch");function a(S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/changeset/${S}/subscribe`,{},Object.assign(Object.assign({},k),{method:"POST"}))})}function _(S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/changeset/${S}/unsubscribe`,{},Object.assign(Object.assign({},k),{method:"POST"}))})}},{"../_osmFetch":17}],27:[function(n,o,c){var d=this&&this.__awaiter||function(E,T,L,R){function N(z){return z instanceof L?z:new L(function(V){V(z)})}return new(L||(L=Promise))(function(z,V){function Q(ne){try{ee(R.next(ne))}catch(j){V(j)}}function oe(ne){try{ee(R.throw(ne))}catch(j){V(j)}}function ee(ne){ne.done?z(ne.value):N(ne.value).then(Q,oe)}ee((R=R.apply(E,T||[])).next())})},h=this&&this.__rest||function(E,T){var L={};for(var R in E)Object.prototype.hasOwnProperty.call(E,R)&&T.indexOf(R)<0&&(L[R]=E[R]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,R=Object.getOwnPropertySymbols(E);N<R.length;N++)T.indexOf(R[N])<0&&Object.prototype.propertyIsEnumerable.call(E,R[N])&&(L[R[N]]=E[R[N]]);return L};Object.defineProperty(c,"__esModule",{value:!0}),c.compress=y,c.uploadChangeset=C;const a=n("../_osmFetch"),_=n("../../../package.json"),S=n("./_createOsmChangeXml"),k=n("./chunkOsmChange");function y(E){if(!globalThis.CompressionStream)return;const T=new Response(E).body.pipeThrough(new CompressionStream("gzip"));return new Response(T).blob()}function C(E,T,L){return d(this,void 0,void 0,function*(){const R=L||{},{onChunk:N,onProgress:z,disableCompression:V}=R,Q=h(R,["onChunk","onProgress","disableCompression"]),oe=(0,k.chunkOsmChange)(T),ee=[],ne=(0,k.getOsmChangeSize)(T);for(const[j,U]of oe.entries()){let X=E;oe.length>1&&(N?X=N({featureCount:ne,changesetIndex:j,changesetTotal:oe.length}):X.chunk=`${j+1}/${oe.length}`),X.created_by||(X.created_by=`osm-api-js ${_.version}`),z==null||z({phase:"upload",step:j+1,total:oe.length});const B=+(yield(0,a.osmFetch)("/0.6/changeset/create",void 0,Object.assign(Object.assign({},Q),{method:"PUT",body:(0,S.createChangesetMetaXml)(X),headers:Object.assign(Object.assign({},Q.headers),{"content-type":"application/xml; charset=utf-8"})}))),W=(0,S.createOsmChangeXml)(B,U),ce=!V&&(yield y(W));yield(0,a.osmFetch)(`/0.6/changeset/${B}/upload`,void 0,Object.assign(Object.assign({},Q),{method:"POST",body:ce||W,headers:Object.assign(Object.assign(Object.assign({},Q.headers),ce&&{"Content-Encoding":"gzip"}),{"content-type":"application/xml; charset=utf-8"})})),yield(0,a.osmFetch)(`/0.6/changeset/${B}/close`,void 0,Object.assign(Object.assign({},Q),{method:"PUT"})),ee.push(B)}return ee[0]})}},{"../../../package.json":16,"../_osmFetch":17,"./_createOsmChangeXml":19,"./chunkOsmChange":21}],28:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.createUserBlock=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/user_blocks.json",_,Object.assign(Object.assign({},S),{method:"POST"}))).user_block})}},{"../_osmFetch":17}],29:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getUserBlock=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user_blocks/${_}.json`,{},S)).user_block})}},{"../_osmFetch":17}],30:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(L){L(T)})}return new(y||(y=Promise))(function(T,L){function R(V){try{z(C.next(V))}catch(Q){L(Q)}}function N(V){try{z(C.throw(V))}catch(Q){L(Q)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.hideChangesetComment=_;const h=n("../_osmFetch"),a=n("../changesets");function _(S,k,y){return d(this,void 0,void 0,function*(){const C=yield(0,h.osmFetch)(`/0.6/changeset_comments/${S}/visibility.json`,{},Object.assign(Object.assign({},y),{method:k==="unhide"?"POST":"DELETE"}));return(0,a.mapRawChangeset)(C.changeset)})}},{"../_osmFetch":17,"../changesets":25}],31:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(L){L(T)})}return new(y||(y=Promise))(function(T,L){function R(V){try{z(C.next(V))}catch(Q){L(Q)}}function N(V){try{z(C.throw(V))}catch(Q){L(Q)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.hideNote=_;const h=n("../_osmFetch"),a=n("../notes");function _(S,k,y){return d(this,void 0,void 0,function*(){const C=yield(0,h.osmFetch)(`/0.6/notes/${S}.json`,k?{text:k}:{},Object.assign(Object.assign({},y),{method:"DELETE"}));return(0,a.featureToNote)(C)})}},{"../_osmFetch":17,"../notes":48}],32:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./createUserBlock"),c),h(n("./getUserBlock"),c),h(n("./hideChangesetComment"),c),h(n("./hideNote"),c),h(n("./redactFeature"),c)},{"./createUserBlock":28,"./getUserBlock":29,"./hideChangesetComment":30,"./hideNote":31,"./redactFeature":33}],33:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.redactFeature=a;const h=n("../_osmFetch");function a(_,S){return d(this,arguments,void 0,function*({featureType:k,featureId:y,featureVersion:C,redactionId:E},T){yield(0,h.osmFetch)(`/0.6/${k}/${y}/${C}/redact`,E?{redaction:E}:{},Object.assign(Object.assign({},T),{method:"POST"}))})}},{"../_osmFetch":17}],34:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(L){L(T)})}return new(y||(y=Promise))(function(T,L){function R(V){try{z(C.next(V))}catch(Q){L(Q)}}function N(V){try{z(C.throw(V))}catch(Q){L(Q)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getApiCapabilities=a,c.getCapabilities=_;const h=n("./_osmFetch");function a(S){return d(this,void 0,void 0,function*(){return(0,h.osmFetch)("/capabilities.json",void 0,S)})}function _(){return d(this,void 0,void 0,function*(){const S=yield a();return{limits:{maxArea:S.api.area.maximum,maxNoteArea:S.api.note_area.maximum,maxTracepointPerPage:S.api.tracepoints.per_page,maxWayNodes:S.api.waynodes.maximum,maxChangesetElements:S.api.changesets.maximum_elements,maxTimeout:S.api.timeout.seconds},policy:{imageryBlacklist:S.policy.imagery.blacklist.map(y=>y.regex)}}})}},{"./_osmFetch":17}],35:[function(n,o,c){var d=this&&this.__awaiter||function(E,T,L,R){function N(z){return z instanceof L?z:new L(function(V){V(z)})}return new(L||(L=Promise))(function(z,V){function Q(ne){try{ee(R.next(ne))}catch(j){V(j)}}function oe(ne){try{ee(R.throw(ne))}catch(j){V(j)}}function ee(ne){ne.done?z(ne.value):N(ne.value).then(Q,oe)}ee((R=R.apply(E,T||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getFeature=a,c.getFeatures=_,c.getFeatureAtVersion=S,c.getFeatureHistory=k,c.getWaysForNode=y,c.getRelationsForElement=C;const h=n("./_osmFetch");function a(E,T,L,R){return d(this,void 0,void 0,function*(){const N=L&&E!=="node"?"/full":"";return(yield(0,h.osmFetch)(`/0.6/${E}/${T}${N}.json`,void 0,R)).elements})}function _(E,T,L){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/${E}s.json?${E}s=${T.join(",")}`,void 0,L)).elements})}function S(E,T,L,R){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/${E}/${T}/${L}.json`,void 0,R)).elements[0]})}function k(E,T,L){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/${E}/${T}/history.json`,void 0,L)).elements})}function y(E,T){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/node/${E}/ways.json`,void 0,T)).elements})}function C(E,T,L){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/${E}/${T}/relations.json`,void 0,L)).elements})}},{"./_osmFetch":17}],36:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getMapData=a;const h=n("./_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/map.json",{bbox:_},S)).elements})}},{"./_osmFetch":17}],37:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getPermissions=a;const h=n("./_osmFetch");function a(_){return d(this,void 0,void 0,function*(){return(0,h.osmFetch)("/0.6/permissions.json",void 0,_)})}},{"./_osmFetch":17}],38:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getUIdFromDisplayName=a;const h=n("./changesets");function a(_){return d(this,void 0,void 0,function*(){const S=yield(0,h.listChangesets)({display_name:_});if(!S.length)throw new Error("Could not get uid because the user has never edited the map");return S[0].uid})}},{"./changesets":25}],39:[function(n,o,c){var d=this&&this.__awaiter||function(y,C,E,T){function L(R){return R instanceof E?R:new E(function(N){N(R)})}return new(E||(E=Promise))(function(R,N){function z(oe){try{Q(T.next(oe))}catch(ee){N(ee)}}function V(oe){try{Q(T.throw(oe))}catch(ee){N(ee)}}function Q(oe){oe.done?R(oe.value):L(oe.value).then(z,V)}Q((T=T.apply(y,C||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getUser=a,c.getUsers=_,c.getUserBlockById=S,c.getOwnUserBlocks=k;const h=n("./_osmFetch");function a(y,C){return d(this,void 0,void 0,function*(){const E=yield(0,h.osmFetch)(`/0.6/user/${y==="me"?"details":y}.json`,void 0,C);return Object.assign(Object.assign({},E.user),{account_created:new Date(E.user.account_created)})})}function _(y,C){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/users",{users:y},C)).users.map(T=>Object.assign(Object.assign({},T),{account_created:new Date(T.account_created)}))})}function S(y,C){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user_blocks/${y}.json`,void 0,C)).user_block})}function k(y){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/user/blocks/active",void 0,y)).user_blocks})}},{"./_osmFetch":17}],40:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./changesets"),c),h(n("./dwg"),c),h(n("./messages"),c),h(n("./notes"),c),h(n("./preferences"),c),h(n("./getCapabilities"),c),h(n("./getFeature"),c),h(n("./getMapData"),c),h(n("./getPermissions"),c),h(n("./getUIdFromDisplayName"),c),h(n("./getUser"),c)},{"./changesets":25,"./dwg":32,"./getCapabilities":34,"./getFeature":35,"./getMapData":36,"./getPermissions":37,"./getUIdFromDisplayName":38,"./getUser":39,"./messages":43,"./notes":48,"./preferences":53}],41:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.deleteMessage=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user/messages/${_}.json`,{},Object.assign(Object.assign({},S),{method:"DELETE"}))).message})}},{"../_osmFetch":17}],42:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getMessage=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user/messages/${_}.json`,void 0,S)).message})}},{"../_osmFetch":17}],43:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./deleteMessage"),c),h(n("./getMessage"),c),h(n("./listMessages"),c),h(n("./sendMessage"),c),h(n("./updateMessageReadStatus"),c)},{"./deleteMessage":41,"./getMessage":42,"./listMessages":44,"./sendMessage":45,"./updateMessageReadStatus":46}],44:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.listMessages=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user/messages/${_}.json`,void 0,S)).messages})}},{"../_osmFetch":17}],45:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.sendMessage=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/user/messages.json",_,Object.assign(Object.assign({},S),{method:"POST"}))).message})}},{"../_osmFetch":17}],46:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.updateMessageReadStatus=a;const h=n("../_osmFetch");function a(_,S,k){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/user/messages/${_}.json`,{read_status:S},Object.assign(Object.assign({},k),{method:"POST"}))).message})}},{"../_osmFetch":17}],47:[function(n,o,c){var d=this&&this.__awaiter||function(C,E,T,L){function R(N){return N instanceof T?N:new T(function(z){z(N)})}return new(T||(T=Promise))(function(N,z){function V(ee){try{oe(L.next(ee))}catch(ne){z(ne)}}function Q(ee){try{oe(L.throw(ee))}catch(ne){z(ne)}}function oe(ee){ee.done?N(ee.value):R(ee.value).then(V,Q)}oe((L=L.apply(C,E||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.featureToNote=void 0,c.getNotesForQuery=S,c.getNotesForArea=k,c.getNote=y;const h=n("../_osmFetch"),a=C=>{const[E,T]=C.geometry.coordinates;return Object.assign(Object.assign({},C.properties),{location:{lat:T,lng:E}})};c.featureToNote=a;function _(C,E,T){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)(`/0.6/notes${E?"/search":""}.json`,C,T)).features.map(c.featureToNote)})}function S(C,E){return _(C,!0,E)}function k(C,E){return _({bbox:C},!1,E)}function y(C,E){return d(this,void 0,void 0,function*(){const T=yield(0,h.osmFetch)(`/0.6/notes/${C}.json`,void 0,E);return(0,c.featureToNote)(T)})}},{"../_osmFetch":17}],48:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./getNotes"),c),h(n("./noteActions"),c),h(n("./subscription"),c)},{"./getNotes":47,"./noteActions":49,"./subscription":50}],49:[function(n,o,c){var d=this&&this.__awaiter||function(C,E,T,L){function R(N){return N instanceof T?N:new T(function(z){z(N)})}return new(T||(T=Promise))(function(N,z){function V(ee){try{oe(L.next(ee))}catch(ne){z(ne)}}function Q(ee){try{oe(L.throw(ee))}catch(ne){z(ne)}}function oe(ee){ee.done?N(ee.value):R(ee.value).then(V,Q)}oe((L=L.apply(C,E||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.createNote=_,c.commentOnNote=S,c.closeNote=k,c.reopenNote=y;const h=n("../_osmFetch"),a=n("./getNotes");function _(C,E,T,L){return d(this,void 0,void 0,function*(){const R=yield(0,h.osmFetch)("/0.6/notes.json",{lat:C,lon:E,text:T},Object.assign(Object.assign({},L),{method:"POST"}));return(0,a.featureToNote)(R)})}function S(C,E,T){return d(this,void 0,void 0,function*(){const L=yield(0,h.osmFetch)(`/0.6/notes/${C}/comment.json`,E?{text:E}:{},Object.assign(Object.assign({},T),{method:"POST"}));return(0,a.featureToNote)(L)})}function k(C,E,T){return d(this,void 0,void 0,function*(){const L=yield(0,h.osmFetch)(`/0.6/notes/${C}/close.json`,E?{text:E}:{},Object.assign(Object.assign({},T),{method:"POST"}));return(0,a.featureToNote)(L)})}function y(C,E,T){return d(this,void 0,void 0,function*(){const L=yield(0,h.osmFetch)(`/0.6/notes/${C}/reopen.json`,E?{text:E}:{},Object.assign(Object.assign({},T),{method:"POST"}));return(0,a.featureToNote)(L)})}},{"../_osmFetch":17,"./getNotes":47}],50:[function(n,o,c){var d=this&&this.__awaiter||function(S,k,y,C){function E(T){return T instanceof y?T:new y(function(L){L(T)})}return new(y||(y=Promise))(function(T,L){function R(V){try{z(C.next(V))}catch(Q){L(Q)}}function N(V){try{z(C.throw(V))}catch(Q){L(Q)}}function z(V){V.done?T(V.value):E(V.value).then(R,N)}z((C=C.apply(S,k||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.subscribeToNote=a,c.unsubscribeFromNote=_;const h=n("../_osmFetch");function a(S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/notes/${S}/subscription`,{},Object.assign(Object.assign({},k),{method:"POST"}))})}function _(S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/notes/${S}/subscription`,{},Object.assign(Object.assign({},k),{method:"DELETE"}))})}},{"../_osmFetch":17}],51:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.deletePreferences=a;const h=n("../_osmFetch");function a(_,S){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/user/preferences/${_}.json`,{},Object.assign(Object.assign({},S),{method:"DELETE"}))})}},{"../_osmFetch":17}],52:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.getPreferences=a;const h=n("../_osmFetch");function a(_){return d(this,void 0,void 0,function*(){return(yield(0,h.osmFetch)("/0.6/user/preferences.json",void 0,_)).preferences})}},{"../_osmFetch":17}],53:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./deletePreferences"),c),h(n("./getPreferences"),c),h(n("./updatePreferences"),c)},{"./deletePreferences":51,"./getPreferences":52,"./updatePreferences":54}],54:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.updatePreferences=a;const h=n("../_osmFetch");function a(_,S,k){return d(this,void 0,void 0,function*(){yield(0,h.osmFetch)(`/0.6/user/preferences/${_}.json`,{},Object.assign(Object.assign({},k),{method:"PUT",body:S}))})}},{"../_osmFetch":17}],55:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.createPopup=h;const d="osm-api-auth-complete";function h(a){let _=!1;return new Promise(S=>{const[k,y]=[600,550],C=Object.entries({width:k,height:y,left:window.screen.width/2-k/2,top:window.screen.height/2-y/2}).map(([R,N])=>`${R}=${N}`).join(","),E=window.open("about:blank","oauth_window",C);if(!E)throw new Error("Popup was blocked");E.location=a;const T=new BroadcastChannel(d),L=R=>{_||(S(R.data),_=!0,T.removeEventListener("message",L),T.close())};T.addEventListener("message",L)})}},{}],56:[function(n,o,c){var d=this&&this.__awaiter||function(_,S,k,y){function C(E){return E instanceof k?E:new k(function(T){T(E)})}return new(k||(k=Promise))(function(E,T){function L(z){try{N(y.next(z))}catch(V){T(V)}}function R(z){try{N(y.throw(z))}catch(V){T(V)}}function N(z){z.done?E(z.value):C(z.value).then(L,R)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.exchangeCode=a;const h=n("./helpers");function a(_,S){return d(this,arguments,void 0,function*(k,{options:y,pkceVerifier:C,state:E}){const T=new URL(k).searchParams,L=T.get("error_description"),R=T.get("code"),N=T.get("state");if(L)throw new Error(L);if(!R)throw new Error("No code in OAuth response");if(!C||!E)throw new Error("No login in progress");if(E!==N)throw new Error("State Mismatch");const z={grant_type:"authorization_code",code:R,redirect_uri:y.redirectUrl,client_id:y.clientId,code_verifier:C},V=`${(0,h.getOAuthBaseUrl)()}/oauth2/token?${new URLSearchParams(z).toString()}`,oe=yield(yield fetch(V,{method:"POST",body:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if("error_description"in oe)throw new Error(oe.error_description);const ee={issuedAt:new Date(oe.created_at*1e3).toISOString(),accessToken:oe.access_token,scopes:oe.scope.split(" ")};return localStorage.setItem("__osmAuth",JSON.stringify(ee)),ee})}},{"./helpers":57}],57:[function(n,o,c){var d=this&&this.__awaiter||function(k,y,C,E){function T(L){return L instanceof C?L:new C(function(R){R(L)})}return new(C||(C=Promise))(function(L,R){function N(Q){try{V(E.next(Q))}catch(oe){R(oe)}}function z(Q){try{V(E.throw(Q))}catch(oe){R(oe)}}function V(Q){Q.done?L(Q.value):T(Q.value).then(N,z)}V((E=E.apply(k,y||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.sha256=a,c.getRandomString=_,c.getOAuthBaseUrl=S;const h=n("../config");function a(k){return d(this,void 0,void 0,function*(){const y=new TextEncoder().encode(k),C=yield window.crypto.subtle.digest("SHA-256",y);return btoa(String.fromCharCode(...new Uint8Array(C))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")})}function _(){return[...window.crypto.getRandomValues(new Uint32Array(32))].map(k=>`0${k.toString(16)}`.slice(-2)).join("")}function S(){let k=(0,h.getConfig)().apiUrl;return k==="https://api.openstreetmap.org"&&(k="https://www.openstreetmap.org"),k}},{"../config":60}],58:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./oauth2"),c)},{"./oauth2":59}],59:[function(n,o,c){var d=this&&this.__awaiter||function(E,T,L,R){function N(z){return z instanceof L?z:new L(function(V){V(z)})}return new(L||(L=Promise))(function(z,V){function Q(ne){try{ee(R.next(ne))}catch(j){V(j)}}function oe(ne){try{ee(R.throw(ne))}catch(j){V(j)}}function ee(ne){ne.done?z(ne.value):N(ne.value).then(Q,oe)}ee((R=R.apply(E,T||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0}),c.isLoggedIn=c.getAuthToken=c.authReady=void 0,c.login=S,c.logout=C;const h=n("./createPopup"),a=n("./exchangeCode"),_=n("./helpers");function S(E){return d(this,void 0,void 0,function*(){if(!E.redirectUrl)throw new Error("You must include the 'redirectUrl' option");if(!E.clientId)throw new Error("You must include the 'clientId' option");if(!E.scopes)throw new Error("You must include the 'scopes' option");const T=(0,_.getRandomString)(),L=(0,_.getRandomString)(),R=yield(0,_.sha256)(L),N={scope:E.scopes.join(" "),include_granted_scopes:"true",response_type:"code",state:T,redirect_uri:E.redirectUrl,client_id:E.clientId,code_challenge_method:"S256",code_challenge:R},z=`/oauth2/authorize?${new URLSearchParams(N).toString()}`,V=E.switchUser?`/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(z)}`)}`:z,Q=(0,_.getOAuthBaseUrl)()+V,oe={state:T,pkceVerifier:L,options:E};if(E.mode==="popup"){const ee=yield(0,h.createPopup)(Q);return(0,a.exchangeCode)(ee,oe)}if(E.mode==="redirect"){localStorage.setItem("__osmAuthTemp",JSON.stringify(oe)),window.location.replace(Q);return}throw new Error("options.mode must be 'popup' or 'redirect'")})}c.authReady=d(void 0,void 0,void 0,function*(){if(typeof window>"u")return;const E=window.location.href,T=localStorage.getItem("__osmAuthTemp");if(new URL(E).searchParams.get("code")&&T)try{const L=JSON.parse(T);yield(0,a.exchangeCode)(E,L),localStorage.removeItem("__osmAuthTemp")}catch(L){console.error("OSM Auth Error",L)}});const k=()=>{try{const E=localStorage.getItem("__osmAuth");return E?JSON.parse(E).accessToken:void 0}catch{return}};c.getAuthToken=k;const y=()=>!!(0,c.getAuthToken)();c.isLoggedIn=y;function C(){localStorage.removeItem("__osmAuth")}},{"./createPopup":55,"./exchangeCode":56,"./helpers":57}],60:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0}),c.getConfig=void 0,c.configure=a;const d={apiUrl:"https://api.openstreetmap.org",userAgent:"https://github.com/osmlab/osm-api-js"},h=()=>d;c.getConfig=h;function a(_){Object.assign(d,_)}},{}],61:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./api"),c),h(n("./auth"),c),h(n("./config"),c),h(n("./types"),c)},{"./api":40,"./auth":58,"./config":60,"./types":65}],62:[function(n,o,c){Object.defineProperty(c,"__esModule",{value:!0})},{}],63:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],64:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],65:[function(n,o,c){var d=this&&this.__createBinding||(Object.create?function(a,_,S,k){k===void 0&&(k=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(a,k,y)}:function(a,_,S,k){k===void 0&&(k=S),a[k]=_[S]}),h=this&&this.__exportStar||function(a,_){for(var S in a)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,a,S)};Object.defineProperty(c,"__esModule",{value:!0}),h(n("./changesets"),c),h(n("./features"),c),h(n("./general"),c),h(n("./messages"),c),h(n("./notes"),c),h(n("./osmPatch"),c),h(n("./user"),c)},{"./changesets":62,"./features":63,"./general":64,"./messages":66,"./notes":67,"./osmPatch":68,"./user":69}],66:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],67:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],68:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],69:[function(n,o,c){arguments[4][62][0].apply(c,arguments)},{dup:62}]},{},[61])(61)})})(xb);var nh=xb.exports;const{window:RC}=c0;function BC(r){let e,n=r[0].length+"",o,c,d=r[0].length==1?"edit":"edits",h;return{c(){e=ke("div"),o=vt(n),c=qe(),h=vt(d),fe(e,"slot","header")},m(a,_){we(a,e,_),he(e,o),he(e,c),he(e,h)},p(a,_){_&1&&n!==(n=a[0].length+"")&&vi(o,n),_&1&&d!==(d=a[0].length==1?"edit":"edits")&&vi(h,d)},d(a){a&&ve(e)}}}function fy(r){let e,n,o,c,d,h=r[0].length+"",a,_,S,k,y,C,E,T,L,R,N,z,V,Q,oe,ee=r[1]+1+"",ne,j,U=r[0].length+"",X,B,W,ce,pe,be,de,ye=JSON.stringify(r[0][r[1]])+"",Ie,Me,ot;return{c(){e=ke("div"),n=ke("button"),n.textContent="Clear edits",o=qe(),c=ke("button"),d=vt("Undo ("),a=vt(h),_=vt(")"),k=qe(),y=ke("div"),C=ke("button"),C.textContent="Download .osc",E=qe(),T=ke("button"),T.textContent="Upload changeset",L=qe(),R=ke("div"),N=ke("button"),z=vt("Previous"),Q=qe(),oe=ke("span"),ne=vt(ee),j=vt(" / "),X=vt(U),B=qe(),W=ke("button"),ce=vt("Next"),be=qe(),de=ke("p"),Ie=vt(ye),fe(n,"class","btn btn-danger"),fe(c,"class","btn btn-danger"),c.disabled=S=r[0].length==0,fe(e,"class","mb-1"),fe(C,"class","btn btn-secondary"),fe(T,"class","btn btn-secondary"),fe(y,"class","mb-1"),fe(N,"class","btn btn-secondary"),N.disabled=V=r[1]==0,fe(W,"class","btn btn-secondary"),W.disabled=pe=r[1]==r[0].length-1,en(R,"display","flex"),en(R,"justify-content","space-between")},m(We,pt){we(We,e,pt),he(e,n),he(e,o),he(e,c),he(c,d),he(c,a),he(c,_),we(We,k,pt),we(We,y,pt),he(y,C),he(y,E),he(y,T),we(We,L,pt),we(We,R,pt),he(R,N),he(N,z),he(R,Q),he(R,oe),he(oe,ne),he(oe,j),he(oe,X),he(R,B),he(R,W),he(W,ce),we(We,be,pt),we(We,de,pt),he(de,Ie),Me||(ot=[Zt(n,"click",r[5]),Zt(c,"click",r[6]),Zt(C,"click",r[7]),Zt(T,"click",r[8]),Zt(N,"click",r[3]),Zt(W,"click",r[4])],Me=!0)},p(We,pt){pt&1&&h!==(h=We[0].length+"")&&vi(a,h),pt&1&&S!==(S=We[0].length==0)&&(c.disabled=S),pt&2&&V!==(V=We[1]==0)&&(N.disabled=V),pt&2&&ee!==(ee=We[1]+1+"")&&vi(ne,ee),pt&1&&U!==(U=We[0].length+"")&&vi(X,U),pt&3&&pe!==(pe=We[1]==We[0].length-1)&&(W.disabled=pe),pt&3&&ye!==(ye=JSON.stringify(We[0][We[1]])+"")&&vi(Ie,ye)},d(We){We&&(ve(e),ve(k),ve(y),ve(L),ve(R),ve(be),ve(de)),Me=!1,Gn(ot)}}}function NC(r){let e,n=r[0].length>0&&fy(r);return{c(){e=ke("div"),n&&n.c(),fe(e,"slot","body")},m(o,c){we(o,e,c),n&&n.m(e,null)},p(o,c){o[0].length>0?n?n.p(o,c):(n=fy(o),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(o){o&&ve(e),n&&n.d()}}}function jC(r){let e,n,o,c,d,h;return e=new su({props:{loading:r[2]}}),o=new iu({props:{$$slots:{body:[NC],header:[BC]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment)},m(a,_){ct(e,a,_),we(a,n,_),ct(o,a,_),c=!0,d||(h=Zt(RC,"keydown",r[9]),d=!0)},p(a,[_]){const S={};_&4&&(S.loading=a[2]),e.$set(S);const k={};_&16387&&(k.$$scope={dirty:_,ctx:a}),o.$set(k)},i(a){c||(Le(e.$$.fragment,a),Le(o.$$.fragment,a),c=!0)},o(a){Be(e.$$.fragment,a),Be(o.$$.fragment,a),c=!1},d(a){a&&ve(n),ut(e,a),ut(o,a),d=!1,h()}}}function UC(r,e,n){let o,c,d,h;jt(r,ch,N=>n(12,o=N)),jt(r,nr,N=>n(10,c=N)),jt(r,uh,N=>n(13,d=N)),jt(r,Gs,N=>n(11,h=N));let a=[],_=0,S="";function k(){n(1,_--,_)}function y(){n(1,_++,_)}async function C(){if(window.confirm("Do you really want to clear your edits?")){n(2,S="Clearing edits"),await Ro();try{c.editClear(),tn(Gs,h++,h)}finally{n(2,S="")}}}async function E(){n(2,S="Undoing last edit"),await Ro();try{c.editUndo(),tn(Gs,h++,h)}finally{n(2,S="")}}function T(){Ep("changes.osc",c.toOsc())}async function L(){if(!d){window.alert("You have to log in first");return}if(a.some(z=>!("SetTags"in z))){window.alert("You've done a bulk operation. You should NOT upload this to OSM -- it's only for testing or usage in you own tool that consumes OSM data.");return}if(!window.confirm("Do you really know what you're doing and want to upload this?"))return;let N=window.prompt("Please describe this changeset");if(N)try{let z=await nh.uploadChangeset({created_by:"Speedwalk",comment:N},JSON.parse(c.toOsmChangeJson()));window.open(`https://www.openstreetmap.org/changeset/${z}`,"_blank"),tn(nr,c=null,c),tn(ch,o=!1,o)}catch(z){window.alert(`Upload failed: ${z}`)}}async function R(N){N.key=="z"&&N.ctrlKey&&a.length>0&&await E()}return r.$$.update=()=>{r.$$.dirty&3073&&h>0&&(n(0,a=c?JSON.parse(c.getEdits()):[]),n(1,_=0),tn(ch,o=a.length>0,o))},[a,_,S,k,y,C,E,T,L,R,c,h]}class VC extends ci{constructor(e){super(),li(this,e,UC,jC,$t,{})}}function qC(r){var z;let e,n,o,c,d,h,a,_,S,k,y,C,E=dy((z=r[1])==null?void 0:z.getOsmTimestamp())+"",T,L,R,N;return e=new su({props:{loading:r[0]}}),{c(){ht(e.$$.fragment),n=qe(),o=ke("hr"),c=qe(),d=ke("div"),h=ke("div"),a=ke("button"),a.textContent="Load another area",_=qe(),S=ke("button"),S.textContent="Refresh OSM data",k=qe(),y=ke("p"),C=vt("OSM data is from "),T=vt(E),fe(o,"class","my-4"),fe(a,"class","btn btn-secondary"),fe(S,"class","btn btn-secondary"),fe(h,"class","d-flex gap-2 mb-3"),fe(d,"class","mt-4")},m(V,Q){ct(e,V,Q),we(V,n,Q),we(V,o,Q),we(V,c,Q),we(V,d,Q),he(d,h),he(h,a),he(h,_),he(h,S),he(d,k),he(d,y),he(y,C),he(y,T),L=!0,R||(N=[Zt(a,"click",r[2]),Zt(S,"click",r[3])],R=!0)},p(V,[Q]){var ee;const oe={};Q&1&&(oe.loading=V[0]),e.$set(oe),(!L||Q&2)&&E!==(E=dy((ee=V[1])==null?void 0:ee.getOsmTimestamp())+"")&&vi(T,E)},i(V){L||(Le(e.$$.fragment,V),L=!0)},o(V){Be(e.$$.fragment,V),L=!1},d(V){V&&(ve(n),ve(o),ve(c),ve(d)),ut(e,V),R=!1,Gn(N)}}}function dy(r){if(r){let e=new Date(1e3*Number(r));return`${e.toLocaleString()} (${ZC(e)} ago)`}return"unknown"}function ZC(r){let e=Date.now()-r.getTime(),n=Math.floor(e/1e3),o=Math.floor(n/60),c=Math.floor(o/60),d=Math.floor(c/24);return d?d==1?"1 day":`${d} days`:c?c==1?"1 hour":`${c} hours`:o?o==1?"1 minute":`${o} minutes`:"a few seconds"}function WC(r,e,n){let o,c;jt(r,nr,_=>n(1,o=_)),jt(r,ch,_=>n(4,c=_));let d="";function h(){c&&!window.confirm("Changing areas will discard your current edits. Do you want to clear the edits?")||(tn(nr,o=null,o),tn(ch,c=!1,c))}async function a(){if(!(c&&!window.confirm("Refreshing OSM data will discard your current edits. Do you want to clear the edits?")))try{n(0,d="Grabbing new OSM data from Overpass");let _=JSON.parse(o.getBoundary()),S=vb(_),k=await fetch(S);if(!k.ok)throw new Error(`Overpass failed: ${k}`);let y=await k.bytes();n(0,d="Processing Overpass data"),await Ro(),tn(nr,o=new _h(new Uint8Array(y),_),o)}catch(_){window.alert(`Couldn't import from Overpass: ${_}`)}finally{n(0,d="")}}return[d,o,h,a]}class If extends ci{constructor(e){super(),li(this,e,WC,qC,$t,{})}}function GC(r){let e,n,o;return{c(){e=ke("button"),e.textContent="Bulk operations",fe(e,"class","btn btn-secondary")},m(c,d){we(c,e,d),n||(o=Zt(e,"click",r[11]),n=!0)},p:Ut,i:Ut,o:Ut,d(c){c&&ve(e),n=!1,o()}}}function HC(r){let e,n;return e=new iu({props:{$$slots:{body:[YC],header:[XC]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&65548&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function XC(r){let e;return{c(){e=ke("div"),e.textContent="Bulk operations",fe(e,"slot","header")},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function KC(r){let e;return{c(){e=vt("Drive on the left")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function JC(r){let e;return{c(){e=vt("Only for major roads")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function YC(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,L,R,N,z,V,Q,oe,ee,ne;function j(W){r[9](W)}let U={$$slots:{default:[KC]},$$scope:{ctx:r}};r[2]!==void 0&&(U.checked=r[2]),h=new mr({props:U}),gi.push(()=>Zi(h,"checked",j));function X(W){r[10](W)}let B={$$slots:{default:[JC]},$$scope:{ctx:r}};return r[3]!==void 0&&(B.checked=r[3]),L=new mr({props:B}),gi.push(()=>Zi(L,"checked",X)),{c(){e=ke("div"),n=ke("div"),o=ke("div"),o.textContent="Assume old-style tags on one-ways",c=qe(),d=ke("div"),ht(h.$$.fragment),_=qe(),S=ke("button"),S.textContent="Autoset tags on one-ways",k=qe(),y=ke("div"),C=ke("div"),C.textContent="Make all sidewalks",E=qe(),T=ke("div"),ht(L.$$.fragment),N=qe(),z=ke("button"),z.textContent="Make sidewalks",V=qe(),Q=ke("button"),Q.textContent="Connect all crossings over major roads",fe(o,"class","card-header"),fe(S,"class","btn btn-secondary"),fe(d,"class","card-body"),fe(n,"class","card mb-3"),fe(C,"class","card-header"),fe(z,"class","btn btn-secondary"),fe(T,"class","card-body"),fe(y,"class","card mb-3"),fe(Q,"class","btn btn-secondary"),fe(e,"slot","body")},m(W,ce){we(W,e,ce),he(e,n),he(n,o),he(n,c),he(n,d),ct(h,d,null),he(d,_),he(d,S),he(e,k),he(e,y),he(y,C),he(y,E),he(y,T),ct(L,T,null),he(T,N),he(T,z),he(e,V),he(e,Q),oe=!0,ee||(ne=[Zt(S,"click",r[8]),Zt(z,"click",r[6]),Zt(Q,"click",r[7])],ee=!0)},p(W,ce){const pe={};ce&65536&&(pe.$$scope={dirty:ce,ctx:W}),!a&&ce&4&&(a=!0,pe.checked=W[2],qi(()=>a=!1)),h.$set(pe);const be={};ce&65536&&(be.$$scope={dirty:ce,ctx:W}),!R&&ce&8&&(R=!0,be.checked=W[3],qi(()=>R=!1)),L.$set(be)},i(W){oe||(Le(h.$$.fragment,W),Le(L.$$.fragment,W),oe=!0)},o(W){Be(h.$$.fragment,W),Be(L.$$.fragment,W),oe=!1},d(W){W&&ve(e),ut(h),ut(L),ee=!1,Gn(ne)}}}function QC(r){let e,n,o,c,d,h,a,_,S;return{c(){e=ke("h2"),e.textContent="Bulk operations",n=qe(),o=ke("p"),o.innerHTML=`Speedwalk has some experimental features that can automatically generate
    separate sidewalks on roads tagged with <i>sidewalk = left,right,both</i>
    . This is intended for use in routers and other tools that require separate sidewalks.
    This generation is very error-prone and not meant to ever replace mapping sidewalks
    properly, just as a stop-gap for areas with low coverage. Feel free to test it
    out, but do not ever upload the results to OSM.`,c=qe(),d=ke("button"),d.textContent="I understand",h=qe(),a=ke("button"),a.textContent="Cancel",fe(d,"class","btn btn-primary"),fe(a,"class","btn btn-secondary")},m(k,y){we(k,e,y),we(k,n,y),we(k,o,y),we(k,c,y),we(k,d,y),we(k,h,y),we(k,a,y),_||(S=[Zt(d,"click",r[5]),Zt(a,"click",r[12])],_=!0)},p:Ut,d(k){k&&(ve(e),ve(n),ve(o),ve(c),ve(d),ve(h),ve(a)),_=!1,Gn(S)}}}function $C(r){let e,n,o,c,d,h,a,_;e=new su({props:{loading:r[1]}});const S=[HC,GC],k=[];function y(T,L){return T[4]?0:1}o=y(r),c=k[o]=S[o](r);function C(T){r[13](T)}let E={$$slots:{default:[QC]},$$scope:{ctx:r}};return r[0]!==void 0&&(E.show=r[0]),h=new Tp({props:E}),gi.push(()=>Zi(h,"show",C)),{c(){ht(e.$$.fragment),n=qe(),c.c(),d=qe(),ht(h.$$.fragment)},m(T,L){ct(e,T,L),we(T,n,L),k[o].m(T,L),we(T,d,L),ct(h,T,L),_=!0},p(T,[L]){const R={};L&2&&(R.loading=T[1]),e.$set(R);let N=o;o=y(T),o===N?k[o].p(T,L):(an(),Be(k[N],1,1,()=>{k[N]=null}),ln(),c=k[o],c?c.p(T,L):(c=k[o]=S[o](T),c.c()),Le(c,1),c.m(d.parentNode,d));const z={};L&65537&&(z.$$scope={dirty:L,ctx:T}),!a&&L&1&&(a=!0,z.show=T[0],qi(()=>a=!1)),h.$set(z)},i(T){_||(Le(e.$$.fragment,T),Le(c),Le(h.$$.fragment,T),_=!0)},o(T){Be(e.$$.fragment,T),Be(c),Be(h.$$.fragment,T),_=!1},d(T){T&&(ve(n),ve(d)),ut(e,T),k[o].d(T),ut(h,T)}}}function eE(r,e,n){let o,c,d;jt(r,Gs,V=>n(14,o=V)),jt(r,nr,V=>n(15,c=V)),jt(r,U_,V=>n(4,d=V));let h=!1;function a(){tn(U_,d=!0,d),n(0,h=!1)}let _="",S=!0,k=!0;async function y(){n(1,_="Generating sidewalks"),await Ro();try{c.editMakeAllSidewalks(k),tn(Gs,o++,o)}catch(V){window.alert(`Error: ${V}`)}finally{n(1,_="")}}async function C(){n(1,_="Connecting crossings"),await Ro();try{c.editConnectAllCrossings(),tn(Gs,o++,o)}catch(V){window.alert(`Error: ${V}`)}finally{n(1,_="")}}async function E(){n(1,_="Inferring sidewalks around one-ways"),await Ro();try{c.editAssumeTags(S),tn(Gs,o++,o)}catch(V){window.alert(`Error: ${V}`)}finally{n(1,_="")}}function T(V){S=V,n(2,S)}function L(V){k=V,n(3,k)}const R=()=>n(0,h=!0),N=()=>n(0,h=!1);function z(V){h=V,n(0,h)}return[h,_,S,k,d,a,y,C,E,T,L,R,N,z]}class tE extends ci{constructor(e){super(),li(this,e,eE,$C,$t,{})}}function py(r,e,n){const o=r.slice();return o[11]=e[n][0],o[12]=e[n][1],o[13]=e,o[14]=n,o}function my(r,e,n){const o=r.slice();return o[11]=e[n][0],o[12]=e[n][1],o[15]=e,o[16]=n,o}function gy(r,e,n){const o=r.slice();o[11]=e[n][0],o[17]=e[n][1];const c=o[1].total_length_meters[o[11]];return o[18]=c,o}function _y(r){let e;return{c(){e=ke("span"),fe(e,"class","svelte-m98wcc"),en(e,"width",`${100*r[18]/r[2]}%`),en(e,"height","100%"),en(e,"background-color",Gl[r[11]])},m(n,o){we(n,e,o)},p(n,o){o&6&&en(e,"width",`${100*n[18]/n[2]}%`)},d(n){n&&ve(e)}}}function iE(r){let e,n,o=r[12]+"",c,d,h=tu(r[1].total_length_meters[r[11]])+"",a;return{c(){e=ke("span"),n=qe(),c=vt(o),d=vt(": "),a=vt(h),fe(e,"class","color-swatch svelte-m98wcc"),en(e,"background",Gl[r[11]])},m(_,S){we(_,e,S),we(_,n,S),we(_,c,S),we(_,d,S),we(_,a,S)},p(_,S){S&2&&h!==(h=tu(_[1].total_length_meters[_[11]])+"")&&vi(a,h)},d(_){_&&(ve(e),ve(n),ve(c),ve(d),ve(a))}}}function yy(r){let e,n,o,c;function d(a){r[8](a,r[11])}let h={$$slots:{default:[iE]},$$scope:{ctx:r}};return r[0][r[11]]!==void 0&&(h.checked=r[0][r[11]]),n=new mr({props:h}),gi.push(()=>Zi(n,"checked",d)),{c(){e=ke("div"),ht(n.$$.fragment),en(e,"display","flex"),en(e,"align-items","center"),en(e,"gap","6px")},m(a,_){we(a,e,_),ct(n,e,null),c=!0},p(a,_){r=a;const S={};_&1026&&(S.$$scope={dirty:_,ctx:r}),!o&&_&9&&(o=!0,S.checked=r[0][r[11]],qi(()=>o=!1)),n.$set(S)},i(a){c||(Le(n.$$.fragment,a),c=!0)},o(a){Be(n.$$.fragment,a),c=!1},d(a){a&&ve(e),ut(n)}}}function nE(r){let e,n,o=r[12]+"",c,d,h=tu(r[1].total_length_meters[r[11]])+"",a;return{c(){e=ke("span"),n=qe(),c=vt(o),d=vt(": "),a=vt(h),fe(e,"class","color-swatch svelte-m98wcc"),en(e,"background",Gl[r[11]])},m(_,S){we(_,e,S),we(_,n,S),we(_,c,S),we(_,d,S),we(_,a,S)},p(_,S){S&2&&h!==(h=tu(_[1].total_length_meters[_[11]])+"")&&vi(a,h)},d(_){_&&(ve(e),ve(n),ve(c),ve(d),ve(a))}}}function by(r){let e,n,o,c,d;function h(_){r[9](_,r[11])}let a={$$slots:{default:[nE]},$$scope:{ctx:r}};return r[0][r[11]]!==void 0&&(a.checked=r[0][r[11]]),n=new mr({props:a}),gi.push(()=>Zi(n,"checked",h)),{c(){e=ke("div"),ht(n.$$.fragment),c=qe(),en(e,"display","flex"),en(e,"align-items","center"),en(e,"gap","6px")},m(_,S){we(_,e,S),ct(n,e,null),he(e,c),d=!0},p(_,S){r=_;const k={};S&1026&&(k.$$scope={dirty:S,ctx:r}),!o&&S&17&&(o=!0,k.checked=r[0][r[11]],qi(()=>o=!1)),n.$set(k)},i(_){d||(Le(n.$$.fragment,_),d=!0)},o(_){Be(n.$$.fragment,_),d=!1},d(_){_&&ve(e),ut(n)}}}function rE(r){let e,n,o,c,d,h,a,_,S,k,y,C,E=Ri(r[3]),T=[];for(let ne=0;ne<E.length;ne+=1)T[ne]=_y(gy(r,E,ne));let L=Ri(r[3]),R=[];for(let ne=0;ne<L.length;ne+=1)R[ne]=yy(my(r,L,ne));const N=ne=>Be(R[ne],1,1,()=>{R[ne]=null}),z=r[7].default,V=wn(z,r,r[10],null);let Q=Ri(r[4]),oe=[];for(let ne=0;ne<Q.length;ne+=1)oe[ne]=by(py(r,Q,ne));const ee=ne=>Be(oe[ne],1,1,()=>{oe[ne]=null});return{c(){e=ke("div"),n=ke("div"),n.textContent="Roads",o=qe(),c=ke("div"),d=ke("div");for(let ne=0;ne<T.length;ne+=1)T[ne].c();h=qe();for(let ne=0;ne<R.length;ne+=1)R[ne].c();a=qe(),_=ke("div"),S=qe(),V&&V.c(),k=qe();for(let ne=0;ne<oe.length;ne+=1)oe[ne].c();y=Mn(),fe(n,"class","card-header"),fe(d,"class","row mb-1 svelte-m98wcc"),fe(_,"class","mb-3"),fe(c,"class","card-body"),fe(e,"class","card mb-3")},m(ne,j){we(ne,e,j),he(e,n),he(e,o),he(e,c),he(c,d);for(let U=0;U<T.length;U+=1)T[U]&&T[U].m(d,null);he(c,h);for(let U=0;U<R.length;U+=1)R[U]&&R[U].m(c,null);he(c,a),he(c,_),he(c,S),V&&V.m(c,null),we(ne,k,j);for(let U=0;U<oe.length;U+=1)oe[U]&&oe[U].m(ne,j);we(ne,y,j),C=!0},p(ne,[j]){if(j&14){E=Ri(ne[3]);let U;for(U=0;U<E.length;U+=1){const X=gy(ne,E,U);T[U]?T[U].p(X,j):(T[U]=_y(X),T[U].c(),T[U].m(d,null))}for(;U<T.length;U+=1)T[U].d(1);T.length=E.length}if(j&11){L=Ri(ne[3]);let U;for(U=0;U<L.length;U+=1){const X=my(ne,L,U);R[U]?(R[U].p(X,j),Le(R[U],1)):(R[U]=yy(X),R[U].c(),Le(R[U],1),R[U].m(c,a))}for(an(),U=L.length;U<R.length;U+=1)N(U);ln()}if(V&&V.p&&(!C||j&1024)&&kn(V,z,ne,ne[10],C?xn(z,ne[10],j,null):Sn(ne[10]),null),j&19){Q=Ri(ne[4]);let U;for(U=0;U<Q.length;U+=1){const X=py(ne,Q,U);oe[U]?(oe[U].p(X,j),Le(oe[U],1)):(oe[U]=by(X),oe[U].c(),Le(oe[U],1),oe[U].m(y.parentNode,y))}for(an(),U=Q.length;U<oe.length;U+=1)ee(U);ln()}},i(ne){if(!C){for(let j=0;j<L.length;j+=1)Le(R[j]);Le(V,ne);for(let j=0;j<Q.length;j+=1)Le(oe[j]);C=!0}},o(ne){R=R.filter(Boolean);for(let j=0;j<R.length;j+=1)Be(R[j]);Be(V,ne),oe=oe.filter(Boolean);for(let j=0;j<oe.length;j+=1)Be(oe[j]);C=!1},d(ne){ne&&(ve(e),ve(k),ve(y)),Qn(T,ne),Qn(R,ne),V&&V.d(ne),Qn(oe,ne)}}}function sE(r,e,n){let o,c,d;jt(r,nr,T=>n(5,c=T)),jt(r,Gs,T=>n(6,d=T));let{$$slots:h={},$$scope:a}=e,{showKinds:_}=e,S=[["RoadWithSeparate","With separate sidewalks"],["RoadWithTags","With tagged sidewalks"],["RoadWithoutSidewalksExplicit","Tagged as no sidewalks"],["RoadWithoutSidewalksImplicit","Assumed as no sidewalks"],["RoadUnknown","Totally unknown"]],k=[["Sidewalk","Sidewalks"],["Crossing","Crossings"],["Other","Other"]],y=JSON.parse(c.getMetrics());function C(T,L){r.$$.not_equal(_[L],T)&&(_[L]=T,n(0,_))}function E(T,L){r.$$.not_equal(_[L],T)&&(_[L]=T,n(0,_))}return r.$$set=T=>{"showKinds"in T&&n(0,_=T.showKinds),"$$scope"in T&&n(10,a=T.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&d&&c&&n(1,y=JSON.parse(c.getMetrics())),r.$$.dirty&2&&n(2,o=lT(S.map(([T,L])=>y.total_length_meters[T])))},[_,y,o,S,k,c,d,h,C,E,a]}class oE extends ci{constructor(e){super(),li(this,e,sE,rE,$t,{showKinds:0})}}function vy(r,e,n){const o=r.slice();return o[14]=e[n][0],o[15]=e[n][1],o}function wy(r,e,n){const o=r.slice();return o[18]=e[n][0],o[19]=e[n][1],o}function xy(r,e,n){const o=r.slice();return o[18]=e[n][0],o[19]=e[n][1],o}function ky(r,e,n){const o=r.slice();return o[14]=e[n][0],o[15]=e[n][1],o}function Sy(r,e,n){const o=r.slice();return o[26]=e[n],o}function Ty(r){let e,n,o,c,d,h,a=Ri(r[1].properties.problems),_=[];for(let k=0;k<a.length;k+=1)_[k]=Cy(Sy(r,a,k));let S=r[2].features.length&&Ey(r);return d=new Cp({props:{labelColors:Object.fromEntries(r[2].features.map(Oy)),itemsPerRow:1}}),{c(){e=ke("u"),e.textContent="Problems:",n=qe();for(let k=0;k<_.length;k+=1)_[k].c();o=qe(),S&&S.c(),c=qe(),ht(d.$$.fragment)},m(k,y){we(k,e,y),we(k,n,y);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(k,y);we(k,o,y),S&&S.m(k,y),we(k,c,y),ct(d,k,y),h=!0},p(k,y){if(y&2){a=Ri(k[1].properties.problems);let E;for(E=0;E<a.length;E+=1){const T=Sy(k,a,E);_[E]?_[E].p(T,y):(_[E]=Cy(T),_[E].c(),_[E].m(o.parentNode,o))}for(;E<_.length;E+=1)_[E].d(1);_.length=a.length}k[2].features.length?S?(S.p(k,y),y&4&&Le(S,1)):(S=Ey(k),S.c(),Le(S,1),S.m(c.parentNode,c)):S&&(an(),Be(S,1,1,()=>{S=null}),ln());const C={};y&4&&(C.labelColors=Object.fromEntries(k[2].features.map(Oy))),d.$set(C)},i(k){h||(Le(S),Le(d.$$.fragment,k),h=!0)},o(k){Be(S),Be(d.$$.fragment,k),h=!1},d(k){k&&(ve(e),ve(n),ve(o),ve(c)),Qn(_,k),S&&S.d(k),ut(d,k)}}}function Cy(r){let e,n=r[26].note+"",o;return{c(){e=ke("p"),o=vt(n)},m(c,d){we(c,e,d),he(e,o)},p(c,d){d&2&&n!==(n=c[26].note+"")&&vi(o,n)},d(c){c&&ve(e)}}}function Ey(r){let e,n,o;function c(h){r[9](h)}let d={$$slots:{default:[aE]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.checked=r[0]),e=new mr({props:d}),gi.push(()=>Zi(e,"checked",c)),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,a){const _={};a&536870912&&(_.$$scope={dirty:a,ctx:h}),!n&&a&1&&(n=!0,_.checked=h[0],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function aE(r){let e;return{c(){e=vt("Show problem details")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function lE(r){let e,n,o,c=Ri(r[7].entries()),d=[];for(let h=0;h<c.length;h+=1)d[h]=Iy(wy(r,c,h));return{c(){e=ke("u"),e.textContent="Set these tags",n=qe();for(let h=0;h<d.length;h+=1)d[h].c();o=Mn()},m(h,a){we(h,e,a),we(h,n,a);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(h,a);we(h,o,a)},p(h,a){if(a&160){c=Ri(h[7].entries());let _;for(_=0;_<c.length;_+=1){const S=wy(h,c,_);d[_]?d[_].p(S,a):(d[_]=Iy(S),d[_].c(),d[_].m(o.parentNode,o))}for(;_<d.length;_+=1)d[_].d(1);d.length=c.length}},d(h){h&&(ve(e),ve(n),ve(o)),Qn(d,h)}}}function cE(r){let e,n,o,c,d,h,a,_=Ri(Object.entries(r[1].properties.tags)),S=[];for(let C=0;C<_.length;C+=1)S[C]=My(ky(r,_,C));let k=Ri(r[6].entries()),y=[];for(let C=0;C<k.length;C+=1)y[C]=Py(xy(r,k,C));return{c(){e=ke("u"),e.textContent="Current sidewalk tags",n=qe(),o=ke("ul");for(let C=0;C<S.length;C+=1)S[C].c();c=qe(),d=ke("u"),d.textContent="Override to these tags",h=qe();for(let C=0;C<y.length;C+=1)y[C].c();a=Mn()},m(C,E){we(C,e,E),we(C,n,E),we(C,o,E);for(let T=0;T<S.length;T+=1)S[T]&&S[T].m(o,null);we(C,c,E),we(C,d,E),we(C,h,E);for(let T=0;T<y.length;T+=1)y[T]&&y[T].m(C,E);we(C,a,E)},p(C,E){if(E&2){_=Ri(Object.entries(C[1].properties.tags));let T;for(T=0;T<_.length;T+=1){const L=ky(C,_,T);S[T]?S[T].p(L,E):(S[T]=My(L),S[T].c(),S[T].m(o,null))}for(;T<S.length;T+=1)S[T].d(1);S.length=_.length}if(E&96){k=Ri(C[6].entries());let T;for(T=0;T<k.length;T+=1){const L=xy(C,k,T);y[T]?y[T].p(L,E):(y[T]=Py(L),y[T].c(),y[T].m(a.parentNode,a))}for(;T<y.length;T+=1)y[T].d(1);y.length=k.length}},d(C){C&&(ve(e),ve(n),ve(o),ve(c),ve(d),ve(h),ve(a)),Qn(S,C),Qn(y,C)}}}function Iy(r){let e,n,o,c,d=r[19].map(fE).join(", ")+"",h,a,_,S;function k(){return r[11](r[19])}return{c(){e=ke("div"),n=ke("button"),o=ke("kbd"),o.textContent=`${r[18]+1}`,c=qe(),h=vt(d),a=qe(),fe(n,"class","btn btn-secondary mb-1")},m(y,C){we(y,e,C),he(e,n),he(n,o),he(n,c),he(n,h),he(e,a),_||(S=Zt(n,"click",k),_=!0)},p(y,C){r=y},d(y){y&&ve(e),_=!1,S()}}}function Ay(r){let e,n=r[14]+"",o,c,d=r[15]+"",h;return{c(){e=ke("li"),o=vt(n),c=vt(" = "),h=vt(d)},m(a,_){we(a,e,_),he(e,o),he(e,c),he(e,h)},p(a,_){_&2&&n!==(n=a[14]+"")&&vi(o,n),_&2&&d!==(d=a[15]+"")&&vi(h,d)},d(a){a&&ve(e)}}}function My(r){let e=r[14].startsWith("sidewalk"),n,o=e&&Ay(r);return{c(){o&&o.c(),n=Mn()},m(c,d){o&&o.m(c,d),we(c,n,d)},p(c,d){d&2&&(e=c[14].startsWith("sidewalk")),e?o?o.p(c,d):(o=Ay(c),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(c){c&&ve(n),o&&o.d(c)}}}function Py(r){let e,n,o,c,d=r[19].map(hE).join(", ")+"",h,a,_,S;function k(){return r[10](r[19])}return{c(){e=ke("div"),n=ke("button"),o=ke("kbd"),o.textContent=`${r[18]+1}`,c=qe(),h=vt(d),a=qe(),fe(n,"class","btn btn-secondary mb-1")},m(y,C){we(y,e,C),he(e,n),he(n,o),he(n,c),he(n,h),he(e,a),_||(S=Zt(n,"click",k),_=!0)},p(y,C){r=y},d(y){y&&ve(e),_=!1,S()}}}function Ly(r){let e,n,o=r[14]+"",c,d,h,a=r[15]+"",_,S;return{c(){e=ke("tr"),n=ke("td"),c=vt(o),d=qe(),h=ke("td"),_=vt(a),S=qe()},m(k,y){we(k,e,y),he(e,n),he(n,c),he(e,d),he(e,h),he(h,_),he(e,S)},p(k,y){y&2&&o!==(o=k[14]+"")&&vi(c,o),y&2&&a!==(a=k[15]+"")&&vi(_,a)},d(k){k&&ve(e)}}}function zy(r){let e,n,o=r[1].properties.node_ids.join(", ")+"",c;return{c(){e=ke("p"),n=vt("Nodes: "),c=vt(o)},m(d,h){we(d,e,h),he(e,n),he(e,c)},p(d,h){h&2&&o!==(o=d[1].properties.node_ids.join(", ")+"")&&vi(c,o)},d(d){d&&ve(e)}}}function uE(r){let e,n,o,c,d,h,a=r[1].properties.id+"",_,S,k,y,C,E,T,L=ny[r[1].properties.kind]+"",R,N,z,V,Q,oe,ee,ne,j,U,X,B,W,ce;e=new su({props:{loading:r[3]}});let pe=r[1].properties.problems.length&&Ty(r);function be(We,pt){if(pt&2&&(Q=null),Q==null&&(Q=!!We[1].properties.kind.startsWith("Road")),Q)return cE;if(We[1].properties.kind=="Sidewalk"||We[1].properties.kind=="Other")return lE}let de=be(r,-1),ye=de&&de(r),Ie=Ri(Object.entries(r[1].properties.tags)),Me=[];for(let We=0;We<Ie.length;We+=1)Me[We]=Ly(vy(r,Ie,We));let ot=r[4]&&zy(r);return{c(){ht(e.$$.fragment),n=qe(),o=ke("div"),c=ke("div"),d=ke("a"),h=vt("Way "),_=vt(a),k=vt(`
    (
    `),y=ke("a"),C=ke("i"),T=vt(`
    ) : `),R=vt(L),N=qe(),z=ke("div"),pe&&pe.c(),V=qe(),ye&&ye.c(),oe=qe(),ee=ke("table"),ne=ke("thead"),ne.innerHTML="<tr><th>Key</th> <th>Value</th></tr>",j=qe(),U=ke("tbody");for(let We=0;We<Me.length;We+=1)Me[We].c();X=qe(),ot&&ot.c(),fe(d,"href",S="https://www.openstreetmap.org/way/"+r[1].properties.id),fe(d,"target","_blank"),fe(C,"class","fa-solid fa-pencil"),fe(y,"href",E="https://www.openstreetmap.org/edit?way="+r[1].properties.id),fe(y,"target","_blank"),fe(c,"class","card-header"),fe(ee,"class","table table-bordered"),fe(z,"class","card-body"),fe(o,"class","card mb-5")},m(We,pt){ct(e,We,pt),we(We,n,pt),we(We,o,pt),he(o,c),he(c,d),he(d,h),he(d,_),he(c,k),he(c,y),he(y,C),he(c,T),he(c,R),he(o,N),he(o,z),pe&&pe.m(z,null),he(z,V),ye&&ye.m(z,null),he(z,oe),he(z,ee),he(ee,ne),he(ee,j),he(ee,U);for(let Tt=0;Tt<Me.length;Tt+=1)Me[Tt]&&Me[Tt].m(U,null);he(z,X),ot&&ot.m(z,null),B=!0,W||(ce=Zt(window,"keypress",r[8]),W=!0)},p(We,[pt]){const Tt={};if(pt&8&&(Tt.loading=We[3]),e.$set(Tt),(!B||pt&2)&&a!==(a=We[1].properties.id+"")&&vi(_,a),(!B||pt&2&&S!==(S="https://www.openstreetmap.org/way/"+We[1].properties.id))&&fe(d,"href",S),(!B||pt&2&&E!==(E="https://www.openstreetmap.org/edit?way="+We[1].properties.id))&&fe(y,"href",E),(!B||pt&2)&&L!==(L=ny[We[1].properties.kind]+"")&&vi(R,L),We[1].properties.problems.length?pe?(pe.p(We,pt),pt&2&&Le(pe,1)):(pe=Ty(We),pe.c(),Le(pe,1),pe.m(z,V)):pe&&(an(),Be(pe,1,1,()=>{pe=null}),ln()),de===(de=be(We,pt))&&ye?ye.p(We,pt):(ye&&ye.d(1),ye=de&&de(We),ye&&(ye.c(),ye.m(z,oe))),pt&2){Ie=Ri(Object.entries(We[1].properties.tags));let $e;for($e=0;$e<Ie.length;$e+=1){const wt=vy(We,Ie,$e);Me[$e]?Me[$e].p(wt,pt):(Me[$e]=Ly(wt),Me[$e].c(),Me[$e].m(U,null))}for(;$e<Me.length;$e+=1)Me[$e].d(1);Me.length=Ie.length}We[4]?ot?ot.p(We,pt):(ot=zy(We),ot.c(),ot.m(z,null)):ot&&(ot.d(1),ot=null)},i(We){B||(Le(e.$$.fragment,We),Le(pe),B=!0)},o(We){Be(e.$$.fragment,We),Be(pe),B=!1},d(We){We&&(ve(n),ve(o)),ut(e,We),pe&&pe.d(),ye&&ye.d(),Qn(Me,We),ot&&ot.d(),W=!1,ce()}}}const Oy=r=>[r.properties.label,r.properties.color],hE=r=>`${r[0]} = ${r[1]}`,fE=r=>`${r[0]} = ${r[1]}`;function dE(r,e,n){let o,c,d;jt(r,Gs,N=>n(12,o=N)),jt(r,nr,N=>n(13,c=N)),jt(r,vf,N=>n(4,d=N));let{pinnedWay:h}=e,{drawProblemDetails:a}=e,{showProblemDetails:_}=e,S="";async function k(N){n(3,S="Setting tags"),await Ro();try{c.editSetTags(BigInt(h.properties.id),N),tn(Gs,o++,o)}finally{n(3,S="")}}let y=[[["sidewalk:both","separate"]],[["sidewalk:left","separate"],["sidewalk:right","no"]],[["sidewalk:right","separate"],["sidewalk:left","no"]],[["sidewalk","both"]],[["sidewalk","left"]],[["sidewalk","right"]],[["sidewalk","no"]]],C=[[["footway","sidewalk"]],[["footway","crossing"]]];async function E(N){let z=[];h.properties.kind.startsWith("Road")?z=y:(h.properties.kind=="Sidewalk"||h.properties.kind=="Other")&&(z=C);let V=parseInt(N.key);Number.isInteger(V)&&V<=z.length&&await k(z[V-1])}function T(N){_=N,n(0,_)}const L=N=>k(N),R=N=>k(N);return r.$$set=N=>{"pinnedWay"in N&&n(1,h=N.pinnedWay),"drawProblemDetails"in N&&n(2,a=N.drawProblemDetails),"showProblemDetails"in N&&n(0,_=N.showProblemDetails)},[_,h,a,S,d,k,y,C,E,T,L,R]}class pE extends ci{constructor(e){super(),li(this,e,dE,uE,$t,{pinnedWay:1,drawProblemDetails:2,showProblemDetails:0})}}function Dy(r){var o;const e=((o=r[29])==null?void 0:o.properties)??{};r[30]=e;const n=JSON.parse(r[30].problems);r[31]=n}function Fy(r,e,n){const o=r.slice();return o[32]=e[n],o}function Ry(r,e,n){const o=r.slice();return o[35]=e[n][0],o[36]=e[n][1],o}function By(r){let e,n,o;function c(h){r[26](h)}let d={pinnedWay:r[2],drawProblemDetails:r[9]};return r[8]!==void 0&&(d.showProblemDetails=r[8]),e=new pE({props:d}),gi.push(()=>Zi(e,"showProblemDetails",c)),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,a){const _={};a[0]&4&&(_.pinnedWay=h[2]),a[0]&512&&(_.drawProblemDetails=h[9]),!n&&a[0]&256&&(n=!0,_.showProblemDetails=h[8],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function mE(r){let e,n,o,c,d,h,a,_,S,k,y;n=new VC({});function C(L){r[25](L)}let E={nodes:r[0],ways:r[1]};r[12]!==void 0&&(E.drawProblems=r[12]),c=new LC({props:E}),gi.push(()=>Zi(c,"drawProblems",C));let T=r[2]&&By(r);return _=new tE({}),k=new If({}),{c(){e=ke("div"),ht(n.$$.fragment),o=qe(),ht(c.$$.fragment),h=qe(),T&&T.c(),a=qe(),ht(_.$$.fragment),S=qe(),ht(k.$$.fragment),fe(e,"slot","sidebar")},m(L,R){we(L,e,R),ct(n,e,null),he(e,o),ct(c,e,null),he(e,h),T&&T.m(e,null),he(e,a),ct(_,e,null),he(e,S),ct(k,e,null),y=!0},p(L,R){const N={};R[0]&1&&(N.nodes=L[0]),R[0]&2&&(N.ways=L[1]),!d&&R[0]&4096&&(d=!0,N.drawProblems=L[12],qi(()=>d=!1)),c.$set(N),L[2]?T?(T.p(L,R),R[0]&4&&Le(T,1)):(T=By(L),T.c(),Le(T,1),T.m(e,a)):T&&(an(),Be(T,1,1,()=>{T=null}),ln())},i(L){y||(Le(n.$$.fragment,L),Le(c.$$.fragment,L),Le(T),Le(_.$$.fragment,L),Le(k.$$.fragment,L),y=!0)},o(L){Be(n.$$.fragment,L),Be(c.$$.fragment,L),Be(T),Be(_.$$.fragment,L),Be(k.$$.fragment,L),y=!1},d(L){L&&ve(e),ut(n),ut(c),T&&T.d(),ut(_),ut(k)}}}function Ny(r){let e,n,o=r[35]+"",c,d,h,a=r[36]+"",_,S;return{c(){e=ke("tr"),n=ke("td"),c=vt(o),d=qe(),h=ke("td"),_=vt(a),S=qe()},m(k,y){we(k,e,y),he(e,n),he(n,c),he(e,d),he(e,h),he(h,_),he(e,S)},p(k,y){y[0]&536870912&&o!==(o=k[35]+"")&&vi(c,o),y[0]&536870912&&a!==(a=k[36]+"")&&vi(_,a)},d(k){k&&ve(e)}}}function jy(r){let e,n,o,c=Ri(r[31]),d=[];for(let h=0;h<c.length;h+=1)d[h]=Uy(Fy(r,c,h));return{c(){e=ke("u"),e.textContent="Problems:",n=qe();for(let h=0;h<d.length;h+=1)d[h].c();o=Mn()},m(h,a){we(h,e,a),we(h,n,a);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(h,a);we(h,o,a)},p(h,a){if(a[0]&536870912){c=Ri(h[31]);let _;for(_=0;_<c.length;_+=1){const S=Fy(h,c,_);d[_]?d[_].p(S,a):(d[_]=Uy(S),d[_].c(),d[_].m(o.parentNode,o))}for(;_<d.length;_+=1)d[_].d(1);d.length=c.length}},d(h){h&&(ve(e),ve(n),ve(o)),Qn(d,h)}}}function Uy(r){let e,n=r[32].note+"",o;return{c(){e=ke("p"),o=vt(n)},m(c,d){we(c,e,d),he(e,o)},p(c,d){d[0]&536870912&&n!==(n=c[32].note+"")&&vi(o,n)},d(c){c&&ve(e)}}}function gE(r){Dy(r);let e,n,o=r[30].id+"",c,d,h,a,_=r[30].way_ids+"",S,k,y,C,E,T,L=Ri(Object.entries(JSON.parse(r[30].tags||"{}"))),R=[];for(let z=0;z<L.length;z+=1)R[z]=Ny(Ry(r,L,z));let N=r[31].length&&jy(r);return{c(){e=ke("h4"),n=vt("Node "),c=vt(o),d=qe(),h=ke("p"),a=vt("Ways: "),S=vt(_),k=qe(),y=ke("table"),C=ke("tbody");for(let z=0;z<R.length;z+=1)R[z].c();E=qe(),N&&N.c(),T=Mn(),fe(y,"class","table table-bordered")},m(z,V){we(z,e,V),he(e,n),he(e,c),we(z,d,V),we(z,h,V),he(h,a),he(h,S),we(z,k,V),we(z,y,V),he(y,C);for(let Q=0;Q<R.length;Q+=1)R[Q]&&R[Q].m(C,null);we(z,E,V),N&&N.m(z,V),we(z,T,V)},p(z,V){if(Dy(z),V[0]&536870912&&o!==(o=z[30].id+"")&&vi(c,o),V[0]&536870912&&_!==(_=z[30].way_ids+"")&&vi(S,_),V[0]&536870912){L=Ri(Object.entries(JSON.parse(z[30].tags||"{}")));let Q;for(Q=0;Q<L.length;Q+=1){const oe=Ry(z,L,Q);R[Q]?R[Q].p(oe,V):(R[Q]=Ny(oe),R[Q].c(),R[Q].m(C,null))}for(;Q<R.length;Q+=1)R[Q].d(1);R.length=L.length}z[31].length?N?N.p(z,V):(N=jy(z),N.c(),N.m(T.parentNode,T)):N&&(N.d(1),N=null)},d(z){z&&(ve(e),ve(d),ve(h),ve(k),ve(y),ve(E),ve(T)),Qn(R,z),N&&N.d(z)}}}function _E(r){let e,n;return e=new Sp({props:{openOn:"hover",$$slots:{default:[gE,({data:o})=>({29:o}),({data:o})=>[o?536870912:0]]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c[0]&536870912|c[1]&256&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function yE(r){let e,n;return e=new Wl({props:{id:"nodes",beforeId:"Road labels",manageHoverState:!0,paint:{"circle-radius":7,"circle-color":["case",["get","is_crossing"],"yellow","grey"],"circle-opacity":["case",["boolean",["get","is_crossing"]],r[4]?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1},layout:{visibility:r[3]?"visible":"none"},$$slots:{default:[_E]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c[0]&16&&(d.paint={"circle-radius":7,"circle-color":["case",["get","is_crossing"],"yellow","grey"],"circle-opacity":["case",["boolean",["get","is_crossing"]],o[4]?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1}),c[0]&8&&(d.layout={visibility:o[3]?"visible":"none"}),c[1]&256&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function bE(r){let e;return{c(){e=ke("div"),e.textContent="Layers",fe(e,"slot","header")},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function vE(r){let e;return{c(){e=vt("Debug mode")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function wE(r){let e;return{c(){e=vt("Nodes")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function xE(r){let e;return{c(){e=vt("Only modified objects")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function kE(r){let e;return{c(){e=vt("Only show major roads")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function SE(r){let e;return{c(){e=vt("Show service roads")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function TE(r){let e;return{c(){e=vt("Show each side with sidewalks  or not ")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function CE(r){let e,n,o,c,d,h,a,_,S;function k(R){r[21](R)}let y={$$slots:{default:[kE]},$$scope:{ctx:r}};r[5]!==void 0&&(y.checked=r[5]),e=new mr({props:y}),gi.push(()=>Zi(e,"checked",k));function C(R){r[22](R)}let E={$$slots:{default:[SE]},$$scope:{ctx:r}};r[6]!==void 0&&(E.checked=r[6]),c=new mr({props:E}),gi.push(()=>Zi(c,"checked",C));function T(R){r[23](R)}let L={$$slots:{default:[TE]},$$scope:{ctx:r}};return r[10]!==void 0&&(L.checked=r[10]),a=new mr({props:L}),gi.push(()=>Zi(a,"checked",T)),{c(){ht(e.$$.fragment),o=qe(),ht(c.$$.fragment),h=qe(),ht(a.$$.fragment)},m(R,N){ct(e,R,N),we(R,o,N),ct(c,R,N),we(R,h,N),ct(a,R,N),S=!0},p(R,N){const z={};N[1]&256&&(z.$$scope={dirty:N,ctx:R}),!n&&N[0]&32&&(n=!0,z.checked=R[5],qi(()=>n=!1)),e.$set(z);const V={};N[1]&256&&(V.$$scope={dirty:N,ctx:R}),!d&&N[0]&64&&(d=!0,V.checked=R[6],qi(()=>d=!1)),c.$set(V);const Q={};N[1]&256&&(Q.$$scope={dirty:N,ctx:R}),!_&&N[0]&1024&&(_=!0,Q.checked=R[10],qi(()=>_=!1)),a.$set(Q)},i(R){S||(Le(e.$$.fragment,R),Le(c.$$.fragment,R),Le(a.$$.fragment,R),S=!0)},o(R){Be(e.$$.fragment,R),Be(c.$$.fragment,R),Be(a.$$.fragment,R),S=!1},d(R){R&&(ve(o),ve(h)),ut(e,R),ut(c,R),ut(a,R)}}}function EE(r){let e,n,o,c,d,h,a,_,S,k,y,C,E;function T(ee){r[18](ee)}let L={$$slots:{default:[vE]},$$scope:{ctx:r}};r[13]!==void 0&&(L.checked=r[13]),n=new mr({props:L}),gi.push(()=>Zi(n,"checked",T));function R(ee){r[19](ee)}let N={$$slots:{default:[wE]},$$scope:{ctx:r}};r[3]!==void 0&&(N.checked=r[3]),d=new mr({props:N}),gi.push(()=>Zi(d,"checked",R));function z(ee){r[20](ee)}let V={$$slots:{default:[xE]},$$scope:{ctx:r}};r[4]!==void 0&&(V.checked=r[4]),_=new mr({props:V}),gi.push(()=>Zi(_,"checked",z));function Q(ee){r[24](ee)}let oe={$$slots:{default:[CE]},$$scope:{ctx:r}};return r[7]!==void 0&&(oe.showKinds=r[7]),y=new oE({props:oe}),gi.push(()=>Zi(y,"showKinds",Q)),{c(){e=ke("div"),ht(n.$$.fragment),c=qe(),ht(d.$$.fragment),a=qe(),ht(_.$$.fragment),k=qe(),ht(y.$$.fragment),fe(e,"slot","body")},m(ee,ne){we(ee,e,ne),ct(n,e,null),he(e,c),ct(d,e,null),he(e,a),ct(_,e,null),he(e,k),ct(y,e,null),E=!0},p(ee,ne){const j={};ne[1]&256&&(j.$$scope={dirty:ne,ctx:ee}),!o&&ne[0]&8192&&(o=!0,j.checked=ee[13],qi(()=>o=!1)),n.$set(j);const U={};ne[1]&256&&(U.$$scope={dirty:ne,ctx:ee}),!h&&ne[0]&8&&(h=!0,U.checked=ee[3],qi(()=>h=!1)),d.$set(U);const X={};ne[1]&256&&(X.$$scope={dirty:ne,ctx:ee}),!S&&ne[0]&16&&(S=!0,X.checked=ee[4],qi(()=>S=!1)),_.$set(X);const B={};ne[0]&1120|ne[1]&256&&(B.$$scope={dirty:ne,ctx:ee}),!C&&ne[0]&128&&(C=!0,B.showKinds=ee[7],qi(()=>C=!1)),y.$set(B)},i(ee){E||(Le(n.$$.fragment,ee),Le(d.$$.fragment,ee),Le(_.$$.fragment,ee),Le(y.$$.fragment,ee),E=!0)},o(ee){Be(n.$$.fragment,ee),Be(d.$$.fragment,ee),Be(_.$$.fragment,ee),Be(y.$$.fragment,ee),E=!1},d(ee){ee&&ve(e),ut(n),ut(d),ut(_),ut(y)}}}function IE(r){let e,n;return e=new iu({props:{$$slots:{body:[EE],header:[bE]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c[0]&9464|c[1]&256&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function AE(r){let e,n,o,c,d,h,a,_,S,k,y;function C(L){r[16](L)}function E(L){r[17](L)}let T={showProblemDetails:r[8],nodes:r[0],ways:r[1],showRoadSides:r[10],filterWays:r[14](r[5],r[4],r[6],r[7])};return r[2]!==void 0&&(T.pinnedWay=r[2]),r[9]!==void 0&&(T.drawProblemDetails=r[9]),n=new hC({props:T}),gi.push(()=>Zi(n,"pinnedWay",C)),gi.push(()=>Zi(n,"drawProblemDetails",E)),h=new FC({props:{drawProblems:r[12],pinnedWay:r[2]}}),_=new Er({props:{data:r[0],$$slots:{default:[yE]},$$scope:{ctx:r}}}),k=new rS({props:{position:"top-right",$$slots:{default:[IE]},$$scope:{ctx:r}}}),{c(){e=ke("div"),ht(n.$$.fragment),d=qe(),ht(h.$$.fragment),a=qe(),ht(_.$$.fragment),S=qe(),ht(k.$$.fragment),fe(e,"slot","map")},m(L,R){we(L,e,R),ct(n,e,null),he(e,d),ct(h,e,null),he(e,a),ct(_,e,null),he(e,S),ct(k,e,null),y=!0},p(L,R){const N={};R[0]&256&&(N.showProblemDetails=L[8]),R[0]&1&&(N.nodes=L[0]),R[0]&2&&(N.ways=L[1]),R[0]&1024&&(N.showRoadSides=L[10]),R[0]&240&&(N.filterWays=L[14](L[5],L[4],L[6],L[7])),!o&&R[0]&4&&(o=!0,N.pinnedWay=L[2],qi(()=>o=!1)),!c&&R[0]&512&&(c=!0,N.drawProblemDetails=L[9],qi(()=>c=!1)),n.$set(N);const z={};R[0]&4096&&(z.drawProblems=L[12]),R[0]&4&&(z.pinnedWay=L[2]),h.$set(z);const V={};R[0]&1&&(V.data=L[0]),R[0]&24|R[1]&256&&(V.$$scope={dirty:R,ctx:L}),_.$set(V);const Q={};R[0]&9464|R[1]&256&&(Q.$$scope={dirty:R,ctx:L}),k.$set(Q)},i(L){y||(Le(n.$$.fragment,L),Le(h.$$.fragment,L),Le(_.$$.fragment,L),Le(k.$$.fragment,L),y=!0)},o(L){Be(n.$$.fragment,L),Be(h.$$.fragment,L),Be(_.$$.fragment,L),Be(k.$$.fragment,L),y=!1},d(L){L&&ve(e),ut(n),ut(h),ut(_),ut(k)}}}function ME(r){let e,n,o,c;return e=new su({props:{loading:r[11]}}),o=new xh({props:{$$slots:{map:[AE],sidebar:[mE]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment)},m(d,h){ct(e,d,h),we(d,n,h),ct(o,d,h),c=!0},p(d,h){const a={};h[0]&2048&&(a.loading=d[11]),e.$set(a);const _={};h[0]&14335|h[1]&256&&(_.$$scope={dirty:h,ctx:d}),o.$set(_)},i(d){c||(Le(e.$$.fragment,d),Le(o.$$.fragment,d),c=!0)},o(d){Be(e.$$.fragment,d),Be(o.$$.fragment,d),c=!1},d(d){d&&ve(n),ut(e,d),ut(o,d)}}}function PE(r,e,n){let o,c,d;jt(r,nr,de=>n(27,o=de)),jt(r,Gs,de=>n(15,c=de)),jt(r,vf,de=>n(13,d=de));let h={type:"FeatureCollection",features:[]},a={type:"FeatureCollection",features:[]},_=null,S=!1,k=!1,y=!1,C=!0,E=Object.fromEntries(Object.keys(Gl).map(de=>[de,!0])),T=!0,L=dr(),R=!1,N="",z=dr();async function V(de){n(11,N="Recalculating model"),await Ro();try{n(0,h=JSON.parse(o.getNodes())),n(1,a=JSON.parse(o.getWays()))}finally{n(11,N="")}if(_){let ye=_.id;n(2,_=a.features.find(Ie=>Ie.id==ye))}}function Q(de,ye,Ie,Me){let ot=[];return y&&ot.push(["any",["in",["get","kind"],["literal",["Sidewalk","Crossing","Other"]]],["get","is_severance"]]),C||ot.push(["!",["get","is_service"]]),k&&ot.push(["get","modified"]),ot.push(["in",["get","kind"],["literal",Object.entries(E).filter(We=>We[1]).map(We=>We[0])]]),["all",...ot]}function oe(de){_=de,n(2,_)}function ee(de){L=de,n(9,L)}function ne(de){d=de,vf.set(d)}function j(de){S=de,n(3,S)}function U(de){k=de,n(4,k)}function X(de){y=de,n(5,y)}function B(de){C=de,n(6,C)}function W(de){R=de,n(10,R)}function ce(de){E=de,n(7,E)}function pe(de){z=de,n(12,z)}function be(de){T=de,n(8,T)}return r.$$.update=()=>{r.$$.dirty[0]&32768&&V()},[h,a,_,S,k,y,C,E,T,L,R,N,z,d,Q,c,oe,ee,ne,j,U,X,B,W,ce,pe,be]}class LE extends ci{constructor(e){super(),li(this,e,PE,ME,$t,{},null,[-1,-1])}}function Vy(r){var n;const e=((n=r[4])==null?void 0:n.properties)??{};r[17]=e}function qy(r,e,n){const o=r.slice();return o[18]=e[n][0],o[19]=e[n][1],o}function zE(r){let e;return{c(){e=vt("Only junctions on major roads")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function OE(r){let e,n,o,c,d;return{c(){e=vt("Ignore "),n=ke("code"),n.textContent="service",o=vt(`
      ,
      `),c=ke("code"),c.textContent="track",d=vt(`
      roads`)},m(h,a){we(h,e,a),we(h,n,a),we(h,o,a),we(h,c,a),we(h,d,a)},p:Ut,d(h){h&&(ve(e),ve(n),ve(o),ve(c),ve(d))}}}function DE(r){let e;return{c(){e=vt("Ignore cycleways")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function Zy(r){let e,n,o=r[9].features.length-r[6]+"",c,d,h,a,_,S=r[8]==1?"crossing":"crossings",k,y,C=r[6]>0&&Wy(r),E=r[7]>0&&Gy(r);return{c(){e=ke("p"),n=vt("Junction has "),c=vt(o),d=vt(` arms
        `),C&&C.c(),h=vt(`,
        `),a=vt(r[8]),_=qe(),k=vt(S),y=qe(),E&&E.c(),fe(e,"class","mt-3 mb-3")},m(T,L){we(T,e,L),he(e,n),he(e,c),he(e,d),C&&C.m(e,null),he(e,h),he(e,a),he(e,_),he(e,k),he(e,y),E&&E.m(e,null)},p(T,L){L&576&&o!==(o=T[9].features.length-T[6]+"")&&vi(c,o),T[6]>0?C?C.p(T,L):(C=Wy(T),C.c(),C.m(e,h)):C&&(C.d(1),C=null),L&256&&vi(a,T[8]),L&256&&S!==(S=T[8]==1?"crossing":"crossings")&&vi(k,S),T[7]>0?E?E.p(T,L):(E=Gy(T),E.c(),E.m(e,null)):E&&(E.d(1),E=null)},d(T){T&&ve(e),C&&C.d(),E&&E.d()}}}function Wy(r){let e,n,o,c=r[6]==1?"split":"splits",d,h;return{c(){e=vt("("),n=vt(r[6]),o=vt(" dual carriageway "),d=vt(c),h=vt(`)
        `)},m(a,_){we(a,e,_),we(a,n,_),we(a,o,_),we(a,d,_),we(a,h,_)},p(a,_){_&64&&vi(n,a[6]),_&64&&c!==(c=a[6]==1?"split":"splits")&&vi(d,c)},d(a){a&&(ve(e),ve(n),ve(o),ve(d),ve(h))}}}function Gy(r){let e,n,o,c=r[7]==1?"non-crossing":"non-crossings",d;return{c(){e=vt(", "),n=vt(r[7]),o=vt(" explicit "),d=vt(c)},m(h,a){we(h,e,a),we(h,n,a),we(h,o,a),we(h,d,a)},p(h,a){a&128&&vi(n,h[7]),a&128&&c!==(c=h[7]==1?"non-crossing":"non-crossings")&&vi(d,c)},d(h){h&&(ve(e),ve(n),ve(o),ve(d))}}}function FE(r){let e,n,o,c,d=r[10].toLocaleString()+"",h,a,_=r[4].features.length.toLocaleString()+"",S,k,y,C,E,T,L,R,N,z,V,Q,oe,ee,ne,j,U,X;function B(Ie){r[14](Ie)}let W={$$slots:{default:[zE]},$$scope:{ctx:r}};r[0].only_major_roads!==void 0&&(W.checked=r[0].only_major_roads),C=new mr({props:W}),gi.push(()=>Zi(C,"checked",B));function ce(Ie){r[15](Ie)}let pe={$$slots:{default:[OE]},$$scope:{ctx:r}};r[0].ignore_utility_roads!==void 0&&(pe.checked=r[0].ignore_utility_roads),L=new mr({props:pe}),gi.push(()=>Zi(L,"checked",ce));function be(Ie){r[16](Ie)}let de={$$slots:{default:[DE]},$$scope:{ctx:r}};r[0].ignore_cycleways!==void 0&&(de.checked=r[0].ignore_cycleways),z=new mr({props:de}),gi.push(()=>Zi(z,"checked",be)),ee=new Cp({props:{labelColors:r[11],itemsPerRow:1}});let ye=r[1]&&Zy(r);return U=new If({}),{c(){e=ke("div"),n=ke("h4"),n.textContent="Crossings audit (experimental)",o=qe(),c=ke("p"),h=vt(d),a=vt(" / "),S=vt(_),k=vt(`
      junctions have all possible crossings mapped`),y=qe(),ht(C.$$.fragment),T=qe(),ht(L.$$.fragment),N=qe(),ht(z.$$.fragment),Q=qe(),oe=ke("div"),ht(ee.$$.fragment),ne=qe(),ye&&ye.c(),j=qe(),ht(U.$$.fragment),fe(oe,"class","card card-body"),fe(e,"slot","sidebar")},m(Ie,Me){we(Ie,e,Me),he(e,n),he(e,o),he(e,c),he(c,h),he(c,a),he(c,S),he(c,k),he(e,y),ct(C,e,null),he(e,T),ct(L,e,null),he(e,N),ct(z,e,null),he(e,Q),he(e,oe),ct(ee,oe,null),he(e,ne),ye&&ye.m(e,null),he(e,j),ct(U,e,null),X=!0},p(Ie,Me){(!X||Me&1024)&&d!==(d=Ie[10].toLocaleString()+"")&&vi(h,d),(!X||Me&16)&&_!==(_=Ie[4].features.length.toLocaleString()+"")&&vi(S,_);const ot={};Me&4194304&&(ot.$$scope={dirty:Me,ctx:Ie}),!E&&Me&1&&(E=!0,ot.checked=Ie[0].only_major_roads,qi(()=>E=!1)),C.$set(ot);const We={};Me&4194304&&(We.$$scope={dirty:Me,ctx:Ie}),!R&&Me&1&&(R=!0,We.checked=Ie[0].ignore_utility_roads,qi(()=>R=!1)),L.$set(We);const pt={};Me&4194304&&(pt.$$scope={dirty:Me,ctx:Ie}),!V&&Me&1&&(V=!0,pt.checked=Ie[0].ignore_cycleways,qi(()=>V=!1)),z.$set(pt),Ie[1]?ye?ye.p(Ie,Me):(ye=Zy(Ie),ye.c(),ye.m(e,j)):ye&&(ye.d(1),ye=null)},i(Ie){X||(Le(C.$$.fragment,Ie),Le(L.$$.fragment,Ie),Le(z.$$.fragment,Ie),Le(ee.$$.fragment,Ie),Le(U.$$.fragment,Ie),X=!0)},o(Ie){Be(C.$$.fragment,Ie),Be(L.$$.fragment,Ie),Be(z.$$.fragment,Ie),Be(ee.$$.fragment,Ie),Be(U.$$.fragment,Ie),X=!1},d(Ie){Ie&&ve(e),ut(C),ut(L),ut(z),ut(ee),ye&&ye.d(),ut(U)}}}function RE(r){let e,n,o;function c(h){r[13](h)}let d={manageHoverState:!0,paint:{"circle-radius":15,"circle-color":["case",["get","complete"],r[11]["Fully mapped junction"],r[11]["Junction to audit"]],"circle-opacity":mh(.5,1),"circle-stroke-color":"black","circle-stroke-width":3}};return r[1]!==void 0&&(d.hovered=r[1]),e=new Wl({props:d}),gi.push(()=>Zi(e,"hovered",c)),{c(){ht(e.$$.fragment)},m(h,a){ct(e,h,a),o=!0},p(h,a){const _={};!n&&a&2&&(n=!0,_.hovered=h[1],qi(()=>n=!1)),e.$set(_)},i(h){o||(Le(e.$$.fragment,h),o=!0)},o(h){Be(e.$$.fragment,h),o=!1},d(h){ut(e,h)}}}function BE(r){let e,n;return e=new ga({props:{paint:{"line-width":6,"line-color":"blue"}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p:Ut,i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function Hy(r){let e,n,o=r[18]+"",c,d,h,a=r[19]+"",_,S;return{c(){e=ke("tr"),n=ke("td"),c=vt(o),d=qe(),h=ke("td"),_=vt(a),S=qe()},m(k,y){we(k,e,y),he(e,n),he(n,c),he(e,d),he(e,h),he(h,_),he(e,S)},p(k,y){y&16&&o!==(o=k[18]+"")&&vi(c,o),y&16&&a!==(a=k[19]+"")&&vi(_,a)},d(k){k&&ve(e)}}}function NE(r){Vy(r);let e,n,o=r[17].id+"",c,d,h,a,_=Ri(Object.entries(JSON.parse(r[17].tags||"{}"))),S=[];for(let k=0;k<_.length;k+=1)S[k]=Hy(qy(r,_,k));return{c(){e=ke("h4"),n=vt("Node "),c=vt(o),d=qe(),h=ke("table"),a=ke("tbody");for(let k=0;k<S.length;k+=1)S[k].c();fe(h,"class","table table-bordered")},m(k,y){we(k,e,y),he(e,n),he(e,c),we(k,d,y),we(k,h,y),he(h,a);for(let C=0;C<S.length;C+=1)S[C]&&S[C].m(a,null)},p(k,y){if(Vy(k),y&16&&o!==(o=k[17].id+"")&&vi(c,o),y&16){_=Ri(Object.entries(JSON.parse(k[17].tags||"{}")));let C;for(C=0;C<_.length;C+=1){const E=qy(k,_,C);S[C]?S[C].p(E,y):(S[C]=Hy(E),S[C].c(),S[C].m(a,null))}for(;C<S.length;C+=1)S[C].d(1);S.length=_.length}},d(k){k&&(ve(e),ve(d),ve(h)),Qn(S,k)}}}function jE(r){let e,n;return e=new Sp({props:{openOn:"hover",$$slots:{default:[NE,({data:o})=>({4:o}),({data:o})=>o?16:0]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&4194320&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function UE(r){let e,n;return e=new Wl({props:{manageHoverState:!0,paint:{"circle-radius":7,"circle-color":["case",["get","is_explicit_crossing_no"],r[11]["crossing=no"],r[11].Crossing],"circle-opacity":mh(.3,1),"circle-stroke-color":"black","circle-stroke-width":1},$$slots:{default:[jE]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&4194320&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function VE(r){let e,n;return e=new Wl({props:{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"red","circle-stroke-width":3}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p:Ut,i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function qE(r){let e,n;return e=new Wl({props:{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"purple","circle-stroke-width":3}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p:Ut,i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function ZE(r){let e,n,o,c,d,h,a,_,S,k,y;return n=new Er({props:{data:r[4],generateId:!0,$$slots:{default:[RE]},$$scope:{ctx:r}}}),c=new Er({props:{data:r[9],$$slots:{default:[BE]},$$scope:{ctx:r}}}),h=new Er({props:{data:r[5],generateId:!0,$$slots:{default:[UE]},$$scope:{ctx:r}}}),_=new Er({props:{data:r[3],$$slots:{default:[VE]},$$scope:{ctx:r}}}),k=new Er({props:{data:r[2],$$slots:{default:[qE]},$$scope:{ctx:r}}}),{c(){e=ke("div"),ht(n.$$.fragment),o=qe(),ht(c.$$.fragment),d=qe(),ht(h.$$.fragment),a=qe(),ht(_.$$.fragment),S=qe(),ht(k.$$.fragment),fe(e,"slot","map")},m(C,E){we(C,e,E),ct(n,e,null),he(e,o),ct(c,e,null),he(e,d),ct(h,e,null),he(e,a),ct(_,e,null),he(e,S),ct(k,e,null),y=!0},p(C,E){const T={};E&16&&(T.data=C[4]),E&4194306&&(T.$$scope={dirty:E,ctx:C}),n.$set(T);const L={};E&512&&(L.data=C[9]),E&4194304&&(L.$$scope={dirty:E,ctx:C}),c.$set(L);const R={};E&32&&(R.data=C[5]),E&4194320&&(R.$$scope={dirty:E,ctx:C}),h.$set(R);const N={};E&8&&(N.data=C[3]),E&4194304&&(N.$$scope={dirty:E,ctx:C}),_.$set(N);const z={};E&4&&(z.data=C[2]),E&4194304&&(z.$$scope={dirty:E,ctx:C}),k.$set(z)},i(C){y||(Le(n.$$.fragment,C),Le(c.$$.fragment,C),Le(h.$$.fragment,C),Le(_.$$.fragment,C),Le(k.$$.fragment,C),y=!0)},o(C){Be(n.$$.fragment,C),Be(c.$$.fragment,C),Be(h.$$.fragment,C),Be(_.$$.fragment,C),Be(k.$$.fragment,C),y=!1},d(C){C&&ve(e),ut(n),ut(c),ut(h),ut(_),ut(k)}}}function WE(r){let e,n;return e=new xh({props:{$$slots:{map:[ZE],sidebar:[FE]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,[c]){const d={};c&4196351&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function GE(r,e,n){let o,c,d,h,a,_,S,k,y;jt(r,nr,Q=>n(12,y=Q));let C={only_major_roads:!0,ignore_utility_roads:!0,ignore_cycleways:!0},E=null,T=JSON.parse(y.getNodes());T.features=T.features.filter(Q=>Q.properties.is_crossing||Q.properties.is_explicit_crossing_no);let L={"Junction to audit":"black","Fully mapped junction":"green",Crossing:"yellow","crossing=no":"purple"};function R(Q){E=Q,n(1,E)}function N(Q){r.$$.not_equal(C.only_major_roads,Q)&&(C.only_major_roads=Q,n(0,C))}function z(Q){r.$$.not_equal(C.ignore_utility_roads,Q)&&(C.ignore_utility_roads=Q,n(0,C))}function V(Q){r.$$.not_equal(C.ignore_cycleways,Q)&&(C.ignore_cycleways=Q,n(0,C))}return r.$$.update=()=>{r.$$.dirty&4097&&n(4,o=y?JSON.parse(y.auditCrossings(C)):dr()),r.$$.dirty&16&&n(10,c=o.features.filter(Q=>Q.properties.complete).length),r.$$.dirty&2&&n(9,d=E?JSON.parse(E.properties.arms):dr()),r.$$.dirty&2&&n(3,h=E?JSON.parse(E.properties.crossings):dr()),r.$$.dirty&2&&n(2,a=E?JSON.parse(E.properties.explicit_non_crossings):dr()),r.$$.dirty&8&&n(8,_=h.features.length),r.$$.dirty&4&&n(7,S=a.features.length),r.$$.dirty&2&&n(6,k=E?E.properties.number_dual_carriageway_splits:0)},[C,E,a,h,o,T,k,S,_,d,c,L,y,R,N,z,V]}class HE extends ci{constructor(e){super(),li(this,e,GE,WE,$t,{})}}function XE(r){let e;return{c(){e=vt("Ignore deadends under 10m")},m(n,o){we(n,e,o)},d(n){n&&ve(e)}}}function KE(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,L,R,N,z,V,Q,oe,ee,ne;function j(X){r[5](X)}let U={$$slots:{default:[XE]},$$scope:{ctx:r}};return r[0].ignore_deadends!==void 0&&(U.checked=r[0].ignore_deadends),z=new mr({props:U}),gi.push(()=>Zi(z,"checked",j)),oe=k1(r[2][0]),{c(){e=ke("div"),n=ke("div"),o=ke("div"),c=ke("label"),d=ke("input"),h=vt(`
        Everything`),a=qe(),_=ke("div"),S=ke("label"),k=ke("input"),y=vt(`
        Only footways`),C=qe(),E=ke("div"),T=ke("label"),L=ke("input"),R=vt(`
        Anything routeable for walking`),N=qe(),ht(z.$$.fragment),fe(d,"class","form-check-input"),fe(d,"type","radio"),d.__value="Everything",jr(d,d.__value),fe(c,"class","form-check-label"),fe(o,"class","form-check"),fe(k,"class","form-check-input"),fe(k,"type","radio"),k.__value="OnlyExplicitFootways",jr(k,k.__value),fe(S,"class","form-check-label"),fe(_,"class","form-check"),fe(L,"class","form-check-input"),fe(L,"type","radio"),L.__value="RouteableNetwork",jr(L,L.__value),fe(T,"class","form-check-label"),fe(E,"class","form-check mb-3"),fe(n,"class","card-body"),fe(e,"class","card"),oe.p(d,k,L)},m(X,B){we(X,e,B),he(e,n),he(n,o),he(o,c),he(c,d),d.checked=d.__value===r[0].include,he(c,h),he(n,a),he(n,_),he(_,S),he(S,k),k.checked=k.__value===r[0].include,he(S,y),he(n,C),he(n,E),he(E,T),he(T,L),L.checked=L.__value===r[0].include,he(T,R),he(n,N),ct(z,n,null),Q=!0,ee||(ne=[Zt(d,"change",r[1]),Zt(k,"change",r[3]),Zt(L,"change",r[4])],ee=!0)},p(X,[B]){B&1&&(d.checked=d.__value===X[0].include),B&1&&(k.checked=k.__value===X[0].include),B&1&&(L.checked=L.__value===X[0].include);const W={};B&64&&(W.$$scope={dirty:B,ctx:X}),!V&&B&1&&(V=!0,W.checked=X[0].ignore_deadends,qi(()=>V=!1)),z.$set(W)},i(X){Q||(Le(z.$$.fragment,X),Q=!0)},o(X){Be(z.$$.fragment,X),Q=!1},d(X){X&&ve(e),ut(z),oe.r(),ee=!1,Gn(ne)}}}function JE(r,e,n){let o;jt(r,Bl,S=>n(0,o=S));const c=[[]];function d(){o.include=this.__value,Bl.set(o)}function h(){o.include=this.__value,Bl.set(o)}function a(){o.include=this.__value,Bl.set(o)}function _(S){r.$$.not_equal(o.ignore_deadends,S)&&(o.ignore_deadends=S,Bl.set(o))}return[o,d,c,h,a,_]}class kb extends ci{constructor(e){super(),li(this,e,JE,KE,$t,{})}}function Xy(r,e,n){const o=r.slice();return o[11]=e[n],o[13]=n,o}function Ky(r){let e,n,o=tu(r[11])+"",c,d,h,a;function _(){return r[9](r[13])}return{c(){e=ke("li"),n=ke("a"),c=vt(o),d=qe(),fe(n,"href","#"),en(n,"color",r[3][r[13]%r[3].length])},m(S,k){we(S,e,k),he(e,n),he(n,c),he(e,d),h||(a=Zt(n,"click",ip(_)),h=!0)},p(S,k){r=S,k&2&&o!==(o=tu(r[11])+"")&&vi(c,o)},d(S){S&&ve(e),h=!1,a()}}}function YE(r){let e,n,o,c,d,h,a,_,S,k,y;h=new kb({});let C=Ri(r[1].component_lengths),E=[];for(let T=0;T<C.length;T+=1)E[T]=Ky(Xy(r,C,T));return k=new If({}),{c(){e=ke("div"),n=ke("h4"),n.textContent="Network disconnections",o=qe(),c=ke("p"),c.textContent="This shows where the network is disconnected. Click a piece to see it.",d=qe(),ht(h.$$.fragment),a=qe(),_=ke("ul");for(let T=0;T<E.length;T+=1)E[T].c();S=qe(),ht(k.$$.fragment),fe(e,"slot","sidebar")},m(T,L){we(T,e,L),he(e,n),he(e,o),he(e,c),he(e,d),ct(h,e,null),he(e,a),he(e,_);for(let R=0;R<E.length;R+=1)E[R]&&E[R].m(_,null);he(e,S),ct(k,e,null),y=!0},p(T,L){if(L&15){C=Ri(T[1].component_lengths);let R;for(R=0;R<C.length;R+=1){const N=Xy(T,C,R);E[R]?E[R].p(N,L):(E[R]=Ky(N),E[R].c(),E[R].m(_,null))}for(;R<E.length;R+=1)E[R].d(1);E.length=C.length}},i(T){y||(Le(h.$$.fragment,T),Le(k.$$.fragment,T),y=!0)},o(T){Be(h.$$.fragment,T),Be(k.$$.fragment,T),y=!1},d(T){T&&ve(e),ut(h),Qn(E,T),ut(k)}}}function QE(r){let e,n;return e=new ga({props:{id:"disconnections",paint:{"line-width":mh(5,10),"line-color":r[4](r[0])},manageHoverState:!0,hoverCursor:"pointer"}}),e.$on("click",r[5]),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&1&&(d.paint={"line-width":mh(5,10),"line-color":o[4](o[0])}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function $E(r){let e,n,o,c,d;return n=new pb({}),n.$on("click",r[6]),c=new Er({props:{data:r[1],generateId:!0,$$slots:{default:[QE]},$$scope:{ctx:r}}}),{c(){e=ke("div"),ht(n.$$.fragment),o=qe(),ht(c.$$.fragment),fe(e,"slot","map")},m(h,a){we(h,e,a),ct(n,e,null),he(e,o),ct(c,e,null),d=!0},p(h,a){const _={};a&2&&(_.data=h[1]),a&16385&&(_.$$scope={dirty:a,ctx:h}),c.$set(_)},i(h){d||(Le(n.$$.fragment,h),Le(c.$$.fragment,h),d=!0)},o(h){Be(n.$$.fragment,h),Be(c.$$.fragment,h),d=!1},d(h){h&&ve(e),ut(n),ut(c)}}}function e3(r){let e,n;return e=new xh({props:{$$slots:{map:[$E],sidebar:[YE]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,[c]){const d={};c&16391&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function t3(r,e,n){let o,c,d,h;jt(r,ol,T=>n(2,c=T)),jt(r,Bl,T=>n(7,d=T)),jt(r,nr,T=>n(8,h=T));let a=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],_=gh(["to-string",["%",["get","component"],a.length]],Object.fromEntries(a.map((T,L)=>[L.toString(),T])),"black"),S=null;function k(T){return T==null?_:["case",["==",["get","component"],T],_,"black"]}function y(T){n(0,S=T.detail.features[0].properties.component)}function C(T){c.queryRenderedFeatures(T.detail.point,{layers:["disconnections"]}).length==0&&n(0,S=null)}const E=T=>{c==null||c.fitBounds(o.component_bboxes[T]),n(0,S=T)};return r.$$.update=()=>{r.$$.dirty&384&&n(1,o=h?JSON.parse(h.findConnectedComponents(d)):{...dr(),component_lengths:[]})},[S,o,c,a,k,y,C,d,h,E]}class i3 extends ci{constructor(e){super(),li(this,e,t3,e3,$t,{})}}function Jy(r,e,n){const o=r.slice();return o[5]=e[n][0],o[6]=e[n][1],o}function n3(r){let e;return{c(){e=ke("div"),e.textContent="Details",fe(e,"slot","header")},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function r3(r){let e;return{c(){e=ke("div"),e.innerHTML=`<p>The output will have a LineString for each edge in the network. An
          edge goes between exactly two graph nodes, so one OSM way usually
          becomes many edges. Each LineString will have these properties:</p> <ul><li><b>node1</b>
            : The OSM node ID of the beginning of the edge. This is safer to use
            to form a graph than the first coordinate.</li> <li><b>node2</b>
            : The OSM node ID of the end of the edge. This is safer to use to form
            a graph than the last coordinate.</li> <li><b>way</b>
            : The OSM way ID where this edge comes from.</li> <li><b>kind</b>
            : Speedwalk&#39;s classification of this edge</li> <li>Each tag from the OSM way will appear as a key and value</li></ul> <p>Note OSM IDs will be negative if you have run bulk operations and
          generated synthetic sidewalks or crossings.</p>`,fe(e,"slot","body")},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function s3(r){let e;return{c(){e=ke("div"),e.textContent="Legend",fe(e,"slot","header")},m(n,o){we(n,e,o)},p:Ut,d(n){n&&ve(e)}}}function o3(r){let e,n,o;return n=new Cp({props:{labelColors:Gl,itemsPerRow:1}}),{c(){e=ke("div"),ht(n.$$.fragment),fe(e,"slot","body")},m(c,d){we(c,e,d),ct(n,e,null),o=!0},p:Ut,i(c){o||(Le(n.$$.fragment,c),o=!0)},o(c){Be(n.$$.fragment,c),o=!1},d(c){c&&ve(e),ut(n)}}}function a3(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,L,R,N;return h=new kb({}),k=new iu({props:{open:!1,$$slots:{body:[r3],header:[n3]},$$scope:{ctx:r}}}),C=new iu({props:{$$slots:{body:[o3],header:[s3]},$$scope:{ctx:r}}}),T=new If({}),{c(){e=ke("div"),n=ke("h4"),n.textContent="Export network",o=qe(),c=ke("p"),c.textContent="You can export the routeable walking network as a GeoJSON file.",d=qe(),ht(h.$$.fragment),a=qe(),_=ke("button"),_.textContent="Download GeoJSON",S=qe(),ht(k.$$.fragment),y=qe(),ht(C.$$.fragment),E=qe(),ht(T.$$.fragment),fe(_,"class","btn btn-primary mt-3 mb-3"),fe(e,"slot","sidebar")},m(z,V){we(z,e,V),he(e,n),he(e,o),he(e,c),he(e,d),ct(h,e,null),he(e,a),he(e,_),he(e,S),ct(k,e,null),he(e,y),ct(C,e,null),he(e,E),ct(T,e,null),L=!0,R||(N=Zt(_,"click",r[1]),R=!0)},p(z,V){const Q={};V&512&&(Q.$$scope={dirty:V,ctx:z}),k.$set(Q);const oe={};V&512&&(oe.$$scope={dirty:V,ctx:z}),C.$set(oe)},i(z){L||(Le(h.$$.fragment,z),Le(k.$$.fragment,z),Le(C.$$.fragment,z),Le(T.$$.fragment,z),L=!0)},o(z){Be(h.$$.fragment,z),Be(k.$$.fragment,z),Be(C.$$.fragment,z),Be(T.$$.fragment,z),L=!1},d(z){z&&ve(e),ut(h),ut(k),ut(C),ut(T),R=!1,N()}}}function Yy(r){let e,n,o=r[5]+"",c,d,h,a=r[6]+"",_,S;return{c(){e=ke("tr"),n=ke("td"),c=vt(o),d=qe(),h=ke("td"),_=vt(a),S=qe()},m(k,y){we(k,e,y),he(e,n),he(n,c),he(e,d),he(e,h),he(h,_),he(e,S)},p(k,y){y&16&&o!==(o=k[5]+"")&&vi(c,o),y&16&&a!==(a=k[6]+"")&&vi(_,a)},d(k){k&&ve(e)}}}function l3(r){let e,n,o=Ri(Object.entries(Wc(Wc(r[4]).properties))),c=[];for(let d=0;d<o.length;d+=1)c[d]=Yy(Jy(r,o,d));return{c(){e=ke("table"),n=ke("tbody");for(let d=0;d<c.length;d+=1)c[d].c();fe(e,"class","table table-bordered")},m(d,h){we(d,e,h),he(e,n);for(let a=0;a<c.length;a+=1)c[a]&&c[a].m(n,null)},p(d,h){if(h&16){o=Ri(Object.entries(Wc(Wc(d[4]).properties)));let a;for(a=0;a<o.length;a+=1){const _=Jy(d,o,a);c[a]?c[a].p(_,h):(c[a]=Yy(_),c[a].c(),c[a].m(n,null))}for(;a<c.length;a+=1)c[a].d(1);c.length=o.length}},d(d){d&&ve(e),Qn(c,d)}}}function c3(r){let e,n;return e=new Sp({props:{openOn:"hover",$$slots:{default:[l3,({data:o})=>({4:o}),({data:o})=>o?16:0]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&528&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function u3(r){let e,n;return e=new ga({props:{manageHoverState:!0,paint:{"line-width":fa(0),"line-color":gh(["get","kind"],Gl,"cyan"),"line-opacity":mh(1,.5)},$$slots:{default:[c3]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,c){const d={};c&512&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function h3(r){let e,n,o;return n=new Er({props:{data:r[0],generateId:!0,$$slots:{default:[u3]},$$scope:{ctx:r}}}),{c(){e=ke("div"),ht(n.$$.fragment),fe(e,"slot","map")},m(c,d){we(c,e,d),ct(n,e,null),o=!0},p(c,d){const h={};d&1&&(h.data=c[0]),d&512&&(h.$$scope={dirty:d,ctx:c}),n.$set(h)},i(c){o||(Le(n.$$.fragment,c),o=!0)},o(c){Be(n.$$.fragment,c),o=!1},d(c){c&&ve(e),ut(n)}}}function f3(r){let e,n;return e=new xh({props:{$$slots:{map:[h3],sidebar:[a3]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,[c]){const d={};c&513&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function d3(r,e,n){let o,c,d;jt(r,Bl,a=>n(2,c=a)),jt(r,nr,a=>n(3,d=a));function h(){Ep("network.geojson",JSON.stringify(o))}return r.$$.update=()=>{r.$$.dirty&12&&n(0,o=d?JSON.parse(d.exportNetwork(c)):dr())},[o,h,c,d]}class p3 extends ci{constructor(e){super(),li(this,e,d3,f3,$t,{})}}function m3(r){let e,n;return e=new lS({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p:Ut,i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function g3(r){let e,n;return e=new Er({props:{data:r[0],$$slots:{default:[m3]},$$scope:{ctx:r}}}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p(o,[c]){const d={};c&8&&(d.$$scope={dirty:c,ctx:o}),e.$set(d)},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function _3(r,e,n){let o;jt(r,nr,h=>n(1,o=h));let c=JSON.parse(o.getBoundary());return[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],c.geometry.coordinates[0]]}}]}class y3 extends ci{constructor(e){super(),li(this,e,_3,g3,$t,{})}}function b3(r){let e,n,o;return{c(){e=ke("button"),e.textContent="Login to OSM",fe(e,"class","btn btn-primary")},m(c,d){we(c,e,d),n||(o=Zt(e,"click",r[1]),n=!0)},p:Ut,d(c){c&&ve(e),n=!1,o()}}}function v3(r){let e,n,o,c=r[0].name+"",d,h,a,_,S,k,y,C=r[0].avatarUrl&&Qy(r);return{c(){e=ke("div"),n=ke("button"),C&&C.c(),o=qe(),d=vt(c),h=qe(),a=ke("ul"),_=ke("li"),S=ke("a"),S.textContent="Logout",fe(n,"class","btn btn-outline-secondary dropdown-toggle"),fe(n,"data-bs-toggle","dropdown"),fe(n,"aria-expanded","false"),fe(S,"class","dropdown-item"),fe(S,"href","#"),fe(a,"class","dropdown-menu"),fe(e,"class","nav-item dropdown")},m(E,T){we(E,e,T),he(e,n),C&&C.m(n,null),he(n,o),he(n,d),he(e,h),he(e,a),he(a,_),he(_,S),k||(y=Zt(S,"click",r[2]),k=!0)},p(E,T){E[0].avatarUrl?C?C.p(E,T):(C=Qy(E),C.c(),C.m(n,o)):C&&(C.d(1),C=null),T&1&&c!==(c=E[0].name+"")&&vi(d,c)},d(E){E&&ve(e),C&&C.d(),k=!1,y()}}}function Qy(r){let e,n;return{c(){e=ke("img"),Wn(e.src,n=r[0].avatarUrl)||fe(e,"src",n),fe(e,"alt","OSM avatar"),fe(e,"height","30")},m(o,c){we(o,e,c)},p(o,c){c&1&&!Wn(e.src,n=o[0].avatarUrl)&&fe(e,"src",n)},d(o){o&&ve(e)}}}function w3(r){let e;function n(d,h){return d[0]?v3:b3}let o=n(r),c=o(r);return{c(){c.c(),e=Mn()},m(d,h){c.m(d,h),we(d,e,h)},p(d,[h]){o===(o=n(d))&&c?c.p(d,h):(c.d(1),c=o(d),c&&(c.c(),c.m(e.parentNode,e)))},i:Ut,o:Ut,d(d){d&&ve(e),c.d(d)}}}function x3(r,e,n){let o;jt(r,uh,a=>n(0,o=a)),np(c);async function c(){var a;if(nh.isLoggedIn()){let _=await nh.getUser("me");tn(uh,o={name:_.display_name,uid:_.id,avatarUrl:((a=_.img)==null?void 0:a.href)||""},o)}}async function d(){try{await nh.login({mode:"popup",clientId:"vyCV0t-IiskqNBgpiHvuSAmf2nC8K-zfByeFL6XtAzc",redirectUrl:`${window.location.origin}/speedwalk/land.html`,scopes:["read_prefs","write_api"]}),await c()}catch(a){window.alert(`Login failed: ${a}`)}}async function h(){tn(uh,o=void 0,o),await nh.logout()}return[o,d,h]}class k3 extends ci{constructor(e){super(),li(this,e,x3,w3,$t,{})}}const S3="/speedwalk/assets/logo-3MjkCCFo.svg";function $y(r,e,n){const o=r.slice();return o[8]=e[n][0],o[9]=e[n][1],o}function e0(r){let e,n=Ri(r[3]),o=[];for(let c=0;c<n.length;c+=1)o[c]=t0($y(r,n,c));return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=Mn()},m(c,d){for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(c,d);we(c,e,d)},p(c,d){if(d&12){n=Ri(c[3]);let h;for(h=0;h<n.length;h+=1){const a=$y(c,n,h);o[h]?o[h].p(a,d):(o[h]=t0(a),o[h].c(),o[h].m(e.parentNode,e))}for(;h<o.length;h+=1)o[h].d(1);o.length=n.length}},d(c){c&&ve(e),Qn(o,c)}}}function t0(r){let e,n,o,c,d;function h(){return r[4](r[8])}return{c(){e=ke("li"),n=ke("a"),n.textContent=`${r[9]}`,o=qe(),fe(n,"class","nav-link"),fe(n,"href","#"),pr(n,"active",JSON.stringify(r[2])==JSON.stringify(r[8])),fe(e,"class","nav-item")},m(a,_){we(a,e,_),he(e,n),he(e,o),c||(d=Zt(n,"click",h),c=!0)},p(a,_){r=a,_&12&&pr(n,"active",JSON.stringify(r[2])==JSON.stringify(r[8]))},d(a){a&&ve(e),c=!1,d()}}}function T3(r){let e,n,o,c,d,h,a,_,S;return{c(){e=ke("h1"),e.textContent="Welcome to Speedwalk",n=qe(),o=ke("p"),o.innerHTML=`This tool helps you quickly assess how sidewalks are mapped in OSM. You can
    find and fix common tagging problems. The tool assumes you understand the
    correct <a href="https://wiki.openstreetmap.org/wiki/Sidewalks" target="_blank">sidewalk mapping conventions</a>
    . If you are unsure about some edits you make, you can download the changeset
    file and check in JOSM, rather than uploading directly.`,c=qe(),d=ke("p"),d.innerHTML=`This is an <a href="https://github.com/a-b-street/speedwalk" target="_blank">open source project</a>
    developed without funding by
    <a href="https://abstreet.uk" target="_blank">A/B Street Ltd</a>
    . Please file a Github issue or contact
    <a href="mailto:dustin@abstreet.uk" target="_blank">dustin@abstreet.uk</a>
    with feedback.
    <b>This is an alpha tool; there will be problems!</b>`,h=qe(),a=ke("button"),a.textContent="Start",fe(a,"class","btn btn-primary")},m(k,y){we(k,e,y),we(k,n,y),we(k,o,y),we(k,c,y),we(k,d,y),we(k,h,y),we(k,a,y),_||(S=Zt(a,"click",r[6]),_=!0)},p:Ut,d(k){k&&(ve(e),ve(n),ve(o),ve(c),ve(d),ve(h),ve(a)),_=!1,S()}}}function C3(r){let e,n,o,c,d,h,a,_,S,k,y,C,E,T,L,R,N,z=r[1]&&e0(r);y=new k3({});function V(oe){r[7](oe)}let Q={$$slots:{default:[T3]},$$scope:{ctx:r}};return r[0]!==void 0&&(Q.show=r[0]),E=new Tp({props:Q}),gi.push(()=>Zi(E,"show",V)),{c(){e=ke("ul"),n=ke("img"),c=qe(),d=ke("h3"),d.textContent="Speedwalk",h=qe(),z&&z.c(),a=qe(),_=ke("li"),S=ke("a"),S.innerHTML=`<i class="fa-solid fa-circle-info"></i>
      About`,k=qe(),ht(y.$$.fragment),C=qe(),ht(E.$$.fragment),Wn(n.src,o=S3)||fe(n,"src",o),en(n,"height","30px"),fe(n,"alt","A/B Street logo"),fe(S,"class","nav-link"),fe(S,"href","#"),fe(_,"class","nav-item ms-auto"),fe(e,"class","nav nav-underline")},m(oe,ee){we(oe,e,ee),he(e,n),he(e,c),he(e,d),he(e,h),z&&z.m(e,null),he(e,a),he(e,_),he(_,S),he(e,k),ct(y,e,null),we(oe,C,ee),ct(E,oe,ee),L=!0,R||(N=Zt(S,"click",r[5]),R=!0)},p(oe,[ee]){oe[1]?z?z.p(oe,ee):(z=e0(oe),z.c(),z.m(e,a)):z&&(z.d(1),z=null);const ne={};ee&4097&&(ne.$$scope={dirty:ee,ctx:oe}),!T&&ee&1&&(T=!0,ne.show=oe[0],qi(()=>T=!1)),E.$set(ne)},i(oe){L||(Le(y.$$.fragment,oe),Le(E.$$.fragment,oe),L=!0)},o(oe){Be(y.$$.fragment,oe),Be(E.$$.fragment,oe),L=!1},d(oe){oe&&(ve(e),ve(C)),z&&z.d(),ut(y),ut(E,oe),R=!1,N()}}}function E3(r,e,n){let o,c;jt(r,nr,y=>n(1,o=y)),jt(r,ep,y=>n(2,c=y));let d=!1,h=[[{kind:"sidewalks"},"Sidewalks"],[{kind:"crossings"},"Crossings"],[{kind:"disconnections"},"Network disconnections"],[{kind:"export"},"Export"]];const a=y=>tn(ep,c=y,c),_=()=>n(0,d=!0),S=()=>n(0,d=!1);function k(y){d=y,n(0,d)}return[d,o,c,h,a,_,S,k]}class I3 extends ci{constructor(e){super(),li(this,e,E3,C3,$t,{})}}function A3(r){let e,n,o;return n=new I3({}),{c(){e=ke("div"),ht(n.$$.fragment),fe(e,"slot","top")},m(c,d){we(c,e,d),ct(n,e,null),o=!0},p:Ut,i(c){o||(Le(n.$$.fragment,c),o=!0)},o(c){Be(n.$$.fragment,c),o=!1},d(c){c&&ve(e),ut(n)}}}function i0(r){let e;return{c(){e=ke("div")},m(n,o){we(n,e,o),r[13](e)},p:Ut,d(n){n&&ve(e),r[13](null)}}}function M3(r){let e,n=r[0]&&i0(r);return{c(){e=ke("div"),n&&n.c(),fe(e,"class","p-3"),fe(e,"slot","left")},m(o,c){we(o,e,c),n&&n.m(e,null)},p(o,c){o[0]?n?n.p(o,c):(n=i0(o),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(o){o&&ve(e),n&&n.d()}}}function n0(r){let e,n,o,c,d,h;const a=[L3,P3],_=[];function S(k,y){return k[5]?0:1}return o=S(r),c=_[o]=a[o](r),{c(){e=ke("div"),n=qe(),c.c(),d=Mn()},m(k,y){we(k,e,y),r[10](e),we(k,n,y),_[o].m(k,y),we(k,d,y),h=!0},p(k,y){let C=o;o=S(k),o===C?_[o].p(k,y):(an(),Be(_[C],1,1,()=>{_[C]=null}),ln(),c=_[o],c?c.p(k,y):(c=_[o]=a[o](k),c.c()),Le(c,1),c.m(d.parentNode,d))},i(k){h||(Le(c),h=!0)},o(k){Be(c),h=!1},d(k){k&&(ve(e),ve(n),ve(d)),r[10](null),_[o].d(k)}}}function P3(r){let e,n;return e=new dT({}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},p:Ut,i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function L3(r){let e,n,o=r[6],c,d;e=new y3({});let h=r0(r);return{c(){ht(e.$$.fragment),n=qe(),h.c(),c=Mn()},m(a,_){ct(e,a,_),we(a,n,_),h.m(a,_),we(a,c,_),d=!0},p(a,_){_&64&&$t(o,o=a[6])?(an(),Be(h,1,1,Ut),ln(),h=r0(a),h.c(),Le(h,1),h.m(c.parentNode,c)):h.p(a,_)},i(a){d||(Le(e.$$.fragment,a),Le(h),d=!0)},o(a){Be(e.$$.fragment,a),Be(h),d=!1},d(a){a&&(ve(n),ve(c)),ut(e,a),h.d(a)}}}function z3(r){let e,n;return e=new p3({}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function O3(r){let e,n;return e=new i3({}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function D3(r){let e,n;return e=new HE({}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function F3(r){let e,n;return e=new LE({}),{c(){ht(e.$$.fragment)},m(o,c){ct(e,o,c),n=!0},i(o){n||(Le(e.$$.fragment,o),n=!0)},o(o){Be(e.$$.fragment,o),n=!1},d(o){ut(e,o)}}}function r0(r){let e,n,o,c;const d=[F3,D3,O3,z3],h=[];function a(_,S){return _[6].kind=="sidewalks"?0:_[6].kind=="crossings"?1:_[6].kind=="disconnections"?2:_[6].kind=="export"?3:-1}return~(e=a(r))&&(n=h[e]=d[e](r)),{c(){n&&n.c(),o=Mn()},m(_,S){~e&&h[e].m(_,S),we(_,o,S),c=!0},p(_,S){let k=e;e=a(_),e!==k&&(n&&(an(),Be(h[k],1,1,()=>{h[k]=null}),ln()),~e?(n=h[e],n||(n=h[e]=d[e](_),n.c()),Le(n,1),n.m(o.parentNode,o)):n=null)},i(_){c||(Le(n),c=!0)},o(_){Be(n),c=!1},d(_){_&&ve(o),~e&&h[e].d(_)}}}function R3(r){let e,n,o,c,d,h,a,_,S;e=new BS({props:{map:r[0]}}),o=new Uk({props:{map:r[0],country:void 0,apiKey:"MZEJTanw3WpxRvt7qDfo"}});function k(E){r[9](E)}let y={};r[3]!==void 0&&(y.basemap=r[3]),d=new tC({props:y}),gi.push(()=>Zi(d,"basemap",k));let C=r[0]&&n0(r);return{c(){ht(e.$$.fragment),n=qe(),ht(o.$$.fragment),c=qe(),ht(d.$$.fragment),a=qe(),C&&C.c(),_=Mn()},m(E,T){ct(e,E,T),we(E,n,T),ct(o,E,T),we(E,c,T),ct(d,E,T),we(E,a,T),C&&C.m(E,T),we(E,_,T),S=!0},p(E,T){const L={};T&1&&(L.map=E[0]),e.$set(L);const R={};T&1&&(R.map=E[0]),o.$set(R);const N={};!h&&T&8&&(h=!0,N.basemap=E[3],qi(()=>h=!1)),d.$set(N),E[0]?C?(C.p(E,T),T&1&&Le(C,1)):(C=n0(E),C.c(),Le(C,1),C.m(_.parentNode,_)):C&&(an(),Be(C,1,1,()=>{C=null}),ln())},i(E){S||(Le(e.$$.fragment,E),Le(o.$$.fragment,E),Le(d.$$.fragment,E),Le(C),S=!0)},o(E){Be(e.$$.fragment,E),Be(o.$$.fragment,E),Be(d.$$.fragment,E),Be(C),S=!1},d(E){E&&(ve(n),ve(c),ve(a),ve(_)),ut(e,E),ut(o,E),ut(d,E),C&&C.d(E)}}}function B3(r){let e,n,o,c;function d(a){r[11](a)}let h={style:r[4][r[3]],hash:!0,images:[{id:"arrow",url:mT}],$$slots:{default:[R3]},$$scope:{ctx:r}};return r[0]!==void 0&&(h.map=r[0]),n=new AS({props:h}),gi.push(()=>Zi(n,"map",d)),n.$on("error",r[12]),{c(){e=ke("div"),ht(n.$$.fragment),fe(e,"slot","main"),en(e,"position","relative"),en(e,"width","100%"),en(e,"height","100vh")},m(a,_){we(a,e,_),ct(n,e,null),c=!0},p(a,_){const S={};_&24&&(S.style=a[4][a[3]]),_&16493&&(S.$$scope={dirty:_,ctx:a}),!o&&_&1&&(o=!0,S.map=a[0],qi(()=>o=!1)),n.$set(S)},i(a){c||(Le(n.$$.fragment,a),c=!0)},o(a){Be(n.$$.fragment,a),c=!1},d(a){a&&ve(e),ut(n)}}}function N3(r){let e,n,o,c;return o=new Zx({props:{$$slots:{main:[B3],left:[M3],top:[A3]},$$scope:{ctx:r}}}),{c(){e=ke("link"),n=qe(),ht(o.$$.fragment),fe(e,"rel","icon"),fe(e,"type","image/x-icon"),fe(e,"href",pT)},m(d,h){he(document.head,e),we(d,n,h),ct(o,d,h),c=!0},p(d,[h]){const a={};h&16511&&(a.$$scope={dirty:h,ctx:d}),o.$set(a)},i(d){c||(Le(o.$$.fragment,d),c=!0)},o(d){Be(o.$$.fragment,d),c=!1},d(d){d&&ve(n),ve(e),ut(o,d)}}}function j3(r,e,n){let o,c,d,h,a;jt(r,Zd,N=>n(7,o=N)),jt(r,qd,N=>n(8,c=N)),jt(r,il,N=>n(4,d=N)),jt(r,nr,N=>n(5,h=N)),jt(r,ep,N=>n(6,a=N));let _,S="Maptiler OpenStreetMap";np(async()=>{await wb()});let k,y;function C(N){S=N,n(3,S)}function E(N){gi[N?"unshift":"push"](()=>{y=N,n(2,y),n(7,o)})}function T(N){_=N,n(0,_)}const L=N=>{console.log(N.detail.error)};function R(N){gi[N?"unshift":"push"](()=>{k=N,n(1,k),n(8,c)})}return r.$$.update=()=>{r.$$.dirty&1&&_&&ol.set(_),r.$$.dirty&258&&k&&c&&(n(1,k.innerHTML="",k),k.appendChild(c)),r.$$.dirty&132&&y&&o&&(n(2,y.innerHTML="",y),y.appendChild(o))},[_,k,y,S,d,h,a,o,c,C,E,T,L,R]}class U3 extends ci{constructor(e){super(),li(this,e,j3,N3,$t,{})}}new U3({target:document.getElementById("app")});
