var Qv=Object.defineProperty;var $v=(s,i,n)=>i in s?Qv(s,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[i]=n;var Zn=(s,i,n)=>$v(s,typeof i!="symbol"?i+"":i,n);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function n(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(u){if(u.ep)return;u.ep=!0;const d=n(u);fetch(u.href,d)}})();function $t(){}function e1(s,i){for(const n in i)s[n]=i[n];return s}function jy(s){return s()}function rg(){return Object.create(null)}function Yn(s){s.forEach(jy)}function Yd(s){return typeof s=="function"}function si(s,i){return s!=s?i==i:s!==i||s&&typeof s=="object"||typeof s=="function"}let Hh;function Wn(s,i){return s===i?!0:(Hh||(Hh=document.createElement("a")),Hh.href=i,s===Hh.href)}function t1(s){return Object.keys(s).length===0}function Uy(s,...i){if(s==null){for(const l of i)l(void 0);return $t}const n=s.subscribe(...i);return n.unsubscribe?()=>n.unsubscribe():n}function Vy(s){let i;return Uy(s,n=>i=n)(),i}function Qt(s,i,n){s.$$.on_destroy.push(Uy(i,n))}function vn(s,i,n,l){if(s){const u=qy(s,i,n,l);return s[0](u)}}function qy(s,i,n,l){return s[1]&&l?e1(n.ctx.slice(),s[1](l(i))):n.ctx}function wn(s,i,n,l){if(s[2]&&l){const u=s[2](l(n));if(i.dirty===void 0)return u;if(typeof u=="object"){const d=[],f=Math.max(i.dirty.length,u.length);for(let o=0;o<f;o+=1)d[o]=i.dirty[o]|u[o];return d}return i.dirty|u}return i.dirty}function xn(s,i,n,l,u,d){if(u){const f=qy(i,n,l,d);s.p(f,u)}}function Sn(s){if(s.ctx.length>32){const i=[],n=s.ctx.length/32;for(let l=0;l<n;l++)i[l]=-1;return i}return-1}function i1(s){const i={};for(const n in s)i[n]=!0;return i}function Zc(s){return s??""}function dn(s,i,n){return s.set(n),i}function n1(s){return s&&Yd(s.destroy)?s.destroy:$t}const Zy=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ve(s,i){s.appendChild(i)}function xe(s,i,n){s.insertBefore(i,n||null)}function we(s){s.parentNode&&s.parentNode.removeChild(s)}function xr(s,i){for(let n=0;n<s.length;n+=1)s[n]&&s[n].d(i)}function Ae(s){return document.createElement(s)}function fa(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function kt(s){return document.createTextNode(s)}function $e(){return kt(" ")}function Ln(){return kt("")}function Jt(s,i,n,l){return s.addEventListener(i,n,l),()=>s.removeEventListener(i,n,l)}function Wy(s){return function(i){return i.preventDefault(),s.call(this,i)}}function r1(s){return function(i){return i.stopPropagation(),s.call(this,i)}}function be(s,i,n){n==null?s.removeAttribute(i):s.getAttribute(i)!==n&&s.setAttribute(i,n)}function s1(s){return Array.from(s.childNodes)}function Li(s,i){i=""+i,s.data!==i&&(s.data=i)}function Wr(s,i){s.value=i??""}function en(s,i,n,l){n==null?s.style.removeProperty(i):s.style.setProperty(i,n,"")}function lf(s,i,n){for(let l=0;l<s.options.length;l+=1){const u=s.options[l];if(u.__value===i){u.selected=!0;return}}(!n||i!==void 0)&&(s.selectedIndex=-1)}function Gy(s){const i=s.querySelector(":checked");return i&&i.__value}function Zs(s,i,n){s.classList.toggle(i,!!n)}function o1(s,i,{bubbles:n=!1,cancelable:l=!1}={}){return new CustomEvent(s,{detail:i,bubbles:n,cancelable:l})}let rh;function Qu(s){rh=s}function hh(){if(!rh)throw new Error("Function called outside component initialization");return rh}function Qd(s){hh().$$.on_mount.push(s)}function hs(s){hh().$$.on_destroy.push(s)}function nl(){const s=hh();return(i,n,{cancelable:l=!1}={})=>{const u=s.$$.callbacks[i];if(u){const d=o1(i,n,{cancelable:l});return u.slice().forEach(f=>{f.call(s,d)}),!d.defaultPrevented}return!0}}function $d(s,i){return hh().$$.context.set(s,i),i}function Hy(s){return hh().$$.context.get(s)}function Di(s,i){const n=s.$$.callbacks[i.type];n&&n.slice().forEach(l=>l.call(this,i))}const Dc=[],Si=[];let Uc=[];const zd=[],Xy=Promise.resolve();let Od=!1;function Ky(){Od||(Od=!0,Xy.then(Yy))}function Jy(){return Ky(),Xy}function sh(s){Uc.push(s)}function Ji(s){zd.push(s)}const wd=new Set;let Pc=0;function Yy(){if(Pc!==0)return;const s=rh;do{try{for(;Pc<Dc.length;){const i=Dc[Pc];Pc++,Qu(i),a1(i.$$)}}catch(i){throw Dc.length=0,Pc=0,i}for(Qu(null),Dc.length=0,Pc=0;Si.length;)Si.pop()();for(let i=0;i<Uc.length;i+=1){const n=Uc[i];wd.has(n)||(wd.add(n),n())}Uc.length=0}while(Dc.length);for(;zd.length;)zd.pop()();Od=!1,wd.clear(),Qu(s)}function a1(s){if(s.fragment!==null){s.update(),Yn(s.before_update);const i=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,i),s.after_update.forEach(sh)}}function l1(s){const i=[],n=[];Uc.forEach(l=>s.indexOf(l)===-1?i.push(l):n.push(l)),n.forEach(l=>l()),Uc=i}const nf=new Set;let Rl;function ln(){Rl={r:0,c:[],p:Rl}}function cn(){Rl.r||Yn(Rl.c),Rl=Rl.p}function Re(s,i){s&&s.i&&(nf.delete(s),s.i(i))}function Ve(s,i,n,l){if(s&&s.o){if(nf.has(s))return;nf.add(s),Rl.c.push(()=>{nf.delete(s),l&&(n&&s.d(1),l())}),s.o(i)}else l&&l()}function Ki(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function c1(s,i){Ve(s,1,1,()=>{i.delete(s.key)})}function u1(s,i,n,l,u,d,f,o,_,T,S,y){let k=s.length,I=d.length,C=k;const L={};for(;C--;)L[s[C].key]=C;const N=[],R=new Map,z=new Map,Z=[];for(C=I;C--;){const re=y(u,d,C),j=n(re);let U=f.get(j);U?Z.push(()=>U.p(re,i)):(U=T(j,re),U.c()),R.set(j,N[C]=U),j in L&&z.set(j,Math.abs(C-L[j]))}const ie=new Set,ae=new Set;function $(re){Re(re,1),re.m(o,S),f.set(re.key,re),S=re.first,I--}for(;k&&I;){const re=N[I-1],j=s[k-1],U=re.key,J=j.key;re===j?(S=re.first,k--,I--):R.has(J)?!f.has(U)||ie.has(U)?$(re):ae.has(J)?k--:z.get(U)>z.get(J)?(ae.add(U),$(re)):(ie.add(J),k--):(_(j,f),k--)}for(;k--;){const re=s[k];R.has(re.key)||_(re,f)}for(;I;)$(N[I-1]);return Yn(Z),N}function Yi(s,i,n){const l=s.$$.props[i];l!==void 0&&(s.$$.bound[l]=n,n(s.$$.ctx[l]))}function yt(s){s&&s.c()}function gt(s,i,n){const{fragment:l,after_update:u}=s.$$;l&&l.m(i,n),sh(()=>{const d=s.$$.on_mount.map(jy).filter(Yd);s.$$.on_destroy?s.$$.on_destroy.push(...d):Yn(d),s.$$.on_mount=[]}),u.forEach(sh)}function _t(s,i){const n=s.$$;n.fragment!==null&&(l1(n.after_update),Yn(n.on_destroy),n.fragment&&n.fragment.d(i),n.on_destroy=n.fragment=null,n.ctx=[])}function h1(s,i){s.$$.dirty[0]===-1&&(Dc.push(s),Ky(),s.$$.dirty.fill(0)),s.$$.dirty[i/31|0]|=1<<i%31}function fi(s,i,n,l,u,d,f=null,o=[-1]){const _=rh;Qu(s);const T=s.$$={fragment:null,ctx:[],props:d,update:$t,not_equal:u,bound:rg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(_?_.$$.context:[])),callbacks:rg(),dirty:o,skip_bound:!1,root:i.target||_.$$.root};f&&f(T.root);let S=!1;if(T.ctx=n?n(s,i.props||{},(y,k,...I)=>{const C=I.length?I[0]:k;return T.ctx&&u(T.ctx[y],T.ctx[y]=C)&&(!T.skip_bound&&T.bound[y]&&T.bound[y](C),S&&h1(s,y)),k}):[],T.update(),S=!0,Yn(T.before_update),T.fragment=l?l(T.ctx):!1,i.target){if(i.hydrate){const y=s1(i.target);T.fragment&&T.fragment.l(y),y.forEach(we)}else T.fragment&&T.fragment.c();i.intro&&Re(s.$$.fragment),gt(s,i.target,i.anchor),Yy()}Qu(_)}class di{constructor(){Zn(this,"$$");Zn(this,"$$set")}$destroy(){_t(this,1),this.$destroy=$t}$on(i,n){if(!Yd(n))return $t;const l=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return l.push(n),()=>{const u=l.indexOf(n);u!==-1&&l.splice(u,1)}}$set(i){this.$$set&&!t1(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const f1="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(f1);var Qy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function d1(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function p1(s){if(s.__esModule)return s;var i=s.default;if(typeof i=="function"){var n=function l(){return this instanceof l?Reflect.construct(i,arguments,this.constructor):i.apply(this,arguments)};n.prototype=i.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(s).forEach(function(l){var u=Object.getOwnPropertyDescriptor(s,l);Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:function(){return s[l]}})}),n}var m1={exports:{}},Gr="top",Ts="bottom",ks="right",Hr="left",_f="auto",Jc=[Gr,Ts,ks,Hr],jl="start",Wc="end",$y="clippingParents",ep="viewport",Fc="popper",e0="reference",Dd=Jc.reduce(function(s,i){return s.concat([i+"-"+jl,i+"-"+Wc])},[]),tp=[].concat(Jc,[_f]).reduce(function(s,i){return s.concat([i,i+"-"+jl,i+"-"+Wc])},[]),t0="beforeRead",i0="read",n0="afterRead",r0="beforeMain",s0="main",o0="afterMain",a0="beforeWrite",l0="write",c0="afterWrite",u0=[t0,i0,n0,r0,s0,o0,a0,l0,c0];function Bo(s){return s?(s.nodeName||"").toLowerCase():null}function Cs(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var i=s.ownerDocument;return i&&i.defaultView||window}return s}function Ul(s){var i=Cs(s).Element;return s instanceof i||s instanceof Element}function Gs(s){var i=Cs(s).HTMLElement;return s instanceof i||s instanceof HTMLElement}function ip(s){if(typeof ShadowRoot>"u")return!1;var i=Cs(s).ShadowRoot;return s instanceof i||s instanceof ShadowRoot}function g1(s){var i=s.state;Object.keys(i.elements).forEach(function(n){var l=i.styles[n]||{},u=i.attributes[n]||{},d=i.elements[n];!Gs(d)||!Bo(d)||(Object.assign(d.style,l),Object.keys(u).forEach(function(f){var o=u[f];o===!1?d.removeAttribute(f):d.setAttribute(f,o===!0?"":o)}))})}function _1(s){var i=s.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow),function(){Object.keys(i.elements).forEach(function(l){var u=i.elements[l],d=i.attributes[l]||{},f=Object.keys(i.styles.hasOwnProperty(l)?i.styles[l]:n[l]),o=f.reduce(function(_,T){return _[T]="",_},{});!Gs(u)||!Bo(u)||(Object.assign(u.style,o),Object.keys(d).forEach(function(_){u.removeAttribute(_)}))})}}const np={name:"applyStyles",enabled:!0,phase:"write",fn:g1,effect:_1,requires:["computeStyles"]};function Fo(s){return s.split("-")[0]}var Bl=Math.max,cf=Math.min,Gc=Math.round;function Fd(){var s=navigator.userAgentData;return s!=null&&s.brands&&Array.isArray(s.brands)?s.brands.map(function(i){return i.brand+"/"+i.version}).join(" "):navigator.userAgent}function h0(){return!/^((?!chrome|android).)*safari/i.test(Fd())}function Hc(s,i,n){i===void 0&&(i=!1),n===void 0&&(n=!1);var l=s.getBoundingClientRect(),u=1,d=1;i&&Gs(s)&&(u=s.offsetWidth>0&&Gc(l.width)/s.offsetWidth||1,d=s.offsetHeight>0&&Gc(l.height)/s.offsetHeight||1);var f=Ul(s)?Cs(s):window,o=f.visualViewport,_=!h0()&&n,T=(l.left+(_&&o?o.offsetLeft:0))/u,S=(l.top+(_&&o?o.offsetTop:0))/d,y=l.width/u,k=l.height/d;return{width:y,height:k,top:S,right:T+y,bottom:S+k,left:T,x:T,y:S}}function rp(s){var i=Hc(s),n=s.offsetWidth,l=s.offsetHeight;return Math.abs(i.width-n)<=1&&(n=i.width),Math.abs(i.height-l)<=1&&(l=i.height),{x:s.offsetLeft,y:s.offsetTop,width:n,height:l}}function f0(s,i){var n=i.getRootNode&&i.getRootNode();if(s.contains(i))return!0;if(n&&ip(n)){var l=i;do{if(l&&s.isSameNode(l))return!0;l=l.parentNode||l.host}while(l)}return!1}function da(s){return Cs(s).getComputedStyle(s)}function y1(s){return["table","td","th"].indexOf(Bo(s))>=0}function rl(s){return((Ul(s)?s.ownerDocument:s.document)||window.document).documentElement}function yf(s){return Bo(s)==="html"?s:s.assignedSlot||s.parentNode||(ip(s)?s.host:null)||rl(s)}function sg(s){return!Gs(s)||da(s).position==="fixed"?null:s.offsetParent}function b1(s){var i=/firefox/i.test(Fd()),n=/Trident/i.test(Fd());if(n&&Gs(s)){var l=da(s);if(l.position==="fixed")return null}var u=yf(s);for(ip(u)&&(u=u.host);Gs(u)&&["html","body"].indexOf(Bo(u))<0;){var d=da(u);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||i&&d.willChange==="filter"||i&&d.filter&&d.filter!=="none")return u;u=u.parentNode}return null}function fh(s){for(var i=Cs(s),n=sg(s);n&&y1(n)&&da(n).position==="static";)n=sg(n);return n&&(Bo(n)==="html"||Bo(n)==="body"&&da(n).position==="static")?i:n||b1(s)||i}function sp(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function $u(s,i,n){return Bl(s,cf(i,n))}function v1(s,i,n){var l=$u(s,i,n);return l>n?n:l}function d0(){return{top:0,right:0,bottom:0,left:0}}function p0(s){return Object.assign({},d0(),s)}function m0(s,i){return i.reduce(function(n,l){return n[l]=s,n},{})}var w1=function(i,n){return i=typeof i=="function"?i(Object.assign({},n.rects,{placement:n.placement})):i,p0(typeof i!="number"?i:m0(i,Jc))};function x1(s){var i,n=s.state,l=s.name,u=s.options,d=n.elements.arrow,f=n.modifiersData.popperOffsets,o=Fo(n.placement),_=sp(o),T=[Hr,ks].indexOf(o)>=0,S=T?"height":"width";if(!(!d||!f)){var y=w1(u.padding,n),k=rp(d),I=_==="y"?Gr:Hr,C=_==="y"?Ts:ks,L=n.rects.reference[S]+n.rects.reference[_]-f[_]-n.rects.popper[S],N=f[_]-n.rects.reference[_],R=fh(d),z=R?_==="y"?R.clientHeight||0:R.clientWidth||0:0,Z=L/2-N/2,ie=y[I],ae=z-k[S]-y[C],$=z/2-k[S]/2+Z,re=$u(ie,$,ae),j=_;n.modifiersData[l]=(i={},i[j]=re,i.centerOffset=re-$,i)}}function S1(s){var i=s.state,n=s.options,l=n.element,u=l===void 0?"[data-popper-arrow]":l;u!=null&&(typeof u=="string"&&(u=i.elements.popper.querySelector(u),!u)||f0(i.elements.popper,u)&&(i.elements.arrow=u))}const g0={name:"arrow",enabled:!0,phase:"main",fn:x1,effect:S1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Xc(s){return s.split("-")[1]}var T1={top:"auto",right:"auto",bottom:"auto",left:"auto"};function k1(s,i){var n=s.x,l=s.y,u=i.devicePixelRatio||1;return{x:Gc(n*u)/u||0,y:Gc(l*u)/u||0}}function og(s){var i,n=s.popper,l=s.popperRect,u=s.placement,d=s.variation,f=s.offsets,o=s.position,_=s.gpuAcceleration,T=s.adaptive,S=s.roundOffsets,y=s.isFixed,k=f.x,I=k===void 0?0:k,C=f.y,L=C===void 0?0:C,N=typeof S=="function"?S({x:I,y:L}):{x:I,y:L};I=N.x,L=N.y;var R=f.hasOwnProperty("x"),z=f.hasOwnProperty("y"),Z=Hr,ie=Gr,ae=window;if(T){var $=fh(n),re="clientHeight",j="clientWidth";if($===Cs(n)&&($=rl(n),da($).position!=="static"&&o==="absolute"&&(re="scrollHeight",j="scrollWidth")),$=$,u===Gr||(u===Hr||u===ks)&&d===Wc){ie=Ts;var U=y&&$===ae&&ae.visualViewport?ae.visualViewport.height:$[re];L-=U-l.height,L*=_?1:-1}if(u===Hr||(u===Gr||u===Ts)&&d===Wc){Z=ks;var J=y&&$===ae&&ae.visualViewport?ae.visualViewport.width:$[j];I-=J-l.width,I*=_?1:-1}}var B=Object.assign({position:o},T&&T1),W=S===!0?k1({x:I,y:L},Cs(n)):{x:I,y:L};if(I=W.x,L=W.y,_){var le;return Object.assign({},B,(le={},le[ie]=z?"0":"",le[Z]=R?"0":"",le.transform=(ae.devicePixelRatio||1)<=1?"translate("+I+"px, "+L+"px)":"translate3d("+I+"px, "+L+"px, 0)",le))}return Object.assign({},B,(i={},i[ie]=z?L+"px":"",i[Z]=R?I+"px":"",i.transform="",i))}function C1(s){var i=s.state,n=s.options,l=n.gpuAcceleration,u=l===void 0?!0:l,d=n.adaptive,f=d===void 0?!0:d,o=n.roundOffsets,_=o===void 0?!0:o,T={placement:Fo(i.placement),variation:Xc(i.placement),popper:i.elements.popper,popperRect:i.rects.popper,gpuAcceleration:u,isFixed:i.options.strategy==="fixed"};i.modifiersData.popperOffsets!=null&&(i.styles.popper=Object.assign({},i.styles.popper,og(Object.assign({},T,{offsets:i.modifiersData.popperOffsets,position:i.options.strategy,adaptive:f,roundOffsets:_})))),i.modifiersData.arrow!=null&&(i.styles.arrow=Object.assign({},i.styles.arrow,og(Object.assign({},T,{offsets:i.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:_})))),i.attributes.popper=Object.assign({},i.attributes.popper,{"data-popper-placement":i.placement})}const op={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:C1,data:{}};var Xh={passive:!0};function E1(s){var i=s.state,n=s.instance,l=s.options,u=l.scroll,d=u===void 0?!0:u,f=l.resize,o=f===void 0?!0:f,_=Cs(i.elements.popper),T=[].concat(i.scrollParents.reference,i.scrollParents.popper);return d&&T.forEach(function(S){S.addEventListener("scroll",n.update,Xh)}),o&&_.addEventListener("resize",n.update,Xh),function(){d&&T.forEach(function(S){S.removeEventListener("scroll",n.update,Xh)}),o&&_.removeEventListener("resize",n.update,Xh)}}const ap={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:E1,data:{}};var I1={left:"right",right:"left",bottom:"top",top:"bottom"};function rf(s){return s.replace(/left|right|bottom|top/g,function(i){return I1[i]})}var A1={start:"end",end:"start"};function ag(s){return s.replace(/start|end/g,function(i){return A1[i]})}function lp(s){var i=Cs(s),n=i.pageXOffset,l=i.pageYOffset;return{scrollLeft:n,scrollTop:l}}function cp(s){return Hc(rl(s)).left+lp(s).scrollLeft}function M1(s,i){var n=Cs(s),l=rl(s),u=n.visualViewport,d=l.clientWidth,f=l.clientHeight,o=0,_=0;if(u){d=u.width,f=u.height;var T=h0();(T||!T&&i==="fixed")&&(o=u.offsetLeft,_=u.offsetTop)}return{width:d,height:f,x:o+cp(s),y:_}}function P1(s){var i,n=rl(s),l=lp(s),u=(i=s.ownerDocument)==null?void 0:i.body,d=Bl(n.scrollWidth,n.clientWidth,u?u.scrollWidth:0,u?u.clientWidth:0),f=Bl(n.scrollHeight,n.clientHeight,u?u.scrollHeight:0,u?u.clientHeight:0),o=-l.scrollLeft+cp(s),_=-l.scrollTop;return da(u||n).direction==="rtl"&&(o+=Bl(n.clientWidth,u?u.clientWidth:0)-d),{width:d,height:f,x:o,y:_}}function up(s){var i=da(s),n=i.overflow,l=i.overflowX,u=i.overflowY;return/auto|scroll|overlay|hidden/.test(n+u+l)}function _0(s){return["html","body","#document"].indexOf(Bo(s))>=0?s.ownerDocument.body:Gs(s)&&up(s)?s:_0(yf(s))}function eh(s,i){var n;i===void 0&&(i=[]);var l=_0(s),u=l===((n=s.ownerDocument)==null?void 0:n.body),d=Cs(l),f=u?[d].concat(d.visualViewport||[],up(l)?l:[]):l,o=i.concat(f);return u?o:o.concat(eh(yf(f)))}function Rd(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function L1(s,i){var n=Hc(s,!1,i==="fixed");return n.top=n.top+s.clientTop,n.left=n.left+s.clientLeft,n.bottom=n.top+s.clientHeight,n.right=n.left+s.clientWidth,n.width=s.clientWidth,n.height=s.clientHeight,n.x=n.left,n.y=n.top,n}function lg(s,i,n){return i===ep?Rd(M1(s,n)):Ul(i)?L1(i,n):Rd(P1(rl(s)))}function z1(s){var i=eh(yf(s)),n=["absolute","fixed"].indexOf(da(s).position)>=0,l=n&&Gs(s)?fh(s):s;return Ul(l)?i.filter(function(u){return Ul(u)&&f0(u,l)&&Bo(u)!=="body"}):[]}function O1(s,i,n,l){var u=i==="clippingParents"?z1(s):[].concat(i),d=[].concat(u,[n]),f=d[0],o=d.reduce(function(_,T){var S=lg(s,T,l);return _.top=Bl(S.top,_.top),_.right=cf(S.right,_.right),_.bottom=cf(S.bottom,_.bottom),_.left=Bl(S.left,_.left),_},lg(s,f,l));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function y0(s){var i=s.reference,n=s.element,l=s.placement,u=l?Fo(l):null,d=l?Xc(l):null,f=i.x+i.width/2-n.width/2,o=i.y+i.height/2-n.height/2,_;switch(u){case Gr:_={x:f,y:i.y-n.height};break;case Ts:_={x:f,y:i.y+i.height};break;case ks:_={x:i.x+i.width,y:o};break;case Hr:_={x:i.x-n.width,y:o};break;default:_={x:i.x,y:i.y}}var T=u?sp(u):null;if(T!=null){var S=T==="y"?"height":"width";switch(d){case jl:_[T]=_[T]-(i[S]/2-n[S]/2);break;case Wc:_[T]=_[T]+(i[S]/2-n[S]/2);break}}return _}function Kc(s,i){i===void 0&&(i={});var n=i,l=n.placement,u=l===void 0?s.placement:l,d=n.strategy,f=d===void 0?s.strategy:d,o=n.boundary,_=o===void 0?$y:o,T=n.rootBoundary,S=T===void 0?ep:T,y=n.elementContext,k=y===void 0?Fc:y,I=n.altBoundary,C=I===void 0?!1:I,L=n.padding,N=L===void 0?0:L,R=p0(typeof N!="number"?N:m0(N,Jc)),z=k===Fc?e0:Fc,Z=s.rects.popper,ie=s.elements[C?z:k],ae=O1(Ul(ie)?ie:ie.contextElement||rl(s.elements.popper),_,S,f),$=Hc(s.elements.reference),re=y0({reference:$,element:Z,placement:u}),j=Rd(Object.assign({},Z,re)),U=k===Fc?j:$,J={top:ae.top-U.top+R.top,bottom:U.bottom-ae.bottom+R.bottom,left:ae.left-U.left+R.left,right:U.right-ae.right+R.right},B=s.modifiersData.offset;if(k===Fc&&B){var W=B[u];Object.keys(J).forEach(function(le){var ge=[ks,Ts].indexOf(le)>=0?1:-1,pe=[Gr,Ts].indexOf(le)>=0?"y":"x";J[le]+=W[pe]*ge})}return J}function D1(s,i){i===void 0&&(i={});var n=i,l=n.placement,u=n.boundary,d=n.rootBoundary,f=n.padding,o=n.flipVariations,_=n.allowedAutoPlacements,T=_===void 0?tp:_,S=Xc(l),y=S?o?Dd:Dd.filter(function(C){return Xc(C)===S}):Jc,k=y.filter(function(C){return T.indexOf(C)>=0});k.length===0&&(k=y);var I=k.reduce(function(C,L){return C[L]=Kc(s,{placement:L,boundary:u,rootBoundary:d,padding:f})[Fo(L)],C},{});return Object.keys(I).sort(function(C,L){return I[C]-I[L]})}function F1(s){if(Fo(s)===_f)return[];var i=rf(s);return[ag(s),i,ag(i)]}function R1(s){var i=s.state,n=s.options,l=s.name;if(!i.modifiersData[l]._skip){for(var u=n.mainAxis,d=u===void 0?!0:u,f=n.altAxis,o=f===void 0?!0:f,_=n.fallbackPlacements,T=n.padding,S=n.boundary,y=n.rootBoundary,k=n.altBoundary,I=n.flipVariations,C=I===void 0?!0:I,L=n.allowedAutoPlacements,N=i.options.placement,R=Fo(N),z=R===N,Z=_||(z||!C?[rf(N)]:F1(N)),ie=[N].concat(Z).reduce(function(tt,vt){return tt.concat(Fo(vt)===_f?D1(i,{placement:vt,boundary:S,rootBoundary:y,padding:T,flipVariations:C,allowedAutoPlacements:L}):vt)},[]),ae=i.rects.reference,$=i.rects.popper,re=new Map,j=!0,U=ie[0],J=0;J<ie.length;J++){var B=ie[J],W=Fo(B),le=Xc(B)===jl,ge=[Gr,Ts].indexOf(W)>=0,pe=ge?"width":"height",_e=Kc(i,{placement:B,boundary:S,rootBoundary:y,altBoundary:k,padding:T}),ce=ge?le?ks:Hr:le?Ts:Gr;ae[pe]>$[pe]&&(ce=rf(ce));var Le=rf(ce),ze=[];if(d&&ze.push(_e[W]<=0),o&&ze.push(_e[ce]<=0,_e[Le]<=0),ze.every(function(tt){return tt})){U=B,j=!1;break}re.set(B,ze)}if(j)for(var ct=C?3:1,nt=function(vt){var St=ie.find(function(Zt){var oi=re.get(Zt);if(oi)return oi.slice(0,vt).every(function(Ai){return Ai})});if(St)return U=St,"break"},bt=ct;bt>0;bt--){var At=nt(bt);if(At==="break")break}i.placement!==U&&(i.modifiersData[l]._skip=!0,i.placement=U,i.reset=!0)}}const b0={name:"flip",enabled:!0,phase:"main",fn:R1,requiresIfExists:["offset"],data:{_skip:!1}};function cg(s,i,n){return n===void 0&&(n={x:0,y:0}),{top:s.top-i.height-n.y,right:s.right-i.width+n.x,bottom:s.bottom-i.height+n.y,left:s.left-i.width-n.x}}function ug(s){return[Gr,ks,Ts,Hr].some(function(i){return s[i]>=0})}function B1(s){var i=s.state,n=s.name,l=i.rects.reference,u=i.rects.popper,d=i.modifiersData.preventOverflow,f=Kc(i,{elementContext:"reference"}),o=Kc(i,{altBoundary:!0}),_=cg(f,l),T=cg(o,u,d),S=ug(_),y=ug(T);i.modifiersData[n]={referenceClippingOffsets:_,popperEscapeOffsets:T,isReferenceHidden:S,hasPopperEscaped:y},i.attributes.popper=Object.assign({},i.attributes.popper,{"data-popper-reference-hidden":S,"data-popper-escaped":y})}const v0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:B1};function N1(s,i,n){var l=Fo(s),u=[Hr,Gr].indexOf(l)>=0?-1:1,d=typeof n=="function"?n(Object.assign({},i,{placement:s})):n,f=d[0],o=d[1];return f=f||0,o=(o||0)*u,[Hr,ks].indexOf(l)>=0?{x:o,y:f}:{x:f,y:o}}function j1(s){var i=s.state,n=s.options,l=s.name,u=n.offset,d=u===void 0?[0,0]:u,f=tp.reduce(function(S,y){return S[y]=N1(y,i.rects,d),S},{}),o=f[i.placement],_=o.x,T=o.y;i.modifiersData.popperOffsets!=null&&(i.modifiersData.popperOffsets.x+=_,i.modifiersData.popperOffsets.y+=T),i.modifiersData[l]=f}const w0={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:j1};function U1(s){var i=s.state,n=s.name;i.modifiersData[n]=y0({reference:i.rects.reference,element:i.rects.popper,placement:i.placement})}const hp={name:"popperOffsets",enabled:!0,phase:"read",fn:U1,data:{}};function V1(s){return s==="x"?"y":"x"}function q1(s){var i=s.state,n=s.options,l=s.name,u=n.mainAxis,d=u===void 0?!0:u,f=n.altAxis,o=f===void 0?!1:f,_=n.boundary,T=n.rootBoundary,S=n.altBoundary,y=n.padding,k=n.tether,I=k===void 0?!0:k,C=n.tetherOffset,L=C===void 0?0:C,N=Kc(i,{boundary:_,rootBoundary:T,padding:y,altBoundary:S}),R=Fo(i.placement),z=Xc(i.placement),Z=!z,ie=sp(R),ae=V1(ie),$=i.modifiersData.popperOffsets,re=i.rects.reference,j=i.rects.popper,U=typeof L=="function"?L(Object.assign({},i.rects,{placement:i.placement})):L,J=typeof U=="number"?{mainAxis:U,altAxis:U}:Object.assign({mainAxis:0,altAxis:0},U),B=i.modifiersData.offset?i.modifiersData.offset[i.placement]:null,W={x:0,y:0};if($){if(d){var le,ge=ie==="y"?Gr:Hr,pe=ie==="y"?Ts:ks,_e=ie==="y"?"height":"width",ce=$[ie],Le=ce+N[ge],ze=ce-N[pe],ct=I?-j[_e]/2:0,nt=z===jl?re[_e]:j[_e],bt=z===jl?-j[_e]:-re[_e],At=i.elements.arrow,tt=I&&At?rp(At):{width:0,height:0},vt=i.modifiersData["arrow#persistent"]?i.modifiersData["arrow#persistent"].padding:d0(),St=vt[ge],Zt=vt[pe],oi=$u(0,re[_e],tt[_e]),Ai=Z?re[_e]/2-ct-oi-St-J.mainAxis:nt-oi-St-J.mainAxis,Mi=Z?-re[_e]/2+ct+oi+Zt+J.mainAxis:bt+oi+Zt+J.mainAxis,Ti=i.elements.arrow&&fh(i.elements.arrow),It=Ti?ie==="y"?Ti.clientTop||0:Ti.clientLeft||0:0,Ge=(le=B==null?void 0:B[ie])!=null?le:0,Pt=ce+Ai-Ge-It,ii=ce+Mi-Ge,Je=$u(I?cf(Le,Pt):Le,ce,I?Bl(ze,ii):ze);$[ie]=Je,W[ie]=Je-ce}if(o){var gi,dt=ie==="x"?Gr:Hr,et=ie==="x"?Ts:ks,he=$[ae],H=ae==="y"?"height":"width",Y=he+N[dt],Ee=he-N[et],qe=[Gr,Hr].indexOf(R)!==-1,ut=(gi=B==null?void 0:B[ae])!=null?gi:0,st=qe?Y:he-re[H]-j[H]-ut+J.altAxis,ki=qe?he+re[H]+j[H]-ut-J.altAxis:Ee,lt=I&&qe?v1(st,he,ki):$u(I?st:Y,he,I?ki:Ee);$[ae]=lt,W[ae]=lt-he}i.modifiersData[l]=W}}const x0={name:"preventOverflow",enabled:!0,phase:"main",fn:q1,requiresIfExists:["offset"]};function Z1(s){return{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}}function W1(s){return s===Cs(s)||!Gs(s)?lp(s):Z1(s)}function G1(s){var i=s.getBoundingClientRect(),n=Gc(i.width)/s.offsetWidth||1,l=Gc(i.height)/s.offsetHeight||1;return n!==1||l!==1}function H1(s,i,n){n===void 0&&(n=!1);var l=Gs(i),u=Gs(i)&&G1(i),d=rl(i),f=Hc(s,u,n),o={scrollLeft:0,scrollTop:0},_={x:0,y:0};return(l||!l&&!n)&&((Bo(i)!=="body"||up(d))&&(o=W1(i)),Gs(i)?(_=Hc(i,!0),_.x+=i.clientLeft,_.y+=i.clientTop):d&&(_.x=cp(d))),{x:f.left+o.scrollLeft-_.x,y:f.top+o.scrollTop-_.y,width:f.width,height:f.height}}function X1(s){var i=new Map,n=new Set,l=[];s.forEach(function(d){i.set(d.name,d)});function u(d){n.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(o){if(!n.has(o)){var _=i.get(o);_&&u(_)}}),l.push(d)}return s.forEach(function(d){n.has(d.name)||u(d)}),l}function K1(s){var i=X1(s);return u0.reduce(function(n,l){return n.concat(i.filter(function(u){return u.phase===l}))},[])}function J1(s){var i;return function(){return i||(i=new Promise(function(n){Promise.resolve().then(function(){i=void 0,n(s())})})),i}}function Y1(s){var i=s.reduce(function(n,l){var u=n[l.name];return n[l.name]=u?Object.assign({},u,l,{options:Object.assign({},u.options,l.options),data:Object.assign({},u.data,l.data)}):l,n},{});return Object.keys(i).map(function(n){return i[n]})}var hg={placement:"bottom",modifiers:[],strategy:"absolute"};function fg(){for(var s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];return!i.some(function(l){return!(l&&typeof l.getBoundingClientRect=="function")})}function bf(s){s===void 0&&(s={});var i=s,n=i.defaultModifiers,l=n===void 0?[]:n,u=i.defaultOptions,d=u===void 0?hg:u;return function(o,_,T){T===void 0&&(T=d);var S={placement:"bottom",orderedModifiers:[],options:Object.assign({},hg,d),modifiersData:{},elements:{reference:o,popper:_},attributes:{},styles:{}},y=[],k=!1,I={state:S,setOptions:function(R){var z=typeof R=="function"?R(S.options):R;L(),S.options=Object.assign({},d,S.options,z),S.scrollParents={reference:Ul(o)?eh(o):o.contextElement?eh(o.contextElement):[],popper:eh(_)};var Z=K1(Y1([].concat(l,S.options.modifiers)));return S.orderedModifiers=Z.filter(function(ie){return ie.enabled}),C(),I.update()},forceUpdate:function(){if(!k){var R=S.elements,z=R.reference,Z=R.popper;if(fg(z,Z)){S.rects={reference:H1(z,fh(Z),S.options.strategy==="fixed"),popper:rp(Z)},S.reset=!1,S.placement=S.options.placement,S.orderedModifiers.forEach(function(J){return S.modifiersData[J.name]=Object.assign({},J.data)});for(var ie=0;ie<S.orderedModifiers.length;ie++){if(S.reset===!0){S.reset=!1,ie=-1;continue}var ae=S.orderedModifiers[ie],$=ae.fn,re=ae.options,j=re===void 0?{}:re,U=ae.name;typeof $=="function"&&(S=$({state:S,options:j,name:U,instance:I})||S)}}}},update:J1(function(){return new Promise(function(N){I.forceUpdate(),N(S)})}),destroy:function(){L(),k=!0}};if(!fg(o,_))return I;I.setOptions(T).then(function(N){!k&&T.onFirstUpdate&&T.onFirstUpdate(N)});function C(){S.orderedModifiers.forEach(function(N){var R=N.name,z=N.options,Z=z===void 0?{}:z,ie=N.effect;if(typeof ie=="function"){var ae=ie({state:S,name:R,instance:I,options:Z}),$=function(){};y.push(ae||$)}})}function L(){y.forEach(function(N){return N()}),y=[]}return I}}var Q1=bf(),$1=[ap,hp,op,np],ew=bf({defaultModifiers:$1}),tw=[ap,hp,op,np,w0,b0,x0,g0,v0],iw=bf({defaultModifiers:tw});const nw=Object.freeze(Object.defineProperty({__proto__:null,afterMain:o0,afterRead:n0,afterWrite:c0,applyStyles:np,arrow:g0,auto:_f,basePlacements:Jc,beforeMain:r0,beforeRead:t0,beforeWrite:a0,bottom:Ts,clippingParents:$y,computeStyles:op,createPopper:iw,createPopperBase:Q1,createPopperLite:ew,detectOverflow:Kc,end:Wc,eventListeners:ap,flip:b0,hide:v0,left:Hr,main:s0,modifierPhases:u0,offset:w0,placements:tp,popper:Fc,popperGenerator:bf,popperOffsets:hp,preventOverflow:x0,read:i0,reference:e0,right:ks,start:jl,top:Gr,variationPlacements:Dd,viewport:ep,write:l0},Symbol.toStringTag,{value:"Module"})),rw=p1(nw);/*!
  * Bootstrap v5.3.8 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(s,i){(function(n,l){s.exports=l(rw)})(Qy,function(n){function l(Be){const D=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(Be){for(const se in Be)if(se!=="default"){const De=Object.getOwnPropertyDescriptor(Be,se);Object.defineProperty(D,se,De.get?De:{enumerable:!0,get:()=>Be[se]})}}return D.default=Be,Object.freeze(D)}const u=l(n),d=new Map,f={set(Be,D,se){d.has(Be)||d.set(Be,new Map);const De=d.get(Be);De.has(D)||De.size===0?De.set(D,se):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(De.keys())[0]}.`)},get:(Be,D)=>d.has(Be)&&d.get(Be).get(D)||null,remove(Be,D){if(!d.has(Be))return;const se=d.get(Be);se.delete(D),se.size===0&&d.delete(Be)}},o="transitionend",_=Be=>(Be&&window.CSS&&window.CSS.escape&&(Be=Be.replace(/#([^\s"#']+)/g,(D,se)=>`#${CSS.escape(se)}`)),Be),T=Be=>Be==null?`${Be}`:Object.prototype.toString.call(Be).match(/\s([a-z]+)/i)[1].toLowerCase(),S=Be=>{Be.dispatchEvent(new Event(o))},y=Be=>!(!Be||typeof Be!="object")&&(Be.jquery!==void 0&&(Be=Be[0]),Be.nodeType!==void 0),k=Be=>y(Be)?Be.jquery?Be[0]:Be:typeof Be=="string"&&Be.length>0?document.querySelector(_(Be)):null,I=Be=>{if(!y(Be)||Be.getClientRects().length===0)return!1;const D=getComputedStyle(Be).getPropertyValue("visibility")==="visible",se=Be.closest("details:not([open])");if(!se)return D;if(se!==Be){const De=Be.closest("summary");if(De&&De.parentNode!==se||De===null)return!1}return D},C=Be=>!Be||Be.nodeType!==Node.ELEMENT_NODE||!!Be.classList.contains("disabled")||(Be.disabled!==void 0?Be.disabled:Be.hasAttribute("disabled")&&Be.getAttribute("disabled")!=="false"),L=Be=>{if(!document.documentElement.attachShadow)return null;if(typeof Be.getRootNode=="function"){const D=Be.getRootNode();return D instanceof ShadowRoot?D:null}return Be instanceof ShadowRoot?Be:Be.parentNode?L(Be.parentNode):null},N=()=>{},R=Be=>{Be.offsetHeight},z=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Z=[],ie=()=>document.documentElement.dir==="rtl",ae=Be=>{var D;D=()=>{const se=z();if(se){const De=Be.NAME,ht=se.fn[De];se.fn[De]=Be.jQueryInterface,se.fn[De].Constructor=Be,se.fn[De].noConflict=()=>(se.fn[De]=ht,Be.jQueryInterface)}},document.readyState==="loading"?(Z.length||document.addEventListener("DOMContentLoaded",()=>{for(const se of Z)se()}),Z.push(D)):D()},$=(Be,D=[],se=Be)=>typeof Be=="function"?Be.call(...D):se,re=(Be,D,se=!0)=>{if(!se)return void $(Be);const De=(Wt=>{if(!Wt)return 0;let{transitionDuration:Zi,transitionDelay:on}=window.getComputedStyle(Wt);const On=Number.parseFloat(Zi),In=Number.parseFloat(on);return On||In?(Zi=Zi.split(",")[0],on=on.split(",")[0],1e3*(Number.parseFloat(Zi)+Number.parseFloat(on))):0})(D)+5;let ht=!1;const Et=({target:Wt})=>{Wt===D&&(ht=!0,D.removeEventListener(o,Et),$(Be))};D.addEventListener(o,Et),setTimeout(()=>{ht||S(D)},De)},j=(Be,D,se,De)=>{const ht=Be.length;let Et=Be.indexOf(D);return Et===-1?!se&&De?Be[ht-1]:Be[0]:(Et+=se?1:-1,De&&(Et=(Et+ht)%ht),Be[Math.max(0,Math.min(Et,ht-1))])},U=/[^.]*(?=\..*)\.|.*/,J=/\..*/,B=/::\d+$/,W={};let le=1;const ge={mouseenter:"mouseover",mouseleave:"mouseout"},pe=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function _e(Be,D){return D&&`${D}::${le++}`||Be.uidEvent||le++}function ce(Be){const D=_e(Be);return Be.uidEvent=D,W[D]=W[D]||{},W[D]}function Le(Be,D,se=null){return Object.values(Be).find(De=>De.callable===D&&De.delegationSelector===se)}function ze(Be,D,se){const De=typeof D=="string",ht=De?se:D||se;let Et=At(Be);return pe.has(Et)||(Et=Be),[De,ht,Et]}function ct(Be,D,se,De,ht){if(typeof D!="string"||!Be)return;let[Et,Wt,Zi]=ze(D,se,De);D in ge&&(Wt=($r=>function(gr){if(!gr.relatedTarget||gr.relatedTarget!==gr.delegateTarget&&!gr.delegateTarget.contains(gr.relatedTarget))return $r.call(this,gr)})(Wt));const on=ce(Be),On=on[Zi]||(on[Zi]={}),In=Le(On,Wt,Et?se:null);if(In)return void(In.oneOff=In.oneOff&&ht);const mr=_e(Wt,D.replace(U,"")),Er=Et?function(Nr,$r,gr){return function so(es){const za=Nr.querySelectorAll($r);for(let{target:jr}=es;jr&&jr!==this;jr=jr.parentNode)for(const bl of za)if(bl===jr)return vt(es,{delegateTarget:jr}),so.oneOff&&tt.off(Nr,es.type,$r,gr),gr.apply(jr,[es])}}(Be,se,Wt):function(Nr,$r){return function gr(so){return vt(so,{delegateTarget:Nr}),gr.oneOff&&tt.off(Nr,so.type,$r),$r.apply(Nr,[so])}}(Be,Wt);Er.delegationSelector=Et?se:null,Er.callable=Wt,Er.oneOff=ht,Er.uidEvent=mr,On[mr]=Er,Be.addEventListener(Zi,Er,Et)}function nt(Be,D,se,De,ht){const Et=Le(D[se],De,ht);Et&&(Be.removeEventListener(se,Et,!!ht),delete D[se][Et.uidEvent])}function bt(Be,D,se,De){const ht=D[se]||{};for(const[Et,Wt]of Object.entries(ht))Et.includes(De)&&nt(Be,D,se,Wt.callable,Wt.delegationSelector)}function At(Be){return Be=Be.replace(J,""),ge[Be]||Be}const tt={on(Be,D,se,De){ct(Be,D,se,De,!1)},one(Be,D,se,De){ct(Be,D,se,De,!0)},off(Be,D,se,De){if(typeof D!="string"||!Be)return;const[ht,Et,Wt]=ze(D,se,De),Zi=Wt!==D,on=ce(Be),On=on[Wt]||{},In=D.startsWith(".");if(Et===void 0){if(In)for(const mr of Object.keys(on))bt(Be,on,mr,D.slice(1));for(const[mr,Er]of Object.entries(On)){const Nr=mr.replace(B,"");Zi&&!D.includes(Nr)||nt(Be,on,Wt,Er.callable,Er.delegationSelector)}}else{if(!Object.keys(On).length)return;nt(Be,on,Wt,Et,ht?se:null)}},trigger(Be,D,se){if(typeof D!="string"||!Be)return null;const De=z();let ht=null,Et=!0,Wt=!0,Zi=!1;D!==At(D)&&De&&(ht=De.Event(D,se),De(Be).trigger(ht),Et=!ht.isPropagationStopped(),Wt=!ht.isImmediatePropagationStopped(),Zi=ht.isDefaultPrevented());const on=vt(new Event(D,{bubbles:Et,cancelable:!0}),se);return Zi&&on.preventDefault(),Wt&&Be.dispatchEvent(on),on.defaultPrevented&&ht&&ht.preventDefault(),on}};function vt(Be,D={}){for(const[se,De]of Object.entries(D))try{Be[se]=De}catch{Object.defineProperty(Be,se,{configurable:!0,get:()=>De})}return Be}function St(Be){if(Be==="true")return!0;if(Be==="false")return!1;if(Be===Number(Be).toString())return Number(Be);if(Be===""||Be==="null")return null;if(typeof Be!="string")return Be;try{return JSON.parse(decodeURIComponent(Be))}catch{return Be}}function Zt(Be){return Be.replace(/[A-Z]/g,D=>`-${D.toLowerCase()}`)}const oi={setDataAttribute(Be,D,se){Be.setAttribute(`data-bs-${Zt(D)}`,se)},removeDataAttribute(Be,D){Be.removeAttribute(`data-bs-${Zt(D)}`)},getDataAttributes(Be){if(!Be)return{};const D={},se=Object.keys(Be.dataset).filter(De=>De.startsWith("bs")&&!De.startsWith("bsConfig"));for(const De of se){let ht=De.replace(/^bs/,"");ht=ht.charAt(0).toLowerCase()+ht.slice(1),D[ht]=St(Be.dataset[De])}return D},getDataAttribute:(Be,D)=>St(Be.getAttribute(`data-bs-${Zt(D)}`))};class Ai{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(D){return D=this._mergeConfigObj(D),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}_configAfterMerge(D){return D}_mergeConfigObj(D,se){const De=y(se)?oi.getDataAttribute(se,"config"):{};return{...this.constructor.Default,...typeof De=="object"?De:{},...y(se)?oi.getDataAttributes(se):{},...typeof D=="object"?D:{}}}_typeCheckConfig(D,se=this.constructor.DefaultType){for(const[De,ht]of Object.entries(se)){const Et=D[De],Wt=y(Et)?"element":T(Et);if(!new RegExp(ht).test(Wt))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${De}" provided type "${Wt}" but expected type "${ht}".`)}}}class Mi extends Ai{constructor(D,se){super(),(D=k(D))&&(this._element=D,this._config=this._getConfig(se),f.set(this._element,this.constructor.DATA_KEY,this))}dispose(){f.remove(this._element,this.constructor.DATA_KEY),tt.off(this._element,this.constructor.EVENT_KEY);for(const D of Object.getOwnPropertyNames(this))this[D]=null}_queueCallback(D,se,De=!0){re(D,se,De)}_getConfig(D){return D=this._mergeConfigObj(D,this._element),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}static getInstance(D){return f.get(k(D),this.DATA_KEY)}static getOrCreateInstance(D,se={}){return this.getInstance(D)||new this(D,typeof se=="object"?se:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(D){return`${D}${this.EVENT_KEY}`}}const Ti=Be=>{let D=Be.getAttribute("data-bs-target");if(!D||D==="#"){let se=Be.getAttribute("href");if(!se||!se.includes("#")&&!se.startsWith("."))return null;se.includes("#")&&!se.startsWith("#")&&(se=`#${se.split("#")[1]}`),D=se&&se!=="#"?se.trim():null}return D?D.split(",").map(se=>_(se)).join(","):null},It={find:(Be,D=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(D,Be)),findOne:(Be,D=document.documentElement)=>Element.prototype.querySelector.call(D,Be),children:(Be,D)=>[].concat(...Be.children).filter(se=>se.matches(D)),parents(Be,D){const se=[];let De=Be.parentNode.closest(D);for(;De;)se.push(De),De=De.parentNode.closest(D);return se},prev(Be,D){let se=Be.previousElementSibling;for(;se;){if(se.matches(D))return[se];se=se.previousElementSibling}return[]},next(Be,D){let se=Be.nextElementSibling;for(;se;){if(se.matches(D))return[se];se=se.nextElementSibling}return[]},focusableChildren(Be){const D=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(se=>`${se}:not([tabindex^="-"])`).join(",");return this.find(D,Be).filter(se=>!C(se)&&I(se))},getSelectorFromElement(Be){const D=Ti(Be);return D&&It.findOne(D)?D:null},getElementFromSelector(Be){const D=Ti(Be);return D?It.findOne(D):null},getMultipleElementsFromSelector(Be){const D=Ti(Be);return D?It.find(D):[]}},Ge=(Be,D="hide")=>{const se=`click.dismiss${Be.EVENT_KEY}`,De=Be.NAME;tt.on(document,se,`[data-bs-dismiss="${De}"]`,function(ht){if(["A","AREA"].includes(this.tagName)&&ht.preventDefault(),C(this))return;const Et=It.getElementFromSelector(this)||this.closest(`.${De}`);Be.getOrCreateInstance(Et)[D]()})},Pt=".bs.alert",ii=`close${Pt}`,Je=`closed${Pt}`;class gi extends Mi{static get NAME(){return"alert"}close(){if(tt.trigger(this._element,ii).defaultPrevented)return;this._element.classList.remove("show");const D=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,D)}_destroyElement(){this._element.remove(),tt.trigger(this._element,Je),this.dispose()}static jQueryInterface(D){return this.each(function(){const se=gi.getOrCreateInstance(this);if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D](this)}})}}Ge(gi,"close"),ae(gi);const dt='[data-bs-toggle="button"]';class et extends Mi{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(D){return this.each(function(){const se=et.getOrCreateInstance(this);D==="toggle"&&se[D]()})}}tt.on(document,"click.bs.button.data-api",dt,Be=>{Be.preventDefault();const D=Be.target.closest(dt);et.getOrCreateInstance(D).toggle()}),ae(et);const he=".bs.swipe",H=`touchstart${he}`,Y=`touchmove${he}`,Ee=`touchend${he}`,qe=`pointerdown${he}`,ut=`pointerup${he}`,st={endCallback:null,leftCallback:null,rightCallback:null},ki={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class lt extends Ai{constructor(D,se){super(),this._element=D,D&&lt.isSupported()&&(this._config=this._getConfig(se),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return st}static get DefaultType(){return ki}static get NAME(){return"swipe"}dispose(){tt.off(this._element,he)}_start(D){this._supportPointerEvents?this._eventIsPointerPenTouch(D)&&(this._deltaX=D.clientX):this._deltaX=D.touches[0].clientX}_end(D){this._eventIsPointerPenTouch(D)&&(this._deltaX=D.clientX-this._deltaX),this._handleSwipe(),$(this._config.endCallback)}_move(D){this._deltaX=D.touches&&D.touches.length>1?0:D.touches[0].clientX-this._deltaX}_handleSwipe(){const D=Math.abs(this._deltaX);if(D<=40)return;const se=D/this._deltaX;this._deltaX=0,se&&$(se>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(tt.on(this._element,qe,D=>this._start(D)),tt.on(this._element,ut,D=>this._end(D)),this._element.classList.add("pointer-event")):(tt.on(this._element,H,D=>this._start(D)),tt.on(this._element,Y,D=>this._move(D)),tt.on(this._element,Ee,D=>this._end(D)))}_eventIsPointerPenTouch(D){return this._supportPointerEvents&&(D.pointerType==="pen"||D.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Vt=".bs.carousel",Ci=".data-api",Fi="ArrowLeft",Cn="ArrowRight",xt="next",li="prev",ti="left",tn="right",hr=`slide${Vt}`,ai=`slid${Vt}`,fr=`keydown${Vt}`,dr=`mouseenter${Vt}`,Sr=`mouseleave${Vt}`,Tr=`dragstart${Vt}`,Ie=`load${Vt}${Ci}`,ee=`click${Vt}${Ci}`,te="carousel",fe="active",Se=".active",je=".carousel-item",Ze=Se+je,Ye={[Fi]:tn,[Cn]:ti},Fe={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ot={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class pt extends Mi{constructor(D,se){super(D,se),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=It.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===te&&this.cycle()}static get Default(){return Fe}static get DefaultType(){return ot}static get NAME(){return"carousel"}next(){this._slide(xt)}nextWhenVisible(){!document.hidden&&I(this._element)&&this.next()}prev(){this._slide(li)}pause(){this._isSliding&&S(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?tt.one(this._element,ai,()=>this.cycle()):this.cycle())}to(D){const se=this._getItems();if(D>se.length-1||D<0)return;if(this._isSliding)return void tt.one(this._element,ai,()=>this.to(D));const De=this._getItemIndex(this._getActive());if(De===D)return;const ht=D>De?xt:li;this._slide(ht,se[D])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(D){return D.defaultInterval=D.interval,D}_addEventListeners(){this._config.keyboard&&tt.on(this._element,fr,D=>this._keydown(D)),this._config.pause==="hover"&&(tt.on(this._element,dr,()=>this.pause()),tt.on(this._element,Sr,()=>this._maybeEnableCycle())),this._config.touch&&lt.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const se of It.find(".carousel-item img",this._element))tt.on(se,Tr,De=>De.preventDefault());const D={leftCallback:()=>this._slide(this._directionToOrder(ti)),rightCallback:()=>this._slide(this._directionToOrder(tn)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new lt(this._element,D)}_keydown(D){if(/input|textarea/i.test(D.target.tagName))return;const se=Ye[D.key];se&&(D.preventDefault(),this._slide(this._directionToOrder(se)))}_getItemIndex(D){return this._getItems().indexOf(D)}_setActiveIndicatorElement(D){if(!this._indicatorsElement)return;const se=It.findOne(Se,this._indicatorsElement);se.classList.remove(fe),se.removeAttribute("aria-current");const De=It.findOne(`[data-bs-slide-to="${D}"]`,this._indicatorsElement);De&&(De.classList.add(fe),De.setAttribute("aria-current","true"))}_updateInterval(){const D=this._activeElement||this._getActive();if(!D)return;const se=Number.parseInt(D.getAttribute("data-bs-interval"),10);this._config.interval=se||this._config.defaultInterval}_slide(D,se=null){if(this._isSliding)return;const De=this._getActive(),ht=D===xt,Et=se||j(this._getItems(),De,ht,this._config.wrap);if(Et===De)return;const Wt=this._getItemIndex(Et),Zi=mr=>tt.trigger(this._element,mr,{relatedTarget:Et,direction:this._orderToDirection(D),from:this._getItemIndex(De),to:Wt});if(Zi(hr).defaultPrevented||!De||!Et)return;const on=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Wt),this._activeElement=Et;const On=ht?"carousel-item-start":"carousel-item-end",In=ht?"carousel-item-next":"carousel-item-prev";Et.classList.add(In),R(Et),De.classList.add(On),Et.classList.add(On),this._queueCallback(()=>{Et.classList.remove(On,In),Et.classList.add(fe),De.classList.remove(fe,In,On),this._isSliding=!1,Zi(ai)},De,this._isAnimated()),on&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return It.findOne(Ze,this._element)}_getItems(){return It.find(je,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(D){return ie()?D===ti?li:xt:D===ti?xt:li}_orderToDirection(D){return ie()?D===li?ti:tn:D===li?tn:ti}static jQueryInterface(D){return this.each(function(){const se=pt.getOrCreateInstance(this,D);if(typeof D!="number"){if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D]()}}else se.to(D)})}}tt.on(document,ee,"[data-bs-slide], [data-bs-slide-to]",function(Be){const D=It.getElementFromSelector(this);if(!D||!D.classList.contains(te))return;Be.preventDefault();const se=pt.getOrCreateInstance(D),De=this.getAttribute("data-bs-slide-to");return De?(se.to(De),void se._maybeEnableCycle()):oi.getDataAttribute(this,"slide")==="next"?(se.next(),void se._maybeEnableCycle()):(se.prev(),void se._maybeEnableCycle())}),tt.on(window,Ie,()=>{const Be=It.find('[data-bs-ride="carousel"]');for(const D of Be)pt.getOrCreateInstance(D)}),ae(pt);const rt=".bs.collapse",Ct=`show${rt}`,Xt=`shown${rt}`,ni=`hide${rt}`,Ri=`hidden${rt}`,bi=`click${rt}.data-api`,zi="show",xi="collapse",un="collapsing",hn=`:scope .${xi} .${xi}`,He='[data-bs-toggle="collapse"]',hi={parent:null,toggle:!0},wi={parent:"(null|element)",toggle:"boolean"};class Bi extends Mi{constructor(D,se){super(D,se),this._isTransitioning=!1,this._triggerArray=[];const De=It.find(He);for(const ht of De){const Et=It.getSelectorFromElement(ht),Wt=It.find(Et).filter(Zi=>Zi===this._element);Et!==null&&Wt.length&&this._triggerArray.push(ht)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return hi}static get DefaultType(){return wi}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let D=[];if(this._config.parent&&(D=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(ht=>ht!==this._element).map(ht=>Bi.getOrCreateInstance(ht,{toggle:!1}))),D.length&&D[0]._isTransitioning||tt.trigger(this._element,Ct).defaultPrevented)return;for(const ht of D)ht.hide();const se=this._getDimension();this._element.classList.remove(xi),this._element.classList.add(un),this._element.style[se]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const De=`scroll${se[0].toUpperCase()+se.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(un),this._element.classList.add(xi,zi),this._element.style[se]="",tt.trigger(this._element,Xt)},this._element,!0),this._element.style[se]=`${this._element[De]}px`}hide(){if(this._isTransitioning||!this._isShown()||tt.trigger(this._element,ni).defaultPrevented)return;const D=this._getDimension();this._element.style[D]=`${this._element.getBoundingClientRect()[D]}px`,R(this._element),this._element.classList.add(un),this._element.classList.remove(xi,zi);for(const se of this._triggerArray){const De=It.getElementFromSelector(se);De&&!this._isShown(De)&&this._addAriaAndCollapsedClass([se],!1)}this._isTransitioning=!0,this._element.style[D]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(un),this._element.classList.add(xi),tt.trigger(this._element,Ri)},this._element,!0)}_isShown(D=this._element){return D.classList.contains(zi)}_configAfterMerge(D){return D.toggle=!!D.toggle,D.parent=k(D.parent),D}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const D=this._getFirstLevelChildren(He);for(const se of D){const De=It.getElementFromSelector(se);De&&this._addAriaAndCollapsedClass([se],this._isShown(De))}}_getFirstLevelChildren(D){const se=It.find(hn,this._config.parent);return It.find(D,this._config.parent).filter(De=>!se.includes(De))}_addAriaAndCollapsedClass(D,se){if(D.length)for(const De of D)De.classList.toggle("collapsed",!se),De.setAttribute("aria-expanded",se)}static jQueryInterface(D){const se={};return typeof D=="string"&&/show|hide/.test(D)&&(se.toggle=!1),this.each(function(){const De=Bi.getOrCreateInstance(this,se);if(typeof D=="string"){if(De[D]===void 0)throw new TypeError(`No method named "${D}"`);De[D]()}})}}tt.on(document,bi,He,function(Be){(Be.target.tagName==="A"||Be.delegateTarget&&Be.delegateTarget.tagName==="A")&&Be.preventDefault();for(const D of It.getMultipleElementsFromSelector(this))Bi.getOrCreateInstance(D,{toggle:!1}).toggle()}),ae(Bi);const Gi="dropdown",Hi=".bs.dropdown",jn=".data-api",ri="ArrowUp",Xr="ArrowDown",Gn=`hide${Hi}`,Un=`hidden${Hi}`,pn=`show${Hi}`,ma=`shown${Hi}`,zn=`click${Hi}${jn}`,Hn=`keydown${Hi}${jn}`,Dr=`keyup${Hi}${jn}`,Rn="show",Ei='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',No=`${Ei}.${Rn}`,ir=".dropdown-menu",En=ie()?"top-end":"top-start",ga=ie()?"top-start":"top-end",Fr=ie()?"bottom-end":"bottom-start",ol=ie()?"bottom-start":"bottom-end",Rr=ie()?"left-start":"right-start",eu=ie()?"right-start":"left-start",_a={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Hs={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Bn extends Mi{constructor(D,se){super(D,se),this._popper=null,this._parent=this._element.parentNode,this._menu=It.next(this._element,ir)[0]||It.prev(this._element,ir)[0]||It.findOne(ir,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return _a}static get DefaultType(){return Hs}static get NAME(){return Gi}toggle(){return this._isShown()?this.hide():this.show()}show(){if(C(this._element)||this._isShown())return;const D={relatedTarget:this._element};if(!tt.trigger(this._element,pn,D).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const se of[].concat(...document.body.children))tt.on(se,"mouseover",N);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Rn),this._element.classList.add(Rn),tt.trigger(this._element,ma,D)}}hide(){if(C(this._element)||!this._isShown())return;const D={relatedTarget:this._element};this._completeHide(D)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(D){if(!tt.trigger(this._element,Gn,D).defaultPrevented){if("ontouchstart"in document.documentElement)for(const se of[].concat(...document.body.children))tt.off(se,"mouseover",N);this._popper&&this._popper.destroy(),this._menu.classList.remove(Rn),this._element.classList.remove(Rn),this._element.setAttribute("aria-expanded","false"),oi.removeDataAttribute(this._menu,"popper"),tt.trigger(this._element,Un,D)}}_getConfig(D){if(typeof(D=super._getConfig(D)).reference=="object"&&!y(D.reference)&&typeof D.reference.getBoundingClientRect!="function")throw new TypeError(`${Gi.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return D}_createPopper(){if(u===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let D=this._element;this._config.reference==="parent"?D=this._parent:y(this._config.reference)?D=k(this._config.reference):typeof this._config.reference=="object"&&(D=this._config.reference);const se=this._getPopperConfig();this._popper=u.createPopper(D,this._menu,se)}_isShown(){return this._menu.classList.contains(Rn)}_getPlacement(){const D=this._parent;if(D.classList.contains("dropend"))return Rr;if(D.classList.contains("dropstart"))return eu;if(D.classList.contains("dropup-center"))return"top";if(D.classList.contains("dropdown-center"))return"bottom";const se=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return D.classList.contains("dropup")?se?ga:En:se?ol:Fr}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:D}=this._config;return typeof D=="string"?D.split(",").map(se=>Number.parseInt(se,10)):typeof D=="function"?se=>D(se,this._element):D}_getPopperConfig(){const D={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(oi.setDataAttribute(this._menu,"popper","static"),D.modifiers=[{name:"applyStyles",enabled:!1}]),{...D,...$(this._config.popperConfig,[void 0,D])}}_selectMenuItem({key:D,target:se}){const De=It.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(ht=>I(ht));De.length&&j(De,se,D===Xr,!De.includes(se)).focus()}static jQueryInterface(D){return this.each(function(){const se=Bn.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0)throw new TypeError(`No method named "${D}"`);se[D]()}})}static clearMenus(D){if(D.button===2||D.type==="keyup"&&D.key!=="Tab")return;const se=It.find(No);for(const De of se){const ht=Bn.getInstance(De);if(!ht||ht._config.autoClose===!1)continue;const Et=D.composedPath(),Wt=Et.includes(ht._menu);if(Et.includes(ht._element)||ht._config.autoClose==="inside"&&!Wt||ht._config.autoClose==="outside"&&Wt||ht._menu.contains(D.target)&&(D.type==="keyup"&&D.key==="Tab"||/input|select|option|textarea|form/i.test(D.target.tagName)))continue;const Zi={relatedTarget:ht._element};D.type==="click"&&(Zi.clickEvent=D),ht._completeHide(Zi)}}static dataApiKeydownHandler(D){const se=/input|textarea/i.test(D.target.tagName),De=D.key==="Escape",ht=[ri,Xr].includes(D.key);if(!ht&&!De||se&&!De)return;D.preventDefault();const Et=this.matches(Ei)?this:It.prev(this,Ei)[0]||It.next(this,Ei)[0]||It.findOne(Ei,D.delegateTarget.parentNode),Wt=Bn.getOrCreateInstance(Et);if(ht)return D.stopPropagation(),Wt.show(),void Wt._selectMenuItem(D);Wt._isShown()&&(D.stopPropagation(),Wt.hide(),Et.focus())}}tt.on(document,Hn,Ei,Bn.dataApiKeydownHandler),tt.on(document,Hn,ir,Bn.dataApiKeydownHandler),tt.on(document,zn,Bn.clearMenus),tt.on(document,Dr,Bn.clearMenus),tt.on(document,zn,Ei,function(Be){Be.preventDefault(),Bn.getOrCreateInstance(this).toggle()}),ae(Bn);const qi="backdrop",ya="show",ba=`mousedown.bs.${qi}`,fo={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},al={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class jo extends Ai{constructor(D){super(),this._config=this._getConfig(D),this._isAppended=!1,this._element=null}static get Default(){return fo}static get DefaultType(){return al}static get NAME(){return qi}show(D){if(!this._config.isVisible)return void $(D);this._append();const se=this._getElement();this._config.isAnimated&&R(se),se.classList.add(ya),this._emulateAnimation(()=>{$(D)})}hide(D){this._config.isVisible?(this._getElement().classList.remove(ya),this._emulateAnimation(()=>{this.dispose(),$(D)})):$(D)}dispose(){this._isAppended&&(tt.off(this._element,ba),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const D=document.createElement("div");D.className=this._config.className,this._config.isAnimated&&D.classList.add("fade"),this._element=D}return this._element}_configAfterMerge(D){return D.rootElement=k(D.rootElement),D}_append(){if(this._isAppended)return;const D=this._getElement();this._config.rootElement.append(D),tt.on(D,ba,()=>{$(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(D){re(D,this._getElement(),this._config.isAnimated)}}const Es=".bs.focustrap",va=`focusin${Es}`,po=`keydown.tab${Es}`,ll="backward",tu={autofocus:!0,trapElement:null},ql={autofocus:"boolean",trapElement:"element"};class Zl extends Ai{constructor(D){super(),this._config=this._getConfig(D),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return tu}static get DefaultType(){return ql}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),tt.off(document,Es),tt.on(document,va,D=>this._handleFocusin(D)),tt.on(document,po,D=>this._handleKeydown(D)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,tt.off(document,Es))}_handleFocusin(D){const{trapElement:se}=this._config;if(D.target===document||D.target===se||se.contains(D.target))return;const De=It.focusableChildren(se);De.length===0?se.focus():this._lastTabNavDirection===ll?De[De.length-1].focus():De[0].focus()}_handleKeydown(D){D.key==="Tab"&&(this._lastTabNavDirection=D.shiftKey?ll:"forward")}}const Is=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",mo=".sticky-top",Vn="padding-right",Qn="margin-right";class go{constructor(){this._element=document.body}getWidth(){const D=document.documentElement.clientWidth;return Math.abs(window.innerWidth-D)}hide(){const D=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Vn,se=>se+D),this._setElementAttributes(Is,Vn,se=>se+D),this._setElementAttributes(mo,Qn,se=>se-D)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Vn),this._resetElementAttributes(Is,Vn),this._resetElementAttributes(mo,Qn)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(D,se,De){const ht=this.getWidth();this._applyManipulationCallback(D,Et=>{if(Et!==this._element&&window.innerWidth>Et.clientWidth+ht)return;this._saveInitialAttribute(Et,se);const Wt=window.getComputedStyle(Et).getPropertyValue(se);Et.style.setProperty(se,`${De(Number.parseFloat(Wt))}px`)})}_saveInitialAttribute(D,se){const De=D.style.getPropertyValue(se);De&&oi.setDataAttribute(D,se,De)}_resetElementAttributes(D,se){this._applyManipulationCallback(D,De=>{const ht=oi.getDataAttribute(De,se);ht!==null?(oi.removeDataAttribute(De,se),De.style.setProperty(se,ht)):De.style.removeProperty(se)})}_applyManipulationCallback(D,se){if(y(D))se(D);else for(const De of It.find(D,this._element))se(De)}}const $n=".bs.modal",wa=`hide${$n}`,Wl=`hidePrevented${$n}`,Xs=`hidden${$n}`,Gl=`show${$n}`,Hl=`shown${$n}`,Xl=`resize${$n}`,iu=`click.dismiss${$n}`,nu=`mousedown.dismiss${$n}`,Kl=`keydown.dismiss${$n}`,Uo=`click${$n}.data-api`,xa="modal-open",Vo="show",qo="modal-static",cl={backdrop:!0,focus:!0,keyboard:!0},Kr={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Ks extends Mi{constructor(D,se){super(D,se),this._dialog=It.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new go,this._addEventListeners()}static get Default(){return cl}static get DefaultType(){return Kr}static get NAME(){return"modal"}toggle(D){return this._isShown?this.hide():this.show(D)}show(D){this._isShown||this._isTransitioning||tt.trigger(this._element,Gl,{relatedTarget:D}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(xa),this._adjustDialog(),this._backdrop.show(()=>this._showElement(D)))}hide(){this._isShown&&!this._isTransitioning&&(tt.trigger(this._element,wa).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Vo),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){tt.off(window,$n),tt.off(this._dialog,$n),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new jo({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Zl({trapElement:this._element})}_showElement(D){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const se=It.findOne(".modal-body",this._dialog);se&&(se.scrollTop=0),R(this._element),this._element.classList.add(Vo),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,tt.trigger(this._element,Hl,{relatedTarget:D})},this._dialog,this._isAnimated())}_addEventListeners(){tt.on(this._element,Kl,D=>{D.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),tt.on(window,Xl,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),tt.on(this._element,nu,D=>{tt.one(this._element,iu,se=>{this._element===D.target&&this._element===se.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(xa),this._resetAdjustments(),this._scrollBar.reset(),tt.trigger(this._element,Xs)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(tt.trigger(this._element,Wl).defaultPrevented)return;const D=this._element.scrollHeight>document.documentElement.clientHeight,se=this._element.style.overflowY;se==="hidden"||this._element.classList.contains(qo)||(D||(this._element.style.overflowY="hidden"),this._element.classList.add(qo),this._queueCallback(()=>{this._element.classList.remove(qo),this._queueCallback(()=>{this._element.style.overflowY=se},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const D=this._element.scrollHeight>document.documentElement.clientHeight,se=this._scrollBar.getWidth(),De=se>0;if(De&&!D){const ht=ie()?"paddingLeft":"paddingRight";this._element.style[ht]=`${se}px`}if(!De&&D){const ht=ie()?"paddingRight":"paddingLeft";this._element.style[ht]=`${se}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(D,se){return this.each(function(){const De=Ks.getOrCreateInstance(this,D);if(typeof D=="string"){if(De[D]===void 0)throw new TypeError(`No method named "${D}"`);De[D](se)}})}}tt.on(document,Uo,'[data-bs-toggle="modal"]',function(Be){const D=It.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&Be.preventDefault(),tt.one(D,Gl,De=>{De.defaultPrevented||tt.one(D,Xs,()=>{I(this)&&this.focus()})});const se=It.findOne(".modal.show");se&&Ks.getInstance(se).hide(),Ks.getOrCreateInstance(D).toggle(this)}),Ge(Ks),ae(Ks);const Br=".bs.offcanvas",As=".data-api",Ms=`load${Br}${As}`,Wi="show",Zo="showing",Jl="hiding",Js=".offcanvas.show",ru=`show${Br}`,Yl=`shown${Br}`,su=`hide${Br}`,ul=`hidePrevented${Br}`,Sa=`hidden${Br}`,Ql=`resize${Br}`,$l=`click${Br}${As}`,ec=`keydown.dismiss${Br}`,tc={backdrop:!0,keyboard:!0,scroll:!1},Ys={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Jr extends Mi{constructor(D,se){super(D,se),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return tc}static get DefaultType(){return Ys}static get NAME(){return"offcanvas"}toggle(D){return this._isShown?this.hide():this.show(D)}show(D){this._isShown||tt.trigger(this._element,ru,{relatedTarget:D}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new go().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Zo),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Wi),this._element.classList.remove(Zo),tt.trigger(this._element,Yl,{relatedTarget:D})},this._element,!0))}hide(){this._isShown&&(tt.trigger(this._element,su).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Jl),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Wi,Jl),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new go().reset(),tt.trigger(this._element,Sa)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const D=!!this._config.backdrop;return new jo({className:"offcanvas-backdrop",isVisible:D,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:D?()=>{this._config.backdrop!=="static"?this.hide():tt.trigger(this._element,ul)}:null})}_initializeFocusTrap(){return new Zl({trapElement:this._element})}_addEventListeners(){tt.on(this._element,ec,D=>{D.key==="Escape"&&(this._config.keyboard?this.hide():tt.trigger(this._element,ul))})}static jQueryInterface(D){return this.each(function(){const se=Jr.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D](this)}})}}tt.on(document,$l,'[data-bs-toggle="offcanvas"]',function(Be){const D=It.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&Be.preventDefault(),C(this))return;tt.one(D,Sa,()=>{I(this)&&this.focus()});const se=It.findOne(Js);se&&se!==D&&Jr.getInstance(se).hide(),Jr.getOrCreateInstance(D).toggle(this)}),tt.on(window,Ms,()=>{for(const Be of It.find(Js))Jr.getOrCreateInstance(Be).show()}),tt.on(window,Ql,()=>{for(const Be of It.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(Be).position!=="fixed"&&Jr.getOrCreateInstance(Be).hide()}),Ge(Jr),ae(Jr);const ic={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},nc=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Wo=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,ou=(Be,D)=>{const se=Be.nodeName.toLowerCase();return D.includes(se)?!nc.has(se)||!!Wo.test(Be.nodeValue):D.filter(De=>De instanceof RegExp).some(De=>De.test(se))},Ta={allowList:ic,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},au={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},lu={entry:"(string|element|function|null)",selector:"(string|element)"};class rc extends Ai{constructor(D){super(),this._config=this._getConfig(D)}static get Default(){return Ta}static get DefaultType(){return au}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(D=>this._resolvePossibleFunction(D)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(D){return this._checkContent(D),this._config.content={...this._config.content,...D},this}toHtml(){const D=document.createElement("div");D.innerHTML=this._maybeSanitize(this._config.template);for(const[ht,Et]of Object.entries(this._config.content))this._setContent(D,Et,ht);const se=D.children[0],De=this._resolvePossibleFunction(this._config.extraClass);return De&&se.classList.add(...De.split(" ")),se}_typeCheckConfig(D){super._typeCheckConfig(D),this._checkContent(D.content)}_checkContent(D){for(const[se,De]of Object.entries(D))super._typeCheckConfig({selector:se,entry:De},lu)}_setContent(D,se,De){const ht=It.findOne(De,D);ht&&((se=this._resolvePossibleFunction(se))?y(se)?this._putElementInTemplate(k(se),ht):this._config.html?ht.innerHTML=this._maybeSanitize(se):ht.textContent=se:ht.remove())}_maybeSanitize(D){return this._config.sanitize?function(se,De,ht){if(!se.length)return se;if(ht&&typeof ht=="function")return ht(se);const Et=new window.DOMParser().parseFromString(se,"text/html"),Wt=[].concat(...Et.body.querySelectorAll("*"));for(const Zi of Wt){const on=Zi.nodeName.toLowerCase();if(!Object.keys(De).includes(on)){Zi.remove();continue}const On=[].concat(...Zi.attributes),In=[].concat(De["*"]||[],De[on]||[]);for(const mr of On)ou(mr,In)||Zi.removeAttribute(mr.nodeName)}return Et.body.innerHTML}(D,this._config.allowList,this._config.sanitizeFn):D}_resolvePossibleFunction(D){return $(D,[void 0,this])}_putElementInTemplate(D,se){if(this._config.html)return se.innerHTML="",void se.append(D);se.textContent=D.textContent}}const sc=new Set(["sanitize","allowList","sanitizeFn"]),ka="fade",_o="show",oc=".tooltip-inner",Go=".modal",Yr="hide.bs.modal",Qs="hover",Ho="focus",Xo="click",Ca={AUTO:"auto",TOP:"top",RIGHT:ie()?"left":"right",BOTTOM:"bottom",LEFT:ie()?"right":"left"},hl={allowList:ic,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},$s={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class fs extends Mi{constructor(D,se){if(u===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(D,se),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return hl}static get DefaultType(){return $s}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),tt.off(this._element.closest(Go),Yr,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const D=tt.trigger(this._element,this.constructor.eventName("show")),se=(L(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(D.defaultPrevented||!se)return;this._disposePopper();const De=this._getTipElement();this._element.setAttribute("aria-describedby",De.getAttribute("id"));const{container:ht}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(ht.append(De),tt.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(De),De.classList.add(_o),"ontouchstart"in document.documentElement)for(const Et of[].concat(...document.body.children))tt.on(Et,"mouseover",N);this._queueCallback(()=>{tt.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!tt.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(_o),"ontouchstart"in document.documentElement)for(const D of[].concat(...document.body.children))tt.off(D,"mouseover",N);this._activeTrigger[Xo]=!1,this._activeTrigger[Ho]=!1,this._activeTrigger[Qs]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),tt.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(D){const se=this._getTemplateFactory(D).toHtml();if(!se)return null;se.classList.remove(ka,_o),se.classList.add(`bs-${this.constructor.NAME}-auto`);const De=(ht=>{do ht+=Math.floor(1e6*Math.random());while(document.getElementById(ht));return ht})(this.constructor.NAME).toString();return se.setAttribute("id",De),this._isAnimated()&&se.classList.add(ka),se}setContent(D){this._newContent=D,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(D){return this._templateFactory?this._templateFactory.changeContent(D):this._templateFactory=new rc({...this._config,content:D,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[oc]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(D){return this.constructor.getOrCreateInstance(D.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(ka)}_isShown(){return this.tip&&this.tip.classList.contains(_o)}_createPopper(D){const se=$(this._config.placement,[this,D,this._element]),De=Ca[se.toUpperCase()];return u.createPopper(this._element,D,this._getPopperConfig(De))}_getOffset(){const{offset:D}=this._config;return typeof D=="string"?D.split(",").map(se=>Number.parseInt(se,10)):typeof D=="function"?se=>D(se,this._element):D}_resolvePossibleFunction(D){return $(D,[this._element,this._element])}_getPopperConfig(D){const se={placement:D,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:De=>{this._getTipElement().setAttribute("data-popper-placement",De.state.placement)}}]};return{...se,...$(this._config.popperConfig,[void 0,se])}}_setListeners(){const D=this._config.trigger.split(" ");for(const se of D)if(se==="click")tt.on(this._element,this.constructor.eventName("click"),this._config.selector,De=>{const ht=this._initializeOnDelegatedTarget(De);ht._activeTrigger[Xo]=!(ht._isShown()&&ht._activeTrigger[Xo]),ht.toggle()});else if(se!=="manual"){const De=se===Qs?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),ht=se===Qs?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");tt.on(this._element,De,this._config.selector,Et=>{const Wt=this._initializeOnDelegatedTarget(Et);Wt._activeTrigger[Et.type==="focusin"?Ho:Qs]=!0,Wt._enter()}),tt.on(this._element,ht,this._config.selector,Et=>{const Wt=this._initializeOnDelegatedTarget(Et);Wt._activeTrigger[Et.type==="focusout"?Ho:Qs]=Wt._element.contains(Et.relatedTarget),Wt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},tt.on(this._element.closest(Go),Yr,this._hideModalHandler)}_fixTitle(){const D=this._element.getAttribute("title");D&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",D),this._element.setAttribute("data-bs-original-title",D),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(D,se){clearTimeout(this._timeout),this._timeout=setTimeout(D,se)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(D){const se=oi.getDataAttributes(this._element);for(const De of Object.keys(se))sc.has(De)&&delete se[De];return D={...se,...typeof D=="object"&&D?D:{}},D=this._mergeConfigObj(D),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}_configAfterMerge(D){return D.container=D.container===!1?document.body:k(D.container),typeof D.delay=="number"&&(D.delay={show:D.delay,hide:D.delay}),typeof D.title=="number"&&(D.title=D.title.toString()),typeof D.content=="number"&&(D.content=D.content.toString()),D}_getDelegateConfig(){const D={};for(const[se,De]of Object.entries(this._config))this.constructor.Default[se]!==De&&(D[se]=De);return D.selector=!1,D.trigger="manual",D}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(D){return this.each(function(){const se=fs.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0)throw new TypeError(`No method named "${D}"`);se[D]()}})}}ae(fs);const cu=".popover-header",Tn=".popover-body",uu={...fs.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Pi={...fs.DefaultType,content:"(null|string|element|function)"};class eo extends fs{static get Default(){return uu}static get DefaultType(){return Pi}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[cu]:this._getTitle(),[Tn]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(D){return this.each(function(){const se=eo.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0)throw new TypeError(`No method named "${D}"`);se[D]()}})}}ae(eo);const Qi=".bs.scrollspy",$i=`activate${Qi}`,Ps=`click${Qi}`,Ko=`load${Qi}.data-api`,Qr="active",Jo="[href]",Ls=".nav-link",yo=`${Ls}, .nav-item > ${Ls}, .list-group-item`,kr={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},fl={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class to extends Mi{constructor(D,se){super(D,se),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return kr}static get DefaultType(){return fl}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const D of this._observableSections.values())this._observer.observe(D)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(D){return D.target=k(D.target)||document.body,D.rootMargin=D.offset?`${D.offset}px 0px -30%`:D.rootMargin,typeof D.threshold=="string"&&(D.threshold=D.threshold.split(",").map(se=>Number.parseFloat(se))),D}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(tt.off(this._config.target,Ps),tt.on(this._config.target,Ps,Jo,D=>{const se=this._observableSections.get(D.target.hash);if(se){D.preventDefault();const De=this._rootElement||window,ht=se.offsetTop-this._element.offsetTop;if(De.scrollTo)return void De.scrollTo({top:ht,behavior:"smooth"});De.scrollTop=ht}}))}_getNewObserver(){const D={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(se=>this._observerCallback(se),D)}_observerCallback(D){const se=Wt=>this._targetLinks.get(`#${Wt.target.id}`),De=Wt=>{this._previousScrollData.visibleEntryTop=Wt.target.offsetTop,this._process(se(Wt))},ht=(this._rootElement||document.documentElement).scrollTop,Et=ht>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=ht;for(const Wt of D){if(!Wt.isIntersecting){this._activeTarget=null,this._clearActiveClass(se(Wt));continue}const Zi=Wt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Et&&Zi){if(De(Wt),!ht)return}else Et||Zi||De(Wt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const D=It.find(Jo,this._config.target);for(const se of D){if(!se.hash||C(se))continue;const De=It.findOne(decodeURI(se.hash),this._element);I(De)&&(this._targetLinks.set(decodeURI(se.hash),se),this._observableSections.set(se.hash,De))}}_process(D){this._activeTarget!==D&&(this._clearActiveClass(this._config.target),this._activeTarget=D,D.classList.add(Qr),this._activateParents(D),tt.trigger(this._element,$i,{relatedTarget:D}))}_activateParents(D){if(D.classList.contains("dropdown-item"))It.findOne(".dropdown-toggle",D.closest(".dropdown")).classList.add(Qr);else for(const se of It.parents(D,".nav, .list-group"))for(const De of It.prev(se,yo))De.classList.add(Qr)}_clearActiveClass(D){D.classList.remove(Qr);const se=It.find(`${Jo}.${Qr}`,D);for(const De of se)De.classList.remove(Qr)}static jQueryInterface(D){return this.each(function(){const se=to.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D]()}})}}tt.on(window,Ko,()=>{for(const Be of It.find('[data-bs-spy="scroll"]'))to.getOrCreateInstance(Be)}),ae(to);const ds=".bs.tab",io=`hide${ds}`,Yo=`hidden${ds}`,Qo=`show${ds}`,bo=`shown${ds}`,$o=`click${ds}`,Ea=`keydown${ds}`,vo=`load${ds}`,wo="ArrowLeft",dl="ArrowRight",pl="ArrowUp",Vi="ArrowDown",xo="Home",ac="End",zs="active",no="fade",Ia="show",ea=".dropdown-toggle",Aa=`:not(${ea})`,ml='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',So=`.nav-link${Aa}, .list-group-item${Aa}, [role="tab"]${Aa}, ${ml}`,Ma=`.${zs}[data-bs-toggle="tab"], .${zs}[data-bs-toggle="pill"], .${zs}[data-bs-toggle="list"]`;class Cr extends Mi{constructor(D){super(D),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),tt.on(this._element,Ea,se=>this._keydown(se)))}static get NAME(){return"tab"}show(){const D=this._element;if(this._elemIsActive(D))return;const se=this._getActiveElem(),De=se?tt.trigger(se,io,{relatedTarget:D}):null;tt.trigger(D,Qo,{relatedTarget:se}).defaultPrevented||De&&De.defaultPrevented||(this._deactivate(se,D),this._activate(D,se))}_activate(D,se){D&&(D.classList.add(zs),this._activate(It.getElementFromSelector(D)),this._queueCallback(()=>{D.getAttribute("role")==="tab"?(D.removeAttribute("tabindex"),D.setAttribute("aria-selected",!0),this._toggleDropDown(D,!0),tt.trigger(D,bo,{relatedTarget:se})):D.classList.add(Ia)},D,D.classList.contains(no)))}_deactivate(D,se){D&&(D.classList.remove(zs),D.blur(),this._deactivate(It.getElementFromSelector(D)),this._queueCallback(()=>{D.getAttribute("role")==="tab"?(D.setAttribute("aria-selected",!1),D.setAttribute("tabindex","-1"),this._toggleDropDown(D,!1),tt.trigger(D,Yo,{relatedTarget:se})):D.classList.remove(Ia)},D,D.classList.contains(no)))}_keydown(D){if(![wo,dl,pl,Vi,xo,ac].includes(D.key))return;D.stopPropagation(),D.preventDefault();const se=this._getChildren().filter(ht=>!C(ht));let De;if([xo,ac].includes(D.key))De=se[D.key===xo?0:se.length-1];else{const ht=[dl,Vi].includes(D.key);De=j(se,D.target,ht,!0)}De&&(De.focus({preventScroll:!0}),Cr.getOrCreateInstance(De).show())}_getChildren(){return It.find(So,this._parent)}_getActiveElem(){return this._getChildren().find(D=>this._elemIsActive(D))||null}_setInitialAttributes(D,se){this._setAttributeIfNotExists(D,"role","tablist");for(const De of se)this._setInitialAttributesOnChild(De)}_setInitialAttributesOnChild(D){D=this._getInnerElement(D);const se=this._elemIsActive(D),De=this._getOuterElement(D);D.setAttribute("aria-selected",se),De!==D&&this._setAttributeIfNotExists(De,"role","presentation"),se||D.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(D,"role","tab"),this._setInitialAttributesOnTargetPanel(D)}_setInitialAttributesOnTargetPanel(D){const se=It.getElementFromSelector(D);se&&(this._setAttributeIfNotExists(se,"role","tabpanel"),D.id&&this._setAttributeIfNotExists(se,"aria-labelledby",`${D.id}`))}_toggleDropDown(D,se){const De=this._getOuterElement(D);if(!De.classList.contains("dropdown"))return;const ht=(Et,Wt)=>{const Zi=It.findOne(Et,De);Zi&&Zi.classList.toggle(Wt,se)};ht(ea,zs),ht(".dropdown-menu",Ia),De.setAttribute("aria-expanded",se)}_setAttributeIfNotExists(D,se,De){D.hasAttribute(se)||D.setAttribute(se,De)}_elemIsActive(D){return D.classList.contains(zs)}_getInnerElement(D){return D.matches(So)?D:It.findOne(So,D)}_getOuterElement(D){return D.closest(".nav-item, .list-group-item")||D}static jQueryInterface(D){return this.each(function(){const se=Cr.getOrCreateInstance(this);if(typeof D=="string"){if(se[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);se[D]()}})}}tt.on(document,$o,ml,function(Be){["A","AREA"].includes(this.tagName)&&Be.preventDefault(),C(this)||Cr.getOrCreateInstance(this).show()}),tt.on(window,vo,()=>{for(const Be of It.find(Ma))Cr.getOrCreateInstance(Be)}),ae(Cr);const pr=".bs.toast",To=`mouseover${pr}`,gl=`mouseout${pr}`,ko=`focusin${pr}`,ta=`focusout${pr}`,Pa=`hide${pr}`,La=`hidden${pr}`,_l=`show${pr}`,hu=`shown${pr}`,yl="hide",ro="show",Co="showing",ia={animation:"boolean",autohide:"boolean",delay:"number"},na={animation:!0,autohide:!0,delay:5e3};class Mn extends Mi{constructor(D,se){super(D,se),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return na}static get DefaultType(){return ia}static get NAME(){return"toast"}show(){tt.trigger(this._element,_l).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(yl),R(this._element),this._element.classList.add(ro,Co),this._queueCallback(()=>{this._element.classList.remove(Co),tt.trigger(this._element,hu),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(tt.trigger(this._element,Pa).defaultPrevented||(this._element.classList.add(Co),this._queueCallback(()=>{this._element.classList.add(yl),this._element.classList.remove(Co,ro),tt.trigger(this._element,La)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(ro),super.dispose()}isShown(){return this._element.classList.contains(ro)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(D,se){switch(D.type){case"mouseover":case"mouseout":this._hasMouseInteraction=se;break;case"focusin":case"focusout":this._hasKeyboardInteraction=se}if(se)return void this._clearTimeout();const De=D.relatedTarget;this._element===De||this._element.contains(De)||this._maybeScheduleHide()}_setListeners(){tt.on(this._element,To,D=>this._onInteraction(D,!0)),tt.on(this._element,gl,D=>this._onInteraction(D,!1)),tt.on(this._element,ko,D=>this._onInteraction(D,!0)),tt.on(this._element,ta,D=>this._onInteraction(D,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(D){return this.each(function(){const se=Mn.getOrCreateInstance(this,D);if(typeof D=="string"){if(se[D]===void 0)throw new TypeError(`No method named "${D}"`);se[D](this)}})}}return Ge(Mn),ae(Mn),{Alert:gi,Button:et,Carousel:pt,Collapse:Bi,Dropdown:Bn,Modal:Ks,Offcanvas:Jr,Popover:eo,ScrollSpy:to,Tab:Cr,Toast:Mn,Tooltip:fs}})})(m1);function sw(s){let i,n,l,u,d,f,o;const _=s[2].default,T=vn(_,s,s[1],null);return{c(){i=Ae("div"),n=Ae("label"),l=Ae("input"),u=$e(),T&&T.c(),be(l,"class","form-check-input"),be(l,"type","checkbox"),be(n,"class","form-check-label"),be(i,"class","form-check")},m(S,y){xe(S,i,y),ve(i,n),ve(n,l),l.checked=s[0],ve(n,u),T&&T.m(n,null),d=!0,f||(o=Jt(l,"change",s[3]),f=!0)},p(S,[y]){y&1&&(l.checked=S[0]),T&&T.p&&(!d||y&2)&&xn(T,_,S,S[1],d?wn(_,S[1],y,null):Sn(S[1]),null)},i(S){d||(Re(T,S),d=!0)},o(S){Ve(T,S),d=!1},d(S){S&&we(i),T&&T.d(S),f=!1,o()}}}function ow(s,i,n){let{$$slots:l={},$$scope:u}=i,{checked:d}=i;function f(){d=this.checked,n(0,d)}return s.$$set=o=>{"checked"in o&&n(0,d=o.checked),"$$scope"in o&&n(1,u=o.$$scope)},[d,u,l,f]}class us extends di{constructor(i){super(),fi(this,i,ow,sw,si,{checked:0})}}function dg(s){let i,n,l,u=s[1]!=null&&pg(s);return{c(){i=Ae("div"),n=kt(s[0]),l=$e(),u&&u.c(),be(i,"class","cover svelte-1w7hi45")},m(d,f){xe(d,i,f),ve(i,n),ve(i,l),u&&u.m(i,null)},p(d,f){f&1&&Li(n,d[0]),d[1]!=null?u?u.p(d,f):(u=pg(d),u.c(),u.m(i,null)):u&&(u.d(1),u=null)},d(d){d&&we(i),u&&u.d()}}}function pg(s){let i,n;return{c(){i=Ae("div"),n=Ae("progress"),n.value=s[1],en(n,"width","100%")},m(l,u){xe(l,i,u),ve(i,n)},p(l,u){u&2&&(n.value=l[1])},d(l){l&&we(i)}}}function aw(s){let i,n=s[0]&&dg(s);return{c(){n&&n.c(),i=Ln()},m(l,u){n&&n.m(l,u),xe(l,i,u)},p(l,[u]){l[0]?n?n.p(l,u):(n=dg(l),n.c(),n.m(i.parentNode,i)):n&&(n.d(1),n=null)},i:$t,o:$t,d(l){l&&we(i),n&&n.d(l)}}}function lw(s,i,n){let{loading:l}=i,{progress:u=null}=i;return s.$$set=d=>{"loading"in d&&n(0,l=d.loading),"progress"in d&&n(1,u=d.progress)},[l,u]}class Yc extends di{constructor(i){super(),fi(this,i,lw,aw,si,{loading:0,progress:1})}}function cw(s){let i,n,l,u,d;const f=s[5].default,o=vn(f,s,s[4],null);return{c(){i=Ae("dialog"),n=Ae("div"),o&&o.c(),be(n,"class","svelte-y9d9eu"),be(i,"class","svelte-y9d9eu")},m(_,T){xe(_,i,T),ve(i,n),o&&o.m(n,null),s[6](i),l=!0,u||(d=[Jt(i,"click",r1(s[1])),Jt(i,"keydown",s[2])],u=!0)},p(_,[T]){o&&o.p&&(!l||T&16)&&xn(o,f,_,_[4],l?wn(f,_[4],T,null):Sn(_[4]),null)},i(_){l||(Re(o,_),l=!0)},o(_){Ve(o,_),l=!1},d(_){_&&we(i),o&&o.d(_),s[6](null),u=!1,Yn(d)}}}function uw(s,i,n){let{$$slots:l={},$$scope:u}=i,{show:d=!1}=i,f;function o(S){S.target==f&&n(3,d=!1)}function _(S){(S.key=="Escape"||S.key=="Enter")&&(S.stopPropagation(),n(3,d=!1))}function T(S){Si[S?"unshift":"push"](()=>{f=S,n(0,f)})}return s.$$set=S=>{"show"in S&&n(3,d=S.show),"$$scope"in S&&n(4,u=S.$$scope)},s.$$.update=()=>{s.$$.dirty&9&&f&&(d?f.showModal():f.close())},[f,o,_,d,u,l,T]}let fp=class extends di{constructor(i){super(),fi(this,i,uw,cw,si,{show:3})}};function mg(s,i,n){const l=s.slice();return l[4]=i[n][0],l[5]=i[n][1],l}function gg(s){let i,n,l,u,d=s[4]+"",f,o;return{c(){i=Ae("div"),n=Ae("span"),u=$e(),f=kt(d),o=$e(),be(n,"class",l="color-swatch "+s[1]+" svelte-1enycr6"),en(n,"background",s[5]),en(i,"display","flex"),en(i,"align-items","center"),en(i,"gap","6px")},m(_,T){xe(_,i,T),ve(i,n),ve(i,u),ve(i,f),ve(i,o)},p(_,T){T&2&&l!==(l="color-swatch "+_[1]+" svelte-1enycr6")&&be(n,"class",l),T&1&&en(n,"background",_[5]),T&1&&d!==(d=_[4]+"")&&Li(f,d)},d(_){_&&we(i)}}}function hw(s){let i,n=Ki(Object.entries(s[0])),l=[];for(let u=0;u<n.length;u+=1)l[u]=gg(mg(s,n,u));return{c(){i=Ae("div");for(let u=0;u<l.length;u+=1)l[u].c();en(i,"display","grid"),en(i,"grid-template-columns","repeat(auto-fill, calc("+s[2]+" - 10px))"),en(i,"gap","10px")},m(u,d){xe(u,i,d);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(i,null)},p(u,[d]){if(d&3){n=Ki(Object.entries(u[0]));let f;for(f=0;f<n.length;f+=1){const o=mg(u,n,f);l[f]?l[f].p(o,d):(l[f]=gg(o),l[f].c(),l[f].m(i,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=n.length}d&4&&en(i,"grid-template-columns","repeat(auto-fill, calc("+u[2]+" - 10px))")},i:$t,o:$t,d(u){u&&we(i),xr(l,u)}}}function fw(s,i,n){let l,{labelColors:u}=i,{swatchClass:d="rectangle"}=i,{itemsPerRow:f=2}=i;return s.$$set=o=>{"labelColors"in o&&n(0,u=o.labelColors),"swatchClass"in o&&n(1,d=o.swatchClass),"itemsPerRow"in o&&n(3,f=o.itemsPerRow)},s.$$.update=()=>{s.$$.dirty&8&&n(2,l=`${100/f}%`)},[u,d,l,f]}class dw extends di{constructor(i){super(),fi(this,i,fw,hw,si,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function S0(s,i){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(i)),n.setAttribute("download",s),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function _g(s){if(s==null||s==null)throw new Error("Oops, notNull given something null");return s}const Lc=[];function xd(s,i){return{subscribe:kn(s,i).subscribe}}function kn(s,i=$t){let n;const l=new Set;function u(o){if(si(s,o)&&(s=o,n)){const _=!Lc.length;for(const T of l)T[1](),Lc.push(T,s);if(_){for(let T=0;T<Lc.length;T+=2)Lc[T][0](Lc[T+1]);Lc.length=0}}}function d(o){u(o(s))}function f(o,_=$t){const T=[o,_];return l.add(T),l.size===1&&(n=i(u,d)||$t),o(s),()=>{l.delete(T),l.size===0&&n&&(n(),n=null)}}return{set:u,update:d,subscribe:f}}let mi,Xu=null;function Vc(){return(Xu===null||Xu.byteLength===0)&&(Xu=new Uint8Array(mi.memory.buffer)),Xu}let sf=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});sf.decode();const pw=2146435072;let Sd=0;function mw(s,i){return Sd+=i,Sd>=pw&&(sf=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),sf.decode(),Sd=i),sf.decode(Vc().subarray(s,s+i))}function ls(s,i){return s=s>>>0,mw(s,i)}function $a(s){return s==null}let Dl=null;function zo(){return(Dl===null||Dl.buffer.detached===!0||Dl.buffer.detached===void 0&&Dl.buffer!==mi.memory.buffer)&&(Dl=new DataView(mi.memory.buffer)),Dl}function Bd(s){const i=typeof s;if(i=="number"||i=="boolean"||s==null)return`${s}`;if(i=="string")return`"${s}"`;if(i=="symbol"){const u=s.description;return u==null?"Symbol":`Symbol(${u})`}if(i=="function"){const u=s.name;return typeof u=="string"&&u.length>0?`Function(${u})`:"Function"}if(Array.isArray(s)){const u=s.length;let d="[";u>0&&(d+=Bd(s[0]));for(let f=1;f<u;f++)d+=", "+Bd(s[f]);return d+="]",d}const n=/\[object ([^\]]+)\]/.exec(toString.call(s));let l;if(n&&n.length>1)l=n[1];else return toString.call(s);if(l=="Object")try{return"Object("+JSON.stringify(s)+")"}catch{return"Object"}return s instanceof Error?`${s.name}: ${s.message}
${s.stack}`:l}let Nl=0;const th=new TextEncoder;"encodeInto"in th||(th.encodeInto=function(s,i){const n=th.encode(s);return i.set(n),{read:s.length,written:n.length}});function Td(s,i,n){if(n===void 0){const o=th.encode(s),_=i(o.length,1)>>>0;return Vc().subarray(_,_+o.length).set(o),Nl=o.length,_}let l=s.length,u=i(l,1)>>>0;const d=Vc();let f=0;for(;f<l;f++){const o=s.charCodeAt(f);if(o>127)break;d[u+f]=o}if(f!==l){f!==0&&(s=s.slice(f)),u=n(u,l,l=f+s.length*3,1)>>>0;const o=Vc().subarray(u+f,u+l),_=th.encodeInto(s,o);f+=_.written,u=n(u,l,f,1)>>>0}return Nl=f,u}function gw(s){const i=mi.__externref_table_alloc();return mi.__wbindgen_externrefs.set(i,s),i}function kd(s,i){try{return s.apply(this,i)}catch(n){const l=gw(n);mi.__wbindgen_exn_store(l)}}function _w(s,i){return s=s>>>0,Vc().subarray(s/1,s/1+i)}function Or(s){const i=mi.__wbindgen_externrefs.get(s);return mi.__externref_table_dealloc(s),i}function yw(s,i){const n=i(s.length*1,1)>>>0;return Vc().set(s,n/1),Nl=s.length,n}const yg=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(s=>mi.__wbg_speedwalk_free(s>>>0,1));class oh{__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,yg.unregister(this),i}free(){const i=this.__destroy_into_raw();mi.__wbg_speedwalk_free(i,0)}get timestamp(){const i=mi.__wbg_get_speedwalk_timestamp(this.__wbg_ptr);return i[0]===0?void 0:i[1]}set timestamp(i){mi.__wbg_set_speedwalk_timestamp(this.__wbg_ptr,!$a(i),$a(i)?BigInt(0):i)}editClear(){mi.speedwalk_editClear(this.__wbg_ptr)}getMetrics(){let i,n;try{const d=mi.speedwalk_getMetrics(this.__wbg_ptr);var l=d[0],u=d[1];if(d[3])throw l=0,u=0,Or(d[2]);return i=l,n=u,ls(l,u)}finally{mi.__wbindgen_free(i,n,1)}}getBoundary(){let i,n;try{const d=mi.speedwalk_getBoundary(this.__wbg_ptr);var l=d[0],u=d[1];if(d[3])throw l=0,u=0,Or(d[2]);return i=l,n=u,ls(l,u)}finally{mi.__wbindgen_free(i,n,1)}}editSetTags(i,n){const l=mi.speedwalk_editSetTags(this.__wbg_ptr,i,n);if(l[1])throw Or(l[0])}editAssumeTags(i){const n=mi.speedwalk_editAssumeTags(this.__wbg_ptr,i);if(n[1])throw Or(n[0])}getOsmTimestamp(){const i=mi.speedwalk_getOsmTimestamp(this.__wbg_ptr);return i[0]===0?void 0:i[1]}toOsmChangeJson(){let i,n;try{const d=mi.speedwalk_toOsmChangeJson(this.__wbg_ptr);var l=d[0],u=d[1];if(d[3])throw l=0,u=0,Or(d[2]);return i=l,n=u,ls(l,u)}finally{mi.__wbindgen_free(i,n,1)}}getSideLocations(i){let n,l;try{const f=mi.speedwalk_getSideLocations(this.__wbg_ptr,i);var u=f[0],d=f[1];if(f[3])throw u=0,d=0,Or(f[2]);return n=u,l=d,ls(u,d)}finally{mi.__wbindgen_free(n,l,1)}}auditCrossings(i){let n,l;try{const f=mi.speedwalk_auditCrossings(this.__wbg_ptr,i);var u=f[0],d=f[1];if(f[3])throw u=0,d=0,Or(f[2]);return n=u,l=d,ls(u,d)}finally{mi.__wbindgen_free(n,l,1)}}editAddNewCrossing(i,n){const l=mi.speedwalk_editAddNewCrossing(this.__wbg_ptr,i,n);if(l[1])throw Or(l[0])}editMakeAllSidewalks(i){const n=mi.speedwalk_editMakeAllSidewalks(this.__wbg_ptr,i);if(n[1])throw Or(n[0])}editConnectAllCrossings(){const i=mi.speedwalk_editConnectAllCrossings(this.__wbg_ptr);if(i[1])throw Or(i[0])}findConnectedComponents(){let i,n;try{const d=mi.speedwalk_findConnectedComponents(this.__wbg_ptr);var l=d[0],u=d[1];if(d[3])throw l=0,u=0,Or(d[2]);return i=l,n=u,ls(l,u)}finally{mi.__wbindgen_free(i,n,1)}}constructor(i,n){const l=yw(i,mi.__wbindgen_malloc),u=Nl,d=mi.speedwalk_new(l,u,n);if(d[2])throw Or(d[1]);return this.__wbg_ptr=d[0]>>>0,yg.register(this,this.__wbg_ptr,this),this}toOsc(){let i,n;try{const l=mi.speedwalk_toOsc(this.__wbg_ptr);return i=l[0],n=l[1],ls(l[0],l[1])}finally{mi.__wbindgen_free(i,n,1)}}getWays(){let i,n;try{const d=mi.speedwalk_getWays(this.__wbg_ptr);var l=d[0],u=d[1];if(d[3])throw l=0,u=0,Or(d[2]);return i=l,n=u,ls(l,u)}finally{mi.__wbindgen_free(i,n,1)}}editUndo(){const i=mi.speedwalk_editUndo(this.__wbg_ptr);if(i[1])throw Or(i[0])}getEdits(){let i,n;try{const d=mi.speedwalk_getEdits(this.__wbg_ptr);var l=d[0],u=d[1];if(d[3])throw l=0,u=0,Or(d[2]);return i=l,n=u,ls(l,u)}finally{mi.__wbindgen_free(i,n,1)}}getNodes(){let i,n;try{const d=mi.speedwalk_getNodes(this.__wbg_ptr);var l=d[0],u=d[1];if(d[3])throw l=0,u=0,Or(d[2]);return i=l,n=u,ls(l,u)}finally{mi.__wbindgen_free(i,n,1)}}}Symbol.dispose&&(oh.prototype[Symbol.dispose]=oh.prototype.free);const bw=new Set(["basic","cors","default"]);async function vw(s,i){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,i)}catch(l){if(s.ok&&bw.has(s.type)&&s.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",l);else throw l}const n=await s.arrayBuffer();return await WebAssembly.instantiate(n,i)}else{const n=await WebAssembly.instantiate(s,i);return n instanceof WebAssembly.Instance?{instance:n,module:s}:n}}function ww(){const s={};return s.wbg={},s.wbg.__wbg_Error_e83987f665cf5504=function(i,n){return Error(ls(i,n))},s.wbg.__wbg___wbindgen_bigint_get_as_i64_f3ebc5a755000afd=function(i,n){const l=n,u=typeof l=="bigint"?l:void 0;zo().setBigInt64(i+8*1,$a(u)?BigInt(0):u,!0),zo().setInt32(i+4*0,!$a(u),!0)},s.wbg.__wbg___wbindgen_boolean_get_6d5a1ee65bab5f68=function(i){const n=i,l=typeof n=="boolean"?n:void 0;return $a(l)?16777215:l?1:0},s.wbg.__wbg___wbindgen_debug_string_df47ffb5e35e6763=function(i,n){const l=Bd(n),u=Td(l,mi.__wbindgen_malloc,mi.__wbindgen_realloc),d=Nl;zo().setInt32(i+4*1,d,!0),zo().setInt32(i+4*0,u,!0)},s.wbg.__wbg___wbindgen_in_bb933bd9e1b3bc0f=function(i,n){return i in n},s.wbg.__wbg___wbindgen_is_bigint_cb320707dcd35f0b=function(i){return typeof i=="bigint"},s.wbg.__wbg___wbindgen_is_function_ee8a6c5833c90377=function(i){return typeof i=="function"},s.wbg.__wbg___wbindgen_is_object_c818261d21f283a4=function(i){const n=i;return typeof n=="object"&&n!==null},s.wbg.__wbg___wbindgen_jsval_eq_6b13ab83478b1c50=function(i,n){return i===n},s.wbg.__wbg___wbindgen_jsval_loose_eq_b664b38a2f582147=function(i,n){return i==n},s.wbg.__wbg___wbindgen_number_get_a20bf9b85341449d=function(i,n){const l=n,u=typeof l=="number"?l:void 0;zo().setFloat64(i+8*1,$a(u)?0:u,!0),zo().setInt32(i+4*0,!$a(u),!0)},s.wbg.__wbg___wbindgen_string_get_e4f06c90489ad01b=function(i,n){const l=n,u=typeof l=="string"?l:void 0;var d=$a(u)?0:Td(u,mi.__wbindgen_malloc,mi.__wbindgen_realloc),f=Nl;zo().setInt32(i+4*1,f,!0),zo().setInt32(i+4*0,d,!0)},s.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(i,n){throw new Error(ls(i,n))},s.wbg.__wbg_call_e762c39fa8ea36bf=function(){return kd(function(i,n){return i.call(n)},arguments)},s.wbg.__wbg_debug_f4b0c59db649db48=function(i){console.debug(i)},s.wbg.__wbg_done_2042aa2670fb1db1=function(i){return i.done},s.wbg.__wbg_entries_e171b586f8f6bdbf=function(i){return Object.entries(i)},s.wbg.__wbg_error_7534b8e9a36f1ab4=function(i,n){let l,u;try{l=i,u=n,console.error(ls(i,n))}finally{mi.__wbindgen_free(l,u,1)}},s.wbg.__wbg_error_a7f8fbb0523dae15=function(i){console.error(i)},s.wbg.__wbg_get_7bed016f185add81=function(i,n){return i[n>>>0]},s.wbg.__wbg_get_efcb449f58ec27c2=function(){return kd(function(i,n){return Reflect.get(i,n)},arguments)},s.wbg.__wbg_info_e674a11f4f50cc0c=function(i){console.info(i)},s.wbg.__wbg_instanceof_ArrayBuffer_70beb1189ca63b38=function(i){let n;try{n=i instanceof ArrayBuffer}catch{n=!1}return n},s.wbg.__wbg_instanceof_Map_8579b5e2ab5437c7=function(i){let n;try{n=i instanceof Map}catch{n=!1}return n},s.wbg.__wbg_instanceof_Uint8Array_20c8e73002f7af98=function(i){let n;try{n=i instanceof Uint8Array}catch{n=!1}return n},s.wbg.__wbg_isArray_96e0af9891d0945d=function(i){return Array.isArray(i)},s.wbg.__wbg_isSafeInteger_d216eda7911dde36=function(i){return Number.isSafeInteger(i)},s.wbg.__wbg_iterator_e5822695327a3c39=function(){return Symbol.iterator},s.wbg.__wbg_length_69bca3cb64fc8748=function(i){return i.length},s.wbg.__wbg_length_cdd215e10d9dd507=function(i){return i.length},s.wbg.__wbg_log_8cec76766b8c0e33=function(i){console.log(i)},s.wbg.__wbg_new_5a79be3ab53b8aa5=function(i){return new Uint8Array(i)},s.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},s.wbg.__wbg_next_020810e0ae8ebcb0=function(){return kd(function(i){return i.next()},arguments)},s.wbg.__wbg_next_2c826fe5dfec6b6a=function(i){return i.next},s.wbg.__wbg_prototypesetcall_2a6620b6922694b2=function(i,n,l){Uint8Array.prototype.set.call(_w(i,n),l)},s.wbg.__wbg_stack_0ed75d68575b0f3c=function(i,n){const l=n.stack,u=Td(l,mi.__wbindgen_malloc,mi.__wbindgen_realloc),d=Nl;zo().setInt32(i+4*1,d,!0),zo().setInt32(i+4*0,u,!0)},s.wbg.__wbg_value_692627309814bb8c=function(i){return i.value},s.wbg.__wbg_warn_1d74dddbe2fd1dbb=function(i){console.warn(i)},s.wbg.__wbindgen_cast_2241b6af4c4b2941=function(i,n){return ls(i,n)},s.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(i){return BigInt.asUintN(64,i)},s.wbg.__wbindgen_cast_9ae0607507abb057=function(i){return i},s.wbg.__wbindgen_init_externref_table=function(){const i=mi.__wbindgen_externrefs,n=i.grow(4);i.set(0,void 0),i.set(n+0,void 0),i.set(n+1,null),i.set(n+2,!0),i.set(n+3,!1)},s}function xw(s,i){return mi=s.exports,T0.__wbindgen_wasm_module=i,Dl=null,Xu=null,mi.__wbindgen_start(),mi}async function T0(s){if(mi!==void 0)return mi;typeof s<"u"&&(Object.getPrototypeOf(s)===Object.prototype?{module_or_path:s}=s:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof s>"u"&&(s=new URL("/speedwalk/assets/backend_bg-C1qf8SVj.wasm",import.meta.url));const i=ww();(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:n,module:l}=await vw(await s,i);return xw(n,l)}var xs=63710088e-1,Sw={centimeters:xs*100,centimetres:xs*100,degrees:360/(2*Math.PI),feet:xs*3.28084,inches:xs*39.37,kilometers:xs/1e3,kilometres:xs/1e3,meters:xs,metres:xs,miles:xs/1609.344,millimeters:xs*1e3,millimetres:xs*1e3,nauticalmiles:xs/1852,radians:1,yards:xs*1.0936};function Nd(s,i,n={}){const l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=i||{},l.geometry=s,l}function Kh(s,i,n={}){if(!s)throw new Error("coordinates is required");if(!Array.isArray(s))throw new Error("coordinates must be an Array");if(s.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vg(s[0])||!vg(s[1]))throw new Error("coordinates must contain numbers");return Nd({type:"Point",coordinates:s},i,n)}function Tw(s,i="kilometers"){const n=Sw[i];if(!n)throw new Error(i+" units is invalid");return s*n}function bg(s){return s%(2*Math.PI)*180/Math.PI}function Nc(s){return s%360*Math.PI/180}function vg(s){return!isNaN(s)&&s!==null&&!Array.isArray(s)}function k0(s,i,n){if(s!==null)for(var l,u,d,f,o,_,T,S=0,y=0,k,I=s.type,C=I==="FeatureCollection",L=I==="Feature",N=C?s.features.length:1,R=0;R<N;R++){T=C?s.features[R].geometry:L?s.geometry:s,k=T?T.type==="GeometryCollection":!1,o=k?T.geometries.length:1;for(var z=0;z<o;z++){var Z=0,ie=0;if(f=k?T.geometries[z]:T,f!==null){_=f.coordinates;var ae=f.type;switch(S=0,ae){case null:break;case"Point":if(i(_,y,R,Z,ie)===!1)return!1;y++,Z++;break;case"LineString":case"MultiPoint":for(l=0;l<_.length;l++){if(i(_[l],y,R,Z,ie)===!1)return!1;y++,ae==="MultiPoint"&&Z++}ae==="LineString"&&Z++;break;case"Polygon":case"MultiLineString":for(l=0;l<_.length;l++){for(u=0;u<_[l].length-S;u++){if(i(_[l][u],y,R,Z,ie)===!1)return!1;y++}ae==="MultiLineString"&&Z++,ae==="Polygon"&&ie++}ae==="Polygon"&&Z++;break;case"MultiPolygon":for(l=0;l<_.length;l++){for(ie=0,u=0;u<_[l].length;u++){for(d=0;d<_[l][u].length-S;d++){if(i(_[l][u][d],y,R,Z,ie)===!1)return!1;y++}ie++}Z++}break;case"GeometryCollection":for(l=0;l<f.geometries.length;l++)if(k0(f.geometries[l],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function kw(s,i){var n,l,u,d,f,o,_,T,S,y,k=0,I=s.type==="FeatureCollection",C=s.type==="Feature",L=I?s.features.length:1;for(n=0;n<L;n++){for(o=I?s.features[n].geometry:C?s.geometry:s,T=I?s.features[n].properties:C?s.properties:{},S=I?s.features[n].bbox:C?s.bbox:void 0,y=I?s.features[n].id:C?s.id:void 0,_=o?o.type==="GeometryCollection":!1,f=_?o.geometries.length:1,u=0;u<f;u++){if(d=_?o.geometries[u]:o,d===null){if(i(null,k,T,S,y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(d,k,T,S,y)===!1)return!1;break}case"GeometryCollection":{for(l=0;l<d.geometries.length;l++)if(i(d.geometries[l],k,T,S,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function Cw(s,i){kw(s,function(n,l,u,d,f){var o=n===null?null:n.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return i(Nd(n,u,{bbox:d,id:f}),l,0)===!1?!1:void 0}var _;switch(o){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var T=0;T<n.coordinates.length;T++){var S=n.coordinates[T],y={type:_,coordinates:S};if(i(Nd(y,u),l,T)===!1)return!1}})}function Ew(s,i={}){if(s.bbox!=null&&i.recompute!==!0)return s.bbox;const n=[1/0,1/0,-1/0,-1/0];return k0(s,l=>{n[0]>l[0]&&(n[0]=l[0]),n[1]>l[1]&&(n[1]=l[1]),n[2]<l[0]&&(n[2]=l[0]),n[3]<l[1]&&(n[3]=l[1])}),n}var Iw=Ew,C0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(s,i){(function(n,l){s.exports=l()})(Qy,function(){var n={},l={};function u(f,o,_){if(l[f]=_,f==="index"){var T="var sharedModule = {}; ("+l.shared+")(sharedModule); ("+l.worker+")(sharedModule);",S={};return l.shared(S),l.index(n,S),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([T],{type:"text/javascript"}))),n}}u("shared",["exports"],function(f){function o(r,t,a,h){return new(a||(a=Promise))(function(g,w){function x(F){try{M(h.next(F))}catch(V){w(V)}}function E(F){try{M(h.throw(F))}catch(V){w(V)}}function M(F){var V;F.done?g(F.value):(V=F.value,V instanceof a?V:new a(function(G){G(V)})).then(x,E)}M((h=h.apply(r,t||[])).next())})}function _(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var T=S;function S(r,t){this.x=r,this.y=t}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,a=r.y-this.y;return t*t+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),a=Math.sin(r),h=a*this.x+t*this.y;return this.x=t*this.x-a*this.y,this.y=h,this},_rotateAround:function(r,t){var a=Math.cos(r),h=Math.sin(r),g=t.y+h*(this.x-t.x)+a*(this.y-t.y);return this.x=t.x+a*(this.x-t.x)-h*(this.y-t.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(r){return r instanceof S?r:Array.isArray(r)?new S(r[0],r[1]):r};var y=_(T),k=I;function I(r,t,a,h){this.cx=3*r,this.bx=3*(a-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=a,this.p2y=h}I.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var a=r,h=0;h<8;h++){var g=this.sampleCurveX(a)-r;if(Math.abs(g)<t)return a;var w=this.sampleCurveDerivativeX(a);if(Math.abs(w)<1e-6)break;a-=g/w}var x=0,E=1;for(a=r,h=0;h<20&&(g=this.sampleCurveX(a),!(Math.abs(g-r)<t));h++)r>g?x=a:E=a,a=.5*(E-x)+x;return a},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var C=_(k);let L,N;function R(){return L==null&&(L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),L}function z(){if(N==null&&(N=!1,R())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let h=0;h<5*5;h++){const g=4*h;t.fillStyle=`rgb(${g},${g+1},${g+2})`,t.fillRect(h%5,Math.floor(h/5),1,1)}const a=t.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&a[h]!==h){N=!0;break}}}return N||!1}function Z(r,t,a,h){const g=new C(r,t,a,h);return w=>g.solve(w)}const ie=Z(.25,.1,.25,1);function ae(r,t,a){return Math.min(a,Math.max(t,r))}function $(r,t,a){const h=a-t,g=((r-t)%h+h)%h+t;return g===t?a:g}function re(r,...t){for(const a of t)for(const h in a)r[h]=a[h];return r}let j=1;function U(r,t,a){const h={};for(const g in r)h[g]=t.call(this,r[g],g,r);return h}function J(r,t,a){const h={};for(const g in r)t.call(this,r[g],g,r)&&(h[g]=r[g]);return h}function B(r){return Array.isArray(r)?r.map(B):typeof r=="object"&&r?U(r,B):r}const W={};function le(r){W[r]||(typeof console<"u"&&console.warn(r),W[r]=!0)}function ge(r,t,a){return(a.y-r.y)*(t.x-r.x)>(t.y-r.y)*(a.x-r.x)}function pe(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let _e=null;function ce(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ze(r,t,a,h,g){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(r,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const E=x.startsWith("BGR"),M=new Uint8ClampedArray(h*g*4);if(yield w.copyTo(M,function(F,V,G,Q,ne){const ue=4*Math.max(-V,0),de=(Math.max(0,G)-G)*Q*4+ue,ke=4*Q,Me=Math.max(0,V),Qe=Math.max(0,G);return{rect:{x:Me,y:Qe,width:Math.min(F.width,V+Q)-Me,height:Math.min(F.height,G+ne)-Qe},layout:[{offset:de,stride:ke}]}}(r,t,a,h,g)),E)for(let F=0;F<M.length;F+=4){const V=M[F];M[F]=M[F+2],M[F+2]=V}return M}finally{w.close()}})}let ct,nt;const bt="AbortError";function At(){return new Error(bt)}const tt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function vt(r){return tt.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const St="global-dispatcher";class Zt extends Error{constructor(t,a,h,g){super(`AJAXError: ${a} (${t}): ${h}`),this.status=t,this.statusText=a,this.url=h,this.body=g}}const oi=()=>pe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ai=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const h=vt(r.url);if(h)return h(r,t);if(pe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:St},t)}if(!(/^file:/.test(a=r.url)||/^file:/.test(oi())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(h,g){return o(this,void 0,void 0,function*(){const w=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:oi(),signal:g.signal});h.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const F=yield x.blob();throw new Zt(x.status,x.statusText,h.url,F)}let E;E=h.type==="arrayBuffer"||h.type==="image"?x.arrayBuffer():h.type==="json"?x.json():x.text();const M=yield E;if(g.signal.aborted)throw At();return{data:M,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(r,t);if(pe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:St},t)}var a;return function(h,g){return new Promise((w,x)=>{var E;const M=new XMLHttpRequest;M.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(M.responseType="arraybuffer");for(const F in h.headers)M.setRequestHeader(F,h.headers[F]);h.type==="json"&&(M.responseType="text",!((E=h.headers)===null||E===void 0)&&E.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=h.credentials==="include",M.onerror=()=>{x(new Error(M.statusText))},M.onload=()=>{if(!g.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let F=M.response;if(h.type==="json")try{F=JSON.parse(M.response)}catch(V){return void x(V)}w({data:F,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const F=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});x(new Zt(M.status,M.statusText,h.url,F))}},g.signal.addEventListener("abort",()=>{M.abort(),x(At())}),M.send(h.body)})}(r,t)};function Mi(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),a=window.location;return t.protocol===a.protocol&&t.host===a.host}function Ti(r,t,a){a[r]&&a[r].indexOf(t)!==-1||(a[r]=a[r]||[],a[r].push(t))}function It(r,t,a){if(a&&a[r]){const h=a[r].indexOf(t);h!==-1&&a[r].splice(h,1)}}class Ge{constructor(t,a={}){re(this,a),this.type=t}}class Pt extends Ge{constructor(t,a={}){super("error",re({error:t},a))}}class ii{on(t,a){return this._listeners=this._listeners||{},Ti(t,a,this._listeners),this}off(t,a){return It(t,a,this._listeners),It(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Ti(t,a,this._oneTimeListeners),this):new Promise(h=>this.once(t,h))}fire(t,a){typeof t=="string"&&(t=new Ge(t,a||{}));const h=t.type;if(this.listens(h)){t.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const E of g)E.call(this,t);const w=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const E of w)It(h,E,this._oneTimeListeners),E.call(this,t);const x=this._eventedParent;x&&(re(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof Pt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}var Je={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const gi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function dt(r,t){const a={};for(const h in r)h!=="ref"&&(a[h]=r[h]);return gi.forEach(h=>{h in t&&(a[h]=t[h])}),a}function et(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let a=0;a<r.length;a++)if(!et(r[a],t[a]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const a in r)if(!et(r[a],t[a]))return!1;return!0}return r===t}function he(r,t){r.push(t)}function H(r,t,a){he(a,{command:"addSource",args:[r,t[r]]})}function Y(r,t,a){he(t,{command:"removeSource",args:[r]}),a[r]=!0}function Ee(r,t,a,h){Y(r,a,h),H(r,t,a)}function qe(r,t,a){let h;for(h in r[a])if(Object.prototype.hasOwnProperty.call(r[a],h)&&h!=="data"&&!et(r[a][h],t[a][h]))return!1;for(h in t[a])if(Object.prototype.hasOwnProperty.call(t[a],h)&&h!=="data"&&!et(r[a][h],t[a][h]))return!1;return!0}function ut(r,t,a,h,g,w){r=r||{},t=t||{};for(const x in r)Object.prototype.hasOwnProperty.call(r,x)&&(et(r[x],t[x])||a.push({command:w,args:[h,x,t[x],g]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(r,x)&&(et(r[x],t[x])||a.push({command:w,args:[h,x,t[x],g]}))}function st(r){return r.id}function ki(r,t){return r[t.id]=t,r}class lt{constructor(t,a,h,g){this.message=(t?`${t}: `:"")+h,g&&(this.identifier=g),a!=null&&a.__line__&&(this.line=a.__line__)}}function Vt(r,...t){for(const a of t)for(const h in a)r[h]=a[h];return r}class Ci extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}class Fi{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[h,g]of a)this.bindings[h]=g}concat(t){return new Fi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Cn={kind:"null"},xt={kind:"number"},li={kind:"string"},ti={kind:"boolean"},tn={kind:"color"},hr={kind:"object"},ai={kind:"value"},fr={kind:"collator"},dr={kind:"formatted"},Sr={kind:"padding"},Tr={kind:"resolvedImage"},Ie={kind:"variableAnchorOffsetCollection"};function ee(r,t){return{kind:"array",itemType:r,N:t}}function te(r){if(r.kind==="array"){const t=te(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const fe=[Cn,xt,li,ti,tn,dr,hr,ee(ai),Sr,Tr,Ie];function Se(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Se(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const a of fe)if(!Se(a,t))return null}}return`Expected ${te(r)} but found ${te(t)} instead.`}function je(r,t){return t.some(a=>a.kind===r.kind)}function Ze(r,t){return t.some(a=>a==="null"?r===null:a==="array"?Array.isArray(r):a==="object"?r&&!Array.isArray(r)&&typeof r=="object":a===typeof r)}function Ye(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const Fe=.96422,ot=.82521,pt=4/29,rt=6/29,Ct=3*rt*rt,Xt=rt*rt*rt,ni=Math.PI/180,Ri=180/Math.PI;function bi(r){return(r%=360)<0&&(r+=360),r}function zi([r,t,a,h]){let g,w;const x=un((.2225045*(r=xi(r))+.7168786*(t=xi(t))+.0606169*(a=xi(a)))/1);r===t&&t===a?g=w=x:(g=un((.4360747*r+.3850649*t+.1430804*a)/Fe),w=un((.0139322*r+.0971045*t+.7141733*a)/ot));const E=116*x-16;return[E<0?0:E,500*(g-x),200*(x-w),h]}function xi(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function un(r){return r>Xt?Math.pow(r,1/3):r/Ct+pt}function hn([r,t,a,h]){let g=(r+16)/116,w=isNaN(t)?g:g+t/500,x=isNaN(a)?g:g-a/200;return g=1*hi(g),w=Fe*hi(w),x=ot*hi(x),[He(3.1338561*w-1.6168667*g-.4906146*x),He(-.9787684*w+1.9161415*g+.033454*x),He(.0719453*w-.2289914*g+1.4052427*x),h]}function He(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function hi(r){return r>rt?r*r*r:Ct*(r-pt)}function wi(r){return parseInt(r.padEnd(2,r),16)/255}function Bi(r,t){return Gi(t?r/100:r,0,1)}function Gi(r,t,a){return Math.min(Math.max(t,r),a)}function Hi(r){return!r.some(Number.isNaN)}const jn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ri{constructor(t,a,h,g=1,w=!0){this.r=t,this.g=a,this.b=h,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[t,a,h,g]))}static parse(t){if(t instanceof ri)return t;if(typeof t!="string")return;const a=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=jn[h];if(g){const[x,E,M]=g;return[x/255,E/255,M/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const x=h.length<6?1:2;let E=1;return[wi(h.slice(E,E+=x)),wi(h.slice(E,E+=x)),wi(h.slice(E,E+=x)),wi(h.slice(E,E+x)||"ff")]}if(h.startsWith("rgb")){const x=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[E,M,F,V,G,Q,ne,ue,de,ke,Me,Qe]=x,Ue=[V||" ",ne||" ",ke].join("");if(Ue==="  "||Ue==="  /"||Ue===",,"||Ue===",,,"){const Ke=[F,Q,de].join(""),at=Ke==="%%%"?100:Ke===""?255:0;if(at){const wt=[Gi(+M/at,0,1),Gi(+G/at,0,1),Gi(+ue/at,0,1),Me?Bi(+Me,Qe):1];if(Hi(wt))return wt}}return}}const w=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,E,M,F,V,G,Q,ne,ue]=w,de=[M||" ",V||" ",Q].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const ke=[+E,Gi(+F,0,100),Gi(+G,0,100),ne?Bi(+ne,ue):1];if(Hi(ke))return function([Me,Qe,Ue,Ke]){function at(wt){const Bt=(wt+Me/30)%12,ci=Qe*Math.min(Ue,1-Ue);return Ue-ci*Math.max(-1,Math.min(Bt-3,9-Bt,1))}return Me=bi(Me),Qe/=100,Ue/=100,[at(0),at(8),at(4),Ke]}(ke)}}}(t);return a?new ri(...a,!1):void 0}get rgb(){const{r:t,g:a,b:h,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[t/w,a/w,h/w,g])}get hcl(){return this.overwriteGetter("hcl",function(t){const[a,h,g,w]=zi(t),x=Math.sqrt(h*h+g*g);return[Math.round(1e4*x)?bi(Math.atan2(g,h)*Ri):NaN,x,a,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zi(this.rgb))}overwriteGetter(t,a){return Object.defineProperty(this,t,{value:a}),a}toString(){const[t,a,h,g]=this.rgb;return`rgba(${[t,a,h].map(w=>Math.round(255*w)).join(",")},${g})`}}ri.black=new ri(0,0,0,1),ri.white=new ri(1,1,1,1),ri.transparent=new ri(0,0,0,0),ri.red=new ri(1,0,0,1);class Xr{constructor(t,a,h){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gn{constructor(t,a,h,g,w){this.text=t,this.image=a,this.scale=h,this.fontStack=g,this.textColor=w}}class Un{constructor(t){this.sections=t}static fromString(t){return new Un([new Gn(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Un?t:Un.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class pn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof pn)return t;if(typeof t=="number")return new pn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const a of t)if(typeof a!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new pn(t)}}toString(){return JSON.stringify(this.values)}}const ma=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class zn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof zn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let a=0;a<t.length;a+=2){const h=t[a],g=t[a+1];if(typeof h!="string"||!ma.has(h)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new zn(t)}}toString(){return JSON.stringify(this.values)}}class Hn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Hn({name:t,available:!1}):null}}function Dr(r,t,a,h){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[r,t,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[r,t,a,h]:[r,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rn(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof ri||r instanceof Xr||r instanceof Un||r instanceof pn||r instanceof zn||r instanceof Hn)return!0;if(Array.isArray(r)){for(const t of r)if(!Rn(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Rn(r[t]))return!1;return!0}return!1}function Ei(r){if(r===null)return Cn;if(typeof r=="string")return li;if(typeof r=="boolean")return ti;if(typeof r=="number")return xt;if(r instanceof ri)return tn;if(r instanceof Xr)return fr;if(r instanceof Un)return dr;if(r instanceof pn)return Sr;if(r instanceof zn)return Ie;if(r instanceof Hn)return Tr;if(Array.isArray(r)){const t=r.length;let a;for(const h of r){const g=Ei(h);if(a){if(a===g)continue;a=ai;break}a=g}return ee(a||ai,t)}return hr}function No(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof ri||r instanceof Un||r instanceof pn||r instanceof zn||r instanceof Hn?r.toString():JSON.stringify(r)}class ir{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(t.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Rn(t[1]))return a.error("invalid value");const h=t[1];let g=Ei(h);const w=a.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new ir(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class En{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ga={string:li,number:xt,boolean:ti,object:hr};class Fr{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let h,g=1;const w=t[0];if(w==="array"){let E,M;if(t.length>2){const F=t[1];if(typeof F!="string"||!(F in ga)||F==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);E=ga[F],g++}else E=ai;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);M=t[2],g++}h=ee(E,M)}else{if(!ga[w])throw new Error(`Types doesn't contain name = ${w}`);h=ga[w]}const x=[];for(;g<t.length;g++){const E=a.parse(t[g],g,ai);if(!E)return null;x.push(E)}return new Fr(h,x)}evaluate(t){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(t);if(!Se(this.type,Ei(h)))return h;if(a===this.args.length-1)throw new En(`Expected value to be of type ${te(this.type)}, but found ${te(Ei(h))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ol={"to-boolean":ti,"to-color":tn,"to-number":xt,"to-string":li};class Rr{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const h=t[0];if(!ol[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&t.length!==2)return a.error("Expected one argument.");const g=ol[h],w=[];for(let x=1;x<t.length;x++){const E=a.parse(t[x],x,ai);if(!E)return null;w.push(E)}return new Rr(g,w)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let a,h;for(const g of this.args){if(a=g.evaluate(t),h=null,a instanceof ri)return a;if(typeof a=="string"){const w=t.parseColor(a);if(w)return w}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Dr(a[0],a[1],a[2],a[3]),!h))return new ri(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new En(h||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const h of this.args){a=h.evaluate(t);const g=pn.parse(a);if(g)return g}throw new En(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const h of this.args){a=h.evaluate(t);const g=zn.parse(a);if(g)return g}throw new En(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const h of this.args){if(a=h.evaluate(t),a===null)return 0;const g=Number(a);if(!isNaN(g))return g}throw new En(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return Un.fromString(No(this.args[0].evaluate(t)));case"resolvedImage":return Hn.fromString(No(this.args[0].evaluate(t)));default:return No(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const eu=["Unknown","Point","LineString","Polygon"];class _a{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?eu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=ri.parse(t)),a}}class Hs{constructor(t,a,h=[],g,w=new Fi,x=[]){this.registry=t,this.path=h,this.key=h.map(E=>`[${E}]`).join(""),this.scope=w,this.errors=x,this.expectedType=g,this._isConstant=a}parse(t,a,h,g,w={}){return a?this.concat(a,h,g)._parse(t,w):this._parse(t,w)}_parse(t,a){function h(g,w,x){return x==="assert"?new Fr(w,[g]):x==="coerce"?new Rr(w,[g]):g}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=t[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let x=w.parse(t,this);if(!x)return null;if(this.expectedType){const E=this.expectedType,M=x.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||M.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(E.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(E,M))return null}else x=h(x,E,a.typeAnnotation||"coerce");else x=h(x,E,a.typeAnnotation||"coerce");else x=h(x,E,a.typeAnnotation||"coerce");else x=h(x,E,a.typeAnnotation||"assert")}if(!(x instanceof ir)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const E=new _a;try{x=new ir(x.type,x.evaluate(E))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,h){const g=typeof t=="number"?this.path.concat(t):this.path,w=h?this.scope.concat(h):this.scope;return new Hs(this.registry,this._isConstant,g,a||null,w,this.errors)}error(t,...a){const h=`${this.key}${a.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ci(h,t))}checkSubtype(t,a){const h=Se(t,a);return h&&this.error(h),h}}class Bn{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const h=[];for(let w=1;w<t.length-1;w+=2){const x=t[w];if(typeof x!="string")return a.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return a.error("Variable names must contain only alphanumeric characters or '_'.",w);const E=a.parse(t[w+1],w+1);if(!E)return null;h.push([x,E])}const g=a.parse(t[t.length-1],t.length-1,a.expectedType,h);return g?new Bn(h,g):null}outputDefined(){return this.result.outputDefined()}}class qi{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const h=t[1];return a.scope.has(h)?new qi(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ya{constructor(t,a,h){this.type=t,this.index=a,this.input=h}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=a.parse(t[1],1,xt),g=a.parse(t[2],2,ee(a.expectedType||ai));return h&&g?new ya(g.type.itemType,h,g):null}evaluate(t){const a=this.index.evaluate(t),h=this.input.evaluate(t);if(a<0)throw new En(`Array index out of bounds: ${a} < 0.`);if(a>=h.length)throw new En(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a!==Math.floor(a))throw new En(`Array index must be an integer, but found ${a} instead.`);return h[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ba{constructor(t,a){this.type=ti,this.needle=t,this.haystack=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=a.parse(t[1],1,ai),g=a.parse(t[2],2,ai);return h&&g?je(h.type,[ti,li,xt,Cn,ai])?new ba(h,g):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(h.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!h)return!1;if(!Ze(a,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${te(Ei(a))} instead.`);if(!Ze(h,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${te(Ei(h))} instead.`);return h.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class fo{constructor(t,a,h){this.type=xt,this.needle=t,this.haystack=a,this.fromIndex=h}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=a.parse(t[1],1,ai),g=a.parse(t[2],2,ai);if(!h||!g)return null;if(!je(h.type,[ti,li,xt,Cn,ai]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(h.type)} instead`);if(t.length===4){const w=a.parse(t[3],3,xt);return w?new fo(h,g,w):null}return new fo(h,g)}evaluate(t){const a=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!Ze(a,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${te(Ei(a))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(t)),Ze(h,["string"])){const w=h.indexOf(a,g);return w===-1?-1:[...h.slice(0,w)].length}if(Ze(h,["array"]))return h.indexOf(a,g);throw new En(`Expected second argument to be of type array or string, but found ${te(Ei(h))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class al{constructor(t,a,h,g,w,x){this.inputType=t,this.type=a,this.input=h,this.cases=g,this.outputs=w,this.otherwise=x}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let h,g;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);const w={},x=[];for(let F=2;F<t.length-1;F+=2){let V=t[F];const G=t[F+1];Array.isArray(V)||(V=[V]);const Q=a.concat(F);if(V.length===0)return Q.error("Expected at least one branch label.");for(const ue of V){if(typeof ue!="number"&&typeof ue!="string")return Q.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return Q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ue=="number"&&Math.floor(ue)!==ue)return Q.error("Numeric branch labels must be integer values.");if(h){if(Q.checkSubtype(h,Ei(ue)))return null}else h=Ei(ue);if(w[String(ue)]!==void 0)return Q.error("Branch labels must be unique.");w[String(ue)]=x.length}const ne=a.parse(G,F,g);if(!ne)return null;g=g||ne.type,x.push(ne)}const E=a.parse(t[1],1,ai);if(!E)return null;const M=a.parse(t[t.length-1],t.length-1,g);return M?E.type.kind!=="value"&&a.concat(1).checkSubtype(h,E.type)?null:new al(h,g,E,w,x,M):null}evaluate(t){const a=this.input.evaluate(t);return(Ei(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class jo{constructor(t,a,h){this.type=t,this.branches=a,this.otherwise=h}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const g=[];for(let x=1;x<t.length-1;x+=2){const E=a.parse(t[x],x,ti);if(!E)return null;const M=a.parse(t[x+1],x+1,h);if(!M)return null;g.push([E,M]),h=h||M.type}const w=a.parse(t[t.length-1],t.length-1,h);if(!w)return null;if(!h)throw new Error("Can't infer output type");return new jo(h,g,w)}evaluate(t){for(const[a,h]of this.branches)if(a.evaluate(t))return h.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,h]of this.branches)t(a),t(h);t(this.otherwise)}outputDefined(){return this.branches.every(([t,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class Es{constructor(t,a,h,g){this.type=t,this.input=a,this.beginIndex=h,this.endIndex=g}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=a.parse(t[1],1,ai),g=a.parse(t[2],2,xt);if(!h||!g)return null;if(!je(h.type,[ee(ai),li,ai]))return a.error(`Expected first argument to be of type array or string, but found ${te(h.type)} instead`);if(t.length===4){const w=a.parse(t[3],3,xt);return w?new Es(h.type,h,g,w):null}return new Es(h.type,h,g)}evaluate(t){const a=this.input.evaluate(t),h=this.beginIndex.evaluate(t);let g;if(this.endIndex&&(g=this.endIndex.evaluate(t)),Ze(a,["string"]))return[...a].slice(h,g).join("");if(Ze(a,["array"]))return a.slice(h,g);throw new En(`Expected first argument to be of type array or string, but found ${te(Ei(a))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function va(r,t){const a=r.length-1;let h,g,w=0,x=a,E=0;for(;w<=x;)if(E=Math.floor((w+x)/2),h=r[E],g=r[E+1],h<=t){if(E===a||t<g)return E;w=E+1}else{if(!(h>t))throw new En("Input is not a number.");x=E-1}return 0}class po{constructor(t,a,h){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[g,w]of h)this.labels.push(g),this.outputs.push(w)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(t[1],1,xt);if(!h)return null;const g=[];let w=null;a.expectedType&&a.expectedType.kind!=="value"&&(w=a.expectedType);for(let x=1;x<t.length;x+=2){const E=x===1?-1/0:t[x],M=t[x+1],F=x,V=x+1;if(typeof E!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(g.length&&g[g.length-1][0]>=E)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const G=a.parse(M,V,w);if(!G)return null;w=w||G.type,g.push([E,G])}return new po(w,h,g)}evaluate(t){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(t);const g=this.input.evaluate(t);if(g<=a[0])return h[0].evaluate(t);const w=a.length;return g>=a[w-1]?h[w-1].evaluate(t):h[va(a,g)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ll(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var tu=ql;function ql(r,t,a,h){this.cx=3*r,this.bx=3*(a-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=a,this.p2y=h}ql.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var a=r,h=0;h<8;h++){var g=this.sampleCurveX(a)-r;if(Math.abs(g)<t)return a;var w=this.sampleCurveDerivativeX(a);if(Math.abs(w)<1e-6)break;a-=g/w}var x=0,E=1;for(a=r,h=0;h<20&&(g=this.sampleCurveX(a),!(Math.abs(g-r)<t));h++)r>g?x=a:E=a,a=.5*(E-x)+x;return a},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Zl=ll(tu);function Is(r,t,a){return r+a*(t-r)}function mo(r,t,a){return r.map((h,g)=>Is(h,t[g],a))}const Vn={number:Is,color:function(r,t,a,h="rgb"){switch(h){case"rgb":{const[g,w,x,E]=mo(r.rgb,t.rgb,a);return new ri(g,w,x,E,!1)}case"hcl":{const[g,w,x,E]=r.hcl,[M,F,V,G]=t.hcl;let Q,ne;if(isNaN(g)||isNaN(M))isNaN(g)?isNaN(M)?Q=NaN:(Q=M,x!==1&&x!==0||(ne=F)):(Q=g,V!==1&&V!==0||(ne=w));else{let Qe=M-g;M>g&&Qe>180?Qe-=360:M<g&&g-M>180&&(Qe+=360),Q=g+a*Qe}const[ue,de,ke,Me]=function([Qe,Ue,Ke,at]){return Qe=isNaN(Qe)?0:Qe*ni,hn([Ke,Math.cos(Qe)*Ue,Math.sin(Qe)*Ue,at])}([Q,ne??Is(w,F,a),Is(x,V,a),Is(E,G,a)]);return new ri(ue,de,ke,Me,!1)}case"lab":{const[g,w,x,E]=hn(mo(r.lab,t.lab,a));return new ri(g,w,x,E,!1)}}},array:mo,padding:function(r,t,a){return new pn(mo(r.values,t.values,a))},variableAnchorOffsetCollection:function(r,t,a){const h=r.values,g=t.values;if(h.length!==g.length)throw new En(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const w=[];for(let x=0;x<h.length;x+=2){if(h[x]!==g[x])throw new En(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${h[x]}, to[${x}]: ${g[x]}`);w.push(h[x]);const[E,M]=h[x+1],[F,V]=g[x+1];w.push([Is(E,F,a),Is(M,V,a)])}return new zn(w)}};class Qn{constructor(t,a,h,g,w){this.type=t,this.operator=a,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[x,E]of w)this.labels.push(x),this.outputs.push(E)}static interpolationFactor(t,a,h,g){let w=0;if(t.name==="exponential")w=go(a,t.base,h,g);else if(t.name==="linear")w=go(a,1,h,g);else if(t.name==="cubic-bezier"){const x=t.controlPoints;w=new Zl(x[0],x[1],x[2],x[3]).solve(go(a,1,h,g))}return w}static parse(t,a){let[h,g,w,...x]=t;if(!Array.isArray(g)||g.length===0)return a.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const F=g[1];if(typeof F!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:F}}else{if(g[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const F=g.slice(1);if(F.length!==4||F.some(V=>typeof V!="number"||V<0||V>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:F}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(w=a.parse(w,2,xt),!w)return null;const E=[];let M=null;h==="interpolate-hcl"||h==="interpolate-lab"?M=tn:a.expectedType&&a.expectedType.kind!=="value"&&(M=a.expectedType);for(let F=0;F<x.length;F+=2){const V=x[F],G=x[F+1],Q=F+3,ne=F+4;if(typeof V!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Q);if(E.length&&E[E.length-1][0]>=V)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Q);const ue=a.parse(G,ne,M);if(!ue)return null;M=M||ue.type,E.push([V,ue])}return Ye(M,xt)||Ye(M,tn)||Ye(M,Sr)||Ye(M,Ie)||Ye(M,ee(xt))?new Qn(M,h,g,w,E):a.error(`Type ${te(M)} is not interpolatable.`)}evaluate(t){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(t);const g=this.input.evaluate(t);if(g<=a[0])return h[0].evaluate(t);const w=a.length;if(g>=a[w-1])return h[w-1].evaluate(t);const x=va(a,g),E=Qn.interpolationFactor(this.interpolation,g,a[x],a[x+1]),M=h[x].evaluate(t),F=h[x+1].evaluate(t);switch(this.operator){case"interpolate":return Vn[this.type.kind](M,F,E);case"interpolate-hcl":return Vn.color(M,F,E,"hcl");case"interpolate-lab":return Vn.color(M,F,E,"lab")}}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function go(r,t,a,h){const g=h-a,w=r-a;return g===0?0:t===1?w/g:(Math.pow(t,w)-1)/(Math.pow(t,g)-1)}class $n{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expectected at least one argument.");let h=null;const g=a.expectedType;g&&g.kind!=="value"&&(h=g);const w=[];for(const E of t.slice(1)){const M=a.parse(E,1+w.length,h,void 0,{typeAnnotation:"omit"});if(!M)return null;h=h||M.type,w.push(M)}if(!h)throw new Error("No output type");const x=g&&w.some(E=>Se(g,E.type));return new $n(x?ai:h,w)}evaluate(t){let a,h=null,g=0;for(const w of this.args)if(g++,h=w.evaluate(t),h&&h instanceof Hn&&!h.available&&(a||(a=h.name),h=null,g===this.args.length&&(h=a)),h!==null)break;return h}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function wa(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Wl(r,t,a,h){return h.compare(t,a)===0}function Xs(r,t,a){const h=r!=="=="&&r!=="!=";return class E0{constructor(w,x,E){this.type=ti,this.lhs=w,this.rhs=x,this.collator=E,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const E=w[0];let M=x.parse(w[1],1,ai);if(!M)return null;if(!wa(E,M.type))return x.concat(1).error(`"${E}" comparisons are not supported for type '${te(M.type)}'.`);let F=x.parse(w[2],2,ai);if(!F)return null;if(!wa(E,F.type))return x.concat(2).error(`"${E}" comparisons are not supported for type '${te(F.type)}'.`);if(M.type.kind!==F.type.kind&&M.type.kind!=="value"&&F.type.kind!=="value")return x.error(`Cannot compare types '${te(M.type)}' and '${te(F.type)}'.`);h&&(M.type.kind==="value"&&F.type.kind!=="value"?M=new Fr(F.type,[M]):M.type.kind!=="value"&&F.type.kind==="value"&&(F=new Fr(M.type,[F])));let V=null;if(w.length===4){if(M.type.kind!=="string"&&F.type.kind!=="string"&&M.type.kind!=="value"&&F.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(V=x.parse(w[3],3,fr),!V)return null}return new E0(M,F,V)}evaluate(w){const x=this.lhs.evaluate(w),E=this.rhs.evaluate(w);if(h&&this.hasUntypedArgument){const M=Ei(x),F=Ei(E);if(M.kind!==F.kind||M.kind!=="string"&&M.kind!=="number")throw new En(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${M.kind}, ${F.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const M=Ei(x),F=Ei(E);if(M.kind!=="string"||F.kind!=="string")return t(w,x,E)}return this.collator?a(w,x,E,this.collator.evaluate(w)):t(w,x,E)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Gl=Xs("==",function(r,t,a){return t===a},Wl),Hl=Xs("!=",function(r,t,a){return t!==a},function(r,t,a,h){return!Wl(0,t,a,h)}),Xl=Xs("<",function(r,t,a){return t<a},function(r,t,a,h){return h.compare(t,a)<0}),iu=Xs(">",function(r,t,a){return t>a},function(r,t,a,h){return h.compare(t,a)>0}),nu=Xs("<=",function(r,t,a){return t<=a},function(r,t,a,h){return h.compare(t,a)<=0}),Kl=Xs(">=",function(r,t,a){return t>=a},function(r,t,a,h){return h.compare(t,a)>=0});class Uo{constructor(t,a,h){this.type=fr,this.locale=h,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(t.length!==2)return a.error("Expected one argument.");const h=t[1];if(typeof h!="object"||Array.isArray(h))return a.error("Collator options argument must be an object.");const g=a.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,ti);if(!g)return null;const w=a.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,ti);if(!w)return null;let x=null;return h.locale&&(x=a.parse(h.locale,1,li),!x)?null:new Uo(g,w,x)}evaluate(t){return new Xr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class xa{constructor(t,a,h,g,w){this.type=li,this.number=t,this.locale=a,this.currency=h,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(t,a){if(t.length!==3)return a.error("Expected two arguments.");const h=a.parse(t[1],1,xt);if(!h)return null;const g=t[2];if(typeof g!="object"||Array.isArray(g))return a.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=a.parse(g.locale,1,li),!w))return null;let x=null;if(g.currency&&(x=a.parse(g.currency,1,li),!x))return null;let E=null;if(g["min-fraction-digits"]&&(E=a.parse(g["min-fraction-digits"],1,xt),!E))return null;let M=null;return g["max-fraction-digits"]&&(M=a.parse(g["max-fraction-digits"],1,xt),!M)?null:new xa(h,w,x,E,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Vo{constructor(t){this.type=dr,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const h=t[1];if(!Array.isArray(h)&&typeof h=="object")return a.error("First argument must be an image or text section.");const g=[];let w=!1;for(let x=1;x<=t.length-1;++x){const E=t[x];if(w&&typeof E=="object"&&!Array.isArray(E)){w=!1;let M=null;if(E["font-scale"]&&(M=a.parse(E["font-scale"],1,xt),!M))return null;let F=null;if(E["text-font"]&&(F=a.parse(E["text-font"],1,ee(li)),!F))return null;let V=null;if(E["text-color"]&&(V=a.parse(E["text-color"],1,tn),!V))return null;const G=g[g.length-1];G.scale=M,G.font=F,G.textColor=V}else{const M=a.parse(t[x],1,ai);if(!M)return null;const F=M.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:M,scale:null,font:null,textColor:null})}}return new Vo(g)}evaluate(t){return new Un(this.sections.map(a=>{const h=a.content.evaluate(t);return Ei(h)===Tr?new Gn("",h,null,null,null):new Gn(No(h),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}outputDefined(){return!1}}class qo{constructor(t){this.type=Tr,this.input=t}static parse(t,a){if(t.length!==2)return a.error("Expected two arguments.");const h=a.parse(t[1],1,li);return h?new qo(h):a.error("No image name provided.")}evaluate(t){const a=this.input.evaluate(t),h=Hn.fromString(a);return h&&t.availableImages&&(h.available=t.availableImages.indexOf(a)>-1),h}eachChild(t){t(this.input)}outputDefined(){return!1}}class cl{constructor(t){this.type=xt,this.input=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const h=a.parse(t[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${te(h.type)} instead.`):new cl(h):null}evaluate(t){const a=this.input.evaluate(t);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new En(`Expected value to be of type string or array, but found ${te(Ei(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Kr=8192;function Ks(r,t){const a=(180+r[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,g=Math.pow(2,t.z);return[Math.round(a*g*Kr),Math.round(h*g*Kr)]}function Br(r,t){const a=Math.pow(2,t.z);return[(g=(r[0]/Kr+t.x)/a,360*g-180),(h=(r[1]/Kr+t.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,g}function As(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Ms(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Wi(r,t,a){const h=r[0]-t[0],g=r[1]-t[1],w=r[0]-a[0],x=r[1]-a[1];return h*x-w*g==0&&h*w<=0&&g*x<=0}function Zo(r,t,a,h){return(g=[h[0]-a[0],h[1]-a[1]])[0]*(w=[t[0]-r[0],t[1]-r[1]])[1]-g[1]*w[0]!=0&&!(!ul(r,t,a,h)||!ul(a,h,r,t));var g,w}function Jl(r,t,a){for(const h of a)for(let g=0;g<h.length-1;++g)if(Zo(r,t,h[g],h[g+1]))return!0;return!1}function Js(r,t,a=!1){let h=!1;for(const E of t)for(let M=0;M<E.length-1;M++){if(Wi(r,E[M],E[M+1]))return a;(w=E[M])[1]>(g=r)[1]!=(x=E[M+1])[1]>g[1]&&g[0]<(x[0]-w[0])*(g[1]-w[1])/(x[1]-w[1])+w[0]&&(h=!h)}var g,w,x;return h}function ru(r,t){for(const a of t)if(Js(r,a))return!0;return!1}function Yl(r,t){for(const a of r)if(!Js(a,t))return!1;for(let a=0;a<r.length-1;++a)if(Jl(r[a],r[a+1],t))return!1;return!0}function su(r,t){for(const a of t)if(Yl(r,a))return!0;return!1}function ul(r,t,a,h){const g=h[0]-a[0],w=h[1]-a[1],x=(r[0]-a[0])*w-g*(r[1]-a[1]),E=(t[0]-a[0])*w-g*(t[1]-a[1]);return x>0&&E<0||x<0&&E>0}function Sa(r,t,a){const h=[];for(let g=0;g<r.length;g++){const w=[];for(let x=0;x<r[g].length;x++){const E=Ks(r[g][x],a);As(t,E),w.push(E)}h.push(w)}return h}function Ql(r,t,a){const h=[];for(let g=0;g<r.length;g++){const w=Sa(r[g],t,a);h.push(w)}return h}function $l(r,t,a,h){if(r[0]<a[0]||r[0]>a[2]){const g=.5*h;let w=r[0]-a[0]>g?-h:a[0]-r[0]>g?h:0;w===0&&(w=r[0]-a[2]>g?-h:a[2]-r[0]>g?h:0),r[0]+=w}As(t,r)}function ec(r,t,a,h){const g=Math.pow(2,h.z)*Kr,w=[h.x*Kr,h.y*Kr],x=[];for(const E of r)for(const M of E){const F=[M.x+w[0],M.y+w[1]];$l(F,t,a,g),x.push(F)}return x}function tc(r,t,a,h){const g=Math.pow(2,h.z)*Kr,w=[h.x*Kr,h.y*Kr],x=[];for(const M of r){const F=[];for(const V of M){const G=[V.x+w[0],V.y+w[1]];As(t,G),F.push(G)}x.push(F)}if(t[2]-t[0]<=g/2){(E=t)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const M of x)for(const F of M)$l(F,t,a,g)}var E;return x}class Ys{constructor(t,a){this.type=ti,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Rn(t[1])){const h=t[1];if(h.type==="FeatureCollection"){const g=[];for(const w of h.features){const{type:x,coordinates:E}=w.geometry;x==="Polygon"&&g.push(E),x==="MultiPolygon"&&g.push(...E)}if(g.length)return new Ys(h,{type:"MultiPolygon",coordinates:g})}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ys(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Ys(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,h){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(h.type==="Polygon"){const E=Sa(h.coordinates,w,x),M=ec(a.geometry(),g,w,x);if(!Ms(g,w))return!1;for(const F of M)if(!Js(F,E))return!1}if(h.type==="MultiPolygon"){const E=Ql(h.coordinates,w,x),M=ec(a.geometry(),g,w,x);if(!Ms(g,w))return!1;for(const F of M)if(!ru(F,E))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,h){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(h.type==="Polygon"){const E=Sa(h.coordinates,w,x),M=tc(a.geometry(),g,w,x);if(!Ms(g,w))return!1;for(const F of M)if(!Yl(F,E))return!1}if(h.type==="MultiPolygon"){const E=Ql(h.coordinates,w,x),M=tc(a.geometry(),g,w,x);if(!Ms(g,w))return!1;for(const F of M)if(!su(F,E))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Jr=class{constructor(r=[],t=(a,h)=>a<h?-1:a>h?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:a}=this,h=t[r];for(;r>0;){const g=r-1>>1,w=t[g];if(a(h,w)>=0)break;t[r]=w,r=g}t[r]=h}_down(r){const{data:t,compare:a}=this,h=this.length>>1,g=t[r];for(;r<h;){let w=1+(r<<1);const x=w+1;if(x<this.length&&a(t[x],t[w])<0&&(w=x),a(t[w],g)>=0)break;t[r]=t[w],r=w}t[r]=g}};function ic(r,t,a,h,g){nc(r,t,a,h||r.length-1,g||ou)}function nc(r,t,a,h,g){for(;h>a;){if(h-a>600){var w=h-a+1,x=t-a+1,E=Math.log(w),M=.5*Math.exp(2*E/3),F=.5*Math.sqrt(E*M*(w-M)/w)*(x-w/2<0?-1:1);nc(r,t,Math.max(a,Math.floor(t-x*M/w+F)),Math.min(h,Math.floor(t+(w-x)*M/w+F)),g)}var V=r[t],G=a,Q=h;for(Wo(r,a,t),g(r[h],V)>0&&Wo(r,a,h);G<Q;){for(Wo(r,G,Q),G++,Q--;g(r[G],V)<0;)G++;for(;g(r[Q],V)>0;)Q--}g(r[a],V)===0?Wo(r,a,Q):Wo(r,++Q,h),Q<=t&&(a=Q+1),t<=Q&&(h=Q-1)}}function Wo(r,t,a){var h=r[t];r[t]=r[a],r[a]=h}function ou(r,t){return r<t?-1:r>t?1:0}function Ta(r,t){if(r.length<=1)return[r];const a=[];let h,g;for(const w of r){const x=lu(w);x!==0&&(w.area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(h&&a.push(h),h=[w]):h.push(w))}if(h&&a.push(h),t>1)for(let w=0;w<a.length;w++)a[w].length<=t||(ic(a[w],t,1,a[w].length-1,au),a[w]=a[w].slice(0,t));return a}function au(r,t){return t.area-r.area}function lu(r){let t=0;for(let a,h,g=0,w=r.length,x=w-1;g<w;x=g++)a=r[g],h=r[x],t+=(h.x-a.x)*(a.y+h.y);return t}const rc=1/298.257223563,sc=rc*(2-rc),ka=Math.PI/180;class _o{constructor(t){const a=6378.137*ka*1e3,h=Math.cos(t*ka),g=1/(1-sc*(1-h*h)),w=Math.sqrt(g);this.kx=a*w*h,this.ky=a*w*g*(1-sc)}distance(t,a){const h=this.wrap(t[0]-a[0])*this.kx,g=(t[1]-a[1])*this.ky;return Math.sqrt(h*h+g*g)}pointOnLine(t,a){let h,g,w,x,E=1/0;for(let M=0;M<t.length-1;M++){let F=t[M][0],V=t[M][1],G=this.wrap(t[M+1][0]-F)*this.kx,Q=(t[M+1][1]-V)*this.ky,ne=0;G===0&&Q===0||(ne=(this.wrap(a[0]-F)*this.kx*G+(a[1]-V)*this.ky*Q)/(G*G+Q*Q),ne>1?(F=t[M+1][0],V=t[M+1][1]):ne>0&&(F+=G/this.kx*ne,V+=Q/this.ky*ne)),G=this.wrap(a[0]-F)*this.kx,Q=(a[1]-V)*this.ky;const ue=G*G+Q*Q;ue<E&&(E=ue,h=F,g=V,w=M,x=ne)}return{point:[h,g],index:w,t:Math.max(0,Math.min(1,x))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function oc(r,t){return t[0]-r[0]}function Go(r){return r[1]-r[0]+1}function Yr(r,t){return r[1]>=r[0]&&r[1]<t}function Qs(r,t){if(r[0]>r[1])return[null,null];const a=Go(r);if(t){if(a===2)return[r,null];const g=Math.floor(a/2);return[[r[0],r[0]+g],[r[0]+g,r[1]]]}if(a===1)return[r,null];const h=Math.floor(a/2)-1;return[[r[0],r[0]+h],[r[0]+h+1,r[1]]]}function Ho(r,t){if(!Yr(t,r.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let h=t[0];h<=t[1];++h)As(a,r[h]);return a}function Xo(r){const t=[1/0,1/0,-1/0,-1/0];for(const a of r)for(const h of a)As(t,h);return t}function Ca(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function hl(r,t,a){if(!Ca(r)||!Ca(t))return NaN;let h=0,g=0;return r[2]<t[0]&&(h=t[0]-r[2]),r[0]>t[2]&&(h=r[0]-t[2]),r[1]>t[3]&&(g=r[1]-t[3]),r[3]<t[1]&&(g=t[1]-r[3]),a.distance([0,0],[h,g])}function $s(r,t,a){const h=a.pointOnLine(t,r);return a.distance(r,h.point)}function fs(r,t,a,h,g){const w=Math.min($s(r,[a,h],g),$s(t,[a,h],g)),x=Math.min($s(a,[r,t],g),$s(h,[r,t],g));return Math.min(w,x)}function cu(r,t,a,h,g){if(!Yr(t,r.length)||!Yr(h,a.length))return 1/0;let w=1/0;for(let x=t[0];x<t[1];++x){const E=r[x],M=r[x+1];for(let F=h[0];F<h[1];++F){const V=a[F],G=a[F+1];if(Zo(E,M,V,G))return 0;w=Math.min(w,fs(E,M,V,G,g))}}return w}function Tn(r,t,a,h,g){if(!Yr(t,r.length)||!Yr(h,a.length))return NaN;let w=1/0;for(let x=t[0];x<=t[1];++x)for(let E=h[0];E<=h[1];++E)if(w=Math.min(w,g.distance(r[x],a[E])),w===0)return w;return w}function uu(r,t,a){if(Js(r,t,!0))return 0;let h=1/0;for(const g of t){const w=g[0],x=g[g.length-1];if(w!==x&&(h=Math.min(h,$s(r,[x,w],a)),h===0))return h;const E=a.pointOnLine(g,r);if(h=Math.min(h,a.distance(r,E.point)),h===0)return h}return h}function Pi(r,t,a,h){if(!Yr(t,r.length))return NaN;for(let w=t[0];w<=t[1];++w)if(Js(r[w],a,!0))return 0;let g=1/0;for(let w=t[0];w<t[1];++w){const x=r[w],E=r[w+1];for(const M of a)for(let F=0,V=M.length,G=V-1;F<V;G=F++){const Q=M[G],ne=M[F];if(Zo(x,E,Q,ne))return 0;g=Math.min(g,fs(x,E,Q,ne,h))}}return g}function eo(r,t){for(const a of r)for(const h of a)if(Js(h,t,!0))return!0;return!1}function Qi(r,t,a,h=1/0){const g=Xo(r),w=Xo(t);if(h!==1/0&&hl(g,w,a)>=h)return h;if(Ms(g,w)){if(eo(r,t))return 0}else if(eo(t,r))return 0;let x=1/0;for(const E of r)for(let M=0,F=E.length,V=F-1;M<F;V=M++){const G=E[V],Q=E[M];for(const ne of t)for(let ue=0,de=ne.length,ke=de-1;ue<de;ke=ue++){const Me=ne[ke],Qe=ne[ue];if(Zo(G,Q,Me,Qe))return 0;x=Math.min(x,fs(G,Q,Me,Qe,a))}}return x}function $i(r,t,a,h,g,w){if(!w)return;const x=hl(Ho(h,w),g,a);x<t&&r.push([x,w,[0,0]])}function Ps(r,t,a,h,g,w,x){if(!w||!x)return;const E=hl(Ho(h,w),Ho(g,x),a);E<t&&r.push([E,w,x])}function Ko(r,t,a,h,g=1/0){let w=Math.min(h.distance(r[0],a[0][0]),g);if(w===0)return w;const x=new Jr([[0,[0,r.length-1],[0,0]]],oc),E=Xo(a);for(;x.length>0;){const M=x.pop();if(M[0]>=w)continue;const F=M[1],V=t?50:100;if(Go(F)<=V){if(!Yr(F,r.length))return NaN;if(t){const G=Pi(r,F,a,h);if(isNaN(G)||G===0)return G;w=Math.min(w,G)}else for(let G=F[0];G<=F[1];++G){const Q=uu(r[G],a,h);if(w=Math.min(w,Q),w===0)return 0}}else{const G=Qs(F,t);$i(x,w,h,r,E,G[0]),$i(x,w,h,r,E,G[1])}}return w}function Qr(r,t,a,h,g,w=1/0){let x=Math.min(w,g.distance(r[0],a[0]));if(x===0)return x;const E=new Jr([[0,[0,r.length-1],[0,a.length-1]]],oc);for(;E.length>0;){const M=E.pop();if(M[0]>=x)continue;const F=M[1],V=M[2],G=t?50:100,Q=h?50:100;if(Go(F)<=G&&Go(V)<=Q){if(!Yr(F,r.length)&&Yr(V,a.length))return NaN;let ne;if(t&&h)ne=cu(r,F,a,V,g),x=Math.min(x,ne);else if(t&&!h){const ue=r.slice(F[0],F[1]+1);for(let de=V[0];de<=V[1];++de)if(ne=$s(a[de],ue,g),x=Math.min(x,ne),x===0)return x}else if(!t&&h){const ue=a.slice(V[0],V[1]+1);for(let de=F[0];de<=F[1];++de)if(ne=$s(r[de],ue,g),x=Math.min(x,ne),x===0)return x}else ne=Tn(r,F,a,V,g),x=Math.min(x,ne)}else{const ne=Qs(F,t),ue=Qs(V,h);Ps(E,x,g,r,a,ne[0],ue[0]),Ps(E,x,g,r,a,ne[0],ue[1]),Ps(E,x,g,r,a,ne[1],ue[0]),Ps(E,x,g,r,a,ne[1],ue[1])}}return x}function Jo(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class Ls{constructor(t,a){this.type=xt,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Rn(t[1])){const h=t[1];if(h.type==="FeatureCollection")return new Ls(h,h.features.map(g=>Jo(g.geometry)).flat());if(h.type==="Feature")return new Ls(h,Jo(h.geometry));if("type"in h&&"coordinates"in h)return new Ls(h,Jo(h))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,h){const g=a.geometry(),w=g.flat().map(M=>Br([M.x,M.y],a.canonical));if(g.length===0)return NaN;const x=new _o(w[0][1]);let E=1/0;for(const M of h){switch(M.type){case"Point":E=Math.min(E,Qr(w,!1,[M.coordinates],!1,x,E));break;case"LineString":E=Math.min(E,Qr(w,!1,M.coordinates,!0,x,E));break;case"Polygon":E=Math.min(E,Ko(w,!1,M.coordinates,x,E))}if(E===0)return E}return E}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,h){const g=a.geometry(),w=g.flat().map(M=>Br([M.x,M.y],a.canonical));if(g.length===0)return NaN;const x=new _o(w[0][1]);let E=1/0;for(const M of h){switch(M.type){case"Point":E=Math.min(E,Qr(w,!0,[M.coordinates],!1,x,E));break;case"LineString":E=Math.min(E,Qr(w,!0,M.coordinates,!0,x,E));break;case"Polygon":E=Math.min(E,Ko(w,!0,M.coordinates,x,E))}if(E===0)return E}return E}(t,this.geometries);if(t.geometryType()==="Polygon")return function(a,h){const g=a.geometry();if(g.length===0||g[0].length===0)return NaN;const w=Ta(g,0).map(M=>M.map(F=>F.map(V=>Br([V.x,V.y],a.canonical)))),x=new _o(w[0][0][0][1]);let E=1/0;for(const M of h)for(const F of w){switch(M.type){case"Point":E=Math.min(E,Ko([M.coordinates],!1,F,x,E));break;case"LineString":E=Math.min(E,Ko(M.coordinates,!0,F,x,E));break;case"Polygon":E=Math.min(E,Qi(F,M.coordinates,x,E))}if(E===0)return E}return E}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const yo={"==":Gl,"!=":Hl,">":iu,"<":Xl,">=":Kl,"<=":nu,array:Fr,at:ya,boolean:Fr,case:jo,coalesce:$n,collator:Uo,format:Vo,image:qo,in:ba,"index-of":fo,interpolate:Qn,"interpolate-hcl":Qn,"interpolate-lab":Qn,length:cl,let:Bn,literal:ir,match:al,number:Fr,"number-format":xa,object:Fr,slice:Es,step:po,string:Fr,"to-boolean":Rr,"to-color":Rr,"to-number":Rr,"to-string":Rr,var:qi,within:Ys,distance:Ls};class kr{constructor(t,a,h,g){this.name=t,this.type=a,this._evaluate=h,this.args=g}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,a){const h=t[0],g=kr.definitions[h];if(!g)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=x.filter(([F])=>!Array.isArray(F)||F.length===t.length-1);let M=null;for(const[F,V]of E){M=new Hs(a.registry,Yo,a.path,null,a.scope);const G=[];let Q=!1;for(let ne=1;ne<t.length;ne++){const ue=t[ne],de=Array.isArray(F)?F[ne-1]:F.type,ke=M.parse(ue,1+G.length,de);if(!ke){Q=!0;break}G.push(ke)}if(!Q)if(Array.isArray(F)&&F.length!==G.length)M.error(`Expected ${F.length} arguments, but found ${G.length} instead.`);else{for(let ne=0;ne<G.length;ne++){const ue=Array.isArray(F)?F[ne]:F.type,de=G[ne];M.concat(ne+1).checkSubtype(ue,de.type)}if(M.errors.length===0)return new kr(h,w,V,G)}}if(E.length===1)a.errors.push(...M.errors);else{const F=(E.length?E:x).map(([G])=>{return Q=G,Array.isArray(Q)?`(${Q.map(te).join(", ")})`:`(${te(Q.type)}...)`;var Q}).join(" | "),V=[];for(let G=1;G<t.length;G++){const Q=a.parse(t[G],1+V.length);if(!Q)return null;V.push(te(Q.type))}a.error(`Expected arguments of type ${F}, but found (${V.join(", ")}) instead.`)}return null}static register(t,a){kr.definitions=a;for(const h in a)t[h]=kr}}function fl(r,[t,a,h,g]){t=t.evaluate(r),a=a.evaluate(r),h=h.evaluate(r);const w=g?g.evaluate(r):1,x=Dr(t,a,h,w);if(x)throw new En(x);return new ri(t/255,a/255,h/255,w,!1)}function to(r,t){return r in t}function ds(r,t){const a=t[r];return a===void 0?null:a}function io(r){return{type:r}}function Yo(r){if(r instanceof qi)return Yo(r.boundExpression);if(r instanceof kr&&r.name==="error"||r instanceof Uo||r instanceof Ys||r instanceof Ls)return!1;const t=r instanceof Rr||r instanceof Fr;let a=!0;return r.eachChild(h=>{a=t?a&&Yo(h):a&&h instanceof ir}),!!a&&Qo(r)&&$o(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Qo(r){if(r instanceof kr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Ys||r instanceof Ls)return!1;let t=!0;return r.eachChild(a=>{t&&!Qo(a)&&(t=!1)}),t}function bo(r){if(r instanceof kr&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(a=>{t&&!bo(a)&&(t=!1)}),t}function $o(r,t){if(r instanceof kr&&t.indexOf(r.name)>=0)return!1;let a=!0;return r.eachChild(h=>{a&&!$o(h,t)&&(a=!1)}),a}function Ea(r){return{result:"success",value:r}}function vo(r){return{result:"error",value:r}}function wo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function dl(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function pl(r){return!!r.expression&&r.expression.interpolated}function Vi(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function xo(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function ac(r){return r}function zs(r,t){const a=t.type==="color",h=r.stops&&typeof r.stops[0][0]=="object",g=h||!(h||r.property!==void 0),w=r.type||(pl(t)?"exponential":"interval");if(a||t.type==="padding"){const V=a?ri.parse:pn.parse;(r=Vt({},r)).stops&&(r.stops=r.stops.map(G=>[G[0],V(G[1])])),r.default=V(r.default?r.default:t.default)}if(r.colorSpace&&(x=r.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var x;let E,M,F;if(w==="exponential")E=Aa;else if(w==="interval")E=ea;else if(w==="categorical"){E=Ia,M=Object.create(null);for(const V of r.stops)M[V[0]]=V[1];F=typeof r.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);E=ml}if(h){const V={},G=[];for(let ue=0;ue<r.stops.length;ue++){const de=r.stops[ue],ke=de[0].zoom;V[ke]===void 0&&(V[ke]={zoom:ke,type:r.type,property:r.property,default:r.default,stops:[]},G.push(ke)),V[ke].stops.push([de[0].value,de[1]])}const Q=[];for(const ue of G)Q.push([V[ue].zoom,zs(V[ue],t)]);const ne={name:"linear"};return{kind:"composite",interpolationType:ne,interpolationFactor:Qn.interpolationFactor.bind(void 0,ne),zoomStops:Q.map(ue=>ue[0]),evaluate:({zoom:ue},de)=>Aa({stops:Q,base:r.base},t,ue).evaluate(ue,de)}}if(g){const V=w==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:V,interpolationFactor:Qn.interpolationFactor.bind(void 0,V),zoomStops:r.stops.map(G=>G[0]),evaluate:({zoom:G})=>E(r,t,G,M,F)}}return{kind:"source",evaluate(V,G){const Q=G&&G.properties?G.properties[r.property]:void 0;return Q===void 0?no(r.default,t.default):E(r,t,Q,M,F)}}}function no(r,t,a){return r!==void 0?r:t!==void 0?t:a!==void 0?a:void 0}function Ia(r,t,a,h,g){return no(typeof a===g?h[a]:void 0,r.default,t.default)}function ea(r,t,a){if(Vi(a)!=="number")return no(r.default,t.default);const h=r.stops.length;if(h===1||a<=r.stops[0][0])return r.stops[0][1];if(a>=r.stops[h-1][0])return r.stops[h-1][1];const g=va(r.stops.map(w=>w[0]),a);return r.stops[g][1]}function Aa(r,t,a){const h=r.base!==void 0?r.base:1;if(Vi(a)!=="number")return no(r.default,t.default);const g=r.stops.length;if(g===1||a<=r.stops[0][0])return r.stops[0][1];if(a>=r.stops[g-1][0])return r.stops[g-1][1];const w=va(r.stops.map(V=>V[0]),a),x=function(V,G,Q,ne){const ue=ne-Q,de=V-Q;return ue===0?0:G===1?de/ue:(Math.pow(G,de)-1)/(Math.pow(G,ue)-1)}(a,h,r.stops[w][0],r.stops[w+1][0]),E=r.stops[w][1],M=r.stops[w+1][1],F=Vn[t.type]||ac;return typeof E.evaluate=="function"?{evaluate(...V){const G=E.evaluate.apply(void 0,V),Q=M.evaluate.apply(void 0,V);if(G!==void 0&&Q!==void 0)return F(G,Q,x,r.colorSpace)}}:F(E,M,x,r.colorSpace)}function ml(r,t,a){switch(t.type){case"color":a=ri.parse(a);break;case"formatted":a=Un.fromString(a.toString());break;case"resolvedImage":a=Hn.fromString(a.toString());break;case"padding":a=pn.parse(a);break;default:Vi(a)===t.type||t.type==="enum"&&t.values[a]||(a=void 0)}return no(a,r.default,t.default)}kr.register(yo,{error:[{kind:"error"},[li],(r,[t])=>{throw new En(t.evaluate(r))}],typeof:[li,[ai],(r,[t])=>te(Ei(t.evaluate(r)))],"to-rgba":[ee(xt,4),[tn],(r,[t])=>{const[a,h,g,w]=t.evaluate(r).rgb;return[255*a,255*h,255*g,w]}],rgb:[tn,[xt,xt,xt],fl],rgba:[tn,[xt,xt,xt,xt],fl],has:{type:ti,overloads:[[[li],(r,[t])=>to(t.evaluate(r),r.properties())],[[li,hr],(r,[t,a])=>to(t.evaluate(r),a.evaluate(r))]]},get:{type:ai,overloads:[[[li],(r,[t])=>ds(t.evaluate(r),r.properties())],[[li,hr],(r,[t,a])=>ds(t.evaluate(r),a.evaluate(r))]]},"feature-state":[ai,[li],(r,[t])=>ds(t.evaluate(r),r.featureState||{})],properties:[hr,[],r=>r.properties()],"geometry-type":[li,[],r=>r.geometryType()],id:[ai,[],r=>r.id()],zoom:[xt,[],r=>r.globals.zoom],"heatmap-density":[xt,[],r=>r.globals.heatmapDensity||0],"line-progress":[xt,[],r=>r.globals.lineProgress||0],accumulated:[ai,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[xt,io(xt),(r,t)=>{let a=0;for(const h of t)a+=h.evaluate(r);return a}],"*":[xt,io(xt),(r,t)=>{let a=1;for(const h of t)a*=h.evaluate(r);return a}],"-":{type:xt,overloads:[[[xt,xt],(r,[t,a])=>t.evaluate(r)-a.evaluate(r)],[[xt],(r,[t])=>-t.evaluate(r)]]},"/":[xt,[xt,xt],(r,[t,a])=>t.evaluate(r)/a.evaluate(r)],"%":[xt,[xt,xt],(r,[t,a])=>t.evaluate(r)%a.evaluate(r)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(r,[t,a])=>Math.pow(t.evaluate(r),a.evaluate(r))],sqrt:[xt,[xt],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[xt,[xt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[xt,[xt],(r,[t])=>Math.log(t.evaluate(r))],log2:[xt,[xt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[xt,[xt],(r,[t])=>Math.sin(t.evaluate(r))],cos:[xt,[xt],(r,[t])=>Math.cos(t.evaluate(r))],tan:[xt,[xt],(r,[t])=>Math.tan(t.evaluate(r))],asin:[xt,[xt],(r,[t])=>Math.asin(t.evaluate(r))],acos:[xt,[xt],(r,[t])=>Math.acos(t.evaluate(r))],atan:[xt,[xt],(r,[t])=>Math.atan(t.evaluate(r))],min:[xt,io(xt),(r,t)=>Math.min(...t.map(a=>a.evaluate(r)))],max:[xt,io(xt),(r,t)=>Math.max(...t.map(a=>a.evaluate(r)))],abs:[xt,[xt],(r,[t])=>Math.abs(t.evaluate(r))],round:[xt,[xt],(r,[t])=>{const a=t.evaluate(r);return a<0?-Math.round(-a):Math.round(a)}],floor:[xt,[xt],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[xt,[xt],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[ti,[li,ai],(r,[t,a])=>r.properties()[t.value]===a.value],"filter-id-==":[ti,[ai],(r,[t])=>r.id()===t.value],"filter-type-==":[ti,[li],(r,[t])=>r.geometryType()===t.value],"filter-<":[ti,[li,ai],(r,[t,a])=>{const h=r.properties()[t.value],g=a.value;return typeof h==typeof g&&h<g}],"filter-id-<":[ti,[ai],(r,[t])=>{const a=r.id(),h=t.value;return typeof a==typeof h&&a<h}],"filter->":[ti,[li,ai],(r,[t,a])=>{const h=r.properties()[t.value],g=a.value;return typeof h==typeof g&&h>g}],"filter-id->":[ti,[ai],(r,[t])=>{const a=r.id(),h=t.value;return typeof a==typeof h&&a>h}],"filter-<=":[ti,[li,ai],(r,[t,a])=>{const h=r.properties()[t.value],g=a.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[ti,[ai],(r,[t])=>{const a=r.id(),h=t.value;return typeof a==typeof h&&a<=h}],"filter->=":[ti,[li,ai],(r,[t,a])=>{const h=r.properties()[t.value],g=a.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[ti,[ai],(r,[t])=>{const a=r.id(),h=t.value;return typeof a==typeof h&&a>=h}],"filter-has":[ti,[ai],(r,[t])=>t.value in r.properties()],"filter-has-id":[ti,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ti,[ee(li)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[ti,[ee(ai)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[ti,[li,ee(ai)],(r,[t,a])=>a.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[ti,[li,ee(ai)],(r,[t,a])=>function(h,g,w,x){for(;w<=x;){const E=w+x>>1;if(g[E]===h)return!0;g[E]>h?x=E-1:w=E+1}return!1}(r.properties()[t.value],a.value,0,a.value.length-1)],all:{type:ti,overloads:[[[ti,ti],(r,[t,a])=>t.evaluate(r)&&a.evaluate(r)],[io(ti),(r,t)=>{for(const a of t)if(!a.evaluate(r))return!1;return!0}]]},any:{type:ti,overloads:[[[ti,ti],(r,[t,a])=>t.evaluate(r)||a.evaluate(r)],[io(ti),(r,t)=>{for(const a of t)if(a.evaluate(r))return!0;return!1}]]},"!":[ti,[ti],(r,[t])=>!t.evaluate(r)],"is-supported-script":[ti,[li],(r,[t])=>{const a=r.globals&&r.globals.isSupportedScript;return!a||a(t.evaluate(r))}],upcase:[li,[li],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[li,[li],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[li,io(ai),(r,t)=>t.map(a=>No(a.evaluate(r))).join("")],"resolved-locale":[li,[fr],(r,[t])=>t.evaluate(r).resolvedLocale()]});class So{constructor(t,a){var h;this.expression=t,this._warningHistory={},this._evaluator=new _a,this._defaultValue=a?(h=a).type==="color"&&xo(h.default)?new ri(0,0,0,0):h.type==="color"?ri.parse(h.default)||null:h.type==="padding"?pn.parse(h.default)||null:h.type==="variableAnchorOffsetCollection"?zn.parse(h.default)||null:h.default===void 0?null:h.default:null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(t,a,h,g,w,x){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,a,h,g,w,x){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new En(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Ma(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in yo}function Cr(r,t){const a=new Hs(yo,Yo,[],t?function(g){const w={color:tn,string:li,number:xt,enum:li,boolean:ti,formatted:dr,padding:Sr,resolvedImage:Tr,variableAnchorOffsetCollection:Ie};return g.type==="array"?ee(w[g.value]||ai,g.length):w[g.type]}(t):void 0),h=a.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Ea(new So(h,t)):vo(a.errors)}class pr{constructor(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!bo(a.expression)}evaluateWithoutErrorHandling(t,a,h,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,h,g,w,x)}evaluate(t,a,h,g,w,x){return this._styleExpression.evaluate(t,a,h,g,w,x)}}class To{constructor(t,a,h,g){this.kind=t,this.zoomStops=h,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!bo(a.expression),this.interpolationType=g}evaluateWithoutErrorHandling(t,a,h,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,h,g,w,x)}evaluate(t,a,h,g,w,x){return this._styleExpression.evaluate(t,a,h,g,w,x)}interpolationFactor(t,a,h){return this.interpolationType?Qn.interpolationFactor(this.interpolationType,t,a,h):0}}function gl(r,t){const a=Cr(r,t);if(a.result==="error")return a;const h=a.value.expression,g=Qo(h);if(!g&&!wo(t))return vo([new Ci("","data expressions not supported")]);const w=$o(h,["zoom"]);if(!w&&!dl(t))return vo([new Ci("","zoom expressions not supported")]);const x=ta(h);return x||w?x instanceof Ci?vo([x]):x instanceof Qn&&!pl(t)?vo([new Ci("",'"interpolate" expressions cannot be used with this property')]):Ea(x?new To(g?"camera":"composite",a.value,x.labels,x instanceof Qn?x.interpolation:void 0):new pr(g?"constant":"source",a.value)):vo([new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ko{constructor(t,a){this._parameters=t,this._specification=a,Vt(this,zs(this._parameters,this._specification))}static deserialize(t){return new ko(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ta(r){let t=null;if(r instanceof Bn)t=ta(r.result);else if(r instanceof $n){for(const a of r.args)if(t=ta(a),t)break}else(r instanceof po||r instanceof Qn)&&r.input instanceof kr&&r.input.name==="zoom"&&(t=r);return t instanceof Ci||r.eachChild(a=>{const h=ta(a);h instanceof Ci?t=h:!t&&h?t=new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&h&&t!==h&&(t=new Ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Pa(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Pa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const La={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _l(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Pa(r)||(r=ro(r));const t=Cr(r,La);if(t.result==="error")throw new Error(t.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,h,g)=>t.value.evaluate(a,h,{},g),needGeometry:yl(r)}}function hu(r,t){return r<t?-1:r>t?1:0}function yl(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(yl(r[t]))return!0;return!1}function ro(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?Co(r[1],r[2],"=="):t==="!="?Mn(Co(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Co(r[1],r[2],t):t==="any"?(a=r.slice(1),["any"].concat(a.map(ro))):t==="all"?["all"].concat(r.slice(1).map(ro)):t==="none"?["all"].concat(r.slice(1).map(ro).map(Mn)):t==="in"?ia(r[1],r.slice(2)):t==="!in"?Mn(ia(r[1],r.slice(2))):t==="has"?na(r[1]):t!=="!has"||Mn(na(r[1]));var a}function Co(r,t,a){switch(r){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,r,t]}}function ia(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(a=>typeof a!=typeof t[0])?["filter-in-large",r,["literal",t.sort(hu)]]:["filter-in-small",r,["literal",t]]}}function na(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Mn(r){return["!",r]}function Be(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let g="[";for(const w of r)g+=`${Be(w)},`;return`${g}]`}const a=Object.keys(r).sort();let h="{";for(let g=0;g<a.length;g++)h+=`${JSON.stringify(a[g])}:${Be(r[a[g]])},`;return`${h}}`}function D(r){let t="";for(const a of gi)t+=`/${Be(r[a])}`;return t}function se(r){const t=r.value;return t?[new lt(r.key,t,"constants have been deprecated as of v8")]:[]}function De(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ht(r){if(Array.isArray(r))return r.map(ht);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const a in r)t[a]=ht(r[a]);return t}return De(r)}function Et(r){const t=r.key,a=r.value,h=r.valueSpec||{},g=r.objectElementValidators||{},w=r.style,x=r.styleSpec,E=r.validateSpec;let M=[];const F=Vi(a);if(F!=="object")return[new lt(t,a,`object expected, ${F} found`)];for(const V in a){const G=V.split(".")[0],Q=h[G]||h["*"];let ne;if(g[G])ne=g[G];else if(h[G])ne=E;else if(g["*"])ne=g["*"];else{if(!h["*"]){M.push(new lt(t,a[V],`unknown property "${V}"`));continue}ne=E}M=M.concat(ne({key:(t&&`${t}.`)+V,value:a[V],valueSpec:Q,style:w,styleSpec:x,object:a,objectKey:V,validateSpec:E},a))}for(const V in h)g[V]||h[V].required&&h[V].default===void 0&&a[V]===void 0&&M.push(new lt(t,a,`missing required property "${V}"`));return M}function Wt(r){const t=r.value,a=r.valueSpec,h=r.style,g=r.styleSpec,w=r.key,x=r.arrayElementValidator||r.validateSpec;if(Vi(t)!=="array")return[new lt(w,t,`array expected, ${Vi(t)} found`)];if(a.length&&t.length!==a.length)return[new lt(w,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new lt(w,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let E={type:a.value,values:a.values};g.$version<7&&(E.function=a.function),Vi(a.value)==="object"&&(E=a.value);let M=[];for(let F=0;F<t.length;F++)M=M.concat(x({array:t,arrayIndex:F,value:t[F],valueSpec:E,validateSpec:r.validateSpec,style:h,styleSpec:g,key:`${w}[${F}]`}));return M}function Zi(r){const t=r.key,a=r.value,h=r.valueSpec;let g=Vi(a);return g==="number"&&a!=a&&(g="NaN"),g!=="number"?[new lt(t,a,`number expected, ${g} found`)]:"minimum"in h&&a<h.minimum?[new lt(t,a,`${a} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&a>h.maximum?[new lt(t,a,`${a} is greater than the maximum value ${h.maximum}`)]:[]}function on(r){const t=r.valueSpec,a=De(r.value.type);let h,g,w,x={};const E=a!=="categorical"&&r.value.property===void 0,M=!E,F=Vi(r.value.stops)==="array"&&Vi(r.value.stops[0])==="array"&&Vi(r.value.stops[0][0])==="object",V=Et({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(ne){if(a==="identity")return[new lt(ne.key,ne.value,'identity function may not have a "stops" property')];let ue=[];const de=ne.value;return ue=ue.concat(Wt({key:ne.key,value:de,valueSpec:ne.valueSpec,validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:G})),Vi(de)==="array"&&de.length===0&&ue.push(new lt(ne.key,de,"array must have at least one stop")),ue},default:function(ne){return ne.validateSpec({key:ne.key,value:ne.value,valueSpec:t,validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec})}}});return a==="identity"&&E&&V.push(new lt(r.key,r.value,'missing required property "property"')),a==="identity"||r.value.stops||V.push(new lt(r.key,r.value,'missing required property "stops"')),a==="exponential"&&r.valueSpec.expression&&!pl(r.valueSpec)&&V.push(new lt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(M&&!wo(r.valueSpec)?V.push(new lt(r.key,r.value,"property functions not supported")):E&&!dl(r.valueSpec)&&V.push(new lt(r.key,r.value,"zoom functions not supported"))),a!=="categorical"&&!F||r.value.property!==void 0||V.push(new lt(r.key,r.value,'"property" property is required')),V;function G(ne){let ue=[];const de=ne.value,ke=ne.key;if(Vi(de)!=="array")return[new lt(ke,de,`array expected, ${Vi(de)} found`)];if(de.length!==2)return[new lt(ke,de,`array length 2 expected, length ${de.length} found`)];if(F){if(Vi(de[0])!=="object")return[new lt(ke,de,`object expected, ${Vi(de[0])} found`)];if(de[0].zoom===void 0)return[new lt(ke,de,"object stop key must have zoom")];if(de[0].value===void 0)return[new lt(ke,de,"object stop key must have value")];if(w&&w>De(de[0].zoom))return[new lt(ke,de[0].zoom,"stop zoom values must appear in ascending order")];De(de[0].zoom)!==w&&(w=De(de[0].zoom),g=void 0,x={}),ue=ue.concat(Et({key:`${ke}[0]`,value:de[0],valueSpec:{zoom:{}},validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:Zi,value:Q}}))}else ue=ue.concat(Q({key:`${ke}[0]`,value:de[0],validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec},de));return Ma(ht(de[1]))?ue.concat([new lt(`${ke}[1]`,de[1],"expressions are not allowed in function stops.")]):ue.concat(ne.validateSpec({key:`${ke}[1]`,value:de[1],valueSpec:t,validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec}))}function Q(ne,ue){const de=Vi(ne.value),ke=De(ne.value),Me=ne.value!==null?ne.value:ue;if(h){if(de!==h)return[new lt(ne.key,Me,`${de} stop domain type must match previous stop domain type ${h}`)]}else h=de;if(de!=="number"&&de!=="string"&&de!=="boolean")return[new lt(ne.key,Me,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&a!=="categorical"){let Qe=`number expected, ${de} found`;return wo(t)&&a===void 0&&(Qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new lt(ne.key,Me,Qe)]}return a!=="categorical"||de!=="number"||isFinite(ke)&&Math.floor(ke)===ke?a!=="categorical"&&de==="number"&&g!==void 0&&ke<g?[new lt(ne.key,Me,"stop domain values must appear in ascending order")]:(g=ke,a==="categorical"&&ke in x?[new lt(ne.key,Me,"stop domain values must be unique")]:(x[ke]=!0,[])):[new lt(ne.key,Me,`integer expected, found ${ke}`)]}}function On(r){const t=(r.expressionContext==="property"?gl:Cr)(ht(r.value),r.valueSpec);if(t.result==="error")return t.value.map(h=>new lt(`${r.key}${h.key}`,r.value,h.message));const a=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!a.outputDefined())return[new lt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!bo(a))return[new lt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!bo(a))return[new lt(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!$o(a,["zoom","feature-state"]))return[new lt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Qo(a))return[new lt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function In(r){const t=r.key,a=r.value,h=r.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(De(a))===-1&&g.push(new lt(t,a,`expected one of [${h.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(h.values).indexOf(De(a))===-1&&g.push(new lt(t,a,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function mr(r){return Pa(ht(r.value))?On(Vt({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Er(r)}function Er(r){const t=r.value,a=r.key;if(Vi(t)!=="array")return[new lt(a,t,`array expected, ${Vi(t)} found`)];const h=r.styleSpec;let g,w=[];if(t.length<1)return[new lt(a,t,"filter array must have at least 1 element")];switch(w=w.concat(In({key:`${a}[0]`,value:t[0],valueSpec:h.filter_operator,style:r.style,styleSpec:r.styleSpec})),De(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&De(t[1])==="$type"&&w.push(new lt(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&w.push(new lt(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=Vi(t[1]),g!=="string"&&w.push(new lt(`${a}[1]`,t[1],`string expected, ${g} found`)));for(let x=2;x<t.length;x++)g=Vi(t[x]),De(t[1])==="$type"?w=w.concat(In({key:`${a}[${x}]`,value:t[x],valueSpec:h.geometry_type,style:r.style,styleSpec:r.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new lt(`${a}[${x}]`,t[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)w=w.concat(Er({key:`${a}[${x}]`,value:t[x],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":g=Vi(t[1]),t.length!==2?w.push(new lt(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new lt(`${a}[1]`,t[1],`string expected, ${g} found`))}return w}function Nr(r,t){const a=r.key,h=r.validateSpec,g=r.style,w=r.styleSpec,x=r.value,E=r.objectKey,M=w[`${t}_${r.layerType}`];if(!M)return[];const F=E.match(/^(.*)-transition$/);if(t==="paint"&&F&&M[F[1]]&&M[F[1]].transition)return h({key:a,value:x,valueSpec:w.transition,style:g,styleSpec:w});const V=r.valueSpec||M[E];if(!V)return[new lt(a,x,`unknown property "${E}"`)];let G;if(Vi(x)==="string"&&wo(V)&&!V.tokens&&(G=/^{([^}]+)}$/.exec(x)))return[new lt(a,x,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const Q=[];return r.layerType==="symbol"&&(E==="text-field"&&g&&!g.glyphs&&Q.push(new lt(a,x,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&xo(ht(x))&&De(x.type)==="identity"&&Q.push(new lt(a,x,'"text-font" does not support identity functions'))),Q.concat(h({key:r.key,value:x,valueSpec:V,style:g,styleSpec:w,expressionContext:"property",propertyType:t,propertyKey:E}))}function $r(r){return Nr(r,"paint")}function gr(r){return Nr(r,"layout")}function so(r){let t=[];const a=r.value,h=r.key,g=r.style,w=r.styleSpec;a.type||a.ref||t.push(new lt(h,a,'either "type" or "ref" is required'));let x=De(a.type);const E=De(a.ref);if(a.id){const M=De(a.id);for(let F=0;F<r.arrayIndex;F++){const V=g.layers[F];De(V.id)===M&&t.push(new lt(h,a.id,`duplicate layer id "${a.id}", previously used at line ${V.id.__line__}`))}}if("ref"in a){let M;["type","source","source-layer","filter","layout"].forEach(F=>{F in a&&t.push(new lt(h,a[F],`"${F}" is prohibited for ref layers`))}),g.layers.forEach(F=>{De(F.id)===E&&(M=F)}),M?M.ref?t.push(new lt(h,a.ref,"ref cannot reference another ref layer")):x=De(M.type):t.push(new lt(h,a.ref,`ref layer "${E}" not found`))}else if(x!=="background")if(a.source){const M=g.sources&&g.sources[a.source],F=M&&De(M.type);M?F==="vector"&&x==="raster"?t.push(new lt(h,a.source,`layer "${a.id}" requires a raster source`)):F!=="raster-dem"&&x==="hillshade"?t.push(new lt(h,a.source,`layer "${a.id}" requires a raster-dem source`)):F==="raster"&&x!=="raster"?t.push(new lt(h,a.source,`layer "${a.id}" requires a vector source`)):F!=="vector"||a["source-layer"]?F==="raster-dem"&&x!=="hillshade"?t.push(new lt(h,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!a.paint||!a.paint["line-gradient"]||F==="geojson"&&M.lineMetrics||t.push(new lt(h,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new lt(h,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new lt(h,a.source,`source "${a.source}" not found`))}else t.push(new lt(h,a,'missing required property "source"'));return t=t.concat(Et({key:h,value:a,valueSpec:w.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${h}.type`,value:a.type,valueSpec:w.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:a,objectKey:"type"}),filter:mr,layout:M=>Et({layer:a,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":F=>gr(Vt({layerType:x},F))}}),paint:M=>Et({layer:a,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":F=>$r(Vt({layerType:x},F))}})}})),t}function es(r){const t=r.value,a=r.key,h=Vi(t);return h!=="string"?[new lt(a,t,`string expected, ${h} found`)]:[]}const za={promoteId:function({key:r,value:t}){if(Vi(t)==="string")return es({key:r,value:t});{const a=[];for(const h in t)a.push(...es({key:`${r}.${h}`,value:t[h]}));return a}}};function jr(r){const t=r.value,a=r.key,h=r.styleSpec,g=r.style,w=r.validateSpec;if(!t.type)return[new lt(a,t,'"type" is required')];const x=De(t.type);let E;switch(x){case"vector":case"raster":return E=Et({key:a,value:t,valueSpec:h[`source_${x.replace("-","_")}`],style:r.style,styleSpec:h,objectElementValidators:za,validateSpec:w}),E;case"raster-dem":return E=function(M){var F;const V=(F=M.sourceName)!==null&&F!==void 0?F:"",G=M.value,Q=M.styleSpec,ne=Q.source_raster_dem,ue=M.style;let de=[];const ke=Vi(G);if(G===void 0)return de;if(ke!=="object")return de.push(new lt("source_raster_dem",G,`object expected, ${ke} found`)),de;const Me=De(G.encoding)==="custom",Qe=["redFactor","greenFactor","blueFactor","baseShift"],Ue=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Ke in G)!Me&&Qe.includes(Ke)?de.push(new lt(Ke,G[Ke],`In "${V}": "${Ke}" is only valid when "encoding" is set to "custom". ${Ue} encoding found`)):ne[Ke]?de=de.concat(M.validateSpec({key:Ke,value:G[Ke],valueSpec:ne[Ke],validateSpec:M.validateSpec,style:ue,styleSpec:Q})):de.push(new lt(Ke,G[Ke],`unknown property "${Ke}"`));return de}({sourceName:a,value:t,style:r.style,styleSpec:h,validateSpec:w}),E;case"geojson":if(E=Et({key:a,value:t,valueSpec:h.source_geojson,style:g,styleSpec:h,validateSpec:w,objectElementValidators:za}),t.cluster)for(const M in t.clusterProperties){const[F,V]=t.clusterProperties[M],G=typeof F=="string"?[F,["accumulated"],["get",M]]:F;E.push(...On({key:`${a}.${M}.map`,value:V,expressionContext:"cluster-map"})),E.push(...On({key:`${a}.${M}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return E;case"video":return Et({key:a,value:t,valueSpec:h.source_video,style:g,validateSpec:w,styleSpec:h});case"image":return Et({key:a,value:t,valueSpec:h.source_image,style:g,validateSpec:w,styleSpec:h});case"canvas":return[new lt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return In({key:`${a}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function bl(r){const t=r.value,a=r.styleSpec,h=a.light,g=r.style;let w=[];const x=Vi(t);if(t===void 0)return w;if(x!=="object")return w=w.concat([new lt("light",t,`object expected, ${x} found`)]),w;for(const E in t){const M=E.match(/^(.*)-transition$/);w=w.concat(M&&h[M[1]]&&h[M[1]].transition?r.validateSpec({key:E,value:t[E],valueSpec:a.transition,validateSpec:r.validateSpec,style:g,styleSpec:a}):h[E]?r.validateSpec({key:E,value:t[E],valueSpec:h[E],validateSpec:r.validateSpec,style:g,styleSpec:a}):[new lt(E,t[E],`unknown property "${E}"`)])}return w}function fu(r){const t=r.value,a=r.styleSpec,h=a.sky,g=r.style,w=Vi(t);if(t===void 0)return[];if(w!=="object")return[new lt("sky",t,`object expected, ${w} found`)];let x=[];for(const E in t)x=x.concat(h[E]?r.validateSpec({key:E,value:t[E],valueSpec:h[E],style:g,styleSpec:a}):[new lt(E,t[E],`unknown property "${E}"`)]);return x}function du(r){const t=r.value,a=r.styleSpec,h=a.terrain,g=r.style;let w=[];const x=Vi(t);if(t===void 0)return w;if(x!=="object")return w=w.concat([new lt("terrain",t,`object expected, ${x} found`)]),w;for(const E in t)w=w.concat(h[E]?r.validateSpec({key:E,value:t[E],valueSpec:h[E],validateSpec:r.validateSpec,style:g,styleSpec:a}):[new lt(E,t[E],`unknown property "${E}"`)]);return w}function pu(r){let t=[];const a=r.value,h=r.key;if(Array.isArray(a)){const g=[],w=[];for(const x in a)a[x].id&&g.includes(a[x].id)&&t.push(new lt(h,a,`all the sprites' ids must be unique, but ${a[x].id} is duplicated`)),g.push(a[x].id),a[x].url&&w.includes(a[x].url)&&t.push(new lt(h,a,`all the sprites' URLs must be unique, but ${a[x].url} is duplicated`)),w.push(a[x].url),t=t.concat(Et({key:`${h}[${x}]`,value:a[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return es({key:h,value:a})}const lc={"*":()=>[],array:Wt,boolean:function(r){const t=r.value,a=r.key,h=Vi(t);return h!=="boolean"?[new lt(a,t,`boolean expected, ${h} found`)]:[]},number:Zi,color:function(r){const t=r.key,a=r.value,h=Vi(a);return h!=="string"?[new lt(t,a,`color expected, ${h} found`)]:ri.parse(String(a))?[]:[new lt(t,a,`color expected, "${a}" found`)]},constants:se,enum:In,filter:mr,function:on,layer:so,object:Et,source:jr,light:bl,sky:fu,terrain:du,projection:function(r){const t=r.value,a=r.styleSpec,h=a.projection,g=r.style,w=Vi(t);if(t===void 0)return[];if(w!=="object")return[new lt("projection",t,`object expected, ${w} found`)];let x=[];for(const E in t)x=x.concat(h[E]?r.validateSpec({key:E,value:t[E],valueSpec:h[E],style:g,styleSpec:a}):[new lt(E,t[E],`unknown property "${E}"`)]);return x},string:es,formatted:function(r){return es(r).length===0?[]:On(r)},resolvedImage:function(r){return es(r).length===0?[]:On(r)},padding:function(r){const t=r.key,a=r.value;if(Vi(a)==="array"){if(a.length<1||a.length>4)return[new lt(t,a,`padding requires 1 to 4 values; ${a.length} values found`)];const h={type:"number"};let g=[];for(let w=0;w<a.length;w++)g=g.concat(r.validateSpec({key:`${t}[${w}]`,value:a[w],validateSpec:r.validateSpec,valueSpec:h}));return g}return Zi({key:t,value:a,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,a=r.value,h=Vi(a),g=r.styleSpec;if(h!=="array"||a.length<1||a.length%2!=0)return[new lt(t,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<a.length;x+=2)w=w.concat(In({key:`${t}[${x}]`,value:a[x],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Wt({key:`${t}[${x+1}]`,value:a[x+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:g}));return w},sprite:pu};function vl(r){const t=r.value,a=r.valueSpec,h=r.styleSpec;return r.validateSpec=vl,a.expression&&xo(De(t))?on(r):a.expression&&Ma(ht(t))?On(r):a.type&&lc[a.type]?lc[a.type](r):Et(Vt({},r,{valueSpec:a.type?h[a.type]:a}))}function _h(r){const t=r.value,a=r.key,h=es(r);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new lt(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new lt(a,t,'"glyphs" url must include a "{range}" token'))),h}function ts(r,t=Je){let a=[];return a=a.concat(vl({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:vl,objectElementValidators:{glyphs:_h,"*":()=>[]}})),r.constants&&(a=a.concat(se({key:"constants",value:r.constants}))),mu(a)}function Os(r){return function(t){return r({...t,validateSpec:vl})}}function mu(r){return[].concat(r).sort((t,a)=>t.line-a.line)}function ps(r){return function(...t){return mu(r.apply(this,t))}}ts.source=ps(Os(jr)),ts.sprite=ps(Os(pu)),ts.glyphs=ps(Os(_h)),ts.light=ps(Os(bl)),ts.sky=ps(Os(fu)),ts.terrain=ps(Os(du)),ts.layer=ps(Os(so)),ts.filter=ps(Os(mr)),ts.paintProperty=ps(Os($r)),ts.layoutProperty=ps(Os(gr));const ra=ts,kf=ra.light,Cf=ra.sky,yh=ra.paintProperty,bh=ra.layoutProperty;function gu(r,t){let a=!1;if(t&&t.length)for(const h of t)r.fire(new Pt(new Error(h.message))),a=!0;return a}class Oa{constructor(t,a,h){const g=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(a=x[1])+2*(h=x[2]);for(let M=0;M<this.d*this.d;M++){const F=x[3+M],V=x[3+M+1];g.push(F===V?null:x.subarray(F,V))}const E=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],E),this.bboxes=x.subarray(E),this.insert=this._insertReadonly}else{this.d=a+2*h;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=h,this.scale=a/t,this.uid=0;const w=h/a*t;this.min=-w,this.max=t+w}insert(t,a,h,g,w){this._forEachCell(a,h,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,a,h,g,w,x){this.cells[w].push(x)}query(t,a,h,g,w){const x=this.min,E=this.max;if(t<=x&&a<=x&&E<=h&&E<=g&&!w)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(t,a,h,g,this._queryCell,M,{},w),M}}_queryCell(t,a,h,g,w,x,E,M){const F=this.cells[w];if(F!==null){const V=this.keys,G=this.bboxes;for(let Q=0;Q<F.length;Q++){const ne=F[Q];if(E[ne]===void 0){const ue=4*ne;(M?M(G[ue+0],G[ue+1],G[ue+2],G[ue+3]):t<=G[ue+2]&&a<=G[ue+3]&&h>=G[ue+0]&&g>=G[ue+1])?(E[ne]=!0,x.push(V[ne])):E[ne]=!1}}}}_forEachCell(t,a,h,g,w,x,E,M){const F=this._convertToCellCoord(t),V=this._convertToCellCoord(a),G=this._convertToCellCoord(h),Q=this._convertToCellCoord(g);for(let ne=F;ne<=G;ne++)for(let ue=V;ue<=Q;ue++){const de=this.d*ue+ne;if((!M||M(this._convertFromCellCoord(ne),this._convertFromCellCoord(ue),this._convertFromCellCoord(ne+1),this._convertFromCellCoord(ue+1)))&&w.call(this,t,a,h,g,de,x,E,M))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,a=3+this.cells.length+1+1;let h=0;for(let x=0;x<this.cells.length;x++)h+=this.cells[x].length;const g=new Int32Array(a+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=a;for(let x=0;x<t.length;x++){const E=t[x];g[3+x]=w,g.set(E,w),w+=E.length}return g[3+t.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+t.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(t,a){const h=t.toArrayBuffer();return a&&a.push(h),{buffer:h}}static deserialize(t){return new Oa(t.buffer)}}const is={};function Ut(r,t,a={}){if(is[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),is[r]={klass:t,omit:a.omit||[],shallow:a.shallow||[]}}Ut("Object",Object),Ut("TransferableGridIndex",Oa),Ut("Color",ri),Ut("Error",Error),Ut("AJAXError",Zt),Ut("ResolvedImage",Hn),Ut("StylePropertyFunction",ko),Ut("StyleExpression",So,{omit:["_evaluator"]}),Ut("ZoomDependentExpression",To),Ut("ZoomConstantExpression",pr),Ut("CompoundExpression",kr,{omit:["_evaluate"]});for(const r in yo)yo[r]._classRegistryKey||Ut(`Expression_${r}`,yo[r]);function cc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function _u(r){return r.$name||r.constructor._classRegistryKey}function vh(r){return!function(t){if(t===null||typeof t!="object")return!1;const a=_u(t);return!(!a||a==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||cc(r)||ce(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Da(r,t){if(vh(r))return(cc(r)||ce(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const w=[];for(const x of r)w.push(Da(x,t));return w}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const a=_u(r);if(!a)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!is[a])throw new Error(`${a} is not registered.`);const{klass:h}=is[a],g=h.serialize?h.serialize(r,t):{};if(h.serialize){if(t&&g===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in r){if(!r.hasOwnProperty(w)||is[a].omit.indexOf(w)>=0)continue;const x=r[w];g[w]=is[a].shallow.indexOf(w)>=0?x:Da(x,t)}r instanceof Error&&(g.message=r.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(g.$name=a),g}function Fa(r){if(vh(r))return r;if(Array.isArray(r))return r.map(Fa);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=_u(r)||"Object";if(!is[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:a}=is[t];if(!a)throw new Error(`can't deserialize unregistered class ${t}`);if(a.deserialize)return a.deserialize(r);const h=Object.create(a.prototype);for(const g of Object.keys(r)){if(g==="$name")continue;const w=r[g];h[g]=is[t].shallow.indexOf(g)>=0?w:Fa(w)}return h}class yu{constructor(){this.first=!0}update(t,a){const h=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=h,!0))}}const ji={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function bu(r){for(const t of r)if(wu(t.charCodeAt(0)))return!0;return!1}function Ef(r){for(const t of r)if(!Ra(t.charCodeAt(0)))return!1;return!0}function vu(r){const t=r.map(a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}}).filter(a=>a);return new RegExp(t.join("|"),"u")}const If=vu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ra(r){return!If.test(String.fromCodePoint(r))}const wh=vu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function wu(r){return!(r!==746&&r!==747&&(r<4352||!(ji["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ji["CJK Compatibility"](r)||ji["CJK Strokes"](r)||!(!ji["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ji["Enclosed CJK Letters and Months"](r)||ji["Ideographic Description Characters"](r)||ji.Kanbun(r)||ji.Katakana(r)&&r!==12540||!(!ji["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ji["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ji["Vertical Forms"](r)||ji["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||wh.test(String.fromCodePoint(r)))))}function xh(r){return!(wu(r)||function(t){return!!(ji["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ji["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ji["Letterlike Symbols"](t)||ji["Number Forms"](t)||ji["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ji["Control Pictures"](t)&&t!==9251||ji["Optical Character Recognition"](t)||ji["Enclosed Alphanumerics"](t)||ji["Geometric Shapes"](t)||ji["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ji["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ji["CJK Symbols and Punctuation"](t)||ji.Katakana(t)||ji["Private Use Area"](t)||ji["CJK Compatibility Forms"](t)||ji["Small Form Variants"](t)||ji["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const Af=vu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function xu(r){return Af.test(String.fromCodePoint(r))}function Mf(r,t){return!(!t&&xu(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ji.Khmer(r))}function Pf(r){for(const t of r)if(xu(t.charCodeAt(0)))return!0;return!1}const Ur=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class mn{constructor(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yu,this.transition={})}isSupportedScript(t){return function(a,h){for(const g of a)if(!Mf(g.charCodeAt(0),h))return!1;return!0}(t,Ur.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,a=t-Math.floor(t),h=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*a}}}class Ba{constructor(t,a){this.property=t,this.value=a,this.expression=function(h,g){if(xo(h))return new ko(h,g);if(Ma(h)){const w=gl(h,g);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=h;return g.type==="color"&&typeof h=="string"?w=ri.parse(h):g.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(h)&&(w=zn.parse(h)):w=pn.parse(h),{kind:"constant",evaluate:()=>w}}}(a===void 0?t.specification.default:a,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,a,h){return this.property.possiblyEvaluate(this,t,a,h)}}class uc{constructor(t){this.property=t,this.value=new Ba(t,void 0)}transitioned(t,a){return new Sh(this.property,this.value,a,re({},t.transition,this.transition),t.now)}untransitioned(){return new Sh(this.property,this.value,null,{},0)}}class hc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return B(this._values[t].value.value)}setValue(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new uc(this._values[t].property)),this._values[t].value=new Ba(this._values[t].property,a===null?void 0:B(a))}getTransition(t){return B(this._values[t].transition)}setTransition(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new uc(this._values[t].property)),this._values[t].transition=B(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(t[a]=h);const g=this.getTransition(a);g!==void 0&&(t[`${a}-transition`]=g)}return t}transitioned(t,a){const h=new wl(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(t,a._values[g]);return h}untransitioned(){const t=new wl(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}}class Sh{constructor(t,a,h,g,w){this.property=t,this.value=a,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,t.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(t,a,h){const g=t.now||0,w=this.value.possiblyEvaluate(t,a,h),x=this.prior;if(x){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return x.possiblyEvaluate(t,a,h);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,a,h),w,function(M){if(M<=0)return 0;if(M>=1)return 1;const F=M*M,V=F*M;return 4*(M<.5?V:3*(M-F)+V-.75)}(E))}}return w}}class wl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,h){const g=new Sl(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(t,a,h);return g}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class xl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return B(this._values[t].value)}setValue(t,a){this._values[t]=new Ba(this._values[t].property,a===null?void 0:B(a))}serialize(){const t={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(t[a]=h)}return t}possiblyEvaluate(t,a,h){const g=new Sl(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(t,a,h);return g}}class Ds{constructor(t,a,h){this.property=t,this.value=a,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,a,h,g){return this.property.evaluate(this.value,this.parameters,t,a,h,g)}}class Sl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Gt{constructor(t){this.specification=t}possiblyEvaluate(t,a){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(a)}interpolate(t,a,h){const g=Vn[this.specification.type];return g?g(t,a,h):t}}class ui{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,h,g){return new Ds(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},h,g)}:t.expression,a)}interpolate(t,a,h){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new Ds(this,{kind:"constant",value:void 0},t.parameters);const g=Vn[this.specification.type];if(g){const w=g(t.value.value,a.value.value,h);return new Ds(this,{kind:"constant",value:w},t.parameters)}return t}evaluate(t,a,h,g,w,x){return t.kind==="constant"?t.value:t.evaluate(a,h,g,w,x)}}class fc extends ui{possiblyEvaluate(t,a,h,g){if(t.value===void 0)return new Ds(this,{kind:"constant",value:void 0},a);if(t.expression.kind==="constant"){const w=t.expression.evaluate(a,null,{},h,g),x=t.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,E=this._calculate(x,x,x,a);return new Ds(this,{kind:"constant",value:E},a)}if(t.expression.kind==="camera"){const w=this._calculate(t.expression.evaluate({zoom:a.zoom-1}),t.expression.evaluate({zoom:a.zoom}),t.expression.evaluate({zoom:a.zoom+1}),a);return new Ds(this,{kind:"constant",value:w},a)}return new Ds(this,t.expression,a)}evaluate(t,a,h,g,w,x){if(t.kind==="source"){const E=t.evaluate(a,h,g,w,x);return this._calculate(E,E,E,a)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(a.zoom)-1},h,g),t.evaluate({zoom:Math.floor(a.zoom)},h,g),t.evaluate({zoom:Math.floor(a.zoom)+1},h,g),a):t.value}_calculate(t,a,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:h,to:a}}interpolate(t){return t}}class dc{constructor(t){this.specification=t}possiblyEvaluate(t,a,h,g){if(t.value!==void 0){if(t.expression.kind==="constant"){const w=t.expression.evaluate(a,null,{},h,g);return this._calculate(w,w,w,a)}return this._calculate(t.expression.evaluate(new mn(Math.floor(a.zoom-1),a)),t.expression.evaluate(new mn(Math.floor(a.zoom),a)),t.expression.evaluate(new mn(Math.floor(a.zoom+1),a)),a)}}_calculate(t,a,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:h,to:a}}interpolate(t){return t}}class Su{constructor(t){this.specification=t}possiblyEvaluate(t,a,h,g){return!!t.expression.evaluate(a,null,{},h,g)}interpolate(){return!1}}class v{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in t){const h=t[a];h.specification.overridable&&this.overridableProperties.push(a);const g=this.defaultPropertyValues[a]=new Ba(h,void 0),w=this.defaultTransitionablePropertyValues[a]=new uc(h);this.defaultTransitioningPropertyValues[a]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=g.possiblyEvaluate({})}}}Ut("DataDrivenProperty",ui),Ut("DataConstantProperty",Gt),Ut("CrossFadedDataDrivenProperty",fc),Ut("CrossFadedProperty",dc),Ut("ColorRampProperty",Su);const e="-transition";class c extends ii{constructor(t,a){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),a.layout&&(this._unevaluatedLayout=new xl(a.layout)),a.paint)){this._transitionablePaint=new hc(a.paint);for(const h in t.paint)this.setPaintProperty(h,t.paint[h],{validate:!1});for(const h in t.layout)this.setLayoutProperty(h,t.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Sl(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,a,h={}){a!=null&&this._validate(bh,`layers.${this.id}.layout.${t}`,t,a,h)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,a):this.visibility=a)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,a,h={}){if(a!=null&&this._validate(yh,`layers.${this.id}.paint.${t}`,t,a,h))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),a||void 0),!1;{const g=this._transitionablePaint._values[t],w=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),E=g.value;this._transitionablePaint.setValue(t,a),this._handleSpecialPaintPropertyUpdate(t);const M=this._transitionablePaint._values[t].value;return M.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(t,E,M)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,a,h){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),J(t,(a,h)=>!(a===void 0||h==="layout"&&!Object.keys(a).length||h==="paint"&&!Object.keys(a).length))}_validate(t,a,h,g,w={}){return(!w||w.validate!==!1)&&gu(this,t.call(ra,{key:a,layerType:this.type,objectKey:h,value:g,styleSpec:Je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof Ds&&wo(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class b{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function A(r,t=1){let a=0,h=0;return{members:r.map(g=>{const w=p[g.type].BYTES_PER_ELEMENT,x=a=P(a,Math.max(t,w)),E=g.components||1;return h=Math.max(h,w),a+=w*E,{name:g.name,type:g.type,components:E,offset:x}}),size:P(a,Math.max(h,t)),alignment:t}}function P(r,t){return Math.ceil(r/t)*t}class O extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,a)}emplace(t,a,h){const g=2*t;return this.int16[g+0]=a,this.int16[g+1]=h,t}}O.prototype.bytesPerElement=4,Ut("StructArrayLayout2i4",O);class q extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,h)}emplace(t,a,h,g){const w=3*t;return this.int16[w+0]=a,this.int16[w+1]=h,this.int16[w+2]=g,t}}q.prototype.bytesPerElement=6,Ut("StructArrayLayout3i6",q);class X extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,h,g)}emplace(t,a,h,g,w){const x=4*t;return this.int16[x+0]=a,this.int16[x+1]=h,this.int16[x+2]=g,this.int16[x+3]=w,t}}X.prototype.bytesPerElement=8,Ut("StructArrayLayout4i8",X);class K extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,a,h,g,w,x)}emplace(t,a,h,g,w,x,E){const M=6*t;return this.int16[M+0]=a,this.int16[M+1]=h,this.int16[M+2]=g,this.int16[M+3]=w,this.int16[M+4]=x,this.int16[M+5]=E,t}}K.prototype.bytesPerElement=12,Ut("StructArrayLayout2i4i12",K);class oe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,a,h,g,w,x)}emplace(t,a,h,g,w,x,E){const M=4*t,F=8*t;return this.int16[M+0]=a,this.int16[M+1]=h,this.uint8[F+4]=g,this.uint8[F+5]=w,this.uint8[F+6]=x,this.uint8[F+7]=E,t}}oe.prototype.bytesPerElement=8,Ut("StructArrayLayout2i4ub8",oe);class me extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,a)}emplace(t,a,h){const g=2*t;return this.float32[g+0]=a,this.float32[g+1]=h,t}}me.prototype.bytesPerElement=8,Ut("StructArrayLayout2f8",me);class ye extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x,E,M,F,V){const G=this.length;return this.resize(G+1),this.emplace(G,t,a,h,g,w,x,E,M,F,V)}emplace(t,a,h,g,w,x,E,M,F,V,G){const Q=10*t;return this.uint16[Q+0]=a,this.uint16[Q+1]=h,this.uint16[Q+2]=g,this.uint16[Q+3]=w,this.uint16[Q+4]=x,this.uint16[Q+5]=E,this.uint16[Q+6]=M,this.uint16[Q+7]=F,this.uint16[Q+8]=V,this.uint16[Q+9]=G,t}}ye.prototype.bytesPerElement=20,Ut("StructArrayLayout10ui20",ye);class Ce extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x,E,M,F,V,G,Q){const ne=this.length;return this.resize(ne+1),this.emplace(ne,t,a,h,g,w,x,E,M,F,V,G,Q)}emplace(t,a,h,g,w,x,E,M,F,V,G,Q,ne){const ue=12*t;return this.int16[ue+0]=a,this.int16[ue+1]=h,this.int16[ue+2]=g,this.int16[ue+3]=w,this.uint16[ue+4]=x,this.uint16[ue+5]=E,this.uint16[ue+6]=M,this.uint16[ue+7]=F,this.int16[ue+8]=V,this.int16[ue+9]=G,this.int16[ue+10]=Q,this.int16[ue+11]=ne,t}}Ce.prototype.bytesPerElement=24,Ut("StructArrayLayout4i4ui4i24",Ce);class Pe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,h)}emplace(t,a,h,g){const w=3*t;return this.float32[w+0]=a,this.float32[w+1]=h,this.float32[w+2]=g,t}}Pe.prototype.bytesPerElement=12,Ut("StructArrayLayout3f12",Pe);class Oe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}Oe.prototype.bytesPerElement=4,Ut("StructArrayLayout1ul4",Oe);class Ne extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x,E,M,F){const V=this.length;return this.resize(V+1),this.emplace(V,t,a,h,g,w,x,E,M,F)}emplace(t,a,h,g,w,x,E,M,F,V){const G=10*t,Q=5*t;return this.int16[G+0]=a,this.int16[G+1]=h,this.int16[G+2]=g,this.int16[G+3]=w,this.int16[G+4]=x,this.int16[G+5]=E,this.uint32[Q+3]=M,this.uint16[G+8]=F,this.uint16[G+9]=V,t}}Ne.prototype.bytesPerElement=20,Ut("StructArrayLayout6i1ul2ui20",Ne);class Te extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,a,h,g,w,x)}emplace(t,a,h,g,w,x,E){const M=6*t;return this.int16[M+0]=a,this.int16[M+1]=h,this.int16[M+2]=g,this.int16[M+3]=w,this.int16[M+4]=x,this.int16[M+5]=E,t}}Te.prototype.bytesPerElement=12,Ut("StructArrayLayout2i2i2i12",Te);class We extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w){const x=this.length;return this.resize(x+1),this.emplace(x,t,a,h,g,w)}emplace(t,a,h,g,w,x){const E=4*t,M=8*t;return this.float32[E+0]=a,this.float32[E+1]=h,this.float32[E+2]=g,this.int16[M+6]=w,this.int16[M+7]=x,t}}We.prototype.bytesPerElement=16,Ut("StructArrayLayout2f1f2i16",We);class Xe extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,a,h,g,w,x)}emplace(t,a,h,g,w,x,E){const M=16*t,F=4*t,V=8*t;return this.uint8[M+0]=a,this.uint8[M+1]=h,this.float32[F+1]=g,this.float32[F+2]=w,this.int16[V+6]=x,this.int16[V+7]=E,t}}Xe.prototype.bytesPerElement=16,Ut("StructArrayLayout2ub2f2i16",Xe);class it extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,h)}emplace(t,a,h,g){const w=3*t;return this.uint16[w+0]=a,this.uint16[w+1]=h,this.uint16[w+2]=g,t}}it.prototype.bytesPerElement=6,Ut("StructArrayLayout3ui6",it);class mt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x,E,M,F,V,G,Q,ne,ue,de,ke,Me){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,t,a,h,g,w,x,E,M,F,V,G,Q,ne,ue,de,ke,Me)}emplace(t,a,h,g,w,x,E,M,F,V,G,Q,ne,ue,de,ke,Me,Qe){const Ue=24*t,Ke=12*t,at=48*t;return this.int16[Ue+0]=a,this.int16[Ue+1]=h,this.uint16[Ue+2]=g,this.uint16[Ue+3]=w,this.uint32[Ke+2]=x,this.uint32[Ke+3]=E,this.uint32[Ke+4]=M,this.uint16[Ue+10]=F,this.uint16[Ue+11]=V,this.uint16[Ue+12]=G,this.float32[Ke+7]=Q,this.float32[Ke+8]=ne,this.uint8[at+36]=ue,this.uint8[at+37]=de,this.uint8[at+38]=ke,this.uint32[Ke+10]=Me,this.int16[Ue+22]=Qe,t}}mt.prototype.bytesPerElement=48,Ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",mt);class Tt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,h,g,w,x,E,M,F,V,G,Q,ne,ue,de,ke,Me,Qe,Ue,Ke,at,wt,Bt,ci,Ft,Ot,Yt,qt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,t,a,h,g,w,x,E,M,F,V,G,Q,ne,ue,de,ke,Me,Qe,Ue,Ke,at,wt,Bt,ci,Ft,Ot,Yt,qt)}emplace(t,a,h,g,w,x,E,M,F,V,G,Q,ne,ue,de,ke,Me,Qe,Ue,Ke,at,wt,Bt,ci,Ft,Ot,Yt,qt,jt){const ft=32*t,ei=16*t;return this.int16[ft+0]=a,this.int16[ft+1]=h,this.int16[ft+2]=g,this.int16[ft+3]=w,this.int16[ft+4]=x,this.int16[ft+5]=E,this.int16[ft+6]=M,this.int16[ft+7]=F,this.uint16[ft+8]=V,this.uint16[ft+9]=G,this.uint16[ft+10]=Q,this.uint16[ft+11]=ne,this.uint16[ft+12]=ue,this.uint16[ft+13]=de,this.uint16[ft+14]=ke,this.uint16[ft+15]=Me,this.uint16[ft+16]=Qe,this.uint16[ft+17]=Ue,this.uint16[ft+18]=Ke,this.uint16[ft+19]=at,this.uint16[ft+20]=wt,this.uint16[ft+21]=Bt,this.uint16[ft+22]=ci,this.uint32[ei+12]=Ft,this.float32[ei+13]=Ot,this.float32[ei+14]=Yt,this.uint16[ft+30]=qt,this.uint16[ft+31]=jt,t}}Tt.prototype.bytesPerElement=64,Ut("StructArrayLayout8i15ui1ul2f2ui64",Tt);class Dt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}Dt.prototype.bytesPerElement=4,Ut("StructArrayLayout1f4",Dt);class Nt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,h)}emplace(t,a,h,g){const w=3*t;return this.uint16[6*t+0]=a,this.float32[w+1]=h,this.float32[w+2]=g,t}}Nt.prototype.bytesPerElement=12,Ut("StructArrayLayout1ui2f12",Nt);class Lt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,a,h)}emplace(t,a,h,g){const w=4*t;return this.uint32[2*t+0]=a,this.uint16[w+2]=h,this.uint16[w+3]=g,t}}Lt.prototype.bytesPerElement=8,Ut("StructArrayLayout1ul2ui8",Lt);class Mt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,a)}emplace(t,a,h){const g=2*t;return this.uint16[g+0]=a,this.uint16[g+1]=h,t}}Mt.prototype.bytesPerElement=4,Ut("StructArrayLayout2ui4",Mt);class Ht extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}Ht.prototype.bytesPerElement=2,Ut("StructArrayLayout1ui2",Ht);class vi extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,t,a,h,g)}emplace(t,a,h,g,w){const x=4*t;return this.float32[x+0]=a,this.float32[x+1]=h,this.float32[x+2]=g,this.float32[x+3]=w,t}}vi.prototype.bytesPerElement=16,Ut("StructArrayLayout4f16",vi);class zt extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}zt.prototype.size=20;class Rt extends Ne{get(t){return new zt(this,t)}}Ut("CollisionBoxArray",Rt);class _i extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_i.prototype.size=48;class gn extends mt{get(t){return new _i(this,t)}}Ut("PlacedSymbolArray",gn);class Ii extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ii.prototype.size=64;class Ni extends Tt{get(t){return new Ii(this,t)}}Ut("SymbolInstanceArray",Ni);class _n extends Dt{getoffsetX(t){return this.float32[1*t+0]}}Ut("GlyphOffsetArray",_n);class nr extends q{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ut("SymbolLineVertexArray",nr);class ms extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ms.prototype.size=12;class yn extends Nt{get(t){return new ms(this,t)}}Ut("TextAnchorOffsetArray",yn);class Ir extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ir.prototype.size=8;class _r extends Lt{get(t){return new Ir(this,t)}}Ut("FeatureIndexArray",_r);class rr extends O{}class yr extends O{}class Fs extends O{}class Na extends K{}class pc extends oe{}class ja extends me{}class ns extends ye{}class mc extends Ce{}class Tu extends Pe{}class rs extends Oe{}class ss extends Te{}class Eo extends Xe{}class gs extends it{}class er extends Mt{}const sr=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vr}=sr;class Ui{constructor(t=[]){this.segments=t}prepareSegment(t,a,h,g){let w=this.segments[this.segments.length-1];return t>Ui.MAX_VERTEX_ARRAY_LENGTH&&le(`Max vertices per segment is ${Ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!w||w.vertexLength+t>Ui.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:a.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,h,g){return new Ui([{vertexOffset:t,primitiveOffset:a,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}function sa(r,t){return 256*(r=ae(Math.floor(r),0,255))+ae(Math.floor(t),0,255)}Ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut("SegmentVector",Ui);const Ua=A([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Va={exports:{}},Th={exports:{}};Th.exports=function(r,t){var a,h,g,w,x,E,M,F;for(h=r.length-(a=3&r.length),g=t,x=3432918353,E=461845907,F=0;F<h;)M=255&r.charCodeAt(F)|(255&r.charCodeAt(++F))<<8|(255&r.charCodeAt(++F))<<16|(255&r.charCodeAt(++F))<<24,++F,g=27492+(65535&(w=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(M=0,a){case 3:M^=(255&r.charCodeAt(F+2))<<16;case 2:M^=(255&r.charCodeAt(F+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&r.charCodeAt(F)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Lf=Th.exports,kh={exports:{}};kh.exports=function(r,t){for(var a,h=r.length,g=t^h,w=0;h>=4;)a=1540483477*(65535&(a=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24))+((1540483477*(a>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),h-=4,++w;switch(h){case 3:g^=(255&r.charCodeAt(w+2))<<16;case 2:g^=(255&r.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Io=Lf,Ch=kh.exports;Va.exports=Io,Va.exports.murmur3=Io,Va.exports.murmur2=Ch;var gc=_(Va.exports);class Tl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,a,h,g){this.ids.push(_c(t)),this.positions.push(a,h,g)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=_c(t);let h=0,g=this.ids.length-1;for(;h<g;){const x=h+g>>1;this.ids[x]>=a?g=x:h=x+1}const w=[];for(;this.ids[h]===a;)w.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return w}static serialize(t,a){const h=new Float64Array(t.ids),g=new Uint32Array(t.positions);return yc(h,g,0,h.length-1),a&&a.push(h.buffer,g.buffer),{ids:h,positions:g}}static deserialize(t){const a=new Tl;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a}}function _c(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:gc(String(r))}function yc(r,t,a,h){for(;a<h;){const g=r[a+h>>1];let w=a-1,x=h+1;for(;;){do w++;while(r[w]<g);do x--;while(r[x]>g);if(w>=x)break;qa(r,w,x),qa(t,3*w,3*x),qa(t,3*w+1,3*x+1),qa(t,3*w+2,3*x+2)}x-a<h-x?(yc(r,t,a,x),a=x+1):(yc(r,t,x+1,h),h=x)}}function qa(r,t,a){const h=r[t];r[t]=r[a],r[a]=h}Ut("FeaturePositionMap",Tl);class kl{constructor(t,a){this.gl=t.gl,this.location=a}}class Eh extends kl{constructor(t,a){super(t,a),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class wp extends kl{constructor(t,a){super(t,a),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class xp extends kl{constructor(t,a){super(t,a),this.current=ri.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ob=new Float32Array(16);function zf(r){return[sa(255*r.r,255*r.g),sa(255*r.b,255*r.a)]}class ku{constructor(t,a,h){this.value=t,this.uniformNames=a.map(g=>`u_${g}`),this.type=h}setUniform(t,a,h){t.set(h.constantOr(this.value))}getBinding(t,a,h){return this.type==="color"?new xp(t,a):new Eh(t,a)}}class bc{constructor(t,a){this.uniformNames=a.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr}setUniform(t,a,h,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&t.set(w)}getBinding(t,a,h){return h.substr(0,9)==="u_pattern"?new wp(t,a):new Eh(t,a)}}class oa{constructor(t,a,h,g){this.expression=t,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map(w=>({name:`a_${w}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,a,h,g,w){const x=this.paintVertexArray.length,E=this.expression.evaluate(new mn(0),a,{},g,[],w);this.paintVertexArray.resize(t),this._setPaintValue(x,t,E)}updatePaintArray(t,a,h,g){const w=this.expression.evaluate({zoom:0},h,g);this._setPaintValue(t,a,w)}_setPaintValue(t,a,h){if(this.type==="color"){const g=zf(h);for(let w=t;w<a;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=t;g<a;g++)this.paintVertexArray.emplace(g,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class oo{constructor(t,a,h,g,w,x){this.expression=t,this.uniformNames=a.map(E=>`u_${E}_t`),this.type=h,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=a.map(E=>({name:`a_${E}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,a,h,g,w){const x=this.expression.evaluate(new mn(this.zoom),a,{},g,[],w),E=this.expression.evaluate(new mn(this.zoom+1),a,{},g,[],w),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,E)}updatePaintArray(t,a,h,g){const w=this.expression.evaluate({zoom:this.zoom},h,g),x=this.expression.evaluate({zoom:this.zoom+1},h,g);this._setPaintValue(t,a,w,x)}_setPaintValue(t,a,h,g){if(this.type==="color"){const w=zf(h),x=zf(g);for(let E=t;E<a;E++)this.paintVertexArray.emplace(E,w[0],w[1],x[0],x[1])}else{for(let w=t;w<a;w++)this.paintVertexArray.emplace(w,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a){const h=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,g=ae(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);t.set(g)}getBinding(t,a,h){return new Eh(t,a)}}class Za{constructor(t,a,h,g,w,x){this.expression=t,this.type=a,this.useIntegerZoom=h,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(t,a,h){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(g,t,a.patterns&&a.patterns[this.layerId],h)}updatePaintArray(t,a,h,g,w){this._setPaintValues(t,a,h.patterns&&h.patterns[this.layerId],w)}_setPaintValues(t,a,h,g){if(!g||!h)return;const{min:w,mid:x,max:E}=h,M=g[w],F=g[x],V=g[E];if(M&&F&&V)for(let G=t;G<a;G++)this.zoomInPaintVertexArray.emplace(G,F.tl[0],F.tl[1],F.br[0],F.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],F.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,F.tl[0],F.tl[1],F.br[0],F.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],F.pixelRatio,V.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ua.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ua.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Sp{constructor(t,a,h){this.binders={},this._buffers=[];const g=[];for(const w in t.paint._values){if(!h(w))continue;const x=t.paint.get(w);if(!(x instanceof Ds&&wo(x.property.specification)))continue;const E=ab(w,t.type),M=x.value,F=x.property.specification.type,V=x.property.useIntegerZoom,G=x.property.specification["property-type"],Q=G==="cross-faded"||G==="cross-faded-data-driven";if(M.kind==="constant")this.binders[w]=Q?new bc(M.value,E):new ku(M.value,E,F),g.push(`/u_${w}`);else if(M.kind==="source"||Q){const ne=Tp(w,F,"source");this.binders[w]=Q?new Za(M,F,V,a,ne,t.id):new oa(M,E,F,ne),g.push(`/a_${w}`)}else{const ne=Tp(w,F,"composite");this.binders[w]=new oo(M,E,F,V,a,ne),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof oa||a instanceof oo?a.maxValue:0}populatePaintArrays(t,a,h,g,w){for(const x in this.binders){const E=this.binders[x];(E instanceof oa||E instanceof oo||E instanceof Za)&&E.populatePaintArray(t,a,h,g,w)}}setConstantPatternPositions(t,a){for(const h in this.binders){const g=this.binders[h];g instanceof bc&&g.setConstantPatternPositions(t,a)}}updatePaintArrays(t,a,h,g,w){let x=!1;for(const E in t){const M=a.getPositions(E);for(const F of M){const V=h.feature(F.index);for(const G in this.binders){const Q=this.binders[G];if((Q instanceof oa||Q instanceof oo||Q instanceof Za)&&Q.expression.isStateDependent===!0){const ne=g.paint.get(G);Q.expression=ne.value,Q.updatePaintArray(F.start,F.end,V,t[E],w),x=!0}}}}return x}defines(){const t=[];for(const a in this.binders){const h=this.binders[a];(h instanceof ku||h instanceof bc)&&t.push(...h.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return t}getBinderAttributes(){const t=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof oa||h instanceof oo)for(let g=0;g<h.paintVertexAttributes.length;g++)t.push(h.paintVertexAttributes[g].name);else if(h instanceof Za)for(let g=0;g<Ua.members.length;g++)t.push(Ua.members[g].name)}return t}getBinderUniforms(){const t=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof ku||h instanceof bc||h instanceof oo)for(const g of h.uniformNames)t.push(g)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,a){const h=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof ku||w instanceof bc||w instanceof oo){for(const x of w.uniformNames)if(a[x]){const E=w.getBinding(t,a[x],x);h.push({name:x,property:g,binding:E})}}}return h}setUniforms(t,a,h,g){for(const{name:w,property:x,binding:E}of a)this.binders[x].setUniform(E,g,h.get(x),w)}updatePaintBuffers(t){this._buffers=[];for(const a in this.binders){const h=this.binders[a];if(t&&h instanceof Za){const g=t.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(h instanceof oa||h instanceof oo)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(t){for(const a in this.binders){const h=this.binders[a];(h instanceof oa||h instanceof oo||h instanceof Za)&&h.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof oa||a instanceof oo||a instanceof Za)&&a.destroy()}}}class Cl{constructor(t,a,h=()=>!0){this.programConfigurations={};for(const g of t)this.programConfigurations[g.id]=new Sp(g,a,h);this.needsUpload=!1,this._featureMap=new Tl,this._bufferOffset=0}populatePaintArrays(t,a,h,g,w,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(t,a,g,w,x);a.id!==void 0&&this._featureMap.add(a.id,h,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,h,g){for(const w of h)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(t,this._featureMap,a,w,g)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ab(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Tp(r,t,a){const h={color:{source:me,composite:vi},number:{source:Dt,composite:me}},g=function(w){return{"line-pattern":{source:ns,composite:ns},"fill-pattern":{source:ns,composite:ns},"fill-extrusion-pattern":{source:ns,composite:ns}}[w]}(r);return g&&g[a]||h[t][a]}Ut("ConstantBinder",ku),Ut("CrossFadedConstantBinder",bc),Ut("SourceExpressionBinder",oa),Ut("CrossFadedCompositeBinder",Za),Ut("CompositeExpressionBinder",oo),Ut("ProgramConfiguration",Sp,{omit:["_buffers"]}),Ut("ProgramConfigurationSet",Cl);const Nn=8192,Of=Math.pow(2,14)-1,kp=-Of-1;function El(r){const t=Nn/r.extent,a=r.loadGeometry();for(let h=0;h<a.length;h++){const g=a[h];for(let w=0;w<g.length;w++){const x=g[w],E=Math.round(x.x*t),M=Math.round(x.y*t);x.x=ae(E,kp,Of),x.y=ae(M,kp,Of),(E<x.x||E>x.x+1||M<x.y||M>x.y+1)&&le("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function Il(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?El(r):[]}}function Ih(r,t,a,h,g){r.emplaceBack(2*t+(h+1)/2,2*a+(g+1)/2)}class Df{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yr,this.indexArray=new gs,this.segments=new Ui,this.programConfigurations=new Cl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,h){const g=this.layers[0],w=[];let x=null,E=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),E=!x.isConstant());for(const{feature:M,id:F,index:V,sourceLayerIndex:G}of t){const Q=this.layers[0]._featureFilter.needGeometry,ne=Il(M,Q);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),ne,h))continue;const ue=E?x.evaluate(ne,{},h):void 0,de={id:F,properties:M.properties,type:M.type,sourceLayerIndex:G,index:V,geometry:Q?ne.geometry:El(M),patterns:{},sortKey:ue};w.push(de)}E&&w.sort((M,F)=>M.sortKey-F.sortKey);for(const M of w){const{geometry:F,index:V,sourceLayerIndex:G}=M,Q=t[V].feature;this.addFeature(M,F,V,h),a.featureIndex.insert(Q,F,V,G,this.index)}}update(t,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,h,g){for(const w of a)for(const x of w){const E=x.x,M=x.y;if(E<0||E>=Nn||M<0||M>=Nn)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),V=F.vertexLength;Ih(this.layoutVertexArray,E,M,-1,-1),Ih(this.layoutVertexArray,E,M,1,-1),Ih(this.layoutVertexArray,E,M,1,1),Ih(this.layoutVertexArray,E,M,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,{},g)}}function Cp(r,t){for(let a=0;a<r.length;a++)if(vc(t,r[a]))return!0;for(let a=0;a<t.length;a++)if(vc(r,t[a]))return!0;return!!Ff(r,t)}function lb(r,t,a){return!!vc(r,t)||!!Rf(t,r,a)}function Ep(r,t){if(r.length===1)return Ap(t,r[0]);for(let a=0;a<t.length;a++){const h=t[a];for(let g=0;g<h.length;g++)if(vc(r,h[g]))return!0}for(let a=0;a<r.length;a++)if(Ap(t,r[a]))return!0;for(let a=0;a<t.length;a++)if(Ff(r,t[a]))return!0;return!1}function cb(r,t,a){if(r.length>1){if(Ff(r,t))return!0;for(let h=0;h<t.length;h++)if(Rf(t[h],r,a))return!0}for(let h=0;h<r.length;h++)if(Rf(r[h],t,a))return!0;return!1}function Ff(r,t){if(r.length===0||t.length===0)return!1;for(let a=0;a<r.length-1;a++){const h=r[a],g=r[a+1];for(let w=0;w<t.length-1;w++)if(ub(h,g,t[w],t[w+1]))return!0}return!1}function ub(r,t,a,h){return ge(r,a,h)!==ge(t,a,h)&&ge(r,t,a)!==ge(r,t,h)}function Rf(r,t,a){const h=a*a;if(t.length===1)return r.distSqr(t[0])<h;for(let g=1;g<t.length;g++)if(Ip(r,t[g-1],t[g])<h)return!0;return!1}function Ip(r,t,a){const h=t.distSqr(a);if(h===0)return r.distSqr(t);const g=((r.x-t.x)*(a.x-t.x)+(r.y-t.y)*(a.y-t.y))/h;return r.distSqr(g<0?t:g>1?a:a.sub(t)._mult(g)._add(t))}function Ap(r,t){let a,h,g,w=!1;for(let x=0;x<r.length;x++){a=r[x];for(let E=0,M=a.length-1;E<a.length;M=E++)h=a[E],g=a[M],h.y>t.y!=g.y>t.y&&t.x<(g.x-h.x)*(t.y-h.y)/(g.y-h.y)+h.x&&(w=!w)}return w}function vc(r,t){let a=!1;for(let h=0,g=r.length-1;h<r.length;g=h++){const w=r[h],x=r[g];w.y>t.y!=x.y>t.y&&t.x<(x.x-w.x)*(t.y-w.y)/(x.y-w.y)+w.x&&(a=!a)}return a}function hb(r,t,a){const h=a[0],g=a[2];if(r.x<h.x&&t.x<h.x||r.x>g.x&&t.x>g.x||r.y<h.y&&t.y<h.y||r.y>g.y&&t.y>g.y)return!1;const w=ge(r,t,a[0]);return w!==ge(r,t,a[1])||w!==ge(r,t,a[2])||w!==ge(r,t,a[3])}function Cu(r,t,a){const h=t.paint.get(r).value;return h.kind==="constant"?h.value:a.programConfigurations.get(t.id).getMaxValue(r)}function Ah(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Mh(r,t,a,h,g){if(!t[0]&&!t[1])return r;const w=y.convert(t)._mult(g);a==="viewport"&&w._rotate(-h);const x=[];for(let E=0;E<r.length;E++)x.push(r[E].sub(w));return x}let Mp,Pp;Ut("CircleBucket",Df,{omit:["layers"]});var fb={get paint(){return Pp=Pp||new v({"circle-radius":new ui(Je.paint_circle["circle-radius"]),"circle-color":new ui(Je.paint_circle["circle-color"]),"circle-blur":new ui(Je.paint_circle["circle-blur"]),"circle-opacity":new ui(Je.paint_circle["circle-opacity"]),"circle-translate":new Gt(Je.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt(Je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt(Je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt(Je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ui(Je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ui(Je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ui(Je.paint_circle["circle-stroke-opacity"])})},get layout(){return Mp=Mp||new v({"circle-sort-key":new ui(Je.layout_circle["circle-sort-key"])})}},Ar=1e-6,wc=typeof Float32Array<"u"?Float32Array:Array;function Bf(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Lp(r,t,a){var h=t[0],g=t[1],w=t[2],x=t[3],E=t[4],M=t[5],F=t[6],V=t[7],G=t[8],Q=t[9],ne=t[10],ue=t[11],de=t[12],ke=t[13],Me=t[14],Qe=t[15],Ue=a[0],Ke=a[1],at=a[2],wt=a[3];return r[0]=Ue*h+Ke*E+at*G+wt*de,r[1]=Ue*g+Ke*M+at*Q+wt*ke,r[2]=Ue*w+Ke*F+at*ne+wt*Me,r[3]=Ue*x+Ke*V+at*ue+wt*Qe,r[4]=(Ue=a[4])*h+(Ke=a[5])*E+(at=a[6])*G+(wt=a[7])*de,r[5]=Ue*g+Ke*M+at*Q+wt*ke,r[6]=Ue*w+Ke*F+at*ne+wt*Me,r[7]=Ue*x+Ke*V+at*ue+wt*Qe,r[8]=(Ue=a[8])*h+(Ke=a[9])*E+(at=a[10])*G+(wt=a[11])*de,r[9]=Ue*g+Ke*M+at*Q+wt*ke,r[10]=Ue*w+Ke*F+at*ne+wt*Me,r[11]=Ue*x+Ke*V+at*ue+wt*Qe,r[12]=(Ue=a[12])*h+(Ke=a[13])*E+(at=a[14])*G+(wt=a[15])*de,r[13]=Ue*g+Ke*M+at*Q+wt*ke,r[14]=Ue*w+Ke*F+at*ne+wt*Me,r[15]=Ue*x+Ke*V+at*ue+wt*Qe,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Eu,db=Lp;function Ph(r,t,a){var h=t[0],g=t[1],w=t[2],x=t[3];return r[0]=a[0]*h+a[4]*g+a[8]*w+a[12]*x,r[1]=a[1]*h+a[5]*g+a[9]*w+a[13]*x,r[2]=a[2]*h+a[6]*g+a[10]*w+a[14]*x,r[3]=a[3]*h+a[7]*g+a[11]*w+a[15]*x,r}Eu=new wc(4),wc!=Float32Array&&(Eu[0]=0,Eu[1]=0,Eu[2]=0,Eu[3]=0);class pb extends c{constructor(t){super(t,fb)}createBucket(t){return new Df(t)}queryRadius(t){const a=t;return Cu("circle-radius",this,a)+Cu("circle-stroke-width",this,a)+Ah(this.paint.get("circle-translate"))}queryIntersectsFeature(t,a,h,g,w,x,E,M){const F=Mh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,E),V=this.paint.get("circle-radius").evaluate(a,h)+this.paint.get("circle-stroke-width").evaluate(a,h),G=this.paint.get("circle-pitch-alignment")==="map",Q=G?F:function(ue,de){return ue.map(ke=>zp(ke,de))}(F,M),ne=G?V*E:V;for(const ue of g)for(const de of ue){const ke=G?de:zp(de,M);let Me=ne;const Qe=Ph([],[de.x,de.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Me*=Qe[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Me*=x.cameraToCenterDistance/Qe[3]),lb(Q,ke,Me))return!0}return!1}}function zp(r,t){const a=Ph([],[r.x,r.y,0,1],t);return new y(a[0]/a[3],a[1]/a[3])}class Op extends Df{}let Dp;Ut("HeatmapBucket",Op,{omit:["layers"]});var mb={get paint(){return Dp=Dp||new v({"heatmap-radius":new ui(Je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ui(Je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt(Je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Su(Je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt(Je.paint_heatmap["heatmap-opacity"])})}};function Nf(r,{width:t,height:a},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==t*a*h)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${t*a*h}`)}else g=new Uint8Array(t*a*h);return r.width=t,r.height=a,r.data=g,r}function Fp(r,{width:t,height:a},h){if(t===r.width&&a===r.height)return;const g=Nf({},{width:t,height:a},h);jf(r,g,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,a)},h),r.width=t,r.height=a,r.data=g.data}function jf(r,t,a,h,g,w){if(g.width===0||g.height===0)return t;if(g.width>r.width||g.height>r.height||a.x>r.width-g.width||a.y>r.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>t.width||g.height>t.height||h.x>t.width-g.width||h.y>t.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=r.data,E=t.data;if(x===E)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<g.height;M++){const F=((a.y+M)*r.width+a.x)*w,V=((h.y+M)*t.width+h.x)*w;for(let G=0;G<g.width*w;G++)E[V+G]=x[F+G]}return t}class Iu{constructor(t,a){Nf(this,t,1,a)}resize(t){Fp(this,t,1)}clone(){return new Iu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,h,g,w){jf(t,a,h,g,w,1)}}class _s{constructor(t,a){Nf(this,t,4,a)}resize(t){Fp(this,t,4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new _s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,h,g,w){jf(t,a,h,g,w,4)}}function Rp(r){const t={},a=r.resolution||256,h=r.clips?r.clips.length:1,g=r.image||new _s({width:a,height:h});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const w=(x,E,M)=>{t[r.evaluationKey]=M;const F=r.expression.evaluate(t);g.data[x+E+0]=Math.floor(255*F.r/F.a),g.data[x+E+1]=Math.floor(255*F.g/F.a),g.data[x+E+2]=Math.floor(255*F.b/F.a),g.data[x+E+3]=Math.floor(255*F.a)};if(r.clips)for(let x=0,E=0;x<h;++x,E+=4*a)for(let M=0,F=0;M<a;M++,F+=4){const V=M/(a-1),{start:G,end:Q}=r.clips[x];w(E,F,G*(1-V)+Q*V)}else for(let x=0,E=0;x<a;x++,E+=4)w(0,E,x/(a-1));return g}Ut("AlphaImage",Iu),Ut("RGBAImage",_s);const Uf="big-fb";class gb extends c{createBucket(t){return new Op(t)}constructor(t){super(t,mb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Uf)&&this.heatmapFbos.delete(Uf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Bp;var _b={get paint(){return Bp=Bp||new v({"hillshade-illumination-direction":new Gt(Je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt(Je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt(Je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt(Je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt(Je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt(Je.paint_hillshade["hillshade-accent-color"])})}};class yb extends c{constructor(t){super(t,_b)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const bb=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:vb}=bb;function Np(r,t,a=2){const h=t&&t.length,g=h?t[0]*a:r.length;let w=jp(r,0,g,a,!0);const x=[];if(!w||w.next===w.prev)return x;let E,M,F;if(h&&(w=function(V,G,Q,ne){const ue=[];for(let de=0,ke=G.length;de<ke;de++){const Me=jp(V,G[de]*ne,de<ke-1?G[de+1]*ne:V.length,ne,!1);Me===Me.next&&(Me.steiner=!0),ue.push(Ib(Me))}ue.sort(kb);for(let de=0;de<ue.length;de++)Q=Cb(ue[de],Q);return Q}(r,t,w,a)),r.length>80*a){E=1/0,M=1/0;let V=-1/0,G=-1/0;for(let Q=a;Q<g;Q+=a){const ne=r[Q],ue=r[Q+1];ne<E&&(E=ne),ue<M&&(M=ue),ne>V&&(V=ne),ue>G&&(G=ue)}F=Math.max(V-E,G-M),F=F!==0?32767/F:0}return Au(w,x,a,E,M,F,0),x}function jp(r,t,a,h,g){let w;if(g===function(x,E,M,F){let V=0;for(let G=E,Q=M-F;G<M;G+=F)V+=(x[Q]-x[G])*(x[G+1]+x[Q+1]),Q=G;return V}(r,t,a,h)>0)for(let x=t;x<a;x+=h)w=qp(x/h|0,r[x],r[x+1],w);else for(let x=a-h;x>=t;x-=h)w=qp(x/h|0,r[x],r[x+1],w);return w&&Lh(w,w.next)&&(Pu(w),w=w.next),w}function Al(r,t){if(!r)return r;t||(t=r);let a,h=r;do if(a=!1,h.steiner||!Lh(h,h.next)&&Dn(h.prev,h,h.next)!==0)h=h.next;else{if(Pu(h),h=t=h.prev,h===h.next)break;a=!0}while(a||h!==t);return t}function Au(r,t,a,h,g,w,x){if(!r)return;!x&&w&&function(M,F,V,G){let Q=M;do Q.z===0&&(Q.z=Vf(Q.x,Q.y,F,V,G)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==M);Q.prevZ.nextZ=null,Q.prevZ=null,function(ne){let ue,de=1;do{let ke,Me=ne;ne=null;let Qe=null;for(ue=0;Me;){ue++;let Ue=Me,Ke=0;for(let wt=0;wt<de&&(Ke++,Ue=Ue.nextZ,Ue);wt++);let at=de;for(;Ke>0||at>0&&Ue;)Ke!==0&&(at===0||!Ue||Me.z<=Ue.z)?(ke=Me,Me=Me.nextZ,Ke--):(ke=Ue,Ue=Ue.nextZ,at--),Qe?Qe.nextZ=ke:ne=ke,ke.prevZ=Qe,Qe=ke;Me=Ue}Qe.nextZ=null,de*=2}while(ue>1)}(Q)}(r,h,g,w);let E=r;for(;r.prev!==r.next;){const M=r.prev,F=r.next;if(w?xb(r,h,g,w):wb(r))t.push(M.i,r.i,F.i),Pu(r),r=F.next,E=F.next;else if((r=F)===E){x?x===1?Au(r=Sb(Al(r),t),t,a,h,g,w,2):x===2&&Tb(r,t,a,h,g,w):Au(Al(r),t,a,h,g,w,1);break}}}function wb(r){const t=r.prev,a=r,h=r.next;if(Dn(t,a,h)>=0)return!1;const g=t.x,w=a.x,x=h.x,E=t.y,M=a.y,F=h.y,V=g<w?g<x?g:x:w<x?w:x,G=E<M?E<F?E:F:M<F?M:F,Q=g>w?g>x?g:x:w>x?w:x,ne=E>M?E>F?E:F:M>F?M:F;let ue=h.next;for(;ue!==t;){if(ue.x>=V&&ue.x<=Q&&ue.y>=G&&ue.y<=ne&&xc(g,E,w,M,x,F,ue.x,ue.y)&&Dn(ue.prev,ue,ue.next)>=0)return!1;ue=ue.next}return!0}function xb(r,t,a,h){const g=r.prev,w=r,x=r.next;if(Dn(g,w,x)>=0)return!1;const E=g.x,M=w.x,F=x.x,V=g.y,G=w.y,Q=x.y,ne=E<M?E<F?E:F:M<F?M:F,ue=V<G?V<Q?V:Q:G<Q?G:Q,de=E>M?E>F?E:F:M>F?M:F,ke=V>G?V>Q?V:Q:G>Q?G:Q,Me=Vf(ne,ue,t,a,h),Qe=Vf(de,ke,t,a,h);let Ue=r.prevZ,Ke=r.nextZ;for(;Ue&&Ue.z>=Me&&Ke&&Ke.z<=Qe;){if(Ue.x>=ne&&Ue.x<=de&&Ue.y>=ue&&Ue.y<=ke&&Ue!==g&&Ue!==x&&xc(E,V,M,G,F,Q,Ue.x,Ue.y)&&Dn(Ue.prev,Ue,Ue.next)>=0||(Ue=Ue.prevZ,Ke.x>=ne&&Ke.x<=de&&Ke.y>=ue&&Ke.y<=ke&&Ke!==g&&Ke!==x&&xc(E,V,M,G,F,Q,Ke.x,Ke.y)&&Dn(Ke.prev,Ke,Ke.next)>=0))return!1;Ke=Ke.nextZ}for(;Ue&&Ue.z>=Me;){if(Ue.x>=ne&&Ue.x<=de&&Ue.y>=ue&&Ue.y<=ke&&Ue!==g&&Ue!==x&&xc(E,V,M,G,F,Q,Ue.x,Ue.y)&&Dn(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.prevZ}for(;Ke&&Ke.z<=Qe;){if(Ke.x>=ne&&Ke.x<=de&&Ke.y>=ue&&Ke.y<=ke&&Ke!==g&&Ke!==x&&xc(E,V,M,G,F,Q,Ke.x,Ke.y)&&Dn(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.nextZ}return!0}function Sb(r,t){let a=r;do{const h=a.prev,g=a.next.next;!Lh(h,g)&&Up(h,a,a.next,g)&&Mu(h,g)&&Mu(g,h)&&(t.push(h.i,a.i,g.i),Pu(a),Pu(a.next),a=r=g),a=a.next}while(a!==r);return Al(a)}function Tb(r,t,a,h,g,w){let x=r;do{let E=x.next.next;for(;E!==x.prev;){if(x.i!==E.i&&Ab(x,E)){let M=Vp(x,E);return x=Al(x,x.next),M=Al(M,M.next),Au(x,t,a,h,g,w,0),void Au(M,t,a,h,g,w,0)}E=E.next}x=x.next}while(x!==r)}function kb(r,t){return r.x-t.x}function Cb(r,t){const a=function(g,w){let x=w;const E=g.x,M=g.y;let F,V=-1/0;do{if(M<=x.y&&M>=x.next.y&&x.next.y!==x.y){const de=x.x+(M-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(de<=E&&de>V&&(V=de,F=x.x<x.next.x?x:x.next,de===E))return F}x=x.next}while(x!==w);if(!F)return null;const G=F,Q=F.x,ne=F.y;let ue=1/0;x=F;do{if(E>=x.x&&x.x>=Q&&E!==x.x&&xc(M<ne?E:V,M,Q,ne,M<ne?V:E,M,x.x,x.y)){const de=Math.abs(M-x.y)/(E-x.x);Mu(x,g)&&(de<ue||de===ue&&(x.x>F.x||x.x===F.x&&Eb(F,x)))&&(F=x,ue=de)}x=x.next}while(x!==G);return F}(r,t);if(!a)return t;const h=Vp(a,r);return Al(h,h.next),Al(a,a.next)}function Eb(r,t){return Dn(r.prev,r,t.prev)<0&&Dn(t.next,r,r.next)<0}function Vf(r,t,a,h,g){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-a)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-h)*g|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ib(r){let t=r,a=r;do(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next;while(t!==r);return a}function xc(r,t,a,h,g,w,x,E){return(g-x)*(t-E)>=(r-x)*(w-E)&&(r-x)*(h-E)>=(a-x)*(t-E)&&(a-x)*(w-E)>=(g-x)*(h-E)}function Ab(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(a,h){let g=a;do{if(g.i!==a.i&&g.next.i!==a.i&&g.i!==h.i&&g.next.i!==h.i&&Up(g,g.next,a,h))return!0;g=g.next}while(g!==a);return!1}(r,t)&&(Mu(r,t)&&Mu(t,r)&&function(a,h){let g=a,w=!1;const x=(a.x+h.x)/2,E=(a.y+h.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&x<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==a);return w}(r,t)&&(Dn(r.prev,r,t.prev)||Dn(r,t.prev,t))||Lh(r,t)&&Dn(r.prev,r,r.next)>0&&Dn(t.prev,t,t.next)>0)}function Dn(r,t,a){return(t.y-r.y)*(a.x-t.x)-(t.x-r.x)*(a.y-t.y)}function Lh(r,t){return r.x===t.x&&r.y===t.y}function Up(r,t,a,h){const g=Oh(Dn(r,t,a)),w=Oh(Dn(r,t,h)),x=Oh(Dn(a,h,r)),E=Oh(Dn(a,h,t));return g!==w&&x!==E||!(g!==0||!zh(r,a,t))||!(w!==0||!zh(r,h,t))||!(x!==0||!zh(a,r,h))||!(E!==0||!zh(a,t,h))}function zh(r,t,a){return t.x<=Math.max(r.x,a.x)&&t.x>=Math.min(r.x,a.x)&&t.y<=Math.max(r.y,a.y)&&t.y>=Math.min(r.y,a.y)}function Oh(r){return r>0?1:r<0?-1:0}function Mu(r,t){return Dn(r.prev,r,r.next)<0?Dn(r,t,r.next)>=0&&Dn(r,r.prev,t)>=0:Dn(r,t,r.prev)<0||Dn(r,r.next,t)<0}function Vp(r,t){const a=qf(r.i,r.x,r.y),h=qf(t.i,t.x,t.y),g=r.next,w=t.prev;return r.next=t,t.prev=r,a.next=g,g.prev=a,h.next=a,a.prev=h,w.next=h,h.prev=w,h}function qp(r,t,a,h){const g=qf(r,t,a);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function Pu(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function qf(r,t,a){return{i:r,x:t,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Zf(r,t,a){const h=a.patternDependencies;let g=!1;for(const w of t){const x=w.paint.get(`${r}-pattern`);x.isConstant()||(g=!0);const E=x.constantOr(null);E&&(g=!0,h[E.to]=!0,h[E.from]=!0)}return g}function Wf(r,t,a,h,g){const w=g.patternDependencies;for(const x of t){const E=x.paint.get(`${r}-pattern`).value;if(E.kind!=="constant"){let M=E.evaluate({zoom:h-1},a,{},g.availableImages),F=E.evaluate({zoom:h},a,{},g.availableImages),V=E.evaluate({zoom:h+1},a,{},g.availableImages);M=M&&M.name?M.name:M,F=F&&F.name?F.name:F,V=V&&V.name?V.name:V,w[M]=!0,w[F]=!0,w[V]=!0,a.patterns[x.id]={min:M,mid:F,max:V}}}return a}class Gf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fs,this.indexArray=new gs,this.indexArray2=new er,this.programConfigurations=new Cl(t.layers,t.zoom),this.segments=new Ui,this.segments2=new Ui,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,h){this.hasPattern=Zf("fill",this.layers,a);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),x=[];for(const{feature:E,id:M,index:F,sourceLayerIndex:V}of t){const G=this.layers[0]._featureFilter.needGeometry,Q=Il(E,G);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),Q,h))continue;const ne=w?g.evaluate(Q,{},h,a.availableImages):void 0,ue={id:M,properties:E.properties,type:E.type,sourceLayerIndex:V,index:F,geometry:G?Q.geometry:El(E),patterns:{},sortKey:ne};x.push(ue)}w&&x.sort((E,M)=>E.sortKey-M.sortKey);for(const E of x){const{geometry:M,index:F,sourceLayerIndex:V}=E;if(this.hasPattern){const G=Wf("fill",this.layers,E,this.zoom,a);this.patternFeatures.push(G)}else this.addFeature(E,M,F,h,{});a.featureIndex.insert(t[F].feature,M,F,V,this.index)}}update(t,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,h)}addFeatures(t,a,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vb),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,a,h,g,w){for(const x of Ta(a,500)){let E=0;for(const ne of x)E+=ne.length;const M=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),F=M.vertexLength,V=[],G=[];for(const ne of x){if(ne.length===0)continue;ne!==x[0]&&G.push(V.length/2);const ue=this.segments2.prepareSegment(ne.length,this.layoutVertexArray,this.indexArray2),de=ue.vertexLength;this.layoutVertexArray.emplaceBack(ne[0].x,ne[0].y),this.indexArray2.emplaceBack(de+ne.length-1,de),V.push(ne[0].x),V.push(ne[0].y);for(let ke=1;ke<ne.length;ke++)this.layoutVertexArray.emplaceBack(ne[ke].x,ne[ke].y),this.indexArray2.emplaceBack(de+ke-1,de+ke),V.push(ne[ke].x),V.push(ne[ke].y);ue.vertexLength+=ne.length,ue.primitiveLength+=ne.length}const Q=Np(V,G);for(let ne=0;ne<Q.length;ne+=3)this.indexArray.emplaceBack(F+Q[ne],F+Q[ne+1],F+Q[ne+2]);M.vertexLength+=E,M.primitiveLength+=Q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,w,g)}}let Zp,Wp;Ut("FillBucket",Gf,{omit:["layers","patternFeatures"]});var Mb={get paint(){return Wp=Wp||new v({"fill-antialias":new Gt(Je.paint_fill["fill-antialias"]),"fill-opacity":new ui(Je.paint_fill["fill-opacity"]),"fill-color":new ui(Je.paint_fill["fill-color"]),"fill-outline-color":new ui(Je.paint_fill["fill-outline-color"]),"fill-translate":new Gt(Je.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt(Je.paint_fill["fill-translate-anchor"]),"fill-pattern":new fc(Je.paint_fill["fill-pattern"])})},get layout(){return Zp=Zp||new v({"fill-sort-key":new ui(Je.layout_fill["fill-sort-key"])})}};class Pb extends c{constructor(t){super(t,Mb)}recalculate(t,a){super.recalculate(t,a);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Gf(t)}queryRadius(){return Ah(this.paint.get("fill-translate"))}queryIntersectsFeature(t,a,h,g,w,x,E){return Ep(Mh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,E),g)}isTileClipped(){return!0}}const Lb=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),zb=A([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ob}=Lb;var Wa={},Db=T,Gp=Sc;function Sc(r,t,a,h,g){this.properties={},this.extent=a,this.type=0,this._pbf=r,this._geometry=-1,this._keys=h,this._values=g,r.readFields(Fb,this,t)}function Fb(r,t,a){r==1?t.id=a.readVarint():r==2?function(h,g){for(var w=h.readVarint()+h.pos;h.pos<w;){var x=g._keys[h.readVarint()],E=g._values[h.readVarint()];g.properties[x]=E}}(a,t):r==3?t.type=a.readVarint():r==4&&(t._geometry=a.pos)}function Rb(r){for(var t,a,h=0,g=0,w=r.length,x=w-1;g<w;x=g++)h+=((a=r[x]).x-(t=r[g]).x)*(t.y+a.y);return h}Sc.types=["Unknown","Point","LineString","Polygon"],Sc.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,a=r.readVarint()+r.pos,h=1,g=0,w=0,x=0,E=[];r.pos<a;){if(g<=0){var M=r.readVarint();h=7&M,g=M>>3}if(g--,h===1||h===2)w+=r.readSVarint(),x+=r.readSVarint(),h===1&&(t&&E.push(t),t=[]),t.push(new Db(w,x));else{if(h!==7)throw new Error("unknown command "+h);t&&t.push(t[0].clone())}}return t&&E.push(t),E},Sc.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,a=1,h=0,g=0,w=0,x=1/0,E=-1/0,M=1/0,F=-1/0;r.pos<t;){if(h<=0){var V=r.readVarint();a=7&V,h=V>>3}if(h--,a===1||a===2)(g+=r.readSVarint())<x&&(x=g),g>E&&(E=g),(w+=r.readSVarint())<M&&(M=w),w>F&&(F=w);else if(a!==7)throw new Error("unknown command "+a)}return[x,M,E,F]},Sc.prototype.toGeoJSON=function(r,t,a){var h,g,w=this.extent*Math.pow(2,a),x=this.extent*r,E=this.extent*t,M=this.loadGeometry(),F=Sc.types[this.type];function V(ne){for(var ue=0;ue<ne.length;ue++){var de=ne[ue];ne[ue]=[360*(de.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+E)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<M.length;h++)G[h]=M[h][0];V(M=G);break;case 2:for(h=0;h<M.length;h++)V(M[h]);break;case 3:for(M=function(ne){var ue=ne.length;if(ue<=1)return[ne];for(var de,ke,Me=[],Qe=0;Qe<ue;Qe++){var Ue=Rb(ne[Qe]);Ue!==0&&(ke===void 0&&(ke=Ue<0),ke===Ue<0?(de&&Me.push(de),de=[ne[Qe]]):de.push(ne[Qe]))}return de&&Me.push(de),Me}(M),h=0;h<M.length;h++)for(g=0;g<M[h].length;g++)V(M[h][g])}M.length===1?M=M[0]:F="Multi"+F;var Q={type:"Feature",geometry:{type:F,coordinates:M},properties:this.properties};return"id"in this&&(Q.id=this.id),Q};var Bb=Gp,Hp=Xp;function Xp(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Nb,this,t),this.length=this._features.length}function Nb(r,t,a){r===15?t.version=a.readVarint():r===1?t.name=a.readString():r===5?t.extent=a.readVarint():r===2?t._features.push(a.pos):r===3?t._keys.push(a.readString()):r===4&&t._values.push(function(h){for(var g=null,w=h.readVarint()+h.pos;h.pos<w;){var x=h.readVarint()>>3;g=x===1?h.readString():x===2?h.readFloat():x===3?h.readDouble():x===4?h.readVarint64():x===5?h.readVarint():x===6?h.readSVarint():x===7?h.readBoolean():null}return g}(a))}Xp.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new Bb(this._pbf,t,this.extent,this._keys,this._values)};var jb=Hp;function Ub(r,t,a){if(r===3){var h=new jb(a,a.readVarint()+a.pos);h.length&&(t[h.name]=h)}}Wa.VectorTile=function(r,t){this.layers=r.readFields(Ub,{},t)},Wa.VectorTileFeature=Gp,Wa.VectorTileLayer=Hp;const Vb=Wa.VectorTileFeature.types,Hf=Math.pow(2,13);function Lu(r,t,a,h,g,w,x,E){r.emplaceBack(t,a,2*Math.floor(h*Hf)+x,g*Hf*2,w*Hf*2,Math.round(E))}class Xf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Na,this.centroidVertexArray=new rr,this.indexArray=new gs,this.programConfigurations=new Cl(t.layers,t.zoom),this.segments=new Ui,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,h){this.features=[],this.hasPattern=Zf("fill-extrusion",this.layers,a);for(const{feature:g,id:w,index:x,sourceLayerIndex:E}of t){const M=this.layers[0]._featureFilter.needGeometry,F=Il(g,M);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),F,h))continue;const V={id:w,sourceLayerIndex:E,index:x,geometry:M?F.geometry:El(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Wf("fill-extrusion",this.layers,V,this.zoom,a)):this.addFeature(V,V.geometry,x,h,{}),a.featureIndex.insert(g,V.geometry,x,E,this.index,!0)}}addFeatures(t,a,h){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,a,h)}}update(t,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ob),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,zb.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,a,h,g,w){for(const x of Ta(a,500)){const E={x:0,y:0,vertexCount:0};let M=0;for(const ue of x)M+=ue.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ue of x){if(ue.length===0||Zb(ue))continue;let de=0;for(let ke=0;ke<ue.length;ke++){const Me=ue[ke];if(ke>=1){const Qe=ue[ke-1];if(!qb(Me,Qe)){F.vertexLength+4>Ui.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ue=Me.sub(Qe)._perp()._unit(),Ke=Qe.dist(Me);de+Ke>32768&&(de=0),Lu(this.layoutVertexArray,Me.x,Me.y,Ue.x,Ue.y,0,0,de),Lu(this.layoutVertexArray,Me.x,Me.y,Ue.x,Ue.y,0,1,de),E.x+=2*Me.x,E.y+=2*Me.y,E.vertexCount+=2,de+=Ke,Lu(this.layoutVertexArray,Qe.x,Qe.y,Ue.x,Ue.y,0,0,de),Lu(this.layoutVertexArray,Qe.x,Qe.y,Ue.x,Ue.y,0,1,de),E.x+=2*Qe.x,E.y+=2*Qe.y,E.vertexCount+=2;const at=F.vertexLength;this.indexArray.emplaceBack(at,at+2,at+1),this.indexArray.emplaceBack(at+1,at+2,at+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+M>Ui.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),Vb[t.type]!=="Polygon")continue;const V=[],G=[],Q=F.vertexLength;for(const ue of x)if(ue.length!==0){ue!==x[0]&&G.push(V.length/2);for(let de=0;de<ue.length;de++){const ke=ue[de];Lu(this.layoutVertexArray,ke.x,ke.y,0,0,1,1,0),E.x+=ke.x,E.y+=ke.y,E.vertexCount+=1,V.push(ke.x),V.push(ke.y)}}const ne=Np(V,G);for(let ue=0;ue<ne.length;ue+=3)this.indexArray.emplaceBack(Q+ne[ue],Q+ne[ue+2],Q+ne[ue+1]);F.primitiveLength+=ne.length/3,F.vertexLength+=M;for(let ue=0;ue<E.vertexCount;ue++){const de=Math.floor(E.x/E.vertexCount),ke=Math.floor(E.y/E.vertexCount);this.centroidVertexArray.emplaceBack(de,ke)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,w,g)}}function qb(r,t){return r.x===t.x&&(r.x<0||r.x>Nn)||r.y===t.y&&(r.y<0||r.y>Nn)}function Zb(r){return r.every(t=>t.x<0)||r.every(t=>t.x>Nn)||r.every(t=>t.y<0)||r.every(t=>t.y>Nn)}let Kp;Ut("FillExtrusionBucket",Xf,{omit:["layers","features"]});var Wb={get paint(){return Kp=Kp||new v({"fill-extrusion-opacity":new Gt(Je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ui(Je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt(Je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt(Je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new fc(Je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ui(Je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ui(Je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gt(Je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Gb extends c{constructor(t){super(t,Wb)}createBucket(t){return new Xf(t)}queryRadius(){return Ah(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,a,h,g,w,x,E,M){const F=Mh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,E),V=this.paint.get("fill-extrusion-height").evaluate(a,h),G=this.paint.get("fill-extrusion-base").evaluate(a,h),Q=function(ue,de,ke,Me){const Qe=[];for(const Ue of ue){const Ke=[Ue.x,Ue.y,0,1];Ph(Ke,Ke,de),Qe.push(new y(Ke[0]/Ke[3],Ke[1]/Ke[3]))}return Qe}(F,M),ne=function(ue,de,ke,Me){const Qe=[],Ue=[],Ke=Me[8]*de,at=Me[9]*de,wt=Me[10]*de,Bt=Me[11]*de,ci=Me[8]*ke,Ft=Me[9]*ke,Ot=Me[10]*ke,Yt=Me[11]*ke;for(const qt of ue){const jt=[],ft=[];for(const ei of qt){const Kt=ei.x,yi=ei.y,an=Me[0]*Kt+Me[4]*yi+Me[12],rn=Me[1]*Kt+Me[5]*yi+Me[13],Xn=Me[2]*Kt+Me[6]*yi+Me[14],Rs=Me[3]*Kt+Me[7]*yi+Me[15],ar=Xn+wt,Kn=Rs+Bt,Mr=an+ci,Pr=rn+Ft,Lr=Xn+Ot,Pn=Rs+Yt,Jn=new y((an+Ke)/Kn,(rn+at)/Kn);Jn.z=ar/Kn,jt.push(Jn);const br=new y(Mr/Pn,Pr/Pn);br.z=Lr/Pn,ft.push(br)}Qe.push(jt),Ue.push(ft)}return[Qe,Ue]}(g,G,V,M);return function(ue,de,ke){let Me=1/0;Ep(ke,de)&&(Me=Jp(ke,de[0]));for(let Qe=0;Qe<de.length;Qe++){const Ue=de[Qe],Ke=ue[Qe];for(let at=0;at<Ue.length-1;at++){const wt=Ue[at],Bt=[wt,Ue[at+1],Ke[at+1],Ke[at],wt];Cp(ke,Bt)&&(Me=Math.min(Me,Jp(ke,Bt)))}}return Me!==1/0&&Me}(ne[0],ne[1],Q)}}function zu(r,t){return r.x*t.x+r.y*t.y}function Jp(r,t){if(r.length===1){let a=0;const h=t[a++];let g;for(;!g||h.equals(g);)if(g=t[a++],!g)return 1/0;for(;a<t.length;a++){const w=t[a],x=r[0],E=g.sub(h),M=w.sub(h),F=x.sub(h),V=zu(E,E),G=zu(E,M),Q=zu(M,M),ne=zu(F,E),ue=zu(F,M),de=V*Q-G*G,ke=(Q*ne-G*ue)/de,Me=(V*ue-G*ne)/de,Qe=h.z*(1-ke-Me)+g.z*ke+w.z*Me;if(isFinite(Qe))return Qe}return 1/0}{let a=1/0;for(const h of t)a=Math.min(a,h.z);return a}}const Hb=A([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Xb}=Hb,Kb=A([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Jb}=Kb,Yb=Wa.VectorTileFeature.types,Qb=Math.cos(Math.PI/180*37.5),Yp=Math.pow(2,14)/.5;class Kf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(a=>a.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new pc,this.layoutVertexArray2=new ja,this.indexArray=new gs,this.programConfigurations=new Cl(t.layers,t.zoom),this.segments=new Ui,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(t,a,h){this.hasPattern=Zf("line",this.layers,a);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),x=[];for(const{feature:E,id:M,index:F,sourceLayerIndex:V}of t){const G=this.layers[0]._featureFilter.needGeometry,Q=Il(E,G);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),Q,h))continue;const ne=w?g.evaluate(Q,{},h):void 0,ue={id:M,properties:E.properties,type:E.type,sourceLayerIndex:V,index:F,geometry:G?Q.geometry:El(E),patterns:{},sortKey:ne};x.push(ue)}w&&x.sort((E,M)=>E.sortKey-M.sortKey);for(const E of x){const{geometry:M,index:F,sourceLayerIndex:V}=E;if(this.hasPattern){const G=Wf("line",this.layers,E,this.zoom,a);this.patternFeatures.push(G)}else this.addFeature(E,M,F,h,{});a.featureIndex.insert(t[F].feature,M,F,V,this.index)}}update(t,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,h)}addFeatures(t,a,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Jb)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xb),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,a,h,g,w){const x=this.layers[0].layout,E=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),F=x.get("line-miter-limit"),V=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const G of a)this.addLine(G,t,E,M,F,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,w,g)}addLine(t,a,h,g,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Me=0;Me<t.length-1;Me++)this.totalDistance+=t[Me].dist(t[Me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=Yb[a.type]==="Polygon";let M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let F=0;for(;F<M-1&&t[F].equals(t[F+1]);)F++;if(M<(E?3:2))return;h==="bevel"&&(w=1.05);const V=this.overscaling<=16?15*Nn/(512*this.overscaling):0,G=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let Q,ne,ue,de,ke;this.e1=this.e2=-1,E&&(Q=t[M-2],ke=t[F].sub(Q)._unit()._perp());for(let Me=F;Me<M;Me++){if(ue=Me===M-1?E?t[F+1]:void 0:t[Me+1],ue&&t[Me].equals(ue))continue;ke&&(de=ke),Q&&(ne=Q),Q=t[Me],ke=ue?ue.sub(Q)._unit()._perp():de,de=de||ke;let Qe=de.add(ke);Qe.x===0&&Qe.y===0||Qe._unit();const Ue=de.x*ke.x+de.y*ke.y,Ke=Qe.x*ke.x+Qe.y*ke.y,at=Ke!==0?1/Ke:1/0,wt=2*Math.sqrt(2-2*Ke),Bt=Ke<Qb&&ne&&ue,ci=de.x*ke.y-de.y*ke.x>0;if(Bt&&Me>F){const Yt=Q.dist(ne);if(Yt>2*V){const qt=Q.sub(Q.sub(ne)._mult(V/Yt)._round());this.updateDistance(ne,qt),this.addCurrentVertex(qt,de,0,0,G),ne=qt}}const Ft=ne&&ue;let Ot=Ft?h:E?"butt":g;if(Ft&&Ot==="round"&&(at<x?Ot="miter":at<=2&&(Ot="fakeround")),Ot==="miter"&&at>w&&(Ot="bevel"),Ot==="bevel"&&(at>2&&(Ot="flipbevel"),at<w&&(Ot="miter")),ne&&this.updateDistance(ne,Q),Ot==="miter")Qe._mult(at),this.addCurrentVertex(Q,Qe,0,0,G);else if(Ot==="flipbevel"){if(at>100)Qe=ke.mult(-1);else{const Yt=at*de.add(ke).mag()/de.sub(ke).mag();Qe._perp()._mult(Yt*(ci?-1:1))}this.addCurrentVertex(Q,Qe,0,0,G),this.addCurrentVertex(Q,Qe.mult(-1),0,0,G)}else if(Ot==="bevel"||Ot==="fakeround"){const Yt=-Math.sqrt(at*at-1),qt=ci?Yt:0,jt=ci?0:Yt;if(ne&&this.addCurrentVertex(Q,de,qt,jt,G),Ot==="fakeround"){const ft=Math.round(180*wt/Math.PI/20);for(let ei=1;ei<ft;ei++){let Kt=ei/ft;if(Kt!==.5){const an=Kt-.5;Kt+=Kt*an*(Kt-1)*((1.0904+Ue*(Ue*(3.55645-1.43519*Ue)-3.2452))*an*an+(.848013+Ue*(.215638*Ue-1.06021)))}const yi=ke.sub(de)._mult(Kt)._add(de)._unit()._mult(ci?-1:1);this.addHalfVertex(Q,yi.x,yi.y,!1,ci,0,G)}}ue&&this.addCurrentVertex(Q,ke,-qt,-jt,G)}else if(Ot==="butt")this.addCurrentVertex(Q,Qe,0,0,G);else if(Ot==="square"){const Yt=ne?1:-1;this.addCurrentVertex(Q,Qe,Yt,Yt,G)}else Ot==="round"&&(ne&&(this.addCurrentVertex(Q,de,0,0,G),this.addCurrentVertex(Q,de,1,1,G,!0)),ue&&(this.addCurrentVertex(Q,ke,-1,-1,G,!0),this.addCurrentVertex(Q,ke,0,0,G)));if(Bt&&Me<M-1){const Yt=Q.dist(ue);if(Yt>2*V){const qt=Q.add(ue.sub(Q)._mult(V/Yt)._round());this.updateDistance(Q,qt),this.addCurrentVertex(qt,ke,0,0,G),Q=qt}}}}addCurrentVertex(t,a,h,g,w,x=!1){const E=a.y*g-a.x,M=-a.y-a.x*g;this.addHalfVertex(t,a.x+a.y*h,a.y-a.x*h,x,!1,h,w),this.addHalfVertex(t,E,M,x,!0,-g,w),this.distance>Yp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,a,h,g,w,x))}addHalfVertex({x:t,y:a},h,g,w,x,E,M){const F=.5*(this.lineClips?this.scaledDistance*(Yp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(w?1:0),(a<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const V=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),M.primitiveLength++),x?this.e2=V:this.e1=V}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,a){this.distance+=t.dist(a),this.updateScaledDistance()}}let Qp,$p;Ut("LineBucket",Kf,{omit:["layers","patternFeatures"]});var em={get paint(){return $p=$p||new v({"line-opacity":new ui(Je.paint_line["line-opacity"]),"line-color":new ui(Je.paint_line["line-color"]),"line-translate":new Gt(Je.paint_line["line-translate"]),"line-translate-anchor":new Gt(Je.paint_line["line-translate-anchor"]),"line-width":new ui(Je.paint_line["line-width"]),"line-gap-width":new ui(Je.paint_line["line-gap-width"]),"line-offset":new ui(Je.paint_line["line-offset"]),"line-blur":new ui(Je.paint_line["line-blur"]),"line-dasharray":new dc(Je.paint_line["line-dasharray"]),"line-pattern":new fc(Je.paint_line["line-pattern"]),"line-gradient":new Su(Je.paint_line["line-gradient"])})},get layout(){return Qp=Qp||new v({"line-cap":new Gt(Je.layout_line["line-cap"]),"line-join":new ui(Je.layout_line["line-join"]),"line-miter-limit":new Gt(Je.layout_line["line-miter-limit"]),"line-round-limit":new Gt(Je.layout_line["line-round-limit"]),"line-sort-key":new ui(Je.layout_line["line-sort-key"])})}};class $b extends ui{possiblyEvaluate(t,a){return a=new mn(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(t,a)}evaluate(t,a,h,g){return a=re({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(t,a,h,g)}}let Dh;class ev extends c{constructor(t){super(t,em),this.gradientVersion=0,Dh||(Dh=new $b(em.paint.properties["line-width"].specification),Dh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(a)&&a._styleExpression.expression instanceof po,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,a){super.recalculate(t,a),this.paint._values["line-floorwidth"]=Dh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Kf(t)}queryRadius(t){const a=t,h=tm(Cu("line-width",this,a),Cu("line-gap-width",this,a)),g=Cu("line-offset",this,a);return h/2+Math.abs(g)+Ah(this.paint.get("line-translate"))}queryIntersectsFeature(t,a,h,g,w,x,E){const M=Mh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,E),F=E/2*tm(this.paint.get("line-width").evaluate(a,h),this.paint.get("line-gap-width").evaluate(a,h)),V=this.paint.get("line-offset").evaluate(a,h);return V&&(g=function(G,Q){const ne=[];for(let ue=0;ue<G.length;ue++){const de=G[ue],ke=[];for(let Me=0;Me<de.length;Me++){const Qe=de[Me-1],Ue=de[Me],Ke=de[Me+1],at=Me===0?new y(0,0):Ue.sub(Qe)._unit()._perp(),wt=Me===de.length-1?new y(0,0):Ke.sub(Ue)._unit()._perp(),Bt=at._add(wt)._unit(),ci=Bt.x*wt.x+Bt.y*wt.y;ci!==0&&Bt._mult(1/ci),ke.push(Bt._mult(Q)._add(Ue))}ne.push(ke)}return ne}(g,V*E)),function(G,Q,ne){for(let ue=0;ue<Q.length;ue++){const de=Q[ue];if(G.length>=3){for(let ke=0;ke<de.length;ke++)if(vc(G,de[ke]))return!0}if(cb(G,de,ne))return!0}return!1}(M,g,F)}isTileClipped(){return!0}}function tm(r,t){return t>0?t+2*r:r}const tv=A([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iv=A([{name:"a_projected_pos",components:3,type:"Float32"}],4);A([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nv=A([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);A([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const im=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rv=A([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function sv(r,t,a){return r.sections.forEach(h=>{h.text=function(g,w,x){const E=w.layout.get("text-transform").evaluate(x,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),Ur.applyArabicShaping&&(g=Ur.applyArabicShaping(g)),g}(h.text,t,a)}),r}A([{name:"triangle",components:3,type:"Uint16"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),A([{type:"Float32",name:"offsetX"}]),A([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),A([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ou={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var qn=24,nm=nn,rm=function(r,t,a,h,g){var w,x,E=8*g-h-1,M=(1<<E)-1,F=M>>1,V=-7,G=g-1,Q=-1,ne=r[t+G];for(G+=Q,w=ne&(1<<-V)-1,ne>>=-V,V+=E;V>0;w=256*w+r[t+G],G+=Q,V-=8);for(x=w&(1<<-V)-1,w>>=-V,V+=h;V>0;x=256*x+r[t+G],G+=Q,V-=8);if(w===0)w=1-F;else{if(w===M)return x?NaN:1/0*(ne?-1:1);x+=Math.pow(2,h),w-=F}return(ne?-1:1)*x*Math.pow(2,w-h)},sm=function(r,t,a,h,g,w){var x,E,M,F=8*w-g-1,V=(1<<F)-1,G=V>>1,Q=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=0,ue=1,de=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(E=isNaN(t)?1:0,x=V):(x=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-x))<1&&(x--,M*=2),(t+=x+G>=1?Q/M:Q*Math.pow(2,1-G))*M>=2&&(x++,M/=2),x+G>=V?(E=0,x=V):x+G>=1?(E=(t*M-1)*Math.pow(2,g),x+=G):(E=t*Math.pow(2,G-1)*Math.pow(2,g),x=0));g>=8;r[a+ne]=255&E,ne+=ue,E/=256,g-=8);for(x=x<<g|E,F+=g;F>0;r[a+ne]=255&x,ne+=ue,x/=256,F-=8);r[a+ne-ue]|=128*de};function nn(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}nn.Varint=0,nn.Fixed64=1,nn.Bytes=2,nn.Fixed32=5;var Jf=4294967296,om=1/Jf,am=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function aa(r){return r.type===nn.Bytes?r.readVarint()+r.pos:r.pos+1}function Tc(r,t,a){return a?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function lm(r,t,a){var h=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));a.realloc(h);for(var g=a.pos-1;g>=r;g--)a.buf[g+h]=a.buf[g]}function ov(r,t){for(var a=0;a<r.length;a++)t.writeVarint(r[a])}function av(r,t){for(var a=0;a<r.length;a++)t.writeSVarint(r[a])}function lv(r,t){for(var a=0;a<r.length;a++)t.writeFloat(r[a])}function cv(r,t){for(var a=0;a<r.length;a++)t.writeDouble(r[a])}function uv(r,t){for(var a=0;a<r.length;a++)t.writeBoolean(r[a])}function hv(r,t){for(var a=0;a<r.length;a++)t.writeFixed32(r[a])}function fv(r,t){for(var a=0;a<r.length;a++)t.writeSFixed32(r[a])}function dv(r,t){for(var a=0;a<r.length;a++)t.writeFixed64(r[a])}function pv(r,t){for(var a=0;a<r.length;a++)t.writeSFixed64(r[a])}function Fh(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function kc(r,t,a){r[a]=t,r[a+1]=t>>>8,r[a+2]=t>>>16,r[a+3]=t>>>24}function cm(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}nn.prototype={destroy:function(){this.buf=null},readFields:function(r,t,a){for(a=a||this.length;this.pos<a;){var h=this.readVarint(),g=h>>3,w=this.pos;this.type=7&h,r(g,t,this),this.pos===w&&this.skip(h)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Fh(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=cm(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Fh(this.buf,this.pos)+Fh(this.buf,this.pos+4)*Jf;return this.pos+=8,r},readSFixed64:function(){var r=Fh(this.buf,this.pos)+cm(this.buf,this.pos+4)*Jf;return this.pos+=8,r},readFloat:function(){var r=rm(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=rm(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,a,h=this.buf;return t=127&(a=h[this.pos++]),a<128?t:(t|=(127&(a=h[this.pos++]))<<7,a<128?t:(t|=(127&(a=h[this.pos++]))<<14,a<128?t:(t|=(127&(a=h[this.pos++]))<<21,a<128?t:function(g,w,x){var E,M,F=x.buf;if(E=(112&(M=F[x.pos++]))>>4,M<128||(E|=(127&(M=F[x.pos++]))<<3,M<128)||(E|=(127&(M=F[x.pos++]))<<10,M<128)||(E|=(127&(M=F[x.pos++]))<<17,M<128)||(E|=(127&(M=F[x.pos++]))<<24,M<128)||(E|=(1&(M=F[x.pos++]))<<31,M<128))return Tc(g,E,w);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(a=h[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&am?function(a,h,g){return am.decode(a.subarray(h,g))}(this.buf,t,r):function(a,h,g){for(var w="",x=h;x<g;){var E,M,F,V=a[x],G=null,Q=V>239?4:V>223?3:V>191?2:1;if(x+Q>g)break;Q===1?V<128&&(G=V):Q===2?(192&(E=a[x+1]))==128&&(G=(31&V)<<6|63&E)<=127&&(G=null):Q===3?(M=a[x+2],(192&(E=a[x+1]))==128&&(192&M)==128&&((G=(15&V)<<12|(63&E)<<6|63&M)<=2047||G>=55296&&G<=57343)&&(G=null)):Q===4&&(M=a[x+2],F=a[x+3],(192&(E=a[x+1]))==128&&(192&M)==128&&(192&F)==128&&((G=(15&V)<<18|(63&E)<<12|(63&M)<<6|63&F)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,Q=1):G>65535&&(G-=65536,w+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),w+=String.fromCharCode(G),x+=Q}return w}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==nn.Bytes)return r.push(this.readVarint(t));var a=aa(this);for(r=r||[];this.pos<a;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==nn.Bytes)return r.push(this.readSVarint());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==nn.Bytes)return r.push(this.readBoolean());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==nn.Bytes)return r.push(this.readFloat());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==nn.Bytes)return r.push(this.readDouble());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==nn.Bytes)return r.push(this.readFixed32());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==nn.Bytes)return r.push(this.readSFixed32());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==nn.Bytes)return r.push(this.readFixed64());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==nn.Bytes)return r.push(this.readSFixed64());var t=aa(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===nn.Varint)for(;this.buf[this.pos++]>127;);else if(t===nn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===nn.Fixed32)this.pos+=4;else{if(t!==nn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var a=new Uint8Array(t);a.set(this.buf),this.buf=a,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),kc(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),kc(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),kc(this.buf,-1&r,this.pos),kc(this.buf,Math.floor(r*om),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),kc(this.buf,-1&r,this.pos),kc(this.buf,Math.floor(r*om),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,a){var h,g;if(t>=0?(h=t%4294967296|0,g=t/4294967296|0):(g=~(-t/4294967296),4294967295^(h=~(-t%4294967296))?h=h+1|0:(h=0,g=g+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(w,x,E){E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,E.buf[E.pos]=127&(w>>>=7)}(h,0,a),function(w,x){var E=(7&w)<<4;x.buf[x.pos++]|=E|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(g,a)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(h,g,w){for(var x,E,M=0;M<g.length;M++){if((x=g.charCodeAt(M))>55295&&x<57344){if(!E){x>56319||M+1===g.length?(h[w++]=239,h[w++]=191,h[w++]=189):E=x;continue}if(x<56320){h[w++]=239,h[w++]=191,h[w++]=189,E=x;continue}x=E-55296<<10|x-56320|65536,E=null}else E&&(h[w++]=239,h[w++]=191,h[w++]=189,E=null);x<128?h[w++]=x:(x<2048?h[w++]=x>>6|192:(x<65536?h[w++]=x>>12|224:(h[w++]=x>>18|240,h[w++]=x>>12&63|128),h[w++]=x>>6&63|128),h[w++]=63&x|128)}return w}(this.buf,r,this.pos);var a=this.pos-t;a>=128&&lm(t,a,this),this.pos=t-1,this.writeVarint(a),this.pos+=a},writeFloat:function(r){this.realloc(4),sm(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),sm(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var a=0;a<t;a++)this.buf[this.pos++]=r[a]},writeRawMessage:function(r,t){this.pos++;var a=this.pos;r(t,this);var h=this.pos-a;h>=128&&lm(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h},writeMessage:function(r,t,a){this.writeTag(r,nn.Bytes),this.writeRawMessage(t,a)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,ov,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,av,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,uv,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,lv,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,cv,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,hv,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,fv,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,dv,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,pv,t)},writeBytesField:function(r,t){this.writeTag(r,nn.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,nn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,nn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,nn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,nn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,nn.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,nn.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,nn.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,nn.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,nn.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var Yf=_(nm);const Qf=3;function mv(r,t,a){r===1&&a.readMessage(gv,t)}function gv(r,t,a){if(r===3){const{id:h,bitmap:g,width:w,height:x,left:E,top:M,advance:F}=a.readMessage(_v,{});t.push({id:h,bitmap:new Iu({width:w+2*Qf,height:x+2*Qf},g),metrics:{width:w,height:x,left:E,top:M,advance:F}})}}function _v(r,t,a){r===1?t.id=a.readVarint():r===2?t.bitmap=a.readBytes():r===3?t.width=a.readVarint():r===4?t.height=a.readVarint():r===5?t.left=a.readSVarint():r===6?t.top=a.readSVarint():r===7&&(t.advance=a.readVarint())}const um=Qf;function hm(r){let t=0,a=0;for(const x of r)t+=x.w*x.h,a=Math.max(a,x.w);r.sort((x,E)=>E.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let g=0,w=0;for(const x of r)for(let E=h.length-1;E>=0;E--){const M=h[E];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,w=Math.max(w,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===M.w&&x.h===M.h){const F=h.pop();E<h.length&&(h[E]=F)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(h.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:g,h:w,fill:t/(g*w)||0}}const qr=1;class $f{constructor(t,{pixelRatio:a,version:h,stretchX:g,stretchY:w,content:x,textFitWidth:E,textFitHeight:M}){this.paddedRect=t,this.pixelRatio=a,this.stretchX=g,this.stretchY=w,this.content=x,this.version=h,this.textFitWidth=E,this.textFitHeight=M}get tl(){return[this.paddedRect.x+qr,this.paddedRect.y+qr]}get br(){return[this.paddedRect.x+this.paddedRect.w-qr,this.paddedRect.y+this.paddedRect.h-qr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*qr)/this.pixelRatio,(this.paddedRect.h-2*qr)/this.pixelRatio]}}class fm{constructor(t,a){const h={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(t,h,w),this.addImages(a,g,w);const{w:x,h:E}=hm(w),M=new _s({width:x||1,height:E||1});for(const F in t){const V=t[F],G=h[F].paddedRect;_s.copy(V.data,M,{x:0,y:0},{x:G.x+qr,y:G.y+qr},V.data)}for(const F in a){const V=a[F],G=g[F].paddedRect,Q=G.x+qr,ne=G.y+qr,ue=V.data.width,de=V.data.height;_s.copy(V.data,M,{x:0,y:0},{x:Q,y:ne},V.data),_s.copy(V.data,M,{x:0,y:de-1},{x:Q,y:ne-1},{width:ue,height:1}),_s.copy(V.data,M,{x:0,y:0},{x:Q,y:ne+de},{width:ue,height:1}),_s.copy(V.data,M,{x:ue-1,y:0},{x:Q-1,y:ne},{width:1,height:de}),_s.copy(V.data,M,{x:0,y:0},{x:Q+ue,y:ne},{width:1,height:de})}this.image=M,this.iconPositions=h,this.patternPositions=g}addImages(t,a,h){for(const g in t){const w=t[g],x={x:0,y:0,w:w.data.width+2*qr,h:w.data.height+2*qr};h.push(x),a[g]=new $f(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(t,a){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in t.updatedImages)this.patchUpdatedImage(this.iconPositions[h],t.getImage(h),a),this.patchUpdatedImage(this.patternPositions[h],t.getImage(h),a)}patchUpdatedImage(t,a,h){if(!t||!a||t.version===a.version)return;t.version=a.version;const[g,w]=t.tl;h.update(a.data,void 0,{x:g,y:w})}}var Ga;Ut("ImagePosition",$f),Ut("ImageAtlas",fm),f.ah=void 0,(Ga=f.ah||(f.ah={}))[Ga.none=0]="none",Ga[Ga.horizontal=1]="horizontal",Ga[Ga.vertical=2]="vertical",Ga[Ga.horizontalOnly=3]="horizontalOnly";const Du=-17;class Fu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,a){const h=new Fu;return h.scale=t||1,h.fontStack=a,h}static forImage(t){const a=new Fu;return a.imageName=t,a}}class Cc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a){const h=new Cc;for(let g=0;g<t.sections.length;g++){const w=t.sections[g];w.image?h.addImageSection(w):h.addTextSection(w,a)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let a="";for(let h=0;h<t.length;h++){const g=t.charCodeAt(h+1)||null,w=t.charCodeAt(h-1)||null;a+=g&&xh(g)&&!Ou[t[h+1]]||w&&xh(w)&&!Ou[t[h-1]]||!Ou[t[h]]?t[h]:Ou[t[h]]}return a}(this.text)}trim(){let t=0;for(let h=0;h<this.text.length&&Bh[this.text.charCodeAt(h)];h++)t++;let a=this.text.length;for(let h=this.text.length-1;h>=0&&h>=t&&Bh[this.text.charCodeAt(h)];h--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const h=new Cc;return h.text=this.text.substring(t,a),h.sectionIndex=this.sectionIndex.slice(t,a),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,a)=>Math.max(t,this.sections[a].scale),0)}addTextSection(t,a){this.text+=t.text,this.sections.push(Fu.forText(t.scale,t.fontStack||a));const h=this.sections.length-1;for(let g=0;g<t.text.length;++g)this.sectionIndex.push(h)}addImageSection(t){const a=t.image?t.image.name:"";if(a.length===0)return void le("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Fu.forImage(a)),this.sectionIndex.push(this.sections.length-1)):le("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rh(r,t,a,h,g,w,x,E,M,F,V,G,Q,ne,ue){const de=Cc.fromFeature(r,g);let ke;G===f.ah.vertical&&de.verticalizePunctuation();const{processBidirectionalText:Me,processStyledBidirectionalText:Qe}=Ur;if(Me&&de.sections.length===1){ke=[];const at=Me(de.toString(),ed(de,F,w,t,h,ne));for(const wt of at){const Bt=new Cc;Bt.text=wt,Bt.sections=de.sections;for(let ci=0;ci<wt.length;ci++)Bt.sectionIndex.push(0);ke.push(Bt)}}else if(Qe){ke=[];const at=Qe(de.text,de.sectionIndex,ed(de,F,w,t,h,ne));for(const wt of at){const Bt=new Cc;Bt.text=wt[0],Bt.sectionIndex=wt[1],Bt.sections=de.sections,ke.push(Bt)}}else ke=function(at,wt){const Bt=[],ci=at.text;let Ft=0;for(const Ot of wt)Bt.push(at.substring(Ft,Ot)),Ft=Ot;return Ft<ci.length&&Bt.push(at.substring(Ft,ci.length)),Bt}(de,ed(de,F,w,t,h,ne));const Ue=[],Ke={positionedLines:Ue,text:de.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(at,wt,Bt,ci,Ft,Ot,Yt,qt,jt,ft,ei,Kt){let yi=0,an=Du,rn=0,Xn=0;const Rs=qt==="right"?1:qt==="left"?0:.5;let ar=0;for(const Pn of Ft){Pn.trim();const Jn=Pn.getMaxScale(),br=(Jn-1)*qn,lr={positionedGlyphs:[],lineOffset:0};at.positionedLines[ar]=lr;const zr=lr.positionedGlyphs;let cr=0;if(!Pn.length()){an+=Ot,++ar;continue}for(let Zr=0;Zr<Pn.length();Zr++){const Xi=Pn.getSection(Zr),fn=Pn.getSectionIndex(Zr),bn=Pn.getCharCode(Zr);let os=0,An=null,Mc=null,Mo=null,Po=qn;const Bs=!(jt===f.ah.horizontal||!ei&&!wu(bn)||ei&&(Bh[bn]||(Kn=bn,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Kn)))));if(Xi.imageName){const vs=ci[Xi.imageName];if(!vs)continue;Mo=Xi.imageName,at.iconsInText=at.iconsInText||!0,Mc=vs.paddedRect;const tr=vs.displaySize;Xi.scale=Xi.scale*qn/Kt,An={width:tr[0],height:tr[1],left:qr,top:-um,advance:Bs?tr[1]:tr[0]},os=br+(qn-tr[1]*Xi.scale),Po=An.advance;const la=Bs?tr[0]*Xi.scale-qn*Jn:tr[1]*Xi.scale-qn*Jn;la>0&&la>cr&&(cr=la)}else{const vs=Bt[Xi.fontStack],tr=vs&&vs[bn];if(tr&&tr.rect)Mc=tr.rect,An=tr.metrics;else{const la=wt[Xi.fontStack],Vu=la&&la[bn];if(!Vu)continue;An=Vu.metrics}os=(Jn-Xi.scale)*qn}Bs?(at.verticalizable=!0,zr.push({glyph:bn,imageName:Mo,x:yi,y:an+os,vertical:Bs,scale:Xi.scale,fontStack:Xi.fontStack,sectionIndex:fn,metrics:An,rect:Mc}),yi+=Po*Xi.scale+ft):(zr.push({glyph:bn,imageName:Mo,x:yi,y:an+os,vertical:Bs,scale:Xi.scale,fontStack:Xi.fontStack,sectionIndex:fn,metrics:An,rect:Mc}),yi+=An.advance*Xi.scale+ft)}zr.length!==0&&(rn=Math.max(yi-ft,rn),wv(zr,0,zr.length-1,Rs,cr)),yi=0;const bs=Ot*Jn+cr;lr.lineOffset=Math.max(cr,br),an+=bs,Xn=Math.max(bs,Xn),++ar}var Kn;const Mr=an-Du,{horizontalAlign:Pr,verticalAlign:Lr}=td(Yt);(function(Pn,Jn,br,lr,zr,cr,bs,Zr,Xi){const fn=(Jn-br)*zr;let bn=0;bn=cr!==bs?-Zr*lr-Du:(-lr*Xi+.5)*bs;for(const os of Pn)for(const An of os.positionedGlyphs)An.x+=fn,An.y+=bn})(at.positionedLines,Rs,Pr,Lr,rn,Xn,Ot,Mr,Ft.length),at.top+=-Lr*Mr,at.bottom=at.top+Mr,at.left+=-Pr*rn,at.right=at.left+rn}(Ke,t,a,h,ke,x,E,M,G,F,Q,ue),!function(at){for(const wt of at)if(wt.positionedGlyphs.length!==0)return!1;return!0}(Ue)&&Ke}const Bh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},bv={40:!0};function dm(r,t,a,h,g,w){if(t.imageName){const x=h[t.imageName];return x?x.displaySize[0]*t.scale*qn/w+g:0}{const x=a[t.fontStack],E=x&&x[r];return E?E.metrics.advance*t.scale+g:0}}function pm(r,t,a,h){const g=Math.pow(r-t,2);return h?r<t?g/2:2*g:g+Math.abs(a)*a}function vv(r,t,a){let h=0;return r===10&&(h-=1e4),a&&(h+=150),r!==40&&r!==65288||(h+=50),t!==41&&t!==65289||(h+=50),h}function mm(r,t,a,h,g,w){let x=null,E=pm(t,a,g,w);for(const M of h){const F=pm(t-M.x,a,g,w)+M.badness;F<=E&&(x=M,E=F)}return{index:r,x:t,priorBreak:x,badness:E}}function gm(r){return r?gm(r.priorBreak).concat(r.index):[]}function ed(r,t,a,h,g,w){if(!r)return[];const x=[],E=function(G,Q,ne,ue,de,ke){let Me=0;for(let Qe=0;Qe<G.length();Qe++){const Ue=G.getSection(Qe);Me+=dm(G.getCharCode(Qe),Ue,ue,de,Q,ke)}return Me/Math.max(1,Math.ceil(Me/ne))}(r,t,a,h,g,w),M=r.text.indexOf("")>=0;let F=0;for(let G=0;G<r.length();G++){const Q=r.getSection(G),ne=r.getCharCode(G);if(Bh[ne]||(F+=dm(ne,Q,h,g,t,w)),G<r.length()-1){const ue=!((V=ne)<11904)&&(!!ji["CJK Compatibility Forms"](V)||!!ji["CJK Compatibility"](V)||!!ji["CJK Strokes"](V)||!!ji["CJK Symbols and Punctuation"](V)||!!ji["Enclosed CJK Letters and Months"](V)||!!ji["Halfwidth and Fullwidth Forms"](V)||!!ji["Ideographic Description Characters"](V)||!!ji["Vertical Forms"](V)||wh.test(String.fromCodePoint(V)));(yv[ne]||ue||Q.imageName||G!==r.length()-2&&bv[r.getCharCode(G+1)])&&x.push(mm(G+1,F,E,x,vv(ne,r.getCharCode(G+1),ue&&M),!1))}}var V;return gm(mm(r.length(),F,E,x,0,!0))}function td(r){let t=.5,a=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function wv(r,t,a,h,g){if(!h&&!g)return;const w=r[a],x=(r[a].x+w.metrics.advance*w.scale)*h;for(let E=t;E<=a;E++)r[E].x-=x,r[E].y+=g}function xv(r,t,a){const{horizontalAlign:h,verticalAlign:g}=td(a),w=t[0]-r.displaySize[0]*h,x=t[1]-r.displaySize[1]*g;return{image:r,top:x,bottom:x+r.displaySize[1],left:w,right:w+r.displaySize[0]}}function _m(r){var t,a;let h=r.left,g=r.top,w=r.right-h,x=r.bottom-g;const E=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",M=(a=r.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",F=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(M==="proportional"){if(E==="stretchOnly"&&w/x<F||E==="proportional"){const V=Math.ceil(x*F);h*=V/w,w=V}}else if(E==="proportional"&&M==="stretchOnly"&&F!==0&&w/x>F){const V=Math.ceil(w/F);g*=V/x,x=V}return{x1:h,y1:g,x2:h+w,y2:g+x}}function ym(r,t,a,h,g,w){const x=r.image;let E;if(x.content){const ke=x.content,Me=x.pixelRatio||1;E=[ke[0]/Me,ke[1]/Me,x.displaySize[0]-ke[2]/Me,x.displaySize[1]-ke[3]/Me]}const M=t.left*w,F=t.right*w;let V,G,Q,ne;a==="width"||a==="both"?(ne=g[0]+M-h[3],G=g[0]+F+h[1]):(ne=g[0]+(M+F-x.displaySize[0])/2,G=ne+x.displaySize[0]);const ue=t.top*w,de=t.bottom*w;return a==="height"||a==="both"?(V=g[1]+ue-h[0],Q=g[1]+de+h[2]):(V=g[1]+(ue+de-x.displaySize[1])/2,Q=V+x.displaySize[1]),{image:x,top:V,right:G,bottom:Q,left:ne,collisionPadding:E}}const Ru=255,Ao=128,Ha=Ru*Ao;function bm(r,t){const{expression:a}=t;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new mn(r+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=a;let w=0;for(;w<h.length&&h[w]<=r;)w++;w=Math.max(0,w-1);let x=w;for(;x<h.length&&h[x]<r+1;)x++;x=Math.min(h.length-1,x);const E=h[w],M=h[x];return a.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:M,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:M,minSize:a.evaluate(new mn(E)),maxSize:a.evaluate(new mn(M)),interpolationType:g}}}function id(r,t,a){let h="never";const g=r.get(t);return g?h=g:r.get(a)&&(h="always"),h}const Sv=Wa.VectorTileFeature.types,Tv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nh(r,t,a,h,g,w,x,E,M,F,V,G,Q){const ne=E?Math.min(Ha,Math.round(E[0])):0,ue=E?Math.min(Ha,Math.round(E[1])):0;r.emplaceBack(t,a,Math.round(32*h),Math.round(32*g),w,x,(ne<<1)+(M?1:0),ue,16*F,16*V,256*G,256*Q)}function nd(r,t,a){r.emplaceBack(t.x,t.y,a),r.emplaceBack(t.x,t.y,a),r.emplaceBack(t.x,t.y,a),r.emplaceBack(t.x,t.y,a)}function kv(r){for(const t of r.sections)if(Pf(t.text))return!0;return!1}class rd{constructor(t){this.layoutVertexArray=new mc,this.indexArray=new gs,this.programConfigurations=t,this.segments=new Ui,this.dynamicLayoutVertexArray=new Tu,this.opacityVertexArray=new rs,this.hasVisibleVertices=!1,this.placedSymbolArray=new gn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,a,h,g){this.isEmpty()||(h&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tv.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,iv.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Tv,!0),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ut("SymbolBuffers",rd);class sd{constructor(t,a,h){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new h,this.segments=new Ui,this.collisionVertexArray=new Eo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,nv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ut("CollisionBuffers",sd);class Ec{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bf([]),this.placementViewportMatrix=Bf([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bm(this.zoom,a["text-size"]),this.iconSizeData=bm(this.zoom,a["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),w=h.get("symbol-z-order");this.canOverlap=id(h,"text-overlap","text-allow-overlap")!=="never"||id(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(x=>f.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new rd(new Cl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new rd(new Cl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new _n,this.lineVertexArray=new nr,this.symbolInstances=new Ni,this.textAnchorOffsets=new yn}calculateGlyphDependencies(t,a,h,g,w){for(let x=0;x<t.length;x++)if(a[t.charCodeAt(x)]=!0,(h||g)&&w){const E=Ou[t.charAt(x)];E&&(a[E.charCodeAt(0)]=!0)}}populate(t,a,h){const g=this.layers[0],w=g.layout,x=w.get("text-font"),E=w.get("text-field"),M=w.get("icon-image"),F=(E.value.kind!=="constant"||E.value.value instanceof Un&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),V=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,G=w.get("symbol-sort-key");if(this.features=[],!F&&!V)return;const Q=a.iconDependencies,ne=a.glyphDependencies,ue=a.availableImages,de=new mn(this.zoom);for(const{feature:ke,id:Me,index:Qe,sourceLayerIndex:Ue}of t){const Ke=g._featureFilter.needGeometry,at=Il(ke,Ke);if(!g._featureFilter.filter(de,at,h))continue;let wt,Bt;if(Ke||(at.geometry=El(ke)),F){const Ft=g.getValueAndResolveTokens("text-field",at,h,ue),Ot=Un.factory(Ft),Yt=this.hasRTLText=this.hasRTLText||kv(Ot);(!Yt||Ur.getRTLTextPluginStatus()==="unavailable"||Yt&&Ur.isParsed())&&(wt=sv(Ot,g,at))}if(V){const Ft=g.getValueAndResolveTokens("icon-image",at,h,ue);Bt=Ft instanceof Hn?Ft:Hn.fromString(Ft)}if(!wt&&!Bt)continue;const ci=this.sortFeaturesByKey?G.evaluate(at,{},h):void 0;if(this.features.push({id:Me,text:wt,icon:Bt,index:Qe,sourceLayerIndex:Ue,geometry:at.geometry,properties:ke.properties,type:Sv[ke.type],sortKey:ci}),Bt&&(Q[Bt.name]=!0),wt){const Ft=x.evaluate(at,{},h).join(","),Ot=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ah.vertical)>=0;for(const Yt of wt.sections)if(Yt.image)Q[Yt.image.name]=!0;else{const qt=bu(wt.toString()),jt=Yt.fontStack||Ft,ft=ne[jt]=ne[jt]||{};this.calculateGlyphDependencies(Yt.text,ft,Ot,this.allowVerticalPlacement,qt)}}}w.get("symbol-placement")==="line"&&(this.features=function(ke){const Me={},Qe={},Ue=[];let Ke=0;function at(Ft){Ue.push(ke[Ft]),Ke++}function wt(Ft,Ot,Yt){const qt=Qe[Ft];return delete Qe[Ft],Qe[Ot]=qt,Ue[qt].geometry[0].pop(),Ue[qt].geometry[0]=Ue[qt].geometry[0].concat(Yt[0]),qt}function Bt(Ft,Ot,Yt){const qt=Me[Ot];return delete Me[Ot],Me[Ft]=qt,Ue[qt].geometry[0].shift(),Ue[qt].geometry[0]=Yt[0].concat(Ue[qt].geometry[0]),qt}function ci(Ft,Ot,Yt){const qt=Yt?Ot[0][Ot[0].length-1]:Ot[0][0];return`${Ft}:${qt.x}:${qt.y}`}for(let Ft=0;Ft<ke.length;Ft++){const Ot=ke[Ft],Yt=Ot.geometry,qt=Ot.text?Ot.text.toString():null;if(!qt){at(Ft);continue}const jt=ci(qt,Yt),ft=ci(qt,Yt,!0);if(jt in Qe&&ft in Me&&Qe[jt]!==Me[ft]){const ei=Bt(jt,ft,Yt),Kt=wt(jt,ft,Ue[ei].geometry);delete Me[jt],delete Qe[ft],Qe[ci(qt,Ue[Kt].geometry,!0)]=Kt,Ue[ei].geometry=null}else jt in Qe?wt(jt,ft,Yt):ft in Me?Bt(jt,ft,Yt):(at(Ft),Me[jt]=Ke-1,Qe[ft]=Ke-1)}return Ue.filter(Ft=>Ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ke,Me)=>ke.sortKey-Me.sortKey)}update(t,a,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,h),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const h=this.lineVertexArray.length;if(t.segment!==void 0){let g=t.dist(a[t.segment+1]),w=t.dist(a[t.segment]);const x={};for(let E=t.segment+1;E<a.length;E++)x[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:g},E<a.length-1&&(g+=a[E+1].dist(a[E]));for(let E=t.segment||0;E>=0;E--)x[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:w},E>0&&(w+=a[E-1].dist(a[E]));for(let E=0;E<a.length;E++){const M=x[E];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(t,a,h,g,w,x,E,M,F,V,G,Q){const ne=t.indexArray,ue=t.layoutVertexArray,de=t.segments.prepareSegment(4*a.length,ue,ne,this.canOverlap?x.sortKey:void 0),ke=this.glyphOffsetArray.length,Me=de.vertexLength,Qe=this.allowVerticalPlacement&&E===f.ah.vertical?Math.PI/2:0,Ue=x.text&&x.text.sections;for(let Ke=0;Ke<a.length;Ke++){const{tl:at,tr:wt,bl:Bt,br:ci,tex:Ft,pixelOffsetTL:Ot,pixelOffsetBR:Yt,minFontScaleX:qt,minFontScaleY:jt,glyphOffset:ft,isSDF:ei,sectionIndex:Kt}=a[Ke],yi=de.vertexLength,an=ft[1];Nh(ue,M.x,M.y,at.x,an+at.y,Ft.x,Ft.y,h,ei,Ot.x,Ot.y,qt,jt),Nh(ue,M.x,M.y,wt.x,an+wt.y,Ft.x+Ft.w,Ft.y,h,ei,Yt.x,Ot.y,qt,jt),Nh(ue,M.x,M.y,Bt.x,an+Bt.y,Ft.x,Ft.y+Ft.h,h,ei,Ot.x,Yt.y,qt,jt),Nh(ue,M.x,M.y,ci.x,an+ci.y,Ft.x+Ft.w,Ft.y+Ft.h,h,ei,Yt.x,Yt.y,qt,jt),nd(t.dynamicLayoutVertexArray,M,Qe),ne.emplaceBack(yi,yi+1,yi+2),ne.emplaceBack(yi+1,yi+2,yi+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ft[0]),Ke!==a.length-1&&Kt===a[Ke+1].sectionIndex||t.programConfigurations.populatePaintArrays(ue.length,x,x.index,{},Q,Ue&&Ue[Kt])}t.placedSymbolArray.emplaceBack(M.x,M.y,ke,this.glyphOffsetArray.length-ke,Me,F,V,M.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],E,0,!1,0,G)}_addCollisionDebugVertex(t,a,h,g,w,x){return a.emplaceBack(0,0),t.emplaceBack(h.x,h.y,g,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,a,h,g,w,x,E){const M=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),F=M.vertexLength,V=w.layoutVertexArray,G=w.collisionVertexArray,Q=E.anchorX,ne=E.anchorY;this._addCollisionDebugVertex(V,G,x,Q,ne,new y(t,a)),this._addCollisionDebugVertex(V,G,x,Q,ne,new y(h,a)),this._addCollisionDebugVertex(V,G,x,Q,ne,new y(h,g)),this._addCollisionDebugVertex(V,G,x,Q,ne,new y(t,g)),M.vertexLength+=4;const ue=w.indexArray;ue.emplaceBack(F,F+1),ue.emplaceBack(F+1,F+2),ue.emplaceBack(F+2,F+3),ue.emplaceBack(F+3,F),M.primitiveLength+=4}addDebugCollisionBoxes(t,a,h,g){for(let w=t;w<a;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sd(ss,im.members,er),this.iconCollisionBox=new sd(ss,im.members,er);for(let t=0;t<this.symbolInstances.length;t++){const a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(t,a,h,g,w,x,E,M,F){const V={};for(let G=a;G<h;G++){const Q=t.get(G);V.textBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},V.textFeatureIndex=Q.featureIndex;break}for(let G=g;G<w;G++){const Q=t.get(G);V.verticalTextBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},V.verticalTextFeatureIndex=Q.featureIndex;break}for(let G=x;G<E;G++){const Q=t.get(G);V.iconBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},V.iconFeatureIndex=Q.featureIndex;break}for(let G=M;G<F;G++){const Q=t.get(G);V.verticalIconBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},V.verticalIconFeatureIndex=Q.featureIndex;break}return V}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,a){const h=t.placedSymbolArray.get(a),g=h.vertexStartIndex+4*h.numGlyphs;for(let w=h.vertexStartIndex;w<g;w+=4)t.indexArray.emplaceBack(w,w+1,w+2),t.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(t),h=Math.cos(t),g=[],w=[],x=[];for(let E=0;E<this.symbolInstances.length;++E){x.push(E);const M=this.symbolInstances.get(E);g.push(0|Math.round(a*M.anchorX+h*M.anchorY)),w.push(M.featureIndex)}return x.sort((E,M)=>g[E]-g[M]||w[M]-w[E]),x}addToSortKeyRanges(t,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((g,w,x)=>{g>=0&&x.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vm,wm;Ut("SymbolBucket",Ec,{omit:["layers","collisionBoxArray","features","compareText"]}),Ec.MAX_GLYPHS=65535,Ec.addDynamicAttributes=nd;var od={get paint(){return wm=wm||new v({"icon-opacity":new ui(Je.paint_symbol["icon-opacity"]),"icon-color":new ui(Je.paint_symbol["icon-color"]),"icon-halo-color":new ui(Je.paint_symbol["icon-halo-color"]),"icon-halo-width":new ui(Je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ui(Je.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt(Je.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt(Je.paint_symbol["icon-translate-anchor"]),"text-opacity":new ui(Je.paint_symbol["text-opacity"]),"text-color":new ui(Je.paint_symbol["text-color"],{runtimeType:tn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ui(Je.paint_symbol["text-halo-color"]),"text-halo-width":new ui(Je.paint_symbol["text-halo-width"]),"text-halo-blur":new ui(Je.paint_symbol["text-halo-blur"]),"text-translate":new Gt(Je.paint_symbol["text-translate"]),"text-translate-anchor":new Gt(Je.paint_symbol["text-translate-anchor"])})},get layout(){return vm=vm||new v({"symbol-placement":new Gt(Je.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt(Je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt(Je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ui(Je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt(Je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gt(Je.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Gt(Je.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Gt(Je.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt(Je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt(Je.layout_symbol["icon-rotation-alignment"]),"icon-size":new ui(Je.layout_symbol["icon-size"]),"icon-text-fit":new Gt(Je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(Je.layout_symbol["icon-text-fit-padding"]),"icon-image":new ui(Je.layout_symbol["icon-image"]),"icon-rotate":new ui(Je.layout_symbol["icon-rotate"]),"icon-padding":new ui(Je.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt(Je.layout_symbol["icon-keep-upright"]),"icon-offset":new ui(Je.layout_symbol["icon-offset"]),"icon-anchor":new ui(Je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt(Je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt(Je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt(Je.layout_symbol["text-rotation-alignment"]),"text-field":new ui(Je.layout_symbol["text-field"]),"text-font":new ui(Je.layout_symbol["text-font"]),"text-size":new ui(Je.layout_symbol["text-size"]),"text-max-width":new ui(Je.layout_symbol["text-max-width"]),"text-line-height":new Gt(Je.layout_symbol["text-line-height"]),"text-letter-spacing":new ui(Je.layout_symbol["text-letter-spacing"]),"text-justify":new ui(Je.layout_symbol["text-justify"]),"text-radial-offset":new ui(Je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt(Je.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ui(Je.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ui(Je.layout_symbol["text-anchor"]),"text-max-angle":new Gt(Je.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt(Je.layout_symbol["text-writing-mode"]),"text-rotate":new ui(Je.layout_symbol["text-rotate"]),"text-padding":new Gt(Je.layout_symbol["text-padding"]),"text-keep-upright":new Gt(Je.layout_symbol["text-keep-upright"]),"text-transform":new ui(Je.layout_symbol["text-transform"]),"text-offset":new ui(Je.layout_symbol["text-offset"]),"text-allow-overlap":new Gt(Je.layout_symbol["text-allow-overlap"]),"text-overlap":new Gt(Je.layout_symbol["text-overlap"]),"text-ignore-placement":new Gt(Je.layout_symbol["text-ignore-placement"]),"text-optional":new Gt(Je.layout_symbol["text-optional"])})}};class xm{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Cn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut("FormatSectionOverride",xm,{omit:["defaultValue"]});class jh extends c{constructor(t){super(t,od)}recalculate(t,a){if(super.recalculate(t,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const w of h)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,a,h,g){const w=this.layout.get(t).evaluate(a,{},h,g),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||Ma(x.value)||!w?w:function(E,M){return M.replace(/{([^{}]+)}/g,(F,V)=>E&&V in E?String(E[V]):"")}(a.properties,w)}createBucket(t){return new Ec(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of od.paint.overridableProperties){if(!jh.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),h=new xm(a),g=new So(h,a.property.specification);let w=null;w=a.value.kind==="constant"||a.value.kind==="source"?new pr("source",g):new To("composite",g,a.value.zoomStops),this.paint._values[t]=new Ds(a.property,w,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&jh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const h=t.get("text-field"),g=od.paint.properties[a];let w=!1;const x=E=>{for(const M of E)if(g.overrides&&g.overrides.hasOverride(M))return void(w=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Un)x(h.value.value.sections);else if(h.value.kind==="source"){const E=F=>{w||(F instanceof ir&&Ei(F.value)===dr?x(F.value.sections):F instanceof Vo?x(F.sections):F.eachChild(E))},M=h.value;M._styleExpression&&E(M._styleExpression.expression)}return w}}let Sm;var Cv={get paint(){return Sm=Sm||new v({"background-color":new Gt(Je.paint_background["background-color"]),"background-pattern":new dc(Je.paint_background["background-pattern"]),"background-opacity":new Gt(Je.paint_background["background-opacity"])})}};class Ev extends c{constructor(t){super(t,Cv)}}let Tm;var Iv={get paint(){return Tm=Tm||new v({"raster-opacity":new Gt(Je.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gt(Je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt(Je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt(Je.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt(Je.paint_raster["raster-saturation"]),"raster-contrast":new Gt(Je.paint_raster["raster-contrast"]),"raster-resampling":new Gt(Je.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt(Je.paint_raster["raster-fade-duration"])})}};class Av extends c{constructor(t){super(t,Iv)}}class Mv extends c{constructor(t){super(t,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Pv{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ad=63710088e-1;class Xa{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xa($(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,h=this.lat*a,g=t.lat*a,w=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((t.lng-this.lng)*a);return ad*Math.acos(Math.min(w,1))}static convert(t){if(t instanceof Xa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Xa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Xa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const km=2*Math.PI*ad;function Cm(r){return km*Math.cos(r*Math.PI/180)}function Em(r){return(180+r)/360}function Im(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Am(r,t){return r/Cm(t)}function ld(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Bu{constructor(t,a,h=0){this.x=+t,this.y=+a,this.z=+h}static fromLngLat(t,a=0){const h=Xa.convert(t);return new Bu(Em(h.lng),Im(h.lat),Am(a,h.lat))}toLngLat(){return new Xa(360*this.x-180,ld(this.y))}toAltitude(){return this.z*Cm(ld(this.y))}meterInMercatorCoordinateUnits(){return 1/km*(t=ld(this.y),1/Math.cos(t*Math.PI/180));var t}}function Mm(r,t,a){var h=2*Math.PI*6378137/256/Math.pow(2,a);return[r*h-2*Math.PI*6378137/2,t*h-2*Math.PI*6378137/2]}class cd{constructor(t,a,h){if(!function(g,w,x){return!(g<0||g>25||x<0||x>=Math.pow(2,g)||w<0||w>=Math.pow(2,g))}(t,a,h))throw new Error(`x=${a}, y=${h}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=a,this.y=h,this.key=Nu(0,t,t,a,h)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,a,h){const g=(x=this.y,E=this.z,M=Mm(256*(w=this.x),256*(x=Math.pow(2,E)-x-1),E),F=Mm(256*(w+1),256*(x+1),E),M[0]+","+M[1]+","+F[0]+","+F[1]);var w,x,E,M,F;const V=function(G,Q,ne){let ue,de="";for(let ke=G;ke>0;ke--)ue=1<<ke-1,de+=(Q&ue?1:0)+(ne&ue?2:0);return de}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,V).replace(/{bbox-epsg-3857}/g,g)}isChildOf(t){const a=this.z-t.z;return a>0&&t.x===this.x>>a&&t.y===this.y>>a}getTilePoint(t){const a=Math.pow(2,this.z);return new y((t.x*a-this.x)*Nn,(t.y*a-this.y)*Nn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pm{constructor(t,a){this.wrap=t,this.canonical=a,this.key=Nu(t,a.z,a.z,a.x,a.y)}}class ys{constructor(t,a,h,g,w){if(t<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${h}`);this.overscaledZ=t,this.wrap=a,this.canonical=new cd(h,+g,+w),this.key=Nu(a,t,h,g,w)}clone(){return new ys(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?new ys(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ys(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(t,a){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-t;return t>this.canonical.z?Nu(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):Nu(this.wrap*+a,t,t,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new ys(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new ys(a,this.wrap,a,h,g),new ys(a,this.wrap,a,h+1,g),new ys(a,this.wrap,a,h,g+1),new ys(a,this.wrap,a,h+1,g+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ys(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ys(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Bu(t.x-this.wrap,t.y))}}function Nu(r,t,a,h,g){(r*=2)<0&&(r=-1*r-1);const w=1<<a;return(w*w*r+w*g+h).toString(36)+a.toString(36)+t.toString(36)}Ut("CanonicalTileID",cd),Ut("OverscaledTileID",ys,{omit:["posMatrix"]});class Lm{constructor(t,a,h,g=1,w=1,x=1,E=0){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void le(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const M=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=x,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<M;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(M,F)]=this.data[this._idx(M-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,M)]=this.data[this._idx(F,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<M;F++)for(let V=0;V<M;V++){const G=this.get(F,V);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(t,a){const h=new Uint8Array(this.data.buffer),g=4*this._idx(t,a);return this.unpack(h[g],h[g+1],h[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}unpack(t,a,h){return t*this.redFactor+a*this.greenFactor+h*this.blueFactor-this.baseShift}getPixels(){return new _s({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,a,h){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let g=a*this.dim,w=a*this.dim+this.dim,x=h*this.dim,E=h*this.dim+this.dim;switch(a){case-1:g=w-1;break;case 1:w=g+1}switch(h){case-1:x=E-1;break;case 1:E=x+1}const M=-a*this.dim,F=-h*this.dim;for(let V=x;V<E;V++)for(let G=g;G<w;G++)this.data[this._idx(G,V)]=t.data[this._idx(G+M,V+F)]}}Ut("DEMData",Lm);class zm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const h=t[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Om{constructor(t,a,h,g,w){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=h,t._y=g,this.properties=t.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t}}class Dm{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Oa(Nn,16,0),this.grid3D=new Oa(Nn,16,0),this.featureIndexArray=new _r,this.promoteId=a}insert(t,a,h,g,w,x){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,w);const M=x?this.grid3D:this.grid;for(let F=0;F<a.length;F++){const V=a[F],G=[1/0,1/0,-1/0,-1/0];for(let Q=0;Q<V.length;Q++){const ne=V[Q];G[0]=Math.min(G[0],ne.x),G[1]=Math.min(G[1],ne.y),G[2]=Math.max(G[2],ne.x),G[3]=Math.max(G[3],ne.y)}G[0]<Nn&&G[1]<Nn&&G[2]>=0&&G[3]>=0&&M.insert(E,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Wa.VectorTile(new Yf(this.rawTileData)).layers,this.sourceLayerCoder=new zm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,a,h,g){this.loadVTLayers();const w=t.params||{},x=Nn/t.tileSize/t.scale,E=_l(w.filter),M=t.queryGeometry,F=t.queryPadding*x,V=Rm(M),G=this.grid.query(V.minX-F,V.minY-F,V.maxX+F,V.maxY+F),Q=Rm(t.cameraQueryGeometry),ne=this.grid3D.query(Q.minX-F,Q.minY-F,Q.maxX+F,Q.maxY+F,(ke,Me,Qe,Ue)=>function(Ke,at,wt,Bt,ci){for(const Ot of Ke)if(at<=Ot.x&&wt<=Ot.y&&Bt>=Ot.x&&ci>=Ot.y)return!0;const Ft=[new y(at,wt),new y(at,ci),new y(Bt,ci),new y(Bt,wt)];if(Ke.length>2){for(const Ot of Ft)if(vc(Ke,Ot))return!0}for(let Ot=0;Ot<Ke.length-1;Ot++)if(hb(Ke[Ot],Ke[Ot+1],Ft))return!0;return!1}(t.cameraQueryGeometry,ke-F,Me-F,Qe+F,Ue+F));for(const ke of ne)G.push(ke);G.sort(Lv);const ue={};let de;for(let ke=0;ke<G.length;ke++){const Me=G[ke];if(Me===de)continue;de=Me;const Qe=this.featureIndexArray.get(Me);let Ue=null;this.loadMatchingFeature(ue,Qe.bucketIndex,Qe.sourceLayerIndex,Qe.featureIndex,E,w.layers,w.availableImages,a,h,g,(Ke,at,wt)=>(Ue||(Ue=El(Ke)),at.queryIntersectsFeature(M,Ke,wt,Ue,this.z,t.transform,x,t.pixelPosMatrix)))}return ue}loadMatchingFeature(t,a,h,g,w,x,E,M,F,V,G){const Q=this.bucketLayerIDs[a];if(x&&!function(ke,Me){for(let Qe=0;Qe<ke.length;Qe++)if(Me.indexOf(ke[Qe])>=0)return!0;return!1}(x,Q))return;const ne=this.sourceLayerCoder.decode(h),ue=this.vtLayers[ne].feature(g);if(w.needGeometry){const ke=Il(ue,!0);if(!w.filter(new mn(this.tileID.overscaledZ),ke,this.tileID.canonical))return}else if(!w.filter(new mn(this.tileID.overscaledZ),ue))return;const de=this.getId(ue,ne);for(let ke=0;ke<Q.length;ke++){const Me=Q[ke];if(x&&x.indexOf(Me)<0)continue;const Qe=M[Me];if(!Qe)continue;let Ue={};de&&V&&(Ue=V.getState(Qe.sourceLayer||"_geojsonTileLayer",de));const Ke=re({},F[Me]);Ke.paint=Fm(Ke.paint,Qe.paint,ue,Ue,E),Ke.layout=Fm(Ke.layout,Qe.layout,ue,Ue,E);const at=!G||G(ue,Qe,Ue);if(!at)continue;const wt=new Om(ue,this.z,this.x,this.y,de);wt.layer=Ke;let Bt=t[Me];Bt===void 0&&(Bt=t[Me]=[]),Bt.push({featureIndex:g,feature:wt,intersectionZ:at})}}lookupSymbolFeatures(t,a,h,g,w,x,E,M){const F={};this.loadVTLayers();const V=_l(w);for(const G of t)this.loadMatchingFeature(F,h,g,G,V,x,E,M,a);return F}hasLayer(t){for(const a of this.bucketLayerIDs)for(const h of a)if(t===h)return!0;return!1}getId(t,a){let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof h=="boolean"&&(h=Number(h))),h}}function Fm(r,t,a,h,g){return U(r,(w,x)=>{const E=t instanceof Sl?t.get(x):null;return E&&E.evaluate?E.evaluate(a,h,g):E})}function Rm(r){let t=1/0,a=1/0,h=-1/0,g=-1/0;for(const w of r)t=Math.min(t,w.x),a=Math.min(a,w.y),h=Math.max(h,w.x),g=Math.max(g,w.y);return{minX:t,minY:a,maxX:h,maxY:g}}function Lv(r,t){return t-r}function Bm(r,t,a,h,g){const w=[];for(let x=0;x<r.length;x++){const E=r[x];let M;for(let F=0;F<E.length-1;F++){let V=E[F],G=E[F+1];V.x<t&&G.x<t||(V.x<t?V=new y(t,V.y+(t-V.x)/(G.x-V.x)*(G.y-V.y))._round():G.x<t&&(G=new y(t,V.y+(t-V.x)/(G.x-V.x)*(G.y-V.y))._round()),V.y<a&&G.y<a||(V.y<a?V=new y(V.x+(a-V.y)/(G.y-V.y)*(G.x-V.x),a)._round():G.y<a&&(G=new y(V.x+(a-V.y)/(G.y-V.y)*(G.x-V.x),a)._round()),V.x>=h&&G.x>=h||(V.x>=h?V=new y(h,V.y+(h-V.x)/(G.x-V.x)*(G.y-V.y))._round():G.x>=h&&(G=new y(h,V.y+(h-V.x)/(G.x-V.x)*(G.y-V.y))._round()),V.y>=g&&G.y>=g||(V.y>=g?V=new y(V.x+(g-V.y)/(G.y-V.y)*(G.x-V.x),g)._round():G.y>=g&&(G=new y(V.x+(g-V.y)/(G.y-V.y)*(G.x-V.x),g)._round()),M&&V.equals(M[M.length-1])||(M=[V],w.push(M)),M.push(G)))))}}return w}Ut("FeatureIndex",Dm,{omit:["rawTileData","sourceLayerCoder"]});class Ka extends y{constructor(t,a,h,g){super(t,a),this.angle=h,g!==void 0&&(this.segment=g)}clone(){return new Ka(this.x,this.y,this.angle,this.segment)}}function Nm(r,t,a,h,g){if(t.segment===void 0||a===0)return!0;let w=t,x=t.segment+1,E=0;for(;E>-a/2;){if(x--,x<0)return!1;E-=r[x].dist(w),w=r[x]}E+=r[x].dist(r[x+1]),x++;const M=[];let F=0;for(;E<a/2;){const V=r[x],G=r[x+1];if(!G)return!1;let Q=r[x-1].angleTo(V)-V.angleTo(G);for(Q=Math.abs((Q+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:E,angleDelta:Q}),F+=Q;E-M[0].distance>h;)F-=M.shift().angleDelta;if(F>g)return!1;x++,E+=V.dist(G)}return!0}function jm(r){let t=0;for(let a=0;a<r.length-1;a++)t+=r[a].dist(r[a+1]);return t}function Um(r,t,a){return r?.6*t*a:0}function Vm(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function zv(r,t,a,h,g,w){const x=Um(a,g,w),E=Vm(a,h)*w;let M=0;const F=jm(r)/2;for(let V=0;V<r.length-1;V++){const G=r[V],Q=r[V+1],ne=G.dist(Q);if(M+ne>F){const ue=(F-M)/ne,de=Vn.number(G.x,Q.x,ue),ke=Vn.number(G.y,Q.y,ue),Me=new Ka(de,ke,Q.angleTo(G),V);return Me._round(),!x||Nm(r,Me,E,x,t)?Me:void 0}M+=ne}}function Ov(r,t,a,h,g,w,x,E,M){const F=Um(h,w,x),V=Vm(h,g),G=V*x,Q=r[0].x===0||r[0].x===M||r[0].y===0||r[0].y===M;return t-G<t/4&&(t=G+t/4),qm(r,Q?t/2*E%t:(V/2+2*w)*x*E%t,t,F,a,G,Q,!1,M)}function qm(r,t,a,h,g,w,x,E,M){const F=w/2,V=jm(r);let G=0,Q=t-a,ne=[];for(let ue=0;ue<r.length-1;ue++){const de=r[ue],ke=r[ue+1],Me=de.dist(ke),Qe=ke.angleTo(de);for(;Q+a<G+Me;){Q+=a;const Ue=(Q-G)/Me,Ke=Vn.number(de.x,ke.x,Ue),at=Vn.number(de.y,ke.y,Ue);if(Ke>=0&&Ke<M&&at>=0&&at<M&&Q-F>=0&&Q+F<=V){const wt=new Ka(Ke,at,Qe,ue);wt._round(),h&&!Nm(r,wt,w,h,g)||ne.push(wt)}}G+=Me}return E||ne.length||x||(ne=qm(r,G/2,a,h,g,w,x,!0,M)),ne}Ut("Anchor",Ka);const Ic=qr;function Zm(r,t,a,h){const g=[],w=r.image,x=w.pixelRatio,E=w.paddedRect.w-2*Ic,M=w.paddedRect.h-2*Ic;let F={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const V=w.stretchX||[[0,E]],G=w.stretchY||[[0,M]],Q=(ft,ei)=>ft+ei[1]-ei[0],ne=V.reduce(Q,0),ue=G.reduce(Q,0),de=E-ne,ke=M-ue;let Me=0,Qe=ne,Ue=0,Ke=ue,at=0,wt=de,Bt=0,ci=ke;if(w.content&&h){const ft=w.content,ei=ft[2]-ft[0],Kt=ft[3]-ft[1];(w.textFitWidth||w.textFitHeight)&&(F=_m(r)),Me=Uh(V,0,ft[0]),Ue=Uh(G,0,ft[1]),Qe=Uh(V,ft[0],ft[2]),Ke=Uh(G,ft[1],ft[3]),at=ft[0]-Me,Bt=ft[1]-Ue,wt=ei-Qe,ci=Kt-Ke}const Ft=F.x1,Ot=F.y1,Yt=F.x2-Ft,qt=F.y2-Ot,jt=(ft,ei,Kt,yi)=>{const an=Vh(ft.stretch-Me,Qe,Yt,Ft),rn=qh(ft.fixed-at,wt,ft.stretch,ne),Xn=Vh(ei.stretch-Ue,Ke,qt,Ot),Rs=qh(ei.fixed-Bt,ci,ei.stretch,ue),ar=Vh(Kt.stretch-Me,Qe,Yt,Ft),Kn=qh(Kt.fixed-at,wt,Kt.stretch,ne),Mr=Vh(yi.stretch-Ue,Ke,qt,Ot),Pr=qh(yi.fixed-Bt,ci,yi.stretch,ue),Lr=new y(an,Xn),Pn=new y(ar,Xn),Jn=new y(ar,Mr),br=new y(an,Mr),lr=new y(rn/x,Rs/x),zr=new y(Kn/x,Pr/x),cr=t*Math.PI/180;if(cr){const Xi=Math.sin(cr),fn=Math.cos(cr),bn=[fn,-Xi,Xi,fn];Lr._matMult(bn),Pn._matMult(bn),br._matMult(bn),Jn._matMult(bn)}const bs=ft.stretch+ft.fixed,Zr=ei.stretch+ei.fixed;return{tl:Lr,tr:Pn,bl:br,br:Jn,tex:{x:w.paddedRect.x+Ic+bs,y:w.paddedRect.y+Ic+Zr,w:Kt.stretch+Kt.fixed-bs,h:yi.stretch+yi.fixed-Zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:zr,minFontScaleX:wt/x/Yt,minFontScaleY:ci/x/qt,isSDF:a}};if(h&&(w.stretchX||w.stretchY)){const ft=Wm(V,de,ne),ei=Wm(G,ke,ue);for(let Kt=0;Kt<ft.length-1;Kt++){const yi=ft[Kt],an=ft[Kt+1];for(let rn=0;rn<ei.length-1;rn++)g.push(jt(yi,ei[rn],an,ei[rn+1]))}}else g.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:M+1}));return g}function Uh(r,t,a){let h=0;for(const g of r)h+=Math.max(t,Math.min(a,g[1]))-Math.max(t,Math.min(a,g[0]));return h}function Wm(r,t,a){const h=[{fixed:-Ic,stretch:0}];for(const[g,w]of r){const x=h[h.length-1];h.push({fixed:g-x.stretch,stretch:x.stretch}),h.push({fixed:g-x.stretch,stretch:x.stretch+(w-g)})}return h.push({fixed:t+Ic,stretch:a}),h}function Vh(r,t,a,h){return r/t*a+h}function qh(r,t,a,h){return r-t*a/h}class Zh{constructor(t,a,h,g,w,x,E,M,F,V){var G;if(this.boxStartIndex=t.length,F){let Q=x.top,ne=x.bottom;const ue=x.collisionPadding;ue&&(Q-=ue[1],ne+=ue[3]);let de=ne-Q;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{const Q=!((G=x.image)===null||G===void 0)&&G.content&&(x.image.textFitWidth||x.image.textFitHeight)?_m(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};Q.y1=Q.y1*E-M[0],Q.y2=Q.y2*E+M[2],Q.x1=Q.x1*E-M[3],Q.x2=Q.x2*E+M[1];const ne=x.collisionPadding;if(ne&&(Q.x1-=ne[0]*E,Q.y1-=ne[1]*E,Q.x2+=ne[2]*E,Q.y2+=ne[3]*E),V){const ue=new y(Q.x1,Q.y1),de=new y(Q.x2,Q.y1),ke=new y(Q.x1,Q.y2),Me=new y(Q.x2,Q.y2),Qe=V*Math.PI/180;ue._rotate(Qe),de._rotate(Qe),ke._rotate(Qe),Me._rotate(Qe),Q.x1=Math.min(ue.x,de.x,ke.x,Me.x),Q.x2=Math.max(ue.x,de.x,ke.x,Me.x),Q.y1=Math.min(ue.y,de.y,ke.y,Me.y),Q.y2=Math.max(ue.y,de.y,ke.y,Me.y)}t.emplaceBack(a.x,a.y,Q.x1,Q.y1,Q.x2,Q.y2,h,g,w)}this.boxEndIndex=t.length}}class Dv{constructor(t=[],a=(h,g)=>h<g?-1:h>g?1:0){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:h}=this,g=a[t];for(;t>0;){const w=t-1>>1,x=a[w];if(h(g,x)>=0)break;a[t]=x,t=w}a[t]=g}_down(t){const{data:a,compare:h}=this,g=this.length>>1,w=a[t];for(;t<g;){let x=1+(t<<1);const E=x+1;if(E<this.length&&h(a[E],a[x])<0&&(x=E),h(a[x],w)>=0)break;a[t]=a[x],t=x}a[t]=w}}function Fv(r,t=1,a=!1){let h=1/0,g=1/0,w=-1/0,x=-1/0;const E=r[0];for(let ne=0;ne<E.length;ne++){const ue=E[ne];(!ne||ue.x<h)&&(h=ue.x),(!ne||ue.y<g)&&(g=ue.y),(!ne||ue.x>w)&&(w=ue.x),(!ne||ue.y>x)&&(x=ue.y)}const M=Math.min(w-h,x-g);let F=M/2;const V=new Dv([],Rv);if(M===0)return new y(h,g);for(let ne=h;ne<w;ne+=M)for(let ue=g;ue<x;ue+=M)V.push(new Ac(ne+F,ue+F,F,r));let G=function(ne){let ue=0,de=0,ke=0;const Me=ne[0];for(let Qe=0,Ue=Me.length,Ke=Ue-1;Qe<Ue;Ke=Qe++){const at=Me[Qe],wt=Me[Ke],Bt=at.x*wt.y-wt.x*at.y;de+=(at.x+wt.x)*Bt,ke+=(at.y+wt.y)*Bt,ue+=3*Bt}return new Ac(de/ue,ke/ue,0,ne)}(r),Q=V.length;for(;V.length;){const ne=V.pop();(ne.d>G.d||!G.d)&&(G=ne,a&&console.log("found best %d after %d probes",Math.round(1e4*ne.d)/1e4,Q)),ne.max-G.d<=t||(F=ne.h/2,V.push(new Ac(ne.p.x-F,ne.p.y-F,F,r)),V.push(new Ac(ne.p.x+F,ne.p.y-F,F,r)),V.push(new Ac(ne.p.x-F,ne.p.y+F,F,r)),V.push(new Ac(ne.p.x+F,ne.p.y+F,F,r)),Q+=4)}return a&&(console.log(`num probes: ${Q}`),console.log(`best distance: ${G.d}`)),G.p}function Rv(r,t){return t.max-r.max}function Ac(r,t,a,h){this.p=new y(r,t),this.h=a,this.d=function(g,w){let x=!1,E=1/0;for(let M=0;M<w.length;M++){const F=w[M];for(let V=0,G=F.length,Q=G-1;V<G;Q=V++){const ne=F[V],ue=F[Q];ne.y>g.y!=ue.y>g.y&&g.x<(ue.x-ne.x)*(g.y-ne.y)/(ue.y-ne.y)+ne.x&&(x=!x),E=Math.min(E,Ip(g,ne,ue))}}return(x?1:-1)*Math.sqrt(E)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var or;f.aq=void 0,(or=f.aq||(f.aq={}))[or.center=1]="center",or[or.left=2]="left",or[or.right=3]="right",or[or.top=4]="top",or[or.bottom=5]="bottom",or[or["top-left"]=6]="top-left",or[or["top-right"]=7]="top-right",or[or["bottom-left"]=8]="bottom-left",or[or["bottom-right"]=9]="bottom-right";const Ja=7,ud=Number.POSITIVE_INFINITY;function Gm(r,t){return t[1]!==ud?function(a,h,g){let w=0,x=0;switch(h=Math.abs(h),g=Math.abs(g),a){case"top-right":case"top-left":case"top":x=g-Ja;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+Ja}switch(a){case"top-right":case"bottom-right":case"right":w=-h;break;case"top-left":case"bottom-left":case"left":w=h}return[w,x]}(r,t[0],t[1]):function(a,h){let g=0,w=0;h<0&&(h=0);const x=h/Math.SQRT2;switch(a){case"top-right":case"top-left":w=x-Ja;break;case"bottom-right":case"bottom-left":w=-x+Ja;break;case"bottom":w=-h+Ja;break;case"top":w=h-Ja}switch(a){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=h;break;case"right":g=-h}return[g,w]}(r,t[0])}function Hm(r,t,a){var h;const g=r.layout,w=(h=g.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(t,{},a);if(w){const E=w.values,M=[];for(let F=0;F<E.length;F+=2){const V=M[F]=E[F],G=E[F+1].map(Q=>Q*qn);V.startsWith("top")?G[1]-=Ja:V.startsWith("bottom")&&(G[1]+=Ja),M[F+1]=G}return new zn(M)}const x=g.get("text-variable-anchor");if(x){let E;E=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(t,{},a)*qn,ud]:g.get("text-offset").evaluate(t,{},a).map(F=>F*qn);const M=[];for(const F of x)M.push(F,Gm(F,E));return new zn(M)}return null}function hd(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bv(r,t,a,h,g,w,x,E,M,F,V){let G=w.textMaxSize.evaluate(t,{});G===void 0&&(G=x);const Q=r.layers[0].layout,ne=Q.get("icon-offset").evaluate(t,{},V),ue=Km(a.horizontal),de=x/24,ke=r.tilePixelRatio*de,Me=r.tilePixelRatio*G/24,Qe=r.tilePixelRatio*E,Ue=r.tilePixelRatio*Q.get("symbol-spacing"),Ke=Q.get("text-padding")*r.tilePixelRatio,at=function(ft,ei,Kt,yi=1){const an=ft.get("icon-padding").evaluate(ei,{},Kt),rn=an&&an.values;return[rn[0]*yi,rn[1]*yi,rn[2]*yi,rn[3]*yi]}(Q,t,V,r.tilePixelRatio),wt=Q.get("text-max-angle")/180*Math.PI,Bt=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point",ci=Q.get("icon-rotation-alignment")==="map"&&Q.get("symbol-placement")!=="point",Ft=Q.get("symbol-placement"),Ot=Ue/2,Yt=Q.get("icon-text-fit");let qt;h&&Yt!=="none"&&(r.allowVerticalPlacement&&a.vertical&&(qt=ym(h,a.vertical,Yt,Q.get("icon-text-fit-padding"),ne,de)),ue&&(h=ym(h,ue,Yt,Q.get("icon-text-fit-padding"),ne,de)));const jt=(ft,ei)=>{ei.x<0||ei.x>=Nn||ei.y<0||ei.y>=Nn||function(Kt,yi,an,rn,Xn,Rs,ar,Kn,Mr,Pr,Lr,Pn,Jn,br,lr,zr,cr,bs,Zr,Xi,fn,bn,os,An,Mc){const Mo=Kt.addToLineVertexArray(yi,an);let Po,Bs,vs,tr,la=0,Vu=0,$m=0,eg=0,bd=-1,vd=-1;const ca={};let tg=gc("");if(Kt.allowVerticalPlacement&&rn.vertical){const vr=Kn.layout.get("text-rotate").evaluate(fn,{},An)+90;vs=new Zh(Mr,yi,Pr,Lr,Pn,rn.vertical,Jn,br,lr,vr),ar&&(tr=new Zh(Mr,yi,Pr,Lr,Pn,ar,cr,bs,lr,vr))}if(Xn){const vr=Kn.layout.get("icon-rotate").evaluate(fn,{}),ws=Kn.layout.get("icon-text-fit")!=="none",Ml=Zm(Xn,vr,os,ws),lo=ar?Zm(ar,vr,os,ws):void 0;Bs=new Zh(Mr,yi,Pr,Lr,Pn,Xn,cr,bs,!1,vr),la=4*Ml.length;const Pl=Kt.iconSizeData;let Lo=null;Pl.kind==="source"?(Lo=[Ao*Kn.layout.get("icon-size").evaluate(fn,{})],Lo[0]>Ha&&le(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Ru}. Reduce your "icon-size".`)):Pl.kind==="composite"&&(Lo=[Ao*bn.compositeIconSizes[0].evaluate(fn,{},An),Ao*bn.compositeIconSizes[1].evaluate(fn,{},An)],(Lo[0]>Ha||Lo[1]>Ha)&&le(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Ru}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,Ml,Lo,Xi,Zr,fn,f.ah.none,yi,Mo.lineStartIndex,Mo.lineLength,-1,An),bd=Kt.icon.placedSymbolArray.length-1,lo&&(Vu=4*lo.length,Kt.addSymbols(Kt.icon,lo,Lo,Xi,Zr,fn,f.ah.vertical,yi,Mo.lineStartIndex,Mo.lineLength,-1,An),vd=Kt.icon.placedSymbolArray.length-1)}const ig=Object.keys(rn.horizontal);for(const vr of ig){const ws=rn.horizontal[vr];if(!Po){tg=gc(ws.text);const lo=Kn.layout.get("text-rotate").evaluate(fn,{},An);Po=new Zh(Mr,yi,Pr,Lr,Pn,ws,Jn,br,lr,lo)}const Ml=ws.positionedLines.length===1;if($m+=Xm(Kt,yi,ws,Rs,Kn,lr,fn,zr,Mo,rn.vertical?f.ah.horizontal:f.ah.horizontalOnly,Ml?ig:[vr],ca,bd,bn,An),Ml)break}rn.vertical&&(eg+=Xm(Kt,yi,rn.vertical,Rs,Kn,lr,fn,zr,Mo,f.ah.vertical,["vertical"],ca,vd,bn,An));const Uv=Po?Po.boxStartIndex:Kt.collisionBoxArray.length,Vv=Po?Po.boxEndIndex:Kt.collisionBoxArray.length,qv=vs?vs.boxStartIndex:Kt.collisionBoxArray.length,Zv=vs?vs.boxEndIndex:Kt.collisionBoxArray.length,Wv=Bs?Bs.boxStartIndex:Kt.collisionBoxArray.length,Gv=Bs?Bs.boxEndIndex:Kt.collisionBoxArray.length,Hv=tr?tr.boxStartIndex:Kt.collisionBoxArray.length,Xv=tr?tr.boxEndIndex:Kt.collisionBoxArray.length;let ao=-1;const Gh=(vr,ws)=>vr&&vr.circleDiameter?Math.max(vr.circleDiameter,ws):ws;ao=Gh(Po,ao),ao=Gh(vs,ao),ao=Gh(Bs,ao),ao=Gh(tr,ao);const ng=ao>-1?1:0;ng&&(ao*=Mc/qn),Kt.glyphOffsetArray.length>=Ec.MAX_GLYPHS&&le("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fn.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,fn.sortKey);const Kv=Hm(Kn,fn,An),[Jv,Yv]=function(vr,ws){const Ml=vr.length,lo=ws==null?void 0:ws.values;if((lo==null?void 0:lo.length)>0)for(let Pl=0;Pl<lo.length;Pl+=2){const Lo=lo[Pl+1];vr.emplaceBack(f.aq[lo[Pl]],Lo[0],Lo[1])}return[Ml,vr.length]}(Kt.textAnchorOffsets,Kv);Kt.symbolInstances.emplaceBack(yi.x,yi.y,ca.right>=0?ca.right:-1,ca.center>=0?ca.center:-1,ca.left>=0?ca.left:-1,ca.vertical||-1,bd,vd,tg,Uv,Vv,qv,Zv,Wv,Gv,Hv,Xv,Pr,$m,eg,la,Vu,ng,0,Jn,ao,Jv,Yv)}(r,ei,ft,a,h,g,qt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,ke,[Ke,Ke,Ke,Ke],Bt,M,Qe,at,ci,ne,t,w,F,V,x)};if(Ft==="line")for(const ft of Bm(t.geometry,0,0,Nn,Nn)){const ei=Ov(ft,Ue,wt,a.vertical||ue,h,24,Me,r.overscaling,Nn);for(const Kt of ei)ue&&Nv(r,ue.text,Ot,Kt)||jt(ft,Kt)}else if(Ft==="line-center"){for(const ft of t.geometry)if(ft.length>1){const ei=zv(ft,wt,a.vertical||ue,h,24,Me);ei&&jt(ft,ei)}}else if(t.type==="Polygon")for(const ft of Ta(t.geometry,0)){const ei=Fv(ft,16);jt(ft[0],new Ka(ei.x,ei.y,0))}else if(t.type==="LineString")for(const ft of t.geometry)jt(ft,new Ka(ft[0].x,ft[0].y,0));else if(t.type==="Point")for(const ft of t.geometry)for(const ei of ft)jt([ei],new Ka(ei.x,ei.y,0))}function Xm(r,t,a,h,g,w,x,E,M,F,V,G,Q,ne,ue){const de=function(Qe,Ue,Ke,at,wt,Bt,ci,Ft){const Ot=at.layout.get("text-rotate").evaluate(Bt,{})*Math.PI/180,Yt=[];for(const qt of Ue.positionedLines)for(const jt of qt.positionedGlyphs){if(!jt.rect)continue;const ft=jt.rect||{};let ei=um+1,Kt=!0,yi=1,an=0;const rn=(wt||Ft)&&jt.vertical,Xn=jt.metrics.advance*jt.scale/2;if(Ft&&Ue.verticalizable&&(an=qt.lineOffset/2-(jt.imageName?-(qn-jt.metrics.width*jt.scale)/2:(jt.scale-1)*qn)),jt.imageName){const Xi=ci[jt.imageName];Kt=Xi.sdf,yi=Xi.pixelRatio,ei=qr/yi}const Rs=wt?[jt.x+Xn,jt.y]:[0,0];let ar=wt?[0,0]:[jt.x+Xn+Ke[0],jt.y+Ke[1]-an],Kn=[0,0];rn&&(Kn=ar,ar=[0,0]);const Mr=jt.metrics.isDoubleResolution?2:1,Pr=(jt.metrics.left-ei)*jt.scale-Xn+ar[0],Lr=(-jt.metrics.top-ei)*jt.scale+ar[1],Pn=Pr+ft.w/Mr*jt.scale/yi,Jn=Lr+ft.h/Mr*jt.scale/yi,br=new y(Pr,Lr),lr=new y(Pn,Lr),zr=new y(Pr,Jn),cr=new y(Pn,Jn);if(rn){const Xi=new y(-Xn,Xn-Du),fn=-Math.PI/2,bn=qn/2-Xn,os=new y(5-Du-bn,-(jt.imageName?bn:0)),An=new y(...Kn);br._rotateAround(fn,Xi)._add(os)._add(An),lr._rotateAround(fn,Xi)._add(os)._add(An),zr._rotateAround(fn,Xi)._add(os)._add(An),cr._rotateAround(fn,Xi)._add(os)._add(An)}if(Ot){const Xi=Math.sin(Ot),fn=Math.cos(Ot),bn=[fn,-Xi,Xi,fn];br._matMult(bn),lr._matMult(bn),zr._matMult(bn),cr._matMult(bn)}const bs=new y(0,0),Zr=new y(0,0);Yt.push({tl:br,tr:lr,bl:zr,br:cr,tex:ft,writingMode:Ue.writingMode,glyphOffset:Rs,sectionIndex:jt.sectionIndex,isSDF:Kt,pixelOffsetTL:bs,pixelOffsetBR:Zr,minFontScaleX:0,minFontScaleY:0})}return Yt}(0,a,E,g,w,x,h,r.allowVerticalPlacement),ke=r.textSizeData;let Me=null;ke.kind==="source"?(Me=[Ao*g.layout.get("text-size").evaluate(x,{})],Me[0]>Ha&&le(`${r.layerIds[0]}: Value for "text-size" is >= ${Ru}. Reduce your "text-size".`)):ke.kind==="composite"&&(Me=[Ao*ne.compositeTextSizes[0].evaluate(x,{},ue),Ao*ne.compositeTextSizes[1].evaluate(x,{},ue)],(Me[0]>Ha||Me[1]>Ha)&&le(`${r.layerIds[0]}: Value for "text-size" is >= ${Ru}. Reduce your "text-size".`)),r.addSymbols(r.text,de,Me,E,w,x,F,t,M.lineStartIndex,M.lineLength,Q,ue);for(const Qe of V)G[Qe]=r.text.placedSymbolArray.length-1;return 4*de.length}function Km(r){for(const t in r)return r[t];return null}function Nv(r,t,a,h){const g=r.compareText;if(t in g){const w=g[t];for(let x=w.length-1;x>=0;x--)if(h.dist(w[x])<a)return!0}else g[t]=[];return g[t].push(h),!1}const Jm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class fd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,h]=new Uint8Array(t,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=h>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=Jm[15&h];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[E]=new Uint32Array(t,4,1);return new fd(E,x,w,t)}constructor(t,a=64,h=Float64Array,g){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=h,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const w=Jm.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,E=t*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-E%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${h}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+E+M,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+E+M),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+E+M,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=t,this.coords[this._pos++]=a,h}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return dd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,h,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:E}=this,M=[0,w.length-1,0],F=[];for(;M.length;){const V=M.pop()||0,G=M.pop()||0,Q=M.pop()||0;if(G-Q<=E){for(let ke=Q;ke<=G;ke++){const Me=x[2*ke],Qe=x[2*ke+1];Me>=t&&Me<=h&&Qe>=a&&Qe<=g&&F.push(w[ke])}continue}const ne=Q+G>>1,ue=x[2*ne],de=x[2*ne+1];ue>=t&&ue<=h&&de>=a&&de<=g&&F.push(w[ne]),(V===0?t<=ue:a<=de)&&(M.push(Q),M.push(ne-1),M.push(1-V)),(V===0?h>=ue:g>=de)&&(M.push(ne+1),M.push(G),M.push(1-V))}return F}within(t,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:x}=this,E=[0,g.length-1,0],M=[],F=h*h;for(;E.length;){const V=E.pop()||0,G=E.pop()||0,Q=E.pop()||0;if(G-Q<=x){for(let ke=Q;ke<=G;ke++)Qm(w[2*ke],w[2*ke+1],t,a)<=F&&M.push(g[ke]);continue}const ne=Q+G>>1,ue=w[2*ne],de=w[2*ne+1];Qm(ue,de,t,a)<=F&&M.push(g[ne]),(V===0?t-h<=ue:a-h<=de)&&(E.push(Q),E.push(ne-1),E.push(1-V)),(V===0?t+h>=ue:a+h>=de)&&(E.push(ne+1),E.push(G),E.push(1-V))}return M}}function dd(r,t,a,h,g,w){if(g-h<=a)return;const x=h+g>>1;Ym(r,t,x,h,g,w),dd(r,t,a,h,x-1,1-w),dd(r,t,a,x+1,g,1-w)}function Ym(r,t,a,h,g,w){for(;g>h;){if(g-h>600){const F=g-h+1,V=a-h+1,G=Math.log(F),Q=.5*Math.exp(2*G/3),ne=.5*Math.sqrt(G*Q*(F-Q)/F)*(V-F/2<0?-1:1);Ym(r,t,a,Math.max(h,Math.floor(a-V*Q/F+ne)),Math.min(g,Math.floor(a+(F-V)*Q/F+ne)),w)}const x=t[2*a+w];let E=h,M=g;for(ju(r,t,h,a),t[2*g+w]>x&&ju(r,t,h,g);E<M;){for(ju(r,t,E,M),E++,M--;t[2*E+w]<x;)E++;for(;t[2*M+w]>x;)M--}t[2*h+w]===x?ju(r,t,h,M):(M++,ju(r,t,M,g)),M<=a&&(h=M+1),a<=M&&(g=M-1)}}function ju(r,t,a,h){pd(r,a,h),pd(t,2*a,2*h),pd(t,2*a+1,2*h+1)}function pd(r,t,a){const h=r[t];r[t]=r[a],r[a]=h}function Qm(r,t,a,h){const g=r-a,w=t-h;return g*g+w*w}var md;f.bg=void 0,(md=f.bg||(f.bg={})).create="create",md.load="load",md.fullLoad="fullLoad";let Wh=null,Uu=[];const gd=1e3/60,_d="loadTime",yd="fullLoadTime",jv={mark(r){performance.mark(r)},frame(r){const t=r;Wh!=null&&Uu.push(t-Wh),Wh=t},clearMetrics(){Wh=null,Uu=[],performance.clearMeasures(_d),performance.clearMeasures(yd);for(const r in f.bg)performance.clearMarks(f.bg[r])},getPerformanceMetrics(){performance.measure(_d,f.bg.create,f.bg.load),performance.measure(yd,f.bg.create,f.bg.fullLoad);const r=performance.getEntriesByName(_d)[0].duration,t=performance.getEntriesByName(yd)[0].duration,a=Uu.length,h=1/(Uu.reduce((w,x)=>w+x,0)/a/1e3),g=Uu.filter(w=>w>gd).reduce((w,x)=>w+(x-gd)/gd,0);return{loadTime:r,fullLoadTime:t,fps:h,percentDroppedFrames:g/(a+g)*100,totalFrames:a}}};f.$=class extends X{},f.A=wc,f.B=Cf,f.C=function(r){if(_e==null){const t=r.navigator?r.navigator.userAgent:null;_e=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return _e},f.D=Gt,f.E=ii,f.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Pv(()=>this.process()),this.subscription=function(a,h,g,w){return a.addEventListener(h,g,!1),{unsubscribe:()=>{a.removeEventListener(h,g,!1)}}}(this.target,"message",a=>this.receive(a)),this.globalScope=pe(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((a,h)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:a,reject:h},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const E={id:g,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},{once:!0});const w=[],x=Object.assign(Object.assign({},r),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Da(r.data,w)});this.target.postMessage(x,{transfer:w})})}receive(r){const t=r.data,a=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[a];const h=this.abortControllers[a];return delete this.abortControllers[a],void(h&&h.abort())}if(pe(self)||t.mustQueue)return this.tasks[a]=t,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return o(this,void 0,void 0,function*(){if(t.type==="<response>"){const g=this.resolveRejects[r];return delete this.resolveRejects[r],g?void(t.error?g.reject(Fa(t.error)):g.resolve(Fa(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=Fa(t.data),h=new AbortController;this.abortControllers[r]=h;try{const g=yield this.messageHandlers[t.type](t.sourceMapId,a,h);this.completeTask(r,null,g)}catch(g){this.completeTask(r,g)}})}completeTask(r,t,a){const h=[];delete this.abortControllers[r];const g={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Da(t):null,data:Da(a,h)};this.target.postMessage(g,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.G=St,f.H=function(){var r=new wc(16);return wc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},f.I=$f,f.J=function(r,t,a){var h,g,w,x,E,M,F,V,G,Q,ne,ue,de=a[0],ke=a[1],Me=a[2];return t===r?(r[12]=t[0]*de+t[4]*ke+t[8]*Me+t[12],r[13]=t[1]*de+t[5]*ke+t[9]*Me+t[13],r[14]=t[2]*de+t[6]*ke+t[10]*Me+t[14],r[15]=t[3]*de+t[7]*ke+t[11]*Me+t[15]):(g=t[1],w=t[2],x=t[3],E=t[4],M=t[5],F=t[6],V=t[7],G=t[8],Q=t[9],ne=t[10],ue=t[11],r[0]=h=t[0],r[1]=g,r[2]=w,r[3]=x,r[4]=E,r[5]=M,r[6]=F,r[7]=V,r[8]=G,r[9]=Q,r[10]=ne,r[11]=ue,r[12]=h*de+E*ke+G*Me+t[12],r[13]=g*de+M*ke+Q*Me+t[13],r[14]=w*de+F*ke+ne*Me+t[14],r[15]=x*de+V*ke+ue*Me+t[15]),r},f.K=function(r,t,a){var h=a[0],g=a[1],w=a[2];return r[0]=t[0]*h,r[1]=t[1]*h,r[2]=t[2]*h,r[3]=t[3]*h,r[4]=t[4]*g,r[5]=t[5]*g,r[6]=t[6]*g,r[7]=t[7]*g,r[8]=t[8]*w,r[9]=t[9]*w,r[10]=t[10]*w,r[11]=t[11]*w,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},f.L=Lp,f.M=function(r,t){const a={};for(let h=0;h<t.length;h++){const g=t[h];g in r&&(a[g]=r[g])}return a},f.N=Xa,f.O=Em,f.P=y,f.Q=Im,f.R=_s,f.S=ys,f.T=hc,f.U=R,f.V=z,f.W=ze,f.X=Nn,f.Y=A,f.Z=Bu,f._=o,f.a=tt,f.a$=function(r,t){var a=r[0],h=r[1],g=r[2],w=r[3],x=r[4],E=r[5],M=r[6],F=r[7],V=r[8],G=r[9],Q=r[10],ne=r[11],ue=r[12],de=r[13],ke=r[14],Me=r[15],Qe=t[0],Ue=t[1],Ke=t[2],at=t[3],wt=t[4],Bt=t[5],ci=t[6],Ft=t[7],Ot=t[8],Yt=t[9],qt=t[10],jt=t[11],ft=t[12],ei=t[13],Kt=t[14],yi=t[15];return Math.abs(a-Qe)<=Ar*Math.max(1,Math.abs(a),Math.abs(Qe))&&Math.abs(h-Ue)<=Ar*Math.max(1,Math.abs(h),Math.abs(Ue))&&Math.abs(g-Ke)<=Ar*Math.max(1,Math.abs(g),Math.abs(Ke))&&Math.abs(w-at)<=Ar*Math.max(1,Math.abs(w),Math.abs(at))&&Math.abs(x-wt)<=Ar*Math.max(1,Math.abs(x),Math.abs(wt))&&Math.abs(E-Bt)<=Ar*Math.max(1,Math.abs(E),Math.abs(Bt))&&Math.abs(M-ci)<=Ar*Math.max(1,Math.abs(M),Math.abs(ci))&&Math.abs(F-Ft)<=Ar*Math.max(1,Math.abs(F),Math.abs(Ft))&&Math.abs(V-Ot)<=Ar*Math.max(1,Math.abs(V),Math.abs(Ot))&&Math.abs(G-Yt)<=Ar*Math.max(1,Math.abs(G),Math.abs(Yt))&&Math.abs(Q-qt)<=Ar*Math.max(1,Math.abs(Q),Math.abs(qt))&&Math.abs(ne-jt)<=Ar*Math.max(1,Math.abs(ne),Math.abs(jt))&&Math.abs(ue-ft)<=Ar*Math.max(1,Math.abs(ue),Math.abs(ft))&&Math.abs(de-ei)<=Ar*Math.max(1,Math.abs(de),Math.abs(ei))&&Math.abs(ke-Kt)<=Ar*Math.max(1,Math.abs(ke),Math.abs(Kt))&&Math.abs(Me-yi)<=Ar*Math.max(1,Math.abs(Me),Math.abs(yi))},f.a0=Ui,f.a1=cd,f.a2=lt,f.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(a=>{t.onloadstart=()=>{a(t)};for(const h of r){const g=window.document.createElement("source");Mi(h)||(t.crossOrigin="Anonymous"),g.src=h,t.appendChild(g)}})},f.a4=function(){return j++},f.a5=Rt,f.a6=Ec,f.a7=_l,f.a8=Il,f.a9=Om,f.aA=function(r){if(r.type==="custom")return new Mv(r);switch(r.type){case"background":return new Ev(r);case"circle":return new pb(r);case"fill":return new Pb(r);case"fill-extrusion":return new Gb(r);case"heatmap":return new gb(r);case"hillshade":return new yb(r);case"line":return new ev(r);case"raster":return new Av(r);case"symbol":return new jh(r)}},f.aB=B,f.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let a=[];try{if(!et(r.version,t.version))return[{command:"setStyle",args:[t]}];et(r.center,t.center)||a.push({command:"setCenter",args:[t.center]}),et(r.zoom,t.zoom)||a.push({command:"setZoom",args:[t.zoom]}),et(r.bearing,t.bearing)||a.push({command:"setBearing",args:[t.bearing]}),et(r.pitch,t.pitch)||a.push({command:"setPitch",args:[t.pitch]}),et(r.sprite,t.sprite)||a.push({command:"setSprite",args:[t.sprite]}),et(r.glyphs,t.glyphs)||a.push({command:"setGlyphs",args:[t.glyphs]}),et(r.transition,t.transition)||a.push({command:"setTransition",args:[t.transition]}),et(r.light,t.light)||a.push({command:"setLight",args:[t.light]}),et(r.terrain,t.terrain)||a.push({command:"setTerrain",args:[t.terrain]}),et(r.sky,t.sky)||a.push({command:"setSky",args:[t.sky]}),et(r.projection,t.projection)||a.push({command:"setProjection",args:[t.projection]});const h={},g=[];(function(x,E,M,F){let V;for(V in E=E||{},x=x||{})Object.prototype.hasOwnProperty.call(x,V)&&(Object.prototype.hasOwnProperty.call(E,V)||Y(V,M,F));for(V in E)Object.prototype.hasOwnProperty.call(E,V)&&(Object.prototype.hasOwnProperty.call(x,V)?et(x[V],E[V])||(x[V].type==="geojson"&&E[V].type==="geojson"&&qe(x,E,V)?he(M,{command:"setGeoJSONSourceData",args:[V,E[V].data]}):Ee(V,E,M,F)):H(V,E,M))})(r.sources,t.sources,g,h);const w=[];r.layers&&r.layers.forEach(x=>{"source"in x&&h[x.source]?a.push({command:"removeLayer",args:[x.id]}):w.push(x)}),a=a.concat(g),function(x,E,M){E=E||[];const F=(x=x||[]).map(st),V=E.map(st),G=x.reduce(ki,{}),Q=E.reduce(ki,{}),ne=F.slice(),ue=Object.create(null);let de,ke,Me,Qe,Ue;for(let Ke=0,at=0;Ke<F.length;Ke++)de=F[Ke],Object.prototype.hasOwnProperty.call(Q,de)?at++:(he(M,{command:"removeLayer",args:[de]}),ne.splice(ne.indexOf(de,at),1));for(let Ke=0,at=0;Ke<V.length;Ke++)de=V[V.length-1-Ke],ne[ne.length-1-Ke]!==de&&(Object.prototype.hasOwnProperty.call(G,de)?(he(M,{command:"removeLayer",args:[de]}),ne.splice(ne.lastIndexOf(de,ne.length-at),1)):at++,Qe=ne[ne.length-Ke],he(M,{command:"addLayer",args:[Q[de],Qe]}),ne.splice(ne.length-Ke,0,de),ue[de]=!0);for(let Ke=0;Ke<V.length;Ke++)if(de=V[Ke],ke=G[de],Me=Q[de],!ue[de]&&!et(ke,Me))if(et(ke.source,Me.source)&&et(ke["source-layer"],Me["source-layer"])&&et(ke.type,Me.type)){for(Ue in ut(ke.layout,Me.layout,M,de,null,"setLayoutProperty"),ut(ke.paint,Me.paint,M,de,null,"setPaintProperty"),et(ke.filter,Me.filter)||he(M,{command:"setFilter",args:[de,Me.filter]}),et(ke.minzoom,Me.minzoom)&&et(ke.maxzoom,Me.maxzoom)||he(M,{command:"setLayerZoomRange",args:[de,Me.minzoom,Me.maxzoom]}),ke)Object.prototype.hasOwnProperty.call(ke,Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&(Ue.indexOf("paint.")===0?ut(ke[Ue],Me[Ue],M,de,Ue.slice(6),"setPaintProperty"):et(ke[Ue],Me[Ue])||he(M,{command:"setLayerProperty",args:[de,Ue,Me[Ue]]}));for(Ue in Me)Object.prototype.hasOwnProperty.call(Me,Ue)&&!Object.prototype.hasOwnProperty.call(ke,Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&(Ue.indexOf("paint.")===0?ut(ke[Ue],Me[Ue],M,de,Ue.slice(6),"setPaintProperty"):et(ke[Ue],Me[Ue])||he(M,{command:"setLayerProperty",args:[de,Ue,Me[Ue]]}))}else he(M,{command:"removeLayer",args:[de]}),Qe=ne[ne.lastIndexOf(de)+1],he(M,{command:"addLayer",args:[Me,Qe]})}(w,t.layers,a)}catch(h){console.warn("Unable to compute style diff:",h),a=[{command:"setStyle",args:[t]}]}return a},f.aD=function(r){const t=[],a=r.id;return a===void 0&&t.push({message:`layers.${a}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${a}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},f.aE=function r(t,a){if(Array.isArray(t)){if(!Array.isArray(a)||t.length!==a.length)return!1;for(let h=0;h<t.length;h++)if(!r(t[h],a[h]))return!1;return!0}if(typeof t=="object"&&t!==null&&a!==null){if(typeof a!="object"||Object.keys(t).length!==Object.keys(a).length)return!1;for(const h in t)if(!r(t[h],a[h]))return!1;return!0}return t===a},f.aF=U,f.aG=J,f.aH=class extends kl{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},f.aI=Eh,f.aJ=class extends kl{constructor(r,t){super(r,t),this.current=ob}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},f.aK=wp,f.aL=xp,f.aM=ri,f.aN=class extends kl{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},f.aO=class extends kl{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},f.aP=function(r,t,a,h,g,w,x){var E=1/(t-a),M=1/(h-g),F=1/(w-x);return r[0]=-2*E,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*M,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*F,r[11]=0,r[12]=(t+a)*E,r[13]=(g+h)*M,r[14]=(x+w)*F,r[15]=1,r},f.aQ=db,f.aR=class extends We{},f.aS=rv,f.aT=class extends it{},f.aU=Uf,f.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},f.aW=Rp,f.aX=rr,f.aY=gs,f.aZ=class extends Ht{},f.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},f.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,h,g,w)=>{const x=g||w;return t[h]=!x||x.toLowerCase(),""}),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t},f.ab=function(r,t){const a=[];for(const h in r)h in t||a.push(h);return a},f.ac=ae,f.ad=function(r,t,a){var h=Math.sin(a),g=Math.cos(a),w=t[0],x=t[1],E=t[2],M=t[3],F=t[4],V=t[5],G=t[6],Q=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=w*g+F*h,r[1]=x*g+V*h,r[2]=E*g+G*h,r[3]=M*g+Q*h,r[4]=F*g-w*h,r[5]=V*g-x*h,r[6]=G*g-E*h,r[7]=Q*g-M*h,r},f.ae=function(r){var t=new wc(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},f.af=Ph,f.ag=function(r,t){let a=0,h=0;if(r.kind==="constant")h=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:x}=r,E=g?ae(Qn.interpolationFactor(g,t,w,x),0,1):0;r.kind==="camera"?h=Vn.number(r.minSize,r.maxSize,E):a=E}return{uSizeT:a,uSize:h}},f.ai=function(r,{uSize:t,uSizeT:a},{lowerSize:h,upperSize:g}){return r.kind==="source"?h/Ao:r.kind==="composite"?Vn.number(h/Ao,g/Ao,a):t},f.aj=nd,f.ak=function(r,t,a,h){const g=t.y-r.y,w=t.x-r.x,x=h.y-a.y,E=h.x-a.x,M=x*w-E*g;if(M===0)return null;const F=(E*(r.y-a.y)-x*(r.x-a.x))/M;return new y(r.x+F*w,r.y+F*g)},f.al=Bm,f.am=Cp,f.an=Bf,f.ao=function(r){let t=1/0,a=1/0,h=-1/0,g=-1/0;for(const w of r)t=Math.min(t,w.x),a=Math.min(a,w.y),h=Math.max(h,w.x),g=Math.max(g,w.y);return[t,a,h,g]},f.ap=qn,f.ar=id,f.as=function(r,t){var a=t[0],h=t[1],g=t[2],w=t[3],x=t[4],E=t[5],M=t[6],F=t[7],V=t[8],G=t[9],Q=t[10],ne=t[11],ue=t[12],de=t[13],ke=t[14],Me=t[15],Qe=a*E-h*x,Ue=a*M-g*x,Ke=a*F-w*x,at=h*M-g*E,wt=h*F-w*E,Bt=g*F-w*M,ci=V*de-G*ue,Ft=V*ke-Q*ue,Ot=V*Me-ne*ue,Yt=G*ke-Q*de,qt=G*Me-ne*de,jt=Q*Me-ne*ke,ft=Qe*jt-Ue*qt+Ke*Yt+at*Ot-wt*Ft+Bt*ci;return ft?(r[0]=(E*jt-M*qt+F*Yt)*(ft=1/ft),r[1]=(g*qt-h*jt-w*Yt)*ft,r[2]=(de*Bt-ke*wt+Me*at)*ft,r[3]=(Q*wt-G*Bt-ne*at)*ft,r[4]=(M*Ot-x*jt-F*Ft)*ft,r[5]=(a*jt-g*Ot+w*Ft)*ft,r[6]=(ke*Ke-ue*Bt-Me*Ue)*ft,r[7]=(V*Bt-Q*Ke+ne*Ue)*ft,r[8]=(x*qt-E*Ot+F*ci)*ft,r[9]=(h*Ot-a*qt-w*ci)*ft,r[10]=(ue*wt-de*Ke+Me*Qe)*ft,r[11]=(G*Ke-V*wt-ne*Qe)*ft,r[12]=(E*Ft-x*Yt-M*ci)*ft,r[13]=(a*Yt-h*Ft+g*ci)*ft,r[14]=(de*Ue-ue*at-ke*Qe)*ft,r[15]=(V*at-G*Ue+Q*Qe)*ft,r):null},f.at=hd,f.au=td,f.av=fd,f.aw=function(){const r={},t=Je.$version;for(const a in Je.$root){const h=Je.$root[a];if(h.required){let g=null;g=a==="version"?t:h.type==="array"?[]:{},g!=null&&(r[a]=g)}}return r},f.ax=yu,f.ay=oi,f.az=function(r){r=r.slice();const t=Object.create(null);for(let a=0;a<r.length;a++)t[r[a].id]=r[a];for(let a=0;a<r.length;a++)"ref"in r[a]&&(r[a]=dt(r[a],t[r[a].ref]));return r},f.b=ce,f.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},f.b1=function(r,t,a){return r[0]=t[0]*a[0],r[1]=t[1]*a[1],r[2]=t[2]*a[2],r[3]=t[3]*a[3],r},f.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},f.b3=$,f.b4=Pm,f.b5=Am,f.b6=function(r,t,a,h,g){var w,x=1/Math.tan(t/2);return r[0]=x/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,g!=null&&g!==1/0?(r[10]=(g+h)*(w=1/(h-g)),r[14]=2*g*h*w):(r[10]=-1,r[14]=-2*h),r},f.b7=function(r,t,a){var h=Math.sin(a),g=Math.cos(a),w=t[4],x=t[5],E=t[6],M=t[7],F=t[8],V=t[9],G=t[10],Q=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=w*g+F*h,r[5]=x*g+V*h,r[6]=E*g+G*h,r[7]=M*g+Q*h,r[8]=F*g-w*h,r[9]=V*g-x*h,r[10]=G*g-E*h,r[11]=Q*g-M*h,r},f.b8=Z,f.b9=ie,f.bA=nm,f.bB=function(r){return r.message===bt},f.bC=Cr,f.bD=Ur,f.ba=function(r){return r*Math.PI/180},f.bb=function(r,t){const{x:a,y:h}=Bu.fromLngLat(t);return!(r<0||r>25||h<0||h>=1||a<0||a>=1)},f.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},f.bd=class extends q{},f.be=ad,f.bf=jv,f.bh=Zt,f.bi=function(r,t){tt.REGISTERED_PROTOCOLS[r]=t},f.bj=function(r){delete tt.REGISTERED_PROTOCOLS[r]},f.bk=function(r,t){const a={};for(let g=0;g<r.length;g++){const w=t&&t[r[g].id]||D(r[g]);t&&(t[r[g].id]=w);let x=a[w];x||(x=a[w]=[]),x.push(r[g])}const h=[];for(const g in a)h.push(a[g]);return h},f.bl=Ut,f.bm=zm,f.bn=Dm,f.bo=fm,f.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Nn/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],a=t.layout,h=t._unevaluatedLayout._values,g={layoutIconSize:h["icon-size"].possiblyEvaluate(new mn(r.bucket.zoom+1),r.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new mn(r.bucket.zoom+1),r.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new mn(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:V}=r.bucket.textSizeData;g.compositeTextSizes=[h["text-size"].possiblyEvaluate(new mn(F),r.canonical),h["text-size"].possiblyEvaluate(new mn(V),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:V}=r.bucket.iconSizeData;g.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new mn(F),r.canonical),h["icon-size"].possiblyEvaluate(new mn(V),r.canonical)]}const w=a.get("text-line-height")*qn,x=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",E=a.get("text-keep-upright"),M=a.get("text-size");for(const F of r.bucket.features){const V=a.get("text-font").evaluate(F,{},r.canonical).join(","),G=M.evaluate(F,{},r.canonical),Q=g.layoutTextSize.evaluate(F,{},r.canonical),ne=g.layoutIconSize.evaluate(F,{},r.canonical),ue={horizontal:{},vertical:void 0},de=F.text;let ke,Me=[0,0];if(de){const Ke=de.toString(),at=a.get("text-letter-spacing").evaluate(F,{},r.canonical)*qn,wt=Ef(Ke)?at:0,Bt=a.get("text-anchor").evaluate(F,{},r.canonical),ci=Hm(t,F,r.canonical);if(!ci){const qt=a.get("text-radial-offset").evaluate(F,{},r.canonical);Me=qt?Gm(Bt,[qt*qn,ud]):a.get("text-offset").evaluate(F,{},r.canonical).map(jt=>jt*qn)}let Ft=x?"center":a.get("text-justify").evaluate(F,{},r.canonical);const Ot=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(F,{},r.canonical)*qn:1/0,Yt=()=>{r.bucket.allowVerticalPlacement&&bu(Ke)&&(ue.vertical=Rh(de,r.glyphMap,r.glyphPositions,r.imagePositions,V,Ot,w,Bt,"left",wt,Me,f.ah.vertical,!0,Q,G))};if(!x&&ci){const qt=new Set;if(Ft==="auto")for(let ft=0;ft<ci.values.length;ft+=2)qt.add(hd(ci.values[ft]));else qt.add(Ft);let jt=!1;for(const ft of qt)if(!ue.horizontal[ft])if(jt)ue.horizontal[ft]=ue.horizontal[0];else{const ei=Rh(de,r.glyphMap,r.glyphPositions,r.imagePositions,V,Ot,w,"center",ft,wt,Me,f.ah.horizontal,!1,Q,G);ei&&(ue.horizontal[ft]=ei,jt=ei.positionedLines.length===1)}Yt()}else{Ft==="auto"&&(Ft=hd(Bt));const qt=Rh(de,r.glyphMap,r.glyphPositions,r.imagePositions,V,Ot,w,Bt,Ft,wt,Me,f.ah.horizontal,!1,Q,G);qt&&(ue.horizontal[Ft]=qt),Yt(),bu(Ke)&&x&&E&&(ue.vertical=Rh(de,r.glyphMap,r.glyphPositions,r.imagePositions,V,Ot,w,Bt,Ft,wt,Me,f.ah.vertical,!1,Q,G))}}let Qe=!1;if(F.icon&&F.icon.name){const Ke=r.imageMap[F.icon.name];Ke&&(ke=xv(r.imagePositions[F.icon.name],a.get("icon-offset").evaluate(F,{},r.canonical),a.get("icon-anchor").evaluate(F,{},r.canonical)),Qe=!!Ke.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=Qe:r.bucket.sdfIcons!==Qe&&le("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==r.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const Ue=Km(ue.horizontal)||ue.vertical;r.bucket.iconsInText=!!Ue&&Ue.iconsInText,(Ue||ke)&&Bv(r.bucket,F,ue,ke,r.imageMap,g,Q,ne,Me,Qe,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},f.bq=Kf,f.br=Gf,f.bs=Xf,f.bt=Wa,f.bu=Yf,f.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},f.bw=function(r,t,a,h,g){return o(this,void 0,void 0,function*(){if(z())try{return yield ze(r,t,a,h,g)}catch{}return function(w,x,E,M,F){const V=w.width,G=w.height;ct&&nt||(ct=new OffscreenCanvas(V,G),nt=ct.getContext("2d",{willReadFrequently:!0})),ct.width=V,ct.height=G,nt.drawImage(w,0,0,V,G);const Q=nt.getImageData(x,E,M,F);return nt.clearRect(0,0,V,G),Q.data}(r,t,a,h,g)})},f.bx=Lm,f.by=_,f.bz=T,f.c=At,f.d=r=>o(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=re,f.f=r=>new Promise((t,a)=>{const h=new Image;h.onload=()=>{t(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=Le})},h.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(r)],{type:"image/png"});h.src=r.byteLength?URL.createObjectURL(g):Le}),f.g=vt,f.h=(r,t)=>Ai(re(r,{type:"json"}),t),f.i=pe,f.j=Pt,f.k=Ge,f.l=(r,t)=>Ai(re(r,{type:"arrayBuffer"}),t),f.m=Ai,f.n=function(r){return new Yf(r).readFields(mv,[])},f.o=Iu,f.p=hm,f.q=v,f.r=kf,f.s=Mi,f.t=gu,f.u=ra,f.v=Je,f.w=le,f.x=function([r,t,a]){return t+=90,t*=Math.PI/180,a*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(a),y:r*Math.sin(t)*Math.sin(a),z:r*Math.cos(a)}},f.y=Vn,f.z=mn}),u("worker",["./shared"],function(f){class o{constructor(ee){this.keyCache={},ee&&this.replace(ee)}replace(ee){this._layerConfigs={},this._layers={},this.update(ee,[])}update(ee,te){for(const Se of ee){this._layerConfigs[Se.id]=Se;const je=this._layers[Se.id]=f.aA(Se);je._featureFilter=f.a7(je.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(const Se of te)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const fe=f.bk(Object.values(this._layerConfigs),this.keyCache);for(const Se of fe){const je=Se.map(rt=>this._layers[rt.id]),Ze=je[0];if(Ze.visibility==="none")continue;const Ye=Ze.source||"";let Fe=this.familiesBySource[Ye];Fe||(Fe=this.familiesBySource[Ye]={});const ot=Ze.sourceLayer||"_geojsonTileLayer";let pt=Fe[ot];pt||(pt=Fe[ot]=[]),pt.push(je)}}}class _{constructor(ee){const te={},fe=[];for(const Ye in ee){const Fe=ee[Ye],ot=te[Ye]={};for(const pt in Fe){const rt=Fe[+pt];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Ct={x:0,y:0,w:rt.bitmap.width+2,h:rt.bitmap.height+2};fe.push(Ct),ot[pt]={rect:Ct,metrics:rt.metrics}}}const{w:Se,h:je}=f.p(fe),Ze=new f.o({width:Se||1,height:je||1});for(const Ye in ee){const Fe=ee[Ye];for(const ot in Fe){const pt=Fe[+ot];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const rt=te[Ye][ot].rect;f.o.copy(pt.bitmap,Ze,{x:0,y:0},{x:rt.x+1,y:rt.y+1},pt.bitmap)}}this.image=Ze,this.positions=te}}f.bl("GlyphAtlas",_);class T{constructor(ee){this.tileID=new f.S(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId,this.inFlightDependencies=[]}parse(ee,te,fe,Se){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=ee,this.collisionBoxArray=new f.a5;const je=new f.bm(Object.keys(ee.layers).sort()),Ze=new f.bn(this.tileID,this.promoteId);Ze.bucketLayerIDs=[];const Ye={},Fe={featureIndex:Ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe},ot=te.familiesBySource[this.source];for(const He in ot){const hi=ee.layers[He];if(!hi)continue;hi.version===1&&f.w(`Vector tile source "${this.source}" layer "${He}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wi=je.encode(He),Bi=[];for(let Gi=0;Gi<hi.length;Gi++){const Hi=hi.feature(Gi),jn=Ze.getId(Hi,He);Bi.push({feature:Hi,id:jn,index:Gi,sourceLayerIndex:wi})}for(const Gi of ot[He]){const Hi=Gi[0];Hi.source!==this.source&&f.w(`layer.source = ${Hi.source} does not equal this.source = ${this.source}`),Hi.minzoom&&this.zoom<Math.floor(Hi.minzoom)||Hi.maxzoom&&this.zoom>=Hi.maxzoom||Hi.visibility!=="none"&&(S(Gi,this.zoom,fe),(Ye[Hi.id]=Hi.createBucket({index:Ze.bucketLayerIDs.length,layers:Gi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wi,sourceID:this.source})).populate(Bi,Fe,this.tileID.canonical),Ze.bucketLayerIDs.push(Gi.map(jn=>jn.id)))}}const pt=f.aF(Fe.glyphDependencies,He=>Object.keys(He).map(Number));this.inFlightDependencies.forEach(He=>He==null?void 0:He.abort()),this.inFlightDependencies=[];let rt=Promise.resolve({});if(Object.keys(pt).length){const He=new AbortController;this.inFlightDependencies.push(He),rt=Se.sendAsync({type:"GG",data:{stacks:pt,source:this.source,tileID:this.tileID,type:"glyphs"}},He)}const Ct=Object.keys(Fe.iconDependencies);let Xt=Promise.resolve({});if(Ct.length){const He=new AbortController;this.inFlightDependencies.push(He),Xt=Se.sendAsync({type:"GI",data:{icons:Ct,source:this.source,tileID:this.tileID,type:"icons"}},He)}const ni=Object.keys(Fe.patternDependencies);let Ri=Promise.resolve({});if(ni.length){const He=new AbortController;this.inFlightDependencies.push(He),Ri=Se.sendAsync({type:"GI",data:{icons:ni,source:this.source,tileID:this.tileID,type:"patterns"}},He)}const[bi,zi,xi]=yield Promise.all([rt,Xt,Ri]),un=new _(bi),hn=new f.bo(zi,xi);for(const He in Ye){const hi=Ye[He];hi instanceof f.a6?(S(hi.layers,this.zoom,fe),f.bp({bucket:hi,glyphMap:bi,glyphPositions:un.positions,imageMap:zi,imagePositions:hn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):hi.hasPattern&&(hi instanceof f.bq||hi instanceof f.br||hi instanceof f.bs)&&(S(hi.layers,this.zoom,fe),hi.addFeatures(Fe,this.tileID.canonical,hn.patternPositions))}return this.status="done",{buckets:Object.values(Ye).filter(He=>!He.isEmpty()),featureIndex:Ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:un.image,imageAtlas:hn,glyphMap:this.returnDependencies?bi:null,iconMap:this.returnDependencies?zi:null,glyphPositions:this.returnDependencies?un.positions:null}})}}function S(Ie,ee,te){const fe=new f.z(ee);for(const Se of Ie)Se.recalculate(fe,te)}class y{constructor(ee,te,fe){this.actor=ee,this.layerIndex=te,this.availableImages=fe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ee,te){return f._(this,void 0,void 0,function*(){const fe=yield f.l(ee.request,te);try{return{vectorTile:new f.bt.VectorTile(new f.bu(fe.data)),rawData:fe.data,cacheControl:fe.cacheControl,expires:fe.expires}}catch(Se){const je=new Uint8Array(fe.data);let Ze=`Unable to parse the tile at ${ee.request.url}, `;throw Ze+=je[0]===31&&je[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(Ze)}})}loadTile(ee){return f._(this,void 0,void 0,function*(){const te=ee.uid,fe=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new f.bv(ee.request),Se=new T(ee);this.loading[te]=Se;const je=new AbortController;Se.abort=je;try{const Ze=yield this.loadVectorTile(ee,je);if(delete this.loading[te],!Ze)return null;const Ye=Ze.rawData,Fe={};Ze.expires&&(Fe.expires=Ze.expires),Ze.cacheControl&&(Fe.cacheControl=Ze.cacheControl);const ot={};if(fe){const rt=fe.finish();rt&&(ot.resourceTiming=JSON.parse(JSON.stringify(rt)))}Se.vectorTile=Ze.vectorTile;const pt=Se.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[te]=Se,this.fetching[te]={rawTileData:Ye,cacheControl:Fe,resourceTiming:ot};try{const rt=yield pt;return f.e({rawTileData:Ye.slice(0)},rt,Fe,ot)}finally{delete this.fetching[te]}}catch(Ze){throw delete this.loading[te],Se.status="done",this.loaded[te]=Se,Ze}})}reloadTile(ee){return f._(this,void 0,void 0,function*(){const te=ee.uid;if(!this.loaded||!this.loaded[te])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const fe=this.loaded[te];if(fe.showCollisionBoxes=ee.showCollisionBoxes,fe.status==="parsing"){const Se=yield fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor);let je;if(this.fetching[te]){const{rawTileData:Ze,cacheControl:Ye,resourceTiming:Fe}=this.fetching[te];delete this.fetching[te],je=f.e({rawTileData:Ze.slice(0)},Se,Ye,Fe)}else je=Se;return je}if(fe.status==="done"&&fe.vectorTile)return fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ee){return f._(this,void 0,void 0,function*(){const te=this.loading,fe=ee.uid;te&&te[fe]&&te[fe].abort&&(te[fe].abort.abort(),delete te[fe])})}removeTile(ee){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ee.uid]&&delete this.loaded[ee.uid]})}}class k{constructor(){this.loaded={}}loadTile(ee){return f._(this,void 0,void 0,function*(){const{uid:te,encoding:fe,rawImageData:Se,redFactor:je,greenFactor:Ze,blueFactor:Ye,baseShift:Fe}=ee,ot=Se.width+2,pt=Se.height+2,rt=f.b(Se)?new f.R({width:ot,height:pt},yield f.bw(Se,-1,-1,ot,pt)):Se,Ct=new f.bx(te,rt,fe,je,Ze,Ye,Fe);return this.loaded=this.loaded||{},this.loaded[te]=Ct,Ct})}removeTile(ee){const te=this.loaded,fe=ee.uid;te&&te[fe]&&delete te[fe]}}function I(Ie,ee){if(Ie.length!==0){C(Ie[0],ee);for(var te=1;te<Ie.length;te++)C(Ie[te],!ee)}}function C(Ie,ee){for(var te=0,fe=0,Se=0,je=Ie.length,Ze=je-1;Se<je;Ze=Se++){var Ye=(Ie[Se][0]-Ie[Ze][0])*(Ie[Ze][1]+Ie[Se][1]),Fe=te+Ye;fe+=Math.abs(te)>=Math.abs(Ye)?te-Fe+Ye:Ye-Fe+te,te=Fe}te+fe>=0!=!!ee&&Ie.reverse()}var L=f.by(function Ie(ee,te){var fe,Se=ee&&ee.type;if(Se==="FeatureCollection")for(fe=0;fe<ee.features.length;fe++)Ie(ee.features[fe],te);else if(Se==="GeometryCollection")for(fe=0;fe<ee.geometries.length;fe++)Ie(ee.geometries[fe],te);else if(Se==="Feature")Ie(ee.geometry,te);else if(Se==="Polygon")I(ee.coordinates,te);else if(Se==="MultiPolygon")for(fe=0;fe<ee.coordinates.length;fe++)I(ee.coordinates[fe],te);return ee});const N=f.bt.VectorTileFeature.prototype.toGeoJSON;var R={exports:{}},z=f.bz,Z=f.bt.VectorTileFeature,ie=ae;function ae(Ie,ee){this.options=ee||{},this.features=Ie,this.length=Ie.length}function $(Ie,ee){this.id=typeof Ie.id=="number"?Ie.id:void 0,this.type=Ie.type,this.rawGeometry=Ie.type===1?[Ie.geometry]:Ie.geometry,this.properties=Ie.tags,this.extent=ee||4096}ae.prototype.feature=function(Ie){return new $(this.features[Ie],this.options.extent)},$.prototype.loadGeometry=function(){var Ie=this.rawGeometry;this.geometry=[];for(var ee=0;ee<Ie.length;ee++){for(var te=Ie[ee],fe=[],Se=0;Se<te.length;Se++)fe.push(new z(te[Se][0],te[Se][1]));this.geometry.push(fe)}return this.geometry},$.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ie=this.geometry,ee=1/0,te=-1/0,fe=1/0,Se=-1/0,je=0;je<Ie.length;je++)for(var Ze=Ie[je],Ye=0;Ye<Ze.length;Ye++){var Fe=Ze[Ye];ee=Math.min(ee,Fe.x),te=Math.max(te,Fe.x),fe=Math.min(fe,Fe.y),Se=Math.max(Se,Fe.y)}return[ee,fe,te,Se]},$.prototype.toGeoJSON=Z.prototype.toGeoJSON;var re=f.bA,j=ie;function U(Ie){var ee=new re;return function(te,fe){for(var Se in te.layers)fe.writeMessage(3,J,te.layers[Se])}(Ie,ee),ee.finish()}function J(Ie,ee){var te;ee.writeVarintField(15,Ie.version||1),ee.writeStringField(1,Ie.name||""),ee.writeVarintField(5,Ie.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<Ie.length;te++)fe.feature=Ie.feature(te),ee.writeMessage(2,B,fe);var Se=fe.keys;for(te=0;te<Se.length;te++)ee.writeStringField(3,Se[te]);var je=fe.values;for(te=0;te<je.length;te++)ee.writeMessage(4,_e,je[te])}function B(Ie,ee){var te=Ie.feature;te.id!==void 0&&ee.writeVarintField(1,te.id),ee.writeMessage(2,W,Ie),ee.writeVarintField(3,te.type),ee.writeMessage(4,pe,te)}function W(Ie,ee){var te=Ie.feature,fe=Ie.keys,Se=Ie.values,je=Ie.keycache,Ze=Ie.valuecache;for(var Ye in te.properties){var Fe=te.properties[Ye],ot=je[Ye];if(Fe!==null){ot===void 0&&(fe.push(Ye),je[Ye]=ot=fe.length-1),ee.writeVarint(ot);var pt=typeof Fe;pt!=="string"&&pt!=="boolean"&&pt!=="number"&&(Fe=JSON.stringify(Fe));var rt=pt+":"+Fe,Ct=Ze[rt];Ct===void 0&&(Se.push(Fe),Ze[rt]=Ct=Se.length-1),ee.writeVarint(Ct)}}}function le(Ie,ee){return(ee<<3)+(7&Ie)}function ge(Ie){return Ie<<1^Ie>>31}function pe(Ie,ee){for(var te=Ie.loadGeometry(),fe=Ie.type,Se=0,je=0,Ze=te.length,Ye=0;Ye<Ze;Ye++){var Fe=te[Ye],ot=1;fe===1&&(ot=Fe.length),ee.writeVarint(le(1,ot));for(var pt=fe===3?Fe.length-1:Fe.length,rt=0;rt<pt;rt++){rt===1&&fe!==1&&ee.writeVarint(le(2,pt-1));var Ct=Fe[rt].x-Se,Xt=Fe[rt].y-je;ee.writeVarint(ge(Ct)),ee.writeVarint(ge(Xt)),Se+=Ct,je+=Xt}fe===3&&ee.writeVarint(le(7,1))}}function _e(Ie,ee){var te=typeof Ie;te==="string"?ee.writeStringField(1,Ie):te==="boolean"?ee.writeBooleanField(7,Ie):te==="number"&&(Ie%1!=0?ee.writeDoubleField(3,Ie):Ie<0?ee.writeSVarintField(6,Ie):ee.writeVarintField(5,Ie))}R.exports=U,R.exports.fromVectorTileJs=U,R.exports.fromGeojsonVt=function(Ie,ee){ee=ee||{};var te={};for(var fe in Ie)te[fe]=new j(Ie[fe].features,ee),te[fe].name=fe,te[fe].version=ee.version,te[fe].extent=ee.extent;return U({layers:te})},R.exports.GeoJSONWrapper=j;var ce=f.by(R.exports);const Le={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ie=>Ie},ze=Math.fround||(ct=new Float32Array(1),Ie=>(ct[0]=+Ie,ct[0]));var ct;const nt=3,bt=5,At=6;class tt{constructor(ee){this.options=Object.assign(Object.create(Le),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:te,minZoom:fe,maxZoom:Se}=this.options;te&&console.time("total time");const je=`prepare ${ee.length} points`;te&&console.time(je),this.points=ee;const Ze=[];for(let Fe=0;Fe<ee.length;Fe++){const ot=ee[Fe];if(!ot.geometry)continue;const[pt,rt]=ot.geometry.coordinates,Ct=ze(Zt(pt)),Xt=ze(oi(rt));Ze.push(Ct,Xt,1/0,Fe,-1,1),this.options.reduce&&Ze.push(0)}let Ye=this.trees[Se+1]=this._createTree(Ze);te&&console.timeEnd(je);for(let Fe=Se;Fe>=fe;Fe--){const ot=+Date.now();Ye=this.trees[Fe]=this._createTree(this._cluster(Ye,Fe)),te&&console.log("z%d: %d clusters in %dms",Fe,Ye.numItems,+Date.now()-ot)}return te&&console.timeEnd("total time"),this}getClusters(ee,te){let fe=((ee[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,ee[1]));let je=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)fe=-180,je=180;else if(fe>je){const rt=this.getClusters([fe,Se,180,Ze],te),Ct=this.getClusters([-180,Se,je,Ze],te);return rt.concat(Ct)}const Ye=this.trees[this._limitZoom(te)],Fe=Ye.range(Zt(fe),oi(Ze),Zt(je),oi(Se)),ot=Ye.data,pt=[];for(const rt of Fe){const Ct=this.stride*rt;pt.push(ot[Ct+bt]>1?vt(ot,Ct,this.clusterProps):this.points[ot[Ct+nt]])}return pt}getChildren(ee){const te=this._getOriginId(ee),fe=this._getOriginZoom(ee),Se="No cluster with the specified id.",je=this.trees[fe];if(!je)throw new Error(Se);const Ze=je.data;if(te*this.stride>=Ze.length)throw new Error(Se);const Ye=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Fe=je.within(Ze[te*this.stride],Ze[te*this.stride+1],Ye),ot=[];for(const pt of Fe){const rt=pt*this.stride;Ze[rt+4]===ee&&ot.push(Ze[rt+bt]>1?vt(Ze,rt,this.clusterProps):this.points[Ze[rt+nt]])}if(ot.length===0)throw new Error(Se);return ot}getLeaves(ee,te,fe){const Se=[];return this._appendLeaves(Se,ee,te=te||10,fe=fe||0,0),Se}getTile(ee,te,fe){const Se=this.trees[this._limitZoom(ee)],je=Math.pow(2,ee),{extent:Ze,radius:Ye}=this.options,Fe=Ye/Ze,ot=(fe-Fe)/je,pt=(fe+1+Fe)/je,rt={features:[]};return this._addTileFeatures(Se.range((te-Fe)/je,ot,(te+1+Fe)/je,pt),Se.data,te,fe,je,rt),te===0&&this._addTileFeatures(Se.range(1-Fe/je,ot,1,pt),Se.data,je,fe,je,rt),te===je-1&&this._addTileFeatures(Se.range(0,ot,Fe/je,pt),Se.data,-1,fe,je,rt),rt.features.length?rt:null}getClusterExpansionZoom(ee){let te=this._getOriginZoom(ee)-1;for(;te<=this.options.maxZoom;){const fe=this.getChildren(ee);if(te++,fe.length!==1)break;ee=fe[0].properties.cluster_id}return te}_appendLeaves(ee,te,fe,Se,je){const Ze=this.getChildren(te);for(const Ye of Ze){const Fe=Ye.properties;if(Fe&&Fe.cluster?je+Fe.point_count<=Se?je+=Fe.point_count:je=this._appendLeaves(ee,Fe.cluster_id,fe,Se,je):je<Se?je++:ee.push(Ye),ee.length===fe)break}return je}_createTree(ee){const te=new f.av(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<ee.length;fe+=this.stride)te.add(ee[fe],ee[fe+1]);return te.finish(),te.data=ee,te}_addTileFeatures(ee,te,fe,Se,je,Ze){for(const Ye of ee){const Fe=Ye*this.stride,ot=te[Fe+bt]>1;let pt,rt,Ct;if(ot)pt=St(te,Fe,this.clusterProps),rt=te[Fe],Ct=te[Fe+1];else{const Ri=this.points[te[Fe+nt]];pt=Ri.properties;const[bi,zi]=Ri.geometry.coordinates;rt=Zt(bi),Ct=oi(zi)}const Xt={type:1,geometry:[[Math.round(this.options.extent*(rt*je-fe)),Math.round(this.options.extent*(Ct*je-Se))]],tags:pt};let ni;ni=ot||this.options.generateId?te[Fe+nt]:this.points[te[Fe+nt]].id,ni!==void 0&&(Xt.id=ni),Ze.features.push(Xt)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,te){const{radius:fe,extent:Se,reduce:je,minPoints:Ze}=this.options,Ye=fe/(Se*Math.pow(2,te)),Fe=ee.data,ot=[],pt=this.stride;for(let rt=0;rt<Fe.length;rt+=pt){if(Fe[rt+2]<=te)continue;Fe[rt+2]=te;const Ct=Fe[rt],Xt=Fe[rt+1],ni=ee.within(Fe[rt],Fe[rt+1],Ye),Ri=Fe[rt+bt];let bi=Ri;for(const zi of ni){const xi=zi*pt;Fe[xi+2]>te&&(bi+=Fe[xi+bt])}if(bi>Ri&&bi>=Ze){let zi,xi=Ct*Ri,un=Xt*Ri,hn=-1;const He=((rt/pt|0)<<5)+(te+1)+this.points.length;for(const hi of ni){const wi=hi*pt;if(Fe[wi+2]<=te)continue;Fe[wi+2]=te;const Bi=Fe[wi+bt];xi+=Fe[wi]*Bi,un+=Fe[wi+1]*Bi,Fe[wi+4]=He,je&&(zi||(zi=this._map(Fe,rt,!0),hn=this.clusterProps.length,this.clusterProps.push(zi)),je(zi,this._map(Fe,wi)))}Fe[rt+4]=He,ot.push(xi/bi,un/bi,1/0,He,-1,bi),je&&ot.push(hn)}else{for(let zi=0;zi<pt;zi++)ot.push(Fe[rt+zi]);if(bi>1)for(const zi of ni){const xi=zi*pt;if(!(Fe[xi+2]<=te)){Fe[xi+2]=te;for(let un=0;un<pt;un++)ot.push(Fe[xi+un])}}}}return ot}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,te,fe){if(ee[te+bt]>1){const Ze=this.clusterProps[ee[te+At]];return fe?Object.assign({},Ze):Ze}const Se=this.points[ee[te+nt]].properties,je=this.options.map(Se);return fe&&je===Se?Object.assign({},je):je}}function vt(Ie,ee,te){return{type:"Feature",id:Ie[ee+nt],properties:St(Ie,ee,te),geometry:{type:"Point",coordinates:[(fe=Ie[ee],360*(fe-.5)),Ai(Ie[ee+1])]}};var fe}function St(Ie,ee,te){const fe=Ie[ee+bt],Se=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,je=Ie[ee+At],Ze=je===-1?{}:Object.assign({},te[je]);return Object.assign(Ze,{cluster:!0,cluster_id:Ie[ee+nt],point_count:fe,point_count_abbreviated:Se})}function Zt(Ie){return Ie/360+.5}function oi(Ie){const ee=Math.sin(Ie*Math.PI/180),te=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return te<0?0:te>1?1:te}function Ai(Ie){const ee=(180-360*Ie)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function Mi(Ie,ee,te,fe){let Se=fe;const je=ee+(te-ee>>1);let Ze,Ye=te-ee;const Fe=Ie[ee],ot=Ie[ee+1],pt=Ie[te],rt=Ie[te+1];for(let Ct=ee+3;Ct<te;Ct+=3){const Xt=Ti(Ie[Ct],Ie[Ct+1],Fe,ot,pt,rt);if(Xt>Se)Ze=Ct,Se=Xt;else if(Xt===Se){const ni=Math.abs(Ct-je);ni<Ye&&(Ze=Ct,Ye=ni)}}Se>fe&&(Ze-ee>3&&Mi(Ie,ee,Ze,fe),Ie[Ze+2]=Se,te-Ze>3&&Mi(Ie,Ze,te,fe))}function Ti(Ie,ee,te,fe,Se,je){let Ze=Se-te,Ye=je-fe;if(Ze!==0||Ye!==0){const Fe=((Ie-te)*Ze+(ee-fe)*Ye)/(Ze*Ze+Ye*Ye);Fe>1?(te=Se,fe=je):Fe>0&&(te+=Ze*Fe,fe+=Ye*Fe)}return Ze=Ie-te,Ye=ee-fe,Ze*Ze+Ye*Ye}function It(Ie,ee,te,fe){const Se={id:Ie??null,type:ee,geometry:te,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Ge(Se,te);else if(ee==="Polygon")Ge(Se,te[0]);else if(ee==="MultiLineString")for(const je of te)Ge(Se,je);else if(ee==="MultiPolygon")for(const je of te)Ge(Se,je[0]);return Se}function Ge(Ie,ee){for(let te=0;te<ee.length;te+=3)Ie.minX=Math.min(Ie.minX,ee[te]),Ie.minY=Math.min(Ie.minY,ee[te+1]),Ie.maxX=Math.max(Ie.maxX,ee[te]),Ie.maxY=Math.max(Ie.maxY,ee[te+1])}function Pt(Ie,ee,te,fe){if(!ee.geometry)return;const Se=ee.geometry.coordinates;if(Se&&Se.length===0)return;const je=ee.geometry.type,Ze=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2);let Ye=[],Fe=ee.id;if(te.promoteId?Fe=ee.properties[te.promoteId]:te.generateId&&(Fe=fe||0),je==="Point")ii(Se,Ye);else if(je==="MultiPoint")for(const ot of Se)ii(ot,Ye);else if(je==="LineString")Je(Se,Ye,Ze,!1);else if(je==="MultiLineString"){if(te.lineMetrics){for(const ot of Se)Ye=[],Je(ot,Ye,Ze,!1),Ie.push(It(Fe,"LineString",Ye,ee.properties));return}gi(Se,Ye,Ze,!1)}else if(je==="Polygon")gi(Se,Ye,Ze,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(const ot of ee.geometry.geometries)Pt(Ie,{id:Fe,geometry:ot,properties:ee.properties},te,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ot of Se){const pt=[];gi(ot,pt,Ze,!0),Ye.push(pt)}}Ie.push(It(Fe,je,Ye,ee.properties))}function ii(Ie,ee){ee.push(dt(Ie[0]),et(Ie[1]),0)}function Je(Ie,ee,te,fe){let Se,je,Ze=0;for(let Fe=0;Fe<Ie.length;Fe++){const ot=dt(Ie[Fe][0]),pt=et(Ie[Fe][1]);ee.push(ot,pt,0),Fe>0&&(Ze+=fe?(Se*pt-ot*je)/2:Math.sqrt(Math.pow(ot-Se,2)+Math.pow(pt-je,2))),Se=ot,je=pt}const Ye=ee.length-3;ee[2]=1,Mi(ee,0,Ye,te),ee[Ye+2]=1,ee.size=Math.abs(Ze),ee.start=0,ee.end=ee.size}function gi(Ie,ee,te,fe){for(let Se=0;Se<Ie.length;Se++){const je=[];Je(Ie[Se],je,te,fe),ee.push(je)}}function dt(Ie){return Ie/360+.5}function et(Ie){const ee=Math.sin(Ie*Math.PI/180),te=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return te<0?0:te>1?1:te}function he(Ie,ee,te,fe,Se,je,Ze,Ye){if(fe/=ee,je>=(te/=ee)&&Ze<fe)return Ie;if(Ze<te||je>=fe)return null;const Fe=[];for(const ot of Ie){const pt=ot.geometry;let rt=ot.type;const Ct=Se===0?ot.minX:ot.minY,Xt=Se===0?ot.maxX:ot.maxY;if(Ct>=te&&Xt<fe){Fe.push(ot);continue}if(Xt<te||Ct>=fe)continue;let ni=[];if(rt==="Point"||rt==="MultiPoint")H(pt,ni,te,fe,Se);else if(rt==="LineString")Y(pt,ni,te,fe,Se,!1,Ye.lineMetrics);else if(rt==="MultiLineString")qe(pt,ni,te,fe,Se,!1);else if(rt==="Polygon")qe(pt,ni,te,fe,Se,!0);else if(rt==="MultiPolygon")for(const Ri of pt){const bi=[];qe(Ri,bi,te,fe,Se,!0),bi.length&&ni.push(bi)}if(ni.length){if(Ye.lineMetrics&&rt==="LineString"){for(const Ri of ni)Fe.push(It(ot.id,rt,Ri,ot.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(ni.length===1?(rt="LineString",ni=ni[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=ni.length===3?"Point":"MultiPoint"),Fe.push(It(ot.id,rt,ni,ot.tags))}}return Fe.length?Fe:null}function H(Ie,ee,te,fe,Se){for(let je=0;je<Ie.length;je+=3){const Ze=Ie[je+Se];Ze>=te&&Ze<=fe&&ut(ee,Ie[je],Ie[je+1],Ie[je+2])}}function Y(Ie,ee,te,fe,Se,je,Ze){let Ye=Ee(Ie);const Fe=Se===0?st:ki;let ot,pt,rt=Ie.start;for(let bi=0;bi<Ie.length-3;bi+=3){const zi=Ie[bi],xi=Ie[bi+1],un=Ie[bi+2],hn=Ie[bi+3],He=Ie[bi+4],hi=Se===0?zi:xi,wi=Se===0?hn:He;let Bi=!1;Ze&&(ot=Math.sqrt(Math.pow(zi-hn,2)+Math.pow(xi-He,2))),hi<te?wi>te&&(pt=Fe(Ye,zi,xi,hn,He,te),Ze&&(Ye.start=rt+ot*pt)):hi>fe?wi<fe&&(pt=Fe(Ye,zi,xi,hn,He,fe),Ze&&(Ye.start=rt+ot*pt)):ut(Ye,zi,xi,un),wi<te&&hi>=te&&(pt=Fe(Ye,zi,xi,hn,He,te),Bi=!0),wi>fe&&hi<=fe&&(pt=Fe(Ye,zi,xi,hn,He,fe),Bi=!0),!je&&Bi&&(Ze&&(Ye.end=rt+ot*pt),ee.push(Ye),Ye=Ee(Ie)),Ze&&(rt+=ot)}let Ct=Ie.length-3;const Xt=Ie[Ct],ni=Ie[Ct+1],Ri=Se===0?Xt:ni;Ri>=te&&Ri<=fe&&ut(Ye,Xt,ni,Ie[Ct+2]),Ct=Ye.length-3,je&&Ct>=3&&(Ye[Ct]!==Ye[0]||Ye[Ct+1]!==Ye[1])&&ut(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&ee.push(Ye)}function Ee(Ie){const ee=[];return ee.size=Ie.size,ee.start=Ie.start,ee.end=Ie.end,ee}function qe(Ie,ee,te,fe,Se,je){for(const Ze of Ie)Y(Ze,ee,te,fe,Se,je,!1)}function ut(Ie,ee,te,fe){Ie.push(ee,te,fe)}function st(Ie,ee,te,fe,Se,je){const Ze=(je-ee)/(fe-ee);return ut(Ie,je,te+(Se-te)*Ze,1),Ze}function ki(Ie,ee,te,fe,Se,je){const Ze=(je-te)/(Se-te);return ut(Ie,ee+(fe-ee)*Ze,je,1),Ze}function lt(Ie,ee){const te=[];for(let fe=0;fe<Ie.length;fe++){const Se=Ie[fe],je=Se.type;let Ze;if(je==="Point"||je==="MultiPoint"||je==="LineString")Ze=Vt(Se.geometry,ee);else if(je==="MultiLineString"||je==="Polygon"){Ze=[];for(const Ye of Se.geometry)Ze.push(Vt(Ye,ee))}else if(je==="MultiPolygon"){Ze=[];for(const Ye of Se.geometry){const Fe=[];for(const ot of Ye)Fe.push(Vt(ot,ee));Ze.push(Fe)}}te.push(It(Se.id,je,Ze,Se.tags))}return te}function Vt(Ie,ee){const te=[];te.size=Ie.size,Ie.start!==void 0&&(te.start=Ie.start,te.end=Ie.end);for(let fe=0;fe<Ie.length;fe+=3)te.push(Ie[fe]+ee,Ie[fe+1],Ie[fe+2]);return te}function Ci(Ie,ee){if(Ie.transformed)return Ie;const te=1<<Ie.z,fe=Ie.x,Se=Ie.y;for(const je of Ie.features){const Ze=je.geometry,Ye=je.type;if(je.geometry=[],Ye===1)for(let Fe=0;Fe<Ze.length;Fe+=2)je.geometry.push(Fi(Ze[Fe],Ze[Fe+1],ee,te,fe,Se));else for(let Fe=0;Fe<Ze.length;Fe++){const ot=[];for(let pt=0;pt<Ze[Fe].length;pt+=2)ot.push(Fi(Ze[Fe][pt],Ze[Fe][pt+1],ee,te,fe,Se));je.geometry.push(ot)}}return Ie.transformed=!0,Ie}function Fi(Ie,ee,te,fe,Se,je){return[Math.round(te*(Ie*fe-Se)),Math.round(te*(ee*fe-je))]}function Cn(Ie,ee,te,fe,Se){const je=ee===Se.maxZoom?0:Se.tolerance/((1<<ee)*Se.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:Ie.length,source:null,x:te,y:fe,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Ie)xt(Ze,Ye,je,Se);return Ze}function xt(Ie,ee,te,fe){const Se=ee.geometry,je=ee.type,Ze=[];if(Ie.minX=Math.min(Ie.minX,ee.minX),Ie.minY=Math.min(Ie.minY,ee.minY),Ie.maxX=Math.max(Ie.maxX,ee.maxX),Ie.maxY=Math.max(Ie.maxY,ee.maxY),je==="Point"||je==="MultiPoint")for(let Ye=0;Ye<Se.length;Ye+=3)Ze.push(Se[Ye],Se[Ye+1]),Ie.numPoints++,Ie.numSimplified++;else if(je==="LineString")li(Ze,Se,Ie,te,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(let Ye=0;Ye<Se.length;Ye++)li(Ze,Se[Ye],Ie,te,je==="Polygon",Ye===0);else if(je==="MultiPolygon")for(let Ye=0;Ye<Se.length;Ye++){const Fe=Se[Ye];for(let ot=0;ot<Fe.length;ot++)li(Ze,Fe[ot],Ie,te,!0,ot===0)}if(Ze.length){let Ye=ee.tags||null;if(je==="LineString"&&fe.lineMetrics){Ye={};for(const ot in ee.tags)Ye[ot]=ee.tags[ot];Ye.mapbox_clip_start=Se.start/Se.size,Ye.mapbox_clip_end=Se.end/Se.size}const Fe={geometry:Ze,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:Ye};ee.id!==null&&(Fe.id=ee.id),Ie.features.push(Fe)}}function li(Ie,ee,te,fe,Se,je){const Ze=fe*fe;if(fe>0&&ee.size<(Se?Ze:fe))return void(te.numPoints+=ee.length/3);const Ye=[];for(let Fe=0;Fe<ee.length;Fe+=3)(fe===0||ee[Fe+2]>Ze)&&(te.numSimplified++,Ye.push(ee[Fe],ee[Fe+1])),te.numPoints++;Se&&function(Fe,ot){let pt=0;for(let rt=0,Ct=Fe.length,Xt=Ct-2;rt<Ct;Xt=rt,rt+=2)pt+=(Fe[rt]-Fe[Xt])*(Fe[rt+1]+Fe[Xt+1]);if(pt>0===ot)for(let rt=0,Ct=Fe.length;rt<Ct/2;rt+=2){const Xt=Fe[rt],ni=Fe[rt+1];Fe[rt]=Fe[Ct-2-rt],Fe[rt+1]=Fe[Ct-1-rt],Fe[Ct-2-rt]=Xt,Fe[Ct-1-rt]=ni}}(Ye,je),Ie.push(Ye)}const ti={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class tn{constructor(ee,te){const fe=(te=this.options=function(je,Ze){for(const Ye in Ze)je[Ye]=Ze[Ye];return je}(Object.create(ti),te)).debug;if(fe&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=function(je,Ze){const Ye=[];if(je.type==="FeatureCollection")for(let Fe=0;Fe<je.features.length;Fe++)Pt(Ye,je.features[Fe],Ze,Fe);else Pt(Ye,je.type==="Feature"?je:{geometry:je},Ze);return Ye}(ee,te);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=function(je,Ze){const Ye=Ze.buffer/Ze.extent;let Fe=je;const ot=he(je,1,-1-Ye,Ye,0,-1,2,Ze),pt=he(je,1,1-Ye,2+Ye,0,-1,2,Ze);return(ot||pt)&&(Fe=he(je,1,-Ye,1+Ye,0,-1,2,Ze)||[],ot&&(Fe=lt(ot,1).concat(Fe)),pt&&(Fe=Fe.concat(lt(pt,-1)))),Fe}(Se,te),Se.length&&this.splitTile(Se,0,0,0),fe&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,te,fe,Se,je,Ze,Ye){const Fe=[ee,te,fe,Se],ot=this.options,pt=ot.debug;for(;Fe.length;){Se=Fe.pop(),fe=Fe.pop(),te=Fe.pop(),ee=Fe.pop();const rt=1<<te,Ct=hr(te,fe,Se);let Xt=this.tiles[Ct];if(!Xt&&(pt>1&&console.time("creation"),Xt=this.tiles[Ct]=Cn(ee,te,fe,Se,ot),this.tileCoords.push({z:te,x:fe,y:Se}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,fe,Se,Xt.numFeatures,Xt.numPoints,Xt.numSimplified),console.timeEnd("creation"));const Bi=`z${te}`;this.stats[Bi]=(this.stats[Bi]||0)+1,this.total++}if(Xt.source=ee,je==null){if(te===ot.indexMaxZoom||Xt.numPoints<=ot.indexMaxPoints)continue}else{if(te===ot.maxZoom||te===je)continue;if(je!=null){const Bi=je-te;if(fe!==Ze>>Bi||Se!==Ye>>Bi)continue}}if(Xt.source=null,ee.length===0)continue;pt>1&&console.time("clipping");const ni=.5*ot.buffer/ot.extent,Ri=.5-ni,bi=.5+ni,zi=1+ni;let xi=null,un=null,hn=null,He=null,hi=he(ee,rt,fe-ni,fe+bi,0,Xt.minX,Xt.maxX,ot),wi=he(ee,rt,fe+Ri,fe+zi,0,Xt.minX,Xt.maxX,ot);ee=null,hi&&(xi=he(hi,rt,Se-ni,Se+bi,1,Xt.minY,Xt.maxY,ot),un=he(hi,rt,Se+Ri,Se+zi,1,Xt.minY,Xt.maxY,ot),hi=null),wi&&(hn=he(wi,rt,Se-ni,Se+bi,1,Xt.minY,Xt.maxY,ot),He=he(wi,rt,Se+Ri,Se+zi,1,Xt.minY,Xt.maxY,ot),wi=null),pt>1&&console.timeEnd("clipping"),Fe.push(xi||[],te+1,2*fe,2*Se),Fe.push(un||[],te+1,2*fe,2*Se+1),Fe.push(hn||[],te+1,2*fe+1,2*Se),Fe.push(He||[],te+1,2*fe+1,2*Se+1)}}getTile(ee,te,fe){ee=+ee,te=+te,fe=+fe;const Se=this.options,{extent:je,debug:Ze}=Se;if(ee<0||ee>24)return null;const Ye=1<<ee,Fe=hr(ee,te=te+Ye&Ye-1,fe);if(this.tiles[Fe])return Ci(this.tiles[Fe],je);Ze>1&&console.log("drilling down to z%d-%d-%d",ee,te,fe);let ot,pt=ee,rt=te,Ct=fe;for(;!ot&&pt>0;)pt--,rt>>=1,Ct>>=1,ot=this.tiles[hr(pt,rt,Ct)];return ot&&ot.source?(Ze>1&&(console.log("found parent tile z%d-%d-%d",pt,rt,Ct),console.time("drilling down")),this.splitTile(ot.source,pt,rt,Ct,ee,te,fe),Ze>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Ci(this.tiles[Fe],je):null):null}}function hr(Ie,ee,te){return 32*((1<<Ie)*te+ee)+Ie}function ai(Ie,ee){return ee?Ie.properties[ee]:Ie.id}function fr(Ie,ee){if(Ie==null)return!0;if(Ie.type==="Feature")return ai(Ie,ee)!=null;if(Ie.type==="FeatureCollection"){const te=new Set;for(const fe of Ie.features){const Se=ai(fe,ee);if(Se==null||te.has(Se))return!1;te.add(Se)}return!0}return!1}function dr(Ie,ee){const te=new Map;if(Ie!=null)if(Ie.type==="Feature")te.set(ai(Ie,ee),Ie);else for(const fe of Ie.features)te.set(ai(fe,ee),fe);return te}class Sr extends y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ee,te){return f._(this,void 0,void 0,function*(){const fe=ee.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Se)return null;const je=new class{constructor(Ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.X,this.length=Ye.length,this._features=Ye}feature(Ye){return new class{constructor(Fe){this._feature=Fe,this.extent=f.X,this.type=Fe.type,this.properties=Fe.tags,"id"in Fe&&!isNaN(Fe.id)&&(this.id=parseInt(Fe.id,10))}loadGeometry(){if(this._feature.type===1){const Fe=[];for(const ot of this._feature.geometry)Fe.push([new f.P(ot[0],ot[1])]);return Fe}{const Fe=[];for(const ot of this._feature.geometry){const pt=[];for(const rt of ot)pt.push(new f.P(rt[0],rt[1]));Fe.push(pt)}return Fe}}toGeoJSON(Fe,ot,pt){return N.call(this,Fe,ot,pt)}}(this._features[Ye])}}(Se.features);let Ze=ce(je);return Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),{vectorTile:je,rawData:Ze.buffer}})}loadData(ee){return f._(this,void 0,void 0,function*(){var te;(te=this._pendingRequest)===null||te===void 0||te.abort();const fe=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new f.bv(ee.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ee,this._pendingRequest),this._geoJSONIndex=ee.cluster?new tt(function({superclusterOptions:Ze,clusterProperties:Ye}){if(!Ye||!Ze)return Ze;const Fe={},ot={},pt={accumulated:null,zoom:0},rt={properties:null},Ct=Object.keys(Ye);for(const Xt of Ct){const[ni,Ri]=Ye[Xt],bi=f.bC(Ri),zi=f.bC(typeof ni=="string"?[ni,["accumulated"],["get",Xt]]:ni);Fe[Xt]=bi.value,ot[Xt]=zi.value}return Ze.map=Xt=>{rt.properties=Xt;const ni={};for(const Ri of Ct)ni[Ri]=Fe[Ri].evaluate(pt,rt);return ni},Ze.reduce=(Xt,ni)=>{rt.properties=ni;for(const Ri of Ct)pt.accumulated=Xt[Ri],Xt[Ri]=ot[Ri].evaluate(pt,rt)},Ze}(ee)).load((yield this._pendingData).features):(Se=yield this._pendingData,new tn(Se,ee.geojsonVtOptions)),this.loaded={};const je={};if(fe){const Ze=fe.finish();Ze&&(je.resourceTiming={},je.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ze)))}return je}catch(je){if(delete this._pendingRequest,f.bB(je))return{abandoned:!0};throw je}var Se})}getData(){return f._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ee){const te=this.loaded;return te&&te[ee.uid]?super.reloadTile(ee):this.loadTile(ee)}loadAndProcessGeoJSON(ee,te){return f._(this,void 0,void 0,function*(){let fe=yield this.loadGeoJSON(ee,te);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);if(L(fe,!0),ee.filter){const Se=f.bC(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(Ze=>`${Ze.key}: ${Ze.message}`).join(", "));fe={type:"FeatureCollection",features:fe.features.filter(Ze=>Se.value.evaluate({zoom:0},Ze))}}return fe})}loadGeoJSON(ee,te){return f._(this,void 0,void 0,function*(){const{promoteId:fe}=ee;if(ee.request){const Se=yield f.h(ee.request,te);return this._dataUpdateable=fr(Se.data,fe)?dr(Se.data,fe):void 0,Se.data}if(typeof ee.data=="string")try{const Se=JSON.parse(ee.data);return this._dataUpdateable=fr(Se,fe)?dr(Se,fe):void 0,Se}catch{throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`)}if(!ee.dataDiff)throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ee.source}`);return function(Se,je,Ze){var Ye,Fe,ot,pt;if(je.removeAll&&Se.clear(),je.remove)for(const rt of je.remove)Se.delete(rt);if(je.add)for(const rt of je.add){const Ct=ai(rt,Ze);Ct!=null&&Se.set(Ct,rt)}if(je.update)for(const rt of je.update){let Ct=Se.get(rt.id);if(Ct==null)continue;const Xt=!rt.removeAllProperties&&(((Ye=rt.removeProperties)===null||Ye===void 0?void 0:Ye.length)>0||((Fe=rt.addOrUpdateProperties)===null||Fe===void 0?void 0:Fe.length)>0);if((rt.newGeometry||rt.removeAllProperties||Xt)&&(Ct=Object.assign({},Ct),Se.set(rt.id,Ct),Xt&&(Ct.properties=Object.assign({},Ct.properties))),rt.newGeometry&&(Ct.geometry=rt.newGeometry),rt.removeAllProperties)Ct.properties={};else if(((ot=rt.removeProperties)===null||ot===void 0?void 0:ot.length)>0)for(const ni of rt.removeProperties)Object.prototype.hasOwnProperty.call(Ct.properties,ni)&&delete Ct.properties[ni];if(((pt=rt.addOrUpdateProperties)===null||pt===void 0?void 0:pt.length)>0)for(const{key:ni,value:Ri}of rt.addOrUpdateProperties)Ct.properties[ni]=Ri}}(this._dataUpdateable,ee.dataDiff,fe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ee){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ee){return this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId)}getClusterChildren(ee){return this._geoJSONIndex.getChildren(ee.clusterId)}getClusterLeaves(ee){return this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset)}}class Tr{constructor(ee){this.self=ee,this.actor=new f.F(ee),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(te,fe)=>{if(this.externalWorkerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.externalWorkerSourceTypes[te]=fe},this.self.addProtocol=f.bi,this.self.removeProtocol=f.bj,this.self.registerRTLTextPlugin=te=>{if(f.bD.isParsed())throw new Error("RTL text plugin already registered.");f.bD.setMethods(te)},this.actor.registerMessageHandler("LDT",(te,fe)=>this._getDEMWorkerSource(te,fe.source).loadTile(fe)),this.actor.registerMessageHandler("RDT",(te,fe)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(te,fe.source).removeTile(fe)})),this.actor.registerMessageHandler("GCEZ",(te,fe)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(te,fe.type,fe.source).getClusterExpansionZoom(fe)})),this.actor.registerMessageHandler("GCC",(te,fe)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(te,fe.type,fe.source).getClusterChildren(fe)})),this.actor.registerMessageHandler("GCL",(te,fe)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(te,fe.type,fe.source).getClusterLeaves(fe)})),this.actor.registerMessageHandler("LD",(te,fe)=>this._getWorkerSource(te,fe.type,fe.source).loadData(fe)),this.actor.registerMessageHandler("GD",(te,fe)=>this._getWorkerSource(te,fe.type,fe.source).getData()),this.actor.registerMessageHandler("LT",(te,fe)=>this._getWorkerSource(te,fe.type,fe.source).loadTile(fe)),this.actor.registerMessageHandler("RT",(te,fe)=>this._getWorkerSource(te,fe.type,fe.source).reloadTile(fe)),this.actor.registerMessageHandler("AT",(te,fe)=>this._getWorkerSource(te,fe.type,fe.source).abortTile(fe)),this.actor.registerMessageHandler("RMT",(te,fe)=>this._getWorkerSource(te,fe.type,fe.source).removeTile(fe)),this.actor.registerMessageHandler("RS",(te,fe)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[te]||!this.workerSources[te][fe.type]||!this.workerSources[te][fe.type][fe.source])return;const Se=this.workerSources[te][fe.type][fe.source];delete this.workerSources[te][fe.type][fe.source],Se.removeSource!==void 0&&Se.removeSource(fe)})),this.actor.registerMessageHandler("RM",te=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te]})),this.actor.registerMessageHandler("SR",(te,fe)=>f._(this,void 0,void 0,function*(){this.referrer=fe})),this.actor.registerMessageHandler("SRPS",(te,fe)=>this._syncRTLPluginState(te,fe)),this.actor.registerMessageHandler("IS",(te,fe)=>f._(this,void 0,void 0,function*(){this.self.importScripts(fe)})),this.actor.registerMessageHandler("SI",(te,fe)=>this._setImages(te,fe)),this.actor.registerMessageHandler("UL",(te,fe)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(te).update(fe.layers,fe.removedIds)})),this.actor.registerMessageHandler("SL",(te,fe)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(te).replace(fe)}))}_setImages(ee,te){return f._(this,void 0,void 0,function*(){this.availableImages[ee]=te;for(const fe in this.workerSources[ee]){const Se=this.workerSources[ee][fe];for(const je in Se)Se[je].availableImages=te}})}_syncRTLPluginState(ee,te){return f._(this,void 0,void 0,function*(){if(f.bD.isParsed())return f.bD.getState();if(te.pluginStatus!=="loading")return f.bD.setState(te),te;const fe=te.pluginURL;if(this.self.importScripts(fe),f.bD.isParsed()){const Se={pluginStatus:"loaded",pluginURL:fe};return f.bD.setState(Se),Se}throw f.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${fe}`)})}_getAvailableImages(ee){let te=this.availableImages[ee];return te||(te=[]),te}_getLayerIndex(ee){let te=this.layerIndexes[ee];return te||(te=this.layerIndexes[ee]=new o),te}_getWorkerSource(ee,te,fe){if(this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][te]||(this.workerSources[ee][te]={}),!this.workerSources[ee][te][fe]){const Se={sendAsync:(je,Ze)=>(je.targetMapId=ee,this.actor.sendAsync(je,Ze))};switch(te){case"vector":this.workerSources[ee][te][fe]=new y(Se,this._getLayerIndex(ee),this._getAvailableImages(ee));break;case"geojson":this.workerSources[ee][te][fe]=new Sr(Se,this._getLayerIndex(ee),this._getAvailableImages(ee));break;default:this.workerSources[ee][te][fe]=new this.externalWorkerSourceTypes[te](Se,this._getLayerIndex(ee),this._getAvailableImages(ee))}}return this.workerSources[ee][te][fe]}_getDEMWorkerSource(ee,te){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][te]||(this.demWorkerSources[ee][te]=new k),this.demWorkerSources[ee][te]}}return f.i(self)&&(self.worker=new Tr(self)),Tr}),u("index",["exports","./shared"],function(f,o){var _="4.7.1";let T,S;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((e,c)=>{const p=requestAnimationFrame(e);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),c(o.c())})}),getImageData(v,e=0){return this.getImageCanvasContext(v).getImageData(-e,-e,v.width+2*e,v.height+2*e)},getImageCanvasContext(v){const e=window.document.createElement("canvas"),c=e.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return e.width=v.width,e.height=v.height,c.drawImage(v,0,0,v.width,v.height),c},resolveURL:v=>(T||(T=document.createElement("a")),T.href=v,T.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class k{static testProp(e){if(!k.docStyle)return e[0];for(let c=0;c<e.length;c++)if(e[c]in k.docStyle)return e[c];return e[0]}static create(e,c,p){const m=window.document.createElement(e);return c!==void 0&&(m.className=c),p&&p.appendChild(m),m}static createNS(e,c){return window.document.createElementNS(e,c)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(e,c){e.style[k.transformProp]=c}static addEventListener(e,c,p,m={}){e.addEventListener(c,p,"passive"in m?m:m.capture)}static removeEventListener(e,c,p,m={}){e.removeEventListener(c,p,"passive"in m?m:m.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static getScale(e){const c=e.getBoundingClientRect();return{x:c.width/e.offsetWidth||1,y:c.height/e.offsetHeight||1,boundingClientRect:c}}static getPoint(e,c,p){const m=c.boundingClientRect;return new o.P((p.clientX-m.left)/c.x-e.clientLeft,(p.clientY-m.top)/c.y-e.clientTop)}static mousePos(e,c){const p=k.getScale(e);return k.getPoint(e,p,c)}static touchPos(e,c){const p=[],m=k.getScale(e);for(let b=0;b<c.length;b++)p.push(k.getPoint(e,m,c[b]));return p}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);const I={supported:!1,testSupport:function(v){!N&&L&&(R?z(v):C=v)}};let C,L,N=!1,R=!1;function z(v){const e=v.createTexture();v.bindTexture(v.TEXTURE_2D,e);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,L),v.isContextLost())return;I.supported=!0}catch{}v.deleteTexture(e),N=!0}var Z;typeof document<"u"&&(L=document.createElement("img"),L.onload=()=>{C&&z(C),C=null,R=!0},L.onerror=()=>{N=!0,C=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let e,c,p,m;v.resetRequestQueue=()=>{e=[],c=0,p=0,m={}},v.addThrottleControl=O=>{const q=p++;return m[q]=O,q},v.removeThrottleControl=O=>{delete m[O],A()},v.getImage=(O,q,X=!0)=>new Promise((K,oe)=>{I.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),o.e(O,{type:"image"}),e.push({abortController:q,requestParameters:O,supportImageRefresh:X,state:"queued",onError:me=>{oe(me)},onSuccess:me=>{K(me)}}),A()});const b=O=>o._(this,void 0,void 0,function*(){O.state="running";const{requestParameters:q,supportImageRefresh:X,onError:K,onSuccess:oe,abortController:me}=O,ye=X===!1&&!o.i(self)&&!o.g(q.url)&&(!q.headers||Object.keys(q.headers).reduce((Oe,Ne)=>Oe&&Ne==="accept",!0));c++;const Ce=ye?P(q,me):o.m(q,me);try{const Oe=yield Ce;delete O.abortController,O.state="completed",Oe.data instanceof HTMLImageElement||o.b(Oe.data)?oe(Oe):Oe.data&&oe({data:yield(Pe=Oe.data,typeof createImageBitmap=="function"?o.d(Pe):o.f(Pe)),cacheControl:Oe.cacheControl,expires:Oe.expires})}catch(Oe){delete O.abortController,K(Oe)}finally{c--,A()}var Pe}),A=()=>{const O=(()=>{for(const q of Object.keys(m))if(m[q]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let q=c;q<O&&e.length>0;q++){const X=e.shift();X.abortController.signal.aborted?q--:b(X)}},P=(O,q)=>new Promise((X,K)=>{const oe=new Image,me=O.url,ye=O.credentials;ye&&ye==="include"?oe.crossOrigin="use-credentials":(ye&&ye==="same-origin"||!o.s(me))&&(oe.crossOrigin="anonymous"),q.signal.addEventListener("abort",()=>{oe.src="",K(o.c())}),oe.fetchPriority="high",oe.onload=()=>{oe.onerror=oe.onload=null,X({data:oe})},oe.onerror=()=>{oe.onerror=oe.onload=null,q.signal.aborted||K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},oe.src=me})}(Z||(Z={})),Z.resetRequestQueue();class ie{constructor(e){this._transformRequestFn=e}transformRequest(e,c){return this._transformRequestFn&&this._transformRequestFn(e,c)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ae(v){var e=new o.A(3);return e[0]=v[0],e[1]=v[1],e[2]=v[2],e}var $,re=function(v,e,c){return v[0]=e[0]-c[0],v[1]=e[1]-c[1],v[2]=e[2]-c[2],v};$=new o.A(3),o.A!=Float32Array&&($[0]=0,$[1]=0,$[2]=0);var j=function(v){var e=v[0],c=v[1];return e*e+c*c};function U(v){const e=[];if(typeof v=="string")e.push({id:"default",url:v});else if(v&&v.length>0){const c=[];for(const{id:p,url:m}of v){const b=`${p}${m}`;c.indexOf(b)===-1&&(c.push(b),e.push({id:p,url:m}))}}return e}function J(v,e,c){const p=v.split("?");return p[0]+=`${e}${c}`,p.join("?")}(function(){var v=new o.A(2);o.A!=Float32Array&&(v[0]=0,v[1]=0)})();class B{constructor(e,c,p,m){this.context=e,this.format=p,this.texture=e.gl.createTexture(),this.update(c,m)}update(e,c,p){const{width:m,height:b}=e,A=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:P}=this,{gl:O}=P;if(this.useMipmap=!!(c&&c.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!c||c.premultiply!==!1)),A)this.size=[m,b],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||o.b(e)?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,e):O.texImage2D(O.TEXTURE_2D,0,this.format,m,b,0,this.format,O.UNSIGNED_BYTE,e.data);else{const{x:q,y:X}=p||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||o.b(e)?O.texSubImage2D(O.TEXTURE_2D,0,q,X,O.RGBA,O.UNSIGNED_BYTE,e):O.texSubImage2D(O.TEXTURE_2D,0,q,X,m,b,O.RGBA,O.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)}bind(e,c,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),e!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,e),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||e),this.filter=e),c!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,c),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function W(v){const{userImage:e}=v;return!!(e&&e.render&&e.render())&&(v.data.replace(new Uint8Array(e.data.buffer)),!0)}class le extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:c,promiseResolve:p}of this.requestors)p(this._getImagesForIds(c));this.requestors=[]}}getImage(e){const c=this.images[e];if(c&&!c.data&&c.spriteData){const p=c.spriteData;c.data=new o.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),c.spriteData=null}return c}addImage(e,c){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,c)&&(this.images[e]=c)}_validate(e,c){let p=!0;const m=c.data||c.spriteData;return this._validateStretch(c.stretchX,m&&m.width)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,m&&m.height)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "content" value`))),p=!1),p}_validateStretch(e,c){if(!e)return!0;let p=0;for(const m of e){if(m[0]<p||m[1]<m[0]||c<m[1])return!1;p=m[1]}return!0}_validateContent(e,c){if(!e)return!0;if(e.length!==4)return!1;const p=c.spriteData,m=p&&p.width||c.data.width,b=p&&p.height||c.data.height;return!(e[0]<0||m<e[0]||e[1]<0||b<e[1]||e[2]<0||m<e[2]||e[3]<0||b<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,c,p=!0){const m=this.getImage(e);if(p&&(m.data.width!==c.data.width||m.data.height!==c.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${c.data.width}x${c.data.height}).`);c.version=m.version+1,this.images[e]=c,this.updatedImages[e]=!0}removeImage(e){const c=this.images[e];delete this.images[e],delete this.patterns[e],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((c,p)=>{let m=!0;if(!this.isLoaded())for(const b of e)this.images[b]||(m=!1);this.isLoaded()||m?c(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:c})})}_getImagesForIds(e){const c={};for(const p of e){let m=this.getImage(p);m||(this.fire(new o.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?c[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:o.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return c}getPixelSize(){const{width:e,height:c}=this.atlasImage;return{width:e,height:c}}getPattern(e){const c=this.patterns[e],p=this.getImage(e);if(!p)return null;if(c&&c.position.version===p.version)return c.position;if(c)c.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new o.I(m,p);this.patterns[e]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const c=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new B(e,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const b in this.patterns)e.push(this.patterns[b].bin);const{w:c,h:p}=o.p(e),m=this.atlasImage;m.resize({width:c||1,height:p||1});for(const b in this.patterns){const{bin:A}=this.patterns[b],P=A.x+1,O=A.y+1,q=this.getImage(b).data,X=q.width,K=q.height;o.R.copy(q,m,{x:0,y:0},{x:P,y:O},{width:X,height:K}),o.R.copy(q,m,{x:0,y:K-1},{x:P,y:O-1},{width:X,height:1}),o.R.copy(q,m,{x:0,y:0},{x:P,y:O+K},{width:X,height:1}),o.R.copy(q,m,{x:X-1,y:0},{x:P-1,y:O},{width:1,height:K}),o.R.copy(q,m,{x:0,y:0},{x:P+X,y:O},{width:1,height:K})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const c of e){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const p=this.getImage(c);p||o.w(`Image with ID: "${c}" was not found`),W(p)&&this.updateImage(c,p)}}}const ge=1e20;function pe(v,e,c,p,m,b,A,P,O){for(let q=e;q<e+p;q++)_e(v,c*b+q,b,m,A,P,O);for(let q=c;q<c+m;q++)_e(v,q*b+e,1,p,A,P,O)}function _e(v,e,c,p,m,b,A){b[0]=0,A[0]=-ge,A[1]=ge,m[0]=v[e];for(let P=1,O=0,q=0;P<p;P++){m[P]=v[e+P*c];const X=P*P;do{const K=b[O];q=(m[P]-m[K]+X-K*K)/(P-K)/2}while(q<=A[O]&&--O>-1);O++,b[O]=P,A[O]=q,A[O+1]=ge}for(let P=0,O=0;P<p;P++){for(;A[O+1]<P;)O++;const q=b[O],X=P-q;v[e+P*c]=m[q]+X*X}}class ce{constructor(e,c){this.requestManager=e,this.localIdeographFontFamily=c,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,function*(){const c=[];for(const b in e)for(const A of e[b])c.push(this._getAndCacheGlyphsPromise(b,A));const p=yield Promise.all(c),m={};for(const{stack:b,id:A,glyph:P}of p)m[b]||(m[b]={}),m[b][A]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return m})}_getAndCacheGlyphsPromise(e,c){return o._(this,void 0,void 0,function*(){let p=this.entries[e];p||(p=this.entries[e]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[c];if(m!==void 0)return{stack:e,id:c,glyph:m};if(m=this._tinySDF(p,e,c),m)return p.glyphs[c]=m,{stack:e,id:c,glyph:m};const b=Math.floor(c/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:e,id:c,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const P=ce.loadGlyphRange(e,b,this.url,this.requestManager);p.requests[b]=P}const A=yield p.requests[b];for(const P in A)this._doesCharSupportLocalGlyph(+P)||(p.glyphs[+P]=A[+P]);return p.ranges[b]=!0,{stack:e,id:c,glyph:A[c]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,c,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=e.tinySDF;if(!b){let P="400";/bold/i.test(c)?P="900":/medium/i.test(c)?P="500":/light/i.test(c)&&(P="200"),b=e.tinySDF=new ce.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:P})}const A=b.draw(String.fromCharCode(p));return{id:p,bitmap:new o.o({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}ce.loadGlyphRange=function(v,e,c,p){return o._(this,void 0,void 0,function*(){const m=256*e,b=m+255,A=p.transformRequest(c.replace("{fontstack}",v).replace("{range}",`${m}-${b}`),"Glyphs"),P=yield o.l(A,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${e}, ${m}-${b}`);const O={};for(const q of o.n(P.data))O[q.id]=q;return O})},ce.TinySDF=class{constructor({fontSize:v=24,buffer:e=3,radius:c=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:A="normal"}={}){this.buffer=e,this.cutoff=p,this.radius=c;const P=this.size=v+4*e,O=this._createCanvas(P),q=this.ctx=O.getContext("2d",{willReadFrequently:!0});q.font=`${A} ${b} ${v}px ${m}`,q.textBaseline="alphabetic",q.textAlign="left",q.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(v){const e=document.createElement("canvas");return e.width=e.height=v,e}draw(v){const{width:e,actualBoundingBoxAscent:c,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(v),A=Math.ceil(c),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),O=Math.min(this.size-this.buffer,A+Math.ceil(p)),q=P+2*this.buffer,X=O+2*this.buffer,K=Math.max(q*X,0),oe=new Uint8ClampedArray(K),me={data:oe,width:q,height:X,glyphWidth:P,glyphHeight:O,glyphTop:A,glyphLeft:0,glyphAdvance:e};if(P===0||O===0)return me;const{ctx:ye,buffer:Ce,gridInner:Pe,gridOuter:Oe}=this;ye.clearRect(Ce,Ce,P,O),ye.fillText(v,Ce,Ce+A);const Ne=ye.getImageData(Ce,Ce,P,O);Oe.fill(ge,0,K),Pe.fill(0,0,K);for(let Te=0;Te<O;Te++)for(let We=0;We<P;We++){const Xe=Ne.data[4*(Te*P+We)+3]/255;if(Xe===0)continue;const it=(Te+Ce)*q+We+Ce;if(Xe===1)Oe[it]=0,Pe[it]=ge;else{const mt=.5-Xe;Oe[it]=mt>0?mt*mt:0,Pe[it]=mt<0?mt*mt:0}}pe(Oe,0,0,q,X,q,this.f,this.v,this.z),pe(Pe,Ce,Ce,P,O,q,this.f,this.v,this.z);for(let Te=0;Te<K;Te++){const We=Math.sqrt(Oe[Te])-Math.sqrt(Pe[Te]);oe[Te]=Math.round(255-255*(We/this.radius+this.cutoff))}return me}};class Le{constructor(){this.specification=o.v.light.position}possiblyEvaluate(e,c){return o.x(e.expression.evaluate(c))}interpolate(e,c,p){return{x:o.y.number(e.x,c.x,p),y:o.y.number(e.y,c.y,p),z:o.y.number(e.z,c.z,p)}}}let ze;class ct extends o.E{constructor(e){super(),ze=ze||new o.q({anchor:new o.D(o.v.light.anchor),position:new Le,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(ze),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,c={}){if(!this._validate(o.r,e,c))for(const p in e){const m=e[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,c,p){return(!p||p.validate!==!1)&&o.t(this,e.call(o.u,{value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const nt=new o.q({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class bt extends o.E{constructor(e){super(),this._transitionable=new o.T(nt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0))}setSky(e,c={}){if(!this._validate(o.B,e,c)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in e){const m=e[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,c,p={}){return(p==null?void 0:p.validate)!==!1&&o.t(this,e.call(o.u,o.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class At{constructor(e,c){this.width=e,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,c){const p=e.join(",")+String(c);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(e,c)),this.dashEntry[p]}getDashRanges(e,c,p){const m=[];let b=e.length%2==1?-e[e.length-1]*p:0,A=e[0]*p,P=!0;m.push({left:b,right:A,isDash:P,zeroLength:e[0]===0});let O=e[0];for(let q=1;q<e.length;q++){P=!P;const X=e[q];b=O*p,O+=X,A=O*p,m.push({left:b,right:A,isDash:P,zeroLength:X===0})}return m}addRoundDash(e,c,p){const m=c/2;for(let b=-p;b<=p;b++){const A=this.width*(this.nextRow+p+b);let P=0,O=e[P];for(let q=0;q<this.width;q++){q/O.right>1&&(O=e[++P]);const X=Math.abs(q-O.left),K=Math.abs(q-O.right),oe=Math.min(X,K);let me;const ye=b/p*(m+1);if(O.isDash){const Ce=m-Math.abs(ye);me=Math.sqrt(oe*oe+Ce*Ce)}else me=m-Math.sqrt(oe*oe+ye*ye);this.data[A+q]=Math.max(0,Math.min(255,me+128))}}}addRegularDash(e){for(let P=e.length-1;P>=0;--P){const O=e[P],q=e[P+1];O.zeroLength?e.splice(P,1):q&&q.isDash===O.isDash&&(q.left=O.left,e.splice(P,1))}const c=e[0],p=e[e.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const m=this.width*this.nextRow;let b=0,A=e[b];for(let P=0;P<this.width;P++){P/A.right>1&&(A=e[++b]);const O=Math.abs(P-A.left),q=Math.abs(P-A.right),X=Math.min(O,q);this.data[m+P]=Math.max(0,Math.min(255,(A.isDash?X:-X)+128))}}addDash(e,c){const p=c?7:0,m=2*p+1;if(this.nextRow+m>this.height)return o.w("LineAtlas out of space"),null;let b=0;for(let P=0;P<e.length;P++)b+=e[P];if(b!==0){const P=this.width/b,O=this.getDashRanges(e,this.width,P);c?this.addRoundDash(O,P,p):this.addRegularDash(O)}const A={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,A}bind(e){const c=e.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}const tt="maplibre_preloaded_worker_pool";class vt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<vt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tt]}numActive(){return Object.keys(this.active).length}}const St=Math.floor(y.hardwareConcurrency/2);let Zt,oi;function Ai(){return Zt||(Zt=new vt),Zt}vt.workerCount=o.C(globalThis)?Math.max(Math.min(St,3),1):1;class Mi{constructor(e,c){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=c;const p=this.workerPool.acquire(c);for(let m=0;m<p.length;m++){const b=new o.F(p[m],c);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,c){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:e,data:c}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(c=>{c.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,c){for(const p of this.actors)p.registerMessageHandler(e,c)}}function Ti(){return oi||(oi=new Mi(Ai(),o.G),oi.registerMessageHandler("GR",(v,e,c)=>o.m(e,c))),oi}function It(v,e){const c=o.H();return o.J(c,c,[1,1,0]),o.K(c,c,[.5*v.width,.5*v.height,1]),o.L(c,c,v.calculatePosMatrix(e.toUnwrapped()))}function Ge(v,e,c,p,m,b){const A=function(K,oe,me){if(K)for(const ye of K){const Ce=oe[ye];if(Ce&&Ce.source===me&&Ce.type==="fill-extrusion")return!0}else for(const ye in oe){const Ce=oe[ye];if(Ce.source===me&&Ce.type==="fill-extrusion")return!0}return!1}(m&&m.layers,e,v.id),P=b.maxPitchScaleFactor(),O=v.tilesIn(p,P,A);O.sort(Pt);const q=[];for(const K of O)q.push({wrappedTileID:K.tileID.wrapped().key,queryResults:K.tile.queryRenderedFeatures(e,c,v._state,K.queryGeometry,K.cameraQueryGeometry,K.scale,m,b,P,It(v.transform,K.tileID))});const X=function(K){const oe={},me={};for(const ye of K){const Ce=ye.queryResults,Pe=ye.wrappedTileID,Oe=me[Pe]=me[Pe]||{};for(const Ne in Ce){const Te=Ce[Ne],We=Oe[Ne]=Oe[Ne]||{},Xe=oe[Ne]=oe[Ne]||[];for(const it of Te)We[it.featureIndex]||(We[it.featureIndex]=!0,Xe.push(it))}}return oe}(q);for(const K in X)X[K].forEach(oe=>{const me=oe.feature,ye=v.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=ye});return X}function Pt(v,e){const c=v.tileID,p=e.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function ii(v,e,c){return o._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield o.h(e.transformRequest(v.url,"Source"),c)).data:yield y.frameAsync(c),!p)return null;const m=o.M(o.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class Je{constructor(e,c){e&&(c?this.setSouthWest(e).setNorthEast(c):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.N?new o.N(e.lng,e.lat):o.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.N?new o.N(e.lng,e.lat):o.N.convert(e),this}extend(e){const c=this._sw,p=this._ne;let m,b;if(e instanceof o.N)m=e,b=e;else{if(!(e instanceof Je))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Je.convert(e)):this.extend(o.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.N.convert(e)):this;if(m=e._sw,b=e._ne,!m||!b)return this}return c||p?(c.lng=Math.min(m.lng,c.lng),c.lat=Math.min(m.lat,c.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new o.N(m.lng,m.lat),this._ne=new o.N(b.lng,b.lat)),this}getCenter(){return new o.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.N(this.getWest(),this.getNorth())}getSouthEast(){return new o.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:c,lat:p}=o.N.convert(e);let m=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(e){return e instanceof Je?e:e&&new Je(e)}static fromLngLat(e,c=0){const p=360*c/40075017,m=p/Math.cos(Math.PI/180*e.lat);return new Je(new o.N(e.lng-m,e.lat-p),new o.N(e.lng+m,e.lat+p))}adjustAntiMeridian(){const e=new o.N(this._sw.lng,this._sw.lat),c=new o.N(this._ne.lng,this._ne.lat);return new Je(e,e.lng>c.lng?new o.N(c.lng+360,c.lat):c)}}class gi{constructor(e,c,p){this.bounds=Je.convert(this.validateBounds(e)),this.minzoom=c||0,this.maxzoom=p||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const c=Math.pow(2,e.z),p=Math.floor(o.O(this.bounds.getWest())*c),m=Math.floor(o.Q(this.bounds.getNorth())*c),b=Math.ceil(o.O(this.bounds.getEast())*c),A=Math.ceil(o.Q(this.bounds.getSouth())*c);return e.x>=p&&e.x<b&&e.y>=m&&e.y<A}}class dt extends o.E{constructor(e,c,p,m){if(super(),this.id=e,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.M(c,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ii(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new gi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,function*(){const c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(c,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((b,A)=>{e.reloadPromise={resolve:b,reject:A}})}else e.actor=this.dispatcher.getActor(),m="LT";e.abortController=new AbortController;try{const b=yield e.actor.sendAsync({type:m,data:p},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,b)}catch(b){if(delete e.abortController,e.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,c){if(c&&c.resourceTiming&&(e.resourceTiming=c.resourceTiming),c&&this.map._refreshExpiredTiles&&e.setExpiryData(c),e.loadVectorData(c,this.map.painter),e.reloadPromise){const p=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(p.resolve).catch(p.reject)}}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class et extends o.E{constructor(e,c,p,m){super(),this.id=e,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},c),o.e(this,o.M(c,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ii(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(o.e(this,e),e.bounds&&(this.tileBounds=new gi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,function*(){const c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const p=yield Z.getImage(this.map._requestManager.transformRequest(c,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,A=p.data;e.texture=this.map.painter.getTileTexture(A.width),e.texture?e.texture.update(A,{useMipmap:!0}):(e.texture=new B(m,A,b.RGBA,{useMipmap:!0}),e.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class he extends et{constructor(e,c,p,m){super(e,c,p,m),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox",this.redFactor=c.redFactor,this.greenFactor=c.greenFactor,this.blueFactor=c.blueFactor,this.baseShift=c.baseShift}loadTile(e){return o._(this,void 0,void 0,function*(){const c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(c,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const m=yield Z.getImage(p,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&e.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const A=o.b(b)&&o.U()?b:yield this.readImageNow(b),P={type:this.type,uid:e.uid,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const O=yield e.actor.sendAsync({type:"LDT",data:P});e.dem=O,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(m){if(delete e.abortController,e.aborted)e.state="unloaded";else if(m)throw e.state="errored",m}})}readImageNow(e){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.V()){const c=e.width+2,p=e.height+2;try{return new o.R({width:c,height:p},yield o.W(e,-1,-1,c,p))}catch{}}return y.getImageData(e,1)})}_getNeighboringTiles(e){const c=e.canonical,p=Math.pow(2,c.z),m=(c.x-1+p)%p,b=c.x===0?e.wrap-1:e.wrap,A=(c.x+1+p)%p,P=c.x+1===p?e.wrap+1:e.wrap,O={};return O[new o.S(e.overscaledZ,b,c.z,m,c.y).key]={backfilled:!1},O[new o.S(e.overscaledZ,P,c.z,A,c.y).key]={backfilled:!1},c.y>0&&(O[new o.S(e.overscaledZ,b,c.z,m,c.y-1).key]={backfilled:!1},O[new o.S(e.overscaledZ,e.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},O[new o.S(e.overscaledZ,P,c.z,A,c.y-1).key]={backfilled:!1}),c.y+1<p&&(O[new o.S(e.overscaledZ,b,c.z,m,c.y+1).key]={backfilled:!1},O[new o.S(e.overscaledZ,e.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},O[new o.S(e.overscaledZ,P,c.z,A,c.y+1).key]={backfilled:!1}),O}unloadTile(e){return o._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class H extends o.E{constructor(e,c,p,m){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=c.data,this._options=o.e({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const b=o.X/this.tileSize;c.clusterMaxZoom!==void 0&&this.maxzoom<=c.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${c.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*b,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*b,extent:o.X,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:o.X,radius:(c.clusterRadius||50)*b,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return o._(this,void 0,void 0,function*(){const e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,c,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:c,offset:p}})}_updateWorkerData(e){return o._(this,void 0,void 0,function*(){const c=o.e({type:this.type},this.workerOptions);e?c.dataDiff=e:typeof this._data=="string"?(c.request=this.map._requestManager.transformRequest(y.resolveURL(this._data),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:c});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&o.e(b,{resourceTiming:m}),this.fire(new o.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(e){return o._(this,void 0,void 0,function*(){const c=e.actor?"RT":"LT";e.actor=this.actor;const p={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const m=yield this.actor.sendAsync({type:c,data:p},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(m,this.map.painter,c==="RT")})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Y=o.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ee extends o.E{constructor(e,c,p,m){super(),this.id=e,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=c}load(e){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const c=yield Z.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,c&&c.data&&(this.image=c.data,e&&(this.coordinates=e),this._finishLoading())}catch(c){this._request=null,this._loaded=!0,this.fire(new o.j(c))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const c=e.map(o.Z.fromLngLat);this.tileID=function(m){let b=1/0,A=1/0,P=-1/0,O=-1/0;for(const oe of m)b=Math.min(b,oe.x),A=Math.min(A,oe.y),P=Math.max(P,oe.x),O=Math.max(O,oe.y);const q=Math.max(P-b,O-A),X=Math.max(0,Math.floor(-Math.log(q)/Math.LN2)),K=Math.pow(2,X);return new o.a1(X,Math.floor((b+P)/2*K),Math.floor((A+O)/2*K))}(c),this.minzoom=this.maxzoom=this.tileID.z;const p=c.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new o.$,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,o.X,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,o.X),this._boundsArray.emplaceBack(p[2].x,p[2].y,o.X,o.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,c=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new B(e,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class qe extends Ee{constructor(e,c,p,m){super(e,c,p,m),this.roundZoom=!0,this.type="video",this.options=c}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const c of e.urls)this.urls.push(this.map._requestManager.transformRequest(c,"Source").url);try{const c=yield o.a3(this.urls);if(this._loaded=!0,!c)return;this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(c){this.fire(new o.j(c))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const c=this.video.seekable;e<c.start(0)||e>c.end(0)?this.fire(new o.j(new o.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,c=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new B(e,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ut extends Ee{constructor(e,c,p,m){super(e,c,p,m),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(A=>typeof A!="number"))||this.fire(new o.j(new o.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a2(`sources.${e}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new o.j(new o.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context,p=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new B(c,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,m=!0)}m&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const st={},ki=v=>{switch(v){case"geojson":return H;case"image":return Ee;case"raster":return et;case"raster-dem":return he;case"vector":return dt;case"video":return qe;case"canvas":return ut}return st[v]},lt="RTLPluginLoaded";class Vt extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ti()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(c=>{throw this.status="error",c})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,function*(c,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(c),!this.url)throw new Error(`requested url ${c} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(lt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ci=null;function Fi(){return Ci||(Ci=new Vt),Ci}class Cn{constructor(e,c){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=o.a4(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const c=e+this.timeAdded;c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,c,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(m,b){const A={};if(!b)return A;for(const P of m){const O=P.layerIds.map(q=>b.getLayer(q)).filter(Boolean);if(O.length!==0){P.layers=O,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(q=>O.filter(X=>X.id===q)[0]));for(const q of O)A[q.id]=P}}return A}(e.buckets,c.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof o.a6){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof o.a6&&b.hasRTLText){this.hasRTLText=!0,Fi().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(m).queryRadius(b))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(e)}const c=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new B(e,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new B(e,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,c,p,m,b,A,P,O,q,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:A,tileSize:this.tileSize,pixelPosMatrix:X,transform:O,params:P,queryPadding:this.queryPadding*q},e,c,p):{}}querySourceFeatures(e,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=c&&c.sourceLayer?c.sourceLayer:"",A=m._geojsonTileLayer||m[b];if(!A)return;const P=o.a7(c&&c.filter),{z:O,x:q,y:X}=this.tileID.canonical,K={z:O,x:q,y:X};for(let oe=0;oe<A.length;oe++){const me=A.feature(oe);if(P.needGeometry){const Pe=o.a8(me,!0);if(!P.filter(new o.z(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!P.filter(new o.z(this.tileID.overscaledZ),me))continue;const ye=p.getId(me,b),Ce=new o.a9(me,O,q,X,ye);Ce.tile=K,e.push(Ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const c=this.expirationTime;if(e.cacheControl){const p=o.aa(e.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(c)if(this.expirationTime<c)m=!0;else{const b=this.expirationTime-c;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!c.style.hasLayer(m))continue;const b=this.buckets[m],A=b.layers[0].sourceLayer||"_geojsonTileLayer",P=p[A],O=e[A];if(!P||!O||Object.keys(O).length===0)continue;b.update(O,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const q=c&&c.style&&c.style.getLayer(m);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=y.now()+e}setDependencies(e,c){const p={};for(const m of c)p[m]=!0;this.dependencies[e]=p}hasDependency(e,c){for(const p of e){const m=this.dependencies[p];if(m){for(const b of c)if(m[b])return!0}}return!1}}class xt{constructor(e,c){this.max=e,this.onRemove=c,this.reset()}reset(){for(const e in this.data)for(const c of this.data[e])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(e,c,p){const m=e.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:c,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(e,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const c=this.data[e].shift();return c.timeout&&clearTimeout(c.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),c.value}getByKey(e){const c=this.data[e];return c?c[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,c){if(!this.has(e))return this;const p=e.wrapped().key,m=c===void 0?0:this.data[p].indexOf(c),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(e){const c=[];for(const p in this.data)for(const m of this.data[p])e(m.value)||c.push(m);for(const p of c)this.remove(p.value.tileID,p)}}class li{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,c,p){const m=String(c);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][m]=this.stateChanges[e][m]||{},o.e(this.stateChanges[e][m],p),this.deletedStates[e]===null){this.deletedStates[e]={};for(const b in this.state[e])b!==m&&(this.deletedStates[e][b]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][m]===null){this.deletedStates[e][m]={};for(const b in this.state[e][m])p[b]||(this.deletedStates[e][m][b]=null)}else for(const b in p)this.deletedStates[e]&&this.deletedStates[e][m]&&this.deletedStates[e][m][b]===null&&delete this.deletedStates[e][m][b]}removeFeatureState(e,c,p){if(this.deletedStates[e]===null)return;const m=String(c);if(this.deletedStates[e]=this.deletedStates[e]||{},p&&c!==void 0)this.deletedStates[e][m]!==null&&(this.deletedStates[e][m]=this.deletedStates[e][m]||{},this.deletedStates[e][m][p]=null);else if(c!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][m])for(p in this.deletedStates[e][m]={},this.stateChanges[e][m])this.deletedStates[e][m][p]=null;else this.deletedStates[e][m]=null;else this.deletedStates[e]=null}getState(e,c){const p=String(c),m=o.e({},(this.state[e]||{})[p],(this.stateChanges[e]||{})[p]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const b=this.deletedStates[e][c];if(b===null)return{};for(const A in b)delete m[A]}return m}initializeTileState(e,c){e.setFeatureState(this.state,c)}coalesceChanges(e,c){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const A in this.stateChanges[m])this.state[m][A]||(this.state[m][A]={}),o.e(this.state[m][A],this.stateChanges[m][A]),b[A]=this.state[m][A];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const A in this.state[m])b[A]={},this.state[m][A]={};else for(const A in this.deletedStates[m]){if(this.deletedStates[m][A]===null)this.state[m][A]={};else for(const P of Object.keys(this.deletedStates[m][A]))delete this.state[m][A][P];b[A]=this.state[m][A]}p[m]=p[m]||{},o.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in e)e[m].setFeatureState(p,c)}}class ti extends o.E{constructor(e,c,p){super(),this.id=e,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,A,P)=>{const O=new(ki(b.type))(m,b,A,P);if(O.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${O.id}`);return O})(e,c,p,this),this._tiles={},this._cache=new xt(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new li,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const c=this._tiles[e];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,c,p){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,c,p)}catch(m){e.state="errored",m.status!==404?this._source.fire(new o.j(m,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(e),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(tn).map(e=>e.key)}getRenderableIds(e){const c=[];for(const p in this._tiles)this._isIdRenderable(p,e)&&c.push(this._tiles[p]);return e?c.sort((p,m)=>{const b=p.tileID,A=m.tileID,P=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),O=new o.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-A.overscaledZ||O.y-P.y||O.x-P.x}).map(p=>p.tileID.key):c.map(p=>p.tileID).sort(tn).map(p=>p.key)}hasRenderableParent(e){const c=this.findLoadedParent(e,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(e,c){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(c||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,c){return o._(this,void 0,void 0,function*(){const p=this._tiles[e];p&&(p.state!=="loading"&&(p.state=c),yield this._loadTile(p,e,c))})}_tileLoaded(e,c,p){e.timeAdded=y.now(),p==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(c,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const c=this.getRenderableIds();for(let m=0;m<c.length;m++){const b=c[m];if(e.neighboringTiles&&e.neighboringTiles[b]){const A=this.getTileByID(b);p(e,A),p(A,e)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let A=b.tileID.canonical.x-m.tileID.canonical.x;const P=b.tileID.canonical.y-m.tileID.canonical.y,O=Math.pow(2,m.tileID.canonical.z),q=b.tileID.key;A===0&&P===0||Math.abs(P)>1||(Math.abs(A)>1&&(Math.abs(A+O)===1?A+=O:Math.abs(A-O)===1&&(A-=O)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,A,P),m.neighboringTiles&&m.neighboringTiles[q]&&(m.neighboringTiles[q].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,c,p,m){for(const b in this._tiles){let A=this._tiles[b];if(m[b]||!A.hasData()||A.tileID.overscaledZ<=c||A.tileID.overscaledZ>p)continue;let P=A.tileID;for(;A&&A.tileID.overscaledZ>c+1;){const q=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[q.key],A&&A.hasData()&&(P=q)}let O=P;for(;O.overscaledZ>c;)if(O=O.scaledTo(O.overscaledZ-1),e[O.key]){m[P.key]=P;break}}}findLoadedParent(e,c){if(e.key in this._loadedParentTiles){const p=this._loadedParentTiles[e.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=e.overscaledZ-1;p>=c;p--){const m=e.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const c=this._tiles[e.key];return c&&c.hasData()?c:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const c=Math.ceil(e.width/this._source.tileSize)+1,p=Math.ceil(e.height/this._source.tileSize)+1,m=Math.floor(c*p*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(e){const c=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,c){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+c),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(e,c,p,m,b,A){const P={},O={},q=Object.keys(e),X=y.now();for(const K of q){const oe=e[K],me=this._tiles[K];if(!me||me.fadeEndTime!==0&&me.fadeEndTime<=X)continue;const ye=this.findLoadedParent(oe,c),Ce=this.findLoadedSibling(oe),Pe=ye||Ce||null;Pe&&(this._addTile(Pe.tileID),P[Pe.tileID.key]=Pe.tileID),O[K]=oe}this._retainLoadedChildren(O,m,p,e);for(const K in P)e[K]||(this._coveredTiles[K]=!0,e[K]=P[K]);if(A){const K={},oe={};for(const me of b)this._tiles[me.key].hasData()?K[me.key]=me:oe[me.key]=me;for(const me in oe){const ye=oe[me].children(this._source.maxzoom);this._tiles[ye[0].key]&&this._tiles[ye[1].key]&&this._tiles[ye[2].key]&&this._tiles[ye[3].key]&&(K[ye[0].key]=e[ye[0].key]=ye[0],K[ye[1].key]=e[ye[1].key]=ye[1],K[ye[2].key]=e[ye[2].key]=ye[2],K[ye[3].key]=e[ye[3].key]=ye[3],delete oe[me])}for(const me in oe){const ye=oe[me],Ce=this.findLoadedParent(ye,this._source.minzoom),Pe=this.findLoadedSibling(ye),Oe=Ce||Pe||null;if(Oe){K[Oe.tileID.key]=e[Oe.tileID.key]=Oe.tileID;for(const Ne in K)K[Ne].isChildOf(Oe.tileID)&&delete K[Ne]}}for(const me in this._tiles)K[me]||(this._coveredTiles[me]=!0)}}update(e,c){if(!this._sourceLoaded||this._paused)return;let p;this.transform=e,this.terrain=c,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(X=>new o.S(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y)):(p=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:c}),this._source.hasTile&&(p=p.filter(X=>this._source.hasTile(X)))):p=[];const m=e.coveringZoomLevel(this._source),b=Math.max(m-ti.maxOverzooming,this._source.minzoom),A=Math.max(m+ti.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const X={};for(const K of p)if(K.canonical.z>this._source.minzoom){const oe=K.scaledTo(K.canonical.z-1);X[oe.key]=oe;const me=K.scaledTo(Math.max(this._source.minzoom,Math.min(K.canonical.z,5)));X[me.key]=me}p=p.concat(Object.values(X))}const P=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const O=this._updateRetainedTiles(p,m);hr(this._source.type)&&this._updateCoveredAndRetainedTiles(O,b,A,m,p,c);for(const X in O)this._tiles[X].clearFadeHold();const q=o.ab(this._tiles,O);for(const X of q){const K=this._tiles[X];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(X)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,c){var p;const m={},b={},A=Math.max(c-ti.maxOverzooming,this._source.minzoom),P=Math.max(c+ti.maxUnderzooming,this._source.minzoom),O={};for(const q of e){const X=this._addTile(q);m[q.key]=q,X.hasData()||c<this._source.maxzoom&&(O[q.key]=q)}this._retainLoadedChildren(O,c,P,m);for(const q of e){let X=this._tiles[q.key];if(X.hasData())continue;if(c+1>this._source.maxzoom){const oe=q.children(this._source.maxzoom)[0],me=this.getTile(oe);if(me&&me.hasData()){m[oe.key]=oe;continue}}else{const oe=q.children(this._source.maxzoom);if(m[oe[0].key]&&m[oe[1].key]&&m[oe[2].key]&&m[oe[3].key])continue}let K=X.wasRequested();for(let oe=q.overscaledZ-1;oe>=A;--oe){const me=q.scaledTo(oe);if(b[me.key])break;if(b[me.key]=!0,X=this.getTile(me),!X&&K&&(X=this._addTile(me)),X){const ye=X.hasData();if((ye||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||K)&&(m[me.key]=me),K=X.wasRequested(),ye)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const c=[];let p,m=this._tiles[e].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}c.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of c)this._loadedParentTiles[b]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const c=this._tiles[e].tileID,p=this._getLoadedTile(c);this._loadedSiblingTiles[c.key]=p}}_addTile(e){let c=this._tiles[e.key];if(c)return c;c=this._cache.getAndRemove(e),c&&(this._setTileReloadTimer(e.key,c),c.tileID=e,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,c)));const p=c;return c||(c=new Cn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(c,e.key,c.state)),c.uses++,this._tiles[e.key]=c,p||this._source.fire(new o.k("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(e,c){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const p=c.getExpiryTimeout();p&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},p))}_removeTile(e){const c=this._tiles[e];c&&(c.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),c.uses>0||(c.hasData()&&c.state!=="reloading"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}_dataHandler(e){const c=e.sourceDataType;e.dataType==="source"&&c==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&c==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,c,p){const m=[],b=this.transform;if(!b)return m;const A=p?b.getCameraQueryGeometry(e):e,P=e.map(ye=>b.pointCoordinate(ye,this.terrain)),O=A.map(ye=>b.pointCoordinate(ye,this.terrain)),q=this.getIds();let X=1/0,K=1/0,oe=-1/0,me=-1/0;for(const ye of O)X=Math.min(X,ye.x),K=Math.min(K,ye.y),oe=Math.max(oe,ye.x),me=Math.max(me,ye.y);for(let ye=0;ye<q.length;ye++){const Ce=this._tiles[q[ye]];if(Ce.holdingForFade())continue;const Pe=Ce.tileID,Oe=Math.pow(2,b.zoom-Ce.tileID.overscaledZ),Ne=c*Ce.queryPadding*o.X/Ce.tileSize/Oe,Te=[Pe.getTilePoint(new o.Z(X,K)),Pe.getTilePoint(new o.Z(oe,me))];if(Te[0].x-Ne<o.X&&Te[0].y-Ne<o.X&&Te[1].x+Ne>=0&&Te[1].y+Ne>=0){const We=P.map(it=>Pe.getTilePoint(it)),Xe=O.map(it=>Pe.getTilePoint(it));m.push({tile:Ce,tileID:Pe,queryGeometry:We,cameraQueryGeometry:Xe,scale:Oe})}}return m}getVisibleCoordinates(e){const c=this.getRenderableIds(e).map(p=>this._tiles[p].tileID);for(const p of c)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(hr(this._source.type)){const e=y.now();for(const c in this._tiles)if(this._tiles[c].fadeEndTime>=e)return!0}return!1}setFeatureState(e,c,p){this._state.updateState(e=e||"_geojsonTileLayer",c,p)}removeFeatureState(e,c,p){this._state.removeFeatureState(e=e||"_geojsonTileLayer",c,p)}getFeatureState(e,c){return this._state.getState(e=e||"_geojsonTileLayer",c)}setDependencies(e,c,p){const m=this._tiles[e];m&&m.setDependencies(c,p)}reloadTilesForDependencies(e,c){for(const p in this._tiles)this._tiles[p].hasDependency(e,c)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(e,c))}}function tn(v,e){const c=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*e.wrap)-+(e.wrap<0);return v.overscaledZ-e.overscaledZ||p-c||e.canonical.y-v.canonical.y||e.canonical.x-v.canonical.x}function hr(v){return v==="raster"||v==="image"||v==="video"}ti.maxOverzooming=10,ti.maxUnderzooming=3;class ai{constructor(e,c){this.reset(e,c)}reset(e,c){this.points=e||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.ac(e,0,1);let c=1,p=this._distances[c];const m=e*this.paddedLength+this.padding;for(;p<m&&c<this._distances.length;)p=this._distances[++c];const b=c-1,A=this._distances[b],P=p-A,O=P>0?(m-A)/P:0;return this.points[b].mult(1-O).add(this.points[c].mult(O))}}function fr(v,e){let c=!0;return v==="always"||v!=="never"&&e!=="never"||(c=!1),c}class dr{constructor(e,c,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(e/p),this.yCellCount=Math.ceil(c/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=c,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,c,p,m,b){this._forEachCell(c,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(e,c,p,m){this._forEachCell(c-m,p-m,c+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(c),this.circles.push(p),this.circles.push(m)}_insertBoxCell(e,c,p,m,b,A){this.boxCells[b].push(A)}_insertCircleCell(e,c,p,m,b,A){this.circleCells[b].push(A)}_query(e,c,p,m,b,A,P){if(p<0||e>this.width||m<0||c>this.height)return[];const O=[];if(e<=0&&c<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:e,y1:c,x2:p,y2:m}];for(let q=0;q<this.boxKeys.length;q++)O.push({key:this.boxKeys[q],x1:this.bboxes[4*q],y1:this.bboxes[4*q+1],x2:this.bboxes[4*q+2],y2:this.bboxes[4*q+3]});for(let q=0;q<this.circleKeys.length;q++){const X=this.circles[3*q],K=this.circles[3*q+1],oe=this.circles[3*q+2];O.push({key:this.circleKeys[q],x1:X-oe,y1:K-oe,x2:X+oe,y2:K+oe})}}else this._forEachCell(e,c,p,m,this._queryCell,O,{hitTest:b,overlapMode:A,seenUids:{box:{},circle:{}}},P);return O}query(e,c,p,m){return this._query(e,c,p,m,!1,null)}hitTest(e,c,p,m,b,A){return this._query(e,c,p,m,!0,b,A).length>0}hitTestCircle(e,c,p,m,b){const A=e-p,P=e+p,O=c-p,q=c+p;if(P<0||A>this.width||q<0||O>this.height)return!1;const X=[];return this._forEachCell(A,O,P,q,this._queryCellCircle,X,{hitTest:!0,overlapMode:m,circle:{x:e,y:c,radius:p},seenUids:{box:{},circle:{}}},b),X.length>0}_queryCell(e,c,p,m,b,A,P,O){const{seenUids:q,hitTest:X,overlapMode:K}=P,oe=this.boxCells[b];if(oe!==null){const ye=this.bboxes;for(const Ce of oe)if(!q.box[Ce]){q.box[Ce]=!0;const Pe=4*Ce,Oe=this.boxKeys[Ce];if(e<=ye[Pe+2]&&c<=ye[Pe+3]&&p>=ye[Pe+0]&&m>=ye[Pe+1]&&(!O||O(Oe))&&(!X||!fr(K,Oe.overlapMode))&&(A.push({key:Oe,x1:ye[Pe],y1:ye[Pe+1],x2:ye[Pe+2],y2:ye[Pe+3]}),X))return!0}}const me=this.circleCells[b];if(me!==null){const ye=this.circles;for(const Ce of me)if(!q.circle[Ce]){q.circle[Ce]=!0;const Pe=3*Ce,Oe=this.circleKeys[Ce];if(this._circleAndRectCollide(ye[Pe],ye[Pe+1],ye[Pe+2],e,c,p,m)&&(!O||O(Oe))&&(!X||!fr(K,Oe.overlapMode))){const Ne=ye[Pe],Te=ye[Pe+1],We=ye[Pe+2];if(A.push({key:Oe,x1:Ne-We,y1:Te-We,x2:Ne+We,y2:Te+We}),X)return!0}}}return!1}_queryCellCircle(e,c,p,m,b,A,P,O){const{circle:q,seenUids:X,overlapMode:K}=P,oe=this.boxCells[b];if(oe!==null){const ye=this.bboxes;for(const Ce of oe)if(!X.box[Ce]){X.box[Ce]=!0;const Pe=4*Ce,Oe=this.boxKeys[Ce];if(this._circleAndRectCollide(q.x,q.y,q.radius,ye[Pe+0],ye[Pe+1],ye[Pe+2],ye[Pe+3])&&(!O||O(Oe))&&!fr(K,Oe.overlapMode))return A.push(!0),!0}}const me=this.circleCells[b];if(me!==null){const ye=this.circles;for(const Ce of me)if(!X.circle[Ce]){X.circle[Ce]=!0;const Pe=3*Ce,Oe=this.circleKeys[Ce];if(this._circlesCollide(ye[Pe],ye[Pe+1],ye[Pe+2],q.x,q.y,q.radius)&&(!O||O(Oe))&&!fr(K,Oe.overlapMode))return A.push(!0),!0}}}_forEachCell(e,c,p,m,b,A,P,O){const q=this._convertToXCellCoord(e),X=this._convertToYCellCoord(c),K=this._convertToXCellCoord(p),oe=this._convertToYCellCoord(m);for(let me=q;me<=K;me++)for(let ye=X;ye<=oe;ye++)if(b.call(this,e,c,p,m,this.xCellCount*ye+me,A,P,O))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,c,p,m,b,A){const P=m-e,O=b-c,q=p+A;return q*q>P*P+O*O}_circleAndRectCollide(e,c,p,m,b,A,P){const O=(A-m)/2,q=Math.abs(e-(m+O));if(q>O+p)return!1;const X=(P-b)/2,K=Math.abs(c-(b+X));if(K>X+p)return!1;if(q<=O||K<=X)return!0;const oe=q-O,me=K-X;return oe*oe+me*me<=p*p}}function Sr(v,e,c,p,m){const b=o.H();return e?(o.K(b,b,[1/m,1/m,1]),c||o.ad(b,b,p.angle)):o.L(b,p.labelPlaneMatrix,v),b}function Tr(v,e,c,p,m){if(e){const b=o.ae(v);return o.K(b,b,[m,m,1]),c||o.ad(b,b,-p.angle),b}return p.glCoordMatrix}function Ie(v,e,c,p){let m;p?(m=[v,e,p(v,e),1],o.af(m,m,c)):(m=[v,e,0,1],Ri(m,m,c));const b=m[3];return{point:new o.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function ee(v,e){return .5+v/e*.5}function te(v,e){return v.x>=-e[0]&&v.x<=e[0]&&v.y>=-e[1]&&v.y<=e[1]}function fe(v,e,c,p,m,b,A,P,O,q,X,K,oe,me,ye){const Ce=p?v.textSizeData:v.iconSizeData,Pe=o.ag(Ce,c.transform.zoom),Oe=[256/c.width*2+1,256/c.height*2+1],Ne=p?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Ne.clear();const Te=v.lineVertexArray,We=p?v.text.placedSymbolArray:v.icon.placedSymbolArray,Xe=c.transform.width/c.transform.height;let it=!1;for(let mt=0;mt<We.length;mt++){const Tt=We.get(mt);if(Tt.hidden||Tt.writingMode===o.ah.vertical&&!it){ni(Tt.numGlyphs,Ne);continue}it=!1;const Dt=Ie(Tt.anchorX,Tt.anchorY,e,ye);if(!te(Dt.point,Oe)){ni(Tt.numGlyphs,Ne);continue}const Nt=ee(c.transform.cameraToCenterDistance,Dt.signedDistanceFromCamera),Lt=o.ai(Ce,Pe,Tt),Mt=A?Lt/Nt:Lt*Nt,Ht={getElevation:ye,labelPlaneMatrix:m,lineVertexArray:Te,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:q,tileAnchorPoint:new o.P(Tt.anchorX,Tt.anchorY),unwrappedTileID:X,width:K,height:oe,translation:me},vi=Ze(Ht,Tt,Mt,!1,P,e,b,v.glyphOffsetArray,Ne,Xe,O);it=vi.useVertical,(vi.notEnoughRoom||it||vi.needsFlipping&&Ze(Ht,Tt,Mt,!0,P,e,b,v.glyphOffsetArray,Ne,Xe,O).notEnoughRoom)&&ni(Tt.numGlyphs,Ne)}p?v.text.dynamicLayoutVertexBuffer.updateData(Ne):v.icon.dynamicLayoutVertexBuffer.updateData(Ne)}function Se(v,e,c,p,m,b,A,P){const O=b.glyphStartIndex+b.numGlyphs,q=b.lineStartIndex,X=b.lineStartIndex+b.lineLength,K=e.getoffsetX(b.glyphStartIndex),oe=e.getoffsetX(O-1),me=Ct(v*K,c,p,m,b.segment,q,X,P,A);if(!me)return null;const ye=Ct(v*oe,c,p,m,b.segment,q,X,P,A);return ye?P.projectionCache.anyProjectionOccluded?null:{first:me,last:ye}:null}function je(v,e,c,p){return v===o.ah.horizontal&&Math.abs(c.y-e.y)>Math.abs(c.x-e.x)*p?{useVertical:!0}:(v===o.ah.vertical?e.y<c.y:e.x>c.x)?{needsFlipping:!0}:null}function Ze(v,e,c,p,m,b,A,P,O,q,X){const K=c/24,oe=e.lineOffsetX*K,me=e.lineOffsetY*K;let ye;if(e.numGlyphs>1){const Ce=e.glyphStartIndex+e.numGlyphs,Pe=e.lineStartIndex,Oe=e.lineStartIndex+e.lineLength,Ne=Se(K,P,oe,me,p,e,X,v);if(!Ne)return{notEnoughRoom:!0};const Te=Ie(Ne.first.point.x,Ne.first.point.y,A,v.getElevation).point,We=Ie(Ne.last.point.x,Ne.last.point.y,A,v.getElevation).point;if(m&&!p){const Xe=je(e.writingMode,Te,We,q);if(Xe)return Xe}ye=[Ne.first];for(let Xe=e.glyphStartIndex+1;Xe<Ce-1;Xe++)ye.push(Ct(K*P.getoffsetX(Xe),oe,me,p,e.segment,Pe,Oe,v,X));ye.push(Ne.last)}else{if(m&&!p){const Pe=Ie(v.tileAnchorPoint.x,v.tileAnchorPoint.y,b,v.getElevation).point,Oe=e.lineStartIndex+e.segment+1,Ne=new o.P(v.lineVertexArray.getx(Oe),v.lineVertexArray.gety(Oe)),Te=Ie(Ne.x,Ne.y,b,v.getElevation),We=Te.signedDistanceFromCamera>0?Te.point:function(it,mt,Tt,Dt,Nt,Lt){return Ye(it,mt,Tt,1,Nt,Lt)}(v.tileAnchorPoint,Ne,Pe,0,b,v),Xe=je(e.writingMode,Pe,We,q);if(Xe)return Xe}const Ce=Ct(K*P.getoffsetX(e.glyphStartIndex),oe,me,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,v,X);if(!Ce||v.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ye=[Ce]}for(const Ce of ye)o.aj(O,Ce.point,Ce.angle);return{}}function Ye(v,e,c,p,m,b){const A=v.add(v.sub(e)._unit()),P=m!==void 0?Ie(A.x,A.y,m,b.getElevation).point:ot(A.x,A.y,b).point,O=c.sub(P);return c.add(O._mult(p/O.mag()))}function Fe(v,e,c){const p=e.projectionCache;if(p.projections[v])return p.projections[v];const m=new o.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),b=ot(m.x,m.y,e);if(b.signedDistanceFromCamera>0)return p.projections[v]=b.point,p.anyProjectionOccluded=p.anyProjectionOccluded||b.isOccluded,b.point;const A=v-c.direction;return function(P,O,q,X,K){return Ye(P,O,q,X,void 0,K)}(c.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(A),e.lineVertexArray.gety(A)),m,c.previousVertex,c.absOffsetX-c.distanceFromAnchor+1,e)}function ot(v,e,c){const p=v+c.translation[0],m=e+c.translation[1];let b;return!c.pitchWithMap&&c.projection.useSpecialProjectionForSymbols?(b=c.projection.projectTileCoordinates(p,m,c.unwrappedTileID,c.getElevation),b.point.x=(.5*b.point.x+.5)*c.width,b.point.y=(.5*-b.point.y+.5)*c.height):(b=Ie(p,m,c.labelPlaneMatrix,c.getElevation),b.isOccluded=!1),b}function pt(v,e,c){return v._unit()._perp()._mult(e*c)}function rt(v,e,c,p,m,b,A,P,O){if(P.projectionCache.offsets[v])return P.projectionCache.offsets[v];const q=c.add(e);if(v+O.direction<p||v+O.direction>=m)return P.projectionCache.offsets[v]=q,q;const X=Fe(v+O.direction,P,O),K=pt(X.sub(c),A,O.direction),oe=c.add(K),me=X.add(K);return P.projectionCache.offsets[v]=o.ak(b,q,oe,me)||q,P.projectionCache.offsets[v]}function Ct(v,e,c,p,m,b,A,P,O){const q=p?v-e:v+e;let X=q>0?1:-1,K=0;p&&(X*=-1,K=Math.PI),X<0&&(K+=Math.PI);let oe,me=X>0?b+m:b+m+1;P.projectionCache.cachedAnchorPoint?oe=P.projectionCache.cachedAnchorPoint:(oe=ot(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=oe);let ye,Ce,Pe=oe,Oe=oe,Ne=0,Te=0;const We=Math.abs(q),Xe=[];let it;for(;Ne+Te<=We;){if(me+=X,me<b||me>=A)return null;Ne+=Te,Oe=Pe,Ce=ye;const Dt={absOffsetX:We,direction:X,distanceFromAnchor:Ne,previousVertex:Oe};if(Pe=Fe(me,P,Dt),c===0)Xe.push(Oe),it=Pe.sub(Oe);else{let Nt;const Lt=Pe.sub(Oe);Nt=Lt.mag()===0?pt(Fe(me+X,P,Dt).sub(Pe),c,X):pt(Lt,c,X),Ce||(Ce=Oe.add(Nt)),ye=rt(me,Nt,Pe,b,A,Ce,c,P,Dt),Xe.push(Ce),it=ye.sub(Ce)}Te=it.mag()}const mt=it._mult((We-Ne)/Te)._add(Ce||Oe),Tt=K+Math.atan2(Pe.y-Oe.y,Pe.x-Oe.x);return Xe.push(mt),{point:mt,angle:O?Tt:0,path:Xe}}const Xt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ni(v,e){for(let c=0;c<v;c++){const p=e.length;e.resize(p+4),e.float32.set(Xt,3*p)}}function Ri(v,e,c){const p=e[0],m=e[1];return v[0]=c[0]*p+c[4]*m+c[12],v[1]=c[1]*p+c[5]*m+c[13],v[3]=c[3]*p+c[7]*m+c[15],v}const bi=100;class zi{constructor(e,c,p=new dr(e.width+200,e.height+200,25),m=new dr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=c,this.grid=p,this.ignoredGrid=m,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+bi,this.screenBottomBoundary=e.height+bi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,c,p,m,b,A,P,O,q,X,K){const oe=e.anchorPointX+O[0],me=e.anchorPointY+O[1],ye=this.projectAndGetPerspectiveRatio(m,oe,me,b,X),Ce=p*ye.perspectiveRatio;let Pe;if(A||P)Pe=this._projectCollisionBox(e,Ce,m,b,A,P,O,ye,X,K);else{const Xe=ye.point.x+(K?K.x*Ce:0),it=ye.point.y+(K?K.y*Ce:0);Pe={allPointsOccluded:!1,box:[Xe+e.x1*Ce,it+e.y1*Ce,Xe+e.x2*Ce,it+e.y2*Ce]}}const[Oe,Ne,Te,We]=Pe.box;return this.mapProjection.useSpecialProjectionForSymbols&&(A?Pe.allPointsOccluded:this.mapProjection.isOccluded(oe,me,b))||ye.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Oe,Ne,Te,We)||c!=="always"&&this.grid.hitTest(Oe,Ne,Te,We,c,q)?{box:[Oe,Ne,Te,We],placeable:!1,offscreen:!1}:{box:[Oe,Ne,Te,We],placeable:!0,offscreen:this.isOffscreen(Oe,Ne,Te,We)}}placeCollisionCircles(e,c,p,m,b,A,P,O,q,X,K,oe,me,ye,Ce,Pe){const Oe=[],Ne=new o.P(c.anchorX,c.anchorY),Te=this.getPerspectiveRatio(A,Ne.x,Ne.y,P,Pe),We=(K?b/Te:b*Te)/o.ap,Xe={getElevation:Pe,labelPlaneMatrix:O,lineVertexArray:p,pitchWithMap:K,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ne,unwrappedTileID:P,width:this.transform.width,height:this.transform.height,translation:Ce},it=Se(We,m,c.lineOffsetX*We,c.lineOffsetY*We,!1,c,!1,Xe);let mt=!1,Tt=!1,Dt=!0;if(it){const Nt=.5*me*Te+ye,Lt=new o.P(-100,-100),Mt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ht=new ai,vi=it.first,zt=it.last;let Rt=[];for(let Ii=vi.path.length-1;Ii>=1;Ii--)Rt.push(vi.path[Ii]);for(let Ii=1;Ii<zt.path.length;Ii++)Rt.push(zt.path[Ii]);const _i=2.5*Nt;if(q){const Ii=this.projectPathToScreenSpace(Rt,Xe,q);Rt=Ii.some(Ni=>Ni.signedDistanceFromCamera<=0)?[]:Ii.map(Ni=>Ni.point)}let gn=[];if(Rt.length>0){const Ii=Rt[0].clone(),Ni=Rt[0].clone();for(let _n=1;_n<Rt.length;_n++)Ii.x=Math.min(Ii.x,Rt[_n].x),Ii.y=Math.min(Ii.y,Rt[_n].y),Ni.x=Math.max(Ni.x,Rt[_n].x),Ni.y=Math.max(Ni.y,Rt[_n].y);gn=Ii.x>=Lt.x&&Ni.x<=Mt.x&&Ii.y>=Lt.y&&Ni.y<=Mt.y?[Rt]:Ni.x<Lt.x||Ii.x>Mt.x||Ni.y<Lt.y||Ii.y>Mt.y?[]:o.al([Rt],Lt.x,Lt.y,Mt.x,Mt.y)}for(const Ii of gn){Ht.reset(Ii,.25*Nt);let Ni=0;Ni=Ht.length<=.5*Nt?1:Math.ceil(Ht.paddedLength/_i)+1;for(let _n=0;_n<Ni;_n++){const nr=_n/Math.max(Ni-1,1),ms=Ht.lerp(nr),yn=ms.x+bi,Ir=ms.y+bi;Oe.push(yn,Ir,Nt,0);const _r=yn-Nt,rr=Ir-Nt,yr=yn+Nt,Fs=Ir+Nt;if(Dt=Dt&&this.isOffscreen(_r,rr,yr,Fs),Tt=Tt||this.isInsideGrid(_r,rr,yr,Fs),e!=="always"&&this.grid.hitTestCircle(yn,Ir,Nt,e,oe)&&(mt=!0,!X))return{circles:[],offscreen:!1,collisionDetected:mt}}}}return{circles:!X&&mt||!Tt||Te<this.perspectiveRatioCutoff?[]:Oe,offscreen:Dt,collisionDetected:mt}}projectPathToScreenSpace(e,c,p){return e.map(m=>Ie(m.x,m.y,p,c.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,m=1/0,b=-1/0,A=-1/0;for(const X of e){const K=new o.P(X.x+bi,X.y+bi);p=Math.min(p,K.x),m=Math.min(m,K.y),b=Math.max(b,K.x),A=Math.max(A,K.y),c.push(K)}const P=this.grid.query(p,m,b,A).concat(this.ignoredGrid.query(p,m,b,A)),O={},q={};for(const X of P){const K=X.key;if(O[K.bucketInstanceId]===void 0&&(O[K.bucketInstanceId]={}),O[K.bucketInstanceId][K.featureIndex])continue;const oe=[new o.P(X.x1,X.y1),new o.P(X.x2,X.y1),new o.P(X.x2,X.y2),new o.P(X.x1,X.y2)];o.am(c,oe)&&(O[K.bucketInstanceId][K.featureIndex]=!0,q[K.bucketInstanceId]===void 0&&(q[K.bucketInstanceId]=[]),q[K.bucketInstanceId].push(K.featureIndex))}return q}insertCollisionBox(e,c,p,m,b,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:c},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,c,p,m,b,A){const P=p?this.ignoredGrid:this.grid,O={bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:c};for(let q=0;q<e.length;q+=4)P.insertCircle(O,e[q],e[q+1],e[q+2])}projectAndGetPerspectiveRatio(e,c,p,m,b){let A;b?(A=[c,p,b(c,p),1],o.af(A,A,e)):(A=[c,p,0,1],Ri(A,A,e));const P=A[3];return{point:new o.P((A[0]/P+1)/2*this.transform.width+bi,(-A[1]/P+1)/2*this.transform.height+bi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}getPerspectiveRatio(e,c,p,m,b){const A=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(c,p,m,b):Ie(c,p,e,b);return .5+this.transform.cameraToCenterDistance/A.signedDistanceFromCamera*.5}isOffscreen(e,c,p,m){return p<bi||e>=this.screenRightBoundary||m<bi||c>this.screenBottomBoundary}isInsideGrid(e,c,p,m){return p>=0&&e<this.gridRightBoundary&&m>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const e=o.an([]);return o.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,c,p,m,b,A,P,O,q,X){let K=new o.P(1,0),oe=new o.P(0,1);const me=new o.P(e.anchorPointX+P[0],e.anchorPointY+P[1]);if(A&&!b){const Dt=this.projectAndGetPerspectiveRatio(p,me.x+1,me.y,m,q).point.sub(O.point).unit(),Nt=Math.atan(Dt.y/Dt.x)+(Dt.x<0?Math.PI:0),Lt=Math.sin(Nt),Mt=Math.cos(Nt);K=new o.P(Mt,Lt),oe=new o.P(-Lt,Mt)}else if(!A&&b){const Dt=-this.transform.angle,Nt=Math.sin(Dt),Lt=Math.cos(Dt);K=new o.P(Lt,Nt),oe=new o.P(-Nt,Lt)}let ye=O.point,Ce=c;if(b){ye=me;const Dt=this.transform.zoom-Math.floor(this.transform.zoom);Ce=Math.pow(2,-Dt),Ce*=this.mapProjection.getPitchedTextCorrection(this.transform,me,m),X||(Ce*=o.ac(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}X&&(ye=ye.add(K.mult(X.x*Ce)).add(oe.mult(X.y*Ce)));const Pe=e.x1*Ce,Oe=e.x2*Ce,Ne=(Pe+Oe)/2,Te=e.y1*Ce,We=e.y2*Ce,Xe=(Te+We)/2,it=[{offsetX:Pe,offsetY:Te},{offsetX:Ne,offsetY:Te},{offsetX:Oe,offsetY:Te},{offsetX:Oe,offsetY:Xe},{offsetX:Oe,offsetY:We},{offsetX:Ne,offsetY:We},{offsetX:Pe,offsetY:We},{offsetX:Pe,offsetY:Xe}];let mt=[];for(const{offsetX:Dt,offsetY:Nt}of it)mt.push(new o.P(ye.x+K.x*Dt+oe.x*Nt,ye.y+K.y*Dt+oe.y*Nt));let Tt=!1;if(b){const Dt=mt.map(Nt=>this.projectAndGetPerspectiveRatio(p,Nt.x,Nt.y,m,q));Tt=Dt.some(Nt=>!Nt.isOccluded),mt=Dt.map(Nt=>Nt.point)}else Tt=!0;return{box:o.ao(mt),allPointsOccluded:!Tt}}}function xi(v,e,c){return e*(o.X/(v.tileSize*Math.pow(2,c-v.tileID.overscaledZ)))}class un{constructor(e,c,p,m){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?c:-c))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class hn{constructor(e,c,p,m,b){this.text=new un(e?e.text:null,c,p,b),this.icon=new un(e?e.icon:null,c,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class He{constructor(e,c,p){this.text=e,this.icon=c,this.skipFade=p}}class hi{constructor(){this.invProjMatrix=o.H(),this.viewportMatrix=o.H(),this.circles=[]}}class wi{constructor(e,c,p,m,b){this.bucketInstanceId=e,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class Bi{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const c=++this.maxGroupID;this.collisionGroups[e]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[e]}}function Gi(v,e,c,p,m){const{horizontalAlign:b,verticalAlign:A}=o.au(v);return new o.P(-(b-.5)*e+p[0]*m,-(A-.5)*c+p[1]*m)}class Hi{constructor(e,c,p,m,b,A){this.transform=e.clone(),this.terrain=p,this.collisionIndex=new zi(this.transform,c),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Bi(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const c=this.terrain;return c?(p,m)=>c.getElevation(e,p,m):null}getBucketParts(e,c,p,m){const b=p.getBucket(c),A=p.latestFeatureIndex;if(!b||!A||c.id!==b.layerIds[0])return;const P=p.collisionBoxArray,O=b.layers[0].layout,q=b.layers[0].paint,X=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),K=p.tileSize/o.X,oe=p.tileID.toUnwrapped(),me=this.transform.calculatePosMatrix(oe),ye=O.get("text-pitch-alignment")==="map",Ce=O.get("text-rotation-alignment")==="map",Pe=xi(p,1,this.transform.zoom),Oe=this.collisionIndex.mapProjection.translatePosition(this.transform,p,q.get("text-translate"),q.get("text-translate-anchor")),Ne=this.collisionIndex.mapProjection.translatePosition(this.transform,p,q.get("icon-translate"),q.get("icon-translate-anchor")),Te=Sr(me,ye,Ce,this.transform,Pe);let We=null;if(ye){const it=Tr(me,ye,Ce,this.transform,Pe);We=o.L([],this.transform.labelPlaneMatrix,it)}this.retainedQueryData[b.bucketInstanceId]=new wi(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,p.tileID);const Xe={bucket:b,layout:O,translationText:Oe,translationIcon:Ne,posMatrix:me,unwrappedTileID:oe,textLabelPlaneMatrix:Te,labelToScreenMatrix:We,scale:X,textPixelRatio:K,holdingForFade:p.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:o.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const it of b.sortKeyRanges){const{sortKey:mt,symbolInstanceStart:Tt,symbolInstanceEnd:Dt}=it;e.push({sortKey:mt,symbolInstanceStart:Tt,symbolInstanceEnd:Dt,parameters:Xe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Xe})}attemptAnchorPlacement(e,c,p,m,b,A,P,O,q,X,K,oe,me,ye,Ce,Pe,Oe,Ne,Te){const We=o.aq[e.textAnchor],Xe=[e.textOffset0,e.textOffset1],it=Gi(We,p,m,Xe,b),mt=this.collisionIndex.placeCollisionBox(c,oe,O,q,X,P,A,Pe,K.predicate,Te,it);if((!Ne||this.collisionIndex.placeCollisionBox(Ne,oe,O,q,X,P,A,Oe,K.predicate,Te,it).placeable)&&mt.placeable){let Tt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(Tt=this.prevPlacement.variableOffsets[me.crossTileID].anchor),me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[me.crossTileID]={textOffset:Xe,width:p,height:m,anchor:We,textBoxScale:b,prevAnchor:Tt},this.markUsedJustification(ye,We,me,Ce),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,Ce,me),this.placedOrientations[me.crossTileID]=Ce),{shift:it,placedGlyphBoxes:mt}}}placeLayerBucketPart(e,c,p){const{bucket:m,layout:b,translationText:A,translationIcon:P,posMatrix:O,unwrappedTileID:q,textLabelPlaneMatrix:X,labelToScreenMatrix:K,textPixelRatio:oe,holdingForFade:me,collisionBoxArray:ye,partiallyEvaluatedTextSize:Ce,collisionGroup:Pe}=e.parameters,Oe=b.get("text-optional"),Ne=b.get("icon-optional"),Te=o.ar(b,"text-overlap","text-allow-overlap"),We=Te==="always",Xe=o.ar(b,"icon-overlap","icon-allow-overlap"),it=Xe==="always",mt=b.get("text-rotation-alignment")==="map",Tt=b.get("text-pitch-alignment")==="map",Dt=b.get("icon-text-fit")!=="none",Nt=b.get("symbol-z-order")==="viewport-y",Lt=We&&(it||!m.hasIconData()||Ne),Mt=it&&(We||!m.hasTextData()||Oe);!m.collisionArrays&&ye&&m.deserializeCollisionBoxes(ye);const Ht=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),vi=(zt,Rt,_i)=>{var gn,Ii;if(c[zt.crossTileID])return;if(me)return void(this.placements[zt.crossTileID]=new He(!1,!1,!1));let Ni=!1,_n=!1,nr=!0,ms=null,yn={box:null,placeable:!1,offscreen:null},Ir={placeable:!1},_r=null,rr=null,yr=null,Fs=0,Na=0,pc=0;Rt.textFeatureIndex?Fs=Rt.textFeatureIndex:zt.useRuntimeCollisionCircles&&(Fs=zt.featureIndex),Rt.verticalTextFeatureIndex&&(Na=Rt.verticalTextFeatureIndex);const ja=Rt.textBox;if(ja){const rs=er=>{let sr=o.ah.horizontal;if(m.allowVerticalPlacement&&!er&&this.prevPlacement){const Vr=this.prevPlacement.placedOrientations[zt.crossTileID];Vr&&(this.placedOrientations[zt.crossTileID]=Vr,sr=Vr,this.markUsedOrientation(m,sr,zt))}return sr},ss=(er,sr)=>{if(m.allowVerticalPlacement&&zt.numVerticalGlyphVertices>0&&Rt.verticalTextBox){for(const Vr of m.writingModes)if(Vr===o.ah.vertical?(yn=sr(),Ir=yn):yn=er(),yn&&yn.placeable)break}else yn=er()},Eo=zt.textAnchorOffsetStartIndex,gs=zt.textAnchorOffsetEndIndex;if(gs===Eo){const er=(sr,Vr)=>{const Ui=this.collisionIndex.placeCollisionBox(sr,Te,oe,O,q,Tt,mt,A,Pe.predicate,Ht);return Ui&&Ui.placeable&&(this.markUsedOrientation(m,Vr,zt),this.placedOrientations[zt.crossTileID]=Vr),Ui};ss(()=>er(ja,o.ah.horizontal),()=>{const sr=Rt.verticalTextBox;return m.allowVerticalPlacement&&zt.numVerticalGlyphVertices>0&&sr?er(sr,o.ah.vertical):{box:null,offscreen:null}}),rs(yn&&yn.placeable)}else{let er=o.aq[(Ii=(gn=this.prevPlacement)===null||gn===void 0?void 0:gn.variableOffsets[zt.crossTileID])===null||Ii===void 0?void 0:Ii.anchor];const sr=(Ui,sa,Ua)=>{const Va=Ui.x2-Ui.x1,Th=Ui.y2-Ui.y1,Lf=zt.textBoxScale,kh=Dt&&Xe==="never"?sa:null;let Io=null,Ch=Te==="never"?1:2,gc="never";er&&Ch++;for(let Tl=0;Tl<Ch;Tl++){for(let _c=Eo;_c<gs;_c++){const yc=m.textAnchorOffsets.get(_c);if(er&&yc.textAnchor!==er)continue;const qa=this.attemptAnchorPlacement(yc,Ui,Va,Th,Lf,mt,Tt,oe,O,q,Pe,gc,zt,m,Ua,A,P,kh,Ht);if(qa&&(Io=qa.placedGlyphBoxes,Io&&Io.placeable))return Ni=!0,ms=qa.shift,Io}er?er=null:gc=Te}return p&&!Io&&(Io={box:this.collisionIndex.placeCollisionBox(ja,"always",oe,O,q,Tt,mt,A,Pe.predicate,Ht,new o.P(0,0)).box,offscreen:!1,placeable:!1}),Io};ss(()=>sr(ja,Rt.iconBox,o.ah.horizontal),()=>{const Ui=Rt.verticalTextBox;return m.allowVerticalPlacement&&(!yn||!yn.placeable)&&zt.numVerticalGlyphVertices>0&&Ui?sr(Ui,Rt.verticalIconBox,o.ah.vertical):{box:null,occluded:!0,offscreen:null}}),yn&&(Ni=yn.placeable,nr=yn.offscreen);const Vr=rs(yn&&yn.placeable);if(!Ni&&this.prevPlacement){const Ui=this.prevPlacement.variableOffsets[zt.crossTileID];Ui&&(this.variableOffsets[zt.crossTileID]=Ui,this.markUsedJustification(m,Ui.anchor,zt,Vr))}}}if(_r=yn,Ni=_r&&_r.placeable,nr=_r&&_r.offscreen,zt.useRuntimeCollisionCircles){const rs=m.text.placedSymbolArray.get(zt.centerJustifiedTextSymbolIndex),ss=o.ai(m.textSizeData,Ce,rs),Eo=b.get("text-padding");rr=this.collisionIndex.placeCollisionCircles(Te,rs,m.lineVertexArray,m.glyphOffsetArray,ss,O,q,X,K,p,Tt,Pe.predicate,zt.collisionCircleDiameter,Eo,A,Ht),rr.circles.length&&rr.collisionDetected&&!p&&o.w("Collisions detected, but collision boxes are not shown"),Ni=We||rr.circles.length>0&&!rr.collisionDetected,nr=nr&&rr.offscreen}if(Rt.iconFeatureIndex&&(pc=Rt.iconFeatureIndex),Rt.iconBox){const rs=ss=>this.collisionIndex.placeCollisionBox(ss,Xe,oe,O,q,Tt,mt,P,Pe.predicate,Ht,Dt&&ms?ms:void 0);Ir&&Ir.placeable&&Rt.verticalIconBox?(yr=rs(Rt.verticalIconBox),_n=yr.placeable):(yr=rs(Rt.iconBox),_n=yr.placeable),nr=nr&&yr.offscreen}const ns=Oe||zt.numHorizontalGlyphVertices===0&&zt.numVerticalGlyphVertices===0,mc=Ne||zt.numIconVertices===0;ns||mc?mc?ns||(_n=_n&&Ni):Ni=_n&&Ni:_n=Ni=_n&&Ni;const Tu=_n&&yr.placeable;if(Ni&&_r.placeable&&this.collisionIndex.insertCollisionBox(_r.box,Te,b.get("text-ignore-placement"),m.bucketInstanceId,Ir&&Ir.placeable&&Na?Na:Fs,Pe.ID),Tu&&this.collisionIndex.insertCollisionBox(yr.box,Xe,b.get("icon-ignore-placement"),m.bucketInstanceId,pc,Pe.ID),rr&&Ni&&this.collisionIndex.insertCollisionCircles(rr.circles,Te,b.get("text-ignore-placement"),m.bucketInstanceId,Fs,Pe.ID),p&&this.storeCollisionData(m.bucketInstanceId,_i,Rt,_r,yr,rr),zt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[zt.crossTileID]=new He(Ni||Lt,_n||Mt,nr||m.justReloaded),c[zt.crossTileID]=!0};if(Nt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const zt=m.getSortedSymbolIndexes(this.transform.angle);for(let Rt=zt.length-1;Rt>=0;--Rt){const _i=zt[Rt];vi(m.symbolInstances.get(_i),m.collisionArrays[_i],_i)}}else for(let zt=e.symbolInstanceStart;zt<e.symbolInstanceEnd;zt++)vi(m.symbolInstances.get(zt),m.collisionArrays[zt],zt);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const zt=this.collisionCircleArrays[m.bucketInstanceId];o.as(zt.invProjMatrix,O),zt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(e,c,p,m,b,A){if(p.textBox||p.iconBox){let P,O;this.collisionBoxArrays.has(e)?P=this.collisionBoxArrays.get(e):(P=new Map,this.collisionBoxArrays.set(e,P)),P.has(c)?O=P.get(c):(O={text:null,icon:null},P.set(c,O)),p.textBox&&(O.text=m.box),p.iconBox&&(O.icon=b.box)}if(A){let P=this.collisionCircleArrays[e];P===void 0&&(P=this.collisionCircleArrays[e]=new hi);for(let O=0;O<A.circles.length;O+=4)P.circles.push(A.circles[O+0]),P.circles.push(A.circles[O+1]),P.circles.push(A.circles[O+2]),P.circles.push(A.collisionDetected?1:0)}}markUsedJustification(e,c,p,m){let b;b=m===o.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[o.at(c)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const P of A)P>=0&&(e.text.placedSymbolArray.get(P).crossTileID=b>=0&&P!==b?0:p.crossTileID)}markUsedOrientation(e,c,p){const m=c===o.ah.horizontal||c===o.ah.horizontalOnly?c:0,b=c===o.ah.vertical?c:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const P of A)e.text.placedSymbolArray.get(P).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const m=c?c.symbolFadeChange(e):1,b=c?c.opacities:{},A=c?c.variableOffsets:{},P=c?c.placedOrientations:{};for(const O in this.placements){const q=this.placements[O],X=b[O];X?(this.opacities[O]=new hn(X,m,q.text,q.icon),p=p||q.text!==X.text.placed||q.icon!==X.icon.placed):(this.opacities[O]=new hn(null,m,q.text,q.icon,q.skipFade),p=p||q.text||q.icon)}for(const O in b){const q=b[O];if(!this.opacities[O]){const X=new hn(q,m,!1,!1);X.isHidden()||(this.opacities[O]=X,p=p||q.text.placed||q.icon.placed)}}for(const O in A)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=A[O]);for(const O in P)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=P[O]);if(c&&c.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:e)}updateLayerOpacities(e,c){const p={};for(const m of c){const b=m.getBucket(e);b&&m.latestFeatureIndex&&e.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(e,c,p,m){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const b=e.layers[0],A=b.layout,P=new hn(null,0,!1,!1,!0),O=A.get("text-allow-overlap"),q=A.get("icon-allow-overlap"),X=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),K=A.get("text-rotation-alignment")==="map",oe=A.get("text-pitch-alignment")==="map",me=A.get("icon-text-fit")!=="none",ye=new hn(null,0,O&&(q||!e.hasIconData()||A.get("icon-optional")),q&&(O||!e.hasTextData()||A.get("text-optional")),!0);!e.collisionArrays&&m&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(m);const Ce=(Oe,Ne,Te)=>{for(let We=0;We<Ne/4;We++)Oe.opacityVertexArray.emplaceBack(Te);Oe.hasVisibleVertices=Oe.hasVisibleVertices||Te!==Dr},Pe=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Oe=0;Oe<e.symbolInstances.length;Oe++){const Ne=e.symbolInstances.get(Oe),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:We,crossTileID:Xe}=Ne;let it=this.opacities[Xe];p[Xe]?it=P:it||(it=ye,this.opacities[Xe]=it),p[Xe]=!0;const mt=Ne.numIconVertices>0,Tt=this.placedOrientations[Ne.crossTileID],Dt=Tt===o.ah.vertical,Nt=Tt===o.ah.horizontal||Tt===o.ah.horizontalOnly;if(Te>0||We>0){const Mt=Hn(it.text);Ce(e.text,Te,Dt?Dr:Mt),Ce(e.text,We,Nt?Dr:Mt);const Ht=it.text.isHidden();[Ne.rightJustifiedTextSymbolIndex,Ne.centerJustifiedTextSymbolIndex,Ne.leftJustifiedTextSymbolIndex].forEach(Rt=>{Rt>=0&&(e.text.placedSymbolArray.get(Rt).hidden=Ht||Dt?1:0)}),Ne.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Ne.verticalPlacedTextSymbolIndex).hidden=Ht||Nt?1:0);const vi=this.variableOffsets[Ne.crossTileID];vi&&this.markUsedJustification(e,vi.anchor,Ne,Tt);const zt=this.placedOrientations[Ne.crossTileID];zt&&(this.markUsedJustification(e,"left",Ne,zt),this.markUsedOrientation(e,zt,Ne))}if(mt){const Mt=Hn(it.icon),Ht=!(me&&Ne.verticalPlacedIconSymbolIndex&&Dt);Ne.placedIconSymbolIndex>=0&&(Ce(e.icon,Ne.numIconVertices,Ht?Mt:Dr),e.icon.placedSymbolArray.get(Ne.placedIconSymbolIndex).hidden=it.icon.isHidden()),Ne.verticalPlacedIconSymbolIndex>=0&&(Ce(e.icon,Ne.numVerticalIconVertices,Ht?Dr:Mt),e.icon.placedSymbolArray.get(Ne.verticalPlacedIconSymbolIndex).hidden=it.icon.isHidden())}const Lt=Pe&&Pe.has(Oe)?Pe.get(Oe):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Mt=e.collisionArrays[Oe];if(Mt){let Ht=new o.P(0,0);if(Mt.textBox||Mt.verticalTextBox){let vi=!0;if(X){const zt=this.variableOffsets[Xe];zt?(Ht=Gi(zt.anchor,zt.width,zt.height,zt.textOffset,zt.textBoxScale),K&&Ht._rotate(oe?this.transform.angle:-this.transform.angle)):vi=!1}if(Mt.textBox||Mt.verticalTextBox){let zt;Mt.textBox&&(zt=Dt),Mt.verticalTextBox&&(zt=Nt),jn(e.textCollisionBox.collisionVertexArray,it.text.placed,!vi||zt,Lt.text,Ht.x,Ht.y)}}if(Mt.iconBox||Mt.verticalIconBox){const vi=!!(!Nt&&Mt.verticalIconBox);let zt;Mt.iconBox&&(zt=vi),Mt.verticalIconBox&&(zt=!vi),jn(e.iconCollisionBox.collisionVertexArray,it.icon.placed,zt,Lt.icon,me?Ht.x:0,me?Ht.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Oe.invProjMatrix,e.placementViewportMatrix=Oe.viewportMatrix,e.collisionCircleArray=Oe.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>e}setStale(){this.stale=!0}}function jn(v,e,c,p,m,b){p&&p.length!==0||(p=[0,0,0,0]);const A=p[0]-bi,P=p[1]-bi,O=p[2]-bi,q=p[3]-bi;v.emplaceBack(e?1:0,c?1:0,m||0,b||0,A,P),v.emplaceBack(e?1:0,c?1:0,m||0,b||0,O,P),v.emplaceBack(e?1:0,c?1:0,m||0,b||0,O,q),v.emplaceBack(e?1:0,c?1:0,m||0,b||0,A,q)}const ri=Math.pow(2,25),Xr=Math.pow(2,24),Gn=Math.pow(2,17),Un=Math.pow(2,16),pn=Math.pow(2,9),ma=Math.pow(2,8),zn=Math.pow(2,1);function Hn(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const e=v.placed?1:0,c=Math.floor(127*v.opacity);return c*ri+e*Xr+c*Gn+e*Un+c*pn+e*ma+c*zn+e}const Dr=0;function Rn(){return{isOccluded:(v,e,c)=>!1,getPitchedTextCorrection:(v,e,c)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(v,e,c,p){throw new Error("Not implemented.")},translatePosition:(v,e,c,p)=>function(m,b,A,P,O=!1){if(!A[0]&&!A[1])return[0,0];const q=O?P==="map"?m.angle:0:P==="viewport"?-m.angle:0;if(q){const X=Math.sin(q),K=Math.cos(q);A=[A[0]*K-A[1]*X,A[0]*X+A[1]*K]}return[O?A[0]:xi(b,A[0],m.zoom),O?A[1]:xi(b,A[1],m.zoom)]}(v,e,c,p),getCircleRadiusCorrection:v=>1}}class Ei{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,c,p,m,b){const A=this._bucketParts;for(;this._currentTileIndex<e.length;)if(c.getBucketParts(A,m,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((P,O)=>P.sortKey-O.sortKey));this._currentPartIndex<A.length;)if(c.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class No{constructor(e,c,p,m,b,A,P,O){this.placement=new Hi(e,Rn(),c,A,P,O),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(e,c,p){const m=y.now(),b=()=>!this._forceFullPlacement&&y.now()-m>2;for(;this._currentPlacementIndex>=0;){const A=c[e[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=P)&&(!A.maxzoom||A.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Ei(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ir=512/o.X/2;class En{constructor(e,c,p){this.tileID=e,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<c.length;b++){const A=c.get(b),P=A.key,O=m.get(P);O?O.push(A):m.set(P,[A])}for(const[b,A]of m){const P={positions:A.map(O=>({x:Math.floor(O.anchorX*ir),y:Math.floor(O.anchorY*ir)})),crossTileIDs:A.map(O=>O.crossTileID)};if(P.positions.length>128){const O=new o.av(P.positions.length,16,Uint16Array);for(const{x:q,y:X}of P.positions)O.add(q,X);O.finish(),delete P.positions,P.index=O}this._symbolsByKey[b]=P}}getScaledCoordinates(e,c){const{x:p,y:m,z:b}=this.tileID.canonical,{x:A,y:P,z:O}=c.canonical,q=ir/Math.pow(2,O-b),X=(P*o.X+e.anchorY)*q,K=m*o.X*ir;return{x:Math.floor((A*o.X+e.anchorX)*q-p*o.X*ir),y:Math.floor(X-K)}}findMatches(e,c,p){const m=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let b=0;b<e.length;b++){const A=e.get(b);if(A.crossTileID)continue;const P=this._symbolsByKey[A.key];if(!P)continue;const O=this.getScaledCoordinates(A,c);if(P.index){const q=P.index.range(O.x-m,O.y-m,O.x+m,O.y+m).sort();for(const X of q){const K=P.crossTileIDs[X];if(!p[K]){p[K]=!0,A.crossTileID=K;break}}}else if(P.positions)for(let q=0;q<P.positions.length;q++){const X=P.positions[q],K=P.crossTileIDs[q];if(Math.abs(X.x-O.x)<=m&&Math.abs(X.y-O.y)<=m&&!p[K]){p[K]=!0,A.crossTileID=K;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ga{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const c=Math.round((e-this.lng)/360);if(c!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const A in m){const P=m[A];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+c),b[P.tileID.key]=P}this.indexes[p]=b}this.lng=e}addBucket(e,c,p){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const m=this.usedCrossTileIDs[e.overscaledZ];for(const b in this.indexes){const A=this.indexes[b];if(Number(b)>e.overscaledZ)for(const P in A){const O=A[P];O.tileID.isChildOf(e)&&O.findMatches(c.symbolInstances,e,m)}else{const P=A[e.scaledTo(Number(b)).key];P&&P.findMatches(c.symbolInstances,e,m)}}for(let b=0;b<c.symbolInstances.length;b++){const A=c.symbolInstances.get(b);A.crossTileID||(A.crossTileID=p.generate(),m[A.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new En(e,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(e,c){for(const p of c.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[e][m]}removeStaleBuckets(e){let c=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)e[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],c=!0)}return c}}class ol{constructor(){this.layerIndexes={},this.crossTileIDs=new ga,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,c,p){let m=this.layerIndexes[e.id];m===void 0&&(m=this.layerIndexes[e.id]=new Fr);let b=!1;const A={};m.handleWrapJump(p);for(const P of c){const O=P.getBucket(e);O&&e.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(P.tileID,O,this.crossTileIDs)&&(b=!0),A[O.bucketInstanceId]=!0)}return m.removeStaleBuckets(A)&&(b=!0),b}pruneUnusedLayers(e){const c={};e.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Rr=(v,e)=>o.t(v,e&&e.filter(c=>c.identifier!=="source.canvas")),eu=o.aw();class _a extends o.E{constructor(e,c={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=e,this.dispatcher=new Mi(Ai(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new le,this.imageManager.setEventedParent(this),this.glyphManager=new ce(e._requestManager,c.localIdeographFontFamily),this.lineAtlas=new At(256,512),this.crossTileSymbolIndex=new ol,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.ay()),Fi().on(lt,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const A in this._layers){const P=this._layers[A];P.source===b.id&&this._validateLayer(P)}})}loadURL(e,c={},p){this.fire(new o.k("dataloading",{dataType:"style"})),c.validate=typeof c.validate!="boolean"||c.validate;const m=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;o.h(m,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,c,p)}).catch(A=>{this._loadStyleRequest=null,A&&!b.signal.aborted&&this.fire(new o.j(A))})}loadJSON(e,c={},p){this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,c.validate=c.validate!==!1,this._load(e,c,p)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(eu,{validate:!1})}_load(e,c,p){var m;const b=c.transformStyle?c.transformStyle(p,e):e;if(!c.validate||!Rr(this,o.u(b))){this._loaded=!0,this.stylesheet=b;for(const A in b.sources)this.addSource(A,b.sources[A],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new ct(this.stylesheet.light),this.sky=new bt(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const e=o.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(c=>c.id),this._layers={},this._serializedLayers=null;for(const c of e){const p=o.aA(c);p.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=p}}_loadSprite(e,c=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,A,P,O){return o._(this,void 0,void 0,function*(){const q=U(b),X=P>1?"@2x":"",K={},oe={};for(const{id:me,url:ye}of q){const Ce=A.transformRequest(J(ye,X,".json"),"SpriteJSON");K[me]=o.h(Ce,O);const Pe=A.transformRequest(J(ye,X,".png"),"SpriteImage");oe[me]=Z.getImage(Pe,O)}return yield Promise.all([...Object.values(K),...Object.values(oe)]),function(me,ye){return o._(this,void 0,void 0,function*(){const Ce={};for(const Pe in me){Ce[Pe]={};const Oe=y.getImageCanvasContext((yield ye[Pe]).data),Ne=(yield me[Pe]).data;for(const Te in Ne){const{width:We,height:Xe,x:it,y:mt,sdf:Tt,pixelRatio:Dt,stretchX:Nt,stretchY:Lt,content:Mt,textFitWidth:Ht,textFitHeight:vi}=Ne[Te];Ce[Pe][Te]={data:null,pixelRatio:Dt,sdf:Tt,stretchX:Nt,stretchY:Lt,content:Mt,textFitWidth:Ht,textFitHeight:vi,spriteData:{width:We,height:Xe,x:it,y:mt,context:Oe}}}}return Ce})}(K,oe)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const A in b){this._spritesImagesIds[A]=[];const P=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter(O=>!(O in b)):[];for(const O of P)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in b[A]){const q=A==="default"?O:`${A}:${O}`;this._spritesImagesIds[A].push(q),q in this.imageManager.images?this.imageManager.updateImage(q,b[A][O],!1):this.imageManager.addImage(q,b[A][O]),c&&(this._changedImages[q]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new o.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),c&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(e){const c=this.sourceCaches[e.source];if(!c)return;const p=e.sourceLayer;if(!p)return;const m=c.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,c=!1){const p=this._serializedAllLayers();if(!e||e.length===0)return Object.values(c?o.aB(p):p);const m=[];for(const b of e)if(p[b]){const A=c?o.aB(p[b]):p[b];m.push(A)}return m}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const c=Object.keys(this._layers);for(const p of c){const m=this._layers[p];m.type!=="custom"&&(e[p]=m.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const c=this._changed;if(c){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const A in this._updatedSources){const P=this._updatedSources[A];if(P==="reload")this._reloadSource(A);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(e,this._availableImages),!b.isHidden(e.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,c&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,c){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,c={}){var p;this._checkLoaded();const m=this.serialize();if(e=c.transformStyle?c.transformStyle(m,e):e,((p=c.validate)===null||p===void 0||p)&&Rr(this,o.u(e)))return!1;(e=o.aB(e)).layers=o.az(e.layers);const b=o.aC(m,e),A=this._getOperationsToPerform(b);if(A.unimplemented.length>0)throw new Error(`Unimplemented: ${A.unimplemented.join(", ")}.`);if(A.operations.length===0)return!1;for(const P of A.operations)P();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const c=[],p=[];for(const m of e)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":c.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":c.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":c.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":c.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":c.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":c.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":c.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":c.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":c.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":c.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":c.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":c.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":c.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":c.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":c.push(()=>{});break;default:p.push(m.command)}return{operations:c,unimplemented:p}}addImage(e,c){if(this.getImage(e))return this.fire(new o.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,c),this._afterImageUpdated(e)}updateImage(e,c){this.imageManager.updateImage(e,c)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,c,p={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(o.u.source,`sources.${e}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const m=this.sourceCaches[e]=new ti(e,c,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:e})),m.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===e)return this.fire(new o.j(new Error(`Source "${e}" cannot be removed while layer "${p}" is using it.`)));const c=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],c.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),c.setEventedParent(null),c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,c){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const p=this.sourceCaches[e].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(c),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,c,p={}){this._checkLoaded();const m=e.id;if(this.getLayer(m))return void this.fire(new o.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(e.type==="custom"){if(Rr(this,o.aD(e)))return;b=o.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(m,e.source),e=o.aB(e),e=o.e(e,{source:m})),this._validate(o.u.layer,`layers.${m}`,e,{arrayIndex:-1},p))return;b=o.aA(e),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const A=c?this._order.indexOf(c):this._order.length;if(c&&A===-1)this.fire(new o.j(new Error(`Cannot add layer "${m}" before non-existing layer "${c}".`)));else{if(this._order.splice(A,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const P=this._removedLayers[m];delete this._removedLayers[m],P.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(e,c){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===c)return;const p=this._order.indexOf(e);this._order.splice(p,1);const m=c?this._order.indexOf(c):this._order.length;c&&m===-1?this.fire(new o.j(new Error(`Cannot move layer "${e}" before non-existing layer "${c}".`))):(this._order.splice(m,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const c=this._layers[e];if(!c)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${e}".`)));c.setEventedParent(null);const p=this._order.indexOf(e);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=c,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],c.onRemove&&c.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,c,p){this._checkLoaded();const m=this.getLayer(e);m?m.minzoom===c&&m.maxzoom===p||(c!=null&&(m.minzoom=c),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,c,p={}){this._checkLoaded();const m=this.getLayer(e);if(m){if(!o.aE(m.filter,c))return c==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.u.filter,`layers.${m.id}.filter`,c,null,p)||(m.filter=o.aB(c),this._updateLayer(m)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.aB(this.getLayer(e).filter)}setLayoutProperty(e,c,p,m={}){this._checkLoaded();const b=this.getLayer(e);b?o.aE(b.getLayoutProperty(c),p)||(b.setLayoutProperty(c,p,m),this._updateLayer(b)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,c){const p=this.getLayer(e);if(p)return p.getLayoutProperty(c);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,c,p,m={}){this._checkLoaded();const b=this.getLayer(e);b?o.aE(b.getPaintProperty(c),p)||(b.setPaintProperty(c,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,c){return this.getLayer(e).getPaintProperty(c)}setFeatureState(e,c){this._checkLoaded();const p=e.source,m=e.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new o.j(new Error(`The source '${p}' does not exist in the map's style.`)));const A=b.getSource().type;A==="geojson"&&m?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||m?(e.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,e.id,c)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,c){this._checkLoaded();const p=e.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new o.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,A=b==="vector"?e.sourceLayer:void 0;b!=="vector"||A?c&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(A,e.id,c):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const c=e.source,p=e.sourceLayer,m=this.sourceCaches[c];if(m!==void 0)return m.getSource().type!=="vector"||p?(e.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,e.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=o.aF(this.sourceCaches,b=>b.serialize()),c=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return o.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:e,layers:c,terrain:p},b=>b!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const c=A=>this._layers[A].type==="fill-extrusion",p={},m=[];for(let A=this._order.length-1;A>=0;A--){const P=this._order[A];if(c(P)){p[P]=A;for(const O of e){const q=O[P];if(q)for(const X of q)m.push(X)}}}m.sort((A,P)=>P.intersectionZ-A.intersectionZ);const b=[];for(let A=this._order.length-1;A>=0;A--){const P=this._order[A];if(c(P))for(let O=m.length-1;O>=0;O--){const q=m[O].feature;if(p[q.layer.id]<A)break;b.push(q),m.pop()}else for(const O of e){const q=O[P];if(q)for(const X of q)b.push(X.feature)}}return b}queryRenderedFeatures(e,c,p){c&&c.filter&&this._validate(o.u.filter,"queryRenderedFeatures.filter",c.filter,null,c);const m={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const O=this._layers[P];if(!O)return this.fire(new o.j(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];m[O.source]=!0}}const b=[];c.availableImages=this._availableImages;const A=this._serializedAllLayers();for(const P in this.sourceCaches)c.layers&&!m[P]||b.push(Ge(this.sourceCaches[P],this._layers,A,e,c,p));return this.placement&&b.push(function(P,O,q,X,K,oe,me){const ye={},Ce=oe.queryRenderedSymbols(X),Pe=[];for(const Oe of Object.keys(Ce).map(Number))Pe.push(me[Oe]);Pe.sort(Pt);for(const Oe of Pe){const Ne=Oe.featureIndex.lookupSymbolFeatures(Ce[Oe.bucketInstanceId],O,Oe.bucketIndex,Oe.sourceLayerIndex,K.filter,K.layers,K.availableImages,P);for(const Te in Ne){const We=ye[Te]=ye[Te]||[],Xe=Ne[Te];Xe.sort((it,mt)=>{const Tt=Oe.featureSortOrder;if(Tt){const Dt=Tt.indexOf(it.featureIndex);return Tt.indexOf(mt.featureIndex)-Dt}return mt.featureIndex-it.featureIndex});for(const it of Xe)We.push(it)}}for(const Oe in ye)ye[Oe].forEach(Ne=>{const Te=Ne.feature,We=q[P[Oe].source].getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=We});return ye}(this._layers,A,this.sourceCaches,e,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(e,c){c&&c.filter&&this._validate(o.u.filter,"querySourceFeatures.filter",c.filter,null,c);const p=this.sourceCaches[e];return p?function(m,b){const A=m.getRenderableIds().map(q=>m.getTileByID(q)),P=[],O={};for(let q=0;q<A.length;q++){const X=A[q],K=X.tileID.canonical.key;O[K]||(O[K]=!0,X.querySourceFeatures(P,b))}return P}(p,c):[]}getLight(){return this.light.getLight()}setLight(e,c={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const A in e)if(!o.aE(e[A],p[A])){m=!0;break}if(!m)return;const b={now:y.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,c),this.light.updateTransitions(b)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,c={}){const p=this.getSky();let m=!1;if(!e&&!p)return;if(e&&!p)m=!0;else if(!e&&p)m=!0;else for(const A in e)if(!o.aE(e[A],p[A])){m=!0;break}if(!m)return;const b={now:y.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,c),this.sky.updateTransitions(b)}_validate(e,c,p,m,b={}){return(!b||b.validate!==!1)&&Rr(this,e.call(o.u,o.e({key:c,style:this.serialize(),value:p,styleSpec:o.v},m)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Fi().off(lt,this._rtlPluginLoaded);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this.sourceCaches){const p=this.sourceCaches[c];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const c in this.sourceCaches)this.sourceCaches[c].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,c,p,m,b=!1){let A=!1,P=!1;const O={};for(const q of this._order){const X=this._layers[q];if(X.type!=="symbol")continue;if(!O[X.source]){const oe=this.sourceCaches[X.source];O[X.source]=oe.getRenderableIds(!0).map(me=>oe.getTileByID(me)).sort((me,ye)=>ye.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(ye.tileID)?-1:1))}const K=this.crossTileSymbolIndex.addLayer(X,O[X.source],e.center.lng);A=A||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),e.zoom))&&(this.pauseablePlacement=new No(e,this.map.terrain,this._order,b,c,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A)for(const q of this._order){const X=this._layers[q];X.type==="symbol"&&this.placement.updateLayerOpacities(X,O[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,c){return o._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(c.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[c.source];return m&&m.setDependencies(c.tileID.key,c.type,c.icons),p})}getGlyphs(e,c){return o._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(c.stacks),m=this.sourceCaches[c.source];return m&&m.setDependencies(c.tileID.key,c.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,c={}){this._checkLoaded(),e&&this._validate(o.u.glyphs,"glyphs",e,null,c)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,c,p={},m){this._checkLoaded();const b=[{id:e,url:c}],A=[...U(this.stylesheet.sprite),...b];this._validate(o.u.sprite,"sprite",A,null,p)||(this.stylesheet.sprite=A,this._loadSprite(b,!0,m))}removeSprite(e){this._checkLoaded();const c=U(this.stylesheet.sprite);if(c.find(p=>p.id===e)){if(this._spritesImagesIds[e])for(const p of this._spritesImagesIds[e])this.imageManager.removeImage(p),this._changedImages[p]=!0;c.splice(c.findIndex(p=>p.id===e),1),this.stylesheet.sprite=c.length>0?c:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return U(this.stylesheet.sprite)}setSprite(e,c={},p){this._checkLoaded(),e&&this._validate(o.u.sprite,"sprite",e,null,c)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,p):(this._unloadSprite(),p&&p(null)))}}var Hs=o.Y([{name:"a_pos",type:"Int16",components:2}]);const Bn={prelude:qi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:qi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:qi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:qi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:qi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:qi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:qi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:qi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:qi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:qi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:qi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:qi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:qi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function qi(v,e){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=e.match(/attribute ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=b?b.concat(m):m,P={};return{fragmentSource:v=v.replace(c,(O,q,X,K,oe)=>(P[oe]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
varying ${X} ${K} ${oe};
#else
uniform ${X} ${K} u_${oe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${oe}
    ${X} ${K} ${oe} = u_${oe};
#endif
`)),vertexSource:e=e.replace(c,(O,q,X,K,oe)=>{const me=K==="float"?"vec2":"vec4",ye=oe.match(/color/)?"color":me;return P[oe]?q==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
attribute ${X} ${me} a_${oe};
varying ${X} ${K} ${oe};
#else
uniform ${X} ${K} u_${oe};
#endif
`:ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = a_${oe};
#else
    ${X} ${K} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = unpack_mix_${ye}(a_${oe}, u_${oe}_t);
#else
    ${X} ${K} ${oe} = u_${oe};
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
attribute ${X} ${me} a_${oe};
#else
uniform ${X} ${K} u_${oe};
#endif
`:ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${X} ${K} ${oe} = a_${oe};
#else
    ${X} ${K} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${X} ${K} ${oe} = unpack_mix_${ye}(a_${oe}, u_${oe}_t);
#else
    ${X} ${K} ${oe} = u_${oe};
#endif
`}),staticAttributes:p,staticUniforms:A}}class ya{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,c,p,m,b,A,P,O,q){this.context=e;let X=this.boundPaintVertexBuffers.length!==m.length;for(let K=0;!X&&K<m.length;K++)this.boundPaintVertexBuffers[K]!==m[K]&&(X=!0);!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||X||this.boundIndexBuffer!==b||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==q?this.freshBind(c,p,m,b,A,P,O,q):(e.bindVertexArray.set(this.vao),P&&P.bind(),b&&b.dynamicDraw&&b.bind(),O&&O.bind(),q&&q.bind())}freshBind(e,c,p,m,b,A,P,O){const q=e.numAttributes,X=this.context,K=X.gl;this.vao&&this.destroy(),this.vao=X.createVertexArray(),X.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=O,c.enableAttributes(K,e);for(const oe of p)oe.enableAttributes(K,e);A&&A.enableAttributes(K,e),P&&P.enableAttributes(K,e),O&&O.enableAttributes(K,e),c.bind(),c.setVertexAttribPointers(K,e,b);for(const oe of p)oe.bind(),oe.setVertexAttribPointers(K,e,b);A&&(A.bind(),A.setVertexAttribPointers(K,e,b)),m&&m.bind(),P&&(P.bind(),P.setVertexAttribPointers(K,e,b)),O&&(O.bind(),O.setVertexAttribPointers(K,e,b)),X.currentNumAttributes=q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ba=(v,e,c,p,m)=>({u_matrix:v,u_texture:0,u_ele_delta:e,u_fog_matrix:c,u_fog_color:p?p.properties.get("fog-color"):o.aM.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?p.calculateFogBlendOpacity(m):0,u_horizon_color:p?p.properties.get("horizon-color"):o.aM.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1});function fo(v){const e=[];for(let c=0;c<v.length;c++){if(v[c]===null)continue;const p=v[c].split(" ");e.push(p.pop())}return e}class al{constructor(e,c,p,m,b,A){const P=e.gl;this.program=P.createProgram();const O=fo(c.staticAttributes),q=p?p.getBinderAttributes():[],X=O.concat(q),K=Bn.prelude.staticUniforms?fo(Bn.prelude.staticUniforms):[],oe=c.staticUniforms?fo(c.staticUniforms):[],me=p?p.getBinderUniforms():[],ye=K.concat(oe).concat(me),Ce=[];for(const it of ye)Ce.indexOf(it)<0&&Ce.push(it);const Pe=p?p.defines():[];b&&Pe.push("#define OVERDRAW_INSPECTOR;"),A&&Pe.push("#define TERRAIN3D;");const Oe=Pe.concat(Bn.prelude.fragmentSource,c.fragmentSource).join(`
`),Ne=Pe.concat(Bn.prelude.vertexSource,c.vertexSource).join(`
`),Te=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Te,Oe),P.compileShader(Te),!P.getShaderParameter(Te,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(Te)}`);P.attachShader(this.program,Te);const We=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(We,Ne),P.compileShader(We),!P.getShaderParameter(We,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(We)}`);P.attachShader(this.program,We),this.attributes={};const Xe={};this.numAttributes=X.length;for(let it=0;it<this.numAttributes;it++)X[it]&&(P.bindAttribLocation(this.program,it,X[it]),this.attributes[X[it]]=it);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(We),P.deleteShader(Te);for(let it=0;it<Ce.length;it++){const mt=Ce[it];if(mt&&!Xe[mt]){const Tt=P.getUniformLocation(this.program,mt);Tt&&(Xe[mt]=Tt)}}this.fixedUniforms=m(e,Xe),this.terrainUniforms=((it,mt)=>({u_depth:new o.aH(it,mt.u_depth),u_terrain:new o.aH(it,mt.u_terrain),u_terrain_dim:new o.aI(it,mt.u_terrain_dim),u_terrain_matrix:new o.aJ(it,mt.u_terrain_matrix),u_terrain_unpack:new o.aK(it,mt.u_terrain_unpack),u_terrain_exaggeration:new o.aI(it,mt.u_terrain_exaggeration)}))(e,Xe),this.binderUniforms=p?p.getUniforms(e,Xe):[]}draw(e,c,p,m,b,A,P,O,q,X,K,oe,me,ye,Ce,Pe,Oe,Ne){const Te=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(p),e.setStencilMode(m),e.setColorMode(b),e.setCullFace(A),O){e.activeTexture.set(Te.TEXTURE2),Te.bindTexture(Te.TEXTURE_2D,O.depthTexture),e.activeTexture.set(Te.TEXTURE3),Te.bindTexture(Te.TEXTURE_2D,O.texture);for(const Xe in this.terrainUniforms)this.terrainUniforms[Xe].set(O[Xe])}for(const Xe in this.fixedUniforms)this.fixedUniforms[Xe].set(P[Xe]);Ce&&Ce.setUniforms(e,this.binderUniforms,me,{zoom:ye});let We=0;switch(c){case Te.LINES:We=2;break;case Te.TRIANGLES:We=3;break;case Te.LINE_STRIP:We=1}for(const Xe of oe.get()){const it=Xe.vaos||(Xe.vaos={});(it[q]||(it[q]=new ya)).bind(e,this,X,Ce?Ce.getPaintVertexBuffers():[],K,Xe.vertexOffset,Pe,Oe,Ne),Te.drawElements(c,Xe.primitiveLength*We,Te.UNSIGNED_SHORT,Xe.primitiveOffset*We*2)}}}function jo(v,e,c){const p=1/xi(c,1,e.transform.tileZoom),m=Math.pow(2,c.tileID.overscaledZ),b=c.tileSize*Math.pow(2,e.transform.tileZoom)/m,A=b*(c.tileID.canonical.x+c.tileID.wrap*m),P=b*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[A>>16,P>>16],u_pixel_coord_lower:[65535&A,65535&P]}}const Es=(v,e,c,p)=>{const m=e.style.light,b=m.properties.get("position"),A=[b.x,b.y,b.z],P=function(){var q=new o.A(9);return o.A!=Float32Array&&(q[1]=0,q[2]=0,q[3]=0,q[5]=0,q[6]=0,q[7]=0),q[0]=1,q[4]=1,q[8]=1,q}();m.properties.get("anchor")==="viewport"&&function(q,X){var K=Math.sin(X),oe=Math.cos(X);q[0]=oe,q[1]=K,q[2]=0,q[3]=-K,q[4]=oe,q[5]=0,q[6]=0,q[7]=0,q[8]=1}(P,-e.transform.angle),function(q,X,K){var oe=X[0],me=X[1],ye=X[2];q[0]=oe*K[0]+me*K[3]+ye*K[6],q[1]=oe*K[1]+me*K[4]+ye*K[7],q[2]=oe*K[2]+me*K[5]+ye*K[8]}(A,A,P);const O=m.properties.get("color");return{u_matrix:v,u_lightpos:A,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+c,u_opacity:p}},va=(v,e,c,p,m,b,A)=>o.e(Es(v,e,c,p),jo(b,e,A),{u_height_factor:-Math.pow(2,m.overscaledZ)/A.tileSize/8}),po=v=>({u_matrix:v}),ll=(v,e,c,p)=>o.e(po(v),jo(c,e,p)),tu=(v,e)=>({u_matrix:v,u_world:e}),ql=(v,e,c,p,m)=>o.e(ll(v,e,c,p),{u_world:m}),Zl=(v,e,c,p)=>{const m=v.transform;let b,A;if(p.paint.get("circle-pitch-alignment")==="map"){const P=xi(c,1,m.zoom);b=!0,A=[P,P]}else b=!1,A=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(e.posMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:A}},Is=(v,e,c)=>({u_matrix:v,u_inv_matrix:e,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}),mo=(v,e,c=1)=>({u_matrix:v,u_color:e,u_overlay:0,u_overlay_scale:c}),Vn=v=>({u_matrix:v}),Qn=(v,e,c,p)=>({u_matrix:v,u_extrude_scale:xi(e,1,c),u_intensity:p}),go=(v,e,c,p)=>{const m=o.H();o.aP(m,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:c,u_color_ramp:p,u_opacity:e.paint.get("heatmap-opacity")}};function $n(v,e){const c=Math.pow(2,e.canonical.z),p=e.canonical.y;return[new o.Z(0,p/c).toLngLat().lat,new o.Z(0,(p+1)/c).toLngLat().lat]}const wa=(v,e,c,p)=>{const m=v.transform;return{u_matrix:Xl(v,e,c,p),u_ratio:1/xi(e,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Wl=(v,e,c,p,m)=>o.e(wa(v,e,c,m),{u_image:0,u_image_height:p}),Xs=(v,e,c,p,m)=>{const b=v.transform,A=Hl(e,b);return{u_matrix:Xl(v,e,c,m),u_texsize:e.imageAtlasTexture.size,u_ratio:1/xi(e,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Gl=(v,e,c,p,m,b)=>{const A=v.lineAtlas,P=Hl(e,v.transform),O=c.layout.get("line-cap")==="round",q=A.getDash(p.from,O),X=A.getDash(p.to,O),K=q.width*m.fromScale,oe=X.width*m.toScale;return o.e(wa(v,e,c,b),{u_patternscale_a:[P/K,-q.height/2],u_patternscale_b:[P/oe,-X.height/2],u_sdfgamma:A.width/(256*Math.min(K,oe)*v.pixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:X.y,u_mix:m.t})};function Hl(v,e){return 1/xi(v,1,e.tileZoom)}function Xl(v,e,c,p){return v.translatePosMatrix(p?p.posMatrix:e.tileID.posMatrix,e,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const iu=(v,e,c,p,m)=>{return{u_matrix:v,u_tl_parent:e,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(A=m.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:nu(m.paint.get("raster-hue-rotate"))};var b,A};function nu(v){v*=Math.PI/180;const e=Math.sin(v),c=Math.cos(v);return[(2*c+1)/3,(-Math.sqrt(3)*e-c+1)/3,(Math.sqrt(3)*e-c+1)/3]}const Kl=(v,e,c,p,m,b,A,P,O,q,X,K,oe,me)=>{const ye=A.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:ye.cameraToCenterDistance,u_pitch:ye.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ye.width/ye.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:O,u_coord_matrix:q,u_is_text:+K,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:oe,u_texture:0,u_translation:X,u_pitched_scale:me}},Uo=(v,e,c,p,m,b,A,P,O,q,X,K,oe,me,ye)=>{const Ce=A.transform;return o.e(Kl(v,e,c,p,m,b,A,P,O,q,X,K,oe,ye),{u_gamma_scale:p?Math.cos(Ce._pitch)*Ce.cameraToCenterDistance:1,u_device_pixel_ratio:A.pixelRatio,u_is_halo:1})},xa=(v,e,c,p,m,b,A,P,O,q,X,K,oe,me)=>o.e(Uo(v,e,c,p,m,b,A,P,O,q,X,!0,K,!0,me),{u_texsize_icon:oe,u_texture_icon:1}),Vo=(v,e,c)=>({u_matrix:v,u_opacity:e,u_color:c}),qo=(v,e,c,p,m,b)=>o.e(function(A,P,O,q){const X=O.imageManager.getPattern(A.from.toString()),K=O.imageManager.getPattern(A.to.toString()),{width:oe,height:me}=O.imageManager.getPixelSize(),ye=Math.pow(2,q.tileID.overscaledZ),Ce=q.tileSize*Math.pow(2,O.transform.tileZoom)/ye,Pe=Ce*(q.tileID.canonical.x+q.tileID.wrap*ye),Oe=Ce*q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:X.tl,u_pattern_br_a:X.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[oe,me],u_mix:P.t,u_pattern_size_a:X.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/xi(q,1,O.transform.tileZoom),u_pixel_coord_upper:[Pe>>16,Oe>>16],u_pixel_coord_lower:[65535&Pe,65535&Oe]}}(p,b,c,m),{u_matrix:v,u_opacity:e}),cl={fillExtrusion:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_lightpos:new o.aN(v,e.u_lightpos),u_lightintensity:new o.aI(v,e.u_lightintensity),u_lightcolor:new o.aN(v,e.u_lightcolor),u_vertical_gradient:new o.aI(v,e.u_vertical_gradient),u_opacity:new o.aI(v,e.u_opacity)}),fillExtrusionPattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_lightpos:new o.aN(v,e.u_lightpos),u_lightintensity:new o.aI(v,e.u_lightintensity),u_lightcolor:new o.aN(v,e.u_lightcolor),u_vertical_gradient:new o.aI(v,e.u_vertical_gradient),u_height_factor:new o.aI(v,e.u_height_factor),u_image:new o.aH(v,e.u_image),u_texsize:new o.aO(v,e.u_texsize),u_pixel_coord_upper:new o.aO(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(v,e.u_pixel_coord_lower),u_scale:new o.aN(v,e.u_scale),u_fade:new o.aI(v,e.u_fade),u_opacity:new o.aI(v,e.u_opacity)}),fill:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix)}),fillPattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_image:new o.aH(v,e.u_image),u_texsize:new o.aO(v,e.u_texsize),u_pixel_coord_upper:new o.aO(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(v,e.u_pixel_coord_lower),u_scale:new o.aN(v,e.u_scale),u_fade:new o.aI(v,e.u_fade)}),fillOutline:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_world:new o.aO(v,e.u_world)}),fillOutlinePattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_world:new o.aO(v,e.u_world),u_image:new o.aH(v,e.u_image),u_texsize:new o.aO(v,e.u_texsize),u_pixel_coord_upper:new o.aO(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(v,e.u_pixel_coord_lower),u_scale:new o.aN(v,e.u_scale),u_fade:new o.aI(v,e.u_fade)}),circle:(v,e)=>({u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_scale_with_map:new o.aH(v,e.u_scale_with_map),u_pitch_with_map:new o.aH(v,e.u_pitch_with_map),u_extrude_scale:new o.aO(v,e.u_extrude_scale),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_matrix:new o.aJ(v,e.u_matrix)}),collisionBox:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_pixel_extrude_scale:new o.aO(v,e.u_pixel_extrude_scale)}),collisionCircle:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_inv_matrix:new o.aJ(v,e.u_inv_matrix),u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_viewport_size:new o.aO(v,e.u_viewport_size)}),debug:(v,e)=>({u_color:new o.aL(v,e.u_color),u_matrix:new o.aJ(v,e.u_matrix),u_overlay:new o.aH(v,e.u_overlay),u_overlay_scale:new o.aI(v,e.u_overlay_scale)}),clippingMask:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix)}),heatmap:(v,e)=>({u_extrude_scale:new o.aI(v,e.u_extrude_scale),u_intensity:new o.aI(v,e.u_intensity),u_matrix:new o.aJ(v,e.u_matrix)}),heatmapTexture:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_world:new o.aO(v,e.u_world),u_image:new o.aH(v,e.u_image),u_color_ramp:new o.aH(v,e.u_color_ramp),u_opacity:new o.aI(v,e.u_opacity)}),hillshade:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_image:new o.aH(v,e.u_image),u_latrange:new o.aO(v,e.u_latrange),u_light:new o.aO(v,e.u_light),u_shadow:new o.aL(v,e.u_shadow),u_highlight:new o.aL(v,e.u_highlight),u_accent:new o.aL(v,e.u_accent)}),hillshadePrepare:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_image:new o.aH(v,e.u_image),u_dimension:new o.aO(v,e.u_dimension),u_zoom:new o.aI(v,e.u_zoom),u_unpack:new o.aK(v,e.u_unpack)}),line:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_ratio:new o.aI(v,e.u_ratio),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_units_to_pixels:new o.aO(v,e.u_units_to_pixels)}),lineGradient:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_ratio:new o.aI(v,e.u_ratio),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_units_to_pixels:new o.aO(v,e.u_units_to_pixels),u_image:new o.aH(v,e.u_image),u_image_height:new o.aI(v,e.u_image_height)}),linePattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_texsize:new o.aO(v,e.u_texsize),u_ratio:new o.aI(v,e.u_ratio),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_image:new o.aH(v,e.u_image),u_units_to_pixels:new o.aO(v,e.u_units_to_pixels),u_scale:new o.aN(v,e.u_scale),u_fade:new o.aI(v,e.u_fade)}),lineSDF:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_ratio:new o.aI(v,e.u_ratio),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_units_to_pixels:new o.aO(v,e.u_units_to_pixels),u_patternscale_a:new o.aO(v,e.u_patternscale_a),u_patternscale_b:new o.aO(v,e.u_patternscale_b),u_sdfgamma:new o.aI(v,e.u_sdfgamma),u_image:new o.aH(v,e.u_image),u_tex_y_a:new o.aI(v,e.u_tex_y_a),u_tex_y_b:new o.aI(v,e.u_tex_y_b),u_mix:new o.aI(v,e.u_mix)}),raster:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_tl_parent:new o.aO(v,e.u_tl_parent),u_scale_parent:new o.aI(v,e.u_scale_parent),u_buffer_scale:new o.aI(v,e.u_buffer_scale),u_fade_t:new o.aI(v,e.u_fade_t),u_opacity:new o.aI(v,e.u_opacity),u_image0:new o.aH(v,e.u_image0),u_image1:new o.aH(v,e.u_image1),u_brightness_low:new o.aI(v,e.u_brightness_low),u_brightness_high:new o.aI(v,e.u_brightness_high),u_saturation_factor:new o.aI(v,e.u_saturation_factor),u_contrast_factor:new o.aI(v,e.u_contrast_factor),u_spin_weights:new o.aN(v,e.u_spin_weights)}),symbolIcon:(v,e)=>({u_is_size_zoom_constant:new o.aH(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(v,e.u_is_size_feature_constant),u_size_t:new o.aI(v,e.u_size_t),u_size:new o.aI(v,e.u_size),u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_pitch:new o.aI(v,e.u_pitch),u_rotate_symbol:new o.aH(v,e.u_rotate_symbol),u_aspect_ratio:new o.aI(v,e.u_aspect_ratio),u_fade_change:new o.aI(v,e.u_fade_change),u_matrix:new o.aJ(v,e.u_matrix),u_label_plane_matrix:new o.aJ(v,e.u_label_plane_matrix),u_coord_matrix:new o.aJ(v,e.u_coord_matrix),u_is_text:new o.aH(v,e.u_is_text),u_pitch_with_map:new o.aH(v,e.u_pitch_with_map),u_is_along_line:new o.aH(v,e.u_is_along_line),u_is_variable_anchor:new o.aH(v,e.u_is_variable_anchor),u_texsize:new o.aO(v,e.u_texsize),u_texture:new o.aH(v,e.u_texture),u_translation:new o.aO(v,e.u_translation),u_pitched_scale:new o.aI(v,e.u_pitched_scale)}),symbolSDF:(v,e)=>({u_is_size_zoom_constant:new o.aH(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(v,e.u_is_size_feature_constant),u_size_t:new o.aI(v,e.u_size_t),u_size:new o.aI(v,e.u_size),u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_pitch:new o.aI(v,e.u_pitch),u_rotate_symbol:new o.aH(v,e.u_rotate_symbol),u_aspect_ratio:new o.aI(v,e.u_aspect_ratio),u_fade_change:new o.aI(v,e.u_fade_change),u_matrix:new o.aJ(v,e.u_matrix),u_label_plane_matrix:new o.aJ(v,e.u_label_plane_matrix),u_coord_matrix:new o.aJ(v,e.u_coord_matrix),u_is_text:new o.aH(v,e.u_is_text),u_pitch_with_map:new o.aH(v,e.u_pitch_with_map),u_is_along_line:new o.aH(v,e.u_is_along_line),u_is_variable_anchor:new o.aH(v,e.u_is_variable_anchor),u_texsize:new o.aO(v,e.u_texsize),u_texture:new o.aH(v,e.u_texture),u_gamma_scale:new o.aI(v,e.u_gamma_scale),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_is_halo:new o.aH(v,e.u_is_halo),u_translation:new o.aO(v,e.u_translation),u_pitched_scale:new o.aI(v,e.u_pitched_scale)}),symbolTextAndIcon:(v,e)=>({u_is_size_zoom_constant:new o.aH(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(v,e.u_is_size_feature_constant),u_size_t:new o.aI(v,e.u_size_t),u_size:new o.aI(v,e.u_size),u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_pitch:new o.aI(v,e.u_pitch),u_rotate_symbol:new o.aH(v,e.u_rotate_symbol),u_aspect_ratio:new o.aI(v,e.u_aspect_ratio),u_fade_change:new o.aI(v,e.u_fade_change),u_matrix:new o.aJ(v,e.u_matrix),u_label_plane_matrix:new o.aJ(v,e.u_label_plane_matrix),u_coord_matrix:new o.aJ(v,e.u_coord_matrix),u_is_text:new o.aH(v,e.u_is_text),u_pitch_with_map:new o.aH(v,e.u_pitch_with_map),u_is_along_line:new o.aH(v,e.u_is_along_line),u_is_variable_anchor:new o.aH(v,e.u_is_variable_anchor),u_texsize:new o.aO(v,e.u_texsize),u_texsize_icon:new o.aO(v,e.u_texsize_icon),u_texture:new o.aH(v,e.u_texture),u_texture_icon:new o.aH(v,e.u_texture_icon),u_gamma_scale:new o.aI(v,e.u_gamma_scale),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_is_halo:new o.aH(v,e.u_is_halo),u_translation:new o.aO(v,e.u_translation),u_pitched_scale:new o.aI(v,e.u_pitched_scale)}),background:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_opacity:new o.aI(v,e.u_opacity),u_color:new o.aL(v,e.u_color)}),backgroundPattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_opacity:new o.aI(v,e.u_opacity),u_image:new o.aH(v,e.u_image),u_pattern_tl_a:new o.aO(v,e.u_pattern_tl_a),u_pattern_br_a:new o.aO(v,e.u_pattern_br_a),u_pattern_tl_b:new o.aO(v,e.u_pattern_tl_b),u_pattern_br_b:new o.aO(v,e.u_pattern_br_b),u_texsize:new o.aO(v,e.u_texsize),u_mix:new o.aI(v,e.u_mix),u_pattern_size_a:new o.aO(v,e.u_pattern_size_a),u_pattern_size_b:new o.aO(v,e.u_pattern_size_b),u_scale_a:new o.aI(v,e.u_scale_a),u_scale_b:new o.aI(v,e.u_scale_b),u_pixel_coord_upper:new o.aO(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(v,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aI(v,e.u_tile_units_to_pixels)}),terrain:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_texture:new o.aH(v,e.u_texture),u_ele_delta:new o.aI(v,e.u_ele_delta),u_fog_matrix:new o.aJ(v,e.u_fog_matrix),u_fog_color:new o.aL(v,e.u_fog_color),u_fog_ground_blend:new o.aI(v,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.aI(v,e.u_fog_ground_blend_opacity),u_horizon_color:new o.aL(v,e.u_horizon_color),u_horizon_fog_blend:new o.aI(v,e.u_horizon_fog_blend)}),terrainDepth:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_ele_delta:new o.aI(v,e.u_ele_delta)}),terrainCoords:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_texture:new o.aH(v,e.u_texture),u_terrain_coords_id:new o.aI(v,e.u_terrain_coords_id),u_ele_delta:new o.aI(v,e.u_ele_delta)}),sky:(v,e)=>({u_sky_color:new o.aL(v,e.u_sky_color),u_horizon_color:new o.aL(v,e.u_horizon_color),u_horizon:new o.aI(v,e.u_horizon),u_sky_horizon_blend:new o.aI(v,e.u_sky_horizon_blend)})};class Kr{constructor(e,c,p){this.context=e;const m=e.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const c=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ks={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Br{constructor(e,c,p,m){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=m,this.context=e;const b=e.gl;this.buffer=b.createBuffer(),e.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,c){for(let p=0;p<this.attributes.length;p++){const m=c.attributes[this.attributes[p].name];m!==void 0&&e.enableVertexAttribArray(m)}}setVertexAttribPointers(e,c,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],A=c.attributes[b.name];A!==void 0&&e.vertexAttribPointer(A,b.components,e[Ks[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const As=new WeakMap;function Ms(v){var e;if(As.has(v))return As.get(v);{const c=(e=v.getParameter(v.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return As.set(v,c),c}}class Wi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zo extends Wi{getDefault(){return o.aM.transparent}set(e){const c=this.current;(e.r!==c.r||e.g!==c.g||e.b!==c.b||e.a!==c.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Jl extends Wi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Js extends Wi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ru extends Wi{getDefault(){return[!0,!0,!0,!0]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||e[3]!==c[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Yl extends Wi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class su extends Wi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ul extends Wi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const c=this.current;(e.func!==c.func||e.ref!==c.ref||e.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Sa extends Wi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Ql extends Wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;e?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=e,this.dirty=!1}}class $l extends Wi{getDefault(){return[0,1]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ec extends Wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;e?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=e,this.dirty=!1}}class tc extends Wi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ys extends Wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;e?c.enable(c.BLEND):c.disable(c.BLEND),this.current=e,this.dirty=!1}}class Jr extends Wi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ic extends Wi{getDefault(){return o.aM.transparent}set(e){const c=this.current;(e.r!==c.r||e.g!==c.g||e.b!==c.b||e.a!==c.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nc extends Wi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Wo extends Wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;e?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=e,this.dirty=!1}}class ou extends Wi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ta extends Wi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class au extends Wi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class lu extends Wi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class rc extends Wi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||e[3]!==c[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class sc extends Wi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ka extends Wi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class _o extends Wi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class oc extends Wi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Go extends Wi{getDefault(){return null}set(e){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Yr extends Wi{getDefault(){return null}set(e){var c;if(e===this.current&&!this.dirty)return;const p=this.gl;Ms(p)?p.bindVertexArray(e):(c=p.getExtension("OES_vertex_array_object"))===null||c===void 0||c.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Qs extends Wi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ho extends Wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Xo extends Wi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ca extends Wi{constructor(e,c){super(e),this.context=e,this.parent=c}getDefault(){return null}}class hl extends Ca{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class $s extends Ca{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fs extends Ca{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class cu{constructor(e,c,p,m,b){this.context=e,this.width=c,this.height=p;const A=e.gl,P=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new hl(e,P),m)this.depthAttachment=b?new fs(e,P):new $s(e,P);else if(b)throw new Error("Stencil cannot be set without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,c=this.colorAttachment.get();if(c&&e.deleteTexture(c),this.depthAttachment){const p=this.depthAttachment.get();p&&e.deleteRenderbuffer(p)}e.deleteFramebuffer(this.framebuffer)}}class Tn{constructor(e,c,p){this.blendFunction=e,this.blendColor=c,this.mask=p}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,o.aM.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,o.aM.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],o.aM.transparent,[!0,!0,!0,!0]);class uu{constructor(e){var c,p;if(this.gl=e,this.clearColor=new Zo(this),this.clearDepth=new Jl(this),this.clearStencil=new Js(this),this.colorMask=new ru(this),this.depthMask=new Yl(this),this.stencilMask=new su(this),this.stencilFunc=new ul(this),this.stencilOp=new Sa(this),this.stencilTest=new Ql(this),this.depthRange=new $l(this),this.depthTest=new ec(this),this.depthFunc=new tc(this),this.blend=new Ys(this),this.blendFunc=new Jr(this),this.blendColor=new ic(this),this.blendEquation=new nc(this),this.cullFace=new Wo(this),this.cullFaceSide=new ou(this),this.frontFace=new Ta(this),this.program=new au(this),this.activeTexture=new lu(this),this.viewport=new rc(this),this.bindFramebuffer=new sc(this),this.bindRenderbuffer=new ka(this),this.bindTexture=new _o(this),this.bindVertexBuffer=new oc(this),this.bindElementBuffer=new Go(this),this.bindVertexArray=new Yr(this),this.pixelStoreUnpack=new Qs(this),this.pixelStoreUnpackPremultiplyAlpha=new Ho(this),this.pixelStoreUnpackFlipY=new Xo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Ms(e)){this.HALF_FLOAT=e.HALF_FLOAT;const m=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(c=e.RGBA16F)!==null&&c!==void 0?c:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=e.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const m=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,c){return new Kr(this,e,c)}createVertexBuffer(e,c,p){return new Br(this,e,c,p)}createRenderbuffer(e,c,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,e,c,p),this.bindRenderbuffer.set(null),b}createFramebuffer(e,c,p,m){return new cu(this,e,c,p,m)}clear({color:e,depth:c,stencil:p}){const m=this.gl;let b=0;e&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.aE(e.blendFunction,Tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Ms(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var c;return Ms(this.gl)?this.gl.deleteVertexArray(e):(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Pi{constructor(e,c,p){this.func=e,this.mask=c,this.range=p}}Pi.ReadOnly=!1,Pi.ReadWrite=!0,Pi.disabled=new Pi(519,Pi.ReadOnly,[0,1]);const eo=7680;class Qi{constructor(e,c,p,m,b,A){this.test=e,this.ref=c,this.mask=p,this.fail=m,this.depthFail=b,this.pass=A}}Qi.disabled=new Qi({func:519,mask:0},0,0,eo,eo,eo);class $i{constructor(e,c,p){this.enable=e,this.mode=c,this.frontFace=p}}let Ps;function Ko(v,e,c,p,m){const b=v.context,A=b.gl,P=v.useProgram("collisionBox"),O=[];let q=0,X=0;for(let Oe=0;Oe<p.length;Oe++){const Ne=p[Oe],Te=e.getTile(Ne).getBucket(c);if(!Te)continue;const We=m?Te.textCollisionBox:Te.iconCollisionBox,Xe=Te.collisionCircleArray;if(Xe.length>0){const it=o.H();o.aQ(it,Te.placementInvProjMatrix,v.transform.glCoordMatrix),o.aQ(it,it,Te.placementViewportMatrix),O.push({circleArray:Xe,circleOffset:X,transform:Ne.posMatrix,invTransform:it,coord:Ne}),q+=Xe.length/4,X=q}We&&P.draw(b,A.LINES,Pi.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,{u_matrix:Ne.posMatrix,u_pixel_extrude_scale:[1/(K=v.transform).width,1/K.height]},v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ne),c.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,v.transform.zoom,null,null,We.collisionVertexBuffer)}var K;if(!m||!O.length)return;const oe=v.useProgram("collisionCircle"),me=new o.aR;me.resize(4*q),me._trim();let ye=0;for(const Oe of O)for(let Ne=0;Ne<Oe.circleArray.length/4;Ne++){const Te=4*Ne,We=Oe.circleArray[Te+0],Xe=Oe.circleArray[Te+1],it=Oe.circleArray[Te+2],mt=Oe.circleArray[Te+3];me.emplace(ye++,We,Xe,it,mt,0),me.emplace(ye++,We,Xe,it,mt,1),me.emplace(ye++,We,Xe,it,mt,2),me.emplace(ye++,We,Xe,it,mt,3)}(!Ps||Ps.length<2*q)&&(Ps=function(Oe){const Ne=2*Oe,Te=new o.aT;Te.resize(Ne),Te._trim();for(let We=0;We<Ne;We++){const Xe=6*We;Te.uint16[Xe+0]=4*We+0,Te.uint16[Xe+1]=4*We+1,Te.uint16[Xe+2]=4*We+2,Te.uint16[Xe+3]=4*We+2,Te.uint16[Xe+4]=4*We+3,Te.uint16[Xe+5]=4*We+0}return Te}(q));const Ce=b.createIndexBuffer(Ps,!0),Pe=b.createVertexBuffer(me,o.aS.members,!0);for(const Oe of O){const Ne=Is(Oe.transform,Oe.invTransform,v.transform);oe.draw(b,A.TRIANGLES,Pi.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,Ne,v.style.map.terrain&&v.style.map.terrain.getTerrainData(Oe.coord),c.id,Pe,Ce,o.a0.simpleSegment(0,2*Oe.circleOffset,Oe.circleArray.length,Oe.circleArray.length/2),null,v.transform.zoom,null,null,null)}Pe.destroy(),Ce.destroy()}$i.disabled=new $i(!1,1029,2305),$i.backCCW=new $i(!0,1029,2305);const Qr=o.an(new Float32Array(16));function Jo(v,e,c,p,m,b){const{horizontalAlign:A,verticalAlign:P}=o.au(v);return new o.P((-(A-.5)*e/m+p[0])*b,(-(P-.5)*c/m+p[1])*b)}function Ls(v,e,c,p,m,b){const A=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let P=p.mult(b);c||(P=P.rotate(-m));const O=A.add(P);return Ie(O.x,O.y,e.labelPlaneMatrix,e.getElevation).point}if(c){const P=ot(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(v),O=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return v.add(p.rotate(O))}return v.add(p)}function yo(v,e,c,p,m,b,A,P,O,q,X,K,oe,me){const ye=v.text.placedSymbolArray,Ce=v.text.dynamicLayoutVertexArray,Pe=v.icon.dynamicLayoutVertexArray,Oe={};Ce.clear();for(let Ne=0;Ne<ye.length;Ne++){const Te=ye.get(Ne),We=Te.hidden||!Te.crossTileID||v.allowVerticalPlacement&&!Te.placedOrientation?null:p[Te.crossTileID];if(We){const Xe=new o.P(Te.anchorX,Te.anchorY),it={getElevation:me,width:m.width,height:m.height,labelPlaneMatrix:b,pitchWithMap:c,projection:X,tileAnchorPoint:Xe,translation:K,unwrappedTileID:oe},mt=c?Ie(Xe.x,Xe.y,A,me):ot(Xe.x,Xe.y,it),Tt=ee(m.cameraToCenterDistance,mt.signedDistanceFromCamera);let Dt=o.ai(v.textSizeData,O,Te)*Tt/o.ap;c&&(Dt*=v.tilePixelRatio/P);const{width:Nt,height:Lt,anchor:Mt,textOffset:Ht,textBoxScale:vi}=We,zt=Jo(Mt,Nt,Lt,Ht,vi,Dt),Rt=X.getPitchedTextCorrection(m,Xe.add(new o.P(K[0],K[1])),oe),_i=Ls(mt.point,it,e,zt,m.angle,Rt),gn=v.allowVerticalPlacement&&Te.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let Ii=0;Ii<Te.numGlyphs;Ii++)o.aj(Ce,_i,gn);q&&Te.associatedIconIndex>=0&&(Oe[Te.associatedIconIndex]={shiftedAnchor:_i,angle:gn})}else ni(Te.numGlyphs,Ce)}if(q){Pe.clear();const Ne=v.icon.placedSymbolArray;for(let Te=0;Te<Ne.length;Te++){const We=Ne.get(Te);if(We.hidden)ni(We.numGlyphs,Pe);else{const Xe=Oe[Te];if(Xe)for(let it=0;it<We.numGlyphs;it++)o.aj(Pe,Xe.shiftedAnchor,Xe.angle);else ni(We.numGlyphs,Pe)}}v.icon.dynamicLayoutVertexBuffer.updateData(Pe)}v.text.dynamicLayoutVertexBuffer.updateData(Ce)}function kr(v,e,c){return c.iconsInText&&e?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function fl(v,e,c,p,m,b,A,P,O,q,X,K){const oe=v.context,me=oe.gl,ye=v.transform,Ce=Rn(),Pe=P==="map",Oe=O==="map",Ne=P!=="viewport"&&c.layout.get("symbol-placement")!=="point",Te=Pe&&!Oe&&!Ne,We=!Oe&&Ne,Xe=!c.layout.get("symbol-sort-key").isConstant();let it=!1;const mt=v.depthModeForSublayer(0,Pi.ReadOnly),Tt=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Dt=[],Nt=Ce.getCircleRadiusCorrection(ye);for(const Lt of p){const Mt=e.getTile(Lt),Ht=Mt.getBucket(c);if(!Ht)continue;const vi=m?Ht.text:Ht.icon;if(!vi||!vi.segments.get().length||!vi.hasVisibleVertices)continue;const zt=vi.programConfigurations.get(c.id),Rt=m||Ht.sdfIcons,_i=m?Ht.textSizeData:Ht.iconSizeData,gn=Oe||ye.pitch!==0,Ii=v.useProgram(kr(Rt,m,Ht),zt),Ni=o.ag(_i,ye.zoom),_n=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Lt);let nr,ms,yn,Ir,_r=[0,0],rr=null;if(m)ms=Mt.glyphAtlasTexture,yn=me.LINEAR,nr=Mt.glyphAtlasTexture.size,Ht.iconsInText&&(_r=Mt.imageAtlasTexture.size,rr=Mt.imageAtlasTexture,Ir=gn||v.options.rotating||v.options.zooming||_i.kind==="composite"||_i.kind==="camera"?me.LINEAR:me.NEAREST);else{const Ui=c.layout.get("icon-size").constantOr(0)!==1||Ht.iconsNeedLinear;ms=Mt.imageAtlasTexture,yn=Rt||v.options.rotating||v.options.zooming||Ui||gn?me.LINEAR:me.NEAREST,nr=Mt.imageAtlasTexture.size}const yr=xi(Mt,1,v.transform.zoom),Fs=We?Lt.posMatrix:Qr,Na=Sr(Fs,Oe,Pe,v.transform,yr),pc=Tr(Fs,Oe,Pe,v.transform,yr),ja=Tr(Lt.posMatrix,Oe,Pe,v.transform,yr),ns=Ce.translatePosition(v.transform,Mt,b,A),mc=Tt&&Ht.hasTextData(),Tu=c.layout.get("icon-text-fit")!=="none"&&mc&&Ht.hasIconData();if(Ne){const Ui=v.style.map.terrain?(Ua,Va)=>v.style.map.terrain.getElevation(Lt,Ua,Va):null,sa=c.layout.get("text-rotation-alignment")==="map";fe(Ht,Lt.posMatrix,v,m,Na,ja,Oe,q,sa,Ce,Lt.toUnwrapped(),ye.width,ye.height,ns,Ui)}const rs=Lt.posMatrix,ss=m&&Tt||Tu,Eo=Ne||ss?Qr:Na,gs=pc,er=Rt&&c.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let sr;sr=Rt?Ht.iconsInText?xa(_i.kind,Ni,Te,Oe,Ne,ss,v,rs,Eo,gs,ns,nr,_r,Nt):Uo(_i.kind,Ni,Te,Oe,Ne,ss,v,rs,Eo,gs,ns,m,nr,!0,Nt):Kl(_i.kind,Ni,Te,Oe,Ne,ss,v,rs,Eo,gs,ns,m,nr,Nt);const Vr={program:Ii,buffers:vi,uniformValues:sr,atlasTexture:ms,atlasTextureIcon:rr,atlasInterpolation:yn,atlasInterpolationIcon:Ir,isSDF:Rt,hasHalo:er};if(Xe&&Ht.canOverlap){it=!0;const Ui=vi.segments.get();for(const sa of Ui)Dt.push({segments:new o.a0([sa]),sortKey:sa.sortKey,state:Vr,terrainData:_n})}else Dt.push({segments:vi.segments,sortKey:0,state:Vr,terrainData:_n})}it&&Dt.sort((Lt,Mt)=>Lt.sortKey-Mt.sortKey);for(const Lt of Dt){const Mt=Lt.state;if(oe.activeTexture.set(me.TEXTURE0),Mt.atlasTexture.bind(Mt.atlasInterpolation,me.CLAMP_TO_EDGE),Mt.atlasTextureIcon&&(oe.activeTexture.set(me.TEXTURE1),Mt.atlasTextureIcon&&Mt.atlasTextureIcon.bind(Mt.atlasInterpolationIcon,me.CLAMP_TO_EDGE)),Mt.isSDF){const Ht=Mt.uniformValues;Mt.hasHalo&&(Ht.u_is_halo=1,to(Mt.buffers,Lt.segments,c,v,Mt.program,mt,X,K,Ht,Lt.terrainData)),Ht.u_is_halo=0}to(Mt.buffers,Lt.segments,c,v,Mt.program,mt,X,K,Mt.uniformValues,Lt.terrainData)}}function to(v,e,c,p,m,b,A,P,O,q){const X=p.context;m.draw(X,X.gl.TRIANGLES,b,A,P,$i.disabled,O,q,c.id,v.layoutVertexBuffer,v.indexBuffer,e,c.paint,p.transform.zoom,v.programConfigurations.get(c.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function ds(v,e,c,p){const m=v.context,b=m.gl,A=Qi.disabled,P=new Tn([b.ONE,b.ONE],o.aM.transparent,[!0,!0,!0,!0]),O=e.getBucket(c);if(!O)return;const q=p.key;let X=c.heatmapFbos.get(q);X||(X=Yo(m,e.tileSize,e.tileSize),c.heatmapFbos.set(q,X)),m.bindFramebuffer.set(X.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:o.aM.transparent});const K=O.programConfigurations.get(c.id),oe=v.useProgram("heatmap",K),me=v.style.map.terrain.getTerrainData(p);oe.draw(m,b.TRIANGLES,Pi.disabled,A,P,$i.disabled,Qn(p.posMatrix,e,v.transform.zoom,c.paint.get("heatmap-intensity")),me,c.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,c.paint,v.transform.zoom,K)}function io(v,e,c){const p=v.context,m=p.gl;p.setColorMode(v.colorModeForRenderPass());const b=Qo(p,e),A=c.key,P=e.heatmapFbos.get(A);P&&(p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,P.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),b.bind(m.LINEAR,m.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(p,m.TRIANGLES,Pi.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,go(v,e,0,1),null,e.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,e.paint,v.transform.zoom),P.destroy(),e.heatmapFbos.delete(A))}function Yo(v,e,c){var p,m;const b=v.gl,A=b.createTexture();b.bindTexture(b.TEXTURE_2D,A),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const P=(p=v.HALF_FLOAT)!==null&&p!==void 0?p:b.UNSIGNED_BYTE,O=(m=v.RGBA16F)!==null&&m!==void 0?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,O,e,c,0,b.RGBA,P,null);const q=v.createFramebuffer(e,c,!1,!1);return q.colorAttachment.set(A),q}function Qo(v,e){return e.colorRampTexture||(e.colorRampTexture=new B(v,e.colorRamp,v.gl.RGBA)),e.colorRampTexture}function bo(v,e,c,p,m){if(!c||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let A=b[c.to.toString()],P=b[c.from.toString()];if(!A&&P&&(A=P),!P&&A&&(P=A),!A||!P){const O=m.getPaintProperty(e);A=b[O],P=b[O]}A&&P&&v.setConstantPatternPositions(A,P)}function $o(v,e,c,p,m,b,A){const P=v.context.gl,O="fill-pattern",q=c.paint.get(O),X=q&&q.constantOr(1),K=c.getCrossfadeParameters();let oe,me,ye,Ce,Pe;A?(me=X&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",oe=P.LINES):(me=X?"fillPattern":"fill",oe=P.TRIANGLES);const Oe=q.constantOr(null);for(const Ne of p){const Te=e.getTile(Ne);if(X&&!Te.patternsLoaded())continue;const We=Te.getBucket(c);if(!We)continue;const Xe=We.programConfigurations.get(c.id),it=v.useProgram(me,Xe),mt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ne);X&&(v.context.activeTexture.set(P.TEXTURE0),Te.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Xe.updatePaintBuffers(K)),bo(Xe,O,Oe,Te,c);const Tt=mt?Ne:null,Dt=v.translatePosMatrix(Tt?Tt.posMatrix:Ne.posMatrix,Te,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(A){Ce=We.indexBuffer2,Pe=We.segments2;const Nt=[P.drawingBufferWidth,P.drawingBufferHeight];ye=me==="fillOutlinePattern"&&X?ql(Dt,v,K,Te,Nt):tu(Dt,Nt)}else Ce=We.indexBuffer,Pe=We.segments,ye=X?ll(Dt,v,K,Te):po(Dt);it.draw(v.context,oe,m,v.stencilModeForClipping(Ne),b,$i.disabled,ye,mt,c.id,We.layoutVertexBuffer,Ce,Pe,c.paint,v.transform.zoom,Xe)}}function Ea(v,e,c,p,m,b,A){const P=v.context,O=P.gl,q="fill-extrusion-pattern",X=c.paint.get(q),K=X.constantOr(1),oe=c.getCrossfadeParameters(),me=c.paint.get("fill-extrusion-opacity"),ye=X.constantOr(null);for(const Ce of p){const Pe=e.getTile(Ce),Oe=Pe.getBucket(c);if(!Oe)continue;const Ne=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ce),Te=Oe.programConfigurations.get(c.id),We=v.useProgram(K?"fillExtrusionPattern":"fillExtrusion",Te);K&&(v.context.activeTexture.set(O.TEXTURE0),Pe.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Te.updatePaintBuffers(oe)),bo(Te,q,ye,Pe,c);const Xe=v.translatePosMatrix(Ce.posMatrix,Pe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),it=c.paint.get("fill-extrusion-vertical-gradient"),mt=K?va(Xe,v,it,me,Ce,oe,Pe):Es(Xe,v,it,me);We.draw(P,P.gl.TRIANGLES,m,b,A,$i.backCCW,mt,Ne,c.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,c.paint,v.transform.zoom,Te,v.style.map.terrain&&Oe.centroidVertexBuffer)}}function vo(v,e,c,p,m,b,A){const P=v.context,O=P.gl,q=c.fbo;if(!q)return;const X=v.useProgram("hillshade"),K=v.style.map.terrain&&v.style.map.terrain.getTerrainData(e);P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,q.colorAttachment.get()),X.draw(P,O.TRIANGLES,m,b,A,$i.disabled,((oe,me,ye,Ce)=>{const Pe=ye.paint.get("hillshade-shadow-color"),Oe=ye.paint.get("hillshade-highlight-color"),Ne=ye.paint.get("hillshade-accent-color");let Te=ye.paint.get("hillshade-illumination-direction")*(Math.PI/180);ye.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=oe.transform.angle);const We=!oe.options.moving;return{u_matrix:Ce?Ce.posMatrix:oe.transform.calculatePosMatrix(me.tileID.toUnwrapped(),We),u_image:0,u_latrange:$n(0,me.tileID),u_light:[ye.paint.get("hillshade-exaggeration"),Te],u_shadow:Pe,u_highlight:Oe,u_accent:Ne}})(v,c,p,K?e:null),K,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function wo(v,e,c,p,m,b){const A=v.context,P=A.gl,O=e.dem;if(O&&O.data){const q=O.dim,X=O.stride,K=O.getPixels();if(A.activeTexture.set(P.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||v.getTileTexture(X),e.demTexture){const me=e.demTexture;me.update(K,{premultiply:!1}),me.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else e.demTexture=new B(A,K,P.RGBA,{premultiply:!1}),e.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);A.activeTexture.set(P.TEXTURE0);let oe=e.fbo;if(!oe){const me=new B(A,{width:q,height:q,data:null},P.RGBA);me.bind(P.LINEAR,P.CLAMP_TO_EDGE),oe=e.fbo=A.createFramebuffer(q,q,!0,!1),oe.colorAttachment.set(me.texture)}A.bindFramebuffer.set(oe.framebuffer),A.viewport.set([0,0,q,q]),v.useProgram("hillshadePrepare").draw(A,P.TRIANGLES,p,m,b,$i.disabled,((me,ye)=>{const Ce=ye.stride,Pe=o.H();return o.aP(Pe,0,o.X,-o.X,0,0,1),o.J(Pe,Pe,[0,-o.X,0]),{u_matrix:Pe,u_image:1,u_dimension:[Ce,Ce],u_zoom:me.overscaledZ,u_unpack:ye.getUnpackVector()}})(e.tileID,O),null,c.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function dl(v,e,c,p,m,b){const A=p.paint.get("raster-fade-duration");if(!b&&A>0){const P=y.now(),O=(P-v.timeAdded)/A,q=e?(P-e.timeAdded)/A:-1,X=c.getSource(),K=m.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),oe=!e||Math.abs(e.tileID.overscaledZ-K)>Math.abs(v.tileID.overscaledZ-K),me=oe&&v.refreshedUponExpiration?1:o.ac(oe?O:1-q,0,1);return v.refreshedUponExpiration&&O>=1&&(v.refreshedUponExpiration=!1),e?{opacity:1,mix:1-me}:{opacity:me,mix:0}}return{opacity:1,mix:0}}const pl=new o.aM(1,0,0,1),Vi=new o.aM(0,1,0,1),xo=new o.aM(0,0,1,1),ac=new o.aM(1,0,1,1),zs=new o.aM(0,1,1,1);function no(v,e,c,p){ea(v,0,e+c/2,v.transform.width,c,p)}function Ia(v,e,c,p){ea(v,e-c/2,0,c,v.transform.height,p)}function ea(v,e,c,p,m,b){const A=v.context,P=A.gl;P.enable(P.SCISSOR_TEST),P.scissor(e*v.pixelRatio,c*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),A.clear({color:b}),P.disable(P.SCISSOR_TEST)}function Aa(v,e,c){const p=v.context,m=p.gl,b=c.posMatrix,A=v.useProgram("debug"),P=Pi.disabled,O=Qi.disabled,q=v.colorModeForRenderPass(),X="$debug",K=v.style.map.terrain&&v.style.map.terrain.getTerrainData(c);p.activeTexture.set(m.TEXTURE0);const oe=e.getTileByID(c.key).latestRawTileData,me=Math.floor((oe&&oe.byteLength||0)/1024),ye=e.getTile(c).tileSize,Ce=512/Math.min(ye,512)*(c.overscaledZ/v.transform.zoom)*.5;let Pe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Pe+=` => ${c.overscaledZ}`),function(Oe,Ne){Oe.initDebugOverlayCanvas();const Te=Oe.debugOverlayCanvas,We=Oe.context.gl,Xe=Oe.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Te.width,Te.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(Ne,5,5),Xe.strokeText(Ne,5,5),Oe.debugOverlayTexture.update(Te),Oe.debugOverlayTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE)}(v,`${Pe} ${me}kB`),A.draw(p,m.TRIANGLES,P,O,Tn.alphaBlended,$i.disabled,mo(b,o.aM.transparent,Ce),null,X,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),A.draw(p,m.LINE_STRIP,P,O,q,$i.disabled,mo(b,o.aM.red),K,X,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function ml(v,e,c){const p=v.context,m=p.gl,b=v.colorModeForRenderPass(),A=new Pi(m.LEQUAL,Pi.ReadWrite,v.depthRangeFor3D),P=v.useProgram("terrain"),O=e.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,v.width,v.height]);for(const q of c){const X=v.renderToTexture.getTexture(q),K=e.getTerrainData(q.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,X.texture);const oe=v.transform.calculatePosMatrix(q.tileID.toUnwrapped()),me=e.getMeshFrameDelta(v.transform.zoom),ye=v.transform.calculateFogMatrix(q.tileID.toUnwrapped()),Ce=ba(oe,me,ye,v.style.sky,v.transform.pitch);P.draw(p,m.TRIANGLES,A,Qi.disabled,b,$i.backCCW,Ce,K,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}class So{constructor(e,c,p){this.vertexBuffer=e,this.indexBuffer=c,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Ma{constructor(e,c){this.context=new uu(e),this.transform=c,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ti.maxUnderzooming+ti.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ol}resize(e,c,p){if(this.width=Math.floor(e*p),this.height=Math.floor(c*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const e=this.context,c=new o.aX;c.emplaceBack(0,0),c.emplaceBack(o.X,0),c.emplaceBack(0,o.X),c.emplaceBack(o.X,o.X),this.tileExtentBuffer=e.createVertexBuffer(c,Hs.members),this.tileExtentSegments=o.a0.simpleSegment(0,0,4,2);const p=new o.aX;p.emplaceBack(0,0),p.emplaceBack(o.X,0),p.emplaceBack(0,o.X),p.emplaceBack(o.X,o.X),this.debugBuffer=e.createVertexBuffer(p,Hs.members),this.debugSegments=o.a0.simpleSegment(0,0,4,5);const m=new o.$;m.emplaceBack(0,0,0,0),m.emplaceBack(o.X,0,o.X,0),m.emplaceBack(0,o.X,0,o.X),m.emplaceBack(o.X,o.X,o.X,o.X),this.rasterBoundsBuffer=e.createVertexBuffer(m,Y.members),this.rasterBoundsSegments=o.a0.simpleSegment(0,0,4,2);const b=new o.aX;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(b,Hs.members),this.viewportSegments=o.a0.simpleSegment(0,0,4,2);const A=new o.aZ;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(A);const P=new o.aY;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(P);const O=this.context.gl;this.stencilClearMode=new Qi({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)}clearStencil(){const e=this.context,c=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=o.H();o.aP(p,0,this.width,this.height,0,0,1),o.K(p,p,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,c.TRIANGLES,Pi.disabled,this.stencilClearMode,Tn.disabled,$i.disabled,Vn(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!c||!c.length)return;this.currentStencilSource=e.source;const p=this.context,m=p.gl;this.nextStencilID+c.length>256&&this.clearStencil(),p.setColorMode(Tn.disabled),p.setDepthMode(Pi.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of c){const P=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A);b.draw(p,m.TRIANGLES,Pi.disabled,new Qi({func:m.ALWAYS,mask:0},P,255,m.KEEP,m.KEEP,m.REPLACE),Tn.disabled,$i.disabled,Vn(A.posMatrix),O,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,c=this.context.gl;return new Qi({func:c.NOTEQUAL,mask:255},e,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(e){const c=this.context.gl;return new Qi({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(e){const c=this.context.gl,p=e.sort((A,P)=>P.overscaledZ-A.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const A={};for(let P=0;P<b;P++)A[P+m]=new Qi({func:c.GEQUAL,mask:255},P+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[A,p]}return[{[m]:Qi.disabled},p]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Tn([e.CONSTANT_COLOR,e.ONE],new o.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tn.unblended:Tn.alphaBlended}depthModeForSublayer(e,c,p){if(!this.opaquePassEnabledForLayer())return Pi.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Pi(p||this.context.gl.LEQUAL,c,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,c){this.style=e,this.options=c,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},A={},P={};for(const O in m){const q=m[O];q.used&&q.prepare(this.context),b[O]=q.getVisibleCoordinates(),A[O]=b[O].slice().reverse(),P[O]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<p.length;O++)if(this.style._layers[p[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const O of p){const q=this.style._layers[O];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const X=A[q.source];(q.type==="custom"||X.length)&&this.renderLayer(this,m[q.source],q,X)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?o.aM.black:o.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(O,q){const X=O.context,K=X.gl,oe=((Oe,Ne,Te)=>({u_sky_color:Oe.properties.get("sky-color"),u_horizon_color:Oe.properties.get("horizon-color"),u_horizon:(Ne.height/2+Ne.getHorizon())*Te,u_sky_horizon_blend:Oe.properties.get("sky-horizon-blend")*Ne.height/2*Te}))(q,O.style.map.transform,O.pixelRatio),me=new Pi(K.LEQUAL,Pi.ReadWrite,[0,1]),ye=Qi.disabled,Ce=O.colorModeForRenderPass(),Pe=O.useProgram("sky");if(!q.mesh){const Oe=new o.aX;Oe.emplaceBack(-1,-1),Oe.emplaceBack(1,-1),Oe.emplaceBack(1,1),Oe.emplaceBack(-1,1);const Ne=new o.aY;Ne.emplaceBack(0,1,2),Ne.emplaceBack(0,2,3),q.mesh=new So(X.createVertexBuffer(Oe,Hs.members),X.createIndexBuffer(Ne),o.a0.simpleSegment(0,0,Oe.length,Ne.length))}Pe.draw(X,K.TRIANGLES,me,ye,Ce,$i.disabled,oe,void 0,"sky",q.mesh.vertexBuffer,q.mesh.indexBuffer,q.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[p[this.currentLayer]],q=m[O.source],X=b[O.source];this._renderTileClippingMasks(O,X),this.renderLayer(this,q,O,X)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const O=this.style._layers[p[this.currentLayer]],q=m[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O))continue;const X=(O.type==="symbol"?P:A)[O.source];this._renderTileClippingMasks(O,b[O.source]),this.renderLayer(this,q,O,X)}if(this.options.showTileBoundaries){const O=function(q,X){let K=null;const oe=Object.values(q._layers).flatMap(Pe=>Pe.source&&!Pe.isHidden(X)?[q.sourceCaches[Pe.source]]:[]),me=oe.filter(Pe=>Pe.getSource().type==="vector"),ye=oe.filter(Pe=>Pe.getSource().type!=="vector"),Ce=Pe=>{(!K||K.getSource().maxzoom<Pe.getSource().maxzoom)&&(K=Pe)};return me.forEach(Pe=>Ce(Pe)),K||ye.forEach(Pe=>Ce(Pe)),K}(this.style,this.transform.zoom);O&&function(q,X,K){for(let oe=0;oe<K.length;oe++)Aa(q,X,K[oe])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const q=O.transform.padding;no(O,O.transform.height-(q.top||0),3,pl),no(O,q.bottom||0,3,Vi),Ia(O,q.left||0,3,xo),Ia(O,O.transform.width-(q.right||0),3,ac);const X=O.transform.centerPoint;(function(K,oe,me,ye){ea(K,oe-1,me-10,2,20,ye),ea(K,oe-10,me-1,20,2,ye)})(O,X.x,O.transform.height-X.y,zs)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const c=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=e?!o.a_(c,p):!o.a$(c,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(o.b0(c,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,A){const P=b.context,O=P.gl,q=Tn.unblended,X=new Pi(O.LEQUAL,Pi.ReadWrite,[0,1]),K=A.getTerrainMesh(),oe=A.sourceCache.getRenderableTiles(),me=b.useProgram("terrainDepth");P.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),P.clear({color:o.aM.transparent,depth:1});for(const ye of oe){const Ce=A.getTerrainData(ye.tileID),Pe={u_matrix:b.transform.calculatePosMatrix(ye.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(b.transform.zoom)};me.draw(P,O.TRIANGLES,X,Qi.disabled,q,$i.backCCW,Pe,Ce,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,A){const P=b.context,O=P.gl,q=Tn.unblended,X=new Pi(O.LEQUAL,Pi.ReadWrite,[0,1]),K=A.getTerrainMesh(),oe=A.getCoordsTexture(),me=A.sourceCache.getRenderableTiles(),ye=b.useProgram("terrainCoords");P.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),P.clear({color:o.aM.transparent,depth:1}),A.coordsIndex=[];for(const Ce of me){const Pe=A.getTerrainData(Ce.tileID);P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,oe.texture);const Oe={u_matrix:b.transform.calculatePosMatrix(Ce.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(b.transform.zoom)};ye.draw(P,O.TRIANGLES,X,Qi.disabled,q,$i.backCCW,Oe,Pe,"terrain",K.vertexBuffer,K.indexBuffer,K.segments),A.coordsIndex.push(Ce.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(e,c,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,A,P,O,q){if(b.renderPass!=="translucent")return;const X=Qi.disabled,K=b.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(oe,me,ye,Ce,Pe,Oe,Ne,Te,We){const Xe=me.transform,it=Rn(),mt=Pe==="map",Tt=Oe==="map";for(const Dt of oe){const Nt=Ce.getTile(Dt),Lt=Nt.getBucket(ye);if(!Lt||!Lt.text||!Lt.text.segments.get().length)continue;const Mt=o.ag(Lt.textSizeData,Xe.zoom),Ht=xi(Nt,1,me.transform.zoom),vi=Sr(Dt.posMatrix,Tt,mt,me.transform,Ht),zt=ye.layout.get("icon-text-fit")!=="none"&&Lt.hasIconData();if(Mt){const Rt=Math.pow(2,Xe.zoom-Nt.tileID.overscaledZ),_i=me.style.map.terrain?(Ii,Ni)=>me.style.map.terrain.getElevation(Dt,Ii,Ni):null,gn=it.translatePosition(Xe,Nt,Ne,Te);yo(Lt,mt,Tt,We,Xe,vi,Dt.posMatrix,Rt,Mt,zt,it,gn,Dt.toUnwrapped(),_i)}}}(O,b,P,A,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),q),P.paint.get("icon-opacity").constantOr(1)!==0&&fl(b,A,P,O,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),X,K),P.paint.get("text-opacity").constantOr(1)!==0&&fl(b,A,P,O,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),X,K),A.map.showCollisionBoxes&&(Ko(b,A,P,O,!0),Ko(b,A,P,O,!1))})(e,c,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,A,P,O){if(b.renderPass!=="translucent")return;const q=P.paint.get("circle-opacity"),X=P.paint.get("circle-stroke-width"),K=P.paint.get("circle-stroke-opacity"),oe=!P.layout.get("circle-sort-key").isConstant();if(q.constantOr(1)===0&&(X.constantOr(1)===0||K.constantOr(1)===0))return;const me=b.context,ye=me.gl,Ce=b.depthModeForSublayer(0,Pi.ReadOnly),Pe=Qi.disabled,Oe=b.colorModeForRenderPass(),Ne=[];for(let Te=0;Te<O.length;Te++){const We=O[Te],Xe=A.getTile(We),it=Xe.getBucket(P);if(!it)continue;const mt=it.programConfigurations.get(P.id),Tt=b.useProgram("circle",mt),Dt=it.layoutVertexBuffer,Nt=it.indexBuffer,Lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(We),Mt={programConfiguration:mt,program:Tt,layoutVertexBuffer:Dt,indexBuffer:Nt,uniformValues:Zl(b,We,Xe,P),terrainData:Lt};if(oe){const Ht=it.segments.get();for(const vi of Ht)Ne.push({segments:new o.a0([vi]),sortKey:vi.sortKey,state:Mt})}else Ne.push({segments:it.segments,sortKey:0,state:Mt})}oe&&Ne.sort((Te,We)=>Te.sortKey-We.sortKey);for(const Te of Ne){const{programConfiguration:We,program:Xe,layoutVertexBuffer:it,indexBuffer:mt,uniformValues:Tt,terrainData:Dt}=Te.state;Xe.draw(me,ye.TRIANGLES,Ce,Pe,Oe,$i.disabled,Tt,Dt,P.id,it,mt,Te.segments,P.paint,b.transform.zoom,We)}})(e,c,p,m);break;case"heatmap":(function(b,A,P,O){if(P.paint.get("heatmap-opacity")===0)return;const q=b.context;if(b.style.map.terrain){for(const X of O){const K=A.getTile(X);A.hasRenderableParent(X)||(b.renderPass==="offscreen"?ds(b,K,P,X):b.renderPass==="translucent"&&io(b,P,X))}q.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(X,K,oe,me){const ye=X.context,Ce=ye.gl,Pe=Qi.disabled,Oe=new Tn([Ce.ONE,Ce.ONE],o.aM.transparent,[!0,!0,!0,!0]);(function(Ne,Te,We){const Xe=Ne.gl;Ne.activeTexture.set(Xe.TEXTURE1),Ne.viewport.set([0,0,Te.width/4,Te.height/4]);let it=We.heatmapFbos.get(o.aU);it?(Xe.bindTexture(Xe.TEXTURE_2D,it.colorAttachment.get()),Ne.bindFramebuffer.set(it.framebuffer)):(it=Yo(Ne,Te.width/4,Te.height/4),We.heatmapFbos.set(o.aU,it))})(ye,X,oe),ye.clear({color:o.aM.transparent});for(let Ne=0;Ne<me.length;Ne++){const Te=me[Ne];if(K.hasRenderableParent(Te))continue;const We=K.getTile(Te),Xe=We.getBucket(oe);if(!Xe)continue;const it=Xe.programConfigurations.get(oe.id),mt=X.useProgram("heatmap",it),{zoom:Tt}=X.transform;mt.draw(ye,Ce.TRIANGLES,Pi.disabled,Pe,Oe,$i.disabled,Qn(Te.posMatrix,We,Tt,oe.paint.get("heatmap-intensity")),null,oe.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,oe.paint,X.transform.zoom,it)}ye.viewport.set([0,0,X.width,X.height])}(b,A,P,O):b.renderPass==="translucent"&&function(X,K){const oe=X.context,me=oe.gl;oe.setColorMode(X.colorModeForRenderPass());const ye=K.heatmapFbos.get(o.aU);ye&&(oe.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,ye.colorAttachment.get()),oe.activeTexture.set(me.TEXTURE1),Qo(oe,K).bind(me.LINEAR,me.CLAMP_TO_EDGE),X.useProgram("heatmapTexture").draw(oe,me.TRIANGLES,Pi.disabled,Qi.disabled,X.colorModeForRenderPass(),$i.disabled,go(X,K,0,1),null,K.id,X.viewportBuffer,X.quadTriangleIndexBuffer,X.viewportSegments,K.paint,X.transform.zoom))}(b,P)})(e,c,p,m);break;case"line":(function(b,A,P,O){if(b.renderPass!=="translucent")return;const q=P.paint.get("line-opacity"),X=P.paint.get("line-width");if(q.constantOr(1)===0||X.constantOr(1)===0)return;const K=b.depthModeForSublayer(0,Pi.ReadOnly),oe=b.colorModeForRenderPass(),me=P.paint.get("line-dasharray"),ye=P.paint.get("line-pattern"),Ce=ye.constantOr(1),Pe=P.paint.get("line-gradient"),Oe=P.getCrossfadeParameters(),Ne=Ce?"linePattern":me?"lineSDF":Pe?"lineGradient":"line",Te=b.context,We=Te.gl;let Xe=!0;for(const it of O){const mt=A.getTile(it);if(Ce&&!mt.patternsLoaded())continue;const Tt=mt.getBucket(P);if(!Tt)continue;const Dt=Tt.programConfigurations.get(P.id),Nt=b.context.program.get(),Lt=b.useProgram(Ne,Dt),Mt=Xe||Lt.program!==Nt,Ht=b.style.map.terrain&&b.style.map.terrain.getTerrainData(it),vi=ye.constantOr(null);if(vi&&mt.imageAtlas){const _i=mt.imageAtlas,gn=_i.patternPositions[vi.to.toString()],Ii=_i.patternPositions[vi.from.toString()];gn&&Ii&&Dt.setConstantPatternPositions(gn,Ii)}const zt=Ht?it:null,Rt=Ce?Xs(b,mt,P,Oe,zt):me?Gl(b,mt,P,me,Oe,zt):Pe?Wl(b,mt,P,Tt.lineClipsArray.length,zt):wa(b,mt,P,zt);if(Ce)Te.activeTexture.set(We.TEXTURE0),mt.imageAtlasTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE),Dt.updatePaintBuffers(Oe);else if(me&&(Mt||b.lineAtlas.dirty))Te.activeTexture.set(We.TEXTURE0),b.lineAtlas.bind(Te);else if(Pe){const _i=Tt.gradients[P.id];let gn=_i.texture;if(P.gradientVersion!==_i.version){let Ii=256;if(P.stepInterpolant){const Ni=A.getSource().maxzoom,_n=it.canonical.z===Ni?Math.ceil(1<<b.transform.maxZoom-it.canonical.z):1;Ii=o.ac(o.aV(Tt.maxLineLength/o.X*1024*_n),256,Te.maxTextureSize)}_i.gradient=o.aW({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:Ii,image:_i.gradient||void 0,clips:Tt.lineClipsArray}),_i.texture?_i.texture.update(_i.gradient):_i.texture=new B(Te,_i.gradient,We.RGBA),_i.version=P.gradientVersion,gn=_i.texture}Te.activeTexture.set(We.TEXTURE0),gn.bind(P.stepInterpolant?We.NEAREST:We.LINEAR,We.CLAMP_TO_EDGE)}Lt.draw(Te,We.TRIANGLES,K,b.stencilModeForClipping(it),oe,$i.disabled,Rt,Ht,P.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,P.paint,b.transform.zoom,Dt,Tt.layoutVertexBuffer2),Xe=!1}})(e,c,p,m);break;case"fill":(function(b,A,P,O){const q=P.paint.get("fill-color"),X=P.paint.get("fill-opacity");if(X.constantOr(1)===0)return;const K=b.colorModeForRenderPass(),oe=P.paint.get("fill-pattern"),me=b.opaquePassEnabledForLayer()&&!oe.constantOr(1)&&q.constantOr(o.aM.transparent).a===1&&X.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===me){const ye=b.depthModeForSublayer(1,b.renderPass==="opaque"?Pi.ReadWrite:Pi.ReadOnly);$o(b,A,P,O,ye,K,!1)}if(b.renderPass==="translucent"&&P.paint.get("fill-antialias")){const ye=b.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Pi.ReadOnly);$o(b,A,P,O,ye,K,!0)}})(e,c,p,m);break;case"fill-extrusion":(function(b,A,P,O){const q=P.paint.get("fill-extrusion-opacity");if(q!==0&&b.renderPass==="translucent"){const X=new Pi(b.context.gl.LEQUAL,Pi.ReadWrite,b.depthRangeFor3D);if(q!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Ea(b,A,P,O,X,Qi.disabled,Tn.disabled),Ea(b,A,P,O,X,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const K=b.colorModeForRenderPass();Ea(b,A,P,O,X,Qi.disabled,K)}}})(e,c,p,m);break;case"hillshade":(function(b,A,P,O){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const q=b.context,X=b.depthModeForSublayer(0,Pi.ReadOnly),K=b.colorModeForRenderPass(),[oe,me]=b.renderPass==="translucent"?b.stencilConfigForOverlap(O):[{},O];for(const ye of me){const Ce=A.getTile(ye);Ce.needsHillshadePrepare!==void 0&&Ce.needsHillshadePrepare&&b.renderPass==="offscreen"?wo(b,Ce,P,X,Qi.disabled,K):b.renderPass==="translucent"&&vo(b,ye,Ce,P,X,oe[ye.overscaledZ],K)}q.viewport.set([0,0,b.width,b.height])})(e,c,p,m);break;case"raster":(function(b,A,P,O){if(b.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!O.length)return;const q=b.context,X=q.gl,K=A.getSource(),oe=b.useProgram("raster"),me=b.colorModeForRenderPass(),[ye,Ce]=K instanceof Ee?[{},O]:b.stencilConfigForOverlap(O),Pe=Ce[Ce.length-1].overscaledZ,Oe=!b.options.moving;for(const Ne of Ce){const Te=b.depthModeForSublayer(Ne.overscaledZ-Pe,P.paint.get("raster-opacity")===1?Pi.ReadWrite:Pi.ReadOnly,X.LESS),We=A.getTile(Ne);We.registerFadeDuration(P.paint.get("raster-fade-duration"));const Xe=A.findLoadedParent(Ne,0),it=A.findLoadedSibling(Ne),mt=dl(We,Xe||it||null,A,P,b.transform,b.style.map.terrain);let Tt,Dt;const Nt=P.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR;q.activeTexture.set(X.TEXTURE0),We.texture.bind(Nt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(X.TEXTURE1),Xe?(Xe.texture.bind(Nt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),Tt=Math.pow(2,Xe.tileID.overscaledZ-We.tileID.overscaledZ),Dt=[We.tileID.canonical.x*Tt%1,We.tileID.canonical.y*Tt%1]):We.texture.bind(Nt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),We.texture.useMipmap&&q.extTextureFilterAnisotropic&&b.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const Lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ne),Mt=Lt?Ne:null,Ht=Mt?Mt.posMatrix:b.transform.calculatePosMatrix(Ne.toUnwrapped(),Oe),vi=iu(Ht,Dt||[0,0],Tt||1,mt,P);K instanceof Ee?oe.draw(q,X.TRIANGLES,Te,Qi.disabled,me,$i.disabled,vi,Lt,P.id,K.boundsBuffer,b.quadTriangleIndexBuffer,K.boundsSegments):oe.draw(q,X.TRIANGLES,Te,ye[Ne.overscaledZ],me,$i.disabled,vi,Lt,P.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(e,c,p,m);break;case"background":(function(b,A,P,O){const q=P.paint.get("background-color"),X=P.paint.get("background-opacity");if(X===0)return;const K=b.context,oe=K.gl,me=b.transform,ye=me.tileSize,Ce=P.paint.get("background-pattern");if(b.isPatternMissing(Ce))return;const Pe=!Ce&&q.a===1&&X===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==Pe)return;const Oe=Qi.disabled,Ne=b.depthModeForSublayer(0,Pe==="opaque"?Pi.ReadWrite:Pi.ReadOnly),Te=b.colorModeForRenderPass(),We=b.useProgram(Ce?"backgroundPattern":"background"),Xe=O||me.coveringTiles({tileSize:ye,terrain:b.style.map.terrain});Ce&&(K.activeTexture.set(oe.TEXTURE0),b.imageManager.bind(b.context));const it=P.getCrossfadeParameters();for(const mt of Xe){const Tt=O?mt.posMatrix:b.transform.calculatePosMatrix(mt.toUnwrapped()),Dt=Ce?qo(Tt,X,b,Ce,{tileID:mt,tileSize:ye},it):Vo(Tt,X,q),Nt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(mt);We.draw(K,oe.TRIANGLES,Ne,Oe,Te,$i.disabled,Dt,Nt,P.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(e,0,p,m);break;case"custom":(function(b,A,P){const O=b.context,q=P.implementation;if(b.renderPass==="offscreen"){const X=q.prerender;X&&(b.setCustomLayerDefaults(),O.setColorMode(b.colorModeForRenderPass()),X.call(q,O.gl,b.transform.customLayerMatrix()),O.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),O.setColorMode(b.colorModeForRenderPass()),O.setStencilMode(Qi.disabled);const X=q.renderingMode==="3d"?new Pi(b.context.gl.LEQUAL,Pi.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Pi.ReadOnly);O.setDepthMode(X),q.render(O.gl,b.transform.customLayerMatrix(),{farZ:b.transform.farZ,nearZ:b.transform.nearZ,fov:b.transform._fov,modelViewProjectionMatrix:b.transform.modelViewProjectionMatrix,projectionMatrix:b.transform.projectionMatrix}),O.setDirty(),b.setBaseState(),O.bindFramebuffer.set(null)}})(e,0,p)}}translatePosMatrix(e,c,p,m,b){if(!p[0]&&!p[1])return e;const A=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(A){const q=Math.sin(A),X=Math.cos(A);p=[p[0]*X-p[1]*q,p[0]*q+p[1]*X]}const P=[b?p[0]:xi(c,p[0],this.transform.zoom),b?p[1]:xi(c,p[1],this.transform.zoom),0],O=new Float32Array(16);return o.J(O,e,P),O}saveTileTexture(e){const c=this._tileTextures[e.size[0]];c?c.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const c=this._tileTextures[e];return c&&c.length>0?c.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const c=this.imageManager.getPattern(e.from.toString()),p=this.imageManager.getPattern(e.to.toString());return!c||!p}useProgram(e,c){this.cache=this.cache||{};const p=e+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new al(this.context,Bn[e],c,cl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new B(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:c}=this.context.gl;return this.width!==e||this.height!==c}}class Cr{constructor(e,c){this.points=e,this.planes=c}static fromInvProjectionMatrix(e,c,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const O=1/(P=o.af([],P,e))[3]/c*m;return o.b1(P,P,[O,O,1/P[3],O])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const O=function(oe,me){var ye=me[0],Ce=me[1],Pe=me[2],Oe=ye*ye+Ce*Ce+Pe*Pe;return Oe>0&&(Oe=1/Math.sqrt(Oe)),oe[0]=me[0]*Oe,oe[1]=me[1]*Oe,oe[2]=me[2]*Oe,oe}([],function(oe,me,ye){var Ce=me[0],Pe=me[1],Oe=me[2],Ne=ye[0],Te=ye[1],We=ye[2];return oe[0]=Pe*We-Oe*Te,oe[1]=Oe*Ne-Ce*We,oe[2]=Ce*Te-Pe*Ne,oe}([],re([],b[P[0]],b[P[1]]),re([],b[P[2]],b[P[1]]))),q=-((X=O)[0]*(K=b[P[1]])[0]+X[1]*K[1]+X[2]*K[2]);var X,K;return O.concat(q)});return new Cr(b,A)}}class pr{constructor(e,c){this.min=e,this.max=c,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(e){const c=[e%2==0,e<2],p=ae(this.min),m=ae(this.max);for(let b=0;b<c.length;b++)p[b]=c[b]?this.min[b]:this.center[b],m[b]=c[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new pr(p,m)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<e.planes.length;m++){const b=e.planes[m];let A=0;for(let P=0;P<c.length;P++)o.b2(b,c[P])>=0&&A++;if(A===0)return 0;A!==c.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let P=0;P<e.points.length;P++){const O=e.points[P][m]-this.min[m];b=Math.min(b,O),A=Math.max(A,O)}if(A<0||b>this.max[m]-this.min[m])return 0}return 1}}class To{constructor(e=0,c=0,p=0,m=0){if(isNaN(e)||e<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=c,this.left=p,this.right=m}interpolate(e,c,p){return c.top!=null&&e.top!=null&&(this.top=o.y.number(e.top,c.top,p)),c.bottom!=null&&e.bottom!=null&&(this.bottom=o.y.number(e.bottom,c.bottom,p)),c.left!=null&&e.left!=null&&(this.left=o.y.number(e.left,c.left,p)),c.right!=null&&e.right!=null&&(this.right=o.y.number(e.right,c.right,p)),this}getCenter(e,c){const p=o.ac((this.left+e-this.right)/2,0,e),m=o.ac((this.top+c-this.bottom)/2,0,c);return new o.P(p,m)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new To(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const gl=85.051129;class ko{constructor(e,c,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=e||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new To,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new ko(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const c=-o.b3(e,-180,180)*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=function(){var p=new o.A(4);return o.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var A=m[0],P=m[1],O=m[2],q=m[3],X=Math.sin(b),K=Math.cos(b);p[0]=A*K+O*X,p[1]=P*K+q*X,p[2]=A*-X+O*K,p[3]=P*-X+q*K}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const c=o.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const c=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.tileZoom=Math.max(0,Math.floor(c)),this.scale=this.zoomScale(c),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,c,p){this._unmodified=!1,this._edgeInsets.interpolate(e,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const c=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(e){const c=[new o.b4(0,e)];if(this._renderWorldCopies){const p=this.pointCoordinate(new o.P(0,0)),m=this.pointCoordinate(new o.P(this.width,0)),b=this.pointCoordinate(new o.P(this.width,this.height)),A=this.pointCoordinate(new o.P(0,this.height)),P=Math.floor(Math.min(p.x,m.x,b.x,A.x)),O=Math.floor(Math.max(p.x,m.x,b.x,A.x)),q=1;for(let X=P-q;X<=O+q;X++)X!==0&&c.push(new o.b4(X,e))}return c}coveringTiles(e){var c,p;let m=this.coveringZoomLevel(e);const b=m;if(e.minzoom!==void 0&&m<e.minzoom)return[];e.maxzoom!==void 0&&m>e.maxzoom&&(m=e.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),P=o.Z.fromLngLat(this.center),O=Math.pow(2,m),q=[O*A.x,O*A.y,0],X=[O*P.x,O*P.y,0],K=Cr.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let oe=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(oe=m);const me=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,ye=Te=>({aabb:new pr([Te*O,0,0],[(Te+1)*O,O,0]),zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),Ce=[],Pe=[],Oe=m,Ne=e.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let Te=1;Te<=3;Te++)Ce.push(ye(-Te)),Ce.push(ye(Te));for(Ce.push(ye(0));Ce.length>0;){const Te=Ce.pop(),We=Te.x,Xe=Te.y;let it=Te.fullyVisible;if(!it){const Lt=Te.aabb.intersects(K);if(Lt===0)continue;it=Lt===2}const mt=e.terrain?q:X,Tt=Te.aabb.distanceX(mt),Dt=Te.aabb.distanceY(mt),Nt=Math.max(Math.abs(Tt),Math.abs(Dt));if(Te.zoom===Oe||Nt>me+(1<<Oe-Te.zoom)-2&&Te.zoom>=oe){const Lt=Oe-Te.zoom,Mt=q[0]-.5-(We<<Lt),Ht=q[1]-.5-(Xe<<Lt);Pe.push({tileID:new o.S(Te.zoom===Oe?Ne:Te.zoom,Te.wrap,Te.zoom,We,Xe),distanceSq:j([X[0]-.5-We,X[1]-.5-Xe]),tileDistanceToCamera:Math.sqrt(Mt*Mt+Ht*Ht)})}else for(let Lt=0;Lt<4;Lt++){const Mt=(We<<1)+Lt%2,Ht=(Xe<<1)+(Lt>>1),vi=Te.zoom+1;let zt=Te.aabb.quadrant(Lt);if(e.terrain){const Rt=new o.S(vi,Te.wrap,vi,Mt,Ht),_i=e.terrain.getMinMaxElevation(Rt),gn=(c=_i.minElevation)!==null&&c!==void 0?c:this.elevation,Ii=(p=_i.maxElevation)!==null&&p!==void 0?p:this.elevation;zt=new pr([zt.min[0],zt.min[1],gn],[zt.max[0],zt.max[1],Ii])}Ce.push({aabb:zt,zoom:vi,x:Mt,y:Ht,wrap:Te.wrap,fullyVisible:it})}}return Pe.sort((Te,We)=>Te.distanceSq-We.distanceSq).map(Te=>Te.tileID)}resize(e,c){this.width=e,this.height=c,this.pixelsToGLUnits=[2/e,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const c=o.ac(e.lat,-85.051129,gl);return new o.P(o.O(e.lng)*this.worldSize,o.Q(c)*this.worldSize)}unproject(e){return new o.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const c=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,e),b=e.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const A=p+c-b,P=Math.cos(this._pitch)*this.cameraToCenterDistance/A/o.b5(1,m.lat),O=this.scaleZoom(P/this.tileSize);this._elevation=b,this._center=m,this.zoom=O}setLocationAtPoint(e,c){const p=this.pointCoordinate(c),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(e),A=new o.Z(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,c){return c?this.coordinatePoint(this.locationCoordinate(e),c.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,c){return this.coordinateLocation(this.pointCoordinate(e,c))}locationCoordinate(e){return o.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,c){if(c){const oe=c.pointCoordinate(e);if(oe!=null)return oe}const p=[e.x,e.y,0,1],m=[e.x,e.y,1,1];o.af(p,p,this.pixelMatrixInverse),o.af(m,m,this.pixelMatrixInverse);const b=p[3],A=m[3],P=p[1]/b,O=m[1]/A,q=p[2]/b,X=m[2]/A,K=q===X?0:(0-q)/(X-q);return new o.Z(o.y.number(p[0]/b,m[0]/A,K)/this.worldSize,o.y.number(P,O,K)/this.worldSize)}coordinatePoint(e,c=0,p=this.pixelMatrix){const m=[e.x*this.worldSize,e.y*this.worldSize,c,1];return o.af(m,m,p),new o.P(m[0]/m[3],m[1]/m[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Je().extend(this.pointLocation(new o.P(0,e))).extend(this.pointLocation(new o.P(this.width,e))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Je([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,gl])}calculateTileMatrix(e){const c=e.canonical,p=this.worldSize/this.zoomScale(c.z),m=c.x+Math.pow(2,c.z)*e.wrap,b=o.an(new Float64Array(16));return o.J(b,b,[m*p,c.y*p,0]),o.K(b,b,[p/o.X,p/o.X,1]),b}calculatePosMatrix(e,c=!1){const p=e.key,m=c?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=this.calculateTileMatrix(e);return o.L(b,c?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,b),m[p]=new Float32Array(b),m[p]}calculateFogMatrix(e){const c=e.key,p=this._fogMatrixCache;if(p[c])return p[c];const m=this.calculateTileMatrix(e);return o.L(m,this.fogMatrix,m),p[c]=new Float32Array(m),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,c){c=o.ac(+c,this.minZoom,this.maxZoom);const p={center:new o.N(e.lng,e.lat),zoom:c};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const Te=179.9999999999;m=[-Te,Te]}const b=this.tileSize*this.zoomScale(p.zoom);let A=0,P=b,O=0,q=b,X=0,K=0;const{x:oe,y:me}=this.size;if(this.latRange){const Te=this.latRange;A=o.Q(Te[1])*b,P=o.Q(Te[0])*b,P-A<me&&(X=me/(P-A))}m&&(O=o.b3(o.O(m[0])*b,0,b),q=o.b3(o.O(m[1])*b,0,b),q<O&&(q+=b),q-O<oe&&(K=oe/(q-O)));const{x:ye,y:Ce}=this.project.call({worldSize:b},e);let Pe,Oe;const Ne=Math.max(K||0,X||0);if(Ne){const Te=new o.P(K?(q+O)/2:ye,X?(P+A)/2:Ce);return p.center=this.unproject.call({worldSize:b},Te).wrap(),p.zoom+=this.scaleZoom(Ne),p}if(this.latRange){const Te=me/2;Ce-Te<A&&(Oe=A+Te),Ce+Te>P&&(Oe=P-Te)}if(m){const Te=(O+q)/2;let We=ye;this._renderWorldCopies&&(We=o.b3(ye,Te-b/2,Te+b/2));const Xe=oe/2;We-Xe<O&&(Pe=O+Xe),We+Xe>q&&(Pe=q-Xe)}if(Pe!==void 0||Oe!==void 0){const Te=new o.P(Pe??ye,Oe??Ce);p.center=this.unproject.call({worldSize:b},Te).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:c,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=c,this.zoom=p,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,c=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b5(1,this.center.lat)*this.worldSize;let m=o.an(new Float64Array(16));o.K(m,m,[this.width/2,-this.height/2,1]),o.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=o.an(new Float64Array(16)),o.K(m,m,[1,-1,1]),o.J(m,m,[-1,-1,0]),o.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),A=Math.min(this.elevation,this.minElevationForCurrentTile),P=b-A*this._pixelPerMeter/Math.cos(this._pitch),O=A<0?P:b,q=Math.PI/2+this._pitch,X=this._fov*(.5+e.y/this.height),K=Math.sin(X)*O/Math.sin(o.ac(Math.PI-q-X,.01,Math.PI-.01)),oe=this.getHorizon(),me=2*Math.atan(oe/this.cameraToCenterDistance)*(.5+e.y/(2*oe)),ye=Math.sin(me)*O/Math.sin(o.ac(Math.PI-q-me,.01,Math.PI-.01)),Ce=Math.min(K,ye);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Ce+O),this.nearZ=this.height/50,m=new Float64Array(16),o.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-e.x/this.width,m[9]=2*e.y/this.height,this.projectionMatrix=o.ae(m),o.K(m,m,[1,-1,1]),o.J(m,m,[0,0,-this.cameraToCenterDistance]),o.b7(m,m,this._pitch),o.ad(m,m,this.angle),o.J(m,m,[-c,-p,0]),this.mercatorMatrix=o.K([],m,[this.worldSize,this.worldSize,this.worldSize]),o.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.L(new Float64Array(16),this.labelPlaneMatrix,m),o.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=o.as([],m),this.fogMatrix=new Float64Array(16),o.b6(this.fogMatrix,this._fov,this.width/this.height,b,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,o.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),o.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b7(this.fogMatrix,this.fogMatrix,this._pitch),o.ad(this.fogMatrix,this.fogMatrix,this.angle),o.J(this.fogMatrix,this.fogMatrix,[-c,-p,0]),o.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),o.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=o.L(new Float64Array(16),this.labelPlaneMatrix,m);const Pe=this.width%2/2,Oe=this.height%2/2,Ne=Math.cos(this.angle),Te=Math.sin(this.angle),We=c-Math.round(c)+Ne*Pe+Te*Oe,Xe=p-Math.round(p)+Ne*Oe+Te*Pe,it=new Float64Array(m);if(o.J(it,it,[We>.5?We-1:We,Xe>.5?Xe-1:Xe,0]),this.alignedModelViewProjectionMatrix=it,m=o.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new o.P(0,0)),c=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.af(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,e))}getCameraQueryGeometry(e){const c=this.getCameraPoint();if(e.length===1)return[e[0],c];{let p=c.x,m=c.y,b=c.x,A=c.y;for(const P of e)p=Math.min(p,P.x),m=Math.min(m,P.y),b=Math.max(b,P.x),A=Math.max(A,P.y);return[new o.P(p,m),new o.P(b,m),new o.P(b,A),new o.P(p,A),new o.P(p,m)]}}lngLatToCameraDepth(e,c){const p=this.locationCoordinate(e),m=[p.x*this.worldSize,p.y*this.worldSize,c,1];return o.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function ta(v,e){let c,p=!1,m=null,b=null;const A=()=>{m=null,p&&(v.apply(b,c),m=setTimeout(A,e),p=!1)};return(...P)=>(p=!0,b=this,c=P,m||A(),m)}class Pa{constructor(e){this._getCurrentHash=()=>{const c=window.location.hash.replace("#","");if(this._hashName){let p;return c.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return c.split("/")},this._onHashChange=()=>{const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const c=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,c)},this._removeHash=()=>{const c=this._getCurrentHash();if(c.length===0)return;const p=c.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let A=window.location.href.replace(/(#.+)?$/,b);A=A.replace("&&","&"),window.history.replaceState(window.history.state,null,A)},this._updateHash=ta(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const c=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),A=Math.round(c.lng*b)/b,P=Math.round(c.lat*b)/b,O=this._map.getBearing(),q=this._map.getPitch();let X="";if(X+=e?`/${A}/${P}/${p}`:`${p}/${P}/${A}`,(O||q)&&(X+="/"+Math.round(10*O)/10),q&&(X+=`/${Math.round(q)}`),this._hashName){const K=this._hashName;let oe=!1;const me=window.location.hash.slice(1).split("&").map(ye=>{const Ce=ye.split("=")[0];return Ce===K?(oe=!0,`${Ce}=${X}`):ye}).filter(ye=>ye);return oe||me.push(`${K}=${X}`),`#${me.join("&")}`}return`#${X}`}}const La={linearity:.3,easing:o.b8(0,0,.3,1)},_l=o.e({deceleration:2500,maxSpeed:1400},La),hu=o.e({deceleration:20,maxSpeed:1400},La),yl=o.e({deceleration:1e3,maxSpeed:360},La),ro=o.e({deceleration:1e3,maxSpeed:90},La);class Co{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,c=y.now();for(;e.length>0&&c-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(c.pan.mag()){const b=na(c.pan.mag(),p,o.e({},_l,e||{}));m.offset=c.pan.mult(b.amount/c.pan.mag()),m.center=this._map.transform.center,ia(m,b)}if(c.zoom){const b=na(c.zoom,p,hu);m.zoom=this._map.transform.zoom+b.amount,ia(m,b)}if(c.bearing){const b=na(c.bearing,p,yl);m.bearing=this._map.transform.bearing+o.ac(b.amount,-179,179),ia(m,b)}if(c.pitch){const b=na(c.pitch,p,ro);m.pitch=this._map.transform.pitch+b.amount,ia(m,b)}if(m.zoom||m.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),o.e(m,{noMoveStart:!0})}}function ia(v,e){(!v.duration||v.duration<e.duration)&&(v.duration=e.duration,v.easing=e.easing)}function na(v,e,c){const{maxSpeed:p,linearity:m,deceleration:b}=c,A=o.ac(v*m/(e/1e3),-p,p),P=Math.abs(A)/(b*m);return{easing:c.easing,duration:1e3*P,amount:A*(P/2)}}class Mn extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,p,m={}){const b=k.mousePos(c.getCanvas(),p),A=c.unproject(b);super(e,o.e({point:b,lngLat:A,originalEvent:p},m)),this._defaultPrevented=!1,this.target=c}}class Be extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,p){const m=e==="touchend"?p.changedTouches:p.touches,b=k.touchPos(c.getCanvasContainer(),m),A=b.map(O=>c.unproject(O)),P=b.reduce((O,q,X,K)=>O.add(q.div(K.length)),new o.P(0,0));super(e,{points:b,point:P,lngLats:A,lngLat:c.unproject(P),originalEvent:p}),this._defaultPrevented=!1}}class D extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,p){super(e,{originalEvent:p}),this._defaultPrevented=!1}}class se{constructor(e,c){this._map=e,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new D(e.type,this._map,e))}mousedown(e,c){return this._mousedownPos=c,this._firePreventable(new Mn(e.type,this._map,e))}mouseup(e){this._map.fire(new Mn(e.type,this._map,e))}click(e,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new Mn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Mn(e.type,this._map,e))}mouseover(e){this._map.fire(new Mn(e.type,this._map,e))}mouseout(e){this._map.fire(new Mn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Be(e.type,this._map,e))}touchmove(e){this._map.fire(new Be(e.type,this._map,e))}touchend(e){this._map.fire(new Be(e.type,this._map,e))}touchcancel(e){this._map.fire(new Be(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class De{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Mn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Mn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ht{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(o.P.convert(e),this._map.terrain)}}class Et{constructor(e,c){this._map=e,this._tr=new ht(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,c){this.isEnabled()&&e.shiftKey&&e.button===0&&(k.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(e,c){if(!this._active)return;const p=c;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=k.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const b=Math.min(m.x,p.x),A=Math.max(m.x,p.x),P=Math.min(m.y,p.y),O=Math.max(m.y,p.y);k.setTransform(this._box,`translate(${b}px,${P}px)`),this._box.style.width=A-b+"px",this._box.style.height=O-P+"px"}mouseupWindow(e,c){if(!this._active||e.button!==0)return;const p=this._startPos,m=c;if(this.reset(),k.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:e})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,c){return this._map.fire(new o.k(e,{originalEvent:c}))}}function Wt(v,e){if(v.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${e.length}`);const c={};for(let p=0;p<v.length;p++)c[v[p].identifier]=e[p];return c}class Zi{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new o.P(0,0);for(const A of m)b._add(A);return b.div(m.length)}(c),this.touches=Wt(p,c)))}touchmove(e,c,p){if(this.aborted||!this.centroid)return;const m=Wt(p,c);for(const b in this.touches){const A=m[b];(!A||A.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(e,c,p){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class on{constructor(e){this.singleTap=new Zi(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,c,p){this.singleTap.touchstart(e,c,p)}touchmove(e,c,p){this.singleTap.touchmove(e,c,p)}touchend(e,c,p){const m=this.singleTap.touchend(e,c,p);if(m){const b=e.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(m)<30;if(b&&A||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class On{constructor(e){this._tr=new ht(e),this._zoomIn=new on({numTouches:1,numTaps:2}),this._zoomOut=new on({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,c,p){this._zoomIn.touchstart(e,c,p),this._zoomOut.touchstart(e,c,p)}touchmove(e,c,p){this._zoomIn.touchmove(e,c,p),this._zoomOut.touchmove(e,c,p)}touchend(e,c,p){const m=this._zoomIn.touchend(e,c,p),b=this._zoomOut.touchend(e,c,p),A=this._tr;return m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(m)},{originalEvent:e})}):b?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(b)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class In{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const c=this._moveFunction(...e);if(c.bearingDelta||c.pitchDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(e,c){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=c.length?c[0]:c,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,c){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const m=c.length?c[0]:c;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&k.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const mr={0:1,2:2};class Er{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const c=k.mouseButton(e);this._eventButton=c}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(c,p){const m=mr[p];return c.buttons===void 0||(c.buttons&m)!==m}(e,this._eventButton)}isValidEndEvent(e){return k.mouseButton(e)===this._eventButton}}class Nr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const $r=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=e=>{e.preventDefault()}},gr=({enable:v,clickTolerance:e,bearingDegreesPerPixelMoved:c=.8})=>{const p=new Er({checkCorrectEvent:m=>k.mouseButton(m)===0&&m.ctrlKey||k.mouseButton(m)===2});return new In({clickTolerance:e,move:(m,b)=>({bearingDelta:(b.x-m.x)*c}),moveStateManager:p,enable:v,assignEvents:$r})},so=({enable:v,clickTolerance:e,pitchDegreesPerPixelMoved:c=-.5})=>{const p=new Er({checkCorrectEvent:m=>k.mouseButton(m)===0&&m.ctrlKey||k.mouseButton(m)===2});return new In({clickTolerance:e,move:(m,b)=>({pitchDelta:(b.y-m.y)*c}),moveStateManager:p,enable:v,assignEvents:$r})};class es{constructor(e,c){this._clickTolerance=e.clickTolerance||1,this._map=c,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,c,p){return this._calculateTransform(e,c,p)}touchmove(e,c,p){if(this._active){if(!this._shouldBePrevented(p.length))return e.preventDefault(),this._calculateTransform(e,c,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,c,p){this._calculateTransform(e,c,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,c,p){p.length>0&&(this._active=!0);const m=Wt(p,c),b=new o.P(0,0),A=new o.P(0,0);let P=0;for(const q in m){const X=m[q],K=this._touches[q];K&&(b._add(X),A._add(X.sub(K)),P++,m[q]=X)}if(this._touches=m,this._shouldBePrevented(P)||!A.mag())return;const O=A.div(P);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(P),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class za{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(e,c,p){if(!this._firstTwoTouches)return;e.preventDefault();const[m,b]=this._firstTwoTouches,A=jr(p,c,m),P=jr(p,c,b);if(!A||!P)return;const O=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],O,e)}touchend(e,c,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,A=jr(p,c,m),P=jr(p,c,b);A&&P||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function jr(v,e,c){for(let p=0;p<v.length;p++)if(v[p].identifier===c)return e[p]}function bl(v,e){return Math.log(v/e)/Math.LN2}class fu extends za{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,c){const p=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(bl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bl(this._distance,p),pinchAround:c}}}function du(v,e){return 180*v.angleWith(e)/Math.PI}class pu extends za{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,c,p){const m=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:du(this._vector,m),pinchAround:c}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const c=25/(Math.PI*this._minDiameter)*360,p=du(e,this._startVector);return Math.abs(p)<c}}function lc(v){return Math.abs(v.y)>Math.abs(v.x)}class vl extends za{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,c,p){super.touchstart(e,c,p),this._currentTouchCount=p.length}_start(e){this._lastPoints=e,lc(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,c,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=e[0].sub(this._lastPoints[0]),b=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(e,c,p){if(this._valid!==void 0)return this._valid;const m=e.mag()>=2,b=c.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=e.y>0==c.y>0;return lc(e)&&lc(c)&&A}}const _h={panStep:100,bearingStep:15,pitchStep:10};class ts{constructor(e){this._tr=new ht(e);const c=_h;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let c=0,p=0,m=0,b=0,A=0;switch(e.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:e.shiftKey?p=-1:(e.preventDefault(),b=-1);break;case 39:e.shiftKey?p=1:(e.preventDefault(),b=1);break;case 38:e.shiftKey?m=1:(e.preventDefault(),A=-1);break;case 40:e.shiftKey?m=-1:(e.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:P=>{const O=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:c?Math.round(O.zoom)+c*(e.shiftKey?2:1):O.zoom,bearing:O.bearing+p*this._bearingStep,pitch:O.pitch+m*this._pitchStep,offset:[-b*this._panStep,-A*this._panStep],center:O.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Os(v){return v*(2-v)}const mu=4.000244140625;class ps{constructor(e,c){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=e,this._tr=new ht(e),this._triggerRenderFrame=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let c=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const p=y.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%mu==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(m*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),e.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=e,this._delta-=c,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=k.mousePos(this._map.getCanvas(),e),p=this._tr;this._around=c.y>p.transform.height/2-p.transform.getHorizon()?o.N.convert(this._aroundCenter?p.center:p.unproject(c)):o.N.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>mu?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&q!==0&&(q=1/q);const X=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(X*q))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,p=this._startZoom,m=this._easing;let b,A=!1;const P=y.now()-this._lastWheelEventTime;if(this._type==="wheel"&&p&&m&&P){const O=Math.min(P/200,1),q=m(O);b=o.y.number(p,c,q),O<1?this._frameId||(this._frameId=!0):A=!0}else b=c,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:b-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let c=o.b9;if(this._prevEase){const p=this._prevEase,m=(y.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),A=.27/Math.sqrt(b*b+1e-4)*.01,P=Math.sqrt(.0729-A*A);c=o.b8(A,P,.25,1)}return this._prevEase={start:y.now(),duration:e,easing:c},c}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ra{constructor(e,c){this._clickZoom=e,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class kf{constructor(e){this._tr=new ht(e),this.reset()}reset(){this._active=!1}dblclick(e,c){return e.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(c)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cf{constructor(){this._tap=new on({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,c,p){if(!this._swipePoint)if(this._tapTime){const m=c[0],b=e.timeStamp-this._tapTime<500,A=this._tapPoint.dist(m)<30;b&&A?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(e,c,p)}touchmove(e,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=c[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,e.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(e,c,p)}touchend(e,c,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(e,c,p);m&&(this._tapTime=e.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yh{constructor(e,c,p){this._el=e,this._mousePan=c,this._touchPan=p}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bh{constructor(e,c,p){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gu{constructor(e,c,p,m){this._el=e,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Oa{constructor(e,c){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=c,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=k.create("div","maplibregl-cooperative-gesture-screen",e);let c=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(c=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=c,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(k.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,c){this._enabled&&(this._map.fire(new o.k("cooperativegestureprevented",{gestureType:e,originalEvent:c})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const is=v=>v.zoom||v.drag||v.pitch||v.rotate;class Ut extends o.k{}function cc(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class _u{constructor(e,c){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=m.type==="renderFrame"?void 0:m,P={needsRenderFrame:!1},O={},q={},X=m.touches,K=X?this._getMapTouches(X):void 0,oe=K?k.touchPos(this._map.getCanvas(),K):k.mousePos(this._map.getCanvas(),m);for(const{handlerName:Ce,handler:Pe,allowed:Oe}of this._handlers){if(!Pe.isEnabled())continue;let Ne;this._blockedByActive(q,Oe,Ce)?Pe.reset():Pe[b||m.type]&&(Ne=Pe[b||m.type](m,oe,K),this.mergeHandlerResult(P,O,Ne,Ce,A),Ne&&Ne.needsRenderFrame&&this._triggerRenderFrame()),(Ne||Pe.isActive())&&(q[Ce]=Pe)}const me={};for(const Ce in this._previousActiveHandlers)q[Ce]||(me[Ce]=A);this._previousActiveHandlers=q,(Object.keys(me).length||cc(P))&&(this._changes.push([P,O,me]),this._triggerRenderFrame()),(Object.keys(q).length||cc(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ye}=P;ye&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ye(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Co(e),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,A]of this._listeners)k.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[e,c,p]of this._listeners)k.removeEventListener(e,c,e===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(e){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new se(c,e));const m=c.boxZoom=new Et(c,e);this._add("boxZoom",m),e.interactive&&e.boxZoom&&m.enable();const b=c.cooperativeGestures=new Oa(c,e.cooperativeGestures);this._add("cooperativeGestures",b),e.cooperativeGestures&&b.enable();const A=new On(c),P=new kf(c);c.doubleClickZoom=new ra(P,A),this._add("tapZoom",A),this._add("clickZoom",P),e.interactive&&e.doubleClickZoom&&c.doubleClickZoom.enable();const O=new Cf;this._add("tapDragZoom",O);const q=c.touchPitch=new vl(c);this._add("touchPitch",q),e.interactive&&e.touchPitch&&c.touchPitch.enable(e.touchPitch);const X=gr(e),K=so(e);c.dragRotate=new bh(e,X,K),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",K,["mouseRotate"]),e.interactive&&e.dragRotate&&c.dragRotate.enable();const oe=(({enable:Ne,clickTolerance:Te})=>{const We=new Er({checkCorrectEvent:Xe=>k.mouseButton(Xe)===0&&!Xe.ctrlKey});return new In({clickTolerance:Te,move:(Xe,it)=>({around:it,panDelta:it.sub(Xe)}),activateOnStart:!0,moveStateManager:We,enable:Ne,assignEvents:$r})})(e),me=new es(e,c);c.dragPan=new yh(p,oe,me),this._add("mousePan",oe),this._add("touchPan",me,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&c.dragPan.enable(e.dragPan);const ye=new pu,Ce=new fu;c.touchZoomRotate=new gu(p,Ce,ye,O),this._add("touchRotate",ye,["touchPan","touchZoom"]),this._add("touchZoom",Ce,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&c.touchZoomRotate.enable(e.touchZoomRotate);const Pe=c.scrollZoom=new ps(c,()=>this._triggerRenderFrame());this._add("scrollZoom",Pe,["mousePan"]),e.interactive&&e.scrollZoom&&c.scrollZoom.enable(e.scrollZoom);const Oe=c.keyboard=new ts(c);this._add("keyboard",Oe),e.interactive&&e.keyboard&&c.keyboard.enable(),this._add("blockableMapEvent",new De(c))}_add(e,c,p){this._handlers.push({handlerName:e,handler:c,allowed:p}),this._handlersById[e]=c}stop(e){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!is(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,c,p){for(const m in e)if(m!==p&&(!c||c.indexOf(m)<0))return!0;return!1}_getMapTouches(e){const c=[];for(const p of e)this._el.contains(p.target)&&c.push(p);return c}mergeHandlerResult(e,c,p,m,b){if(!p)return;o.e(e,p);const A={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(c.zoom=A),p.panDelta!==void 0&&(c.drag=A),p.pitchDelta!==void 0&&(c.pitch=A),p.bearingDelta!==void 0&&(c.rotate=A)}_applyChanges(){const e={},c={},p={};for(const[m,b,A]of this._changes)m.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(m.panDelta)),m.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(e.around=m.around),m.pinchAround!==void 0&&(e.pinchAround=m.pinchAround),m.noInertia&&(e.noInertia=m.noInertia),o.e(c,b),o.e(p,A);this._updateMapTransform(e,c,p),this._changes=[]}_updateMapTransform(e,c,p){const m=this._map,b=m._getTransformForUpdate(),A=m.terrain;if(!(cc(e)||A&&this._terrainMovement))return this._fireEvents(c,p,!0);let{panDelta:P,zoomDelta:O,bearingDelta:q,pitchDelta:X,around:K,pinchAround:oe}=e;oe!==void 0&&(K=oe),m._stop(!0),K=K||m.transform.centerPoint;const me=b.pointLocation(P?K.sub(P):K);q&&(b.bearing+=q),X&&(b.pitch+=X),O&&(b.zoom+=O),A?this._terrainMovement||!c.drag&&!c.zoom?c.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(P)):b.setLocationAtPoint(me,K):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(me,K)):b.setLocationAtPoint(me,K),m._applyUpdatedTransform(b),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(c,p,!0)}_fireEvents(e,c,p){const m=is(this._eventsInProgress),b=is(e),A={};for(const K in e){const{originalEvent:oe}=e[K];this._eventsInProgress[K]||(A[`${K}start`]=oe),this._eventsInProgress[K]=e[K]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const K in A)this._fireEvent(K,A[K]);b&&this._fireEvent("move",b.originalEvent);for(const K in e){const{originalEvent:oe}=e[K];this._fireEvent(K,oe)}const P={};let O;for(const K in this._eventsInProgress){const{handlerName:oe,originalEvent:me}=this._eventsInProgress[K];this._handlersById[oe].isActive()||(delete this._eventsInProgress[K],O=c[oe]||me,P[`${K}end`]=O)}for(const K in P)this._fireEvent(K,P[K]);const q=is(this._eventsInProgress),X=(m||b)&&!q;if(X&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const K=this._map._getTransformForUpdate();K.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(K)}if(p&&X){this._updatingCamera=!0;const K=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),oe=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;!K||!K.essential&&y.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:O})),oe(this._map.getBearing())&&this._map.resetNorth()):(oe(K.bearing||this._map.getBearing())&&(K.bearing=0),K.freezeElevation=!0,this._map.easeTo(K,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(e,c){this._map.fire(new o.k(e,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Ut("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class vh extends o.E{constructor(e,c){super(),this._renderFrameCallback=()=>{const p=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,c){return this.jumpTo({center:e},c)}panBy(e,c,p){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},c),p)}panTo(e,c,p){return this.easeTo(o.e({center:e},c),p)}getZoom(){return this.transform.zoom}setZoom(e,c){return this.jumpTo({zoom:e},c),this}zoomTo(e,c,p){return this.easeTo(o.e({zoom:e},c),p)}zoomIn(e,c){return this.zoomTo(this.getZoom()+1,e,c),this}zoomOut(e,c){return this.zoomTo(this.getZoom()-1,e,c),this}getBearing(){return this.transform.bearing}setBearing(e,c){return this.jumpTo({bearing:e},c),this}getPadding(){return this.transform.padding}setPadding(e,c){return this.jumpTo({padding:e},c),this}rotateTo(e,c,p){return this.easeTo(o.e({bearing:e},c),p)}resetNorth(e,c){return this.rotateTo(0,o.e({duration:1e3},e),c),this}resetNorthPitch(e,c){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},e),c),this}snapToNorth(e,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,c):this}getPitch(){return this.transform.pitch}setPitch(e,c){return this.jumpTo({pitch:e},c),this}cameraForBounds(e,c){e=Je.convert(e).adjustAntiMeridian();const p=c&&c.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),p,c)}_cameraForBoxAndBearing(e,c,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=o.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Lt=m.padding;m.padding={top:Lt,bottom:Lt,right:Lt,left:Lt}}m.padding=o.e(b,m.padding);const A=this.transform,P=A.padding,O=new Je(e,c),q=A.project(O.getNorthWest()),X=A.project(O.getNorthEast()),K=A.project(O.getSouthEast()),oe=A.project(O.getSouthWest()),me=o.ba(-p),ye=q.rotate(me),Ce=X.rotate(me),Pe=K.rotate(me),Oe=oe.rotate(me),Ne=new o.P(Math.max(ye.x,Ce.x,Oe.x,Pe.x),Math.max(ye.y,Ce.y,Oe.y,Pe.y)),Te=new o.P(Math.min(ye.x,Ce.x,Oe.x,Pe.x),Math.min(ye.y,Ce.y,Oe.y,Pe.y)),We=Ne.sub(Te),Xe=(A.width-(P.left+P.right+m.padding.left+m.padding.right))/We.x,it=(A.height-(P.top+P.bottom+m.padding.top+m.padding.bottom))/We.y;if(it<0||Xe<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const mt=Math.min(A.scaleZoom(A.scale*Math.min(Xe,it)),m.maxZoom),Tt=o.P.convert(m.offset),Dt=new o.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(o.ba(p)),Nt=Tt.add(Dt).mult(A.scale/A.zoomScale(mt));return{center:A.unproject(q.add(K).div(2).sub(Nt)),zoom:mt,bearing:p}}fitBounds(e,c,p){return this._fitInternal(this.cameraForBounds(e,c),c,p)}fitScreenCoordinates(e,c,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(e)),this.transform.pointLocation(o.P.convert(c)),p,m),m,b)}_fitInternal(e,c,p){return e?(delete(c=o.e(e,c)).padding,c.linear?this.easeTo(c,p):this.flyTo(c,p)):this}jumpTo(e,c){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,A=!1;return"zoom"in e&&p.zoom!==+e.zoom&&(m=!0,p.zoom=+e.zoom),e.center!==void 0&&(p.center=o.N.convert(e.center)),"bearing"in e&&p.bearing!==+e.bearing&&(b=!0,p.bearing=+e.bearing),"pitch"in e&&p.pitch!==+e.pitch&&(A=!0,p.pitch=+e.pitch),e.padding==null||p.isPaddingEqual(e.padding)||(p.padding=e.padding),this._applyUpdatedTransform(p),this.fire(new o.k("movestart",c)).fire(new o.k("move",c)),m&&this.fire(new o.k("zoomstart",c)).fire(new o.k("zoom",c)).fire(new o.k("zoomend",c)),b&&this.fire(new o.k("rotatestart",c)).fire(new o.k("rotate",c)).fire(new o.k("rotateend",c)),A&&this.fire(new o.k("pitchstart",c)).fire(new o.k("pitch",c)).fire(new o.k("pitchend",c)),this.fire(new o.k("moveend",c))}calculateCameraOptionsFromTo(e,c,p,m=0){const b=o.Z.fromLngLat(e,c),A=o.Z.fromLngLat(p,m),P=A.x-b.x,O=A.y-b.y,q=A.z-b.z,X=Math.hypot(P,O,q);if(X===0)throw new Error("Can't calculate camera options with same From and To");const K=Math.hypot(P,O),oe=this.transform.scaleZoom(this.transform.cameraToCenterDistance/X/this.transform.tileSize),me=180*Math.atan2(P,-O)/Math.PI;let ye=180*Math.acos(K/X)/Math.PI;return ye=q<0?90-ye:90+ye,{center:A.toLngLat(),zoom:oe,pitch:ye,bearing:me}}easeTo(e,c){var p;this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.b9},e)).animate===!1||!e.essential&&y.prefersReducedMotion)&&(e.duration=0);const m=this._getTransformForUpdate(),b=m.zoom,A=m.bearing,P=m.pitch,O=m.padding,q="bearing"in e?this._normalizeBearing(e.bearing,A):A,X="pitch"in e?+e.pitch:P,K="padding"in e?e.padding:m.padding,oe=o.P.convert(e.offset);let me=m.centerPoint.add(oe);const ye=m.pointLocation(me),{center:Ce,zoom:Pe}=m.getConstrained(o.N.convert(e.center||ye),(p=e.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(Ce,m);const Oe=m.project(ye),Ne=m.project(Ce).sub(Oe),Te=m.zoomScale(Pe-b);let We,Xe;e.around&&(We=o.N.convert(e.around),Xe=m.locationPoint(We));const it={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Pe!==b,this._rotating=this._rotating||A!==q,this._pitching=this._pitching||X!==P,this._padding=!m.isPaddingEqual(K),this._easeId=e.easeId,this._prepareEase(c,e.noMoveStart,it),this.terrain&&this._prepareElevation(Ce),this._ease(mt=>{if(this._zooming&&(m.zoom=o.y.number(b,Pe,mt)),this._rotating&&(m.bearing=o.y.number(A,q,mt)),this._pitching&&(m.pitch=o.y.number(P,X,mt)),this._padding&&(m.interpolatePadding(O,K,mt),me=m.centerPoint.add(oe)),this.terrain&&!e.freezeElevation&&this._updateElevation(mt),We)m.setLocationAtPoint(We,Xe);else{const Tt=m.zoomScale(m.zoom-b),Dt=Pe>b?Math.min(2,Te):Math.max(.5,Te),Nt=Math.pow(Dt,1-mt),Lt=m.unproject(Oe.add(Ne.mult(mt*Nt)).mult(Tt));m.setLocationAtPoint(m.renderWorldCopies?Lt.wrap():Lt,me)}this._applyUpdatedTransform(m),this._fireMoveEvents(c)},mt=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(c,mt)},e),this}_prepareEase(e,c,p={}){this._moving=!0,c||p.moving||this.fire(new o.k("movestart",e)),this._zooming&&!p.zooming&&this.fire(new o.k("zoomstart",e)),this._rotating&&!p.rotating&&this.fire(new o.k("rotatestart",e)),this._pitching&&!p.pitching&&this.fire(new o.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const c=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&c!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(p-(c-(p*e+this._elevationStart))/(1-e)),this._elevationTarget=c}this.transform.elevation=o.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const c=e.getCameraPosition(),p=this.terrain.getElevationForLngLatZoom(c.lngLat,e.zoom);if(c.altitude<p){const m=this.calculateCameraOptionsFromTo(c.lngLat,p,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const c=[];if(this.terrain&&c.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&c.push(m=>this.transformCameraUpdate(m)),!c.length)return;const p=e.clone();for(const m of c){const b=p.clone(),{center:A,zoom:P,pitch:O,bearing:q,elevation:X}=m(b);A&&(b.center=A),P!==void 0&&(b.zoom=P),O!==void 0&&(b.pitch=O),q!==void 0&&(b.bearing=q),X!==void 0&&(b.elevation=X),p.apply(b)}this.transform.apply(p)}_fireMoveEvents(e){this.fire(new o.k("move",e)),this._zooming&&this.fire(new o.k("zoom",e)),this._rotating&&this.fire(new o.k("rotate",e)),this._pitching&&this.fire(new o.k("pitch",e))}_afterEase(e,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.k("zoomend",e)),m&&this.fire(new o.k("rotateend",e)),b&&this.fire(new o.k("pitchend",e)),this.fire(new o.k("moveend",e))}flyTo(e,c){var p;if(!e.essential&&y.prefersReducedMotion){const Rt=o.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rt,c)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b9},e);const m=this._getTransformForUpdate(),b=m.zoom,A=m.bearing,P=m.pitch,O=m.padding,q="bearing"in e?this._normalizeBearing(e.bearing,A):A,X="pitch"in e?+e.pitch:P,K="padding"in e?e.padding:m.padding,oe=o.P.convert(e.offset);let me=m.centerPoint.add(oe);const ye=m.pointLocation(me),{center:Ce,zoom:Pe}=m.getConstrained(o.N.convert(e.center||ye),(p=e.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(Ce,m);const Oe=m.zoomScale(Pe-b),Ne=m.project(ye),Te=m.project(Ce).sub(Ne);let We=e.curve;const Xe=Math.max(m.width,m.height),it=Xe/Oe,mt=Te.mag();if("minZoom"in e){const Rt=o.ac(Math.min(e.minZoom,b,Pe),m.minZoom,m.maxZoom),_i=Xe/m.zoomScale(Rt-b);We=Math.sqrt(_i/mt*2)}const Tt=We*We;function Dt(Rt){const _i=(it*it-Xe*Xe+(Rt?-1:1)*Tt*Tt*mt*mt)/(2*(Rt?it:Xe)*Tt*mt);return Math.log(Math.sqrt(_i*_i+1)-_i)}function Nt(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function Lt(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const Mt=Dt(!1);let Ht=function(Rt){return Lt(Mt)/Lt(Mt+We*Rt)},vi=function(Rt){return Xe*((Lt(Mt)*(Nt(_i=Mt+We*Rt)/Lt(_i))-Nt(Mt))/Tt)/mt;var _i},zt=(Dt(!0)-Mt)/We;if(Math.abs(mt)<1e-6||!isFinite(zt)){if(Math.abs(Xe-it)<1e-6)return this.easeTo(e,c);const Rt=it<Xe?-1:1;zt=Math.abs(Math.log(it/Xe))/We,vi=()=>0,Ht=_i=>Math.exp(Rt*We*_i)}return e.duration="duration"in e?+e.duration:1e3*zt/("screenSpeed"in e?+e.screenSpeed/We:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=A!==q,this._pitching=X!==P,this._padding=!m.isPaddingEqual(K),this._prepareEase(c,!1),this.terrain&&this._prepareElevation(Ce),this._ease(Rt=>{const _i=Rt*zt,gn=1/Ht(_i);m.zoom=Rt===1?Pe:b+m.scaleZoom(gn),this._rotating&&(m.bearing=o.y.number(A,q,Rt)),this._pitching&&(m.pitch=o.y.number(P,X,Rt)),this._padding&&(m.interpolatePadding(O,K,Rt),me=m.centerPoint.add(oe)),this.terrain&&!e.freezeElevation&&this._updateElevation(Rt);const Ii=Rt===1?Ce:m.unproject(Ne.add(Te.mult(vi(_i))).mult(gn));m.setLocationAtPoint(m.renderWorldCopies?Ii.wrap():Ii,me),this._applyUpdatedTransform(m),this._fireMoveEvents(c)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(c)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,c){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,c)}return e||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(e,c,p){p.animate===!1||p.duration===0?(e(1),c()):(this._easeStart=y.now(),this._easeOptions=p,this._onEaseFrame=e,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,c){e=o.b3(e,-180,180);const p=Math.abs(e-c);return Math.abs(e-360-c)<p&&(e-=360),Math.abs(e+360-c)<p&&(e+=360),e}_normalizeCenter(e,c){if(!c.renderWorldCopies||c.lngRange)return;const p=e.lng-c.center.lng;e.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Da={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Fa{constructor(e=Da){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=c=>{!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"&&c.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,c){const p=this._map._getUIString(`AttributionControl.${c}`);e.title=p,e.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const c=this._map.style.sourceCaches;for(const m in c){const b=c[m];if(b.used||b.usedForTerrain){const A=b.getSource();A.attribution&&e.indexOf(A.attribution)<0&&e.push(A.attribution)}}e=e.filter(m=>String(m).trim()),e.sort((m,b)=>m.length-b.length),e=e.filter((m,b)=>{for(let A=b+1;A<e.length;A++)if(e[A].indexOf(m)>=0)return!1;return!0});const p=e.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,e.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yu{constructor(e={}){this._updateCompact=()=>{const c=this._container.children;if(c.length){const p=c[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl");const c=k.create("a","maplibregl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ji{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const c=++this._id;return this._queue.push({callback:e,id:c,cancelled:!1}),c}remove(e){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const m of p)if(m.id===e)return void(m.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var bu=o.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ef extends o.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,c){this.sourceCache.update(e,c),this._renderableTilesKeys=[];const p={};for(const m of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:c}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),o.aP(m.posMatrix,0,o.X,0,o.X,0,1),this._tiles[m.key]=new Cn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(e){for(const c in this._tiles){const p=this._tiles[c];(!e||p.tileID.equals(e)||p.tileID.isChildOf(e)||e.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const c={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(e.canonical)){const b=e.clone();b.posMatrix=new Float64Array(16),o.aP(b.posMatrix,0,o.X,0,o.X,0,1),c[p]=b}else if(m.canonical.isChildOf(e.canonical)){const b=e.clone();b.posMatrix=new Float64Array(16);const A=m.canonical.z-e.canonical.z,P=m.canonical.x-(m.canonical.x>>A<<A),O=m.canonical.y-(m.canonical.y>>A<<A),q=o.X>>A;o.aP(b.posMatrix,0,q,0,q,0,1),o.J(b.posMatrix,b.posMatrix,[-P*q,-O*q,0]),c[p]=b}else if(e.canonical.isChildOf(m.canonical)){const b=e.clone();b.posMatrix=new Float64Array(16);const A=e.canonical.z-m.canonical.z,P=e.canonical.x-(e.canonical.x>>A<<A),O=e.canonical.y-(e.canonical.y>>A<<A),q=o.X>>A;o.aP(b.posMatrix,0,o.X,0,o.X,0,1),o.J(b.posMatrix,b.posMatrix,[P*q,O*q,0]),o.K(b.posMatrix,b.posMatrix,[1/2**A,1/2**A,0]),c[p]=b}}return c}getSourceTile(e,c){const p=this.sourceCache._source;let m=e.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!b||!b.dem)&&c)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(e.scaledTo(m--).key);return b}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(c=>c.timeAdded>=e)}}class vu{constructor(e,c,p){this.painter=e,this.sourceCache=new Ef(c),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,c,p,m=o.X){var b;if(!(c>=0&&c<m&&p>=0&&p<m))return 0;const A=this.getTerrainData(e),P=(b=A.tile)===null||b===void 0?void 0:b.dem;if(!P)return 0;const O=function(ye,Ce,Pe){var Oe=Ce[0],Ne=Ce[1];return ye[0]=Pe[0]*Oe+Pe[4]*Ne+Pe[12],ye[1]=Pe[1]*Oe+Pe[5]*Ne+Pe[13],ye}([],[c/m*o.X,p/m*o.X],A.u_terrain_matrix),q=[O[0]*P.dim,O[1]*P.dim],X=Math.floor(q[0]),K=Math.floor(q[1]),oe=q[0]-X,me=q[1]-K;return P.get(X,K)*(1-oe)*(1-me)+P.get(X+1,K)*oe*(1-me)+P.get(X,K+1)*(1-oe)*me+P.get(X+1,K+1)*oe*me}getElevationForLngLatZoom(e,c){if(!o.bb(c,e.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(e,c);return this.getElevation(p,m%o.X,b%o.X,o.X)}getElevation(e,c,p,m=o.X){return this.getDEMElevation(e,c,p,m)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const m=this.painter.context,b=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new B(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new B(m,new o.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const c=this.sourceCache.getSourceTile(e,!0);if(c&&c.dem&&(!c.demTexture||c.needsTerrainPrepare)){const m=this.painter.context;c.demTexture=this.painter.getTileTexture(c.dem.stride),c.demTexture?c.demTexture.update(c.dem.getPixels(),{premultiply:!1}):c.demTexture=new B(m,c.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),c.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),c.needsTerrainPrepare=!1}const p=c&&c+c.tileID.key+e.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=e.canonical.z-c.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=m?b=e.canonical.z-m:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=e.canonical.x-(e.canonical.x>>b<<b),P=e.canonical.y-(e.canonical.y>>b<<b),O=o.bc(new Float64Array(16),[1/(o.X<<b),1/(o.X<<b),0]);o.J(O,O,[A*o.X,P*o.X,0]),this._demMatrixCache[e.key]={matrix:O,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:c&&c.dem&&c.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:c&&c.dem&&c.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(c&&c.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:c}}getFramebuffer(e){const c=this.painter,p=c.width/devicePixelRatio,m=c.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new B(c.context,{width:p,height:m,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new B(c.context,{width:p,height:m,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=c.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(c.context.createRenderbuffer(c.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const c=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,A=0;b<this._coordsTextureSize;b++)for(let P=0;P<this._coordsTextureSize;P++,A+=4)c[A+0]=255&P,c[A+1]=255&b,c[A+2]=P>>8<<4|b>>8,c[A+3]=0;const p=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(c.buffer)),m=new B(e,p,e.gl.RGBA,{premultiply:!1});return m.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const c=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),A=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,P-A-1,1,1,m.RGBA,m.UNSIGNED_BYTE,c),p.bindFramebuffer.set(null);const O=c[0]+(c[2]>>4<<8),q=c[1]+((15&c[2])<<8),X=this.coordsIndex[255-c[3]],K=X&&this.sourceCache.getTileByID(X);if(!K)return null;const oe=this._coordsTextureSize,me=(1<<K.tileID.canonical.z)*oe;return new o.Z((K.tileID.canonical.x*oe+O)/me+K.tileID.wrap,(K.tileID.canonical.y*oe+q)/me,this.getElevation(K.tileID,O,q,oe))}depthAtPoint(e){const c=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,c),p.bindFramebuffer.set(null),(c[0]/16777216+c[1]/65536+c[2]/256+c[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,c=new o.bd,p=new o.aY,m=this.meshSize,b=o.X/m,A=m*m;for(let K=0;K<=m;K++)for(let oe=0;oe<=m;oe++)c.emplaceBack(oe*b,K*b,0);for(let K=0;K<A;K+=m+1)for(let oe=0;oe<m;oe++)p.emplaceBack(oe+K,m+oe+K+1,m+oe+K+2),p.emplaceBack(oe+K,m+oe+K+2,oe+K+1);const P=c.length,O=P+2*(m+1);for(const K of[0,1])for(let oe=0;oe<=m;oe++)for(const me of[0,1])c.emplaceBack(oe*b,K*o.X,me);for(let K=0;K<2*m;K+=2)p.emplaceBack(O+K,O+K+1,O+K+3),p.emplaceBack(O+K,O+K+3,O+K+2),p.emplaceBack(P+K,P+K+3,P+K+1),p.emplaceBack(P+K,P+K+2,P+K+3);const q=c.length,X=q+2*(m+1);for(const K of[0,1])for(let oe=0;oe<=m;oe++)for(const me of[0,1])c.emplaceBack(K*o.X,oe*b,me);for(let K=0;K<2*m;K+=2)p.emplaceBack(q+K,q+K+1,q+K+3),p.emplaceBack(q+K,q+K+3,q+K+2),p.emplaceBack(X+K,X+K+3,X+K+1),p.emplaceBack(X+K,X+K+2,X+K+3);return this._mesh=new So(e.createVertexBuffer(c,bu.members),e.createIndexBuffer(p),o.a0.simpleSegment(0,0,c.length,p.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*o.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,c){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(e,c);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(e){const c=this.getTerrainData(e).tile,p={minElevation:null,maxElevation:null};return c&&c.dem&&(p.minElevation=c.dem.min*this.exaggeration,p.maxElevation=c.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(e,c){const p=o.Z.fromLngLat(e.wrap()),m=(1<<c)*o.X,b=p.x*m,A=p.y*m,P=Math.floor(b/o.X),O=Math.floor(A/o.X);return{tileID:new o.S(c,0,c,P,O),mercatorX:b,mercatorY:A}}}class If{constructor(e,c,p){this._context=e,this._size=c,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const c=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new B(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),c.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),c.colorAttachment.set(p.texture),{id:e,fbo:c,texture:p,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(c=>e.id!==c),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const c of this._recentlyUsed)if(!this._objects[c].inUse)return this._objects[c];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Ra={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class wh{constructor(e,c){this.painter=e,this.terrain=c,this.pool=new If(e.context,30,c.sourceCache.tileSize*c.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,c){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(p=>!e._layers[p].isHidden(c)),this._coordsDescendingInv={};for(const p in e.sourceCaches){this._coordsDescendingInv[p]={};const m=e.sourceCaches[p].getVisibleCoordinates();for(const b of m){const A=this.terrain.sourceCache.getTerrainCoords(b);for(const P in A)this._coordsDescendingInv[p][P]||(this._coordsDescendingInv[p][P]=[]),this._coordsDescendingInv[p][P].push(A[P])}}this._coordsDescendingInvStr={};for(const p of e._order){const m=e._layers[p],b=m.source;if(Ra[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const A in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][A]=this._coordsDescendingInv[b][A].map(P=>P.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const c=e.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ra[c]&&(this._prevType&&Ra[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!m))return!0;if(Ra[this._prevType]||Ra[c]&&m){this._prevType=c;const b=this._stacks.length-1,A=this._stacks[b]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(ml(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[b]){const q=this.pool.getObjectForId(P.rtt[b].id);if(q.stamp===P.rtt[b].stamp){this.pool.useObject(q);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),P.rtt[b]={id:O.id,stamp:O.stamp},p.context.bindFramebuffer.set(O.fbo.framebuffer),p.context.clear({color:o.aM.transparent,stencil:0}),p.currentStencilSource=void 0;for(let q=0;q<A.length;q++){const X=p.style._layers[A[q]],K=X.source?this._coordsDescendingInv[X.source][P.tileID.key]:[P.tileID];p.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),p._renderTileClippingMasks(X,K),p.renderLayer(p,p.style.sourceCaches[X.source],X,K),X.source&&(P.rttCoords[X.source]=this._coordsDescendingInvStr[X.source][P.tileID.key])}}return ml(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ra[c]}return!1}}const wu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},xh=_,Af={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Da,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},xu=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},Mf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pf{constructor(e,c,p=!1){this.mousedown=A=>{this.startMouse(o.e({},A,{ctrlKey:!0,preventDefault:()=>A.preventDefault()}),k.mousePos(this.element,A)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.moveMouse(A,k.mousePos(this.element,A))},this.mouseup=A=>{this.mouseRotate.dragEnd(A),this.mousePitch&&this.mousePitch.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,A.targetTouches)[0],this.startTouch(A,this._startPos),k.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,A.targetTouches)[0],this.moveTouch(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=e.dragRotate._mouseRotate.getClickTolerance(),b=e.dragRotate._mousePitch.getClickTolerance();this.element=c,this.mouseRotate=gr({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:A,clickTolerance:P,bearingDegreesPerPixelMoved:O=.8})=>{const q=new Nr;return new In({clickTolerance:P,move:(X,K)=>({bearingDelta:(K.x-X.x)*O}),moveStateManager:q,enable:A,assignEvents:xu})})({clickTolerance:m,enable:!0}),this.map=e,p&&(this.mousePitch=so({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:A,clickTolerance:P,pitchDegreesPerPixelMoved:O=-.5})=>{const q=new Nr;return new In({clickTolerance:P,move:(X,K)=>({pitchDelta:(K.y-X.y)*O}),moveStateManager:q,enable:A,assignEvents:xu})})({clickTolerance:b,enable:!0})),k.addEventListener(c,"mousedown",this.mousedown),k.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(c,"touchcancel",this.reset)}startMouse(e,c){this.mouseRotate.dragStart(e,c),this.mousePitch&&this.mousePitch.dragStart(e,c),k.disableDrag()}startTouch(e,c){this.touchRotate.dragStart(e,c),this.touchPitch&&this.touchPitch.dragStart(e,c),k.disableDrag()}moveMouse(e,c){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(e,c)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(e,c)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(e,c){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(e,c)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(e,c)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const e=this.element;k.removeEventListener(e,"mousedown",this.mousedown),k.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend),k.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend)}}let Ur;function mn(v,e,c){const p=new o.N(v.lng,v.lat);if(v=new o.N(v.lng,v.lat),e){const m=new o.N(v.lng-360,v.lat),b=new o.N(v.lng+360,v.lat),A=c.locationPoint(v).distSqr(e);c.locationPoint(m).distSqr(e)<A?v=m:c.locationPoint(b).distSqr(e)<A&&(v=b)}for(;Math.abs(v.lng-c.center.lng)>180;){const m=c.locationPoint(v);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;v.lng>c.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&c.locationPoint(v).y>c.height/2-c.getHorizon()?v:p}const Ba={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function uc(v,e,c){const p=v.classList;for(const m in Ba)p.remove(`maplibregl-${c}-anchor-${m}`);p.add(`maplibregl-${c}-anchor-${e}`)}class hc extends o.E{constructor(e){if(super(),this._onKeyPress=c=>{const p=c.code,m=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=c=>{const p=c.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=c=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((c==null?void 0:c.type)==="terrain"||(c==null?void 0:c.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?mn(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||c&&c.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${Ba[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${b}`),y.frameAsync(new AbortController).then(()=>{this._updateOpacity(c&&c.type==="moveend")}).catch(()=>{})},this._onMove=c=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=c=>{this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div");const c=k.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${p}px`),c.setAttributeNS(null,"width",`${m}px`),c.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=k.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const A=k.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const P=k.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Oe of O){const Ne=k.createNS("http://www.w3.org/2000/svg","ellipse");Ne.setAttributeNS(null,"opacity","0.04"),Ne.setAttributeNS(null,"cx","10.5"),Ne.setAttributeNS(null,"cy","5.80029008"),Ne.setAttributeNS(null,"rx",Oe.rx),Ne.setAttributeNS(null,"ry",Oe.ry),P.appendChild(Ne)}const q=k.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);const X=k.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(X);const K=k.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"fill","#000000");const oe=k.createNS("http://www.w3.org/2000/svg","path");oe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),K.appendChild(oe);const me=k.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");const ye=k.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ce=k.createNS("http://www.w3.org/2000/svg","circle");Ce.setAttributeNS(null,"fill","#000000"),Ce.setAttributeNS(null,"opacity","0.25"),Ce.setAttributeNS(null,"cx","5.5"),Ce.setAttributeNS(null,"cy","5.5"),Ce.setAttributeNS(null,"r","5.4999962");const Pe=k.createNS("http://www.w3.org/2000/svg","circle");Pe.setAttributeNS(null,"fill","#FFFFFF"),Pe.setAttributeNS(null,"cx","5.5"),Pe.setAttributeNS(null,"cy","5.5"),Pe.setAttributeNS(null,"r","5.4999962"),ye.appendChild(Ce),ye.appendChild(Pe),A.appendChild(P),A.appendChild(q),A.appendChild(K),A.appendChild(me),A.appendChild(ye),c.appendChild(A),c.setAttributeNS(null,"height",p*this._scale+"px"),c.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(c),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),uc(this._element,this._anchor,"marker"),e&&e.className)for(const c of e.className.split(" "))this._element.classList.add(c);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const m=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var c,p;if(!(!((c=this._map)===null||c===void 0)&&c.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),A=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,A)-b<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/m.transform._pixelPerMeter,O=Math.sin(m.getPitch()*Math.PI/180)*P,q=m.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),X=m.transform.lngLatToCameraDepth(this._lngLat,A+O)-q>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&X&&this._popup.remove(),this._element.style.opacity=X?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,c){return e===void 0&&c===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),c!==void 0&&(this._opacityWhenCovered=c),this._map&&this._updateOpacity(!0),this}}const Sh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let wl=0,xl=!1;const Ds={maxWidth:100,unit:"metric"};function Sl(v,e,c){const p=c&&c.maxWidth||100,m=v._container.clientHeight/2,b=v.unproject([0,m]),A=v.unproject([p,m]),P=b.distanceTo(A);if(c&&c.unit==="imperial"){const O=3.2808*P;O>5280?Gt(e,p,O/5280,v._getUIString("ScaleControl.Miles")):Gt(e,p,O,v._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Gt(e,p,P/1852,v._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Gt(e,p,P/1e3,v._getUIString("ScaleControl.Kilometers")):Gt(e,p,P,v._getUIString("ScaleControl.Meters"))}function Gt(v,e,c,p){const m=function(b){const A=Math.pow(10,`${Math.floor(b)}`.length-1);let P=b/A;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(O){const q=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*q)/q}(P),A*P}(c);v.style.width=e*(m/c)+"px",v.innerHTML=`${m}&nbsp;${p}`}const ui={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},fc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dc(v){if(v){if(typeof v=="number"){const e=Math.round(Math.abs(v)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,v),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-v),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(v,0),right:new o.P(-v,0)}}if(v instanceof o.P||Array.isArray(v)){const e=o.P.convert(v);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(v.center||[0,0]),top:o.P.convert(v.top||[0,0]),"top-left":o.P.convert(v["top-left"]||[0,0]),"top-right":o.P.convert(v["top-right"]||[0,0]),bottom:o.P.convert(v.bottom||[0,0]),"bottom-left":o.P.convert(v["bottom-left"]||[0,0]),"bottom-right":o.P.convert(v["bottom-right"]||[0,0]),left:o.P.convert(v.left||[0,0]),right:o.P.convert(v.right||[0,0])}}return dc(new o.P(0,0))}const Su=_;f.AJAXError=o.bh,f.Evented=o.E,f.LngLat=o.N,f.MercatorCoordinate=o.Z,f.Point=o.P,f.addProtocol=o.bi,f.config=o.a,f.removeProtocol=o.bj,f.AttributionControl=Fa,f.BoxZoomHandler=Et,f.CanvasSource=ut,f.CooperativeGesturesHandler=Oa,f.DoubleClickZoomHandler=ra,f.DragPanHandler=yh,f.DragRotateHandler=bh,f.EdgeInsets=To,f.FullscreenControl=class extends o.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var e;let c=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=c==null?void 0:c.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)c=c.shadowRoot.fullscreenElement;c===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=H,f.GeolocateControl=class extends o.E{constructor(v){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const c=new o.N(e.coords.longitude,e.coords.latitude),p=e.coords.accuracy,m=this._map.getBearing(),b=o.e({bearing:m},this.options.fitBoundsOptions),A=Je.fromLngLat(c,p);this._map.fitBounds(A,b,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const c=new o.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&xl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new hc({element:this._dotElement}),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},Sh,v)}onAdd(v){return this._map=v,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(e=!1){if(Ur!==void 0&&!e)return Ur;if(window.navigator.permissions===void 0)return Ur=!!window.navigator.geolocation,Ur;try{Ur=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ur=!!window.navigator.geolocation}return Ur})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,wl=0,xl=!1}_isOutOfMapMaxBounds(v){const e=this._map.getMaxBounds(),c=v.coords;return e&&(c.longitude<e.getWest()||c.longitude>e.getEast()||c.latitude<e.getSouth()||c.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),e=v.getSouthEast(),c=v.getNorthEast(),p=e.distanceTo(c),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wl--,xl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),wl++,wl>1?(v={maximumAge:6e5,timeout:0},xl=!0):(v=this.options.positionOptions,xl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.Hash=Pa,f.ImageSource=Ee,f.KeyboardHandler=ts,f.LngLatBounds=Je,f.LogoControl=yu,f.Map=class extends vh{constructor(v){o.bf.mark(o.bg.create);const e=Object.assign(Object.assign({},Af),v);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ko(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ji,this._controls=[],this._mapId=o.a4(),this._contextLost=c=>{c.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:c}))},this._contextRestored=c=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:c}))},this._onMapScroll=c=>{if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},wu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Z.addThrottleControl(()=>this.isMoving()),this._requestManager=new ie(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let c=!1;const p=ta(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{c?p(m):c=!0}),this._resizeObserver.observe(this._container)}this.handlers=new _u(this,e),this._hash=e.hash&&new Pa(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,o.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Fa(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new yu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.k(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.k(`${c.dataType}dataloading`,c))}),this.on("dataabort",c=>{this.fire(new o.k("sourcedataabort",c))})}_getMapId(){return this._mapId}addControl(v,e){if(e===void 0&&(e=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[e];return e.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(v);return e>-1&&this._controls.splice(e,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,e,c,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,e,c,p)}resize(v){var e;const c=this._containerDimensions(),p=c[0],m=c[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const O=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,O),this.painter.resize(p,m,O)}this.transform.resize(p,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(p,m);const A=!this._moving;return A&&(this.stop(),this.fire(new o.k("movestart",v)).fire(new o.k("move",v))),this.fire(new o.k("resize",v)),A&&this.fire(new o.k("moveend",v)),this}_getClampedPixelRatio(v,e){const{0:c,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=v*m,A=e*m;return Math.min(b>c?c/b:1,A>p?p/A:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Je.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(o.N.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(o.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,e,c){if(v==="mouseenter"||v==="mouseover"){let p=!1;return{layers:e,listener:c,delegates:{mousemove:b=>{const A=e.filter(O=>this.getLayer(O)),P=A.length!==0?this.queryRenderedFeatures(b.point,{layers:A}):[];P.length?p||(p=!0,c.call(this,new Mn(v,this,b.originalEvent,{features:P}))):p=!1},mouseout:()=>{p=!1}}}}if(v==="mouseleave"||v==="mouseout"){let p=!1;return{layers:e,listener:c,delegates:{mousemove:A=>{const P=e.filter(O=>this.getLayer(O));(P.length!==0?this.queryRenderedFeatures(A.point,{layers:P}):[]).length?p=!0:p&&(p=!1,c.call(this,new Mn(v,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,c.call(this,new Mn(v,this,A.originalEvent)))}}}}{const p=m=>{const b=e.filter(P=>this.getLayer(P)),A=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];A.length&&(m.features=A,c.call(this,m),delete m.features)};return{layers:e,listener:c,delegates:{[v]:p}}}}_saveDelegatedListener(v,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(e)}_removeDelegatedListener(v,e,c){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const p=this._delegatedListeners[v];for(let m=0;m<p.length;m++){const b=p[m];if(b.listener===c&&b.layers.length===e.length&&b.layers.every(A=>e.includes(A))){for(const A in b.delegates)this.off(A,b.delegates[A]);return void p.splice(m,1)}}}on(v,e,c){if(c===void 0)return super.on(v,e);const p=this._createDelegatedListener(v,typeof e=="string"?[e]:e,c);this._saveDelegatedListener(v,p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(v,e,c){if(c===void 0)return super.once(v,e);const p=typeof e=="string"?[e]:e,m=this._createDelegatedListener(v,p,c);for(const b in m.delegates){const A=m.delegates[b];m.delegates[b]=(...P)=>{this._removeDelegatedListener(v,p,c),A(...P)}}this._saveDelegatedListener(v,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(v,e,c){return c===void 0?super.off(v,e):(this._removeDelegatedListener(v,typeof e=="string"?[e]:e,c),this)}queryRenderedFeatures(v,e){if(!this.style)return[];let c;const p=v instanceof o.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(p?{}:v)||{},m instanceof o.P||typeof m[0]=="number")c=[o.P.convert(m)];else{const b=o.P.convert(m[0]),A=o.P.convert(m[1]);c=[b,new o.P(A.x,b.y),A,new o.P(b.x,A.y),b]}return this.style.queryRenderedFeatures(c,e,this.transform)}querySourceFeatures(v,e){return this.style.querySourceFeatures(v,e)}setStyle(v,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(v,e))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const e=this._locale[v];if(e==null)throw new Error(`Missing UI string '${v}'`);return e}_updateStyle(v,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,e));const c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new _a(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,e,c):this.style.loadJSON(v,e,c),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new _a(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,e){if(typeof v=="string"){const c=this._requestManager.transformRequest(v,"Style");o.h(c,new AbortController).then(p=>{this._updateDiff(p.data,e)}).catch(p=>{p&&this.fire(new o.j(p))})}else typeof v=="object"&&this._updateDiff(v,e)}_updateDiff(v,e){try{this.style.setState(v,e)&&this._update(!0)}catch(c){o.w(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(v,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(v,e){return this._lazyInitEmptyStyle(),this.style.addSource(v,e),this._update(!0)}isSourceLoaded(v){const e=this.style&&this.style.sourceCaches[v];if(e!==void 0)return e.loaded();this.fire(new o.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const e=this.style.sourceCaches[v.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&e.reload();for(const c in this.style._layers){const p=this.style._layers[c];p.type==="hillshade"&&p.source===v.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new vu(this.painter,e,v),this.painter.renderToTexture=new wh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=c=>{c.dataType==="style"?this.terrain.sourceCache.freeRtt():c.dataType==="source"&&c.tile&&(c.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(c.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:v})),this}getTerrain(){var v,e;return(e=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const e in v){const c=v[e]._tiles;for(const p in c){const m=c[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,e,c={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:A,content:P,textFitWidth:O,textFitHeight:q}=c;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:X,height:K,data:oe}=e,me=e;return this.style.addImage(v,{data:new o.R({width:X,height:K},new Uint8Array(oe)),pixelRatio:p,stretchX:b,stretchY:A,content:P,textFitWidth:O,textFitHeight:q,sdf:m,version:0,userImage:me}),me.onAdd&&me.onAdd(this,v),this}}{const{width:X,height:K,data:oe}=y.getImageData(e);this.style.addImage(v,{data:new o.R({width:X,height:K},oe),pixelRatio:p,stretchX:b,stretchY:A,content:P,textFitWidth:O,textFitHeight:q,sdf:m,version:0})}}updateImage(v,e){const c=this.style.getImage(v);if(!c)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=e instanceof HTMLImageElement||o.b(e)?y.getImageData(e):e,{width:m,height:b,data:A}=p;if(m===void 0||b===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==c.data.width||b!==c.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(e instanceof HTMLImageElement||o.b(e));return c.data.replace(A,P),this.style.updateImage(v,c),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return Z.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,e){return this._lazyInitEmptyStyle(),this.style.addLayer(v,e),this._update(!0)}moveLayer(v,e){return this.style.moveLayer(v,e),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,e,c){return this.style.setLayerZoomRange(v,e,c),this._update(!0)}setFilter(v,e,c={}){return this.style.setFilter(v,e,c),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,e,c,p={}){return this.style.setPaintProperty(v,e,c,p),this._update(!0)}getPaintProperty(v,e){return this.style.getPaintProperty(v,e)}setLayoutProperty(v,e,c,p={}){return this.style.setLayoutProperty(v,e,c,p),this._update(!0)}getLayoutProperty(v,e){return this.style.getLayoutProperty(v,e)}setGlyphs(v,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,e,c={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,e,c,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,e,c=>{c||this._update(!0)}),this}setLight(v,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(v){return this._lazyInitEmptyStyle(),this.style.setSky(v),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,e){return this.style.setFeatureState(v,e),this._update()}removeFeatureState(v,e){return this.style.removeFeatureState(v,e),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,e=0;return this._container&&(v=this._container.clientWidth||400,e=this._container.clientHeight||300),[v,e]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const e=this._canvasContainer=k.create("div","maplibregl-canvas-container",v);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const c=this._containerDimensions(),p=this._getClampedPixelRatio(c[0],c[1]);this._resizeCanvas(c[0],c[1],p);const m=this._controlContainer=k.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{b[A]=k.create("div",`maplibregl-ctrl-${A} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,e,c){this._canvas.width=Math.floor(c*v),this._canvas.height=Math.floor(c*e),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{e={requestedAttributes:v},p&&(e.statusMessage=p.statusMessage,e.type=p.type)},{once:!0});const c=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!c){const p="Failed to initialize WebGL";throw e?(e.message=p,new Error(JSON.stringify(e))):new Error(p)}this.painter=new Ma(c,this.transform),I.testSupport(c)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let c=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=y.now();this.style.zoomHistory.update(m,b);const A=new o.z(m,{now:b,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=A.crossFadingFactor();P===1&&P===this._crossFadingFactor||(c=!0,this._crossFadingFactor=P),this.style.update(A)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bf.mark(o.bg.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||c)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,o.bf.mark(o.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Z.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bf.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(v=>{o.bf.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return xh}getCameraTargetElevation(){return this.transform.elevation}},f.MapMouseEvent=Mn,f.MapTouchEvent=Be,f.MapWheelEvent=D,f.Marker=hc,f.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const e=this._map.getZoom(),c=e===this._map.getMaxZoom(),p=e===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,c)=>{const p=this._map._getUIString(`NavigationControl.${c}`);e.title=p,e.setAttribute("aria-label",p)},this.options=o.e({},Mf,v),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),k.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),k.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,e){const c=k.create("button",v,this._container);return c.type="button",c.addEventListener("click",e),c}},f.Popup=class extends o.E{constructor(v){super(),this.remove=()=>(this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var c;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=k.create("div","maplibregl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?mn(this._lngLat,this._flatPos,this._map.transform):(c=this._lngLat)===null||c===void 0?void 0:c.wrap(),this._trackPointer&&!e)return;const p=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=dc(this.options.offset);if(!m){const P=this._container.offsetWidth,O=this._container.offsetHeight;let q;q=p.y+b.bottom.y<O?["top"]:p.y>this._map.transform.height-O?["bottom"]:[],p.x<P/2?q.push("left"):p.x>this._map.transform.width-P/2&&q.push("right"),m=q.length===0?"bottom":q.join("-")}let A=p.add(b[m]);this.options.subpixelPositioning||(A=A.round()),k.setTransform(this._container,`${Ba[m]} translate(${A.x}px,${A.y}px)`),uc(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(ui),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=o.N.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const e=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=v;p=c.firstChild,p;)e.appendChild(p);return this.setDOMContent(e)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(fc);v&&v.focus()}},f.RasterDEMTileSource=he,f.RasterTileSource=et,f.ScaleControl=class{constructor(v){this._onMove=()=>{Sl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Sl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ds),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=ps,f.Style=_a,f.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=vl,f.TwoFingersTouchRotateHandler=pu,f.TwoFingersTouchZoomHandler=fu,f.TwoFingersTouchZoomRotateHandler=gu,f.VectorTileSource=dt,f.VideoSource=qe,f.addSourceType=(v,e)=>o._(void 0,void 0,void 0,function*(){if(ki(v))throw new Error(`A source type called "${v}" already exists.`);((c,p)=>{st[c]=p})(v,e)}),f.clearPrewarmedResources=function(){const v=Zt;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(tt),Zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Fi().getRTLTextPluginStatus()},f.getVersion=function(){return Su},f.getWorkerCount=function(){return vt.workerCount},f.getWorkerUrl=function(){return o.a.WORKER_URL},f.importScriptInWorkers=function(v){return Ti().broadcast("IS",v)},f.prewarm=function(){Ai().acquire(tt)},f.setMaxParallelImageRequests=function(v){o.a.MAX_PARALLEL_IMAGE_REQUESTS=v},f.setRTLTextPlugin=function(v,e){return Fi().setRTLTextPlugin(v,e)},f.setWorkerCount=function(v){vt.workerCount=v},f.setWorkerUrl=function(v){o.a.WORKER_URL=v}});var d=n;return d})})(C0);var Aw=C0.exports;const Ws=d1(Aw);var Mw=Object.defineProperty,Pw=(s,i,n)=>i in s?Mw(s,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[i]=n,pi=(s,i,n)=>Pw(s,typeof i!="symbol"?i+"":i,n);function ah(){}function I0(s){return s()}function wg(){return Object.create(null)}function vf(s){s.forEach(I0)}function A0(s){return typeof s=="function"}function Lw(s,i){return s!=s?i==i:s!==i||s&&typeof s=="object"||typeof s=="function"}function zw(s){return Object.keys(s).length===0}function Ow(s,i){s.appendChild(i)}function Dw(s,i,n){s.insertBefore(i,n||null)}function M0(s){s.parentNode&&s.parentNode.removeChild(s)}function xg(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Ya(s,i,n){n==null?s.removeAttribute(i):s.getAttribute(i)!==n&&s.setAttribute(i,n)}function Fw(s){return Array.from(s.childNodes)}function Jh(s,i,n){s.classList.toggle(i,!!n)}let dp;function ih(s){dp=s}const Rc=[],Sg=[];let qc=[];const Tg=[],Rw=Promise.resolve();let jd=!1;function Bw(){jd||(jd=!0,Rw.then(P0))}function Ud(s){qc.push(s)}const Cd=new Set;let zc=0;function P0(){if(zc!==0)return;const s=dp;do{try{for(;zc<Rc.length;){const i=Rc[zc];zc++,ih(i),Nw(i.$$)}}catch(i){throw Rc.length=0,zc=0,i}for(ih(null),Rc.length=0,zc=0;Sg.length;)Sg.pop()();for(let i=0;i<qc.length;i+=1){const n=qc[i];Cd.has(n)||(Cd.add(n),n())}qc.length=0}while(Rc.length);for(;Tg.length;)Tg.pop()();jd=!1,Cd.clear(),ih(s)}function Nw(s){if(s.fragment!==null){s.update(),vf(s.before_update);const i=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,i),s.after_update.forEach(Ud)}}function jw(s){const i=[],n=[];qc.forEach(l=>s.indexOf(l)===-1?i.push(l):n.push(l)),n.forEach(l=>l()),qc=i}const Uw=new Set;function Vw(s,i){s&&s.i&&(Uw.delete(s),s.i(i))}function qw(s,i,n){const{fragment:l,after_update:u}=s.$$;l&&l.m(i,n),Ud(()=>{const d=s.$$.on_mount.map(I0).filter(A0);s.$$.on_destroy?s.$$.on_destroy.push(...d):vf(d),s.$$.on_mount=[]}),u.forEach(Ud)}function Zw(s,i){const n=s.$$;n.fragment!==null&&(jw(n.after_update),vf(n.on_destroy),n.fragment&&n.fragment.d(i),n.on_destroy=n.fragment=null,n.ctx=[])}function Ww(s,i){s.$$.dirty[0]===-1&&(Rc.push(s),Bw(),s.$$.dirty.fill(0)),s.$$.dirty[i/31|0]|=1<<i%31}function Gw(s,i,n,l,u,d,f=null,o=[-1]){const _=dp;ih(s);const T=s.$$={fragment:null,ctx:[],props:d,update:ah,not_equal:u,bound:wg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(_?_.$$.context:[])),callbacks:wg(),dirty:o,skip_bound:!1,root:i.target||_.$$.root};f&&f(T.root);let S=!1;if(T.ctx=n?n(s,i.props||{},(y,k,...I)=>{const C=I.length?I[0]:k;return T.ctx&&u(T.ctx[y],T.ctx[y]=C)&&(!T.skip_bound&&T.bound[y]&&T.bound[y](C),S&&Ww(s,y)),k}):[],T.update(),S=!0,vf(T.before_update),T.fragment=l?l(T.ctx):!1,i.target){if(i.hydrate){const y=Fw(i.target);T.fragment&&T.fragment.l(y),y.forEach(M0)}else T.fragment&&T.fragment.c();i.intro&&Vw(s.$$.fragment),qw(s,i.target,i.anchor),P0()}ih(_)}class Hw{constructor(){pi(this,"$$"),pi(this,"$$set")}$destroy(){Zw(this,1),this.$destroy=ah}$on(i,n){if(!A0(n))return ah;const l=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return l.push(n),()=>{const u=l.indexOf(n);u!==-1&&l.splice(u,1)}}$set(i){this.$$set&&!zw(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const Xw="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Xw);function Kw(s){let i,n,l;return{c(){i=xg("svg"),n=xg("path"),Ya(n,"stroke-width","4"),Ya(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Ya(n,"class","svelte-gzo3ar"),Ya(i,"width",l=s[0]==="list"?20:void 0),Ya(i,"viewBox","0 0 70 85"),Ya(i,"fill","none"),Ya(i,"class","svelte-gzo3ar"),Jh(i,"in-map",s[0]!=="list"),Jh(i,"list-icon",s[0]==="list")},m(u,d){Dw(u,i,d),Ow(i,n)},p(u,[d]){d&1&&l!==(l=u[0]==="list"?20:void 0)&&Ya(i,"width",l),d&1&&Jh(i,"in-map",u[0]!=="list"),d&1&&Jh(i,"list-icon",u[0]==="list")},i:ah,o:ah,d(u){u&&M0(i)}}}function Jw(s,i,n){let{displayIn:l}=i;return s.$$set=u=>{"displayIn"in u&&n(0,l=u.displayIn)},[l]}class Yw extends Hw{constructor(i){super(),Gw(this,i,Jw,Kw,Lw,{displayIn:0})}}function kg(s){const i=[...s];return i[2]<i[0]&&(Math.abs((i[0]+i[2]+360)/2)>Math.abs((i[0]-360+i[2])/2)?i[0]-=360:i[2]+=360),i}const Qw=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],$w={decimalLatitude:40.123,decimalLongitude:-74.123},ex=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],tx=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function ix(){const s=[];return Qw.forEach(i=>{i.decimalLatitude?s.push(i):s.push({...i,...$w})}),[...s,...ex,...tx]}const nx=ix();nx.map(s=>s.verbatimCoordinates);function lh(s,i,n={}){const l={type:"Feature"};return(n.id===0||n.id)&&(l.id=n.id),n.bbox&&(l.bbox=n.bbox),l.properties=i||{},l.geometry=s,l}function pp(s,i,n={}){for(const l of s){if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(l[l.length-1].length!==l[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<l[l.length-1].length;u++)if(l[l.length-1][u]!==l[0][u])throw new Error("First and last Position are not equivalent.")}return lh({type:"Polygon",coordinates:s},i,n)}function ch(s,i={}){const n={type:"FeatureCollection"};return i.id&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.features=s,n}function L0(s,i,n={}){return lh({type:"MultiPolygon",coordinates:s},i,n)}var rx=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Ed=Math.ceil,Us=Math.floor,as="[BigNumber Error] ",Cg=as+"Number primitive has more than 15 significant digits: ",co=1e14,Oi=14,Eg=9007199254740991,Id=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Qa=1e7,Ss=1e9;function z0(s){var i,n,l,u=z.prototype={constructor:z,toString:null,valueOf:null},d=new z(1),f=20,o=4,_=-7,T=21,S=-1e7,y=1e7,k=!1,I=1,C=0,L={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},N="0123456789abcdefghijklmnopqrstuvwxyz",R=!0;function z(j,U){var J,B,W,le,ge,pe,_e,ce,Le=this;if(!(Le instanceof z))return new z(j,U);if(U==null){if(j&&j._isBigNumber===!0){Le.s=j.s,!j.c||j.e>y?Le.c=Le.e=null:j.e<S?Le.c=[Le.e=0]:(Le.e=j.e,Le.c=j.c.slice());return}if((pe=typeof j=="number")&&j*0==0){if(Le.s=1/j<0?(j=-j,-1):1,j===~~j){for(le=0,ge=j;ge>=10;ge/=10,le++);le>y?Le.c=Le.e=null:(Le.e=le,Le.c=[j]);return}ce=String(j)}else{if(!rx.test(ce=String(j)))return l(Le,ce,pe);Le.s=ce.charCodeAt(0)==45?(ce=ce.slice(1),-1):1}(le=ce.indexOf("."))>-1&&(ce=ce.replace(".","")),(ge=ce.search(/e/i))>0?(le<0&&(le=ge),le+=+ce.slice(ge+1),ce=ce.substring(0,ge)):le<0&&(le=ce.length)}else{if(Fn(U,2,N.length,"Base"),U==10&&R)return Le=new z(j),$(Le,f+Le.e+1,o);if(ce=String(j),pe=typeof j=="number"){if(j*0!=0)return l(Le,ce,pe,U);if(Le.s=1/j<0?(ce=ce.slice(1),-1):1,z.DEBUG&&ce.replace(/^0\.0*|\./,"").length>15)throw Error(Cg+j)}else Le.s=ce.charCodeAt(0)===45?(ce=ce.slice(1),-1):1;for(J=N.slice(0,U),le=ge=0,_e=ce.length;ge<_e;ge++)if(J.indexOf(B=ce.charAt(ge))<0){if(B=="."){if(ge>le){le=_e;continue}}else if(!W&&(ce==ce.toUpperCase()&&(ce=ce.toLowerCase())||ce==ce.toLowerCase()&&(ce=ce.toUpperCase()))){W=!0,ge=-1,le=0;continue}return l(Le,String(j),pe,U)}pe=!1,ce=n(ce,U,10,Le.s),(le=ce.indexOf("."))>-1?ce=ce.replace(".",""):le=ce.length}for(ge=0;ce.charCodeAt(ge)===48;ge++);for(_e=ce.length;ce.charCodeAt(--_e)===48;);if(ce=ce.slice(ge,++_e)){if(_e-=ge,pe&&z.DEBUG&&_e>15&&(j>Eg||j!==Us(j)))throw Error(Cg+Le.s*j);if((le=le-ge-1)>y)Le.c=Le.e=null;else if(le<S)Le.c=[Le.e=0];else{if(Le.e=le,Le.c=[],ge=(le+1)%Oi,le<0&&(ge+=Oi),ge<_e){for(ge&&Le.c.push(+ce.slice(0,ge)),_e-=Oi;ge<_e;)Le.c.push(+ce.slice(ge,ge+=Oi));ge=Oi-(ce=ce.slice(ge)).length}else ge-=_e;for(;ge--;ce+="0");Le.c.push(+ce)}}else Le.c=[Le.e=0]}z.clone=z0,z.ROUND_UP=0,z.ROUND_DOWN=1,z.ROUND_CEIL=2,z.ROUND_FLOOR=3,z.ROUND_HALF_UP=4,z.ROUND_HALF_DOWN=5,z.ROUND_HALF_EVEN=6,z.ROUND_HALF_CEIL=7,z.ROUND_HALF_FLOOR=8,z.EUCLID=9,z.config=z.set=function(j){var U,J;if(j!=null)if(typeof j=="object"){if(j.hasOwnProperty(U="DECIMAL_PLACES")&&(J=j[U],Fn(J,0,Ss,U),f=J),j.hasOwnProperty(U="ROUNDING_MODE")&&(J=j[U],Fn(J,0,8,U),o=J),j.hasOwnProperty(U="EXPONENTIAL_AT")&&(J=j[U],J&&J.pop?(Fn(J[0],-1e9,0,U),Fn(J[1],0,Ss,U),_=J[0],T=J[1]):(Fn(J,-1e9,Ss,U),_=-(T=J<0?-J:J))),j.hasOwnProperty(U="RANGE"))if(J=j[U],J&&J.pop)Fn(J[0],-1e9,-1,U),Fn(J[1],1,Ss,U),S=J[0],y=J[1];else if(Fn(J,-1e9,Ss,U),J)S=-(y=J<0?-J:J);else throw Error(as+U+" cannot be zero: "+J);if(j.hasOwnProperty(U="CRYPTO"))if(J=j[U],J===!!J)if(J)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))k=J;else throw k=!J,Error(as+"crypto unavailable");else k=J;else throw Error(as+U+" not true or false: "+J);if(j.hasOwnProperty(U="MODULO_MODE")&&(J=j[U],Fn(J,0,9,U),I=J),j.hasOwnProperty(U="POW_PRECISION")&&(J=j[U],Fn(J,0,Ss,U),C=J),j.hasOwnProperty(U="FORMAT"))if(J=j[U],typeof J=="object")L=J;else throw Error(as+U+" not an object: "+J);if(j.hasOwnProperty(U="ALPHABET"))if(J=j[U],typeof J=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(J))R=J.slice(0,10)=="0123456789",N=J;else throw Error(as+U+" invalid: "+J)}else throw Error(as+"Object expected: "+j);return{DECIMAL_PLACES:f,ROUNDING_MODE:o,EXPONENTIAL_AT:[_,T],RANGE:[S,y],CRYPTO:k,MODULO_MODE:I,POW_PRECISION:C,FORMAT:L,ALPHABET:N}},z.isBigNumber=function(j){if(!j||j._isBigNumber!==!0)return!1;if(!z.DEBUG)return!0;var U,J,B=j.c,W=j.e,le=j.s;e:if({}.toString.call(B)=="[object Array]"){if((le===1||le===-1)&&W>=-1e9&&W<=Ss&&W===Us(W)){if(B[0]===0){if(W===0&&B.length===1)return!0;break e}if(U=(W+1)%Oi,U<1&&(U+=Oi),String(B[0]).length==U){for(U=0;U<B.length;U++)if(J=B[U],J<0||J>=co||J!==Us(J))break e;if(J!==0)return!0}}}else if(B===null&&W===null&&(le===null||le===1||le===-1))return!0;throw Error(as+"Invalid BigNumber: "+j)},z.maximum=z.max=function(){return ie(arguments,-1)},z.minimum=z.min=function(){return ie(arguments,1)},z.random=function(){var j=9007199254740992,U=Math.random()*j&2097151?function(){return Us(Math.random()*j)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(J){var B,W,le,ge,pe,_e=0,ce=[],Le=new z(d);if(J==null?J=f:Fn(J,0,Ss),ge=Ed(J/Oi),k)if(crypto.getRandomValues){for(B=crypto.getRandomValues(new Uint32Array(ge*=2));_e<ge;)pe=B[_e]*131072+(B[_e+1]>>>11),pe>=9e15?(W=crypto.getRandomValues(new Uint32Array(2)),B[_e]=W[0],B[_e+1]=W[1]):(ce.push(pe%1e14),_e+=2);_e=ge/2}else if(crypto.randomBytes){for(B=crypto.randomBytes(ge*=7);_e<ge;)pe=(B[_e]&31)*281474976710656+B[_e+1]*1099511627776+B[_e+2]*4294967296+B[_e+3]*16777216+(B[_e+4]<<16)+(B[_e+5]<<8)+B[_e+6],pe>=9e15?crypto.randomBytes(7).copy(B,_e):(ce.push(pe%1e14),_e+=7);_e=ge/7}else throw k=!1,Error(as+"crypto unavailable");if(!k)for(;_e<ge;)pe=U(),pe<9e15&&(ce[_e++]=pe%1e14);for(ge=ce[--_e],J%=Oi,ge&&J&&(pe=Id[Oi-J],ce[_e]=Us(ge/pe)*pe);ce[_e]===0;ce.pop(),_e--);if(_e<0)ce=[le=0];else{for(le=-1;ce[0]===0;ce.splice(0,1),le-=Oi);for(_e=1,pe=ce[0];pe>=10;pe/=10,_e++);_e<Oi&&(le-=Oi-_e)}return Le.e=le,Le.c=ce,Le}}(),z.sum=function(){for(var j=1,U=arguments,J=new z(U[0]);j<U.length;)J=J.plus(U[j++]);return J},n=function(){var j="0123456789";function U(J,B,W,le){for(var ge,pe=[0],_e,ce=0,Le=J.length;ce<Le;){for(_e=pe.length;_e--;pe[_e]*=B);for(pe[0]+=le.indexOf(J.charAt(ce++)),ge=0;ge<pe.length;ge++)pe[ge]>W-1&&(pe[ge+1]==null&&(pe[ge+1]=0),pe[ge+1]+=pe[ge]/W|0,pe[ge]%=W)}return pe.reverse()}return function(J,B,W,le,ge){var pe,_e,ce,Le,ze,ct,nt,bt,At=J.indexOf("."),tt=f,vt=o;for(At>=0&&(Le=C,C=0,J=J.replace(".",""),bt=new z(B),ct=bt.pow(J.length-At),C=Le,bt.c=U(ua(Ns(ct.c),ct.e,"0"),10,W,j),bt.e=bt.c.length),nt=U(J,B,W,ge?(pe=N,j):(pe=j,N)),ce=Le=nt.length;nt[--Le]==0;nt.pop());if(!nt[0])return pe.charAt(0);if(At<0?--ce:(ct.c=nt,ct.e=ce,ct.s=le,ct=i(ct,bt,tt,vt,W),nt=ct.c,ze=ct.r,ce=ct.e),_e=ce+tt+1,At=nt[_e],Le=W/2,ze=ze||_e<0||nt[_e+1]!=null,ze=vt<4?(At!=null||ze)&&(vt==0||vt==(ct.s<0?3:2)):At>Le||At==Le&&(vt==4||ze||vt==6&&nt[_e-1]&1||vt==(ct.s<0?8:7)),_e<1||!nt[0])J=ze?ua(pe.charAt(1),-tt,pe.charAt(0)):pe.charAt(0);else{if(nt.length=_e,ze)for(--W;++nt[--_e]>W;)nt[_e]=0,_e||(++ce,nt=[1].concat(nt));for(Le=nt.length;!nt[--Le];);for(At=0,J="";At<=Le;J+=pe.charAt(nt[At++]));J=ua(J,ce,pe.charAt(0))}return J}}(),i=function(){function j(B,W,le){var ge,pe,_e,ce,Le=0,ze=B.length,ct=W%Qa,nt=W/Qa|0;for(B=B.slice();ze--;)_e=B[ze]%Qa,ce=B[ze]/Qa|0,ge=nt*_e+ce*ct,pe=ct*_e+ge%Qa*Qa+Le,Le=(pe/le|0)+(ge/Qa|0)+nt*ce,B[ze]=pe%le;return Le&&(B=[Le].concat(B)),B}function U(B,W,le,ge){var pe,_e;if(le!=ge)_e=le>ge?1:-1;else for(pe=_e=0;pe<le;pe++)if(B[pe]!=W[pe]){_e=B[pe]>W[pe]?1:-1;break}return _e}function J(B,W,le,ge){for(var pe=0;le--;)B[le]-=pe,pe=B[le]<W[le]?1:0,B[le]=pe*ge+B[le]-W[le];for(;!B[0]&&B.length>1;B.splice(0,1));}return function(B,W,le,ge,pe){var _e,ce,Le,ze,ct,nt,bt,At,tt,vt,St,Zt,oi,Ai,Mi,Ti,It,Ge=B.s==W.s?1:-1,Pt=B.c,ii=W.c;if(!Pt||!Pt[0]||!ii||!ii[0])return new z(!B.s||!W.s||(Pt?ii&&Pt[0]==ii[0]:!ii)?NaN:Pt&&Pt[0]==0||!ii?Ge*0:Ge/0);for(At=new z(Ge),tt=At.c=[],ce=B.e-W.e,Ge=le+ce+1,pe||(pe=co,ce=Vs(B.e/Oi)-Vs(W.e/Oi),Ge=Ge/Oi|0),Le=0;ii[Le]==(Pt[Le]||0);Le++);if(ii[Le]>(Pt[Le]||0)&&ce--,Ge<0)tt.push(1),ze=!0;else{for(Ai=Pt.length,Ti=ii.length,Le=0,Ge+=2,ct=Us(pe/(ii[0]+1)),ct>1&&(ii=j(ii,ct,pe),Pt=j(Pt,ct,pe),Ti=ii.length,Ai=Pt.length),oi=Ti,vt=Pt.slice(0,Ti),St=vt.length;St<Ti;vt[St++]=0);It=ii.slice(),It=[0].concat(It),Mi=ii[0],ii[1]>=pe/2&&Mi++;do{if(ct=0,_e=U(ii,vt,Ti,St),_e<0){if(Zt=vt[0],Ti!=St&&(Zt=Zt*pe+(vt[1]||0)),ct=Us(Zt/Mi),ct>1)for(ct>=pe&&(ct=pe-1),nt=j(ii,ct,pe),bt=nt.length,St=vt.length;U(nt,vt,bt,St)==1;)ct--,J(nt,Ti<bt?It:ii,bt,pe),bt=nt.length,_e=1;else ct==0&&(_e=ct=1),nt=ii.slice(),bt=nt.length;if(bt<St&&(nt=[0].concat(nt)),J(vt,nt,St,pe),St=vt.length,_e==-1)for(;U(ii,vt,Ti,St)<1;)ct++,J(vt,Ti<St?It:ii,St,pe),St=vt.length}else _e===0&&(ct++,vt=[0]);tt[Le++]=ct,vt[0]?vt[St++]=Pt[oi]||0:(vt=[Pt[oi]],St=1)}while((oi++<Ai||vt[0]!=null)&&Ge--);ze=vt[0]!=null,tt[0]||tt.splice(0,1)}if(pe==co){for(Le=1,Ge=tt[0];Ge>=10;Ge/=10,Le++);$(At,le+(At.e=Le+ce*Oi-1)+1,ge,ze)}else At.e=ce,At.r=+ze;return At}}();function Z(j,U,J,B){var W,le,ge,pe,_e;if(J==null?J=o:Fn(J,0,8),!j.c)return j.toString();if(W=j.c[0],ge=j.e,U==null)_e=Ns(j.c),_e=B==1||B==2&&(ge<=_||ge>=T)?Qh(_e,ge):ua(_e,ge,"0");else if(j=$(new z(j),U,J),le=j.e,_e=Ns(j.c),pe=_e.length,B==1||B==2&&(U<=le||le<=_)){for(;pe<U;_e+="0",pe++);_e=Qh(_e,le)}else if(U-=ge,_e=ua(_e,le,"0"),le+1>pe){if(--U>0)for(_e+=".";U--;_e+="0");}else if(U+=le-pe,U>0)for(le+1==pe&&(_e+=".");U--;_e+="0");return j.s<0&&W?"-"+_e:_e}function ie(j,U){for(var J,B,W=1,le=new z(j[0]);W<j.length;W++)B=new z(j[W]),(!B.s||(J=Ll(le,B))===U||J===0&&le.s===U)&&(le=B);return le}function ae(j,U,J){for(var B=1,W=U.length;!U[--W];U.pop());for(W=U[0];W>=10;W/=10,B++);return(J=B+J*Oi-1)>y?j.c=j.e=null:J<S?j.c=[j.e=0]:(j.e=J,j.c=U),j}l=function(){var j=/^(-?)0([xbo])(?=\w[\w.]*$)/i,U=/^([^.]+)\.$/,J=/^\.([^.]+)$/,B=/^-?(Infinity|NaN)$/,W=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(le,ge,pe,_e){var ce,Le=pe?ge:ge.replace(W,"");if(B.test(Le))le.s=isNaN(Le)?null:Le<0?-1:1;else{if(!pe&&(Le=Le.replace(j,function(ze,ct,nt){return ce=(nt=nt.toLowerCase())=="x"?16:nt=="b"?2:8,!_e||_e==ce?ct:ze}),_e&&(ce=_e,Le=Le.replace(U,"$1").replace(J,"0.$1")),ge!=Le))return new z(Le,ce);if(z.DEBUG)throw Error(as+"Not a"+(_e?" base "+_e:"")+" number: "+ge);le.s=null}le.c=le.e=null}}();function $(j,U,J,B){var W,le,ge,pe,_e,ce,Le,ze=j.c,ct=Id;if(ze){e:{for(W=1,pe=ze[0];pe>=10;pe/=10,W++);if(le=U-W,le<0)le+=Oi,ge=U,_e=ze[ce=0],Le=Us(_e/ct[W-ge-1]%10);else if(ce=Ed((le+1)/Oi),ce>=ze.length)if(B){for(;ze.length<=ce;ze.push(0));_e=Le=0,W=1,le%=Oi,ge=le-Oi+1}else break e;else{for(_e=pe=ze[ce],W=1;pe>=10;pe/=10,W++);le%=Oi,ge=le-Oi+W,Le=ge<0?0:Us(_e/ct[W-ge-1]%10)}if(B=B||U<0||ze[ce+1]!=null||(ge<0?_e:_e%ct[W-ge-1]),B=J<4?(Le||B)&&(J==0||J==(j.s<0?3:2)):Le>5||Le==5&&(J==4||B||J==6&&(le>0?ge>0?_e/ct[W-ge]:0:ze[ce-1])%10&1||J==(j.s<0?8:7)),U<1||!ze[0])return ze.length=0,B?(U-=j.e+1,ze[0]=ct[(Oi-U%Oi)%Oi],j.e=-U||0):ze[0]=j.e=0,j;if(le==0?(ze.length=ce,pe=1,ce--):(ze.length=ce+1,pe=ct[Oi-le],ze[ce]=ge>0?Us(_e/ct[W-ge]%ct[ge])*pe:0),B)for(;;)if(ce==0){for(le=1,ge=ze[0];ge>=10;ge/=10,le++);for(ge=ze[0]+=pe,pe=1;ge>=10;ge/=10,pe++);le!=pe&&(j.e++,ze[0]==co&&(ze[0]=1));break}else{if(ze[ce]+=pe,ze[ce]!=co)break;ze[ce--]=0,pe=1}for(le=ze.length;ze[--le]===0;ze.pop());}j.e>y?j.c=j.e=null:j.e<S&&(j.c=[j.e=0])}return j}function re(j){var U,J=j.e;return J===null?j.toString():(U=Ns(j.c),U=J<=_||J>=T?Qh(U,J):ua(U,J,"0"),j.s<0?"-"+U:U)}return u.absoluteValue=u.abs=function(){var j=new z(this);return j.s<0&&(j.s=1),j},u.comparedTo=function(j,U){return Ll(this,new z(j,U))},u.decimalPlaces=u.dp=function(j,U){var J,B,W,le=this;if(j!=null)return Fn(j,0,Ss),U==null?U=o:Fn(U,0,8),$(new z(le),j+le.e+1,U);if(!(J=le.c))return null;if(B=((W=J.length-1)-Vs(this.e/Oi))*Oi,W=J[W])for(;W%10==0;W/=10,B--);return B<0&&(B=0),B},u.dividedBy=u.div=function(j,U){return i(this,new z(j,U),f,o)},u.dividedToIntegerBy=u.idiv=function(j,U){return i(this,new z(j,U),0,1)},u.exponentiatedBy=u.pow=function(j,U){var J,B,W,le,ge,pe,_e,ce,Le,ze=this;if(j=new z(j),j.c&&!j.isInteger())throw Error(as+"Exponent not an integer: "+re(j));if(U!=null&&(U=new z(U)),pe=j.e>14,!ze.c||!ze.c[0]||ze.c[0]==1&&!ze.e&&ze.c.length==1||!j.c||!j.c[0])return Le=new z(Math.pow(+re(ze),pe?j.s*(2-Yh(j)):+re(j))),U?Le.mod(U):Le;if(_e=j.s<0,U){if(U.c?!U.c[0]:!U.s)return new z(NaN);B=!_e&&ze.isInteger()&&U.isInteger(),B&&(ze=ze.mod(U))}else{if(j.e>9&&(ze.e>0||ze.e<-1||(ze.e==0?ze.c[0]>1||pe&&ze.c[1]>=24e7:ze.c[0]<8e13||pe&&ze.c[0]<=9999975e7)))return le=ze.s<0&&Yh(j)?-0:0,ze.e>-1&&(le=1/le),new z(_e?1/le:le);C&&(le=Ed(C/Oi+2))}for(pe?(J=new z(.5),_e&&(j.s=1),ce=Yh(j)):(W=Math.abs(+re(j)),ce=W%2),Le=new z(d);;){if(ce){if(Le=Le.times(ze),!Le.c)break;le?Le.c.length>le&&(Le.c.length=le):B&&(Le=Le.mod(U))}if(W){if(W=Us(W/2),W===0)break;ce=W%2}else if(j=j.times(J),$(j,j.e+1,1),j.e>14)ce=Yh(j);else{if(W=+re(j),W===0)break;ce=W%2}ze=ze.times(ze),le?ze.c&&ze.c.length>le&&(ze.c.length=le):B&&(ze=ze.mod(U))}return B?Le:(_e&&(Le=d.div(Le)),U?Le.mod(U):le?$(Le,C,o,ge):Le)},u.integerValue=function(j){var U=new z(this);return j==null?j=o:Fn(j,0,8),$(U,U.e+1,j)},u.isEqualTo=u.eq=function(j,U){return Ll(this,new z(j,U))===0},u.isFinite=function(){return!!this.c},u.isGreaterThan=u.gt=function(j,U){return Ll(this,new z(j,U))>0},u.isGreaterThanOrEqualTo=u.gte=function(j,U){return(U=Ll(this,new z(j,U)))===1||U===0},u.isInteger=function(){return!!this.c&&Vs(this.e/Oi)>this.c.length-2},u.isLessThan=u.lt=function(j,U){return Ll(this,new z(j,U))<0},u.isLessThanOrEqualTo=u.lte=function(j,U){return(U=Ll(this,new z(j,U)))===-1||U===0},u.isNaN=function(){return!this.s},u.isNegative=function(){return this.s<0},u.isPositive=function(){return this.s>0},u.isZero=function(){return!!this.c&&this.c[0]==0},u.minus=function(j,U){var J,B,W,le,ge=this,pe=ge.s;if(j=new z(j,U),U=j.s,!pe||!U)return new z(NaN);if(pe!=U)return j.s=-U,ge.plus(j);var _e=ge.e/Oi,ce=j.e/Oi,Le=ge.c,ze=j.c;if(!_e||!ce){if(!Le||!ze)return Le?(j.s=-U,j):new z(ze?ge:NaN);if(!Le[0]||!ze[0])return ze[0]?(j.s=-U,j):new z(Le[0]?ge:o==3?-0:0)}if(_e=Vs(_e),ce=Vs(ce),Le=Le.slice(),pe=_e-ce){for((le=pe<0)?(pe=-pe,W=Le):(ce=_e,W=ze),W.reverse(),U=pe;U--;W.push(0));W.reverse()}else for(B=(le=(pe=Le.length)<(U=ze.length))?pe:U,pe=U=0;U<B;U++)if(Le[U]!=ze[U]){le=Le[U]<ze[U];break}if(le&&(W=Le,Le=ze,ze=W,j.s=-j.s),U=(B=ze.length)-(J=Le.length),U>0)for(;U--;Le[J++]=0);for(U=co-1;B>pe;){if(Le[--B]<ze[B]){for(J=B;J&&!Le[--J];Le[J]=U);--Le[J],Le[B]+=co}Le[B]-=ze[B]}for(;Le[0]==0;Le.splice(0,1),--ce);return Le[0]?ae(j,Le,ce):(j.s=o==3?-1:1,j.c=[j.e=0],j)},u.modulo=u.mod=function(j,U){var J,B,W=this;return j=new z(j,U),!W.c||!j.s||j.c&&!j.c[0]?new z(NaN):!j.c||W.c&&!W.c[0]?new z(W):(I==9?(B=j.s,j.s=1,J=i(W,j,0,3),j.s=B,J.s*=B):J=i(W,j,0,I),j=W.minus(J.times(j)),!j.c[0]&&I==1&&(j.s=W.s),j)},u.multipliedBy=u.times=function(j,U){var J,B,W,le,ge,pe,_e,ce,Le,ze,ct,nt,bt,At,tt,vt=this,St=vt.c,Zt=(j=new z(j,U)).c;if(!St||!Zt||!St[0]||!Zt[0])return!vt.s||!j.s||St&&!St[0]&&!Zt||Zt&&!Zt[0]&&!St?j.c=j.e=j.s=null:(j.s*=vt.s,!St||!Zt?j.c=j.e=null:(j.c=[0],j.e=0)),j;for(B=Vs(vt.e/Oi)+Vs(j.e/Oi),j.s*=vt.s,_e=St.length,ze=Zt.length,_e<ze&&(bt=St,St=Zt,Zt=bt,W=_e,_e=ze,ze=W),W=_e+ze,bt=[];W--;bt.push(0));for(At=co,tt=Qa,W=ze;--W>=0;){for(J=0,ct=Zt[W]%tt,nt=Zt[W]/tt|0,ge=_e,le=W+ge;le>W;)ce=St[--ge]%tt,Le=St[ge]/tt|0,pe=nt*ce+Le*ct,ce=ct*ce+pe%tt*tt+bt[le]+J,J=(ce/At|0)+(pe/tt|0)+nt*Le,bt[le--]=ce%At;bt[le]=J}return J?++B:bt.splice(0,1),ae(j,bt,B)},u.negated=function(){var j=new z(this);return j.s=-j.s||null,j},u.plus=function(j,U){var J,B=this,W=B.s;if(j=new z(j,U),U=j.s,!W||!U)return new z(NaN);if(W!=U)return j.s=-U,B.minus(j);var le=B.e/Oi,ge=j.e/Oi,pe=B.c,_e=j.c;if(!le||!ge){if(!pe||!_e)return new z(W/0);if(!pe[0]||!_e[0])return _e[0]?j:new z(pe[0]?B:W*0)}if(le=Vs(le),ge=Vs(ge),pe=pe.slice(),W=le-ge){for(W>0?(ge=le,J=_e):(W=-W,J=pe),J.reverse();W--;J.push(0));J.reverse()}for(W=pe.length,U=_e.length,W-U<0&&(J=_e,_e=pe,pe=J,U=W),W=0;U;)W=(pe[--U]=pe[U]+_e[U]+W)/co|0,pe[U]=co===pe[U]?0:pe[U]%co;return W&&(pe=[W].concat(pe),++ge),ae(j,pe,ge)},u.precision=u.sd=function(j,U){var J,B,W,le=this;if(j!=null&&j!==!!j)return Fn(j,1,Ss),U==null?U=o:Fn(U,0,8),$(new z(le),j,U);if(!(J=le.c))return null;if(W=J.length-1,B=W*Oi+1,W=J[W]){for(;W%10==0;W/=10,B--);for(W=J[0];W>=10;W/=10,B++);}return j&&le.e+1>B&&(B=le.e+1),B},u.shiftedBy=function(j){return Fn(j,-9007199254740991,Eg),this.times("1e"+j)},u.squareRoot=u.sqrt=function(){var j,U,J,B,W,le=this,ge=le.c,pe=le.s,_e=le.e,ce=f+4,Le=new z("0.5");if(pe!==1||!ge||!ge[0])return new z(!pe||pe<0&&(!ge||ge[0])?NaN:ge?le:1/0);if(pe=Math.sqrt(+re(le)),pe==0||pe==1/0?(U=Ns(ge),(U.length+_e)%2==0&&(U+="0"),pe=Math.sqrt(+U),_e=Vs((_e+1)/2)-(_e<0||_e%2),pe==1/0?U="5e"+_e:(U=pe.toExponential(),U=U.slice(0,U.indexOf("e")+1)+_e),J=new z(U)):J=new z(pe+""),J.c[0]){for(_e=J.e,pe=_e+ce,pe<3&&(pe=0);;)if(W=J,J=Le.times(W.plus(i(le,W,ce,1))),Ns(W.c).slice(0,pe)===(U=Ns(J.c)).slice(0,pe))if(J.e<_e&&--pe,U=U.slice(pe-3,pe+1),U=="9999"||!B&&U=="4999"){if(!B&&($(W,W.e+f+2,0),W.times(W).eq(le))){J=W;break}ce+=4,pe+=4,B=1}else{(!+U||!+U.slice(1)&&U.charAt(0)=="5")&&($(J,J.e+f+2,1),j=!J.times(J).eq(le));break}}return $(J,J.e+f+1,o,j)},u.toExponential=function(j,U){return j!=null&&(Fn(j,0,Ss),j++),Z(this,j,U,1)},u.toFixed=function(j,U){return j!=null&&(Fn(j,0,Ss),j=j+this.e+1),Z(this,j,U)},u.toFormat=function(j,U,J){var B,W=this;if(J==null)j!=null&&U&&typeof U=="object"?(J=U,U=null):j&&typeof j=="object"?(J=j,j=U=null):J=L;else if(typeof J!="object")throw Error(as+"Argument not an object: "+J);if(B=W.toFixed(j,U),W.c){var le,ge=B.split("."),pe=+J.groupSize,_e=+J.secondaryGroupSize,ce=J.groupSeparator||"",Le=ge[0],ze=ge[1],ct=W.s<0,nt=ct?Le.slice(1):Le,bt=nt.length;if(_e&&(le=pe,pe=_e,_e=le,bt-=le),pe>0&&bt>0){for(le=bt%pe||pe,Le=nt.substr(0,le);le<bt;le+=pe)Le+=ce+nt.substr(le,pe);_e>0&&(Le+=ce+nt.slice(le)),ct&&(Le="-"+Le)}B=ze?Le+(J.decimalSeparator||"")+((_e=+J.fractionGroupSize)?ze.replace(new RegExp("\\d{"+_e+"}\\B","g"),"$&"+(J.fractionGroupSeparator||"")):ze):Le}return(J.prefix||"")+B+(J.suffix||"")},u.toFraction=function(j){var U,J,B,W,le,ge,pe,_e,ce,Le,ze,ct,nt=this,bt=nt.c;if(j!=null&&(pe=new z(j),!pe.isInteger()&&(pe.c||pe.s!==1)||pe.lt(d)))throw Error(as+"Argument "+(pe.isInteger()?"out of range: ":"not an integer: ")+re(pe));if(!bt)return new z(nt);for(U=new z(d),ce=J=new z(d),B=_e=new z(d),ct=Ns(bt),le=U.e=ct.length-nt.e-1,U.c[0]=Id[(ge=le%Oi)<0?Oi+ge:ge],j=!j||pe.comparedTo(U)>0?le>0?U:ce:pe,ge=y,y=1/0,pe=new z(ct),_e.c[0]=0;Le=i(pe,U,0,1),W=J.plus(Le.times(B)),W.comparedTo(j)!=1;)J=B,B=W,ce=_e.plus(Le.times(W=ce)),_e=W,U=pe.minus(Le.times(W=U)),pe=W;return W=i(j.minus(J),B,0,1),_e=_e.plus(W.times(ce)),J=J.plus(W.times(B)),_e.s=ce.s=nt.s,le=le*2,ze=i(ce,B,le,o).minus(nt).abs().comparedTo(i(_e,J,le,o).minus(nt).abs())<1?[ce,B]:[_e,J],y=ge,ze},u.toNumber=function(){return+re(this)},u.toPrecision=function(j,U){return j!=null&&Fn(j,1,Ss),Z(this,j,U,2)},u.toString=function(j){var U,J=this,B=J.s,W=J.e;return W===null?B?(U="Infinity",B<0&&(U="-"+U)):U="NaN":(j==null?U=W<=_||W>=T?Qh(Ns(J.c),W):ua(Ns(J.c),W,"0"):j===10&&R?(J=$(new z(J),f+W+1,o),U=ua(Ns(J.c),J.e,"0")):(Fn(j,2,N.length,"Base"),U=n(ua(Ns(J.c),W,"0"),10,j,B,!0)),B<0&&J.c[0]&&(U="-"+U)),U},u.valueOf=u.toJSON=function(){return re(this)},u._isBigNumber=!0,u[Symbol.toStringTag]="BigNumber",u[Symbol.for("nodejs.util.inspect.custom")]=u.valueOf,s!=null&&z.set(s),z}function Vs(s){var i=s|0;return s>0||s===i?i:i-1}function Ns(s){for(var i,n,l=1,u=s.length,d=s[0]+"";l<u;){for(i=s[l++]+"",n=Oi-i.length;n--;i="0"+i);d+=i}for(u=d.length;d.charCodeAt(--u)===48;);return d.slice(0,u+1||1)}function Ll(s,i){var n,l,u=s.c,d=i.c,f=s.s,o=i.s,_=s.e,T=i.e;if(!f||!o)return null;if(n=u&&!u[0],l=d&&!d[0],n||l)return n?l?0:-o:f;if(f!=o)return f;if(n=f<0,l=_==T,!u||!d)return l?0:!u^n?1:-1;if(!l)return _>T^n?1:-1;for(o=(_=u.length)<(T=d.length)?_:T,f=0;f<o;f++)if(u[f]!=d[f])return u[f]>d[f]^n?1:-1;return _==T?0:_>T^n?1:-1}function Fn(s,i,n,l){if(s<i||s>n||s!==Us(s))throw Error(as+(l||"Argument")+(typeof s=="number"?s<i||s>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(s))}function Yh(s){var i=s.c.length-1;return Vs(s.e/Oi)==i&&s.c[i]%2!=0}function Qh(s,i){return(s.length>1?s.charAt(0)+"."+s.slice(1):s)+(i<0?"e":"e+")+i}function ua(s,i,n){var l,u;if(i<0){for(u=n+".";++i;u+=n);s=u+s}else if(l=s.length,++i>l){for(u=n,i-=l;--i;u+=n);s+=u}else i<l&&(s=s.slice(0,i)+"."+s.slice(i));return s}var Do=z0(),sx=class{constructor(s){pi(this,"key"),pi(this,"left",null),pi(this,"right",null),this.key=s}},qu=class extends sx{constructor(s){super(s)}},ox=class{constructor(){pi(this,"size",0),pi(this,"modificationCount",0),pi(this,"splayCount",0)}splay(s){const i=this.root;if(i==null)return this.compare(s,s),-1;let n=null,l=null,u=null,d=null,f=i;const o=this.compare;let _;for(;;)if(_=o(f.key,s),_>0){let T=f.left;if(T==null||(_=o(T.key,s),_>0&&(f.left=T.right,T.right=f,f=T,T=f.left,T==null)))break;n==null?l=f:n.left=f,n=f,f=T}else if(_<0){let T=f.right;if(T==null||(_=o(T.key,s),_<0&&(f.right=T.left,T.left=f,f=T,T=f.right,T==null)))break;u==null?d=f:u.right=f,u=f,f=T}else break;return u!=null&&(u.right=f.left,f.left=d),n!=null&&(n.left=f.right,f.right=l),this.root!==f&&(this.root=f,this.splayCount++),_}splayMin(s){let i=s,n=i.left;for(;n!=null;){const l=n;i.left=l.right,l.right=i,i=l,n=i.left}return i}splayMax(s){let i=s,n=i.right;for(;n!=null;){const l=n;i.right=l.left,l.left=i,i=l,n=i.right}return i}_delete(s){if(this.root==null||this.splay(s)!=0)return null;let i=this.root;const n=i,l=i.left;if(this.size--,l==null)this.root=i.right;else{const u=i.right;i=this.splayMax(l),i.right=u,this.root=i}return this.modificationCount++,n}addNewRoot(s,i){this.size++,this.modificationCount++;const n=this.root;if(n==null){this.root=s;return}i<0?(s.left=n,s.right=n.right,n.right=null):(s.right=n,s.left=n.left,n.left=null),this.root=s}_first(){const s=this.root;return s==null?null:(this.root=this.splayMin(s),this.root)}_last(){const s=this.root;return s==null?null:(this.root=this.splayMax(s),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(s){return this.validKey(s)&&this.splay(s)==0}defaultCompare(){return(s,i)=>s<i?-1:s>i?1:0}wrap(){return{getRoot:()=>this.root,setRoot:s=>{this.root=s},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:s=>{this.splayCount=s},splay:s=>this.splay(s),has:s=>this.has(s)}}},Ig,Ag,uf=class Ku extends ox{constructor(i,n){super(),pi(this,"root",null),pi(this,"compare"),pi(this,"validKey"),pi(this,Ig,"[object Set]"),this.compare=i??this.defaultCompare(),this.validKey=n??(l=>l!=null&&l!=null)}delete(i){return this.validKey(i)?this._delete(i)!=null:!1}deleteAll(i){for(const n of i)this.delete(n)}forEach(i){const n=this[Symbol.iterator]();let l;for(;l=n.next(),!l.done;)i(l.value,l.value,this)}add(i){const n=this.splay(i);return n!=0&&this.addNewRoot(new qu(i),n),this}addAndReturn(i){const n=this.splay(i);return n!=0&&this.addNewRoot(new qu(i),n),this.root.key}addAll(i){for(const n of i)this.add(n)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(i){if(i==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(i)<0)return this.root.key;let n=this.root.left;if(n==null)return null;let l=n.right;for(;l!=null;)n=l,l=n.right;return n.key}firstAfter(i){if(i==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(i)>0)return this.root.key;let n=this.root.right;if(n==null)return null;let l=n.left;for(;l!=null;)n=l,l=n.left;return n.key}retainAll(i){const n=new Ku(this.compare,this.validKey),l=this.modificationCount;for(const u of i){if(l!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(u)&&this.splay(u)==0&&n.add(this.root.key)}n.size!=this.size&&(this.root=n.root,this.size=n.size,this.modificationCount++)}lookup(i){return!this.validKey(i)||this.splay(i)!=0?null:this.root.key}intersection(i){const n=new Ku(this.compare,this.validKey);for(const l of this)i.has(l)&&n.add(l);return n}difference(i){const n=new Ku(this.compare,this.validKey);for(const l of this)i.has(l)||n.add(l);return n}union(i){const n=this.clone();return n.addAll(i),n}clone(){const i=new Ku(this.compare,this.validKey);return i.size=this.size,i.root=this.copyNode(this.root),i}copyNode(i){if(i==null)return null;function n(u,d){let f,o;do{if(f=u.left,o=u.right,f!=null){const _=new qu(f.key);d.left=_,n(f,_)}if(o!=null){const _=new qu(o.key);d.right=_,u=o,d=_}}while(o!=null)}const l=new qu(i.key);return n(i,l),l}toSet(){return this.clone()}entries(){return new lx(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Ag=Symbol.iterator,Ig=Symbol.toStringTag,Ag)](){return new ax(this.wrap())}},O0=class{constructor(s){pi(this,"tree"),pi(this,"path",new Array),pi(this,"modificationCount",null),pi(this,"splayCount"),this.tree=s,this.splayCount=s.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const s=this.path[this.path.length-1];return this.getValue(s)}rebuildPath(s){this.path.splice(0,this.path.length),this.tree.splay(s),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(s){for(;s!=null;)this.path.push(s),s=s.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let n=this.tree.getRoot();for(;n!=null;)this.path.push(n),n=n.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let s=this.path[this.path.length-1],i=s.right;if(i!=null){for(;i!=null;)this.path.push(i),i=i.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===s;)s=this.path.pop();return this.path.length>0}},ax=class extends O0{getValue(s){return s.key}},lx=class extends O0{getValue(s){return[s.key,s.key]}},D0=s=>()=>s,Vd=s=>{const i=s?(n,l)=>l.minus(n).abs().isLessThanOrEqualTo(s):D0(!1);return(n,l)=>i(n,l)?0:n.comparedTo(l)};function cx(s){const i=s?(n,l,u,d,f)=>n.exponentiatedBy(2).isLessThanOrEqualTo(d.minus(l).exponentiatedBy(2).plus(f.minus(u).exponentiatedBy(2)).times(s)):D0(!1);return(n,l,u)=>{const d=n.x,f=n.y,o=u.x,_=u.y,T=f.minus(_).times(l.x.minus(o)).minus(d.minus(o).times(l.y.minus(_)));return i(T,d,f,o,_)?0:T.comparedTo(0)}}var ux=s=>s,hx=s=>{if(s){const i=new uf(Vd(s)),n=new uf(Vd(s)),l=(d,f)=>f.addAndReturn(d),u=d=>({x:l(d.x,i),y:l(d.y,n)});return u({x:new Do(0),y:new Do(0)}),u}return ux},qd=s=>({set:i=>{pa=qd(i)},reset:()=>qd(s),compare:Vd(s),snap:hx(s),orient:cx(s)}),pa=qd(),Zu=(s,i)=>s.ll.x.isLessThanOrEqualTo(i.x)&&i.x.isLessThanOrEqualTo(s.ur.x)&&s.ll.y.isLessThanOrEqualTo(i.y)&&i.y.isLessThanOrEqualTo(s.ur.y),Zd=(s,i)=>{if(i.ur.x.isLessThan(s.ll.x)||s.ur.x.isLessThan(i.ll.x)||i.ur.y.isLessThan(s.ll.y)||s.ur.y.isLessThan(i.ll.y))return null;const n=s.ll.x.isLessThan(i.ll.x)?i.ll.x:s.ll.x,l=s.ur.x.isLessThan(i.ur.x)?s.ur.x:i.ur.x,u=s.ll.y.isLessThan(i.ll.y)?i.ll.y:s.ll.y,d=s.ur.y.isLessThan(i.ur.y)?s.ur.y:i.ur.y;return{ll:{x:n,y:u},ur:{x:l,y:d}}},of=(s,i)=>s.x.times(i.y).minus(s.y.times(i.x)),F0=(s,i)=>s.x.times(i.x).plus(s.y.times(i.y)),hf=s=>F0(s,s).sqrt(),fx=(s,i,n)=>{const l={x:i.x.minus(s.x),y:i.y.minus(s.y)},u={x:n.x.minus(s.x),y:n.y.minus(s.y)};return of(u,l).div(hf(u)).div(hf(l))},dx=(s,i,n)=>{const l={x:i.x.minus(s.x),y:i.y.minus(s.y)},u={x:n.x.minus(s.x),y:n.y.minus(s.y)};return F0(u,l).div(hf(u)).div(hf(l))},Mg=(s,i,n)=>i.y.isZero()?null:{x:s.x.plus(i.x.div(i.y).times(n.minus(s.y))),y:n},Pg=(s,i,n)=>i.x.isZero()?null:{x:n,y:s.y.plus(i.y.div(i.x).times(n.minus(s.x)))},px=(s,i,n,l)=>{if(i.x.isZero())return Pg(n,l,s.x);if(l.x.isZero())return Pg(s,i,n.x);if(i.y.isZero())return Mg(n,l,s.y);if(l.y.isZero())return Mg(s,i,n.y);const u=of(i,l);if(u.isZero())return null;const d={x:n.x.minus(s.x),y:n.y.minus(s.y)},f=of(d,i).div(u),o=of(d,l).div(u),_=s.x.plus(o.times(i.x)),T=n.x.plus(f.times(l.x)),S=s.y.plus(o.times(i.y)),y=n.y.plus(f.times(l.y)),k=_.plus(T).div(2),I=S.plus(y).div(2);return{x:k,y:I}},Oo=class R0{constructor(i,n){pi(this,"point"),pi(this,"isLeft"),pi(this,"segment"),pi(this,"otherSE"),pi(this,"consumedBy"),i.events===void 0?i.events=[this]:i.events.push(this),this.point=i,this.isLeft=n}static compare(i,n){const l=R0.comparePoints(i.point,n.point);return l!==0?l:(i.point!==n.point&&i.link(n),i.isLeft!==n.isLeft?i.isLeft?1:-1:df.compare(i.segment,n.segment))}static comparePoints(i,n){return i.x.isLessThan(n.x)?-1:i.x.isGreaterThan(n.x)?1:i.y.isLessThan(n.y)?-1:i.y.isGreaterThan(n.y)?1:0}link(i){if(i.point===this.point)throw new Error("Tried to link already linked events");const n=i.point.events;for(let l=0,u=n.length;l<u;l++){const d=n[l];this.point.events.push(d),d.point=this.point}this.checkForConsuming()}checkForConsuming(){const i=this.point.events.length;for(let n=0;n<i;n++){const l=this.point.events[n];if(l.segment.consumedBy===void 0)for(let u=n+1;u<i;u++){const d=this.point.events[u];d.consumedBy===void 0&&l.otherSE.point.events===d.otherSE.point.events&&l.segment.consume(d.segment)}}}getAvailableLinkedEvents(){const i=[];for(let n=0,l=this.point.events.length;n<l;n++){const u=this.point.events[n];u!==this&&!u.segment.ringOut&&u.segment.isInResult()&&i.push(u)}return i}getLeftmostComparator(i){const n=new Map,l=u=>{const d=u.otherSE;n.set(u,{sine:fx(this.point,i.point,d.point),cosine:dx(this.point,i.point,d.point)})};return(u,d)=>{n.has(u)||l(u),n.has(d)||l(d);const{sine:f,cosine:o}=n.get(u),{sine:_,cosine:T}=n.get(d);return f.isGreaterThanOrEqualTo(0)&&_.isGreaterThanOrEqualTo(0)?o.isLessThan(T)?1:o.isGreaterThan(T)?-1:0:f.isLessThan(0)&&_.isLessThan(0)?o.isLessThan(T)?-1:o.isGreaterThan(T)?1:0:_.isLessThan(f)?-1:_.isGreaterThan(f)?1:0}}},mx=class Wd{constructor(i){pi(this,"events"),pi(this,"poly"),pi(this,"_isExteriorRing"),pi(this,"_enclosingRing"),this.events=i;for(let n=0,l=i.length;n<l;n++)i[n].segment.ringOut=this;this.poly=null}static factory(i){const n=[];for(let l=0,u=i.length;l<u;l++){const d=i[l];if(!d.isInResult()||d.ringOut)continue;let f=null,o=d.leftSE,_=d.rightSE;const T=[o],S=o.point,y=[];for(;f=o,o=_,T.push(o),o.point!==S;)for(;;){const k=o.getAvailableLinkedEvents();if(k.length===0){const L=T[0].point,N=T[T.length-1].point;throw new Error(`Unable to complete output ring starting at [${L.x}, ${L.y}]. Last matching segment found ends at [${N.x}, ${N.y}].`)}if(k.length===1){_=k[0].otherSE;break}let I=null;for(let L=0,N=y.length;L<N;L++)if(y[L].point===o.point){I=L;break}if(I!==null){const L=y.splice(I)[0],N=T.splice(L.index);N.unshift(N[0].otherSE),n.push(new Wd(N.reverse()));continue}y.push({index:T.length,point:o.point});const C=o.getLeftmostComparator(f);_=k.sort(C)[0].otherSE;break}n.push(new Wd(T))}return n}getGeom(){let i=this.events[0].point;const n=[i];for(let T=1,S=this.events.length-1;T<S;T++){const y=this.events[T].point,k=this.events[T+1].point;pa.orient(y,i,k)!==0&&(n.push(y),i=y)}if(n.length===1)return null;const l=n[0],u=n[1];pa.orient(l,i,u)===0&&n.shift(),n.push(n[0]);const d=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:n.length-1,o=this.isExteriorRing()?n.length:-1,_=[];for(let T=f;T!=o;T+=d)_.push([n[T].x.toNumber(),n[T].y.toNumber()]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const i=this.enclosingRing();this._isExteriorRing=i?!i.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var i,n;let l=this.events[0];for(let f=1,o=this.events.length;f<o;f++){const _=this.events[f];Oo.compare(l,_)>0&&(l=_)}let u=l.segment.prevInResult(),d=u?u.prevInResult():null;for(;;){if(!u)return null;if(!d)return u.ringOut;if(d.ringOut!==u.ringOut)return((i=d.ringOut)==null?void 0:i.enclosingRing())!==u.ringOut?u.ringOut:(n=u.ringOut)==null?void 0:n.enclosingRing();u=d.prevInResult(),d=u?u.prevInResult():null}}},Lg=class{constructor(s){pi(this,"exteriorRing"),pi(this,"interiorRings"),this.exteriorRing=s,s.poly=this,this.interiorRings=[]}addInterior(s){this.interiorRings.push(s),s.poly=this}getGeom(){const s=this.exteriorRing.getGeom();if(s===null)return null;const i=[s];for(let n=0,l=this.interiorRings.length;n<l;n++){const u=this.interiorRings[n].getGeom();u!==null&&i.push(u)}return i}},gx=class{constructor(s){pi(this,"rings"),pi(this,"polys"),this.rings=s,this.polys=this._composePolys(s)}getGeom(){const s=[];for(let i=0,n=this.polys.length;i<n;i++){const l=this.polys[i].getGeom();l!==null&&s.push(l)}return s}_composePolys(s){var i;const n=[];for(let l=0,u=s.length;l<u;l++){const d=s[l];if(!d.poly)if(d.isExteriorRing())n.push(new Lg(d));else{const f=d.enclosingRing();f!=null&&f.poly||n.push(new Lg(f)),(i=f==null?void 0:f.poly)==null||i.addInterior(d)}}return n}},_x=class{constructor(s,i=df.compare){pi(this,"queue"),pi(this,"tree"),pi(this,"segments"),this.queue=s,this.tree=new uf(i),this.segments=[]}process(s){const i=s.segment,n=[];if(s.consumedBy)return s.isLeft?this.queue.delete(s.otherSE):this.tree.delete(i),n;s.isLeft&&this.tree.add(i);let l=i,u=i;do l=this.tree.lastBefore(l);while(l!=null&&l.consumedBy!=null);do u=this.tree.firstAfter(u);while(u!=null&&u.consumedBy!=null);if(s.isLeft){let d=null;if(l){const o=l.getIntersection(i);if(o!==null&&(i.isAnEndpoint(o)||(d=o),!l.isAnEndpoint(o))){const _=this._splitSafely(l,o);for(let T=0,S=_.length;T<S;T++)n.push(_[T])}}let f=null;if(u){const o=u.getIntersection(i);if(o!==null&&(i.isAnEndpoint(o)||(f=o),!u.isAnEndpoint(o))){const _=this._splitSafely(u,o);for(let T=0,S=_.length;T<S;T++)n.push(_[T])}}if(d!==null||f!==null){let o=null;d===null?o=f:f===null?o=d:o=Oo.comparePoints(d,f)<=0?d:f,this.queue.delete(i.rightSE),n.push(i.rightSE);const _=i.split(o);for(let T=0,S=_.length;T<S;T++)n.push(_[T])}n.length>0?(this.tree.delete(i),n.push(s)):(this.segments.push(i),i.prev=l)}else{if(l&&u){const d=l.getIntersection(u);if(d!==null){if(!l.isAnEndpoint(d)){const f=this._splitSafely(l,d);for(let o=0,_=f.length;o<_;o++)n.push(f[o])}if(!u.isAnEndpoint(d)){const f=this._splitSafely(u,d);for(let o=0,_=f.length;o<_;o++)n.push(f[o])}}}this.tree.delete(i)}return n}_splitSafely(s,i){this.tree.delete(s);const n=s.rightSE;this.queue.delete(n);const l=s.split(i);return l.push(n),s.consumedBy===void 0&&this.tree.add(s),l}},yx=class{constructor(){pi(this,"type"),pi(this,"numMultiPolys")}run(s,i,n){Ju.type=s;const l=[new Og(i,!0)];for(let _=0,T=n.length;_<T;_++)l.push(new Og(n[_],!1));if(Ju.numMultiPolys=l.length,Ju.type==="difference"){const _=l[0];let T=1;for(;T<l.length;)Zd(l[T].bbox,_.bbox)!==null?T++:l.splice(T,1)}if(Ju.type==="intersection")for(let _=0,T=l.length;_<T;_++){const S=l[_];for(let y=_+1,k=l.length;y<k;y++)if(Zd(S.bbox,l[y].bbox)===null)return[]}const u=new uf(Oo.compare);for(let _=0,T=l.length;_<T;_++){const S=l[_].getSweepEvents();for(let y=0,k=S.length;y<k;y++)u.add(S[y])}const d=new _x(u);let f=null;for(u.size!=0&&(f=u.first(),u.delete(f));f;){const _=d.process(f);for(let T=0,S=_.length;T<S;T++){const y=_[T];y.consumedBy===void 0&&u.add(y)}u.size!=0?(f=u.first(),u.delete(f)):f=null}pa.reset();const o=mx.factory(d.segments);return new gx(o).getGeom()}},Ju=new yx,ff=Ju,bx=0,df=class af{constructor(i,n,l,u){pi(this,"id"),pi(this,"leftSE"),pi(this,"rightSE"),pi(this,"rings"),pi(this,"windings"),pi(this,"ringOut"),pi(this,"consumedBy"),pi(this,"prev"),pi(this,"_prevInResult"),pi(this,"_beforeState"),pi(this,"_afterState"),pi(this,"_isInResult"),this.id=++bx,this.leftSE=i,i.segment=this,i.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=i,this.rings=l,this.windings=u}static compare(i,n){const l=i.leftSE.point.x,u=n.leftSE.point.x,d=i.rightSE.point.x,f=n.rightSE.point.x;if(f.isLessThan(l))return 1;if(d.isLessThan(u))return-1;const o=i.leftSE.point.y,_=n.leftSE.point.y,T=i.rightSE.point.y,S=n.rightSE.point.y;if(l.isLessThan(u)){if(_.isLessThan(o)&&_.isLessThan(T))return 1;if(_.isGreaterThan(o)&&_.isGreaterThan(T))return-1;const y=i.comparePoint(n.leftSE.point);if(y<0)return 1;if(y>0)return-1;const k=n.comparePoint(i.rightSE.point);return k!==0?k:-1}if(l.isGreaterThan(u)){if(o.isLessThan(_)&&o.isLessThan(S))return-1;if(o.isGreaterThan(_)&&o.isGreaterThan(S))return 1;const y=n.comparePoint(i.leftSE.point);if(y!==0)return y;const k=i.comparePoint(n.rightSE.point);return k<0?1:k>0?-1:1}if(o.isLessThan(_))return-1;if(o.isGreaterThan(_))return 1;if(d.isLessThan(f)){const y=n.comparePoint(i.rightSE.point);if(y!==0)return y}if(d.isGreaterThan(f)){const y=i.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(!d.eq(f)){const y=T.minus(o),k=d.minus(l),I=S.minus(_),C=f.minus(u);if(y.isGreaterThan(k)&&I.isLessThan(C))return 1;if(y.isLessThan(k)&&I.isGreaterThan(C))return-1}return d.isGreaterThan(f)?1:d.isLessThan(f)||T.isLessThan(S)?-1:T.isGreaterThan(S)?1:i.id<n.id?-1:i.id>n.id?1:0}static fromRing(i,n,l){let u,d,f;const o=Oo.comparePoints(i,n);if(o<0)u=i,d=n,f=1;else if(o>0)u=n,d=i,f=-1;else throw new Error(`Tried to create degenerate segment at [${i.x}, ${i.y}]`);const _=new Oo(u,!0),T=new Oo(d,!1);return new af(_,T,[l],[f])}replaceRightSE(i){this.rightSE=i,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const i=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:i.isLessThan(n)?i:n},ur:{x:this.rightSE.point.x,y:i.isGreaterThan(n)?i:n}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(i){return i.x.eq(this.leftSE.point.x)&&i.y.eq(this.leftSE.point.y)||i.x.eq(this.rightSE.point.x)&&i.y.eq(this.rightSE.point.y)}comparePoint(i){return pa.orient(this.leftSE.point,i,this.rightSE.point)}getIntersection(i){const n=this.bbox(),l=i.bbox(),u=Zd(n,l);if(u===null)return null;const d=this.leftSE.point,f=this.rightSE.point,o=i.leftSE.point,_=i.rightSE.point,T=Zu(n,o)&&this.comparePoint(o)===0,S=Zu(l,d)&&i.comparePoint(d)===0,y=Zu(n,_)&&this.comparePoint(_)===0,k=Zu(l,f)&&i.comparePoint(f)===0;if(S&&T)return k&&!y?f:!k&&y?_:null;if(S)return y&&d.x.eq(_.x)&&d.y.eq(_.y)?null:d;if(T)return k&&f.x.eq(o.x)&&f.y.eq(o.y)?null:o;if(k&&y)return null;if(k)return f;if(y)return _;const I=px(d,this.vector(),o,i.vector());return I===null||!Zu(u,I)?null:pa.snap(I)}split(i){const n=[],l=i.events!==void 0,u=new Oo(i,!0),d=new Oo(i,!1),f=this.rightSE;this.replaceRightSE(d),n.push(d),n.push(u);const o=new af(u,f,this.rings.slice(),this.windings.slice());return Oo.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),Oo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),l&&(u.checkForConsuming(),d.checkForConsuming()),n}swapEvents(){const i=this.rightSE;this.rightSE=this.leftSE,this.leftSE=i,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,l=this.windings.length;n<l;n++)this.windings[n]*=-1}consume(i){let n=this,l=i;for(;n.consumedBy;)n=n.consumedBy;for(;l.consumedBy;)l=l.consumedBy;const u=af.compare(n,l);if(u!==0){if(u>0){const d=n;n=l,l=d}if(n.prev===l){const d=n;n=l,l=d}for(let d=0,f=l.rings.length;d<f;d++){const o=l.rings[d],_=l.windings[d],T=n.rings.indexOf(o);T===-1?(n.rings.push(o),n.windings.push(_)):n.windings[T]+=_}l.rings=null,l.windings=null,l.consumedBy=n,l.leftSE.consumedBy=n.leftSE,l.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const i=this.prev.consumedBy||this.prev;this._beforeState=i.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const i=this.beforeState();this._afterState={rings:i.rings.slice(0),windings:i.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,l=this._afterState.windings,u=this._afterState.multiPolys;for(let o=0,_=this.rings.length;o<_;o++){const T=this.rings[o],S=this.windings[o],y=n.indexOf(T);y===-1?(n.push(T),l.push(S)):l[y]+=S}const d=[],f=[];for(let o=0,_=n.length;o<_;o++){if(l[o]===0)continue;const T=n[o],S=T.poly;if(f.indexOf(S)===-1)if(T.isExterior)d.push(S);else{f.indexOf(S)===-1&&f.push(S);const y=d.indexOf(T.poly);y!==-1&&d.splice(y,1)}}for(let o=0,_=d.length;o<_;o++){const T=d[o].multiPoly;u.indexOf(T)===-1&&u.push(T)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const i=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(ff.type){case"union":{const l=i.length===0,u=n.length===0;this._isInResult=l!==u;break}case"intersection":{let l,u;i.length<n.length?(l=i.length,u=n.length):(l=n.length,u=i.length),this._isInResult=u===ff.numMultiPolys&&l<u;break}case"xor":{const l=Math.abs(i.length-n.length);this._isInResult=l%2===1;break}case"difference":{const l=u=>u.length===1&&u[0].isSubject;this._isInResult=l(i)!==l(n);break}}return this._isInResult}},zg=class{constructor(s,i,n){if(pi(this,"poly"),pi(this,"isExterior"),pi(this,"segments"),pi(this,"bbox"),!Array.isArray(s)||s.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=n,this.segments=[],typeof s[0][0]!="number"||typeof s[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=pa.snap({x:new Do(s[0][0]),y:new Do(s[0][1])});this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,f=s.length;d<f;d++){if(typeof s[d][0]!="number"||typeof s[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const o=pa.snap({x:new Do(s[d][0]),y:new Do(s[d][1])});o.x.eq(u.x)&&o.y.eq(u.y)||(this.segments.push(df.fromRing(u,o,this)),o.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=o.x),o.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=o.y),o.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=o.x),o.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=o.y),u=o)}(!l.x.eq(u.x)||!l.y.eq(u.y))&&this.segments.push(df.fromRing(u,l,this))}getSweepEvents(){const s=[];for(let i=0,n=this.segments.length;i<n;i++){const l=this.segments[i];s.push(l.leftSE),s.push(l.rightSE)}return s}},vx=class{constructor(s,i){if(pi(this,"multiPoly"),pi(this,"exteriorRing"),pi(this,"interiorRings"),pi(this,"bbox"),!Array.isArray(s))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new zg(s[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,l=s.length;n<l;n++){const u=new zg(s[n],this,!1);u.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=i}getSweepEvents(){const s=this.exteriorRing.getSweepEvents();for(let i=0,n=this.interiorRings.length;i<n;i++){const l=this.interiorRings[i].getSweepEvents();for(let u=0,d=l.length;u<d;u++)s.push(l[u])}return s}},Og=class{constructor(s,i){if(pi(this,"isSubject"),pi(this,"polys"),pi(this,"bbox"),!Array.isArray(s))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof s[0][0][0]=="number"&&(s=[s])}catch{}this.polys=[],this.bbox={ll:{x:new Do(Number.POSITIVE_INFINITY),y:new Do(Number.POSITIVE_INFINITY)},ur:{x:new Do(Number.NEGATIVE_INFINITY),y:new Do(Number.NEGATIVE_INFINITY)}};for(let n=0,l=s.length;n<l;n++){const u=new vx(s[n],this);u.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=i}getSweepEvents(){const s=[];for(let i=0,n=this.polys.length;i<n;i++){const l=this.polys[i].getSweepEvents();for(let u=0,d=l.length;u<d;u++)s.push(l[u])}return s}},wx=(s,...i)=>ff.run("union",s,i),xx=(s,...i)=>ff.run("difference",s,i);pa.set;function B0(s,i,n){if(s!==null)for(var l,u,d,f,o,_,T,S=0,y=0,k,I=s.type,C=I==="FeatureCollection",L=I==="Feature",N=C?s.features.length:1,R=0;R<N;R++){T=C?s.features[R].geometry:L?s.geometry:s,k=T?T.type==="GeometryCollection":!1,o=k?T.geometries.length:1;for(var z=0;z<o;z++){var Z=0,ie=0;if(f=k?T.geometries[z]:T,f!==null){_=f.coordinates;var ae=f.type;switch(S=0,ae){case null:break;case"Point":if(i(_,y,R,Z,ie)===!1)return!1;y++,Z++;break;case"LineString":case"MultiPoint":for(l=0;l<_.length;l++){if(i(_[l],y,R,Z,ie)===!1)return!1;y++,ae==="MultiPoint"&&Z++}ae==="LineString"&&Z++;break;case"Polygon":case"MultiLineString":for(l=0;l<_.length;l++){for(u=0;u<_[l].length-S;u++){if(i(_[l][u],y,R,Z,ie)===!1)return!1;y++}ae==="MultiLineString"&&Z++,ae==="Polygon"&&ie++}ae==="Polygon"&&Z++;break;case"MultiPolygon":for(l=0;l<_.length;l++){for(ie=0,u=0;u<_[l].length;u++){for(d=0;d<_[l][u].length-S;d++){if(i(_[l][u][d],y,R,Z,ie)===!1)return!1;y++}ie++}Z++}break;case"GeometryCollection":for(l=0;l<f.geometries.length;l++)if(B0(f.geometries[l],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function mp(s,i){var n,l,u,d,f,o,_,T,S,y,k=0,I=s.type==="FeatureCollection",C=s.type==="Feature",L=I?s.features.length:1;for(n=0;n<L;n++){for(o=I?s.features[n].geometry:C?s.geometry:s,T=I?s.features[n].properties:C?s.properties:{},S=I?s.features[n].bbox:C?s.bbox:void 0,y=I?s.features[n].id:C?s.id:void 0,_=o?o.type==="GeometryCollection":!1,f=_?o.geometries.length:1,u=0;u<f;u++){if(d=_?o.geometries[u]:o,d===null){if(i(null,k,T,S,y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(d,k,T,S,y)===!1)return!1;break}case"GeometryCollection":{for(l=0;l<d.geometries.length;l++)if(i(d.geometries[l],k,T,S,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function Sx(s,i){mp(s,function(n,l,u,d,f){var o=n===null?null:n.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return i(lh(n,u,{bbox:d,id:f}),l,0)===!1?!1:void 0}var _;switch(o){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var T=0;T<n.coordinates.length;T++){var S=n.coordinates[T],y={type:_,coordinates:S};if(i(lh(y,u),l,T)===!1)return!1}})}function Tx(s,i={}){const n=[];if(mp(s,u=>{n.push(u.coordinates)}),n.length<2)throw new Error("Must have at least 2 geometries");const l=wx(n[0],...n.slice(1));return l.length===0?null:l.length===1?pp(l[0],i.properties):L0(l,i.properties)}var N0=Tx;function kx(s,i={}){if(s.bbox!=null&&i.recompute!==!0)return s.bbox;const n=[1/0,1/0,-1/0,-1/0];return B0(s,l=>{n[0]>l[0]&&(n[0]=l[0]),n[1]>l[1]&&(n[1]=l[1]),n[2]<l[0]&&(n[2]=l[0]),n[3]<l[1]&&(n[3]=l[1])}),n}var Dg=kx;function Cx(s){const i=[];if(mp(s,u=>{i.push(u.coordinates)}),i.length<2)throw new Error("Must have at least two features");const n=s.features[0].properties||{},l=xx(i[0],...i.slice(1));return l.length===0?null:l.length===1?pp(l[0],n):L0(l,n)}var Ex=Cx;function Ix(s){if(!s)throw new Error("geojson is required");var i=[];return Sx(s,function(n){i.push(n)}),ch(i)}var Ax=Ix;function Fg(s,i){const n=Ex(ch([pp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),s]));if(!n)return;n.properties={isMask:!0};const l=kg(Dg(s)),u=(l[2]-l[0])/360/1e3,d=l[0]<-180,f=l[2]>180,o=Ax(s);if(o.features.length>1&&(d||f))for(const _ of o.features){const T=kg(Dg(_));if(f&&T[0]<-180+u)for(const S of _.geometry.coordinates)for(const y of S)y[0]+=360-u;if(d&&T[2]>180-u)for(const S of _.geometry.coordinates)for(const y of S)y[0]-=360-u}i(ch([o.features.length<2?s:N0(o)??s,n]))}const Rg={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},$h="mtlr-gc-full-geom",Bg="mtlr-gc-full-geom-fill",Ng="mtlr-gc-full-geom-line";function Mx(s,i,n=!0,l=!0,u={},d={},f=Rg){let o;const _=[];let T,S,y;function k(){if(!s.loaded){s.once("load",k);return}const N=f?f===!0?Rg:f:void 0;if(!(N!=null&&N.fill)&&!(N!=null&&N.line))return;const R=s.getSource($h);if(R)R.setData(y??ch([]));else if(y)s.addSource($h,{type:"geojson",data:y});else return;!s.getLayer(Bg)&&N!=null&&N.fill&&s.addLayer({...N==null?void 0:N.fill,id:Bg,type:"fill",source:$h}),!s.getLayer(Ng)&&N!=null&&N.line&&s.addLayer({...N==null?void 0:N.line,id:Ng,type:"line",source:$h})}function I(N){y=N,k()}s.on("styledata",()=>{setTimeout(()=>{y&&k()})});const C=N=>{o==null||o({type:"mapClick",coordinates:[N.lngLat.lng,N.lngLat.lat]})};function L(N=!1){if(!i)throw new Error;const R=document.createElement("div");return N&&R.classList.add("marker-interactive"),new Yw({props:{displayIn:"maplibre"},target:R}),new i.Marker({element:R,offset:[1,-13]})}return{setEventHandler(N){N?(o=N,s.on("click",C)):(o=void 0,s.off("click",C))},flyTo(N,R){s.flyTo({center:N,...R?{zoom:R}:{},...u})},fitBounds(N,R,z){s.fitBounds([[N[0],N[1]],[N[2],N[3]]],{padding:R,...z?{maxZoom:z}:{},...d})},indicateReverse(N){s.getCanvasContainer().style.cursor=N?"crosshair":""},setReverseMarker(N){!i||!n||(S?N?S.setLngLat(N):(S.remove(),S=void 0):N&&(n instanceof Function?S=n(s)??void 0:(S=(typeof n=="object"?new i.Marker(n):L()).setLngLat(N).addTo(s),S.getElement().classList.add("marker-reverse"))))},setFeatures(N,R,z){for(const Z of _)Z.remove();if(_.length=0,I(void 0),!!i){e:if(R){let Z=!1;if(R.geometry.type==="GeometryCollection"){const ie=R.geometry.geometries.filter(ae=>ae.type==="Polygon"||ae.type==="MultiPolygon");t:if(ie.length>0){const ae=N0(ch(ie.map($=>lh($))));if(!ae)break t;Fg({...R,geometry:ae.geometry},I),Z=!0}else{const ae=R.geometry.geometries.filter($=>$.type==="LineString"||$.type==="MultiLineString");ae.length>0&&(I({...R,geometry:{type:"GeometryCollection",geometries:ae}}),Z=!0)}}if(!Z){if(R.geometry.type==="Polygon"||R.geometry.type==="MultiPolygon")Fg(R,I);else if(R.geometry.type==="LineString"||R.geometry.type==="MultiLineString"){I(R);break e}}if(!z&&!R.geometry.type.endsWith("Point"))break e;if(n instanceof Function){const ie=n(s,R);ie&&_.push(ie)}else n&&_.push(typeof n=="object"?new i.Marker(n):L().setLngLat(R.center).addTo(s))}if(l)for(const Z of N??[]){if(Z===R)continue;let ie;if(l instanceof Function){if(ie=l(s,Z),!ie)continue}else ie=(typeof l=="object"?new i.Marker(l):L(!0)).setLngLat(Z.center).setPopup(new i.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Z.place_type[0]==="reverse"?Z.place_name:Z.place_name.replace(/,.*/,""))).addTo(s);const ae=ie.getElement();ae.addEventListener("click",$=>{$.stopPropagation(),o==null||o({type:"markerClick",id:Z.id})}),ae.addEventListener("mouseenter",()=>{o==null||o({type:"markerMouseEnter",id:Z.id}),ie.togglePopup()}),ae.addEventListener("mouseleave",()=>{o==null||o({type:"markerMouseLeave",id:Z.id}),ie.togglePopup()}),_.push(ie)}}},setSelectedMarker(N){T&&T.getElement().classList.toggle("marker-selected",!1),T=N>-1?_[N]:void 0,T==null||T.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const N=s.getCenter();return[s.getZoom(),N.lng,N.lat]}}}function Px(s){let i,n;return{c(){i=fa("svg"),n=fa("path"),be(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),be(i,"viewBox","0 0 14 14"),be(i,"width","13"),be(i,"height","13"),be(i,"class","svelte-en2qvf")},m(l,u){xe(l,i,u),ve(i,n)},p:$t,i:$t,o:$t,d(l){l&&we(i)}}}class j0 extends di{constructor(i){super(),fi(this,i,null,Px,si,{})}}function Lx(s){let i,n;return{c(){i=fa("svg"),n=fa("path"),be(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),be(i,"viewBox","0 0 30 30"),be(i,"fill","none"),be(i,"xmlns","http://www.w3.org/2000/svg"),be(i,"class","svelte-d2loi5")},m(l,u){xe(l,i,u),ve(i,n)},p:$t,i:$t,o:$t,d(l){l&&we(i)}}}class U0 extends di{constructor(i){super(),fi(this,i,null,Lx,si,{})}}function zx(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[3]+"area.svg")||be(i,"src",n),be(i,"alt",s[7]),be(i,"title",s[7]),be(i,"class","svelte-w9y5n9")},m(l,u){xe(l,i,u)},p(l,u){u&8&&!Wn(i.src,n=l[3]+"area.svg")&&be(i,"src",n),u&128&&be(i,"alt",l[7]),u&128&&be(i,"title",l[7])},d(l){l&&we(i)}}}function Ox(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[3]+"reverse.svg")||be(i,"src",n),be(i,"alt",s[7]),be(i,"title",s[7]),be(i,"class","svelte-w9y5n9")},m(l,u){xe(l,i,u)},p(l,u){u&8&&!Wn(i.src,n=l[3]+"reverse.svg")&&be(i,"src",n),u&128&&be(i,"alt",l[7]),u&128&&be(i,"title",l[7])},d(l){l&&we(i)}}}function Dx(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[3]+"poi.svg")||be(i,"src",n),be(i,"alt",s[7]),be(i,"title",s[7]),be(i,"class","svelte-w9y5n9")},m(l,u){xe(l,i,u)},p(l,u){u&8&&!Wn(i.src,n=l[3]+"poi.svg")&&be(i,"src",n),u&128&&be(i,"alt",l[7]),u&128&&be(i,"title",l[7])},d(l){l&&we(i)}}}function Fx(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[3]+"postal_code.svg")||be(i,"src",n),be(i,"alt",s[7]),be(i,"title",s[7]),be(i,"class","svelte-w9y5n9")},m(l,u){xe(l,i,u)},p(l,u){u&8&&!Wn(i.src,n=l[3]+"postal_code.svg")&&be(i,"src",n),u&128&&be(i,"alt",l[7]),u&128&&be(i,"title",l[7])},d(l){l&&we(i)}}}function Rx(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[3]+"street.svg")||be(i,"src",n),be(i,"alt",s[7]),be(i,"title",s[7]),be(i,"class","svelte-w9y5n9")},m(l,u){xe(l,i,u)},p(l,u){u&8&&!Wn(i.src,n=l[3]+"street.svg")&&be(i,"src",n),u&128&&be(i,"alt",l[7]),u&128&&be(i,"title",l[7])},d(l){l&&we(i)}}}function Bx(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[3]+"road.svg")||be(i,"src",n),be(i,"alt",s[7]),be(i,"title",s[7]),be(i,"class","svelte-w9y5n9")},m(l,u){xe(l,i,u)},p(l,u){u&8&&!Wn(i.src,n=l[3]+"road.svg")&&be(i,"src",n),u&128&&be(i,"alt",l[7]),u&128&&be(i,"title",l[7])},d(l){l&&we(i)}}}function Nx(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[3]+"housenumber.svg")||be(i,"src",n),be(i,"alt",s[7]),be(i,"title",s[7]),be(i,"class","svelte-w9y5n9")},m(l,u){xe(l,i,u)},p(l,u){u&8&&!Wn(i.src,n=l[3]+"housenumber.svg")&&be(i,"src",n),u&128&&be(i,"alt",l[7]),u&128&&be(i,"title",l[7])},d(l){l&&we(i)}}}function jx(s){let i,n,l,u;return{c(){i=Ae("img"),Wn(i.src,n=s[5])||be(i,"src",n),be(i,"alt",s[4]),be(i,"title",s[7]),be(i,"class","svelte-w9y5n9")},m(d,f){xe(d,i,f),l||(u=Jt(i,"error",s[14]),l=!0)},p(d,f){f&32&&!Wn(i.src,n=d[5])&&be(i,"src",n),f&16&&be(i,"alt",d[4]),f&128&&be(i,"title",d[7])},d(d){d&&we(i),l=!1,u()}}}function Ux(s){let i,n;return{c(){i=Ae("div"),be(i,"class","sprite-icon svelte-w9y5n9"),be(i,"style",n=`
        width: ${s[6].width/js}px;
        height: ${s[6].height/js}px;
        background-image: url(${s[3]}sprite${Gd}.png);
        background-position: -${s[6].x/js}px -${s[6].y/js}px;
        background-size: ${uo.width/js}px ${uo.height/js}px;
      `),be(i,"title",s[7])},m(l,u){xe(l,i,u)},p(l,u){u&72&&n!==(n=`
        width: ${l[6].width/js}px;
        height: ${l[6].height/js}px;
        background-image: url(${l[3]}sprite${Gd}.png);
        background-position: -${l[6].x/js}px -${l[6].y/js}px;
        background-size: ${uo.width/js}px ${uo.height/js}px;
      `)&&be(i,"style",n),u&128&&be(i,"title",l[7])},d(l){l&&we(i)}}}function jg(s){let i,n;return{c(){i=Ae("span"),n=kt(s[7]),be(i,"class","secondary svelte-w9y5n9")},m(l,u){xe(l,i,u),ve(i,n)},p(l,u){u&128&&Li(n,l[7])},d(l){l&&we(i)}}}function Vx(s){let i,n,l,u,d,f,o,_,T,S=(s[8]?s[0].place_name:s[0].place_name.replace(/,.*/,""))+"",y,k,I=s[2]==="always"||s[2]!=="never"&&!s[0].address&&!s[0].id.startsWith("road.")&&!s[0].id.startsWith("address.")&&!s[0].id.startsWith("postal_code.")&&(!s[0].id.startsWith("poi.")||!s[5])&&!s[8],C,L,N=(s[8]?"":s[0].place_name.replace(/[^,]*,?\s*/,""))+"",R,z,Z,ie,ae,$;function re(B,W){return W&1&&(n=null),W&1&&(l=null),W&1&&(u=null),W&1&&(d=null),uo&&B[6]?Ux:B[5]?jx:B[0].address?Nx:(n==null&&(n=!!B[0].id.startsWith("road.")),n?Bx:(l==null&&(l=!!B[0].id.startsWith("address.")),l?Rx:(u==null&&(u=!!B[0].id.startsWith("postal_code.")),u?Fx:(d==null&&(d=!!B[0].id.startsWith("poi.")),d?Dx:B[8]?Ox:zx))))}let j=re(s,-1),U=j(s),J=I&&jg(s);return{c(){i=Ae("li"),U.c(),f=$e(),o=Ae("span"),_=Ae("span"),T=Ae("span"),y=kt(S),k=$e(),J&&J.c(),C=$e(),L=Ae("span"),R=kt(N),be(T,"class","primary svelte-w9y5n9"),be(_,"class","svelte-w9y5n9"),be(L,"class","line2 svelte-w9y5n9"),be(o,"class","texts svelte-w9y5n9"),be(i,"tabindex","-1"),be(i,"role","option"),be(i,"aria-selected",z=s[1]==="selected"),be(i,"aria-checked",Z=s[1]==="picked"),be(i,"class",ie=Zc(s[1])+" svelte-w9y5n9")},m(B,W){xe(B,i,W),U.m(i,null),ve(i,f),ve(i,o),ve(o,_),ve(_,T),ve(T,y),ve(_,k),J&&J.m(_,null),ve(o,C),ve(o,L),ve(L,R),ae||($=[Jt(i,"mouseenter",s[13]),Jt(i,"focus",s[15]),Jt(i,"click",s[16])],ae=!0)},p(B,[W]){j===(j=re(B,W))&&U?U.p(B,W):(U.d(1),U=j(B),U&&(U.c(),U.m(i,f))),W&257&&S!==(S=(B[8]?B[0].place_name:B[0].place_name.replace(/,.*/,""))+"")&&Li(y,S),W&293&&(I=B[2]==="always"||B[2]!=="never"&&!B[0].address&&!B[0].id.startsWith("road.")&&!B[0].id.startsWith("address.")&&!B[0].id.startsWith("postal_code.")&&(!B[0].id.startsWith("poi.")||!B[5])&&!B[8]),I?J?J.p(B,W):(J=jg(B),J.c(),J.m(_,null)):J&&(J.d(1),J=null),W&257&&N!==(N=(B[8]?"":B[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Li(R,N),W&2&&z!==(z=B[1]==="selected")&&be(i,"aria-selected",z),W&2&&Z!==(Z=B[1]==="picked")&&be(i,"aria-checked",Z),W&2&&ie!==(ie=Zc(B[1])+" svelte-w9y5n9")&&be(i,"class",ie)},i:$t,o:$t,d(B){B&&we(i),U.d(),J&&J.d(),ae=!1,Yn($)}}}const V0=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,Gd=V0?"@2x":"",js=V0?2:1;let uo,ef;function qx(s,i,n){let l,u,d,{feature:f}=i,{style:o="default"}=i,{showPlaceType:_}=i,{missingIconsCache:T}=i,{iconsBaseUrl:S}=i;const y=nl();let k,I,C,L;function N(){ef??(ef=fetch(`${S}sprite${Gd}.json`).then(j=>j.json()).then(j=>{uo=j}).catch(()=>{uo=null}))}function R(){I&&T.add(I),z()}function z(){uo!==void 0?Z():(N(),ef==null||ef.then(Z))}function Z(){do{if(L--,n(4,k=l==null?void 0:l[L]),n(6,C=k?uo==null?void 0:uo.icons[k]:void 0),C)break;n(5,I=k?S+k.replace(/ /g,"_")+".svg":void 0)}while(L>-1&&(!I||T.has(I)))}function ie(j){Di.call(this,s,j)}const ae=()=>R(),$=()=>y("select",void 0),re=j=>{document.activeElement!==j.target&&y("select",void 0)};return s.$$set=j=>{"feature"in j&&n(0,f=j.feature),"style"in j&&n(1,o=j.style),"showPlaceType"in j&&n(2,_=j.showPlaceType),"missingIconsCache"in j&&n(11,T=j.missingIconsCache),"iconsBaseUrl"in j&&n(3,S=j.iconsBaseUrl)},s.$$.update=()=>{var j,U,J,B,W;s.$$.dirty&1&&n(12,l=(j=f.properties)==null?void 0:j.categories),s.$$.dirty&1&&n(8,u=f.place_type[0]==="reverse"),s.$$.dirty&1&&n(7,d=((J=(U=f.properties)==null?void 0:U.categories)==null?void 0:J.join(", "))??((W=(B=f.properties)==null?void 0:B.place_type_name)==null?void 0:W[0])??f.place_type[0]),s.$$.dirty&4096&&(L=(l==null?void 0:l.length)??0,z())},[f,o,_,S,k,I,C,d,u,y,R,T,l,ie,ae,$,re]}class Zx extends di{constructor(i){super(),fi(this,i,qx,Vx,si,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function Wx(s){let i;return{c(){i=Ae("div"),i.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',be(i,"class","svelte-1ocfouu")},m(n,l){xe(n,i,l)},p:$t,i:$t,o:$t,d(n){n&&we(i)}}}class Gx extends di{constructor(i){super(),fi(this,i,null,Wx,si,{})}}function Hx(s){let i,n;return{c(){i=fa("svg"),n=fa("path"),be(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),be(i,"viewBox","0 0 60.006 21.412"),be(i,"width","14"),be(i,"height","20"),be(i,"class","svelte-en2qvf")},m(l,u){xe(l,i,u),ve(i,n)},p:$t,i:$t,o:$t,d(l){l&&we(i)}}}class Xx extends di{constructor(i){super(),fi(this,i,null,Hx,si,{})}}function Kx(s){let i,n,l;return{c(){i=fa("svg"),n=fa("circle"),l=fa("path"),be(n,"cx","4.789"),be(n,"cy","4.787"),be(n,"r","3.85"),be(n,"class","svelte-1aq105l"),be(l,"d","M12.063 12.063 7.635 7.635"),be(l,"class","svelte-1aq105l"),be(i,"xmlns","http://www.w3.org/2000/svg"),be(i,"width","13"),be(i,"height","13"),be(i,"viewBox","0 0 13 13"),be(i,"class","svelte-1aq105l")},m(u,d){xe(u,i,d),ve(i,n),ve(i,l)},p:$t,i:$t,o:$t,d(u){u&&we(i)}}}class Jx extends di{constructor(i){super(),fi(this,i,null,Kx,si,{})}}function Yx(s,i,n){const l=i[1],u=i[0],d=l-u;return s===l&&n?s:((s-u)%d+d)%d+u}function Ug(s){const i=[...s];return i[2]<i[0]&&(Math.abs((i[0]+i[2]+360)/2)>Math.abs((i[0]-360+i[2])/2)?i[0]-=360:i[2]+=360),i}let Wu;async function Qx(s,i,n){const l=s==null?void 0:s.getCenterAndZoom();for(const u of i??[])if(!(l&&(u.minZoom!=null&&u.minZoom>l[0]||u.maxZoom!=null&&u.maxZoom<l[0]))){if(u.type==="fixed")return u.coordinates.join(",");e:if(u.type==="client-geolocation"){if(Wu&&u.cachedLocationExpiry&&Wu.time+u.cachedLocationExpiry>Date.now()){if(!Wu.coords)break e;return Wu.coords}let d;try{return d=await new Promise((f,o)=>{n.signal.addEventListener("abort",()=>{o(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(T=>T.toFixed(6)).join(","))},_=>{o(_)},u)}),d}catch{}finally{u.cachedLocationExpiry&&(Wu={time:Date.now(),coords:d})}if(n.signal.aborted)return}if(u.type==="server-geolocation")return"ip";if(l&&u.type==="map-center")return l[1].toFixed(6)+","+l[2].toFixed(6)}}const $x=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Vg=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,qg=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,Zg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Wg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,Gg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function e2(s){if(!["DMS","DM","DD"].includes(s))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const i=this.decimalCoordinates.split(",").map(I=>Number(I.trim())),n=Number(i[0]),l=Number(i[1]),u=Math.abs(n),d=Math.abs(l),f=n>0?"N":"S",o=l>0?"E":"W";let _;s=="DD"&&(_=`${u} ${f}, ${d} ${o}`);const T=Math.floor(u),S=Math.floor(d),y=(u-T)*60,k=(d-S)*60;if(s=="DM"){let I=Hg(y,3).toFixed(3).padStart(6,"0"),C=Hg(k,3).toFixed(3).padStart(6,"0");I.endsWith(".000")&&C.endsWith(".000")&&(I=I.replace(/\.000$/,""),C=C.replace(/\.000$/,"")),_=`${T} ${I}' ${f}, ${S} ${C}' ${o}`}if(s=="DMS"){const I=Math.floor(y),C=Math.floor(k);let L=((y-I)*60).toFixed(1).padStart(4,"0"),N=((k-C)*60).toFixed(1).padStart(4,"0");const R=I.toString().padStart(2,"0"),z=C.toString().padStart(2,"0");L.endsWith(".0")&&N.endsWith(".0")&&(L=L.replace(/\.0$/,""),N=N.replace(/\.0$/,"")),_=`${T} ${R}' ${L}" ${f}, ${S} ${z}' ${N}" ${o}`}return _}else throw new Error("no decimal coordinates to convert")}function Hg(s,i){const n=Math.pow(10,i);return Math.round((s+Number.EPSILON)*n)/n}function gp(s,i){i||(i=5),s=s.replace(/\s+/g," ").trim();let n=null,l=null,u="",d="",f=null,o=[],_=!1;if($x.test(s))throw new Error("invalid coordinate value");if(Vg.test(s))if(o=Vg.exec(s),_=Gu(o),_)n=Math.abs(o[1])+o[2]/60,Number(o[1])<0&&(n*=-1),l=Math.abs(o[3])+o[4]/60,Number(o[3])<0&&(l*=-1),f="DM";else throw new Error("invalid coordinate format");else if(qg.test(s))if(o=qg.exec(s),_=Gu(o),_){if(n=o[2],l=o[6],n.includes(",")&&(n=n.replace(",",".")),l.includes(",")&&(l=l.replace(",",".")),f="DD",Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(l))==Number(l))throw new Error("integer only coordinate provided");o[1]?(u=o[1],d=o[5]):o[4]&&(u=o[4],d=o[8])}else throw new Error("invalid decimal coordinate format");else if(Zg.test(s))if(o=Zg.exec(s),_=Gu(o),_)n=Math.abs(parseInt(o[2])),o[4]&&(n+=o[4]/60,f="DM"),o[6]&&(n+=o[6].replace(",",".")/3600,f="DMS"),parseInt(o[2])<0&&(n=-1*n),l=Math.abs(parseInt(o[9])),o[11]&&(l+=o[11]/60),o[13]&&(l+=o[13].replace(",",".")/3600),parseInt(o[9])<0&&(l=-1*l),o[1]?(u=o[1],d=o[8]):o[7]&&(u=o[7],d=o[14]);else throw new Error("invalid DMS coordinates format");else if(Wg.test(s))if(o=Wg.exec(s),_=Gu(o),_)n=Math.abs(parseInt(o[2])),o[4]&&(n+=o[4]/60,f="DM"),o[6]&&(n+=o[6]/3600,f="DMS"),parseInt(o[2])<0&&(n=-1*n),l=Math.abs(parseInt(o[10])),o[12]&&(l+=o[12]/60),o[14]&&(l+=o[14]/3600),parseInt(o[10])<0&&(l=-1*l),o[1]?(u=o[1],d=o[9]):o[8]&&(u=o[8],d=o[16]);else throw new Error("invalid DMS coordinates format");else if(Gg.test(s)){if(o=Gg.exec(s),_=Gu(o),o.filter(T=>T).length<=5)throw new Error("invalid coordinates format");if(_)n=Math.abs(parseInt(o[2])),o[4]&&(n+=o[4].replace(",",".")/60,f="DM"),o[6]&&(n+=o[6].replace(",",".")/3600,f="DMS"),parseInt(o[2])<0&&(n=-1*n),l=Math.abs(parseInt(o[10])),o[12]&&(l+=o[12].replace(",",".")/60),o[14]&&(l+=o[14].replace(",",".")/3600),parseInt(o[10])<0&&(l=-1*l),o[1]?(u=o[1],d=o[9]):o[8]&&(u=o[8],d=o[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(l)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if(u&&!d||!u&&d)throw new Error("invalid coordinates value");if(u&&u==d)throw new Error("invalid coordinates format");n.toString().includes(",")&&(n=n.replace(",",".")),l.toString().includes(",")&&(l=l.replace(",","."));let T=/S|SOUTH/i;T.test(u)&&n>0&&(n=-1*n),T=/W|WEST/i,T.test(d)&&l>0&&(l=-1*l);const S=o[0].trim();let y,k;const I=/[,/;\u0020]/g,C=S.match(I);if(C==null){const R=Math.floor(s.length/2);y=S.substring(0,R).trim(),k=S.substring(R).trim()}else{let R;C.length%2==1?R=Math.floor(C.length/2):R=C.length/2-1;let z=0;if(R==0)z=S.indexOf(C[0]),y=S.substring(0,z).trim(),k=S.substring(z+1).trim();else{let Z=0,ie=0;for(;Z<=R;)z=S.indexOf(C[Z],ie),ie=z+1,Z++;y=S.substring(0,z).trim(),k=S.substring(z+1).trim()}}const L=y.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");const N=k.split(".");if(N.length==2&&N[1]==0&&N[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(k))throw new Error("degree only coordinate/s provided");return n=Number(Number(n).toFixed(i)),l=Number(Number(l).toFixed(i)),Object.freeze({verbatimCoordinates:S,verbatimLatitude:y,verbatimLongitude:k,decimalLatitude:n,decimalLongitude:l,decimalCoordinates:`${n},${l}`,originalFormat:f,closeEnough:t2,toCoordinateFormat:e2})}else throw new Error("coordinates pattern match failed")}function Gu(s){if(!isNaN(s[0]))return!1;const i=[...s];if(i.shift(),i.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,l=/[eastsouthnorthwest]+/i,u=i.length/2;for(let d=0;d<u;d++){const f=i[d],o=i[d+u],_=n.test(f)&&n.test(o),T=l.test(f)&&l.test(o),S=f==o;if(!(f==null&&o==null)){if(f==null||o==null)return!1;if(_||T||S)continue;return!1}}return!0}function Xg(s,i){const n=Math.abs(s-i);return Number(n.toFixed(6))<=1e-5}function t2(s){if(!s)throw new Error("coords must be provided");if(s.includes(",")){const i=s.split(",");if(Number(i[0])==NaN||Number(i[1])==NaN)throw new Error("coords are not valid decimals");return Xg(this.decimalLatitude,Number(i[0]))&&Xg(this.decimalLongitude,i[1])}else throw new Error("coords being tested must be separated by a comma")}const i2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});gp.to=i2;const n2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],r2={decimalLatitude:40.123,decimalLongitude:-74.123},s2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],o2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function a2(){const s=[];return n2.forEach(i=>{i.decimalLatitude?s.push(i):s.push({...i,...r2})}),[...s,...s2,...o2]}const l2=a2();gp.formats=l2.map(s=>s.verbatimCoordinates);const c2=gp;function Kg(s,i,n){const l=s.slice();return l[97]=i[n],l[99]=n,l}function Jg(s){let i,n,l,u,d;return n=new j0({}),{c(){i=Ae("button"),yt(n.$$.fragment),be(i,"type","button"),be(i,"title",s[3]),be(i,"class","svelte-bz0zu3")},m(f,o){xe(f,i,o),gt(n,i,null),l=!0,u||(d=Jt(i,"click",s[78]),u=!0)},p(f,o){(!l||o[0]&8)&&be(i,"title",f[3])},i(f){l||(Re(n.$$.fragment,f),l=!0)},o(f){Ve(n.$$.fragment,f),l=!1},d(f){f&&we(i),_t(n),u=!1,d()}}}function Yg(s){let i,n;return i=new Gx({}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function Qg(s){let i,n,l,u,d;return n=new Xx({}),{c(){i=Ae("button"),yt(n.$$.fragment),be(i,"type","button"),be(i,"title",s[10]),be(i,"class","svelte-bz0zu3"),Zs(i,"active",s[0])},m(f,o){xe(f,i,o),gt(n,i,null),l=!0,u||(d=Jt(i,"click",s[79]),u=!0)},p(f,o){(!l||o[0]&1024)&&be(i,"title",f[10]),(!l||o[0]&1)&&Zs(i,"active",f[0])},i(f){l||(Re(n.$$.fragment,f),l=!0)},o(f){Ve(n.$$.fragment,f),l=!1},d(f){f&&we(i),_t(n),u=!1,d()}}}function u2(s){let i,n=[],l=new Map,u,d,f,o=Ki(s[13]);const _=T=>T[97].id+(T[97].address?","+T[97].address:"");for(let T=0;T<o.length;T+=1){let S=Kg(s,o,T),y=_(S);l.set(y,n[T]=$g(y,S))}return{c(){i=Ae("ul");for(let T=0;T<n.length;T+=1)n[T].c();be(i,"class","options svelte-bz0zu3"),be(i,"role","listbox")},m(T,S){xe(T,i,S);for(let y=0;y<n.length;y+=1)n[y]&&n[y].m(i,null);u=!0,d||(f=[Jt(i,"mouseleave",s[27]),Jt(i,"blur",s[83]),Jt(i,"keydown",s[23])],d=!0)},p(T,S){S[0]&102823936&&(o=Ki(T[13]),ln(),n=u1(n,S,_,1,T,o,l,i,c1,$g,null,Kg),cn())},i(T){if(!u){for(let S=0;S<o.length;S+=1)Re(n[S]);u=!0}},o(T){for(let S=0;S<n.length;S+=1)Ve(n[S]);u=!1},d(T){T&&we(i);for(let S=0;S<n.length;S+=1)n[S].d();d=!1,Yn(f)}}}function h2(s){let i,n,l,u,d,f;return n=new U0({}),{c(){i=Ae("div"),yt(n.$$.fragment),l=$e(),u=Ae("div"),d=kt(s[8]),be(u,"class","svelte-bz0zu3"),be(i,"class","no-results svelte-bz0zu3")},m(o,_){xe(o,i,_),gt(n,i,null),ve(i,l),ve(i,u),ve(u,d),f=!0},p(o,_){(!f||_[0]&256)&&Li(d,o[8])},i(o){f||(Re(n.$$.fragment,o),f=!0)},o(o){Ve(n.$$.fragment,o),f=!1},d(o){o&&we(i),_t(n)}}}function f2(s){let i="",n;return{c(){n=kt(i)},m(l,u){xe(l,n,u)},p:$t,i:$t,o:$t,d(l){l&&we(n)}}}function d2(s){let i,n,l,u,d,f,o,_,T,S,y;return n=new U0({}),_=new j0({}),{c(){i=Ae("div"),yt(n.$$.fragment),l=$e(),u=Ae("div"),d=kt(s[7]),f=$e(),o=Ae("button"),yt(_.$$.fragment),be(u,"class","svelte-bz0zu3"),be(o,"class","svelte-bz0zu3"),be(i,"class","error svelte-bz0zu3")},m(k,I){xe(k,i,I),gt(n,i,null),ve(i,l),ve(i,u),ve(u,d),ve(i,f),ve(i,o),gt(_,o,null),T=!0,S||(y=Jt(o,"click",s[80]),S=!0)},p(k,I){(!T||I[0]&128)&&Li(d,k[7])},i(k){T||(Re(n.$$.fragment,k),Re(_.$$.fragment,k),T=!0)},o(k){Ve(n.$$.fragment,k),Ve(_.$$.fragment,k),T=!1},d(k){k&&we(i),_t(n),_t(_),S=!1,y()}}}function $g(s,i){var o;let n,l,u;function d(){return i[81](i[99])}function f(){return i[82](i[97])}return l=new Zx({props:{feature:i[97],showPlaceType:i[11],style:i[15]===i[99]?"selected":((o=i[14])==null?void 0:o.id)===i[97].id?"picked":"default",missingIconsCache:i[21],iconsBaseUrl:i[12]}}),l.$on("mouseenter",d),l.$on("select",f),{key:s,first:null,c(){n=Ln(),yt(l.$$.fragment),this.first=n},m(_,T){xe(_,n,T),gt(l,_,T),u=!0},p(_,T){var y;i=_;const S={};T[0]&8192&&(S.feature=i[97]),T[0]&2048&&(S.showPlaceType=i[11]),T[0]&57344&&(S.style=i[15]===i[99]?"selected":((y=i[14])==null?void 0:y.id)===i[97].id?"picked":"default"),T[0]&4096&&(S.iconsBaseUrl=i[12]),l.$set(S)},i(_){u||(Re(l.$$.fragment,_),u=!0)},o(_){Ve(l.$$.fragment,_),u=!1},d(_){_&&we(n),_t(l,_)}}}function p2(s){let i,n,l,u,d,f,o,_,T,S,y,k,I,C,L,N,R,z,Z,ie=!1;d=new Jx({});let ae=!s[20]&&Jg(s),$=s[20]&&Yg(),re=s[6]==="button"&&Qg(s);const j=s[70].default,U=vn(j,s,s[69],null),J=[d2,f2,h2,u2],B=[];function W(le,ge){var pe,_e;return le[19]?0:!le[16]&&!le[4]?1:((pe=le[13])==null?void 0:pe.length)===0?2:(_e=le[13])!=null&&_e.length&&(le[16]||le[4])?3:-1}return~(C=W(s))&&(L=B[C]=J[C](s)),{c(){i=$e(),n=Ae("form"),l=Ae("div"),u=Ae("button"),yt(d.$$.fragment),f=$e(),o=Ae("input"),_=$e(),T=Ae("div"),ae&&ae.c(),S=$e(),$&&$.c(),y=$e(),re&&re.c(),k=$e(),U&&U.c(),I=$e(),L&&L.c(),be(u,"class","search-button svelte-bz0zu3"),be(u,"type","button"),be(o,"placeholder",s[9]),be(o,"aria-label",s[9]),be(o,"class","svelte-bz0zu3"),be(T,"class","clear-button-container svelte-bz0zu3"),Zs(T,"displayable",s[1]!==""),be(l,"class","input-group svelte-bz0zu3"),be(n,"class",N=Zc(s[2])+" svelte-bz0zu3"),Zs(n,"can-collapse",s[5]&&s[1]==="")},m(le,ge){xe(le,i,ge),xe(le,n,ge),ve(n,l),ve(l,u),gt(d,u,null),ve(l,f),ve(l,o),s[72](o),Wr(o,s[1]),ve(l,_),ve(l,T),ae&&ae.m(T,null),ve(T,S),$&&$.m(T,null),ve(l,y),re&&re.m(l,null),ve(l,k),U&&U.m(l,null),ve(n,I),~C&&B[C].m(n,null),R=!0,z||(Z=[Jt(u,"click",s[71]),Jt(o,"input",s[73]),Jt(o,"focus",s[74]),Jt(o,"blur",s[75]),Jt(o,"click",s[76]),Jt(o,"keydown",s[23]),Jt(o,"input",s[24]),Jt(o,"change",s[77]),Jt(n,"submit",Wy(s[22]))],z=!0)},p(le,ge){(!R||ge[0]&512)&&be(o,"placeholder",le[9]),(!R||ge[0]&512)&&be(o,"aria-label",le[9]),ge[0]&2&&o.value!==le[1]&&Wr(o,le[1]),le[20]?ae&&(ln(),Ve(ae,1,1,()=>{ae=null}),cn()):ae?(ae.p(le,ge),ge[0]&1048576&&Re(ae,1)):(ae=Jg(le),ae.c(),Re(ae,1),ae.m(T,S)),le[20]?$?ge[0]&1048576&&Re($,1):($=Yg(),$.c(),Re($,1),$.m(T,null)):$&&(ln(),Ve($,1,1,()=>{$=null}),cn()),(!R||ge[0]&2)&&Zs(T,"displayable",le[1]!==""),le[6]==="button"?re?(re.p(le,ge),ge[0]&64&&Re(re,1)):(re=Qg(le),re.c(),Re(re,1),re.m(l,k)):re&&(ln(),Ve(re,1,1,()=>{re=null}),cn()),U&&U.p&&(!R||ge[2]&128)&&xn(U,j,le,le[69],R?wn(j,le[69],ge,null):Sn(le[69]),null);let pe=C;C=W(le),C===pe?~C&&B[C].p(le,ge):(L&&(ln(),Ve(B[pe],1,1,()=>{B[pe]=null}),cn()),~C?(L=B[C],L?L.p(le,ge):(L=B[C]=J[C](le),L.c()),Re(L,1),L.m(n,null)):L=null),(!R||ge[0]&4&&N!==(N=Zc(le[2])+" svelte-bz0zu3"))&&be(n,"class",N),(!R||ge[0]&38)&&Zs(n,"can-collapse",le[5]&&le[1]==="")},i(le){R||(Re(ie),Re(d.$$.fragment,le),Re(ae),Re($),Re(re),Re(U,le),Re(L),R=!0)},o(le){Ve(ie),Ve(d.$$.fragment,le),Ve(ae),Ve($),Ve(re),Ve(U,le),Ve(L),R=!1},d(le){le&&(we(i),we(n)),_t(d),s[72](null),ae&&ae.d(),$&&$.d(),re&&re.d(),U&&U.d(le),~C&&B[C].d(),z=!1,Yn(Z)}}}function m2(s,i,n){let l,u,d,{$$slots:f={},$$scope:o}=i;const _={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:T=void 0}=i,{apiKey:S=void 0}=i,{bbox:y=void 0}=i,{clearButtonTitle:k="clear"}=i,{clearOnBlur:I=!1}=i,{clearListOnPick:C=!1}=i,{keepListOpen:L=!1}=i,{collapsed:N=!1}=i,{country:R=void 0}=i,{debounceSearch:z=200}=i,{enableReverse:Z="never"}=i,{errorMessage:ie="Something went wrong"}=i,{filter:ae=()=>!0}=i,{flyTo:$=!0}=i,{fuzzyMatch:re=!0}=i,{language:j=void 0}=i,{limit:U=void 0}=i;const J=41415112612;let{reverseGeocodingLimit:B=J}=i,{mapController:W=void 0}=i,{minLength:le=2}=i,{noResultsMessage:ge="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=i,{placeholder:pe="Search"}=i,{proximity:_e=[{type:"server-geolocation"}]}=i,{reverseActive:ce=Z==="always"}=i,{reverseButtonTitle:Le="toggle reverse geocoding"}=i,{searchValue:ze=""}=i,{pickedResultStyle:ct="full-geometry"}=i,{showPlaceType:nt="if-needed"}=i,{showResultsWhileTyping:bt=!0}=i,{selectFirst:At=!0}=i,{flyToSelected:tt=!1}=i,{markerOnSelected:vt=!0}=i,{types:St=void 0}=i;const Zt=[];let{reverseGeocodingTypes:oi=Zt}=i,{exhaustiveReverseGeocoding:Ai=!1}=i,{excludeTypes:Mi=!1}=i;const Ti=void 0;let{reverseGeocodingExcludeTypes:It=Ti}=i,{zoom:Ge=_}=i,{apiUrl:Pt="https://api.maptiler.com/geocoding"}=i,{fetchParameters:ii={}}=i,{iconsBaseUrl:Je="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=i,{adjustUrlQuery:gi=()=>{}}=i,{adjustUrl:dt=()=>{}}=i;function et(He){lt.focus(He)}function he(){lt.blur()}function H(He,hi=!0,wi=!1){n(1,ze=He),hi?(n(15,Vt=-1),fr()):(Se(void 0,!wi,wi),setTimeout(()=>{lt.focus(),lt.select()}))}function Y(){n(13,qe=void 0),n(14,st=void 0),n(15,Vt=-1)}function Ee(){n(64,ut=[]),n(14,st=void 0)}let qe,ut,st,ki="",lt,Vt=-1,Ci,Fi=[],Cn,xt,li,ti,tn=!1;const hr=new Set,ai=nl();hs(()=>{W&&(W.setEventHandler(void 0),W.indicateReverse(!1),W.setSelectedMarker(-1),W.setFeatures(void 0,void 0,!1))});function fr(He){if(n(17,tn=!1),xt&&(clearTimeout(xt),xt=void 0),Vt>-1&&qe)n(14,st=qe[Vt]),n(1,ze=st.place_type[0]==="reverse"?st.place_name:st.place_name.replace(/,.*/,"")),n(19,Ci=void 0),n(64,ut=void 0),n(15,Vt=-1);else if(ze){const hi=He||!dr(ze);Sr(ze,{exact:!0}).then(()=>{n(64,ut=qe),n(14,st=void 0),hi&&Tr()}).catch(wi=>n(19,Ci=wi))}}function dr(He){try{return c2(He,6)}catch{return!1}}async function Sr(He,{byId:hi=!1,exact:wi=!1}={}){var Gi,Hi,jn;n(19,Ci=void 0),Cn==null||Cn.abort();const Bi=new AbortController;n(20,Cn=Bi);try{const ri=dr(He),Xr=new URL(Pt+"/"+encodeURIComponent(ri?ri.decimalLongitude+","+ri.decimalLatitude:He)+".json"),Gn=Xr.searchParams;j!==void 0&&Gn.set("language",Array.isArray(j)?j.join(","):j??"");const[Un]=(W==null?void 0:W.getCenterAndZoom())??[];let pn=(Gi=!ri||oi===Zt?St:oi)==null?void 0:Gi.map(Ei=>typeof Ei=="string"?Ei:Un===void 0||(Ei[0]??0)<=Un&&Un<(Ei[1]??1/0)?Ei[2]:void 0).filter(Ei=>Ei!==void 0);pn&&(pn=[...new Set(pn)],Gn.set("types",pn.join(",")));const ma=!ri||It===Ti?Mi:It;if(ma&&Gn.set("excludeTypes",String(ma)),y&&Gn.set("bbox",y.map(Ei=>Ei.toFixed(6)).join(",")),R&&Gn.set("country",Array.isArray(R)?R.join(","):R),!hi&&!ri){const Ei=await Qx(W,_e,Bi);Ei&&Gn.set("proximity",Ei),(wi||!bt)&&Gn.set("autocomplete","false"),Gn.set("fuzzyMatch",String(re))}const zn=B===J?U:B;zn!==void 0&&zn>1&&(pn==null?void 0:pn.length)!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),ri?(zn===1||zn!==void 0&&(Ai||(pn==null?void 0:pn.length)===1))&&Gn.set("limit",String(zn)):U!==void 0&&Gn.set("limit",String(U)),S&&Gn.set("key",S),gi(Gn),dt(Xr);const Hn=Xr.searchParams.get("types")===""&&Xr.searchParams.get("excludeTypes")!=="true",Dr=Xr.toString();if(Dr===ki){hi?(C&&n(13,qe=void 0),n(14,st=Fi[0])):(n(13,qe=Fi),((Hi=qe[Vt])==null?void 0:Hi.id)!==(u==null?void 0:u.id)&&n(15,Vt=-1));return}ki=Dr;let Rn;if(Hn)Rn={type:"FeatureCollection",features:[]};else{const Ei=await fetch(Dr,{signal:Bi.signal,...ii});if(!Ei.ok)throw new Error(await Ei.text());Rn=await Ei.json()}ai("response",{url:Dr,featureCollection:Rn}),hi?(C&&n(13,qe=void 0),n(14,st=Rn.features[0]),Fi=[st]):(n(13,qe=Rn.features.filter(ae)),ri&&qe.unshift({type:"Feature",properties:{},id:"reverse_"+ri.decimalLongitude+"_"+ri.decimalLatitude,text:ri.decimalLatitude+", "+ri.decimalLongitude,place_name:ri.decimalLatitude+", "+ri.decimalLongitude,place_type:["reverse"],center:[ri.decimalLongitude,ri.decimalLatitude],bbox:[ri.decimalLongitude,ri.decimalLatitude,ri.decimalLongitude,ri.decimalLatitude],geometry:{type:"Point",coordinates:[ri.decimalLongitude,ri.decimalLatitude]}}),Fi=qe,((jn=qe[Vt])==null?void 0:jn.id)!==(u==null?void 0:u.id)&&n(15,Vt=-1),ri&&lt.focus())}catch(ri){if(ri&&typeof ri=="object"&&"name"in ri&&ri.name==="AbortError")return;throw ri}finally{Bi===Cn&&n(20,Cn=void 0)}}function Tr(){var Bi;if(!(ut!=null&&ut.length)||!$)return;const He=[180,90,-180,-90],hi=!ut.some(Gi=>!Gi.matching_text);let wi;for(const Gi of ut){const Hi=ee(Gi);if(wi=wi===void 0?Hi:Hi===void 0?wi:Math.max(wi,Hi),hi||!Gi.matching_text)for(const jn of[0,1,2,3])He[jn]=Math[jn<2?"min":"max"](He[jn],((Bi=Gi.bbox)==null?void 0:Bi[jn])??Gi.center[jn%2])}W&&ut.length>0&&(st&&He[0]===He[2]&&He[1]===He[3]?W.flyTo(st.center,ee(st)):W.fitBounds(Ug(He),50,wi))}function Ie(){!st||!W||(!st.bbox||st.bbox[0]===st.bbox[2]&&st.bbox[1]===st.bbox[3]?W.flyTo(st.center,ee(st)):W.fitBounds(Ug(st.bbox),50,ee(st)))}function ee(He){var wi;if(!He.bbox||He.bbox[0]!==He.bbox[2]&&He.bbox[1]!==He.bbox[3])return;const hi=He.id.replace(/\..*/,"");return(Array.isArray((wi=He.properties)==null?void 0:wi.categories)?He.properties.categories.reduce((Bi,Gi)=>{const Hi=Ge[hi+"."+Gi];return Bi===void 0?Hi:Hi===void 0?Bi:Math.max(Bi,Hi)},void 0):void 0)??Ge[hi]}function te(He){n(0,ce=Z==="always"),n(13,qe=void 0),n(14,st=void 0),n(15,Vt=-1),H(He[1].toFixed(6)+", "+Yx(He[0],[-180,180],!0).toFixed(6),!1,!0)}function fe(He){if(!qe)return;let hi=He.key==="ArrowDown"?1:He.key==="ArrowUp"?-1:0;hi&&(lt.focus(),n(17,tn=!0),He.preventDefault(),st&&Vt===-1&&n(15,Vt=qe.findIndex(wi=>wi.id===(st==null?void 0:st.id))),Vt===(st||At?0:-1)&&hi===-1&&n(15,Vt=qe.length),n(15,Vt+=hi),Vt>=qe.length&&n(15,Vt=-1),Vt<0&&(st||At)&&n(15,Vt=0))}function Se(He,hi=!0,wi=!1){if(n(19,Ci=void 0),n(14,st=void 0),n(17,tn=!0),bt||wi){if(xt&&clearTimeout(xt),ze.length<le)return;const Bi=ze;xt=window.setTimeout(()=>{Sr(Bi).catch(Gi=>n(19,Ci=Gi))},hi?z:0)}else n(13,qe=void 0),n(19,Ci=void 0)}function je(He){st&&(st==null?void 0:st.id)===(He==null?void 0:He.id)?Ie():(n(14,st=He),n(1,ze=He.place_name))}function Ze(He){n(15,Vt=He)}function Ye(){(!At||st)&&n(15,Vt=-1),tt&&Ie()}const Fe=()=>lt.focus();function ot(He){Si[He?"unshift":"push"](()=>{lt=He,n(18,lt)})}function pt(){ze=this.value,n(1,ze),n(17,tn),n(31,I),n(16,li)}const rt=()=>n(17,tn=!0),Ct=()=>n(17,tn=!1),Xt=()=>n(17,tn=!0),ni=()=>n(14,st=void 0),Ri=()=>{n(1,ze=""),n(14,st=void 0),lt.focus()},bi=()=>n(0,ce=!ce),zi=()=>n(19,Ci=void 0),xi=He=>Ze(He),un=He=>je(He),hn=()=>{};return s.$$set=He=>{"class"in He&&n(2,T=He.class),"apiKey"in He&&n(29,S=He.apiKey),"bbox"in He&&n(30,y=He.bbox),"clearButtonTitle"in He&&n(3,k=He.clearButtonTitle),"clearOnBlur"in He&&n(31,I=He.clearOnBlur),"clearListOnPick"in He&&n(32,C=He.clearListOnPick),"keepListOpen"in He&&n(4,L=He.keepListOpen),"collapsed"in He&&n(5,N=He.collapsed),"country"in He&&n(33,R=He.country),"debounceSearch"in He&&n(34,z=He.debounceSearch),"enableReverse"in He&&n(6,Z=He.enableReverse),"errorMessage"in He&&n(7,ie=He.errorMessage),"filter"in He&&n(35,ae=He.filter),"flyTo"in He&&n(36,$=He.flyTo),"fuzzyMatch"in He&&n(37,re=He.fuzzyMatch),"language"in He&&n(38,j=He.language),"limit"in He&&n(39,U=He.limit),"reverseGeocodingLimit"in He&&n(40,B=He.reverseGeocodingLimit),"mapController"in He&&n(41,W=He.mapController),"minLength"in He&&n(42,le=He.minLength),"noResultsMessage"in He&&n(8,ge=He.noResultsMessage),"placeholder"in He&&n(9,pe=He.placeholder),"proximity"in He&&n(43,_e=He.proximity),"reverseActive"in He&&n(0,ce=He.reverseActive),"reverseButtonTitle"in He&&n(10,Le=He.reverseButtonTitle),"searchValue"in He&&n(1,ze=He.searchValue),"pickedResultStyle"in He&&n(44,ct=He.pickedResultStyle),"showPlaceType"in He&&n(11,nt=He.showPlaceType),"showResultsWhileTyping"in He&&n(45,bt=He.showResultsWhileTyping),"selectFirst"in He&&n(46,At=He.selectFirst),"flyToSelected"in He&&n(47,tt=He.flyToSelected),"markerOnSelected"in He&&n(48,vt=He.markerOnSelected),"types"in He&&n(49,St=He.types),"reverseGeocodingTypes"in He&&n(50,oi=He.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in He&&n(51,Ai=He.exhaustiveReverseGeocoding),"excludeTypes"in He&&n(52,Mi=He.excludeTypes),"reverseGeocodingExcludeTypes"in He&&n(53,It=He.reverseGeocodingExcludeTypes),"zoom"in He&&n(54,Ge=He.zoom),"apiUrl"in He&&n(55,Pt=He.apiUrl),"fetchParameters"in He&&n(56,ii=He.fetchParameters),"iconsBaseUrl"in He&&n(12,Je=He.iconsBaseUrl),"adjustUrlQuery"in He&&n(57,gi=He.adjustUrlQuery),"adjustUrl"in He&&n(58,dt=He.adjustUrl),"$$scope"in He&&n(69,o=He.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&64&&n(0,ce=Z==="always"),s.$$.dirty[0]&16384|s.$$.dirty[1]&8192&&ct!=="marker-only"&&st&&!st.address&&st.geometry.type==="Point"&&st.place_type[0]!=="reverse"&&Sr(st.id,{byId:!0}).catch(He=>n(19,Ci=He)),s.$$.dirty[0]&16384|s.$$.dirty[1]&1058|s.$$.dirty[2]&8&&(W&&st&&st.id!==ti&&$&&(Ie(),C&&n(13,qe=void 0),n(64,ut=void 0),n(15,Vt=-1)),n(65,ti=st==null?void 0:st.id)),s.$$.dirty[0]&196608|s.$$.dirty[1]&1&&setTimeout(()=>{n(16,li=tn),I&&!li&&n(1,ze="")}),s.$$.dirty[0]&8194|s.$$.dirty[1]&2048&&ze.length<le&&(n(13,qe=void 0),n(19,Ci=void 0),n(64,ut=qe)),s.$$.dirty[0]&57344|s.$$.dirty[1]&32768&&At&&qe!=null&&qe.length&&Vt==-1&&!st&&n(15,Vt=0),s.$$.dirty[0]&8192|s.$$.dirty[2]&4&&ut!==qe&&n(64,ut=void 0),s.$$.dirty[0]&73729|s.$$.dirty[1]&1024|s.$$.dirty[2]&4&&W&&W.setEventHandler(He=>{switch(He.type){case"mapClick":ce&&te(He.coordinates);break;case"markerClick":{const hi=qe==null?void 0:qe.find(wi=>wi.id===He.id);hi&&je(hi)}break;case"markerMouseEnter":ut&&n(15,Vt=li?(qe==null?void 0:qe.findIndex(hi=>hi.id===He.id))??-1:-1);break;case"markerMouseLeave":ut&&n(15,Vt=-1);break}}),s.$$.dirty[0]&40960&&n(66,u=qe==null?void 0:qe[Vt]),s.$$.dirty[1]&66592|s.$$.dirty[2]&16&&W&&u&&$&&tt&&W.flyTo(u.center,ee(u)),s.$$.dirty[1]&8192&&n(68,l=ct==="full-geometry-including-polygon-center-marker"),s.$$.dirty[1]&132096|s.$$.dirty[2]&64&&(vt||W==null||W.setFeatures(void 0,void 0,l)),s.$$.dirty[0]&16384|s.$$.dirty[1]&132096|s.$$.dirty[2]&84&&W&&vt&&!ut&&(W.setFeatures(u?[u]:void 0,st,l),W.setSelectedMarker(u?0:-1)),s.$$.dirty[0]&16384|s.$$.dirty[1]&1024|s.$$.dirty[2]&68&&W&&W.setFeatures(ut,st,l),s.$$.dirty[0]&32768|s.$$.dirty[1]&1024|s.$$.dirty[2]&4&&ut&&W&&W.setSelectedMarker(Vt),s.$$.dirty[0]&2|s.$$.dirty[1]&1024&&W){const He=dr(ze);W.setReverseMarker(He?[He.decimalLongitude,He.decimalLatitude]:void 0)}s.$$.dirty[2]&16&&ai("select",{feature:u}),s.$$.dirty[0]&16384&&ai("pick",{feature:st}),s.$$.dirty[0]&73744&&n(67,d=!!(qe!=null&&qe.length)&&(li||L)),s.$$.dirty[2]&32&&ai("optionsvisibilitychange",{optionsVisible:d}),s.$$.dirty[0]&8192&&ai("featureslisted",{features:qe}),s.$$.dirty[2]&4&&ai("featuresmarked",{features:ut}),s.$$.dirty[0]&1&&ai("reversetoggle",{reverse:ce}),s.$$.dirty[0]&2&&ai("querychange",{query:ze}),s.$$.dirty[0]&1|s.$$.dirty[1]&1024&&W&&W.indicateReverse(ce)},[ce,ze,T,k,L,N,Z,ie,ge,pe,Le,nt,Je,qe,st,Vt,li,tn,lt,Ci,Cn,hr,fr,fe,Se,je,Ze,Ye,_,S,y,I,C,R,z,ae,$,re,j,U,B,W,le,_e,ct,bt,At,tt,vt,St,oi,Ai,Mi,It,Ge,Pt,ii,gi,dt,et,he,H,Y,Ee,ut,ti,u,d,l,o,f,Fe,ot,pt,rt,Ct,Xt,ni,Ri,bi,zi,xi,un,hn]}class g2 extends di{constructor(i){super(),fi(this,i,m2,p2,si,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}}function e_(s){let i,n,l;return n=new g2({props:{mapController:s[2],apiKey:s[0],country:s[1],types:s[3],proximity:[{type:"map-center"}]}}),{c(){i=Ae("div"),yt(n.$$.fragment),be(i,"class","svelte-ixhnie")},m(u,d){xe(u,i,d),gt(n,i,null),l=!0},p(u,d){const f={};d&4&&(f.mapController=u[2]),d&1&&(f.apiKey=u[0]),d&2&&(f.country=u[1]),n.$set(f)},i(u){l||(Re(n.$$.fragment,u),l=!0)},o(u){Ve(n.$$.fragment,u),l=!1},d(u){u&&we(i),_t(n)}}}function _2(s){let i,n,l=s[2]&&e_(s);return{c(){l&&l.c(),i=Ln()},m(u,d){l&&l.m(u,d),xe(u,i,d),n=!0},p(u,[d]){u[2]?l?(l.p(u,d),d&4&&Re(l,1)):(l=e_(u),l.c(),Re(l,1),l.m(i.parentNode,i)):l&&(ln(),Ve(l,1,1,()=>{l=null}),cn())},i(u){n||(Re(l),n=!0)},o(u){Ve(l),n=!1},d(u){u&&we(i),l&&l.d(u)}}}function y2(s,i,n){let l,{apiKey:u}=i,{map:d}=i,{country:f}=i,o=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(T){return T?Mx(T,Ws,!0,!0,{duration:1e3},{duration:1e3}):null}return s.$$set=T=>{"apiKey"in T&&n(0,u=T.apiKey),"map"in T&&n(4,d=T.map),"country"in T&&n(1,f=T.country)},s.$$.update=()=>{s.$$.dirty&16&&n(2,l=_(d))},[u,f,l,o,d]}class b2 extends di{constructor(i){super(),fi(this,i,y2,_2,si,{apiKey:0,map:4,country:1})}}let v2=Date.now();function Qc(s){return`${s}-${v2++}`}const _p=Symbol.for("svelte-maplibre");function sl(){return Hy(_p)}function w2(s){let i=new WeakMap;return n=>{var f;let l=i.get(n.originalEvent);if(l!==void 0)return l;let d=(f=n.target.queryRenderedFeatures(n.point).find(o=>{var _;return(_=s.get(o.layer.id))==null?void 0:_.interactive}))==null?void 0:f.layer.id;return i.set(n.originalEvent,d),d}}function x2(){let s=new Map;return $d(_p,{map:kn(null),source:xd(null),layer:xd(null),popupTarget:xd(null),cluster:kn(),loadedImages:kn(new Set),minzoom:kn(0),maxzoom:kn(24),layerEvent:kn(null),layerInfo:s,eventTopMost:w2(s),markerClickManager:new C2})}function t_(s){return{subscribe:s.subscribe}}function q0({key:s,setPopupTarget:i=!1,setCluster:n=!1,setMouseEvent:l=!1}){let u=sl(),d=kn(null),f=t_(d),o={...u,[s]:t_(d)};if(i&&(o.popupTarget=f),l){let _=kn(null);o.layerEvent=_,u.layerEvent=_}return n&&(o.cluster=kn()),$d(_p,o),{...u,self:d}}function S2(){return q0({key:"source",setCluster:!0})}function T2(s=!0){return q0({key:"layer",setPopupTarget:s,setMouseEvent:s})}function k2(s){return"layerType"in s&&s.layerType==="deckgl"}class C2{constructor(){Zn(this,"_handlers",new Set)}add(i){this._handlers.add(i)}remove(i){this._handlers.delete(i)}handleClick(i){for(const n of this._handlers)n(i)}}function i_(s){let i;return n=>{if(n)for(let l in n){let u=i==null?void 0:i[l],d=n[l];u!==d&&s(l,d,u)}else if(i)for(let l in i)s(l,void 0,i[l]);i=n}}function E2(s,...i){let n=[s];for(let l of i)if(l)Array.isArray(l)&&l[0]===s?n.push(...l.slice(1)):n.push(l);else continue;if(n.length!==1)return n.length===2?n[1]:n}function I2(s){return s===!0?["has","point_count"]:s===!1?["!",["has","point_count"]]:void 0}function pf(s,i){return["case",["boolean",["feature-state","hover"],!1],i,s]}var Vl=A2;function A2(s){var i,n,l;if(s){if(Array.isArray(s)){for(i=[],n=s.length,l=0;l<n;l++){var u=s[l];u!=null&&i.push(u)}return i}if(typeof s=="object"){i={};var d=Object.keys(s);for(n=d.length,l=0;l<n;l++){var f=d[l],o=s[f];o!=null&&(i[f]=o)}return i}}}function n_(s){let i=s[0],n,l,u=r_(s);return{c(){u.c(),n=Ln()},m(d,f){u.m(d,f),xe(d,n,f),l=!0},p(d,f){f[0]&1&&si(i,i=d[0])?(ln(),Ve(u,1,1,$t),cn(),u=r_(d),u.c(),Re(u,1),u.m(n.parentNode,n)):u.p(d,f)},i(d){l||(Re(u),l=!0)},o(d){Ve(u),l=!1},d(d){d&&we(n),u.d(d)}}}function r_(s){let i;const n=s[36].default,l=vn(n,s,s[35],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d[1]&16)&&xn(l,n,u,u[35],i?wn(n,u[35],d,null):Sn(u[35]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function M2(s){let i,n,l=s[0]&&n_(s);return{c(){l&&l.c(),i=Ln()},m(u,d){l&&l.m(u,d),xe(u,i,d),n=!0},p(u,d){u[0]?l?(l.p(u,d),d[0]&1&&Re(l,1)):(l=n_(u),l.c(),Re(l,1),l.m(i.parentNode,i)):l&&(ln(),Ve(l,1,1,()=>{l=null}),cn())},i(u){n||(Re(l),n=!0)},o(u){Ve(l),n=!1},d(u){u&&we(i),l&&l.d(u)}}}function P2(s,i,n){let l,u,d,f,o,_,T,S,y,k,I,C,{$$slots:L={},$$scope:N}=i,{id:R=Qc("layer")}=i,{source:z=void 0}=i,{sourceLayer:Z=void 0}=i,{beforeId:ie=void 0}=i,{beforeLayerType:ae=void 0}=i,{type:$}=i,{paint:re=void 0}=i,{layout:j=void 0}=i,{filter:U=void 0}=i,{applyToClusters:J=void 0}=i,{minzoom:B=void 0}=i,{maxzoom:W=void 0}=i,{manageHoverState:le=!1}=i,{hovered:ge=null}=i,{interactive:pe=!0}=i,{hoverCursor:_e=void 0}=i,{eventsIfTopMost:ce=!1}=i;const Le=nl(),{map:ze,source:ct,self:nt,minzoom:bt,maxzoom:At,eventTopMost:tt,layerInfo:vt}=T2();Qt(s,ze,Ge=>n(31,y=Ge)),Qt(s,ct,Ge=>n(32,k=Ge)),Qt(s,nt,Ge=>n(0,S=Ge)),Qt(s,bt,Ge=>n(34,C=Ge)),Qt(s,At,Ge=>n(33,I=Ge)),hs(()=>{S&&y&&(vt.delete(S),y==null||y.removeLayer(S))});let St;function Zt(Ge){var gi,dt;if(!pe||!S||!y||ce&&tt(Ge)!==S)return;let Pt=Ge.features??[],ii=(dt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:dt.cluster_id,Je={event:Ge,map:y,clusterId:ii,layer:S,source:o,features:Pt};Le(Ge.type,Je)}function oi(Ge){var gi,dt;if(!pe||!S||!y||ce&&tt(Ge)!==S)return;_e&&(y.getCanvas().style.cursor=_e);let Pt=Ge.features??[];n(6,ge=Pt[0]??null);let ii=(dt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:dt.cluster_id;Le("mouseenter",{event:Ge,map:y,clusterId:ii,layer:S,source:o,features:Pt})}function Ai(Ge){var gi,dt,et;if(!pe||!y)return;if(ce&&tt(Ge)!==S){n(6,ge=null),le&&St!==void 0&&(y==null||y.setFeatureState({source:o,sourceLayer:Z,id:St},{hover:!1}),St=void 0);return}y.getCanvas().style.cursor=_e;let Pt=Ge.features??[],ii=(dt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:dt.cluster_id,Je=(et=Pt[0])==null?void 0:et.id;Je!==St&&(le&&(St!==void 0&&(y==null||y.setFeatureState({source:o,id:St,sourceLayer:Z},{hover:!1})),y==null||y.setFeatureState({source:o,id:Je,sourceLayer:Z},{hover:!0})),St=Je,n(6,ge=Pt[0]??null)),Le("mousemove",{event:Ge,map:y,clusterId:ii,layer:S,source:o,features:Pt})}function Mi(Ge){if(!(!pe||!S||!y)){if(_e&&(y.getCanvas().style.cursor=""),n(6,ge=null),le&&St!==void 0){const Pt={source:o,id:St,sourceLayer:Z};y==null||y.setFeatureState(Pt,{hover:!1}),St=void 0}Le("mouseleave",{map:y,layer:S,source:o})}}let Ti=!0;function It(Ge){y&&(y.off("click",Ge,Zt),y.off("dblclick",Ge,Zt),y.off("contextmenu",Ge,Zt),y.off("mouseenter",Ge,oi),y.off("mousemove",Ge,Ai),y.off("mouseleave",Ge,Mi))}return hs(()=>{y&&S&&It(S)}),s.$$set=Ge=>{"id"in Ge&&n(7,R=Ge.id),"source"in Ge&&n(8,z=Ge.source),"sourceLayer"in Ge&&n(9,Z=Ge.sourceLayer),"beforeId"in Ge&&n(10,ie=Ge.beforeId),"beforeLayerType"in Ge&&n(11,ae=Ge.beforeLayerType),"type"in Ge&&n(12,$=Ge.type),"paint"in Ge&&n(13,re=Ge.paint),"layout"in Ge&&n(14,j=Ge.layout),"filter"in Ge&&n(15,U=Ge.filter),"applyToClusters"in Ge&&n(16,J=Ge.applyToClusters),"minzoom"in Ge&&n(17,B=Ge.minzoom),"maxzoom"in Ge&&n(18,W=Ge.maxzoom),"manageHoverState"in Ge&&n(19,le=Ge.manageHoverState),"hovered"in Ge&&n(6,ge=Ge.hovered),"interactive"in Ge&&n(20,pe=Ge.interactive),"hoverCursor"in Ge&&n(21,_e=Ge.hoverCursor),"eventsIfTopMost"in Ge&&n(22,ce=Ge.eventsIfTopMost),"$$scope"in Ge&&n(35,N=Ge.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&65536&&n(30,l=I2(J)),s.$$.dirty[0]&1073774592&&n(24,u=E2("all",l,U)),s.$$.dirty[0]&131072|s.$$.dirty[1]&8&&n(26,d=B??C),s.$$.dirty[0]&262144|s.$$.dirty[1]&4&&n(25,f=W??I),s.$$.dirty[0]&256|s.$$.dirty[1]&2&&n(29,o=z||k),s.$$.dirty[0]&654343809|s.$$.dirty[1]&1&&y&&S!==R&&o){S&&(It(S),vt.delete(S));let Ge=ie;if(!ie&&ae){let Pt=y.getStyle().layers,ii=typeof ae=="function"?ae:gi=>gi.type===ae,Je=Pt==null?void 0:Pt.find(ii);Je&&(Ge=Je.id)}dn(nt,S=R,S),y.addLayer(Vl({id:S,type:$,source:o,"source-layer":Z,filter:u,paint:re,layout:j,minzoom:d,maxzoom:f}),Ge),n(23,Ti=!0),y.on("click",S,Zt),y.on("dblclick",S,Zt),y.on("contextmenu",S,Zt),y.on("mouseenter",S,oi),y.on("mousemove",S,Ai),y.on("mouseleave",S,Mi)}s.$$.dirty[0]&1048577&&S&&vt.set(S,{interactive:pe}),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&n(28,_=S?i_((Ge,Pt)=>{y!=null&&y.style._loaded?y.setPaintProperty(S,Ge,Pt):y==null||y.once("styledata",()=>y==null?void 0:y.setPaintProperty(S,Ge,Pt))}):void 0),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&n(27,T=S?i_((Ge,Pt)=>{y!=null&&y.style._loaded?y.setLayoutProperty(S,Ge,Pt):y==null||y.once("styledata",()=>y==null?void 0:y.setLayoutProperty(S,Ge,Pt))}):void 0),s.$$.dirty[0]&268443648&&(_==null||_(re)),s.$$.dirty[0]&134234112&&(T==null||T(j)),s.$$.dirty[0]&100663297|s.$$.dirty[1]&1&&S&&(y==null||y.setLayerZoomRange(S,d,f)),s.$$.dirty[0]&25165825|s.$$.dirty[1]&1&&S&&(Ti?n(23,Ti=!1):y==null||y.setFilter(S,u))},[S,ze,ct,nt,bt,At,ge,R,z,Z,ie,ae,$,re,j,U,J,B,W,le,pe,_e,ce,Ti,u,f,d,T,_,o,l,y,k,I,C,N,L]}let wf=class extends di{constructor(i){super(),fi(this,i,P2,M2,si,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function L2(s){let i;const n=s[16].default,l=vn(n,s,s[24],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&16777216)&&xn(l,n,u,u[24],i?wn(n,u[24],d,null):Sn(u[24]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function z2(s){let i,n,l;function u(f){s[17](f)}let d={id:s[1],type:"circle",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],applyToClusters:s[9],minzoom:s[10],maxzoom:s[11],hoverCursor:s[12],manageHoverState:s[13],eventsIfTopMost:s[14],interactive:s[15],$$slots:{default:[L2]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.hovered=s[0]),i=new wf({props:d}),Si.push(()=>Yi(i,"hovered",u)),i.$on("click",s[18]),i.$on("dblclick",s[19]),i.$on("contextmenu",s[20]),i.$on("mouseenter",s[21]),i.$on("mousemove",s[22]),i.$on("mouseleave",s[23]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.applyToClusters=f[9]),o&1024&&(_.minzoom=f[10]),o&2048&&(_.maxzoom=f[11]),o&4096&&(_.hoverCursor=f[12]),o&8192&&(_.manageHoverState=f[13]),o&16384&&(_.eventsIfTopMost=f[14]),o&32768&&(_.interactive=f[15]),o&16777216&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function O2(s,i,n){let{$$slots:l={},$$scope:u}=i,{id:d=Qc("circle")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:T=void 0}=i,{paint:S}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{applyToClusters:I=void 0}=i,{minzoom:C=void 0}=i,{maxzoom:L=void 0}=i,{hoverCursor:N=void 0}=i,{manageHoverState:R=!1}=i,{hovered:z=null}=i,{eventsIfTopMost:Z=!1}=i,{interactive:ie=!0}=i;function ae(W){z=W,n(0,z)}function $(W){Di.call(this,s,W)}function re(W){Di.call(this,s,W)}function j(W){Di.call(this,s,W)}function U(W){Di.call(this,s,W)}function J(W){Di.call(this,s,W)}function B(W){Di.call(this,s,W)}return s.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,f=W.source),"sourceLayer"in W&&n(3,o=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,T=W.beforeLayerType),"paint"in W&&n(6,S=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,k=W.filter),"applyToClusters"in W&&n(9,I=W.applyToClusters),"minzoom"in W&&n(10,C=W.minzoom),"maxzoom"in W&&n(11,L=W.maxzoom),"hoverCursor"in W&&n(12,N=W.hoverCursor),"manageHoverState"in W&&n(13,R=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,Z=W.eventsIfTopMost),"interactive"in W&&n(15,ie=W.interactive),"$$scope"in W&&n(24,u=W.$$scope)},[z,d,f,o,_,T,S,y,k,I,C,L,N,R,Z,ie,l,ae,$,re,j,U,J,B,u]}let $c=class extends di{constructor(i){super(),fi(this,i,O2,z2,si,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function D2(s){let i,n;const l=s[7].default,u=vn(l,s,s[6],null);return{c(){i=Ae("div"),u&&u.c(),be(i,"class",s[1]),Zs(i,"maplibregl-ctrl",s[0])},m(d,f){xe(d,i,f),u&&u.m(i,null),s[8](i),n=!0},p(d,[f]){u&&u.p&&(!n||f&64)&&xn(u,l,d,d[6],n?wn(l,d[6],f,null):Sn(d[6]),null),(!n||f&2)&&be(i,"class",d[1]),(!n||f&3)&&Zs(i,"maplibregl-ctrl",d[0])},i(d){n||(Re(u,d),n=!0)},o(d){Ve(u,d),n=!1},d(d){d&&we(i),u&&u.d(d),s[8](null)}}}function F2(s,i,n){let l,{$$slots:u={},$$scope:d}=i,{defaultStyling:f=!0}=i,{position:o="top-right"}=i,{class:_=void 0}=i;const{map:T}=sl();Qt(s,T,I=>n(5,l=I));let S,y={onAdd(){return S},onRemove(){var I;(I=S==null?void 0:S.parentNode)==null||I.removeChild(S)}};hs(()=>{l==null||l.removeControl(y)});function k(I){Si[I?"unshift":"push"](()=>{S=I,n(2,S)})}return s.$$set=I=>{"defaultStyling"in I&&n(0,f=I.defaultStyling),"position"in I&&n(4,o=I.position),"class"in I&&n(1,_=I.class),"$$scope"in I&&n(6,d=I.$$scope)},s.$$.update=()=>{s.$$.dirty&52&&l&&S&&l.addControl(y,o)},[f,_,S,T,o,l,d,u,k]}class R2 extends di{constructor(i){super(),fi(this,i,F2,D2,si,{defaultStyling:0,position:4,class:1})}}function B2(s){let i;const n=s[15].default,l=vn(n,s,s[23],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&8388608)&&xn(l,n,u,u[23],i?wn(n,u[23],d,null):Sn(u[23]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function N2(s){let i,n,l;function u(f){s[16](f)}let d={id:s[1],type:"fill",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[B2]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.hovered=s[0]),i=new wf({props:d}),Si.push(()=>Yi(i,"hovered",u)),i.$on("click",s[17]),i.$on("dblclick",s[18]),i.$on("contextmenu",s[19]),i.$on("mouseenter",s[20]),i.$on("mousemove",s[21]),i.$on("mouseleave",s[22]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.minzoom=f[9]),o&1024&&(_.maxzoom=f[10]),o&2048&&(_.hoverCursor=f[11]),o&4096&&(_.manageHoverState=f[12]),o&8192&&(_.eventsIfTopMost=f[13]),o&16384&&(_.interactive=f[14]),o&8388608&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function j2(s,i,n){let{$$slots:l={},$$scope:u}=i,{id:d=Qc("fill")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:T=void 0}=i,{paint:S}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{minzoom:I=void 0}=i,{maxzoom:C=void 0}=i,{hoverCursor:L=void 0}=i,{manageHoverState:N=!1}=i,{hovered:R=null}=i,{eventsIfTopMost:z=!1}=i,{interactive:Z=!0}=i;function ie(B){R=B,n(0,R)}function ae(B){Di.call(this,s,B)}function $(B){Di.call(this,s,B)}function re(B){Di.call(this,s,B)}function j(B){Di.call(this,s,B)}function U(B){Di.call(this,s,B)}function J(B){Di.call(this,s,B)}return s.$$set=B=>{"id"in B&&n(1,d=B.id),"source"in B&&n(2,f=B.source),"sourceLayer"in B&&n(3,o=B.sourceLayer),"beforeId"in B&&n(4,_=B.beforeId),"beforeLayerType"in B&&n(5,T=B.beforeLayerType),"paint"in B&&n(6,S=B.paint),"layout"in B&&n(7,y=B.layout),"filter"in B&&n(8,k=B.filter),"minzoom"in B&&n(9,I=B.minzoom),"maxzoom"in B&&n(10,C=B.maxzoom),"hoverCursor"in B&&n(11,L=B.hoverCursor),"manageHoverState"in B&&n(12,N=B.manageHoverState),"hovered"in B&&n(0,R=B.hovered),"eventsIfTopMost"in B&&n(13,z=B.eventsIfTopMost),"interactive"in B&&n(14,Z=B.interactive),"$$scope"in B&&n(23,u=B.$$scope)},[R,d,f,o,_,T,S,y,k,I,C,L,N,z,Z,l,ie,ae,$,re,j,U,J,u]}let U2=class extends di{constructor(i){super(),fi(this,i,j2,N2,si,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function V2(s,i,n){let l;const{map:u}=sl();Qt(s,u,_=>n(4,l=_));let{position:d="top-left"}=i,{container:f=void 0}=i,o=null;return hs(()=>{l!=null&&l.loaded()&&o&&l.removeControl(o)}),s.$$set=_=>{"position"in _&&n(1,d=_.position),"container"in _&&n(2,f=_.container)},s.$$.update=()=>{if(s.$$.dirty&30&&l&&!o){let _;typeof f=="string"?_=document.querySelector(f)??void 0:_=f,n(3,o=new Ws.FullscreenControl({container:_})),l.addControl(o,d)}},[u,d,f,o,l]}class q2 extends di{constructor(i){super(),fi(this,i,V2,null,si,{position:1,container:2})}}function Z2(s,i,n,l,u){let d=!1;s.getSource(i)&&(d=!0,s.removeSource(i));const f=()=>{l(i)&&(s.addSource(i,n),u())};if(d){const o=()=>{i&&(s.getSource(i)?setTimeout(o,1):f())};o()}else f()}function W2(s,i,n){Jy().then(()=>{let l=Vy(s);if(!l)return;l.getSource(i)===n&&l.removeSource(i)})}function s_(s){let i=s[0],n,l,u=o_(s);return{c(){u.c(),n=Ln()},m(d,f){u.m(d,f),xe(d,n,f),l=!0},p(d,f){f&1&&si(i,i=d[0])?(ln(),Ve(u,1,1,$t),cn(),u=o_(d),u.c(),Re(u,1),u.m(n.parentNode,n)):u.p(d,f)},i(d){l||(Re(u),l=!0)},o(d){Ve(u),l=!1},d(d){d&&we(n),u.d(d)}}}function o_(s){let i;const n=s[19].default,l=vn(n,s,s[18],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&262144)&&xn(l,n,u,u[18],i?wn(n,u[18],d,null):Sn(u[18]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function G2(s){let i,n,l=s[0]&&s_(s);return{c(){l&&l.c(),i=Ln()},m(u,d){l&&l.m(u,d),xe(u,i,d),n=!0},p(u,[d]){u[0]?l?(l.p(u,d),d&1&&Re(l,1)):(l=s_(u),l.c(),Re(l,1),l.m(i.parentNode,i)):l&&(ln(),Ve(l,1,1,()=>{l=null}),cn())},i(u){n||(Re(l),n=!0)},o(u){Ve(l),n=!1},d(u){u&&we(i),l&&l.d(u)}}}function H2(s,i,n){let l,u,d,{$$slots:f={},$$scope:o}=i,{id:_=Qc("geojson")}=i,{data:T}=i,{generateId:S=!1}=i,{promoteId:y=void 0}=i,{filter:k=void 0}=i,{lineMetrics:I=void 0}=i,{cluster:C=void 0}=i,{maxzoom:L=void 0}=i,{attribution:N=void 0}=i,{buffer:R=void 0}=i,{tolerance:z=void 0}=i;const{map:Z,cluster:ie,self:ae}=S2();Qt(s,Z,j=>n(17,u=j)),Qt(s,ie,j=>n(20,d=j)),Qt(s,ae,j=>n(0,l=j));let $,re=!0;return hs(()=>{l&&$&&u&&(W2(Z,l,$),dn(ae,l=null,l),n(15,$=void 0))}),s.$$set=j=>{"id"in j&&n(4,_=j.id),"data"in j&&n(5,T=j.data),"generateId"in j&&n(6,S=j.generateId),"promoteId"in j&&n(7,y=j.promoteId),"filter"in j&&n(8,k=j.filter),"lineMetrics"in j&&n(9,I=j.lineMetrics),"cluster"in j&&n(10,C=j.cluster),"maxzoom"in j&&n(11,L=j.maxzoom),"attribution"in j&&n(12,N=j.attribution),"buffer"in j&&n(13,R=j.buffer),"tolerance"in j&&n(14,z=j.tolerance),"$$scope"in j&&n(18,o=j.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&dn(ie,d=C,d),s.$$.dirty&196593&&u&&l!==_&&(dn(ae,l=_,l),Z2(u,l,Vl({type:"geojson",data:T,filter:k,lineMetrics:I,generateId:S,promoteId:y,cluster:!!C,clusterMinPoints:C==null?void 0:C.minPoints,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius,clusterProperties:C==null?void 0:C.properties,maxzoom:L,attribution:N,buffer:R,tolerance:z}),j=>u&&j===l,()=>{l&&(n(15,$=u==null?void 0:u.getSource(l)),n(16,re=!0))})),s.$$.dirty&131088&&(u==null||u.on("style.load",()=>{n(15,$=u==null?void 0:u.getSource(_))})),s.$$.dirty&98336&&$&&(re?n(16,re=!1):$.setData(T)),s.$$.dirty&33792&&($==null||$.setClusterOptions(Vl({cluster:!!C,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius})))},[l,Z,ie,ae,_,T,S,y,k,I,C,L,N,R,z,$,re,u,o,f]}let cs=class extends di{constructor(i){super(),fi(this,i,H2,G2,si,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function X2(s,i,n){let l;const{map:u}=sl();Qt(s,u,k=>n(8,l=k));let{position:d="top-left"}=i,{positionOptions:f=void 0}=i,{fitBoundsOptions:o=void 0}=i,{trackUserLocation:_=!1}=i,{showAccuracyCircle:T=!0}=i,{showUserLocation:S=!0}=i,{control:y=null}=i;return hs(()=>{l!=null&&l.loaded()&&y&&l.removeControl(y)}),s.$$set=k=>{"position"in k&&n(2,d=k.position),"positionOptions"in k&&n(3,f=k.positionOptions),"fitBoundsOptions"in k&&n(4,o=k.fitBoundsOptions),"trackUserLocation"in k&&n(5,_=k.trackUserLocation),"showAccuracyCircle"in k&&n(6,T=k.showAccuracyCircle),"showUserLocation"in k&&n(7,S=k.showUserLocation),"control"in k&&n(1,y=k.control)},s.$$.update=()=>{s.$$.dirty&510&&l&&!y&&(n(1,y=new Ws.GeolocateControl({positionOptions:f,fitBoundsOptions:o,trackUserLocation:_,showAccuracyCircle:T,showUserLocation:S})),l.addControl(y,d))},[u,y,d,f,o,_,T,S,l]}class K2 extends di{constructor(i){super(),fi(this,i,X2,null,si,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function J2(s){let i;const n=s[15].default,l=vn(n,s,s[23],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&8388608)&&xn(l,n,u,u[23],i?wn(n,u[23],d,null):Sn(u[23]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function Y2(s){let i,n,l;function u(f){s[16](f)}let d={id:s[1],type:"line",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[J2]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.hovered=s[0]),i=new wf({props:d}),Si.push(()=>Yi(i,"hovered",u)),i.$on("click",s[17]),i.$on("dblclick",s[18]),i.$on("contextmenu",s[19]),i.$on("mouseenter",s[20]),i.$on("mousemove",s[21]),i.$on("mouseleave",s[22]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.minzoom=f[9]),o&1024&&(_.maxzoom=f[10]),o&2048&&(_.hoverCursor=f[11]),o&4096&&(_.manageHoverState=f[12]),o&8192&&(_.eventsIfTopMost=f[13]),o&16384&&(_.interactive=f[14]),o&8388608&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function Q2(s,i,n){let{$$slots:l={},$$scope:u}=i,{id:d=Qc("line")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:T=void 0}=i,{paint:S}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{minzoom:I=void 0}=i,{maxzoom:C=void 0}=i,{hoverCursor:L=void 0}=i,{manageHoverState:N=!1}=i,{hovered:R=null}=i,{eventsIfTopMost:z=!1}=i,{interactive:Z=!0}=i;function ie(B){R=B,n(0,R)}function ae(B){Di.call(this,s,B)}function $(B){Di.call(this,s,B)}function re(B){Di.call(this,s,B)}function j(B){Di.call(this,s,B)}function U(B){Di.call(this,s,B)}function J(B){Di.call(this,s,B)}return s.$$set=B=>{"id"in B&&n(1,d=B.id),"source"in B&&n(2,f=B.source),"sourceLayer"in B&&n(3,o=B.sourceLayer),"beforeId"in B&&n(4,_=B.beforeId),"beforeLayerType"in B&&n(5,T=B.beforeLayerType),"paint"in B&&n(6,S=B.paint),"layout"in B&&n(7,y=B.layout),"filter"in B&&n(8,k=B.filter),"minzoom"in B&&n(9,I=B.minzoom),"maxzoom"in B&&n(10,C=B.maxzoom),"hoverCursor"in B&&n(11,L=B.hoverCursor),"manageHoverState"in B&&n(12,N=B.manageHoverState),"hovered"in B&&n(0,R=B.hovered),"eventsIfTopMost"in B&&n(13,z=B.eventsIfTopMost),"interactive"in B&&n(14,Z=B.interactive),"$$scope"in B&&n(23,u=B.$$scope)},[R,d,f,o,_,T,S,y,k,I,C,L,N,z,Z,l,ie,ae,$,re,j,U,J,u]}let il=class extends di{constructor(i){super(),fi(this,i,Q2,Y2,si,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function $2(s,i,n){let l;const u=nl();let{layer:d=void 0}=i;const{map:f}=sl();Qt(s,f,S=>n(2,l=S));function o(S){u(S.type,{...S,map:f})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],T=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return hs(()=>{if(l)if(d)for(const S of _)l.off(S,d,o);else for(const S of T)l.off(S,o)}),s.$$set=S=>{"layer"in S&&n(1,d=S.layer)},s.$$.update=()=>{if(s.$$.dirty&6&&l)if(d)for(const S of _)l.on(S,d,o);else for(const S of T)l.on(S,o)},[f,d,l]}class Z0 extends di{constructor(i){super(),fi(this,i,$2,null,si,{layer:1})}}function eS(s){let i=s.getCenter(),n=Math.round(s.getZoom()*100)/100,l=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,l),d=Math.round(i.lat*u)/u,f=Math.round(i.lng*u)/u,o=`${n}/${d}/${f}`,_=s.getBearing(),T=s.getPitch();return(_||T)&&(o+=`/${Math.round(_*10)/10}`),T&&(o+=`/${Math.round(T)}`),`#${o}`}function tS(s){return s.replace("#","").split("/").map(parseFloat)}var Oc=yp;function yp(s,i){return s===i||s!==s&&i!==i?!0:typeof s!=typeof i||{}.toString.call(s)!={}.toString.call(i)||s!==Object(s)||!s?!1:Array.isArray(s)?a_(s,i):{}.toString.call(s)=="[object Set]"?a_(Array.from(s),Array.from(i)):{}.toString.call(s)=="[object Object]"?nS(s,i):iS(s,i)}function iS(s,i){return s.toString()===i.toString()}function a_(s,i){var n=s.length;if(n!=i.length)return!1;for(var l=0;l<n;l++)if(!yp(s[l],i[l]))return!1;return!0}function nS(s,i){var n=Object.keys(s),l=n.length;if(l!=Object.keys(i).length)return!1;for(var u=0;u<l;u++){var d=n[u];if(!(i.hasOwnProperty(d)&&yp(s[d],i[d])))return!1}return!0}function rS(s,i,n){let l;const{map:u}=sl();Qt(s,u,S=>n(6,l=S));let{position:d="top-left"}=i,{showCompass:f=!0}=i,{showZoom:o=!0}=i,{visualizePitch:_=!1}=i,T=null;return hs(()=>{l!=null&&l.loaded()&&T&&l.removeControl(T)}),s.$$set=S=>{"position"in S&&n(1,d=S.position),"showCompass"in S&&n(2,f=S.showCompass),"showZoom"in S&&n(3,o=S.showZoom),"visualizePitch"in S&&n(4,_=S.visualizePitch)},s.$$.update=()=>{s.$$.dirty&126&&l&&!T&&(n(5,T=new Ws.NavigationControl({showCompass:f,showZoom:o,visualizePitch:_})),l.addControl(T,d))},[u,d,f,o,_,T,l]}class W0 extends di{constructor(i){super(),fi(this,i,rS,null,si,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function sS(s,i,n){let l;const{map:u}=sl();Qt(s,u,T=>n(5,l=T));let{position:d="bottom-left"}=i,{maxWidth:f=void 0}=i,{unit:o="metric"}=i,_=null;return hs(()=>{l!=null&&l.loaded()&&_&&l.removeControl(_)}),s.$$set=T=>{"position"in T&&n(1,d=T.position),"maxWidth"in T&&n(2,f=T.maxWidth),"unit"in T&&n(3,o=T.unit)},s.$$.update=()=>{s.$$.dirty&62&&l&&!_&&(n(4,_=new Ws.ScaleControl({maxWidth:f,unit:o})),l.addControl(_,d))},[u,d,f,o,_,l]}class G0 extends di{constructor(i){super(),fi(this,i,sS,null,si,{position:1,maxWidth:2,unit:3})}}const{window:oS}=Zy,aS=s=>({map:s[0]&16,loadedImages:s[0]&32,allImagesLoaded:s[0]&64}),l_=s=>({map:s[4],loadedImages:s[5],allImagesLoaded:s[6]});function c_(s){let i,n,l=s[3]&&u_(s);const u=s[46].default,d=vn(u,s,s[45],l_);return{c(){l&&l.c(),i=$e(),d&&d.c()},m(f,o){l&&l.m(f,o),xe(f,i,o),d&&d.m(f,o),n=!0},p(f,o){f[3]?l?(l.p(f,o),o[0]&8&&Re(l,1)):(l=u_(f),l.c(),Re(l,1),l.m(i.parentNode,i)):l&&(ln(),Ve(l,1,1,()=>{l=null}),cn()),d&&d.p&&(!n||o[0]&112|o[1]&16384)&&xn(d,u,f,f[45],n?wn(u,f[45],o,aS):Sn(f[45]),l_)},i(f){n||(Re(l),Re(d,f),n=!0)},o(f){Ve(l),Ve(d,f),n=!1},d(f){f&&we(i),l&&l.d(f),d&&d.d(f)}}}function u_(s){let i,n,l,u,d,f,o,_;return i=new W0({props:{position:s[7]}}),l=new K2({props:{position:s[7],fitBoundsOptions:{maxZoom:12}}}),d=new q2({props:{position:s[7]}}),o=new G0({props:{position:s[7]}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment),u=$e(),yt(d.$$.fragment),f=$e(),yt(o.$$.fragment)},m(T,S){gt(i,T,S),xe(T,n,S),gt(l,T,S),xe(T,u,S),gt(d,T,S),xe(T,f,S),gt(o,T,S),_=!0},p(T,S){const y={};S[0]&128&&(y.position=T[7]),i.$set(y);const k={};S[0]&128&&(k.position=T[7]),l.$set(k);const I={};S[0]&128&&(I.position=T[7]),d.$set(I);const C={};S[0]&128&&(C.position=T[7]),o.$set(C)},i(T){_||(Re(i.$$.fragment,T),Re(l.$$.fragment,T),Re(d.$$.fragment,T),Re(o.$$.fragment,T),_=!0)},o(T){Ve(i.$$.fragment,T),Ve(l.$$.fragment,T),Ve(d.$$.fragment,T),Ve(o.$$.fragment,T),_=!1},d(T){T&&(we(n),we(u),we(f)),_t(i,T),_t(l,T),_t(d,T),_t(o,T)}}}function lS(s){let i,n,l,u,d,f=s[4]&&s[0]&&c_(s);return{c(){i=Ae("div"),f&&f.c(),be(i,"class",n=Zc(s[2])+" svelte-p00lfq"),be(i,"data-testid","map-container"),Zs(i,"expand-map",!s[2])},m(o,_){xe(o,i,_),f&&f.m(i,null),s[47](i),l=!0,u||(d=[Jt(oS,"hashchange",s[11]),n1(s[10].call(null,i))],u=!0)},p(o,_){o[4]&&o[0]?f?(f.p(o,_),_[0]&17&&Re(f,1)):(f=c_(o),f.c(),Re(f,1),f.m(i,null)):f&&(ln(),Ve(f,1,1,()=>{f=null}),cn()),(!l||_[0]&4&&n!==(n=Zc(o[2])+" svelte-p00lfq"))&&be(i,"class",n),(!l||_[0]&4)&&Zs(i,"expand-map",!o[2])},i(o){l||(Re(f),l=!0)},o(o){Ve(f),l=!1},d(o){o&&we(i),f&&f.d(),s[47](null),u=!1,Yn(d)}}}function cS(s,i,n){let l,u,d,f,{$$slots:o={},$$scope:_}=i,{map:T=null}=i,{mapContainer:S=void 0}=i,{class:y=void 0}=i,{style:k}=i,{diffStyleUpdates:I=!1}=i,{center:C=void 0}=i,{zoom:L=void 0}=i,{pitch:N=0}=i,{bearing:R=0}=i,{bounds:z=void 0}=i,{hash:Z=!1}=i,{updateHash:ie=et=>{window.history.replaceState(window.history.state,"",et)}}=i,{loaded:ae=!1}=i,{minZoom:$=0}=i,{maxZoom:re=22}=i,{minPitch:j=0}=i,{maxPitch:U=60}=i,{renderWorldCopies:J=void 0}=i,{dragPan:B=void 0}=i,{dragRotate:W=void 0}=i,{pitchWithRotate:le=void 0}=i,{antialias:ge=void 0}=i,{zoomOnDoubleClick:pe=!0}=i,{locale:_e=void 0}=i,{interactive:ce=!0}=i,{attributionControl:Le=!0}=i,{cooperativeGestures:ze=!1}=i,{preserveDrawingBuffer:ct=!1}=i,{maxBounds:nt=void 0}=i,{images:bt=[]}=i,{standardControls:At=!1}=i,{filterLayers:tt=void 0}=i,{transformRequest:vt=void 0}=i;const St=nl(),{map:Zt,loadedImages:oi}=x2();Qt(s,Zt,et=>n(4,d=et)),Qt(s,oi,et=>n(5,f=et));let Ai=new Set;async function Mi(et,he=!1){if(d&&!(!d.loaded()&&!he))if("url"in et){Ai.add(et.id);try{let H=await d.loadImage(et.url);d==null||d.addImage(et.id,H.data,et.options),f.add(et.id),oi.set(f)}catch(H){St("error",H)}finally{Ai.delete(et.id)}}else d.addImage(et.id,et.data,et.options),f.add(et.id),oi.set(f)}let Ti,It,Ge,Pt;function ii(et){return gi(),dn(Zt,d=new Ws.Map(Vl({container:et,style:k,locale:_e,center:C,zoom:L,pitch:N,bearing:R,minZoom:$,maxZoom:re,minPitch:j,maxPitch:U,renderWorldCopies:J,dragPan:B,dragRotate:W,pitchWithRotate:le,antialias:ge,interactive:ce,preserveDrawingBuffer:ct,maxBounds:nt,bounds:z,attributionControl:Le,transformRequest:vt,cooperativeGestures:ze})),d),d.on("load",he=>{he.target.getContainer().setAttribute("data-testid","map"),he.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,ae=!0),St("load",d)}),d.on("error",he=>St("error",{...he,map:d})),d.on("movestart",he=>St("movestart",{...he,map:d})),d.on("moveend",he=>{if(n(12,C=he.target.getCenter()),n(13,L=he.target.getZoom()),n(14,N=he.target.getPitch()),n(15,R=he.target.getBearing()),n(16,z=he.target.getBounds()),St("moveend",{...he,map:d}),Z){let H=new URL(window.location.href.replace(/(#.+)?$/,eS(d)));ie(H)}}),d.on("click",he=>St("click",{...he,map:d})),d.on("dblclick",he=>St("dblclick",{...he,map:d})),d.on("contextmenu",he=>St("contextmenu",{...he,map:d})),d.on("zoomstart",he=>St("zoomstart",{...he,map:d})),d.on("zoom",he=>{St("zoom",{...he,map:d})}),d.on("zoomend",he=>{St("zoomend",{...he,map:d})}),d.on("style.load",()=>{if(d){const he=d.getStyle();if(n(42,Ti=he.layers.map(H=>H.id)),n(43,It=Object.keys(he.sources)),Pt)for(const[H,Y]of Object.entries(Pt))d.addSource(H,Y);if(Ge)for(const H of Ge)d.addLayer(H);for(const H of bt)Mi(H,!0)}}),d.on("styledata",he=>{if(d&&tt){const H=d.getStyle().layers;if(H)for(let Y of H)tt(Y)||d.setLayoutProperty(Y.id,"visibility","none")}St("styledata",{...he,map:d})}),{destroy(){n(0,ae=!1),d==null||d.remove(),dn(Zt,d=null,d)}}}let Je=k;function gi(){if(Z){let et=tS(window.location.hash);if(et.some(isNaN))return;et.length>=3&&(n(13,L=et[0]),n(12,C=[et[2],et[1]])),et.length==5&&(n(15,R=et[3]),n(14,N=et[4]))}}function dt(et){Si[et?"unshift":"push"](()=>{S=et,n(1,S)})}return s.$$set=et=>{"map"in et&&n(17,T=et.map),"mapContainer"in et&&n(1,S=et.mapContainer),"class"in et&&n(2,y=et.class),"style"in et&&n(18,k=et.style),"diffStyleUpdates"in et&&n(19,I=et.diffStyleUpdates),"center"in et&&n(12,C=et.center),"zoom"in et&&n(13,L=et.zoom),"pitch"in et&&n(14,N=et.pitch),"bearing"in et&&n(15,R=et.bearing),"bounds"in et&&n(16,z=et.bounds),"hash"in et&&n(20,Z=et.hash),"updateHash"in et&&n(21,ie=et.updateHash),"loaded"in et&&n(0,ae=et.loaded),"minZoom"in et&&n(22,$=et.minZoom),"maxZoom"in et&&n(23,re=et.maxZoom),"minPitch"in et&&n(24,j=et.minPitch),"maxPitch"in et&&n(25,U=et.maxPitch),"renderWorldCopies"in et&&n(26,J=et.renderWorldCopies),"dragPan"in et&&n(27,B=et.dragPan),"dragRotate"in et&&n(28,W=et.dragRotate),"pitchWithRotate"in et&&n(29,le=et.pitchWithRotate),"antialias"in et&&n(30,ge=et.antialias),"zoomOnDoubleClick"in et&&n(31,pe=et.zoomOnDoubleClick),"locale"in et&&n(32,_e=et.locale),"interactive"in et&&n(33,ce=et.interactive),"attributionControl"in et&&n(34,Le=et.attributionControl),"cooperativeGestures"in et&&n(35,ze=et.cooperativeGestures),"preserveDrawingBuffer"in et&&n(36,ct=et.preserveDrawingBuffer),"maxBounds"in et&&n(37,nt=et.maxBounds),"images"in et&&n(38,bt=et.images),"standardControls"in et&&n(3,At=et.standardControls),"filterLayers"in et&&n(39,tt=et.filterLayers),"transformRequest"in et&&n(40,vt=et.transformRequest),"$$scope"in et&&n(45,_=et.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&8&&n(7,l=typeof At=="boolean"?void 0:At),s.$$.dirty[0]&16&&n(17,T=d),s.$$.dirty[0]&786448|s.$$.dirty[1]&14336&&d&&!Oc(k,Je)){const et=d.getStyle();if(Ti&&(Ge=et.layers.filter(he=>!Ti.includes(he.id))),It){const he=Object.keys(et.sources).filter(H=>!It.includes(H));Pt={};for(const H of he)Pt[H]=et.sources[H]}n(44,Je=k),d.setStyle(k,{diff:I}),dn(oi,f=new Set,f),n(41,Ai=new Set)}if(s.$$.dirty[0]&49|s.$$.dirty[1]&1152&&ae&&d!=null&&d.loaded())for(let et of bt)!f.has(et.id)&&!Ai.has(et.id)&&!d.hasImage(et.id)&&Mi(et);if(s.$$.dirty[0]&32|s.$$.dirty[1]&128&&n(6,u=bt.every(et=>f.has(et.id))),s.$$.dirty[0]&61456&&d){let et={};C!=null&&!Oc(C,d==null?void 0:d.getCenter())&&(et.center=C),L!=null&&!Oc(L,d==null?void 0:d.getZoom())&&(et.zoom=L),R!=null&&!Oc(R,d==null?void 0:d.getBearing())&&(et.bearing=R),N!=null&&!Oc(N,d==null?void 0:d.getPitch())&&(et.pitch=N),Object.keys(et).length&&d.easeTo(et)}s.$$.dirty[0]&65552&&z&&!Oc(z,d==null?void 0:d.getBounds())&&(d==null||d.fitBounds(z)),s.$$.dirty[0]&16|s.$$.dirty[1]&1&&(pe?d==null||d.doubleClickZoom.enable():d==null||d.doubleClickZoom.disable())},[ae,S,y,At,d,f,u,l,Zt,oi,ii,gi,C,L,N,R,z,T,k,I,Z,ie,$,re,j,U,J,B,W,le,ge,pe,_e,ce,Le,ze,ct,nt,bt,tt,vt,Ai,Ti,It,Je,_,o,dt]}class uS extends di{constructor(i){super(),fi(this,i,cS,lS,si,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const hS=s=>({features:s[0]&16,data:s[0]&16,map:s[0]&4,close:s[0]&1}),h_=s=>{var i;return{features:s[4],data:((i=s[4])==null?void 0:i[0])??null,map:s[2],close:s[32]}};function f_(s){var u;let i,n,l=(((u=s[4])==null?void 0:u.length)||s[3]instanceof Ws.Marker)&&d_(s);return{c(){i=Ae("div"),l&&l.c()},m(d,f){xe(d,i,f),l&&l.m(i,null),s[33](i),n=!0},p(d,f){var o;(o=d[4])!=null&&o.length||d[3]instanceof Ws.Marker?l?(l.p(d,f),f[0]&24&&Re(l,1)):(l=d_(d),l.c(),Re(l,1),l.m(i,null)):l&&(ln(),Ve(l,1,1,()=>{l=null}),cn())},i(d){n||(Re(l),n=!0)},o(d){Ve(l),n=!1},d(d){d&&we(i),l&&l.d(),s[33](null)}}}function d_(s){let i;const n=s[31].default,l=vn(n,s,s[30],h_);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d[0]&1073741845)&&xn(l,n,u,u[30],i?wn(n,u[30],d,hS):Sn(u[30]),h_)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function fS(s){let i,n,l=s[9].default&&f_(s);return{c(){l&&l.c(),i=Ln()},m(u,d){l&&l.m(u,d),xe(u,i,d),n=!0},p(u,d){u[9].default?l?(l.p(u,d),d[0]&512&&Re(l,1)):(l=f_(u),l.c(),Re(l,1),l.m(i.parentNode,i)):l&&(ln(),Ve(l,1,1,()=>{l=null}),cn())},i(u){n||(Re(l),n=!0)},o(u){Ve(l),n=!1},d(u){u&&we(i),l&&l.d(u)}}}function dS(s,i,n){let l,u,d,f,o,_,{$$slots:T={},$$scope:S}=i;const y=i1(T);let{closeButton:k=void 0}=i,{closeOnClickOutside:I=!0}=i,{closeOnClickInside:C=!1}=i,{closeOnMove:L=!1}=i,{openOn:N="click"}=i,{openIfTopMost:R=!0}=i,{canOpen:z=void 0}=i,{focusAfterOpen:Z=!0}=i,{anchor:ie=void 0}=i,{offset:ae=void 0}=i,{popupClass:$=void 0}=i,{maxWidth:re=void 0}=i,{lngLat:j=void 0}=i,{html:U=void 0}=i,{open:J=!1}=i;const B=nl(),{map:W,popupTarget:le,layerEvent:ge,layer:pe,eventTopMost:_e,markerClickManager:ce}=sl();Qt(s,W,dt=>n(2,d=dt)),Qt(s,le,dt=>n(3,o=dt)),Qt(s,ge,dt=>n(29,f=dt)),Qt(s,pe,dt=>n(36,_=dt));const Le=["click","dblclick","contextmenu"];let ze,ct=!1,nt;function bt(){if(!ze)return;let dt=ze.getElement();!dt||dt===nt||(nt=dt,N==="hover"&&(nt.style.pointerEvents="none"),nt.addEventListener("mouseenter",()=>{n(25,ct=!0)},{passive:!0}),nt.addEventListener("mouseleave",()=>{n(25,ct=!1)},{passive:!0}),nt.addEventListener("click",()=>{C&&n(0,J=!1)},{passive:!0}))}Qd(()=>{if(d)return d.on("click",Ge),d.on("contextmenu",Ge),ce.add(Pt),typeof o=="string"&&(d.on("click",o,Zt),d.on("dblclick",o,Zt),d.on("contextmenu",o,Zt),d.on("mousemove",o,It),d.on("mouseleave",o,Ti),d.on("touchstart",o,Ai),d.on("touchend",o,Mi)),()=>{d!=null&&d.loaded()&&(ze==null||ze.remove(),d.off("click",Ge),d.off("contextmenu",Ge),ce.remove(Pt),o instanceof Ws.Marker?o.getPopup()===ze&&o.setPopup(void 0):typeof o=="string"&&(d.off("click",o,Zt),d.off("dblclick",o,Zt),d.off("contextmenu",o,Zt),d.off("mousemove",o,It),d.off("mouseleave",o,Ti),d.off("touchstart",o,Ai),d.off("touchend",o,Mi)))}});function At(dt){return R?!("marker"in dt)&&!k2(dt)&&_e(dt)!==_:!1}let tt=null,vt="normal";function St(dt){"layerType"in dt&&dt.layerType==="deckgl"?(n(10,j=dt.coordinate),n(4,tt=dt.object?[dt.object]:null)):(n(10,j=dt.lngLat),n(4,tt=dt.features??[]))}function Zt(dt){dt.type!==N||At(dt)||(St(dt),setTimeout(()=>n(0,J=!0)))}let oi=null;function Ai(dt){oi=dt.point}function Mi(dt){if(!oi||N!=="hover")return;let et=oi.dist(dt.point);oi=null,et<3&&(n(10,j=dt.lngLat),n(4,tt=dt.features??[]),ze.isOpen()?n(26,vt="justOpened"):(n(26,vt="opening"),n(0,J=!0)))}function Ti(dt){N!=="hover"||oi||vt!=="normal"||(n(0,J=!1),n(4,tt=null))}function It(dt){if(!(N!=="hover"||oi||vt!=="normal")){if(At(dt)){n(0,J=!1),n(4,tt=null);return}if(n(0,J=!0),n(4,tt=dt.features??[]),n(10,j=dt.lngLat),z&&!z(dt.features??[])){n(0,J=!1);return}}}function Ge(dt){if(vt==="justOpened"){n(26,vt="normal");return}if(!I)return;let et=[nt,o instanceof Ws.Marker?o==null?void 0:o.getElement():null];J&&ze.isOpen()&&!et.some(he=>he==null?void 0:he.contains(dt.originalEvent.target))&&(dt.type==="contextmenu"&&N==="contextmenu"||dt.type!=="contextmenu")&&n(0,J=!1)}function Pt(dt){I&&J&&ze.isOpen()&&dt.marker!==o&&n(0,J=!1)}hs(()=>{d&&(ze!=null&&ze.isOpen())&&ze.remove()});let ii;const Je=()=>n(0,J=!1);function gi(dt){Si[dt?"unshift":"push"](()=>{ii=dt,n(1,ii)})}return s.$$set=dt=>{"closeButton"in dt&&n(11,k=dt.closeButton),"closeOnClickOutside"in dt&&n(12,I=dt.closeOnClickOutside),"closeOnClickInside"in dt&&n(13,C=dt.closeOnClickInside),"closeOnMove"in dt&&n(14,L=dt.closeOnMove),"openOn"in dt&&n(15,N=dt.openOn),"openIfTopMost"in dt&&n(16,R=dt.openIfTopMost),"canOpen"in dt&&n(17,z=dt.canOpen),"focusAfterOpen"in dt&&n(18,Z=dt.focusAfterOpen),"anchor"in dt&&n(19,ie=dt.anchor),"offset"in dt&&n(20,ae=dt.offset),"popupClass"in dt&&n(21,$=dt.popupClass),"maxWidth"in dt&&n(22,re=dt.maxWidth),"lngLat"in dt&&n(10,j=dt.lngLat),"html"in dt&&n(23,U=dt.html),"open"in dt&&n(0,J=dt.open),"$$scope"in dt&&n(30,S=dt.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&14336&&n(28,l=k??(!I&&!C)),s.$$.dirty[0]&293355520&&(ze||(n(24,ze=new Ws.Popup({closeButton:l,closeOnClick:!1,closeOnMove:L,focusAfterOpen:Z,maxWidth:re,className:$,anchor:ie,offset:ae})),nt=ze.getElement(),ze.on("open",()=>{n(0,J=!0),bt(),B("open",ze)}),ze.on("close",()=>{n(0,J=!1),B("close",ze)}),ze.on("hover",()=>{B("hover",ze)}))),s.$$.dirty[0]&16809992&&ze&&o instanceof Ws.Marker&&(N==="click"?o.setPopup(ze):o.getPopup()===ze&&o.setPopup(void 0)),s.$$.dirty[0]&536903680&&Le.includes(N)&&(f==null?void 0:f.type)===N&&(Zt(f),dn(ge,f=null,f)),s.$$.dirty[0]&536903680&&n(27,u=N==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),s.$$.dirty[0]&704675840&&N==="hover"&&ge&&(u&&f&&St(f),n(0,J=(u||ct)??!1)),s.$$.dirty[0]&25165826&&(ii?ze.setDOMContent(ii):U&&ze.setHTML(U)),s.$$.dirty[0]&16778240&&j&&ze.setLngLat(j),s.$$.dirty[0]&83886085&&d){let dt=ze.isOpen();J&&!dt?(ze.addTo(d),vt==="opening"&&n(26,vt="justOpened")):!J&&dt&&ze.remove()}},[J,ii,d,o,tt,W,le,ge,pe,y,j,k,I,C,L,N,R,z,Z,ie,ae,$,re,U,ze,ct,vt,u,l,f,S,T,Je,gi]}class H0 extends di{constructor(i){super(),fi(this,i,dS,fS,si,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,canOpen:17,focusAfterOpen:18,anchor:19,offset:20,popupClass:21,maxWidth:22,lngLat:10,html:23,open:0},null,[-1,-1])}}var dh=Uint8Array,X0=Uint16Array,pS=Int32Array,mS=new dh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gS=new dh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),K0=function(s,i){for(var n=new X0(31),l=0;l<31;++l)n[l]=i+=1<<s[l-1];for(var u=new pS(n[30]),l=1;l<30;++l)for(var d=n[l];d<n[l+1];++d)u[d]=d-n[l]<<5|l;return{b:n,r:u}},J0=K0(mS,2),_S=J0.b,yS=J0.r;_S[28]=258,yS[258]=28;K0(gS,0);var bS=new X0(32768);for(sn=0;sn<32768;++sn)ha=(sn&43690)>>1|(sn&21845)<<1,ha=(ha&52428)>>2|(ha&13107)<<2,ha=(ha&61680)>>4|(ha&3855)<<4,bS[sn]=((ha&65280)>>8|(ha&255)<<8)>>1;var ha,sn,xf=new dh(288);for(sn=0;sn<144;++sn)xf[sn]=8;var sn;for(sn=144;sn<256;++sn)xf[sn]=9;var sn;for(sn=256;sn<280;++sn)xf[sn]=7;var sn;for(sn=280;sn<288;++sn)xf[sn]=8;var sn,vS=new dh(32);for(sn=0;sn<32;++sn)vS[sn]=5;var sn,wS=new dh(0),xS=typeof TextDecoder<"u"&&new TextDecoder,SS=0;try{xS.decode(wS,{stream:!0}),SS=1}catch{}function TS(s){let i;const n=s[16].default,l=vn(n,s,s[24],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&16777216)&&xn(l,n,u,u[24],i?wn(n,u[24],d,null):Sn(u[24]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function kS(s){let i,n,l;function u(f){s[17](f)}let d={id:s[1],type:"symbol",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],applyToClusters:s[9],minzoom:s[10],maxzoom:s[11],hoverCursor:s[12],manageHoverState:s[13],eventsIfTopMost:s[14],interactive:s[15],$$slots:{default:[TS]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.hovered=s[0]),i=new wf({props:d}),Si.push(()=>Yi(i,"hovered",u)),i.$on("click",s[18]),i.$on("dblclick",s[19]),i.$on("contextmenu",s[20]),i.$on("mouseenter",s[21]),i.$on("mousemove",s[22]),i.$on("mouseleave",s[23]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.applyToClusters=f[9]),o&1024&&(_.minzoom=f[10]),o&2048&&(_.maxzoom=f[11]),o&4096&&(_.hoverCursor=f[12]),o&8192&&(_.manageHoverState=f[13]),o&16384&&(_.eventsIfTopMost=f[14]),o&32768&&(_.interactive=f[15]),o&16777216&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function CS(s,i,n){let{$$slots:l={},$$scope:u}=i,{id:d=Qc("symbol")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:T=void 0}=i,{paint:S=void 0}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{applyToClusters:I=void 0}=i,{minzoom:C=void 0}=i,{maxzoom:L=void 0}=i,{hoverCursor:N=void 0}=i,{manageHoverState:R=!1}=i,{hovered:z=null}=i,{eventsIfTopMost:Z=!1}=i,{interactive:ie=!0}=i;function ae(W){z=W,n(0,z)}function $(W){Di.call(this,s,W)}function re(W){Di.call(this,s,W)}function j(W){Di.call(this,s,W)}function U(W){Di.call(this,s,W)}function J(W){Di.call(this,s,W)}function B(W){Di.call(this,s,W)}return s.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,f=W.source),"sourceLayer"in W&&n(3,o=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,T=W.beforeLayerType),"paint"in W&&n(6,S=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,k=W.filter),"applyToClusters"in W&&n(9,I=W.applyToClusters),"minzoom"in W&&n(10,C=W.minzoom),"maxzoom"in W&&n(11,L=W.maxzoom),"hoverCursor"in W&&n(12,N=W.hoverCursor),"manageHoverState"in W&&n(13,R=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,Z=W.eventsIfTopMost),"interactive"in W&&n(15,ie=W.interactive),"$$scope"in W&&n(24,u=W.$$scope)},[z,d,f,o,_,T,S,y,k,I,C,L,N,R,Z,ie,l,ae,$,re,j,U,J,B,u]}class bp extends di{constructor(i){super(),fi(this,i,CS,kS,si,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function ES(s){let i,n,l,u;return i=new W0({props:{showCompass:!1}}),l=new G0({}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(l,d,f),u=!0},p:$t,i(d){u||(Re(i.$$.fragment,d),Re(l.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(l.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(l,d)}}}function IS(s,i,n){let{map:l}=i;return s.$$set=u=>{"map"in u&&n(0,l=u.map)},s.$$.update=()=>{s.$$.dirty&1&&l&&(l.keyboard.disableRotation(),l.dragRotate.disable(),l.touchZoomRotate.disableRotation())},[l]}class AS extends di{constructor(i){super(),fi(this,i,IS,ES,si,{map:0})}}const Hd=["==",["geometry-type"],"LineString"],Y0=["==",["geometry-type"],"Point"];function mf(s,i,n){let l=["match",s];for(let[u,d]of Object.entries(i))l.push(u),l.push(d);return l.push(n),l}function qs(){return{type:"FeatureCollection",features:[]}}function MS(s){return Iw(s)}let Bc="MZEJTanw3WpxRvt7qDfo",p_=`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${Bc}`,PS={Blank:{version:8,sources:{},layers:[],glyphs:p_},"Maptiler Streets":`https://api.maptiler.com/maps/streets-v2/style.json?key=${Bc}`,"Maptiler Dataviz":`https://api.maptiler.com/maps/dataviz/style.json?key=${Bc}`,"Maptiler Hybrid":`https://api.maptiler.com/maps/hybrid/style.json?key=${Bc}`,"Maptiler OpenStreetMap":`https://api.maptiler.com/maps/openstreetmap/style.json?key=${Bc}`,"Maptiler OS Open Zoomstack":`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${Bc}`,"ESRI World Imagery":{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"ESRI &copy; <a href='http://www.esri.com' target='_blank'>ESRI</a>",minzoom:0,maxzoom:18}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:p_}},ph=kn(null),ur=kn(null),ho=kn(0),nh=kn(),Xd=kn({kind:"sidewalks"}),m_=kn(!1),gf=kn(!1),el=kn(JSON.parse(JSON.stringify(PS)));function LS(s){return s.reduce((i,n)=>i+n,0)}function uh(s){return s<1e3?Math.round(s)+" m":(s/1e3).toFixed(1)+" km"}async function Ro(){await new Promise(s=>{requestAnimationFrame(()=>{requestAnimationFrame(s)})})}function zS(s){let i,n,l,u,d;const f=s[6].default,o=vn(f,s,s[5],null);return{c(){i=Ae("dialog"),n=Ae("div"),o&&o.c(),be(n,"class","svelte-y9d9eu"),be(i,"closedby","none"),be(i,"class","svelte-y9d9eu")},m(_,T){xe(_,i,T),ve(i,n),o&&o.m(n,null),s[7](i),l=!0,u||(d=[Jt(i,"click",s[1]),Jt(i,"keydown",s[2])],u=!0)},p(_,[T]){o&&o.p&&(!l||T&32)&&xn(o,f,_,_[5],l?wn(f,_[5],T,null):Sn(_[5]),null)},i(_){l||(Re(o,_),l=!0)},o(_){Ve(o,_),l=!1},d(_){_&&we(i),o&&o.d(_),s[7](null),u=!1,Yn(d)}}}function OS(s,i,n){let{$$slots:l={},$$scope:u}=i,{show:d}=i,{closeable:f=!0}=i,o;function _(y){y.target==o&&(y.stopPropagation(),f&&n(3,d=!1))}function T(y){(y.key=="Escape"||y.key=="Enter")&&(y.stopPropagation(),f&&n(3,d=!1))}function S(y){Si[y?"unshift":"push"](()=>{o=y,n(0,o)})}return s.$$set=y=>{"show"in y&&n(3,d=y.show),"closeable"in y&&n(4,f=y.closeable),"$$scope"in y&&n(5,u=y.$$scope)},s.$$.update=()=>{s.$$.dirty&9&&o&&(d?o.showModal():o.close())},[o,_,T,d,f,u,l,S]}class g_ extends di{constructor(i){super(),fi(this,i,OS,zS,si,{show:3,closeable:4})}}function __(s){let i;return{c(){i=kt("You may be contacted later when this problem has been fixed.")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function DS(s){let i,n,l,u,d,f,o,_,T=s[5]&&s[8]&&__();return{c(){i=Ae("h2"),i.textContent="Report a problem",n=$e(),l=Ae("p"),u=kt(`Done, thank you for submitting.
    `),T&&T.c(),d=$e(),f=Ae("button"),f.textContent="OK",be(f,"class","btn btn-primary")},m(S,y){xe(S,i,y),xe(S,n,y),xe(S,l,y),ve(l,u),T&&T.m(l,null),xe(S,d,y),xe(S,f,y),o||(_=Jt(f,"click",s[12]),o=!0)},p(S,y){S[5]&&S[8]?T||(T=__(),T.c(),T.m(l,null)):T&&(T.d(1),T=null)},d(S){S&&(we(i),we(n),we(l),we(d),we(f)),T&&T.d(),o=!1,_()}}}function FS(s){let i;return{c(){i=kt("Include screenshot")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function y_(s){let i,n,l;function u(f){s[16](f)}let d={$$slots:{default:[RS]},$$scope:{ctx:s}};return s[5]!==void 0&&(d.checked=s[5]),i=new us({props:d}),Si.push(()=>Yi(i,"checked",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,o){const _={};o&2097408&&(_.$$scope={dirty:o,ctx:f}),!n&&o&32&&(n=!0,_.checked=f[5],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function RS(s){let i,n=s[8].name+"",l,u;return{c(){i=kt("Include your OSM username ("),l=kt(n),u=kt(`) in the report and be
      contacted when the problem is fixed`)},m(d,f){xe(d,i,f),xe(d,l,f),xe(d,u,f)},p(d,f){f&256&&n!==(n=d[8].name+"")&&Li(l,n)},d(d){d&&(we(i),we(l),we(u))}}}function b_(s){let i;function n(d,f){return d[1]?NS:BS}let l=n(s),u=l(s);return{c(){i=Ae("div"),u.c(),be(i,"class","img-container mb-3 svelte-1ym4gxw")},m(d,f){xe(d,i,f),u.m(i,null)},p(d,f){l===(l=n(d))&&u?u.p(d,f):(u.d(1),u=l(d),u&&(u.c(),u.m(i,null)))},d(d){d&&we(i),u.d()}}}function BS(s){let i;return{c(){i=Ae("p"),i.textContent="Loading screenshot... (sometimes you have to cancel and try again)"},m(n,l){xe(n,i,l)},p:$t,d(n){n&&we(i)}}}function NS(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[1])||be(i,"src",n),be(i,"alt","Screenshot"),be(i,"class","svelte-1ym4gxw")},m(l,u){xe(l,i,u)},p(l,u){u&2&&!Wn(i.src,n=l[1])&&be(i,"src",n)},d(l){l&&we(i)}}}function jS(s){let i,n,l,u,d;return{c(){i=Ae("button"),n=kt("Submit report"),be(i,"class","btn btn-primary me-3"),i.disabled=l=!s[7]},m(f,o){xe(f,i,o),ve(i,n),u||(d=Jt(i,"click",s[10]),u=!0)},p(f,o){o&128&&l!==(l=!f[7])&&(i.disabled=l)},d(f){f&&we(i),u=!1,d()}}}function US(s){let i;return{c(){i=Ae("button"),i.innerHTML=`<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
        Submit report`,be(i,"class","btn btn-primary me-3"),i.disabled=!0},m(n,l){xe(n,i,l)},p:$t,d(n){n&&we(i)}}}function VS(s){let i,n,l,u,d,f,o,_,T,S,y,k,I,C,L,N,R,z,Z,ie,ae,$,re;function j(pe){s[15](pe)}let U={$$slots:{default:[FS]},$$scope:{ctx:s}};s[6]!==void 0&&(U.checked=s[6]),I=new us({props:U}),Si.push(()=>Yi(I,"checked",j));let J=s[8]&&y_(s),B=s[6]&&b_(s);function W(pe,_e){return pe[3]?US:jS}let le=W(s),ge=le(s);return{c(){i=Ae("div"),n=Ae("h2"),n.textContent="Report a problem",l=$e(),u=Ae("button"),d=$e(),f=Ae("p"),f.textContent="You can report a problem with Speedwalk.",o=$e(),_=Ae("fieldset"),T=Ae("legend"),T.innerHTML=`Please describe the problem
      <br/>
      (if it&#39;s not obvious from the screenshot below)`,S=$e(),y=Ae("textarea"),k=$e(),yt(I.$$.fragment),L=$e(),J&&J.c(),N=$e(),B&&B.c(),R=$e(),z=Ae("div"),ge.c(),Z=$e(),ie=Ae("button"),ie.textContent="Cancel",be(u,"class","btn-close"),be(u,"aria-label","Close"),be(i,"class","d-flex justify-content-between"),be(y,"class","form-control"),be(y,"rows","4"),be(y,"placeholder","Details"),be(_,"class","mb-3"),be(ie,"class","btn btn-secondary"),be(z,"class","d-flex")},m(pe,_e){xe(pe,i,_e),ve(i,n),ve(i,l),ve(i,u),xe(pe,d,_e),xe(pe,f,_e),xe(pe,o,_e),xe(pe,_,_e),ve(_,T),ve(_,S),ve(_,y),Wr(y,s[0]),xe(pe,k,_e),gt(I,pe,_e),xe(pe,L,_e),J&&J.m(pe,_e),xe(pe,N,_e),B&&B.m(pe,_e),xe(pe,R,_e),xe(pe,z,_e),ge.m(z,null),ve(z,Z),ve(z,ie),ae=!0,$||(re=[Jt(u,"click",s[11]),Jt(y,"input",s[14]),Jt(ie,"click",s[11])],$=!0)},p(pe,_e){_e&1&&Wr(y,pe[0]);const ce={};_e&2097152&&(ce.$$scope={dirty:_e,ctx:pe}),!C&&_e&64&&(C=!0,ce.checked=pe[6],Ji(()=>C=!1)),I.$set(ce),pe[8]?J?(J.p(pe,_e),_e&256&&Re(J,1)):(J=y_(pe),J.c(),Re(J,1),J.m(N.parentNode,N)):J&&(ln(),Ve(J,1,1,()=>{J=null}),cn()),pe[6]?B?B.p(pe,_e):(B=b_(pe),B.c(),B.m(R.parentNode,R)):B&&(B.d(1),B=null),le===(le=W(pe))&&ge?ge.p(pe,_e):(ge.d(1),ge=le(pe),ge&&(ge.c(),ge.m(z,Z)))},i(pe){ae||(Re(I.$$.fragment,pe),Re(J),ae=!0)},o(pe){Ve(I.$$.fragment,pe),Ve(J),ae=!1},d(pe){pe&&(we(i),we(d),we(f),we(o),we(_),we(k),we(L),we(N),we(R),we(z)),_t(I,pe),J&&J.d(pe),B&&B.d(pe),ge.d(),$=!1,Yn(re)}}}function qS(s){let i,n,l,u,d,f,o,_,T,S,y,k,I;function C(z){s[13](z)}let L={$$slots:{default:[DS]},$$scope:{ctx:s}};s[4]!==void 0&&(L.show=s[4]),i=new g_({props:L}),Si.push(()=>Yi(i,"show",C));function N(z){s[17](z)}let R={closeable:!1,$$slots:{default:[VS]},$$scope:{ctx:s}};return s[2]!==void 0&&(R.show=s[2]),u=new g_({props:R}),Si.push(()=>Yi(u,"show",N)),{c(){yt(i.$$.fragment),l=$e(),yt(u.$$.fragment),f=$e(),o=Ae("div"),_=Ae("button"),T=Ae("i"),S=kt(`
    Report problem`),be(T,"class","fa-solid fa-triangle-exclamation"),be(_,"class","btn btn-secondary"),_.disabled=s[2],be(o,"class","launcher svelte-1ym4gxw")},m(z,Z){gt(i,z,Z),xe(z,l,Z),gt(u,z,Z),xe(z,f,Z),xe(z,o,Z),ve(o,_),ve(_,T),ve(_,S),y=!0,k||(I=Jt(_,"click",s[9]),k=!0)},p(z,[Z]){const ie={};Z&2097456&&(ie.$$scope={dirty:Z,ctx:z}),!n&&Z&16&&(n=!0,ie.show=z[4],Ji(()=>n=!1)),i.$set(ie);const ae={};Z&2097643&&(ae.$$scope={dirty:Z,ctx:z}),!d&&Z&4&&(d=!0,ae.show=z[2],Ji(()=>d=!1)),u.$set(ae),(!y||Z&4)&&(_.disabled=z[2])},i(z){y||(Re(i.$$.fragment,z),Re(u.$$.fragment,z),y=!0)},o(z){Ve(i.$$.fragment,z),Ve(u.$$.fragment,z),y=!1},d(z){z&&(we(l),we(f),we(o)),_t(i,z),_t(u,z),k=!1,I()}}}function ZS(s){return new Promise((i,n)=>{s.redraw(),s.once("idle",()=>{s.getCanvas().toBlob(l=>{l?i(l):n("no blob")})})})}function WS(s){return new Promise((i,n)=>{let l=new FileReader;l.readAsDataURL(s),l.onloadend=function(){l.result?i(l.result):n("base64 failed")}})}function GS(s){let i=s.getCenter(),n=Math.round(s.getZoom()*100)/100,l=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,l),d=Math.round(i.lat*u)/u,f=Math.round(i.lng*u)/u,o=`${n}/${d}/${f}`,_=s.getBearing(),T=s.getPitch();return(_||T)&&(o+=`/${Math.round(_*10)/10}`),T&&(o+=`/${Math.round(T)}`),`#${o}`}function HS(s,i,n){let l,u,d;Qt(s,nh,j=>n(8,u=j)),Qt(s,ph,j=>n(20,d=j));let f=!1,o=!1,_=!1,T="",S={},y=!1,k=!0,I,C;async function L(){n(2,f=!0),S={url:window.location.toString(),viewport:GS(d)},I=await ZS(d),n(1,C=URL.createObjectURL(I))}async function N(){let j=null;y&&u&&(j=u.name);let U=null;k&&I&&(U=await WS(I));let J={...S,details:T,screenshot:U,username:j};try{n(3,o=!0);let B=await fetch("https://walknet.abstreet.uk/problems/speedwalk_problems",{method:"POST",body:JSON.stringify(J),headers:{"Content-Type":"application/json"}});if(!B.ok)throw new Error(`Bad response: ${B.status}`)}catch(B){window.alert(`Failed to report a problem: ${B}`),n(3,o=!1);return}n(3,o=!1),R(),n(4,_=!0)}function R(){n(2,f=!1),n(0,T=""),S={},I=void 0,C&&(URL.revokeObjectURL(C),n(1,C=void 0))}const z=()=>n(4,_=!1);function Z(j){_=j,n(4,_)}function ie(){T=this.value,n(0,T)}function ae(j){k=j,n(6,k)}function $(j){y=j,n(5,y)}function re(j){f=j,n(2,f)}return s.$$.update=()=>{s.$$.dirty&3&&n(7,l=T||C)},[T,C,f,o,_,y,k,l,u,L,N,R,z,Z,ie,ae,$,re]}class XS extends di{constructor(i){super(),fi(this,i,HS,qS,si,{})}}function jc(s){if(!s)throw new Error("coord is required");if(!Array.isArray(s)){if(s.type==="Feature"&&s.geometry!==null&&s.geometry.type==="Point")return[...s.geometry.coordinates];if(s.type==="Point")return[...s.coordinates]}if(Array.isArray(s)&&s.length>=2&&!Array.isArray(s[0])&&!Array.isArray(s[1]))return[...s];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function KS(s){if(Array.isArray(s))return s;if(s.type==="Feature"){if(s.geometry!==null)return s.geometry.coordinates}else if(s.coordinates)return s.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Fl(s,i,n={}){var l=jc(s),u=jc(i),d=Nc(u[1]-l[1]),f=Nc(u[0]-l[0]),o=Nc(l[1]),_=Nc(u[1]),T=Math.pow(Math.sin(d/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(o)*Math.cos(_);return Tw(2*Math.atan2(Math.sqrt(T),Math.sqrt(1-T)),n.units)}var JS=Object.defineProperty,YS=Object.defineProperties,QS=Object.getOwnPropertyDescriptors,v_=Object.getOwnPropertySymbols,$S=Object.prototype.hasOwnProperty,eT=Object.prototype.propertyIsEnumerable,w_=(s,i,n)=>i in s?JS(s,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[i]=n,x_=(s,i)=>{for(var n in i||(i={}))$S.call(i,n)&&w_(s,n,i[n]);if(v_)for(var n of v_(i))eT.call(i,n)&&w_(s,n,i[n]);return s},S_=(s,i)=>YS(s,QS(i));function tT(s,i,n={}){if(!s||!i)throw new Error("lines and pt are required arguments");const l=jc(i);let u=Kh([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),d=0;return Cw(s,function(f,o,_){const T=KS(f);for(let S=0;S<T.length-1;S++){const y=Kh(T[S]);y.properties.dist=Fl(i,y,n);const k=jc(y),I=Kh(T[S+1]);I.properties.dist=Fl(i,I,n);const C=jc(I),L=Fl(y,I,n);let N,R;k[0]===l[0]&&k[1]===l[1]?[N,,R]=[k,void 0,!1]:C[0]===l[0]&&C[1]===l[1]?[N,,R]=[C,void 0,!0]:[N,,R]=rT(y.geometry.coordinates,I.geometry.coordinates,jc(i));let z;N&&(z=Kh(N,{dist:Fl(i,N,n),multiFeatureIndex:_,location:d+Fl(y,N,n)})),z&&z.properties.dist<u.properties.dist&&(u=S_(x_({},z),{properties:S_(x_({},z.properties),{index:R?S+1:S})})),d+=L}}),u}function iT(s,i){const[n,l,u]=s,[d,f,o]=i;return n*d+l*f+u*o}function nT(s,i){const[n,l,u]=s,[d,f,o]=i;return[l*o-u*f,u*d-n*o,n*f-l*d]}function T_(s){return Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)+Math.pow(s[2],2))}function zl(s,i){const n=iT(s,i)/(T_(s)*T_(i));return Math.acos(Math.min(Math.max(n,-1),1))}function Ad(s){const i=Nc(s[1]),n=Nc(s[0]);return[Math.cos(i)*Math.cos(n),Math.cos(i)*Math.sin(n),Math.sin(i)]}function Ol(s){const[i,n,l]=s,u=bg(Math.asin(l));return[bg(Math.atan2(n,i)),u]}function rT(s,i,n){const l=Ad(s),u=Ad(i),d=Ad(n),[f,o,_]=d,[T,S,y]=nT(l,u),k=S*_-y*o,I=y*f-T*_,C=T*o-S*f,L=C*S-I*y,N=k*y-C*T,R=I*T-k*S,z=1/Math.sqrt(Math.pow(L,2)+Math.pow(N,2)+Math.pow(R,2)),Z=[L*z,N*z,R*z],ie=[-1*L*z,-1*N*z,-1*R*z],ae=zl(l,u),$=zl(l,Z),re=zl(u,Z),j=zl(l,ie),U=zl(u,ie);let J;return $<j&&$<U||re<j&&re<U?J=Z:J=ie,zl(l,J)>ae||zl(u,J)>ae?Fl(Ol(J),Ol(l))<=Fl(Ol(J),Ol(u))?[Ol(l),!0,!1]:[Ol(u),!1,!0]:[Ol(J),!1,!1]}var sT=tT;const oT=["==",["geometry-type"],"Polygon"],aT=["==",["geometry-type"],"LineString"],lT=["==",["geometry-type"],"Point"];function Q0(){return{type:"FeatureCollection",features:[]}}function Md(s){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:$0(s)}}}function $0(s){return[Math.round(s[0]*1e7)/1e7,Math.round(s[1]*1e7)/1e7]}const eb=kn(Q0()),tb=kn(0),cT=100;class uT{constructor(i){Zn(this,"map");Zn(this,"active");Zn(this,"eventListenersSuccess");Zn(this,"eventListenersUpdated");Zn(this,"eventListenersFailure");Zn(this,"points");Zn(this,"cursor");Zn(this,"hover");Zn(this,"dragFrom");Zn(this,"previousStates");Zn(this,"onMouseMove",i=>{if(this.active&&!this.dragFrom)this.recalculateHovering(i);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-i.lngLat.lng,l=this.dragFrom[1]-i.lngLat.lat;for(let u of this.points)u[0]-=n,u[1]-=l}else this.points[this.hover]=i.lngLat.toArray();this.dragFrom=i.lngLat.toArray(),this.redraw()}});Zn(this,"onClick",i=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(k_(this.points).forEach((l,u)=>{n.push([u+1,sT(l,this.cursor).properties.dist])}),n.sort((l,u)=>l[1]-u[1]),n.length>0){let l=n[0][0];this.points.splice(l,0,this.cursor.geometry.coordinates),this.hover=l}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(i))});Zn(this,"onDoubleClick",i=>{this.active&&(i.preventDefault(),this.cursor=Md(i.lngLat.toArray()),this.onClick(i),this.finish())});Zn(this,"onMouseDown",i=>{this.active&&!this.dragFrom&&this.hover!=null&&(i.preventDefault(),this.cursor=null,this.dragFrom=i.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Zn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Zn(this,"onKeypress",i=>{if(!this.active)return;let n=i.target.tagName;n=="INPUT"||n=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="z"&&i.ctrlKey&&this.undo())});Zn(this,"onKeyDown",i=>{if(!this.active)return;let n=i.target.tagName;n=="INPUT"||n=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())});this.map=i,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let i=this.polygonFeature();if(i)for(let n of this.eventListenersSuccess)n(i);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let i of this.eventListenersFailure)i();this.stop()}addEventListenerSuccess(i){this.eventListenersSuccess.push(i)}addEventListenerUpdated(i){this.eventListenersUpdated.push(i)}addEventListenerFailure(i){this.eventListenersFailure.push(i)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(i){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(i.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let i=Q0();this.points.forEach((u,d)=>{let f=Md(u);f.properties.hover=this.hover==d,f.properties.idx=d,i.features.push(f)}),i.features=i.features.concat(k_(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",i.features.push(n)),eb.set(i);let l="crosshair";this.hover!=null&&(l=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=l,tb.set(this.previousStates.length)}pointsUpdated(){let i=this.polygonFeature();if(i)for(let n of this.eventListenersUpdated)n(i)}recalculateHovering(i){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(i.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Md(i.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let i=this.points.map($0),n=[JSON.parse(JSON.stringify(i))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>cT&&this.previousStates.shift()}}function k_(s){let i=[];for(let n=0;n<s.length-1;n++)i.push({type:"Feature",geometry:{type:"LineString",coordinates:[s[n],s[n+1]]},properties:{}});return s.length>=3&&i.push({type:"Feature",geometry:{type:"LineString",coordinates:[s[s.length-1],s[0]]},properties:{}}),i}function hT(s){let i,n,l;return{c(){i=kt("Undo ("),n=kt(s[1]),l=kt(")")},m(u,d){xe(u,i,d),xe(u,n,d),xe(u,l,d)},p(u,d){d&2&&Li(n,u[1])},d(u){u&&(we(i),we(n),we(l))}}}function fT(s){let i;return{c(){i=kt("Undo")},m(n,l){xe(n,i,l)},p:$t,d(n){n&&we(i)}}}function dT(s){let i,n,l,u,d,f,o,_,T,S,y;function k(L,N){return L[1]==0?fT:hT}let I=k(s),C=I(s);return{c(){i=Ae("div"),n=Ae("button"),n.textContent="Finish",l=$e(),u=Ae("button"),u.textContent="Cancel",d=$e(),f=Ae("button"),C.c(),_=$e(),T=Ae("ul"),T.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,f.disabled=o=s[1]==0,en(i,"display","flex"),en(i,"justify-content","space-between")},m(L,N){xe(L,i,N),ve(i,n),ve(i,l),ve(i,u),ve(i,d),ve(i,f),C.m(f,null),xe(L,_,N),xe(L,T,N),S||(y=[Jt(n,"click",s[2]),Jt(u,"click",s[3]),Jt(f,"click",s[4])],S=!0)},p(L,[N]){I===(I=k(L))&&C?C.p(L,N):(C.d(1),C=I(L),C&&(C.c(),C.m(f,null))),N&2&&o!==(o=L[1]==0)&&(f.disabled=o)},i:$t,o:$t,d(L){L&&(we(i),we(_),we(T)),C.d(),S=!1,Yn(y)}}}function pT(s,i,n){let l;Qt(s,tb,_=>n(1,l=_));let{polygonTool:u}=i;const d=()=>u.finish(),f=()=>u.cancel(),o=()=>u.undo();return s.$$set=_=>{"polygonTool"in _&&n(0,u=_.polygonTool)},[u,l,d,f,o]}class mT extends di{constructor(i){super(),fi(this,i,pT,dT,si,{polygonTool:0})}}let gT=Date.now();function mh(s){return`${s}-${gT++}`}const ib=Symbol.for("svelte-maplibre");function _T(){return Hy(ib)}function C_(s){return{subscribe:s.subscribe}}function nb({key:s,setPopupTarget:i=!1,setCluster:n=!1,setMouseEvent:l=!1}){let u=_T(),d=kn(null),f=C_(d),o={...u,[s]:C_(d)};if(i&&(o.popupTarget=f),l){let _=kn(null);o.layerEvent=_,u.layerEvent=_}return n&&(o.cluster=kn()),$d(ib,o),{...u,self:d}}function yT(){return nb({key:"source",setCluster:!0})}function bT(s=!0){return nb({key:"layer",setPopupTarget:s,setMouseEvent:s})}function E_(s){let i;return n=>{if(n)for(let l in n){let u=i==null?void 0:i[l],d=n[l];u!==d&&s(l,d,u)}else if(i)for(let l in i)s(l,void 0,i[l]);i=n}}function vT(s,...i){let n=[s];for(let l of i)if(l)Array.isArray(l)&&l[0]===s?n.push(...l.slice(1)):n.push(l);else continue;if(n.length!==1)return n.length===2?n[1]:n}function wT(s){return s===!0?["has","point_count"]:s===!1?["!",["has","point_count"]]:void 0}function I_(s){let i=s[0],n,l,u=A_(s);return{c(){u.c(),n=Ln()},m(d,f){u.m(d,f),xe(d,n,f),l=!0},p(d,f){f[0]&1&&si(i,i=d[0])?(ln(),Ve(u,1,1,$t),cn(),u=A_(d),u.c(),Re(u,1),u.m(n.parentNode,n)):u.p(d,f)},i(d){l||(Re(u),l=!0)},o(d){Ve(u),l=!1},d(d){d&&we(n),u.d(d)}}}function A_(s){let i;const n=s[36].default,l=vn(n,s,s[35],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d[1]&16)&&xn(l,n,u,u[35],i?wn(n,u[35],d,null):Sn(u[35]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function xT(s){let i,n,l=s[0]&&I_(s);return{c(){l&&l.c(),i=Ln()},m(u,d){l&&l.m(u,d),xe(u,i,d),n=!0},p(u,d){u[0]?l?(l.p(u,d),d[0]&1&&Re(l,1)):(l=I_(u),l.c(),Re(l,1),l.m(i.parentNode,i)):l&&(ln(),Ve(l,1,1,()=>{l=null}),cn())},i(u){n||(Re(l),n=!0)},o(u){Ve(l),n=!1},d(u){u&&we(i),l&&l.d(u)}}}function ST(s,i,n){let l,u,d,f,o,_,T,S,y,k,I,C,{$$slots:L={},$$scope:N}=i,{id:R=mh("layer")}=i,{source:z=void 0}=i,{sourceLayer:Z=void 0}=i,{beforeId:ie=void 0}=i,{beforeLayerType:ae=void 0}=i,{type:$}=i,{paint:re=void 0}=i,{layout:j=void 0}=i,{filter:U=void 0}=i,{applyToClusters:J=void 0}=i,{minzoom:B=void 0}=i,{maxzoom:W=void 0}=i,{manageHoverState:le=!1}=i,{hovered:ge=null}=i,{interactive:pe=!0}=i,{hoverCursor:_e=void 0}=i,{eventsIfTopMost:ce=!1}=i;const Le=nl(),{map:ze,source:ct,self:nt,minzoom:bt,maxzoom:At,eventTopMost:tt,layerInfo:vt}=bT();Qt(s,ze,Ge=>n(31,y=Ge)),Qt(s,ct,Ge=>n(32,k=Ge)),Qt(s,nt,Ge=>n(0,S=Ge)),Qt(s,bt,Ge=>n(34,C=Ge)),Qt(s,At,Ge=>n(33,I=Ge)),hs(()=>{S&&y&&(vt.delete(S),y==null||y.removeLayer(S))});let St;function Zt(Ge){var gi,dt;if(!pe||!S||!y||ce&&tt(Ge)!==S)return;let Pt=Ge.features??[],ii=(dt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:dt.cluster_id,Je={event:Ge,map:y,clusterId:ii,layer:S,source:o,features:Pt};Le(Ge.type,Je)}function oi(Ge){var gi,dt;if(!pe||!S||!y||ce&&tt(Ge)!==S)return;_e&&(y.getCanvas().style.cursor=_e);let Pt=Ge.features??[];n(6,ge=Pt[0]??null);let ii=(dt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:dt.cluster_id;Le("mouseenter",{event:Ge,map:y,clusterId:ii,layer:S,source:o,features:Pt})}function Ai(Ge){var gi,dt,et;if(!pe||!y)return;if(ce&&tt(Ge)!==S){n(6,ge=null),le&&St!==void 0&&(y==null||y.setFeatureState({source:o,sourceLayer:Z,id:St},{hover:!1}),St=void 0);return}y.getCanvas().style.cursor=_e;let Pt=Ge.features??[],ii=(dt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:dt.cluster_id,Je=(et=Pt[0])==null?void 0:et.id;Je!==St&&(le&&(St!==void 0&&(y==null||y.setFeatureState({source:o,id:St,sourceLayer:Z},{hover:!1})),y==null||y.setFeatureState({source:o,id:Je,sourceLayer:Z},{hover:!0})),St=Je,n(6,ge=Pt[0]??null)),Le("mousemove",{event:Ge,map:y,clusterId:ii,layer:S,source:o,features:Pt})}function Mi(Ge){if(!(!pe||!S||!y)){if(_e&&(y.getCanvas().style.cursor=""),n(6,ge=null),le&&St!==void 0){const Pt={source:o,id:St,sourceLayer:Z};y==null||y.setFeatureState(Pt,{hover:!1}),St=void 0}Le("mouseleave",{map:y,layer:S,source:o})}}let Ti=!0;function It(Ge){y&&(y.off("click",Ge,Zt),y.off("dblclick",Ge,Zt),y.off("contextmenu",Ge,Zt),y.off("mouseenter",Ge,oi),y.off("mousemove",Ge,Ai),y.off("mouseleave",Ge,Mi))}return hs(()=>{y&&S&&It(S)}),s.$$set=Ge=>{"id"in Ge&&n(7,R=Ge.id),"source"in Ge&&n(8,z=Ge.source),"sourceLayer"in Ge&&n(9,Z=Ge.sourceLayer),"beforeId"in Ge&&n(10,ie=Ge.beforeId),"beforeLayerType"in Ge&&n(11,ae=Ge.beforeLayerType),"type"in Ge&&n(12,$=Ge.type),"paint"in Ge&&n(13,re=Ge.paint),"layout"in Ge&&n(14,j=Ge.layout),"filter"in Ge&&n(15,U=Ge.filter),"applyToClusters"in Ge&&n(16,J=Ge.applyToClusters),"minzoom"in Ge&&n(17,B=Ge.minzoom),"maxzoom"in Ge&&n(18,W=Ge.maxzoom),"manageHoverState"in Ge&&n(19,le=Ge.manageHoverState),"hovered"in Ge&&n(6,ge=Ge.hovered),"interactive"in Ge&&n(20,pe=Ge.interactive),"hoverCursor"in Ge&&n(21,_e=Ge.hoverCursor),"eventsIfTopMost"in Ge&&n(22,ce=Ge.eventsIfTopMost),"$$scope"in Ge&&n(35,N=Ge.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&65536&&n(30,l=wT(J)),s.$$.dirty[0]&1073774592&&n(24,u=vT("all",l,U)),s.$$.dirty[0]&131072|s.$$.dirty[1]&8&&n(26,d=B??C),s.$$.dirty[0]&262144|s.$$.dirty[1]&4&&n(25,f=W??I),s.$$.dirty[0]&256|s.$$.dirty[1]&2&&n(29,o=z||k),s.$$.dirty[0]&654343809|s.$$.dirty[1]&1&&y&&S!==R&&o){S&&(It(S),vt.delete(S));let Ge=ie;if(!ie&&ae){let Pt=y.getStyle().layers,ii=typeof ae=="function"?ae:gi=>gi.type===ae,Je=Pt==null?void 0:Pt.find(ii);Je&&(Ge=Je.id)}dn(nt,S=R,S),y.addLayer(Vl({id:S,type:$,source:o,"source-layer":Z,filter:u,paint:re,layout:j,minzoom:d,maxzoom:f}),Ge),n(23,Ti=!0),y.on("click",S,Zt),y.on("dblclick",S,Zt),y.on("contextmenu",S,Zt),y.on("mouseenter",S,oi),y.on("mousemove",S,Ai),y.on("mouseleave",S,Mi)}s.$$.dirty[0]&1048577&&S&&vt.set(S,{interactive:pe}),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&n(28,_=S?E_((Ge,Pt)=>y==null?void 0:y.setPaintProperty(S,Ge,Pt)):void 0),s.$$.dirty[0]&1|s.$$.dirty[1]&1&&n(27,T=S?E_((Ge,Pt)=>y==null?void 0:y.setLayoutProperty(S,Ge,Pt)):void 0),s.$$.dirty[0]&268443648&&(_==null||_(re)),s.$$.dirty[0]&134234112&&(T==null||T(j)),s.$$.dirty[0]&100663297|s.$$.dirty[1]&1&&S&&(y==null||y.setLayerZoomRange(S,d,f)),s.$$.dirty[0]&25165825|s.$$.dirty[1]&1&&S&&(Ti?n(23,Ti=!1):y==null||y.setFilter(S,u))},[S,ze,ct,nt,bt,At,ge,R,z,Z,ie,ae,$,re,j,U,J,B,W,le,pe,_e,ce,Ti,u,f,d,T,_,o,l,y,k,I,C,N,L]}class vp extends di{constructor(i){super(),fi(this,i,ST,xT,si,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function TT(s){let i;const n=s[16].default,l=vn(n,s,s[24],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&16777216)&&xn(l,n,u,u[24],i?wn(n,u[24],d,null):Sn(u[24]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function kT(s){let i,n,l;function u(f){s[17](f)}let d={id:s[1],type:"circle",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],applyToClusters:s[9],minzoom:s[10],maxzoom:s[11],hoverCursor:s[12],manageHoverState:s[13],eventsIfTopMost:s[14],interactive:s[15],$$slots:{default:[TT]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.hovered=s[0]),i=new vp({props:d}),Si.push(()=>Yi(i,"hovered",u)),i.$on("click",s[18]),i.$on("dblclick",s[19]),i.$on("contextmenu",s[20]),i.$on("mouseenter",s[21]),i.$on("mousemove",s[22]),i.$on("mouseleave",s[23]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.applyToClusters=f[9]),o&1024&&(_.minzoom=f[10]),o&2048&&(_.maxzoom=f[11]),o&4096&&(_.hoverCursor=f[12]),o&8192&&(_.manageHoverState=f[13]),o&16384&&(_.eventsIfTopMost=f[14]),o&32768&&(_.interactive=f[15]),o&16777216&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function CT(s,i,n){let{$$slots:l={},$$scope:u}=i,{id:d=mh("circle")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:T=void 0}=i,{paint:S}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{applyToClusters:I=void 0}=i,{minzoom:C=void 0}=i,{maxzoom:L=void 0}=i,{hoverCursor:N=void 0}=i,{manageHoverState:R=!1}=i,{hovered:z=null}=i,{eventsIfTopMost:Z=!1}=i,{interactive:ie=!0}=i;function ae(W){z=W,n(0,z)}function $(W){Di.call(this,s,W)}function re(W){Di.call(this,s,W)}function j(W){Di.call(this,s,W)}function U(W){Di.call(this,s,W)}function J(W){Di.call(this,s,W)}function B(W){Di.call(this,s,W)}return s.$$set=W=>{"id"in W&&n(1,d=W.id),"source"in W&&n(2,f=W.source),"sourceLayer"in W&&n(3,o=W.sourceLayer),"beforeId"in W&&n(4,_=W.beforeId),"beforeLayerType"in W&&n(5,T=W.beforeLayerType),"paint"in W&&n(6,S=W.paint),"layout"in W&&n(7,y=W.layout),"filter"in W&&n(8,k=W.filter),"applyToClusters"in W&&n(9,I=W.applyToClusters),"minzoom"in W&&n(10,C=W.minzoom),"maxzoom"in W&&n(11,L=W.maxzoom),"hoverCursor"in W&&n(12,N=W.hoverCursor),"manageHoverState"in W&&n(13,R=W.manageHoverState),"hovered"in W&&n(0,z=W.hovered),"eventsIfTopMost"in W&&n(14,Z=W.eventsIfTopMost),"interactive"in W&&n(15,ie=W.interactive),"$$scope"in W&&n(24,u=W.$$scope)},[z,d,f,o,_,T,S,y,k,I,C,L,N,R,Z,ie,l,ae,$,re,j,U,J,B,u]}class ET extends di{constructor(i){super(),fi(this,i,CT,kT,si,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function IT(s){let i;const n=s[15].default,l=vn(n,s,s[23],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&8388608)&&xn(l,n,u,u[23],i?wn(n,u[23],d,null):Sn(u[23]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function AT(s){let i,n,l;function u(f){s[16](f)}let d={id:s[1],type:"fill",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[IT]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.hovered=s[0]),i=new vp({props:d}),Si.push(()=>Yi(i,"hovered",u)),i.$on("click",s[17]),i.$on("dblclick",s[18]),i.$on("contextmenu",s[19]),i.$on("mouseenter",s[20]),i.$on("mousemove",s[21]),i.$on("mouseleave",s[22]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.minzoom=f[9]),o&1024&&(_.maxzoom=f[10]),o&2048&&(_.hoverCursor=f[11]),o&4096&&(_.manageHoverState=f[12]),o&8192&&(_.eventsIfTopMost=f[13]),o&16384&&(_.interactive=f[14]),o&8388608&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function MT(s,i,n){let{$$slots:l={},$$scope:u}=i,{id:d=mh("fill")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:T=void 0}=i,{paint:S}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{minzoom:I=void 0}=i,{maxzoom:C=void 0}=i,{hoverCursor:L=void 0}=i,{manageHoverState:N=!1}=i,{hovered:R=null}=i,{eventsIfTopMost:z=!1}=i,{interactive:Z=!0}=i;function ie(B){R=B,n(0,R)}function ae(B){Di.call(this,s,B)}function $(B){Di.call(this,s,B)}function re(B){Di.call(this,s,B)}function j(B){Di.call(this,s,B)}function U(B){Di.call(this,s,B)}function J(B){Di.call(this,s,B)}return s.$$set=B=>{"id"in B&&n(1,d=B.id),"source"in B&&n(2,f=B.source),"sourceLayer"in B&&n(3,o=B.sourceLayer),"beforeId"in B&&n(4,_=B.beforeId),"beforeLayerType"in B&&n(5,T=B.beforeLayerType),"paint"in B&&n(6,S=B.paint),"layout"in B&&n(7,y=B.layout),"filter"in B&&n(8,k=B.filter),"minzoom"in B&&n(9,I=B.minzoom),"maxzoom"in B&&n(10,C=B.maxzoom),"hoverCursor"in B&&n(11,L=B.hoverCursor),"manageHoverState"in B&&n(12,N=B.manageHoverState),"hovered"in B&&n(0,R=B.hovered),"eventsIfTopMost"in B&&n(13,z=B.eventsIfTopMost),"interactive"in B&&n(14,Z=B.interactive),"$$scope"in B&&n(23,u=B.$$scope)},[R,d,f,o,_,T,S,y,k,I,C,L,N,z,Z,l,ie,ae,$,re,j,U,J,u]}class PT extends di{constructor(i){super(),fi(this,i,MT,AT,si,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function LT(s,i,n,l,u){let d=!1;s.getSource(i)&&(d=!0,s.removeSource(i));const f=()=>{l(i)&&(s.addSource(i,n),u())};if(d){const o=()=>{i&&(s.getSource(i)?setTimeout(o,1):f())};o()}else f()}function zT(s,i,n){Jy().then(()=>{let l=Vy(s);if(!l)return;l.getSource(i)===n&&l.removeSource(i)})}function M_(s){let i=s[0],n,l,u=P_(s);return{c(){u.c(),n=Ln()},m(d,f){u.m(d,f),xe(d,n,f),l=!0},p(d,f){f&1&&si(i,i=d[0])?(ln(),Ve(u,1,1,$t),cn(),u=P_(d),u.c(),Re(u,1),u.m(n.parentNode,n)):u.p(d,f)},i(d){l||(Re(u),l=!0)},o(d){Ve(u),l=!1},d(d){d&&we(n),u.d(d)}}}function P_(s){let i;const n=s[15].default,l=vn(n,s,s[14],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&16384)&&xn(l,n,u,u[14],i?wn(n,u[14],d,null):Sn(u[14]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function OT(s){let i,n,l=s[0]&&M_(s);return{c(){l&&l.c(),i=Ln()},m(u,d){l&&l.m(u,d),xe(u,i,d),n=!0},p(u,[d]){u[0]?l?(l.p(u,d),d&1&&Re(l,1)):(l=M_(u),l.c(),Re(l,1),l.m(i.parentNode,i)):l&&(ln(),Ve(l,1,1,()=>{l=null}),cn())},i(u){n||(Re(l),n=!0)},o(u){Ve(l),n=!1},d(u){u&&we(i),l&&l.d(u)}}}function DT(s,i,n){let l,u,d,{$$slots:f={},$$scope:o}=i,{id:_=mh("geojson")}=i,{data:T}=i,{generateId:S=!1}=i,{promoteId:y=void 0}=i,{filter:k=void 0}=i,{lineMetrics:I=void 0}=i,{cluster:C=void 0}=i;const{map:L,cluster:N,self:R}=yT();Qt(s,L,ie=>n(13,u=ie)),Qt(s,N,ie=>n(16,d=ie)),Qt(s,R,ie=>n(0,l=ie));let z,Z=!0;return hs(()=>{l&&z&&u&&(zT(L,l,z),dn(R,l=null,l),n(11,z=void 0))}),s.$$set=ie=>{"id"in ie&&n(4,_=ie.id),"data"in ie&&n(5,T=ie.data),"generateId"in ie&&n(6,S=ie.generateId),"promoteId"in ie&&n(7,y=ie.promoteId),"filter"in ie&&n(8,k=ie.filter),"lineMetrics"in ie&&n(9,I=ie.lineMetrics),"cluster"in ie&&n(10,C=ie.cluster),"$$scope"in ie&&n(14,o=ie.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&dn(N,d=C,d),s.$$.dirty&12273&&u&&l!==_&&(dn(R,l=_,l),LT(u,l,Vl({type:"geojson",data:T,filter:k,lineMetrics:I,generateId:S,promoteId:y,cluster:!!C,clusterMinPoints:C==null?void 0:C.minPoints,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius,clusterProperties:C==null?void 0:C.properties}),ie=>u&&ie===l,()=>{l&&(n(11,z=u==null?void 0:u.getSource(l)),n(12,Z=!0))})),s.$$.dirty&8208&&(u==null||u.on("style.load",()=>{n(11,z=u==null?void 0:u.getSource(_))})),s.$$.dirty&6176&&z&&(Z?n(12,Z=!1):z.setData(T)),s.$$.dirty&3072&&(z==null||z.setClusterOptions(Vl({cluster:!!C,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius})))},[l,L,N,R,_,T,S,y,k,I,C,z,Z,u,o,f]}class FT extends di{constructor(i){super(),fi(this,i,DT,OT,si,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function RT(s){let i;const n=s[15].default,l=vn(n,s,s[23],null);return{c(){l&&l.c()},m(u,d){l&&l.m(u,d),i=!0},p(u,d){l&&l.p&&(!i||d&8388608)&&xn(l,n,u,u[23],i?wn(n,u[23],d,null):Sn(u[23]),null)},i(u){i||(Re(l,u),i=!0)},o(u){Ve(l,u),i=!1},d(u){l&&l.d(u)}}}function BT(s){let i,n,l;function u(f){s[16](f)}let d={id:s[1],type:"line",source:s[2],sourceLayer:s[3],beforeId:s[4],beforeLayerType:s[5],paint:s[6],layout:s[7],filter:s[8],minzoom:s[9],maxzoom:s[10],hoverCursor:s[11],manageHoverState:s[12],eventsIfTopMost:s[13],interactive:s[14],$$slots:{default:[RT]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.hovered=s[0]),i=new vp({props:d}),Si.push(()=>Yi(i,"hovered",u)),i.$on("click",s[17]),i.$on("dblclick",s[18]),i.$on("contextmenu",s[19]),i.$on("mouseenter",s[20]),i.$on("mousemove",s[21]),i.$on("mouseleave",s[22]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.minzoom=f[9]),o&1024&&(_.maxzoom=f[10]),o&2048&&(_.hoverCursor=f[11]),o&4096&&(_.manageHoverState=f[12]),o&8192&&(_.eventsIfTopMost=f[13]),o&16384&&(_.interactive=f[14]),o&8388608&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function NT(s,i,n){let{$$slots:l={},$$scope:u}=i,{id:d=mh("line")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:T=void 0}=i,{paint:S}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{minzoom:I=void 0}=i,{maxzoom:C=void 0}=i,{hoverCursor:L=void 0}=i,{manageHoverState:N=!1}=i,{hovered:R=null}=i,{eventsIfTopMost:z=!1}=i,{interactive:Z=!0}=i;function ie(B){R=B,n(0,R)}function ae(B){Di.call(this,s,B)}function $(B){Di.call(this,s,B)}function re(B){Di.call(this,s,B)}function j(B){Di.call(this,s,B)}function U(B){Di.call(this,s,B)}function J(B){Di.call(this,s,B)}return s.$$set=B=>{"id"in B&&n(1,d=B.id),"source"in B&&n(2,f=B.source),"sourceLayer"in B&&n(3,o=B.sourceLayer),"beforeId"in B&&n(4,_=B.beforeId),"beforeLayerType"in B&&n(5,T=B.beforeLayerType),"paint"in B&&n(6,S=B.paint),"layout"in B&&n(7,y=B.layout),"filter"in B&&n(8,k=B.filter),"minzoom"in B&&n(9,I=B.minzoom),"maxzoom"in B&&n(10,C=B.maxzoom),"hoverCursor"in B&&n(11,L=B.hoverCursor),"manageHoverState"in B&&n(12,N=B.manageHoverState),"hovered"in B&&n(0,R=B.hovered),"eventsIfTopMost"in B&&n(13,z=B.eventsIfTopMost),"interactive"in B&&n(14,Z=B.interactive),"$$scope"in B&&n(23,u=B.$$scope)},[R,d,f,o,_,T,S,y,k,I,C,L,N,z,Z,l,ie,ae,$,re,j,U,J,u]}class jT extends di{constructor(i){super(),fi(this,i,NT,BT,si,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function UT(s){let i,n,l,u,d,f;return i=new PT({props:{id:"edit-polygon-fill",filter:oT,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),l=new jT({props:{id:"edit-polygon-lines",filter:aT,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),d=new ET({props:{id:"edit-polygon-vertices",filter:lT,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment),u=$e(),yt(d.$$.fragment)},m(o,_){gt(i,o,_),xe(o,n,_),gt(l,o,_),xe(o,u,_),gt(d,o,_),f=!0},p:$t,i(o){f||(Re(i.$$.fragment,o),Re(l.$$.fragment,o),Re(d.$$.fragment,o),f=!0)},o(o){Ve(i.$$.fragment,o),Ve(l.$$.fragment,o),Ve(d.$$.fragment,o),f=!1},d(o){o&&(we(n),we(u)),_t(i,o),_t(l,o),_t(d,o)}}}function VT(s){let i,n;return i=new FT({props:{data:s[0],$$slots:{default:[UT]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,[u]){const d={};u&1&&(d.data=l[0]),u&2&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function qT(s,i,n){let l;return Qt(s,eb,u=>n(0,l=u)),[l]}class ZT extends di{constructor(i){super(),fi(this,i,qT,VT,si,{})}}const WT=s=>({}),L_=s=>({}),GT=s=>({}),z_=s=>({}),HT=s=>({}),O_=s=>({});function XT(s){let i,n,l,u,d,f,o,_;const T=s[1].top,S=vn(T,s,s[0],O_),y=s[1].left,k=vn(y,s,s[0],z_),I=s[1].main,C=vn(I,s,s[0],L_);return{c(){i=Ae("div"),n=Ae("div"),S&&S.c(),l=$e(),u=Ae("div"),d=Ae("div"),k&&k.c(),f=$e(),o=Ae("div"),C&&C.c(),be(n,"class","top svelte-29q570"),be(d,"class","left svelte-29q570"),be(o,"class","main svelte-29q570"),be(u,"class","content svelte-29q570"),be(i,"class","flex-container svelte-29q570")},m(L,N){xe(L,i,N),ve(i,n),S&&S.m(n,null),ve(i,l),ve(i,u),ve(u,d),k&&k.m(d,null),ve(u,f),ve(u,o),C&&C.m(o,null),_=!0},p(L,[N]){S&&S.p&&(!_||N&1)&&xn(S,T,L,L[0],_?wn(T,L[0],N,HT):Sn(L[0]),O_),k&&k.p&&(!_||N&1)&&xn(k,y,L,L[0],_?wn(y,L[0],N,GT):Sn(L[0]),z_),C&&C.p&&(!_||N&1)&&xn(C,I,L,L[0],_?wn(I,L[0],N,WT):Sn(L[0]),L_)},i(L){_||(Re(S,L),Re(k,L),Re(C,L),_=!0)},o(L){Ve(S,L),Ve(k,L),Ve(C,L),_=!1},d(L){L&&we(i),S&&S.d(L),k&&k.d(L),C&&C.d(L)}}}function KT(s,i,n){let{$$slots:l={},$$scope:u}=i;return s.$$set=d=>{"$$scope"in d&&n(0,u=d.$$scope)},[u,l]}class JT extends di{constructor(i){super(),fi(this,i,KT,XT,si,{})}}const YT=s=>({}),D_=s=>({}),QT=s=>({}),F_=s=>({}),$T=s=>({}),R_=s=>({});function ek(s){let i,n,l,u,d,f;const o=s[4].top,_=vn(o,s,s[3],R_),T=s[4].sidebar,S=vn(T,s,s[3],F_),y=s[4].map,k=vn(y,s,s[3],D_);return{c(){i=Ae("div"),_&&_.c(),n=$e(),l=Ae("div"),S&&S.c(),u=$e(),d=Ae("div"),k&&k.c()},m(I,C){xe(I,i,C),_&&_.m(i,null),s[5](i),xe(I,n,C),xe(I,l,C),S&&S.m(l,null),s[6](l),xe(I,u,C),xe(I,d,C),k&&k.m(d,null),s[7](d),f=!0},p(I,[C]){_&&_.p&&(!f||C&8)&&xn(_,o,I,I[3],f?wn(o,I[3],C,$T):Sn(I[3]),R_),S&&S.p&&(!f||C&8)&&xn(S,T,I,I[3],f?wn(T,I[3],C,QT):Sn(I[3]),F_),k&&k.p&&(!f||C&8)&&xn(k,y,I,I[3],f?wn(y,I[3],C,YT):Sn(I[3]),D_)},i(I){f||(Re(_,I),Re(S,I),Re(k,I),f=!0)},o(I){Ve(_,I),Ve(S,I),Ve(k,I),f=!1},d(I){I&&(we(i),we(n),we(l),we(u),we(d)),_&&_.d(I),s[5](null),S&&S.d(I),s[6](null),k&&k.d(I),s[7](null)}}}function tk(s,i,n){let l,u,d;Qt(s,B_,y=>n(0,l=y)),Qt(s,Kd,y=>n(1,u=y)),Qt(s,Jd,y=>n(2,d=y));let{$$slots:f={},$$scope:o}=i;function _(y){Si[y?"unshift":"push"](()=>{l=y,B_.set(l)})}function T(y){Si[y?"unshift":"push"](()=>{u=y,Kd.set(u)})}function S(y){Si[y?"unshift":"push"](()=>{d=y,Jd.set(d)})}return s.$$set=y=>{"$$scope"in y&&n(3,o=y.$$scope)},[l,u,d,o,f,_,T,S]}class Sf extends di{constructor(i){super(),fi(this,i,tk,ek,si,{})}}let B_=kn(null),Kd=kn(null),Jd=kn(null);function ik(s){let i,n,l,u,d,f,o;return{c(){i=Ae("button"),i.textContent="Import current view",n=$e(),l=Ae("p"),l.textContent="or...",u=$e(),d=Ae("button"),d.textContent="Draw an area to import on the map",be(i,"class","btn btn-primary"),be(i,"type","button"),be(l,"class","fst-italic my-3"),be(d,"class","btn btn-primary"),be(d,"type","button")},m(_,T){xe(_,i,T),xe(_,n,T),xe(_,l,T),xe(_,u,T),xe(_,d,T),f||(o=[Jt(i,"click",s[2]),Jt(d,"click",s[3])],f=!0)},p:$t,i:$t,o:$t,d(_){_&&(we(i),we(n),we(l),we(u),we(d)),f=!1,Yn(o)}}}function nk(s){let i,n;return i=new mT({props:{polygonTool:s[0]}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u&1&&(d.polygonTool=l[0]),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function rk(s){let i;return{c(){i=kt("Save a copy of the osm.xml after importing")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function sk(s){let i,n,l,u,d,f;const o=[nk,ik],_=[];function T(k,I){return k[0]?0:1}i=T(s),n=_[i]=o[i](s);function S(k){s[5](k)}let y={$$slots:{default:[rk]},$$scope:{ctx:s}};return s[1]!==void 0&&(y.checked=s[1]),u=new us({props:y}),Si.push(()=>Yi(u,"checked",S)),{c(){n.c(),l=$e(),yt(u.$$.fragment)},m(k,I){_[i].m(k,I),xe(k,l,I),gt(u,k,I),f=!0},p(k,[I]){let C=i;i=T(k),i===C?_[i].p(k,I):(ln(),Ve(_[C],1,1,()=>{_[C]=null}),cn(),n=_[i],n?n.p(k,I):(n=_[i]=o[i](k),n.c()),Re(n,1),n.m(l.parentNode,l));const L={};I&512&&(L.$$scope={dirty:I,ctx:k}),!d&&I&2&&(d=!0,L.checked=k[1],Ji(()=>d=!1)),u.$set(L)},i(k){f||(Re(n),Re(u.$$.fragment,k),f=!0)},o(k){Ve(n),Ve(u.$$.fragment,k),f=!1},d(k){k&&we(l),_[i].d(k),_t(u,k)}}}function Hu(s){return[s.lng,s.lat]}function ok(s,i,n){let{map:l}=i;const u=nl();let d=null,f=!1;async function o(k){try{u("loading","Loading from Overpass");let C=await(await fetch(rb(k))).text();f&&S0("osm.xml",C),u("gotXml",{xml:C,boundary:k})}catch(I){u("error",I.toString())}}function _(){let k=l.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Hu(k.getSouthWest()),Hu(k.getNorthWest()),Hu(k.getNorthEast()),Hu(k.getSouthEast()),Hu(k.getSouthWest())]],type:"Polygon"}}}async function T(){if(l){if(l.getZoom()<13){u("error","Zoom in more to import");return}await o(_())}}function S(){l&&(n(0,d=new uT(l)),d.startNew(),d.addEventListenerSuccess(async k=>{n(0,d=null),await o(k)}),d.addEventListenerFailure(()=>{n(0,d=null)}))}function y(k){f=k,n(1,f)}return s.$$set=k=>{"map"in k&&n(4,l=k.map)},[d,f,T,S,l,y]}class ak extends di{constructor(i){super(),fi(this,i,ok,sk,si,{map:4})}}function rb(s){let i='poly:"';if(s.geometry.type=="Polygon")for(let[l,u]of s.geometry.coordinates[0])i+=`${u} ${l} `;else if(s.geometry.type=="MultiPolygon")for(let[l,u]of s.geometry.coordinates[0][0])i+=`${u} ${l} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return i=i.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${i}); node(w)->.x; <;); out meta;`}`}function lk(s){let i,n,l,u,d,f,o,_,T,S,y,k;return T=new ak({props:{map:_g(s[2])}}),T.$on("gotXml",s[4]),T.$on("loading",s[6]),T.$on("error",s[7]),{c(){i=Ae("div"),n=Ae("div"),l=Ae("label"),u=kt(`Load an osm.pbf or osm.xml file
        `),d=Ae("input"),f=$e(),o=Ae("p"),o.textContent="or...",_=$e(),yt(T.$$.fragment),be(d,"class","form-control"),be(d,"type","file"),be(l,"class","form-label"),be(o,"class","fst-italic my-3"),be(i,"slot","sidebar")},m(I,C){xe(I,i,C),ve(i,n),ve(n,l),ve(l,u),ve(l,d),s[5](d),ve(i,f),ve(i,o),ve(i,_),gt(T,i,null),S=!0,y||(k=Jt(d,"change",s[3]),y=!0)},p(I,C){const L={};C&4&&(L.map=_g(I[2])),T.$set(L)},i(I){S||(Re(T.$$.fragment,I),S=!0)},o(I){Ve(T.$$.fragment,I),S=!1},d(I){I&&we(i),s[5](null),_t(T),y=!1,k()}}}function ck(s){let i,n,l;return n=new ZT({}),{c(){i=Ae("div"),yt(n.$$.fragment),be(i,"slot","map")},m(u,d){xe(u,i,d),gt(n,i,null),l=!0},p:$t,i(u){l||(Re(n.$$.fragment,u),l=!0)},o(u){Ve(n.$$.fragment,u),l=!1},d(u){u&&we(i),_t(n)}}}function uk(s){let i,n,l,u;return i=new Yc({props:{loading:s[0]}}),l=new Sf({props:{$$slots:{map:[ck],sidebar:[lk]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(l,d,f),u=!0},p(d,[f]){const o={};f&1&&(o.loading=d[0]),i.$set(o);const _={};f&1031&&(_.$$scope={dirty:f,ctx:d}),l.$set(_)},i(d){u||(Re(i.$$.fragment,d),Re(l.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(l.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(l,d)}}}function hk(s,i,n){let l,u;Qt(s,ur,I=>n(8,l=I)),Qt(s,ph,I=>n(2,u=I));let d="",f;async function o(I){try{n(0,d="Loading from file"),await Ro();let C=await f.files[0].arrayBuffer();dn(ur,l=new oh(new Uint8Array(C),null),l),T()}catch(C){window.alert(`Bad input file: ${C}`)}finally{n(0,d="")}}async function _(I){try{n(0,d="Processing Overpass data"),await Ro();let C=new TextEncoder().encode(I.detail.xml);dn(ur,l=new oh(new Uint8Array(C),I.detail.boundary),l),T()}catch(C){window.alert(`Couldn't import from Overpass: ${C}`)}finally{n(0,d="")}}function T(){u.fitBounds(MS(JSON.parse(l.getNodes())),{animate:!1,padding:10})}function S(I){Si[I?"unshift":"push"](()=>{f=I,n(1,f)})}return[d,f,u,o,_,S,I=>n(0,d=I.detail),I=>window.alert(I.detail)]}class fk extends di{constructor(i){super(),fi(this,i,hk,uk,si,{})}}const dk="/speedwalk/assets/favicon-DMAVMD4u.ico",pk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAApElEQVRIS+XUQQqAIBAFUOcgnaEIul/tO1kQdYau0AHsC64y4n9BIWozG/lPx0lzhT8rnO9+BnjvZ7T0NLOJbS3dIoQ3CD1i8MgiNBCCgbQou4JIQEQ61I1FZCAiPerKIFmAgmQDERlQl7eTJAAu0rMj+LAuma76gLJ7HFZvEQsgnJqkrEtmw8NmZQDh5X40NVw6Qa3HrtxzzU7XfZ18ySr0feACKA1QGcdX8MgAAAAASUVORK5CYII=";function N_(s,i,n){const l=s.slice();return l[14]=i[n],l}function j_(s){let i,n,l,u=s[14].name+"",d,f,o;function _(){return s[7](s[14])}return{c(){i=Ae("div"),n=Ae("button"),l=kt("Remove "),d=kt(u),be(n,"class","btn btn-danger mb-3")},m(T,S){xe(T,i,S),ve(i,n),ve(n,l),ve(n,d),f||(o=Jt(n,"click",_),f=!0)},p(T,S){s=T,S&2&&u!==(u=s[14].name+"")&&Li(d,u)},d(T){T&&we(i),f=!1,o()}}}function mk(s){let i,n,l,u,d,f,o,_,T,S,y,k,I,C,L,N,R,z,Z,ie,ae,$,re,j,U,J,B,W,le,ge,pe,_e,ce,Le,ze=Ki(s[1]),ct=[];for(let nt=0;nt<ze.length;nt+=1)ct[nt]=j_(N_(s,ze,nt));return{c(){i=Ae("h1"),i.textContent="Customize basemaps",n=$e();for(let nt=0;nt<ct.length;nt+=1)ct[nt].c();l=$e(),u=Ae("div"),d=Ae("div"),d.textContent="Add a basemap",f=$e(),o=Ae("div"),_=Ae("p"),_.textContent=`You can add custom basemaps if you know a tile URL and that the imagery
        has a license allowing it to be used for editing OSM.`,T=$e(),S=Ae("ul"),S.innerHTML=`<li><a href="https://github.com/osmlab/editor-layer-index" target="_blank">editor-layer-index</a>
          is a great reference, or you could check in iD or JOSM and figure out which
          one you like to use for your area.</li> <li>If you copy a URL from there, you may need to manually substitute some
          parts of the URL to make it work.</li> <li><b>{zoom}</b>
          
          <b>{z}</b></li> <li><b>{proj}</b>
          
          <b>{EPSG:3857}</b></li> <li><b>{width}</b>
          
          <b>256</b></li> <li><b>{height}</b>
          
          <b>256</b></li> <li><b>{bbox}</b>
          
          <b>{bbox-epsg-3857}</b></li> <li>Some sources have CORS restrictions and won&#39;t work</li>`,y=$e(),k=Ae("div"),I=Ae("label"),C=kt(`Name:
          `),L=Ae("input"),N=$e(),R=Ae("div"),z=Ae("label"),Z=kt(`Tile URL:
          `),ie=Ae("textarea"),ae=$e(),$=Ae("div"),re=Ae("label"),j=kt(`Attribution:
          `),U=Ae("input"),J=$e(),B=Ae("button"),W=kt("Add basemap"),ge=$e(),pe=Ae("div"),_e=Ae("button"),_e.textContent="Done",be(d,"class","card-header"),be(L,"class","form-control"),be(L,"type","text"),be(I,"class","form-label"),be(ie,"class","form-control"),be(ie,"rows","3"),be(ie,"cols","80"),be(z,"class","form-label"),be(U,"class","form-control"),be(U,"type","text"),be(re,"class","form-label"),be(B,"class","btn btn-primary"),B.disabled=le=!s[2]||!s[3]||!s[4],be(o,"class","card-body"),be(u,"class","card"),be(_e,"class","btn btn-primary"),be(pe,"class","mt-5")},m(nt,bt){xe(nt,i,bt),xe(nt,n,bt);for(let At=0;At<ct.length;At+=1)ct[At]&&ct[At].m(nt,bt);xe(nt,l,bt),xe(nt,u,bt),ve(u,d),ve(u,f),ve(u,o),ve(o,_),ve(o,T),ve(o,S),ve(o,y),ve(o,k),ve(k,I),ve(I,C),ve(I,L),Wr(L,s[2]),ve(o,N),ve(o,R),ve(R,z),ve(z,Z),ve(z,ie),Wr(ie,s[3]),ve(o,ae),ve(o,$),ve($,re),ve(re,j),ve(re,U),Wr(U,s[4]),ve(o,J),ve(o,B),ve(B,W),xe(nt,ge,bt),xe(nt,pe,bt),ve(pe,_e),ce||(Le=[Jt(L,"input",s[8]),Jt(ie,"input",s[9]),Jt(U,"input",s[10]),Jt(B,"click",s[5]),Jt(_e,"click",s[11])],ce=!0)},p(nt,bt){if(bt&66){ze=Ki(nt[1]);let At;for(At=0;At<ze.length;At+=1){const tt=N_(nt,ze,At);ct[At]?ct[At].p(tt,bt):(ct[At]=j_(tt),ct[At].c(),ct[At].m(l.parentNode,l))}for(;At<ct.length;At+=1)ct[At].d(1);ct.length=ze.length}bt&4&&L.value!==nt[2]&&Wr(L,nt[2]),bt&8&&Wr(ie,nt[3]),bt&16&&U.value!==nt[4]&&Wr(U,nt[4]),bt&28&&le!==(le=!nt[2]||!nt[3]||!nt[4])&&(B.disabled=le)},d(nt){nt&&(we(i),we(n),we(l),we(u),we(ge),we(pe)),xr(ct,nt),ce=!1,Yn(Le)}}}function gk(s){let i,n,l;function u(f){s[12](f)}let d={$$slots:{default:[mk]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.show=s[0]),i=new fp({props:d}),Si.push(()=>Yi(i,"show",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,[o]){const _={};o&131103&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.show=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}let Pd="speedwalk-custom-basemaps";function U_(s,i){return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[s],tileSize:256,attribution:i}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"},{id:"Road labels",type:"background",layout:{visibility:"none"}}],glyphs:"https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=MZEJTanw3WpxRvt7qDfo"}}function _k(s,i,n){let l;Qt(s,el,R=>n(13,l=R));let{show:u}=i,d=JSON.parse(window.localStorage.getItem(Pd)||"[]");for(let R of d)dn(el,l[R.name]=U_(R.tileURL,R.attribution),l);el.set(l);let f="",o="",_="";function T(){d.push({name:f,tileURL:o,attribution:_}),n(1,d),window.localStorage.setItem(Pd,JSON.stringify(d)),dn(el,l[f]=U_(o,_),l),el.set(l),n(2,f=""),n(3,o=""),n(4,_="")}function S(R){n(1,d=d.filter(z=>z.name!=R)),window.localStorage.setItem(Pd,JSON.stringify(d)),delete l[R],el.set(l)}const y=R=>S(R.name);function k(){f=this.value,n(2,f)}function I(){o=this.value,n(3,o)}function C(){_=this.value,n(4,_)}const L=()=>n(0,u=!1);function N(R){u=R,n(0,u)}return s.$$set=R=>{"show"in R&&n(0,u=R.show)},[u,d,f,o,_,T,S,y,k,I,C,L,N]}class yk extends di{constructor(i){super(),fi(this,i,_k,gk,si,{show:0})}}function V_(s,i,n){const l=s.slice();return l[7]=i[n],l}function q_(s){let i,n=s[7]+"",l,u;return{c(){i=Ae("option"),l=kt(n),i.__value=u=s[7],Wr(i,i.__value)},m(d,f){xe(d,i,f),ve(i,l)},p(d,f){f&8&&n!==(n=d[7]+"")&&Li(l,n),f&8&&u!==(u=d[7])&&(i.__value=u,Wr(i,i.__value))},d(d){d&&we(i)}}}function bk(s){let i,n,l,u,d,f,o,_,T,S,y,k,I=Ki(Object.keys(s[3])),C=[];for(let R=0;R<I.length;R+=1)C[R]=q_(V_(s,I,R));function L(R){s[6](R)}let N={};return s[2]!==void 0&&(N.show=s[2]),_=new yk({props:N}),Si.push(()=>Yi(_,"show",L)),{c(){i=Ae("div"),n=Ae("h5"),l=$e(),u=Ae("button"),u.innerHTML='<i class="fa-solid fa-square-plus"></i>',d=$e(),f=Ae("select");for(let R=0;R<C.length;R+=1)C[R].c();o=$e(),yt(_.$$.fragment),be(n,"class","fa-solid fa-layer-group me-2 align-self-center"),be(u,"class","btn btn-outline-secondary"),be(f,"class","form-select"),s[0]===void 0&&sh(()=>s[5].call(f)),be(i,"class","svelte-1ixzryq"),en(i,"bottom",s[1])},m(R,z){xe(R,i,z),ve(i,n),ve(i,l),ve(i,u),ve(i,d),ve(i,f);for(let Z=0;Z<C.length;Z+=1)C[Z]&&C[Z].m(f,null);lf(f,s[0],!0),xe(R,o,z),gt(_,R,z),S=!0,y||(k=[Jt(u,"click",s[4]),Jt(f,"change",s[5])],y=!0)},p(R,[z]){if(z&8){I=Ki(Object.keys(R[3]));let ie;for(ie=0;ie<I.length;ie+=1){const ae=V_(R,I,ie);C[ie]?C[ie].p(ae,z):(C[ie]=q_(ae),C[ie].c(),C[ie].m(f,null))}for(;ie<C.length;ie+=1)C[ie].d(1);C.length=I.length}z&9&&lf(f,R[0]),z&2&&en(i,"bottom",R[1]);const Z={};!T&&z&4&&(T=!0,Z.show=R[2],Ji(()=>T=!1)),_.$set(Z)},i(R){S||(Re(_.$$.fragment,R),S=!0)},o(R){Ve(_.$$.fragment,R),S=!1},d(R){R&&(we(i),we(o)),xr(C,R),_t(_,R),y=!1,Yn(k)}}}function vk(s,i,n){let l;Qt(s,el,S=>n(3,l=S));let{basemap:u}=i,{bottom:d="60px"}=i,f=!1;const o=()=>n(2,f=!0);function _(){u=Gy(this),n(0,u)}function T(S){f=S,n(2,f)}return s.$$set=S=>{"basemap"in S&&n(0,u=S.basemap),"bottom"in S&&n(1,d=S.bottom)},[u,d,f,l,o,_,T]}class wk extends di{constructor(i){super(),fi(this,i,vk,bk,si,{basemap:0,bottom:1})}}let gh={RoadWithSeparate:"purple",RoadWithTags:"blue",RoadWithoutSidewalksExplicit:"#8B4000",RoadWithoutSidewalksImplicit:"orange",RoadUnknown:"#ff69b4",Sidewalk:"black",Crossing:"green",Other:"grey"},Z_={RoadWithSeparate:"With separate sidewalks",RoadWithTags:"With tagged sidewalks",RoadWithoutSidewalksExplicit:"Tagged as no sidewalks",RoadWithoutSidewalksImplicit:"Assumed as no sidewalks",RoadUnknown:"Totally unknown",Sidewalk:"Separate sidewalk",Crossing:"Crossing",Other:"Other"};function tl(s){return["interpolate",["linear"],["zoom"],5,.5+s,10,1+s,12,1.5+s,14,4+s,16,mf(["get","kind"],{Sidewalk:4+s,Crossing:5+s,Other:5+s},7+s),20,mf(["get","kind"],{Sidewalk:7+s,Crossing:10+s,Other:10+s},24+s)]}function xk(s){let i,n,l,u;return i=new il({props:{id:"pinned",beforeId:"Road labels",paint:{"line-width":tl(10),"line-color":"cyan","line-opacity":.5}}}),l=new bp({props:{minzoom:12,layout:{"icon-image":"arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0}}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(l,d,f),u=!0},p:$t,i(d){u||(Re(i.$$.fragment,d),Re(l.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(l.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(l,d)}}}function Sk(s){let i,n;return i=new il({props:{id:"snapped-to-pinned",beforeId:"Road labels",paint:{"line-width":tl(10),"line-color":"blue","line-opacity":.5,"line-offset":["case",["get","left"],-5,5]}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p:$t,i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function Tk(s){let i,n;return i=new il({props:{id:"ways",beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",filter:s[4],paint:{"line-width":tl(0),"line-color":mf(["get","kind"],gh,"cyan")}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u&16&&(d.filter=l[4]),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function kk(s){let i,n;return i=new bp({props:{id:"pinned-sides",paint:{"text-color":"black","text-halo-color":"cyan","text-halo-width":4},layout:{"text-field":["get","side"],"text-size":16,"symbol-placement":"line"}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p:$t,i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function Ck(s){let i,n;return i=new bp({props:{id:"pinned-node-order",paint:{"text-color":"white","text-halo-color":"blue","text-halo-width":5},layout:{"text-field":["get","idx"],"text-size":16,visibility:s[6]?"visible":"none"}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u&64&&(d.layout={"text-field":["get","idx"],"text-size":16,visibility:l[6]?"visible":"none"}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function Ek(s){let i,n,l,u;return i=new $c({props:{filter:Y0,paint:{"circle-radius":20,"circle-color":["get","color"],"circle-opacity":.5},layout:{visibility:s[2]?"visible":"none"}}}),l=new il({props:{filter:Hd,paint:{"line-width":tl(5),"line-color":["get","color"],"line-opacity":.5},layout:{visibility:s[2]?"visible":"none"}}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(l,d,f),u=!0},p(d,f){const o={};f&4&&(o.layout={visibility:d[2]?"visible":"none"}),i.$set(o);const _={};f&4&&(_.layout={visibility:d[2]?"visible":"none"}),l.$set(_)},i(d){u||(Re(i.$$.fragment,d),Re(l.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(l.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(l,d)}}}function Ik(s){let i,n,l,u,d,f,o,_,T,S,y,k,I,C;return i=new Z0({}),i.$on("click",s[7]),l=new cs({props:{data:s[0]||qs(),$$slots:{default:[xk]},$$scope:{ctx:s}}}),d=new cs({props:{data:s[9](s[0],s[6]),$$slots:{default:[Sk]},$$scope:{ctx:s}}}),o=new cs({props:{data:s[3],$$slots:{default:[Tk]},$$scope:{ctx:s}}}),T=new cs({props:{data:s[5],$$slots:{default:[kk]},$$scope:{ctx:s}}}),y=new cs({props:{data:s[8](s[0]),$$slots:{default:[Ck]},$$scope:{ctx:s}}}),I=new cs({props:{data:s[1],$$slots:{default:[Ek]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment),u=$e(),yt(d.$$.fragment),f=$e(),yt(o.$$.fragment),_=$e(),yt(T.$$.fragment),S=$e(),yt(y.$$.fragment),k=$e(),yt(I.$$.fragment)},m(L,N){gt(i,L,N),xe(L,n,N),gt(l,L,N),xe(L,u,N),gt(d,L,N),xe(L,f,N),gt(o,L,N),xe(L,_,N),gt(T,L,N),xe(L,S,N),gt(y,L,N),xe(L,k,N),gt(I,L,N),C=!0},p(L,[N]){const R={};N&1&&(R.data=L[0]||qs()),N&16384&&(R.$$scope={dirty:N,ctx:L}),l.$set(R);const z={};N&65&&(z.data=L[9](L[0],L[6])),N&16384&&(z.$$scope={dirty:N,ctx:L}),d.$set(z);const Z={};N&8&&(Z.data=L[3]),N&16400&&(Z.$$scope={dirty:N,ctx:L}),o.$set(Z);const ie={};N&32&&(ie.data=L[5]),N&16384&&(ie.$$scope={dirty:N,ctx:L}),T.$set(ie);const ae={};N&1&&(ae.data=L[8](L[0])),N&16448&&(ae.$$scope={dirty:N,ctx:L}),y.$set(ae);const $={};N&2&&($.data=L[1]),N&16388&&($.$$scope={dirty:N,ctx:L}),I.$set($)},i(L){C||(Re(i.$$.fragment,L),Re(l.$$.fragment,L),Re(d.$$.fragment,L),Re(o.$$.fragment,L),Re(T.$$.fragment,L),Re(y.$$.fragment,L),Re(I.$$.fragment,L),C=!0)},o(L){Ve(i.$$.fragment,L),Ve(l.$$.fragment,L),Ve(d.$$.fragment,L),Ve(o.$$.fragment,L),Ve(T.$$.fragment,L),Ve(y.$$.fragment,L),Ve(I.$$.fragment,L),C=!1},d(L){L&&(we(n),we(u),we(f),we(_),we(S),we(k)),_t(i,L),_t(l,L),_t(d,L),_t(o,L),_t(T,L),_t(y,L),_t(I,L)}}}function Ak(s,i,n){let l,u,d,f;Qt(s,ur,R=>n(11,u=R)),Qt(s,ph,R=>n(12,d=R)),Qt(s,gf,R=>n(6,f=R));let{pinnedWay:o}=i,{drawProblemDetails:_}=i,{showProblemDetails:T}=i,{nodes:S}=i,{ways:y}=i,{filterWays:k}=i;function I(R){n(0,o=null);for(let z of d.queryRenderedFeatures(R.detail.point,{layers:["ways"]})){n(0,o=y.features.find(Z=>Z.id==z.id));break}}function C(R){let z=qs();if(R)for(let Z of R.properties.problems)z.features=[...z.features,...Z.details];return z}function L(R){let z=qs();if(R)for(let[Z,ie]of R.properties.node_ids.entries()){let ae=S.features.find($=>$.properties.id==ie);z.features.push({type:"Feature",geometry:ae.geometry,properties:{idx:Z}})}return z}function N(R,z){if(!R||!z)return qs();let Z=parseInt(R.properties.tags["tmp:closest_way"]);if(!Z)return qs();for(let ie of y.features)if(ie.properties.id==Z){let ae=JSON.parse(JSON.stringify(ie));return ae.properties.left=R.properties.tags["tmp:side"]=="Left",{type:"FeatureCollection",features:[ae]}}return qs()}return s.$$set=R=>{"pinnedWay"in R&&n(0,o=R.pinnedWay),"drawProblemDetails"in R&&n(1,_=R.drawProblemDetails),"showProblemDetails"in R&&n(2,T=R.showProblemDetails),"nodes"in R&&n(10,S=R.nodes),"ways"in R&&n(3,y=R.ways),"filterWays"in R&&n(4,k=R.filterWays)},s.$$.update=()=>{s.$$.dirty&2049&&n(5,l=u&&o?JSON.parse(u.getSideLocations(BigInt(o.properties.id))):qs()),s.$$.dirty&1&&n(1,_=C(o))},[o,_,T,y,k,l,f,I,L,N,S,u]}class Mk extends di{constructor(i){super(),fi(this,i,Ak,Ik,si,{pinnedWay:0,drawProblemDetails:1,showProblemDetails:2,nodes:10,ways:3,filterWays:4})}}const wr=[];for(let s=0;s<256;++s)wr.push((s+256).toString(16).slice(1));function Pk(s,i=0){return(wr[s[i+0]]+wr[s[i+1]]+wr[s[i+2]]+wr[s[i+3]]+"-"+wr[s[i+4]]+wr[s[i+5]]+"-"+wr[s[i+6]]+wr[s[i+7]]+"-"+wr[s[i+8]]+wr[s[i+9]]+"-"+wr[s[i+10]]+wr[s[i+11]]+wr[s[i+12]]+wr[s[i+13]]+wr[s[i+14]]+wr[s[i+15]]).toLowerCase()}let Ld;const Lk=new Uint8Array(16);function zk(){if(!Ld){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ld=crypto.getRandomValues.bind(crypto)}return Ld(Lk)}const Ok=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),W_={randomUUID:Ok};function Dk(s,i,n){var u;s=s||{};const l=s.random??((u=s.rng)==null?void 0:u.call(s))??zk();if(l.length<16)throw new Error("Random bytes length must be >= 16");return l[6]=l[6]&15|64,l[8]=l[8]&63|128,Pk(l)}function Fk(s,i,n){return W_.randomUUID&&!s?W_.randomUUID():Dk(s)}const Rk=s=>({}),G_=s=>({}),Bk=s=>({}),H_=s=>({});function Nk(s){let i,n,l,u,d,f,o,_;const T=s[2].header,S=vn(T,s,s[1],H_),y=s[2].body,k=vn(y,s,s[1],G_);return{c(){i=Ae("div"),n=Ae("div"),l=Ae("div"),u=Ae("button"),S&&S.c(),d=$e(),f=Ae("div"),o=Ae("div"),k&&k.c(),be(u,"class","accordion-button"),be(u,"type","button"),be(u,"data-bs-toggle","collapse"),be(u,"data-bs-target",`#${s[0]}`),be(u,"aria-expanded","true"),be(u,"aria-controls",s[0]),be(l,"class","accordion-header"),be(o,"class","accordion-body"),be(f,"id",s[0]),be(f,"class","accordion-collapse collapse show"),be(n,"class","accordion-item"),be(i,"class","accordion mb-3")},m(I,C){xe(I,i,C),ve(i,n),ve(n,l),ve(l,u),S&&S.m(u,null),ve(n,d),ve(n,f),ve(f,o),k&&k.m(o,null),_=!0},p(I,[C]){S&&S.p&&(!_||C&2)&&xn(S,T,I,I[1],_?wn(T,I[1],C,Bk):Sn(I[1]),H_),k&&k.p&&(!_||C&2)&&xn(k,y,I,I[1],_?wn(y,I[1],C,Rk):Sn(I[1]),G_)},i(I){_||(Re(S,I),Re(k,I),_=!0)},o(I){Ve(S,I),Ve(k,I),_=!1},d(I){I&&we(i),S&&S.d(I),k&&k.d(I)}}}function jk(s,i,n){let{$$slots:l={},$$scope:u}=i,d=Fk();return s.$$set=f=>{"$$scope"in f&&n(1,u=f.$$scope)},[d,u,l]}class Tf extends di{constructor(i){super(),fi(this,i,jk,Nk,si,{})}}function X_(s,i,n){const l=s.slice();return l[10]=i[n][0],l[11]=i[n][1],l}function Uk(s){let i;return{c(){i=Ae("div"),i.textContent="Problems",be(i,"slot","header")},m(n,l){xe(n,i,l)},p:$t,d(n){n&&we(i)}}}function K_(s){let i,n=s[10]+"",l,u,d=s[11]+"",f,o,_,T;return{c(){i=Ae("option"),l=kt(n),u=kt(" ("),f=kt(d),o=kt(`)
        `),i.__value=_=s[10],Wr(i,i.__value),i.disabled=T=s[11]==0},m(S,y){xe(S,i,y),ve(i,l),ve(i,u),ve(i,f),ve(i,o)},p(S,y){y&2&&n!==(n=S[10]+"")&&Li(l,n),y&2&&d!==(d=S[11]+"")&&Li(f,d),y&2&&_!==(_=S[10])&&(i.__value=_,Wr(i,i.__value)),y&2&&T!==(T=S[11]==0)&&(i.disabled=T)},d(S){S&&we(i)}}}function J_(s){let i,n=s[1][s[0]]+"",l,u;return{c(){i=Ae("p"),l=kt(n),u=kt(" problems")},m(d,f){xe(d,i,f),ve(i,l),ve(i,u)},p(d,f){f&3&&n!==(n=d[1][d[0]]+"")&&Li(l,n)},d(d){d&&we(i)}}}function Vk(s){let i;return{c(){i=Ae("p"),i.textContent=`These roads have separate sidewalks tagged on one side, but the other
        side is unspecified or not drawn separately. Be consistent on each road
        and use another editor to draw separate sidewalks on both sides.`},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function qk(s){let i;return{c(){i=Ae("p"),i.innerHTML=`<i>sidewalk=separate</i>
         is ambiguous. Update the tagging to specify if there are separate sidewalks
        on both sides or just one.`},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function Zk(s){let i,n,l,u,d;return{c(){i=Ae("p"),i.textContent=`These roads aren't tagged as having separate sidewalks, but it looks
        like there's a parallel separate sidewalk already mapped.`,n=$e(),l=Ae("ol"),l.innerHTML=`<li>Check each segment. If separate sidewalks are already there, update
          the tagging here.</li> <li>If the separate sidewalks don&#39;t cover the entire length of the road,
          ideally go finish drawing the separate sidewalks in another tool, then
          update the tagging on the road.</li>`,u=$e(),d=Ae("p"),d.textContent="There are false positives. Check the full length of the road."},m(f,o){xe(f,i,o),xe(f,n,o),xe(f,l,o),xe(f,u,o),xe(f,d,o)},d(f){f&&(we(i),we(n),we(l),we(u),we(d))}}}function Wk(s){let i,n,l;return{c(){i=Ae("p"),i.innerHTML=`Here are footways with a crossing node, but the way needs to be split
        and tagged as <i>footway=crossing</i>
        .`,n=$e(),l=Ae("ol"),l.innerHTML=`<li>Open in another editor</li> <li>Split the way around the crossing</li> <li>Tag <i>footway=crossing</i>
           on the smaller segment</li> <li>Refresh the data here to verify</li>`},m(u,d){xe(u,i,d),xe(u,n,d),xe(u,l,d)},d(u){u&&(we(i),we(n),we(l))}}}function Gk(s){let i,n,l,u,d;return{c(){i=Ae("p"),i.textContent=`Here are places where part of a road has separate sidewalks tagged, but
        then the next part of the road doesn't. It's best to be consistent about
        separate sidewalks along the entire length of a road. To fix:`,n=$e(),l=Ae("ol"),l.innerHTML=`<li>Go map separate sidewalks along the entire road (in another editor)</li> <li>Update the road tagging to indicate those separate sidewalks (here or
          in another editor)</li> <li>Refresh the data here to verify</li>`,u=$e(),d=Ae("p"),d.textContent=`(This problem is detected when the road names are the same, so there are
        some false positives you can ignore.)`},m(f,o){xe(f,i,o),xe(f,n,o),xe(f,l,o),xe(f,u,o),xe(f,d,o)},d(f){f&&(we(i),we(n),we(l),we(u),we(d))}}}function Hk(s){let i;return{c(){i=Ae("p"),i.textContent=`When a crossing way hits a road, the node should be tagged as a
        crossing. Instructions to fix are TODO.`},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function Xk(s){let i,n,l,u,d,f,o,_=Ki(Object.entries(s[1])),T=[];for(let C=0;C<_.length;C+=1)T[C]=K_(X_(s,_,C));let S=s[0]&&J_(s);function y(C,L){if(C[0]=="missing crossing node")return Hk;if(C[0]=="separate sidewalks should be continued here")return Gk;if(C[0]=="missing footway=crossing")return Wk;if(C[0]=="possible separate sidewalk near way without it tagged")return Zk;if(C[0]=="sidewalk=separate is ambiguous about the side")return qk;if(C[0]=="sidewalk:left and sidewalk:right should each be tagged as separate or no")return Vk}let k=y(s),I=k&&k(s);return{c(){i=Ae("div"),n=Ae("select"),l=Ae("option"),l.textContent="Show a type of problem";for(let C=0;C<T.length;C+=1)T[C].c();u=$e(),S&&S.c(),d=$e(),I&&I.c(),l.__value="",Wr(l,l.__value),be(n,"class","form-select"),s[0]===void 0&&sh(()=>s[5].call(n)),be(i,"slot","body")},m(C,L){xe(C,i,L),ve(i,n),ve(n,l);for(let N=0;N<T.length;N+=1)T[N]&&T[N].m(n,null);lf(n,s[0],!0),ve(i,u),S&&S.m(i,null),ve(i,d),I&&I.m(i,null),f||(o=Jt(n,"change",s[5]),f=!0)},p(C,L){if(L&2){_=Ki(Object.entries(C[1]));let N;for(N=0;N<_.length;N+=1){const R=X_(C,_,N);T[N]?T[N].p(R,L):(T[N]=K_(R),T[N].c(),T[N].m(n,null))}for(;N<T.length;N+=1)T[N].d(1);T.length=_.length}L&3&&lf(n,C[0]),C[0]?S?S.p(C,L):(S=J_(C),S.c(),S.m(i,d)):S&&(S.d(1),S=null),k!==(k=y(C))&&(I&&I.d(1),I=k&&k(C),I&&(I.c(),I.m(i,null)))},d(C){C&&we(i),xr(T,C),S&&S.d(),I&&I.d(),f=!1,o()}}}function Kk(s){let i,n;return i=new Tf({props:{$$slots:{body:[Xk],header:[Uk]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,[u]){const d={};u&16387&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function Jk(s,i,n){let l,{nodes:u}=i,{ways:d}=i,{drawProblems:f}=i,o=["missing crossing node","separate sidewalks should be continued here"],_=["missing footway=crossing","possible separate sidewalk near way without it tagged","sidewalk=separate is ambiguous about the side","sidewalk:left and sidewalk:right should each be tagged as separate or no"],T="";function S(I,C){let L={};for(let N of[...o,..._])L[N]=0;for(let N of[...u.features,...d.features])for(let R of N.properties.problems)L[R.note]+=1;return L}function y(I,C,L){let N={type:"FeatureCollection",features:[]};for(let R of[...u.features,...d.features])R.properties.problems.some(z=>z.note==T)&&N.features.push(R);return N}function k(){T=Gy(this),n(0,T),n(1,l),n(3,u),n(4,d)}return s.$$set=I=>{"nodes"in I&&n(3,u=I.nodes),"ways"in I&&n(4,d=I.ways),"drawProblems"in I&&n(2,f=I.drawProblems)},s.$$.update=()=>{s.$$.dirty&24&&n(1,l=S()),s.$$.dirty&25&&n(2,f=y())},[T,l,f,u,d,k]}class Yk extends di{constructor(i){super(),fi(this,i,Jk,Kk,si,{nodes:3,ways:4,drawProblems:2})}}function Qk(s){let i,n,l,u,d,f;return i=new $c({props:{filter:Y0,paint:{"circle-radius":10,"circle-color":"red","circle-opacity":.5,"circle-stroke-color":"black","circle-stroke-width":1}}}),l=new il({props:{filter:Hd,maxzoom:16,paint:{"line-width":tl(15),"line-color":"red","line-opacity":s[2],"line-blur":5},layout:{visibility:s[1]?"none":"visible"}}}),d=new il({props:{filter:Hd,beforeId:"Road labels",minzoom:16,paint:{"line-width":tl(20),"line-color":"red","line-opacity":s[2],"line-blur":5},layout:{visibility:s[1]?"none":"visible"}}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment),u=$e(),yt(d.$$.fragment)},m(o,_){gt(i,o,_),xe(o,n,_),gt(l,o,_),xe(o,u,_),gt(d,o,_),f=!0},p(o,_){const T={};_&4&&(T.paint={"line-width":tl(15),"line-color":"red","line-opacity":o[2],"line-blur":5}),_&2&&(T.layout={visibility:o[1]?"none":"visible"}),l.$set(T);const S={};_&4&&(S.paint={"line-width":tl(20),"line-color":"red","line-opacity":o[2],"line-blur":5}),_&2&&(S.layout={visibility:o[1]?"none":"visible"}),d.$set(S)},i(o){f||(Re(i.$$.fragment,o),Re(l.$$.fragment,o),Re(d.$$.fragment,o),f=!0)},o(o){Ve(i.$$.fragment,o),Ve(l.$$.fragment,o),Ve(d.$$.fragment,o),f=!1},d(o){o&&(we(n),we(u)),_t(i,o),_t(l,o),_t(d,o)}}}function $k(s){let i,n;return i=new cs({props:{data:s[0],$$slots:{default:[Qk]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,[u]){const d={};u&1&&(d.data=l[0]),u&22&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function eC(s,i,n){let{drawProblems:l}=i,{pinnedWay:u}=i,d=.5;function f(o){let _=2500,T=.35,S=.85,y=(Math.sin(o/_*Math.PI*2)+1)/2;n(2,d=T+y*(S-T)),requestAnimationFrame(f)}return requestAnimationFrame(f),s.$$set=o=>{"drawProblems"in o&&n(0,l=o.drawProblems),"pinnedWay"in o&&n(1,u=o.pinnedWay)},[l,u,d]}class tC extends di{constructor(i){super(),fi(this,i,eC,$k,si,{drawProblems:0,pinnedWay:1})}}function iC(s){var k;let i,n,l,u,d=Y_((k=s[1])==null?void 0:k.getOsmTimestamp())+"",f,o,_,T,S,y;return i=new Yc({props:{loading:s[0]}}),{c(){yt(i.$$.fragment),n=$e(),l=Ae("p"),u=kt("OSM data is from "),f=kt(d),o=$e(),_=Ae("button"),_.textContent="Refresh OSM data",be(_,"class","btn btn-secondary mb-3")},m(I,C){gt(i,I,C),xe(I,n,C),xe(I,l,C),ve(l,u),ve(l,f),xe(I,o,C),xe(I,_,C),T=!0,S||(y=Jt(_,"click",s[2]),S=!0)},p(I,[C]){var N;const L={};C&1&&(L.loading=I[0]),i.$set(L),(!T||C&2)&&d!==(d=Y_((N=I[1])==null?void 0:N.getOsmTimestamp())+"")&&Li(f,d)},i(I){T||(Re(i.$$.fragment,I),T=!0)},o(I){Ve(i.$$.fragment,I),T=!1},d(I){I&&(we(n),we(l),we(o),we(_)),_t(i,I),S=!1,y()}}}function Y_(s){if(s){let i=new Date(1e3*Number(s));return`${i.toLocaleString()} (${nC(i)} ago)`}return"unknown"}function nC(s){let i=Date.now()-s.getTime(),n=Math.floor(i/1e3),l=Math.floor(n/60),u=Math.floor(l/60),d=Math.floor(u/24);return d?d==1?"1 day":`${d} days`:u?u==1?"1 hour":`${u} hours`:l?l==1?"1 minute":`${l} minutes`:"a few seconds"}function rC(s,i,n){let l;Qt(s,ur,o=>n(1,l=o));let{anyEdits:u}=i,d="";async function f(){if(!(u&&!window.confirm("Refreshing OSM data will discard your current edits. Do you want to clear the edits?")))try{n(0,d="Grabbing new OSM data from Overpass");let o=JSON.parse(l.getBoundary()),_=rb(o),T=await fetch(_);if(!T.ok)throw new Error(`Overpass failed: ${T}`);let S=await T.bytes();n(0,d="Processing Overpass data"),await Ro(),dn(ur,l=new oh(new Uint8Array(S),o),l)}catch(o){window.alert(`Couldn't import from Overpass: ${o}`)}finally{n(0,d="")}}return s.$$set=o=>{"anyEdits"in o&&n(3,u=o.anyEdits)},[d,l,f,u]}class sC extends di{constructor(i){super(),fi(this,i,rC,iC,si,{anyEdits:3})}}function tf(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var sb={exports:{}};(function(s,i){(function(n){s.exports=n()})(function(){return function(){function n(l,u,d){function f(T,S){if(!u[T]){if(!l[T]){var y=typeof tf=="function"&&tf;if(!S&&y)return y(T,!0);if(o)return o(T,!0);var k=new Error("Cannot find module '"+T+"'");throw k.code="MODULE_NOT_FOUND",k}var I=u[T]={exports:{}};l[T][0].call(I.exports,function(C){var L=l[T][1][C];return f(L||C)},I,I.exports,n,l,u,d)}return u[T].exports}for(var o=typeof tf=="function"&&tf,_=0;_<d.length;_++)f(d[_]);return f}return n}()({1:[function(n,l,u){u.byteLength=k,u.toByteArray=C,u.fromByteArray=R;for(var d=[],f=[],o=typeof Uint8Array<"u"?Uint8Array:Array,_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=0,S=_.length;T<S;++T)d[T]=_[T],f[_.charCodeAt(T)]=T;f[45]=62,f[95]=63;function y(z){var Z=z.length;if(Z%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var ie=z.indexOf("=");ie===-1&&(ie=Z);var ae=ie===Z?0:4-ie%4;return[ie,ae]}function k(z){var Z=y(z),ie=Z[0],ae=Z[1];return(ie+ae)*3/4-ae}function I(z,Z,ie){return(Z+ie)*3/4-ie}function C(z){var Z,ie=y(z),ae=ie[0],$=ie[1],re=new o(I(z,ae,$)),j=0,U=$>0?ae-4:ae,J;for(J=0;J<U;J+=4)Z=f[z.charCodeAt(J)]<<18|f[z.charCodeAt(J+1)]<<12|f[z.charCodeAt(J+2)]<<6|f[z.charCodeAt(J+3)],re[j++]=Z>>16&255,re[j++]=Z>>8&255,re[j++]=Z&255;return $===2&&(Z=f[z.charCodeAt(J)]<<2|f[z.charCodeAt(J+1)]>>4,re[j++]=Z&255),$===1&&(Z=f[z.charCodeAt(J)]<<10|f[z.charCodeAt(J+1)]<<4|f[z.charCodeAt(J+2)]>>2,re[j++]=Z>>8&255,re[j++]=Z&255),re}function L(z){return d[z>>18&63]+d[z>>12&63]+d[z>>6&63]+d[z&63]}function N(z,Z,ie){for(var ae,$=[],re=Z;re<ie;re+=3)ae=(z[re]<<16&16711680)+(z[re+1]<<8&65280)+(z[re+2]&255),$.push(L(ae));return $.join("")}function R(z){for(var Z,ie=z.length,ae=ie%3,$=[],re=16383,j=0,U=ie-ae;j<U;j+=re)$.push(N(z,j,j+re>U?U:j+re));return ae===1?(Z=z[ie-1],$.push(d[Z>>2]+d[Z<<4&63]+"==")):ae===2&&(Z=(z[ie-2]<<8)+z[ie-1],$.push(d[Z>>10]+d[Z>>4&63]+d[Z<<2&63]+"=")),$.join("")}},{}],2:[function(n,l,u){(function(d){(function(){var f=n("base64-js"),o=n("ieee754");u.Buffer=y,u.SlowBuffer=ae,u.INSPECT_MAX_BYTES=50;var _=2147483647;u.kMaxLength=_,y.TYPED_ARRAY_SUPPORT=T(),!y.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function T(){try{var he=new Uint8Array(1);return he.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},he.foo()===42}catch{return!1}}Object.defineProperty(y.prototype,"parent",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.buffer}}),Object.defineProperty(y.prototype,"offset",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.byteOffset}});function S(he){if(he>_)throw new RangeError('The value "'+he+'" is invalid for option "size"');var H=new Uint8Array(he);return H.__proto__=y.prototype,H}function y(he,H,Y){if(typeof he=="number"){if(typeof H=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return L(he)}return k(he,H,Y)}typeof Symbol<"u"&&Symbol.species!=null&&y[Symbol.species]===y&&Object.defineProperty(y,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),y.poolSize=8192;function k(he,H,Y){if(typeof he=="string")return N(he,H);if(ArrayBuffer.isView(he))return R(he);if(he==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof he);if(dt(he,ArrayBuffer)||he&&dt(he.buffer,ArrayBuffer))return z(he,H,Y);if(typeof he=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var Ee=he.valueOf&&he.valueOf();if(Ee!=null&&Ee!==he)return y.from(Ee,H,Y);var qe=Z(he);if(qe)return qe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof he[Symbol.toPrimitive]=="function")return y.from(he[Symbol.toPrimitive]("string"),H,Y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof he)}y.from=function(he,H,Y){return k(he,H,Y)},y.prototype.__proto__=Uint8Array.prototype,y.__proto__=Uint8Array;function I(he){if(typeof he!="number")throw new TypeError('"size" argument must be of type number');if(he<0)throw new RangeError('The value "'+he+'" is invalid for option "size"')}function C(he,H,Y){return I(he),he<=0?S(he):H!==void 0?typeof Y=="string"?S(he).fill(H,Y):S(he).fill(H):S(he)}y.alloc=function(he,H,Y){return C(he,H,Y)};function L(he){return I(he),S(he<0?0:ie(he)|0)}y.allocUnsafe=function(he){return L(he)},y.allocUnsafeSlow=function(he){return L(he)};function N(he,H){if((typeof H!="string"||H==="")&&(H="utf8"),!y.isEncoding(H))throw new TypeError("Unknown encoding: "+H);var Y=$(he,H)|0,Ee=S(Y),qe=Ee.write(he,H);return qe!==Y&&(Ee=Ee.slice(0,qe)),Ee}function R(he){for(var H=he.length<0?0:ie(he.length)|0,Y=S(H),Ee=0;Ee<H;Ee+=1)Y[Ee]=he[Ee]&255;return Y}function z(he,H,Y){if(H<0||he.byteLength<H)throw new RangeError('"offset" is outside of buffer bounds');if(he.byteLength<H+(Y||0))throw new RangeError('"length" is outside of buffer bounds');var Ee;return H===void 0&&Y===void 0?Ee=new Uint8Array(he):Y===void 0?Ee=new Uint8Array(he,H):Ee=new Uint8Array(he,H,Y),Ee.__proto__=y.prototype,Ee}function Z(he){if(y.isBuffer(he)){var H=ie(he.length)|0,Y=S(H);return Y.length===0||he.copy(Y,0,0,H),Y}if(he.length!==void 0)return typeof he.length!="number"||et(he.length)?S(0):R(he);if(he.type==="Buffer"&&Array.isArray(he.data))return R(he.data)}function ie(he){if(he>=_)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+_.toString(16)+" bytes");return he|0}function ae(he){return+he!=he&&(he=0),y.alloc(+he)}y.isBuffer=function(H){return H!=null&&H._isBuffer===!0&&H!==y.prototype},y.compare=function(H,Y){if(dt(H,Uint8Array)&&(H=y.from(H,H.offset,H.byteLength)),dt(Y,Uint8Array)&&(Y=y.from(Y,Y.offset,Y.byteLength)),!y.isBuffer(H)||!y.isBuffer(Y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(H===Y)return 0;for(var Ee=H.length,qe=Y.length,ut=0,st=Math.min(Ee,qe);ut<st;++ut)if(H[ut]!==Y[ut]){Ee=H[ut],qe=Y[ut];break}return Ee<qe?-1:qe<Ee?1:0},y.isEncoding=function(H){switch(String(H).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},y.concat=function(H,Y){if(!Array.isArray(H))throw new TypeError('"list" argument must be an Array of Buffers');if(H.length===0)return y.alloc(0);var Ee;if(Y===void 0)for(Y=0,Ee=0;Ee<H.length;++Ee)Y+=H[Ee].length;var qe=y.allocUnsafe(Y),ut=0;for(Ee=0;Ee<H.length;++Ee){var st=H[Ee];if(dt(st,Uint8Array)&&(st=y.from(st)),!y.isBuffer(st))throw new TypeError('"list" argument must be an Array of Buffers');st.copy(qe,ut),ut+=st.length}return qe};function $(he,H){if(y.isBuffer(he))return he.length;if(ArrayBuffer.isView(he)||dt(he,ArrayBuffer))return he.byteLength;if(typeof he!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof he);var Y=he.length,Ee=arguments.length>2&&arguments[2]===!0;if(!Ee&&Y===0)return 0;for(var qe=!1;;)switch(H){case"ascii":case"latin1":case"binary":return Y;case"utf8":case"utf-8":return Ge(he).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y*2;case"hex":return Y>>>1;case"base64":return Je(he).length;default:if(qe)return Ee?-1:Ge(he).length;H=(""+H).toLowerCase(),qe=!0}}y.byteLength=$;function re(he,H,Y){var Ee=!1;if((H===void 0||H<0)&&(H=0),H>this.length||((Y===void 0||Y>this.length)&&(Y=this.length),Y<=0)||(Y>>>=0,H>>>=0,Y<=H))return"";for(he||(he="utf8");;)switch(he){case"hex":return At(this,H,Y);case"utf8":case"utf-8":return Le(this,H,Y);case"ascii":return nt(this,H,Y);case"latin1":case"binary":return bt(this,H,Y);case"base64":return ce(this,H,Y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return tt(this,H,Y);default:if(Ee)throw new TypeError("Unknown encoding: "+he);he=(he+"").toLowerCase(),Ee=!0}}y.prototype._isBuffer=!0;function j(he,H,Y){var Ee=he[H];he[H]=he[Y],he[Y]=Ee}y.prototype.swap16=function(){var H=this.length;if(H%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Y=0;Y<H;Y+=2)j(this,Y,Y+1);return this},y.prototype.swap32=function(){var H=this.length;if(H%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Y=0;Y<H;Y+=4)j(this,Y,Y+3),j(this,Y+1,Y+2);return this},y.prototype.swap64=function(){var H=this.length;if(H%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Y=0;Y<H;Y+=8)j(this,Y,Y+7),j(this,Y+1,Y+6),j(this,Y+2,Y+5),j(this,Y+3,Y+4);return this},y.prototype.toString=function(){var H=this.length;return H===0?"":arguments.length===0?Le(this,0,H):re.apply(this,arguments)},y.prototype.toLocaleString=y.prototype.toString,y.prototype.equals=function(H){if(!y.isBuffer(H))throw new TypeError("Argument must be a Buffer");return this===H?!0:y.compare(this,H)===0},y.prototype.inspect=function(){var H="",Y=u.INSPECT_MAX_BYTES;return H=this.toString("hex",0,Y).replace(/(.{2})/g,"$1 ").trim(),this.length>Y&&(H+=" ... "),"<Buffer "+H+">"},y.prototype.compare=function(H,Y,Ee,qe,ut){if(dt(H,Uint8Array)&&(H=y.from(H,H.offset,H.byteLength)),!y.isBuffer(H))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof H);if(Y===void 0&&(Y=0),Ee===void 0&&(Ee=H?H.length:0),qe===void 0&&(qe=0),ut===void 0&&(ut=this.length),Y<0||Ee>H.length||qe<0||ut>this.length)throw new RangeError("out of range index");if(qe>=ut&&Y>=Ee)return 0;if(qe>=ut)return-1;if(Y>=Ee)return 1;if(Y>>>=0,Ee>>>=0,qe>>>=0,ut>>>=0,this===H)return 0;for(var st=ut-qe,ki=Ee-Y,lt=Math.min(st,ki),Vt=this.slice(qe,ut),Ci=H.slice(Y,Ee),Fi=0;Fi<lt;++Fi)if(Vt[Fi]!==Ci[Fi]){st=Vt[Fi],ki=Ci[Fi];break}return st<ki?-1:ki<st?1:0};function U(he,H,Y,Ee,qe){if(he.length===0)return-1;if(typeof Y=="string"?(Ee=Y,Y=0):Y>2147483647?Y=2147483647:Y<-2147483648&&(Y=-2147483648),Y=+Y,et(Y)&&(Y=qe?0:he.length-1),Y<0&&(Y=he.length+Y),Y>=he.length){if(qe)return-1;Y=he.length-1}else if(Y<0)if(qe)Y=0;else return-1;if(typeof H=="string"&&(H=y.from(H,Ee)),y.isBuffer(H))return H.length===0?-1:J(he,H,Y,Ee,qe);if(typeof H=="number")return H=H&255,typeof Uint8Array.prototype.indexOf=="function"?qe?Uint8Array.prototype.indexOf.call(he,H,Y):Uint8Array.prototype.lastIndexOf.call(he,H,Y):J(he,[H],Y,Ee,qe);throw new TypeError("val must be string, number or Buffer")}function J(he,H,Y,Ee,qe){var ut=1,st=he.length,ki=H.length;if(Ee!==void 0&&(Ee=String(Ee).toLowerCase(),Ee==="ucs2"||Ee==="ucs-2"||Ee==="utf16le"||Ee==="utf-16le")){if(he.length<2||H.length<2)return-1;ut=2,st/=2,ki/=2,Y/=2}function lt(xt,li){return ut===1?xt[li]:xt.readUInt16BE(li*ut)}var Vt;if(qe){var Ci=-1;for(Vt=Y;Vt<st;Vt++)if(lt(he,Vt)===lt(H,Ci===-1?0:Vt-Ci)){if(Ci===-1&&(Ci=Vt),Vt-Ci+1===ki)return Ci*ut}else Ci!==-1&&(Vt-=Vt-Ci),Ci=-1}else for(Y+ki>st&&(Y=st-ki),Vt=Y;Vt>=0;Vt--){for(var Fi=!0,Cn=0;Cn<ki;Cn++)if(lt(he,Vt+Cn)!==lt(H,Cn)){Fi=!1;break}if(Fi)return Vt}return-1}y.prototype.includes=function(H,Y,Ee){return this.indexOf(H,Y,Ee)!==-1},y.prototype.indexOf=function(H,Y,Ee){return U(this,H,Y,Ee,!0)},y.prototype.lastIndexOf=function(H,Y,Ee){return U(this,H,Y,Ee,!1)};function B(he,H,Y,Ee){Y=Number(Y)||0;var qe=he.length-Y;Ee?(Ee=Number(Ee),Ee>qe&&(Ee=qe)):Ee=qe;var ut=H.length;Ee>ut/2&&(Ee=ut/2);for(var st=0;st<Ee;++st){var ki=parseInt(H.substr(st*2,2),16);if(et(ki))return st;he[Y+st]=ki}return st}function W(he,H,Y,Ee){return gi(Ge(H,he.length-Y),he,Y,Ee)}function le(he,H,Y,Ee){return gi(Pt(H),he,Y,Ee)}function ge(he,H,Y,Ee){return le(he,H,Y,Ee)}function pe(he,H,Y,Ee){return gi(Je(H),he,Y,Ee)}function _e(he,H,Y,Ee){return gi(ii(H,he.length-Y),he,Y,Ee)}y.prototype.write=function(H,Y,Ee,qe){if(Y===void 0)qe="utf8",Ee=this.length,Y=0;else if(Ee===void 0&&typeof Y=="string")qe=Y,Ee=this.length,Y=0;else if(isFinite(Y))Y=Y>>>0,isFinite(Ee)?(Ee=Ee>>>0,qe===void 0&&(qe="utf8")):(qe=Ee,Ee=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var ut=this.length-Y;if((Ee===void 0||Ee>ut)&&(Ee=ut),H.length>0&&(Ee<0||Y<0)||Y>this.length)throw new RangeError("Attempt to write outside buffer bounds");qe||(qe="utf8");for(var st=!1;;)switch(qe){case"hex":return B(this,H,Y,Ee);case"utf8":case"utf-8":return W(this,H,Y,Ee);case"ascii":return le(this,H,Y,Ee);case"latin1":case"binary":return ge(this,H,Y,Ee);case"base64":return pe(this,H,Y,Ee);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _e(this,H,Y,Ee);default:if(st)throw new TypeError("Unknown encoding: "+qe);qe=(""+qe).toLowerCase(),st=!0}},y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ce(he,H,Y){return H===0&&Y===he.length?f.fromByteArray(he):f.fromByteArray(he.slice(H,Y))}function Le(he,H,Y){Y=Math.min(he.length,Y);for(var Ee=[],qe=H;qe<Y;){var ut=he[qe],st=null,ki=ut>239?4:ut>223?3:ut>191?2:1;if(qe+ki<=Y){var lt,Vt,Ci,Fi;switch(ki){case 1:ut<128&&(st=ut);break;case 2:lt=he[qe+1],(lt&192)===128&&(Fi=(ut&31)<<6|lt&63,Fi>127&&(st=Fi));break;case 3:lt=he[qe+1],Vt=he[qe+2],(lt&192)===128&&(Vt&192)===128&&(Fi=(ut&15)<<12|(lt&63)<<6|Vt&63,Fi>2047&&(Fi<55296||Fi>57343)&&(st=Fi));break;case 4:lt=he[qe+1],Vt=he[qe+2],Ci=he[qe+3],(lt&192)===128&&(Vt&192)===128&&(Ci&192)===128&&(Fi=(ut&15)<<18|(lt&63)<<12|(Vt&63)<<6|Ci&63,Fi>65535&&Fi<1114112&&(st=Fi))}}st===null?(st=65533,ki=1):st>65535&&(st-=65536,Ee.push(st>>>10&1023|55296),st=56320|st&1023),Ee.push(st),qe+=ki}return ct(Ee)}var ze=4096;function ct(he){var H=he.length;if(H<=ze)return String.fromCharCode.apply(String,he);for(var Y="",Ee=0;Ee<H;)Y+=String.fromCharCode.apply(String,he.slice(Ee,Ee+=ze));return Y}function nt(he,H,Y){var Ee="";Y=Math.min(he.length,Y);for(var qe=H;qe<Y;++qe)Ee+=String.fromCharCode(he[qe]&127);return Ee}function bt(he,H,Y){var Ee="";Y=Math.min(he.length,Y);for(var qe=H;qe<Y;++qe)Ee+=String.fromCharCode(he[qe]);return Ee}function At(he,H,Y){var Ee=he.length;(!H||H<0)&&(H=0),(!Y||Y<0||Y>Ee)&&(Y=Ee);for(var qe="",ut=H;ut<Y;++ut)qe+=It(he[ut]);return qe}function tt(he,H,Y){for(var Ee=he.slice(H,Y),qe="",ut=0;ut<Ee.length;ut+=2)qe+=String.fromCharCode(Ee[ut]+Ee[ut+1]*256);return qe}y.prototype.slice=function(H,Y){var Ee=this.length;H=~~H,Y=Y===void 0?Ee:~~Y,H<0?(H+=Ee,H<0&&(H=0)):H>Ee&&(H=Ee),Y<0?(Y+=Ee,Y<0&&(Y=0)):Y>Ee&&(Y=Ee),Y<H&&(Y=H);var qe=this.subarray(H,Y);return qe.__proto__=y.prototype,qe};function vt(he,H,Y){if(he%1!==0||he<0)throw new RangeError("offset is not uint");if(he+H>Y)throw new RangeError("Trying to access beyond buffer length")}y.prototype.readUIntLE=function(H,Y,Ee){H=H>>>0,Y=Y>>>0,Ee||vt(H,Y,this.length);for(var qe=this[H],ut=1,st=0;++st<Y&&(ut*=256);)qe+=this[H+st]*ut;return qe},y.prototype.readUIntBE=function(H,Y,Ee){H=H>>>0,Y=Y>>>0,Ee||vt(H,Y,this.length);for(var qe=this[H+--Y],ut=1;Y>0&&(ut*=256);)qe+=this[H+--Y]*ut;return qe},y.prototype.readUInt8=function(H,Y){return H=H>>>0,Y||vt(H,1,this.length),this[H]},y.prototype.readUInt16LE=function(H,Y){return H=H>>>0,Y||vt(H,2,this.length),this[H]|this[H+1]<<8},y.prototype.readUInt16BE=function(H,Y){return H=H>>>0,Y||vt(H,2,this.length),this[H]<<8|this[H+1]},y.prototype.readUInt32LE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),(this[H]|this[H+1]<<8|this[H+2]<<16)+this[H+3]*16777216},y.prototype.readUInt32BE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),this[H]*16777216+(this[H+1]<<16|this[H+2]<<8|this[H+3])},y.prototype.readIntLE=function(H,Y,Ee){H=H>>>0,Y=Y>>>0,Ee||vt(H,Y,this.length);for(var qe=this[H],ut=1,st=0;++st<Y&&(ut*=256);)qe+=this[H+st]*ut;return ut*=128,qe>=ut&&(qe-=Math.pow(2,8*Y)),qe},y.prototype.readIntBE=function(H,Y,Ee){H=H>>>0,Y=Y>>>0,Ee||vt(H,Y,this.length);for(var qe=Y,ut=1,st=this[H+--qe];qe>0&&(ut*=256);)st+=this[H+--qe]*ut;return ut*=128,st>=ut&&(st-=Math.pow(2,8*Y)),st},y.prototype.readInt8=function(H,Y){return H=H>>>0,Y||vt(H,1,this.length),this[H]&128?(255-this[H]+1)*-1:this[H]},y.prototype.readInt16LE=function(H,Y){H=H>>>0,Y||vt(H,2,this.length);var Ee=this[H]|this[H+1]<<8;return Ee&32768?Ee|4294901760:Ee},y.prototype.readInt16BE=function(H,Y){H=H>>>0,Y||vt(H,2,this.length);var Ee=this[H+1]|this[H]<<8;return Ee&32768?Ee|4294901760:Ee},y.prototype.readInt32LE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),this[H]|this[H+1]<<8|this[H+2]<<16|this[H+3]<<24},y.prototype.readInt32BE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),this[H]<<24|this[H+1]<<16|this[H+2]<<8|this[H+3]},y.prototype.readFloatLE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),o.read(this,H,!0,23,4)},y.prototype.readFloatBE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),o.read(this,H,!1,23,4)},y.prototype.readDoubleLE=function(H,Y){return H=H>>>0,Y||vt(H,8,this.length),o.read(this,H,!0,52,8)},y.prototype.readDoubleBE=function(H,Y){return H=H>>>0,Y||vt(H,8,this.length),o.read(this,H,!1,52,8)};function St(he,H,Y,Ee,qe,ut){if(!y.isBuffer(he))throw new TypeError('"buffer" argument must be a Buffer instance');if(H>qe||H<ut)throw new RangeError('"value" argument is out of bounds');if(Y+Ee>he.length)throw new RangeError("Index out of range")}y.prototype.writeUIntLE=function(H,Y,Ee,qe){if(H=+H,Y=Y>>>0,Ee=Ee>>>0,!qe){var ut=Math.pow(2,8*Ee)-1;St(this,H,Y,Ee,ut,0)}var st=1,ki=0;for(this[Y]=H&255;++ki<Ee&&(st*=256);)this[Y+ki]=H/st&255;return Y+Ee},y.prototype.writeUIntBE=function(H,Y,Ee,qe){if(H=+H,Y=Y>>>0,Ee=Ee>>>0,!qe){var ut=Math.pow(2,8*Ee)-1;St(this,H,Y,Ee,ut,0)}var st=Ee-1,ki=1;for(this[Y+st]=H&255;--st>=0&&(ki*=256);)this[Y+st]=H/ki&255;return Y+Ee},y.prototype.writeUInt8=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,1,255,0),this[Y]=H&255,Y+1},y.prototype.writeUInt16LE=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,2,65535,0),this[Y]=H&255,this[Y+1]=H>>>8,Y+2},y.prototype.writeUInt16BE=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,2,65535,0),this[Y]=H>>>8,this[Y+1]=H&255,Y+2},y.prototype.writeUInt32LE=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,4,4294967295,0),this[Y+3]=H>>>24,this[Y+2]=H>>>16,this[Y+1]=H>>>8,this[Y]=H&255,Y+4},y.prototype.writeUInt32BE=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,4,4294967295,0),this[Y]=H>>>24,this[Y+1]=H>>>16,this[Y+2]=H>>>8,this[Y+3]=H&255,Y+4},y.prototype.writeIntLE=function(H,Y,Ee,qe){if(H=+H,Y=Y>>>0,!qe){var ut=Math.pow(2,8*Ee-1);St(this,H,Y,Ee,ut-1,-ut)}var st=0,ki=1,lt=0;for(this[Y]=H&255;++st<Ee&&(ki*=256);)H<0&&lt===0&&this[Y+st-1]!==0&&(lt=1),this[Y+st]=(H/ki>>0)-lt&255;return Y+Ee},y.prototype.writeIntBE=function(H,Y,Ee,qe){if(H=+H,Y=Y>>>0,!qe){var ut=Math.pow(2,8*Ee-1);St(this,H,Y,Ee,ut-1,-ut)}var st=Ee-1,ki=1,lt=0;for(this[Y+st]=H&255;--st>=0&&(ki*=256);)H<0&&lt===0&&this[Y+st+1]!==0&&(lt=1),this[Y+st]=(H/ki>>0)-lt&255;return Y+Ee},y.prototype.writeInt8=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,1,127,-128),H<0&&(H=255+H+1),this[Y]=H&255,Y+1},y.prototype.writeInt16LE=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,2,32767,-32768),this[Y]=H&255,this[Y+1]=H>>>8,Y+2},y.prototype.writeInt16BE=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,2,32767,-32768),this[Y]=H>>>8,this[Y+1]=H&255,Y+2},y.prototype.writeInt32LE=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,4,2147483647,-2147483648),this[Y]=H&255,this[Y+1]=H>>>8,this[Y+2]=H>>>16,this[Y+3]=H>>>24,Y+4},y.prototype.writeInt32BE=function(H,Y,Ee){return H=+H,Y=Y>>>0,Ee||St(this,H,Y,4,2147483647,-2147483648),H<0&&(H=4294967295+H+1),this[Y]=H>>>24,this[Y+1]=H>>>16,this[Y+2]=H>>>8,this[Y+3]=H&255,Y+4};function Zt(he,H,Y,Ee,qe,ut){if(Y+Ee>he.length)throw new RangeError("Index out of range");if(Y<0)throw new RangeError("Index out of range")}function oi(he,H,Y,Ee,qe){return H=+H,Y=Y>>>0,qe||Zt(he,H,Y,4),o.write(he,H,Y,Ee,23,4),Y+4}y.prototype.writeFloatLE=function(H,Y,Ee){return oi(this,H,Y,!0,Ee)},y.prototype.writeFloatBE=function(H,Y,Ee){return oi(this,H,Y,!1,Ee)};function Ai(he,H,Y,Ee,qe){return H=+H,Y=Y>>>0,qe||Zt(he,H,Y,8),o.write(he,H,Y,Ee,52,8),Y+8}y.prototype.writeDoubleLE=function(H,Y,Ee){return Ai(this,H,Y,!0,Ee)},y.prototype.writeDoubleBE=function(H,Y,Ee){return Ai(this,H,Y,!1,Ee)},y.prototype.copy=function(H,Y,Ee,qe){if(!y.isBuffer(H))throw new TypeError("argument should be a Buffer");if(Ee||(Ee=0),!qe&&qe!==0&&(qe=this.length),Y>=H.length&&(Y=H.length),Y||(Y=0),qe>0&&qe<Ee&&(qe=Ee),qe===Ee||H.length===0||this.length===0)return 0;if(Y<0)throw new RangeError("targetStart out of bounds");if(Ee<0||Ee>=this.length)throw new RangeError("Index out of range");if(qe<0)throw new RangeError("sourceEnd out of bounds");qe>this.length&&(qe=this.length),H.length-Y<qe-Ee&&(qe=H.length-Y+Ee);var ut=qe-Ee;if(this===H&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(Y,Ee,qe);else if(this===H&&Ee<Y&&Y<qe)for(var st=ut-1;st>=0;--st)H[st+Y]=this[st+Ee];else Uint8Array.prototype.set.call(H,this.subarray(Ee,qe),Y);return ut},y.prototype.fill=function(H,Y,Ee,qe){if(typeof H=="string"){if(typeof Y=="string"?(qe=Y,Y=0,Ee=this.length):typeof Ee=="string"&&(qe=Ee,Ee=this.length),qe!==void 0&&typeof qe!="string")throw new TypeError("encoding must be a string");if(typeof qe=="string"&&!y.isEncoding(qe))throw new TypeError("Unknown encoding: "+qe);if(H.length===1){var ut=H.charCodeAt(0);(qe==="utf8"&&ut<128||qe==="latin1")&&(H=ut)}}else typeof H=="number"&&(H=H&255);if(Y<0||this.length<Y||this.length<Ee)throw new RangeError("Out of range index");if(Ee<=Y)return this;Y=Y>>>0,Ee=Ee===void 0?this.length:Ee>>>0,H||(H=0);var st;if(typeof H=="number")for(st=Y;st<Ee;++st)this[st]=H;else{var ki=y.isBuffer(H)?H:y.from(H,qe),lt=ki.length;if(lt===0)throw new TypeError('The value "'+H+'" is invalid for argument "value"');for(st=0;st<Ee-Y;++st)this[st+Y]=ki[st%lt]}return this};var Mi=/[^+/0-9A-Za-z-_]/g;function Ti(he){if(he=he.split("=")[0],he=he.trim().replace(Mi,""),he.length<2)return"";for(;he.length%4!==0;)he=he+"=";return he}function It(he){return he<16?"0"+he.toString(16):he.toString(16)}function Ge(he,H){H=H||1/0;for(var Y,Ee=he.length,qe=null,ut=[],st=0;st<Ee;++st){if(Y=he.charCodeAt(st),Y>55295&&Y<57344){if(!qe){if(Y>56319){(H-=3)>-1&&ut.push(239,191,189);continue}else if(st+1===Ee){(H-=3)>-1&&ut.push(239,191,189);continue}qe=Y;continue}if(Y<56320){(H-=3)>-1&&ut.push(239,191,189),qe=Y;continue}Y=(qe-55296<<10|Y-56320)+65536}else qe&&(H-=3)>-1&&ut.push(239,191,189);if(qe=null,Y<128){if((H-=1)<0)break;ut.push(Y)}else if(Y<2048){if((H-=2)<0)break;ut.push(Y>>6|192,Y&63|128)}else if(Y<65536){if((H-=3)<0)break;ut.push(Y>>12|224,Y>>6&63|128,Y&63|128)}else if(Y<1114112){if((H-=4)<0)break;ut.push(Y>>18|240,Y>>12&63|128,Y>>6&63|128,Y&63|128)}else throw new Error("Invalid code point")}return ut}function Pt(he){for(var H=[],Y=0;Y<he.length;++Y)H.push(he.charCodeAt(Y)&255);return H}function ii(he,H){for(var Y,Ee,qe,ut=[],st=0;st<he.length&&!((H-=2)<0);++st)Y=he.charCodeAt(st),Ee=Y>>8,qe=Y%256,ut.push(qe),ut.push(Ee);return ut}function Je(he){return f.toByteArray(Ti(he))}function gi(he,H,Y,Ee){for(var qe=0;qe<Ee&&!(qe+Y>=H.length||qe>=he.length);++qe)H[qe+Y]=he[qe];return qe}function dt(he,H){return he instanceof H||he!=null&&he.constructor!=null&&he.constructor.name!=null&&he.constructor.name===H.name}function et(he){return he!==he}}).call(this)}).call(this,n("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:14}],3:[function(n,l,u){const d=n("./validator"),f=n("./xmlparser/XMLParser"),o=n("./xmlbuilder/json2xml");l.exports={XMLParser:f,XMLValidator:d,XMLBuilder:o}},{"./validator":5,"./xmlbuilder/json2xml":6,"./xmlparser/XMLParser":11}],4:[function(n,l,u){const d=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",f=d+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",o="["+d+"]["+f+"]*",_=new RegExp("^"+o+"$"),T=function(y,k){const I=[];let C=k.exec(y);for(;C;){const L=[];L.startIndex=k.lastIndex-C[0].length;const N=C.length;for(let R=0;R<N;R++)L.push(C[R]);I.push(L),C=k.exec(y)}return I},S=function(y){const k=_.exec(y);return!(k===null||typeof k>"u")};u.isExist=function(y){return typeof y<"u"},u.isEmptyObject=function(y){return Object.keys(y).length===0},u.merge=function(y,k,I){if(k){const C=Object.keys(k),L=C.length;for(let N=0;N<L;N++)I==="strict"?y[C[N]]=[k[C[N]]]:y[C[N]]=k[C[N]]}},u.getValue=function(y){return u.isExist(y)?y:""},u.isName=S,u.getAllMatches=T,u.nameRegexp=o},{}],5:[function(n,l,u){const d=n("./util"),f={allowBooleanAttributes:!1,unpairedTags:[]};u.validate=function($,re){re=Object.assign({},f,re);const j=[];let U=!1,J=!1;$[0]==="\uFEFF"&&($=$.substr(1));for(let B=0;B<$.length;B++)if($[B]==="<"&&$[B+1]==="?"){if(B+=2,B=_($,B),B.err)return B}else if($[B]==="<"){let W=B;if(B++,$[B]==="!"){B=T($,B);continue}else{let le=!1;$[B]==="/"&&(le=!0,B++);let ge="";for(;B<$.length&&$[B]!==">"&&$[B]!==" "&&$[B]!=="	"&&$[B]!==`
`&&$[B]!=="\r";B++)ge+=$[B];if(ge=ge.trim(),ge[ge.length-1]==="/"&&(ge=ge.substring(0,ge.length-1),B--),!Z(ge)){let ce;return ge.trim().length===0?ce="Invalid space after '<'.":ce="Tag '"+ge+"' is an invalid name.",R("InvalidTag",ce,ie($,B))}const pe=k($,B);if(pe===!1)return R("InvalidAttr","Attributes for '"+ge+"' have open quote.",ie($,B));let _e=pe.value;if(B=pe.index,_e[_e.length-1]==="/"){const ce=B-_e.length;_e=_e.substring(0,_e.length-1);const Le=C(_e,re);if(Le===!0)U=!0;else return R(Le.err.code,Le.err.msg,ie($,ce+Le.err.line))}else if(le)if(pe.tagClosed){if(_e.trim().length>0)return R("InvalidTag","Closing tag '"+ge+"' can't have attributes or invalid starting.",ie($,W));if(j.length===0)return R("InvalidTag","Closing tag '"+ge+"' has not been opened.",ie($,W));{const ce=j.pop();if(ge!==ce.tagName){let Le=ie($,ce.tagStartPos);return R("InvalidTag","Expected closing tag '"+ce.tagName+"' (opened in line "+Le.line+", col "+Le.col+") instead of closing tag '"+ge+"'.",ie($,W))}j.length==0&&(J=!0)}}else return R("InvalidTag","Closing tag '"+ge+"' doesn't have proper closing.",ie($,B));else{const ce=C(_e,re);if(ce!==!0)return R(ce.err.code,ce.err.msg,ie($,B-_e.length+ce.err.line));if(J===!0)return R("InvalidXml","Multiple possible root nodes found.",ie($,B));re.unpairedTags.indexOf(ge)!==-1||j.push({tagName:ge,tagStartPos:W}),U=!0}for(B++;B<$.length;B++)if($[B]==="<")if($[B+1]==="!"){B++,B=T($,B);continue}else if($[B+1]==="?"){if(B=_($,++B),B.err)return B}else break;else if($[B]==="&"){const ce=N($,B);if(ce==-1)return R("InvalidChar","char '&' is not expected.",ie($,B));B=ce}else if(J===!0&&!o($[B]))return R("InvalidXml","Extra text at the end",ie($,B));$[B]==="<"&&B--}}else{if(o($[B]))continue;return R("InvalidChar","char '"+$[B]+"' is not expected.",ie($,B))}if(U){if(j.length==1)return R("InvalidTag","Unclosed tag '"+j[0].tagName+"'.",ie($,j[0].tagStartPos));if(j.length>0)return R("InvalidXml","Invalid '"+JSON.stringify(j.map(B=>B.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return R("InvalidXml","Start tag expected.",1);return!0};function o($){return $===" "||$==="	"||$===`
`||$==="\r"}function _($,re){const j=re;for(;re<$.length;re++)if($[re]=="?"||$[re]==" "){const U=$.substr(j,re-j);if(re>5&&U==="xml")return R("InvalidXml","XML declaration allowed only at the start of the document.",ie($,re));if($[re]=="?"&&$[re+1]==">"){re++;break}else continue}return re}function T($,re){if($.length>re+5&&$[re+1]==="-"&&$[re+2]==="-"){for(re+=3;re<$.length;re++)if($[re]==="-"&&$[re+1]==="-"&&$[re+2]===">"){re+=2;break}}else if($.length>re+8&&$[re+1]==="D"&&$[re+2]==="O"&&$[re+3]==="C"&&$[re+4]==="T"&&$[re+5]==="Y"&&$[re+6]==="P"&&$[re+7]==="E"){let j=1;for(re+=8;re<$.length;re++)if($[re]==="<")j++;else if($[re]===">"&&(j--,j===0))break}else if($.length>re+9&&$[re+1]==="["&&$[re+2]==="C"&&$[re+3]==="D"&&$[re+4]==="A"&&$[re+5]==="T"&&$[re+6]==="A"&&$[re+7]==="["){for(re+=8;re<$.length;re++)if($[re]==="]"&&$[re+1]==="]"&&$[re+2]===">"){re+=2;break}}return re}const S='"',y="'";function k($,re){let j="",U="",J=!1;for(;re<$.length;re++){if($[re]===S||$[re]===y)U===""?U=$[re]:U!==$[re]||(U="");else if($[re]===">"&&U===""){J=!0;break}j+=$[re]}return U!==""?!1:{value:j,index:re,tagClosed:J}}const I=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function C($,re){const j=d.getAllMatches($,I),U={};for(let J=0;J<j.length;J++){if(j[J][1].length===0)return R("InvalidAttr","Attribute '"+j[J][2]+"' has no space in starting.",ae(j[J]));if(j[J][3]!==void 0&&j[J][4]===void 0)return R("InvalidAttr","Attribute '"+j[J][2]+"' is without value.",ae(j[J]));if(j[J][3]===void 0&&!re.allowBooleanAttributes)return R("InvalidAttr","boolean attribute '"+j[J][2]+"' is not allowed.",ae(j[J]));const B=j[J][2];if(!z(B))return R("InvalidAttr","Attribute '"+B+"' is an invalid name.",ae(j[J]));if(!U.hasOwnProperty(B))U[B]=1;else return R("InvalidAttr","Attribute '"+B+"' is repeated.",ae(j[J]))}return!0}function L($,re){let j=/\d/;for($[re]==="x"&&(re++,j=/[\da-fA-F]/);re<$.length;re++){if($[re]===";")return re;if(!$[re].match(j))break}return-1}function N($,re){if(re++,$[re]===";")return-1;if($[re]==="#")return re++,L($,re);let j=0;for(;re<$.length;re++,j++)if(!($[re].match(/\w/)&&j<20)){if($[re]===";")break;return-1}return re}function R($,re,j){return{err:{code:$,msg:re,line:j.line||j,col:j.col}}}function z($){return d.isName($)}function Z($){return d.isName($)}function ie($,re){const j=$.substring(0,re).split(/\r?\n/);return{line:j.length,col:j[j.length-1].length+1}}function ae($){return $.startIndex+$[1].length}},{"./util":4}],6:[function(n,l,u){const d=n("./orderedJs2Xml"),f={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(y,k){return k},attributeValueProcessor:function(y,k){return k},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function o(y){this.options=Object.assign({},f,y),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=S),this.processTextOrObjNode=_,this.options.format?(this.indentate=T,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}o.prototype.build=function(y){return this.options.preserveOrder?d(y,this.options):(Array.isArray(y)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(y={[this.options.arrayNodeName]:y}),this.j2x(y,0).val)},o.prototype.j2x=function(y,k){let I="",C="";for(let L in y)if(Object.prototype.hasOwnProperty.call(y,L))if(typeof y[L]>"u")this.isAttribute(L)&&(C+="");else if(y[L]===null)this.isAttribute(L)?C+="":L[0]==="?"?C+=this.indentate(k)+"<"+L+"?"+this.tagEndChar:C+=this.indentate(k)+"<"+L+"/"+this.tagEndChar;else if(y[L]instanceof Date)C+=this.buildTextValNode(y[L],L,"",k);else if(typeof y[L]!="object"){const N=this.isAttribute(L);if(N)I+=this.buildAttrPairStr(N,""+y[L]);else if(L===this.options.textNodeName){let R=this.options.tagValueProcessor(L,""+y[L]);C+=this.replaceEntitiesValue(R)}else C+=this.buildTextValNode(y[L],L,"",k)}else if(Array.isArray(y[L])){const N=y[L].length;let R="",z="";for(let Z=0;Z<N;Z++){const ie=y[L][Z];if(!(typeof ie>"u"))if(ie===null)L[0]==="?"?C+=this.indentate(k)+"<"+L+"?"+this.tagEndChar:C+=this.indentate(k)+"<"+L+"/"+this.tagEndChar;else if(typeof ie=="object")if(this.options.oneListGroup){const ae=this.j2x(ie,k+1);R+=ae.val,this.options.attributesGroupName&&ie.hasOwnProperty(this.options.attributesGroupName)&&(z+=ae.attrStr)}else R+=this.processTextOrObjNode(ie,L,k);else if(this.options.oneListGroup){let ae=this.options.tagValueProcessor(L,ie);ae=this.replaceEntitiesValue(ae),R+=ae}else R+=this.buildTextValNode(ie,L,"",k)}this.options.oneListGroup&&(R=this.buildObjectNode(R,L,z,k)),C+=R}else if(this.options.attributesGroupName&&L===this.options.attributesGroupName){const N=Object.keys(y[L]),R=N.length;for(let z=0;z<R;z++)I+=this.buildAttrPairStr(N[z],""+y[L][N[z]])}else C+=this.processTextOrObjNode(y[L],L,k);return{attrStr:I,val:C}},o.prototype.buildAttrPairStr=function(y,k){return k=this.options.attributeValueProcessor(y,""+k),k=this.replaceEntitiesValue(k),this.options.suppressBooleanAttributes&&k==="true"?" "+y:" "+y+'="'+k+'"'};function _(y,k,I){const C=this.j2x(y,I+1);return y[this.options.textNodeName]!==void 0&&Object.keys(y).length===1?this.buildTextValNode(y[this.options.textNodeName],k,C.attrStr,I):this.buildObjectNode(C.val,k,C.attrStr,I)}o.prototype.buildObjectNode=function(y,k,I,C){if(y==="")return k[0]==="?"?this.indentate(C)+"<"+k+I+"?"+this.tagEndChar:this.indentate(C)+"<"+k+I+this.closeTag(k)+this.tagEndChar;{let L="</"+k+this.tagEndChar,N="";return k[0]==="?"&&(N="?",L=""),(I||I==="")&&y.indexOf("<")===-1?this.indentate(C)+"<"+k+I+N+">"+y+L:this.options.commentPropName!==!1&&k===this.options.commentPropName&&N.length===0?this.indentate(C)+`<!--${y}-->`+this.newLine:this.indentate(C)+"<"+k+I+N+this.tagEndChar+y+this.indentate(C)+L}},o.prototype.closeTag=function(y){let k="";return this.options.unpairedTags.indexOf(y)!==-1?this.options.suppressUnpairedNode||(k="/"):this.options.suppressEmptyNode?k="/":k=`></${y}`,k},o.prototype.buildTextValNode=function(y,k,I,C){if(this.options.cdataPropName!==!1&&k===this.options.cdataPropName)return this.indentate(C)+`<![CDATA[${y}]]>`+this.newLine;if(this.options.commentPropName!==!1&&k===this.options.commentPropName)return this.indentate(C)+`<!--${y}-->`+this.newLine;if(k[0]==="?")return this.indentate(C)+"<"+k+I+"?"+this.tagEndChar;{let L=this.options.tagValueProcessor(k,y);return L=this.replaceEntitiesValue(L),L===""?this.indentate(C)+"<"+k+I+this.closeTag(k)+this.tagEndChar:this.indentate(C)+"<"+k+I+">"+L+"</"+k+this.tagEndChar}},o.prototype.replaceEntitiesValue=function(y){if(y&&y.length>0&&this.options.processEntities)for(let k=0;k<this.options.entities.length;k++){const I=this.options.entities[k];y=y.replace(I.regex,I.val)}return y};function T(y){return this.options.indentBy.repeat(y)}function S(y){return y.startsWith(this.options.attributeNamePrefix)&&y!==this.options.textNodeName?y.substr(this.attrPrefixLen):!1}l.exports=o},{"./orderedJs2Xml":7}],7:[function(n,l,u){const d=`
`;function f(k,I){let C="";return I.format&&I.indentBy.length>0&&(C=d),o(k,I,"",C)}function o(k,I,C,L){let N="",R=!1;for(let z=0;z<k.length;z++){const Z=k[z],ie=_(Z);if(ie===void 0)continue;let ae="";if(C.length===0?ae=ie:ae=`${C}.${ie}`,ie===I.textNodeName){let J=Z[ie];S(ae,I)||(J=I.tagValueProcessor(ie,J),J=y(J,I)),R&&(N+=L),N+=J,R=!1;continue}else if(ie===I.cdataPropName){R&&(N+=L),N+=`<![CDATA[${Z[ie][0][I.textNodeName]}]]>`,R=!1;continue}else if(ie===I.commentPropName){N+=L+`<!--${Z[ie][0][I.textNodeName]}-->`,R=!0;continue}else if(ie[0]==="?"){const J=T(Z[":@"],I),B=ie==="?xml"?"":L;let W=Z[ie][0][I.textNodeName];W=W.length!==0?" "+W:"",N+=B+`<${ie}${W}${J}?>`,R=!0;continue}let $=L;$!==""&&($+=I.indentBy);const re=T(Z[":@"],I),j=L+`<${ie}${re}`,U=o(Z[ie],I,ae,$);I.unpairedTags.indexOf(ie)!==-1?I.suppressUnpairedNode?N+=j+">":N+=j+"/>":(!U||U.length===0)&&I.suppressEmptyNode?N+=j+"/>":U&&U.endsWith(">")?N+=j+`>${U}${L}</${ie}>`:(N+=j+">",U&&L!==""&&(U.includes("/>")||U.includes("</"))?N+=L+I.indentBy+U+L:N+=U,N+=`</${ie}>`),R=!0}return N}function _(k){const I=Object.keys(k);for(let C=0;C<I.length;C++){const L=I[C];if(k.hasOwnProperty(L)&&L!==":@")return L}}function T(k,I){let C="";if(k&&!I.ignoreAttributes)for(let L in k){if(!k.hasOwnProperty(L))continue;let N=I.attributeValueProcessor(L,k[L]);N=y(N,I),N===!0&&I.suppressBooleanAttributes?C+=` ${L.substr(I.attributeNamePrefix.length)}`:C+=` ${L.substr(I.attributeNamePrefix.length)}="${N}"`}return C}function S(k,I){k=k.substr(0,k.length-I.textNodeName.length-1);let C=k.substr(k.lastIndexOf(".")+1);for(let L in I.stopNodes)if(I.stopNodes[L]===k||I.stopNodes[L]==="*."+C)return!0;return!1}function y(k,I){if(k&&k.length>0&&I.processEntities)for(let C=0;C<I.entities.length;C++){const L=I.entities[C];k=k.replace(L.regex,L.val)}return k}l.exports=f},{}],8:[function(n,l,u){const d=n("../util");function f(C,L){const N={};if(C[L+3]==="O"&&C[L+4]==="C"&&C[L+5]==="T"&&C[L+6]==="Y"&&C[L+7]==="P"&&C[L+8]==="E"){L=L+9;let R=1,z=!1,Z=!1,ie="";for(;L<C.length;L++)if(C[L]==="<"&&!Z){if(z&&T(C,L))L+=7,[entityName,val,L]=o(C,L+1),val.indexOf("&")===-1&&(N[I(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(z&&S(C,L))L+=8;else if(z&&y(C,L))L+=8;else if(z&&k(C,L))L+=9;else if(_)Z=!0;else throw new Error("Invalid DOCTYPE");R++,ie=""}else if(C[L]===">"){if(Z?C[L-1]==="-"&&C[L-2]==="-"&&(Z=!1,R--):R--,R===0)break}else C[L]==="["?z=!0:ie+=C[L];if(R!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:N,i:L}}function o(C,L){let N="";for(;L<C.length&&C[L]!=="'"&&C[L]!=='"';L++)N+=C[L];if(N=N.trim(),N.indexOf(" ")!==-1)throw new Error("External entites are not supported");const R=C[L++];let z="";for(;L<C.length&&C[L]!==R;L++)z+=C[L];return[N,z,L]}function _(C,L){return C[L+1]==="!"&&C[L+2]==="-"&&C[L+3]==="-"}function T(C,L){return C[L+1]==="!"&&C[L+2]==="E"&&C[L+3]==="N"&&C[L+4]==="T"&&C[L+5]==="I"&&C[L+6]==="T"&&C[L+7]==="Y"}function S(C,L){return C[L+1]==="!"&&C[L+2]==="E"&&C[L+3]==="L"&&C[L+4]==="E"&&C[L+5]==="M"&&C[L+6]==="E"&&C[L+7]==="N"&&C[L+8]==="T"}function y(C,L){return C[L+1]==="!"&&C[L+2]==="A"&&C[L+3]==="T"&&C[L+4]==="T"&&C[L+5]==="L"&&C[L+6]==="I"&&C[L+7]==="S"&&C[L+8]==="T"}function k(C,L){return C[L+1]==="!"&&C[L+2]==="N"&&C[L+3]==="O"&&C[L+4]==="T"&&C[L+5]==="A"&&C[L+6]==="T"&&C[L+7]==="I"&&C[L+8]==="O"&&C[L+9]==="N"}function I(C){if(d.isName(C))return C;throw new Error(`Invalid entity name ${C}`)}l.exports=f},{"../util":4}],9:[function(n,l,u){const d={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(o,_){return _},attributeValueProcessor:function(o,_){return _},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(o,_,T){return o}},f=function(o){return Object.assign({},d,o)};u.buildOptions=f,u.defaultOptions=d},{}],10:[function(n,l,u){const d=n("../util"),f=n("./xmlNode"),o=n("./DocTypeReader"),_=n("strnum");class T{constructor(J){this.options=J,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(B,W)=>String.fromCharCode(Number.parseInt(W,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(B,W)=>String.fromCharCode(Number.parseInt(W,16))}},this.addExternalEntities=S,this.parseXml=L,this.parseTextData=y,this.resolveNameSpace=k,this.buildAttributesMap=C,this.isItStopNode=Z,this.replaceEntitiesValue=R,this.readStopNodeData=re,this.saveTextToParentTag=z,this.addChild=N}}function S(U){const J=Object.keys(U);for(let B=0;B<J.length;B++){const W=J[B];this.lastEntities[W]={regex:new RegExp("&"+W+";","g"),val:U[W]}}}function y(U,J,B,W,le,ge,pe){if(U!==void 0&&(this.options.trimValues&&!W&&(U=U.trim()),U.length>0)){pe||(U=this.replaceEntitiesValue(U));const _e=this.options.tagValueProcessor(J,U,B,le,ge);return _e==null?U:typeof _e!=typeof U||_e!==U?_e:this.options.trimValues?j(U,this.options.parseTagValue,this.options.numberParseOptions):U.trim()===U?j(U,this.options.parseTagValue,this.options.numberParseOptions):U}}function k(U){if(this.options.removeNSPrefix){const J=U.split(":"),B=U.charAt(0)==="/"?"/":"";if(J[0]==="xmlns")return"";J.length===2&&(U=B+J[1])}return U}const I=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function C(U,J,B){if(!this.options.ignoreAttributes&&typeof U=="string"){const W=d.getAllMatches(U,I),le=W.length,ge={};for(let pe=0;pe<le;pe++){const _e=this.resolveNameSpace(W[pe][1]);let ce=W[pe][4],Le=this.options.attributeNamePrefix+_e;if(_e.length)if(this.options.transformAttributeName&&(Le=this.options.transformAttributeName(Le)),Le==="__proto__"&&(Le="#__proto__"),ce!==void 0){this.options.trimValues&&(ce=ce.trim()),ce=this.replaceEntitiesValue(ce);const ze=this.options.attributeValueProcessor(_e,ce,J);ze==null?ge[Le]=ce:typeof ze!=typeof ce||ze!==ce?ge[Le]=ze:ge[Le]=j(ce,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(ge[Le]=!0)}if(!Object.keys(ge).length)return;if(this.options.attributesGroupName){const pe={};return pe[this.options.attributesGroupName]=ge,pe}return ge}}const L=function(U){U=U.replace(/\r\n?/g,`
`);const J=new f("!xml");let B=J,W="",le="";for(let ge=0;ge<U.length;ge++)if(U[ge]==="<")if(U[ge+1]==="/"){const _e=ae(U,">",ge,"Closing Tag is not closed.");let ce=U.substring(ge+2,_e).trim();if(this.options.removeNSPrefix){const ct=ce.indexOf(":");ct!==-1&&(ce=ce.substr(ct+1))}this.options.transformTagName&&(ce=this.options.transformTagName(ce)),B&&(W=this.saveTextToParentTag(W,B,le));const Le=le.substring(le.lastIndexOf(".")+1);if(ce&&this.options.unpairedTags.indexOf(ce)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${ce}>`);let ze=0;Le&&this.options.unpairedTags.indexOf(Le)!==-1?(ze=le.lastIndexOf(".",le.lastIndexOf(".")-1),this.tagsNodeStack.pop()):ze=le.lastIndexOf("."),le=le.substring(0,ze),B=this.tagsNodeStack.pop(),W="",ge=_e}else if(U[ge+1]==="?"){let _e=$(U,ge,!1,"?>");if(!_e)throw new Error("Pi Tag is not closed.");if(W=this.saveTextToParentTag(W,B,le),!(this.options.ignoreDeclaration&&_e.tagName==="?xml"||this.options.ignorePiTags)){const ce=new f(_e.tagName);ce.add(this.options.textNodeName,""),_e.tagName!==_e.tagExp&&_e.attrExpPresent&&(ce[":@"]=this.buildAttributesMap(_e.tagExp,le,_e.tagName)),this.addChild(B,ce,le)}ge=_e.closeIndex+1}else if(U.substr(ge+1,3)==="!--"){const _e=ae(U,"-->",ge+4,"Comment is not closed.");if(this.options.commentPropName){const ce=U.substring(ge+4,_e-2);W=this.saveTextToParentTag(W,B,le),B.add(this.options.commentPropName,[{[this.options.textNodeName]:ce}])}ge=_e}else if(U.substr(ge+1,2)==="!D"){const _e=o(U,ge);this.docTypeEntities=_e.entities,ge=_e.i}else if(U.substr(ge+1,2)==="!["){const _e=ae(U,"]]>",ge,"CDATA is not closed.")-2,ce=U.substring(ge+9,_e);W=this.saveTextToParentTag(W,B,le);let Le=this.parseTextData(ce,B.tagname,le,!0,!1,!0,!0);Le==null&&(Le=""),this.options.cdataPropName?B.add(this.options.cdataPropName,[{[this.options.textNodeName]:ce}]):B.add(this.options.textNodeName,Le),ge=_e+2}else{let _e=$(U,ge,this.options.removeNSPrefix),ce=_e.tagName;const Le=_e.rawTagName;let ze=_e.tagExp,ct=_e.attrExpPresent,nt=_e.closeIndex;this.options.transformTagName&&(ce=this.options.transformTagName(ce)),B&&W&&B.tagname!=="!xml"&&(W=this.saveTextToParentTag(W,B,le,!1));const bt=B;if(bt&&this.options.unpairedTags.indexOf(bt.tagname)!==-1&&(B=this.tagsNodeStack.pop(),le=le.substring(0,le.lastIndexOf("."))),ce!==J.tagname&&(le+=le?"."+ce:ce),this.isItStopNode(this.options.stopNodes,le,ce)){let At="";if(ze.length>0&&ze.lastIndexOf("/")===ze.length-1)ce[ce.length-1]==="/"?(ce=ce.substr(0,ce.length-1),le=le.substr(0,le.length-1),ze=ce):ze=ze.substr(0,ze.length-1),ge=_e.closeIndex;else if(this.options.unpairedTags.indexOf(ce)!==-1)ge=_e.closeIndex;else{const vt=this.readStopNodeData(U,Le,nt+1);if(!vt)throw new Error(`Unexpected end of ${Le}`);ge=vt.i,At=vt.tagContent}const tt=new f(ce);ce!==ze&&ct&&(tt[":@"]=this.buildAttributesMap(ze,le,ce)),At&&(At=this.parseTextData(At,ce,le,!0,ct,!0,!0)),le=le.substr(0,le.lastIndexOf(".")),tt.add(this.options.textNodeName,At),this.addChild(B,tt,le)}else{if(ze.length>0&&ze.lastIndexOf("/")===ze.length-1){ce[ce.length-1]==="/"?(ce=ce.substr(0,ce.length-1),le=le.substr(0,le.length-1),ze=ce):ze=ze.substr(0,ze.length-1),this.options.transformTagName&&(ce=this.options.transformTagName(ce));const At=new f(ce);ce!==ze&&ct&&(At[":@"]=this.buildAttributesMap(ze,le,ce)),this.addChild(B,At,le),le=le.substr(0,le.lastIndexOf("."))}else{const At=new f(ce);this.tagsNodeStack.push(B),ce!==ze&&ct&&(At[":@"]=this.buildAttributesMap(ze,le,ce)),this.addChild(B,At,le),B=At}W="",ge=nt}}else W+=U[ge];return J.child};function N(U,J,B){const W=this.options.updateTag(J.tagname,B,J[":@"]);W===!1||(typeof W=="string"&&(J.tagname=W),U.addChild(J))}const R=function(U){if(this.options.processEntities){for(let J in this.docTypeEntities){const B=this.docTypeEntities[J];U=U.replace(B.regx,B.val)}for(let J in this.lastEntities){const B=this.lastEntities[J];U=U.replace(B.regex,B.val)}if(this.options.htmlEntities)for(let J in this.htmlEntities){const B=this.htmlEntities[J];U=U.replace(B.regex,B.val)}U=U.replace(this.ampEntity.regex,this.ampEntity.val)}return U};function z(U,J,B,W){return U&&(W===void 0&&(W=Object.keys(J.child).length===0),U=this.parseTextData(U,J.tagname,B,!1,J[":@"]?Object.keys(J[":@"]).length!==0:!1,W),U!==void 0&&U!==""&&J.add(this.options.textNodeName,U),U=""),U}function Z(U,J,B){const W="*."+B;for(const le in U){const ge=U[le];if(W===ge||J===ge)return!0}return!1}function ie(U,J,B=">"){let W,le="";for(let ge=J;ge<U.length;ge++){let pe=U[ge];if(W)pe===W&&(W="");else if(pe==='"'||pe==="'")W=pe;else if(pe===B[0])if(B[1]){if(U[ge+1]===B[1])return{data:le,index:ge}}else return{data:le,index:ge};else pe==="	"&&(pe=" ");le+=pe}}function ae(U,J,B,W){const le=U.indexOf(J,B);if(le===-1)throw new Error(W);return le+J.length-1}function $(U,J,B,W=">"){const le=ie(U,J+1,W);if(!le)return;let ge=le.data;const pe=le.index,_e=ge.search(/\s/);let ce=ge,Le=!0;_e!==-1&&(ce=ge.substring(0,_e),ge=ge.substring(_e+1).trimStart());const ze=ce;if(B){const ct=ce.indexOf(":");ct!==-1&&(ce=ce.substr(ct+1),Le=ce!==le.data.substr(ct+1))}return{tagName:ce,tagExp:ge,closeIndex:pe,attrExpPresent:Le,rawTagName:ze}}function re(U,J,B){const W=B;let le=1;for(;B<U.length;B++)if(U[B]==="<")if(U[B+1]==="/"){const ge=ae(U,">",B,`${J} is not closed`);if(U.substring(B+2,ge).trim()===J&&(le--,le===0))return{tagContent:U.substring(W,B),i:ge};B=ge}else if(U[B+1]==="?")B=ae(U,"?>",B+1,"StopNode is not closed.");else if(U.substr(B+1,3)==="!--")B=ae(U,"-->",B+3,"StopNode is not closed.");else if(U.substr(B+1,2)==="![")B=ae(U,"]]>",B,"StopNode is not closed.")-2;else{const ge=$(U,B,">");ge&&((ge&&ge.tagName)===J&&ge.tagExp[ge.tagExp.length-1]!=="/"&&le++,B=ge.closeIndex)}}function j(U,J,B){if(J&&typeof U=="string"){const W=U.trim();return W==="true"?!0:W==="false"?!1:_(U,B)}else return d.isExist(U)?U:""}l.exports=T},{"../util":4,"./DocTypeReader":8,"./xmlNode":13,strnum:15}],11:[function(n,l,u){const{buildOptions:d}=n("./OptionsBuilder"),f=n("./OrderedObjParser"),{prettify:o}=n("./node2json"),_=n("../validator");class T{constructor(y){this.externalEntities={},this.options=d(y)}parse(y,k){if(typeof y!="string")if(y.toString)y=y.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(k){k===!0&&(k={});const L=_.validate(y,k);if(L!==!0)throw Error(`${L.err.msg}:${L.err.line}:${L.err.col}`)}const I=new f(this.options);I.addExternalEntities(this.externalEntities);const C=I.parseXml(y);return this.options.preserveOrder||C===void 0?C:o(C,this.options)}addEntity(y,k){if(k.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(y.indexOf("&")!==-1||y.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(k==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[y]=k}}l.exports=T},{"../validator":5,"./OptionsBuilder":9,"./OrderedObjParser":10,"./node2json":12}],12:[function(n,l,u){function d(S,y){return f(S,y)}function f(S,y,k){let I;const C={};for(let L=0;L<S.length;L++){const N=S[L],R=o(N);let z="";if(k===void 0?z=R:z=k+"."+R,R===y.textNodeName)I===void 0?I=N[R]:I+=""+N[R];else{if(R===void 0)continue;if(N[R]){let Z=f(N[R],y,z);const ie=T(Z,y);N[":@"]?_(Z,N[":@"],z,y):Object.keys(Z).length===1&&Z[y.textNodeName]!==void 0&&!y.alwaysCreateTextNode?Z=Z[y.textNodeName]:Object.keys(Z).length===0&&(y.alwaysCreateTextNode?Z[y.textNodeName]="":Z=""),C[R]!==void 0&&C.hasOwnProperty(R)?(Array.isArray(C[R])||(C[R]=[C[R]]),C[R].push(Z)):y.isArray(R,z,ie)?C[R]=[Z]:C[R]=Z}}}return typeof I=="string"?I.length>0&&(C[y.textNodeName]=I):I!==void 0&&(C[y.textNodeName]=I),C}function o(S){const y=Object.keys(S);for(let k=0;k<y.length;k++){const I=y[k];if(I!==":@")return I}}function _(S,y,k,I){if(y){const C=Object.keys(y),L=C.length;for(let N=0;N<L;N++){const R=C[N];I.isArray(R,k+"."+R,!0,!0)?S[R]=[y[R]]:S[R]=y[R]}}}function T(S,y){const{textNodeName:k}=y,I=Object.keys(S).length;return!!(I===0||I===1&&(S[k]||typeof S[k]=="boolean"||S[k]===0))}u.prettify=d},{}],13:[function(n,l,u){class d{constructor(o){this.tagname=o,this.child=[],this[":@"]={}}add(o,_){o==="__proto__"&&(o="#__proto__"),this.child.push({[o]:_})}addChild(o){o.tagname==="__proto__"&&(o.tagname="#__proto__"),o[":@"]&&Object.keys(o[":@"]).length>0?this.child.push({[o.tagname]:o.child,":@":o[":@"]}):this.child.push({[o.tagname]:o.child})}}l.exports=d},{}],14:[function(n,l,u){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */u.read=function(d,f,o,_,T){var S,y,k=T*8-_-1,I=(1<<k)-1,C=I>>1,L=-7,N=o?T-1:0,R=o?-1:1,z=d[f+N];for(N+=R,S=z&(1<<-L)-1,z>>=-L,L+=k;L>0;S=S*256+d[f+N],N+=R,L-=8);for(y=S&(1<<-L)-1,S>>=-L,L+=_;L>0;y=y*256+d[f+N],N+=R,L-=8);if(S===0)S=1-C;else{if(S===I)return y?NaN:(z?-1:1)*(1/0);y=y+Math.pow(2,_),S=S-C}return(z?-1:1)*y*Math.pow(2,S-_)},u.write=function(d,f,o,_,T,S){var y,k,I,C=S*8-T-1,L=(1<<C)-1,N=L>>1,R=T===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=_?0:S-1,Z=_?1:-1,ie=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===1/0?(k=isNaN(f)?1:0,y=L):(y=Math.floor(Math.log(f)/Math.LN2),f*(I=Math.pow(2,-y))<1&&(y--,I*=2),y+N>=1?f+=R/I:f+=R*Math.pow(2,1-N),f*I>=2&&(y++,I/=2),y+N>=L?(k=0,y=L):y+N>=1?(k=(f*I-1)*Math.pow(2,T),y=y+N):(k=f*Math.pow(2,N-1)*Math.pow(2,T),y=0));T>=8;d[o+z]=k&255,z+=Z,k/=256,T-=8);for(y=y<<T|k,C+=T;C>0;d[o+z]=y&255,z+=Z,y/=256,C-=8);d[o+z-Z]|=ie*128}},{}],15:[function(n,l,u){const d=/^[-+]?0x[a-fA-F0-9]+$/,f=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const o={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function _(S,y={}){if(y=Object.assign({},o,y),!S||typeof S!="string")return S;let k=S.trim();if(y.skipLike!==void 0&&y.skipLike.test(k))return S;if(y.hex&&d.test(k))return Number.parseInt(k,16);{const I=f.exec(k);if(I){const C=I[1],L=I[2];let N=T(I[3]);const R=I[4]||I[6];if(!y.leadingZeros&&L.length>0&&C&&k[2]!==".")return S;if(!y.leadingZeros&&L.length>0&&!C&&k[1]!==".")return S;{const z=Number(k),Z=""+z;return Z.search(/[eE]/)!==-1||R?y.eNotation?z:S:k.indexOf(".")!==-1?Z==="0"&&N===""||Z===N||C&&Z==="-"+N?z:S:L?N===Z||C+N===Z?z:S:k===Z||k===C+Z?z:S}}else return S}}function T(S){return S&&S.indexOf(".")!==-1&&(S=S.replace(/0+$/,""),S==="."?S="0":S[0]==="."?S="0"+S:S[S.length-1]==="."&&(S=S.substr(0,S.length-1))),S}l.exports=_},{}],16:[function(n,l,u){l.exports={name:"osm-api",version:"3.3.0",contributors:["Kyle Hensel (https://github.com/k-yle)"],description:" Javascript/Typescript wrapper around the OpenStreetMap API",main:"dist",unpkg:"dist/index.min.js",types:"dist/src/index.d.ts",license:"MIT",files:["dist"],keywords:["osm","openstreetmap","openstreetmap api"],repository:"https://github.com/osmlab/osm-api-js",scripts:{build:"rm -rf dist && tsc --emitDeclarationOnly && rm -rf dist/__tests__ && browserify -s OSM src/index.ts -p tsify > dist/index.js && uglifyjs dist/index.js > dist/index.min.js",lint:"eslint .",test:"vitest",trypublish:"npm publish --provenance || true"},engines:{node:">=18"},dependencies:{"@types/geojson":"^7946.0.13","fast-xml-parser":"^4.4.1"},devDependencies:{"@types/node":"^22.5.5",browserify:"^17.0.0",eslint:"^9.10.0","eslint-config-kyle":"^25.0.0-beta3",tsify:"^5.0.4",typescript:"^5.6.2","uglify-js":"^3.19.3",vitest:"^2.1.1"},prettier:{trailingComma:"es5"}}},{}],17:[function(n,l,u){(function(d){(function(){var f=this&&this.__awaiter||function(k,I,C,L){function N(R){return R instanceof C?R:new C(function(z){z(R)})}return new(C||(C=Promise))(function(R,z){function Z($){try{ae(L.next($))}catch(re){z(re)}}function ie($){try{ae(L.throw($))}catch(re){z(re)}}function ae($){$.done?R($.value):N($.value).then(Z,ie)}ae((L=L.apply(k,I||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.osmFetch=y;const o=n("../auth"),_=n("../config"),T=n("./_xml"),S=k=>typeof btoa>"u"?d.from(k,"binary").toString("base64"):btoa(k);function y(k,I,C){return f(this,void 0,void 0,function*(){const{apiUrl:L,authHeader:N,basicAuth:R,userAgent:z}=(0,_.getConfig)(),Z=R&&`Basic ${S(`${R.username}:${R.password}`)}`,ie=(0,o.getAuthToken)()&&`Bearer ${(0,o.getAuthToken)()}`;let ae=new URLSearchParams(I).toString();ae&&(ae=`?${ae}`);const $=yield fetch(`${L}/api${k}${ae}`,Object.assign(Object.assign({},C),{headers:Object.assign({Authorization:N||Z||ie||"","User-Agent":z},C==null?void 0:C.headers)})),re=$.headers.get("Content-Type");if(re!=null&&re.startsWith("application/xml")){const U=yield $.text();return yield T.xmlParser.parse(U)}if(re!=null&&re.startsWith("application/json"))return $.json();if($.ok)return yield $.text();const j=new Error(`OSM API: ${yield $.text()}`);throw j.cause=$.status,j})}}).call(this)}).call(this,n("buffer").Buffer)},{"../auth":58,"../config":60,"./_xml":18,buffer:2}],18:[function(n,l,u){Object.defineProperty(u,"__esModule",{value:!0}),u.xmlParser=void 0;const d=n("fast-xml-parser");u.xmlParser=new d.XMLParser({ignoreAttributes:!1,attributesGroupName:"$",attributeNamePrefix:"",isArray:f=>f!=="$"})},{"fast-xml-parser":3}],19:[function(n,l,u){Object.defineProperty(u,"__esModule",{value:!0}),u.createChangesetMetaXml=o,u.createOsmChangeXml=T;const d=n("fast-xml-parser"),f=new d.XMLBuilder({ignoreAttributes:!1,attributeNamePrefix:"$",format:!0,suppressEmptyNode:!0,suppressBooleanAttributes:!1});function o(S){return f.build({osm:{changeset:{tag:Object.entries(S).map(([y,k])=>({$k:y,$v:k}))}}})}const _=(S,y,k)=>{const I=["node","way","relation"];return k==="delete"&&I.reverse(),y.reduce((C,L)=>{const N={$id:L.id,$version:k==="create"?0:L.version,$changeset:S,tag:Object.entries(L.tags||{}).map(([R,z])=>({$k:R,$v:z}))};switch(L.type){case"node":{const R=Object.assign(Object.assign({},N),{$lat:L.lat,$lon:L.lon});return Object.assign(Object.assign({},C),{node:[...C.node,R]})}case"way":{if(!L.nodes)throw new Error("Way has no nodes");const R=Object.assign(Object.assign({},N),{nd:L.nodes.map(z=>({$ref:z}))});return Object.assign(Object.assign({},C),{way:[...C.way,R]})}case"relation":{if(!L.members)throw new Error("Relation has no members");const R=Object.assign(Object.assign({},N),{member:L.members.map(z=>({$type:z.type,$ref:z.ref,$role:z.role}))});return Object.assign(Object.assign({},C),{relation:[...C.relation,R]})}default:return C}},Object.fromEntries(I.map(C=>[C,[]])))};function T(S,y,k){return f.build({osmChange:{$version:"0.6",$generator:"osm-api-js",changeset:k?{tag:Object.entries(k).map(([I,C])=>({$k:I,$v:C}))}:void 0,create:[_(S,y.create,"create")],modify:[_(S,y.modify,"modify")],delete:[Object.assign({"$if-unused":!0},_(S,y.delete,"delete"))]}})}},{"fast-xml-parser":3}],20:[function(n,l,u){Object.defineProperty(u,"__esModule",{value:!0}),u.parseOsmChangeJson=T,u.parseOsmChangeXml=S;const d=n("../_xml");function f(y){if(y!=null&&y.tag)return Object.fromEntries(y.tag.map(k=>[k.$.k,k.$.v]))}function o(y){return{changeset:+y.$.changeset,id:+y.$.id,timestamp:y.$.timestamp,uid:+y.$.uid,user:y.$.user,version:+y.$.version,tags:f(y)}}const _=y=>{const k=[];if(y.node){const I=y.node.map(C=>Object.assign(Object.assign({type:"node"},o(C)),{lat:+C.$.lat,lon:+C.$.lon}));k.push(...I)}if(y.way){const I=y.way.map(C=>{var L;return Object.assign(Object.assign({type:"way"},o(C)),{nodes:((L=C.nd)===null||L===void 0?void 0:L.map(N=>+N.$.ref))||[]})});k.push(...I)}if(y.relation){const I=y.relation.map(C=>{var L;return Object.assign(Object.assign({type:"relation"},o(C)),{members:((L=C.member)===null||L===void 0?void 0:L.map(N=>({ref:+N.$.ref,role:N.$.role,type:N.$.type})))||[]})});k.push(...I)}return k};function T(y){var k,I,C,L;const N=f((k=y.osmChange[0].changeset)===null||k===void 0?void 0:k[0]),R={create:((I=y.osmChange[0].create)===null||I===void 0?void 0:I.flatMap(_))||[],modify:((C=y.osmChange[0].modify)===null||C===void 0?void 0:C.flatMap(_))||[],delete:((L=y.osmChange[0].delete)===null||L===void 0?void 0:L.flatMap(_))||[]};return N&&(R.changeset=N),R}function S(y){const k=d.xmlParser.parse(y);return T(k)}},{"../_xml":18}],21:[function(n,l,u){Object.defineProperty(u,"__esModule",{value:!0}),u.getOsmChangeSize=_,u.chunkOsmChange=T;const d=["create","modify","delete"],f=["create-node","create-way","create-relation","delete-relation","delete-way","delete-node","modify-node","modify-way","modify-relation"],o=()=>({create:[],modify:[],delete:[]});function _(S){return S.create.length+S.modify.length+S.delete.length}function T(S,y){var k;const I=(k=y==null?void 0:y.api.changesets.maximum_elements)!==null&&k!==void 0?k:T.DEFAULT_LIMIT;if(_(S)<=I)return[S];const C={};for(const z of d)for(const Z of S[z]){const ie=`${z}-${Z.type}`;C[ie]||(C[ie]=[]),C[ie].push(Z)}const L=[o()];function N(){var z;for(const Z of f){const ie=Z.split("-")[0],ae=(z=C[Z])===null||z===void 0?void 0:z.pop();if(ae)return{action:ie,feature:ae}}}let R;for(;R=N();){const z=L[0];z[R.action].push(R.feature),_(z)>=I&&L.unshift(o())}return L.reverse()}T.DEFAULT_LIMIT=1e4},{}],22:[function(n,l,u){var d=this&&this.__awaiter||function(T,S,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function N(Z){try{z(k.next(Z))}catch(ie){L(ie)}}function R(Z){try{z(k.throw(Z))}catch(ie){L(ie)}}function z(Z){Z.done?C(Z.value):I(Z.value).then(N,R)}z((k=k.apply(T,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.createChangesetComment=_;const f=n("../_osmFetch"),o=n("./getChangesets");function _(T,S,y){return d(this,void 0,void 0,function*(){const k=yield(0,f.osmFetch)(`/0.6/changeset/${T}/comment.json`,void 0,Object.assign(Object.assign({},y),{method:"POST",body:`text=${encodeURIComponent(S)}`,headers:Object.assign(Object.assign({},y==null?void 0:y.headers),{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"})}));return(0,o.mapRawChangeset)(k.changeset)})}},{"../_osmFetch":17,"./getChangesets":24}],23:[function(n,l,u){var d=this&&this.__awaiter||function(T,S,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function N(Z){try{z(k.next(Z))}catch(ie){L(ie)}}function R(Z){try{z(k.throw(Z))}catch(ie){L(ie)}}function z(Z){Z.done?C(Z.value):I(Z.value).then(N,R)}z((k=k.apply(T,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getChangesetDiff=_;const f=n("../_osmFetch"),o=n("./_parseOsmChangeXml");function _(T,S){return d(this,void 0,void 0,function*(){const y=yield(0,f.osmFetch)(`/0.6/changeset/${T}/download`,void 0,S);return(0,o.parseOsmChangeJson)(y)})}},{"../_osmFetch":17,"./_parseOsmChangeXml":20}],24:[function(n,l,u){var d=this&&this.__awaiter||function(y,k,I,C){function L(N){return N instanceof I?N:new I(function(R){R(N)})}return new(I||(I=Promise))(function(N,R){function z(ae){try{ie(C.next(ae))}catch($){R($)}}function Z(ae){try{ie(C.throw(ae))}catch($){R($)}}function ie(ae){ae.done?N(ae.value):L(ae.value).then(z,Z)}ie((C=C.apply(y,k||[])).next())})},f=this&&this.__rest||function(y,k){var I={};for(var C in y)Object.prototype.hasOwnProperty.call(y,C)&&k.indexOf(C)<0&&(I[C]=y[C]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,C=Object.getOwnPropertySymbols(y);L<C.length;L++)k.indexOf(C[L])<0&&Object.prototype.propertyIsEnumerable.call(y,C[L])&&(I[C[L]]=y[C[L]]);return I};Object.defineProperty(u,"__esModule",{value:!0}),u.mapRawChangeset=void 0,u.listChangesets=T,u.getChangeset=S;const o=n("../_osmFetch"),_=y=>{var{comments:k}=y,I=f(y,["comments"]);return Object.assign(Object.assign({},I),{created_at:new Date(I.created_at),closed_at:I.closed_at?new Date(I.closed_at):void 0,discussion:k==null?void 0:k.map(C=>Object.assign(Object.assign({},C),{date:new Date(C.date),uid:`${C.uid}`}))})};u.mapRawChangeset=_;function T(y,k){return d(this,void 0,void 0,function*(){const{only:I}=y,C=f(y,["only"]);return(yield(0,o.osmFetch)("/0.6/changesets.json",Object.assign(Object.assign({},I&&{[I]:!0}),C),k)).changesets.map(u.mapRawChangeset)})}function S(y){return d(this,arguments,void 0,function*(k,I=!0,C){const L=yield(0,o.osmFetch)(`/0.6/changeset/${k}.json`,I?{include_discussion:1}:{},C);return(0,u.mapRawChangeset)(L.changeset)})}},{"../_osmFetch":17}],25:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(T,S,y,k){k===void 0&&(k=y);var I=Object.getOwnPropertyDescriptor(S,y);(!I||("get"in I?!S.__esModule:I.writable||I.configurable))&&(I={enumerable:!0,get:function(){return S[y]}}),Object.defineProperty(T,k,I)}:function(T,S,y,k){k===void 0&&(k=y),T[k]=S[y]}),f=this&&this.__exportStar||function(T,S){for(var y in T)y!=="default"&&!Object.prototype.hasOwnProperty.call(S,y)&&d(S,T,y)};Object.defineProperty(u,"__esModule",{value:!0}),u.createOsmChangeXml=u.parseOsmChangeXml=void 0,f(n("./chunkOsmChange"),u),f(n("./createChangesetComment"),u),f(n("./getChangesetDiff"),u),f(n("./getChangesets"),u),f(n("./subscription"),u),f(n("./uploadChangeset"),u);var o=n("./_parseOsmChangeXml");Object.defineProperty(u,"parseOsmChangeXml",{enumerable:!0,get:function(){return o.parseOsmChangeXml}});var _=n("./_createOsmChangeXml");Object.defineProperty(u,"createOsmChangeXml",{enumerable:!0,get:function(){return _.createOsmChangeXml}})},{"./_createOsmChangeXml":19,"./_parseOsmChangeXml":20,"./chunkOsmChange":21,"./createChangesetComment":22,"./getChangesetDiff":23,"./getChangesets":24,"./subscription":26,"./uploadChangeset":27}],26:[function(n,l,u){var d=this&&this.__awaiter||function(T,S,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function N(Z){try{z(k.next(Z))}catch(ie){L(ie)}}function R(Z){try{z(k.throw(Z))}catch(ie){L(ie)}}function z(Z){Z.done?C(Z.value):I(Z.value).then(N,R)}z((k=k.apply(T,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.subscribeToChangeset=o,u.unsubscribeFromChangeset=_;const f=n("../_osmFetch");function o(T,S){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/changeset/${T}/subscribe`,{},Object.assign(Object.assign({},S),{method:"POST"}))})}function _(T,S){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/changeset/${T}/unsubscribe`,{},Object.assign(Object.assign({},S),{method:"POST"}))})}},{"../_osmFetch":17}],27:[function(n,l,u){var d=this&&this.__awaiter||function(I,C,L,N){function R(z){return z instanceof L?z:new L(function(Z){Z(z)})}return new(L||(L=Promise))(function(z,Z){function ie(re){try{$(N.next(re))}catch(j){Z(j)}}function ae(re){try{$(N.throw(re))}catch(j){Z(j)}}function $(re){re.done?z(re.value):R(re.value).then(ie,ae)}$((N=N.apply(I,C||[])).next())})},f=this&&this.__rest||function(I,C){var L={};for(var N in I)Object.prototype.hasOwnProperty.call(I,N)&&C.indexOf(N)<0&&(L[N]=I[N]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var R=0,N=Object.getOwnPropertySymbols(I);R<N.length;R++)C.indexOf(N[R])<0&&Object.prototype.propertyIsEnumerable.call(I,N[R])&&(L[N[R]]=I[N[R]]);return L};Object.defineProperty(u,"__esModule",{value:!0}),u.compress=y,u.uploadChangeset=k;const o=n("../_osmFetch"),_=n("../../../package.json"),T=n("./_createOsmChangeXml"),S=n("./chunkOsmChange");function y(I){if(!globalThis.CompressionStream)return;const C=new Response(I).body.pipeThrough(new CompressionStream("gzip"));return new Response(C).blob()}function k(I,C,L){return d(this,void 0,void 0,function*(){const N=L||{},{onChunk:R,onProgress:z,disableCompression:Z}=N,ie=f(N,["onChunk","onProgress","disableCompression"]),ae=(0,S.chunkOsmChange)(C),$=[],re=(0,S.getOsmChangeSize)(C);for(const[j,U]of ae.entries()){let J=I;ae.length>1&&(R?J=R({featureCount:re,changesetIndex:j,changesetTotal:ae.length}):J.chunk=`${j+1}/${ae.length}`),J.created_by||(J.created_by=`osm-api-js ${_.version}`),z==null||z({phase:"upload",step:j+1,total:ae.length});const B=+(yield(0,o.osmFetch)("/0.6/changeset/create",void 0,Object.assign(Object.assign({},ie),{method:"PUT",body:(0,T.createChangesetMetaXml)(J),headers:Object.assign(Object.assign({},ie.headers),{"content-type":"application/xml; charset=utf-8"})}))),W=(0,T.createOsmChangeXml)(B,U),le=!Z&&(yield y(W));yield(0,o.osmFetch)(`/0.6/changeset/${B}/upload`,void 0,Object.assign(Object.assign({},ie),{method:"POST",body:le||W,headers:Object.assign(Object.assign(Object.assign({},ie.headers),le&&{"Content-Encoding":"gzip"}),{"content-type":"application/xml; charset=utf-8"})})),yield(0,o.osmFetch)(`/0.6/changeset/${B}/close`,void 0,Object.assign(Object.assign({},ie),{method:"PUT"})),$.push(B)}return $[0]})}},{"../../../package.json":16,"../_osmFetch":17,"./_createOsmChangeXml":19,"./chunkOsmChange":21}],28:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.createUserBlock=o;const f=n("../_osmFetch");function o(_,T){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/user_blocks.json",_,Object.assign(Object.assign({},T),{method:"POST"}))).user_block})}},{"../_osmFetch":17}],29:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getUserBlock=o;const f=n("../_osmFetch");function o(_,T){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user_blocks/${_}.json`,{},T)).user_block})}},{"../_osmFetch":17}],30:[function(n,l,u){var d=this&&this.__awaiter||function(T,S,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function N(Z){try{z(k.next(Z))}catch(ie){L(ie)}}function R(Z){try{z(k.throw(Z))}catch(ie){L(ie)}}function z(Z){Z.done?C(Z.value):I(Z.value).then(N,R)}z((k=k.apply(T,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.hideChangesetComment=_;const f=n("../_osmFetch"),o=n("../changesets");function _(T,S,y){return d(this,void 0,void 0,function*(){const k=yield(0,f.osmFetch)(`/0.6/changeset_comments/${T}/visibility.json`,{},Object.assign(Object.assign({},y),{method:S==="unhide"?"POST":"DELETE"}));return(0,o.mapRawChangeset)(k.changeset)})}},{"../_osmFetch":17,"../changesets":25}],31:[function(n,l,u){var d=this&&this.__awaiter||function(T,S,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function N(Z){try{z(k.next(Z))}catch(ie){L(ie)}}function R(Z){try{z(k.throw(Z))}catch(ie){L(ie)}}function z(Z){Z.done?C(Z.value):I(Z.value).then(N,R)}z((k=k.apply(T,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.hideNote=_;const f=n("../_osmFetch"),o=n("../notes");function _(T,S,y){return d(this,void 0,void 0,function*(){const k=yield(0,f.osmFetch)(`/0.6/notes/${T}.json`,S?{text:S}:{},Object.assign(Object.assign({},y),{method:"DELETE"}));return(0,o.featureToNote)(k)})}},{"../_osmFetch":17,"../notes":48}],32:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(o,_,T,S){S===void 0&&(S=T);var y=Object.getOwnPropertyDescriptor(_,T);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[T]}}),Object.defineProperty(o,S,y)}:function(o,_,T,S){S===void 0&&(S=T),o[S]=_[T]}),f=this&&this.__exportStar||function(o,_){for(var T in o)T!=="default"&&!Object.prototype.hasOwnProperty.call(_,T)&&d(_,o,T)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./createUserBlock"),u),f(n("./getUserBlock"),u),f(n("./hideChangesetComment"),u),f(n("./hideNote"),u),f(n("./redactFeature"),u)},{"./createUserBlock":28,"./getUserBlock":29,"./hideChangesetComment":30,"./hideNote":31,"./redactFeature":33}],33:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.redactFeature=o;const f=n("../_osmFetch");function o(_,T){return d(this,arguments,void 0,function*({featureType:S,featureId:y,featureVersion:k,redactionId:I},C){yield(0,f.osmFetch)(`/0.6/${S}/${y}/${k}/redact`,I?{redaction:I}:{},Object.assign(Object.assign({},C),{method:"POST"}))})}},{"../_osmFetch":17}],34:[function(n,l,u){var d=this&&this.__awaiter||function(T,S,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function N(Z){try{z(k.next(Z))}catch(ie){L(ie)}}function R(Z){try{z(k.throw(Z))}catch(ie){L(ie)}}function z(Z){Z.done?C(Z.value):I(Z.value).then(N,R)}z((k=k.apply(T,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getApiCapabilities=o,u.getCapabilities=_;const f=n("./_osmFetch");function o(T){return d(this,void 0,void 0,function*(){return(0,f.osmFetch)("/capabilities.json",void 0,T)})}function _(){return d(this,void 0,void 0,function*(){const T=yield o();return{limits:{maxArea:T.api.area.maximum,maxNoteArea:T.api.note_area.maximum,maxTracepointPerPage:T.api.tracepoints.per_page,maxWayNodes:T.api.waynodes.maximum,maxChangesetElements:T.api.changesets.maximum_elements,maxTimeout:T.api.timeout.seconds},policy:{imageryBlacklist:T.policy.imagery.blacklist.map(y=>y.regex)}}})}},{"./_osmFetch":17}],35:[function(n,l,u){var d=this&&this.__awaiter||function(I,C,L,N){function R(z){return z instanceof L?z:new L(function(Z){Z(z)})}return new(L||(L=Promise))(function(z,Z){function ie(re){try{$(N.next(re))}catch(j){Z(j)}}function ae(re){try{$(N.throw(re))}catch(j){Z(j)}}function $(re){re.done?z(re.value):R(re.value).then(ie,ae)}$((N=N.apply(I,C||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getFeature=o,u.getFeatures=_,u.getFeatureAtVersion=T,u.getFeatureHistory=S,u.getWaysForNode=y,u.getRelationsForElement=k;const f=n("./_osmFetch");function o(I,C,L,N){return d(this,void 0,void 0,function*(){const R=L&&I!=="node"?"/full":"";return(yield(0,f.osmFetch)(`/0.6/${I}/${C}${R}.json`,void 0,N)).elements})}function _(I,C,L){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/${I}s.json?${I}s=${C.join(",")}`,void 0,L)).elements})}function T(I,C,L,N){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/${I}/${C}/${L}.json`,void 0,N)).elements[0]})}function S(I,C,L){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/${I}/${C}/history.json`,void 0,L)).elements})}function y(I,C){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/node/${I}/ways.json`,void 0,C)).elements})}function k(I,C,L){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/${I}/${C}/relations.json`,void 0,L)).elements})}},{"./_osmFetch":17}],36:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getMapData=o;const f=n("./_osmFetch");function o(_,T){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/map.json",{bbox:_},T)).elements})}},{"./_osmFetch":17}],37:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getPermissions=o;const f=n("./_osmFetch");function o(_){return d(this,void 0,void 0,function*(){return(0,f.osmFetch)("/0.6/permissions.json",void 0,_)})}},{"./_osmFetch":17}],38:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getUIdFromDisplayName=o;const f=n("./changesets");function o(_){return d(this,void 0,void 0,function*(){const T=yield(0,f.listChangesets)({display_name:_});if(!T.length)throw new Error("Could not get uid because the user has never edited the map");return T[0].uid})}},{"./changesets":25}],39:[function(n,l,u){var d=this&&this.__awaiter||function(y,k,I,C){function L(N){return N instanceof I?N:new I(function(R){R(N)})}return new(I||(I=Promise))(function(N,R){function z(ae){try{ie(C.next(ae))}catch($){R($)}}function Z(ae){try{ie(C.throw(ae))}catch($){R($)}}function ie(ae){ae.done?N(ae.value):L(ae.value).then(z,Z)}ie((C=C.apply(y,k||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getUser=o,u.getUsers=_,u.getUserBlockById=T,u.getOwnUserBlocks=S;const f=n("./_osmFetch");function o(y,k){return d(this,void 0,void 0,function*(){const I=yield(0,f.osmFetch)(`/0.6/user/${y==="me"?"details":y}.json`,void 0,k);return Object.assign(Object.assign({},I.user),{account_created:new Date(I.user.account_created)})})}function _(y,k){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/users",{users:y},k)).users.map(C=>Object.assign(Object.assign({},C),{account_created:new Date(C.account_created)}))})}function T(y,k){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user_blocks/${y}.json`,void 0,k)).user_block})}function S(y){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/user/blocks/active",void 0,y)).user_blocks})}},{"./_osmFetch":17}],40:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(o,_,T,S){S===void 0&&(S=T);var y=Object.getOwnPropertyDescriptor(_,T);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[T]}}),Object.defineProperty(o,S,y)}:function(o,_,T,S){S===void 0&&(S=T),o[S]=_[T]}),f=this&&this.__exportStar||function(o,_){for(var T in o)T!=="default"&&!Object.prototype.hasOwnProperty.call(_,T)&&d(_,o,T)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./changesets"),u),f(n("./dwg"),u),f(n("./messages"),u),f(n("./notes"),u),f(n("./preferences"),u),f(n("./getCapabilities"),u),f(n("./getFeature"),u),f(n("./getMapData"),u),f(n("./getPermissions"),u),f(n("./getUIdFromDisplayName"),u),f(n("./getUser"),u)},{"./changesets":25,"./dwg":32,"./getCapabilities":34,"./getFeature":35,"./getMapData":36,"./getPermissions":37,"./getUIdFromDisplayName":38,"./getUser":39,"./messages":43,"./notes":48,"./preferences":53}],41:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.deleteMessage=o;const f=n("../_osmFetch");function o(_,T){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user/messages/${_}.json`,{},Object.assign(Object.assign({},T),{method:"DELETE"}))).message})}},{"../_osmFetch":17}],42:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getMessage=o;const f=n("../_osmFetch");function o(_,T){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user/messages/${_}.json`,void 0,T)).message})}},{"../_osmFetch":17}],43:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(o,_,T,S){S===void 0&&(S=T);var y=Object.getOwnPropertyDescriptor(_,T);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[T]}}),Object.defineProperty(o,S,y)}:function(o,_,T,S){S===void 0&&(S=T),o[S]=_[T]}),f=this&&this.__exportStar||function(o,_){for(var T in o)T!=="default"&&!Object.prototype.hasOwnProperty.call(_,T)&&d(_,o,T)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./deleteMessage"),u),f(n("./getMessage"),u),f(n("./listMessages"),u),f(n("./sendMessage"),u),f(n("./updateMessageReadStatus"),u)},{"./deleteMessage":41,"./getMessage":42,"./listMessages":44,"./sendMessage":45,"./updateMessageReadStatus":46}],44:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.listMessages=o;const f=n("../_osmFetch");function o(_,T){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user/messages/${_}.json`,void 0,T)).messages})}},{"../_osmFetch":17}],45:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.sendMessage=o;const f=n("../_osmFetch");function o(_,T){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/user/messages.json",_,Object.assign(Object.assign({},T),{method:"POST"}))).message})}},{"../_osmFetch":17}],46:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.updateMessageReadStatus=o;const f=n("../_osmFetch");function o(_,T,S){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user/messages/${_}.json`,{read_status:T},Object.assign(Object.assign({},S),{method:"POST"}))).message})}},{"../_osmFetch":17}],47:[function(n,l,u){var d=this&&this.__awaiter||function(k,I,C,L){function N(R){return R instanceof C?R:new C(function(z){z(R)})}return new(C||(C=Promise))(function(R,z){function Z($){try{ae(L.next($))}catch(re){z(re)}}function ie($){try{ae(L.throw($))}catch(re){z(re)}}function ae($){$.done?R($.value):N($.value).then(Z,ie)}ae((L=L.apply(k,I||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.featureToNote=void 0,u.getNotesForQuery=T,u.getNotesForArea=S,u.getNote=y;const f=n("../_osmFetch"),o=k=>{const[I,C]=k.geometry.coordinates;return Object.assign(Object.assign({},k.properties),{location:{lat:C,lng:I}})};u.featureToNote=o;function _(k,I,C){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/notes${I?"/search":""}.json`,k,C)).features.map(u.featureToNote)})}function T(k,I){return _(k,!0,I)}function S(k,I){return _({bbox:k},!1,I)}function y(k,I){return d(this,void 0,void 0,function*(){const C=yield(0,f.osmFetch)(`/0.6/notes/${k}.json`,void 0,I);return(0,u.featureToNote)(C)})}},{"../_osmFetch":17}],48:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(o,_,T,S){S===void 0&&(S=T);var y=Object.getOwnPropertyDescriptor(_,T);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[T]}}),Object.defineProperty(o,S,y)}:function(o,_,T,S){S===void 0&&(S=T),o[S]=_[T]}),f=this&&this.__exportStar||function(o,_){for(var T in o)T!=="default"&&!Object.prototype.hasOwnProperty.call(_,T)&&d(_,o,T)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./getNotes"),u),f(n("./noteActions"),u),f(n("./subscription"),u)},{"./getNotes":47,"./noteActions":49,"./subscription":50}],49:[function(n,l,u){var d=this&&this.__awaiter||function(k,I,C,L){function N(R){return R instanceof C?R:new C(function(z){z(R)})}return new(C||(C=Promise))(function(R,z){function Z($){try{ae(L.next($))}catch(re){z(re)}}function ie($){try{ae(L.throw($))}catch(re){z(re)}}function ae($){$.done?R($.value):N($.value).then(Z,ie)}ae((L=L.apply(k,I||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.createNote=_,u.commentOnNote=T,u.closeNote=S,u.reopenNote=y;const f=n("../_osmFetch"),o=n("./getNotes");function _(k,I,C,L){return d(this,void 0,void 0,function*(){const N=yield(0,f.osmFetch)("/0.6/notes.json",{lat:k,lon:I,text:C},Object.assign(Object.assign({},L),{method:"POST"}));return(0,o.featureToNote)(N)})}function T(k,I,C){return d(this,void 0,void 0,function*(){const L=yield(0,f.osmFetch)(`/0.6/notes/${k}/comment.json`,I?{text:I}:{},Object.assign(Object.assign({},C),{method:"POST"}));return(0,o.featureToNote)(L)})}function S(k,I,C){return d(this,void 0,void 0,function*(){const L=yield(0,f.osmFetch)(`/0.6/notes/${k}/close.json`,I?{text:I}:{},Object.assign(Object.assign({},C),{method:"POST"}));return(0,o.featureToNote)(L)})}function y(k,I,C){return d(this,void 0,void 0,function*(){const L=yield(0,f.osmFetch)(`/0.6/notes/${k}/reopen.json`,I?{text:I}:{},Object.assign(Object.assign({},C),{method:"POST"}));return(0,o.featureToNote)(L)})}},{"../_osmFetch":17,"./getNotes":47}],50:[function(n,l,u){var d=this&&this.__awaiter||function(T,S,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function N(Z){try{z(k.next(Z))}catch(ie){L(ie)}}function R(Z){try{z(k.throw(Z))}catch(ie){L(ie)}}function z(Z){Z.done?C(Z.value):I(Z.value).then(N,R)}z((k=k.apply(T,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.subscribeToNote=o,u.unsubscribeFromNote=_;const f=n("../_osmFetch");function o(T,S){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/notes/${T}/subscription`,{},Object.assign(Object.assign({},S),{method:"POST"}))})}function _(T,S){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/notes/${T}/subscription`,{},Object.assign(Object.assign({},S),{method:"DELETE"}))})}},{"../_osmFetch":17}],51:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.deletePreferences=o;const f=n("../_osmFetch");function o(_,T){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/user/preferences/${_}.json`,{},Object.assign(Object.assign({},T),{method:"DELETE"}))})}},{"../_osmFetch":17}],52:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getPreferences=o;const f=n("../_osmFetch");function o(_){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/user/preferences.json",void 0,_)).preferences})}},{"../_osmFetch":17}],53:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(o,_,T,S){S===void 0&&(S=T);var y=Object.getOwnPropertyDescriptor(_,T);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[T]}}),Object.defineProperty(o,S,y)}:function(o,_,T,S){S===void 0&&(S=T),o[S]=_[T]}),f=this&&this.__exportStar||function(o,_){for(var T in o)T!=="default"&&!Object.prototype.hasOwnProperty.call(_,T)&&d(_,o,T)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./deletePreferences"),u),f(n("./getPreferences"),u),f(n("./updatePreferences"),u)},{"./deletePreferences":51,"./getPreferences":52,"./updatePreferences":54}],54:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.updatePreferences=o;const f=n("../_osmFetch");function o(_,T,S){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/user/preferences/${_}.json`,{},Object.assign(Object.assign({},S),{method:"PUT",body:T}))})}},{"../_osmFetch":17}],55:[function(n,l,u){Object.defineProperty(u,"__esModule",{value:!0}),u.createPopup=f;const d="osm-api-auth-complete";function f(o){let _=!1;return new Promise(T=>{const[S,y]=[600,550],k=Object.entries({width:S,height:y,left:window.screen.width/2-S/2,top:window.screen.height/2-y/2}).map(([N,R])=>`${N}=${R}`).join(","),I=window.open("about:blank","oauth_window",k);if(!I)throw new Error("Popup was blocked");I.location=o;const C=new BroadcastChannel(d),L=N=>{_||(T(N.data),_=!0,C.removeEventListener("message",L),C.close())};C.addEventListener("message",L)})}},{}],56:[function(n,l,u){var d=this&&this.__awaiter||function(_,T,S,y){function k(I){return I instanceof S?I:new S(function(C){C(I)})}return new(S||(S=Promise))(function(I,C){function L(z){try{R(y.next(z))}catch(Z){C(Z)}}function N(z){try{R(y.throw(z))}catch(Z){C(Z)}}function R(z){z.done?I(z.value):k(z.value).then(L,N)}R((y=y.apply(_,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.exchangeCode=o;const f=n("./helpers");function o(_,T){return d(this,arguments,void 0,function*(S,{options:y,pkceVerifier:k,state:I}){const C=new URL(S).searchParams,L=C.get("error_description"),N=C.get("code"),R=C.get("state");if(L)throw new Error(L);if(!N)throw new Error("No code in OAuth response");if(!k||!I)throw new Error("No login in progress");if(I!==R)throw new Error("State Mismatch");const z={grant_type:"authorization_code",code:N,redirect_uri:y.redirectUrl,client_id:y.clientId,code_verifier:k},Z=`${(0,f.getOAuthBaseUrl)()}/oauth2/token?${new URLSearchParams(z).toString()}`,ae=yield(yield fetch(Z,{method:"POST",body:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if("error_description"in ae)throw new Error(ae.error_description);const $={issuedAt:new Date(ae.created_at*1e3).toISOString(),accessToken:ae.access_token,scopes:ae.scope.split(" ")};return localStorage.setItem("__osmAuth",JSON.stringify($)),$})}},{"./helpers":57}],57:[function(n,l,u){var d=this&&this.__awaiter||function(S,y,k,I){function C(L){return L instanceof k?L:new k(function(N){N(L)})}return new(k||(k=Promise))(function(L,N){function R(ie){try{Z(I.next(ie))}catch(ae){N(ae)}}function z(ie){try{Z(I.throw(ie))}catch(ae){N(ae)}}function Z(ie){ie.done?L(ie.value):C(ie.value).then(R,z)}Z((I=I.apply(S,y||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.sha256=o,u.getRandomString=_,u.getOAuthBaseUrl=T;const f=n("../config");function o(S){return d(this,void 0,void 0,function*(){const y=new TextEncoder().encode(S),k=yield window.crypto.subtle.digest("SHA-256",y);return btoa(String.fromCharCode(...new Uint8Array(k))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")})}function _(){return[...window.crypto.getRandomValues(new Uint32Array(32))].map(S=>`0${S.toString(16)}`.slice(-2)).join("")}function T(){let S=(0,f.getConfig)().apiUrl;return S==="https://api.openstreetmap.org"&&(S="https://www.openstreetmap.org"),S}},{"../config":60}],58:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(o,_,T,S){S===void 0&&(S=T);var y=Object.getOwnPropertyDescriptor(_,T);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[T]}}),Object.defineProperty(o,S,y)}:function(o,_,T,S){S===void 0&&(S=T),o[S]=_[T]}),f=this&&this.__exportStar||function(o,_){for(var T in o)T!=="default"&&!Object.prototype.hasOwnProperty.call(_,T)&&d(_,o,T)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./oauth2"),u)},{"./oauth2":59}],59:[function(n,l,u){var d=this&&this.__awaiter||function(I,C,L,N){function R(z){return z instanceof L?z:new L(function(Z){Z(z)})}return new(L||(L=Promise))(function(z,Z){function ie(re){try{$(N.next(re))}catch(j){Z(j)}}function ae(re){try{$(N.throw(re))}catch(j){Z(j)}}function $(re){re.done?z(re.value):R(re.value).then(ie,ae)}$((N=N.apply(I,C||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.isLoggedIn=u.getAuthToken=u.authReady=void 0,u.login=T,u.logout=k;const f=n("./createPopup"),o=n("./exchangeCode"),_=n("./helpers");function T(I){return d(this,void 0,void 0,function*(){if(!I.redirectUrl)throw new Error("You must include the 'redirectUrl' option");if(!I.clientId)throw new Error("You must include the 'clientId' option");if(!I.scopes)throw new Error("You must include the 'scopes' option");const C=(0,_.getRandomString)(),L=(0,_.getRandomString)(),N=yield(0,_.sha256)(L),R={scope:I.scopes.join(" "),include_granted_scopes:"true",response_type:"code",state:C,redirect_uri:I.redirectUrl,client_id:I.clientId,code_challenge_method:"S256",code_challenge:N},z=`/oauth2/authorize?${new URLSearchParams(R).toString()}`,Z=I.switchUser?`/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(z)}`)}`:z,ie=(0,_.getOAuthBaseUrl)()+Z,ae={state:C,pkceVerifier:L,options:I};if(I.mode==="popup"){const $=yield(0,f.createPopup)(ie);return(0,o.exchangeCode)($,ae)}if(I.mode==="redirect"){localStorage.setItem("__osmAuthTemp",JSON.stringify(ae)),window.location.replace(ie);return}throw new Error("options.mode must be 'popup' or 'redirect'")})}u.authReady=d(void 0,void 0,void 0,function*(){if(typeof window>"u")return;const I=window.location.href,C=localStorage.getItem("__osmAuthTemp");if(new URL(I).searchParams.get("code")&&C)try{const L=JSON.parse(C);yield(0,o.exchangeCode)(I,L),localStorage.removeItem("__osmAuthTemp")}catch(L){console.error("OSM Auth Error",L)}});const S=()=>{try{const I=localStorage.getItem("__osmAuth");return I?JSON.parse(I).accessToken:void 0}catch{return}};u.getAuthToken=S;const y=()=>!!(0,u.getAuthToken)();u.isLoggedIn=y;function k(){localStorage.removeItem("__osmAuth")}},{"./createPopup":55,"./exchangeCode":56,"./helpers":57}],60:[function(n,l,u){Object.defineProperty(u,"__esModule",{value:!0}),u.getConfig=void 0,u.configure=o;const d={apiUrl:"https://api.openstreetmap.org",userAgent:"https://github.com/osmlab/osm-api-js"},f=()=>d;u.getConfig=f;function o(_){Object.assign(d,_)}},{}],61:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(o,_,T,S){S===void 0&&(S=T);var y=Object.getOwnPropertyDescriptor(_,T);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[T]}}),Object.defineProperty(o,S,y)}:function(o,_,T,S){S===void 0&&(S=T),o[S]=_[T]}),f=this&&this.__exportStar||function(o,_){for(var T in o)T!=="default"&&!Object.prototype.hasOwnProperty.call(_,T)&&d(_,o,T)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./api"),u),f(n("./auth"),u),f(n("./config"),u),f(n("./types"),u)},{"./api":40,"./auth":58,"./config":60,"./types":65}],62:[function(n,l,u){Object.defineProperty(u,"__esModule",{value:!0})},{}],63:[function(n,l,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],64:[function(n,l,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],65:[function(n,l,u){var d=this&&this.__createBinding||(Object.create?function(o,_,T,S){S===void 0&&(S=T);var y=Object.getOwnPropertyDescriptor(_,T);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[T]}}),Object.defineProperty(o,S,y)}:function(o,_,T,S){S===void 0&&(S=T),o[S]=_[T]}),f=this&&this.__exportStar||function(o,_){for(var T in o)T!=="default"&&!Object.prototype.hasOwnProperty.call(_,T)&&d(_,o,T)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./changesets"),u),f(n("./features"),u),f(n("./general"),u),f(n("./messages"),u),f(n("./notes"),u),f(n("./osmPatch"),u),f(n("./user"),u)},{"./changesets":62,"./features":63,"./general":64,"./messages":66,"./notes":67,"./osmPatch":68,"./user":69}],66:[function(n,l,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],67:[function(n,l,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],68:[function(n,l,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],69:[function(n,l,u){arguments[4][62][0].apply(u,arguments)},{dup:62}]},{},[61])(61)})})(sb);var Yu=sb.exports;const{window:oC}=Zy;function aC(s){let i,n=s[0].length+"",l,u,d=s[0].length==1?"edit":"edits",f;return{c(){i=Ae("div"),l=kt(n),u=$e(),f=kt(d),be(i,"slot","header")},m(o,_){xe(o,i,_),ve(i,l),ve(i,u),ve(i,f)},p(o,_){_&1&&n!==(n=o[0].length+"")&&Li(l,n),_&1&&d!==(d=o[0].length==1?"edit":"edits")&&Li(f,d)},d(o){o&&we(i)}}}function Q_(s){let i,n,l,u,d,f=s[0].length+"",o,_,T,S,y,k,I,C,L,N,R,z,Z,ie,ae,$=s[1]+1+"",re,j,U=s[0].length+"",J,B,W,le,ge,pe,_e,ce=JSON.stringify(s[0][s[1]])+"",Le,ze,ct;return{c(){i=Ae("div"),n=Ae("button"),n.textContent="Clear edits",l=$e(),u=Ae("button"),d=kt("Undo ("),o=kt(f),_=kt(")"),S=$e(),y=Ae("div"),k=Ae("button"),k.textContent="Download .osc",I=$e(),C=Ae("button"),C.textContent="Upload changeset",L=$e(),N=Ae("div"),R=Ae("button"),z=kt("Previous"),ie=$e(),ae=Ae("span"),re=kt($),j=kt(" / "),J=kt(U),B=$e(),W=Ae("button"),le=kt("Next"),pe=$e(),_e=Ae("p"),Le=kt(ce),be(n,"class","btn btn-danger"),be(u,"class","btn btn-danger"),u.disabled=T=s[0].length==0,be(i,"class","mb-1"),be(k,"class","btn btn-secondary"),be(C,"class","btn btn-secondary"),be(y,"class","mb-1"),be(R,"class","btn btn-secondary"),R.disabled=Z=s[1]==0,be(W,"class","btn btn-secondary"),W.disabled=ge=s[1]==s[0].length-1,en(N,"display","flex"),en(N,"justify-content","space-between")},m(nt,bt){xe(nt,i,bt),ve(i,n),ve(i,l),ve(i,u),ve(u,d),ve(u,o),ve(u,_),xe(nt,S,bt),xe(nt,y,bt),ve(y,k),ve(y,I),ve(y,C),xe(nt,L,bt),xe(nt,N,bt),ve(N,R),ve(R,z),ve(N,ie),ve(N,ae),ve(ae,re),ve(ae,j),ve(ae,J),ve(N,B),ve(N,W),ve(W,le),xe(nt,pe,bt),xe(nt,_e,bt),ve(_e,Le),ze||(ct=[Jt(n,"click",s[5]),Jt(u,"click",s[6]),Jt(k,"click",s[7]),Jt(C,"click",s[8]),Jt(R,"click",s[3]),Jt(W,"click",s[4])],ze=!0)},p(nt,bt){bt&1&&f!==(f=nt[0].length+"")&&Li(o,f),bt&1&&T!==(T=nt[0].length==0)&&(u.disabled=T),bt&2&&Z!==(Z=nt[1]==0)&&(R.disabled=Z),bt&2&&$!==($=nt[1]+1+"")&&Li(re,$),bt&1&&U!==(U=nt[0].length+"")&&Li(J,U),bt&3&&ge!==(ge=nt[1]==nt[0].length-1)&&(W.disabled=ge),bt&3&&ce!==(ce=JSON.stringify(nt[0][nt[1]])+"")&&Li(Le,ce)},d(nt){nt&&(we(i),we(S),we(y),we(L),we(N),we(pe),we(_e)),ze=!1,Yn(ct)}}}function lC(s){let i,n=s[0].length>0&&Q_(s);return{c(){i=Ae("div"),n&&n.c(),be(i,"slot","body")},m(l,u){xe(l,i,u),n&&n.m(i,null)},p(l,u){l[0].length>0?n?n.p(l,u):(n=Q_(l),n.c(),n.m(i,null)):n&&(n.d(1),n=null)},d(l){l&&we(i),n&&n.d()}}}function cC(s){let i,n,l,u,d,f;return i=new Yc({props:{loading:s[2]}}),l=new Tf({props:{$$slots:{body:[lC],header:[aC]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment)},m(o,_){gt(i,o,_),xe(o,n,_),gt(l,o,_),u=!0,d||(f=Jt(oC,"keydown",s[9]),d=!0)},p(o,[_]){const T={};_&4&&(T.loading=o[2]),i.$set(T);const S={};_&16387&&(S.$$scope={dirty:_,ctx:o}),l.$set(S)},i(o){u||(Re(i.$$.fragment,o),Re(l.$$.fragment,o),u=!0)},o(o){Ve(i.$$.fragment,o),Ve(l.$$.fragment,o),u=!1},d(o){o&&we(n),_t(i,o),_t(l,o),d=!1,f()}}}function uC(s,i,n){let l,u,d;Qt(s,ur,R=>n(11,l=R)),Qt(s,nh,R=>n(13,u=R)),Qt(s,ho,R=>n(12,d=R));let{anyEdits:f}=i,o=[],_=0,T="";function S(){n(1,_--,_)}function y(){n(1,_++,_)}async function k(){if(window.confirm("Do you really want to clear your edits?")){n(2,T="Clearing edits"),await Ro();try{l.editClear(),dn(ho,d++,d)}finally{n(2,T="")}}}async function I(){n(2,T="Undoing last edit"),await Ro();try{l.editUndo(),dn(ho,d++,d)}finally{n(2,T="")}}function C(){S0("changes.osc",l.toOsc())}async function L(){if(!u){window.alert("You have to log in first");return}if(o.some(z=>!("SetTags"in z))){window.alert("You've done a bulk operation. You should NOT upload this to OSM -- it's only for testing or usage in you own tool that consumes OSM data.");return}if(!window.confirm("Do you really know what you're doing and want to upload this?"))return;let R=window.prompt("Please describe this changeset");if(R)try{let z=await Yu.uploadChangeset({created_by:"Speedwalk",comment:R},JSON.parse(l.toOsmChangeJson()));window.open(`https://www.openstreetmap.org/changeset/${z}`,"_blank"),dn(ur,l=null,l)}catch(z){window.alert(`Upload failed: ${z}`)}}async function N(R){R.key=="z"&&R.ctrlKey&&o.length>0&&await I()}return s.$$set=R=>{"anyEdits"in R&&n(10,f=R.anyEdits)},s.$$.update=()=>{s.$$.dirty&6145&&d>0&&(n(0,o=l?JSON.parse(l.getEdits()):[]),n(1,_=0),n(10,f=o.length>0))},[o,_,T,S,y,k,I,C,L,N,f,l,d]}class hC extends di{constructor(i){super(),fi(this,i,uC,cC,si,{anyEdits:10})}}function fC(s){let i,n,l;return{c(){i=Ae("button"),i.textContent="Bulk operations",be(i,"class","btn btn-secondary")},m(u,d){xe(u,i,d),n||(l=Jt(i,"click",s[11]),n=!0)},p:$t,i:$t,o:$t,d(u){u&&we(i),n=!1,l()}}}function dC(s){let i,n;return i=new Tf({props:{$$slots:{body:[_C],header:[pC]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u&65548&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function pC(s){let i;return{c(){i=Ae("div"),i.textContent="Bulk operations",be(i,"slot","header")},m(n,l){xe(n,i,l)},p:$t,d(n){n&&we(i)}}}function mC(s){let i;return{c(){i=kt("Drive on the left")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function gC(s){let i;return{c(){i=kt("Only for major roads")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function _C(s){let i,n,l,u,d,f,o,_,T,S,y,k,I,C,L,N,R,z,Z,ie,ae,$,re;function j(W){s[9](W)}let U={$$slots:{default:[mC]},$$scope:{ctx:s}};s[2]!==void 0&&(U.checked=s[2]),f=new us({props:U}),Si.push(()=>Yi(f,"checked",j));function J(W){s[10](W)}let B={$$slots:{default:[gC]},$$scope:{ctx:s}};return s[3]!==void 0&&(B.checked=s[3]),L=new us({props:B}),Si.push(()=>Yi(L,"checked",J)),{c(){i=Ae("div"),n=Ae("div"),l=Ae("div"),l.textContent="Assume old-style tags on one-ways",u=$e(),d=Ae("div"),yt(f.$$.fragment),_=$e(),T=Ae("button"),T.textContent="Autoset tags on one-ways",S=$e(),y=Ae("div"),k=Ae("div"),k.textContent="Make all sidewalks",I=$e(),C=Ae("div"),yt(L.$$.fragment),R=$e(),z=Ae("button"),z.textContent="Make sidewalks",Z=$e(),ie=Ae("button"),ie.textContent="Connect all crossings over major roads",be(l,"class","card-header"),be(T,"class","btn btn-secondary"),be(d,"class","card-body"),be(n,"class","card mb-3"),be(k,"class","card-header"),be(z,"class","btn btn-secondary"),be(C,"class","card-body"),be(y,"class","card mb-3"),be(ie,"class","btn btn-secondary"),be(i,"slot","body")},m(W,le){xe(W,i,le),ve(i,n),ve(n,l),ve(n,u),ve(n,d),gt(f,d,null),ve(d,_),ve(d,T),ve(i,S),ve(i,y),ve(y,k),ve(y,I),ve(y,C),gt(L,C,null),ve(C,R),ve(C,z),ve(i,Z),ve(i,ie),ae=!0,$||(re=[Jt(T,"click",s[8]),Jt(z,"click",s[6]),Jt(ie,"click",s[7])],$=!0)},p(W,le){const ge={};le&65536&&(ge.$$scope={dirty:le,ctx:W}),!o&&le&4&&(o=!0,ge.checked=W[2],Ji(()=>o=!1)),f.$set(ge);const pe={};le&65536&&(pe.$$scope={dirty:le,ctx:W}),!N&&le&8&&(N=!0,pe.checked=W[3],Ji(()=>N=!1)),L.$set(pe)},i(W){ae||(Re(f.$$.fragment,W),Re(L.$$.fragment,W),ae=!0)},o(W){Ve(f.$$.fragment,W),Ve(L.$$.fragment,W),ae=!1},d(W){W&&we(i),_t(f),_t(L),$=!1,Yn(re)}}}function yC(s){let i,n,l,u,d,f,o,_,T;return{c(){i=Ae("h2"),i.textContent="Bulk operations",n=$e(),l=Ae("p"),l.innerHTML=`Speedwalk has some experimental features that can automatically generate
    separate sidewalks on roads tagged with <i>sidewalk = left,right,both</i>
    . This is intended for use in routers and other tools that require separate sidewalks.
    This generation is very error-prone and not meant to ever replace mapping sidewalks
    properly, just as a stop-gap for areas with low coverage. Feel free to test it
    out, but do not ever upload the results to OSM.`,u=$e(),d=Ae("button"),d.textContent="I understand",f=$e(),o=Ae("button"),o.textContent="Cancel",be(d,"class","btn btn-primary"),be(o,"class","btn btn-secondary")},m(S,y){xe(S,i,y),xe(S,n,y),xe(S,l,y),xe(S,u,y),xe(S,d,y),xe(S,f,y),xe(S,o,y),_||(T=[Jt(d,"click",s[5]),Jt(o,"click",s[12])],_=!0)},p:$t,d(S){S&&(we(i),we(n),we(l),we(u),we(d),we(f),we(o)),_=!1,Yn(T)}}}function bC(s){let i,n,l,u,d,f,o,_;i=new Yc({props:{loading:s[1]}});const T=[dC,fC],S=[];function y(C,L){return C[4]?0:1}l=y(s),u=S[l]=T[l](s);function k(C){s[13](C)}let I={$$slots:{default:[yC]},$$scope:{ctx:s}};return s[0]!==void 0&&(I.show=s[0]),f=new fp({props:I}),Si.push(()=>Yi(f,"show",k)),{c(){yt(i.$$.fragment),n=$e(),u.c(),d=$e(),yt(f.$$.fragment)},m(C,L){gt(i,C,L),xe(C,n,L),S[l].m(C,L),xe(C,d,L),gt(f,C,L),_=!0},p(C,[L]){const N={};L&2&&(N.loading=C[1]),i.$set(N);let R=l;l=y(C),l===R?S[l].p(C,L):(ln(),Ve(S[R],1,1,()=>{S[R]=null}),cn(),u=S[l],u?u.p(C,L):(u=S[l]=T[l](C),u.c()),Re(u,1),u.m(d.parentNode,d));const z={};L&65537&&(z.$$scope={dirty:L,ctx:C}),!o&&L&1&&(o=!0,z.show=C[0],Ji(()=>o=!1)),f.$set(z)},i(C){_||(Re(i.$$.fragment,C),Re(u),Re(f.$$.fragment,C),_=!0)},o(C){Ve(i.$$.fragment,C),Ve(u),Ve(f.$$.fragment,C),_=!1},d(C){C&&(we(n),we(d)),_t(i,C),S[l].d(C),_t(f,C)}}}function vC(s,i,n){let l,u,d;Qt(s,ho,Z=>n(14,l=Z)),Qt(s,ur,Z=>n(15,u=Z)),Qt(s,m_,Z=>n(4,d=Z));let f=!1;function o(){dn(m_,d=!0,d),n(0,f=!1)}let _="",T=!0,S=!0;async function y(){n(1,_="Generating sidewalks"),await Ro();try{u.editMakeAllSidewalks(S),dn(ho,l++,l)}catch(Z){window.alert(`Error: ${Z}`)}finally{n(1,_="")}}async function k(){n(1,_="Connecting crossings"),await Ro();try{u.editConnectAllCrossings(),dn(ho,l++,l)}catch(Z){window.alert(`Error: ${Z}`)}finally{n(1,_="")}}async function I(){n(1,_="Inferring sidewalks around one-ways"),await Ro();try{u.editAssumeTags(T),dn(ho,l++,l)}catch(Z){window.alert(`Error: ${Z}`)}finally{n(1,_="")}}function C(Z){T=Z,n(2,T)}function L(Z){S=Z,n(3,S)}const N=()=>n(0,f=!0),R=()=>n(0,f=!1);function z(Z){f=Z,n(0,f)}return[f,_,T,S,d,o,y,k,I,C,L,N,R,z]}class wC extends di{constructor(i){super(),fi(this,i,vC,bC,si,{})}}function $_(s,i,n){const l=s.slice();return l[11]=i[n][0],l[12]=i[n][1],l[13]=i,l[14]=n,l}function ey(s,i,n){const l=s.slice();return l[11]=i[n][0],l[12]=i[n][1],l[15]=i,l[16]=n,l}function ty(s,i,n){const l=s.slice();l[11]=i[n][0],l[17]=i[n][1];const u=l[1].total_length_meters[l[11]];return l[18]=u,l}function iy(s){let i;return{c(){i=Ae("span"),be(i,"class","svelte-m98wcc"),en(i,"width",`${100*s[18]/s[2]}%`),en(i,"height","100%"),en(i,"background-color",gh[s[11]])},m(n,l){xe(n,i,l)},p(n,l){l&6&&en(i,"width",`${100*n[18]/n[2]}%`)},d(n){n&&we(i)}}}function xC(s){let i,n,l=s[12]+"",u,d,f=uh(s[1].total_length_meters[s[11]])+"",o;return{c(){i=Ae("span"),n=$e(),u=kt(l),d=kt(": "),o=kt(f),be(i,"class","color-swatch svelte-m98wcc"),en(i,"background",gh[s[11]])},m(_,T){xe(_,i,T),xe(_,n,T),xe(_,u,T),xe(_,d,T),xe(_,o,T)},p(_,T){T&2&&f!==(f=uh(_[1].total_length_meters[_[11]])+"")&&Li(o,f)},d(_){_&&(we(i),we(n),we(u),we(d),we(o))}}}function ny(s){let i,n,l,u;function d(o){s[8](o,s[11])}let f={$$slots:{default:[xC]},$$scope:{ctx:s}};return s[0][s[11]]!==void 0&&(f.checked=s[0][s[11]]),n=new us({props:f}),Si.push(()=>Yi(n,"checked",d)),{c(){i=Ae("div"),yt(n.$$.fragment),en(i,"display","flex"),en(i,"align-items","center"),en(i,"gap","6px")},m(o,_){xe(o,i,_),gt(n,i,null),u=!0},p(o,_){s=o;const T={};_&1026&&(T.$$scope={dirty:_,ctx:s}),!l&&_&9&&(l=!0,T.checked=s[0][s[11]],Ji(()=>l=!1)),n.$set(T)},i(o){u||(Re(n.$$.fragment,o),u=!0)},o(o){Ve(n.$$.fragment,o),u=!1},d(o){o&&we(i),_t(n)}}}function SC(s){let i,n,l=s[12]+"",u,d,f=uh(s[1].total_length_meters[s[11]])+"",o;return{c(){i=Ae("span"),n=$e(),u=kt(l),d=kt(": "),o=kt(f),be(i,"class","color-swatch svelte-m98wcc"),en(i,"background",gh[s[11]])},m(_,T){xe(_,i,T),xe(_,n,T),xe(_,u,T),xe(_,d,T),xe(_,o,T)},p(_,T){T&2&&f!==(f=uh(_[1].total_length_meters[_[11]])+"")&&Li(o,f)},d(_){_&&(we(i),we(n),we(u),we(d),we(o))}}}function ry(s){let i,n,l,u,d;function f(_){s[9](_,s[11])}let o={$$slots:{default:[SC]},$$scope:{ctx:s}};return s[0][s[11]]!==void 0&&(o.checked=s[0][s[11]]),n=new us({props:o}),Si.push(()=>Yi(n,"checked",f)),{c(){i=Ae("div"),yt(n.$$.fragment),u=$e(),en(i,"display","flex"),en(i,"align-items","center"),en(i,"gap","6px")},m(_,T){xe(_,i,T),gt(n,i,null),ve(i,u),d=!0},p(_,T){s=_;const S={};T&1026&&(S.$$scope={dirty:T,ctx:s}),!l&&T&17&&(l=!0,S.checked=s[0][s[11]],Ji(()=>l=!1)),n.$set(S)},i(_){d||(Re(n.$$.fragment,_),d=!0)},o(_){Ve(n.$$.fragment,_),d=!1},d(_){_&&we(i),_t(n)}}}function TC(s){let i,n,l,u,d,f,o,_,T,S,y,k,I=Ki(s[3]),C=[];for(let re=0;re<I.length;re+=1)C[re]=iy(ty(s,I,re));let L=Ki(s[3]),N=[];for(let re=0;re<L.length;re+=1)N[re]=ny(ey(s,L,re));const R=re=>Ve(N[re],1,1,()=>{N[re]=null}),z=s[7].default,Z=vn(z,s,s[10],null);let ie=Ki(s[4]),ae=[];for(let re=0;re<ie.length;re+=1)ae[re]=ry($_(s,ie,re));const $=re=>Ve(ae[re],1,1,()=>{ae[re]=null});return{c(){i=Ae("div"),n=Ae("div"),n.textContent="Roads",l=$e(),u=Ae("div"),d=Ae("div");for(let re=0;re<C.length;re+=1)C[re].c();f=$e();for(let re=0;re<N.length;re+=1)N[re].c();o=$e(),_=Ae("div"),T=$e(),Z&&Z.c(),S=$e();for(let re=0;re<ae.length;re+=1)ae[re].c();y=Ln(),be(n,"class","card-header"),be(d,"class","row mb-1 svelte-m98wcc"),be(_,"class","mb-3"),be(u,"class","card-body"),be(i,"class","card mb-3")},m(re,j){xe(re,i,j),ve(i,n),ve(i,l),ve(i,u),ve(u,d);for(let U=0;U<C.length;U+=1)C[U]&&C[U].m(d,null);ve(u,f);for(let U=0;U<N.length;U+=1)N[U]&&N[U].m(u,null);ve(u,o),ve(u,_),ve(u,T),Z&&Z.m(u,null),xe(re,S,j);for(let U=0;U<ae.length;U+=1)ae[U]&&ae[U].m(re,j);xe(re,y,j),k=!0},p(re,[j]){if(j&14){I=Ki(re[3]);let U;for(U=0;U<I.length;U+=1){const J=ty(re,I,U);C[U]?C[U].p(J,j):(C[U]=iy(J),C[U].c(),C[U].m(d,null))}for(;U<C.length;U+=1)C[U].d(1);C.length=I.length}if(j&11){L=Ki(re[3]);let U;for(U=0;U<L.length;U+=1){const J=ey(re,L,U);N[U]?(N[U].p(J,j),Re(N[U],1)):(N[U]=ny(J),N[U].c(),Re(N[U],1),N[U].m(u,o))}for(ln(),U=L.length;U<N.length;U+=1)R(U);cn()}if(Z&&Z.p&&(!k||j&1024)&&xn(Z,z,re,re[10],k?wn(z,re[10],j,null):Sn(re[10]),null),j&19){ie=Ki(re[4]);let U;for(U=0;U<ie.length;U+=1){const J=$_(re,ie,U);ae[U]?(ae[U].p(J,j),Re(ae[U],1)):(ae[U]=ry(J),ae[U].c(),Re(ae[U],1),ae[U].m(y.parentNode,y))}for(ln(),U=ie.length;U<ae.length;U+=1)$(U);cn()}},i(re){if(!k){for(let j=0;j<L.length;j+=1)Re(N[j]);Re(Z,re);for(let j=0;j<ie.length;j+=1)Re(ae[j]);k=!0}},o(re){N=N.filter(Boolean);for(let j=0;j<N.length;j+=1)Ve(N[j]);Ve(Z,re),ae=ae.filter(Boolean);for(let j=0;j<ae.length;j+=1)Ve(ae[j]);k=!1},d(re){re&&(we(i),we(S),we(y)),xr(C,re),xr(N,re),Z&&Z.d(re),xr(ae,re)}}}function kC(s,i,n){let l,u,d;Qt(s,ur,C=>n(5,u=C)),Qt(s,ho,C=>n(6,d=C));let{$$slots:f={},$$scope:o}=i,{showKinds:_}=i,T=[["RoadWithSeparate","With separate sidewalks"],["RoadWithTags","With tagged sidewalks"],["RoadWithoutSidewalksExplicit","Tagged as no sidewalks"],["RoadWithoutSidewalksImplicit","Assumed as no sidewalks"],["RoadUnknown","Totally unknown"]],S=[["Sidewalk","Sidewalks"],["Crossing","Crossings"],["Other","Other"]],y=JSON.parse(u.getMetrics());function k(C,L){s.$$.not_equal(_[L],C)&&(_[L]=C,n(0,_))}function I(C,L){s.$$.not_equal(_[L],C)&&(_[L]=C,n(0,_))}return s.$$set=C=>{"showKinds"in C&&n(0,_=C.showKinds),"$$scope"in C&&n(10,o=C.$$scope)},s.$$.update=()=>{s.$$.dirty&96&&d&&u&&n(1,y=JSON.parse(u.getMetrics())),s.$$.dirty&2&&n(2,l=LS(T.map(([C,L])=>y.total_length_meters[C])))},[_,y,l,T,S,u,d,f,k,I,o]}class CC extends di{constructor(i){super(),fi(this,i,kC,TC,si,{showKinds:0})}}function sy(s,i,n){const l=s.slice();return l[14]=i[n][0],l[15]=i[n][1],l}function oy(s,i,n){const l=s.slice();return l[18]=i[n][0],l[19]=i[n][1],l}function ay(s,i,n){const l=s.slice();return l[18]=i[n][0],l[19]=i[n][1],l}function ly(s,i,n){const l=s.slice();return l[14]=i[n][0],l[15]=i[n][1],l}function cy(s,i,n){const l=s.slice();return l[26]=i[n],l}function uy(s){let i,n,l,u,d,f,o=Ki(s[1].properties.problems),_=[];for(let S=0;S<o.length;S+=1)_[S]=hy(cy(s,o,S));let T=s[2].features.length&&fy(s);return d=new dw({props:{labelColors:Object.fromEntries(s[2].features.map(by)),itemsPerRow:1}}),{c(){i=Ae("u"),i.textContent="Problems:",n=$e();for(let S=0;S<_.length;S+=1)_[S].c();l=$e(),T&&T.c(),u=$e(),yt(d.$$.fragment)},m(S,y){xe(S,i,y),xe(S,n,y);for(let k=0;k<_.length;k+=1)_[k]&&_[k].m(S,y);xe(S,l,y),T&&T.m(S,y),xe(S,u,y),gt(d,S,y),f=!0},p(S,y){if(y&2){o=Ki(S[1].properties.problems);let I;for(I=0;I<o.length;I+=1){const C=cy(S,o,I);_[I]?_[I].p(C,y):(_[I]=hy(C),_[I].c(),_[I].m(l.parentNode,l))}for(;I<_.length;I+=1)_[I].d(1);_.length=o.length}S[2].features.length?T?(T.p(S,y),y&4&&Re(T,1)):(T=fy(S),T.c(),Re(T,1),T.m(u.parentNode,u)):T&&(ln(),Ve(T,1,1,()=>{T=null}),cn());const k={};y&4&&(k.labelColors=Object.fromEntries(S[2].features.map(by))),d.$set(k)},i(S){f||(Re(T),Re(d.$$.fragment,S),f=!0)},o(S){Ve(T),Ve(d.$$.fragment,S),f=!1},d(S){S&&(we(i),we(n),we(l),we(u)),xr(_,S),T&&T.d(S),_t(d,S)}}}function hy(s){let i,n=s[26].note+"",l;return{c(){i=Ae("p"),l=kt(n)},m(u,d){xe(u,i,d),ve(i,l)},p(u,d){d&2&&n!==(n=u[26].note+"")&&Li(l,n)},d(u){u&&we(i)}}}function fy(s){let i,n,l;function u(f){s[9](f)}let d={$$slots:{default:[EC]},$$scope:{ctx:s}};return s[0]!==void 0&&(d.checked=s[0]),i=new us({props:d}),Si.push(()=>Yi(i,"checked",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,o){const _={};o&536870912&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.checked=f[0],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function EC(s){let i;return{c(){i=kt("Show problem details")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function IC(s){let i,n,l,u=Ki(s[7].entries()),d=[];for(let f=0;f<u.length;f+=1)d[f]=dy(oy(s,u,f));return{c(){i=Ae("u"),i.textContent="Set these tags",n=$e();for(let f=0;f<d.length;f+=1)d[f].c();l=Ln()},m(f,o){xe(f,i,o),xe(f,n,o);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(f,o);xe(f,l,o)},p(f,o){if(o&160){u=Ki(f[7].entries());let _;for(_=0;_<u.length;_+=1){const T=oy(f,u,_);d[_]?d[_].p(T,o):(d[_]=dy(T),d[_].c(),d[_].m(l.parentNode,l))}for(;_<d.length;_+=1)d[_].d(1);d.length=u.length}},d(f){f&&(we(i),we(n),we(l)),xr(d,f)}}}function AC(s){let i,n,l,u,d,f,o,_=Ki(Object.entries(s[1].properties.tags)),T=[];for(let k=0;k<_.length;k+=1)T[k]=my(ly(s,_,k));let S=Ki(s[6].entries()),y=[];for(let k=0;k<S.length;k+=1)y[k]=gy(ay(s,S,k));return{c(){i=Ae("u"),i.textContent="Current sidewalk tags",n=$e(),l=Ae("ul");for(let k=0;k<T.length;k+=1)T[k].c();u=$e(),d=Ae("u"),d.textContent="Override to these tags",f=$e();for(let k=0;k<y.length;k+=1)y[k].c();o=Ln()},m(k,I){xe(k,i,I),xe(k,n,I),xe(k,l,I);for(let C=0;C<T.length;C+=1)T[C]&&T[C].m(l,null);xe(k,u,I),xe(k,d,I),xe(k,f,I);for(let C=0;C<y.length;C+=1)y[C]&&y[C].m(k,I);xe(k,o,I)},p(k,I){if(I&2){_=Ki(Object.entries(k[1].properties.tags));let C;for(C=0;C<_.length;C+=1){const L=ly(k,_,C);T[C]?T[C].p(L,I):(T[C]=my(L),T[C].c(),T[C].m(l,null))}for(;C<T.length;C+=1)T[C].d(1);T.length=_.length}if(I&96){S=Ki(k[6].entries());let C;for(C=0;C<S.length;C+=1){const L=ay(k,S,C);y[C]?y[C].p(L,I):(y[C]=gy(L),y[C].c(),y[C].m(o.parentNode,o))}for(;C<y.length;C+=1)y[C].d(1);y.length=S.length}},d(k){k&&(we(i),we(n),we(l),we(u),we(d),we(f),we(o)),xr(T,k),xr(y,k)}}}function dy(s){let i,n,l,u,d=s[19].map(LC).join(", ")+"",f,o,_,T;function S(){return s[11](s[19])}return{c(){i=Ae("div"),n=Ae("button"),l=Ae("kbd"),l.textContent=`${s[18]+1}`,u=$e(),f=kt(d),o=$e(),be(n,"class","btn btn-secondary mb-1")},m(y,k){xe(y,i,k),ve(i,n),ve(n,l),ve(n,u),ve(n,f),ve(i,o),_||(T=Jt(n,"click",S),_=!0)},p(y,k){s=y},d(y){y&&we(i),_=!1,T()}}}function py(s){let i,n=s[14]+"",l,u,d=s[15]+"",f;return{c(){i=Ae("li"),l=kt(n),u=kt(" = "),f=kt(d)},m(o,_){xe(o,i,_),ve(i,l),ve(i,u),ve(i,f)},p(o,_){_&2&&n!==(n=o[14]+"")&&Li(l,n),_&2&&d!==(d=o[15]+"")&&Li(f,d)},d(o){o&&we(i)}}}function my(s){let i=s[14].startsWith("sidewalk"),n,l=i&&py(s);return{c(){l&&l.c(),n=Ln()},m(u,d){l&&l.m(u,d),xe(u,n,d)},p(u,d){d&2&&(i=u[14].startsWith("sidewalk")),i?l?l.p(u,d):(l=py(u),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null)},d(u){u&&we(n),l&&l.d(u)}}}function gy(s){let i,n,l,u,d=s[19].map(PC).join(", ")+"",f,o,_,T;function S(){return s[10](s[19])}return{c(){i=Ae("div"),n=Ae("button"),l=Ae("kbd"),l.textContent=`${s[18]+1}`,u=$e(),f=kt(d),o=$e(),be(n,"class","btn btn-secondary mb-1")},m(y,k){xe(y,i,k),ve(i,n),ve(n,l),ve(n,u),ve(n,f),ve(i,o),_||(T=Jt(n,"click",S),_=!0)},p(y,k){s=y},d(y){y&&we(i),_=!1,T()}}}function _y(s){let i,n,l=s[14]+"",u,d,f,o=s[15]+"",_,T;return{c(){i=Ae("tr"),n=Ae("td"),u=kt(l),d=$e(),f=Ae("td"),_=kt(o),T=$e()},m(S,y){xe(S,i,y),ve(i,n),ve(n,u),ve(i,d),ve(i,f),ve(f,_),ve(i,T)},p(S,y){y&2&&l!==(l=S[14]+"")&&Li(u,l),y&2&&o!==(o=S[15]+"")&&Li(_,o)},d(S){S&&we(i)}}}function yy(s){let i,n,l=s[1].properties.node_ids.join(", ")+"",u;return{c(){i=Ae("p"),n=kt("Nodes: "),u=kt(l)},m(d,f){xe(d,i,f),ve(i,n),ve(i,u)},p(d,f){f&2&&l!==(l=d[1].properties.node_ids.join(", ")+"")&&Li(u,l)},d(d){d&&we(i)}}}function MC(s){let i,n,l,u,d,f,o=s[1].properties.id+"",_,T,S,y=Z_[s[1].properties.kind]+"",k,I,C,L,N,R,z,Z,ie,ae,$,re,j,U;i=new Yc({props:{loading:s[3]}});let J=s[1].properties.problems.length&&uy(s);function B(ce,Le){if(Le&2&&(N=null),N==null&&(N=!!ce[1].properties.kind.startsWith("Road")),N)return AC;if(ce[1].properties.kind=="Sidewalk"||ce[1].properties.kind=="Other")return IC}let W=B(s,-1),le=W&&W(s),ge=Ki(Object.entries(s[1].properties.tags)),pe=[];for(let ce=0;ce<ge.length;ce+=1)pe[ce]=_y(sy(s,ge,ce));let _e=s[4]&&yy(s);return{c(){yt(i.$$.fragment),n=$e(),l=Ae("div"),u=Ae("div"),d=Ae("a"),f=kt("Way "),_=kt(o),S=kt(`
    : `),k=kt(y),I=$e(),C=Ae("div"),J&&J.c(),L=$e(),le&&le.c(),R=$e(),z=Ae("table"),Z=Ae("thead"),Z.innerHTML="<tr><th>Key</th> <th>Value</th></tr>",ie=$e(),ae=Ae("tbody");for(let ce=0;ce<pe.length;ce+=1)pe[ce].c();$=$e(),_e&&_e.c(),be(d,"href",T="https://www.openstreetmap.org/way/"+s[1].properties.id),be(d,"target","_blank"),be(u,"class","card-header"),be(z,"class","table table-bordered"),be(C,"class","card-body"),be(l,"class","card mb-5")},m(ce,Le){gt(i,ce,Le),xe(ce,n,Le),xe(ce,l,Le),ve(l,u),ve(u,d),ve(d,f),ve(d,_),ve(u,S),ve(u,k),ve(l,I),ve(l,C),J&&J.m(C,null),ve(C,L),le&&le.m(C,null),ve(C,R),ve(C,z),ve(z,Z),ve(z,ie),ve(z,ae);for(let ze=0;ze<pe.length;ze+=1)pe[ze]&&pe[ze].m(ae,null);ve(C,$),_e&&_e.m(C,null),re=!0,j||(U=Jt(window,"keypress",s[8]),j=!0)},p(ce,[Le]){const ze={};if(Le&8&&(ze.loading=ce[3]),i.$set(ze),(!re||Le&2)&&o!==(o=ce[1].properties.id+"")&&Li(_,o),(!re||Le&2&&T!==(T="https://www.openstreetmap.org/way/"+ce[1].properties.id))&&be(d,"href",T),(!re||Le&2)&&y!==(y=Z_[ce[1].properties.kind]+"")&&Li(k,y),ce[1].properties.problems.length?J?(J.p(ce,Le),Le&2&&Re(J,1)):(J=uy(ce),J.c(),Re(J,1),J.m(C,L)):J&&(ln(),Ve(J,1,1,()=>{J=null}),cn()),W===(W=B(ce,Le))&&le?le.p(ce,Le):(le&&le.d(1),le=W&&W(ce),le&&(le.c(),le.m(C,R))),Le&2){ge=Ki(Object.entries(ce[1].properties.tags));let ct;for(ct=0;ct<ge.length;ct+=1){const nt=sy(ce,ge,ct);pe[ct]?pe[ct].p(nt,Le):(pe[ct]=_y(nt),pe[ct].c(),pe[ct].m(ae,null))}for(;ct<pe.length;ct+=1)pe[ct].d(1);pe.length=ge.length}ce[4]?_e?_e.p(ce,Le):(_e=yy(ce),_e.c(),_e.m(C,null)):_e&&(_e.d(1),_e=null)},i(ce){re||(Re(i.$$.fragment,ce),Re(J),re=!0)},o(ce){Ve(i.$$.fragment,ce),Ve(J),re=!1},d(ce){ce&&(we(n),we(l)),_t(i,ce),J&&J.d(),le&&le.d(),xr(pe,ce),_e&&_e.d(),j=!1,U()}}}const by=s=>[s.properties.label,s.properties.color],PC=s=>`${s[0]} = ${s[1]}`,LC=s=>`${s[0]} = ${s[1]}`;function zC(s,i,n){let l,u,d;Qt(s,ho,R=>n(12,l=R)),Qt(s,ur,R=>n(13,u=R)),Qt(s,gf,R=>n(4,d=R));let{pinnedWay:f}=i,{drawProblemDetails:o}=i,{showProblemDetails:_}=i,T="";async function S(R){n(3,T="Setting tags"),await Ro();try{u.editSetTags(BigInt(f.properties.id),R),dn(ho,l++,l)}finally{n(3,T="")}}let y=[[["sidewalk:both","separate"]],[["sidewalk:left","separate"],["sidewalk:right","no"]],[["sidewalk:right","separate"],["sidewalk:left","no"]],[["sidewalk","both"]],[["sidewalk","left"]],[["sidewalk","right"]],[["sidewalk","no"]]],k=[[["footway","sidewalk"]],[["footway","crossing"]]];async function I(R){let z=[];f.properties.kind.startsWith("Road")?z=y:(f.properties.kind=="Sidewalk"||f.properties.kind=="Other")&&(z=k);let Z=parseInt(R.key);Number.isInteger(Z)&&Z<=z.length&&await S(z[Z-1])}function C(R){_=R,n(0,_)}const L=R=>S(R),N=R=>S(R);return s.$$set=R=>{"pinnedWay"in R&&n(1,f=R.pinnedWay),"drawProblemDetails"in R&&n(2,o=R.drawProblemDetails),"showProblemDetails"in R&&n(0,_=R.showProblemDetails)},[_,f,o,T,d,S,y,k,I,C,L,N]}class OC extends di{constructor(i){super(),fi(this,i,zC,MC,si,{pinnedWay:1,drawProblemDetails:2,showProblemDetails:0})}}function vy(s){var l;const i=((l=s[30])==null?void 0:l.properties)??{};s[31]=i;const n=JSON.parse(s[31].problems);s[32]=n}function wy(s,i,n){const l=s.slice();return l[33]=i[n],l}function xy(s,i,n){const l=s.slice();return l[36]=i[n][0],l[37]=i[n][1],l}function Sy(s){let i,n,l;function u(f){s[27](f)}let d={pinnedWay:s[2],drawProblemDetails:s[9]};return s[8]!==void 0&&(d.showProblemDetails=s[8]),i=new OC({props:d}),Si.push(()=>Yi(i,"showProblemDetails",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,o){const _={};o[0]&4&&(_.pinnedWay=f[2]),o[0]&512&&(_.drawProblemDetails=f[9]),!n&&o[0]&256&&(n=!0,_.showProblemDetails=f[8],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function DC(s){let i,n,l,u,d,f,o,_,T,S,y,k,I,C,L,N;u=new sC({props:{anyEdits:s[10]}});function R($){s[25]($)}let z={};s[10]!==void 0&&(z.anyEdits=s[10]),f=new hC({props:z}),Si.push(()=>Yi(f,"anyEdits",R));function Z($){s[26]($)}let ie={nodes:s[0],ways:s[1]};s[12]!==void 0&&(ie.drawProblems=s[12]),T=new Yk({props:ie}),Si.push(()=>Yi(T,"drawProblems",Z));let ae=s[2]&&Sy(s);return I=new wC({}),{c(){i=Ae("div"),n=Ae("button"),n.textContent="Load another area",l=$e(),yt(u.$$.fragment),d=$e(),yt(f.$$.fragment),_=$e(),yt(T.$$.fragment),y=$e(),ae&&ae.c(),k=$e(),yt(I.$$.fragment),be(n,"class","btn btn-secondary"),be(i,"slot","sidebar")},m($,re){xe($,i,re),ve(i,n),ve(i,l),gt(u,i,null),ve(i,d),gt(f,i,null),ve(i,_),gt(T,i,null),ve(i,y),ae&&ae.m(i,null),ve(i,k),gt(I,i,null),C=!0,L||(N=Jt(n,"click",s[15]),L=!0)},p($,re){const j={};re[0]&1024&&(j.anyEdits=$[10]),u.$set(j);const U={};!o&&re[0]&1024&&(o=!0,U.anyEdits=$[10],Ji(()=>o=!1)),f.$set(U);const J={};re[0]&1&&(J.nodes=$[0]),re[0]&2&&(J.ways=$[1]),!S&&re[0]&4096&&(S=!0,J.drawProblems=$[12],Ji(()=>S=!1)),T.$set(J),$[2]?ae?(ae.p($,re),re[0]&4&&Re(ae,1)):(ae=Sy($),ae.c(),Re(ae,1),ae.m(i,k)):ae&&(ln(),Ve(ae,1,1,()=>{ae=null}),cn())},i($){C||(Re(u.$$.fragment,$),Re(f.$$.fragment,$),Re(T.$$.fragment,$),Re(ae),Re(I.$$.fragment,$),C=!0)},o($){Ve(u.$$.fragment,$),Ve(f.$$.fragment,$),Ve(T.$$.fragment,$),Ve(ae),Ve(I.$$.fragment,$),C=!1},d($){$&&we(i),_t(u),_t(f),_t(T),ae&&ae.d(),_t(I),L=!1,N()}}}function Ty(s){let i,n,l=s[36]+"",u,d,f,o=s[37]+"",_,T;return{c(){i=Ae("tr"),n=Ae("td"),u=kt(l),d=$e(),f=Ae("td"),_=kt(o),T=$e()},m(S,y){xe(S,i,y),ve(i,n),ve(n,u),ve(i,d),ve(i,f),ve(f,_),ve(i,T)},p(S,y){y[0]&1073741824&&l!==(l=S[36]+"")&&Li(u,l),y[0]&1073741824&&o!==(o=S[37]+"")&&Li(_,o)},d(S){S&&we(i)}}}function ky(s){let i,n,l,u=Ki(s[32]),d=[];for(let f=0;f<u.length;f+=1)d[f]=Cy(wy(s,u,f));return{c(){i=Ae("u"),i.textContent="Problems:",n=$e();for(let f=0;f<d.length;f+=1)d[f].c();l=Ln()},m(f,o){xe(f,i,o),xe(f,n,o);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(f,o);xe(f,l,o)},p(f,o){if(o[0]&1073741824){u=Ki(f[32]);let _;for(_=0;_<u.length;_+=1){const T=wy(f,u,_);d[_]?d[_].p(T,o):(d[_]=Cy(T),d[_].c(),d[_].m(l.parentNode,l))}for(;_<d.length;_+=1)d[_].d(1);d.length=u.length}},d(f){f&&(we(i),we(n),we(l)),xr(d,f)}}}function Cy(s){let i,n=s[33].note+"",l;return{c(){i=Ae("p"),l=kt(n)},m(u,d){xe(u,i,d),ve(i,l)},p(u,d){d[0]&1073741824&&n!==(n=u[33].note+"")&&Li(l,n)},d(u){u&&we(i)}}}function FC(s){vy(s);let i,n,l=s[31].id+"",u,d,f,o,_=s[31].way_ids+"",T,S,y,k,I,C,L=Ki(Object.entries(JSON.parse(s[31].tags||"{}"))),N=[];for(let z=0;z<L.length;z+=1)N[z]=Ty(xy(s,L,z));let R=s[32].length&&ky(s);return{c(){i=Ae("h4"),n=kt("Node "),u=kt(l),d=$e(),f=Ae("p"),o=kt("Ways: "),T=kt(_),S=$e(),y=Ae("table"),k=Ae("tbody");for(let z=0;z<N.length;z+=1)N[z].c();I=$e(),R&&R.c(),C=Ln(),be(y,"class","table table-bordered")},m(z,Z){xe(z,i,Z),ve(i,n),ve(i,u),xe(z,d,Z),xe(z,f,Z),ve(f,o),ve(f,T),xe(z,S,Z),xe(z,y,Z),ve(y,k);for(let ie=0;ie<N.length;ie+=1)N[ie]&&N[ie].m(k,null);xe(z,I,Z),R&&R.m(z,Z),xe(z,C,Z)},p(z,Z){if(vy(z),Z[0]&1073741824&&l!==(l=z[31].id+"")&&Li(u,l),Z[0]&1073741824&&_!==(_=z[31].way_ids+"")&&Li(T,_),Z[0]&1073741824){L=Ki(Object.entries(JSON.parse(z[31].tags||"{}")));let ie;for(ie=0;ie<L.length;ie+=1){const ae=xy(z,L,ie);N[ie]?N[ie].p(ae,Z):(N[ie]=Ty(ae),N[ie].c(),N[ie].m(k,null))}for(;ie<N.length;ie+=1)N[ie].d(1);N.length=L.length}z[32].length?R?R.p(z,Z):(R=ky(z),R.c(),R.m(C.parentNode,C)):R&&(R.d(1),R=null)},d(z){z&&(we(i),we(d),we(f),we(S),we(y),we(I),we(C)),xr(N,z),R&&R.d(z)}}}function RC(s){let i,n;return i=new H0({props:{openOn:"hover",$$slots:{default:[FC,({data:l})=>({30:l}),({data:l})=>[l?1073741824:0]]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u[0]&1073741824|u[1]&512&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function BC(s){let i,n;return i=new $c({props:{id:"nodes",beforeId:"Road labels",manageHoverState:!0,paint:{"circle-radius":7,"circle-color":["case",["get","is_crossing"],"yellow","grey"],"circle-opacity":["case",["boolean",["get","is_crossing"]],s[4]?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1},layout:{visibility:s[3]?"visible":"none"},$$slots:{default:[RC]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u[0]&16&&(d.paint={"circle-radius":7,"circle-color":["case",["get","is_crossing"],"yellow","grey"],"circle-opacity":["case",["boolean",["get","is_crossing"]],l[4]?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1}),u[0]&8&&(d.layout={visibility:l[3]?"visible":"none"}),u[1]&512&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function NC(s){let i;return{c(){i=Ae("div"),i.textContent="Layers",be(i,"slot","header")},m(n,l){xe(n,i,l)},p:$t,d(n){n&&we(i)}}}function jC(s){let i;return{c(){i=kt("Debug mode")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function UC(s){let i;return{c(){i=kt("Nodes")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function VC(s){let i;return{c(){i=kt("Only modified objects")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function qC(s){let i;return{c(){i=kt("Only show major roads")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function ZC(s){let i;return{c(){i=kt("Show service roads")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function WC(s){let i,n,l,u,d,f;function o(y){s[22](y)}let _={$$slots:{default:[qC]},$$scope:{ctx:s}};s[5]!==void 0&&(_.checked=s[5]),i=new us({props:_}),Si.push(()=>Yi(i,"checked",o));function T(y){s[23](y)}let S={$$slots:{default:[ZC]},$$scope:{ctx:s}};return s[6]!==void 0&&(S.checked=s[6]),u=new us({props:S}),Si.push(()=>Yi(u,"checked",T)),{c(){yt(i.$$.fragment),l=$e(),yt(u.$$.fragment)},m(y,k){gt(i,y,k),xe(y,l,k),gt(u,y,k),f=!0},p(y,k){const I={};k[1]&512&&(I.$$scope={dirty:k,ctx:y}),!n&&k[0]&32&&(n=!0,I.checked=y[5],Ji(()=>n=!1)),i.$set(I);const C={};k[1]&512&&(C.$$scope={dirty:k,ctx:y}),!d&&k[0]&64&&(d=!0,C.checked=y[6],Ji(()=>d=!1)),u.$set(C)},i(y){f||(Re(i.$$.fragment,y),Re(u.$$.fragment,y),f=!0)},o(y){Ve(i.$$.fragment,y),Ve(u.$$.fragment,y),f=!1},d(y){y&&we(l),_t(i,y),_t(u,y)}}}function GC(s){let i,n,l,u,d,f,o,_,T,S,y,k,I;function C($){s[19]($)}let L={$$slots:{default:[jC]},$$scope:{ctx:s}};s[13]!==void 0&&(L.checked=s[13]),n=new us({props:L}),Si.push(()=>Yi(n,"checked",C));function N($){s[20]($)}let R={$$slots:{default:[UC]},$$scope:{ctx:s}};s[3]!==void 0&&(R.checked=s[3]),d=new us({props:R}),Si.push(()=>Yi(d,"checked",N));function z($){s[21]($)}let Z={$$slots:{default:[VC]},$$scope:{ctx:s}};s[4]!==void 0&&(Z.checked=s[4]),_=new us({props:Z}),Si.push(()=>Yi(_,"checked",z));function ie($){s[24]($)}let ae={$$slots:{default:[WC]},$$scope:{ctx:s}};return s[7]!==void 0&&(ae.showKinds=s[7]),y=new CC({props:ae}),Si.push(()=>Yi(y,"showKinds",ie)),{c(){i=Ae("div"),yt(n.$$.fragment),u=$e(),yt(d.$$.fragment),o=$e(),yt(_.$$.fragment),S=$e(),yt(y.$$.fragment),be(i,"slot","body")},m($,re){xe($,i,re),gt(n,i,null),ve(i,u),gt(d,i,null),ve(i,o),gt(_,i,null),ve(i,S),gt(y,i,null),I=!0},p($,re){const j={};re[1]&512&&(j.$$scope={dirty:re,ctx:$}),!l&&re[0]&8192&&(l=!0,j.checked=$[13],Ji(()=>l=!1)),n.$set(j);const U={};re[1]&512&&(U.$$scope={dirty:re,ctx:$}),!f&&re[0]&8&&(f=!0,U.checked=$[3],Ji(()=>f=!1)),d.$set(U);const J={};re[1]&512&&(J.$$scope={dirty:re,ctx:$}),!T&&re[0]&16&&(T=!0,J.checked=$[4],Ji(()=>T=!1)),_.$set(J);const B={};re[0]&96|re[1]&512&&(B.$$scope={dirty:re,ctx:$}),!k&&re[0]&128&&(k=!0,B.showKinds=$[7],Ji(()=>k=!1)),y.$set(B)},i($){I||(Re(n.$$.fragment,$),Re(d.$$.fragment,$),Re(_.$$.fragment,$),Re(y.$$.fragment,$),I=!0)},o($){Ve(n.$$.fragment,$),Ve(d.$$.fragment,$),Ve(_.$$.fragment,$),Ve(y.$$.fragment,$),I=!1},d($){$&&we(i),_t(n),_t(d),_t(_),_t(y)}}}function HC(s){let i,n;return i=new Tf({props:{$$slots:{body:[GC],header:[NC]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u[0]&8440|u[1]&512&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function XC(s){let i,n,l,u,d,f,o,_,T,S,y;function k(L){s[17](L)}function I(L){s[18](L)}let C={showProblemDetails:s[8],nodes:s[0],ways:s[1],filterWays:s[14](s[5],s[4],s[6],s[7])};return s[2]!==void 0&&(C.pinnedWay=s[2]),s[9]!==void 0&&(C.drawProblemDetails=s[9]),n=new Mk({props:C}),Si.push(()=>Yi(n,"pinnedWay",k)),Si.push(()=>Yi(n,"drawProblemDetails",I)),f=new tC({props:{drawProblems:s[12],pinnedWay:s[2]}}),_=new cs({props:{data:s[0],$$slots:{default:[BC]},$$scope:{ctx:s}}}),S=new R2({props:{position:"top-right",$$slots:{default:[HC]},$$scope:{ctx:s}}}),{c(){i=Ae("div"),yt(n.$$.fragment),d=$e(),yt(f.$$.fragment),o=$e(),yt(_.$$.fragment),T=$e(),yt(S.$$.fragment),be(i,"slot","map")},m(L,N){xe(L,i,N),gt(n,i,null),ve(i,d),gt(f,i,null),ve(i,o),gt(_,i,null),ve(i,T),gt(S,i,null),y=!0},p(L,N){const R={};N[0]&256&&(R.showProblemDetails=L[8]),N[0]&1&&(R.nodes=L[0]),N[0]&2&&(R.ways=L[1]),N[0]&240&&(R.filterWays=L[14](L[5],L[4],L[6],L[7])),!l&&N[0]&4&&(l=!0,R.pinnedWay=L[2],Ji(()=>l=!1)),!u&&N[0]&512&&(u=!0,R.drawProblemDetails=L[9],Ji(()=>u=!1)),n.$set(R);const z={};N[0]&4096&&(z.drawProblems=L[12]),N[0]&4&&(z.pinnedWay=L[2]),f.$set(z);const Z={};N[0]&1&&(Z.data=L[0]),N[0]&24|N[1]&512&&(Z.$$scope={dirty:N,ctx:L}),_.$set(Z);const ie={};N[0]&8440|N[1]&512&&(ie.$$scope={dirty:N,ctx:L}),S.$set(ie)},i(L){y||(Re(n.$$.fragment,L),Re(f.$$.fragment,L),Re(_.$$.fragment,L),Re(S.$$.fragment,L),y=!0)},o(L){Ve(n.$$.fragment,L),Ve(f.$$.fragment,L),Ve(_.$$.fragment,L),Ve(S.$$.fragment,L),y=!1},d(L){L&&we(i),_t(n),_t(f),_t(_),_t(S)}}}function KC(s){let i,n,l,u;return i=new Yc({props:{loading:s[11]}}),l=new Sf({props:{$$slots:{map:[XC],sidebar:[DC]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(l,d,f),u=!0},p(d,f){const o={};f[0]&2048&&(o.loading=d[11]),i.$set(o);const _={};f[0]&14335|f[1]&512&&(_.$$scope={dirty:f,ctx:d}),l.$set(_)},i(d){u||(Re(i.$$.fragment,d),Re(l.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(l.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(l,d)}}}function JC(s,i,n){let l,u,d;Qt(s,ur,ce=>n(28,l=ce)),Qt(s,ho,ce=>n(16,u=ce)),Qt(s,gf,ce=>n(13,d=ce));let f={type:"FeatureCollection",features:[]},o={type:"FeatureCollection",features:[]},_=null,T=!1,S=!1,y=!1,k=!0,I=Object.fromEntries(Object.keys(gh).map(ce=>[ce,!0])),C=!0,L=qs(),N=!1,R="",z=qs();async function Z(ce){n(11,R="Recalculating model"),await Ro();try{n(0,f=JSON.parse(l.getNodes())),n(1,o=JSON.parse(l.getWays()))}finally{n(11,R="")}if(_){let Le=_.id;n(2,_=o.features.find(ze=>ze.id==Le))}}function ie(ce,Le,ze,ct){let nt=[];return y&&nt.push(["any",["in",["get","kind"],["literal",["Sidewalk","Crossing","Other"]]],["get","is_severance"]]),k||nt.push(["!",["get","is_service"]]),S&&nt.push(["get","modified"]),nt.push(["in",["get","kind"],["literal",Object.entries(I).filter(bt=>bt[1]).map(bt=>bt[0])]]),["all",...nt]}function ae(){N&&!window.confirm("Changing areas will discard your current edits. Do you want to clear the edits?")||dn(ur,l=null,l)}function $(ce){_=ce,n(2,_)}function re(ce){L=ce,n(9,L)}function j(ce){d=ce,gf.set(d)}function U(ce){T=ce,n(3,T)}function J(ce){S=ce,n(4,S)}function B(ce){y=ce,n(5,y)}function W(ce){k=ce,n(6,k)}function le(ce){I=ce,n(7,I)}function ge(ce){N=ce,n(10,N)}function pe(ce){z=ce,n(12,z)}function _e(ce){C=ce,n(8,C)}return s.$$.update=()=>{s.$$.dirty[0]&65536&&Z()},[f,o,_,T,S,y,k,I,C,L,N,R,z,d,ie,ae,u,$,re,j,U,J,B,W,le,ge,pe,_e]}class YC extends di{constructor(i){super(),fi(this,i,JC,KC,si,{},null,[-1,-1])}}function Ey(s){var n;const i=((n=s[2])==null?void 0:n.properties)??{};s[10]=i}function Iy(s,i,n){const l=s.slice();return l[11]=i[n][0],l[12]=i[n][1],l}function QC(s){let i;return{c(){i=kt("Ignore service roads")},m(n,l){xe(n,i,l)},d(n){n&&we(i)}}}function Ay(s){let i,n,l=s[5].features.length+"",u,d,f=s[4].features.length+"",o,_;return{c(){i=Ae("p"),n=kt("Junction has "),u=kt(l),d=kt(" arms, "),o=kt(f),_=kt(" crossings"),be(i,"class","mt-5")},m(T,S){xe(T,i,S),ve(i,n),ve(i,u),ve(i,d),ve(i,o),ve(i,_)},p(T,S){S&32&&l!==(l=T[5].features.length+"")&&Li(u,l),S&16&&f!==(f=T[4].features.length+"")&&Li(o,f)},d(T){T&&we(i)}}}function $C(s){let i,n,l,u,d=s[6].toLocaleString()+"",f,o,_=s[2].features.length.toLocaleString()+"",T,S,y,k,I,C,L;function N(Z){s[9](Z)}let R={$$slots:{default:[QC]},$$scope:{ctx:s}};s[0]!==void 0&&(R.checked=s[0]),k=new us({props:R}),Si.push(()=>Yi(k,"checked",N));let z=s[1]&&Ay(s);return{c(){i=Ae("div"),n=Ae("h4"),n.textContent="Crossings audit (experimental)",l=$e(),u=Ae("p"),f=kt(d),o=kt(" / "),T=kt(_),S=kt(`
      junctions have all possible crossings mapped`),y=$e(),yt(k.$$.fragment),C=$e(),z&&z.c(),be(i,"slot","sidebar")},m(Z,ie){xe(Z,i,ie),ve(i,n),ve(i,l),ve(i,u),ve(u,f),ve(u,o),ve(u,T),ve(u,S),ve(i,y),gt(k,i,null),ve(i,C),z&&z.m(i,null),L=!0},p(Z,ie){(!L||ie&64)&&d!==(d=Z[6].toLocaleString()+"")&&Li(f,d),(!L||ie&4)&&_!==(_=Z[2].features.length.toLocaleString()+"")&&Li(T,_);const ae={};ie&32768&&(ae.$$scope={dirty:ie,ctx:Z}),!I&&ie&1&&(I=!0,ae.checked=Z[0],Ji(()=>I=!1)),k.$set(ae),Z[1]?z?z.p(Z,ie):(z=Ay(Z),z.c(),z.m(i,null)):z&&(z.d(1),z=null)},i(Z){L||(Re(k.$$.fragment,Z),L=!0)},o(Z){Ve(k.$$.fragment,Z),L=!1},d(Z){Z&&we(i),_t(k),z&&z.d()}}}function eE(s){let i,n,l;function u(f){s[8](f)}let d={manageHoverState:!0,paint:{"circle-radius":15,"circle-color":["case",["get","complete"],"green","black"],"circle-opacity":pf(.5,1),"circle-stroke-color":"black","circle-stroke-width":3}};return s[1]!==void 0&&(d.hovered=s[1]),i=new $c({props:d}),Si.push(()=>Yi(i,"hovered",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),l=!0},p(f,o){const _={};!n&&o&2&&(n=!0,_.hovered=f[1],Ji(()=>n=!1)),i.$set(_)},i(f){l||(Re(i.$$.fragment,f),l=!0)},o(f){Ve(i.$$.fragment,f),l=!1},d(f){_t(i,f)}}}function tE(s){let i,n;return i=new il({props:{paint:{"line-width":6,"line-color":"blue"}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p:$t,i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function My(s){let i,n,l=s[11]+"",u,d,f,o=s[12]+"",_,T;return{c(){i=Ae("tr"),n=Ae("td"),u=kt(l),d=$e(),f=Ae("td"),_=kt(o),T=$e()},m(S,y){xe(S,i,y),ve(i,n),ve(n,u),ve(i,d),ve(i,f),ve(f,_),ve(i,T)},p(S,y){y&4&&l!==(l=S[11]+"")&&Li(u,l),y&4&&o!==(o=S[12]+"")&&Li(_,o)},d(S){S&&we(i)}}}function iE(s){Ey(s);let i,n,l=s[10].id+"",u,d,f,o,_=Ki(Object.entries(JSON.parse(s[10].tags||"{}"))),T=[];for(let S=0;S<_.length;S+=1)T[S]=My(Iy(s,_,S));return{c(){i=Ae("h4"),n=kt("Node "),u=kt(l),d=$e(),f=Ae("table"),o=Ae("tbody");for(let S=0;S<T.length;S+=1)T[S].c();be(f,"class","table table-bordered")},m(S,y){xe(S,i,y),ve(i,n),ve(i,u),xe(S,d,y),xe(S,f,y),ve(f,o);for(let k=0;k<T.length;k+=1)T[k]&&T[k].m(o,null)},p(S,y){if(Ey(S),y&4&&l!==(l=S[10].id+"")&&Li(u,l),y&4){_=Ki(Object.entries(JSON.parse(S[10].tags||"{}")));let k;for(k=0;k<_.length;k+=1){const I=Iy(S,_,k);T[k]?T[k].p(I,y):(T[k]=My(I),T[k].c(),T[k].m(o,null))}for(;k<T.length;k+=1)T[k].d(1);T.length=_.length}},d(S){S&&(we(i),we(d),we(f)),xr(T,S)}}}function nE(s){let i,n;return i=new H0({props:{openOn:"hover",$$slots:{default:[iE,({data:l})=>({2:l}),({data:l})=>l?4:0]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u&32772&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function rE(s){let i,n;return i=new $c({props:{manageHoverState:!0,paint:{"circle-radius":7,"circle-color":"yellow","circle-opacity":pf(.3,1),"circle-stroke-color":"black","circle-stroke-width":1},$$slots:{default:[nE]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u&32772&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function sE(s){let i,n;return i=new $c({props:{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"red","circle-stroke-width":3}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p:$t,i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function oE(s){let i,n,l,u,d,f,o,_,T;return n=new cs({props:{data:s[2],generateId:!0,$$slots:{default:[eE]},$$scope:{ctx:s}}}),u=new cs({props:{data:s[5],$$slots:{default:[tE]},$$scope:{ctx:s}}}),f=new cs({props:{data:s[3],generateId:!0,$$slots:{default:[rE]},$$scope:{ctx:s}}}),_=new cs({props:{data:s[4],$$slots:{default:[sE]},$$scope:{ctx:s}}}),{c(){i=Ae("div"),yt(n.$$.fragment),l=$e(),yt(u.$$.fragment),d=$e(),yt(f.$$.fragment),o=$e(),yt(_.$$.fragment),be(i,"slot","map")},m(S,y){xe(S,i,y),gt(n,i,null),ve(i,l),gt(u,i,null),ve(i,d),gt(f,i,null),ve(i,o),gt(_,i,null),T=!0},p(S,y){const k={};y&4&&(k.data=S[2]),y&32770&&(k.$$scope={dirty:y,ctx:S}),n.$set(k);const I={};y&32&&(I.data=S[5]),y&32768&&(I.$$scope={dirty:y,ctx:S}),u.$set(I);const C={};y&8&&(C.data=S[3]),y&32772&&(C.$$scope={dirty:y,ctx:S}),f.$set(C);const L={};y&16&&(L.data=S[4]),y&32768&&(L.$$scope={dirty:y,ctx:S}),_.$set(L)},i(S){T||(Re(n.$$.fragment,S),Re(u.$$.fragment,S),Re(f.$$.fragment,S),Re(_.$$.fragment,S),T=!0)},o(S){Ve(n.$$.fragment,S),Ve(u.$$.fragment,S),Ve(f.$$.fragment,S),Ve(_.$$.fragment,S),T=!1},d(S){S&&we(i),_t(n),_t(u),_t(f),_t(_)}}}function aE(s){let i,n;return i=new Sf({props:{$$slots:{map:[oE],sidebar:[$C]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,[u]){const d={};u&32895&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function lE(s,i,n){let l,u,d,f,o;Qt(s,ur,I=>n(7,o=I));let _=!1,T=null,S=JSON.parse(o.getNodes());S.features=S.features.filter(I=>I.properties.is_crossing);function y(I){T=I,n(1,T)}function k(I){_=I,n(0,_)}return s.$$.update=()=>{s.$$.dirty&129&&n(2,l=JSON.parse(o.auditCrossings(_))),s.$$.dirty&4&&n(6,u=l.features.filter(I=>I.properties.complete).length),s.$$.dirty&2&&n(5,d=T?JSON.parse(T.properties.arms):qs()),s.$$.dirty&2&&n(4,f=T?JSON.parse(T.properties.crossings):qs())},[_,T,l,S,f,d,u,o,y,k]}class cE extends di{constructor(i){super(),fi(this,i,lE,aE,si,{})}}function Py(s,i,n){const l=s.slice();return l[10]=i[n],l[12]=n,l}function Ly(s){let i,n,l,u,d;function f(){return s[7](s[12])}return{c(){i=Ae("li"),n=Ae("a"),n.textContent=`${uh(s[10])}`,l=$e(),be(n,"href","#"),en(n,"color",s[3][s[12]%s[3].length])},m(o,_){xe(o,i,_),ve(i,n),ve(i,l),u||(d=Jt(n,"click",Wy(f)),u=!0)},p(o,_){s=o},d(o){o&&we(i),u=!1,d()}}}function uE(s){let i,n,l,u,d,f,o=Ki(s[2].component_lengths),_=[];for(let T=0;T<o.length;T+=1)_[T]=Ly(Py(s,o,T));return{c(){i=Ae("div"),n=Ae("h4"),n.textContent="Network disconnections",l=$e(),u=Ae("p"),u.textContent=`This shows where the separate sidewalk network is disconnected. Click a
      piece to see it:`,d=$e(),f=Ae("ul");for(let T=0;T<_.length;T+=1)_[T].c();be(i,"slot","sidebar")},m(T,S){xe(T,i,S),ve(i,n),ve(i,l),ve(i,u),ve(i,d),ve(i,f);for(let y=0;y<_.length;y+=1)_[y]&&_[y].m(f,null)},p(T,S){if(S&15){o=Ki(T[2].component_lengths);let y;for(y=0;y<o.length;y+=1){const k=Py(T,o,y);_[y]?_[y].p(k,S):(_[y]=Ly(k),_[y].c(),_[y].m(f,null))}for(;y<_.length;y+=1)_[y].d(1);_.length=o.length}},d(T){T&&we(i),xr(_,T)}}}function hE(s){let i,n;return i=new il({props:{id:"disconnections",paint:{"line-width":pf(5,10),"line-color":s[4](s[0])},manageHoverState:!0,hoverCursor:"pointer"}}),i.$on("click",s[5]),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,u){const d={};u&1&&(d.paint={"line-width":pf(5,10),"line-color":l[4](l[0])}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function fE(s){let i,n,l,u,d;return n=new Z0({}),n.$on("click",s[6]),u=new cs({props:{data:s[2],generateId:!0,$$slots:{default:[hE]},$$scope:{ctx:s}}}),{c(){i=Ae("div"),yt(n.$$.fragment),l=$e(),yt(u.$$.fragment),be(i,"slot","map")},m(f,o){xe(f,i,o),gt(n,i,null),ve(i,l),gt(u,i,null),d=!0},p(f,o){const _={};o&8193&&(_.$$scope={dirty:o,ctx:f}),u.$set(_)},i(f){d||(Re(n.$$.fragment,f),Re(u.$$.fragment,f),d=!0)},o(f){Ve(n.$$.fragment,f),Ve(u.$$.fragment,f),d=!1},d(f){f&&we(i),_t(n),_t(u)}}}function dE(s){let i,n;return i=new Sf({props:{$$slots:{map:[fE],sidebar:[uE]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,[u]){const d={};u&8195&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function pE(s,i,n){let l,u;Qt(s,ph,I=>n(1,l=I)),Qt(s,ur,I=>n(8,u=I));let d=JSON.parse(u.findConnectedComponents()),f=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],o=mf(["to-string",["%",["get","component"],f.length]],Object.fromEntries(f.map((I,C)=>[C.toString(),I])),"black"),_=null;function T(I){return I==null?o:["case",["==",["get","component"],I],o,"black"]}function S(I){n(0,_=I.detail.features[0].properties.component)}function y(I){l.queryRenderedFeatures(I.detail.point,{layers:["disconnections"]}).length==0&&n(0,_=null)}return[_,l,d,f,T,S,y,I=>{l==null||l.fitBounds(d.component_bboxes[I]),n(0,_=I)}]}class mE extends di{constructor(i){super(),fi(this,i,pE,dE,si,{})}}function gE(s){let i,n;return i=new U2({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p:$t,i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function _E(s){let i,n;return i=new cs({props:{data:s[0],$$slots:{default:[gE]},$$scope:{ctx:s}}}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p(l,[u]){const d={};u&8&&(d.$$scope={dirty:u,ctx:l}),i.$set(d)},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function yE(s,i,n){let l;Qt(s,ur,f=>n(1,l=f));let u=JSON.parse(l.getBoundary());return[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],u.geometry.coordinates[0]]}}]}class bE extends di{constructor(i){super(),fi(this,i,yE,_E,si,{})}}function vE(s){let i,n,l;return{c(){i=Ae("button"),i.textContent="Login to OSM",be(i,"class","btn btn-primary")},m(u,d){xe(u,i,d),n||(l=Jt(i,"click",s[1]),n=!0)},p:$t,d(u){u&&we(i),n=!1,l()}}}function wE(s){let i,n,l,u=s[0].name+"",d,f,o,_,T,S,y,k=s[0].avatarUrl&&zy(s);return{c(){i=Ae("div"),n=Ae("button"),k&&k.c(),l=$e(),d=kt(u),f=$e(),o=Ae("ul"),_=Ae("li"),T=Ae("a"),T.textContent="Logout",be(n,"class","btn btn-outline-secondary dropdown-toggle"),be(n,"data-bs-toggle","dropdown"),be(n,"aria-expanded","false"),be(T,"class","dropdown-item"),be(T,"href","#"),be(o,"class","dropdown-menu"),be(i,"class","nav-item dropdown")},m(I,C){xe(I,i,C),ve(i,n),k&&k.m(n,null),ve(n,l),ve(n,d),ve(i,f),ve(i,o),ve(o,_),ve(_,T),S||(y=Jt(T,"click",s[2]),S=!0)},p(I,C){I[0].avatarUrl?k?k.p(I,C):(k=zy(I),k.c(),k.m(n,l)):k&&(k.d(1),k=null),C&1&&u!==(u=I[0].name+"")&&Li(d,u)},d(I){I&&we(i),k&&k.d(),S=!1,y()}}}function zy(s){let i,n;return{c(){i=Ae("img"),Wn(i.src,n=s[0].avatarUrl)||be(i,"src",n),be(i,"alt","OSM avatar"),be(i,"height","30")},m(l,u){xe(l,i,u)},p(l,u){u&1&&!Wn(i.src,n=l[0].avatarUrl)&&be(i,"src",n)},d(l){l&&we(i)}}}function xE(s){let i;function n(d,f){return d[0]?wE:vE}let l=n(s),u=l(s);return{c(){u.c(),i=Ln()},m(d,f){u.m(d,f),xe(d,i,f)},p(d,[f]){l===(l=n(d))&&u?u.p(d,f):(u.d(1),u=l(d),u&&(u.c(),u.m(i.parentNode,i)))},i:$t,o:$t,d(d){d&&we(i),u.d(d)}}}function SE(s,i,n){let l;Qt(s,nh,o=>n(0,l=o)),Qd(u);async function u(){var o;if(Yu.isLoggedIn()){let _=await Yu.getUser("me");dn(nh,l={name:_.display_name,uid:_.id,avatarUrl:((o=_.img)==null?void 0:o.href)||""},l)}}async function d(){try{await Yu.login({mode:"popup",clientId:"vyCV0t-IiskqNBgpiHvuSAmf2nC8K-zfByeFL6XtAzc",redirectUrl:`${window.location.origin}/speedwalk/land.html`,scopes:["read_prefs","write_api"]}),await u()}catch(o){window.alert(`Login failed: ${o}`)}}async function f(){dn(nh,l=void 0,l),await Yu.logout()}return[l,d,f]}class TE extends di{constructor(i){super(),fi(this,i,SE,xE,si,{})}}const kE="/speedwalk/assets/logo-3MjkCCFo.svg";function Oy(s,i,n){const l=s.slice();return l[8]=i[n][0],l[9]=i[n][1],l}function Dy(s){let i,n=Ki(s[3]),l=[];for(let u=0;u<n.length;u+=1)l[u]=Fy(Oy(s,n,u));return{c(){for(let u=0;u<l.length;u+=1)l[u].c();i=Ln()},m(u,d){for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(u,d);xe(u,i,d)},p(u,d){if(d&12){n=Ki(u[3]);let f;for(f=0;f<n.length;f+=1){const o=Oy(u,n,f);l[f]?l[f].p(o,d):(l[f]=Fy(o),l[f].c(),l[f].m(i.parentNode,i))}for(;f<l.length;f+=1)l[f].d(1);l.length=n.length}},d(u){u&&we(i),xr(l,u)}}}function Fy(s){let i,n,l,u,d;function f(){return s[4](s[8])}return{c(){i=Ae("li"),n=Ae("a"),n.textContent=`${s[9]}`,l=$e(),be(n,"class","nav-link"),be(n,"href","#"),Zs(n,"active",JSON.stringify(s[2])==JSON.stringify(s[8])),be(i,"class","nav-item")},m(o,_){xe(o,i,_),ve(i,n),ve(i,l),u||(d=Jt(n,"click",f),u=!0)},p(o,_){s=o,_&12&&Zs(n,"active",JSON.stringify(s[2])==JSON.stringify(s[8]))},d(o){o&&we(i),u=!1,d()}}}function CE(s){let i,n,l,u,d,f,o,_,T;return{c(){i=Ae("h1"),i.textContent="Welcome to Speedwalk",n=$e(),l=Ae("p"),l.innerHTML=`This tool helps you quickly assess how sidewalks are mapped in OSM. You can
    find and fix common tagging problems. The tool assumes you understand the
    correct <a href="https://wiki.openstreetmap.org/wiki/Sidewalks" target="_blank">sidewalk mapping conventions</a>
    . If you are unsure about some edits you make, you can download the changeset
    file and check in JOSM, rather than uploading directly.`,u=$e(),d=Ae("p"),d.innerHTML=`This is an <a href="https://github.com/a-b-street/speedwalk" target="_blank">open source project</a>
    developed without funding by
    <a href="https://abstreet.uk" target="_blank">A/B Street Ltd</a>
    . Please file a Github issue or contact
    <a href="mailto:dustin@abstreet.uk" target="_blank">dustin@abstreet.uk</a>
    with feedback.
    <b>This is an alpha tool; there will be problems!</b>`,f=$e(),o=Ae("button"),o.textContent="Start",be(o,"class","btn btn-primary")},m(S,y){xe(S,i,y),xe(S,n,y),xe(S,l,y),xe(S,u,y),xe(S,d,y),xe(S,f,y),xe(S,o,y),_||(T=Jt(o,"click",s[6]),_=!0)},p:$t,d(S){S&&(we(i),we(n),we(l),we(u),we(d),we(f),we(o)),_=!1,T()}}}function EE(s){let i,n,l,u,d,f,o,_,T,S,y,k,I,C,L,N,R,z=s[1]&&Dy(s);y=new TE({});function Z(ae){s[7](ae)}let ie={$$slots:{default:[CE]},$$scope:{ctx:s}};return s[0]!==void 0&&(ie.show=s[0]),I=new fp({props:ie}),Si.push(()=>Yi(I,"show",Z)),{c(){i=Ae("ul"),n=Ae("img"),u=$e(),d=Ae("h3"),d.textContent="Speedwalk",f=$e(),z&&z.c(),o=$e(),_=Ae("li"),T=Ae("a"),T.innerHTML=`<i class="fa-solid fa-circle-info"></i>
      About`,S=$e(),yt(y.$$.fragment),k=$e(),yt(I.$$.fragment),Wn(n.src,l=kE)||be(n,"src",l),en(n,"height","30px"),be(n,"alt","A/B Street logo"),be(T,"class","nav-link"),be(T,"href","#"),be(_,"class","nav-item ms-auto"),be(i,"class","nav nav-underline")},m(ae,$){xe(ae,i,$),ve(i,n),ve(i,u),ve(i,d),ve(i,f),z&&z.m(i,null),ve(i,o),ve(i,_),ve(_,T),ve(i,S),gt(y,i,null),xe(ae,k,$),gt(I,ae,$),L=!0,N||(R=Jt(T,"click",s[5]),N=!0)},p(ae,[$]){ae[1]?z?z.p(ae,$):(z=Dy(ae),z.c(),z.m(i,o)):z&&(z.d(1),z=null);const re={};$&4097&&(re.$$scope={dirty:$,ctx:ae}),!C&&$&1&&(C=!0,re.show=ae[0],Ji(()=>C=!1)),I.$set(re)},i(ae){L||(Re(y.$$.fragment,ae),Re(I.$$.fragment,ae),L=!0)},o(ae){Ve(y.$$.fragment,ae),Ve(I.$$.fragment,ae),L=!1},d(ae){ae&&(we(i),we(k)),z&&z.d(),_t(y),_t(I,ae),N=!1,R()}}}function IE(s,i,n){let l,u;Qt(s,ur,y=>n(1,l=y)),Qt(s,Xd,y=>n(2,u=y));let d=!1,f=[[{kind:"sidewalks"},"Sidewalks"],[{kind:"crossings"},"Crossings"],[{kind:"disconnections"},"Network disconnections"]];const o=y=>dn(Xd,u=y,u),_=()=>n(0,d=!0),T=()=>n(0,d=!1);function S(y){d=y,n(0,d)}return[d,l,u,f,o,_,T,S]}class AE extends di{constructor(i){super(),fi(this,i,IE,EE,si,{})}}function ME(s){let i,n,l;return n=new AE({}),{c(){i=Ae("div"),yt(n.$$.fragment),be(i,"slot","top")},m(u,d){xe(u,i,d),gt(n,i,null),l=!0},p:$t,i(u){l||(Re(n.$$.fragment,u),l=!0)},o(u){Ve(n.$$.fragment,u),l=!1},d(u){u&&we(i),_t(n)}}}function Ry(s){let i;return{c(){i=Ae("div")},m(n,l){xe(n,i,l),s[13](i)},p:$t,d(n){n&&we(i),s[13](null)}}}function PE(s){let i,n=s[0]&&Ry(s);return{c(){i=Ae("div"),n&&n.c(),be(i,"class","p-3"),be(i,"slot","left")},m(l,u){xe(l,i,u),n&&n.m(i,null)},p(l,u){l[0]?n?n.p(l,u):(n=Ry(l),n.c(),n.m(i,null)):n&&(n.d(1),n=null)},d(l){l&&we(i),n&&n.d()}}}function By(s){let i,n,l,u,d,f,o,_;i=new XS({});const T=[zE,LE],S=[];function y(k,I){return k[5]?0:1}return d=y(s),f=S[d]=T[d](s),{c(){yt(i.$$.fragment),n=$e(),l=Ae("div"),u=$e(),f.c(),o=Ln()},m(k,I){gt(i,k,I),xe(k,n,I),xe(k,l,I),s[10](l),xe(k,u,I),S[d].m(k,I),xe(k,o,I),_=!0},p(k,I){let C=d;d=y(k),d===C?S[d].p(k,I):(ln(),Ve(S[C],1,1,()=>{S[C]=null}),cn(),f=S[d],f?f.p(k,I):(f=S[d]=T[d](k),f.c()),Re(f,1),f.m(o.parentNode,o))},i(k){_||(Re(i.$$.fragment,k),Re(f),_=!0)},o(k){Ve(i.$$.fragment,k),Ve(f),_=!1},d(k){k&&(we(n),we(l),we(u),we(o)),_t(i,k),s[10](null),S[d].d(k)}}}function LE(s){let i,n;return i=new fk({}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},p:$t,i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function zE(s){let i,n,l=s[6],u,d;i=new bE({});let f=Ny(s);return{c(){yt(i.$$.fragment),n=$e(),f.c(),u=Ln()},m(o,_){gt(i,o,_),xe(o,n,_),f.m(o,_),xe(o,u,_),d=!0},p(o,_){_&64&&si(l,l=o[6])?(ln(),Ve(f,1,1,$t),cn(),f=Ny(o),f.c(),Re(f,1),f.m(u.parentNode,u)):f.p(o,_)},i(o){d||(Re(i.$$.fragment,o),Re(f),d=!0)},o(o){Ve(i.$$.fragment,o),Ve(f),d=!1},d(o){o&&(we(n),we(u)),_t(i,o),f.d(o)}}}function OE(s){let i,n;return i=new mE({}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function DE(s){let i,n;return i=new cE({}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function FE(s){let i,n;return i=new YC({}),{c(){yt(i.$$.fragment)},m(l,u){gt(i,l,u),n=!0},i(l){n||(Re(i.$$.fragment,l),n=!0)},o(l){Ve(i.$$.fragment,l),n=!1},d(l){_t(i,l)}}}function Ny(s){let i,n,l,u;const d=[FE,DE,OE],f=[];function o(_,T){return _[6].kind=="sidewalks"?0:_[6].kind=="crossings"?1:_[6].kind=="disconnections"?2:-1}return~(i=o(s))&&(n=f[i]=d[i](s)),{c(){n&&n.c(),l=Ln()},m(_,T){~i&&f[i].m(_,T),xe(_,l,T),u=!0},p(_,T){let S=i;i=o(_),i!==S&&(n&&(ln(),Ve(f[S],1,1,()=>{f[S]=null}),cn()),~i?(n=f[i],n||(n=f[i]=d[i](_),n.c()),Re(n,1),n.m(l.parentNode,l)):n=null)},i(_){u||(Re(n),u=!0)},o(_){Ve(n),u=!1},d(_){_&&we(l),~i&&f[i].d(_)}}}function RE(s){let i,n,l,u,d,f,o,_,T;i=new AS({props:{map:s[0]}}),l=new b2({props:{map:s[0],country:void 0,apiKey:"MZEJTanw3WpxRvt7qDfo"}});function S(I){s[9](I)}let y={};s[3]!==void 0&&(y.basemap=s[3]),d=new wk({props:y}),Si.push(()=>Yi(d,"basemap",S));let k=s[0]&&By(s);return{c(){yt(i.$$.fragment),n=$e(),yt(l.$$.fragment),u=$e(),yt(d.$$.fragment),o=$e(),k&&k.c(),_=Ln()},m(I,C){gt(i,I,C),xe(I,n,C),gt(l,I,C),xe(I,u,C),gt(d,I,C),xe(I,o,C),k&&k.m(I,C),xe(I,_,C),T=!0},p(I,C){const L={};C&1&&(L.map=I[0]),i.$set(L);const N={};C&1&&(N.map=I[0]),l.$set(N);const R={};!f&&C&8&&(f=!0,R.basemap=I[3],Ji(()=>f=!1)),d.$set(R),I[0]?k?(k.p(I,C),C&1&&Re(k,1)):(k=By(I),k.c(),Re(k,1),k.m(_.parentNode,_)):k&&(ln(),Ve(k,1,1,()=>{k=null}),cn())},i(I){T||(Re(i.$$.fragment,I),Re(l.$$.fragment,I),Re(d.$$.fragment,I),Re(k),T=!0)},o(I){Ve(i.$$.fragment,I),Ve(l.$$.fragment,I),Ve(d.$$.fragment,I),Ve(k),T=!1},d(I){I&&(we(n),we(u),we(o),we(_)),_t(i,I),_t(l,I),_t(d,I),k&&k.d(I)}}}function BE(s){let i,n,l,u;function d(o){s[11](o)}let f={style:s[4][s[3]],hash:!0,images:[{id:"arrow",url:pk}],$$slots:{default:[RE]},$$scope:{ctx:s}};return s[0]!==void 0&&(f.map=s[0]),n=new uS({props:f}),Si.push(()=>Yi(n,"map",d)),n.$on("error",s[12]),{c(){i=Ae("div"),yt(n.$$.fragment),be(i,"slot","main"),en(i,"position","relative"),en(i,"width","100%"),en(i,"height","100vh")},m(o,_){xe(o,i,_),gt(n,i,null),u=!0},p(o,_){const T={};_&24&&(T.style=o[4][o[3]]),_&16493&&(T.$$scope={dirty:_,ctx:o}),!l&&_&1&&(l=!0,T.map=o[0],Ji(()=>l=!1)),n.$set(T)},i(o){u||(Re(n.$$.fragment,o),u=!0)},o(o){Ve(n.$$.fragment,o),u=!1},d(o){o&&we(i),_t(n)}}}function NE(s){let i,n,l,u;return l=new JT({props:{$$slots:{main:[BE],left:[PE],top:[ME]},$$scope:{ctx:s}}}),{c(){i=Ae("link"),n=$e(),yt(l.$$.fragment),be(i,"rel","icon"),be(i,"type","image/x-icon"),be(i,"href",dk)},m(d,f){ve(document.head,i),xe(d,n,f),gt(l,d,f),u=!0},p(d,[f]){const o={};f&16511&&(o.$$scope={dirty:f,ctx:d}),l.$set(o)},i(d){u||(Re(l.$$.fragment,d),u=!0)},o(d){Ve(l.$$.fragment,d),u=!1},d(d){d&&we(n),we(i),_t(l,d)}}}function jE(s,i,n){let l,u,d,f,o;Qt(s,Jd,R=>n(7,l=R)),Qt(s,Kd,R=>n(8,u=R)),Qt(s,el,R=>n(4,d=R)),Qt(s,ur,R=>n(5,f=R)),Qt(s,Xd,R=>n(6,o=R));let _,T="Maptiler OpenStreetMap";Qd(async()=>{await T0()});let S,y;function k(R){T=R,n(3,T)}function I(R){Si[R?"unshift":"push"](()=>{y=R,n(2,y),n(7,l)})}function C(R){_=R,n(0,_)}const L=R=>{console.log(R.detail.error)};function N(R){Si[R?"unshift":"push"](()=>{S=R,n(1,S),n(8,u)})}return s.$$.update=()=>{s.$$.dirty&1&&_&&ph.set(_),s.$$.dirty&258&&S&&u&&(n(1,S.innerHTML="",S),S.appendChild(u)),s.$$.dirty&132&&y&&l&&(n(2,y.innerHTML="",y),y.appendChild(l))},[_,S,y,T,d,f,o,l,u,k,I,C,L,N]}class UE extends di{constructor(i){super(),fi(this,i,jE,NE,si,{})}}new UE({target:document.getElementById("app")});
