var o1=Object.defineProperty;var a1=(r,i,n)=>i in r?o1(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n;var Zn=(r,i,n)=>a1(r,typeof i!="symbol"?i+"":i,n);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))a(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&a(f)}).observe(document,{childList:!0,subtree:!0});function n(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(u){if(u.ep)return;u.ep=!0;const d=n(u);fetch(u.href,d)}})();function Ht(){}function l1(r,i){for(const n in i)r[n]=i[n];return r}function Xy(r){return r()}function rg(){return Object.create(null)}function ir(r){r.forEach(Xy)}function Jd(r){return typeof r=="function"}function ti(r,i){return r!=r?i==i:r!==i||r&&typeof r=="object"||typeof r=="function"}let Gh;function Wn(r,i){return r===i?!0:(Gh||(Gh=document.createElement("a")),Gh.href=i,r===Gh.href)}function c1(r){return Object.keys(r).length===0}function Ky(r,...i){if(r==null){for(const a of i)a(void 0);return Ht}const n=r.subscribe(...i);return n.unsubscribe?()=>n.unsubscribe():n}function Jy(r){let i;return Ky(r,n=>i=n)(),i}function Gt(r,i,n){r.$$.on_destroy.push(Ky(i,n))}function vn(r,i,n,a){if(r){const u=Yy(r,i,n,a);return r[0](u)}}function Yy(r,i,n,a){return r[1]&&a?l1(n.ctx.slice(),r[1](a(i))):n.ctx}function wn(r,i,n,a){if(r[2]&&a){const u=r[2](a(n));if(i.dirty===void 0)return u;if(typeof u=="object"){const d=[],f=Math.max(i.dirty.length,u.length);for(let o=0;o<f;o+=1)d[o]=i.dirty[o]|u[o];return d}return i.dirty|u}return i.dirty}function xn(r,i,n,a,u,d){if(u){const f=Yy(i,n,a,d);r.p(f,u)}}function Sn(r){if(r.ctx.length>32){const i=[],n=r.ctx.length/32;for(let a=0;a<n;a++)i[a]=-1;return i}return-1}function u1(r){const i={};for(const n in r)i[n]=!0;return i}function Wc(r){return r??""}function dn(r,i,n){return r.set(n),i}function h1(r){return r&&Jd(r.destroy)?r.destroy:Ht}const Qy=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function be(r,i){r.appendChild(i)}function xe(r,i,n){r.insertBefore(i,n||null)}function we(r){r.parentNode&&r.parentNode.removeChild(r)}function tr(r,i){for(let n=0;n<r.length;n+=1)r[n]&&r[n].d(i)}function ke(r){return document.createElement(r)}function fa(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Tt(r){return document.createTextNode(r)}function Qe(){return Tt(" ")}function Mn(){return Tt("")}function Wt(r,i,n,a){return r.addEventListener(i,n,a),()=>r.removeEventListener(i,n,a)}function Yd(r){return function(i){return i.preventDefault(),r.call(this,i)}}function f1(r){return function(i){return i.stopPropagation(),r.call(this,i)}}function _e(r,i,n){n==null?r.removeAttribute(i):r.getAttribute(i)!==n&&r.setAttribute(i,n)}function d1(r){return Array.from(r.childNodes)}function Ai(r,i){i=""+i,r.data!==i&&(r.data=i)}function Ts(r,i){r.value=i??""}function en(r,i,n,a){n==null?r.style.removeProperty(i):r.style.setProperty(i,n,"")}function sg(r,i,n){for(let a=0;a<r.options.length;a+=1){const u=r.options[a];if(u.__value===i){u.selected=!0;return}}(!n||i!==void 0)&&(r.selectedIndex=-1)}function p1(r){const i=r.querySelector(":checked");return i&&i.__value}function Dr(r,i,n){r.classList.toggle(i,!!n)}function m1(r,i,{bubbles:n=!1,cancelable:a=!1}={}){return new CustomEvent(r,{detail:i,bubbles:n,cancelable:a})}let sh;function $u(r){sh=r}function hh(){if(!sh)throw new Error("Function called outside component initialization");return sh}function Qd(r){hh().$$.on_mount.push(r)}function hs(r){hh().$$.on_destroy.push(r)}function nl(){const r=hh();return(i,n,{cancelable:a=!1}={})=>{const u=r.$$.callbacks[i];if(u){const d=m1(i,n,{cancelable:a});return u.slice().forEach(f=>{f.call(r,d)}),!d.defaultPrevented}return!0}}function $d(r,i){return hh().$$.context.set(r,i),i}function $y(r){return hh().$$.context.get(r)}function Di(r,i){const n=r.$$.callbacks[i.type];n&&n.slice().forEach(a=>a.call(this,i))}const Fc=[],wi=[];let Vc=[];const Ld=[],e0=Promise.resolve();let zd=!1;function t0(){zd||(zd=!0,e0.then(n0))}function i0(){return t0(),e0}function af(r){Vc.push(r)}function Hi(r){Ld.push(r)}const vd=new Set;let Lc=0;function n0(){if(Lc!==0)return;const r=sh;do{try{for(;Lc<Fc.length;){const i=Fc[Lc];Lc++,$u(i),g1(i.$$)}}catch(i){throw Fc.length=0,Lc=0,i}for($u(null),Fc.length=0,Lc=0;wi.length;)wi.pop()();for(let i=0;i<Vc.length;i+=1){const n=Vc[i];vd.has(n)||(vd.add(n),n())}Vc.length=0}while(Fc.length);for(;Ld.length;)Ld.pop()();zd=!1,vd.clear(),$u(r)}function g1(r){if(r.fragment!==null){r.update(),ir(r.before_update);const i=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,i),r.after_update.forEach(af)}}function _1(r){const i=[],n=[];Vc.forEach(a=>r.indexOf(a)===-1?i.push(a):n.push(a)),n.forEach(a=>a()),Vc=i}const tf=new Set;let Bl;function ln(){Bl={r:0,c:[],p:Bl}}function cn(){Bl.r||ir(Bl.c),Bl=Bl.p}function Re(r,i){r&&r.i&&(tf.delete(r),r.i(i))}function Ve(r,i,n,a){if(r&&r.o){if(tf.has(r))return;tf.add(r),Bl.c.push(()=>{tf.delete(r),a&&(n&&r.d(1),a())}),r.o(i)}else a&&a()}function Vi(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function y1(r,i){Ve(r,1,1,()=>{i.delete(r.key)})}function b1(r,i,n,a,u,d,f,o,_,S,T,y){let k=r.length,I=d.length,C=k;const L={};for(;C--;)L[r[C].key]=C;const B=[],N=new Map,F=new Map,W=[];for(C=I;C--;){const re=y(u,d,C),j=n(re);let U=f.get(j);U?W.push(()=>U.p(re,i)):(U=S(j,re),U.c()),N.set(j,B[C]=U),j in L&&F.set(j,Math.abs(C-L[j]))}const ee=new Set,oe=new Set;function $(re){Re(re,1),re.m(o,T),f.set(re.key,re),T=re.first,I--}for(;k&&I;){const re=B[I-1],j=r[k-1],U=re.key,J=j.key;re===j?(T=re.first,k--,I--):N.has(J)?!f.has(U)||ee.has(U)?$(re):oe.has(J)?k--:F.get(U)>F.get(J)?(oe.add(U),$(re)):(ee.add(J),k--):(_(j,f),k--)}for(;k--;){const re=r[k];N.has(re.key)||_(re,f)}for(;I;)$(B[I-1]);return ir(W),B}function Xi(r,i,n){const a=r.$$.props[i];a!==void 0&&(r.$$.bound[a]=n,n(r.$$.ctx[a]))}function yt(r){r&&r.c()}function gt(r,i,n){const{fragment:a,after_update:u}=r.$$;a&&a.m(i,n),af(()=>{const d=r.$$.on_mount.map(Xy).filter(Jd);r.$$.on_destroy?r.$$.on_destroy.push(...d):ir(d),r.$$.on_mount=[]}),u.forEach(af)}function _t(r,i){const n=r.$$;n.fragment!==null&&(_1(n.after_update),ir(n.on_destroy),n.fragment&&n.fragment.d(i),n.on_destroy=n.fragment=null,n.ctx=[])}function v1(r,i){r.$$.dirty[0]===-1&&(Fc.push(r),t0(),r.$$.dirty.fill(0)),r.$$.dirty[i/31|0]|=1<<i%31}function ci(r,i,n,a,u,d,f=null,o=[-1]){const _=sh;$u(r);const S=r.$$={fragment:null,ctx:[],props:d,update:Ht,not_equal:u,bound:rg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(_?_.$$.context:[])),callbacks:rg(),dirty:o,skip_bound:!1,root:i.target||_.$$.root};f&&f(S.root);let T=!1;if(S.ctx=n?n(r,i.props||{},(y,k,...I)=>{const C=I.length?I[0]:k;return S.ctx&&u(S.ctx[y],S.ctx[y]=C)&&(!S.skip_bound&&S.bound[y]&&S.bound[y](C),T&&v1(r,y)),k}):[],S.update(),T=!0,ir(S.before_update),S.fragment=a?a(S.ctx):!1,i.target){if(i.hydrate){const y=d1(i.target);S.fragment&&S.fragment.l(y),y.forEach(we)}else S.fragment&&S.fragment.c();i.intro&&Re(r.$$.fragment),gt(r,i.target,i.anchor),n0()}$u(_)}class ui{constructor(){Zn(this,"$$");Zn(this,"$$set")}$destroy(){_t(this,1),this.$destroy=Ht}$on(i,n){if(!Jd(n))return Ht;const a=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return a.push(n),()=>{const u=a.indexOf(n);u!==-1&&a.splice(u,1)}}$set(i){this.$$set&&!c1(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const w1="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(w1);var r0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function x1(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function S1(r){if(r.__esModule)return r;var i=r.default;if(typeof i=="function"){var n=function a(){return this instanceof a?Reflect.construct(i,arguments,this.constructor):i.apply(this,arguments)};n.prototype=i.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(r).forEach(function(a){var u=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(n,a,u.get?u:{enumerable:!0,get:function(){return r[a]}})}),n}var T1={exports:{}},Gr="top",ks="bottom",Cs="right",Hr="left",gf="auto",Yc=[Gr,ks,Cs,Hr],Ul="start",Gc="end",s0="clippingParents",ep="viewport",Rc="popper",o0="reference",Od=Yc.reduce(function(r,i){return r.concat([i+"-"+Ul,i+"-"+Gc])},[]),tp=[].concat(Yc,[gf]).reduce(function(r,i){return r.concat([i,i+"-"+Ul,i+"-"+Gc])},[]),a0="beforeRead",l0="read",c0="afterRead",u0="beforeMain",h0="main",f0="afterMain",d0="beforeWrite",p0="write",m0="afterWrite",g0=[a0,l0,c0,u0,h0,f0,d0,p0,m0];function Bo(r){return r?(r.nodeName||"").toLowerCase():null}function Es(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var i=r.ownerDocument;return i&&i.defaultView||window}return r}function Vl(r){var i=Es(r).Element;return r instanceof i||r instanceof Element}function Gs(r){var i=Es(r).HTMLElement;return r instanceof i||r instanceof HTMLElement}function ip(r){if(typeof ShadowRoot>"u")return!1;var i=Es(r).ShadowRoot;return r instanceof i||r instanceof ShadowRoot}function k1(r){var i=r.state;Object.keys(i.elements).forEach(function(n){var a=i.styles[n]||{},u=i.attributes[n]||{},d=i.elements[n];!Gs(d)||!Bo(d)||(Object.assign(d.style,a),Object.keys(u).forEach(function(f){var o=u[f];o===!1?d.removeAttribute(f):d.setAttribute(f,o===!0?"":o)}))})}function C1(r){var i=r.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow),function(){Object.keys(i.elements).forEach(function(a){var u=i.elements[a],d=i.attributes[a]||{},f=Object.keys(i.styles.hasOwnProperty(a)?i.styles[a]:n[a]),o=f.reduce(function(_,S){return _[S]="",_},{});!Gs(u)||!Bo(u)||(Object.assign(u.style,o),Object.keys(d).forEach(function(_){u.removeAttribute(_)}))})}}const np={name:"applyStyles",enabled:!0,phase:"write",fn:k1,effect:C1,requires:["computeStyles"]};function Fo(r){return r.split("-")[0]}var Nl=Math.max,lf=Math.min,Hc=Math.round;function Dd(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(i){return i.brand+"/"+i.version}).join(" "):navigator.userAgent}function _0(){return!/^((?!chrome|android).)*safari/i.test(Dd())}function Xc(r,i,n){i===void 0&&(i=!1),n===void 0&&(n=!1);var a=r.getBoundingClientRect(),u=1,d=1;i&&Gs(r)&&(u=r.offsetWidth>0&&Hc(a.width)/r.offsetWidth||1,d=r.offsetHeight>0&&Hc(a.height)/r.offsetHeight||1);var f=Vl(r)?Es(r):window,o=f.visualViewport,_=!_0()&&n,S=(a.left+(_&&o?o.offsetLeft:0))/u,T=(a.top+(_&&o?o.offsetTop:0))/d,y=a.width/u,k=a.height/d;return{width:y,height:k,top:T,right:S+y,bottom:T+k,left:S,x:S,y:T}}function rp(r){var i=Xc(r),n=r.offsetWidth,a=r.offsetHeight;return Math.abs(i.width-n)<=1&&(n=i.width),Math.abs(i.height-a)<=1&&(a=i.height),{x:r.offsetLeft,y:r.offsetTop,width:n,height:a}}function y0(r,i){var n=i.getRootNode&&i.getRootNode();if(r.contains(i))return!0;if(n&&ip(n)){var a=i;do{if(a&&r.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function da(r){return Es(r).getComputedStyle(r)}function E1(r){return["table","td","th"].indexOf(Bo(r))>=0}function rl(r){return((Vl(r)?r.ownerDocument:r.document)||window.document).documentElement}function _f(r){return Bo(r)==="html"?r:r.assignedSlot||r.parentNode||(ip(r)?r.host:null)||rl(r)}function og(r){return!Gs(r)||da(r).position==="fixed"?null:r.offsetParent}function I1(r){var i=/firefox/i.test(Dd()),n=/Trident/i.test(Dd());if(n&&Gs(r)){var a=da(r);if(a.position==="fixed")return null}var u=_f(r);for(ip(u)&&(u=u.host);Gs(u)&&["html","body"].indexOf(Bo(u))<0;){var d=da(u);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||i&&d.willChange==="filter"||i&&d.filter&&d.filter!=="none")return u;u=u.parentNode}return null}function fh(r){for(var i=Es(r),n=og(r);n&&E1(n)&&da(n).position==="static";)n=og(n);return n&&(Bo(n)==="html"||Bo(n)==="body"&&da(n).position==="static")?i:n||I1(r)||i}function sp(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function eh(r,i,n){return Nl(r,lf(i,n))}function A1(r,i,n){var a=eh(r,i,n);return a>n?n:a}function b0(){return{top:0,right:0,bottom:0,left:0}}function v0(r){return Object.assign({},b0(),r)}function w0(r,i){return i.reduce(function(n,a){return n[a]=r,n},{})}var M1=function(i,n){return i=typeof i=="function"?i(Object.assign({},n.rects,{placement:n.placement})):i,v0(typeof i!="number"?i:w0(i,Yc))};function P1(r){var i,n=r.state,a=r.name,u=r.options,d=n.elements.arrow,f=n.modifiersData.popperOffsets,o=Fo(n.placement),_=sp(o),S=[Hr,Cs].indexOf(o)>=0,T=S?"height":"width";if(!(!d||!f)){var y=M1(u.padding,n),k=rp(d),I=_==="y"?Gr:Hr,C=_==="y"?ks:Cs,L=n.rects.reference[T]+n.rects.reference[_]-f[_]-n.rects.popper[T],B=f[_]-n.rects.reference[_],N=fh(d),F=N?_==="y"?N.clientHeight||0:N.clientWidth||0:0,W=L/2-B/2,ee=y[I],oe=F-k[T]-y[C],$=F/2-k[T]/2+W,re=eh(ee,$,oe),j=_;n.modifiersData[a]=(i={},i[j]=re,i.centerOffset=re-$,i)}}function L1(r){var i=r.state,n=r.options,a=n.element,u=a===void 0?"[data-popper-arrow]":a;u!=null&&(typeof u=="string"&&(u=i.elements.popper.querySelector(u),!u)||y0(i.elements.popper,u)&&(i.elements.arrow=u))}const x0={name:"arrow",enabled:!0,phase:"main",fn:P1,effect:L1,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Kc(r){return r.split("-")[1]}var z1={top:"auto",right:"auto",bottom:"auto",left:"auto"};function O1(r,i){var n=r.x,a=r.y,u=i.devicePixelRatio||1;return{x:Hc(n*u)/u||0,y:Hc(a*u)/u||0}}function ag(r){var i,n=r.popper,a=r.popperRect,u=r.placement,d=r.variation,f=r.offsets,o=r.position,_=r.gpuAcceleration,S=r.adaptive,T=r.roundOffsets,y=r.isFixed,k=f.x,I=k===void 0?0:k,C=f.y,L=C===void 0?0:C,B=typeof T=="function"?T({x:I,y:L}):{x:I,y:L};I=B.x,L=B.y;var N=f.hasOwnProperty("x"),F=f.hasOwnProperty("y"),W=Hr,ee=Gr,oe=window;if(S){var $=fh(n),re="clientHeight",j="clientWidth";if($===Es(n)&&($=rl(n),da($).position!=="static"&&o==="absolute"&&(re="scrollHeight",j="scrollWidth")),$=$,u===Gr||(u===Hr||u===Cs)&&d===Gc){ee=ks;var U=y&&$===oe&&oe.visualViewport?oe.visualViewport.height:$[re];L-=U-a.height,L*=_?1:-1}if(u===Hr||(u===Gr||u===ks)&&d===Gc){W=Cs;var J=y&&$===oe&&oe.visualViewport?oe.visualViewport.width:$[j];I-=J-a.width,I*=_?1:-1}}var R=Object.assign({position:o},S&&z1),Z=T===!0?O1({x:I,y:L},Es(n)):{x:I,y:L};if(I=Z.x,L=Z.y,_){var ce;return Object.assign({},R,(ce={},ce[ee]=F?"0":"",ce[W]=N?"0":"",ce.transform=(oe.devicePixelRatio||1)<=1?"translate("+I+"px, "+L+"px)":"translate3d("+I+"px, "+L+"px, 0)",ce))}return Object.assign({},R,(i={},i[ee]=F?L+"px":"",i[W]=N?I+"px":"",i.transform="",i))}function D1(r){var i=r.state,n=r.options,a=n.gpuAcceleration,u=a===void 0?!0:a,d=n.adaptive,f=d===void 0?!0:d,o=n.roundOffsets,_=o===void 0?!0:o,S={placement:Fo(i.placement),variation:Kc(i.placement),popper:i.elements.popper,popperRect:i.rects.popper,gpuAcceleration:u,isFixed:i.options.strategy==="fixed"};i.modifiersData.popperOffsets!=null&&(i.styles.popper=Object.assign({},i.styles.popper,ag(Object.assign({},S,{offsets:i.modifiersData.popperOffsets,position:i.options.strategy,adaptive:f,roundOffsets:_})))),i.modifiersData.arrow!=null&&(i.styles.arrow=Object.assign({},i.styles.arrow,ag(Object.assign({},S,{offsets:i.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:_})))),i.attributes.popper=Object.assign({},i.attributes.popper,{"data-popper-placement":i.placement})}const op={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:D1,data:{}};var Hh={passive:!0};function F1(r){var i=r.state,n=r.instance,a=r.options,u=a.scroll,d=u===void 0?!0:u,f=a.resize,o=f===void 0?!0:f,_=Es(i.elements.popper),S=[].concat(i.scrollParents.reference,i.scrollParents.popper);return d&&S.forEach(function(T){T.addEventListener("scroll",n.update,Hh)}),o&&_.addEventListener("resize",n.update,Hh),function(){d&&S.forEach(function(T){T.removeEventListener("scroll",n.update,Hh)}),o&&_.removeEventListener("resize",n.update,Hh)}}const ap={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:F1,data:{}};var R1={left:"right",right:"left",bottom:"top",top:"bottom"};function nf(r){return r.replace(/left|right|bottom|top/g,function(i){return R1[i]})}var B1={start:"end",end:"start"};function lg(r){return r.replace(/start|end/g,function(i){return B1[i]})}function lp(r){var i=Es(r),n=i.pageXOffset,a=i.pageYOffset;return{scrollLeft:n,scrollTop:a}}function cp(r){return Xc(rl(r)).left+lp(r).scrollLeft}function N1(r,i){var n=Es(r),a=rl(r),u=n.visualViewport,d=a.clientWidth,f=a.clientHeight,o=0,_=0;if(u){d=u.width,f=u.height;var S=_0();(S||!S&&i==="fixed")&&(o=u.offsetLeft,_=u.offsetTop)}return{width:d,height:f,x:o+cp(r),y:_}}function j1(r){var i,n=rl(r),a=lp(r),u=(i=r.ownerDocument)==null?void 0:i.body,d=Nl(n.scrollWidth,n.clientWidth,u?u.scrollWidth:0,u?u.clientWidth:0),f=Nl(n.scrollHeight,n.clientHeight,u?u.scrollHeight:0,u?u.clientHeight:0),o=-a.scrollLeft+cp(r),_=-a.scrollTop;return da(u||n).direction==="rtl"&&(o+=Nl(n.clientWidth,u?u.clientWidth:0)-d),{width:d,height:f,x:o,y:_}}function up(r){var i=da(r),n=i.overflow,a=i.overflowX,u=i.overflowY;return/auto|scroll|overlay|hidden/.test(n+u+a)}function S0(r){return["html","body","#document"].indexOf(Bo(r))>=0?r.ownerDocument.body:Gs(r)&&up(r)?r:S0(_f(r))}function th(r,i){var n;i===void 0&&(i=[]);var a=S0(r),u=a===((n=r.ownerDocument)==null?void 0:n.body),d=Es(a),f=u?[d].concat(d.visualViewport||[],up(a)?a:[]):a,o=i.concat(f);return u?o:o.concat(th(_f(f)))}function Fd(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function U1(r,i){var n=Xc(r,!1,i==="fixed");return n.top=n.top+r.clientTop,n.left=n.left+r.clientLeft,n.bottom=n.top+r.clientHeight,n.right=n.left+r.clientWidth,n.width=r.clientWidth,n.height=r.clientHeight,n.x=n.left,n.y=n.top,n}function cg(r,i,n){return i===ep?Fd(N1(r,n)):Vl(i)?U1(i,n):Fd(j1(rl(r)))}function V1(r){var i=th(_f(r)),n=["absolute","fixed"].indexOf(da(r).position)>=0,a=n&&Gs(r)?fh(r):r;return Vl(a)?i.filter(function(u){return Vl(u)&&y0(u,a)&&Bo(u)!=="body"}):[]}function q1(r,i,n,a){var u=i==="clippingParents"?V1(r):[].concat(i),d=[].concat(u,[n]),f=d[0],o=d.reduce(function(_,S){var T=cg(r,S,a);return _.top=Nl(T.top,_.top),_.right=lf(T.right,_.right),_.bottom=lf(T.bottom,_.bottom),_.left=Nl(T.left,_.left),_},cg(r,f,a));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function T0(r){var i=r.reference,n=r.element,a=r.placement,u=a?Fo(a):null,d=a?Kc(a):null,f=i.x+i.width/2-n.width/2,o=i.y+i.height/2-n.height/2,_;switch(u){case Gr:_={x:f,y:i.y-n.height};break;case ks:_={x:f,y:i.y+i.height};break;case Cs:_={x:i.x+i.width,y:o};break;case Hr:_={x:i.x-n.width,y:o};break;default:_={x:i.x,y:i.y}}var S=u?sp(u):null;if(S!=null){var T=S==="y"?"height":"width";switch(d){case Ul:_[S]=_[S]-(i[T]/2-n[T]/2);break;case Gc:_[S]=_[S]+(i[T]/2-n[T]/2);break}}return _}function Jc(r,i){i===void 0&&(i={});var n=i,a=n.placement,u=a===void 0?r.placement:a,d=n.strategy,f=d===void 0?r.strategy:d,o=n.boundary,_=o===void 0?s0:o,S=n.rootBoundary,T=S===void 0?ep:S,y=n.elementContext,k=y===void 0?Rc:y,I=n.altBoundary,C=I===void 0?!1:I,L=n.padding,B=L===void 0?0:L,N=v0(typeof B!="number"?B:w0(B,Yc)),F=k===Rc?o0:Rc,W=r.rects.popper,ee=r.elements[C?F:k],oe=q1(Vl(ee)?ee:ee.contextElement||rl(r.elements.popper),_,T,f),$=Xc(r.elements.reference),re=T0({reference:$,element:W,placement:u}),j=Fd(Object.assign({},W,re)),U=k===Rc?j:$,J={top:oe.top-U.top+N.top,bottom:U.bottom-oe.bottom+N.bottom,left:oe.left-U.left+N.left,right:U.right-oe.right+N.right},R=r.modifiersData.offset;if(k===Rc&&R){var Z=R[u];Object.keys(J).forEach(function(ce){var fe=[Cs,ks].indexOf(ce)>=0?1:-1,ge=[Gr,ks].indexOf(ce)>=0?"y":"x";J[ce]+=Z[ge]*fe})}return J}function Z1(r,i){i===void 0&&(i={});var n=i,a=n.placement,u=n.boundary,d=n.rootBoundary,f=n.padding,o=n.flipVariations,_=n.allowedAutoPlacements,S=_===void 0?tp:_,T=Kc(a),y=T?o?Od:Od.filter(function(C){return Kc(C)===T}):Yc,k=y.filter(function(C){return S.indexOf(C)>=0});k.length===0&&(k=y);var I=k.reduce(function(C,L){return C[L]=Jc(r,{placement:L,boundary:u,rootBoundary:d,padding:f})[Fo(L)],C},{});return Object.keys(I).sort(function(C,L){return I[C]-I[L]})}function W1(r){if(Fo(r)===gf)return[];var i=nf(r);return[lg(r),i,lg(i)]}function G1(r){var i=r.state,n=r.options,a=r.name;if(!i.modifiersData[a]._skip){for(var u=n.mainAxis,d=u===void 0?!0:u,f=n.altAxis,o=f===void 0?!0:f,_=n.fallbackPlacements,S=n.padding,T=n.boundary,y=n.rootBoundary,k=n.altBoundary,I=n.flipVariations,C=I===void 0?!0:I,L=n.allowedAutoPlacements,B=i.options.placement,N=Fo(B),F=N===B,W=_||(F||!C?[nf(B)]:W1(B)),ee=[B].concat(W).reduce(function($e,vt){return $e.concat(Fo(vt)===gf?Z1(i,{placement:vt,boundary:T,rootBoundary:y,padding:S,flipVariations:C,allowedAutoPlacements:L}):vt)},[]),oe=i.rects.reference,$=i.rects.popper,re=new Map,j=!0,U=ee[0],J=0;J<ee.length;J++){var R=ee[J],Z=Fo(R),ce=Kc(R)===Ul,fe=[Gr,ks].indexOf(Z)>=0,ge=fe?"width":"height",ye=Jc(i,{placement:R,boundary:T,rootBoundary:y,altBoundary:k,padding:S}),he=fe?ce?Cs:Hr:ce?ks:Gr;oe[ge]>$[ge]&&(he=nf(he));var Fe=nf(he),Me=[];if(d&&Me.push(ye[Z]<=0),o&&Me.push(ye[he]<=0,ye[Fe]<=0),Me.every(function($e){return $e})){U=R,j=!1;break}re.set(R,Me)}if(j)for(var lt=C?3:1,Ze=function(vt){var St=ee.find(function(Zt){var oi=re.get(Zt);if(oi)return oi.slice(0,vt).every(function(Mi){return Mi})});if(St)return U=St,"break"},ht=lt;ht>0;ht--){var kt=Ze(ht);if(kt==="break")break}i.placement!==U&&(i.modifiersData[a]._skip=!0,i.placement=U,i.reset=!0)}}const k0={name:"flip",enabled:!0,phase:"main",fn:G1,requiresIfExists:["offset"],data:{_skip:!1}};function ug(r,i,n){return n===void 0&&(n={x:0,y:0}),{top:r.top-i.height-n.y,right:r.right-i.width+n.x,bottom:r.bottom-i.height+n.y,left:r.left-i.width-n.x}}function hg(r){return[Gr,Cs,ks,Hr].some(function(i){return r[i]>=0})}function H1(r){var i=r.state,n=r.name,a=i.rects.reference,u=i.rects.popper,d=i.modifiersData.preventOverflow,f=Jc(i,{elementContext:"reference"}),o=Jc(i,{altBoundary:!0}),_=ug(f,a),S=ug(o,u,d),T=hg(_),y=hg(S);i.modifiersData[n]={referenceClippingOffsets:_,popperEscapeOffsets:S,isReferenceHidden:T,hasPopperEscaped:y},i.attributes.popper=Object.assign({},i.attributes.popper,{"data-popper-reference-hidden":T,"data-popper-escaped":y})}const C0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:H1};function X1(r,i,n){var a=Fo(r),u=[Hr,Gr].indexOf(a)>=0?-1:1,d=typeof n=="function"?n(Object.assign({},i,{placement:r})):n,f=d[0],o=d[1];return f=f||0,o=(o||0)*u,[Hr,Cs].indexOf(a)>=0?{x:o,y:f}:{x:f,y:o}}function K1(r){var i=r.state,n=r.options,a=r.name,u=n.offset,d=u===void 0?[0,0]:u,f=tp.reduce(function(T,y){return T[y]=X1(y,i.rects,d),T},{}),o=f[i.placement],_=o.x,S=o.y;i.modifiersData.popperOffsets!=null&&(i.modifiersData.popperOffsets.x+=_,i.modifiersData.popperOffsets.y+=S),i.modifiersData[a]=f}const E0={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:K1};function J1(r){var i=r.state,n=r.name;i.modifiersData[n]=T0({reference:i.rects.reference,element:i.rects.popper,placement:i.placement})}const hp={name:"popperOffsets",enabled:!0,phase:"read",fn:J1,data:{}};function Y1(r){return r==="x"?"y":"x"}function Q1(r){var i=r.state,n=r.options,a=r.name,u=n.mainAxis,d=u===void 0?!0:u,f=n.altAxis,o=f===void 0?!1:f,_=n.boundary,S=n.rootBoundary,T=n.altBoundary,y=n.padding,k=n.tether,I=k===void 0?!0:k,C=n.tetherOffset,L=C===void 0?0:C,B=Jc(i,{boundary:_,rootBoundary:S,padding:y,altBoundary:T}),N=Fo(i.placement),F=Kc(i.placement),W=!F,ee=sp(N),oe=Y1(ee),$=i.modifiersData.popperOffsets,re=i.rects.reference,j=i.rects.popper,U=typeof L=="function"?L(Object.assign({},i.rects,{placement:i.placement})):L,J=typeof U=="number"?{mainAxis:U,altAxis:U}:Object.assign({mainAxis:0,altAxis:0},U),R=i.modifiersData.offset?i.modifiersData.offset[i.placement]:null,Z={x:0,y:0};if($){if(d){var ce,fe=ee==="y"?Gr:Hr,ge=ee==="y"?ks:Cs,ye=ee==="y"?"height":"width",he=$[ee],Fe=he+B[fe],Me=he-B[ge],lt=I?-j[ye]/2:0,Ze=F===Ul?re[ye]:j[ye],ht=F===Ul?-j[ye]:-re[ye],kt=i.elements.arrow,$e=I&&kt?rp(kt):{width:0,height:0},vt=i.modifiersData["arrow#persistent"]?i.modifiersData["arrow#persistent"].padding:b0(),St=vt[fe],Zt=vt[ge],oi=eh(0,re[ye],$e[ye]),Mi=W?re[ye]/2-lt-oi-St-J.mainAxis:Ze-oi-St-J.mainAxis,Pi=W?-re[ye]/2+lt+oi+Zt+J.mainAxis:ht+oi+Zt+J.mainAxis,Ti=i.elements.arrow&&fh(i.elements.arrow),At=Ti?ee==="y"?Ti.clientTop||0:Ti.clientLeft||0:0,He=(ce=R==null?void 0:R[ee])!=null?ce:0,Pt=he+Mi-He-At,ni=he+Pi-He,Ye=eh(I?lf(Fe,Pt):Fe,he,I?Nl(Me,ni):Me);$[ee]=Ye,Z[ee]=Ye-he}if(o){var gi,pt=ee==="x"?Gr:Hr,it=ee==="x"?ks:Cs,ue=$[oe],H=oe==="y"?"height":"width",Y=ue+B[pt],Ie=ue-B[it],qe=[Gr,Hr].indexOf(N)!==-1,ut=(gi=R==null?void 0:R[oe])!=null?gi:0,st=qe?Y:ue-re[H]-j[H]-ut+J.altAxis,ki=qe?ue+re[H]+j[H]-ut-J.altAxis:Ie,ct=I&&qe?A1(st,ue,ki):eh(I?st:Y,ue,I?ki:Ie);$[oe]=ct,Z[oe]=ct-ue}i.modifiersData[a]=Z}}const I0={name:"preventOverflow",enabled:!0,phase:"main",fn:Q1,requiresIfExists:["offset"]};function $1(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function ew(r){return r===Es(r)||!Gs(r)?lp(r):$1(r)}function tw(r){var i=r.getBoundingClientRect(),n=Hc(i.width)/r.offsetWidth||1,a=Hc(i.height)/r.offsetHeight||1;return n!==1||a!==1}function iw(r,i,n){n===void 0&&(n=!1);var a=Gs(i),u=Gs(i)&&tw(i),d=rl(i),f=Xc(r,u,n),o={scrollLeft:0,scrollTop:0},_={x:0,y:0};return(a||!a&&!n)&&((Bo(i)!=="body"||up(d))&&(o=ew(i)),Gs(i)?(_=Xc(i,!0),_.x+=i.clientLeft,_.y+=i.clientTop):d&&(_.x=cp(d))),{x:f.left+o.scrollLeft-_.x,y:f.top+o.scrollTop-_.y,width:f.width,height:f.height}}function nw(r){var i=new Map,n=new Set,a=[];r.forEach(function(d){i.set(d.name,d)});function u(d){n.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(o){if(!n.has(o)){var _=i.get(o);_&&u(_)}}),a.push(d)}return r.forEach(function(d){n.has(d.name)||u(d)}),a}function rw(r){var i=nw(r);return g0.reduce(function(n,a){return n.concat(i.filter(function(u){return u.phase===a}))},[])}function sw(r){var i;return function(){return i||(i=new Promise(function(n){Promise.resolve().then(function(){i=void 0,n(r())})})),i}}function ow(r){var i=r.reduce(function(n,a){var u=n[a.name];return n[a.name]=u?Object.assign({},u,a,{options:Object.assign({},u.options,a.options),data:Object.assign({},u.data,a.data)}):a,n},{});return Object.keys(i).map(function(n){return i[n]})}var fg={placement:"bottom",modifiers:[],strategy:"absolute"};function dg(){for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return!i.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function yf(r){r===void 0&&(r={});var i=r,n=i.defaultModifiers,a=n===void 0?[]:n,u=i.defaultOptions,d=u===void 0?fg:u;return function(o,_,S){S===void 0&&(S=d);var T={placement:"bottom",orderedModifiers:[],options:Object.assign({},fg,d),modifiersData:{},elements:{reference:o,popper:_},attributes:{},styles:{}},y=[],k=!1,I={state:T,setOptions:function(N){var F=typeof N=="function"?N(T.options):N;L(),T.options=Object.assign({},d,T.options,F),T.scrollParents={reference:Vl(o)?th(o):o.contextElement?th(o.contextElement):[],popper:th(_)};var W=rw(ow([].concat(a,T.options.modifiers)));return T.orderedModifiers=W.filter(function(ee){return ee.enabled}),C(),I.update()},forceUpdate:function(){if(!k){var N=T.elements,F=N.reference,W=N.popper;if(dg(F,W)){T.rects={reference:iw(F,fh(W),T.options.strategy==="fixed"),popper:rp(W)},T.reset=!1,T.placement=T.options.placement,T.orderedModifiers.forEach(function(J){return T.modifiersData[J.name]=Object.assign({},J.data)});for(var ee=0;ee<T.orderedModifiers.length;ee++){if(T.reset===!0){T.reset=!1,ee=-1;continue}var oe=T.orderedModifiers[ee],$=oe.fn,re=oe.options,j=re===void 0?{}:re,U=oe.name;typeof $=="function"&&(T=$({state:T,options:j,name:U,instance:I})||T)}}}},update:sw(function(){return new Promise(function(B){I.forceUpdate(),B(T)})}),destroy:function(){L(),k=!0}};if(!dg(o,_))return I;I.setOptions(S).then(function(B){!k&&S.onFirstUpdate&&S.onFirstUpdate(B)});function C(){T.orderedModifiers.forEach(function(B){var N=B.name,F=B.options,W=F===void 0?{}:F,ee=B.effect;if(typeof ee=="function"){var oe=ee({state:T,name:N,instance:I,options:W}),$=function(){};y.push(oe||$)}})}function L(){y.forEach(function(B){return B()}),y=[]}return I}}var aw=yf(),lw=[ap,hp,op,np],cw=yf({defaultModifiers:lw}),uw=[ap,hp,op,np,E0,k0,I0,x0,C0],hw=yf({defaultModifiers:uw});const fw=Object.freeze(Object.defineProperty({__proto__:null,afterMain:f0,afterRead:c0,afterWrite:m0,applyStyles:np,arrow:x0,auto:gf,basePlacements:Yc,beforeMain:u0,beforeRead:a0,beforeWrite:d0,bottom:ks,clippingParents:s0,computeStyles:op,createPopper:hw,createPopperBase:aw,createPopperLite:cw,detectOverflow:Jc,end:Gc,eventListeners:ap,flip:k0,hide:C0,left:Hr,main:h0,modifierPhases:g0,offset:E0,placements:tp,popper:Rc,popperGenerator:yf,popperOffsets:hp,preventOverflow:I0,read:l0,reference:o0,right:Cs,start:Ul,top:Gr,variationPlacements:Od,viewport:ep,write:p0},Symbol.toStringTag,{value:"Module"})),dw=S1(fw);/*!
  * Bootstrap v5.3.8 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(r,i){(function(n,a){r.exports=a(dw)})(r0,function(n){function a(Be){const O=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(Be){for(const se in Be)if(se!=="default"){const Oe=Object.getOwnPropertyDescriptor(Be,se);Object.defineProperty(O,se,Oe.get?Oe:{enumerable:!0,get:()=>Be[se]})}}return O.default=Be,Object.freeze(O)}const u=a(n),d=new Map,f={set(Be,O,se){d.has(Be)||d.set(Be,new Map);const Oe=d.get(Be);Oe.has(O)||Oe.size===0?Oe.set(O,se):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(Oe.keys())[0]}.`)},get:(Be,O)=>d.has(Be)&&d.get(Be).get(O)||null,remove(Be,O){if(!d.has(Be))return;const se=d.get(Be);se.delete(O),se.size===0&&d.delete(Be)}},o="transitionend",_=Be=>(Be&&window.CSS&&window.CSS.escape&&(Be=Be.replace(/#([^\s"#']+)/g,(O,se)=>`#${CSS.escape(se)}`)),Be),S=Be=>Be==null?`${Be}`:Object.prototype.toString.call(Be).match(/\s([a-z]+)/i)[1].toLowerCase(),T=Be=>{Be.dispatchEvent(new Event(o))},y=Be=>!(!Be||typeof Be!="object")&&(Be.jquery!==void 0&&(Be=Be[0]),Be.nodeType!==void 0),k=Be=>y(Be)?Be.jquery?Be[0]:Be:typeof Be=="string"&&Be.length>0?document.querySelector(_(Be)):null,I=Be=>{if(!y(Be)||Be.getClientRects().length===0)return!1;const O=getComputedStyle(Be).getPropertyValue("visibility")==="visible",se=Be.closest("details:not([open])");if(!se)return O;if(se!==Be){const Oe=Be.closest("summary");if(Oe&&Oe.parentNode!==se||Oe===null)return!1}return O},C=Be=>!Be||Be.nodeType!==Node.ELEMENT_NODE||!!Be.classList.contains("disabled")||(Be.disabled!==void 0?Be.disabled:Be.hasAttribute("disabled")&&Be.getAttribute("disabled")!=="false"),L=Be=>{if(!document.documentElement.attachShadow)return null;if(typeof Be.getRootNode=="function"){const O=Be.getRootNode();return O instanceof ShadowRoot?O:null}return Be instanceof ShadowRoot?Be:Be.parentNode?L(Be.parentNode):null},B=()=>{},N=Be=>{Be.offsetHeight},F=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,W=[],ee=()=>document.documentElement.dir==="rtl",oe=Be=>{var O;O=()=>{const se=F();if(se){const Oe=Be.NAME,ft=se.fn[Oe];se.fn[Oe]=Be.jQueryInterface,se.fn[Oe].Constructor=Be,se.fn[Oe].noConflict=()=>(se.fn[Oe]=ft,Be.jQueryInterface)}},document.readyState==="loading"?(W.length||document.addEventListener("DOMContentLoaded",()=>{for(const se of W)se()}),W.push(O)):O()},$=(Be,O=[],se=Be)=>typeof Be=="function"?Be.call(...O):se,re=(Be,O,se=!0)=>{if(!se)return void $(Be);const Oe=(Xt=>{if(!Xt)return 0;let{transitionDuration:Wi,transitionDelay:on}=window.getComputedStyle(Xt);const On=Number.parseFloat(Wi),In=Number.parseFloat(on);return On||In?(Wi=Wi.split(",")[0],on=on.split(",")[0],1e3*(Number.parseFloat(Wi)+Number.parseFloat(on))):0})(O)+5;let ft=!1;const It=({target:Xt})=>{Xt===O&&(ft=!0,O.removeEventListener(o,It),$(Be))};O.addEventListener(o,It),setTimeout(()=>{ft||T(O)},Oe)},j=(Be,O,se,Oe)=>{const ft=Be.length;let It=Be.indexOf(O);return It===-1?!se&&Oe?Be[ft-1]:Be[0]:(It+=se?1:-1,Oe&&(It=(It+ft)%ft),Be[Math.max(0,Math.min(It,ft-1))])},U=/[^.]*(?=\..*)\.|.*/,J=/\..*/,R=/::\d+$/,Z={};let ce=1;const fe={mouseenter:"mouseover",mouseleave:"mouseout"},ge=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function ye(Be,O){return O&&`${O}::${ce++}`||Be.uidEvent||ce++}function he(Be){const O=ye(Be);return Be.uidEvent=O,Z[O]=Z[O]||{},Z[O]}function Fe(Be,O,se=null){return Object.values(Be).find(Oe=>Oe.callable===O&&Oe.delegationSelector===se)}function Me(Be,O,se){const Oe=typeof O=="string",ft=Oe?se:O||se;let It=kt(Be);return ge.has(It)||(It=Be),[Oe,ft,It]}function lt(Be,O,se,Oe,ft){if(typeof O!="string"||!Be)return;let[It,Xt,Wi]=Me(O,se,Oe);O in fe&&(Xt=($r=>function(_r){if(!_r.relatedTarget||_r.relatedTarget!==_r.delegateTarget&&!_r.delegateTarget.contains(_r.relatedTarget))return $r.call(this,_r)})(Xt));const on=he(Be),On=on[Wi]||(on[Wi]={}),In=Fe(On,Xt,It?se:null);if(In)return void(In.oneOff=In.oneOff&&ft);const gr=ye(Xt,O.replace(U,"")),Er=It?function(jr,$r,_r){return function so(es){const za=jr.querySelectorAll($r);for(let{target:Ur}=es;Ur&&Ur!==this;Ur=Ur.parentNode)for(const vl of za)if(vl===Ur)return vt(es,{delegateTarget:Ur}),so.oneOff&&$e.off(jr,es.type,$r,_r),_r.apply(Ur,[es])}}(Be,se,Xt):function(jr,$r){return function _r(so){return vt(so,{delegateTarget:jr}),_r.oneOff&&$e.off(jr,so.type,$r),$r.apply(jr,[so])}}(Be,Xt);Er.delegationSelector=It?se:null,Er.callable=Xt,Er.oneOff=ft,Er.uidEvent=gr,On[gr]=Er,Be.addEventListener(Wi,Er,It)}function Ze(Be,O,se,Oe,ft){const It=Fe(O[se],Oe,ft);It&&(Be.removeEventListener(se,It,!!ft),delete O[se][It.uidEvent])}function ht(Be,O,se,Oe){const ft=O[se]||{};for(const[It,Xt]of Object.entries(ft))It.includes(Oe)&&Ze(Be,O,se,Xt.callable,Xt.delegationSelector)}function kt(Be){return Be=Be.replace(J,""),fe[Be]||Be}const $e={on(Be,O,se,Oe){lt(Be,O,se,Oe,!1)},one(Be,O,se,Oe){lt(Be,O,se,Oe,!0)},off(Be,O,se,Oe){if(typeof O!="string"||!Be)return;const[ft,It,Xt]=Me(O,se,Oe),Wi=Xt!==O,on=he(Be),On=on[Xt]||{},In=O.startsWith(".");if(It===void 0){if(In)for(const gr of Object.keys(on))ht(Be,on,gr,O.slice(1));for(const[gr,Er]of Object.entries(On)){const jr=gr.replace(R,"");Wi&&!O.includes(jr)||Ze(Be,on,Xt,Er.callable,Er.delegationSelector)}}else{if(!Object.keys(On).length)return;Ze(Be,on,Xt,It,ft?se:null)}},trigger(Be,O,se){if(typeof O!="string"||!Be)return null;const Oe=F();let ft=null,It=!0,Xt=!0,Wi=!1;O!==kt(O)&&Oe&&(ft=Oe.Event(O,se),Oe(Be).trigger(ft),It=!ft.isPropagationStopped(),Xt=!ft.isImmediatePropagationStopped(),Wi=ft.isDefaultPrevented());const on=vt(new Event(O,{bubbles:It,cancelable:!0}),se);return Wi&&on.preventDefault(),Xt&&Be.dispatchEvent(on),on.defaultPrevented&&ft&&ft.preventDefault(),on}};function vt(Be,O={}){for(const[se,Oe]of Object.entries(O))try{Be[se]=Oe}catch{Object.defineProperty(Be,se,{configurable:!0,get:()=>Oe})}return Be}function St(Be){if(Be==="true")return!0;if(Be==="false")return!1;if(Be===Number(Be).toString())return Number(Be);if(Be===""||Be==="null")return null;if(typeof Be!="string")return Be;try{return JSON.parse(decodeURIComponent(Be))}catch{return Be}}function Zt(Be){return Be.replace(/[A-Z]/g,O=>`-${O.toLowerCase()}`)}const oi={setDataAttribute(Be,O,se){Be.setAttribute(`data-bs-${Zt(O)}`,se)},removeDataAttribute(Be,O){Be.removeAttribute(`data-bs-${Zt(O)}`)},getDataAttributes(Be){if(!Be)return{};const O={},se=Object.keys(Be.dataset).filter(Oe=>Oe.startsWith("bs")&&!Oe.startsWith("bsConfig"));for(const Oe of se){let ft=Oe.replace(/^bs/,"");ft=ft.charAt(0).toLowerCase()+ft.slice(1),O[ft]=St(Be.dataset[Oe])}return O},getDataAttribute:(Be,O)=>St(Be.getAttribute(`data-bs-${Zt(O)}`))};class Mi{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(O){return O=this._mergeConfigObj(O),O=this._configAfterMerge(O),this._typeCheckConfig(O),O}_configAfterMerge(O){return O}_mergeConfigObj(O,se){const Oe=y(se)?oi.getDataAttribute(se,"config"):{};return{...this.constructor.Default,...typeof Oe=="object"?Oe:{},...y(se)?oi.getDataAttributes(se):{},...typeof O=="object"?O:{}}}_typeCheckConfig(O,se=this.constructor.DefaultType){for(const[Oe,ft]of Object.entries(se)){const It=O[Oe],Xt=y(It)?"element":S(It);if(!new RegExp(ft).test(Xt))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${Oe}" provided type "${Xt}" but expected type "${ft}".`)}}}class Pi extends Mi{constructor(O,se){super(),(O=k(O))&&(this._element=O,this._config=this._getConfig(se),f.set(this._element,this.constructor.DATA_KEY,this))}dispose(){f.remove(this._element,this.constructor.DATA_KEY),$e.off(this._element,this.constructor.EVENT_KEY);for(const O of Object.getOwnPropertyNames(this))this[O]=null}_queueCallback(O,se,Oe=!0){re(O,se,Oe)}_getConfig(O){return O=this._mergeConfigObj(O,this._element),O=this._configAfterMerge(O),this._typeCheckConfig(O),O}static getInstance(O){return f.get(k(O),this.DATA_KEY)}static getOrCreateInstance(O,se={}){return this.getInstance(O)||new this(O,typeof se=="object"?se:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(O){return`${O}${this.EVENT_KEY}`}}const Ti=Be=>{let O=Be.getAttribute("data-bs-target");if(!O||O==="#"){let se=Be.getAttribute("href");if(!se||!se.includes("#")&&!se.startsWith("."))return null;se.includes("#")&&!se.startsWith("#")&&(se=`#${se.split("#")[1]}`),O=se&&se!=="#"?se.trim():null}return O?O.split(",").map(se=>_(se)).join(","):null},At={find:(Be,O=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(O,Be)),findOne:(Be,O=document.documentElement)=>Element.prototype.querySelector.call(O,Be),children:(Be,O)=>[].concat(...Be.children).filter(se=>se.matches(O)),parents(Be,O){const se=[];let Oe=Be.parentNode.closest(O);for(;Oe;)se.push(Oe),Oe=Oe.parentNode.closest(O);return se},prev(Be,O){let se=Be.previousElementSibling;for(;se;){if(se.matches(O))return[se];se=se.previousElementSibling}return[]},next(Be,O){let se=Be.nextElementSibling;for(;se;){if(se.matches(O))return[se];se=se.nextElementSibling}return[]},focusableChildren(Be){const O=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(se=>`${se}:not([tabindex^="-"])`).join(",");return this.find(O,Be).filter(se=>!C(se)&&I(se))},getSelectorFromElement(Be){const O=Ti(Be);return O&&At.findOne(O)?O:null},getElementFromSelector(Be){const O=Ti(Be);return O?At.findOne(O):null},getMultipleElementsFromSelector(Be){const O=Ti(Be);return O?At.find(O):[]}},He=(Be,O="hide")=>{const se=`click.dismiss${Be.EVENT_KEY}`,Oe=Be.NAME;$e.on(document,se,`[data-bs-dismiss="${Oe}"]`,function(ft){if(["A","AREA"].includes(this.tagName)&&ft.preventDefault(),C(this))return;const It=At.getElementFromSelector(this)||this.closest(`.${Oe}`);Be.getOrCreateInstance(It)[O]()})},Pt=".bs.alert",ni=`close${Pt}`,Ye=`closed${Pt}`;class gi extends Pi{static get NAME(){return"alert"}close(){if($e.trigger(this._element,ni).defaultPrevented)return;this._element.classList.remove("show");const O=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,O)}_destroyElement(){this._element.remove(),$e.trigger(this._element,Ye),this.dispose()}static jQueryInterface(O){return this.each(function(){const se=gi.getOrCreateInstance(this);if(typeof O=="string"){if(se[O]===void 0||O.startsWith("_")||O==="constructor")throw new TypeError(`No method named "${O}"`);se[O](this)}})}}He(gi,"close"),oe(gi);const pt='[data-bs-toggle="button"]';class it extends Pi{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(O){return this.each(function(){const se=it.getOrCreateInstance(this);O==="toggle"&&se[O]()})}}$e.on(document,"click.bs.button.data-api",pt,Be=>{Be.preventDefault();const O=Be.target.closest(pt);it.getOrCreateInstance(O).toggle()}),oe(it);const ue=".bs.swipe",H=`touchstart${ue}`,Y=`touchmove${ue}`,Ie=`touchend${ue}`,qe=`pointerdown${ue}`,ut=`pointerup${ue}`,st={endCallback:null,leftCallback:null,rightCallback:null},ki={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class ct extends Mi{constructor(O,se){super(),this._element=O,O&&ct.isSupported()&&(this._config=this._getConfig(se),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return st}static get DefaultType(){return ki}static get NAME(){return"swipe"}dispose(){$e.off(this._element,ue)}_start(O){this._supportPointerEvents?this._eventIsPointerPenTouch(O)&&(this._deltaX=O.clientX):this._deltaX=O.touches[0].clientX}_end(O){this._eventIsPointerPenTouch(O)&&(this._deltaX=O.clientX-this._deltaX),this._handleSwipe(),$(this._config.endCallback)}_move(O){this._deltaX=O.touches&&O.touches.length>1?0:O.touches[0].clientX-this._deltaX}_handleSwipe(){const O=Math.abs(this._deltaX);if(O<=40)return;const se=O/this._deltaX;this._deltaX=0,se&&$(se>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?($e.on(this._element,qe,O=>this._start(O)),$e.on(this._element,ut,O=>this._end(O)),this._element.classList.add("pointer-event")):($e.on(this._element,H,O=>this._start(O)),$e.on(this._element,Y,O=>this._move(O)),$e.on(this._element,Ie,O=>this._end(O)))}_eventIsPointerPenTouch(O){return this._supportPointerEvents&&(O.pointerType==="pen"||O.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Vt=".bs.carousel",Ci=".data-api",Fi="ArrowLeft",Cn="ArrowRight",xt="next",li="prev",ii="left",tn="right",fr=`slide${Vt}`,ai=`slid${Vt}`,dr=`keydown${Vt}`,pr=`mouseenter${Vt}`,Sr=`mouseleave${Vt}`,Tr=`dragstart${Vt}`,Ae=`load${Vt}${Ci}`,te=`click${Vt}${Ci}`,ie="carousel",de="active",Se=".active",je=".carousel-item",We=Se+je,et={[Fi]:tn,[Cn]:ii},De={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ot={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class mt extends Pi{constructor(O,se){super(O,se),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=At.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===ie&&this.cycle()}static get Default(){return De}static get DefaultType(){return ot}static get NAME(){return"carousel"}next(){this._slide(xt)}nextWhenVisible(){!document.hidden&&I(this._element)&&this.next()}prev(){this._slide(li)}pause(){this._isSliding&&T(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?$e.one(this._element,ai,()=>this.cycle()):this.cycle())}to(O){const se=this._getItems();if(O>se.length-1||O<0)return;if(this._isSliding)return void $e.one(this._element,ai,()=>this.to(O));const Oe=this._getItemIndex(this._getActive());if(Oe===O)return;const ft=O>Oe?xt:li;this._slide(ft,se[O])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(O){return O.defaultInterval=O.interval,O}_addEventListeners(){this._config.keyboard&&$e.on(this._element,dr,O=>this._keydown(O)),this._config.pause==="hover"&&($e.on(this._element,pr,()=>this.pause()),$e.on(this._element,Sr,()=>this._maybeEnableCycle())),this._config.touch&&ct.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const se of At.find(".carousel-item img",this._element))$e.on(se,Tr,Oe=>Oe.preventDefault());const O={leftCallback:()=>this._slide(this._directionToOrder(ii)),rightCallback:()=>this._slide(this._directionToOrder(tn)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new ct(this._element,O)}_keydown(O){if(/input|textarea/i.test(O.target.tagName))return;const se=et[O.key];se&&(O.preventDefault(),this._slide(this._directionToOrder(se)))}_getItemIndex(O){return this._getItems().indexOf(O)}_setActiveIndicatorElement(O){if(!this._indicatorsElement)return;const se=At.findOne(Se,this._indicatorsElement);se.classList.remove(de),se.removeAttribute("aria-current");const Oe=At.findOne(`[data-bs-slide-to="${O}"]`,this._indicatorsElement);Oe&&(Oe.classList.add(de),Oe.setAttribute("aria-current","true"))}_updateInterval(){const O=this._activeElement||this._getActive();if(!O)return;const se=Number.parseInt(O.getAttribute("data-bs-interval"),10);this._config.interval=se||this._config.defaultInterval}_slide(O,se=null){if(this._isSliding)return;const Oe=this._getActive(),ft=O===xt,It=se||j(this._getItems(),Oe,ft,this._config.wrap);if(It===Oe)return;const Xt=this._getItemIndex(It),Wi=gr=>$e.trigger(this._element,gr,{relatedTarget:It,direction:this._orderToDirection(O),from:this._getItemIndex(Oe),to:Xt});if(Wi(fr).defaultPrevented||!Oe||!It)return;const on=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Xt),this._activeElement=It;const On=ft?"carousel-item-start":"carousel-item-end",In=ft?"carousel-item-next":"carousel-item-prev";It.classList.add(In),N(It),Oe.classList.add(On),It.classList.add(On),this._queueCallback(()=>{It.classList.remove(On,In),It.classList.add(de),Oe.classList.remove(de,In,On),this._isSliding=!1,Wi(ai)},Oe,this._isAnimated()),on&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return At.findOne(We,this._element)}_getItems(){return At.find(je,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(O){return ee()?O===ii?li:xt:O===ii?xt:li}_orderToDirection(O){return ee()?O===li?ii:tn:O===li?tn:ii}static jQueryInterface(O){return this.each(function(){const se=mt.getOrCreateInstance(this,O);if(typeof O!="number"){if(typeof O=="string"){if(se[O]===void 0||O.startsWith("_")||O==="constructor")throw new TypeError(`No method named "${O}"`);se[O]()}}else se.to(O)})}}$e.on(document,te,"[data-bs-slide], [data-bs-slide-to]",function(Be){const O=At.getElementFromSelector(this);if(!O||!O.classList.contains(ie))return;Be.preventDefault();const se=mt.getOrCreateInstance(O),Oe=this.getAttribute("data-bs-slide-to");return Oe?(se.to(Oe),void se._maybeEnableCycle()):oi.getDataAttribute(this,"slide")==="next"?(se.next(),void se._maybeEnableCycle()):(se.prev(),void se._maybeEnableCycle())}),$e.on(window,Ae,()=>{const Be=At.find('[data-bs-ride="carousel"]');for(const O of Be)mt.getOrCreateInstance(O)}),oe(mt);const rt=".bs.collapse",Et=`show${rt}`,Yt=`shown${rt}`,ri=`hide${rt}`,Ri=`hidden${rt}`,bi=`click${rt}.data-api`,zi="show",Si="collapse",un="collapsing",hn=`:scope .${Si} .${Si}`,Xe='[data-bs-toggle="collapse"]',di={parent:null,toggle:!0},xi={parent:"(null|element)",toggle:"boolean"};class Bi extends Pi{constructor(O,se){super(O,se),this._isTransitioning=!1,this._triggerArray=[];const Oe=At.find(Xe);for(const ft of Oe){const It=At.getSelectorFromElement(ft),Xt=At.find(It).filter(Wi=>Wi===this._element);It!==null&&Xt.length&&this._triggerArray.push(ft)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return di}static get DefaultType(){return xi}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let O=[];if(this._config.parent&&(O=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(ft=>ft!==this._element).map(ft=>Bi.getOrCreateInstance(ft,{toggle:!1}))),O.length&&O[0]._isTransitioning||$e.trigger(this._element,Et).defaultPrevented)return;for(const ft of O)ft.hide();const se=this._getDimension();this._element.classList.remove(Si),this._element.classList.add(un),this._element.style[se]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const Oe=`scroll${se[0].toUpperCase()+se.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(un),this._element.classList.add(Si,zi),this._element.style[se]="",$e.trigger(this._element,Yt)},this._element,!0),this._element.style[se]=`${this._element[Oe]}px`}hide(){if(this._isTransitioning||!this._isShown()||$e.trigger(this._element,ri).defaultPrevented)return;const O=this._getDimension();this._element.style[O]=`${this._element.getBoundingClientRect()[O]}px`,N(this._element),this._element.classList.add(un),this._element.classList.remove(Si,zi);for(const se of this._triggerArray){const Oe=At.getElementFromSelector(se);Oe&&!this._isShown(Oe)&&this._addAriaAndCollapsedClass([se],!1)}this._isTransitioning=!0,this._element.style[O]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(un),this._element.classList.add(Si),$e.trigger(this._element,Ri)},this._element,!0)}_isShown(O=this._element){return O.classList.contains(zi)}_configAfterMerge(O){return O.toggle=!!O.toggle,O.parent=k(O.parent),O}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const O=this._getFirstLevelChildren(Xe);for(const se of O){const Oe=At.getElementFromSelector(se);Oe&&this._addAriaAndCollapsedClass([se],this._isShown(Oe))}}_getFirstLevelChildren(O){const se=At.find(hn,this._config.parent);return At.find(O,this._config.parent).filter(Oe=>!se.includes(Oe))}_addAriaAndCollapsedClass(O,se){if(O.length)for(const Oe of O)Oe.classList.toggle("collapsed",!se),Oe.setAttribute("aria-expanded",se)}static jQueryInterface(O){const se={};return typeof O=="string"&&/show|hide/.test(O)&&(se.toggle=!1),this.each(function(){const Oe=Bi.getOrCreateInstance(this,se);if(typeof O=="string"){if(Oe[O]===void 0)throw new TypeError(`No method named "${O}"`);Oe[O]()}})}}$e.on(document,bi,Xe,function(Be){(Be.target.tagName==="A"||Be.delegateTarget&&Be.delegateTarget.tagName==="A")&&Be.preventDefault();for(const O of At.getMultipleElementsFromSelector(this))Bi.getOrCreateInstance(O,{toggle:!1}).toggle()}),oe(Bi);const Ki="dropdown",Ji=".bs.dropdown",jn=".data-api",si="ArrowUp",Xr="ArrowDown",Gn=`hide${Ji}`,Un=`hidden${Ji}`,pn=`show${Ji}`,ma=`shown${Ji}`,zn=`click${Ji}${jn}`,Hn=`keydown${Ji}${jn}`,Fr=`keyup${Ji}${jn}`,Rn="show",Ei='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',No=`${Ei}.${Rn}`,nr=".dropdown-menu",En=ee()?"top-end":"top-start",ga=ee()?"top-start":"top-end",Rr=ee()?"bottom-end":"bottom-start",al=ee()?"bottom-start":"bottom-end",Br=ee()?"left-start":"right-start",tu=ee()?"right-start":"left-start",_a={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Hs={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Bn extends Pi{constructor(O,se){super(O,se),this._popper=null,this._parent=this._element.parentNode,this._menu=At.next(this._element,nr)[0]||At.prev(this._element,nr)[0]||At.findOne(nr,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return _a}static get DefaultType(){return Hs}static get NAME(){return Ki}toggle(){return this._isShown()?this.hide():this.show()}show(){if(C(this._element)||this._isShown())return;const O={relatedTarget:this._element};if(!$e.trigger(this._element,pn,O).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const se of[].concat(...document.body.children))$e.on(se,"mouseover",B);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Rn),this._element.classList.add(Rn),$e.trigger(this._element,ma,O)}}hide(){if(C(this._element)||!this._isShown())return;const O={relatedTarget:this._element};this._completeHide(O)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(O){if(!$e.trigger(this._element,Gn,O).defaultPrevented){if("ontouchstart"in document.documentElement)for(const se of[].concat(...document.body.children))$e.off(se,"mouseover",B);this._popper&&this._popper.destroy(),this._menu.classList.remove(Rn),this._element.classList.remove(Rn),this._element.setAttribute("aria-expanded","false"),oi.removeDataAttribute(this._menu,"popper"),$e.trigger(this._element,Un,O)}}_getConfig(O){if(typeof(O=super._getConfig(O)).reference=="object"&&!y(O.reference)&&typeof O.reference.getBoundingClientRect!="function")throw new TypeError(`${Ki.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return O}_createPopper(){if(u===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let O=this._element;this._config.reference==="parent"?O=this._parent:y(this._config.reference)?O=k(this._config.reference):typeof this._config.reference=="object"&&(O=this._config.reference);const se=this._getPopperConfig();this._popper=u.createPopper(O,this._menu,se)}_isShown(){return this._menu.classList.contains(Rn)}_getPlacement(){const O=this._parent;if(O.classList.contains("dropend"))return Br;if(O.classList.contains("dropstart"))return tu;if(O.classList.contains("dropup-center"))return"top";if(O.classList.contains("dropdown-center"))return"bottom";const se=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return O.classList.contains("dropup")?se?ga:En:se?al:Rr}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:O}=this._config;return typeof O=="string"?O.split(",").map(se=>Number.parseInt(se,10)):typeof O=="function"?se=>O(se,this._element):O}_getPopperConfig(){const O={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(oi.setDataAttribute(this._menu,"popper","static"),O.modifiers=[{name:"applyStyles",enabled:!1}]),{...O,...$(this._config.popperConfig,[void 0,O])}}_selectMenuItem({key:O,target:se}){const Oe=At.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(ft=>I(ft));Oe.length&&j(Oe,se,O===Xr,!Oe.includes(se)).focus()}static jQueryInterface(O){return this.each(function(){const se=Bn.getOrCreateInstance(this,O);if(typeof O=="string"){if(se[O]===void 0)throw new TypeError(`No method named "${O}"`);se[O]()}})}static clearMenus(O){if(O.button===2||O.type==="keyup"&&O.key!=="Tab")return;const se=At.find(No);for(const Oe of se){const ft=Bn.getInstance(Oe);if(!ft||ft._config.autoClose===!1)continue;const It=O.composedPath(),Xt=It.includes(ft._menu);if(It.includes(ft._element)||ft._config.autoClose==="inside"&&!Xt||ft._config.autoClose==="outside"&&Xt||ft._menu.contains(O.target)&&(O.type==="keyup"&&O.key==="Tab"||/input|select|option|textarea|form/i.test(O.target.tagName)))continue;const Wi={relatedTarget:ft._element};O.type==="click"&&(Wi.clickEvent=O),ft._completeHide(Wi)}}static dataApiKeydownHandler(O){const se=/input|textarea/i.test(O.target.tagName),Oe=O.key==="Escape",ft=[si,Xr].includes(O.key);if(!ft&&!Oe||se&&!Oe)return;O.preventDefault();const It=this.matches(Ei)?this:At.prev(this,Ei)[0]||At.next(this,Ei)[0]||At.findOne(Ei,O.delegateTarget.parentNode),Xt=Bn.getOrCreateInstance(It);if(ft)return O.stopPropagation(),Xt.show(),void Xt._selectMenuItem(O);Xt._isShown()&&(O.stopPropagation(),Xt.hide(),It.focus())}}$e.on(document,Hn,Ei,Bn.dataApiKeydownHandler),$e.on(document,Hn,nr,Bn.dataApiKeydownHandler),$e.on(document,zn,Bn.clearMenus),$e.on(document,Fr,Bn.clearMenus),$e.on(document,zn,Ei,function(Be){Be.preventDefault(),Bn.getOrCreateInstance(this).toggle()}),oe(Bn);const Zi="backdrop",ya="show",ba=`mousedown.bs.${Zi}`,fo={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},ll={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class jo extends Mi{constructor(O){super(),this._config=this._getConfig(O),this._isAppended=!1,this._element=null}static get Default(){return fo}static get DefaultType(){return ll}static get NAME(){return Zi}show(O){if(!this._config.isVisible)return void $(O);this._append();const se=this._getElement();this._config.isAnimated&&N(se),se.classList.add(ya),this._emulateAnimation(()=>{$(O)})}hide(O){this._config.isVisible?(this._getElement().classList.remove(ya),this._emulateAnimation(()=>{this.dispose(),$(O)})):$(O)}dispose(){this._isAppended&&($e.off(this._element,ba),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const O=document.createElement("div");O.className=this._config.className,this._config.isAnimated&&O.classList.add("fade"),this._element=O}return this._element}_configAfterMerge(O){return O.rootElement=k(O.rootElement),O}_append(){if(this._isAppended)return;const O=this._getElement();this._config.rootElement.append(O),$e.on(O,ba,()=>{$(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(O){re(O,this._getElement(),this._config.isAnimated)}}const Is=".bs.focustrap",va=`focusin${Is}`,po=`keydown.tab${Is}`,cl="backward",iu={autofocus:!0,trapElement:null},Zl={autofocus:"boolean",trapElement:"element"};class Wl extends Mi{constructor(O){super(),this._config=this._getConfig(O),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return iu}static get DefaultType(){return Zl}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),$e.off(document,Is),$e.on(document,va,O=>this._handleFocusin(O)),$e.on(document,po,O=>this._handleKeydown(O)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,$e.off(document,Is))}_handleFocusin(O){const{trapElement:se}=this._config;if(O.target===document||O.target===se||se.contains(O.target))return;const Oe=At.focusableChildren(se);Oe.length===0?se.focus():this._lastTabNavDirection===cl?Oe[Oe.length-1].focus():Oe[0].focus()}_handleKeydown(O){O.key==="Tab"&&(this._lastTabNavDirection=O.shiftKey?cl:"forward")}}const As=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",mo=".sticky-top",Vn="padding-right",Yn="margin-right";class go{constructor(){this._element=document.body}getWidth(){const O=document.documentElement.clientWidth;return Math.abs(window.innerWidth-O)}hide(){const O=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Vn,se=>se+O),this._setElementAttributes(As,Vn,se=>se+O),this._setElementAttributes(mo,Yn,se=>se-O)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Vn),this._resetElementAttributes(As,Vn),this._resetElementAttributes(mo,Yn)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(O,se,Oe){const ft=this.getWidth();this._applyManipulationCallback(O,It=>{if(It!==this._element&&window.innerWidth>It.clientWidth+ft)return;this._saveInitialAttribute(It,se);const Xt=window.getComputedStyle(It).getPropertyValue(se);It.style.setProperty(se,`${Oe(Number.parseFloat(Xt))}px`)})}_saveInitialAttribute(O,se){const Oe=O.style.getPropertyValue(se);Oe&&oi.setDataAttribute(O,se,Oe)}_resetElementAttributes(O,se){this._applyManipulationCallback(O,Oe=>{const ft=oi.getDataAttribute(Oe,se);ft!==null?(oi.removeDataAttribute(Oe,se),Oe.style.setProperty(se,ft)):Oe.style.removeProperty(se)})}_applyManipulationCallback(O,se){if(y(O))se(O);else for(const Oe of At.find(O,this._element))se(Oe)}}const Qn=".bs.modal",wa=`hide${Qn}`,Gl=`hidePrevented${Qn}`,Xs=`hidden${Qn}`,Hl=`show${Qn}`,Xl=`shown${Qn}`,Kl=`resize${Qn}`,nu=`click.dismiss${Qn}`,ru=`mousedown.dismiss${Qn}`,Jl=`keydown.dismiss${Qn}`,Uo=`click${Qn}.data-api`,xa="modal-open",Vo="show",qo="modal-static",ul={backdrop:!0,focus:!0,keyboard:!0},Kr={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Ks extends Pi{constructor(O,se){super(O,se),this._dialog=At.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new go,this._addEventListeners()}static get Default(){return ul}static get DefaultType(){return Kr}static get NAME(){return"modal"}toggle(O){return this._isShown?this.hide():this.show(O)}show(O){this._isShown||this._isTransitioning||$e.trigger(this._element,Hl,{relatedTarget:O}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(xa),this._adjustDialog(),this._backdrop.show(()=>this._showElement(O)))}hide(){this._isShown&&!this._isTransitioning&&($e.trigger(this._element,wa).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Vo),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){$e.off(window,Qn),$e.off(this._dialog,Qn),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new jo({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Wl({trapElement:this._element})}_showElement(O){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const se=At.findOne(".modal-body",this._dialog);se&&(se.scrollTop=0),N(this._element),this._element.classList.add(Vo),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,$e.trigger(this._element,Xl,{relatedTarget:O})},this._dialog,this._isAnimated())}_addEventListeners(){$e.on(this._element,Jl,O=>{O.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),$e.on(window,Kl,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),$e.on(this._element,ru,O=>{$e.one(this._element,nu,se=>{this._element===O.target&&this._element===se.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(xa),this._resetAdjustments(),this._scrollBar.reset(),$e.trigger(this._element,Xs)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if($e.trigger(this._element,Gl).defaultPrevented)return;const O=this._element.scrollHeight>document.documentElement.clientHeight,se=this._element.style.overflowY;se==="hidden"||this._element.classList.contains(qo)||(O||(this._element.style.overflowY="hidden"),this._element.classList.add(qo),this._queueCallback(()=>{this._element.classList.remove(qo),this._queueCallback(()=>{this._element.style.overflowY=se},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const O=this._element.scrollHeight>document.documentElement.clientHeight,se=this._scrollBar.getWidth(),Oe=se>0;if(Oe&&!O){const ft=ee()?"paddingLeft":"paddingRight";this._element.style[ft]=`${se}px`}if(!Oe&&O){const ft=ee()?"paddingRight":"paddingLeft";this._element.style[ft]=`${se}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(O,se){return this.each(function(){const Oe=Ks.getOrCreateInstance(this,O);if(typeof O=="string"){if(Oe[O]===void 0)throw new TypeError(`No method named "${O}"`);Oe[O](se)}})}}$e.on(document,Uo,'[data-bs-toggle="modal"]',function(Be){const O=At.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&Be.preventDefault(),$e.one(O,Hl,Oe=>{Oe.defaultPrevented||$e.one(O,Xs,()=>{I(this)&&this.focus()})});const se=At.findOne(".modal.show");se&&Ks.getInstance(se).hide(),Ks.getOrCreateInstance(O).toggle(this)}),He(Ks),oe(Ks);const Nr=".bs.offcanvas",Ms=".data-api",Ps=`load${Nr}${Ms}`,Gi="show",Zo="showing",Yl="hiding",Js=".offcanvas.show",su=`show${Nr}`,Ql=`shown${Nr}`,ou=`hide${Nr}`,hl=`hidePrevented${Nr}`,Sa=`hidden${Nr}`,$l=`resize${Nr}`,ec=`click${Nr}${Ms}`,tc=`keydown.dismiss${Nr}`,ic={backdrop:!0,keyboard:!0,scroll:!1},Ys={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Jr extends Pi{constructor(O,se){super(O,se),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return ic}static get DefaultType(){return Ys}static get NAME(){return"offcanvas"}toggle(O){return this._isShown?this.hide():this.show(O)}show(O){this._isShown||$e.trigger(this._element,su,{relatedTarget:O}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new go().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Zo),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Gi),this._element.classList.remove(Zo),$e.trigger(this._element,Ql,{relatedTarget:O})},this._element,!0))}hide(){this._isShown&&($e.trigger(this._element,ou).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Yl),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Gi,Yl),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new go().reset(),$e.trigger(this._element,Sa)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const O=!!this._config.backdrop;return new jo({className:"offcanvas-backdrop",isVisible:O,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:O?()=>{this._config.backdrop!=="static"?this.hide():$e.trigger(this._element,hl)}:null})}_initializeFocusTrap(){return new Wl({trapElement:this._element})}_addEventListeners(){$e.on(this._element,tc,O=>{O.key==="Escape"&&(this._config.keyboard?this.hide():$e.trigger(this._element,hl))})}static jQueryInterface(O){return this.each(function(){const se=Jr.getOrCreateInstance(this,O);if(typeof O=="string"){if(se[O]===void 0||O.startsWith("_")||O==="constructor")throw new TypeError(`No method named "${O}"`);se[O](this)}})}}$e.on(document,ec,'[data-bs-toggle="offcanvas"]',function(Be){const O=At.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&Be.preventDefault(),C(this))return;$e.one(O,Sa,()=>{I(this)&&this.focus()});const se=At.findOne(Js);se&&se!==O&&Jr.getInstance(se).hide(),Jr.getOrCreateInstance(O).toggle(this)}),$e.on(window,Ps,()=>{for(const Be of At.find(Js))Jr.getOrCreateInstance(Be).show()}),$e.on(window,$l,()=>{for(const Be of At.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(Be).position!=="fixed"&&Jr.getOrCreateInstance(Be).hide()}),He(Jr),oe(Jr);const nc={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},rc=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Wo=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,au=(Be,O)=>{const se=Be.nodeName.toLowerCase();return O.includes(se)?!rc.has(se)||!!Wo.test(Be.nodeValue):O.filter(Oe=>Oe instanceof RegExp).some(Oe=>Oe.test(se))},Ta={allowList:nc,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},lu={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},cu={entry:"(string|element|function|null)",selector:"(string|element)"};class sc extends Mi{constructor(O){super(),this._config=this._getConfig(O)}static get Default(){return Ta}static get DefaultType(){return lu}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(O=>this._resolvePossibleFunction(O)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(O){return this._checkContent(O),this._config.content={...this._config.content,...O},this}toHtml(){const O=document.createElement("div");O.innerHTML=this._maybeSanitize(this._config.template);for(const[ft,It]of Object.entries(this._config.content))this._setContent(O,It,ft);const se=O.children[0],Oe=this._resolvePossibleFunction(this._config.extraClass);return Oe&&se.classList.add(...Oe.split(" ")),se}_typeCheckConfig(O){super._typeCheckConfig(O),this._checkContent(O.content)}_checkContent(O){for(const[se,Oe]of Object.entries(O))super._typeCheckConfig({selector:se,entry:Oe},cu)}_setContent(O,se,Oe){const ft=At.findOne(Oe,O);ft&&((se=this._resolvePossibleFunction(se))?y(se)?this._putElementInTemplate(k(se),ft):this._config.html?ft.innerHTML=this._maybeSanitize(se):ft.textContent=se:ft.remove())}_maybeSanitize(O){return this._config.sanitize?function(se,Oe,ft){if(!se.length)return se;if(ft&&typeof ft=="function")return ft(se);const It=new window.DOMParser().parseFromString(se,"text/html"),Xt=[].concat(...It.body.querySelectorAll("*"));for(const Wi of Xt){const on=Wi.nodeName.toLowerCase();if(!Object.keys(Oe).includes(on)){Wi.remove();continue}const On=[].concat(...Wi.attributes),In=[].concat(Oe["*"]||[],Oe[on]||[]);for(const gr of On)au(gr,In)||Wi.removeAttribute(gr.nodeName)}return It.body.innerHTML}(O,this._config.allowList,this._config.sanitizeFn):O}_resolvePossibleFunction(O){return $(O,[void 0,this])}_putElementInTemplate(O,se){if(this._config.html)return se.innerHTML="",void se.append(O);se.textContent=O.textContent}}const oc=new Set(["sanitize","allowList","sanitizeFn"]),ka="fade",_o="show",ac=".tooltip-inner",Go=".modal",Yr="hide.bs.modal",Qs="hover",Ho="focus",Xo="click",Ca={AUTO:"auto",TOP:"top",RIGHT:ee()?"left":"right",BOTTOM:"bottom",LEFT:ee()?"right":"left"},fl={allowList:nc,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},$s={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class fs extends Pi{constructor(O,se){if(u===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(O,se),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return fl}static get DefaultType(){return $s}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),$e.off(this._element.closest(Go),Yr,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const O=$e.trigger(this._element,this.constructor.eventName("show")),se=(L(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(O.defaultPrevented||!se)return;this._disposePopper();const Oe=this._getTipElement();this._element.setAttribute("aria-describedby",Oe.getAttribute("id"));const{container:ft}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(ft.append(Oe),$e.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(Oe),Oe.classList.add(_o),"ontouchstart"in document.documentElement)for(const It of[].concat(...document.body.children))$e.on(It,"mouseover",B);this._queueCallback(()=>{$e.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!$e.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(_o),"ontouchstart"in document.documentElement)for(const O of[].concat(...document.body.children))$e.off(O,"mouseover",B);this._activeTrigger[Xo]=!1,this._activeTrigger[Ho]=!1,this._activeTrigger[Qs]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),$e.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(O){const se=this._getTemplateFactory(O).toHtml();if(!se)return null;se.classList.remove(ka,_o),se.classList.add(`bs-${this.constructor.NAME}-auto`);const Oe=(ft=>{do ft+=Math.floor(1e6*Math.random());while(document.getElementById(ft));return ft})(this.constructor.NAME).toString();return se.setAttribute("id",Oe),this._isAnimated()&&se.classList.add(ka),se}setContent(O){this._newContent=O,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(O){return this._templateFactory?this._templateFactory.changeContent(O):this._templateFactory=new sc({...this._config,content:O,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[ac]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(O){return this.constructor.getOrCreateInstance(O.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(ka)}_isShown(){return this.tip&&this.tip.classList.contains(_o)}_createPopper(O){const se=$(this._config.placement,[this,O,this._element]),Oe=Ca[se.toUpperCase()];return u.createPopper(this._element,O,this._getPopperConfig(Oe))}_getOffset(){const{offset:O}=this._config;return typeof O=="string"?O.split(",").map(se=>Number.parseInt(se,10)):typeof O=="function"?se=>O(se,this._element):O}_resolvePossibleFunction(O){return $(O,[this._element,this._element])}_getPopperConfig(O){const se={placement:O,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:Oe=>{this._getTipElement().setAttribute("data-popper-placement",Oe.state.placement)}}]};return{...se,...$(this._config.popperConfig,[void 0,se])}}_setListeners(){const O=this._config.trigger.split(" ");for(const se of O)if(se==="click")$e.on(this._element,this.constructor.eventName("click"),this._config.selector,Oe=>{const ft=this._initializeOnDelegatedTarget(Oe);ft._activeTrigger[Xo]=!(ft._isShown()&&ft._activeTrigger[Xo]),ft.toggle()});else if(se!=="manual"){const Oe=se===Qs?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),ft=se===Qs?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");$e.on(this._element,Oe,this._config.selector,It=>{const Xt=this._initializeOnDelegatedTarget(It);Xt._activeTrigger[It.type==="focusin"?Ho:Qs]=!0,Xt._enter()}),$e.on(this._element,ft,this._config.selector,It=>{const Xt=this._initializeOnDelegatedTarget(It);Xt._activeTrigger[It.type==="focusout"?Ho:Qs]=Xt._element.contains(It.relatedTarget),Xt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},$e.on(this._element.closest(Go),Yr,this._hideModalHandler)}_fixTitle(){const O=this._element.getAttribute("title");O&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",O),this._element.setAttribute("data-bs-original-title",O),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(O,se){clearTimeout(this._timeout),this._timeout=setTimeout(O,se)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(O){const se=oi.getDataAttributes(this._element);for(const Oe of Object.keys(se))oc.has(Oe)&&delete se[Oe];return O={...se,...typeof O=="object"&&O?O:{}},O=this._mergeConfigObj(O),O=this._configAfterMerge(O),this._typeCheckConfig(O),O}_configAfterMerge(O){return O.container=O.container===!1?document.body:k(O.container),typeof O.delay=="number"&&(O.delay={show:O.delay,hide:O.delay}),typeof O.title=="number"&&(O.title=O.title.toString()),typeof O.content=="number"&&(O.content=O.content.toString()),O}_getDelegateConfig(){const O={};for(const[se,Oe]of Object.entries(this._config))this.constructor.Default[se]!==Oe&&(O[se]=Oe);return O.selector=!1,O.trigger="manual",O}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(O){return this.each(function(){const se=fs.getOrCreateInstance(this,O);if(typeof O=="string"){if(se[O]===void 0)throw new TypeError(`No method named "${O}"`);se[O]()}})}}oe(fs);const uu=".popover-header",Tn=".popover-body",hu={...fs.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Li={...fs.DefaultType,content:"(null|string|element|function)"};class eo extends fs{static get Default(){return hu}static get DefaultType(){return Li}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[uu]:this._getTitle(),[Tn]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(O){return this.each(function(){const se=eo.getOrCreateInstance(this,O);if(typeof O=="string"){if(se[O]===void 0)throw new TypeError(`No method named "${O}"`);se[O]()}})}}oe(eo);const Qi=".bs.scrollspy",$i=`activate${Qi}`,Ls=`click${Qi}`,Ko=`load${Qi}.data-api`,Qr="active",Jo="[href]",zs=".nav-link",yo=`${zs}, .nav-item > ${zs}, .list-group-item`,kr={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},dl={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class to extends Pi{constructor(O,se){super(O,se),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return kr}static get DefaultType(){return dl}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const O of this._observableSections.values())this._observer.observe(O)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(O){return O.target=k(O.target)||document.body,O.rootMargin=O.offset?`${O.offset}px 0px -30%`:O.rootMargin,typeof O.threshold=="string"&&(O.threshold=O.threshold.split(",").map(se=>Number.parseFloat(se))),O}_maybeEnableSmoothScroll(){this._config.smoothScroll&&($e.off(this._config.target,Ls),$e.on(this._config.target,Ls,Jo,O=>{const se=this._observableSections.get(O.target.hash);if(se){O.preventDefault();const Oe=this._rootElement||window,ft=se.offsetTop-this._element.offsetTop;if(Oe.scrollTo)return void Oe.scrollTo({top:ft,behavior:"smooth"});Oe.scrollTop=ft}}))}_getNewObserver(){const O={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(se=>this._observerCallback(se),O)}_observerCallback(O){const se=Xt=>this._targetLinks.get(`#${Xt.target.id}`),Oe=Xt=>{this._previousScrollData.visibleEntryTop=Xt.target.offsetTop,this._process(se(Xt))},ft=(this._rootElement||document.documentElement).scrollTop,It=ft>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=ft;for(const Xt of O){if(!Xt.isIntersecting){this._activeTarget=null,this._clearActiveClass(se(Xt));continue}const Wi=Xt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(It&&Wi){if(Oe(Xt),!ft)return}else It||Wi||Oe(Xt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const O=At.find(Jo,this._config.target);for(const se of O){if(!se.hash||C(se))continue;const Oe=At.findOne(decodeURI(se.hash),this._element);I(Oe)&&(this._targetLinks.set(decodeURI(se.hash),se),this._observableSections.set(se.hash,Oe))}}_process(O){this._activeTarget!==O&&(this._clearActiveClass(this._config.target),this._activeTarget=O,O.classList.add(Qr),this._activateParents(O),$e.trigger(this._element,$i,{relatedTarget:O}))}_activateParents(O){if(O.classList.contains("dropdown-item"))At.findOne(".dropdown-toggle",O.closest(".dropdown")).classList.add(Qr);else for(const se of At.parents(O,".nav, .list-group"))for(const Oe of At.prev(se,yo))Oe.classList.add(Qr)}_clearActiveClass(O){O.classList.remove(Qr);const se=At.find(`${Jo}.${Qr}`,O);for(const Oe of se)Oe.classList.remove(Qr)}static jQueryInterface(O){return this.each(function(){const se=to.getOrCreateInstance(this,O);if(typeof O=="string"){if(se[O]===void 0||O.startsWith("_")||O==="constructor")throw new TypeError(`No method named "${O}"`);se[O]()}})}}$e.on(window,Ko,()=>{for(const Be of At.find('[data-bs-spy="scroll"]'))to.getOrCreateInstance(Be)}),oe(to);const ds=".bs.tab",io=`hide${ds}`,Yo=`hidden${ds}`,Qo=`show${ds}`,bo=`shown${ds}`,$o=`click${ds}`,Ea=`keydown${ds}`,vo=`load${ds}`,wo="ArrowLeft",pl="ArrowRight",ml="ArrowUp",qi="ArrowDown",xo="Home",lc="End",Os="active",no="fade",Ia="show",ea=".dropdown-toggle",Aa=`:not(${ea})`,gl='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',So=`.nav-link${Aa}, .list-group-item${Aa}, [role="tab"]${Aa}, ${gl}`,Ma=`.${Os}[data-bs-toggle="tab"], .${Os}[data-bs-toggle="pill"], .${Os}[data-bs-toggle="list"]`;class Cr extends Pi{constructor(O){super(O),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),$e.on(this._element,Ea,se=>this._keydown(se)))}static get NAME(){return"tab"}show(){const O=this._element;if(this._elemIsActive(O))return;const se=this._getActiveElem(),Oe=se?$e.trigger(se,io,{relatedTarget:O}):null;$e.trigger(O,Qo,{relatedTarget:se}).defaultPrevented||Oe&&Oe.defaultPrevented||(this._deactivate(se,O),this._activate(O,se))}_activate(O,se){O&&(O.classList.add(Os),this._activate(At.getElementFromSelector(O)),this._queueCallback(()=>{O.getAttribute("role")==="tab"?(O.removeAttribute("tabindex"),O.setAttribute("aria-selected",!0),this._toggleDropDown(O,!0),$e.trigger(O,bo,{relatedTarget:se})):O.classList.add(Ia)},O,O.classList.contains(no)))}_deactivate(O,se){O&&(O.classList.remove(Os),O.blur(),this._deactivate(At.getElementFromSelector(O)),this._queueCallback(()=>{O.getAttribute("role")==="tab"?(O.setAttribute("aria-selected",!1),O.setAttribute("tabindex","-1"),this._toggleDropDown(O,!1),$e.trigger(O,Yo,{relatedTarget:se})):O.classList.remove(Ia)},O,O.classList.contains(no)))}_keydown(O){if(![wo,pl,ml,qi,xo,lc].includes(O.key))return;O.stopPropagation(),O.preventDefault();const se=this._getChildren().filter(ft=>!C(ft));let Oe;if([xo,lc].includes(O.key))Oe=se[O.key===xo?0:se.length-1];else{const ft=[pl,qi].includes(O.key);Oe=j(se,O.target,ft,!0)}Oe&&(Oe.focus({preventScroll:!0}),Cr.getOrCreateInstance(Oe).show())}_getChildren(){return At.find(So,this._parent)}_getActiveElem(){return this._getChildren().find(O=>this._elemIsActive(O))||null}_setInitialAttributes(O,se){this._setAttributeIfNotExists(O,"role","tablist");for(const Oe of se)this._setInitialAttributesOnChild(Oe)}_setInitialAttributesOnChild(O){O=this._getInnerElement(O);const se=this._elemIsActive(O),Oe=this._getOuterElement(O);O.setAttribute("aria-selected",se),Oe!==O&&this._setAttributeIfNotExists(Oe,"role","presentation"),se||O.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(O,"role","tab"),this._setInitialAttributesOnTargetPanel(O)}_setInitialAttributesOnTargetPanel(O){const se=At.getElementFromSelector(O);se&&(this._setAttributeIfNotExists(se,"role","tabpanel"),O.id&&this._setAttributeIfNotExists(se,"aria-labelledby",`${O.id}`))}_toggleDropDown(O,se){const Oe=this._getOuterElement(O);if(!Oe.classList.contains("dropdown"))return;const ft=(It,Xt)=>{const Wi=At.findOne(It,Oe);Wi&&Wi.classList.toggle(Xt,se)};ft(ea,Os),ft(".dropdown-menu",Ia),Oe.setAttribute("aria-expanded",se)}_setAttributeIfNotExists(O,se,Oe){O.hasAttribute(se)||O.setAttribute(se,Oe)}_elemIsActive(O){return O.classList.contains(Os)}_getInnerElement(O){return O.matches(So)?O:At.findOne(So,O)}_getOuterElement(O){return O.closest(".nav-item, .list-group-item")||O}static jQueryInterface(O){return this.each(function(){const se=Cr.getOrCreateInstance(this);if(typeof O=="string"){if(se[O]===void 0||O.startsWith("_")||O==="constructor")throw new TypeError(`No method named "${O}"`);se[O]()}})}}$e.on(document,$o,gl,function(Be){["A","AREA"].includes(this.tagName)&&Be.preventDefault(),C(this)||Cr.getOrCreateInstance(this).show()}),$e.on(window,vo,()=>{for(const Be of At.find(Ma))Cr.getOrCreateInstance(Be)}),oe(Cr);const mr=".bs.toast",To=`mouseover${mr}`,_l=`mouseout${mr}`,ko=`focusin${mr}`,ta=`focusout${mr}`,Pa=`hide${mr}`,La=`hidden${mr}`,yl=`show${mr}`,fu=`shown${mr}`,bl="hide",ro="show",Co="showing",ia={animation:"boolean",autohide:"boolean",delay:"number"},na={animation:!0,autohide:!0,delay:5e3};class Pn extends Pi{constructor(O,se){super(O,se),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return na}static get DefaultType(){return ia}static get NAME(){return"toast"}show(){$e.trigger(this._element,yl).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(bl),N(this._element),this._element.classList.add(ro,Co),this._queueCallback(()=>{this._element.classList.remove(Co),$e.trigger(this._element,fu),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&($e.trigger(this._element,Pa).defaultPrevented||(this._element.classList.add(Co),this._queueCallback(()=>{this._element.classList.add(bl),this._element.classList.remove(Co,ro),$e.trigger(this._element,La)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(ro),super.dispose()}isShown(){return this._element.classList.contains(ro)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(O,se){switch(O.type){case"mouseover":case"mouseout":this._hasMouseInteraction=se;break;case"focusin":case"focusout":this._hasKeyboardInteraction=se}if(se)return void this._clearTimeout();const Oe=O.relatedTarget;this._element===Oe||this._element.contains(Oe)||this._maybeScheduleHide()}_setListeners(){$e.on(this._element,To,O=>this._onInteraction(O,!0)),$e.on(this._element,_l,O=>this._onInteraction(O,!1)),$e.on(this._element,ko,O=>this._onInteraction(O,!0)),$e.on(this._element,ta,O=>this._onInteraction(O,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(O){return this.each(function(){const se=Pn.getOrCreateInstance(this,O);if(typeof O=="string"){if(se[O]===void 0)throw new TypeError(`No method named "${O}"`);se[O](this)}})}}return He(Pn),oe(Pn),{Alert:gi,Button:it,Carousel:mt,Collapse:Bi,Dropdown:Bn,Modal:Ks,Offcanvas:Jr,Popover:eo,ScrollSpy:to,Tab:Cr,Toast:Pn,Tooltip:fs}})})(T1);var xs=63710088e-1,pw={centimeters:xs*100,centimetres:xs*100,degrees:360/(2*Math.PI),feet:xs*3.28084,inches:xs*39.37,kilometers:xs/1e3,kilometres:xs/1e3,meters:xs,metres:xs,miles:xs/1609.344,millimeters:xs*1e3,millimetres:xs*1e3,nauticalmiles:xs/1852,radians:1,yards:xs*1.0936};function Rd(r,i,n={}){const a={type:"Feature"};return(n.id===0||n.id)&&(a.id=n.id),n.bbox&&(a.bbox=n.bbox),a.properties=i||{},a.geometry=r,a}function Xh(r,i,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!mg(r[0])||!mg(r[1]))throw new Error("coordinates must contain numbers");return Rd({type:"Point",coordinates:r},i,n)}function mw(r,i="kilometers"){const n=pw[i];if(!n)throw new Error(i+" units is invalid");return r*n}function pg(r){return r%(2*Math.PI)*180/Math.PI}function jc(r){return r%360*Math.PI/180}function mg(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Uc(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function gw(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Rl(r,i,n={}){var a=Uc(r),u=Uc(i),d=jc(u[1]-a[1]),f=jc(u[0]-a[0]),o=jc(a[1]),_=jc(u[1]),S=Math.pow(Math.sin(d/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(o)*Math.cos(_);return mw(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)),n.units)}function A0(r,i,n){if(r!==null)for(var a,u,d,f,o,_,S,T=0,y=0,k,I=r.type,C=I==="FeatureCollection",L=I==="Feature",B=C?r.features.length:1,N=0;N<B;N++){S=C?r.features[N].geometry:L?r.geometry:r,k=S?S.type==="GeometryCollection":!1,o=k?S.geometries.length:1;for(var F=0;F<o;F++){var W=0,ee=0;if(f=k?S.geometries[F]:S,f!==null){_=f.coordinates;var oe=f.type;switch(T=0,oe){case null:break;case"Point":if(i(_,y,N,W,ee)===!1)return!1;y++,W++;break;case"LineString":case"MultiPoint":for(a=0;a<_.length;a++){if(i(_[a],y,N,W,ee)===!1)return!1;y++,oe==="MultiPoint"&&W++}oe==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(a=0;a<_.length;a++){for(u=0;u<_[a].length-T;u++){if(i(_[a][u],y,N,W,ee)===!1)return!1;y++}oe==="MultiLineString"&&W++,oe==="Polygon"&&ee++}oe==="Polygon"&&W++;break;case"MultiPolygon":for(a=0;a<_.length;a++){for(ee=0,u=0;u<_[a].length;u++){for(d=0;d<_[a][u].length-T;d++){if(i(_[a][u][d],y,N,W,ee)===!1)return!1;y++}ee++}W++}break;case"GeometryCollection":for(a=0;a<f.geometries.length;a++)if(A0(f.geometries[a],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function _w(r,i){var n,a,u,d,f,o,_,S,T,y,k=0,I=r.type==="FeatureCollection",C=r.type==="Feature",L=I?r.features.length:1;for(n=0;n<L;n++){for(o=I?r.features[n].geometry:C?r.geometry:r,S=I?r.features[n].properties:C?r.properties:{},T=I?r.features[n].bbox:C?r.bbox:void 0,y=I?r.features[n].id:C?r.id:void 0,_=o?o.type==="GeometryCollection":!1,f=_?o.geometries.length:1,u=0;u<f;u++){if(d=_?o.geometries[u]:o,d===null){if(i(null,k,S,T,y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(d,k,S,T,y)===!1)return!1;break}case"GeometryCollection":{for(a=0;a<d.geometries.length;a++)if(i(d.geometries[a],k,S,T,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function yw(r,i){_w(r,function(n,a,u,d,f){var o=n===null?null:n.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return i(Rd(n,u,{bbox:d,id:f}),a,0)===!1?!1:void 0}var _;switch(o){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var T=n.coordinates[S],y={type:_,coordinates:T};if(i(Rd(y,u),a,S)===!1)return!1}})}var bw=Object.defineProperty,vw=Object.defineProperties,ww=Object.getOwnPropertyDescriptors,gg=Object.getOwnPropertySymbols,xw=Object.prototype.hasOwnProperty,Sw=Object.prototype.propertyIsEnumerable,_g=(r,i,n)=>i in r?bw(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,yg=(r,i)=>{for(var n in i||(i={}))xw.call(i,n)&&_g(r,n,i[n]);if(gg)for(var n of gg(i))Sw.call(i,n)&&_g(r,n,i[n]);return r},bg=(r,i)=>vw(r,ww(i));function Tw(r,i,n={}){if(!r||!i)throw new Error("lines and pt are required arguments");const a=Uc(i);let u=Xh([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),d=0;return yw(r,function(f,o,_){const S=gw(f);for(let T=0;T<S.length-1;T++){const y=Xh(S[T]);y.properties.dist=Rl(i,y,n);const k=Uc(y),I=Xh(S[T+1]);I.properties.dist=Rl(i,I,n);const C=Uc(I),L=Rl(y,I,n);let B,N;k[0]===a[0]&&k[1]===a[1]?[B,,N]=[k,void 0,!1]:C[0]===a[0]&&C[1]===a[1]?[B,,N]=[C,void 0,!0]:[B,,N]=Ew(y.geometry.coordinates,I.geometry.coordinates,Uc(i));let F;B&&(F=Xh(B,{dist:Rl(i,B,n),multiFeatureIndex:_,location:d+Rl(y,B,n)})),F&&F.properties.dist<u.properties.dist&&(u=bg(yg({},F),{properties:bg(yg({},F.properties),{index:N?T+1:T})})),d+=L}}),u}function kw(r,i){const[n,a,u]=r,[d,f,o]=i;return n*d+a*f+u*o}function Cw(r,i){const[n,a,u]=r,[d,f,o]=i;return[a*o-u*f,u*d-n*o,n*f-a*d]}function vg(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2))}function zl(r,i){const n=kw(r,i)/(vg(r)*vg(i));return Math.acos(Math.min(Math.max(n,-1),1))}function wd(r){const i=jc(r[1]),n=jc(r[0]);return[Math.cos(i)*Math.cos(n),Math.cos(i)*Math.sin(n),Math.sin(i)]}function Ol(r){const[i,n,a]=r,u=pg(Math.asin(a));return[pg(Math.atan2(n,i)),u]}function Ew(r,i,n){const a=wd(r),u=wd(i),d=wd(n),[f,o,_]=d,[S,T,y]=Cw(a,u),k=T*_-y*o,I=y*f-S*_,C=S*o-T*f,L=C*T-I*y,B=k*y-C*S,N=I*S-k*T,F=1/Math.sqrt(Math.pow(L,2)+Math.pow(B,2)+Math.pow(N,2)),W=[L*F,B*F,N*F],ee=[-1*L*F,-1*B*F,-1*N*F],oe=zl(a,u),$=zl(a,W),re=zl(u,W),j=zl(a,ee),U=zl(u,ee);let J;return $<j&&$<U||re<j&&re<U?J=W:J=ee,zl(a,J)>oe||zl(u,J)>oe?Rl(Ol(J),Ol(a))<=Rl(Ol(J),Ol(u))?[Ol(a),!0,!1]:[Ol(u),!1,!0]:[Ol(J),!1,!1]}var Iw=Tw;const Aw=["==",["geometry-type"],"Polygon"],Mw=["==",["geometry-type"],"LineString"],Pw=["==",["geometry-type"],"Point"];function M0(){return{type:"FeatureCollection",features:[]}}function xd(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:P0(r)}}}function P0(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const zc=[];function Sd(r,i){return{subscribe:kn(r,i).subscribe}}function kn(r,i=Ht){let n;const a=new Set;function u(o){if(ti(r,o)&&(r=o,n)){const _=!zc.length;for(const S of a)S[1](),zc.push(S,r);if(_){for(let S=0;S<zc.length;S+=2)zc[S][0](zc[S+1]);zc.length=0}}}function d(o){u(o(r))}function f(o,_=Ht){const S=[o,_];return a.add(S),a.size===1&&(n=i(u,d)||Ht),o(r),()=>{a.delete(S),a.size===0&&n&&(n(),n=null)}}return{set:u,update:d,subscribe:f}}const L0=kn(M0()),z0=kn(0),Lw=100;class zw{constructor(i){Zn(this,"map");Zn(this,"active");Zn(this,"eventListenersSuccess");Zn(this,"eventListenersUpdated");Zn(this,"eventListenersFailure");Zn(this,"points");Zn(this,"cursor");Zn(this,"hover");Zn(this,"dragFrom");Zn(this,"previousStates");Zn(this,"onMouseMove",i=>{if(this.active&&!this.dragFrom)this.recalculateHovering(i);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-i.lngLat.lng,a=this.dragFrom[1]-i.lngLat.lat;for(let u of this.points)u[0]-=n,u[1]-=a}else this.points[this.hover]=i.lngLat.toArray();this.dragFrom=i.lngLat.toArray(),this.redraw()}});Zn(this,"onClick",i=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(wg(this.points).forEach((a,u)=>{n.push([u+1,Iw(a,this.cursor).properties.dist])}),n.sort((a,u)=>a[1]-u[1]),n.length>0){let a=n[0][0];this.points.splice(a,0,this.cursor.geometry.coordinates),this.hover=a}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(i))});Zn(this,"onDoubleClick",i=>{this.active&&(i.preventDefault(),this.cursor=xd(i.lngLat.toArray()),this.onClick(i),this.finish())});Zn(this,"onMouseDown",i=>{this.active&&!this.dragFrom&&this.hover!=null&&(i.preventDefault(),this.cursor=null,this.dragFrom=i.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Zn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Zn(this,"onKeypress",i=>{if(!this.active)return;let n=i.target.tagName;n=="INPUT"||n=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="z"&&i.ctrlKey&&this.undo())});Zn(this,"onKeyDown",i=>{if(!this.active)return;let n=i.target.tagName;n=="INPUT"||n=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())});this.map=i,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let i=this.polygonFeature();if(i)for(let n of this.eventListenersSuccess)n(i);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let i of this.eventListenersFailure)i();this.stop()}addEventListenerSuccess(i){this.eventListenersSuccess.push(i)}addEventListenerUpdated(i){this.eventListenersUpdated.push(i)}addEventListenerFailure(i){this.eventListenersFailure.push(i)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(i){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(i.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let i=M0();this.points.forEach((u,d)=>{let f=xd(u);f.properties.hover=this.hover==d,f.properties.idx=d,i.features.push(f)}),i.features=i.features.concat(wg(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",i.features.push(n)),L0.set(i);let a="crosshair";this.hover!=null&&(a=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=a,z0.set(this.previousStates.length)}pointsUpdated(){let i=this.polygonFeature();if(i)for(let n of this.eventListenersUpdated)n(i)}recalculateHovering(i){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(i.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=xd(i.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let i=this.points.map(P0),n=[JSON.parse(JSON.stringify(i))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Lw&&this.previousStates.shift()}}function wg(r){let i=[];for(let n=0;n<r.length-1;n++)i.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[n],r[n+1]]},properties:{}});return r.length>=3&&i.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),i}function Ow(r){let i,n,a;return{c(){i=Tt("Undo ("),n=Tt(r[1]),a=Tt(")")},m(u,d){xe(u,i,d),xe(u,n,d),xe(u,a,d)},p(u,d){d&2&&Ai(n,u[1])},d(u){u&&(we(i),we(n),we(a))}}}function Dw(r){let i;return{c(){i=Tt("Undo")},m(n,a){xe(n,i,a)},p:Ht,d(n){n&&we(i)}}}function Fw(r){let i,n,a,u,d,f,o,_,S,T,y;function k(L,B){return L[1]==0?Dw:Ow}let I=k(r),C=I(r);return{c(){i=ke("div"),n=ke("button"),n.textContent="Finish",a=Qe(),u=ke("button"),u.textContent="Cancel",d=Qe(),f=ke("button"),C.c(),_=Qe(),S=ke("ul"),S.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,f.disabled=o=r[1]==0,en(i,"display","flex"),en(i,"justify-content","space-between")},m(L,B){xe(L,i,B),be(i,n),be(i,a),be(i,u),be(i,d),be(i,f),C.m(f,null),xe(L,_,B),xe(L,S,B),T||(y=[Wt(n,"click",r[2]),Wt(u,"click",r[3]),Wt(f,"click",r[4])],T=!0)},p(L,[B]){I===(I=k(L))&&C?C.p(L,B):(C.d(1),C=I(L),C&&(C.c(),C.m(f,null))),B&2&&o!==(o=L[1]==0)&&(f.disabled=o)},i:Ht,o:Ht,d(L){L&&(we(i),we(_),we(S)),C.d(),T=!1,ir(y)}}}function Rw(r,i,n){let a;Gt(r,z0,_=>n(1,a=_));let{polygonTool:u}=i;const d=()=>u.finish(),f=()=>u.cancel(),o=()=>u.undo();return r.$$set=_=>{"polygonTool"in _&&n(0,u=_.polygonTool)},[u,a,d,f,o]}class Bw extends ui{constructor(i){super(),ci(this,i,Rw,Fw,ti,{polygonTool:0})}}let Nw=Date.now();function dh(r){return`${r}-${Nw++}`}const O0=Symbol.for("svelte-maplibre");function jw(){return $y(O0)}function xg(r){return{subscribe:r.subscribe}}function D0({key:r,setPopupTarget:i=!1,setCluster:n=!1,setMouseEvent:a=!1}){let u=jw(),d=kn(null),f=xg(d),o={...u,[r]:xg(d)};if(i&&(o.popupTarget=f),a){let _=kn(null);o.layerEvent=_,u.layerEvent=_}return n&&(o.cluster=kn()),$d(O0,o),{...u,self:d}}function Uw(){return D0({key:"source",setCluster:!0})}function Vw(r=!0){return D0({key:"layer",setPopupTarget:r,setMouseEvent:r})}var F0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,i){(function(n,a){r.exports=a()})(r0,function(){var n={},a={};function u(f,o,_){if(a[f]=_,f==="index"){var S="var sharedModule = {}; ("+a.shared+")(sharedModule); ("+a.worker+")(sharedModule);",T={};return a.shared(T),a.index(n,T),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([S],{type:"text/javascript"}))),n}}u("shared",["exports"],function(f){function o(s,t,l,h){return new(l||(l=Promise))(function(g,w){function x(D){try{M(h.next(D))}catch(V){w(V)}}function E(D){try{M(h.throw(D))}catch(V){w(V)}}function M(D){var V;D.done?g(D.value):(V=D.value,V instanceof l?V:new l(function(G){G(V)})).then(x,E)}M((h=h.apply(s,t||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var S=T;function T(s,t){this.x=s,this.y=t}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,t){return this.clone()._rotateAround(s,t)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var t=s.x-this.x,l=s.y-this.y;return t*t+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,t){return Math.atan2(this.x*t-this.y*s,this.x*s+this.y*t)},_matMult:function(s){var t=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=t,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var t=Math.cos(s),l=Math.sin(s),h=l*this.x+t*this.y;return this.x=t*this.x-l*this.y,this.y=h,this},_rotateAround:function(s,t){var l=Math.cos(s),h=Math.sin(s),g=t.y+h*(this.x-t.x)+l*(this.y-t.y);return this.x=t.x+l*(this.x-t.x)-h*(this.y-t.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(s){return s instanceof T?s:Array.isArray(s)?new T(s[0],s[1]):s};var y=_(S),k=I;function I(s,t,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=t,this.p2x=l,this.p2y=h}I.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,t){if(t===void 0&&(t=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<t)return l;var w=this.sampleCurveDerivativeX(l);if(Math.abs(w)<1e-6)break;l-=g/w}var x=0,E=1;for(l=s,h=0;h<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<t));h++)s>g?x=l:E=l,l=.5*(E-x)+x;return l},solve:function(s,t){return this.sampleCurveY(this.solveCurveX(s,t))}};var C=_(k);let L,B;function N(){return L==null&&(L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),L}function F(){if(B==null&&(B=!1,N())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let h=0;h<5*5;h++){const g=4*h;t.fillStyle=`rgb(${g},${g+1},${g+2})`,t.fillRect(h%5,Math.floor(h/5),1,1)}const l=t.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&l[h]!==h){B=!0;break}}}return B||!1}function W(s,t,l,h){const g=new C(s,t,l,h);return w=>g.solve(w)}const ee=W(.25,.1,.25,1);function oe(s,t,l){return Math.min(l,Math.max(t,s))}function $(s,t,l){const h=l-t,g=((s-t)%h+h)%h+t;return g===t?l:g}function re(s,...t){for(const l of t)for(const h in l)s[h]=l[h];return s}let j=1;function U(s,t,l){const h={};for(const g in s)h[g]=t.call(this,s[g],g,s);return h}function J(s,t,l){const h={};for(const g in s)t.call(this,s[g],g,s)&&(h[g]=s[g]);return h}function R(s){return Array.isArray(s)?s.map(R):typeof s=="object"&&s?U(s,R):s}const Z={};function ce(s){Z[s]||(typeof console<"u"&&console.warn(s),Z[s]=!0)}function fe(s,t,l){return(l.y-s.y)*(t.x-s.x)>(t.y-s.y)*(l.x-s.x)}function ge(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let ye=null;function he(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Me(s,t,l,h,g){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const E=x.startsWith("BGR"),M=new Uint8ClampedArray(h*g*4);if(yield w.copyTo(M,function(D,V,G,Q,ne){const le=4*Math.max(-V,0),pe=(Math.max(0,G)-G)*Q*4+le,Ce=4*Q,Pe=Math.max(0,V),tt=Math.max(0,G);return{rect:{x:Pe,y:tt,width:Math.min(D.width,V+Q)-Pe,height:Math.min(D.height,G+ne)-tt},layout:[{offset:pe,stride:Ce}]}}(s,t,l,h,g)),E)for(let D=0;D<M.length;D+=4){const V=M[D];M[D]=M[D+2],M[D+2]=V}return M}finally{w.close()}})}let lt,Ze;const ht="AbortError";function kt(){return new Error(ht)}const $e={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function vt(s){return $e.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const St="global-dispatcher";class Zt extends Error{constructor(t,l,h,g){super(`AJAXError: ${l} (${t}): ${h}`),this.status=t,this.statusText=l,this.url=h,this.body=g}}const oi=()=>ge(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Mi=function(s,t){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const h=vt(s.url);if(h)return h(s,t);if(ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:St},t)}if(!(/^file:/.test(l=s.url)||/^file:/.test(oi())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(h,g){return o(this,void 0,void 0,function*(){const w=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:oi(),signal:g.signal});h.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const D=yield x.blob();throw new Zt(x.status,x.statusText,h.url,D)}let E;E=h.type==="arrayBuffer"||h.type==="image"?x.arrayBuffer():h.type==="json"?x.json():x.text();const M=yield E;if(g.signal.aborted)throw kt();return{data:M,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,t);if(ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:St},t)}var l;return function(h,g){return new Promise((w,x)=>{var E;const M=new XMLHttpRequest;M.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(M.responseType="arraybuffer");for(const D in h.headers)M.setRequestHeader(D,h.headers[D]);h.type==="json"&&(M.responseType="text",!((E=h.headers)===null||E===void 0)&&E.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=h.credentials==="include",M.onerror=()=>{x(new Error(M.statusText))},M.onload=()=>{if(!g.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let D=M.response;if(h.type==="json")try{D=JSON.parse(M.response)}catch(V){return void x(V)}w({data:D,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const D=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});x(new Zt(M.status,M.statusText,h.url,D))}},g.signal.addEventListener("abort",()=>{M.abort(),x(kt())}),M.send(h.body)})}(s,t)};function Pi(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const t=new URL(s),l=window.location;return t.protocol===l.protocol&&t.host===l.host}function Ti(s,t,l){l[s]&&l[s].indexOf(t)!==-1||(l[s]=l[s]||[],l[s].push(t))}function At(s,t,l){if(l&&l[s]){const h=l[s].indexOf(t);h!==-1&&l[s].splice(h,1)}}class He{constructor(t,l={}){re(this,l),this.type=t}}class Pt extends He{constructor(t,l={}){super("error",re({error:t},l))}}class ni{on(t,l){return this._listeners=this._listeners||{},Ti(t,l,this._listeners),this}off(t,l){return At(t,l,this._listeners),At(t,l,this._oneTimeListeners),this}once(t,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ti(t,l,this._oneTimeListeners),this):new Promise(h=>this.once(t,h))}fire(t,l){typeof t=="string"&&(t=new He(t,l||{}));const h=t.type;if(this.listens(h)){t.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const E of g)E.call(this,t);const w=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const E of w)At(h,E,this._oneTimeListeners),E.call(this,t);const x=this._eventedParent;x&&(re(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof Pt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,l){return this._eventedParent=t,this._eventedParentData=l,this}}var Ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const gi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function pt(s,t){const l={};for(const h in s)h!=="ref"&&(l[h]=s[h]);return gi.forEach(h=>{h in t&&(l[h]=t[h])}),l}function it(s,t){if(Array.isArray(s)){if(!Array.isArray(t)||s.length!==t.length)return!1;for(let l=0;l<s.length;l++)if(!it(s[l],t[l]))return!1;return!0}if(typeof s=="object"&&s!==null&&t!==null){if(typeof t!="object"||Object.keys(s).length!==Object.keys(t).length)return!1;for(const l in s)if(!it(s[l],t[l]))return!1;return!0}return s===t}function ue(s,t){s.push(t)}function H(s,t,l){ue(l,{command:"addSource",args:[s,t[s]]})}function Y(s,t,l){ue(t,{command:"removeSource",args:[s]}),l[s]=!0}function Ie(s,t,l,h){Y(s,l,h),H(s,t,l)}function qe(s,t,l){let h;for(h in s[l])if(Object.prototype.hasOwnProperty.call(s[l],h)&&h!=="data"&&!it(s[l][h],t[l][h]))return!1;for(h in t[l])if(Object.prototype.hasOwnProperty.call(t[l],h)&&h!=="data"&&!it(s[l][h],t[l][h]))return!1;return!0}function ut(s,t,l,h,g,w){s=s||{},t=t||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(it(s[x],t[x])||l.push({command:w,args:[h,x,t[x],g]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(it(s[x],t[x])||l.push({command:w,args:[h,x,t[x],g]}))}function st(s){return s.id}function ki(s,t){return s[t.id]=t,s}class ct{constructor(t,l,h,g){this.message=(t?`${t}: `:"")+h,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function Vt(s,...t){for(const l of t)for(const h in l)s[h]=l[h];return s}class Ci extends Error{constructor(t,l){super(l),this.message=l,this.key=t}}class Fi{constructor(t,l=[]){this.parent=t,this.bindings={};for(const[h,g]of l)this.bindings[h]=g}concat(t){return new Fi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Cn={kind:"null"},xt={kind:"number"},li={kind:"string"},ii={kind:"boolean"},tn={kind:"color"},fr={kind:"object"},ai={kind:"value"},dr={kind:"collator"},pr={kind:"formatted"},Sr={kind:"padding"},Tr={kind:"resolvedImage"},Ae={kind:"variableAnchorOffsetCollection"};function te(s,t){return{kind:"array",itemType:s,N:t}}function ie(s){if(s.kind==="array"){const t=ie(s.itemType);return typeof s.N=="number"?`array<${t}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${t}>`}return s.kind}const de=[Cn,xt,li,ii,tn,pr,fr,te(ai),Sr,Tr,Ae];function Se(s,t){if(t.kind==="error")return null;if(s.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Se(s.itemType,t.itemType))&&(typeof s.N!="number"||s.N===t.N))return null}else{if(s.kind===t.kind)return null;if(s.kind==="value"){for(const l of de)if(!Se(l,t))return null}}return`Expected ${ie(s)} but found ${ie(t)} instead.`}function je(s,t){return t.some(l=>l.kind===s.kind)}function We(s,t){return t.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}function et(s,t){return s.kind==="array"&&t.kind==="array"?s.itemType.kind===t.itemType.kind&&typeof s.N=="number":s.kind===t.kind}const De=.96422,ot=.82521,mt=4/29,rt=6/29,Et=3*rt*rt,Yt=rt*rt*rt,ri=Math.PI/180,Ri=180/Math.PI;function bi(s){return(s%=360)<0&&(s+=360),s}function zi([s,t,l,h]){let g,w;const x=un((.2225045*(s=Si(s))+.7168786*(t=Si(t))+.0606169*(l=Si(l)))/1);s===t&&t===l?g=w=x:(g=un((.4360747*s+.3850649*t+.1430804*l)/De),w=un((.0139322*s+.0971045*t+.7141733*l)/ot));const E=116*x-16;return[E<0?0:E,500*(g-x),200*(x-w),h]}function Si(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function un(s){return s>Yt?Math.pow(s,1/3):s/Et+mt}function hn([s,t,l,h]){let g=(s+16)/116,w=isNaN(t)?g:g+t/500,x=isNaN(l)?g:g-l/200;return g=1*di(g),w=De*di(w),x=ot*di(x),[Xe(3.1338561*w-1.6168667*g-.4906146*x),Xe(-.9787684*w+1.9161415*g+.033454*x),Xe(.0719453*w-.2289914*g+1.4052427*x),h]}function Xe(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function di(s){return s>rt?s*s*s:Et*(s-mt)}function xi(s){return parseInt(s.padEnd(2,s),16)/255}function Bi(s,t){return Ki(t?s/100:s,0,1)}function Ki(s,t,l){return Math.min(Math.max(t,s),l)}function Ji(s){return!s.some(Number.isNaN)}const jn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class si{constructor(t,l,h,g=1,w=!0){this.r=t,this.g=l,this.b=h,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[t,l,h,g]))}static parse(t){if(t instanceof si)return t;if(typeof t!="string")return;const l=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=jn[h];if(g){const[x,E,M]=g;return[x/255,E/255,M/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const x=h.length<6?1:2;let E=1;return[xi(h.slice(E,E+=x)),xi(h.slice(E,E+=x)),xi(h.slice(E,E+=x)),xi(h.slice(E,E+x)||"ff")]}if(h.startsWith("rgb")){const x=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[E,M,D,V,G,Q,ne,le,pe,Ce,Pe,tt]=x,Ue=[V||" ",ne||" ",Ce].join("");if(Ue==="  "||Ue==="  /"||Ue===",,"||Ue===",,,"){const Je=[D,Q,pe].join(""),at=Je==="%%%"?100:Je===""?255:0;if(at){const wt=[Ki(+M/at,0,1),Ki(+G/at,0,1),Ki(+le/at,0,1),Pe?Bi(+Pe,tt):1];if(Ji(wt))return wt}}return}}const w=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,E,M,D,V,G,Q,ne,le]=w,pe=[M||" ",V||" ",Q].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const Ce=[+E,Ki(+D,0,100),Ki(+G,0,100),ne?Bi(+ne,le):1];if(Ji(Ce))return function([Pe,tt,Ue,Je]){function at(wt){const Bt=(wt+Pe/30)%12,hi=tt*Math.min(Ue,1-Ue);return Ue-hi*Math.max(-1,Math.min(Bt-3,9-Bt,1))}return Pe=bi(Pe),tt/=100,Ue/=100,[at(0),at(8),at(4),Je]}(Ce)}}}(t);return l?new si(...l,!1):void 0}get rgb(){const{r:t,g:l,b:h,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[t/w,l/w,h/w,g])}get hcl(){return this.overwriteGetter("hcl",function(t){const[l,h,g,w]=zi(t),x=Math.sqrt(h*h+g*g);return[Math.round(1e4*x)?bi(Math.atan2(g,h)*Ri):NaN,x,l,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zi(this.rgb))}overwriteGetter(t,l){return Object.defineProperty(this,t,{value:l}),l}toString(){const[t,l,h,g]=this.rgb;return`rgba(${[t,l,h].map(w=>Math.round(255*w)).join(",")},${g})`}}si.black=new si(0,0,0,1),si.white=new si(1,1,1,1),si.transparent=new si(0,0,0,0),si.red=new si(1,0,0,1);class Xr{constructor(t,l,h){this.sensitivity=t?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,l){return this.collator.compare(t,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gn{constructor(t,l,h,g,w){this.text=t,this.image=l,this.scale=h,this.fontStack=g,this.textColor=w}}class Un{constructor(t){this.sections=t}static fromString(t){return new Un([new Gn(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Un?t:Un.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class pn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof pn)return t;if(typeof t=="number")return new pn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const l of t)if(typeof l!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new pn(t)}}toString(){return JSON.stringify(this.values)}}const ma=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class zn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof zn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let l=0;l<t.length;l+=2){const h=t[l],g=t[l+1];if(typeof h!="string"||!ma.has(h)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new zn(t)}}toString(){return JSON.stringify(this.values)}}class Hn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Hn({name:t,available:!1}):null}}function Fr(s,t,l,h){return typeof s=="number"&&s>=0&&s<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[s,t,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[s,t,l,h]:[s,t,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rn(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof si||s instanceof Xr||s instanceof Un||s instanceof pn||s instanceof zn||s instanceof Hn)return!0;if(Array.isArray(s)){for(const t of s)if(!Rn(t))return!1;return!0}if(typeof s=="object"){for(const t in s)if(!Rn(s[t]))return!1;return!0}return!1}function Ei(s){if(s===null)return Cn;if(typeof s=="string")return li;if(typeof s=="boolean")return ii;if(typeof s=="number")return xt;if(s instanceof si)return tn;if(s instanceof Xr)return dr;if(s instanceof Un)return pr;if(s instanceof pn)return Sr;if(s instanceof zn)return Ae;if(s instanceof Hn)return Tr;if(Array.isArray(s)){const t=s.length;let l;for(const h of s){const g=Ei(h);if(l){if(l===g)continue;l=ai;break}l=g}return te(l||ai,t)}return fr}function No(s){const t=typeof s;return s===null?"":t==="string"||t==="number"||t==="boolean"?String(s):s instanceof si||s instanceof Un||s instanceof pn||s instanceof zn||s instanceof Hn?s.toString():JSON.stringify(s)}class nr{constructor(t,l){this.type=t,this.value=l}static parse(t,l){if(t.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Rn(t[1]))return l.error("invalid value");const h=t[1];let g=Ei(h);const w=l.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new nr(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class En{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ga={string:li,number:xt,boolean:ii,object:fr};class Rr{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let h,g=1;const w=t[0];if(w==="array"){let E,M;if(t.length>2){const D=t[1];if(typeof D!="string"||!(D in ga)||D==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);E=ga[D],g++}else E=ai;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=t[2],g++}h=te(E,M)}else{if(!ga[w])throw new Error(`Types doesn't contain name = ${w}`);h=ga[w]}const x=[];for(;g<t.length;g++){const E=l.parse(t[g],g,ai);if(!E)return null;x.push(E)}return new Rr(h,x)}evaluate(t){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(t);if(!Se(this.type,Ei(h)))return h;if(l===this.args.length-1)throw new En(`Expected value to be of type ${ie(this.type)}, but found ${ie(Ei(h))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const al={"to-boolean":ii,"to-color":tn,"to-number":xt,"to-string":li};class Br{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");const h=t[0];if(!al[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&t.length!==2)return l.error("Expected one argument.");const g=al[h],w=[];for(let x=1;x<t.length;x++){const E=l.parse(t[x],x,ai);if(!E)return null;w.push(E)}return new Br(g,w)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let l,h;for(const g of this.args){if(l=g.evaluate(t),h=null,l instanceof si)return l;if(typeof l=="string"){const w=t.parseColor(l);if(w)return w}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Fr(l[0],l[1],l[2],l[3]),!h))return new si(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new En(h||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const h of this.args){l=h.evaluate(t);const g=pn.parse(l);if(g)return g}throw new En(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const h of this.args){l=h.evaluate(t);const g=zn.parse(l);if(g)return g}throw new En(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const h of this.args){if(l=h.evaluate(t),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new En(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Un.fromString(No(this.args[0].evaluate(t)));case"resolvedImage":return Hn.fromString(No(this.args[0].evaluate(t)));default:return No(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const tu=["Unknown","Point","LineString","Polygon"];class _a{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?tu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let l=this._parseColorCache[t];return l||(l=this._parseColorCache[t]=si.parse(t)),l}}class Hs{constructor(t,l,h=[],g,w=new Fi,x=[]){this.registry=t,this.path=h,this.key=h.map(E=>`[${E}]`).join(""),this.scope=w,this.errors=x,this.expectedType=g,this._isConstant=l}parse(t,l,h,g,w={}){return l?this.concat(l,h,g)._parse(t,w):this._parse(t,w)}_parse(t,l){function h(g,w,x){return x==="assert"?new Rr(w,[g]):x==="coerce"?new Br(w,[g]):g}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=t[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let x=w.parse(t,this);if(!x)return null;if(this.expectedType){const E=this.expectedType,M=x.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||M.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(E.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(E,M))return null}else x=h(x,E,l.typeAnnotation||"coerce");else x=h(x,E,l.typeAnnotation||"coerce");else x=h(x,E,l.typeAnnotation||"coerce");else x=h(x,E,l.typeAnnotation||"assert")}if(!(x instanceof nr)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const E=new _a;try{x=new nr(x.type,x.evaluate(E))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,l,h){const g=typeof t=="number"?this.path.concat(t):this.path,w=h?this.scope.concat(h):this.scope;return new Hs(this.registry,this._isConstant,g,l||null,w,this.errors)}error(t,...l){const h=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ci(h,t))}checkSubtype(t,l){const h=Se(t,l);return h&&this.error(h),h}}class Bn{constructor(t,l){this.type=l.type,this.bindings=[].concat(t),this.result=l}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const l of this.bindings)t(l[1]);t(this.result)}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const h=[];for(let w=1;w<t.length-1;w+=2){const x=t[w];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",w);const E=l.parse(t[w+1],w+1);if(!E)return null;h.push([x,E])}const g=l.parse(t[t.length-1],t.length-1,l.expectedType,h);return g?new Bn(h,g):null}outputDefined(){return this.result.outputDefined()}}class Zi{constructor(t,l){this.type=l.type,this.name=t,this.boundExpression=l}static parse(t,l){if(t.length!==2||typeof t[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=t[1];return l.scope.has(h)?new Zi(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ya{constructor(t,l,h){this.type=t,this.index=l,this.input=h}static parse(t,l){if(t.length!==3)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=l.parse(t[1],1,xt),g=l.parse(t[2],2,te(l.expectedType||ai));return h&&g?new ya(g.type.itemType,h,g):null}evaluate(t){const l=this.index.evaluate(t),h=this.input.evaluate(t);if(l<0)throw new En(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new En(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new En(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ba{constructor(t,l){this.type=ii,this.needle=t,this.haystack=l}static parse(t,l){if(t.length!==3)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=l.parse(t[1],1,ai),g=l.parse(t[2],2,ai);return h&&g?je(h.type,[ii,li,xt,Cn,ai])?new ba(h,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ie(h.type)} instead`):null}evaluate(t){const l=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!h)return!1;if(!We(l,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${ie(Ei(l))} instead.`);if(!We(h,["string","array"]))throw new En(`Expected second argument to be of type array or string, but found ${ie(Ei(h))} instead.`);return h.indexOf(l)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class fo{constructor(t,l,h){this.type=xt,this.needle=t,this.haystack=l,this.fromIndex=h}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=l.parse(t[1],1,ai),g=l.parse(t[2],2,ai);if(!h||!g)return null;if(!je(h.type,[ii,li,xt,Cn,ai]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ie(h.type)} instead`);if(t.length===4){const w=l.parse(t[3],3,xt);return w?new fo(h,g,w):null}return new fo(h,g)}evaluate(t){const l=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!We(l,["boolean","string","number","null"]))throw new En(`Expected first argument to be of type boolean, string, number or null, but found ${ie(Ei(l))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(t)),We(h,["string"])){const w=h.indexOf(l,g);return w===-1?-1:[...h.slice(0,w)].length}if(We(h,["array"]))return h.indexOf(l,g);throw new En(`Expected second argument to be of type array or string, but found ${ie(Ei(h))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ll{constructor(t,l,h,g,w,x){this.inputType=t,this.type=l,this.input=h,this.cases=g,this.outputs=w,this.otherwise=x}static parse(t,l){if(t.length<5)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return l.error("Expected an even number of arguments.");let h,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const w={},x=[];for(let D=2;D<t.length-1;D+=2){let V=t[D];const G=t[D+1];Array.isArray(V)||(V=[V]);const Q=l.concat(D);if(V.length===0)return Q.error("Expected at least one branch label.");for(const le of V){if(typeof le!="number"&&typeof le!="string")return Q.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return Q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof le=="number"&&Math.floor(le)!==le)return Q.error("Numeric branch labels must be integer values.");if(h){if(Q.checkSubtype(h,Ei(le)))return null}else h=Ei(le);if(w[String(le)]!==void 0)return Q.error("Branch labels must be unique.");w[String(le)]=x.length}const ne=l.parse(G,D,g);if(!ne)return null;g=g||ne.type,x.push(ne)}const E=l.parse(t[1],1,ai);if(!E)return null;const M=l.parse(t[t.length-1],t.length-1,g);return M?E.type.kind!=="value"&&l.concat(1).checkSubtype(h,E.type)?null:new ll(h,g,E,w,x,M):null}evaluate(t){const l=this.input.evaluate(t);return(Ei(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class jo{constructor(t,l,h){this.type=t,this.branches=l,this.otherwise=h}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const g=[];for(let x=1;x<t.length-1;x+=2){const E=l.parse(t[x],x,ii);if(!E)return null;const M=l.parse(t[x+1],x+1,h);if(!M)return null;g.push([E,M]),h=h||M.type}const w=l.parse(t[t.length-1],t.length-1,h);if(!w)return null;if(!h)throw new Error("Can't infer output type");return new jo(h,g,w)}evaluate(t){for(const[l,h]of this.branches)if(l.evaluate(t))return h.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[l,h]of this.branches)t(l),t(h);t(this.otherwise)}outputDefined(){return this.branches.every(([t,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Is{constructor(t,l,h,g){this.type=t,this.input=l,this.beginIndex=h,this.endIndex=g}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=l.parse(t[1],1,ai),g=l.parse(t[2],2,xt);if(!h||!g)return null;if(!je(h.type,[te(ai),li,ai]))return l.error(`Expected first argument to be of type array or string, but found ${ie(h.type)} instead`);if(t.length===4){const w=l.parse(t[3],3,xt);return w?new Is(h.type,h,g,w):null}return new Is(h.type,h,g)}evaluate(t){const l=this.input.evaluate(t),h=this.beginIndex.evaluate(t);let g;if(this.endIndex&&(g=this.endIndex.evaluate(t)),We(l,["string"]))return[...l].slice(h,g).join("");if(We(l,["array"]))return l.slice(h,g);throw new En(`Expected first argument to be of type array or string, but found ${ie(Ei(l))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function va(s,t){const l=s.length-1;let h,g,w=0,x=l,E=0;for(;w<=x;)if(E=Math.floor((w+x)/2),h=s[E],g=s[E+1],h<=t){if(E===l||t<g)return E;w=E+1}else{if(!(h>t))throw new En("Input is not a number.");x=E-1}return 0}class po{constructor(t,l,h){this.type=t,this.input=l,this.labels=[],this.outputs=[];for(const[g,w]of h)this.labels.push(g),this.outputs.push(w)}static parse(t,l){if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(t[1],1,xt);if(!h)return null;const g=[];let w=null;l.expectedType&&l.expectedType.kind!=="value"&&(w=l.expectedType);for(let x=1;x<t.length;x+=2){const E=x===1?-1/0:t[x],M=t[x+1],D=x,V=x+1;if(typeof E!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=E)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const G=l.parse(M,V,w);if(!G)return null;w=w||G.type,g.push([E,G])}return new po(w,h,g)}evaluate(t){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(t);const g=this.input.evaluate(t);if(g<=l[0])return h[0].evaluate(t);const w=l.length;return g>=l[w-1]?h[w-1].evaluate(t):h[va(l,g)].evaluate(t)}eachChild(t){t(this.input);for(const l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function cl(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var iu=Zl;function Zl(s,t,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=t,this.p2x=l,this.p2y=h}Zl.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,t){if(t===void 0&&(t=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<t)return l;var w=this.sampleCurveDerivativeX(l);if(Math.abs(w)<1e-6)break;l-=g/w}var x=0,E=1;for(l=s,h=0;h<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<t));h++)s>g?x=l:E=l,l=.5*(E-x)+x;return l},solve:function(s,t){return this.sampleCurveY(this.solveCurveX(s,t))}};var Wl=cl(iu);function As(s,t,l){return s+l*(t-s)}function mo(s,t,l){return s.map((h,g)=>As(h,t[g],l))}const Vn={number:As,color:function(s,t,l,h="rgb"){switch(h){case"rgb":{const[g,w,x,E]=mo(s.rgb,t.rgb,l);return new si(g,w,x,E,!1)}case"hcl":{const[g,w,x,E]=s.hcl,[M,D,V,G]=t.hcl;let Q,ne;if(isNaN(g)||isNaN(M))isNaN(g)?isNaN(M)?Q=NaN:(Q=M,x!==1&&x!==0||(ne=D)):(Q=g,V!==1&&V!==0||(ne=w));else{let tt=M-g;M>g&&tt>180?tt-=360:M<g&&g-M>180&&(tt+=360),Q=g+l*tt}const[le,pe,Ce,Pe]=function([tt,Ue,Je,at]){return tt=isNaN(tt)?0:tt*ri,hn([Je,Math.cos(tt)*Ue,Math.sin(tt)*Ue,at])}([Q,ne??As(w,D,l),As(x,V,l),As(E,G,l)]);return new si(le,pe,Ce,Pe,!1)}case"lab":{const[g,w,x,E]=hn(mo(s.lab,t.lab,l));return new si(g,w,x,E,!1)}}},array:mo,padding:function(s,t,l){return new pn(mo(s.values,t.values,l))},variableAnchorOffsetCollection:function(s,t,l){const h=s.values,g=t.values;if(h.length!==g.length)throw new En(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${t.toString()}`);const w=[];for(let x=0;x<h.length;x+=2){if(h[x]!==g[x])throw new En(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${h[x]}, to[${x}]: ${g[x]}`);w.push(h[x]);const[E,M]=h[x+1],[D,V]=g[x+1];w.push([As(E,D,l),As(M,V,l)])}return new zn(w)}};class Yn{constructor(t,l,h,g,w){this.type=t,this.operator=l,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[x,E]of w)this.labels.push(x),this.outputs.push(E)}static interpolationFactor(t,l,h,g){let w=0;if(t.name==="exponential")w=go(l,t.base,h,g);else if(t.name==="linear")w=go(l,1,h,g);else if(t.name==="cubic-bezier"){const x=t.controlPoints;w=new Wl(x[0],x[1],x[2],x[3]).solve(go(l,1,h,g))}return w}static parse(t,l){let[h,g,w,...x]=t;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some(V=>typeof V!="number"||V<0||V>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(w=l.parse(w,2,xt),!w)return null;const E=[];let M=null;h==="interpolate-hcl"||h==="interpolate-lab"?M=tn:l.expectedType&&l.expectedType.kind!=="value"&&(M=l.expectedType);for(let D=0;D<x.length;D+=2){const V=x[D],G=x[D+1],Q=D+3,ne=D+4;if(typeof V!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Q);if(E.length&&E[E.length-1][0]>=V)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Q);const le=l.parse(G,ne,M);if(!le)return null;M=M||le.type,E.push([V,le])}return et(M,xt)||et(M,tn)||et(M,Sr)||et(M,Ae)||et(M,te(xt))?new Yn(M,h,g,w,E):l.error(`Type ${ie(M)} is not interpolatable.`)}evaluate(t){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(t);const g=this.input.evaluate(t);if(g<=l[0])return h[0].evaluate(t);const w=l.length;if(g>=l[w-1])return h[w-1].evaluate(t);const x=va(l,g),E=Yn.interpolationFactor(this.interpolation,g,l[x],l[x+1]),M=h[x].evaluate(t),D=h[x+1].evaluate(t);switch(this.operator){case"interpolate":return Vn[this.type.kind](M,D,E);case"interpolate-hcl":return Vn.color(M,D,E,"hcl");case"interpolate-lab":return Vn.color(M,D,E,"lab")}}eachChild(t){t(this.input);for(const l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function go(s,t,l,h){const g=h-l,w=s-l;return g===0?0:t===1?w/g:(Math.pow(t,w)-1)/(Math.pow(t,g)-1)}class Qn{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expectected at least one argument.");let h=null;const g=l.expectedType;g&&g.kind!=="value"&&(h=g);const w=[];for(const E of t.slice(1)){const M=l.parse(E,1+w.length,h,void 0,{typeAnnotation:"omit"});if(!M)return null;h=h||M.type,w.push(M)}if(!h)throw new Error("No output type");const x=g&&w.some(E=>Se(g,E.type));return new Qn(x?ai:h,w)}evaluate(t){let l,h=null,g=0;for(const w of this.args)if(g++,h=w.evaluate(t),h&&h instanceof Hn&&!h.available&&(l||(l=h.name),h=null,g===this.args.length&&(h=l)),h!==null)break;return h}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function wa(s,t){return s==="=="||s==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Gl(s,t,l,h){return h.compare(t,l)===0}function Xs(s,t,l){const h=s!=="=="&&s!=="!=";return class R0{constructor(w,x,E){this.type=ii,this.lhs=w,this.rhs=x,this.collator=E,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const E=w[0];let M=x.parse(w[1],1,ai);if(!M)return null;if(!wa(E,M.type))return x.concat(1).error(`"${E}" comparisons are not supported for type '${ie(M.type)}'.`);let D=x.parse(w[2],2,ai);if(!D)return null;if(!wa(E,D.type))return x.concat(2).error(`"${E}" comparisons are not supported for type '${ie(D.type)}'.`);if(M.type.kind!==D.type.kind&&M.type.kind!=="value"&&D.type.kind!=="value")return x.error(`Cannot compare types '${ie(M.type)}' and '${ie(D.type)}'.`);h&&(M.type.kind==="value"&&D.type.kind!=="value"?M=new Rr(D.type,[M]):M.type.kind!=="value"&&D.type.kind==="value"&&(D=new Rr(M.type,[D])));let V=null;if(w.length===4){if(M.type.kind!=="string"&&D.type.kind!=="string"&&M.type.kind!=="value"&&D.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(V=x.parse(w[3],3,dr),!V)return null}return new R0(M,D,V)}evaluate(w){const x=this.lhs.evaluate(w),E=this.rhs.evaluate(w);if(h&&this.hasUntypedArgument){const M=Ei(x),D=Ei(E);if(M.kind!==D.kind||M.kind!=="string"&&M.kind!=="number")throw new En(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${M.kind}, ${D.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const M=Ei(x),D=Ei(E);if(M.kind!=="string"||D.kind!=="string")return t(w,x,E)}return this.collator?l(w,x,E,this.collator.evaluate(w)):t(w,x,E)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Hl=Xs("==",function(s,t,l){return t===l},Gl),Xl=Xs("!=",function(s,t,l){return t!==l},function(s,t,l,h){return!Gl(0,t,l,h)}),Kl=Xs("<",function(s,t,l){return t<l},function(s,t,l,h){return h.compare(t,l)<0}),nu=Xs(">",function(s,t,l){return t>l},function(s,t,l,h){return h.compare(t,l)>0}),ru=Xs("<=",function(s,t,l){return t<=l},function(s,t,l,h){return h.compare(t,l)<=0}),Jl=Xs(">=",function(s,t,l){return t>=l},function(s,t,l,h){return h.compare(t,l)>=0});class Uo{constructor(t,l,h){this.type=dr,this.locale=h,this.caseSensitive=t,this.diacriticSensitive=l}static parse(t,l){if(t.length!==2)return l.error("Expected one argument.");const h=t[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const g=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,ii);if(!g)return null;const w=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,ii);if(!w)return null;let x=null;return h.locale&&(x=l.parse(h.locale,1,li),!x)?null:new Uo(g,w,x)}evaluate(t){return new Xr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class xa{constructor(t,l,h,g,w){this.type=li,this.number=t,this.locale=l,this.currency=h,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(t,l){if(t.length!==3)return l.error("Expected two arguments.");const h=l.parse(t[1],1,xt);if(!h)return null;const g=t[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=l.parse(g.locale,1,li),!w))return null;let x=null;if(g.currency&&(x=l.parse(g.currency,1,li),!x))return null;let E=null;if(g["min-fraction-digits"]&&(E=l.parse(g["min-fraction-digits"],1,xt),!E))return null;let M=null;return g["max-fraction-digits"]&&(M=l.parse(g["max-fraction-digits"],1,xt),!M)?null:new xa(h,w,x,E,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Vo{constructor(t){this.type=pr,this.sections=t}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");const h=t[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const g=[];let w=!1;for(let x=1;x<=t.length-1;++x){const E=t[x];if(w&&typeof E=="object"&&!Array.isArray(E)){w=!1;let M=null;if(E["font-scale"]&&(M=l.parse(E["font-scale"],1,xt),!M))return null;let D=null;if(E["text-font"]&&(D=l.parse(E["text-font"],1,te(li)),!D))return null;let V=null;if(E["text-color"]&&(V=l.parse(E["text-color"],1,tn),!V))return null;const G=g[g.length-1];G.scale=M,G.font=D,G.textColor=V}else{const M=l.parse(t[x],1,ai);if(!M)return null;const D=M.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:M,scale:null,font:null,textColor:null})}}return new Vo(g)}evaluate(t){return new Un(this.sections.map(l=>{const h=l.content.evaluate(t);return Ei(h)===Tr?new Gn("",h,null,null,null):new Gn(No(h),null,l.scale?l.scale.evaluate(t):null,l.font?l.font.evaluate(t).join(","):null,l.textColor?l.textColor.evaluate(t):null)}))}eachChild(t){for(const l of this.sections)t(l.content),l.scale&&t(l.scale),l.font&&t(l.font),l.textColor&&t(l.textColor)}outputDefined(){return!1}}class qo{constructor(t){this.type=Tr,this.input=t}static parse(t,l){if(t.length!==2)return l.error("Expected two arguments.");const h=l.parse(t[1],1,li);return h?new qo(h):l.error("No image name provided.")}evaluate(t){const l=this.input.evaluate(t),h=Hn.fromString(l);return h&&t.availableImages&&(h.available=t.availableImages.indexOf(l)>-1),h}eachChild(t){t(this.input)}outputDefined(){return!1}}class ul{constructor(t){this.type=xt,this.input=t}static parse(t,l){if(t.length!==2)return l.error(`Expected 1 argument, but found ${t.length-1} instead.`);const h=l.parse(t[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${ie(h.type)} instead.`):new ul(h):null}evaluate(t){const l=this.input.evaluate(t);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new En(`Expected value to be of type string or array, but found ${ie(Ei(l))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Kr=8192;function Ks(s,t){const l=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,t.z);return[Math.round(l*g*Kr),Math.round(h*g*Kr)]}function Nr(s,t){const l=Math.pow(2,t.z);return[(g=(s[0]/Kr+t.x)/l,360*g-180),(h=(s[1]/Kr+t.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,g}function Ms(s,t){s[0]=Math.min(s[0],t[0]),s[1]=Math.min(s[1],t[1]),s[2]=Math.max(s[2],t[0]),s[3]=Math.max(s[3],t[1])}function Ps(s,t){return!(s[0]<=t[0]||s[2]>=t[2]||s[1]<=t[1]||s[3]>=t[3])}function Gi(s,t,l){const h=s[0]-t[0],g=s[1]-t[1],w=s[0]-l[0],x=s[1]-l[1];return h*x-w*g==0&&h*w<=0&&g*x<=0}function Zo(s,t,l,h){return(g=[h[0]-l[0],h[1]-l[1]])[0]*(w=[t[0]-s[0],t[1]-s[1]])[1]-g[1]*w[0]!=0&&!(!hl(s,t,l,h)||!hl(l,h,s,t));var g,w}function Yl(s,t,l){for(const h of l)for(let g=0;g<h.length-1;++g)if(Zo(s,t,h[g],h[g+1]))return!0;return!1}function Js(s,t,l=!1){let h=!1;for(const E of t)for(let M=0;M<E.length-1;M++){if(Gi(s,E[M],E[M+1]))return l;(w=E[M])[1]>(g=s)[1]!=(x=E[M+1])[1]>g[1]&&g[0]<(x[0]-w[0])*(g[1]-w[1])/(x[1]-w[1])+w[0]&&(h=!h)}var g,w,x;return h}function su(s,t){for(const l of t)if(Js(s,l))return!0;return!1}function Ql(s,t){for(const l of s)if(!Js(l,t))return!1;for(let l=0;l<s.length-1;++l)if(Yl(s[l],s[l+1],t))return!1;return!0}function ou(s,t){for(const l of t)if(Ql(s,l))return!0;return!1}function hl(s,t,l,h){const g=h[0]-l[0],w=h[1]-l[1],x=(s[0]-l[0])*w-g*(s[1]-l[1]),E=(t[0]-l[0])*w-g*(t[1]-l[1]);return x>0&&E<0||x<0&&E>0}function Sa(s,t,l){const h=[];for(let g=0;g<s.length;g++){const w=[];for(let x=0;x<s[g].length;x++){const E=Ks(s[g][x],l);Ms(t,E),w.push(E)}h.push(w)}return h}function $l(s,t,l){const h=[];for(let g=0;g<s.length;g++){const w=Sa(s[g],t,l);h.push(w)}return h}function ec(s,t,l,h){if(s[0]<l[0]||s[0]>l[2]){const g=.5*h;let w=s[0]-l[0]>g?-h:l[0]-s[0]>g?h:0;w===0&&(w=s[0]-l[2]>g?-h:l[2]-s[0]>g?h:0),s[0]+=w}Ms(t,s)}function tc(s,t,l,h){const g=Math.pow(2,h.z)*Kr,w=[h.x*Kr,h.y*Kr],x=[];for(const E of s)for(const M of E){const D=[M.x+w[0],M.y+w[1]];ec(D,t,l,g),x.push(D)}return x}function ic(s,t,l,h){const g=Math.pow(2,h.z)*Kr,w=[h.x*Kr,h.y*Kr],x=[];for(const M of s){const D=[];for(const V of M){const G=[V.x+w[0],V.y+w[1]];Ms(t,G),D.push(G)}x.push(D)}if(t[2]-t[0]<=g/2){(E=t)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const M of x)for(const D of M)ec(D,t,l,g)}var E;return x}class Ys{constructor(t,l){this.type=ii,this.geojson=t,this.geometries=l}static parse(t,l){if(t.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Rn(t[1])){const h=t[1];if(h.type==="FeatureCollection"){const g=[];for(const w of h.features){const{type:x,coordinates:E}=w.geometry;x==="Polygon"&&g.push(E),x==="MultiPolygon"&&g.push(...E)}if(g.length)return new Ys(h,{type:"MultiPolygon",coordinates:g})}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ys(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Ys(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(l,h){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(h.type==="Polygon"){const E=Sa(h.coordinates,w,x),M=tc(l.geometry(),g,w,x);if(!Ps(g,w))return!1;for(const D of M)if(!Js(D,E))return!1}if(h.type==="MultiPolygon"){const E=$l(h.coordinates,w,x),M=tc(l.geometry(),g,w,x);if(!Ps(g,w))return!1;for(const D of M)if(!su(D,E))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(l,h){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(h.type==="Polygon"){const E=Sa(h.coordinates,w,x),M=ic(l.geometry(),g,w,x);if(!Ps(g,w))return!1;for(const D of M)if(!Ql(D,E))return!1}if(h.type==="MultiPolygon"){const E=$l(h.coordinates,w,x),M=ic(l.geometry(),g,w,x);if(!Ps(g,w))return!1;for(const D of M)if(!ou(D,E))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Jr=class{constructor(s=[],t=(l,h)=>l<h?-1:l>h?1:0){if(this.data=s,this.length=this.data.length,this.compare=t,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:t,compare:l}=this,h=t[s];for(;s>0;){const g=s-1>>1,w=t[g];if(l(h,w)>=0)break;t[s]=w,s=g}t[s]=h}_down(s){const{data:t,compare:l}=this,h=this.length>>1,g=t[s];for(;s<h;){let w=1+(s<<1);const x=w+1;if(x<this.length&&l(t[x],t[w])<0&&(w=x),l(t[w],g)>=0)break;t[s]=t[w],s=w}t[s]=g}};function nc(s,t,l,h,g){rc(s,t,l,h||s.length-1,g||au)}function rc(s,t,l,h,g){for(;h>l;){if(h-l>600){var w=h-l+1,x=t-l+1,E=Math.log(w),M=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*M*(w-M)/w)*(x-w/2<0?-1:1);rc(s,t,Math.max(l,Math.floor(t-x*M/w+D)),Math.min(h,Math.floor(t+(w-x)*M/w+D)),g)}var V=s[t],G=l,Q=h;for(Wo(s,l,t),g(s[h],V)>0&&Wo(s,l,h);G<Q;){for(Wo(s,G,Q),G++,Q--;g(s[G],V)<0;)G++;for(;g(s[Q],V)>0;)Q--}g(s[l],V)===0?Wo(s,l,Q):Wo(s,++Q,h),Q<=t&&(l=Q+1),t<=Q&&(h=Q-1)}}function Wo(s,t,l){var h=s[t];s[t]=s[l],s[l]=h}function au(s,t){return s<t?-1:s>t?1:0}function Ta(s,t){if(s.length<=1)return[s];const l=[];let h,g;for(const w of s){const x=cu(w);x!==0&&(w.area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(h&&l.push(h),h=[w]):h.push(w))}if(h&&l.push(h),t>1)for(let w=0;w<l.length;w++)l[w].length<=t||(nc(l[w],t,1,l[w].length-1,lu),l[w]=l[w].slice(0,t));return l}function lu(s,t){return t.area-s.area}function cu(s){let t=0;for(let l,h,g=0,w=s.length,x=w-1;g<w;x=g++)l=s[g],h=s[x],t+=(h.x-l.x)*(l.y+h.y);return t}const sc=1/298.257223563,oc=sc*(2-sc),ka=Math.PI/180;class _o{constructor(t){const l=6378.137*ka*1e3,h=Math.cos(t*ka),g=1/(1-oc*(1-h*h)),w=Math.sqrt(g);this.kx=l*w*h,this.ky=l*w*g*(1-oc)}distance(t,l){const h=this.wrap(t[0]-l[0])*this.kx,g=(t[1]-l[1])*this.ky;return Math.sqrt(h*h+g*g)}pointOnLine(t,l){let h,g,w,x,E=1/0;for(let M=0;M<t.length-1;M++){let D=t[M][0],V=t[M][1],G=this.wrap(t[M+1][0]-D)*this.kx,Q=(t[M+1][1]-V)*this.ky,ne=0;G===0&&Q===0||(ne=(this.wrap(l[0]-D)*this.kx*G+(l[1]-V)*this.ky*Q)/(G*G+Q*Q),ne>1?(D=t[M+1][0],V=t[M+1][1]):ne>0&&(D+=G/this.kx*ne,V+=Q/this.ky*ne)),G=this.wrap(l[0]-D)*this.kx,Q=(l[1]-V)*this.ky;const le=G*G+Q*Q;le<E&&(E=le,h=D,g=V,w=M,x=ne)}return{point:[h,g],index:w,t:Math.max(0,Math.min(1,x))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function ac(s,t){return t[0]-s[0]}function Go(s){return s[1]-s[0]+1}function Yr(s,t){return s[1]>=s[0]&&s[1]<t}function Qs(s,t){if(s[0]>s[1])return[null,null];const l=Go(s);if(t){if(l===2)return[s,null];const g=Math.floor(l/2);return[[s[0],s[0]+g],[s[0]+g,s[1]]]}if(l===1)return[s,null];const h=Math.floor(l/2)-1;return[[s[0],s[0]+h],[s[0]+h+1,s[1]]]}function Ho(s,t){if(!Yr(t,s.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let h=t[0];h<=t[1];++h)Ms(l,s[h]);return l}function Xo(s){const t=[1/0,1/0,-1/0,-1/0];for(const l of s)for(const h of l)Ms(t,h);return t}function Ca(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function fl(s,t,l){if(!Ca(s)||!Ca(t))return NaN;let h=0,g=0;return s[2]<t[0]&&(h=t[0]-s[2]),s[0]>t[2]&&(h=s[0]-t[2]),s[1]>t[3]&&(g=s[1]-t[3]),s[3]<t[1]&&(g=t[1]-s[3]),l.distance([0,0],[h,g])}function $s(s,t,l){const h=l.pointOnLine(t,s);return l.distance(s,h.point)}function fs(s,t,l,h,g){const w=Math.min($s(s,[l,h],g),$s(t,[l,h],g)),x=Math.min($s(l,[s,t],g),$s(h,[s,t],g));return Math.min(w,x)}function uu(s,t,l,h,g){if(!Yr(t,s.length)||!Yr(h,l.length))return 1/0;let w=1/0;for(let x=t[0];x<t[1];++x){const E=s[x],M=s[x+1];for(let D=h[0];D<h[1];++D){const V=l[D],G=l[D+1];if(Zo(E,M,V,G))return 0;w=Math.min(w,fs(E,M,V,G,g))}}return w}function Tn(s,t,l,h,g){if(!Yr(t,s.length)||!Yr(h,l.length))return NaN;let w=1/0;for(let x=t[0];x<=t[1];++x)for(let E=h[0];E<=h[1];++E)if(w=Math.min(w,g.distance(s[x],l[E])),w===0)return w;return w}function hu(s,t,l){if(Js(s,t,!0))return 0;let h=1/0;for(const g of t){const w=g[0],x=g[g.length-1];if(w!==x&&(h=Math.min(h,$s(s,[x,w],l)),h===0))return h;const E=l.pointOnLine(g,s);if(h=Math.min(h,l.distance(s,E.point)),h===0)return h}return h}function Li(s,t,l,h){if(!Yr(t,s.length))return NaN;for(let w=t[0];w<=t[1];++w)if(Js(s[w],l,!0))return 0;let g=1/0;for(let w=t[0];w<t[1];++w){const x=s[w],E=s[w+1];for(const M of l)for(let D=0,V=M.length,G=V-1;D<V;G=D++){const Q=M[G],ne=M[D];if(Zo(x,E,Q,ne))return 0;g=Math.min(g,fs(x,E,Q,ne,h))}}return g}function eo(s,t){for(const l of s)for(const h of l)if(Js(h,t,!0))return!0;return!1}function Qi(s,t,l,h=1/0){const g=Xo(s),w=Xo(t);if(h!==1/0&&fl(g,w,l)>=h)return h;if(Ps(g,w)){if(eo(s,t))return 0}else if(eo(t,s))return 0;let x=1/0;for(const E of s)for(let M=0,D=E.length,V=D-1;M<D;V=M++){const G=E[V],Q=E[M];for(const ne of t)for(let le=0,pe=ne.length,Ce=pe-1;le<pe;Ce=le++){const Pe=ne[Ce],tt=ne[le];if(Zo(G,Q,Pe,tt))return 0;x=Math.min(x,fs(G,Q,Pe,tt,l))}}return x}function $i(s,t,l,h,g,w){if(!w)return;const x=fl(Ho(h,w),g,l);x<t&&s.push([x,w,[0,0]])}function Ls(s,t,l,h,g,w,x){if(!w||!x)return;const E=fl(Ho(h,w),Ho(g,x),l);E<t&&s.push([E,w,x])}function Ko(s,t,l,h,g=1/0){let w=Math.min(h.distance(s[0],l[0][0]),g);if(w===0)return w;const x=new Jr([[0,[0,s.length-1],[0,0]]],ac),E=Xo(l);for(;x.length>0;){const M=x.pop();if(M[0]>=w)continue;const D=M[1],V=t?50:100;if(Go(D)<=V){if(!Yr(D,s.length))return NaN;if(t){const G=Li(s,D,l,h);if(isNaN(G)||G===0)return G;w=Math.min(w,G)}else for(let G=D[0];G<=D[1];++G){const Q=hu(s[G],l,h);if(w=Math.min(w,Q),w===0)return 0}}else{const G=Qs(D,t);$i(x,w,h,s,E,G[0]),$i(x,w,h,s,E,G[1])}}return w}function Qr(s,t,l,h,g,w=1/0){let x=Math.min(w,g.distance(s[0],l[0]));if(x===0)return x;const E=new Jr([[0,[0,s.length-1],[0,l.length-1]]],ac);for(;E.length>0;){const M=E.pop();if(M[0]>=x)continue;const D=M[1],V=M[2],G=t?50:100,Q=h?50:100;if(Go(D)<=G&&Go(V)<=Q){if(!Yr(D,s.length)&&Yr(V,l.length))return NaN;let ne;if(t&&h)ne=uu(s,D,l,V,g),x=Math.min(x,ne);else if(t&&!h){const le=s.slice(D[0],D[1]+1);for(let pe=V[0];pe<=V[1];++pe)if(ne=$s(l[pe],le,g),x=Math.min(x,ne),x===0)return x}else if(!t&&h){const le=l.slice(V[0],V[1]+1);for(let pe=D[0];pe<=D[1];++pe)if(ne=$s(s[pe],le,g),x=Math.min(x,ne),x===0)return x}else ne=Tn(s,D,l,V,g),x=Math.min(x,ne)}else{const ne=Qs(D,t),le=Qs(V,h);Ls(E,x,g,s,l,ne[0],le[0]),Ls(E,x,g,s,l,ne[0],le[1]),Ls(E,x,g,s,l,ne[1],le[0]),Ls(E,x,g,s,l,ne[1],le[1])}}return x}function Jo(s){return s.type==="MultiPolygon"?s.coordinates.map(t=>({type:"Polygon",coordinates:t})):s.type==="MultiLineString"?s.coordinates.map(t=>({type:"LineString",coordinates:t})):s.type==="MultiPoint"?s.coordinates.map(t=>({type:"Point",coordinates:t})):[s]}class zs{constructor(t,l){this.type=xt,this.geojson=t,this.geometries=l}static parse(t,l){if(t.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Rn(t[1])){const h=t[1];if(h.type==="FeatureCollection")return new zs(h,h.features.map(g=>Jo(g.geometry)).flat());if(h.type==="Feature")return new zs(h,Jo(h.geometry));if("type"in h&&"coordinates"in h)return new zs(h,Jo(h))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(l,h){const g=l.geometry(),w=g.flat().map(M=>Nr([M.x,M.y],l.canonical));if(g.length===0)return NaN;const x=new _o(w[0][1]);let E=1/0;for(const M of h){switch(M.type){case"Point":E=Math.min(E,Qr(w,!1,[M.coordinates],!1,x,E));break;case"LineString":E=Math.min(E,Qr(w,!1,M.coordinates,!0,x,E));break;case"Polygon":E=Math.min(E,Ko(w,!1,M.coordinates,x,E))}if(E===0)return E}return E}(t,this.geometries);if(t.geometryType()==="LineString")return function(l,h){const g=l.geometry(),w=g.flat().map(M=>Nr([M.x,M.y],l.canonical));if(g.length===0)return NaN;const x=new _o(w[0][1]);let E=1/0;for(const M of h){switch(M.type){case"Point":E=Math.min(E,Qr(w,!0,[M.coordinates],!1,x,E));break;case"LineString":E=Math.min(E,Qr(w,!0,M.coordinates,!0,x,E));break;case"Polygon":E=Math.min(E,Ko(w,!0,M.coordinates,x,E))}if(E===0)return E}return E}(t,this.geometries);if(t.geometryType()==="Polygon")return function(l,h){const g=l.geometry();if(g.length===0||g[0].length===0)return NaN;const w=Ta(g,0).map(M=>M.map(D=>D.map(V=>Nr([V.x,V.y],l.canonical)))),x=new _o(w[0][0][0][1]);let E=1/0;for(const M of h)for(const D of w){switch(M.type){case"Point":E=Math.min(E,Ko([M.coordinates],!1,D,x,E));break;case"LineString":E=Math.min(E,Ko(M.coordinates,!0,D,x,E));break;case"Polygon":E=Math.min(E,Qi(D,M.coordinates,x,E))}if(E===0)return E}return E}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const yo={"==":Hl,"!=":Xl,">":nu,"<":Kl,">=":Jl,"<=":ru,array:Rr,at:ya,boolean:Rr,case:jo,coalesce:Qn,collator:Uo,format:Vo,image:qo,in:ba,"index-of":fo,interpolate:Yn,"interpolate-hcl":Yn,"interpolate-lab":Yn,length:ul,let:Bn,literal:nr,match:ll,number:Rr,"number-format":xa,object:Rr,slice:Is,step:po,string:Rr,"to-boolean":Br,"to-color":Br,"to-number":Br,"to-string":Br,var:Zi,within:Ys,distance:zs};class kr{constructor(t,l,h,g){this.name=t,this.type=l,this._evaluate=h,this.args=g}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,l){const h=t[0],g=kr.definitions[h];if(!g)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=x.filter(([D])=>!Array.isArray(D)||D.length===t.length-1);let M=null;for(const[D,V]of E){M=new Hs(l.registry,Yo,l.path,null,l.scope);const G=[];let Q=!1;for(let ne=1;ne<t.length;ne++){const le=t[ne],pe=Array.isArray(D)?D[ne-1]:D.type,Ce=M.parse(le,1+G.length,pe);if(!Ce){Q=!0;break}G.push(Ce)}if(!Q)if(Array.isArray(D)&&D.length!==G.length)M.error(`Expected ${D.length} arguments, but found ${G.length} instead.`);else{for(let ne=0;ne<G.length;ne++){const le=Array.isArray(D)?D[ne]:D.type,pe=G[ne];M.concat(ne+1).checkSubtype(le,pe.type)}if(M.errors.length===0)return new kr(h,w,V,G)}}if(E.length===1)l.errors.push(...M.errors);else{const D=(E.length?E:x).map(([G])=>{return Q=G,Array.isArray(Q)?`(${Q.map(ie).join(", ")})`:`(${ie(Q.type)}...)`;var Q}).join(" | "),V=[];for(let G=1;G<t.length;G++){const Q=l.parse(t[G],1+V.length);if(!Q)return null;V.push(ie(Q.type))}l.error(`Expected arguments of type ${D}, but found (${V.join(", ")}) instead.`)}return null}static register(t,l){kr.definitions=l;for(const h in l)t[h]=kr}}function dl(s,[t,l,h,g]){t=t.evaluate(s),l=l.evaluate(s),h=h.evaluate(s);const w=g?g.evaluate(s):1,x=Fr(t,l,h,w);if(x)throw new En(x);return new si(t/255,l/255,h/255,w,!1)}function to(s,t){return s in t}function ds(s,t){const l=t[s];return l===void 0?null:l}function io(s){return{type:s}}function Yo(s){if(s instanceof Zi)return Yo(s.boundExpression);if(s instanceof kr&&s.name==="error"||s instanceof Uo||s instanceof Ys||s instanceof zs)return!1;const t=s instanceof Br||s instanceof Rr;let l=!0;return s.eachChild(h=>{l=t?l&&Yo(h):l&&h instanceof nr}),!!l&&Qo(s)&&$o(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Qo(s){if(s instanceof kr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Ys||s instanceof zs)return!1;let t=!0;return s.eachChild(l=>{t&&!Qo(l)&&(t=!1)}),t}function bo(s){if(s instanceof kr&&s.name==="feature-state")return!1;let t=!0;return s.eachChild(l=>{t&&!bo(l)&&(t=!1)}),t}function $o(s,t){if(s instanceof kr&&t.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(h=>{l&&!$o(h,t)&&(l=!1)}),l}function Ea(s){return{result:"success",value:s}}function vo(s){return{result:"error",value:s}}function wo(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function pl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ml(s){return!!s.expression&&s.expression.interpolated}function qi(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function xo(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function lc(s){return s}function Os(s,t){const l=t.type==="color",h=s.stops&&typeof s.stops[0][0]=="object",g=h||!(h||s.property!==void 0),w=s.type||(ml(t)?"exponential":"interval");if(l||t.type==="padding"){const V=l?si.parse:pn.parse;(s=Vt({},s)).stops&&(s.stops=s.stops.map(G=>[G[0],V(G[1])])),s.default=V(s.default?s.default:t.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let E,M,D;if(w==="exponential")E=Aa;else if(w==="interval")E=ea;else if(w==="categorical"){E=Ia,M=Object.create(null);for(const V of s.stops)M[V[0]]=V[1];D=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);E=gl}if(h){const V={},G=[];for(let le=0;le<s.stops.length;le++){const pe=s.stops[le],Ce=pe[0].zoom;V[Ce]===void 0&&(V[Ce]={zoom:Ce,type:s.type,property:s.property,default:s.default,stops:[]},G.push(Ce)),V[Ce].stops.push([pe[0].value,pe[1]])}const Q=[];for(const le of G)Q.push([V[le].zoom,Os(V[le],t)]);const ne={name:"linear"};return{kind:"composite",interpolationType:ne,interpolationFactor:Yn.interpolationFactor.bind(void 0,ne),zoomStops:Q.map(le=>le[0]),evaluate:({zoom:le},pe)=>Aa({stops:Q,base:s.base},t,le).evaluate(le,pe)}}if(g){const V=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:V,interpolationFactor:Yn.interpolationFactor.bind(void 0,V),zoomStops:s.stops.map(G=>G[0]),evaluate:({zoom:G})=>E(s,t,G,M,D)}}return{kind:"source",evaluate(V,G){const Q=G&&G.properties?G.properties[s.property]:void 0;return Q===void 0?no(s.default,t.default):E(s,t,Q,M,D)}}}function no(s,t,l){return s!==void 0?s:t!==void 0?t:l!==void 0?l:void 0}function Ia(s,t,l,h,g){return no(typeof l===g?h[l]:void 0,s.default,t.default)}function ea(s,t,l){if(qi(l)!=="number")return no(s.default,t.default);const h=s.stops.length;if(h===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[h-1][0])return s.stops[h-1][1];const g=va(s.stops.map(w=>w[0]),l);return s.stops[g][1]}function Aa(s,t,l){const h=s.base!==void 0?s.base:1;if(qi(l)!=="number")return no(s.default,t.default);const g=s.stops.length;if(g===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[g-1][0])return s.stops[g-1][1];const w=va(s.stops.map(V=>V[0]),l),x=function(V,G,Q,ne){const le=ne-Q,pe=V-Q;return le===0?0:G===1?pe/le:(Math.pow(G,pe)-1)/(Math.pow(G,le)-1)}(l,h,s.stops[w][0],s.stops[w+1][0]),E=s.stops[w][1],M=s.stops[w+1][1],D=Vn[t.type]||lc;return typeof E.evaluate=="function"?{evaluate(...V){const G=E.evaluate.apply(void 0,V),Q=M.evaluate.apply(void 0,V);if(G!==void 0&&Q!==void 0)return D(G,Q,x,s.colorSpace)}}:D(E,M,x,s.colorSpace)}function gl(s,t,l){switch(t.type){case"color":l=si.parse(l);break;case"formatted":l=Un.fromString(l.toString());break;case"resolvedImage":l=Hn.fromString(l.toString());break;case"padding":l=pn.parse(l);break;default:qi(l)===t.type||t.type==="enum"&&t.values[l]||(l=void 0)}return no(l,s.default,t.default)}kr.register(yo,{error:[{kind:"error"},[li],(s,[t])=>{throw new En(t.evaluate(s))}],typeof:[li,[ai],(s,[t])=>ie(Ei(t.evaluate(s)))],"to-rgba":[te(xt,4),[tn],(s,[t])=>{const[l,h,g,w]=t.evaluate(s).rgb;return[255*l,255*h,255*g,w]}],rgb:[tn,[xt,xt,xt],dl],rgba:[tn,[xt,xt,xt,xt],dl],has:{type:ii,overloads:[[[li],(s,[t])=>to(t.evaluate(s),s.properties())],[[li,fr],(s,[t,l])=>to(t.evaluate(s),l.evaluate(s))]]},get:{type:ai,overloads:[[[li],(s,[t])=>ds(t.evaluate(s),s.properties())],[[li,fr],(s,[t,l])=>ds(t.evaluate(s),l.evaluate(s))]]},"feature-state":[ai,[li],(s,[t])=>ds(t.evaluate(s),s.featureState||{})],properties:[fr,[],s=>s.properties()],"geometry-type":[li,[],s=>s.geometryType()],id:[ai,[],s=>s.id()],zoom:[xt,[],s=>s.globals.zoom],"heatmap-density":[xt,[],s=>s.globals.heatmapDensity||0],"line-progress":[xt,[],s=>s.globals.lineProgress||0],accumulated:[ai,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[xt,io(xt),(s,t)=>{let l=0;for(const h of t)l+=h.evaluate(s);return l}],"*":[xt,io(xt),(s,t)=>{let l=1;for(const h of t)l*=h.evaluate(s);return l}],"-":{type:xt,overloads:[[[xt,xt],(s,[t,l])=>t.evaluate(s)-l.evaluate(s)],[[xt],(s,[t])=>-t.evaluate(s)]]},"/":[xt,[xt,xt],(s,[t,l])=>t.evaluate(s)/l.evaluate(s)],"%":[xt,[xt,xt],(s,[t,l])=>t.evaluate(s)%l.evaluate(s)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(s,[t,l])=>Math.pow(t.evaluate(s),l.evaluate(s))],sqrt:[xt,[xt],(s,[t])=>Math.sqrt(t.evaluate(s))],log10:[xt,[xt],(s,[t])=>Math.log(t.evaluate(s))/Math.LN10],ln:[xt,[xt],(s,[t])=>Math.log(t.evaluate(s))],log2:[xt,[xt],(s,[t])=>Math.log(t.evaluate(s))/Math.LN2],sin:[xt,[xt],(s,[t])=>Math.sin(t.evaluate(s))],cos:[xt,[xt],(s,[t])=>Math.cos(t.evaluate(s))],tan:[xt,[xt],(s,[t])=>Math.tan(t.evaluate(s))],asin:[xt,[xt],(s,[t])=>Math.asin(t.evaluate(s))],acos:[xt,[xt],(s,[t])=>Math.acos(t.evaluate(s))],atan:[xt,[xt],(s,[t])=>Math.atan(t.evaluate(s))],min:[xt,io(xt),(s,t)=>Math.min(...t.map(l=>l.evaluate(s)))],max:[xt,io(xt),(s,t)=>Math.max(...t.map(l=>l.evaluate(s)))],abs:[xt,[xt],(s,[t])=>Math.abs(t.evaluate(s))],round:[xt,[xt],(s,[t])=>{const l=t.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[xt,[xt],(s,[t])=>Math.floor(t.evaluate(s))],ceil:[xt,[xt],(s,[t])=>Math.ceil(t.evaluate(s))],"filter-==":[ii,[li,ai],(s,[t,l])=>s.properties()[t.value]===l.value],"filter-id-==":[ii,[ai],(s,[t])=>s.id()===t.value],"filter-type-==":[ii,[li],(s,[t])=>s.geometryType()===t.value],"filter-<":[ii,[li,ai],(s,[t,l])=>{const h=s.properties()[t.value],g=l.value;return typeof h==typeof g&&h<g}],"filter-id-<":[ii,[ai],(s,[t])=>{const l=s.id(),h=t.value;return typeof l==typeof h&&l<h}],"filter->":[ii,[li,ai],(s,[t,l])=>{const h=s.properties()[t.value],g=l.value;return typeof h==typeof g&&h>g}],"filter-id->":[ii,[ai],(s,[t])=>{const l=s.id(),h=t.value;return typeof l==typeof h&&l>h}],"filter-<=":[ii,[li,ai],(s,[t,l])=>{const h=s.properties()[t.value],g=l.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[ii,[ai],(s,[t])=>{const l=s.id(),h=t.value;return typeof l==typeof h&&l<=h}],"filter->=":[ii,[li,ai],(s,[t,l])=>{const h=s.properties()[t.value],g=l.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[ii,[ai],(s,[t])=>{const l=s.id(),h=t.value;return typeof l==typeof h&&l>=h}],"filter-has":[ii,[ai],(s,[t])=>t.value in s.properties()],"filter-has-id":[ii,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ii,[te(li)],(s,[t])=>t.value.indexOf(s.geometryType())>=0],"filter-id-in":[ii,[te(ai)],(s,[t])=>t.value.indexOf(s.id())>=0],"filter-in-small":[ii,[li,te(ai)],(s,[t,l])=>l.value.indexOf(s.properties()[t.value])>=0],"filter-in-large":[ii,[li,te(ai)],(s,[t,l])=>function(h,g,w,x){for(;w<=x;){const E=w+x>>1;if(g[E]===h)return!0;g[E]>h?x=E-1:w=E+1}return!1}(s.properties()[t.value],l.value,0,l.value.length-1)],all:{type:ii,overloads:[[[ii,ii],(s,[t,l])=>t.evaluate(s)&&l.evaluate(s)],[io(ii),(s,t)=>{for(const l of t)if(!l.evaluate(s))return!1;return!0}]]},any:{type:ii,overloads:[[[ii,ii],(s,[t,l])=>t.evaluate(s)||l.evaluate(s)],[io(ii),(s,t)=>{for(const l of t)if(l.evaluate(s))return!0;return!1}]]},"!":[ii,[ii],(s,[t])=>!t.evaluate(s)],"is-supported-script":[ii,[li],(s,[t])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(t.evaluate(s))}],upcase:[li,[li],(s,[t])=>t.evaluate(s).toUpperCase()],downcase:[li,[li],(s,[t])=>t.evaluate(s).toLowerCase()],concat:[li,io(ai),(s,t)=>t.map(l=>No(l.evaluate(s))).join("")],"resolved-locale":[li,[dr],(s,[t])=>t.evaluate(s).resolvedLocale()]});class So{constructor(t,l){var h;this.expression=t,this._warningHistory={},this._evaluator=new _a,this._defaultValue=l?(h=l).type==="color"&&xo(h.default)?new si(0,0,0,0):h.type==="color"?si.parse(h.default)||null:h.type==="padding"?pn.parse(h.default)||null:h.type==="variableAnchorOffsetCollection"?zn.parse(h.default)||null:h.default===void 0?null:h.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(t,l,h,g,w,x){return this._evaluator.globals=t,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,l,h,g,w,x){this._evaluator.globals=t,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new En(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Ma(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in yo}function Cr(s,t){const l=new Hs(yo,Yo,[],t?function(g){const w={color:tn,string:li,number:xt,enum:li,boolean:ii,formatted:pr,padding:Sr,resolvedImage:Tr,variableAnchorOffsetCollection:Ae};return g.type==="array"?te(w[g.value]||ai,g.length):w[g.type]}(t):void 0),h=l.parse(s,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Ea(new So(h,t)):vo(l.errors)}class mr{constructor(t,l){this.kind=t,this._styleExpression=l,this.isStateDependent=t!=="constant"&&!bo(l.expression)}evaluateWithoutErrorHandling(t,l,h,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(t,l,h,g,w,x)}evaluate(t,l,h,g,w,x){return this._styleExpression.evaluate(t,l,h,g,w,x)}}class To{constructor(t,l,h,g){this.kind=t,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=t!=="camera"&&!bo(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(t,l,h,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(t,l,h,g,w,x)}evaluate(t,l,h,g,w,x){return this._styleExpression.evaluate(t,l,h,g,w,x)}interpolationFactor(t,l,h){return this.interpolationType?Yn.interpolationFactor(this.interpolationType,t,l,h):0}}function _l(s,t){const l=Cr(s,t);if(l.result==="error")return l;const h=l.value.expression,g=Qo(h);if(!g&&!wo(t))return vo([new Ci("","data expressions not supported")]);const w=$o(h,["zoom"]);if(!w&&!pl(t))return vo([new Ci("","zoom expressions not supported")]);const x=ta(h);return x||w?x instanceof Ci?vo([x]):x instanceof Yn&&!ml(t)?vo([new Ci("",'"interpolate" expressions cannot be used with this property')]):Ea(x?new To(g?"camera":"composite",l.value,x.labels,x instanceof Yn?x.interpolation:void 0):new mr(g?"constant":"source",l.value)):vo([new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ko{constructor(t,l){this._parameters=t,this._specification=l,Vt(this,Os(this._parameters,this._specification))}static deserialize(t){return new ko(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ta(s){let t=null;if(s instanceof Bn)t=ta(s.result);else if(s instanceof Qn){for(const l of s.args)if(t=ta(l),t)break}else(s instanceof po||s instanceof Yn)&&s.input instanceof kr&&s.input.name==="zoom"&&(t=s);return t instanceof Ci||s.eachChild(l=>{const h=ta(l);h instanceof Ci?t=h:!t&&h?t=new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&h&&t!==h&&(t=new Ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Pa(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const t of s.slice(1))if(!Pa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const La={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function yl(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Pa(s)||(s=ro(s));const t=Cr(s,La);if(t.result==="error")throw new Error(t.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,h,g)=>t.value.evaluate(l,h,{},g),needGeometry:bl(s)}}function fu(s,t){return s<t?-1:s>t?1:0}function bl(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let t=1;t<s.length;t++)if(bl(s[t]))return!0;return!1}function ro(s){if(!s)return!0;const t=s[0];return s.length<=1?t!=="any":t==="=="?Co(s[1],s[2],"=="):t==="!="?Pn(Co(s[1],s[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Co(s[1],s[2],t):t==="any"?(l=s.slice(1),["any"].concat(l.map(ro))):t==="all"?["all"].concat(s.slice(1).map(ro)):t==="none"?["all"].concat(s.slice(1).map(ro).map(Pn)):t==="in"?ia(s[1],s.slice(2)):t==="!in"?Pn(ia(s[1],s.slice(2))):t==="has"?na(s[1]):t!=="!has"||Pn(na(s[1]));var l}function Co(s,t,l){switch(s){case"$type":return[`filter-type-${l}`,t];case"$id":return[`filter-id-${l}`,t];default:return[`filter-${l}`,s,t]}}function ia(s,t){if(t.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(l=>typeof l!=typeof t[0])?["filter-in-large",s,["literal",t.sort(fu)]]:["filter-in-small",s,["literal",t]]}}function na(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Pn(s){return["!",s]}function Be(s){const t=typeof s;if(t==="number"||t==="boolean"||t==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const w of s)g+=`${Be(w)},`;return`${g}]`}const l=Object.keys(s).sort();let h="{";for(let g=0;g<l.length;g++)h+=`${JSON.stringify(l[g])}:${Be(s[l[g]])},`;return`${h}}`}function O(s){let t="";for(const l of gi)t+=`/${Be(s[l])}`;return t}function se(s){const t=s.value;return t?[new ct(s.key,t,"constants have been deprecated as of v8")]:[]}function Oe(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function ft(s){if(Array.isArray(s))return s.map(ft);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const t={};for(const l in s)t[l]=ft(s[l]);return t}return Oe(s)}function It(s){const t=s.key,l=s.value,h=s.valueSpec||{},g=s.objectElementValidators||{},w=s.style,x=s.styleSpec,E=s.validateSpec;let M=[];const D=qi(l);if(D!=="object")return[new ct(t,l,`object expected, ${D} found`)];for(const V in l){const G=V.split(".")[0],Q=h[G]||h["*"];let ne;if(g[G])ne=g[G];else if(h[G])ne=E;else if(g["*"])ne=g["*"];else{if(!h["*"]){M.push(new ct(t,l[V],`unknown property "${V}"`));continue}ne=E}M=M.concat(ne({key:(t&&`${t}.`)+V,value:l[V],valueSpec:Q,style:w,styleSpec:x,object:l,objectKey:V,validateSpec:E},l))}for(const V in h)g[V]||h[V].required&&h[V].default===void 0&&l[V]===void 0&&M.push(new ct(t,l,`missing required property "${V}"`));return M}function Xt(s){const t=s.value,l=s.valueSpec,h=s.style,g=s.styleSpec,w=s.key,x=s.arrayElementValidator||s.validateSpec;if(qi(t)!=="array")return[new ct(w,t,`array expected, ${qi(t)} found`)];if(l.length&&t.length!==l.length)return[new ct(w,t,`array length ${l.length} expected, length ${t.length} found`)];if(l["min-length"]&&t.length<l["min-length"])return[new ct(w,t,`array length at least ${l["min-length"]} expected, length ${t.length} found`)];let E={type:l.value,values:l.values};g.$version<7&&(E.function=l.function),qi(l.value)==="object"&&(E=l.value);let M=[];for(let D=0;D<t.length;D++)M=M.concat(x({array:t,arrayIndex:D,value:t[D],valueSpec:E,validateSpec:s.validateSpec,style:h,styleSpec:g,key:`${w}[${D}]`}));return M}function Wi(s){const t=s.key,l=s.value,h=s.valueSpec;let g=qi(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new ct(t,l,`number expected, ${g} found`)]:"minimum"in h&&l<h.minimum?[new ct(t,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new ct(t,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function on(s){const t=s.valueSpec,l=Oe(s.value.type);let h,g,w,x={};const E=l!=="categorical"&&s.value.property===void 0,M=!E,D=qi(s.value.stops)==="array"&&qi(s.value.stops[0])==="array"&&qi(s.value.stops[0][0])==="object",V=It({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(ne){if(l==="identity")return[new ct(ne.key,ne.value,'identity function may not have a "stops" property')];let le=[];const pe=ne.value;return le=le.concat(Xt({key:ne.key,value:pe,valueSpec:ne.valueSpec,validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:G})),qi(pe)==="array"&&pe.length===0&&le.push(new ct(ne.key,pe,"array must have at least one stop")),le},default:function(ne){return ne.validateSpec({key:ne.key,value:ne.value,valueSpec:t,validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec})}}});return l==="identity"&&E&&V.push(new ct(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||V.push(new ct(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!ml(s.valueSpec)&&V.push(new ct(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(M&&!wo(s.valueSpec)?V.push(new ct(s.key,s.value,"property functions not supported")):E&&!pl(s.valueSpec)&&V.push(new ct(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!D||s.value.property!==void 0||V.push(new ct(s.key,s.value,'"property" property is required')),V;function G(ne){let le=[];const pe=ne.value,Ce=ne.key;if(qi(pe)!=="array")return[new ct(Ce,pe,`array expected, ${qi(pe)} found`)];if(pe.length!==2)return[new ct(Ce,pe,`array length 2 expected, length ${pe.length} found`)];if(D){if(qi(pe[0])!=="object")return[new ct(Ce,pe,`object expected, ${qi(pe[0])} found`)];if(pe[0].zoom===void 0)return[new ct(Ce,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new ct(Ce,pe,"object stop key must have value")];if(w&&w>Oe(pe[0].zoom))return[new ct(Ce,pe[0].zoom,"stop zoom values must appear in ascending order")];Oe(pe[0].zoom)!==w&&(w=Oe(pe[0].zoom),g=void 0,x={}),le=le.concat(It({key:`${Ce}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:Wi,value:Q}}))}else le=le.concat(Q({key:`${Ce}[0]`,value:pe[0],validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec},pe));return Ma(ft(pe[1]))?le.concat([new ct(`${Ce}[1]`,pe[1],"expressions are not allowed in function stops.")]):le.concat(ne.validateSpec({key:`${Ce}[1]`,value:pe[1],valueSpec:t,validateSpec:ne.validateSpec,style:ne.style,styleSpec:ne.styleSpec}))}function Q(ne,le){const pe=qi(ne.value),Ce=Oe(ne.value),Pe=ne.value!==null?ne.value:le;if(h){if(pe!==h)return[new ct(ne.key,Pe,`${pe} stop domain type must match previous stop domain type ${h}`)]}else h=pe;if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new ct(ne.key,Pe,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&l!=="categorical"){let tt=`number expected, ${pe} found`;return wo(t)&&l===void 0&&(tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(ne.key,Pe,tt)]}return l!=="categorical"||pe!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?l!=="categorical"&&pe==="number"&&g!==void 0&&Ce<g?[new ct(ne.key,Pe,"stop domain values must appear in ascending order")]:(g=Ce,l==="categorical"&&Ce in x?[new ct(ne.key,Pe,"stop domain values must be unique")]:(x[Ce]=!0,[])):[new ct(ne.key,Pe,`integer expected, found ${Ce}`)]}}function On(s){const t=(s.expressionContext==="property"?_l:Cr)(ft(s.value),s.valueSpec);if(t.result==="error")return t.value.map(h=>new ct(`${s.key}${h.key}`,s.value,h.message));const l=t.value.expression||t.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new ct(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!bo(l))return[new ct(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!bo(l))return[new ct(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!$o(l,["zoom","feature-state"]))return[new ct(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Qo(l))return[new ct(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function In(s){const t=s.key,l=s.value,h=s.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Oe(l))===-1&&g.push(new ct(t,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(Oe(l))===-1&&g.push(new ct(t,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function gr(s){return Pa(ft(s.value))?On(Vt({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Er(s)}function Er(s){const t=s.value,l=s.key;if(qi(t)!=="array")return[new ct(l,t,`array expected, ${qi(t)} found`)];const h=s.styleSpec;let g,w=[];if(t.length<1)return[new ct(l,t,"filter array must have at least 1 element")];switch(w=w.concat(In({key:`${l}[0]`,value:t[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),Oe(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Oe(t[1])==="$type"&&w.push(new ct(l,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&w.push(new ct(l,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=qi(t[1]),g!=="string"&&w.push(new ct(`${l}[1]`,t[1],`string expected, ${g} found`)));for(let x=2;x<t.length;x++)g=qi(t[x]),Oe(t[1])==="$type"?w=w.concat(In({key:`${l}[${x}]`,value:t[x],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new ct(`${l}[${x}]`,t[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)w=w.concat(Er({key:`${l}[${x}]`,value:t[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=qi(t[1]),t.length!==2?w.push(new ct(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new ct(`${l}[1]`,t[1],`string expected, ${g} found`))}return w}function jr(s,t){const l=s.key,h=s.validateSpec,g=s.style,w=s.styleSpec,x=s.value,E=s.objectKey,M=w[`${t}_${s.layerType}`];if(!M)return[];const D=E.match(/^(.*)-transition$/);if(t==="paint"&&D&&M[D[1]]&&M[D[1]].transition)return h({key:l,value:x,valueSpec:w.transition,style:g,styleSpec:w});const V=s.valueSpec||M[E];if(!V)return[new ct(l,x,`unknown property "${E}"`)];let G;if(qi(x)==="string"&&wo(V)&&!V.tokens&&(G=/^{([^}]+)}$/.exec(x)))return[new ct(l,x,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const Q=[];return s.layerType==="symbol"&&(E==="text-field"&&g&&!g.glyphs&&Q.push(new ct(l,x,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&xo(ft(x))&&Oe(x.type)==="identity"&&Q.push(new ct(l,x,'"text-font" does not support identity functions'))),Q.concat(h({key:s.key,value:x,valueSpec:V,style:g,styleSpec:w,expressionContext:"property",propertyType:t,propertyKey:E}))}function $r(s){return jr(s,"paint")}function _r(s){return jr(s,"layout")}function so(s){let t=[];const l=s.value,h=s.key,g=s.style,w=s.styleSpec;l.type||l.ref||t.push(new ct(h,l,'either "type" or "ref" is required'));let x=Oe(l.type);const E=Oe(l.ref);if(l.id){const M=Oe(l.id);for(let D=0;D<s.arrayIndex;D++){const V=g.layers[D];Oe(V.id)===M&&t.push(new ct(h,l.id,`duplicate layer id "${l.id}", previously used at line ${V.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&t.push(new ct(h,l[D],`"${D}" is prohibited for ref layers`))}),g.layers.forEach(D=>{Oe(D.id)===E&&(M=D)}),M?M.ref?t.push(new ct(h,l.ref,"ref cannot reference another ref layer")):x=Oe(M.type):t.push(new ct(h,l.ref,`ref layer "${E}" not found`))}else if(x!=="background")if(l.source){const M=g.sources&&g.sources[l.source],D=M&&Oe(M.type);M?D==="vector"&&x==="raster"?t.push(new ct(h,l.source,`layer "${l.id}" requires a raster source`)):D!=="raster-dem"&&x==="hillshade"?t.push(new ct(h,l.source,`layer "${l.id}" requires a raster-dem source`)):D==="raster"&&x!=="raster"?t.push(new ct(h,l.source,`layer "${l.id}" requires a vector source`)):D!=="vector"||l["source-layer"]?D==="raster-dem"&&x!=="hillshade"?t.push(new ct(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!l.paint||!l.paint["line-gradient"]||D==="geojson"&&M.lineMetrics||t.push(new ct(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ct(h,l,`layer "${l.id}" must specify a "source-layer"`)):t.push(new ct(h,l.source,`source "${l.source}" not found`))}else t.push(new ct(h,l,'missing required property "source"'));return t=t.concat(It({key:h,value:l,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${h}.type`,value:l.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"}),filter:gr,layout:M=>It({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":D=>_r(Vt({layerType:x},D))}}),paint:M=>It({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":D=>$r(Vt({layerType:x},D))}})}})),t}function es(s){const t=s.value,l=s.key,h=qi(t);return h!=="string"?[new ct(l,t,`string expected, ${h} found`)]:[]}const za={promoteId:function({key:s,value:t}){if(qi(t)==="string")return es({key:s,value:t});{const l=[];for(const h in t)l.push(...es({key:`${s}.${h}`,value:t[h]}));return l}}};function Ur(s){const t=s.value,l=s.key,h=s.styleSpec,g=s.style,w=s.validateSpec;if(!t.type)return[new ct(l,t,'"type" is required')];const x=Oe(t.type);let E;switch(x){case"vector":case"raster":return E=It({key:l,value:t,valueSpec:h[`source_${x.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:za,validateSpec:w}),E;case"raster-dem":return E=function(M){var D;const V=(D=M.sourceName)!==null&&D!==void 0?D:"",G=M.value,Q=M.styleSpec,ne=Q.source_raster_dem,le=M.style;let pe=[];const Ce=qi(G);if(G===void 0)return pe;if(Ce!=="object")return pe.push(new ct("source_raster_dem",G,`object expected, ${Ce} found`)),pe;const Pe=Oe(G.encoding)==="custom",tt=["redFactor","greenFactor","blueFactor","baseShift"],Ue=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Je in G)!Pe&&tt.includes(Je)?pe.push(new ct(Je,G[Je],`In "${V}": "${Je}" is only valid when "encoding" is set to "custom". ${Ue} encoding found`)):ne[Je]?pe=pe.concat(M.validateSpec({key:Je,value:G[Je],valueSpec:ne[Je],validateSpec:M.validateSpec,style:le,styleSpec:Q})):pe.push(new ct(Je,G[Je],`unknown property "${Je}"`));return pe}({sourceName:l,value:t,style:s.style,styleSpec:h,validateSpec:w}),E;case"geojson":if(E=It({key:l,value:t,valueSpec:h.source_geojson,style:g,styleSpec:h,validateSpec:w,objectElementValidators:za}),t.cluster)for(const M in t.clusterProperties){const[D,V]=t.clusterProperties[M],G=typeof D=="string"?[D,["accumulated"],["get",M]]:D;E.push(...On({key:`${l}.${M}.map`,value:V,expressionContext:"cluster-map"})),E.push(...On({key:`${l}.${M}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return E;case"video":return It({key:l,value:t,valueSpec:h.source_video,style:g,validateSpec:w,styleSpec:h});case"image":return It({key:l,value:t,valueSpec:h.source_image,style:g,validateSpec:w,styleSpec:h});case"canvas":return[new ct(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return In({key:`${l}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function vl(s){const t=s.value,l=s.styleSpec,h=l.light,g=s.style;let w=[];const x=qi(t);if(t===void 0)return w;if(x!=="object")return w=w.concat([new ct("light",t,`object expected, ${x} found`)]),w;for(const E in t){const M=E.match(/^(.*)-transition$/);w=w.concat(M&&h[M[1]]&&h[M[1]].transition?s.validateSpec({key:E,value:t[E],valueSpec:l.transition,validateSpec:s.validateSpec,style:g,styleSpec:l}):h[E]?s.validateSpec({key:E,value:t[E],valueSpec:h[E],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new ct(E,t[E],`unknown property "${E}"`)])}return w}function du(s){const t=s.value,l=s.styleSpec,h=l.sky,g=s.style,w=qi(t);if(t===void 0)return[];if(w!=="object")return[new ct("sky",t,`object expected, ${w} found`)];let x=[];for(const E in t)x=x.concat(h[E]?s.validateSpec({key:E,value:t[E],valueSpec:h[E],style:g,styleSpec:l}):[new ct(E,t[E],`unknown property "${E}"`)]);return x}function pu(s){const t=s.value,l=s.styleSpec,h=l.terrain,g=s.style;let w=[];const x=qi(t);if(t===void 0)return w;if(x!=="object")return w=w.concat([new ct("terrain",t,`object expected, ${x} found`)]),w;for(const E in t)w=w.concat(h[E]?s.validateSpec({key:E,value:t[E],valueSpec:h[E],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new ct(E,t[E],`unknown property "${E}"`)]);return w}function mu(s){let t=[];const l=s.value,h=s.key;if(Array.isArray(l)){const g=[],w=[];for(const x in l)l[x].id&&g.includes(l[x].id)&&t.push(new ct(h,l,`all the sprites' ids must be unique, but ${l[x].id} is duplicated`)),g.push(l[x].id),l[x].url&&w.includes(l[x].url)&&t.push(new ct(h,l,`all the sprites' URLs must be unique, but ${l[x].url} is duplicated`)),w.push(l[x].url),t=t.concat(It({key:`${h}[${x}]`,value:l[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return t}return es({key:h,value:l})}const cc={"*":()=>[],array:Xt,boolean:function(s){const t=s.value,l=s.key,h=qi(t);return h!=="boolean"?[new ct(l,t,`boolean expected, ${h} found`)]:[]},number:Wi,color:function(s){const t=s.key,l=s.value,h=qi(l);return h!=="string"?[new ct(t,l,`color expected, ${h} found`)]:si.parse(String(l))?[]:[new ct(t,l,`color expected, "${l}" found`)]},constants:se,enum:In,filter:gr,function:on,layer:so,object:It,source:Ur,light:vl,sky:du,terrain:pu,projection:function(s){const t=s.value,l=s.styleSpec,h=l.projection,g=s.style,w=qi(t);if(t===void 0)return[];if(w!=="object")return[new ct("projection",t,`object expected, ${w} found`)];let x=[];for(const E in t)x=x.concat(h[E]?s.validateSpec({key:E,value:t[E],valueSpec:h[E],style:g,styleSpec:l}):[new ct(E,t[E],`unknown property "${E}"`)]);return x},string:es,formatted:function(s){return es(s).length===0?[]:On(s)},resolvedImage:function(s){return es(s).length===0?[]:On(s)},padding:function(s){const t=s.key,l=s.value;if(qi(l)==="array"){if(l.length<1||l.length>4)return[new ct(t,l,`padding requires 1 to 4 values; ${l.length} values found`)];const h={type:"number"};let g=[];for(let w=0;w<l.length;w++)g=g.concat(s.validateSpec({key:`${t}[${w}]`,value:l[w],validateSpec:s.validateSpec,valueSpec:h}));return g}return Wi({key:t,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const t=s.key,l=s.value,h=qi(l),g=s.styleSpec;if(h!=="array"||l.length<1||l.length%2!=0)return[new ct(t,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<l.length;x+=2)w=w.concat(In({key:`${t}[${x}]`,value:l[x],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Xt({key:`${t}[${x+1}]`,value:l[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return w},sprite:mu};function wl(s){const t=s.value,l=s.valueSpec,h=s.styleSpec;return s.validateSpec=wl,l.expression&&xo(Oe(t))?on(s):l.expression&&Ma(ft(t))?On(s):l.type&&cc[l.type]?cc[l.type](s):It(Vt({},s,{valueSpec:l.type?h[l.type]:l}))}function gh(s){const t=s.value,l=s.key,h=es(s);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new ct(l,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new ct(l,t,'"glyphs" url must include a "{range}" token'))),h}function ts(s,t=Ye){let l=[];return l=l.concat(wl({key:"",value:s,valueSpec:t.$root,styleSpec:t,style:s,validateSpec:wl,objectElementValidators:{glyphs:gh,"*":()=>[]}})),s.constants&&(l=l.concat(se({key:"constants",value:s.constants}))),gu(l)}function Ds(s){return function(t){return s({...t,validateSpec:wl})}}function gu(s){return[].concat(s).sort((t,l)=>t.line-l.line)}function ps(s){return function(...t){return gu(s.apply(this,t))}}ts.source=ps(Ds(Ur)),ts.sprite=ps(Ds(mu)),ts.glyphs=ps(Ds(gh)),ts.light=ps(Ds(vl)),ts.sky=ps(Ds(du)),ts.terrain=ps(Ds(pu)),ts.layer=ps(Ds(so)),ts.filter=ps(Ds(gr)),ts.paintProperty=ps(Ds($r)),ts.layoutProperty=ps(Ds(_r));const ra=ts,Tf=ra.light,kf=ra.sky,_h=ra.paintProperty,yh=ra.layoutProperty;function _u(s,t){let l=!1;if(t&&t.length)for(const h of t)s.fire(new Pt(new Error(h.message))),l=!0;return l}class Oa{constructor(t,l,h){const g=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(l=x[1])+2*(h=x[2]);for(let M=0;M<this.d*this.d;M++){const D=x[3+M],V=x[3+M+1];g.push(D===V?null:x.subarray(D,V))}const E=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],E),this.bboxes=x.subarray(E),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=t,this.padding=h,this.scale=l/t,this.uid=0;const w=h/l*t;this.min=-w,this.max=t+w}insert(t,l,h,g,w){this._forEachCell(l,h,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,l,h,g,w,x){this.cells[w].push(x)}query(t,l,h,g,w){const x=this.min,E=this.max;if(t<=x&&l<=x&&E<=h&&E<=g&&!w)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(t,l,h,g,this._queryCell,M,{},w),M}}_queryCell(t,l,h,g,w,x,E,M){const D=this.cells[w];if(D!==null){const V=this.keys,G=this.bboxes;for(let Q=0;Q<D.length;Q++){const ne=D[Q];if(E[ne]===void 0){const le=4*ne;(M?M(G[le+0],G[le+1],G[le+2],G[le+3]):t<=G[le+2]&&l<=G[le+3]&&h>=G[le+0]&&g>=G[le+1])?(E[ne]=!0,x.push(V[ne])):E[ne]=!1}}}}_forEachCell(t,l,h,g,w,x,E,M){const D=this._convertToCellCoord(t),V=this._convertToCellCoord(l),G=this._convertToCellCoord(h),Q=this._convertToCellCoord(g);for(let ne=D;ne<=G;ne++)for(let le=V;le<=Q;le++){const pe=this.d*le+ne;if((!M||M(this._convertFromCellCoord(ne),this._convertFromCellCoord(le),this._convertFromCellCoord(ne+1),this._convertFromCellCoord(le+1)))&&w.call(this,t,l,h,g,pe,x,E,M))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,l=3+this.cells.length+1+1;let h=0;for(let x=0;x<this.cells.length;x++)h+=this.cells[x].length;const g=new Int32Array(l+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=l;for(let x=0;x<t.length;x++){const E=t[x];g[3+x]=w,g.set(E,w),w+=E.length}return g[3+t.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+t.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(t,l){const h=t.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(t){return new Oa(t.buffer)}}const is={};function Ut(s,t,l={}){if(is[s])throw new Error(`${s} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:s,writeable:!1}),is[s]={klass:t,omit:l.omit||[],shallow:l.shallow||[]}}Ut("Object",Object),Ut("TransferableGridIndex",Oa),Ut("Color",si),Ut("Error",Error),Ut("AJAXError",Zt),Ut("ResolvedImage",Hn),Ut("StylePropertyFunction",ko),Ut("StyleExpression",So,{omit:["_evaluator"]}),Ut("ZoomDependentExpression",To),Ut("ZoomConstantExpression",mr),Ut("CompoundExpression",kr,{omit:["_evaluate"]});for(const s in yo)yo[s]._classRegistryKey||Ut(`Expression_${s}`,yo[s]);function uc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function yu(s){return s.$name||s.constructor._classRegistryKey}function bh(s){return!function(t){if(t===null||typeof t!="object")return!1;const l=yu(t);return!(!l||l==="Object")}(s)&&(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||uc(s)||he(s)||ArrayBuffer.isView(s)||s instanceof ImageData)}function Da(s,t){if(bh(s))return(uc(s)||he(s))&&t&&t.push(s),ArrayBuffer.isView(s)&&t&&t.push(s.buffer),s instanceof ImageData&&t&&t.push(s.data.buffer),s;if(Array.isArray(s)){const w=[];for(const x of s)w.push(Da(x,t));return w}if(typeof s!="object")throw new Error("can't serialize object of type "+typeof s);const l=yu(s);if(!l)throw new Error(`can't serialize object of unregistered class ${s.constructor.name}`);if(!is[l])throw new Error(`${l} is not registered.`);const{klass:h}=is[l],g=h.serialize?h.serialize(s,t):{};if(h.serialize){if(t&&g===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||is[l].omit.indexOf(w)>=0)continue;const x=s[w];g[w]=is[l].shallow.indexOf(w)>=0?x:Da(x,t)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(g.$name=l),g}function Fa(s){if(bh(s))return s;if(Array.isArray(s))return s.map(Fa);if(typeof s!="object")throw new Error("can't deserialize object of type "+typeof s);const t=yu(s)||"Object";if(!is[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:l}=is[t];if(!l)throw new Error(`can't deserialize unregistered class ${t}`);if(l.deserialize)return l.deserialize(s);const h=Object.create(l.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const w=s[g];h[g]=is[t].shallow.indexOf(g)>=0?w:Fa(w)}return h}class bu{constructor(){this.first=!0}update(t,l){const h=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=h,!0))}}const ji={"Latin-1 Supplement":s=>s>=128&&s<=255,"Hangul Jamo":s=>s>=4352&&s<=4607,Khmer:s=>s>=6016&&s<=6143,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Katakana:s=>s>=12448&&s<=12543,Kanbun:s=>s>=12688&&s<=12703,"CJK Strokes":s=>s>=12736&&s<=12783,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"Private Use Area":s=>s>=57344&&s<=63743,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function vu(s){for(const t of s)if(xu(t.charCodeAt(0)))return!0;return!1}function Cf(s){for(const t of s)if(!Ra(t.charCodeAt(0)))return!1;return!0}function wu(s){const t=s.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(t.join("|"),"u")}const Ef=wu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ra(s){return!Ef.test(String.fromCodePoint(s))}const vh=wu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function xu(s){return!(s!==746&&s!==747&&(s<4352||!(ji["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||ji["CJK Compatibility"](s)||ji["CJK Strokes"](s)||!(!ji["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||ji["Enclosed CJK Letters and Months"](s)||ji["Ideographic Description Characters"](s)||ji.Kanbun(s)||ji.Katakana(s)&&s!==12540||!(!ji["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!ji["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||ji["Vertical Forms"](s)||ji["Yijing Hexagram Symbols"](s)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(s))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(s))||vh.test(String.fromCodePoint(s)))))}function wh(s){return!(xu(s)||function(t){return!!(ji["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ji["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ji["Letterlike Symbols"](t)||ji["Number Forms"](t)||ji["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ji["Control Pictures"](t)&&t!==9251||ji["Optical Character Recognition"](t)||ji["Enclosed Alphanumerics"](t)||ji["Geometric Shapes"](t)||ji["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ji["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ji["CJK Symbols and Punctuation"](t)||ji.Katakana(t)||ji["Private Use Area"](t)||ji["CJK Compatibility Forms"](t)||ji["Small Form Variants"](t)||ji["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(s))}const If=wu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Su(s){return If.test(String.fromCodePoint(s))}function Af(s,t){return!(!t&&Su(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||ji.Khmer(s))}function Mf(s){for(const t of s)if(Su(t.charCodeAt(0)))return!0;return!1}const Vr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class mn{constructor(t,l){this.zoom=t,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bu,this.transition={})}isSupportedScript(t){return function(l,h){for(const g of l)if(!Af(g.charCodeAt(0),h))return!1;return!0}(t,Vr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,l=t-Math.floor(t),h=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}class Ba{constructor(t,l){this.property=t,this.value=l,this.expression=function(h,g){if(xo(h))return new ko(h,g);if(Ma(h)){const w=_l(h,g);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=h;return g.type==="color"&&typeof h=="string"?w=si.parse(h):g.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(h)&&(w=zn.parse(h)):w=pn.parse(h),{kind:"constant",evaluate:()=>w}}}(l===void 0?t.specification.default:l,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,l,h){return this.property.possiblyEvaluate(this,t,l,h)}}class hc{constructor(t){this.property=t,this.value=new Ba(t,void 0)}transitioned(t,l){return new xh(this.property,this.value,l,re({},t.transition,this.transition),t.now)}untransitioned(){return new xh(this.property,this.value,null,{},0)}}class fc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return R(this._values[t].value.value)}setValue(t,l){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new hc(this._values[t].property)),this._values[t].value=new Ba(this._values[t].property,l===null?void 0:R(l))}getTransition(t){return R(this._values[t].transition)}setTransition(t,l){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new hc(this._values[t].property)),this._values[t].transition=R(l)||void 0}serialize(){const t={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(t[l]=h);const g=this.getTransition(l);g!==void 0&&(t[`${l}-transition`]=g)}return t}transitioned(t,l){const h=new xl(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(t,l._values[g]);return h}untransitioned(){const t=new xl(this._properties);for(const l of Object.keys(this._values))t._values[l]=this._values[l].untransitioned();return t}}class xh{constructor(t,l,h,g,w){this.property=t,this.value=l,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,t.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(t,l,h){const g=t.now||0,w=this.value.possiblyEvaluate(t,l,h),x=this.prior;if(x){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return x.possiblyEvaluate(t,l,h);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,l,h),w,function(M){if(M<=0)return 0;if(M>=1)return 1;const D=M*M,V=D*M;return 4*(M<.5?V:3*(M-D)+V-.75)}(E))}}return w}}class xl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,l,h){const g=new Tl(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(t,l,h);return g}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Sl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return R(this._values[t].value)}setValue(t,l){this._values[t]=new Ba(this._values[t].property,l===null?void 0:R(l))}serialize(){const t={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(t[l]=h)}return t}possiblyEvaluate(t,l,h){const g=new Tl(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(t,l,h);return g}}class Fs{constructor(t,l,h){this.property=t,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,l,h,g){return this.property.evaluate(this.value,this.parameters,t,l,h,g)}}class Tl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Kt{constructor(t){this.specification=t}possiblyEvaluate(t,l){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(l)}interpolate(t,l,h){const g=Vn[this.specification.type];return g?g(t,l,h):t}}class fi{constructor(t,l){this.specification=t,this.overrides=l}possiblyEvaluate(t,l,h,g){return new Fs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(l,null,{},h,g)}:t.expression,l)}interpolate(t,l,h){if(t.value.kind!=="constant"||l.value.kind!=="constant")return t;if(t.value.value===void 0||l.value.value===void 0)return new Fs(this,{kind:"constant",value:void 0},t.parameters);const g=Vn[this.specification.type];if(g){const w=g(t.value.value,l.value.value,h);return new Fs(this,{kind:"constant",value:w},t.parameters)}return t}evaluate(t,l,h,g,w,x){return t.kind==="constant"?t.value:t.evaluate(l,h,g,w,x)}}class dc extends fi{possiblyEvaluate(t,l,h,g){if(t.value===void 0)return new Fs(this,{kind:"constant",value:void 0},l);if(t.expression.kind==="constant"){const w=t.expression.evaluate(l,null,{},h,g),x=t.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,E=this._calculate(x,x,x,l);return new Fs(this,{kind:"constant",value:E},l)}if(t.expression.kind==="camera"){const w=this._calculate(t.expression.evaluate({zoom:l.zoom-1}),t.expression.evaluate({zoom:l.zoom}),t.expression.evaluate({zoom:l.zoom+1}),l);return new Fs(this,{kind:"constant",value:w},l)}return new Fs(this,t.expression,l)}evaluate(t,l,h,g,w,x){if(t.kind==="source"){const E=t.evaluate(l,h,g,w,x);return this._calculate(E,E,E,l)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(l.zoom)-1},h,g),t.evaluate({zoom:Math.floor(l.zoom)},h,g),t.evaluate({zoom:Math.floor(l.zoom)+1},h,g),l):t.value}_calculate(t,l,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:t,to:l}:{from:h,to:l}}interpolate(t){return t}}class pc{constructor(t){this.specification=t}possiblyEvaluate(t,l,h,g){if(t.value!==void 0){if(t.expression.kind==="constant"){const w=t.expression.evaluate(l,null,{},h,g);return this._calculate(w,w,w,l)}return this._calculate(t.expression.evaluate(new mn(Math.floor(l.zoom-1),l)),t.expression.evaluate(new mn(Math.floor(l.zoom),l)),t.expression.evaluate(new mn(Math.floor(l.zoom+1),l)),l)}}_calculate(t,l,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:t,to:l}:{from:h,to:l}}interpolate(t){return t}}class Tu{constructor(t){this.specification=t}possiblyEvaluate(t,l,h,g){return!!t.expression.evaluate(l,null,{},h,g)}interpolate(){return!1}}class v{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in t){const h=t[l];h.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new Ba(h,void 0),w=this.defaultTransitionablePropertyValues[l]=new hc(h);this.defaultTransitioningPropertyValues[l]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}Ut("DataDrivenProperty",fi),Ut("DataConstantProperty",Kt),Ut("CrossFadedDataDrivenProperty",dc),Ut("CrossFadedProperty",pc),Ut("ColorRampProperty",Tu);const e="-transition";class c extends ni{constructor(t,l){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),l.layout&&(this._unevaluatedLayout=new Sl(l.layout)),l.paint)){this._transitionablePaint=new fc(l.paint);for(const h in t.paint)this.setPaintProperty(h,t.paint[h],{validate:!1});for(const h in t.layout)this.setLayoutProperty(h,t.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Tl(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,l,h={}){l!=null&&this._validate(yh,`layers.${this.id}.layout.${t}`,t,l,h)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,l):this.visibility=l)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,l,h={}){if(l!=null&&this._validate(_h,`layers.${this.id}.paint.${t}`,t,l,h))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[t],w=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),E=g.value;this._transitionablePaint.setValue(t,l),this._handleSpecialPaintPropertyUpdate(t);const M=this._transitionablePaint._values[t].value;return M.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(t,E,M)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,l,h){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,l){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,l)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),J(t,(l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length))}_validate(t,l,h,g,w={}){return(!w||w.validate!==!1)&&_u(this,t.call(ra,{key:l,layerType:this.type,objectKey:h,value:g,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const l=this.paint.get(t);if(l instanceof Fs&&wo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(t,l){this._structArray=t,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class b{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,l){return t._trim(),l&&(t.isTransferred=!0,l.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const l=Object.create(this.prototype);return l.arrayBuffer=t.arrayBuffer,l.length=t.length,l.capacity=t.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function A(s,t=1){let l=0,h=0;return{members:s.map(g=>{const w=p[g.type].BYTES_PER_ELEMENT,x=l=P(l,Math.max(t,w)),E=g.components||1;return h=Math.max(h,w),l+=w*E,{name:g.name,type:g.type,components:E,offset:x}}),size:P(l,Math.max(h,t)),alignment:t}}function P(s,t){return Math.ceil(s/t)*t}class z extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){const g=2*t;return this.int16[g+0]=l,this.int16[g+1]=h,t}}z.prototype.bytesPerElement=4,Ut("StructArrayLayout2i4",z);class q extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,l,h)}emplace(t,l,h,g){const w=3*t;return this.int16[w+0]=l,this.int16[w+1]=h,this.int16[w+2]=g,t}}q.prototype.bytesPerElement=6,Ut("StructArrayLayout3i6",q);class X extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,t,l,h,g)}emplace(t,l,h,g,w){const x=4*t;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=g,this.int16[x+3]=w,t}}X.prototype.bytesPerElement=8,Ut("StructArrayLayout4i8",X);class K extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,h,g,w,x)}emplace(t,l,h,g,w,x,E){const M=6*t;return this.int16[M+0]=l,this.int16[M+1]=h,this.int16[M+2]=g,this.int16[M+3]=w,this.int16[M+4]=x,this.int16[M+5]=E,t}}K.prototype.bytesPerElement=12,Ut("StructArrayLayout2i4i12",K);class ae extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,h,g,w,x)}emplace(t,l,h,g,w,x,E){const M=4*t,D=8*t;return this.int16[M+0]=l,this.int16[M+1]=h,this.uint8[D+4]=g,this.uint8[D+5]=w,this.uint8[D+6]=x,this.uint8[D+7]=E,t}}ae.prototype.bytesPerElement=8,Ut("StructArrayLayout2i4ub8",ae);class me extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){const g=2*t;return this.float32[g+0]=l,this.float32[g+1]=h,t}}me.prototype.bytesPerElement=8,Ut("StructArrayLayout2f8",me);class ve extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x,E,M,D,V){const G=this.length;return this.resize(G+1),this.emplace(G,t,l,h,g,w,x,E,M,D,V)}emplace(t,l,h,g,w,x,E,M,D,V,G){const Q=10*t;return this.uint16[Q+0]=l,this.uint16[Q+1]=h,this.uint16[Q+2]=g,this.uint16[Q+3]=w,this.uint16[Q+4]=x,this.uint16[Q+5]=E,this.uint16[Q+6]=M,this.uint16[Q+7]=D,this.uint16[Q+8]=V,this.uint16[Q+9]=G,t}}ve.prototype.bytesPerElement=20,Ut("StructArrayLayout10ui20",ve);class Ee extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x,E,M,D,V,G,Q){const ne=this.length;return this.resize(ne+1),this.emplace(ne,t,l,h,g,w,x,E,M,D,V,G,Q)}emplace(t,l,h,g,w,x,E,M,D,V,G,Q,ne){const le=12*t;return this.int16[le+0]=l,this.int16[le+1]=h,this.int16[le+2]=g,this.int16[le+3]=w,this.uint16[le+4]=x,this.uint16[le+5]=E,this.uint16[le+6]=M,this.uint16[le+7]=D,this.int16[le+8]=V,this.int16[le+9]=G,this.int16[le+10]=Q,this.int16[le+11]=ne,t}}Ee.prototype.bytesPerElement=24,Ut("StructArrayLayout4i4ui4i24",Ee);class Le extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,l,h)}emplace(t,l,h,g){const w=3*t;return this.float32[w+0]=l,this.float32[w+1]=h,this.float32[w+2]=g,t}}Le.prototype.bytesPerElement=12,Ut("StructArrayLayout3f12",Le);class ze extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint32[1*t+0]=l,t}}ze.prototype.bytesPerElement=4,Ut("StructArrayLayout1ul4",ze);class Ne extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x,E,M,D){const V=this.length;return this.resize(V+1),this.emplace(V,t,l,h,g,w,x,E,M,D)}emplace(t,l,h,g,w,x,E,M,D,V){const G=10*t,Q=5*t;return this.int16[G+0]=l,this.int16[G+1]=h,this.int16[G+2]=g,this.int16[G+3]=w,this.int16[G+4]=x,this.int16[G+5]=E,this.uint32[Q+3]=M,this.uint16[G+8]=D,this.uint16[G+9]=V,t}}Ne.prototype.bytesPerElement=20,Ut("StructArrayLayout6i1ul2ui20",Ne);class Te extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,h,g,w,x)}emplace(t,l,h,g,w,x,E){const M=6*t;return this.int16[M+0]=l,this.int16[M+1]=h,this.int16[M+2]=g,this.int16[M+3]=w,this.int16[M+4]=x,this.int16[M+5]=E,t}}Te.prototype.bytesPerElement=12,Ut("StructArrayLayout2i2i2i12",Te);class Ge extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w){const x=this.length;return this.resize(x+1),this.emplace(x,t,l,h,g,w)}emplace(t,l,h,g,w,x){const E=4*t,M=8*t;return this.float32[E+0]=l,this.float32[E+1]=h,this.float32[E+2]=g,this.int16[M+6]=w,this.int16[M+7]=x,t}}Ge.prototype.bytesPerElement=16,Ut("StructArrayLayout2f1f2i16",Ge);class Ke extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,h,g,w,x)}emplace(t,l,h,g,w,x,E){const M=16*t,D=4*t,V=8*t;return this.uint8[M+0]=l,this.uint8[M+1]=h,this.float32[D+1]=g,this.float32[D+2]=w,this.int16[V+6]=x,this.int16[V+7]=E,t}}Ke.prototype.bytesPerElement=16,Ut("StructArrayLayout2ub2f2i16",Ke);class nt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,l,h)}emplace(t,l,h,g){const w=3*t;return this.uint16[w+0]=l,this.uint16[w+1]=h,this.uint16[w+2]=g,t}}nt.prototype.bytesPerElement=6,Ut("StructArrayLayout3ui6",nt);class bt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x,E,M,D,V,G,Q,ne,le,pe,Ce,Pe){const tt=this.length;return this.resize(tt+1),this.emplace(tt,t,l,h,g,w,x,E,M,D,V,G,Q,ne,le,pe,Ce,Pe)}emplace(t,l,h,g,w,x,E,M,D,V,G,Q,ne,le,pe,Ce,Pe,tt){const Ue=24*t,Je=12*t,at=48*t;return this.int16[Ue+0]=l,this.int16[Ue+1]=h,this.uint16[Ue+2]=g,this.uint16[Ue+3]=w,this.uint32[Je+2]=x,this.uint32[Je+3]=E,this.uint32[Je+4]=M,this.uint16[Ue+10]=D,this.uint16[Ue+11]=V,this.uint16[Ue+12]=G,this.float32[Je+7]=Q,this.float32[Je+8]=ne,this.uint8[at+36]=le,this.uint8[at+37]=pe,this.uint8[at+38]=Ce,this.uint32[Je+10]=Pe,this.int16[Ue+22]=tt,t}}bt.prototype.bytesPerElement=48,Ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",bt);class Ct extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,g,w,x,E,M,D,V,G,Q,ne,le,pe,Ce,Pe,tt,Ue,Je,at,wt,Bt,hi,Ft,Ot,$t,qt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,t,l,h,g,w,x,E,M,D,V,G,Q,ne,le,pe,Ce,Pe,tt,Ue,Je,at,wt,Bt,hi,Ft,Ot,$t,qt)}emplace(t,l,h,g,w,x,E,M,D,V,G,Q,ne,le,pe,Ce,Pe,tt,Ue,Je,at,wt,Bt,hi,Ft,Ot,$t,qt,jt){const dt=32*t,ei=16*t;return this.int16[dt+0]=l,this.int16[dt+1]=h,this.int16[dt+2]=g,this.int16[dt+3]=w,this.int16[dt+4]=x,this.int16[dt+5]=E,this.int16[dt+6]=M,this.int16[dt+7]=D,this.uint16[dt+8]=V,this.uint16[dt+9]=G,this.uint16[dt+10]=Q,this.uint16[dt+11]=ne,this.uint16[dt+12]=le,this.uint16[dt+13]=pe,this.uint16[dt+14]=Ce,this.uint16[dt+15]=Pe,this.uint16[dt+16]=tt,this.uint16[dt+17]=Ue,this.uint16[dt+18]=Je,this.uint16[dt+19]=at,this.uint16[dt+20]=wt,this.uint16[dt+21]=Bt,this.uint16[dt+22]=hi,this.uint32[ei+12]=Ft,this.float32[ei+13]=Ot,this.float32[ei+14]=$t,this.uint16[dt+30]=qt,this.uint16[dt+31]=jt,t}}Ct.prototype.bytesPerElement=64,Ut("StructArrayLayout8i15ui1ul2f2ui64",Ct);class Dt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.float32[1*t+0]=l,t}}Dt.prototype.bytesPerElement=4,Ut("StructArrayLayout1f4",Dt);class Nt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,l,h)}emplace(t,l,h,g){const w=3*t;return this.uint16[6*t+0]=l,this.float32[w+1]=h,this.float32[w+2]=g,t}}Nt.prototype.bytesPerElement=12,Ut("StructArrayLayout1ui2f12",Nt);class Lt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,l,h)}emplace(t,l,h,g){const w=4*t;return this.uint32[2*t+0]=l,this.uint16[w+2]=h,this.uint16[w+3]=g,t}}Lt.prototype.bytesPerElement=8,Ut("StructArrayLayout1ul2ui8",Lt);class Mt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){const g=2*t;return this.uint16[g+0]=l,this.uint16[g+1]=h,t}}Mt.prototype.bytesPerElement=4,Ut("StructArrayLayout2ui4",Mt);class Jt extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint16[1*t+0]=l,t}}Jt.prototype.bytesPerElement=2,Ut("StructArrayLayout1ui2",Jt);class vi extends b{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,g){const w=this.length;return this.resize(w+1),this.emplace(w,t,l,h,g)}emplace(t,l,h,g,w){const x=4*t;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=g,this.float32[x+3]=w,t}}vi.prototype.bytesPerElement=16,Ut("StructArrayLayout4f16",vi);class zt extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}zt.prototype.size=20;class Rt extends Ne{get(t){return new zt(this,t)}}Ut("CollisionBoxArray",Rt);class _i extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_i.prototype.size=48;class gn extends bt{get(t){return new _i(this,t)}}Ut("PlacedSymbolArray",gn);class Ii extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ii.prototype.size=64;class Ni extends Ct{get(t){return new Ii(this,t)}}Ut("SymbolInstanceArray",Ni);class _n extends Dt{getoffsetX(t){return this.float32[1*t+0]}}Ut("GlyphOffsetArray",_n);class rr extends q{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ut("SymbolLineVertexArray",rr);class ms extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ms.prototype.size=12;class yn extends Nt{get(t){return new ms(this,t)}}Ut("TextAnchorOffsetArray",yn);class Ir extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ir.prototype.size=8;class yr extends Lt{get(t){return new Ir(this,t)}}Ut("FeatureIndexArray",yr);class sr extends z{}class br extends z{}class Rs extends z{}class Na extends K{}class mc extends ae{}class ja extends me{}class ns extends ve{}class gc extends Ee{}class ku extends Le{}class rs extends ze{}class ss extends Te{}class Eo extends Ke{}class gs extends nt{}class $n extends Mt{}const or=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:qr}=or;class Ui{constructor(t=[]){this.segments=t}prepareSegment(t,l,h,g){let w=this.segments[this.segments.length-1];return t>Ui.MAX_VERTEX_ARRAY_LENGTH&&ce(`Max vertices per segment is ${Ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!w||w.vertexLength+t>Ui.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const t of this.segments)for(const l in t.vaos)t.vaos[l].destroy()}static simpleSegment(t,l,h,g){return new Ui([{vertexOffset:t,primitiveOffset:l,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}function sa(s,t){return 256*(s=oe(Math.floor(s),0,255))+oe(Math.floor(t),0,255)}Ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut("SegmentVector",Ui);const Ua=A([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Va={exports:{}},Sh={exports:{}};Sh.exports=function(s,t){var l,h,g,w,x,E,M,D;for(h=s.length-(l=3&s.length),g=t,x=3432918353,E=461845907,D=0;D<h;)M=255&s.charCodeAt(D)|(255&s.charCodeAt(++D))<<8|(255&s.charCodeAt(++D))<<16|(255&s.charCodeAt(++D))<<24,++D,g=27492+(65535&(w=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&s.charCodeAt(D+2))<<16;case 2:M^=(255&s.charCodeAt(D+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&s.charCodeAt(D)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*E+(((M>>>16)*E&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Pf=Sh.exports,Th={exports:{}};Th.exports=function(s,t){for(var l,h=s.length,g=t^h,w=0;h>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++w;switch(h){case 3:g^=(255&s.charCodeAt(w+2))<<16;case 2:g^=(255&s.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Io=Pf,kh=Th.exports;Va.exports=Io,Va.exports.murmur3=Io,Va.exports.murmur2=kh;var _c=_(Va.exports);class kl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,l,h,g){this.ids.push(yc(t)),this.positions.push(l,h,g)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=yc(t);let h=0,g=this.ids.length-1;for(;h<g;){const x=h+g>>1;this.ids[x]>=l?g=x:h=x+1}const w=[];for(;this.ids[h]===l;)w.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return w}static serialize(t,l){const h=new Float64Array(t.ids),g=new Uint32Array(t.positions);return bc(h,g,0,h.length-1),l&&l.push(h.buffer,g.buffer),{ids:h,positions:g}}static deserialize(t){const l=new kl;return l.ids=t.ids,l.positions=t.positions,l.indexed=!0,l}}function yc(s){const t=+s;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:_c(String(s))}function bc(s,t,l,h){for(;l<h;){const g=s[l+h>>1];let w=l-1,x=h+1;for(;;){do w++;while(s[w]<g);do x--;while(s[x]>g);if(w>=x)break;qa(s,w,x),qa(t,3*w,3*x),qa(t,3*w+1,3*x+1),qa(t,3*w+2,3*x+2)}x-l<h-x?(bc(s,t,l,x),l=x+1):(bc(s,t,x+1,h),h=x)}}function qa(s,t,l){const h=s[t];s[t]=s[l],s[l]=h}Ut("FeaturePositionMap",kl);class Cl{constructor(t,l){this.gl=t.gl,this.location=l}}class Ch extends Cl{constructor(t,l){super(t,l),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class wp extends Cl{constructor(t,l){super(t,l),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class xp extends Cl{constructor(t,l){super(t,l),this.current=si.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const pb=new Float32Array(16);function Lf(s){return[sa(255*s.r,255*s.g),sa(255*s.b,255*s.a)]}class Cu{constructor(t,l,h){this.value=t,this.uniformNames=l.map(g=>`u_${g}`),this.type=h}setUniform(t,l,h){t.set(h.constantOr(this.value))}getBinding(t,l,h){return this.type==="color"?new xp(t,l):new Ch(t,l)}}class vc{constructor(t,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=t.tlbr}setUniform(t,l,h,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&t.set(w)}getBinding(t,l,h){return h.substr(0,9)==="u_pattern"?new wp(t,l):new Ch(t,l)}}class oa{constructor(t,l,h,g){this.expression=t,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,l,h,g,w){const x=this.paintVertexArray.length,E=this.expression.evaluate(new mn(0),l,{},g,[],w);this.paintVertexArray.resize(t),this._setPaintValue(x,t,E)}updatePaintArray(t,l,h,g){const w=this.expression.evaluate({zoom:0},h,g);this._setPaintValue(t,l,w)}_setPaintValue(t,l,h){if(this.type==="color"){const g=Lf(h);for(let w=t;w<l;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=t;g<l;g++)this.paintVertexArray.emplace(g,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class oo{constructor(t,l,h,g,w,x){this.expression=t,this.uniformNames=l.map(E=>`u_${E}_t`),this.type=h,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=l.map(E=>({name:`a_${E}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,l,h,g,w){const x=this.expression.evaluate(new mn(this.zoom),l,{},g,[],w),E=this.expression.evaluate(new mn(this.zoom+1),l,{},g,[],w),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,E)}updatePaintArray(t,l,h,g){const w=this.expression.evaluate({zoom:this.zoom},h,g),x=this.expression.evaluate({zoom:this.zoom+1},h,g);this._setPaintValue(t,l,w,x)}_setPaintValue(t,l,h,g){if(this.type==="color"){const w=Lf(h),x=Lf(g);for(let E=t;E<l;E++)this.paintVertexArray.emplace(E,w[0],w[1],x[0],x[1])}else{for(let w=t;w<l;w++)this.paintVertexArray.emplace(w,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,l){const h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=oe(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);t.set(g)}getBinding(t,l,h){return new Ch(t,l)}}class Za{constructor(t,l,h,g,w,x){this.expression=t,this.type=l,this.useIntegerZoom=h,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(t,l,h){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(g,t,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(t,l,h,g,w){this._setPaintValues(t,l,h.patterns&&h.patterns[this.layerId],w)}_setPaintValues(t,l,h,g){if(!g||!h)return;const{min:w,mid:x,max:E}=h,M=g[w],D=g[x],V=g[E];if(M&&D&&V)for(let G=t;G<l;G++)this.zoomInPaintVertexArray.emplace(G,D.tl[0],D.tl[1],D.br[0],D.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],D.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,D.tl[0],D.tl[1],D.br[0],D.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],D.pixelRatio,V.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ua.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ua.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Sp{constructor(t,l,h){this.binders={},this._buffers=[];const g=[];for(const w in t.paint._values){if(!h(w))continue;const x=t.paint.get(w);if(!(x instanceof Fs&&wo(x.property.specification)))continue;const E=mb(w,t.type),M=x.value,D=x.property.specification.type,V=x.property.useIntegerZoom,G=x.property.specification["property-type"],Q=G==="cross-faded"||G==="cross-faded-data-driven";if(M.kind==="constant")this.binders[w]=Q?new vc(M.value,E):new Cu(M.value,E,D),g.push(`/u_${w}`);else if(M.kind==="source"||Q){const ne=Tp(w,D,"source");this.binders[w]=Q?new Za(M,D,V,l,ne,t.id):new oa(M,E,D,ne),g.push(`/a_${w}`)}else{const ne=Tp(w,D,"composite");this.binders[w]=new oo(M,E,D,V,l,ne),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(t){const l=this.binders[t];return l instanceof oa||l instanceof oo?l.maxValue:0}populatePaintArrays(t,l,h,g,w){for(const x in this.binders){const E=this.binders[x];(E instanceof oa||E instanceof oo||E instanceof Za)&&E.populatePaintArray(t,l,h,g,w)}}setConstantPatternPositions(t,l){for(const h in this.binders){const g=this.binders[h];g instanceof vc&&g.setConstantPatternPositions(t,l)}}updatePaintArrays(t,l,h,g,w){let x=!1;for(const E in t){const M=l.getPositions(E);for(const D of M){const V=h.feature(D.index);for(const G in this.binders){const Q=this.binders[G];if((Q instanceof oa||Q instanceof oo||Q instanceof Za)&&Q.expression.isStateDependent===!0){const ne=g.paint.get(G);Q.expression=ne.value,Q.updatePaintArray(D.start,D.end,V,t[E],w),x=!0}}}}return x}defines(){const t=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Cu||h instanceof vc)&&t.push(...h.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return t}getBinderAttributes(){const t=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof oa||h instanceof oo)for(let g=0;g<h.paintVertexAttributes.length;g++)t.push(h.paintVertexAttributes[g].name);else if(h instanceof Za)for(let g=0;g<Ua.members.length;g++)t.push(Ua.members[g].name)}return t}getBinderUniforms(){const t=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Cu||h instanceof vc||h instanceof oo)for(const g of h.uniformNames)t.push(g)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,l){const h=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof Cu||w instanceof vc||w instanceof oo){for(const x of w.uniformNames)if(l[x]){const E=w.getBinding(t,l[x],x);h.push({name:x,property:g,binding:E})}}}return h}setUniforms(t,l,h,g){for(const{name:w,property:x,binding:E}of l)this.binders[x].setUniform(E,g,h.get(x),w)}updatePaintBuffers(t){this._buffers=[];for(const l in this.binders){const h=this.binders[l];if(t&&h instanceof Za){const g=t.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(h instanceof oa||h instanceof oo)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(t){for(const l in this.binders){const h=this.binders[l];(h instanceof oa||h instanceof oo||h instanceof Za)&&h.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const l=this.binders[t];(l instanceof oa||l instanceof oo||l instanceof Za)&&l.destroy()}}}class El{constructor(t,l,h=()=>!0){this.programConfigurations={};for(const g of t)this.programConfigurations[g.id]=new Sp(g,l,h);this.needsUpload=!1,this._featureMap=new kl,this._bufferOffset=0}populatePaintArrays(t,l,h,g,w,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(t,l,g,w,x);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,l,h,g){for(const w of h)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(t,this._featureMap,l,w,g)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function mb(s,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${t}-`,"").replace(/-/g,"_")]}function Tp(s,t,l){const h={color:{source:me,composite:vi},number:{source:Dt,composite:me}},g=function(w){return{"line-pattern":{source:ns,composite:ns},"fill-pattern":{source:ns,composite:ns},"fill-extrusion-pattern":{source:ns,composite:ns}}[w]}(s);return g&&g[l]||h[t][l]}Ut("ConstantBinder",Cu),Ut("CrossFadedConstantBinder",vc),Ut("SourceExpressionBinder",oa),Ut("CrossFadedCompositeBinder",Za),Ut("CompositeExpressionBinder",oo),Ut("ProgramConfiguration",Sp,{omit:["_buffers"]}),Ut("ProgramConfigurationSet",El);const Nn=8192,zf=Math.pow(2,14)-1,kp=-zf-1;function Il(s){const t=Nn/s.extent,l=s.loadGeometry();for(let h=0;h<l.length;h++){const g=l[h];for(let w=0;w<g.length;w++){const x=g[w],E=Math.round(x.x*t),M=Math.round(x.y*t);x.x=oe(E,kp,zf),x.y=oe(M,kp,zf),(E<x.x||E>x.x+1||M<x.y||M>x.y+1)&&ce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Al(s,t){return{type:s.type,id:s.id,properties:s.properties,geometry:t?Il(s):[]}}function Eh(s,t,l,h,g){s.emplaceBack(2*t+(h+1)/2,2*l+(g+1)/2)}class Of{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new br,this.indexArray=new gs,this.segments=new Ui,this.programConfigurations=new El(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h){const g=this.layers[0],w=[];let x=null,E=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),E=!x.isConstant());for(const{feature:M,id:D,index:V,sourceLayerIndex:G}of t){const Q=this.layers[0]._featureFilter.needGeometry,ne=Al(M,Q);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),ne,h))continue;const le=E?x.evaluate(ne,{},h):void 0,pe={id:D,properties:M.properties,type:M.type,sourceLayerIndex:G,index:V,geometry:Q?ne.geometry:Il(M),patterns:{},sortKey:le};w.push(pe)}E&&w.sort((M,D)=>M.sortKey-D.sortKey);for(const M of w){const{geometry:D,index:V,sourceLayerIndex:G}=M,Q=t[V].feature;this.addFeature(M,D,V,h),l.featureIndex.insert(Q,D,V,G,this.index)}}update(t,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,l,h,g){for(const w of l)for(const x of w){const E=x.x,M=x.y;if(E<0||E>=Nn||M<0||M>=Nn)continue;const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),V=D.vertexLength;Eh(this.layoutVertexArray,E,M,-1,-1),Eh(this.layoutVertexArray,E,M,1,-1),Eh(this.layoutVertexArray,E,M,1,1),Eh(this.layoutVertexArray,E,M,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,{},g)}}function Cp(s,t){for(let l=0;l<s.length;l++)if(wc(t,s[l]))return!0;for(let l=0;l<t.length;l++)if(wc(s,t[l]))return!0;return!!Df(s,t)}function gb(s,t,l){return!!wc(s,t)||!!Ff(t,s,l)}function Ep(s,t){if(s.length===1)return Ap(t,s[0]);for(let l=0;l<t.length;l++){const h=t[l];for(let g=0;g<h.length;g++)if(wc(s,h[g]))return!0}for(let l=0;l<s.length;l++)if(Ap(t,s[l]))return!0;for(let l=0;l<t.length;l++)if(Df(s,t[l]))return!0;return!1}function _b(s,t,l){if(s.length>1){if(Df(s,t))return!0;for(let h=0;h<t.length;h++)if(Ff(t[h],s,l))return!0}for(let h=0;h<s.length;h++)if(Ff(s[h],t,l))return!0;return!1}function Df(s,t){if(s.length===0||t.length===0)return!1;for(let l=0;l<s.length-1;l++){const h=s[l],g=s[l+1];for(let w=0;w<t.length-1;w++)if(yb(h,g,t[w],t[w+1]))return!0}return!1}function yb(s,t,l,h){return fe(s,l,h)!==fe(t,l,h)&&fe(s,t,l)!==fe(s,t,h)}function Ff(s,t,l){const h=l*l;if(t.length===1)return s.distSqr(t[0])<h;for(let g=1;g<t.length;g++)if(Ip(s,t[g-1],t[g])<h)return!0;return!1}function Ip(s,t,l){const h=t.distSqr(l);if(h===0)return s.distSqr(t);const g=((s.x-t.x)*(l.x-t.x)+(s.y-t.y)*(l.y-t.y))/h;return s.distSqr(g<0?t:g>1?l:l.sub(t)._mult(g)._add(t))}function Ap(s,t){let l,h,g,w=!1;for(let x=0;x<s.length;x++){l=s[x];for(let E=0,M=l.length-1;E<l.length;M=E++)h=l[E],g=l[M],h.y>t.y!=g.y>t.y&&t.x<(g.x-h.x)*(t.y-h.y)/(g.y-h.y)+h.x&&(w=!w)}return w}function wc(s,t){let l=!1;for(let h=0,g=s.length-1;h<s.length;g=h++){const w=s[h],x=s[g];w.y>t.y!=x.y>t.y&&t.x<(x.x-w.x)*(t.y-w.y)/(x.y-w.y)+w.x&&(l=!l)}return l}function bb(s,t,l){const h=l[0],g=l[2];if(s.x<h.x&&t.x<h.x||s.x>g.x&&t.x>g.x||s.y<h.y&&t.y<h.y||s.y>g.y&&t.y>g.y)return!1;const w=fe(s,t,l[0]);return w!==fe(s,t,l[1])||w!==fe(s,t,l[2])||w!==fe(s,t,l[3])}function Eu(s,t,l){const h=t.paint.get(s).value;return h.kind==="constant"?h.value:l.programConfigurations.get(t.id).getMaxValue(s)}function Ih(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Ah(s,t,l,h,g){if(!t[0]&&!t[1])return s;const w=y.convert(t)._mult(g);l==="viewport"&&w._rotate(-h);const x=[];for(let E=0;E<s.length;E++)x.push(s[E].sub(w));return x}let Mp,Pp;Ut("CircleBucket",Of,{omit:["layers"]});var vb={get paint(){return Pp=Pp||new v({"circle-radius":new fi(Ye.paint_circle["circle-radius"]),"circle-color":new fi(Ye.paint_circle["circle-color"]),"circle-blur":new fi(Ye.paint_circle["circle-blur"]),"circle-opacity":new fi(Ye.paint_circle["circle-opacity"]),"circle-translate":new Kt(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Kt(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Kt(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Kt(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fi(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fi(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fi(Ye.paint_circle["circle-stroke-opacity"])})},get layout(){return Mp=Mp||new v({"circle-sort-key":new fi(Ye.layout_circle["circle-sort-key"])})}},Ar=1e-6,xc=typeof Float32Array<"u"?Float32Array:Array;function Rf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Lp(s,t,l){var h=t[0],g=t[1],w=t[2],x=t[3],E=t[4],M=t[5],D=t[6],V=t[7],G=t[8],Q=t[9],ne=t[10],le=t[11],pe=t[12],Ce=t[13],Pe=t[14],tt=t[15],Ue=l[0],Je=l[1],at=l[2],wt=l[3];return s[0]=Ue*h+Je*E+at*G+wt*pe,s[1]=Ue*g+Je*M+at*Q+wt*Ce,s[2]=Ue*w+Je*D+at*ne+wt*Pe,s[3]=Ue*x+Je*V+at*le+wt*tt,s[4]=(Ue=l[4])*h+(Je=l[5])*E+(at=l[6])*G+(wt=l[7])*pe,s[5]=Ue*g+Je*M+at*Q+wt*Ce,s[6]=Ue*w+Je*D+at*ne+wt*Pe,s[7]=Ue*x+Je*V+at*le+wt*tt,s[8]=(Ue=l[8])*h+(Je=l[9])*E+(at=l[10])*G+(wt=l[11])*pe,s[9]=Ue*g+Je*M+at*Q+wt*Ce,s[10]=Ue*w+Je*D+at*ne+wt*Pe,s[11]=Ue*x+Je*V+at*le+wt*tt,s[12]=(Ue=l[12])*h+(Je=l[13])*E+(at=l[14])*G+(wt=l[15])*pe,s[13]=Ue*g+Je*M+at*Q+wt*Ce,s[14]=Ue*w+Je*D+at*ne+wt*Pe,s[15]=Ue*x+Je*V+at*le+wt*tt,s}Math.hypot||(Math.hypot=function(){for(var s=0,t=arguments.length;t--;)s+=arguments[t]*arguments[t];return Math.sqrt(s)});var Iu,wb=Lp;function Mh(s,t,l){var h=t[0],g=t[1],w=t[2],x=t[3];return s[0]=l[0]*h+l[4]*g+l[8]*w+l[12]*x,s[1]=l[1]*h+l[5]*g+l[9]*w+l[13]*x,s[2]=l[2]*h+l[6]*g+l[10]*w+l[14]*x,s[3]=l[3]*h+l[7]*g+l[11]*w+l[15]*x,s}Iu=new xc(4),xc!=Float32Array&&(Iu[0]=0,Iu[1]=0,Iu[2]=0,Iu[3]=0);class xb extends c{constructor(t){super(t,vb)}createBucket(t){return new Of(t)}queryRadius(t){const l=t;return Eu("circle-radius",this,l)+Eu("circle-stroke-width",this,l)+Ih(this.paint.get("circle-translate"))}queryIntersectsFeature(t,l,h,g,w,x,E,M){const D=Ah(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,E),V=this.paint.get("circle-radius").evaluate(l,h)+this.paint.get("circle-stroke-width").evaluate(l,h),G=this.paint.get("circle-pitch-alignment")==="map",Q=G?D:function(le,pe){return le.map(Ce=>zp(Ce,pe))}(D,M),ne=G?V*E:V;for(const le of g)for(const pe of le){const Ce=G?pe:zp(pe,M);let Pe=ne;const tt=Mh([],[pe.x,pe.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=tt[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=x.cameraToCenterDistance/tt[3]),gb(Q,Ce,Pe))return!0}return!1}}function zp(s,t){const l=Mh([],[s.x,s.y,0,1],t);return new y(l[0]/l[3],l[1]/l[3])}class Op extends Of{}let Dp;Ut("HeatmapBucket",Op,{omit:["layers"]});var Sb={get paint(){return Dp=Dp||new v({"heatmap-radius":new fi(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fi(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Kt(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tu(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Kt(Ye.paint_heatmap["heatmap-opacity"])})}};function Bf(s,{width:t,height:l},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==t*l*h)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${t*l*h}`)}else g=new Uint8Array(t*l*h);return s.width=t,s.height=l,s.data=g,s}function Fp(s,{width:t,height:l},h){if(t===s.width&&l===s.height)return;const g=Bf({},{width:t,height:l},h);Nf(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,t),height:Math.min(s.height,l)},h),s.width=t,s.height=l,s.data=g.data}function Nf(s,t,l,h,g,w){if(g.width===0||g.height===0)return t;if(g.width>s.width||g.height>s.height||l.x>s.width-g.width||l.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>t.width||g.height>t.height||h.x>t.width-g.width||h.y>t.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,E=t.data;if(x===E)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<g.height;M++){const D=((l.y+M)*s.width+l.x)*w,V=((h.y+M)*t.width+h.x)*w;for(let G=0;G<g.width*w;G++)E[V+G]=x[D+G]}return t}class Au{constructor(t,l){Bf(this,t,1,l)}resize(t){Fp(this,t,1)}clone(){return new Au({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,h,g,w){Nf(t,l,h,g,w,1)}}class _s{constructor(t,l){Bf(this,t,4,l)}resize(t){Fp(this,t,4)}replace(t,l){l?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new _s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,h,g,w){Nf(t,l,h,g,w,4)}}function Rp(s){const t={},l=s.resolution||256,h=s.clips?s.clips.length:1,g=s.image||new _s({width:l,height:h});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const w=(x,E,M)=>{t[s.evaluationKey]=M;const D=s.expression.evaluate(t);g.data[x+E+0]=Math.floor(255*D.r/D.a),g.data[x+E+1]=Math.floor(255*D.g/D.a),g.data[x+E+2]=Math.floor(255*D.b/D.a),g.data[x+E+3]=Math.floor(255*D.a)};if(s.clips)for(let x=0,E=0;x<h;++x,E+=4*l)for(let M=0,D=0;M<l;M++,D+=4){const V=M/(l-1),{start:G,end:Q}=s.clips[x];w(E,D,G*(1-V)+Q*V)}else for(let x=0,E=0;x<l;x++,E+=4)w(0,E,x/(l-1));return g}Ut("AlphaImage",Au),Ut("RGBAImage",_s);const jf="big-fb";class Tb extends c{createBucket(t){return new Op(t)}constructor(t){super(t,Sb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(jf)&&this.heatmapFbos.delete(jf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Bp;var kb={get paint(){return Bp=Bp||new v({"hillshade-illumination-direction":new Kt(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Kt(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Kt(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Kt(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Kt(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Kt(Ye.paint_hillshade["hillshade-accent-color"])})}};class Cb extends c{constructor(t){super(t,kb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Eb=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ib}=Eb;function Np(s,t,l=2){const h=t&&t.length,g=h?t[0]*l:s.length;let w=jp(s,0,g,l,!0);const x=[];if(!w||w.next===w.prev)return x;let E,M,D;if(h&&(w=function(V,G,Q,ne){const le=[];for(let pe=0,Ce=G.length;pe<Ce;pe++){const Pe=jp(V,G[pe]*ne,pe<Ce-1?G[pe+1]*ne:V.length,ne,!1);Pe===Pe.next&&(Pe.steiner=!0),le.push(Fb(Pe))}le.sort(zb);for(let pe=0;pe<le.length;pe++)Q=Ob(le[pe],Q);return Q}(s,t,w,l)),s.length>80*l){E=1/0,M=1/0;let V=-1/0,G=-1/0;for(let Q=l;Q<g;Q+=l){const ne=s[Q],le=s[Q+1];ne<E&&(E=ne),le<M&&(M=le),ne>V&&(V=ne),le>G&&(G=le)}D=Math.max(V-E,G-M),D=D!==0?32767/D:0}return Mu(w,x,l,E,M,D,0),x}function jp(s,t,l,h,g){let w;if(g===function(x,E,M,D){let V=0;for(let G=E,Q=M-D;G<M;G+=D)V+=(x[Q]-x[G])*(x[G+1]+x[Q+1]),Q=G;return V}(s,t,l,h)>0)for(let x=t;x<l;x+=h)w=qp(x/h|0,s[x],s[x+1],w);else for(let x=l-h;x>=t;x-=h)w=qp(x/h|0,s[x],s[x+1],w);return w&&Ph(w,w.next)&&(Lu(w),w=w.next),w}function Ml(s,t){if(!s)return s;t||(t=s);let l,h=s;do if(l=!1,h.steiner||!Ph(h,h.next)&&Dn(h.prev,h,h.next)!==0)h=h.next;else{if(Lu(h),h=t=h.prev,h===h.next)break;l=!0}while(l||h!==t);return t}function Mu(s,t,l,h,g,w,x){if(!s)return;!x&&w&&function(M,D,V,G){let Q=M;do Q.z===0&&(Q.z=Uf(Q.x,Q.y,D,V,G)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==M);Q.prevZ.nextZ=null,Q.prevZ=null,function(ne){let le,pe=1;do{let Ce,Pe=ne;ne=null;let tt=null;for(le=0;Pe;){le++;let Ue=Pe,Je=0;for(let wt=0;wt<pe&&(Je++,Ue=Ue.nextZ,Ue);wt++);let at=pe;for(;Je>0||at>0&&Ue;)Je!==0&&(at===0||!Ue||Pe.z<=Ue.z)?(Ce=Pe,Pe=Pe.nextZ,Je--):(Ce=Ue,Ue=Ue.nextZ,at--),tt?tt.nextZ=Ce:ne=Ce,Ce.prevZ=tt,tt=Ce;Pe=Ue}tt.nextZ=null,pe*=2}while(le>1)}(Q)}(s,h,g,w);let E=s;for(;s.prev!==s.next;){const M=s.prev,D=s.next;if(w?Mb(s,h,g,w):Ab(s))t.push(M.i,s.i,D.i),Lu(s),s=D.next,E=D.next;else if((s=D)===E){x?x===1?Mu(s=Pb(Ml(s),t),t,l,h,g,w,2):x===2&&Lb(s,t,l,h,g,w):Mu(Ml(s),t,l,h,g,w,1);break}}}function Ab(s){const t=s.prev,l=s,h=s.next;if(Dn(t,l,h)>=0)return!1;const g=t.x,w=l.x,x=h.x,E=t.y,M=l.y,D=h.y,V=g<w?g<x?g:x:w<x?w:x,G=E<M?E<D?E:D:M<D?M:D,Q=g>w?g>x?g:x:w>x?w:x,ne=E>M?E>D?E:D:M>D?M:D;let le=h.next;for(;le!==t;){if(le.x>=V&&le.x<=Q&&le.y>=G&&le.y<=ne&&Sc(g,E,w,M,x,D,le.x,le.y)&&Dn(le.prev,le,le.next)>=0)return!1;le=le.next}return!0}function Mb(s,t,l,h){const g=s.prev,w=s,x=s.next;if(Dn(g,w,x)>=0)return!1;const E=g.x,M=w.x,D=x.x,V=g.y,G=w.y,Q=x.y,ne=E<M?E<D?E:D:M<D?M:D,le=V<G?V<Q?V:Q:G<Q?G:Q,pe=E>M?E>D?E:D:M>D?M:D,Ce=V>G?V>Q?V:Q:G>Q?G:Q,Pe=Uf(ne,le,t,l,h),tt=Uf(pe,Ce,t,l,h);let Ue=s.prevZ,Je=s.nextZ;for(;Ue&&Ue.z>=Pe&&Je&&Je.z<=tt;){if(Ue.x>=ne&&Ue.x<=pe&&Ue.y>=le&&Ue.y<=Ce&&Ue!==g&&Ue!==x&&Sc(E,V,M,G,D,Q,Ue.x,Ue.y)&&Dn(Ue.prev,Ue,Ue.next)>=0||(Ue=Ue.prevZ,Je.x>=ne&&Je.x<=pe&&Je.y>=le&&Je.y<=Ce&&Je!==g&&Je!==x&&Sc(E,V,M,G,D,Q,Je.x,Je.y)&&Dn(Je.prev,Je,Je.next)>=0))return!1;Je=Je.nextZ}for(;Ue&&Ue.z>=Pe;){if(Ue.x>=ne&&Ue.x<=pe&&Ue.y>=le&&Ue.y<=Ce&&Ue!==g&&Ue!==x&&Sc(E,V,M,G,D,Q,Ue.x,Ue.y)&&Dn(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.prevZ}for(;Je&&Je.z<=tt;){if(Je.x>=ne&&Je.x<=pe&&Je.y>=le&&Je.y<=Ce&&Je!==g&&Je!==x&&Sc(E,V,M,G,D,Q,Je.x,Je.y)&&Dn(Je.prev,Je,Je.next)>=0)return!1;Je=Je.nextZ}return!0}function Pb(s,t){let l=s;do{const h=l.prev,g=l.next.next;!Ph(h,g)&&Up(h,l,l.next,g)&&Pu(h,g)&&Pu(g,h)&&(t.push(h.i,l.i,g.i),Lu(l),Lu(l.next),l=s=g),l=l.next}while(l!==s);return Ml(l)}function Lb(s,t,l,h,g,w){let x=s;do{let E=x.next.next;for(;E!==x.prev;){if(x.i!==E.i&&Rb(x,E)){let M=Vp(x,E);return x=Ml(x,x.next),M=Ml(M,M.next),Mu(x,t,l,h,g,w,0),void Mu(M,t,l,h,g,w,0)}E=E.next}x=x.next}while(x!==s)}function zb(s,t){return s.x-t.x}function Ob(s,t){const l=function(g,w){let x=w;const E=g.x,M=g.y;let D,V=-1/0;do{if(M<=x.y&&M>=x.next.y&&x.next.y!==x.y){const pe=x.x+(M-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(pe<=E&&pe>V&&(V=pe,D=x.x<x.next.x?x:x.next,pe===E))return D}x=x.next}while(x!==w);if(!D)return null;const G=D,Q=D.x,ne=D.y;let le=1/0;x=D;do{if(E>=x.x&&x.x>=Q&&E!==x.x&&Sc(M<ne?E:V,M,Q,ne,M<ne?V:E,M,x.x,x.y)){const pe=Math.abs(M-x.y)/(E-x.x);Pu(x,g)&&(pe<le||pe===le&&(x.x>D.x||x.x===D.x&&Db(D,x)))&&(D=x,le=pe)}x=x.next}while(x!==G);return D}(s,t);if(!l)return t;const h=Vp(l,s);return Ml(h,h.next),Ml(l,l.next)}function Db(s,t){return Dn(s.prev,s,t.prev)<0&&Dn(t.next,s,s.next)<0}function Uf(s,t,l,h,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-h)*g|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Fb(s){let t=s,l=s;do(t.x<l.x||t.x===l.x&&t.y<l.y)&&(l=t),t=t.next;while(t!==s);return l}function Sc(s,t,l,h,g,w,x,E){return(g-x)*(t-E)>=(s-x)*(w-E)&&(s-x)*(h-E)>=(l-x)*(t-E)&&(l-x)*(w-E)>=(g-x)*(h-E)}function Rb(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(l,h){let g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==h.i&&g.next.i!==h.i&&Up(g,g.next,l,h))return!0;g=g.next}while(g!==l);return!1}(s,t)&&(Pu(s,t)&&Pu(t,s)&&function(l,h){let g=l,w=!1;const x=(l.x+h.x)/2,E=(l.y+h.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&x<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==l);return w}(s,t)&&(Dn(s.prev,s,t.prev)||Dn(s,t.prev,t))||Ph(s,t)&&Dn(s.prev,s,s.next)>0&&Dn(t.prev,t,t.next)>0)}function Dn(s,t,l){return(t.y-s.y)*(l.x-t.x)-(t.x-s.x)*(l.y-t.y)}function Ph(s,t){return s.x===t.x&&s.y===t.y}function Up(s,t,l,h){const g=zh(Dn(s,t,l)),w=zh(Dn(s,t,h)),x=zh(Dn(l,h,s)),E=zh(Dn(l,h,t));return g!==w&&x!==E||!(g!==0||!Lh(s,l,t))||!(w!==0||!Lh(s,h,t))||!(x!==0||!Lh(l,s,h))||!(E!==0||!Lh(l,t,h))}function Lh(s,t,l){return t.x<=Math.max(s.x,l.x)&&t.x>=Math.min(s.x,l.x)&&t.y<=Math.max(s.y,l.y)&&t.y>=Math.min(s.y,l.y)}function zh(s){return s>0?1:s<0?-1:0}function Pu(s,t){return Dn(s.prev,s,s.next)<0?Dn(s,t,s.next)>=0&&Dn(s,s.prev,t)>=0:Dn(s,t,s.prev)<0||Dn(s,s.next,t)<0}function Vp(s,t){const l=Vf(s.i,s.x,s.y),h=Vf(t.i,t.x,t.y),g=s.next,w=t.prev;return s.next=t,t.prev=s,l.next=g,g.prev=l,h.next=l,l.prev=h,w.next=h,h.prev=w,h}function qp(s,t,l,h){const g=Vf(s,t,l);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function Lu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Vf(s,t,l){return{i:s,x:t,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function qf(s,t,l){const h=l.patternDependencies;let g=!1;for(const w of t){const x=w.paint.get(`${s}-pattern`);x.isConstant()||(g=!0);const E=x.constantOr(null);E&&(g=!0,h[E.to]=!0,h[E.from]=!0)}return g}function Zf(s,t,l,h,g){const w=g.patternDependencies;for(const x of t){const E=x.paint.get(`${s}-pattern`).value;if(E.kind!=="constant"){let M=E.evaluate({zoom:h-1},l,{},g.availableImages),D=E.evaluate({zoom:h},l,{},g.availableImages),V=E.evaluate({zoom:h+1},l,{},g.availableImages);M=M&&M.name?M.name:M,D=D&&D.name?D.name:D,V=V&&V.name?V.name:V,w[M]=!0,w[D]=!0,w[V]=!0,l.patterns[x.id]={min:M,mid:D,max:V}}}return l}class Wf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Rs,this.indexArray=new gs,this.indexArray2=new $n,this.programConfigurations=new El(t.layers,t.zoom),this.segments=new Ui,this.segments2=new Ui,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h){this.hasPattern=qf("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),x=[];for(const{feature:E,id:M,index:D,sourceLayerIndex:V}of t){const G=this.layers[0]._featureFilter.needGeometry,Q=Al(E,G);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),Q,h))continue;const ne=w?g.evaluate(Q,{},h,l.availableImages):void 0,le={id:M,properties:E.properties,type:E.type,sourceLayerIndex:V,index:D,geometry:G?Q.geometry:Il(E),patterns:{},sortKey:ne};x.push(le)}w&&x.sort((E,M)=>E.sortKey-M.sortKey);for(const E of x){const{geometry:M,index:D,sourceLayerIndex:V}=E;if(this.hasPattern){const G=Zf("fill",this.layers,E,this.zoom,l);this.patternFeatures.push(G)}else this.addFeature(E,M,D,h,{});l.featureIndex.insert(t[D].feature,M,D,V,this.index)}}update(t,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h)}addFeatures(t,l,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ib),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,l,h,g,w){for(const x of Ta(l,500)){let E=0;for(const ne of x)E+=ne.length;const M=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),D=M.vertexLength,V=[],G=[];for(const ne of x){if(ne.length===0)continue;ne!==x[0]&&G.push(V.length/2);const le=this.segments2.prepareSegment(ne.length,this.layoutVertexArray,this.indexArray2),pe=le.vertexLength;this.layoutVertexArray.emplaceBack(ne[0].x,ne[0].y),this.indexArray2.emplaceBack(pe+ne.length-1,pe),V.push(ne[0].x),V.push(ne[0].y);for(let Ce=1;Ce<ne.length;Ce++)this.layoutVertexArray.emplaceBack(ne[Ce].x,ne[Ce].y),this.indexArray2.emplaceBack(pe+Ce-1,pe+Ce),V.push(ne[Ce].x),V.push(ne[Ce].y);le.vertexLength+=ne.length,le.primitiveLength+=ne.length}const Q=Np(V,G);for(let ne=0;ne<Q.length;ne+=3)this.indexArray.emplaceBack(D+Q[ne],D+Q[ne+1],D+Q[ne+2]);M.vertexLength+=E,M.primitiveLength+=Q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,w,g)}}let Zp,Wp;Ut("FillBucket",Wf,{omit:["layers","patternFeatures"]});var Bb={get paint(){return Wp=Wp||new v({"fill-antialias":new Kt(Ye.paint_fill["fill-antialias"]),"fill-opacity":new fi(Ye.paint_fill["fill-opacity"]),"fill-color":new fi(Ye.paint_fill["fill-color"]),"fill-outline-color":new fi(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Kt(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Kt(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new dc(Ye.paint_fill["fill-pattern"])})},get layout(){return Zp=Zp||new v({"fill-sort-key":new fi(Ye.layout_fill["fill-sort-key"])})}};class Nb extends c{constructor(t){super(t,Bb)}recalculate(t,l){super.recalculate(t,l);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Wf(t)}queryRadius(){return Ih(this.paint.get("fill-translate"))}queryIntersectsFeature(t,l,h,g,w,x,E){return Ep(Ah(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,E),g)}isTileClipped(){return!0}}const jb=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ub=A([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Vb}=jb;var Wa={},qb=S,Gp=Tc;function Tc(s,t,l,h,g){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=g,s.readFields(Zb,this,t)}function Zb(s,t,l){s==1?t.id=l.readVarint():s==2?function(h,g){for(var w=h.readVarint()+h.pos;h.pos<w;){var x=g._keys[h.readVarint()],E=g._values[h.readVarint()];g.properties[x]=E}}(l,t):s==3?t.type=l.readVarint():s==4&&(t._geometry=l.pos)}function Wb(s){for(var t,l,h=0,g=0,w=s.length,x=w-1;g<w;x=g++)h+=((l=s[x]).x-(t=s[g]).x)*(t.y+l.y);return h}Tc.types=["Unknown","Point","LineString","Polygon"],Tc.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var t,l=s.readVarint()+s.pos,h=1,g=0,w=0,x=0,E=[];s.pos<l;){if(g<=0){var M=s.readVarint();h=7&M,g=M>>3}if(g--,h===1||h===2)w+=s.readSVarint(),x+=s.readSVarint(),h===1&&(t&&E.push(t),t=[]),t.push(new qb(w,x));else{if(h!==7)throw new Error("unknown command "+h);t&&t.push(t[0].clone())}}return t&&E.push(t),E},Tc.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var t=s.readVarint()+s.pos,l=1,h=0,g=0,w=0,x=1/0,E=-1/0,M=1/0,D=-1/0;s.pos<t;){if(h<=0){var V=s.readVarint();l=7&V,h=V>>3}if(h--,l===1||l===2)(g+=s.readSVarint())<x&&(x=g),g>E&&(E=g),(w+=s.readSVarint())<M&&(M=w),w>D&&(D=w);else if(l!==7)throw new Error("unknown command "+l)}return[x,M,E,D]},Tc.prototype.toGeoJSON=function(s,t,l){var h,g,w=this.extent*Math.pow(2,l),x=this.extent*s,E=this.extent*t,M=this.loadGeometry(),D=Tc.types[this.type];function V(ne){for(var le=0;le<ne.length;le++){var pe=ne[le];ne[le]=[360*(pe.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+E)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<M.length;h++)G[h]=M[h][0];V(M=G);break;case 2:for(h=0;h<M.length;h++)V(M[h]);break;case 3:for(M=function(ne){var le=ne.length;if(le<=1)return[ne];for(var pe,Ce,Pe=[],tt=0;tt<le;tt++){var Ue=Wb(ne[tt]);Ue!==0&&(Ce===void 0&&(Ce=Ue<0),Ce===Ue<0?(pe&&Pe.push(pe),pe=[ne[tt]]):pe.push(ne[tt]))}return pe&&Pe.push(pe),Pe}(M),h=0;h<M.length;h++)for(g=0;g<M[h].length;g++)V(M[h][g])}M.length===1?M=M[0]:D="Multi"+D;var Q={type:"Feature",geometry:{type:D,coordinates:M},properties:this.properties};return"id"in this&&(Q.id=this.id),Q};var Gb=Gp,Hp=Xp;function Xp(s,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Hb,this,t),this.length=this._features.length}function Hb(s,t,l){s===15?t.version=l.readVarint():s===1?t.name=l.readString():s===5?t.extent=l.readVarint():s===2?t._features.push(l.pos):s===3?t._keys.push(l.readString()):s===4&&t._values.push(function(h){for(var g=null,w=h.readVarint()+h.pos;h.pos<w;){var x=h.readVarint()>>3;g=x===1?h.readString():x===2?h.readFloat():x===3?h.readDouble():x===4?h.readVarint64():x===5?h.readVarint():x===6?h.readSVarint():x===7?h.readBoolean():null}return g}(l))}Xp.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var t=this._pbf.readVarint()+this._pbf.pos;return new Gb(this._pbf,t,this.extent,this._keys,this._values)};var Xb=Hp;function Kb(s,t,l){if(s===3){var h=new Xb(l,l.readVarint()+l.pos);h.length&&(t[h.name]=h)}}Wa.VectorTile=function(s,t){this.layers=s.readFields(Kb,{},t)},Wa.VectorTileFeature=Gp,Wa.VectorTileLayer=Hp;const Jb=Wa.VectorTileFeature.types,Gf=Math.pow(2,13);function zu(s,t,l,h,g,w,x,E){s.emplaceBack(t,l,2*Math.floor(h*Gf)+x,g*Gf*2,w*Gf*2,Math.round(E))}class Hf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Na,this.centroidVertexArray=new sr,this.indexArray=new gs,this.programConfigurations=new El(t.layers,t.zoom),this.segments=new Ui,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h){this.features=[],this.hasPattern=qf("fill-extrusion",this.layers,l);for(const{feature:g,id:w,index:x,sourceLayerIndex:E}of t){const M=this.layers[0]._featureFilter.needGeometry,D=Al(g,M);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),D,h))continue;const V={id:w,sourceLayerIndex:E,index:x,geometry:M?D.geometry:Il(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Zf("fill-extrusion",this.layers,V,this.zoom,l)):this.addFeature(V,V.geometry,x,h,{}),l.featureIndex.insert(g,V.geometry,x,E,this.index,!0)}}addFeatures(t,l,h){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,l,h)}}update(t,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vb),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ub.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,l,h,g,w){for(const x of Ta(l,500)){const E={x:0,y:0,vertexCount:0};let M=0;for(const le of x)M+=le.length;let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const le of x){if(le.length===0||Qb(le))continue;let pe=0;for(let Ce=0;Ce<le.length;Ce++){const Pe=le[Ce];if(Ce>=1){const tt=le[Ce-1];if(!Yb(Pe,tt)){D.vertexLength+4>Ui.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ue=Pe.sub(tt)._perp()._unit(),Je=tt.dist(Pe);pe+Je>32768&&(pe=0),zu(this.layoutVertexArray,Pe.x,Pe.y,Ue.x,Ue.y,0,0,pe),zu(this.layoutVertexArray,Pe.x,Pe.y,Ue.x,Ue.y,0,1,pe),E.x+=2*Pe.x,E.y+=2*Pe.y,E.vertexCount+=2,pe+=Je,zu(this.layoutVertexArray,tt.x,tt.y,Ue.x,Ue.y,0,0,pe),zu(this.layoutVertexArray,tt.x,tt.y,Ue.x,Ue.y,0,1,pe),E.x+=2*tt.x,E.y+=2*tt.y,E.vertexCount+=2;const at=D.vertexLength;this.indexArray.emplaceBack(at,at+2,at+1),this.indexArray.emplaceBack(at+1,at+2,at+3),D.vertexLength+=4,D.primitiveLength+=2}}}}if(D.vertexLength+M>Ui.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),Jb[t.type]!=="Polygon")continue;const V=[],G=[],Q=D.vertexLength;for(const le of x)if(le.length!==0){le!==x[0]&&G.push(V.length/2);for(let pe=0;pe<le.length;pe++){const Ce=le[pe];zu(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),E.x+=Ce.x,E.y+=Ce.y,E.vertexCount+=1,V.push(Ce.x),V.push(Ce.y)}}const ne=Np(V,G);for(let le=0;le<ne.length;le+=3)this.indexArray.emplaceBack(Q+ne[le],Q+ne[le+2],Q+ne[le+1]);D.primitiveLength+=ne.length/3,D.vertexLength+=M;for(let le=0;le<E.vertexCount;le++){const pe=Math.floor(E.x/E.vertexCount),Ce=Math.floor(E.y/E.vertexCount);this.centroidVertexArray.emplaceBack(pe,Ce)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,w,g)}}function Yb(s,t){return s.x===t.x&&(s.x<0||s.x>Nn)||s.y===t.y&&(s.y<0||s.y>Nn)}function Qb(s){return s.every(t=>t.x<0)||s.every(t=>t.x>Nn)||s.every(t=>t.y<0)||s.every(t=>t.y>Nn)}let Kp;Ut("FillExtrusionBucket",Hf,{omit:["layers","features"]});var $b={get paint(){return Kp=Kp||new v({"fill-extrusion-opacity":new Kt(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fi(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Kt(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Kt(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new dc(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fi(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fi(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Kt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ev extends c{constructor(t){super(t,$b)}createBucket(t){return new Hf(t)}queryRadius(){return Ih(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,l,h,g,w,x,E,M){const D=Ah(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,E),V=this.paint.get("fill-extrusion-height").evaluate(l,h),G=this.paint.get("fill-extrusion-base").evaluate(l,h),Q=function(le,pe,Ce,Pe){const tt=[];for(const Ue of le){const Je=[Ue.x,Ue.y,0,1];Mh(Je,Je,pe),tt.push(new y(Je[0]/Je[3],Je[1]/Je[3]))}return tt}(D,M),ne=function(le,pe,Ce,Pe){const tt=[],Ue=[],Je=Pe[8]*pe,at=Pe[9]*pe,wt=Pe[10]*pe,Bt=Pe[11]*pe,hi=Pe[8]*Ce,Ft=Pe[9]*Ce,Ot=Pe[10]*Ce,$t=Pe[11]*Ce;for(const qt of le){const jt=[],dt=[];for(const ei of qt){const Qt=ei.x,yi=ei.y,an=Pe[0]*Qt+Pe[4]*yi+Pe[12],rn=Pe[1]*Qt+Pe[5]*yi+Pe[13],Xn=Pe[2]*Qt+Pe[6]*yi+Pe[14],Bs=Pe[3]*Qt+Pe[7]*yi+Pe[15],lr=Xn+wt,Kn=Bs+Bt,Mr=an+hi,Pr=rn+Ft,Lr=Xn+Ot,Ln=Bs+$t,Jn=new y((an+Je)/Kn,(rn+at)/Kn);Jn.z=lr/Kn,jt.push(Jn);const vr=new y(Mr/Ln,Pr/Ln);vr.z=Lr/Ln,dt.push(vr)}tt.push(jt),Ue.push(dt)}return[tt,Ue]}(g,G,V,M);return function(le,pe,Ce){let Pe=1/0;Ep(Ce,pe)&&(Pe=Jp(Ce,pe[0]));for(let tt=0;tt<pe.length;tt++){const Ue=pe[tt],Je=le[tt];for(let at=0;at<Ue.length-1;at++){const wt=Ue[at],Bt=[wt,Ue[at+1],Je[at+1],Je[at],wt];Cp(Ce,Bt)&&(Pe=Math.min(Pe,Jp(Ce,Bt)))}}return Pe!==1/0&&Pe}(ne[0],ne[1],Q)}}function Ou(s,t){return s.x*t.x+s.y*t.y}function Jp(s,t){if(s.length===1){let l=0;const h=t[l++];let g;for(;!g||h.equals(g);)if(g=t[l++],!g)return 1/0;for(;l<t.length;l++){const w=t[l],x=s[0],E=g.sub(h),M=w.sub(h),D=x.sub(h),V=Ou(E,E),G=Ou(E,M),Q=Ou(M,M),ne=Ou(D,E),le=Ou(D,M),pe=V*Q-G*G,Ce=(Q*ne-G*le)/pe,Pe=(V*le-G*ne)/pe,tt=h.z*(1-Ce-Pe)+g.z*Ce+w.z*Pe;if(isFinite(tt))return tt}return 1/0}{let l=1/0;for(const h of t)l=Math.min(l,h.z);return l}}const tv=A([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:iv}=tv,nv=A([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rv}=nv,sv=Wa.VectorTileFeature.types,ov=Math.cos(Math.PI/180*37.5),Yp=Math.pow(2,14)/.5;class Xf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new mc,this.layoutVertexArray2=new ja,this.indexArray=new gs,this.programConfigurations=new El(t.layers,t.zoom),this.segments=new Ui,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h){this.hasPattern=qf("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),x=[];for(const{feature:E,id:M,index:D,sourceLayerIndex:V}of t){const G=this.layers[0]._featureFilter.needGeometry,Q=Al(E,G);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),Q,h))continue;const ne=w?g.evaluate(Q,{},h):void 0,le={id:M,properties:E.properties,type:E.type,sourceLayerIndex:V,index:D,geometry:G?Q.geometry:Il(E),patterns:{},sortKey:ne};x.push(le)}w&&x.sort((E,M)=>E.sortKey-M.sortKey);for(const E of x){const{geometry:M,index:D,sourceLayerIndex:V}=E;if(this.hasPattern){const G=Zf("line",this.layers,E,this.zoom,l);this.patternFeatures.push(G)}else this.addFeature(E,M,D,h,{});l.featureIndex.insert(t[D].feature,M,D,V,this.index)}}update(t,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h)}addFeatures(t,l,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,rv)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iv),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,l,h,g,w){const x=this.layers[0].layout,E=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),D=x.get("line-miter-limit"),V=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const G of l)this.addLine(G,t,E,M,D,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,w,g)}addLine(t,l,h,g,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<t.length-1;Pe++)this.totalDistance+=t[Pe].dist(t[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=sv[l.type]==="Polygon";let M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let D=0;for(;D<M-1&&t[D].equals(t[D+1]);)D++;if(M<(E?3:2))return;h==="bevel"&&(w=1.05);const V=this.overscaling<=16?15*Nn/(512*this.overscaling):0,G=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let Q,ne,le,pe,Ce;this.e1=this.e2=-1,E&&(Q=t[M-2],Ce=t[D].sub(Q)._unit()._perp());for(let Pe=D;Pe<M;Pe++){if(le=Pe===M-1?E?t[D+1]:void 0:t[Pe+1],le&&t[Pe].equals(le))continue;Ce&&(pe=Ce),Q&&(ne=Q),Q=t[Pe],Ce=le?le.sub(Q)._unit()._perp():pe,pe=pe||Ce;let tt=pe.add(Ce);tt.x===0&&tt.y===0||tt._unit();const Ue=pe.x*Ce.x+pe.y*Ce.y,Je=tt.x*Ce.x+tt.y*Ce.y,at=Je!==0?1/Je:1/0,wt=2*Math.sqrt(2-2*Je),Bt=Je<ov&&ne&&le,hi=pe.x*Ce.y-pe.y*Ce.x>0;if(Bt&&Pe>D){const $t=Q.dist(ne);if($t>2*V){const qt=Q.sub(Q.sub(ne)._mult(V/$t)._round());this.updateDistance(ne,qt),this.addCurrentVertex(qt,pe,0,0,G),ne=qt}}const Ft=ne&&le;let Ot=Ft?h:E?"butt":g;if(Ft&&Ot==="round"&&(at<x?Ot="miter":at<=2&&(Ot="fakeround")),Ot==="miter"&&at>w&&(Ot="bevel"),Ot==="bevel"&&(at>2&&(Ot="flipbevel"),at<w&&(Ot="miter")),ne&&this.updateDistance(ne,Q),Ot==="miter")tt._mult(at),this.addCurrentVertex(Q,tt,0,0,G);else if(Ot==="flipbevel"){if(at>100)tt=Ce.mult(-1);else{const $t=at*pe.add(Ce).mag()/pe.sub(Ce).mag();tt._perp()._mult($t*(hi?-1:1))}this.addCurrentVertex(Q,tt,0,0,G),this.addCurrentVertex(Q,tt.mult(-1),0,0,G)}else if(Ot==="bevel"||Ot==="fakeround"){const $t=-Math.sqrt(at*at-1),qt=hi?$t:0,jt=hi?0:$t;if(ne&&this.addCurrentVertex(Q,pe,qt,jt,G),Ot==="fakeround"){const dt=Math.round(180*wt/Math.PI/20);for(let ei=1;ei<dt;ei++){let Qt=ei/dt;if(Qt!==.5){const an=Qt-.5;Qt+=Qt*an*(Qt-1)*((1.0904+Ue*(Ue*(3.55645-1.43519*Ue)-3.2452))*an*an+(.848013+Ue*(.215638*Ue-1.06021)))}const yi=Ce.sub(pe)._mult(Qt)._add(pe)._unit()._mult(hi?-1:1);this.addHalfVertex(Q,yi.x,yi.y,!1,hi,0,G)}}le&&this.addCurrentVertex(Q,Ce,-qt,-jt,G)}else if(Ot==="butt")this.addCurrentVertex(Q,tt,0,0,G);else if(Ot==="square"){const $t=ne?1:-1;this.addCurrentVertex(Q,tt,$t,$t,G)}else Ot==="round"&&(ne&&(this.addCurrentVertex(Q,pe,0,0,G),this.addCurrentVertex(Q,pe,1,1,G,!0)),le&&(this.addCurrentVertex(Q,Ce,-1,-1,G,!0),this.addCurrentVertex(Q,Ce,0,0,G)));if(Bt&&Pe<M-1){const $t=Q.dist(le);if($t>2*V){const qt=Q.add(le.sub(Q)._mult(V/$t)._round());this.updateDistance(Q,qt),this.addCurrentVertex(qt,Ce,0,0,G),Q=qt}}}}addCurrentVertex(t,l,h,g,w,x=!1){const E=l.y*g-l.x,M=-l.y-l.x*g;this.addHalfVertex(t,l.x+l.y*h,l.y-l.x*h,x,!1,h,w),this.addHalfVertex(t,E,M,x,!0,-g,w),this.distance>Yp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,l,h,g,w,x))}addHalfVertex({x:t,y:l},h,g,w,x,E,M){const D=.5*(this.lineClips?this.scaledDistance*(Yp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(w?1:0),(l<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const V=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),M.primitiveLength++),x?this.e2=V:this.e1=V}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,l){this.distance+=t.dist(l),this.updateScaledDistance()}}let Qp,$p;Ut("LineBucket",Xf,{omit:["layers","patternFeatures"]});var em={get paint(){return $p=$p||new v({"line-opacity":new fi(Ye.paint_line["line-opacity"]),"line-color":new fi(Ye.paint_line["line-color"]),"line-translate":new Kt(Ye.paint_line["line-translate"]),"line-translate-anchor":new Kt(Ye.paint_line["line-translate-anchor"]),"line-width":new fi(Ye.paint_line["line-width"]),"line-gap-width":new fi(Ye.paint_line["line-gap-width"]),"line-offset":new fi(Ye.paint_line["line-offset"]),"line-blur":new fi(Ye.paint_line["line-blur"]),"line-dasharray":new pc(Ye.paint_line["line-dasharray"]),"line-pattern":new dc(Ye.paint_line["line-pattern"]),"line-gradient":new Tu(Ye.paint_line["line-gradient"])})},get layout(){return Qp=Qp||new v({"line-cap":new Kt(Ye.layout_line["line-cap"]),"line-join":new fi(Ye.layout_line["line-join"]),"line-miter-limit":new Kt(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Kt(Ye.layout_line["line-round-limit"]),"line-sort-key":new fi(Ye.layout_line["line-sort-key"])})}};class av extends fi{possiblyEvaluate(t,l){return l=new mn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(t,l)}evaluate(t,l,h,g){return l=re({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(t,l,h,g)}}let Oh;class lv extends c{constructor(t){super(t,em),this.gradientVersion=0,Oh||(Oh=new av(em.paint.properties["line-width"].specification),Oh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof po,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,l){super.recalculate(t,l),this.paint._values["line-floorwidth"]=Oh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Xf(t)}queryRadius(t){const l=t,h=tm(Eu("line-width",this,l),Eu("line-gap-width",this,l)),g=Eu("line-offset",this,l);return h/2+Math.abs(g)+Ih(this.paint.get("line-translate"))}queryIntersectsFeature(t,l,h,g,w,x,E){const M=Ah(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,E),D=E/2*tm(this.paint.get("line-width").evaluate(l,h),this.paint.get("line-gap-width").evaluate(l,h)),V=this.paint.get("line-offset").evaluate(l,h);return V&&(g=function(G,Q){const ne=[];for(let le=0;le<G.length;le++){const pe=G[le],Ce=[];for(let Pe=0;Pe<pe.length;Pe++){const tt=pe[Pe-1],Ue=pe[Pe],Je=pe[Pe+1],at=Pe===0?new y(0,0):Ue.sub(tt)._unit()._perp(),wt=Pe===pe.length-1?new y(0,0):Je.sub(Ue)._unit()._perp(),Bt=at._add(wt)._unit(),hi=Bt.x*wt.x+Bt.y*wt.y;hi!==0&&Bt._mult(1/hi),Ce.push(Bt._mult(Q)._add(Ue))}ne.push(Ce)}return ne}(g,V*E)),function(G,Q,ne){for(let le=0;le<Q.length;le++){const pe=Q[le];if(G.length>=3){for(let Ce=0;Ce<pe.length;Ce++)if(wc(G,pe[Ce]))return!0}if(_b(G,pe,ne))return!0}return!1}(M,g,D)}isTileClipped(){return!0}}function tm(s,t){return t>0?t+2*s:s}const cv=A([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uv=A([{name:"a_projected_pos",components:3,type:"Float32"}],4);A([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hv=A([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);A([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const im=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),fv=A([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function dv(s,t,l){return s.sections.forEach(h=>{h.text=function(g,w,x){const E=w.layout.get("text-transform").evaluate(x,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),Vr.applyArabicShaping&&(g=Vr.applyArabicShaping(g)),g}(h.text,t,l)}),s}A([{name:"triangle",components:3,type:"Uint16"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),A([{type:"Float32",name:"offsetX"}]),A([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),A([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Du={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var qn=24,nm=nn,rm=function(s,t,l,h,g){var w,x,E=8*g-h-1,M=(1<<E)-1,D=M>>1,V=-7,G=g-1,Q=-1,ne=s[t+G];for(G+=Q,w=ne&(1<<-V)-1,ne>>=-V,V+=E;V>0;w=256*w+s[t+G],G+=Q,V-=8);for(x=w&(1<<-V)-1,w>>=-V,V+=h;V>0;x=256*x+s[t+G],G+=Q,V-=8);if(w===0)w=1-D;else{if(w===M)return x?NaN:1/0*(ne?-1:1);x+=Math.pow(2,h),w-=D}return(ne?-1:1)*x*Math.pow(2,w-h)},sm=function(s,t,l,h,g,w){var x,E,M,D=8*w-g-1,V=(1<<D)-1,G=V>>1,Q=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=0,le=1,pe=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(E=isNaN(t)?1:0,x=V):(x=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-x))<1&&(x--,M*=2),(t+=x+G>=1?Q/M:Q*Math.pow(2,1-G))*M>=2&&(x++,M/=2),x+G>=V?(E=0,x=V):x+G>=1?(E=(t*M-1)*Math.pow(2,g),x+=G):(E=t*Math.pow(2,G-1)*Math.pow(2,g),x=0));g>=8;s[l+ne]=255&E,ne+=le,E/=256,g-=8);for(x=x<<g|E,D+=g;D>0;s[l+ne]=255&x,ne+=le,x/=256,D-=8);s[l+ne-le]|=128*pe};function nn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}nn.Varint=0,nn.Fixed64=1,nn.Bytes=2,nn.Fixed32=5;var Kf=4294967296,om=1/Kf,am=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function aa(s){return s.type===nn.Bytes?s.readVarint()+s.pos:s.pos+1}function kc(s,t,l){return l?4294967296*t+(s>>>0):4294967296*(t>>>0)+(s>>>0)}function lm(s,t,l){var h=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));l.realloc(h);for(var g=l.pos-1;g>=s;g--)l.buf[g+h]=l.buf[g]}function pv(s,t){for(var l=0;l<s.length;l++)t.writeVarint(s[l])}function mv(s,t){for(var l=0;l<s.length;l++)t.writeSVarint(s[l])}function gv(s,t){for(var l=0;l<s.length;l++)t.writeFloat(s[l])}function _v(s,t){for(var l=0;l<s.length;l++)t.writeDouble(s[l])}function yv(s,t){for(var l=0;l<s.length;l++)t.writeBoolean(s[l])}function bv(s,t){for(var l=0;l<s.length;l++)t.writeFixed32(s[l])}function vv(s,t){for(var l=0;l<s.length;l++)t.writeSFixed32(s[l])}function wv(s,t){for(var l=0;l<s.length;l++)t.writeFixed64(s[l])}function xv(s,t){for(var l=0;l<s.length;l++)t.writeSFixed64(s[l])}function Dh(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+16777216*s[t+3]}function Cc(s,t,l){s[l]=t,s[l+1]=t>>>8,s[l+2]=t>>>16,s[l+3]=t>>>24}function cm(s,t){return(s[t]|s[t+1]<<8|s[t+2]<<16)+(s[t+3]<<24)}nn.prototype={destroy:function(){this.buf=null},readFields:function(s,t,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),g=h>>3,w=this.pos;this.type=7&h,s(g,t,this),this.pos===w&&this.skip(h)}return t},readMessage:function(s,t){return this.readFields(s,t,this.readVarint()+this.pos)},readFixed32:function(){var s=Dh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=cm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Dh(this.buf,this.pos)+Dh(this.buf,this.pos+4)*Kf;return this.pos+=8,s},readSFixed64:function(){var s=Dh(this.buf,this.pos)+cm(this.buf,this.pos+4)*Kf;return this.pos+=8,s},readFloat:function(){var s=rm(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=rm(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var t,l,h=this.buf;return t=127&(l=h[this.pos++]),l<128?t:(t|=(127&(l=h[this.pos++]))<<7,l<128?t:(t|=(127&(l=h[this.pos++]))<<14,l<128?t:(t|=(127&(l=h[this.pos++]))<<21,l<128?t:function(g,w,x){var E,M,D=x.buf;if(E=(112&(M=D[x.pos++]))>>4,M<128||(E|=(127&(M=D[x.pos++]))<<3,M<128)||(E|=(127&(M=D[x.pos++]))<<10,M<128)||(E|=(127&(M=D[x.pos++]))<<17,M<128)||(E|=(127&(M=D[x.pos++]))<<24,M<128)||(E|=(1&(M=D[x.pos++]))<<31,M<128))return kc(g,E,w);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(l=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,t=this.pos;return this.pos=s,s-t>=12&&am?function(l,h,g){return am.decode(l.subarray(h,g))}(this.buf,t,s):function(l,h,g){for(var w="",x=h;x<g;){var E,M,D,V=l[x],G=null,Q=V>239?4:V>223?3:V>191?2:1;if(x+Q>g)break;Q===1?V<128&&(G=V):Q===2?(192&(E=l[x+1]))==128&&(G=(31&V)<<6|63&E)<=127&&(G=null):Q===3?(M=l[x+2],(192&(E=l[x+1]))==128&&(192&M)==128&&((G=(15&V)<<12|(63&E)<<6|63&M)<=2047||G>=55296&&G<=57343)&&(G=null)):Q===4&&(M=l[x+2],D=l[x+3],(192&(E=l[x+1]))==128&&(192&M)==128&&(192&D)==128&&((G=(15&V)<<18|(63&E)<<12|(63&M)<<6|63&D)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,Q=1):G>65535&&(G-=65536,w+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),w+=String.fromCharCode(G),x+=Q}return w}(this.buf,t,s)},readBytes:function(){var s=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,s);return this.pos=s,t},readPackedVarint:function(s,t){if(this.type!==nn.Bytes)return s.push(this.readVarint(t));var l=aa(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(t));return s},readPackedSVarint:function(s){if(this.type!==nn.Bytes)return s.push(this.readSVarint());var t=aa(this);for(s=s||[];this.pos<t;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==nn.Bytes)return s.push(this.readBoolean());var t=aa(this);for(s=s||[];this.pos<t;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==nn.Bytes)return s.push(this.readFloat());var t=aa(this);for(s=s||[];this.pos<t;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==nn.Bytes)return s.push(this.readDouble());var t=aa(this);for(s=s||[];this.pos<t;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==nn.Bytes)return s.push(this.readFixed32());var t=aa(this);for(s=s||[];this.pos<t;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==nn.Bytes)return s.push(this.readSFixed32());var t=aa(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==nn.Bytes)return s.push(this.readFixed64());var t=aa(this);for(s=s||[];this.pos<t;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==nn.Bytes)return s.push(this.readSFixed64());var t=aa(this);for(s=s||[];this.pos<t;)s.push(this.readSFixed64());return s},skip:function(s){var t=7&s;if(t===nn.Varint)for(;this.buf[this.pos++]>127;);else if(t===nn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===nn.Fixed32)this.pos+=4;else{if(t!==nn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(s,t){this.writeVarint(s<<3|t)},realloc:function(s){for(var t=this.length||16;t<this.pos+s;)t*=2;if(t!==this.length){var l=new Uint8Array(t);l.set(this.buf),this.buf=l,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Cc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Cc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Cc(this.buf,-1&s,this.pos),Cc(this.buf,Math.floor(s*om),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Cc(this.buf,-1&s,this.pos),Cc(this.buf,Math.floor(s*om),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(t,l){var h,g;if(t>=0?(h=t%4294967296|0,g=t/4294967296|0):(g=~(-t/4294967296),4294967295^(h=~(-t%4294967296))?h=h+1|0:(h=0,g=g+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(w,x,E){E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,E.buf[E.pos]=127&(w>>>=7)}(h,0,l),function(w,x){var E=(7&w)<<4;x.buf[x.pos++]|=E|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(g,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var t=this.pos;this.pos=function(h,g,w){for(var x,E,M=0;M<g.length;M++){if((x=g.charCodeAt(M))>55295&&x<57344){if(!E){x>56319||M+1===g.length?(h[w++]=239,h[w++]=191,h[w++]=189):E=x;continue}if(x<56320){h[w++]=239,h[w++]=191,h[w++]=189,E=x;continue}x=E-55296<<10|x-56320|65536,E=null}else E&&(h[w++]=239,h[w++]=191,h[w++]=189,E=null);x<128?h[w++]=x:(x<2048?h[w++]=x>>6|192:(x<65536?h[w++]=x>>12|224:(h[w++]=x>>18|240,h[w++]=x>>12&63|128),h[w++]=x>>6&63|128),h[w++]=63&x|128)}return w}(this.buf,s,this.pos);var l=this.pos-t;l>=128&&lm(t,l,this),this.pos=t-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),sm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),sm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var t=s.length;this.writeVarint(t),this.realloc(t);for(var l=0;l<t;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,t){this.pos++;var l=this.pos;s(t,this);var h=this.pos-l;h>=128&&lm(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,t,l){this.writeTag(s,nn.Bytes),this.writeRawMessage(t,l)},writePackedVarint:function(s,t){t.length&&this.writeMessage(s,pv,t)},writePackedSVarint:function(s,t){t.length&&this.writeMessage(s,mv,t)},writePackedBoolean:function(s,t){t.length&&this.writeMessage(s,yv,t)},writePackedFloat:function(s,t){t.length&&this.writeMessage(s,gv,t)},writePackedDouble:function(s,t){t.length&&this.writeMessage(s,_v,t)},writePackedFixed32:function(s,t){t.length&&this.writeMessage(s,bv,t)},writePackedSFixed32:function(s,t){t.length&&this.writeMessage(s,vv,t)},writePackedFixed64:function(s,t){t.length&&this.writeMessage(s,wv,t)},writePackedSFixed64:function(s,t){t.length&&this.writeMessage(s,xv,t)},writeBytesField:function(s,t){this.writeTag(s,nn.Bytes),this.writeBytes(t)},writeFixed32Field:function(s,t){this.writeTag(s,nn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(s,t){this.writeTag(s,nn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(s,t){this.writeTag(s,nn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(s,t){this.writeTag(s,nn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(s,t){this.writeTag(s,nn.Varint),this.writeVarint(t)},writeSVarintField:function(s,t){this.writeTag(s,nn.Varint),this.writeSVarint(t)},writeStringField:function(s,t){this.writeTag(s,nn.Bytes),this.writeString(t)},writeFloatField:function(s,t){this.writeTag(s,nn.Fixed32),this.writeFloat(t)},writeDoubleField:function(s,t){this.writeTag(s,nn.Fixed64),this.writeDouble(t)},writeBooleanField:function(s,t){this.writeVarintField(s,!!t)}};var Jf=_(nm);const Yf=3;function Sv(s,t,l){s===1&&l.readMessage(Tv,t)}function Tv(s,t,l){if(s===3){const{id:h,bitmap:g,width:w,height:x,left:E,top:M,advance:D}=l.readMessage(kv,{});t.push({id:h,bitmap:new Au({width:w+2*Yf,height:x+2*Yf},g),metrics:{width:w,height:x,left:E,top:M,advance:D}})}}function kv(s,t,l){s===1?t.id=l.readVarint():s===2?t.bitmap=l.readBytes():s===3?t.width=l.readVarint():s===4?t.height=l.readVarint():s===5?t.left=l.readSVarint():s===6?t.top=l.readSVarint():s===7&&(t.advance=l.readVarint())}const um=Yf;function hm(s){let t=0,l=0;for(const x of s)t+=x.w*x.h,l=Math.max(l,x.w);s.sort((x,E)=>E.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),l),h:1/0}];let g=0,w=0;for(const x of s)for(let E=h.length-1;E>=0;E--){const M=h[E];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,w=Math.max(w,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===M.w&&x.h===M.h){const D=h.pop();E<h.length&&(h[E]=D)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(h.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:g,h:w,fill:t/(g*w)||0}}const Zr=1;class Qf{constructor(t,{pixelRatio:l,version:h,stretchX:g,stretchY:w,content:x,textFitWidth:E,textFitHeight:M}){this.paddedRect=t,this.pixelRatio=l,this.stretchX=g,this.stretchY=w,this.content=x,this.version=h,this.textFitWidth=E,this.textFitHeight=M}get tl(){return[this.paddedRect.x+Zr,this.paddedRect.y+Zr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Zr,this.paddedRect.y+this.paddedRect.h-Zr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Zr)/this.pixelRatio,(this.paddedRect.h-2*Zr)/this.pixelRatio]}}class fm{constructor(t,l){const h={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(t,h,w),this.addImages(l,g,w);const{w:x,h:E}=hm(w),M=new _s({width:x||1,height:E||1});for(const D in t){const V=t[D],G=h[D].paddedRect;_s.copy(V.data,M,{x:0,y:0},{x:G.x+Zr,y:G.y+Zr},V.data)}for(const D in l){const V=l[D],G=g[D].paddedRect,Q=G.x+Zr,ne=G.y+Zr,le=V.data.width,pe=V.data.height;_s.copy(V.data,M,{x:0,y:0},{x:Q,y:ne},V.data),_s.copy(V.data,M,{x:0,y:pe-1},{x:Q,y:ne-1},{width:le,height:1}),_s.copy(V.data,M,{x:0,y:0},{x:Q,y:ne+pe},{width:le,height:1}),_s.copy(V.data,M,{x:le-1,y:0},{x:Q-1,y:ne},{width:1,height:pe}),_s.copy(V.data,M,{x:0,y:0},{x:Q+le,y:ne},{width:1,height:pe})}this.image=M,this.iconPositions=h,this.patternPositions=g}addImages(t,l,h){for(const g in t){const w=t[g],x={x:0,y:0,w:w.data.width+2*Zr,h:w.data.height+2*Zr};h.push(x),l[g]=new Qf(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(t,l){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in t.updatedImages)this.patchUpdatedImage(this.iconPositions[h],t.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],t.getImage(h),l)}patchUpdatedImage(t,l,h){if(!t||!l||t.version===l.version)return;t.version=l.version;const[g,w]=t.tl;h.update(l.data,void 0,{x:g,y:w})}}var Ga;Ut("ImagePosition",Qf),Ut("ImageAtlas",fm),f.ah=void 0,(Ga=f.ah||(f.ah={}))[Ga.none=0]="none",Ga[Ga.horizontal=1]="horizontal",Ga[Ga.vertical=2]="vertical",Ga[Ga.horizontalOnly=3]="horizontalOnly";const Fu=-17;class Ru{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,l){const h=new Ru;return h.scale=t||1,h.fontStack=l,h}static forImage(t){const l=new Ru;return l.imageName=t,l}}class Ec{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,l){const h=new Ec;for(let g=0;g<t.sections.length;g++){const w=t.sections[g];w.image?h.addImageSection(w):h.addTextSection(w,l)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let l="";for(let h=0;h<t.length;h++){const g=t.charCodeAt(h+1)||null,w=t.charCodeAt(h-1)||null;l+=g&&wh(g)&&!Du[t[h+1]]||w&&wh(w)&&!Du[t[h-1]]||!Du[t[h]]?t[h]:Du[t[h]]}return l}(this.text)}trim(){let t=0;for(let h=0;h<this.text.length&&Rh[this.text.charCodeAt(h)];h++)t++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=t&&Rh[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(t,l),this.sectionIndex=this.sectionIndex.slice(t,l)}substring(t,l){const h=new Ec;return h.text=this.text.substring(t,l),h.sectionIndex=this.sectionIndex.slice(t,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,l)=>Math.max(t,this.sections[l].scale),0)}addTextSection(t,l){this.text+=t.text,this.sections.push(Ru.forText(t.scale,t.fontStack||l));const h=this.sections.length-1;for(let g=0;g<t.text.length;++g)this.sectionIndex.push(h)}addImageSection(t){const l=t.image?t.image.name:"";if(l.length===0)return void ce("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Ru.forImage(l)),this.sectionIndex.push(this.sections.length-1)):ce("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fh(s,t,l,h,g,w,x,E,M,D,V,G,Q,ne,le){const pe=Ec.fromFeature(s,g);let Ce;G===f.ah.vertical&&pe.verticalizePunctuation();const{processBidirectionalText:Pe,processStyledBidirectionalText:tt}=Vr;if(Pe&&pe.sections.length===1){Ce=[];const at=Pe(pe.toString(),$f(pe,D,w,t,h,ne));for(const wt of at){const Bt=new Ec;Bt.text=wt,Bt.sections=pe.sections;for(let hi=0;hi<wt.length;hi++)Bt.sectionIndex.push(0);Ce.push(Bt)}}else if(tt){Ce=[];const at=tt(pe.text,pe.sectionIndex,$f(pe,D,w,t,h,ne));for(const wt of at){const Bt=new Ec;Bt.text=wt[0],Bt.sectionIndex=wt[1],Bt.sections=pe.sections,Ce.push(Bt)}}else Ce=function(at,wt){const Bt=[],hi=at.text;let Ft=0;for(const Ot of wt)Bt.push(at.substring(Ft,Ot)),Ft=Ot;return Ft<hi.length&&Bt.push(at.substring(Ft,hi.length)),Bt}(pe,$f(pe,D,w,t,h,ne));const Ue=[],Je={positionedLines:Ue,text:pe.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(at,wt,Bt,hi,Ft,Ot,$t,qt,jt,dt,ei,Qt){let yi=0,an=Fu,rn=0,Xn=0;const Bs=qt==="right"?1:qt==="left"?0:.5;let lr=0;for(const Ln of Ft){Ln.trim();const Jn=Ln.getMaxScale(),vr=(Jn-1)*qn,cr={positionedGlyphs:[],lineOffset:0};at.positionedLines[lr]=cr;const zr=cr.positionedGlyphs;let ur=0;if(!Ln.length()){an+=Ot,++lr;continue}for(let Wr=0;Wr<Ln.length();Wr++){const Yi=Ln.getSection(Wr),fn=Ln.getSectionIndex(Wr),bn=Ln.getCharCode(Wr);let os=0,An=null,Pc=null,Mo=null,Po=qn;const Ns=!(jt===f.ah.horizontal||!ei&&!xu(bn)||ei&&(Rh[bn]||(Kn=bn,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Kn)))));if(Yi.imageName){const vs=hi[Yi.imageName];if(!vs)continue;Mo=Yi.imageName,at.iconsInText=at.iconsInText||!0,Pc=vs.paddedRect;const er=vs.displaySize;Yi.scale=Yi.scale*qn/Qt,An={width:er[0],height:er[1],left:Zr,top:-um,advance:Ns?er[1]:er[0]},os=vr+(qn-er[1]*Yi.scale),Po=An.advance;const la=Ns?er[0]*Yi.scale-qn*Jn:er[1]*Yi.scale-qn*Jn;la>0&&la>ur&&(ur=la)}else{const vs=Bt[Yi.fontStack],er=vs&&vs[bn];if(er&&er.rect)Pc=er.rect,An=er.metrics;else{const la=wt[Yi.fontStack],qu=la&&la[bn];if(!qu)continue;An=qu.metrics}os=(Jn-Yi.scale)*qn}Ns?(at.verticalizable=!0,zr.push({glyph:bn,imageName:Mo,x:yi,y:an+os,vertical:Ns,scale:Yi.scale,fontStack:Yi.fontStack,sectionIndex:fn,metrics:An,rect:Pc}),yi+=Po*Yi.scale+dt):(zr.push({glyph:bn,imageName:Mo,x:yi,y:an+os,vertical:Ns,scale:Yi.scale,fontStack:Yi.fontStack,sectionIndex:fn,metrics:An,rect:Pc}),yi+=An.advance*Yi.scale+dt)}zr.length!==0&&(rn=Math.max(yi-dt,rn),Av(zr,0,zr.length-1,Bs,ur)),yi=0;const bs=Ot*Jn+ur;cr.lineOffset=Math.max(ur,vr),an+=bs,Xn=Math.max(bs,Xn),++lr}var Kn;const Mr=an-Fu,{horizontalAlign:Pr,verticalAlign:Lr}=ed($t);(function(Ln,Jn,vr,cr,zr,ur,bs,Wr,Yi){const fn=(Jn-vr)*zr;let bn=0;bn=ur!==bs?-Wr*cr-Fu:(-cr*Yi+.5)*bs;for(const os of Ln)for(const An of os.positionedGlyphs)An.x+=fn,An.y+=bn})(at.positionedLines,Bs,Pr,Lr,rn,Xn,Ot,Mr,Ft.length),at.top+=-Lr*Mr,at.bottom=at.top+Mr,at.left+=-Pr*rn,at.right=at.left+rn}(Je,t,l,h,Ce,x,E,M,G,D,Q,le),!function(at){for(const wt of at)if(wt.positionedGlyphs.length!==0)return!1;return!0}(Ue)&&Je}const Rh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ev={40:!0};function dm(s,t,l,h,g,w){if(t.imageName){const x=h[t.imageName];return x?x.displaySize[0]*t.scale*qn/w+g:0}{const x=l[t.fontStack],E=x&&x[s];return E?E.metrics.advance*t.scale+g:0}}function pm(s,t,l,h){const g=Math.pow(s-t,2);return h?s<t?g/2:2*g:g+Math.abs(l)*l}function Iv(s,t,l){let h=0;return s===10&&(h-=1e4),l&&(h+=150),s!==40&&s!==65288||(h+=50),t!==41&&t!==65289||(h+=50),h}function mm(s,t,l,h,g,w){let x=null,E=pm(t,l,g,w);for(const M of h){const D=pm(t-M.x,l,g,w)+M.badness;D<=E&&(x=M,E=D)}return{index:s,x:t,priorBreak:x,badness:E}}function gm(s){return s?gm(s.priorBreak).concat(s.index):[]}function $f(s,t,l,h,g,w){if(!s)return[];const x=[],E=function(G,Q,ne,le,pe,Ce){let Pe=0;for(let tt=0;tt<G.length();tt++){const Ue=G.getSection(tt);Pe+=dm(G.getCharCode(tt),Ue,le,pe,Q,Ce)}return Pe/Math.max(1,Math.ceil(Pe/ne))}(s,t,l,h,g,w),M=s.text.indexOf("")>=0;let D=0;for(let G=0;G<s.length();G++){const Q=s.getSection(G),ne=s.getCharCode(G);if(Rh[ne]||(D+=dm(ne,Q,h,g,t,w)),G<s.length()-1){const le=!((V=ne)<11904)&&(!!ji["CJK Compatibility Forms"](V)||!!ji["CJK Compatibility"](V)||!!ji["CJK Strokes"](V)||!!ji["CJK Symbols and Punctuation"](V)||!!ji["Enclosed CJK Letters and Months"](V)||!!ji["Halfwidth and Fullwidth Forms"](V)||!!ji["Ideographic Description Characters"](V)||!!ji["Vertical Forms"](V)||vh.test(String.fromCodePoint(V)));(Cv[ne]||le||Q.imageName||G!==s.length()-2&&Ev[s.getCharCode(G+1)])&&x.push(mm(G+1,D,E,x,Iv(ne,s.getCharCode(G+1),le&&M),!1))}}var V;return gm(mm(s.length(),D,E,x,0,!0))}function ed(s){let t=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:t,verticalAlign:l}}function Av(s,t,l,h,g){if(!h&&!g)return;const w=s[l],x=(s[l].x+w.metrics.advance*w.scale)*h;for(let E=t;E<=l;E++)s[E].x-=x,s[E].y+=g}function Mv(s,t,l){const{horizontalAlign:h,verticalAlign:g}=ed(l),w=t[0]-s.displaySize[0]*h,x=t[1]-s.displaySize[1]*g;return{image:s,top:x,bottom:x+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function _m(s){var t,l;let h=s.left,g=s.top,w=s.right-h,x=s.bottom-g;const E=(t=s.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",M=(l=s.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",D=(s.image.content[2]-s.image.content[0])/(s.image.content[3]-s.image.content[1]);if(M==="proportional"){if(E==="stretchOnly"&&w/x<D||E==="proportional"){const V=Math.ceil(x*D);h*=V/w,w=V}}else if(E==="proportional"&&M==="stretchOnly"&&D!==0&&w/x>D){const V=Math.ceil(w/D);g*=V/x,x=V}return{x1:h,y1:g,x2:h+w,y2:g+x}}function ym(s,t,l,h,g,w){const x=s.image;let E;if(x.content){const Ce=x.content,Pe=x.pixelRatio||1;E=[Ce[0]/Pe,Ce[1]/Pe,x.displaySize[0]-Ce[2]/Pe,x.displaySize[1]-Ce[3]/Pe]}const M=t.left*w,D=t.right*w;let V,G,Q,ne;l==="width"||l==="both"?(ne=g[0]+M-h[3],G=g[0]+D+h[1]):(ne=g[0]+(M+D-x.displaySize[0])/2,G=ne+x.displaySize[0]);const le=t.top*w,pe=t.bottom*w;return l==="height"||l==="both"?(V=g[1]+le-h[0],Q=g[1]+pe+h[2]):(V=g[1]+(le+pe-x.displaySize[1])/2,Q=V+x.displaySize[1]),{image:x,top:V,right:G,bottom:Q,left:ne,collisionPadding:E}}const Bu=255,Ao=128,Ha=Bu*Ao;function bm(s,t){const{expression:l}=t;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new mn(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=l;let w=0;for(;w<h.length&&h[w]<=s;)w++;w=Math.max(0,w-1);let x=w;for(;x<h.length&&h[x]<s+1;)x++;x=Math.min(h.length-1,x);const E=h[w],M=h[x];return l.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:M,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:M,minSize:l.evaluate(new mn(E)),maxSize:l.evaluate(new mn(M)),interpolationType:g}}}function td(s,t,l){let h="never";const g=s.get(t);return g?h=g:s.get(l)&&(h="always"),h}const Pv=Wa.VectorTileFeature.types,Lv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bh(s,t,l,h,g,w,x,E,M,D,V,G,Q){const ne=E?Math.min(Ha,Math.round(E[0])):0,le=E?Math.min(Ha,Math.round(E[1])):0;s.emplaceBack(t,l,Math.round(32*h),Math.round(32*g),w,x,(ne<<1)+(M?1:0),le,16*D,16*V,256*G,256*Q)}function id(s,t,l){s.emplaceBack(t.x,t.y,l),s.emplaceBack(t.x,t.y,l),s.emplaceBack(t.x,t.y,l),s.emplaceBack(t.x,t.y,l)}function zv(s){for(const t of s.sections)if(Mf(t.text))return!0;return!1}class nd{constructor(t){this.layoutVertexArray=new gc,this.indexArray=new gs,this.programConfigurations=t,this.segments=new Ui,this.dynamicLayoutVertexArray=new ku,this.opacityVertexArray=new rs,this.hasVisibleVertices=!1,this.placedSymbolArray=new gn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,l,h,g){this.isEmpty()||(h&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cv.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,uv.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Lv,!0),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ut("SymbolBuffers",nd);class rd{constructor(t,l,h){this.layoutVertexArray=new t,this.layoutAttributes=l,this.indexArray=new h,this.segments=new Ui,this.collisionVertexArray=new Eo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,hv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ut("CollisionBuffers",rd);class Ic{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rf([]),this.placementViewportMatrix=Rf([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bm(this.zoom,l["text-size"]),this.iconSizeData=bm(this.zoom,l["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),w=h.get("symbol-z-order");this.canOverlap=td(h,"text-overlap","text-allow-overlap")!=="never"||td(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(x=>f.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new nd(new El(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new nd(new El(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new _n,this.lineVertexArray=new rr,this.symbolInstances=new Ni,this.textAnchorOffsets=new yn}calculateGlyphDependencies(t,l,h,g,w){for(let x=0;x<t.length;x++)if(l[t.charCodeAt(x)]=!0,(h||g)&&w){const E=Du[t.charAt(x)];E&&(l[E.charCodeAt(0)]=!0)}}populate(t,l,h){const g=this.layers[0],w=g.layout,x=w.get("text-font"),E=w.get("text-field"),M=w.get("icon-image"),D=(E.value.kind!=="constant"||E.value.value instanceof Un&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),V=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,G=w.get("symbol-sort-key");if(this.features=[],!D&&!V)return;const Q=l.iconDependencies,ne=l.glyphDependencies,le=l.availableImages,pe=new mn(this.zoom);for(const{feature:Ce,id:Pe,index:tt,sourceLayerIndex:Ue}of t){const Je=g._featureFilter.needGeometry,at=Al(Ce,Je);if(!g._featureFilter.filter(pe,at,h))continue;let wt,Bt;if(Je||(at.geometry=Il(Ce)),D){const Ft=g.getValueAndResolveTokens("text-field",at,h,le),Ot=Un.factory(Ft),$t=this.hasRTLText=this.hasRTLText||zv(Ot);(!$t||Vr.getRTLTextPluginStatus()==="unavailable"||$t&&Vr.isParsed())&&(wt=dv(Ot,g,at))}if(V){const Ft=g.getValueAndResolveTokens("icon-image",at,h,le);Bt=Ft instanceof Hn?Ft:Hn.fromString(Ft)}if(!wt&&!Bt)continue;const hi=this.sortFeaturesByKey?G.evaluate(at,{},h):void 0;if(this.features.push({id:Pe,text:wt,icon:Bt,index:tt,sourceLayerIndex:Ue,geometry:at.geometry,properties:Ce.properties,type:Pv[Ce.type],sortKey:hi}),Bt&&(Q[Bt.name]=!0),wt){const Ft=x.evaluate(at,{},h).join(","),Ot=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ah.vertical)>=0;for(const $t of wt.sections)if($t.image)Q[$t.image.name]=!0;else{const qt=vu(wt.toString()),jt=$t.fontStack||Ft,dt=ne[jt]=ne[jt]||{};this.calculateGlyphDependencies($t.text,dt,Ot,this.allowVerticalPlacement,qt)}}}w.get("symbol-placement")==="line"&&(this.features=function(Ce){const Pe={},tt={},Ue=[];let Je=0;function at(Ft){Ue.push(Ce[Ft]),Je++}function wt(Ft,Ot,$t){const qt=tt[Ft];return delete tt[Ft],tt[Ot]=qt,Ue[qt].geometry[0].pop(),Ue[qt].geometry[0]=Ue[qt].geometry[0].concat($t[0]),qt}function Bt(Ft,Ot,$t){const qt=Pe[Ot];return delete Pe[Ot],Pe[Ft]=qt,Ue[qt].geometry[0].shift(),Ue[qt].geometry[0]=$t[0].concat(Ue[qt].geometry[0]),qt}function hi(Ft,Ot,$t){const qt=$t?Ot[0][Ot[0].length-1]:Ot[0][0];return`${Ft}:${qt.x}:${qt.y}`}for(let Ft=0;Ft<Ce.length;Ft++){const Ot=Ce[Ft],$t=Ot.geometry,qt=Ot.text?Ot.text.toString():null;if(!qt){at(Ft);continue}const jt=hi(qt,$t),dt=hi(qt,$t,!0);if(jt in tt&&dt in Pe&&tt[jt]!==Pe[dt]){const ei=Bt(jt,dt,$t),Qt=wt(jt,dt,Ue[ei].geometry);delete Pe[jt],delete tt[dt],tt[hi(qt,Ue[Qt].geometry,!0)]=Qt,Ue[ei].geometry=null}else jt in tt?wt(jt,dt,$t):dt in Pe?Bt(jt,dt,$t):(at(Ft),Pe[jt]=Je-1,tt[dt]=Je-1)}return Ue.filter(Ft=>Ft.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Pe)=>Ce.sortKey-Pe.sortKey)}update(t,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,l,this.layers,h),this.icon.programConfigurations.updatePaintArrays(t,l,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,l){const h=this.lineVertexArray.length;if(t.segment!==void 0){let g=t.dist(l[t.segment+1]),w=t.dist(l[t.segment]);const x={};for(let E=t.segment+1;E<l.length;E++)x[E]={x:l[E].x,y:l[E].y,tileUnitDistanceFromAnchor:g},E<l.length-1&&(g+=l[E+1].dist(l[E]));for(let E=t.segment||0;E>=0;E--)x[E]={x:l[E].x,y:l[E].y,tileUnitDistanceFromAnchor:w},E>0&&(w+=l[E-1].dist(l[E]));for(let E=0;E<l.length;E++){const M=x[E];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(t,l,h,g,w,x,E,M,D,V,G,Q){const ne=t.indexArray,le=t.layoutVertexArray,pe=t.segments.prepareSegment(4*l.length,le,ne,this.canOverlap?x.sortKey:void 0),Ce=this.glyphOffsetArray.length,Pe=pe.vertexLength,tt=this.allowVerticalPlacement&&E===f.ah.vertical?Math.PI/2:0,Ue=x.text&&x.text.sections;for(let Je=0;Je<l.length;Je++){const{tl:at,tr:wt,bl:Bt,br:hi,tex:Ft,pixelOffsetTL:Ot,pixelOffsetBR:$t,minFontScaleX:qt,minFontScaleY:jt,glyphOffset:dt,isSDF:ei,sectionIndex:Qt}=l[Je],yi=pe.vertexLength,an=dt[1];Bh(le,M.x,M.y,at.x,an+at.y,Ft.x,Ft.y,h,ei,Ot.x,Ot.y,qt,jt),Bh(le,M.x,M.y,wt.x,an+wt.y,Ft.x+Ft.w,Ft.y,h,ei,$t.x,Ot.y,qt,jt),Bh(le,M.x,M.y,Bt.x,an+Bt.y,Ft.x,Ft.y+Ft.h,h,ei,Ot.x,$t.y,qt,jt),Bh(le,M.x,M.y,hi.x,an+hi.y,Ft.x+Ft.w,Ft.y+Ft.h,h,ei,$t.x,$t.y,qt,jt),id(t.dynamicLayoutVertexArray,M,tt),ne.emplaceBack(yi,yi+1,yi+2),ne.emplaceBack(yi+1,yi+2,yi+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),Je!==l.length-1&&Qt===l[Je+1].sectionIndex||t.programConfigurations.populatePaintArrays(le.length,x,x.index,{},Q,Ue&&Ue[Qt])}t.placedSymbolArray.emplaceBack(M.x,M.y,Ce,this.glyphOffsetArray.length-Ce,Pe,D,V,M.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],E,0,!1,0,G)}_addCollisionDebugVertex(t,l,h,g,w,x){return l.emplaceBack(0,0),t.emplaceBack(h.x,h.y,g,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,l,h,g,w,x,E){const M=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),D=M.vertexLength,V=w.layoutVertexArray,G=w.collisionVertexArray,Q=E.anchorX,ne=E.anchorY;this._addCollisionDebugVertex(V,G,x,Q,ne,new y(t,l)),this._addCollisionDebugVertex(V,G,x,Q,ne,new y(h,l)),this._addCollisionDebugVertex(V,G,x,Q,ne,new y(h,g)),this._addCollisionDebugVertex(V,G,x,Q,ne,new y(t,g)),M.vertexLength+=4;const le=w.indexArray;le.emplaceBack(D,D+1),le.emplaceBack(D+1,D+2),le.emplaceBack(D+2,D+3),le.emplaceBack(D+3,D),M.primitiveLength+=4}addDebugCollisionBoxes(t,l,h,g){for(let w=t;w<l;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rd(ss,im.members,$n),this.iconCollisionBox=new rd(ss,im.members,$n);for(let t=0;t<this.symbolInstances.length;t++){const l=this.symbolInstances.get(t);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(t,l,h,g,w,x,E,M,D){const V={};for(let G=l;G<h;G++){const Q=t.get(G);V.textBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},V.textFeatureIndex=Q.featureIndex;break}for(let G=g;G<w;G++){const Q=t.get(G);V.verticalTextBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},V.verticalTextFeatureIndex=Q.featureIndex;break}for(let G=x;G<E;G++){const Q=t.get(G);V.iconBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},V.iconFeatureIndex=Q.featureIndex;break}for(let G=M;G<D;G++){const Q=t.get(G);V.verticalIconBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},V.verticalIconFeatureIndex=Q.featureIndex;break}return V}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,l){const h=t.placedSymbolArray.get(l),g=h.vertexStartIndex+4*h.numGlyphs;for(let w=h.vertexStartIndex;w<g;w+=4)t.indexArray.emplaceBack(w,w+1,w+2),t.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(t),h=Math.cos(t),g=[],w=[],x=[];for(let E=0;E<this.symbolInstances.length;++E){x.push(E);const M=this.symbolInstances.get(E);g.push(0|Math.round(l*M.anchorX+h*M.anchorY)),w.push(M.featureIndex)}return x.sort((E,M)=>g[E]-g[M]||w[M]-w[E]),x}addToSortKeyRanges(t,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((g,w,x)=>{g>=0&&x.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vm,wm;Ut("SymbolBucket",Ic,{omit:["layers","collisionBoxArray","features","compareText"]}),Ic.MAX_GLYPHS=65535,Ic.addDynamicAttributes=id;var sd={get paint(){return wm=wm||new v({"icon-opacity":new fi(Ye.paint_symbol["icon-opacity"]),"icon-color":new fi(Ye.paint_symbol["icon-color"]),"icon-halo-color":new fi(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new fi(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fi(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Kt(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Kt(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new fi(Ye.paint_symbol["text-opacity"]),"text-color":new fi(Ye.paint_symbol["text-color"],{runtimeType:tn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new fi(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new fi(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new fi(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Kt(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Kt(Ye.paint_symbol["text-translate-anchor"])})},get layout(){return vm=vm||new v({"symbol-placement":new Kt(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Kt(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Kt(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fi(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Kt(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Kt(Ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Kt(Ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Kt(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Kt(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Kt(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new fi(Ye.layout_symbol["icon-size"]),"icon-text-fit":new Kt(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kt(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new fi(Ye.layout_symbol["icon-image"]),"icon-rotate":new fi(Ye.layout_symbol["icon-rotate"]),"icon-padding":new fi(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Kt(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new fi(Ye.layout_symbol["icon-offset"]),"icon-anchor":new fi(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Kt(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Kt(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Kt(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new fi(Ye.layout_symbol["text-field"]),"text-font":new fi(Ye.layout_symbol["text-font"]),"text-size":new fi(Ye.layout_symbol["text-size"]),"text-max-width":new fi(Ye.layout_symbol["text-max-width"]),"text-line-height":new Kt(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new fi(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new fi(Ye.layout_symbol["text-justify"]),"text-radial-offset":new fi(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Kt(Ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new fi(Ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new fi(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Kt(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Kt(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new fi(Ye.layout_symbol["text-rotate"]),"text-padding":new Kt(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Kt(Ye.layout_symbol["text-keep-upright"]),"text-transform":new fi(Ye.layout_symbol["text-transform"]),"text-offset":new fi(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Kt(Ye.layout_symbol["text-allow-overlap"]),"text-overlap":new Kt(Ye.layout_symbol["text-overlap"]),"text-ignore-placement":new Kt(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Kt(Ye.layout_symbol["text-optional"])})}};class xm{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Cn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(t.formattedSection))return l.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ut("FormatSectionOverride",xm,{omit:["defaultValue"]});class Nh extends c{constructor(t){super(t,sd)}recalculate(t,l){if(super.recalculate(t,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const w of h)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,l,h,g){const w=this.layout.get(t).evaluate(l,{},h,g),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||Ma(x.value)||!w?w:function(E,M){return M.replace(/{([^{}]+)}/g,(D,V)=>E&&V in E?String(E[V]):"")}(l.properties,w)}createBucket(t){return new Ic(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of sd.paint.overridableProperties){if(!Nh.hasPaintOverride(this.layout,t))continue;const l=this.paint.get(t),h=new xm(l),g=new So(h,l.property.specification);let w=null;w=l.value.kind==="constant"||l.value.kind==="source"?new mr("source",g):new To("composite",g,l.value.zoomStops),this.paint._values[t]=new Fs(l.property,w,l.parameters)}}_handleOverridablePaintPropertyUpdate(t,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Nh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,l){const h=t.get("text-field"),g=sd.paint.properties[l];let w=!1;const x=E=>{for(const M of E)if(g.overrides&&g.overrides.hasOverride(M))return void(w=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Un)x(h.value.value.sections);else if(h.value.kind==="source"){const E=D=>{w||(D instanceof nr&&Ei(D.value)===pr?x(D.value.sections):D instanceof Vo?x(D.sections):D.eachChild(E))},M=h.value;M._styleExpression&&E(M._styleExpression.expression)}return w}}let Sm;var Ov={get paint(){return Sm=Sm||new v({"background-color":new Kt(Ye.paint_background["background-color"]),"background-pattern":new pc(Ye.paint_background["background-pattern"]),"background-opacity":new Kt(Ye.paint_background["background-opacity"])})}};class Dv extends c{constructor(t){super(t,Ov)}}let Tm;var Fv={get paint(){return Tm=Tm||new v({"raster-opacity":new Kt(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Kt(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Kt(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Kt(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Kt(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Kt(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Kt(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Kt(Ye.paint_raster["raster-fade-duration"])})}};class Rv extends c{constructor(t){super(t,Fv)}}class Bv extends c{constructor(t){super(t,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Nv{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const od=63710088e-1;class Xa{constructor(t,l){if(isNaN(t)||isNaN(l))throw new Error(`Invalid LngLat object: (${t}, ${l})`);if(this.lng=+t,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xa($(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const l=Math.PI/180,h=this.lat*l,g=t.lat*l,w=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((t.lng-this.lng)*l);return od*Math.acos(Math.min(w,1))}static convert(t){if(t instanceof Xa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Xa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Xa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const km=2*Math.PI*od;function Cm(s){return km*Math.cos(s*Math.PI/180)}function Em(s){return(180+s)/360}function Im(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Am(s,t){return s/Cm(t)}function ad(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Nu{constructor(t,l,h=0){this.x=+t,this.y=+l,this.z=+h}static fromLngLat(t,l=0){const h=Xa.convert(t);return new Nu(Em(h.lng),Im(h.lat),Am(l,h.lat))}toLngLat(){return new Xa(360*this.x-180,ad(this.y))}toAltitude(){return this.z*Cm(ad(this.y))}meterInMercatorCoordinateUnits(){return 1/km*(t=ad(this.y),1/Math.cos(t*Math.PI/180));var t}}function Mm(s,t,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[s*h-2*Math.PI*6378137/2,t*h-2*Math.PI*6378137/2]}class ld{constructor(t,l,h){if(!function(g,w,x){return!(g<0||g>25||x<0||x>=Math.pow(2,g)||w<0||w>=Math.pow(2,g))}(t,l,h))throw new Error(`x=${l}, y=${h}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=l,this.y=h,this.key=ju(0,t,t,l,h)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,l,h){const g=(x=this.y,E=this.z,M=Mm(256*(w=this.x),256*(x=Math.pow(2,E)-x-1),E),D=Mm(256*(w+1),256*(x+1),E),M[0]+","+M[1]+","+D[0]+","+D[1]);var w,x,E,M,D;const V=function(G,Q,ne){let le,pe="";for(let Ce=G;Ce>0;Ce--)le=1<<Ce-1,pe+=(Q&le?1:0)+(ne&le?2:0);return pe}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,V).replace(/{bbox-epsg-3857}/g,g)}isChildOf(t){const l=this.z-t.z;return l>0&&t.x===this.x>>l&&t.y===this.y>>l}getTilePoint(t){const l=Math.pow(2,this.z);return new y((t.x*l-this.x)*Nn,(t.y*l-this.y)*Nn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pm{constructor(t,l){this.wrap=t,this.canonical=l,this.key=ju(t,l.z,l.z,l.x,l.y)}}class ys{constructor(t,l,h,g,w){if(t<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${h}`);this.overscaledZ=t,this.wrap=l,this.canonical=new ld(h,+g,+w),this.key=ju(l,t,h,g,w)}clone(){return new ys(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?new ys(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ys(t,this.wrap,t,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(t,l){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-t;return t>this.canonical.z?ju(this.wrap*+l,t,this.canonical.z,this.canonical.x,this.canonical.y):ju(this.wrap*+l,t,t,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const l=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>l&&t.canonical.y===this.canonical.y>>l}children(t){if(this.overscaledZ>=t)return[new ys(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new ys(l,this.wrap,l,h,g),new ys(l,this.wrap,l,h+1,g),new ys(l,this.wrap,l,h,g+1),new ys(l,this.wrap,l,h+1,g+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ys(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ys(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Nu(t.x-this.wrap,t.y))}}function ju(s,t,l,h,g){(s*=2)<0&&(s=-1*s-1);const w=1<<l;return(w*w*s+w*g+h).toString(36)+l.toString(36)+t.toString(36)}Ut("CanonicalTileID",ld),Ut("OverscaledTileID",ys,{omit:["posMatrix"]});class Lm{constructor(t,l,h,g=1,w=1,x=1,E=0){if(this.uid=t,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void ce(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const M=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=x,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<M;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(M,D)]=this.data[this._idx(M-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,M)]=this.data[this._idx(D,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<M;D++)for(let V=0;V<M;V++){const G=this.get(D,V);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(t,l){const h=new Uint8Array(this.data.buffer),g=4*this._idx(t,l);return this.unpack(h[g],h[g+1],h[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,l){if(t<-1||t>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(t+1)}unpack(t,l,h){return t*this.redFactor+l*this.greenFactor+h*this.blueFactor-this.baseShift}getPixels(){return new _s({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,l,h){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,w=l*this.dim+this.dim,x=h*this.dim,E=h*this.dim+this.dim;switch(l){case-1:g=w-1;break;case 1:w=g+1}switch(h){case-1:x=E-1;break;case 1:E=x+1}const M=-l*this.dim,D=-h*this.dim;for(let V=x;V<E;V++)for(let G=g;G<w;G++)this.data[this._idx(G,V)]=t.data[this._idx(G+M,V+D)]}}Ut("DEMData",Lm);class zm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let l=0;l<t.length;l++){const h=t[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Om{constructor(t,l,h,g,w){this.type="Feature",this._vectorTileFeature=t,t._z=l,t._x=h,t._y=g,this.properties=t.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(t[l]=this[l]);return t}}class Dm{constructor(t,l){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Oa(Nn,16,0),this.grid3D=new Oa(Nn,16,0),this.featureIndexArray=new yr,this.promoteId=l}insert(t,l,h,g,w,x){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,w);const M=x?this.grid3D:this.grid;for(let D=0;D<l.length;D++){const V=l[D],G=[1/0,1/0,-1/0,-1/0];for(let Q=0;Q<V.length;Q++){const ne=V[Q];G[0]=Math.min(G[0],ne.x),G[1]=Math.min(G[1],ne.y),G[2]=Math.max(G[2],ne.x),G[3]=Math.max(G[3],ne.y)}G[0]<Nn&&G[1]<Nn&&G[2]>=0&&G[3]>=0&&M.insert(E,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Wa.VectorTile(new Jf(this.rawTileData)).layers,this.sourceLayerCoder=new zm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,l,h,g){this.loadVTLayers();const w=t.params||{},x=Nn/t.tileSize/t.scale,E=yl(w.filter),M=t.queryGeometry,D=t.queryPadding*x,V=Rm(M),G=this.grid.query(V.minX-D,V.minY-D,V.maxX+D,V.maxY+D),Q=Rm(t.cameraQueryGeometry),ne=this.grid3D.query(Q.minX-D,Q.minY-D,Q.maxX+D,Q.maxY+D,(Ce,Pe,tt,Ue)=>function(Je,at,wt,Bt,hi){for(const Ot of Je)if(at<=Ot.x&&wt<=Ot.y&&Bt>=Ot.x&&hi>=Ot.y)return!0;const Ft=[new y(at,wt),new y(at,hi),new y(Bt,hi),new y(Bt,wt)];if(Je.length>2){for(const Ot of Ft)if(wc(Je,Ot))return!0}for(let Ot=0;Ot<Je.length-1;Ot++)if(bb(Je[Ot],Je[Ot+1],Ft))return!0;return!1}(t.cameraQueryGeometry,Ce-D,Pe-D,tt+D,Ue+D));for(const Ce of ne)G.push(Ce);G.sort(jv);const le={};let pe;for(let Ce=0;Ce<G.length;Ce++){const Pe=G[Ce];if(Pe===pe)continue;pe=Pe;const tt=this.featureIndexArray.get(Pe);let Ue=null;this.loadMatchingFeature(le,tt.bucketIndex,tt.sourceLayerIndex,tt.featureIndex,E,w.layers,w.availableImages,l,h,g,(Je,at,wt)=>(Ue||(Ue=Il(Je)),at.queryIntersectsFeature(M,Je,wt,Ue,this.z,t.transform,x,t.pixelPosMatrix)))}return le}loadMatchingFeature(t,l,h,g,w,x,E,M,D,V,G){const Q=this.bucketLayerIDs[l];if(x&&!function(Ce,Pe){for(let tt=0;tt<Ce.length;tt++)if(Pe.indexOf(Ce[tt])>=0)return!0;return!1}(x,Q))return;const ne=this.sourceLayerCoder.decode(h),le=this.vtLayers[ne].feature(g);if(w.needGeometry){const Ce=Al(le,!0);if(!w.filter(new mn(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!w.filter(new mn(this.tileID.overscaledZ),le))return;const pe=this.getId(le,ne);for(let Ce=0;Ce<Q.length;Ce++){const Pe=Q[Ce];if(x&&x.indexOf(Pe)<0)continue;const tt=M[Pe];if(!tt)continue;let Ue={};pe&&V&&(Ue=V.getState(tt.sourceLayer||"_geojsonTileLayer",pe));const Je=re({},D[Pe]);Je.paint=Fm(Je.paint,tt.paint,le,Ue,E),Je.layout=Fm(Je.layout,tt.layout,le,Ue,E);const at=!G||G(le,tt,Ue);if(!at)continue;const wt=new Om(le,this.z,this.x,this.y,pe);wt.layer=Je;let Bt=t[Pe];Bt===void 0&&(Bt=t[Pe]=[]),Bt.push({featureIndex:g,feature:wt,intersectionZ:at})}}lookupSymbolFeatures(t,l,h,g,w,x,E,M){const D={};this.loadVTLayers();const V=yl(w);for(const G of t)this.loadMatchingFeature(D,h,g,G,V,x,E,M,l);return D}hasLayer(t){for(const l of this.bucketLayerIDs)for(const h of l)if(t===h)return!0;return!1}getId(t,l){let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof h=="boolean"&&(h=Number(h))),h}}function Fm(s,t,l,h,g){return U(s,(w,x)=>{const E=t instanceof Tl?t.get(x):null;return E&&E.evaluate?E.evaluate(l,h,g):E})}function Rm(s){let t=1/0,l=1/0,h=-1/0,g=-1/0;for(const w of s)t=Math.min(t,w.x),l=Math.min(l,w.y),h=Math.max(h,w.x),g=Math.max(g,w.y);return{minX:t,minY:l,maxX:h,maxY:g}}function jv(s,t){return t-s}function Bm(s,t,l,h,g){const w=[];for(let x=0;x<s.length;x++){const E=s[x];let M;for(let D=0;D<E.length-1;D++){let V=E[D],G=E[D+1];V.x<t&&G.x<t||(V.x<t?V=new y(t,V.y+(t-V.x)/(G.x-V.x)*(G.y-V.y))._round():G.x<t&&(G=new y(t,V.y+(t-V.x)/(G.x-V.x)*(G.y-V.y))._round()),V.y<l&&G.y<l||(V.y<l?V=new y(V.x+(l-V.y)/(G.y-V.y)*(G.x-V.x),l)._round():G.y<l&&(G=new y(V.x+(l-V.y)/(G.y-V.y)*(G.x-V.x),l)._round()),V.x>=h&&G.x>=h||(V.x>=h?V=new y(h,V.y+(h-V.x)/(G.x-V.x)*(G.y-V.y))._round():G.x>=h&&(G=new y(h,V.y+(h-V.x)/(G.x-V.x)*(G.y-V.y))._round()),V.y>=g&&G.y>=g||(V.y>=g?V=new y(V.x+(g-V.y)/(G.y-V.y)*(G.x-V.x),g)._round():G.y>=g&&(G=new y(V.x+(g-V.y)/(G.y-V.y)*(G.x-V.x),g)._round()),M&&V.equals(M[M.length-1])||(M=[V],w.push(M)),M.push(G)))))}}return w}Ut("FeatureIndex",Dm,{omit:["rawTileData","sourceLayerCoder"]});class Ka extends y{constructor(t,l,h,g){super(t,l),this.angle=h,g!==void 0&&(this.segment=g)}clone(){return new Ka(this.x,this.y,this.angle,this.segment)}}function Nm(s,t,l,h,g){if(t.segment===void 0||l===0)return!0;let w=t,x=t.segment+1,E=0;for(;E>-l/2;){if(x--,x<0)return!1;E-=s[x].dist(w),w=s[x]}E+=s[x].dist(s[x+1]),x++;const M=[];let D=0;for(;E<l/2;){const V=s[x],G=s[x+1];if(!G)return!1;let Q=s[x-1].angleTo(V)-V.angleTo(G);for(Q=Math.abs((Q+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:E,angleDelta:Q}),D+=Q;E-M[0].distance>h;)D-=M.shift().angleDelta;if(D>g)return!1;x++,E+=V.dist(G)}return!0}function jm(s){let t=0;for(let l=0;l<s.length-1;l++)t+=s[l].dist(s[l+1]);return t}function Um(s,t,l){return s?.6*t*l:0}function Vm(s,t){return Math.max(s?s.right-s.left:0,t?t.right-t.left:0)}function Uv(s,t,l,h,g,w){const x=Um(l,g,w),E=Vm(l,h)*w;let M=0;const D=jm(s)/2;for(let V=0;V<s.length-1;V++){const G=s[V],Q=s[V+1],ne=G.dist(Q);if(M+ne>D){const le=(D-M)/ne,pe=Vn.number(G.x,Q.x,le),Ce=Vn.number(G.y,Q.y,le),Pe=new Ka(pe,Ce,Q.angleTo(G),V);return Pe._round(),!x||Nm(s,Pe,E,x,t)?Pe:void 0}M+=ne}}function Vv(s,t,l,h,g,w,x,E,M){const D=Um(h,w,x),V=Vm(h,g),G=V*x,Q=s[0].x===0||s[0].x===M||s[0].y===0||s[0].y===M;return t-G<t/4&&(t=G+t/4),qm(s,Q?t/2*E%t:(V/2+2*w)*x*E%t,t,D,l,G,Q,!1,M)}function qm(s,t,l,h,g,w,x,E,M){const D=w/2,V=jm(s);let G=0,Q=t-l,ne=[];for(let le=0;le<s.length-1;le++){const pe=s[le],Ce=s[le+1],Pe=pe.dist(Ce),tt=Ce.angleTo(pe);for(;Q+l<G+Pe;){Q+=l;const Ue=(Q-G)/Pe,Je=Vn.number(pe.x,Ce.x,Ue),at=Vn.number(pe.y,Ce.y,Ue);if(Je>=0&&Je<M&&at>=0&&at<M&&Q-D>=0&&Q+D<=V){const wt=new Ka(Je,at,tt,le);wt._round(),h&&!Nm(s,wt,w,h,g)||ne.push(wt)}}G+=Pe}return E||ne.length||x||(ne=qm(s,G/2,l,h,g,w,x,!0,M)),ne}Ut("Anchor",Ka);const Ac=Zr;function Zm(s,t,l,h){const g=[],w=s.image,x=w.pixelRatio,E=w.paddedRect.w-2*Ac,M=w.paddedRect.h-2*Ac;let D={x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};const V=w.stretchX||[[0,E]],G=w.stretchY||[[0,M]],Q=(dt,ei)=>dt+ei[1]-ei[0],ne=V.reduce(Q,0),le=G.reduce(Q,0),pe=E-ne,Ce=M-le;let Pe=0,tt=ne,Ue=0,Je=le,at=0,wt=pe,Bt=0,hi=Ce;if(w.content&&h){const dt=w.content,ei=dt[2]-dt[0],Qt=dt[3]-dt[1];(w.textFitWidth||w.textFitHeight)&&(D=_m(s)),Pe=jh(V,0,dt[0]),Ue=jh(G,0,dt[1]),tt=jh(V,dt[0],dt[2]),Je=jh(G,dt[1],dt[3]),at=dt[0]-Pe,Bt=dt[1]-Ue,wt=ei-tt,hi=Qt-Je}const Ft=D.x1,Ot=D.y1,$t=D.x2-Ft,qt=D.y2-Ot,jt=(dt,ei,Qt,yi)=>{const an=Uh(dt.stretch-Pe,tt,$t,Ft),rn=Vh(dt.fixed-at,wt,dt.stretch,ne),Xn=Uh(ei.stretch-Ue,Je,qt,Ot),Bs=Vh(ei.fixed-Bt,hi,ei.stretch,le),lr=Uh(Qt.stretch-Pe,tt,$t,Ft),Kn=Vh(Qt.fixed-at,wt,Qt.stretch,ne),Mr=Uh(yi.stretch-Ue,Je,qt,Ot),Pr=Vh(yi.fixed-Bt,hi,yi.stretch,le),Lr=new y(an,Xn),Ln=new y(lr,Xn),Jn=new y(lr,Mr),vr=new y(an,Mr),cr=new y(rn/x,Bs/x),zr=new y(Kn/x,Pr/x),ur=t*Math.PI/180;if(ur){const Yi=Math.sin(ur),fn=Math.cos(ur),bn=[fn,-Yi,Yi,fn];Lr._matMult(bn),Ln._matMult(bn),vr._matMult(bn),Jn._matMult(bn)}const bs=dt.stretch+dt.fixed,Wr=ei.stretch+ei.fixed;return{tl:Lr,tr:Ln,bl:vr,br:Jn,tex:{x:w.paddedRect.x+Ac+bs,y:w.paddedRect.y+Ac+Wr,w:Qt.stretch+Qt.fixed-bs,h:yi.stretch+yi.fixed-Wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cr,pixelOffsetBR:zr,minFontScaleX:wt/x/$t,minFontScaleY:hi/x/qt,isSDF:l}};if(h&&(w.stretchX||w.stretchY)){const dt=Wm(V,pe,ne),ei=Wm(G,Ce,le);for(let Qt=0;Qt<dt.length-1;Qt++){const yi=dt[Qt],an=dt[Qt+1];for(let rn=0;rn<ei.length-1;rn++)g.push(jt(yi,ei[rn],an,ei[rn+1]))}}else g.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:M+1}));return g}function jh(s,t,l){let h=0;for(const g of s)h+=Math.max(t,Math.min(l,g[1]))-Math.max(t,Math.min(l,g[0]));return h}function Wm(s,t,l){const h=[{fixed:-Ac,stretch:0}];for(const[g,w]of s){const x=h[h.length-1];h.push({fixed:g-x.stretch,stretch:x.stretch}),h.push({fixed:g-x.stretch,stretch:x.stretch+(w-g)})}return h.push({fixed:t+Ac,stretch:l}),h}function Uh(s,t,l,h){return s/t*l+h}function Vh(s,t,l,h){return s-t*l/h}class qh{constructor(t,l,h,g,w,x,E,M,D,V){var G;if(this.boxStartIndex=t.length,D){let Q=x.top,ne=x.bottom;const le=x.collisionPadding;le&&(Q-=le[1],ne+=le[3]);let pe=ne-Q;pe>0&&(pe=Math.max(10,pe),this.circleDiameter=pe)}else{const Q=!((G=x.image)===null||G===void 0)&&G.content&&(x.image.textFitWidth||x.image.textFitHeight)?_m(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};Q.y1=Q.y1*E-M[0],Q.y2=Q.y2*E+M[2],Q.x1=Q.x1*E-M[3],Q.x2=Q.x2*E+M[1];const ne=x.collisionPadding;if(ne&&(Q.x1-=ne[0]*E,Q.y1-=ne[1]*E,Q.x2+=ne[2]*E,Q.y2+=ne[3]*E),V){const le=new y(Q.x1,Q.y1),pe=new y(Q.x2,Q.y1),Ce=new y(Q.x1,Q.y2),Pe=new y(Q.x2,Q.y2),tt=V*Math.PI/180;le._rotate(tt),pe._rotate(tt),Ce._rotate(tt),Pe._rotate(tt),Q.x1=Math.min(le.x,pe.x,Ce.x,Pe.x),Q.x2=Math.max(le.x,pe.x,Ce.x,Pe.x),Q.y1=Math.min(le.y,pe.y,Ce.y,Pe.y),Q.y2=Math.max(le.y,pe.y,Ce.y,Pe.y)}t.emplaceBack(l.x,l.y,Q.x1,Q.y1,Q.x2,Q.y2,h,g,w)}this.boxEndIndex=t.length}}class qv{constructor(t=[],l=(h,g)=>h<g?-1:h>g?1:0){if(this.data=t,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:l,compare:h}=this,g=l[t];for(;t>0;){const w=t-1>>1,x=l[w];if(h(g,x)>=0)break;l[t]=x,t=w}l[t]=g}_down(t){const{data:l,compare:h}=this,g=this.length>>1,w=l[t];for(;t<g;){let x=1+(t<<1);const E=x+1;if(E<this.length&&h(l[E],l[x])<0&&(x=E),h(l[x],w)>=0)break;l[t]=l[x],t=x}l[t]=w}}function Zv(s,t=1,l=!1){let h=1/0,g=1/0,w=-1/0,x=-1/0;const E=s[0];for(let ne=0;ne<E.length;ne++){const le=E[ne];(!ne||le.x<h)&&(h=le.x),(!ne||le.y<g)&&(g=le.y),(!ne||le.x>w)&&(w=le.x),(!ne||le.y>x)&&(x=le.y)}const M=Math.min(w-h,x-g);let D=M/2;const V=new qv([],Wv);if(M===0)return new y(h,g);for(let ne=h;ne<w;ne+=M)for(let le=g;le<x;le+=M)V.push(new Mc(ne+D,le+D,D,s));let G=function(ne){let le=0,pe=0,Ce=0;const Pe=ne[0];for(let tt=0,Ue=Pe.length,Je=Ue-1;tt<Ue;Je=tt++){const at=Pe[tt],wt=Pe[Je],Bt=at.x*wt.y-wt.x*at.y;pe+=(at.x+wt.x)*Bt,Ce+=(at.y+wt.y)*Bt,le+=3*Bt}return new Mc(pe/le,Ce/le,0,ne)}(s),Q=V.length;for(;V.length;){const ne=V.pop();(ne.d>G.d||!G.d)&&(G=ne,l&&console.log("found best %d after %d probes",Math.round(1e4*ne.d)/1e4,Q)),ne.max-G.d<=t||(D=ne.h/2,V.push(new Mc(ne.p.x-D,ne.p.y-D,D,s)),V.push(new Mc(ne.p.x+D,ne.p.y-D,D,s)),V.push(new Mc(ne.p.x-D,ne.p.y+D,D,s)),V.push(new Mc(ne.p.x+D,ne.p.y+D,D,s)),Q+=4)}return l&&(console.log(`num probes: ${Q}`),console.log(`best distance: ${G.d}`)),G.p}function Wv(s,t){return t.max-s.max}function Mc(s,t,l,h){this.p=new y(s,t),this.h=l,this.d=function(g,w){let x=!1,E=1/0;for(let M=0;M<w.length;M++){const D=w[M];for(let V=0,G=D.length,Q=G-1;V<G;Q=V++){const ne=D[V],le=D[Q];ne.y>g.y!=le.y>g.y&&g.x<(le.x-ne.x)*(g.y-ne.y)/(le.y-ne.y)+ne.x&&(x=!x),E=Math.min(E,Ip(g,ne,le))}}return(x?1:-1)*Math.sqrt(E)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var ar;f.aq=void 0,(ar=f.aq||(f.aq={}))[ar.center=1]="center",ar[ar.left=2]="left",ar[ar.right=3]="right",ar[ar.top=4]="top",ar[ar.bottom=5]="bottom",ar[ar["top-left"]=6]="top-left",ar[ar["top-right"]=7]="top-right",ar[ar["bottom-left"]=8]="bottom-left",ar[ar["bottom-right"]=9]="bottom-right";const Ja=7,cd=Number.POSITIVE_INFINITY;function Gm(s,t){return t[1]!==cd?function(l,h,g){let w=0,x=0;switch(h=Math.abs(h),g=Math.abs(g),l){case"top-right":case"top-left":case"top":x=g-Ja;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+Ja}switch(l){case"top-right":case"bottom-right":case"right":w=-h;break;case"top-left":case"bottom-left":case"left":w=h}return[w,x]}(s,t[0],t[1]):function(l,h){let g=0,w=0;h<0&&(h=0);const x=h/Math.SQRT2;switch(l){case"top-right":case"top-left":w=x-Ja;break;case"bottom-right":case"bottom-left":w=-x+Ja;break;case"bottom":w=-h+Ja;break;case"top":w=h-Ja}switch(l){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=h;break;case"right":g=-h}return[g,w]}(s,t[0])}function Hm(s,t,l){var h;const g=s.layout,w=(h=g.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(t,{},l);if(w){const E=w.values,M=[];for(let D=0;D<E.length;D+=2){const V=M[D]=E[D],G=E[D+1].map(Q=>Q*qn);V.startsWith("top")?G[1]-=Ja:V.startsWith("bottom")&&(G[1]+=Ja),M[D+1]=G}return new zn(M)}const x=g.get("text-variable-anchor");if(x){let E;E=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(t,{},l)*qn,cd]:g.get("text-offset").evaluate(t,{},l).map(D=>D*qn);const M=[];for(const D of x)M.push(D,Gm(D,E));return new zn(M)}return null}function ud(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gv(s,t,l,h,g,w,x,E,M,D,V){let G=w.textMaxSize.evaluate(t,{});G===void 0&&(G=x);const Q=s.layers[0].layout,ne=Q.get("icon-offset").evaluate(t,{},V),le=Km(l.horizontal),pe=x/24,Ce=s.tilePixelRatio*pe,Pe=s.tilePixelRatio*G/24,tt=s.tilePixelRatio*E,Ue=s.tilePixelRatio*Q.get("symbol-spacing"),Je=Q.get("text-padding")*s.tilePixelRatio,at=function(dt,ei,Qt,yi=1){const an=dt.get("icon-padding").evaluate(ei,{},Qt),rn=an&&an.values;return[rn[0]*yi,rn[1]*yi,rn[2]*yi,rn[3]*yi]}(Q,t,V,s.tilePixelRatio),wt=Q.get("text-max-angle")/180*Math.PI,Bt=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point",hi=Q.get("icon-rotation-alignment")==="map"&&Q.get("symbol-placement")!=="point",Ft=Q.get("symbol-placement"),Ot=Ue/2,$t=Q.get("icon-text-fit");let qt;h&&$t!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(qt=ym(h,l.vertical,$t,Q.get("icon-text-fit-padding"),ne,pe)),le&&(h=ym(h,le,$t,Q.get("icon-text-fit-padding"),ne,pe)));const jt=(dt,ei)=>{ei.x<0||ei.x>=Nn||ei.y<0||ei.y>=Nn||function(Qt,yi,an,rn,Xn,Bs,lr,Kn,Mr,Pr,Lr,Ln,Jn,vr,cr,zr,ur,bs,Wr,Yi,fn,bn,os,An,Pc){const Mo=Qt.addToLineVertexArray(yi,an);let Po,Ns,vs,er,la=0,qu=0,$m=0,eg=0,yd=-1,bd=-1;const ca={};let tg=_c("");if(Qt.allowVerticalPlacement&&rn.vertical){const wr=Kn.layout.get("text-rotate").evaluate(fn,{},An)+90;vs=new qh(Mr,yi,Pr,Lr,Ln,rn.vertical,Jn,vr,cr,wr),lr&&(er=new qh(Mr,yi,Pr,Lr,Ln,lr,ur,bs,cr,wr))}if(Xn){const wr=Kn.layout.get("icon-rotate").evaluate(fn,{}),ws=Kn.layout.get("icon-text-fit")!=="none",Pl=Zm(Xn,wr,os,ws),lo=lr?Zm(lr,wr,os,ws):void 0;Ns=new qh(Mr,yi,Pr,Lr,Ln,Xn,ur,bs,!1,wr),la=4*Pl.length;const Ll=Qt.iconSizeData;let Lo=null;Ll.kind==="source"?(Lo=[Ao*Kn.layout.get("icon-size").evaluate(fn,{})],Lo[0]>Ha&&ce(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${Bu}. Reduce your "icon-size".`)):Ll.kind==="composite"&&(Lo=[Ao*bn.compositeIconSizes[0].evaluate(fn,{},An),Ao*bn.compositeIconSizes[1].evaluate(fn,{},An)],(Lo[0]>Ha||Lo[1]>Ha)&&ce(`${Qt.layerIds[0]}: Value for "icon-size" is >= ${Bu}. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,Pl,Lo,Yi,Wr,fn,f.ah.none,yi,Mo.lineStartIndex,Mo.lineLength,-1,An),yd=Qt.icon.placedSymbolArray.length-1,lo&&(qu=4*lo.length,Qt.addSymbols(Qt.icon,lo,Lo,Yi,Wr,fn,f.ah.vertical,yi,Mo.lineStartIndex,Mo.lineLength,-1,An),bd=Qt.icon.placedSymbolArray.length-1)}const ig=Object.keys(rn.horizontal);for(const wr of ig){const ws=rn.horizontal[wr];if(!Po){tg=_c(ws.text);const lo=Kn.layout.get("text-rotate").evaluate(fn,{},An);Po=new qh(Mr,yi,Pr,Lr,Ln,ws,Jn,vr,cr,lo)}const Pl=ws.positionedLines.length===1;if($m+=Xm(Qt,yi,ws,Bs,Kn,cr,fn,zr,Mo,rn.vertical?f.ah.horizontal:f.ah.horizontalOnly,Pl?ig:[wr],ca,yd,bn,An),Pl)break}rn.vertical&&(eg+=Xm(Qt,yi,rn.vertical,Bs,Kn,cr,fn,zr,Mo,f.ah.vertical,["vertical"],ca,bd,bn,An));const Kv=Po?Po.boxStartIndex:Qt.collisionBoxArray.length,Jv=Po?Po.boxEndIndex:Qt.collisionBoxArray.length,Yv=vs?vs.boxStartIndex:Qt.collisionBoxArray.length,Qv=vs?vs.boxEndIndex:Qt.collisionBoxArray.length,$v=Ns?Ns.boxStartIndex:Qt.collisionBoxArray.length,e1=Ns?Ns.boxEndIndex:Qt.collisionBoxArray.length,t1=er?er.boxStartIndex:Qt.collisionBoxArray.length,i1=er?er.boxEndIndex:Qt.collisionBoxArray.length;let ao=-1;const Wh=(wr,ws)=>wr&&wr.circleDiameter?Math.max(wr.circleDiameter,ws):ws;ao=Wh(Po,ao),ao=Wh(vs,ao),ao=Wh(Ns,ao),ao=Wh(er,ao);const ng=ao>-1?1:0;ng&&(ao*=Pc/qn),Qt.glyphOffsetArray.length>=Ic.MAX_GLYPHS&&ce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fn.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,fn.sortKey);const n1=Hm(Kn,fn,An),[r1,s1]=function(wr,ws){const Pl=wr.length,lo=ws==null?void 0:ws.values;if((lo==null?void 0:lo.length)>0)for(let Ll=0;Ll<lo.length;Ll+=2){const Lo=lo[Ll+1];wr.emplaceBack(f.aq[lo[Ll]],Lo[0],Lo[1])}return[Pl,wr.length]}(Qt.textAnchorOffsets,n1);Qt.symbolInstances.emplaceBack(yi.x,yi.y,ca.right>=0?ca.right:-1,ca.center>=0?ca.center:-1,ca.left>=0?ca.left:-1,ca.vertical||-1,yd,bd,tg,Kv,Jv,Yv,Qv,$v,e1,t1,i1,Pr,$m,eg,la,qu,ng,0,Jn,ao,r1,s1)}(s,ei,dt,l,h,g,qt,s.layers[0],s.collisionBoxArray,t.index,t.sourceLayerIndex,s.index,Ce,[Je,Je,Je,Je],Bt,M,tt,at,hi,ne,t,w,D,V,x)};if(Ft==="line")for(const dt of Bm(t.geometry,0,0,Nn,Nn)){const ei=Vv(dt,Ue,wt,l.vertical||le,h,24,Pe,s.overscaling,Nn);for(const Qt of ei)le&&Hv(s,le.text,Ot,Qt)||jt(dt,Qt)}else if(Ft==="line-center"){for(const dt of t.geometry)if(dt.length>1){const ei=Uv(dt,wt,l.vertical||le,h,24,Pe);ei&&jt(dt,ei)}}else if(t.type==="Polygon")for(const dt of Ta(t.geometry,0)){const ei=Zv(dt,16);jt(dt[0],new Ka(ei.x,ei.y,0))}else if(t.type==="LineString")for(const dt of t.geometry)jt(dt,new Ka(dt[0].x,dt[0].y,0));else if(t.type==="Point")for(const dt of t.geometry)for(const ei of dt)jt([ei],new Ka(ei.x,ei.y,0))}function Xm(s,t,l,h,g,w,x,E,M,D,V,G,Q,ne,le){const pe=function(tt,Ue,Je,at,wt,Bt,hi,Ft){const Ot=at.layout.get("text-rotate").evaluate(Bt,{})*Math.PI/180,$t=[];for(const qt of Ue.positionedLines)for(const jt of qt.positionedGlyphs){if(!jt.rect)continue;const dt=jt.rect||{};let ei=um+1,Qt=!0,yi=1,an=0;const rn=(wt||Ft)&&jt.vertical,Xn=jt.metrics.advance*jt.scale/2;if(Ft&&Ue.verticalizable&&(an=qt.lineOffset/2-(jt.imageName?-(qn-jt.metrics.width*jt.scale)/2:(jt.scale-1)*qn)),jt.imageName){const Yi=hi[jt.imageName];Qt=Yi.sdf,yi=Yi.pixelRatio,ei=Zr/yi}const Bs=wt?[jt.x+Xn,jt.y]:[0,0];let lr=wt?[0,0]:[jt.x+Xn+Je[0],jt.y+Je[1]-an],Kn=[0,0];rn&&(Kn=lr,lr=[0,0]);const Mr=jt.metrics.isDoubleResolution?2:1,Pr=(jt.metrics.left-ei)*jt.scale-Xn+lr[0],Lr=(-jt.metrics.top-ei)*jt.scale+lr[1],Ln=Pr+dt.w/Mr*jt.scale/yi,Jn=Lr+dt.h/Mr*jt.scale/yi,vr=new y(Pr,Lr),cr=new y(Ln,Lr),zr=new y(Pr,Jn),ur=new y(Ln,Jn);if(rn){const Yi=new y(-Xn,Xn-Fu),fn=-Math.PI/2,bn=qn/2-Xn,os=new y(5-Fu-bn,-(jt.imageName?bn:0)),An=new y(...Kn);vr._rotateAround(fn,Yi)._add(os)._add(An),cr._rotateAround(fn,Yi)._add(os)._add(An),zr._rotateAround(fn,Yi)._add(os)._add(An),ur._rotateAround(fn,Yi)._add(os)._add(An)}if(Ot){const Yi=Math.sin(Ot),fn=Math.cos(Ot),bn=[fn,-Yi,Yi,fn];vr._matMult(bn),cr._matMult(bn),zr._matMult(bn),ur._matMult(bn)}const bs=new y(0,0),Wr=new y(0,0);$t.push({tl:vr,tr:cr,bl:zr,br:ur,tex:dt,writingMode:Ue.writingMode,glyphOffset:Bs,sectionIndex:jt.sectionIndex,isSDF:Qt,pixelOffsetTL:bs,pixelOffsetBR:Wr,minFontScaleX:0,minFontScaleY:0})}return $t}(0,l,E,g,w,x,h,s.allowVerticalPlacement),Ce=s.textSizeData;let Pe=null;Ce.kind==="source"?(Pe=[Ao*g.layout.get("text-size").evaluate(x,{})],Pe[0]>Ha&&ce(`${s.layerIds[0]}: Value for "text-size" is >= ${Bu}. Reduce your "text-size".`)):Ce.kind==="composite"&&(Pe=[Ao*ne.compositeTextSizes[0].evaluate(x,{},le),Ao*ne.compositeTextSizes[1].evaluate(x,{},le)],(Pe[0]>Ha||Pe[1]>Ha)&&ce(`${s.layerIds[0]}: Value for "text-size" is >= ${Bu}. Reduce your "text-size".`)),s.addSymbols(s.text,pe,Pe,E,w,x,D,t,M.lineStartIndex,M.lineLength,Q,le);for(const tt of V)G[tt]=s.text.placedSymbolArray.length-1;return 4*pe.length}function Km(s){for(const t in s)return s[t];return null}function Hv(s,t,l,h){const g=s.compareText;if(t in g){const w=g[t];for(let x=w.length-1;x>=0;x--)if(h.dist(w[x])<l)return!0}else g[t]=[];return g[t].push(h),!1}const Jm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(t,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=h>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=Jm[15&h];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[E]=new Uint32Array(t,4,1);return new hd(E,x,w,t)}constructor(t,l=64,h=Float64Array,g){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const w=Jm.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,E=t*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-E%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${h}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+E+M,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+E+M),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+E+M,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=t)}add(t,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=t,this.coords[this._pos++]=l,h}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return fd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,l,h,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:E}=this,M=[0,w.length-1,0],D=[];for(;M.length;){const V=M.pop()||0,G=M.pop()||0,Q=M.pop()||0;if(G-Q<=E){for(let Ce=Q;Ce<=G;Ce++){const Pe=x[2*Ce],tt=x[2*Ce+1];Pe>=t&&Pe<=h&&tt>=l&&tt<=g&&D.push(w[Ce])}continue}const ne=Q+G>>1,le=x[2*ne],pe=x[2*ne+1];le>=t&&le<=h&&pe>=l&&pe<=g&&D.push(w[ne]),(V===0?t<=le:l<=pe)&&(M.push(Q),M.push(ne-1),M.push(1-V)),(V===0?h>=le:g>=pe)&&(M.push(ne+1),M.push(G),M.push(1-V))}return D}within(t,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:x}=this,E=[0,g.length-1,0],M=[],D=h*h;for(;E.length;){const V=E.pop()||0,G=E.pop()||0,Q=E.pop()||0;if(G-Q<=x){for(let Ce=Q;Ce<=G;Ce++)Qm(w[2*Ce],w[2*Ce+1],t,l)<=D&&M.push(g[Ce]);continue}const ne=Q+G>>1,le=w[2*ne],pe=w[2*ne+1];Qm(le,pe,t,l)<=D&&M.push(g[ne]),(V===0?t-h<=le:l-h<=pe)&&(E.push(Q),E.push(ne-1),E.push(1-V)),(V===0?t+h>=le:l+h>=pe)&&(E.push(ne+1),E.push(G),E.push(1-V))}return M}}function fd(s,t,l,h,g,w){if(g-h<=l)return;const x=h+g>>1;Ym(s,t,x,h,g,w),fd(s,t,l,h,x-1,1-w),fd(s,t,l,x+1,g,1-w)}function Ym(s,t,l,h,g,w){for(;g>h;){if(g-h>600){const D=g-h+1,V=l-h+1,G=Math.log(D),Q=.5*Math.exp(2*G/3),ne=.5*Math.sqrt(G*Q*(D-Q)/D)*(V-D/2<0?-1:1);Ym(s,t,l,Math.max(h,Math.floor(l-V*Q/D+ne)),Math.min(g,Math.floor(l+(D-V)*Q/D+ne)),w)}const x=t[2*l+w];let E=h,M=g;for(Uu(s,t,h,l),t[2*g+w]>x&&Uu(s,t,h,g);E<M;){for(Uu(s,t,E,M),E++,M--;t[2*E+w]<x;)E++;for(;t[2*M+w]>x;)M--}t[2*h+w]===x?Uu(s,t,h,M):(M++,Uu(s,t,M,g)),M<=l&&(h=M+1),l<=M&&(g=M-1)}}function Uu(s,t,l,h){dd(s,l,h),dd(t,2*l,2*h),dd(t,2*l+1,2*h+1)}function dd(s,t,l){const h=s[t];s[t]=s[l],s[l]=h}function Qm(s,t,l,h){const g=s-l,w=t-h;return g*g+w*w}var pd;f.bg=void 0,(pd=f.bg||(f.bg={})).create="create",pd.load="load",pd.fullLoad="fullLoad";let Zh=null,Vu=[];const md=1e3/60,gd="loadTime",_d="fullLoadTime",Xv={mark(s){performance.mark(s)},frame(s){const t=s;Zh!=null&&Vu.push(t-Zh),Zh=t},clearMetrics(){Zh=null,Vu=[],performance.clearMeasures(gd),performance.clearMeasures(_d);for(const s in f.bg)performance.clearMarks(f.bg[s])},getPerformanceMetrics(){performance.measure(gd,f.bg.create,f.bg.load),performance.measure(_d,f.bg.create,f.bg.fullLoad);const s=performance.getEntriesByName(gd)[0].duration,t=performance.getEntriesByName(_d)[0].duration,l=Vu.length,h=1/(Vu.reduce((w,x)=>w+x,0)/l/1e3),g=Vu.filter(w=>w>md).reduce((w,x)=>w+(x-md)/md,0);return{loadTime:s,fullLoadTime:t,fps:h,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};f.$=class extends X{},f.A=xc,f.B=kf,f.C=function(s){if(ye==null){const t=s.navigator?s.navigator.userAgent:null;ye=!!s.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ye},f.D=Kt,f.E=ni,f.F=class{constructor(s,t){this.target=s,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Nv(()=>this.process()),this.subscription=function(l,h,g,w){return l.addEventListener(h,g,!1),{unsubscribe:()=>{l.removeEventListener(h,g,!1)}}}(this.target,"message",l=>this.receive(l)),this.globalScope=ge(self)?s:window}registerMessageHandler(s,t){this.messageHandlers[s]=t}sendAsync(s,t){return new Promise((l,h)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:l,reject:h},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const E={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},{once:!0});const w=[],x=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Da(s.data,w)});this.target.postMessage(x,{transfer:w})})}receive(s){const t=s.data,l=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[l];const h=this.abortControllers[l];return delete this.abortControllers[l],void(h&&h.abort())}if(ge(self)||t.mustQueue)return this.tasks[l]=t,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,t)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),t=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(s,t)}processTask(s,t){return o(this,void 0,void 0,function*(){if(t.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(t.error?g.reject(Fa(t.error)):g.resolve(Fa(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Fa(t.data),h=new AbortController;this.abortControllers[s]=h;try{const g=yield this.messageHandlers[t.type](t.sourceMapId,l,h);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,t,l){const h=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Da(t):null,data:Da(l,h)};this.target.postMessage(g,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.G=St,f.H=function(){var s=new xc(16);return xc!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},f.I=Qf,f.J=function(s,t,l){var h,g,w,x,E,M,D,V,G,Q,ne,le,pe=l[0],Ce=l[1],Pe=l[2];return t===s?(s[12]=t[0]*pe+t[4]*Ce+t[8]*Pe+t[12],s[13]=t[1]*pe+t[5]*Ce+t[9]*Pe+t[13],s[14]=t[2]*pe+t[6]*Ce+t[10]*Pe+t[14],s[15]=t[3]*pe+t[7]*Ce+t[11]*Pe+t[15]):(g=t[1],w=t[2],x=t[3],E=t[4],M=t[5],D=t[6],V=t[7],G=t[8],Q=t[9],ne=t[10],le=t[11],s[0]=h=t[0],s[1]=g,s[2]=w,s[3]=x,s[4]=E,s[5]=M,s[6]=D,s[7]=V,s[8]=G,s[9]=Q,s[10]=ne,s[11]=le,s[12]=h*pe+E*Ce+G*Pe+t[12],s[13]=g*pe+M*Ce+Q*Pe+t[13],s[14]=w*pe+D*Ce+ne*Pe+t[14],s[15]=x*pe+V*Ce+le*Pe+t[15]),s},f.K=function(s,t,l){var h=l[0],g=l[1],w=l[2];return s[0]=t[0]*h,s[1]=t[1]*h,s[2]=t[2]*h,s[3]=t[3]*h,s[4]=t[4]*g,s[5]=t[5]*g,s[6]=t[6]*g,s[7]=t[7]*g,s[8]=t[8]*w,s[9]=t[9]*w,s[10]=t[10]*w,s[11]=t[11]*w,s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},f.L=Lp,f.M=function(s,t){const l={};for(let h=0;h<t.length;h++){const g=t[h];g in s&&(l[g]=s[g])}return l},f.N=Xa,f.O=Em,f.P=y,f.Q=Im,f.R=_s,f.S=ys,f.T=fc,f.U=N,f.V=F,f.W=Me,f.X=Nn,f.Y=A,f.Z=Nu,f._=o,f.a=$e,f.a$=function(s,t){var l=s[0],h=s[1],g=s[2],w=s[3],x=s[4],E=s[5],M=s[6],D=s[7],V=s[8],G=s[9],Q=s[10],ne=s[11],le=s[12],pe=s[13],Ce=s[14],Pe=s[15],tt=t[0],Ue=t[1],Je=t[2],at=t[3],wt=t[4],Bt=t[5],hi=t[6],Ft=t[7],Ot=t[8],$t=t[9],qt=t[10],jt=t[11],dt=t[12],ei=t[13],Qt=t[14],yi=t[15];return Math.abs(l-tt)<=Ar*Math.max(1,Math.abs(l),Math.abs(tt))&&Math.abs(h-Ue)<=Ar*Math.max(1,Math.abs(h),Math.abs(Ue))&&Math.abs(g-Je)<=Ar*Math.max(1,Math.abs(g),Math.abs(Je))&&Math.abs(w-at)<=Ar*Math.max(1,Math.abs(w),Math.abs(at))&&Math.abs(x-wt)<=Ar*Math.max(1,Math.abs(x),Math.abs(wt))&&Math.abs(E-Bt)<=Ar*Math.max(1,Math.abs(E),Math.abs(Bt))&&Math.abs(M-hi)<=Ar*Math.max(1,Math.abs(M),Math.abs(hi))&&Math.abs(D-Ft)<=Ar*Math.max(1,Math.abs(D),Math.abs(Ft))&&Math.abs(V-Ot)<=Ar*Math.max(1,Math.abs(V),Math.abs(Ot))&&Math.abs(G-$t)<=Ar*Math.max(1,Math.abs(G),Math.abs($t))&&Math.abs(Q-qt)<=Ar*Math.max(1,Math.abs(Q),Math.abs(qt))&&Math.abs(ne-jt)<=Ar*Math.max(1,Math.abs(ne),Math.abs(jt))&&Math.abs(le-dt)<=Ar*Math.max(1,Math.abs(le),Math.abs(dt))&&Math.abs(pe-ei)<=Ar*Math.max(1,Math.abs(pe),Math.abs(ei))&&Math.abs(Ce-Qt)<=Ar*Math.max(1,Math.abs(Ce),Math.abs(Qt))&&Math.abs(Pe-yi)<=Ar*Math.max(1,Math.abs(Pe),Math.abs(yi))},f.a0=Ui,f.a1=ld,f.a2=ct,f.a3=s=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(l=>{t.onloadstart=()=>{l(t)};for(const h of s){const g=window.document.createElement("source");Pi(h)||(t.crossOrigin="Anonymous"),g.src=h,t.appendChild(g)}})},f.a4=function(){return j++},f.a5=Rt,f.a6=Ic,f.a7=yl,f.a8=Al,f.a9=Om,f.aA=function(s){if(s.type==="custom")return new Bv(s);switch(s.type){case"background":return new Dv(s);case"circle":return new xb(s);case"fill":return new Nb(s);case"fill-extrusion":return new ev(s);case"heatmap":return new Tb(s);case"hillshade":return new Cb(s);case"line":return new lv(s);case"raster":return new Rv(s);case"symbol":return new Nh(s)}},f.aB=R,f.aC=function(s,t){if(!s)return[{command:"setStyle",args:[t]}];let l=[];try{if(!it(s.version,t.version))return[{command:"setStyle",args:[t]}];it(s.center,t.center)||l.push({command:"setCenter",args:[t.center]}),it(s.zoom,t.zoom)||l.push({command:"setZoom",args:[t.zoom]}),it(s.bearing,t.bearing)||l.push({command:"setBearing",args:[t.bearing]}),it(s.pitch,t.pitch)||l.push({command:"setPitch",args:[t.pitch]}),it(s.sprite,t.sprite)||l.push({command:"setSprite",args:[t.sprite]}),it(s.glyphs,t.glyphs)||l.push({command:"setGlyphs",args:[t.glyphs]}),it(s.transition,t.transition)||l.push({command:"setTransition",args:[t.transition]}),it(s.light,t.light)||l.push({command:"setLight",args:[t.light]}),it(s.terrain,t.terrain)||l.push({command:"setTerrain",args:[t.terrain]}),it(s.sky,t.sky)||l.push({command:"setSky",args:[t.sky]}),it(s.projection,t.projection)||l.push({command:"setProjection",args:[t.projection]});const h={},g=[];(function(x,E,M,D){let V;for(V in E=E||{},x=x||{})Object.prototype.hasOwnProperty.call(x,V)&&(Object.prototype.hasOwnProperty.call(E,V)||Y(V,M,D));for(V in E)Object.prototype.hasOwnProperty.call(E,V)&&(Object.prototype.hasOwnProperty.call(x,V)?it(x[V],E[V])||(x[V].type==="geojson"&&E[V].type==="geojson"&&qe(x,E,V)?ue(M,{command:"setGeoJSONSourceData",args:[V,E[V].data]}):Ie(V,E,M,D)):H(V,E,M))})(s.sources,t.sources,g,h);const w=[];s.layers&&s.layers.forEach(x=>{"source"in x&&h[x.source]?l.push({command:"removeLayer",args:[x.id]}):w.push(x)}),l=l.concat(g),function(x,E,M){E=E||[];const D=(x=x||[]).map(st),V=E.map(st),G=x.reduce(ki,{}),Q=E.reduce(ki,{}),ne=D.slice(),le=Object.create(null);let pe,Ce,Pe,tt,Ue;for(let Je=0,at=0;Je<D.length;Je++)pe=D[Je],Object.prototype.hasOwnProperty.call(Q,pe)?at++:(ue(M,{command:"removeLayer",args:[pe]}),ne.splice(ne.indexOf(pe,at),1));for(let Je=0,at=0;Je<V.length;Je++)pe=V[V.length-1-Je],ne[ne.length-1-Je]!==pe&&(Object.prototype.hasOwnProperty.call(G,pe)?(ue(M,{command:"removeLayer",args:[pe]}),ne.splice(ne.lastIndexOf(pe,ne.length-at),1)):at++,tt=ne[ne.length-Je],ue(M,{command:"addLayer",args:[Q[pe],tt]}),ne.splice(ne.length-Je,0,pe),le[pe]=!0);for(let Je=0;Je<V.length;Je++)if(pe=V[Je],Ce=G[pe],Pe=Q[pe],!le[pe]&&!it(Ce,Pe))if(it(Ce.source,Pe.source)&&it(Ce["source-layer"],Pe["source-layer"])&&it(Ce.type,Pe.type)){for(Ue in ut(Ce.layout,Pe.layout,M,pe,null,"setLayoutProperty"),ut(Ce.paint,Pe.paint,M,pe,null,"setPaintProperty"),it(Ce.filter,Pe.filter)||ue(M,{command:"setFilter",args:[pe,Pe.filter]}),it(Ce.minzoom,Pe.minzoom)&&it(Ce.maxzoom,Pe.maxzoom)||ue(M,{command:"setLayerZoomRange",args:[pe,Pe.minzoom,Pe.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&(Ue.indexOf("paint.")===0?ut(Ce[Ue],Pe[Ue],M,pe,Ue.slice(6),"setPaintProperty"):it(Ce[Ue],Pe[Ue])||ue(M,{command:"setLayerProperty",args:[pe,Ue,Pe[Ue]]}));for(Ue in Pe)Object.prototype.hasOwnProperty.call(Pe,Ue)&&!Object.prototype.hasOwnProperty.call(Ce,Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&(Ue.indexOf("paint.")===0?ut(Ce[Ue],Pe[Ue],M,pe,Ue.slice(6),"setPaintProperty"):it(Ce[Ue],Pe[Ue])||ue(M,{command:"setLayerProperty",args:[pe,Ue,Pe[Ue]]}))}else ue(M,{command:"removeLayer",args:[pe]}),tt=ne[ne.lastIndexOf(pe)+1],ue(M,{command:"addLayer",args:[Pe,tt]})}(w,t.layers,l)}catch(h){console.warn("Unable to compute style diff:",h),l=[{command:"setStyle",args:[t]}]}return l},f.aD=function(s){const t=[],l=s.id;return l===void 0&&t.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&t.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&t.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),t},f.aE=function s(t,l){if(Array.isArray(t)){if(!Array.isArray(l)||t.length!==l.length)return!1;for(let h=0;h<t.length;h++)if(!s(t[h],l[h]))return!1;return!0}if(typeof t=="object"&&t!==null&&l!==null){if(typeof l!="object"||Object.keys(t).length!==Object.keys(l).length)return!1;for(const h in t)if(!s(t[h],l[h]))return!1;return!0}return t===l},f.aF=U,f.aG=J,f.aH=class extends Cl{constructor(s,t){super(s,t),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},f.aI=Ch,f.aJ=class extends Cl{constructor(s,t){super(s,t),this.current=pb}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let t=1;t<16;t++)if(s[t]!==this.current[t]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},f.aK=wp,f.aL=xp,f.aM=si,f.aN=class extends Cl{constructor(s,t){super(s,t),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},f.aO=class extends Cl{constructor(s,t){super(s,t),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},f.aP=function(s,t,l,h,g,w,x){var E=1/(t-l),M=1/(h-g),D=1/(w-x);return s[0]=-2*E,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*M,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*D,s[11]=0,s[12]=(t+l)*E,s[13]=(g+h)*M,s[14]=(x+w)*D,s[15]=1,s},f.aQ=wb,f.aR=class extends Ge{},f.aS=fv,f.aT=class extends nt{},f.aU=jf,f.aV=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},f.aW=Rp,f.aX=sr,f.aY=gs,f.aZ=class extends Jt{},f.a_=function(s,t){return s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]&&s[3]===t[3]&&s[4]===t[4]&&s[5]===t[5]&&s[6]===t[6]&&s[7]===t[7]&&s[8]===t[8]&&s[9]===t[9]&&s[10]===t[10]&&s[11]===t[11]&&s[12]===t[12]&&s[13]===t[13]&&s[14]===t[14]&&s[15]===t[15]},f.aa=function(s){const t={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,g,w)=>{const x=g||w;return t[h]=!x||x.toLowerCase(),""}),t["max-age"]){const l=parseInt(t["max-age"],10);isNaN(l)?delete t["max-age"]:t["max-age"]=l}return t},f.ab=function(s,t){const l=[];for(const h in s)h in t||l.push(h);return l},f.ac=oe,f.ad=function(s,t,l){var h=Math.sin(l),g=Math.cos(l),w=t[0],x=t[1],E=t[2],M=t[3],D=t[4],V=t[5],G=t[6],Q=t[7];return t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=w*g+D*h,s[1]=x*g+V*h,s[2]=E*g+G*h,s[3]=M*g+Q*h,s[4]=D*g-w*h,s[5]=V*g-x*h,s[6]=G*g-E*h,s[7]=Q*g-M*h,s},f.ae=function(s){var t=new xc(16);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],t},f.af=Mh,f.ag=function(s,t){let l=0,h=0;if(s.kind==="constant")h=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:x}=s,E=g?oe(Yn.interpolationFactor(g,t,w,x),0,1):0;s.kind==="camera"?h=Vn.number(s.minSize,s.maxSize,E):l=E}return{uSizeT:l,uSize:h}},f.ai=function(s,{uSize:t,uSizeT:l},{lowerSize:h,upperSize:g}){return s.kind==="source"?h/Ao:s.kind==="composite"?Vn.number(h/Ao,g/Ao,l):t},f.aj=id,f.ak=function(s,t,l,h){const g=t.y-s.y,w=t.x-s.x,x=h.y-l.y,E=h.x-l.x,M=x*w-E*g;if(M===0)return null;const D=(E*(s.y-l.y)-x*(s.x-l.x))/M;return new y(s.x+D*w,s.y+D*g)},f.al=Bm,f.am=Cp,f.an=Rf,f.ao=function(s){let t=1/0,l=1/0,h=-1/0,g=-1/0;for(const w of s)t=Math.min(t,w.x),l=Math.min(l,w.y),h=Math.max(h,w.x),g=Math.max(g,w.y);return[t,l,h,g]},f.ap=qn,f.ar=td,f.as=function(s,t){var l=t[0],h=t[1],g=t[2],w=t[3],x=t[4],E=t[5],M=t[6],D=t[7],V=t[8],G=t[9],Q=t[10],ne=t[11],le=t[12],pe=t[13],Ce=t[14],Pe=t[15],tt=l*E-h*x,Ue=l*M-g*x,Je=l*D-w*x,at=h*M-g*E,wt=h*D-w*E,Bt=g*D-w*M,hi=V*pe-G*le,Ft=V*Ce-Q*le,Ot=V*Pe-ne*le,$t=G*Ce-Q*pe,qt=G*Pe-ne*pe,jt=Q*Pe-ne*Ce,dt=tt*jt-Ue*qt+Je*$t+at*Ot-wt*Ft+Bt*hi;return dt?(s[0]=(E*jt-M*qt+D*$t)*(dt=1/dt),s[1]=(g*qt-h*jt-w*$t)*dt,s[2]=(pe*Bt-Ce*wt+Pe*at)*dt,s[3]=(Q*wt-G*Bt-ne*at)*dt,s[4]=(M*Ot-x*jt-D*Ft)*dt,s[5]=(l*jt-g*Ot+w*Ft)*dt,s[6]=(Ce*Je-le*Bt-Pe*Ue)*dt,s[7]=(V*Bt-Q*Je+ne*Ue)*dt,s[8]=(x*qt-E*Ot+D*hi)*dt,s[9]=(h*Ot-l*qt-w*hi)*dt,s[10]=(le*wt-pe*Je+Pe*tt)*dt,s[11]=(G*Je-V*wt-ne*tt)*dt,s[12]=(E*Ft-x*$t-M*hi)*dt,s[13]=(l*$t-h*Ft+g*hi)*dt,s[14]=(pe*Ue-le*at-Ce*tt)*dt,s[15]=(V*at-G*Ue+Q*tt)*dt,s):null},f.at=ud,f.au=ed,f.av=hd,f.aw=function(){const s={},t=Ye.$version;for(const l in Ye.$root){const h=Ye.$root[l];if(h.required){let g=null;g=l==="version"?t:h.type==="array"?[]:{},g!=null&&(s[l]=g)}}return s},f.ax=bu,f.ay=oi,f.az=function(s){s=s.slice();const t=Object.create(null);for(let l=0;l<s.length;l++)t[s[l].id]=s[l];for(let l=0;l<s.length;l++)"ref"in s[l]&&(s[l]=pt(s[l],t[s[l].ref]));return s},f.b=he,f.b0=function(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s},f.b1=function(s,t,l){return s[0]=t[0]*l[0],s[1]=t[1]*l[1],s[2]=t[2]*l[2],s[3]=t[3]*l[3],s},f.b2=function(s,t){return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]*t[3]},f.b3=$,f.b4=Pm,f.b5=Am,f.b6=function(s,t,l,h,g){var w,x=1/Math.tan(t/2);return s[0]=x/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+h)*(w=1/(h-g)),s[14]=2*g*h*w):(s[10]=-1,s[14]=-2*h),s},f.b7=function(s,t,l){var h=Math.sin(l),g=Math.cos(l),w=t[4],x=t[5],E=t[6],M=t[7],D=t[8],V=t[9],G=t[10],Q=t[11];return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[4]=w*g+D*h,s[5]=x*g+V*h,s[6]=E*g+G*h,s[7]=M*g+Q*h,s[8]=D*g-w*h,s[9]=V*g-x*h,s[10]=G*g-E*h,s[11]=Q*g-M*h,s},f.b8=W,f.b9=ee,f.bA=nm,f.bB=function(s){return s.message===ht},f.bC=Cr,f.bD=Vr,f.ba=function(s){return s*Math.PI/180},f.bb=function(s,t){const{x:l,y:h}=Nu.fromLngLat(t);return!(s<0||s>25||h<0||h>=1||l<0||l>=1)},f.bc=function(s,t){return s[0]=t[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=t[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=t[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},f.bd=class extends q{},f.be=od,f.bf=Xv,f.bh=Zt,f.bi=function(s,t){$e.REGISTERED_PROTOCOLS[s]=t},f.bj=function(s){delete $e.REGISTERED_PROTOCOLS[s]},f.bk=function(s,t){const l={};for(let g=0;g<s.length;g++){const w=t&&t[s[g].id]||O(s[g]);t&&(t[s[g].id]=w);let x=l[w];x||(x=l[w]=[]),x.push(s[g])}const h=[];for(const g in l)h.push(l[g]);return h},f.bl=Ut,f.bm=zm,f.bn=Dm,f.bo=fm,f.bp=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Nn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const t=s.bucket.layers[0],l=t.layout,h=t._unevaluatedLayout._values,g={layoutIconSize:h["icon-size"].possiblyEvaluate(new mn(s.bucket.zoom+1),s.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new mn(s.bucket.zoom+1),s.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new mn(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:V}=s.bucket.textSizeData;g.compositeTextSizes=[h["text-size"].possiblyEvaluate(new mn(D),s.canonical),h["text-size"].possiblyEvaluate(new mn(V),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:V}=s.bucket.iconSizeData;g.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new mn(D),s.canonical),h["icon-size"].possiblyEvaluate(new mn(V),s.canonical)]}const w=l.get("text-line-height")*qn,x=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",E=l.get("text-keep-upright"),M=l.get("text-size");for(const D of s.bucket.features){const V=l.get("text-font").evaluate(D,{},s.canonical).join(","),G=M.evaluate(D,{},s.canonical),Q=g.layoutTextSize.evaluate(D,{},s.canonical),ne=g.layoutIconSize.evaluate(D,{},s.canonical),le={horizontal:{},vertical:void 0},pe=D.text;let Ce,Pe=[0,0];if(pe){const Je=pe.toString(),at=l.get("text-letter-spacing").evaluate(D,{},s.canonical)*qn,wt=Cf(Je)?at:0,Bt=l.get("text-anchor").evaluate(D,{},s.canonical),hi=Hm(t,D,s.canonical);if(!hi){const qt=l.get("text-radial-offset").evaluate(D,{},s.canonical);Pe=qt?Gm(Bt,[qt*qn,cd]):l.get("text-offset").evaluate(D,{},s.canonical).map(jt=>jt*qn)}let Ft=x?"center":l.get("text-justify").evaluate(D,{},s.canonical);const Ot=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(D,{},s.canonical)*qn:1/0,$t=()=>{s.bucket.allowVerticalPlacement&&vu(Je)&&(le.vertical=Fh(pe,s.glyphMap,s.glyphPositions,s.imagePositions,V,Ot,w,Bt,"left",wt,Pe,f.ah.vertical,!0,Q,G))};if(!x&&hi){const qt=new Set;if(Ft==="auto")for(let dt=0;dt<hi.values.length;dt+=2)qt.add(ud(hi.values[dt]));else qt.add(Ft);let jt=!1;for(const dt of qt)if(!le.horizontal[dt])if(jt)le.horizontal[dt]=le.horizontal[0];else{const ei=Fh(pe,s.glyphMap,s.glyphPositions,s.imagePositions,V,Ot,w,"center",dt,wt,Pe,f.ah.horizontal,!1,Q,G);ei&&(le.horizontal[dt]=ei,jt=ei.positionedLines.length===1)}$t()}else{Ft==="auto"&&(Ft=ud(Bt));const qt=Fh(pe,s.glyphMap,s.glyphPositions,s.imagePositions,V,Ot,w,Bt,Ft,wt,Pe,f.ah.horizontal,!1,Q,G);qt&&(le.horizontal[Ft]=qt),$t(),vu(Je)&&x&&E&&(le.vertical=Fh(pe,s.glyphMap,s.glyphPositions,s.imagePositions,V,Ot,w,Bt,Ft,wt,Pe,f.ah.vertical,!1,Q,G))}}let tt=!1;if(D.icon&&D.icon.name){const Je=s.imageMap[D.icon.name];Je&&(Ce=Mv(s.imagePositions[D.icon.name],l.get("icon-offset").evaluate(D,{},s.canonical),l.get("icon-anchor").evaluate(D,{},s.canonical)),tt=!!Je.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=tt:s.bucket.sdfIcons!==tt&&ce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Je.pixelRatio!==s.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Ue=Km(le.horizontal)||le.vertical;s.bucket.iconsInText=!!Ue&&Ue.iconsInText,(Ue||Ce)&&Gv(s.bucket,D,le,Ce,s.imageMap,g,Q,ne,Pe,tt,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},f.bq=Xf,f.br=Wf,f.bs=Hf,f.bt=Wa,f.bu=Jf,f.bv=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},f.bw=function(s,t,l,h,g){return o(this,void 0,void 0,function*(){if(F())try{return yield Me(s,t,l,h,g)}catch{}return function(w,x,E,M,D){const V=w.width,G=w.height;lt&&Ze||(lt=new OffscreenCanvas(V,G),Ze=lt.getContext("2d",{willReadFrequently:!0})),lt.width=V,lt.height=G,Ze.drawImage(w,0,0,V,G);const Q=Ze.getImageData(x,E,M,D);return Ze.clearRect(0,0,V,G),Q.data}(s,t,l,h,g)})},f.bx=Lm,f.by=_,f.bz=S,f.c=kt,f.d=s=>o(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(t)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=re,f.f=s=>new Promise((t,l)=>{const h=new Image;h.onload=()=>{t(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=Fe})},h.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});h.src=s.byteLength?URL.createObjectURL(g):Fe}),f.g=vt,f.h=(s,t)=>Mi(re(s,{type:"json"}),t),f.i=ge,f.j=Pt,f.k=He,f.l=(s,t)=>Mi(re(s,{type:"arrayBuffer"}),t),f.m=Mi,f.n=function(s){return new Jf(s).readFields(Sv,[])},f.o=Au,f.p=hm,f.q=v,f.r=Tf,f.s=Pi,f.t=_u,f.u=ra,f.v=Ye,f.w=ce,f.x=function([s,t,l]){return t+=90,t*=Math.PI/180,l*=Math.PI/180,{x:s*Math.cos(t)*Math.sin(l),y:s*Math.sin(t)*Math.sin(l),z:s*Math.cos(l)}},f.y=Vn,f.z=mn}),u("worker",["./shared"],function(f){class o{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,ie){for(const Se of te){this._layerConfigs[Se.id]=Se;const je=this._layers[Se.id]=f.aA(Se);je._featureFilter=f.a7(je.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(const Se of ie)delete this.keyCache[Se],delete this._layerConfigs[Se],delete this._layers[Se];this.familiesBySource={};const de=f.bk(Object.values(this._layerConfigs),this.keyCache);for(const Se of de){const je=Se.map(rt=>this._layers[rt.id]),We=je[0];if(We.visibility==="none")continue;const et=We.source||"";let De=this.familiesBySource[et];De||(De=this.familiesBySource[et]={});const ot=We.sourceLayer||"_geojsonTileLayer";let mt=De[ot];mt||(mt=De[ot]=[]),mt.push(je)}}}class _{constructor(te){const ie={},de=[];for(const et in te){const De=te[et],ot=ie[et]={};for(const mt in De){const rt=De[+mt];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Et={x:0,y:0,w:rt.bitmap.width+2,h:rt.bitmap.height+2};de.push(Et),ot[mt]={rect:Et,metrics:rt.metrics}}}const{w:Se,h:je}=f.p(de),We=new f.o({width:Se||1,height:je||1});for(const et in te){const De=te[et];for(const ot in De){const mt=De[+ot];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const rt=ie[et][ot].rect;f.o.copy(mt.bitmap,We,{x:0,y:0},{x:rt.x+1,y:rt.y+1},mt.bitmap)}}this.image=We,this.positions=ie}}f.bl("GlyphAtlas",_);class S{constructor(te){this.tileID=new f.S(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.uid=te.uid,this.zoom=te.zoom,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.returnDependencies=!!te.returnDependencies,this.promoteId=te.promoteId,this.inFlightDependencies=[]}parse(te,ie,de,Se){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=te,this.collisionBoxArray=new f.a5;const je=new f.bm(Object.keys(te.layers).sort()),We=new f.bn(this.tileID,this.promoteId);We.bucketLayerIDs=[];const et={},De={featureIndex:We,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:de},ot=ie.familiesBySource[this.source];for(const Xe in ot){const di=te.layers[Xe];if(!di)continue;di.version===1&&f.w(`Vector tile source "${this.source}" layer "${Xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xi=je.encode(Xe),Bi=[];for(let Ki=0;Ki<di.length;Ki++){const Ji=di.feature(Ki),jn=We.getId(Ji,Xe);Bi.push({feature:Ji,id:jn,index:Ki,sourceLayerIndex:xi})}for(const Ki of ot[Xe]){const Ji=Ki[0];Ji.source!==this.source&&f.w(`layer.source = ${Ji.source} does not equal this.source = ${this.source}`),Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility!=="none"&&(T(Ki,this.zoom,de),(et[Ji.id]=Ji.createBucket({index:We.bucketLayerIDs.length,layers:Ki,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xi,sourceID:this.source})).populate(Bi,De,this.tileID.canonical),We.bucketLayerIDs.push(Ki.map(jn=>jn.id)))}}const mt=f.aF(De.glyphDependencies,Xe=>Object.keys(Xe).map(Number));this.inFlightDependencies.forEach(Xe=>Xe==null?void 0:Xe.abort()),this.inFlightDependencies=[];let rt=Promise.resolve({});if(Object.keys(mt).length){const Xe=new AbortController;this.inFlightDependencies.push(Xe),rt=Se.sendAsync({type:"GG",data:{stacks:mt,source:this.source,tileID:this.tileID,type:"glyphs"}},Xe)}const Et=Object.keys(De.iconDependencies);let Yt=Promise.resolve({});if(Et.length){const Xe=new AbortController;this.inFlightDependencies.push(Xe),Yt=Se.sendAsync({type:"GI",data:{icons:Et,source:this.source,tileID:this.tileID,type:"icons"}},Xe)}const ri=Object.keys(De.patternDependencies);let Ri=Promise.resolve({});if(ri.length){const Xe=new AbortController;this.inFlightDependencies.push(Xe),Ri=Se.sendAsync({type:"GI",data:{icons:ri,source:this.source,tileID:this.tileID,type:"patterns"}},Xe)}const[bi,zi,Si]=yield Promise.all([rt,Yt,Ri]),un=new _(bi),hn=new f.bo(zi,Si);for(const Xe in et){const di=et[Xe];di instanceof f.a6?(T(di.layers,this.zoom,de),f.bp({bucket:di,glyphMap:bi,glyphPositions:un.positions,imageMap:zi,imagePositions:hn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):di.hasPattern&&(di instanceof f.bq||di instanceof f.br||di instanceof f.bs)&&(T(di.layers,this.zoom,de),di.addFeatures(De,this.tileID.canonical,hn.patternPositions))}return this.status="done",{buckets:Object.values(et).filter(Xe=>!Xe.isEmpty()),featureIndex:We,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:un.image,imageAtlas:hn,glyphMap:this.returnDependencies?bi:null,iconMap:this.returnDependencies?zi:null,glyphPositions:this.returnDependencies?un.positions:null}})}}function T(Ae,te,ie){const de=new f.z(te);for(const Se of Ae)Se.recalculate(de,ie)}class y{constructor(te,ie,de){this.actor=te,this.layerIndex=ie,this.availableImages=de,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(te,ie){return f._(this,void 0,void 0,function*(){const de=yield f.l(te.request,ie);try{return{vectorTile:new f.bt.VectorTile(new f.bu(de.data)),rawData:de.data,cacheControl:de.cacheControl,expires:de.expires}}catch(Se){const je=new Uint8Array(de.data);let We=`Unable to parse the tile at ${te.request.url}, `;throw We+=je[0]===31&&je[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(We)}})}loadTile(te){return f._(this,void 0,void 0,function*(){const ie=te.uid,de=!!(te&&te.request&&te.request.collectResourceTiming)&&new f.bv(te.request),Se=new S(te);this.loading[ie]=Se;const je=new AbortController;Se.abort=je;try{const We=yield this.loadVectorTile(te,je);if(delete this.loading[ie],!We)return null;const et=We.rawData,De={};We.expires&&(De.expires=We.expires),We.cacheControl&&(De.cacheControl=We.cacheControl);const ot={};if(de){const rt=de.finish();rt&&(ot.resourceTiming=JSON.parse(JSON.stringify(rt)))}Se.vectorTile=We.vectorTile;const mt=Se.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ie]=Se,this.fetching[ie]={rawTileData:et,cacheControl:De,resourceTiming:ot};try{const rt=yield mt;return f.e({rawTileData:et.slice(0)},rt,De,ot)}finally{delete this.fetching[ie]}}catch(We){throw delete this.loading[ie],Se.status="done",this.loaded[ie]=Se,We}})}reloadTile(te){return f._(this,void 0,void 0,function*(){const ie=te.uid;if(!this.loaded||!this.loaded[ie])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const de=this.loaded[ie];if(de.showCollisionBoxes=te.showCollisionBoxes,de.status==="parsing"){const Se=yield de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor);let je;if(this.fetching[ie]){const{rawTileData:We,cacheControl:et,resourceTiming:De}=this.fetching[ie];delete this.fetching[ie],je=f.e({rawTileData:We.slice(0)},Se,et,De)}else je=Se;return je}if(de.status==="done"&&de.vectorTile)return de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(te){return f._(this,void 0,void 0,function*(){const ie=this.loading,de=te.uid;ie&&ie[de]&&ie[de].abort&&(ie[de].abort.abort(),delete ie[de])})}removeTile(te){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[te.uid]&&delete this.loaded[te.uid]})}}class k{constructor(){this.loaded={}}loadTile(te){return f._(this,void 0,void 0,function*(){const{uid:ie,encoding:de,rawImageData:Se,redFactor:je,greenFactor:We,blueFactor:et,baseShift:De}=te,ot=Se.width+2,mt=Se.height+2,rt=f.b(Se)?new f.R({width:ot,height:mt},yield f.bw(Se,-1,-1,ot,mt)):Se,Et=new f.bx(ie,rt,de,je,We,et,De);return this.loaded=this.loaded||{},this.loaded[ie]=Et,Et})}removeTile(te){const ie=this.loaded,de=te.uid;ie&&ie[de]&&delete ie[de]}}function I(Ae,te){if(Ae.length!==0){C(Ae[0],te);for(var ie=1;ie<Ae.length;ie++)C(Ae[ie],!te)}}function C(Ae,te){for(var ie=0,de=0,Se=0,je=Ae.length,We=je-1;Se<je;We=Se++){var et=(Ae[Se][0]-Ae[We][0])*(Ae[We][1]+Ae[Se][1]),De=ie+et;de+=Math.abs(ie)>=Math.abs(et)?ie-De+et:et-De+ie,ie=De}ie+de>=0!=!!te&&Ae.reverse()}var L=f.by(function Ae(te,ie){var de,Se=te&&te.type;if(Se==="FeatureCollection")for(de=0;de<te.features.length;de++)Ae(te.features[de],ie);else if(Se==="GeometryCollection")for(de=0;de<te.geometries.length;de++)Ae(te.geometries[de],ie);else if(Se==="Feature")Ae(te.geometry,ie);else if(Se==="Polygon")I(te.coordinates,ie);else if(Se==="MultiPolygon")for(de=0;de<te.coordinates.length;de++)I(te.coordinates[de],ie);return te});const B=f.bt.VectorTileFeature.prototype.toGeoJSON;var N={exports:{}},F=f.bz,W=f.bt.VectorTileFeature,ee=oe;function oe(Ae,te){this.options=te||{},this.features=Ae,this.length=Ae.length}function $(Ae,te){this.id=typeof Ae.id=="number"?Ae.id:void 0,this.type=Ae.type,this.rawGeometry=Ae.type===1?[Ae.geometry]:Ae.geometry,this.properties=Ae.tags,this.extent=te||4096}oe.prototype.feature=function(Ae){return new $(this.features[Ae],this.options.extent)},$.prototype.loadGeometry=function(){var Ae=this.rawGeometry;this.geometry=[];for(var te=0;te<Ae.length;te++){for(var ie=Ae[te],de=[],Se=0;Se<ie.length;Se++)de.push(new F(ie[Se][0],ie[Se][1]));this.geometry.push(de)}return this.geometry},$.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ae=this.geometry,te=1/0,ie=-1/0,de=1/0,Se=-1/0,je=0;je<Ae.length;je++)for(var We=Ae[je],et=0;et<We.length;et++){var De=We[et];te=Math.min(te,De.x),ie=Math.max(ie,De.x),de=Math.min(de,De.y),Se=Math.max(Se,De.y)}return[te,de,ie,Se]},$.prototype.toGeoJSON=W.prototype.toGeoJSON;var re=f.bA,j=ee;function U(Ae){var te=new re;return function(ie,de){for(var Se in ie.layers)de.writeMessage(3,J,ie.layers[Se])}(Ae,te),te.finish()}function J(Ae,te){var ie;te.writeVarintField(15,Ae.version||1),te.writeStringField(1,Ae.name||""),te.writeVarintField(5,Ae.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<Ae.length;ie++)de.feature=Ae.feature(ie),te.writeMessage(2,R,de);var Se=de.keys;for(ie=0;ie<Se.length;ie++)te.writeStringField(3,Se[ie]);var je=de.values;for(ie=0;ie<je.length;ie++)te.writeMessage(4,ye,je[ie])}function R(Ae,te){var ie=Ae.feature;ie.id!==void 0&&te.writeVarintField(1,ie.id),te.writeMessage(2,Z,Ae),te.writeVarintField(3,ie.type),te.writeMessage(4,ge,ie)}function Z(Ae,te){var ie=Ae.feature,de=Ae.keys,Se=Ae.values,je=Ae.keycache,We=Ae.valuecache;for(var et in ie.properties){var De=ie.properties[et],ot=je[et];if(De!==null){ot===void 0&&(de.push(et),je[et]=ot=de.length-1),te.writeVarint(ot);var mt=typeof De;mt!=="string"&&mt!=="boolean"&&mt!=="number"&&(De=JSON.stringify(De));var rt=mt+":"+De,Et=We[rt];Et===void 0&&(Se.push(De),We[rt]=Et=Se.length-1),te.writeVarint(Et)}}}function ce(Ae,te){return(te<<3)+(7&Ae)}function fe(Ae){return Ae<<1^Ae>>31}function ge(Ae,te){for(var ie=Ae.loadGeometry(),de=Ae.type,Se=0,je=0,We=ie.length,et=0;et<We;et++){var De=ie[et],ot=1;de===1&&(ot=De.length),te.writeVarint(ce(1,ot));for(var mt=de===3?De.length-1:De.length,rt=0;rt<mt;rt++){rt===1&&de!==1&&te.writeVarint(ce(2,mt-1));var Et=De[rt].x-Se,Yt=De[rt].y-je;te.writeVarint(fe(Et)),te.writeVarint(fe(Yt)),Se+=Et,je+=Yt}de===3&&te.writeVarint(ce(7,1))}}function ye(Ae,te){var ie=typeof Ae;ie==="string"?te.writeStringField(1,Ae):ie==="boolean"?te.writeBooleanField(7,Ae):ie==="number"&&(Ae%1!=0?te.writeDoubleField(3,Ae):Ae<0?te.writeSVarintField(6,Ae):te.writeVarintField(5,Ae))}N.exports=U,N.exports.fromVectorTileJs=U,N.exports.fromGeojsonVt=function(Ae,te){te=te||{};var ie={};for(var de in Ae)ie[de]=new j(Ae[de].features,te),ie[de].name=de,ie[de].version=te.version,ie[de].extent=te.extent;return U({layers:ie})},N.exports.GeoJSONWrapper=j;var he=f.by(N.exports);const Fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},Me=Math.fround||(lt=new Float32Array(1),Ae=>(lt[0]=+Ae,lt[0]));var lt;const Ze=3,ht=5,kt=6;class $e{constructor(te){this.options=Object.assign(Object.create(Fe),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ie,minZoom:de,maxZoom:Se}=this.options;ie&&console.time("total time");const je=`prepare ${te.length} points`;ie&&console.time(je),this.points=te;const We=[];for(let De=0;De<te.length;De++){const ot=te[De];if(!ot.geometry)continue;const[mt,rt]=ot.geometry.coordinates,Et=Me(Zt(mt)),Yt=Me(oi(rt));We.push(Et,Yt,1/0,De,-1,1),this.options.reduce&&We.push(0)}let et=this.trees[Se+1]=this._createTree(We);ie&&console.timeEnd(je);for(let De=Se;De>=de;De--){const ot=+Date.now();et=this.trees[De]=this._createTree(this._cluster(et,De)),ie&&console.log("z%d: %d clusters in %dms",De,et.numItems,+Date.now()-ot)}return ie&&console.timeEnd("total time"),this}getClusters(te,ie){let de=((te[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,te[1]));let je=te[2]===180?180:((te[2]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)de=-180,je=180;else if(de>je){const rt=this.getClusters([de,Se,180,We],ie),Et=this.getClusters([-180,Se,je,We],ie);return rt.concat(Et)}const et=this.trees[this._limitZoom(ie)],De=et.range(Zt(de),oi(We),Zt(je),oi(Se)),ot=et.data,mt=[];for(const rt of De){const Et=this.stride*rt;mt.push(ot[Et+ht]>1?vt(ot,Et,this.clusterProps):this.points[ot[Et+Ze]])}return mt}getChildren(te){const ie=this._getOriginId(te),de=this._getOriginZoom(te),Se="No cluster with the specified id.",je=this.trees[de];if(!je)throw new Error(Se);const We=je.data;if(ie*this.stride>=We.length)throw new Error(Se);const et=this.options.radius/(this.options.extent*Math.pow(2,de-1)),De=je.within(We[ie*this.stride],We[ie*this.stride+1],et),ot=[];for(const mt of De){const rt=mt*this.stride;We[rt+4]===te&&ot.push(We[rt+ht]>1?vt(We,rt,this.clusterProps):this.points[We[rt+Ze]])}if(ot.length===0)throw new Error(Se);return ot}getLeaves(te,ie,de){const Se=[];return this._appendLeaves(Se,te,ie=ie||10,de=de||0,0),Se}getTile(te,ie,de){const Se=this.trees[this._limitZoom(te)],je=Math.pow(2,te),{extent:We,radius:et}=this.options,De=et/We,ot=(de-De)/je,mt=(de+1+De)/je,rt={features:[]};return this._addTileFeatures(Se.range((ie-De)/je,ot,(ie+1+De)/je,mt),Se.data,ie,de,je,rt),ie===0&&this._addTileFeatures(Se.range(1-De/je,ot,1,mt),Se.data,je,de,je,rt),ie===je-1&&this._addTileFeatures(Se.range(0,ot,De/je,mt),Se.data,-1,de,je,rt),rt.features.length?rt:null}getClusterExpansionZoom(te){let ie=this._getOriginZoom(te)-1;for(;ie<=this.options.maxZoom;){const de=this.getChildren(te);if(ie++,de.length!==1)break;te=de[0].properties.cluster_id}return ie}_appendLeaves(te,ie,de,Se,je){const We=this.getChildren(ie);for(const et of We){const De=et.properties;if(De&&De.cluster?je+De.point_count<=Se?je+=De.point_count:je=this._appendLeaves(te,De.cluster_id,de,Se,je):je<Se?je++:te.push(et),te.length===de)break}return je}_createTree(te){const ie=new f.av(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<te.length;de+=this.stride)ie.add(te[de],te[de+1]);return ie.finish(),ie.data=te,ie}_addTileFeatures(te,ie,de,Se,je,We){for(const et of te){const De=et*this.stride,ot=ie[De+ht]>1;let mt,rt,Et;if(ot)mt=St(ie,De,this.clusterProps),rt=ie[De],Et=ie[De+1];else{const Ri=this.points[ie[De+Ze]];mt=Ri.properties;const[bi,zi]=Ri.geometry.coordinates;rt=Zt(bi),Et=oi(zi)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(rt*je-de)),Math.round(this.options.extent*(Et*je-Se))]],tags:mt};let ri;ri=ot||this.options.generateId?ie[De+Ze]:this.points[ie[De+Ze]].id,ri!==void 0&&(Yt.id=ri),We.features.push(Yt)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ie){const{radius:de,extent:Se,reduce:je,minPoints:We}=this.options,et=de/(Se*Math.pow(2,ie)),De=te.data,ot=[],mt=this.stride;for(let rt=0;rt<De.length;rt+=mt){if(De[rt+2]<=ie)continue;De[rt+2]=ie;const Et=De[rt],Yt=De[rt+1],ri=te.within(De[rt],De[rt+1],et),Ri=De[rt+ht];let bi=Ri;for(const zi of ri){const Si=zi*mt;De[Si+2]>ie&&(bi+=De[Si+ht])}if(bi>Ri&&bi>=We){let zi,Si=Et*Ri,un=Yt*Ri,hn=-1;const Xe=((rt/mt|0)<<5)+(ie+1)+this.points.length;for(const di of ri){const xi=di*mt;if(De[xi+2]<=ie)continue;De[xi+2]=ie;const Bi=De[xi+ht];Si+=De[xi]*Bi,un+=De[xi+1]*Bi,De[xi+4]=Xe,je&&(zi||(zi=this._map(De,rt,!0),hn=this.clusterProps.length,this.clusterProps.push(zi)),je(zi,this._map(De,xi)))}De[rt+4]=Xe,ot.push(Si/bi,un/bi,1/0,Xe,-1,bi),je&&ot.push(hn)}else{for(let zi=0;zi<mt;zi++)ot.push(De[rt+zi]);if(bi>1)for(const zi of ri){const Si=zi*mt;if(!(De[Si+2]<=ie)){De[Si+2]=ie;for(let un=0;un<mt;un++)ot.push(De[Si+un])}}}}return ot}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ie,de){if(te[ie+ht]>1){const We=this.clusterProps[te[ie+kt]];return de?Object.assign({},We):We}const Se=this.points[te[ie+Ze]].properties,je=this.options.map(Se);return de&&je===Se?Object.assign({},je):je}}function vt(Ae,te,ie){return{type:"Feature",id:Ae[te+Ze],properties:St(Ae,te,ie),geometry:{type:"Point",coordinates:[(de=Ae[te],360*(de-.5)),Mi(Ae[te+1])]}};var de}function St(Ae,te,ie){const de=Ae[te+ht],Se=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,je=Ae[te+kt],We=je===-1?{}:Object.assign({},ie[je]);return Object.assign(We,{cluster:!0,cluster_id:Ae[te+Ze],point_count:de,point_count_abbreviated:Se})}function Zt(Ae){return Ae/360+.5}function oi(Ae){const te=Math.sin(Ae*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Mi(Ae){const te=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Pi(Ae,te,ie,de){let Se=de;const je=te+(ie-te>>1);let We,et=ie-te;const De=Ae[te],ot=Ae[te+1],mt=Ae[ie],rt=Ae[ie+1];for(let Et=te+3;Et<ie;Et+=3){const Yt=Ti(Ae[Et],Ae[Et+1],De,ot,mt,rt);if(Yt>Se)We=Et,Se=Yt;else if(Yt===Se){const ri=Math.abs(Et-je);ri<et&&(We=Et,et=ri)}}Se>de&&(We-te>3&&Pi(Ae,te,We,de),Ae[We+2]=Se,ie-We>3&&Pi(Ae,We,ie,de))}function Ti(Ae,te,ie,de,Se,je){let We=Se-ie,et=je-de;if(We!==0||et!==0){const De=((Ae-ie)*We+(te-de)*et)/(We*We+et*et);De>1?(ie=Se,de=je):De>0&&(ie+=We*De,de+=et*De)}return We=Ae-ie,et=te-de,We*We+et*et}function At(Ae,te,ie,de){const Se={id:Ae??null,type:te,geometry:ie,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")He(Se,ie);else if(te==="Polygon")He(Se,ie[0]);else if(te==="MultiLineString")for(const je of ie)He(Se,je);else if(te==="MultiPolygon")for(const je of ie)He(Se,je[0]);return Se}function He(Ae,te){for(let ie=0;ie<te.length;ie+=3)Ae.minX=Math.min(Ae.minX,te[ie]),Ae.minY=Math.min(Ae.minY,te[ie+1]),Ae.maxX=Math.max(Ae.maxX,te[ie]),Ae.maxY=Math.max(Ae.maxY,te[ie+1])}function Pt(Ae,te,ie,de){if(!te.geometry)return;const Se=te.geometry.coordinates;if(Se&&Se.length===0)return;const je=te.geometry.type,We=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let et=[],De=te.id;if(ie.promoteId?De=te.properties[ie.promoteId]:ie.generateId&&(De=de||0),je==="Point")ni(Se,et);else if(je==="MultiPoint")for(const ot of Se)ni(ot,et);else if(je==="LineString")Ye(Se,et,We,!1);else if(je==="MultiLineString"){if(ie.lineMetrics){for(const ot of Se)et=[],Ye(ot,et,We,!1),Ae.push(At(De,"LineString",et,te.properties));return}gi(Se,et,We,!1)}else if(je==="Polygon")gi(Se,et,We,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(const ot of te.geometry.geometries)Pt(Ae,{id:De,geometry:ot,properties:te.properties},ie,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ot of Se){const mt=[];gi(ot,mt,We,!0),et.push(mt)}}Ae.push(At(De,je,et,te.properties))}function ni(Ae,te){te.push(pt(Ae[0]),it(Ae[1]),0)}function Ye(Ae,te,ie,de){let Se,je,We=0;for(let De=0;De<Ae.length;De++){const ot=pt(Ae[De][0]),mt=it(Ae[De][1]);te.push(ot,mt,0),De>0&&(We+=de?(Se*mt-ot*je)/2:Math.sqrt(Math.pow(ot-Se,2)+Math.pow(mt-je,2))),Se=ot,je=mt}const et=te.length-3;te[2]=1,Pi(te,0,et,ie),te[et+2]=1,te.size=Math.abs(We),te.start=0,te.end=te.size}function gi(Ae,te,ie,de){for(let Se=0;Se<Ae.length;Se++){const je=[];Ye(Ae[Se],je,ie,de),te.push(je)}}function pt(Ae){return Ae/360+.5}function it(Ae){const te=Math.sin(Ae*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function ue(Ae,te,ie,de,Se,je,We,et){if(de/=te,je>=(ie/=te)&&We<de)return Ae;if(We<ie||je>=de)return null;const De=[];for(const ot of Ae){const mt=ot.geometry;let rt=ot.type;const Et=Se===0?ot.minX:ot.minY,Yt=Se===0?ot.maxX:ot.maxY;if(Et>=ie&&Yt<de){De.push(ot);continue}if(Yt<ie||Et>=de)continue;let ri=[];if(rt==="Point"||rt==="MultiPoint")H(mt,ri,ie,de,Se);else if(rt==="LineString")Y(mt,ri,ie,de,Se,!1,et.lineMetrics);else if(rt==="MultiLineString")qe(mt,ri,ie,de,Se,!1);else if(rt==="Polygon")qe(mt,ri,ie,de,Se,!0);else if(rt==="MultiPolygon")for(const Ri of mt){const bi=[];qe(Ri,bi,ie,de,Se,!0),bi.length&&ri.push(bi)}if(ri.length){if(et.lineMetrics&&rt==="LineString"){for(const Ri of ri)De.push(At(ot.id,rt,Ri,ot.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(ri.length===1?(rt="LineString",ri=ri[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=ri.length===3?"Point":"MultiPoint"),De.push(At(ot.id,rt,ri,ot.tags))}}return De.length?De:null}function H(Ae,te,ie,de,Se){for(let je=0;je<Ae.length;je+=3){const We=Ae[je+Se];We>=ie&&We<=de&&ut(te,Ae[je],Ae[je+1],Ae[je+2])}}function Y(Ae,te,ie,de,Se,je,We){let et=Ie(Ae);const De=Se===0?st:ki;let ot,mt,rt=Ae.start;for(let bi=0;bi<Ae.length-3;bi+=3){const zi=Ae[bi],Si=Ae[bi+1],un=Ae[bi+2],hn=Ae[bi+3],Xe=Ae[bi+4],di=Se===0?zi:Si,xi=Se===0?hn:Xe;let Bi=!1;We&&(ot=Math.sqrt(Math.pow(zi-hn,2)+Math.pow(Si-Xe,2))),di<ie?xi>ie&&(mt=De(et,zi,Si,hn,Xe,ie),We&&(et.start=rt+ot*mt)):di>de?xi<de&&(mt=De(et,zi,Si,hn,Xe,de),We&&(et.start=rt+ot*mt)):ut(et,zi,Si,un),xi<ie&&di>=ie&&(mt=De(et,zi,Si,hn,Xe,ie),Bi=!0),xi>de&&di<=de&&(mt=De(et,zi,Si,hn,Xe,de),Bi=!0),!je&&Bi&&(We&&(et.end=rt+ot*mt),te.push(et),et=Ie(Ae)),We&&(rt+=ot)}let Et=Ae.length-3;const Yt=Ae[Et],ri=Ae[Et+1],Ri=Se===0?Yt:ri;Ri>=ie&&Ri<=de&&ut(et,Yt,ri,Ae[Et+2]),Et=et.length-3,je&&Et>=3&&(et[Et]!==et[0]||et[Et+1]!==et[1])&&ut(et,et[0],et[1],et[2]),et.length&&te.push(et)}function Ie(Ae){const te=[];return te.size=Ae.size,te.start=Ae.start,te.end=Ae.end,te}function qe(Ae,te,ie,de,Se,je){for(const We of Ae)Y(We,te,ie,de,Se,je,!1)}function ut(Ae,te,ie,de){Ae.push(te,ie,de)}function st(Ae,te,ie,de,Se,je){const We=(je-te)/(de-te);return ut(Ae,je,ie+(Se-ie)*We,1),We}function ki(Ae,te,ie,de,Se,je){const We=(je-ie)/(Se-ie);return ut(Ae,te+(de-te)*We,je,1),We}function ct(Ae,te){const ie=[];for(let de=0;de<Ae.length;de++){const Se=Ae[de],je=Se.type;let We;if(je==="Point"||je==="MultiPoint"||je==="LineString")We=Vt(Se.geometry,te);else if(je==="MultiLineString"||je==="Polygon"){We=[];for(const et of Se.geometry)We.push(Vt(et,te))}else if(je==="MultiPolygon"){We=[];for(const et of Se.geometry){const De=[];for(const ot of et)De.push(Vt(ot,te));We.push(De)}}ie.push(At(Se.id,je,We,Se.tags))}return ie}function Vt(Ae,te){const ie=[];ie.size=Ae.size,Ae.start!==void 0&&(ie.start=Ae.start,ie.end=Ae.end);for(let de=0;de<Ae.length;de+=3)ie.push(Ae[de]+te,Ae[de+1],Ae[de+2]);return ie}function Ci(Ae,te){if(Ae.transformed)return Ae;const ie=1<<Ae.z,de=Ae.x,Se=Ae.y;for(const je of Ae.features){const We=je.geometry,et=je.type;if(je.geometry=[],et===1)for(let De=0;De<We.length;De+=2)je.geometry.push(Fi(We[De],We[De+1],te,ie,de,Se));else for(let De=0;De<We.length;De++){const ot=[];for(let mt=0;mt<We[De].length;mt+=2)ot.push(Fi(We[De][mt],We[De][mt+1],te,ie,de,Se));je.geometry.push(ot)}}return Ae.transformed=!0,Ae}function Fi(Ae,te,ie,de,Se,je){return[Math.round(ie*(Ae*de-Se)),Math.round(ie*(te*de-je))]}function Cn(Ae,te,ie,de,Se){const je=te===Se.maxZoom?0:Se.tolerance/((1<<te)*Se.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:Ae.length,source:null,x:ie,y:de,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of Ae)xt(We,et,je,Se);return We}function xt(Ae,te,ie,de){const Se=te.geometry,je=te.type,We=[];if(Ae.minX=Math.min(Ae.minX,te.minX),Ae.minY=Math.min(Ae.minY,te.minY),Ae.maxX=Math.max(Ae.maxX,te.maxX),Ae.maxY=Math.max(Ae.maxY,te.maxY),je==="Point"||je==="MultiPoint")for(let et=0;et<Se.length;et+=3)We.push(Se[et],Se[et+1]),Ae.numPoints++,Ae.numSimplified++;else if(je==="LineString")li(We,Se,Ae,ie,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(let et=0;et<Se.length;et++)li(We,Se[et],Ae,ie,je==="Polygon",et===0);else if(je==="MultiPolygon")for(let et=0;et<Se.length;et++){const De=Se[et];for(let ot=0;ot<De.length;ot++)li(We,De[ot],Ae,ie,!0,ot===0)}if(We.length){let et=te.tags||null;if(je==="LineString"&&de.lineMetrics){et={};for(const ot in te.tags)et[ot]=te.tags[ot];et.mapbox_clip_start=Se.start/Se.size,et.mapbox_clip_end=Se.end/Se.size}const De={geometry:We,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:et};te.id!==null&&(De.id=te.id),Ae.features.push(De)}}function li(Ae,te,ie,de,Se,je){const We=de*de;if(de>0&&te.size<(Se?We:de))return void(ie.numPoints+=te.length/3);const et=[];for(let De=0;De<te.length;De+=3)(de===0||te[De+2]>We)&&(ie.numSimplified++,et.push(te[De],te[De+1])),ie.numPoints++;Se&&function(De,ot){let mt=0;for(let rt=0,Et=De.length,Yt=Et-2;rt<Et;Yt=rt,rt+=2)mt+=(De[rt]-De[Yt])*(De[rt+1]+De[Yt+1]);if(mt>0===ot)for(let rt=0,Et=De.length;rt<Et/2;rt+=2){const Yt=De[rt],ri=De[rt+1];De[rt]=De[Et-2-rt],De[rt+1]=De[Et-1-rt],De[Et-2-rt]=Yt,De[Et-1-rt]=ri}}(et,je),Ae.push(et)}const ii={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class tn{constructor(te,ie){const de=(ie=this.options=function(je,We){for(const et in We)je[et]=We[et];return je}(Object.create(ii),ie)).debug;if(de&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=function(je,We){const et=[];if(je.type==="FeatureCollection")for(let De=0;De<je.features.length;De++)Pt(et,je.features[De],We,De);else Pt(et,je.type==="Feature"?je:{geometry:je},We);return et}(te,ie);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=function(je,We){const et=We.buffer/We.extent;let De=je;const ot=ue(je,1,-1-et,et,0,-1,2,We),mt=ue(je,1,1-et,2+et,0,-1,2,We);return(ot||mt)&&(De=ue(je,1,-et,1+et,0,-1,2,We)||[],ot&&(De=ct(ot,1).concat(De)),mt&&(De=De.concat(ct(mt,-1)))),De}(Se,ie),Se.length&&this.splitTile(Se,0,0,0),de&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,ie,de,Se,je,We,et){const De=[te,ie,de,Se],ot=this.options,mt=ot.debug;for(;De.length;){Se=De.pop(),de=De.pop(),ie=De.pop(),te=De.pop();const rt=1<<ie,Et=fr(ie,de,Se);let Yt=this.tiles[Et];if(!Yt&&(mt>1&&console.time("creation"),Yt=this.tiles[Et]=Cn(te,ie,de,Se,ot),this.tileCoords.push({z:ie,x:de,y:Se}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,de,Se,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));const Bi=`z${ie}`;this.stats[Bi]=(this.stats[Bi]||0)+1,this.total++}if(Yt.source=te,je==null){if(ie===ot.indexMaxZoom||Yt.numPoints<=ot.indexMaxPoints)continue}else{if(ie===ot.maxZoom||ie===je)continue;if(je!=null){const Bi=je-ie;if(de!==We>>Bi||Se!==et>>Bi)continue}}if(Yt.source=null,te.length===0)continue;mt>1&&console.time("clipping");const ri=.5*ot.buffer/ot.extent,Ri=.5-ri,bi=.5+ri,zi=1+ri;let Si=null,un=null,hn=null,Xe=null,di=ue(te,rt,de-ri,de+bi,0,Yt.minX,Yt.maxX,ot),xi=ue(te,rt,de+Ri,de+zi,0,Yt.minX,Yt.maxX,ot);te=null,di&&(Si=ue(di,rt,Se-ri,Se+bi,1,Yt.minY,Yt.maxY,ot),un=ue(di,rt,Se+Ri,Se+zi,1,Yt.minY,Yt.maxY,ot),di=null),xi&&(hn=ue(xi,rt,Se-ri,Se+bi,1,Yt.minY,Yt.maxY,ot),Xe=ue(xi,rt,Se+Ri,Se+zi,1,Yt.minY,Yt.maxY,ot),xi=null),mt>1&&console.timeEnd("clipping"),De.push(Si||[],ie+1,2*de,2*Se),De.push(un||[],ie+1,2*de,2*Se+1),De.push(hn||[],ie+1,2*de+1,2*Se),De.push(Xe||[],ie+1,2*de+1,2*Se+1)}}getTile(te,ie,de){te=+te,ie=+ie,de=+de;const Se=this.options,{extent:je,debug:We}=Se;if(te<0||te>24)return null;const et=1<<te,De=fr(te,ie=ie+et&et-1,de);if(this.tiles[De])return Ci(this.tiles[De],je);We>1&&console.log("drilling down to z%d-%d-%d",te,ie,de);let ot,mt=te,rt=ie,Et=de;for(;!ot&&mt>0;)mt--,rt>>=1,Et>>=1,ot=this.tiles[fr(mt,rt,Et)];return ot&&ot.source?(We>1&&(console.log("found parent tile z%d-%d-%d",mt,rt,Et),console.time("drilling down")),this.splitTile(ot.source,mt,rt,Et,te,ie,de),We>1&&console.timeEnd("drilling down"),this.tiles[De]?Ci(this.tiles[De],je):null):null}}function fr(Ae,te,ie){return 32*((1<<Ae)*ie+te)+Ae}function ai(Ae,te){return te?Ae.properties[te]:Ae.id}function dr(Ae,te){if(Ae==null)return!0;if(Ae.type==="Feature")return ai(Ae,te)!=null;if(Ae.type==="FeatureCollection"){const ie=new Set;for(const de of Ae.features){const Se=ai(de,te);if(Se==null||ie.has(Se))return!1;ie.add(Se)}return!0}return!1}function pr(Ae,te){const ie=new Map;if(Ae!=null)if(Ae.type==="Feature")ie.set(ai(Ae,te),Ae);else for(const de of Ae.features)ie.set(ai(de,te),de);return ie}class Sr extends y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(te,ie){return f._(this,void 0,void 0,function*(){const de=te.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!Se)return null;const je=new class{constructor(et){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.X,this.length=et.length,this._features=et}feature(et){return new class{constructor(De){this._feature=De,this.extent=f.X,this.type=De.type,this.properties=De.tags,"id"in De&&!isNaN(De.id)&&(this.id=parseInt(De.id,10))}loadGeometry(){if(this._feature.type===1){const De=[];for(const ot of this._feature.geometry)De.push([new f.P(ot[0],ot[1])]);return De}{const De=[];for(const ot of this._feature.geometry){const mt=[];for(const rt of ot)mt.push(new f.P(rt[0],rt[1]));De.push(mt)}return De}}toGeoJSON(De,ot,mt){return B.call(this,De,ot,mt)}}(this._features[et])}}(Se.features);let We=he(je);return We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),{vectorTile:je,rawData:We.buffer}})}loadData(te){return f._(this,void 0,void 0,function*(){var ie;(ie=this._pendingRequest)===null||ie===void 0||ie.abort();const de=!!(te&&te.request&&te.request.collectResourceTiming)&&new f.bv(te.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(te,this._pendingRequest),this._geoJSONIndex=te.cluster?new $e(function({superclusterOptions:We,clusterProperties:et}){if(!et||!We)return We;const De={},ot={},mt={accumulated:null,zoom:0},rt={properties:null},Et=Object.keys(et);for(const Yt of Et){const[ri,Ri]=et[Yt],bi=f.bC(Ri),zi=f.bC(typeof ri=="string"?[ri,["accumulated"],["get",Yt]]:ri);De[Yt]=bi.value,ot[Yt]=zi.value}return We.map=Yt=>{rt.properties=Yt;const ri={};for(const Ri of Et)ri[Ri]=De[Ri].evaluate(mt,rt);return ri},We.reduce=(Yt,ri)=>{rt.properties=ri;for(const Ri of Et)mt.accumulated=Yt[Ri],Yt[Ri]=ot[Ri].evaluate(mt,rt)},We}(te)).load((yield this._pendingData).features):(Se=yield this._pendingData,new tn(Se,te.geojsonVtOptions)),this.loaded={};const je={};if(de){const We=de.finish();We&&(je.resourceTiming={},je.resourceTiming[te.source]=JSON.parse(JSON.stringify(We)))}return je}catch(je){if(delete this._pendingRequest,f.bB(je))return{abandoned:!0};throw je}var Se})}getData(){return f._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(te){const ie=this.loaded;return ie&&ie[te.uid]?super.reloadTile(te):this.loadTile(te)}loadAndProcessGeoJSON(te,ie){return f._(this,void 0,void 0,function*(){let de=yield this.loadGeoJSON(te,ie);if(delete this._pendingRequest,typeof de!="object")throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(L(de,!0),te.filter){const Se=f.bC(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(We=>`${We.key}: ${We.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(We=>Se.value.evaluate({zoom:0},We))}}return de})}loadGeoJSON(te,ie){return f._(this,void 0,void 0,function*(){const{promoteId:de}=te;if(te.request){const Se=yield f.h(te.request,ie);return this._dataUpdateable=dr(Se.data,de)?pr(Se.data,de):void 0,Se.data}if(typeof te.data=="string")try{const Se=JSON.parse(te.data);return this._dataUpdateable=dr(Se,de)?pr(Se,de):void 0,Se}catch{throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`)}if(!te.dataDiff)throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${te.source}`);return function(Se,je,We){var et,De,ot,mt;if(je.removeAll&&Se.clear(),je.remove)for(const rt of je.remove)Se.delete(rt);if(je.add)for(const rt of je.add){const Et=ai(rt,We);Et!=null&&Se.set(Et,rt)}if(je.update)for(const rt of je.update){let Et=Se.get(rt.id);if(Et==null)continue;const Yt=!rt.removeAllProperties&&(((et=rt.removeProperties)===null||et===void 0?void 0:et.length)>0||((De=rt.addOrUpdateProperties)===null||De===void 0?void 0:De.length)>0);if((rt.newGeometry||rt.removeAllProperties||Yt)&&(Et=Object.assign({},Et),Se.set(rt.id,Et),Yt&&(Et.properties=Object.assign({},Et.properties))),rt.newGeometry&&(Et.geometry=rt.newGeometry),rt.removeAllProperties)Et.properties={};else if(((ot=rt.removeProperties)===null||ot===void 0?void 0:ot.length)>0)for(const ri of rt.removeProperties)Object.prototype.hasOwnProperty.call(Et.properties,ri)&&delete Et.properties[ri];if(((mt=rt.addOrUpdateProperties)===null||mt===void 0?void 0:mt.length)>0)for(const{key:ri,value:Ri}of rt.addOrUpdateProperties)Et.properties[ri]=Ri}}(this._dataUpdateable,te.dataDiff,de),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(te){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(te){return this._geoJSONIndex.getClusterExpansionZoom(te.clusterId)}getClusterChildren(te){return this._geoJSONIndex.getChildren(te.clusterId)}getClusterLeaves(te){return this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset)}}class Tr{constructor(te){this.self=te,this.actor=new f.F(te),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ie,de)=>{if(this.externalWorkerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.externalWorkerSourceTypes[ie]=de},this.self.addProtocol=f.bi,this.self.removeProtocol=f.bj,this.self.registerRTLTextPlugin=ie=>{if(f.bD.isParsed())throw new Error("RTL text plugin already registered.");f.bD.setMethods(ie)},this.actor.registerMessageHandler("LDT",(ie,de)=>this._getDEMWorkerSource(ie,de.source).loadTile(de)),this.actor.registerMessageHandler("RDT",(ie,de)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ie,de.source).removeTile(de)})),this.actor.registerMessageHandler("GCEZ",(ie,de)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,de.type,de.source).getClusterExpansionZoom(de)})),this.actor.registerMessageHandler("GCC",(ie,de)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,de.type,de.source).getClusterChildren(de)})),this.actor.registerMessageHandler("GCL",(ie,de)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,de.type,de.source).getClusterLeaves(de)})),this.actor.registerMessageHandler("LD",(ie,de)=>this._getWorkerSource(ie,de.type,de.source).loadData(de)),this.actor.registerMessageHandler("GD",(ie,de)=>this._getWorkerSource(ie,de.type,de.source).getData()),this.actor.registerMessageHandler("LT",(ie,de)=>this._getWorkerSource(ie,de.type,de.source).loadTile(de)),this.actor.registerMessageHandler("RT",(ie,de)=>this._getWorkerSource(ie,de.type,de.source).reloadTile(de)),this.actor.registerMessageHandler("AT",(ie,de)=>this._getWorkerSource(ie,de.type,de.source).abortTile(de)),this.actor.registerMessageHandler("RMT",(ie,de)=>this._getWorkerSource(ie,de.type,de.source).removeTile(de)),this.actor.registerMessageHandler("RS",(ie,de)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[ie]||!this.workerSources[ie][de.type]||!this.workerSources[ie][de.type][de.source])return;const Se=this.workerSources[ie][de.type][de.source];delete this.workerSources[ie][de.type][de.source],Se.removeSource!==void 0&&Se.removeSource(de)})),this.actor.registerMessageHandler("RM",ie=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie]})),this.actor.registerMessageHandler("SR",(ie,de)=>f._(this,void 0,void 0,function*(){this.referrer=de})),this.actor.registerMessageHandler("SRPS",(ie,de)=>this._syncRTLPluginState(ie,de)),this.actor.registerMessageHandler("IS",(ie,de)=>f._(this,void 0,void 0,function*(){this.self.importScripts(de)})),this.actor.registerMessageHandler("SI",(ie,de)=>this._setImages(ie,de)),this.actor.registerMessageHandler("UL",(ie,de)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(ie).update(de.layers,de.removedIds)})),this.actor.registerMessageHandler("SL",(ie,de)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(ie).replace(de)}))}_setImages(te,ie){return f._(this,void 0,void 0,function*(){this.availableImages[te]=ie;for(const de in this.workerSources[te]){const Se=this.workerSources[te][de];for(const je in Se)Se[je].availableImages=ie}})}_syncRTLPluginState(te,ie){return f._(this,void 0,void 0,function*(){if(f.bD.isParsed())return f.bD.getState();if(ie.pluginStatus!=="loading")return f.bD.setState(ie),ie;const de=ie.pluginURL;if(this.self.importScripts(de),f.bD.isParsed()){const Se={pluginStatus:"loaded",pluginURL:de};return f.bD.setState(Se),Se}throw f.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${de}`)})}_getAvailableImages(te){let ie=this.availableImages[te];return ie||(ie=[]),ie}_getLayerIndex(te){let ie=this.layerIndexes[te];return ie||(ie=this.layerIndexes[te]=new o),ie}_getWorkerSource(te,ie,de){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][ie]||(this.workerSources[te][ie]={}),!this.workerSources[te][ie][de]){const Se={sendAsync:(je,We)=>(je.targetMapId=te,this.actor.sendAsync(je,We))};switch(ie){case"vector":this.workerSources[te][ie][de]=new y(Se,this._getLayerIndex(te),this._getAvailableImages(te));break;case"geojson":this.workerSources[te][ie][de]=new Sr(Se,this._getLayerIndex(te),this._getAvailableImages(te));break;default:this.workerSources[te][ie][de]=new this.externalWorkerSourceTypes[ie](Se,this._getLayerIndex(te),this._getAvailableImages(te))}}return this.workerSources[te][ie][de]}_getDEMWorkerSource(te,ie){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][ie]||(this.demWorkerSources[te][ie]=new k),this.demWorkerSources[te][ie]}}return f.i(self)&&(self.worker=new Tr(self)),Tr}),u("index",["exports","./shared"],function(f,o){var _="4.7.1";let S,T;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((e,c)=>{const p=requestAnimationFrame(e);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),c(o.c())})}),getImageData(v,e=0){return this.getImageCanvasContext(v).getImageData(-e,-e,v.width+2*e,v.height+2*e)},getImageCanvasContext(v){const e=window.document.createElement("canvas"),c=e.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return e.width=v.width,e.height=v.height,c.drawImage(v,0,0,v.width,v.height),c},resolveURL:v=>(S||(S=document.createElement("a")),S.href=v,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}};class k{static testProp(e){if(!k.docStyle)return e[0];for(let c=0;c<e.length;c++)if(e[c]in k.docStyle)return e[c];return e[0]}static create(e,c,p){const m=window.document.createElement(e);return c!==void 0&&(m.className=c),p&&p.appendChild(m),m}static createNS(e,c){return window.document.createElementNS(e,c)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(e,c){e.style[k.transformProp]=c}static addEventListener(e,c,p,m={}){e.addEventListener(c,p,"passive"in m?m:m.capture)}static removeEventListener(e,c,p,m={}){e.removeEventListener(c,p,"passive"in m?m:m.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static getScale(e){const c=e.getBoundingClientRect();return{x:c.width/e.offsetWidth||1,y:c.height/e.offsetHeight||1,boundingClientRect:c}}static getPoint(e,c,p){const m=c.boundingClientRect;return new o.P((p.clientX-m.left)/c.x-e.clientLeft,(p.clientY-m.top)/c.y-e.clientTop)}static mousePos(e,c){const p=k.getScale(e);return k.getPoint(e,p,c)}static touchPos(e,c){const p=[],m=k.getScale(e);for(let b=0;b<c.length;b++)p.push(k.getPoint(e,m,c[b]));return p}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);const I={supported:!1,testSupport:function(v){!B&&L&&(N?F(v):C=v)}};let C,L,B=!1,N=!1;function F(v){const e=v.createTexture();v.bindTexture(v.TEXTURE_2D,e);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,L),v.isContextLost())return;I.supported=!0}catch{}v.deleteTexture(e),B=!0}var W;typeof document<"u"&&(L=document.createElement("img"),L.onload=()=>{C&&F(C),C=null,N=!0},L.onerror=()=>{B=!0,C=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let e,c,p,m;v.resetRequestQueue=()=>{e=[],c=0,p=0,m={}},v.addThrottleControl=z=>{const q=p++;return m[q]=z,q},v.removeThrottleControl=z=>{delete m[z],A()},v.getImage=(z,q,X=!0)=>new Promise((K,ae)=>{I.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),o.e(z,{type:"image"}),e.push({abortController:q,requestParameters:z,supportImageRefresh:X,state:"queued",onError:me=>{ae(me)},onSuccess:me=>{K(me)}}),A()});const b=z=>o._(this,void 0,void 0,function*(){z.state="running";const{requestParameters:q,supportImageRefresh:X,onError:K,onSuccess:ae,abortController:me}=z,ve=X===!1&&!o.i(self)&&!o.g(q.url)&&(!q.headers||Object.keys(q.headers).reduce((ze,Ne)=>ze&&Ne==="accept",!0));c++;const Ee=ve?P(q,me):o.m(q,me);try{const ze=yield Ee;delete z.abortController,z.state="completed",ze.data instanceof HTMLImageElement||o.b(ze.data)?ae(ze):ze.data&&ae({data:yield(Le=ze.data,typeof createImageBitmap=="function"?o.d(Le):o.f(Le)),cacheControl:ze.cacheControl,expires:ze.expires})}catch(ze){delete z.abortController,K(ze)}finally{c--,A()}var Le}),A=()=>{const z=(()=>{for(const q of Object.keys(m))if(m[q]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let q=c;q<z&&e.length>0;q++){const X=e.shift();X.abortController.signal.aborted?q--:b(X)}},P=(z,q)=>new Promise((X,K)=>{const ae=new Image,me=z.url,ve=z.credentials;ve&&ve==="include"?ae.crossOrigin="use-credentials":(ve&&ve==="same-origin"||!o.s(me))&&(ae.crossOrigin="anonymous"),q.signal.addEventListener("abort",()=>{ae.src="",K(o.c())}),ae.fetchPriority="high",ae.onload=()=>{ae.onerror=ae.onload=null,X({data:ae})},ae.onerror=()=>{ae.onerror=ae.onload=null,q.signal.aborted||K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ae.src=me})}(W||(W={})),W.resetRequestQueue();class ee{constructor(e){this._transformRequestFn=e}transformRequest(e,c){return this._transformRequestFn&&this._transformRequestFn(e,c)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function oe(v){var e=new o.A(3);return e[0]=v[0],e[1]=v[1],e[2]=v[2],e}var $,re=function(v,e,c){return v[0]=e[0]-c[0],v[1]=e[1]-c[1],v[2]=e[2]-c[2],v};$=new o.A(3),o.A!=Float32Array&&($[0]=0,$[1]=0,$[2]=0);var j=function(v){var e=v[0],c=v[1];return e*e+c*c};function U(v){const e=[];if(typeof v=="string")e.push({id:"default",url:v});else if(v&&v.length>0){const c=[];for(const{id:p,url:m}of v){const b=`${p}${m}`;c.indexOf(b)===-1&&(c.push(b),e.push({id:p,url:m}))}}return e}function J(v,e,c){const p=v.split("?");return p[0]+=`${e}${c}`,p.join("?")}(function(){var v=new o.A(2);o.A!=Float32Array&&(v[0]=0,v[1]=0)})();class R{constructor(e,c,p,m){this.context=e,this.format=p,this.texture=e.gl.createTexture(),this.update(c,m)}update(e,c,p){const{width:m,height:b}=e,A=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:P}=this,{gl:z}=P;if(this.useMipmap=!!(c&&c.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!c||c.premultiply!==!1)),A)this.size=[m,b],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||o.b(e)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,e):z.texImage2D(z.TEXTURE_2D,0,this.format,m,b,0,this.format,z.UNSIGNED_BYTE,e.data);else{const{x:q,y:X}=p||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||o.b(e)?z.texSubImage2D(z.TEXTURE_2D,0,q,X,z.RGBA,z.UNSIGNED_BYTE,e):z.texSubImage2D(z.TEXTURE_2D,0,q,X,m,b,z.RGBA,z.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(e,c,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),e!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,e),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||e),this.filter=e),c!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,c),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Z(v){const{userImage:e}=v;return!!(e&&e.render&&e.render())&&(v.data.replace(new Uint8Array(e.data.buffer)),!0)}class ce extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:c,promiseResolve:p}of this.requestors)p(this._getImagesForIds(c));this.requestors=[]}}getImage(e){const c=this.images[e];if(c&&!c.data&&c.spriteData){const p=c.spriteData;c.data=new o.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),c.spriteData=null}return c}addImage(e,c){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,c)&&(this.images[e]=c)}_validate(e,c){let p=!0;const m=c.data||c.spriteData;return this._validateStretch(c.stretchX,m&&m.width)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,m&&m.height)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "content" value`))),p=!1),p}_validateStretch(e,c){if(!e)return!0;let p=0;for(const m of e){if(m[0]<p||m[1]<m[0]||c<m[1])return!1;p=m[1]}return!0}_validateContent(e,c){if(!e)return!0;if(e.length!==4)return!1;const p=c.spriteData,m=p&&p.width||c.data.width,b=p&&p.height||c.data.height;return!(e[0]<0||m<e[0]||e[1]<0||b<e[1]||e[2]<0||m<e[2]||e[3]<0||b<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,c,p=!0){const m=this.getImage(e);if(p&&(m.data.width!==c.data.width||m.data.height!==c.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${c.data.width}x${c.data.height}).`);c.version=m.version+1,this.images[e]=c,this.updatedImages[e]=!0}removeImage(e){const c=this.images[e];delete this.images[e],delete this.patterns[e],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((c,p)=>{let m=!0;if(!this.isLoaded())for(const b of e)this.images[b]||(m=!1);this.isLoaded()||m?c(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:c})})}_getImagesForIds(e){const c={};for(const p of e){let m=this.getImage(p);m||(this.fire(new o.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?c[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:o.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return c}getPixelSize(){const{width:e,height:c}=this.atlasImage;return{width:e,height:c}}getPattern(e){const c=this.patterns[e],p=this.getImage(e);if(!p)return null;if(c&&c.position.version===p.version)return c.position;if(c)c.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new o.I(m,p);this.patterns[e]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const c=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new R(e,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const b in this.patterns)e.push(this.patterns[b].bin);const{w:c,h:p}=o.p(e),m=this.atlasImage;m.resize({width:c||1,height:p||1});for(const b in this.patterns){const{bin:A}=this.patterns[b],P=A.x+1,z=A.y+1,q=this.getImage(b).data,X=q.width,K=q.height;o.R.copy(q,m,{x:0,y:0},{x:P,y:z},{width:X,height:K}),o.R.copy(q,m,{x:0,y:K-1},{x:P,y:z-1},{width:X,height:1}),o.R.copy(q,m,{x:0,y:0},{x:P,y:z+K},{width:X,height:1}),o.R.copy(q,m,{x:X-1,y:0},{x:P-1,y:z},{width:1,height:K}),o.R.copy(q,m,{x:0,y:0},{x:P+X,y:z},{width:1,height:K})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const c of e){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const p=this.getImage(c);p||o.w(`Image with ID: "${c}" was not found`),Z(p)&&this.updateImage(c,p)}}}const fe=1e20;function ge(v,e,c,p,m,b,A,P,z){for(let q=e;q<e+p;q++)ye(v,c*b+q,b,m,A,P,z);for(let q=c;q<c+m;q++)ye(v,q*b+e,1,p,A,P,z)}function ye(v,e,c,p,m,b,A){b[0]=0,A[0]=-fe,A[1]=fe,m[0]=v[e];for(let P=1,z=0,q=0;P<p;P++){m[P]=v[e+P*c];const X=P*P;do{const K=b[z];q=(m[P]-m[K]+X-K*K)/(P-K)/2}while(q<=A[z]&&--z>-1);z++,b[z]=P,A[z]=q,A[z+1]=fe}for(let P=0,z=0;P<p;P++){for(;A[z+1]<P;)z++;const q=b[z],X=P-q;v[e+P*c]=m[q]+X*X}}class he{constructor(e,c){this.requestManager=e,this.localIdeographFontFamily=c,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,function*(){const c=[];for(const b in e)for(const A of e[b])c.push(this._getAndCacheGlyphsPromise(b,A));const p=yield Promise.all(c),m={};for(const{stack:b,id:A,glyph:P}of p)m[b]||(m[b]={}),m[b][A]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return m})}_getAndCacheGlyphsPromise(e,c){return o._(this,void 0,void 0,function*(){let p=this.entries[e];p||(p=this.entries[e]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[c];if(m!==void 0)return{stack:e,id:c,glyph:m};if(m=this._tinySDF(p,e,c),m)return p.glyphs[c]=m,{stack:e,id:c,glyph:m};const b=Math.floor(c/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:e,id:c,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const P=he.loadGlyphRange(e,b,this.url,this.requestManager);p.requests[b]=P}const A=yield p.requests[b];for(const P in A)this._doesCharSupportLocalGlyph(+P)||(p.glyphs[+P]=A[+P]);return p.ranges[b]=!0,{stack:e,id:c,glyph:A[c]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,c,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=e.tinySDF;if(!b){let P="400";/bold/i.test(c)?P="900":/medium/i.test(c)?P="500":/light/i.test(c)&&(P="200"),b=e.tinySDF=new he.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:P})}const A=b.draw(String.fromCharCode(p));return{id:p,bitmap:new o.o({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}he.loadGlyphRange=function(v,e,c,p){return o._(this,void 0,void 0,function*(){const m=256*e,b=m+255,A=p.transformRequest(c.replace("{fontstack}",v).replace("{range}",`${m}-${b}`),"Glyphs"),P=yield o.l(A,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${e}, ${m}-${b}`);const z={};for(const q of o.n(P.data))z[q.id]=q;return z})},he.TinySDF=class{constructor({fontSize:v=24,buffer:e=3,radius:c=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:A="normal"}={}){this.buffer=e,this.cutoff=p,this.radius=c;const P=this.size=v+4*e,z=this._createCanvas(P),q=this.ctx=z.getContext("2d",{willReadFrequently:!0});q.font=`${A} ${b} ${v}px ${m}`,q.textBaseline="alphabetic",q.textAlign="left",q.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(v){const e=document.createElement("canvas");return e.width=e.height=v,e}draw(v){const{width:e,actualBoundingBoxAscent:c,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(v),A=Math.ceil(c),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),z=Math.min(this.size-this.buffer,A+Math.ceil(p)),q=P+2*this.buffer,X=z+2*this.buffer,K=Math.max(q*X,0),ae=new Uint8ClampedArray(K),me={data:ae,width:q,height:X,glyphWidth:P,glyphHeight:z,glyphTop:A,glyphLeft:0,glyphAdvance:e};if(P===0||z===0)return me;const{ctx:ve,buffer:Ee,gridInner:Le,gridOuter:ze}=this;ve.clearRect(Ee,Ee,P,z),ve.fillText(v,Ee,Ee+A);const Ne=ve.getImageData(Ee,Ee,P,z);ze.fill(fe,0,K),Le.fill(0,0,K);for(let Te=0;Te<z;Te++)for(let Ge=0;Ge<P;Ge++){const Ke=Ne.data[4*(Te*P+Ge)+3]/255;if(Ke===0)continue;const nt=(Te+Ee)*q+Ge+Ee;if(Ke===1)ze[nt]=0,Le[nt]=fe;else{const bt=.5-Ke;ze[nt]=bt>0?bt*bt:0,Le[nt]=bt<0?bt*bt:0}}ge(ze,0,0,q,X,q,this.f,this.v,this.z),ge(Le,Ee,Ee,P,z,q,this.f,this.v,this.z);for(let Te=0;Te<K;Te++){const Ge=Math.sqrt(ze[Te])-Math.sqrt(Le[Te]);ae[Te]=Math.round(255-255*(Ge/this.radius+this.cutoff))}return me}};class Fe{constructor(){this.specification=o.v.light.position}possiblyEvaluate(e,c){return o.x(e.expression.evaluate(c))}interpolate(e,c,p){return{x:o.y.number(e.x,c.x,p),y:o.y.number(e.y,c.y,p),z:o.y.number(e.z,c.z,p)}}}let Me;class lt extends o.E{constructor(e){super(),Me=Me||new o.q({anchor:new o.D(o.v.light.anchor),position:new Fe,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(Me),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,c={}){if(!this._validate(o.r,e,c))for(const p in e){const m=e[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,c,p){return(!p||p.validate!==!1)&&o.t(this,e.call(o.u,{value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Ze=new o.q({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class ht extends o.E{constructor(e){super(),this._transitionable=new o.T(Ze),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0))}setSky(e,c={}){if(!this._validate(o.B,e,c)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in e){const m=e[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,c,p={}){return(p==null?void 0:p.validate)!==!1&&o.t(this,e.call(o.u,o.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class kt{constructor(e,c){this.width=e,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,c){const p=e.join(",")+String(c);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(e,c)),this.dashEntry[p]}getDashRanges(e,c,p){const m=[];let b=e.length%2==1?-e[e.length-1]*p:0,A=e[0]*p,P=!0;m.push({left:b,right:A,isDash:P,zeroLength:e[0]===0});let z=e[0];for(let q=1;q<e.length;q++){P=!P;const X=e[q];b=z*p,z+=X,A=z*p,m.push({left:b,right:A,isDash:P,zeroLength:X===0})}return m}addRoundDash(e,c,p){const m=c/2;for(let b=-p;b<=p;b++){const A=this.width*(this.nextRow+p+b);let P=0,z=e[P];for(let q=0;q<this.width;q++){q/z.right>1&&(z=e[++P]);const X=Math.abs(q-z.left),K=Math.abs(q-z.right),ae=Math.min(X,K);let me;const ve=b/p*(m+1);if(z.isDash){const Ee=m-Math.abs(ve);me=Math.sqrt(ae*ae+Ee*Ee)}else me=m-Math.sqrt(ae*ae+ve*ve);this.data[A+q]=Math.max(0,Math.min(255,me+128))}}}addRegularDash(e){for(let P=e.length-1;P>=0;--P){const z=e[P],q=e[P+1];z.zeroLength?e.splice(P,1):q&&q.isDash===z.isDash&&(q.left=z.left,e.splice(P,1))}const c=e[0],p=e[e.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const m=this.width*this.nextRow;let b=0,A=e[b];for(let P=0;P<this.width;P++){P/A.right>1&&(A=e[++b]);const z=Math.abs(P-A.left),q=Math.abs(P-A.right),X=Math.min(z,q);this.data[m+P]=Math.max(0,Math.min(255,(A.isDash?X:-X)+128))}}addDash(e,c){const p=c?7:0,m=2*p+1;if(this.nextRow+m>this.height)return o.w("LineAtlas out of space"),null;let b=0;for(let P=0;P<e.length;P++)b+=e[P];if(b!==0){const P=this.width/b,z=this.getDashRanges(e,this.width,P);c?this.addRoundDash(z,P,p):this.addRegularDash(z)}const A={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,A}bind(e){const c=e.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}const $e="maplibre_preloaded_worker_pool";class vt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<vt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$e]}numActive(){return Object.keys(this.active).length}}const St=Math.floor(y.hardwareConcurrency/2);let Zt,oi;function Mi(){return Zt||(Zt=new vt),Zt}vt.workerCount=o.C(globalThis)?Math.max(Math.min(St,3),1):1;class Pi{constructor(e,c){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=c;const p=this.workerPool.acquire(c);for(let m=0;m<p.length;m++){const b=new o.F(p[m],c);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,c){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:e,data:c}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(c=>{c.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,c){for(const p of this.actors)p.registerMessageHandler(e,c)}}function Ti(){return oi||(oi=new Pi(Mi(),o.G),oi.registerMessageHandler("GR",(v,e,c)=>o.m(e,c))),oi}function At(v,e){const c=o.H();return o.J(c,c,[1,1,0]),o.K(c,c,[.5*v.width,.5*v.height,1]),o.L(c,c,v.calculatePosMatrix(e.toUnwrapped()))}function He(v,e,c,p,m,b){const A=function(K,ae,me){if(K)for(const ve of K){const Ee=ae[ve];if(Ee&&Ee.source===me&&Ee.type==="fill-extrusion")return!0}else for(const ve in ae){const Ee=ae[ve];if(Ee.source===me&&Ee.type==="fill-extrusion")return!0}return!1}(m&&m.layers,e,v.id),P=b.maxPitchScaleFactor(),z=v.tilesIn(p,P,A);z.sort(Pt);const q=[];for(const K of z)q.push({wrappedTileID:K.tileID.wrapped().key,queryResults:K.tile.queryRenderedFeatures(e,c,v._state,K.queryGeometry,K.cameraQueryGeometry,K.scale,m,b,P,At(v.transform,K.tileID))});const X=function(K){const ae={},me={};for(const ve of K){const Ee=ve.queryResults,Le=ve.wrappedTileID,ze=me[Le]=me[Le]||{};for(const Ne in Ee){const Te=Ee[Ne],Ge=ze[Ne]=ze[Ne]||{},Ke=ae[Ne]=ae[Ne]||[];for(const nt of Te)Ge[nt.featureIndex]||(Ge[nt.featureIndex]=!0,Ke.push(nt))}}return ae}(q);for(const K in X)X[K].forEach(ae=>{const me=ae.feature,ve=v.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=ve});return X}function Pt(v,e){const c=v.tileID,p=e.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function ni(v,e,c){return o._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield o.h(e.transformRequest(v.url,"Source"),c)).data:yield y.frameAsync(c),!p)return null;const m=o.M(o.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class Ye{constructor(e,c){e&&(c?this.setSouthWest(e).setNorthEast(c):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.N?new o.N(e.lng,e.lat):o.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.N?new o.N(e.lng,e.lat):o.N.convert(e),this}extend(e){const c=this._sw,p=this._ne;let m,b;if(e instanceof o.N)m=e,b=e;else{if(!(e instanceof Ye))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ye.convert(e)):this.extend(o.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.N.convert(e)):this;if(m=e._sw,b=e._ne,!m||!b)return this}return c||p?(c.lng=Math.min(m.lng,c.lng),c.lat=Math.min(m.lat,c.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new o.N(m.lng,m.lat),this._ne=new o.N(b.lng,b.lat)),this}getCenter(){return new o.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.N(this.getWest(),this.getNorth())}getSouthEast(){return new o.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:c,lat:p}=o.N.convert(e);let m=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(e){return e instanceof Ye?e:e&&new Ye(e)}static fromLngLat(e,c=0){const p=360*c/40075017,m=p/Math.cos(Math.PI/180*e.lat);return new Ye(new o.N(e.lng-m,e.lat-p),new o.N(e.lng+m,e.lat+p))}adjustAntiMeridian(){const e=new o.N(this._sw.lng,this._sw.lat),c=new o.N(this._ne.lng,this._ne.lat);return new Ye(e,e.lng>c.lng?new o.N(c.lng+360,c.lat):c)}}class gi{constructor(e,c,p){this.bounds=Ye.convert(this.validateBounds(e)),this.minzoom=c||0,this.maxzoom=p||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const c=Math.pow(2,e.z),p=Math.floor(o.O(this.bounds.getWest())*c),m=Math.floor(o.Q(this.bounds.getNorth())*c),b=Math.ceil(o.O(this.bounds.getEast())*c),A=Math.ceil(o.Q(this.bounds.getSouth())*c);return e.x>=p&&e.x<b&&e.y>=m&&e.y<A}}class pt extends o.E{constructor(e,c,p,m){if(super(),this.id=e,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.M(c,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ni(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new gi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,function*(){const c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(c,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((b,A)=>{e.reloadPromise={resolve:b,reject:A}})}else e.actor=this.dispatcher.getActor(),m="LT";e.abortController=new AbortController;try{const b=yield e.actor.sendAsync({type:m,data:p},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,b)}catch(b){if(delete e.abortController,e.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,c){if(c&&c.resourceTiming&&(e.resourceTiming=c.resourceTiming),c&&this.map._refreshExpiredTiles&&e.setExpiryData(c),e.loadVectorData(c,this.map.painter),e.reloadPromise){const p=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(p.resolve).catch(p.reject)}}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class it extends o.E{constructor(e,c,p,m){super(),this.id=e,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},c),o.e(this,o.M(c,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ni(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(o.e(this,e),e.bounds&&(this.tileBounds=new gi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,function*(){const c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const p=yield W.getImage(this.map._requestManager.transformRequest(c,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,A=p.data;e.texture=this.map.painter.getTileTexture(A.width),e.texture?e.texture.update(A,{useMipmap:!0}):(e.texture=new R(m,A,b.RGBA,{useMipmap:!0}),e.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class ue extends it{constructor(e,c,p,m){super(e,c,p,m),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox",this.redFactor=c.redFactor,this.greenFactor=c.greenFactor,this.blueFactor=c.blueFactor,this.baseShift=c.baseShift}loadTile(e){return o._(this,void 0,void 0,function*(){const c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(c,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const m=yield W.getImage(p,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&e.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const A=o.b(b)&&o.U()?b:yield this.readImageNow(b),P={type:this.type,uid:e.uid,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const z=yield e.actor.sendAsync({type:"LDT",data:P});e.dem=z,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(m){if(delete e.abortController,e.aborted)e.state="unloaded";else if(m)throw e.state="errored",m}})}readImageNow(e){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.V()){const c=e.width+2,p=e.height+2;try{return new o.R({width:c,height:p},yield o.W(e,-1,-1,c,p))}catch{}}return y.getImageData(e,1)})}_getNeighboringTiles(e){const c=e.canonical,p=Math.pow(2,c.z),m=(c.x-1+p)%p,b=c.x===0?e.wrap-1:e.wrap,A=(c.x+1+p)%p,P=c.x+1===p?e.wrap+1:e.wrap,z={};return z[new o.S(e.overscaledZ,b,c.z,m,c.y).key]={backfilled:!1},z[new o.S(e.overscaledZ,P,c.z,A,c.y).key]={backfilled:!1},c.y>0&&(z[new o.S(e.overscaledZ,b,c.z,m,c.y-1).key]={backfilled:!1},z[new o.S(e.overscaledZ,e.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},z[new o.S(e.overscaledZ,P,c.z,A,c.y-1).key]={backfilled:!1}),c.y+1<p&&(z[new o.S(e.overscaledZ,b,c.z,m,c.y+1).key]={backfilled:!1},z[new o.S(e.overscaledZ,e.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},z[new o.S(e.overscaledZ,P,c.z,A,c.y+1).key]={backfilled:!1}),z}unloadTile(e){return o._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class H extends o.E{constructor(e,c,p,m){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=c.data,this._options=o.e({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const b=o.X/this.tileSize;c.clusterMaxZoom!==void 0&&this.maxzoom<=c.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${c.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*b,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*b,extent:o.X,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:o.X,radius:(c.clusterRadius||50)*b,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return o._(this,void 0,void 0,function*(){const e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,c,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:c,offset:p}})}_updateWorkerData(e){return o._(this,void 0,void 0,function*(){const c=o.e({type:this.type},this.workerOptions);e?c.dataDiff=e:typeof this._data=="string"?(c.request=this.map._requestManager.transformRequest(y.resolveURL(this._data),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:c});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&o.e(b,{resourceTiming:m}),this.fire(new o.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(e){return o._(this,void 0,void 0,function*(){const c=e.actor?"RT":"LT";e.actor=this.actor;const p={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const m=yield this.actor.sendAsync({type:c,data:p},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(m,this.map.painter,c==="RT")})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Y=o.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ie extends o.E{constructor(e,c,p,m){super(),this.id=e,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=c}load(e){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const c=yield W.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,c&&c.data&&(this.image=c.data,e&&(this.coordinates=e),this._finishLoading())}catch(c){this._request=null,this._loaded=!0,this.fire(new o.j(c))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const c=e.map(o.Z.fromLngLat);this.tileID=function(m){let b=1/0,A=1/0,P=-1/0,z=-1/0;for(const ae of m)b=Math.min(b,ae.x),A=Math.min(A,ae.y),P=Math.max(P,ae.x),z=Math.max(z,ae.y);const q=Math.max(P-b,z-A),X=Math.max(0,Math.floor(-Math.log(q)/Math.LN2)),K=Math.pow(2,X);return new o.a1(X,Math.floor((b+P)/2*K),Math.floor((A+z)/2*K))}(c),this.minzoom=this.maxzoom=this.tileID.z;const p=c.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new o.$,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,o.X,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,o.X),this._boundsArray.emplaceBack(p[2].x,p[2].y,o.X,o.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,c=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new R(e,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class qe extends Ie{constructor(e,c,p,m){super(e,c,p,m),this.roundZoom=!0,this.type="video",this.options=c}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const c of e.urls)this.urls.push(this.map._requestManager.transformRequest(c,"Source").url);try{const c=yield o.a3(this.urls);if(this._loaded=!0,!c)return;this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(c){this.fire(new o.j(c))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const c=this.video.seekable;e<c.start(0)||e>c.end(0)?this.fire(new o.j(new o.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,c=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new R(e,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ut extends Ie{constructor(e,c,p,m){super(e,c,p,m),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(A=>typeof A!="number"))||this.fire(new o.j(new o.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a2(`sources.${e}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new o.j(new o.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context,p=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=o.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new R(c,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,m=!0)}m&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const st={},ki=v=>{switch(v){case"geojson":return H;case"image":return Ie;case"raster":return it;case"raster-dem":return ue;case"vector":return pt;case"video":return qe;case"canvas":return ut}return st[v]},ct="RTLPluginLoaded";class Vt extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ti()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(c=>{throw this.status="error",c})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,function*(c,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(c),!this.url)throw new Error(`requested url ${c} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ci=null;function Fi(){return Ci||(Ci=new Vt),Ci}class Cn{constructor(e,c){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=o.a4(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const c=e+this.timeAdded;c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,c,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(m,b){const A={};if(!b)return A;for(const P of m){const z=P.layerIds.map(q=>b.getLayer(q)).filter(Boolean);if(z.length!==0){P.layers=z,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(q=>z.filter(X=>X.id===q)[0]));for(const q of z)A[q.id]=P}}return A}(e.buckets,c.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof o.a6){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof o.a6&&b.hasRTLText){this.hasRTLText=!0,Fi().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(m).queryRadius(b))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(e)}const c=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new R(e,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new R(e,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,c,p,m,b,A,P,z,q,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:A,tileSize:this.tileSize,pixelPosMatrix:X,transform:z,params:P,queryPadding:this.queryPadding*q},e,c,p):{}}querySourceFeatures(e,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=c&&c.sourceLayer?c.sourceLayer:"",A=m._geojsonTileLayer||m[b];if(!A)return;const P=o.a7(c&&c.filter),{z,x:q,y:X}=this.tileID.canonical,K={z,x:q,y:X};for(let ae=0;ae<A.length;ae++){const me=A.feature(ae);if(P.needGeometry){const Le=o.a8(me,!0);if(!P.filter(new o.z(this.tileID.overscaledZ),Le,this.tileID.canonical))continue}else if(!P.filter(new o.z(this.tileID.overscaledZ),me))continue;const ve=p.getId(me,b),Ee=new o.a9(me,z,q,X,ve);Ee.tile=K,e.push(Ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const c=this.expirationTime;if(e.cacheControl){const p=o.aa(e.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(c)if(this.expirationTime<c)m=!0;else{const b=this.expirationTime-c;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!c.style.hasLayer(m))continue;const b=this.buckets[m],A=b.layers[0].sourceLayer||"_geojsonTileLayer",P=p[A],z=e[A];if(!P||!z||Object.keys(z).length===0)continue;b.update(z,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const q=c&&c.style&&c.style.getLayer(m);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=y.now()+e}setDependencies(e,c){const p={};for(const m of c)p[m]=!0;this.dependencies[e]=p}hasDependency(e,c){for(const p of e){const m=this.dependencies[p];if(m){for(const b of c)if(m[b])return!0}}return!1}}class xt{constructor(e,c){this.max=e,this.onRemove=c,this.reset()}reset(){for(const e in this.data)for(const c of this.data[e])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(e,c,p){const m=e.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:c,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(e,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const c=this.data[e].shift();return c.timeout&&clearTimeout(c.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),c.value}getByKey(e){const c=this.data[e];return c?c[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,c){if(!this.has(e))return this;const p=e.wrapped().key,m=c===void 0?0:this.data[p].indexOf(c),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(e){const c=[];for(const p in this.data)for(const m of this.data[p])e(m.value)||c.push(m);for(const p of c)this.remove(p.value.tileID,p)}}class li{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,c,p){const m=String(c);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][m]=this.stateChanges[e][m]||{},o.e(this.stateChanges[e][m],p),this.deletedStates[e]===null){this.deletedStates[e]={};for(const b in this.state[e])b!==m&&(this.deletedStates[e][b]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][m]===null){this.deletedStates[e][m]={};for(const b in this.state[e][m])p[b]||(this.deletedStates[e][m][b]=null)}else for(const b in p)this.deletedStates[e]&&this.deletedStates[e][m]&&this.deletedStates[e][m][b]===null&&delete this.deletedStates[e][m][b]}removeFeatureState(e,c,p){if(this.deletedStates[e]===null)return;const m=String(c);if(this.deletedStates[e]=this.deletedStates[e]||{},p&&c!==void 0)this.deletedStates[e][m]!==null&&(this.deletedStates[e][m]=this.deletedStates[e][m]||{},this.deletedStates[e][m][p]=null);else if(c!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][m])for(p in this.deletedStates[e][m]={},this.stateChanges[e][m])this.deletedStates[e][m][p]=null;else this.deletedStates[e][m]=null;else this.deletedStates[e]=null}getState(e,c){const p=String(c),m=o.e({},(this.state[e]||{})[p],(this.stateChanges[e]||{})[p]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const b=this.deletedStates[e][c];if(b===null)return{};for(const A in b)delete m[A]}return m}initializeTileState(e,c){e.setFeatureState(this.state,c)}coalesceChanges(e,c){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const A in this.stateChanges[m])this.state[m][A]||(this.state[m][A]={}),o.e(this.state[m][A],this.stateChanges[m][A]),b[A]=this.state[m][A];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const A in this.state[m])b[A]={},this.state[m][A]={};else for(const A in this.deletedStates[m]){if(this.deletedStates[m][A]===null)this.state[m][A]={};else for(const P of Object.keys(this.deletedStates[m][A]))delete this.state[m][A][P];b[A]=this.state[m][A]}p[m]=p[m]||{},o.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in e)e[m].setFeatureState(p,c)}}class ii extends o.E{constructor(e,c,p){super(),this.id=e,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,A,P)=>{const z=new(ki(b.type))(m,b,A,P);if(z.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${z.id}`);return z})(e,c,p,this),this._tiles={},this._cache=new xt(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new li,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const c=this._tiles[e];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,c,p){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,c,p)}catch(m){e.state="errored",m.status!==404?this._source.fire(new o.j(m,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(e),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(tn).map(e=>e.key)}getRenderableIds(e){const c=[];for(const p in this._tiles)this._isIdRenderable(p,e)&&c.push(this._tiles[p]);return e?c.sort((p,m)=>{const b=p.tileID,A=m.tileID,P=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),z=new o.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-A.overscaledZ||z.y-P.y||z.x-P.x}).map(p=>p.tileID.key):c.map(p=>p.tileID).sort(tn).map(p=>p.key)}hasRenderableParent(e){const c=this.findLoadedParent(e,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(e,c){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(c||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,c){return o._(this,void 0,void 0,function*(){const p=this._tiles[e];p&&(p.state!=="loading"&&(p.state=c),yield this._loadTile(p,e,c))})}_tileLoaded(e,c,p){e.timeAdded=y.now(),p==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(c,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const c=this.getRenderableIds();for(let m=0;m<c.length;m++){const b=c[m];if(e.neighboringTiles&&e.neighboringTiles[b]){const A=this.getTileByID(b);p(e,A),p(A,e)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let A=b.tileID.canonical.x-m.tileID.canonical.x;const P=b.tileID.canonical.y-m.tileID.canonical.y,z=Math.pow(2,m.tileID.canonical.z),q=b.tileID.key;A===0&&P===0||Math.abs(P)>1||(Math.abs(A)>1&&(Math.abs(A+z)===1?A+=z:Math.abs(A-z)===1&&(A-=z)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,A,P),m.neighboringTiles&&m.neighboringTiles[q]&&(m.neighboringTiles[q].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,c,p,m){for(const b in this._tiles){let A=this._tiles[b];if(m[b]||!A.hasData()||A.tileID.overscaledZ<=c||A.tileID.overscaledZ>p)continue;let P=A.tileID;for(;A&&A.tileID.overscaledZ>c+1;){const q=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[q.key],A&&A.hasData()&&(P=q)}let z=P;for(;z.overscaledZ>c;)if(z=z.scaledTo(z.overscaledZ-1),e[z.key]){m[P.key]=P;break}}}findLoadedParent(e,c){if(e.key in this._loadedParentTiles){const p=this._loadedParentTiles[e.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=e.overscaledZ-1;p>=c;p--){const m=e.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const c=this._tiles[e.key];return c&&c.hasData()?c:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const c=Math.ceil(e.width/this._source.tileSize)+1,p=Math.ceil(e.height/this._source.tileSize)+1,m=Math.floor(c*p*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(e){const c=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,c){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+c),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(e,c,p,m,b,A){const P={},z={},q=Object.keys(e),X=y.now();for(const K of q){const ae=e[K],me=this._tiles[K];if(!me||me.fadeEndTime!==0&&me.fadeEndTime<=X)continue;const ve=this.findLoadedParent(ae,c),Ee=this.findLoadedSibling(ae),Le=ve||Ee||null;Le&&(this._addTile(Le.tileID),P[Le.tileID.key]=Le.tileID),z[K]=ae}this._retainLoadedChildren(z,m,p,e);for(const K in P)e[K]||(this._coveredTiles[K]=!0,e[K]=P[K]);if(A){const K={},ae={};for(const me of b)this._tiles[me.key].hasData()?K[me.key]=me:ae[me.key]=me;for(const me in ae){const ve=ae[me].children(this._source.maxzoom);this._tiles[ve[0].key]&&this._tiles[ve[1].key]&&this._tiles[ve[2].key]&&this._tiles[ve[3].key]&&(K[ve[0].key]=e[ve[0].key]=ve[0],K[ve[1].key]=e[ve[1].key]=ve[1],K[ve[2].key]=e[ve[2].key]=ve[2],K[ve[3].key]=e[ve[3].key]=ve[3],delete ae[me])}for(const me in ae){const ve=ae[me],Ee=this.findLoadedParent(ve,this._source.minzoom),Le=this.findLoadedSibling(ve),ze=Ee||Le||null;if(ze){K[ze.tileID.key]=e[ze.tileID.key]=ze.tileID;for(const Ne in K)K[Ne].isChildOf(ze.tileID)&&delete K[Ne]}}for(const me in this._tiles)K[me]||(this._coveredTiles[me]=!0)}}update(e,c){if(!this._sourceLoaded||this._paused)return;let p;this.transform=e,this.terrain=c,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(X=>new o.S(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y)):(p=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:c}),this._source.hasTile&&(p=p.filter(X=>this._source.hasTile(X)))):p=[];const m=e.coveringZoomLevel(this._source),b=Math.max(m-ii.maxOverzooming,this._source.minzoom),A=Math.max(m+ii.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const X={};for(const K of p)if(K.canonical.z>this._source.minzoom){const ae=K.scaledTo(K.canonical.z-1);X[ae.key]=ae;const me=K.scaledTo(Math.max(this._source.minzoom,Math.min(K.canonical.z,5)));X[me.key]=me}p=p.concat(Object.values(X))}const P=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const z=this._updateRetainedTiles(p,m);fr(this._source.type)&&this._updateCoveredAndRetainedTiles(z,b,A,m,p,c);for(const X in z)this._tiles[X].clearFadeHold();const q=o.ab(this._tiles,z);for(const X of q){const K=this._tiles[X];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(X)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,c){var p;const m={},b={},A=Math.max(c-ii.maxOverzooming,this._source.minzoom),P=Math.max(c+ii.maxUnderzooming,this._source.minzoom),z={};for(const q of e){const X=this._addTile(q);m[q.key]=q,X.hasData()||c<this._source.maxzoom&&(z[q.key]=q)}this._retainLoadedChildren(z,c,P,m);for(const q of e){let X=this._tiles[q.key];if(X.hasData())continue;if(c+1>this._source.maxzoom){const ae=q.children(this._source.maxzoom)[0],me=this.getTile(ae);if(me&&me.hasData()){m[ae.key]=ae;continue}}else{const ae=q.children(this._source.maxzoom);if(m[ae[0].key]&&m[ae[1].key]&&m[ae[2].key]&&m[ae[3].key])continue}let K=X.wasRequested();for(let ae=q.overscaledZ-1;ae>=A;--ae){const me=q.scaledTo(ae);if(b[me.key])break;if(b[me.key]=!0,X=this.getTile(me),!X&&K&&(X=this._addTile(me)),X){const ve=X.hasData();if((ve||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||K)&&(m[me.key]=me),K=X.wasRequested(),ve)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const c=[];let p,m=this._tiles[e].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}c.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of c)this._loadedParentTiles[b]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const c=this._tiles[e].tileID,p=this._getLoadedTile(c);this._loadedSiblingTiles[c.key]=p}}_addTile(e){let c=this._tiles[e.key];if(c)return c;c=this._cache.getAndRemove(e),c&&(this._setTileReloadTimer(e.key,c),c.tileID=e,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,c)));const p=c;return c||(c=new Cn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(c,e.key,c.state)),c.uses++,this._tiles[e.key]=c,p||this._source.fire(new o.k("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(e,c){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const p=c.getExpiryTimeout();p&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},p))}_removeTile(e){const c=this._tiles[e];c&&(c.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),c.uses>0||(c.hasData()&&c.state!=="reloading"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}_dataHandler(e){const c=e.sourceDataType;e.dataType==="source"&&c==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&c==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,c,p){const m=[],b=this.transform;if(!b)return m;const A=p?b.getCameraQueryGeometry(e):e,P=e.map(ve=>b.pointCoordinate(ve,this.terrain)),z=A.map(ve=>b.pointCoordinate(ve,this.terrain)),q=this.getIds();let X=1/0,K=1/0,ae=-1/0,me=-1/0;for(const ve of z)X=Math.min(X,ve.x),K=Math.min(K,ve.y),ae=Math.max(ae,ve.x),me=Math.max(me,ve.y);for(let ve=0;ve<q.length;ve++){const Ee=this._tiles[q[ve]];if(Ee.holdingForFade())continue;const Le=Ee.tileID,ze=Math.pow(2,b.zoom-Ee.tileID.overscaledZ),Ne=c*Ee.queryPadding*o.X/Ee.tileSize/ze,Te=[Le.getTilePoint(new o.Z(X,K)),Le.getTilePoint(new o.Z(ae,me))];if(Te[0].x-Ne<o.X&&Te[0].y-Ne<o.X&&Te[1].x+Ne>=0&&Te[1].y+Ne>=0){const Ge=P.map(nt=>Le.getTilePoint(nt)),Ke=z.map(nt=>Le.getTilePoint(nt));m.push({tile:Ee,tileID:Le,queryGeometry:Ge,cameraQueryGeometry:Ke,scale:ze})}}return m}getVisibleCoordinates(e){const c=this.getRenderableIds(e).map(p=>this._tiles[p].tileID);for(const p of c)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(fr(this._source.type)){const e=y.now();for(const c in this._tiles)if(this._tiles[c].fadeEndTime>=e)return!0}return!1}setFeatureState(e,c,p){this._state.updateState(e=e||"_geojsonTileLayer",c,p)}removeFeatureState(e,c,p){this._state.removeFeatureState(e=e||"_geojsonTileLayer",c,p)}getFeatureState(e,c){return this._state.getState(e=e||"_geojsonTileLayer",c)}setDependencies(e,c,p){const m=this._tiles[e];m&&m.setDependencies(c,p)}reloadTilesForDependencies(e,c){for(const p in this._tiles)this._tiles[p].hasDependency(e,c)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(e,c))}}function tn(v,e){const c=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*e.wrap)-+(e.wrap<0);return v.overscaledZ-e.overscaledZ||p-c||e.canonical.y-v.canonical.y||e.canonical.x-v.canonical.x}function fr(v){return v==="raster"||v==="image"||v==="video"}ii.maxOverzooming=10,ii.maxUnderzooming=3;class ai{constructor(e,c){this.reset(e,c)}reset(e,c){this.points=e||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.ac(e,0,1);let c=1,p=this._distances[c];const m=e*this.paddedLength+this.padding;for(;p<m&&c<this._distances.length;)p=this._distances[++c];const b=c-1,A=this._distances[b],P=p-A,z=P>0?(m-A)/P:0;return this.points[b].mult(1-z).add(this.points[c].mult(z))}}function dr(v,e){let c=!0;return v==="always"||v!=="never"&&e!=="never"||(c=!1),c}class pr{constructor(e,c,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(e/p),this.yCellCount=Math.ceil(c/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=c,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,c,p,m,b){this._forEachCell(c,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(e,c,p,m){this._forEachCell(c-m,p-m,c+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(c),this.circles.push(p),this.circles.push(m)}_insertBoxCell(e,c,p,m,b,A){this.boxCells[b].push(A)}_insertCircleCell(e,c,p,m,b,A){this.circleCells[b].push(A)}_query(e,c,p,m,b,A,P){if(p<0||e>this.width||m<0||c>this.height)return[];const z=[];if(e<=0&&c<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:e,y1:c,x2:p,y2:m}];for(let q=0;q<this.boxKeys.length;q++)z.push({key:this.boxKeys[q],x1:this.bboxes[4*q],y1:this.bboxes[4*q+1],x2:this.bboxes[4*q+2],y2:this.bboxes[4*q+3]});for(let q=0;q<this.circleKeys.length;q++){const X=this.circles[3*q],K=this.circles[3*q+1],ae=this.circles[3*q+2];z.push({key:this.circleKeys[q],x1:X-ae,y1:K-ae,x2:X+ae,y2:K+ae})}}else this._forEachCell(e,c,p,m,this._queryCell,z,{hitTest:b,overlapMode:A,seenUids:{box:{},circle:{}}},P);return z}query(e,c,p,m){return this._query(e,c,p,m,!1,null)}hitTest(e,c,p,m,b,A){return this._query(e,c,p,m,!0,b,A).length>0}hitTestCircle(e,c,p,m,b){const A=e-p,P=e+p,z=c-p,q=c+p;if(P<0||A>this.width||q<0||z>this.height)return!1;const X=[];return this._forEachCell(A,z,P,q,this._queryCellCircle,X,{hitTest:!0,overlapMode:m,circle:{x:e,y:c,radius:p},seenUids:{box:{},circle:{}}},b),X.length>0}_queryCell(e,c,p,m,b,A,P,z){const{seenUids:q,hitTest:X,overlapMode:K}=P,ae=this.boxCells[b];if(ae!==null){const ve=this.bboxes;for(const Ee of ae)if(!q.box[Ee]){q.box[Ee]=!0;const Le=4*Ee,ze=this.boxKeys[Ee];if(e<=ve[Le+2]&&c<=ve[Le+3]&&p>=ve[Le+0]&&m>=ve[Le+1]&&(!z||z(ze))&&(!X||!dr(K,ze.overlapMode))&&(A.push({key:ze,x1:ve[Le],y1:ve[Le+1],x2:ve[Le+2],y2:ve[Le+3]}),X))return!0}}const me=this.circleCells[b];if(me!==null){const ve=this.circles;for(const Ee of me)if(!q.circle[Ee]){q.circle[Ee]=!0;const Le=3*Ee,ze=this.circleKeys[Ee];if(this._circleAndRectCollide(ve[Le],ve[Le+1],ve[Le+2],e,c,p,m)&&(!z||z(ze))&&(!X||!dr(K,ze.overlapMode))){const Ne=ve[Le],Te=ve[Le+1],Ge=ve[Le+2];if(A.push({key:ze,x1:Ne-Ge,y1:Te-Ge,x2:Ne+Ge,y2:Te+Ge}),X)return!0}}}return!1}_queryCellCircle(e,c,p,m,b,A,P,z){const{circle:q,seenUids:X,overlapMode:K}=P,ae=this.boxCells[b];if(ae!==null){const ve=this.bboxes;for(const Ee of ae)if(!X.box[Ee]){X.box[Ee]=!0;const Le=4*Ee,ze=this.boxKeys[Ee];if(this._circleAndRectCollide(q.x,q.y,q.radius,ve[Le+0],ve[Le+1],ve[Le+2],ve[Le+3])&&(!z||z(ze))&&!dr(K,ze.overlapMode))return A.push(!0),!0}}const me=this.circleCells[b];if(me!==null){const ve=this.circles;for(const Ee of me)if(!X.circle[Ee]){X.circle[Ee]=!0;const Le=3*Ee,ze=this.circleKeys[Ee];if(this._circlesCollide(ve[Le],ve[Le+1],ve[Le+2],q.x,q.y,q.radius)&&(!z||z(ze))&&!dr(K,ze.overlapMode))return A.push(!0),!0}}}_forEachCell(e,c,p,m,b,A,P,z){const q=this._convertToXCellCoord(e),X=this._convertToYCellCoord(c),K=this._convertToXCellCoord(p),ae=this._convertToYCellCoord(m);for(let me=q;me<=K;me++)for(let ve=X;ve<=ae;ve++)if(b.call(this,e,c,p,m,this.xCellCount*ve+me,A,P,z))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,c,p,m,b,A){const P=m-e,z=b-c,q=p+A;return q*q>P*P+z*z}_circleAndRectCollide(e,c,p,m,b,A,P){const z=(A-m)/2,q=Math.abs(e-(m+z));if(q>z+p)return!1;const X=(P-b)/2,K=Math.abs(c-(b+X));if(K>X+p)return!1;if(q<=z||K<=X)return!0;const ae=q-z,me=K-X;return ae*ae+me*me<=p*p}}function Sr(v,e,c,p,m){const b=o.H();return e?(o.K(b,b,[1/m,1/m,1]),c||o.ad(b,b,p.angle)):o.L(b,p.labelPlaneMatrix,v),b}function Tr(v,e,c,p,m){if(e){const b=o.ae(v);return o.K(b,b,[m,m,1]),c||o.ad(b,b,-p.angle),b}return p.glCoordMatrix}function Ae(v,e,c,p){let m;p?(m=[v,e,p(v,e),1],o.af(m,m,c)):(m=[v,e,0,1],Ri(m,m,c));const b=m[3];return{point:new o.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function te(v,e){return .5+v/e*.5}function ie(v,e){return v.x>=-e[0]&&v.x<=e[0]&&v.y>=-e[1]&&v.y<=e[1]}function de(v,e,c,p,m,b,A,P,z,q,X,K,ae,me,ve){const Ee=p?v.textSizeData:v.iconSizeData,Le=o.ag(Ee,c.transform.zoom),ze=[256/c.width*2+1,256/c.height*2+1],Ne=p?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Ne.clear();const Te=v.lineVertexArray,Ge=p?v.text.placedSymbolArray:v.icon.placedSymbolArray,Ke=c.transform.width/c.transform.height;let nt=!1;for(let bt=0;bt<Ge.length;bt++){const Ct=Ge.get(bt);if(Ct.hidden||Ct.writingMode===o.ah.vertical&&!nt){ri(Ct.numGlyphs,Ne);continue}nt=!1;const Dt=Ae(Ct.anchorX,Ct.anchorY,e,ve);if(!ie(Dt.point,ze)){ri(Ct.numGlyphs,Ne);continue}const Nt=te(c.transform.cameraToCenterDistance,Dt.signedDistanceFromCamera),Lt=o.ai(Ee,Le,Ct),Mt=A?Lt/Nt:Lt*Nt,Jt={getElevation:ve,labelPlaneMatrix:m,lineVertexArray:Te,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:q,tileAnchorPoint:new o.P(Ct.anchorX,Ct.anchorY),unwrappedTileID:X,width:K,height:ae,translation:me},vi=We(Jt,Ct,Mt,!1,P,e,b,v.glyphOffsetArray,Ne,Ke,z);nt=vi.useVertical,(vi.notEnoughRoom||nt||vi.needsFlipping&&We(Jt,Ct,Mt,!0,P,e,b,v.glyphOffsetArray,Ne,Ke,z).notEnoughRoom)&&ri(Ct.numGlyphs,Ne)}p?v.text.dynamicLayoutVertexBuffer.updateData(Ne):v.icon.dynamicLayoutVertexBuffer.updateData(Ne)}function Se(v,e,c,p,m,b,A,P){const z=b.glyphStartIndex+b.numGlyphs,q=b.lineStartIndex,X=b.lineStartIndex+b.lineLength,K=e.getoffsetX(b.glyphStartIndex),ae=e.getoffsetX(z-1),me=Et(v*K,c,p,m,b.segment,q,X,P,A);if(!me)return null;const ve=Et(v*ae,c,p,m,b.segment,q,X,P,A);return ve?P.projectionCache.anyProjectionOccluded?null:{first:me,last:ve}:null}function je(v,e,c,p){return v===o.ah.horizontal&&Math.abs(c.y-e.y)>Math.abs(c.x-e.x)*p?{useVertical:!0}:(v===o.ah.vertical?e.y<c.y:e.x>c.x)?{needsFlipping:!0}:null}function We(v,e,c,p,m,b,A,P,z,q,X){const K=c/24,ae=e.lineOffsetX*K,me=e.lineOffsetY*K;let ve;if(e.numGlyphs>1){const Ee=e.glyphStartIndex+e.numGlyphs,Le=e.lineStartIndex,ze=e.lineStartIndex+e.lineLength,Ne=Se(K,P,ae,me,p,e,X,v);if(!Ne)return{notEnoughRoom:!0};const Te=Ae(Ne.first.point.x,Ne.first.point.y,A,v.getElevation).point,Ge=Ae(Ne.last.point.x,Ne.last.point.y,A,v.getElevation).point;if(m&&!p){const Ke=je(e.writingMode,Te,Ge,q);if(Ke)return Ke}ve=[Ne.first];for(let Ke=e.glyphStartIndex+1;Ke<Ee-1;Ke++)ve.push(Et(K*P.getoffsetX(Ke),ae,me,p,e.segment,Le,ze,v,X));ve.push(Ne.last)}else{if(m&&!p){const Le=Ae(v.tileAnchorPoint.x,v.tileAnchorPoint.y,b,v.getElevation).point,ze=e.lineStartIndex+e.segment+1,Ne=new o.P(v.lineVertexArray.getx(ze),v.lineVertexArray.gety(ze)),Te=Ae(Ne.x,Ne.y,b,v.getElevation),Ge=Te.signedDistanceFromCamera>0?Te.point:function(nt,bt,Ct,Dt,Nt,Lt){return et(nt,bt,Ct,1,Nt,Lt)}(v.tileAnchorPoint,Ne,Le,0,b,v),Ke=je(e.writingMode,Le,Ge,q);if(Ke)return Ke}const Ee=Et(K*P.getoffsetX(e.glyphStartIndex),ae,me,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,v,X);if(!Ee||v.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ve=[Ee]}for(const Ee of ve)o.aj(z,Ee.point,Ee.angle);return{}}function et(v,e,c,p,m,b){const A=v.add(v.sub(e)._unit()),P=m!==void 0?Ae(A.x,A.y,m,b.getElevation).point:ot(A.x,A.y,b).point,z=c.sub(P);return c.add(z._mult(p/z.mag()))}function De(v,e,c){const p=e.projectionCache;if(p.projections[v])return p.projections[v];const m=new o.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),b=ot(m.x,m.y,e);if(b.signedDistanceFromCamera>0)return p.projections[v]=b.point,p.anyProjectionOccluded=p.anyProjectionOccluded||b.isOccluded,b.point;const A=v-c.direction;return function(P,z,q,X,K){return et(P,z,q,X,void 0,K)}(c.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(A),e.lineVertexArray.gety(A)),m,c.previousVertex,c.absOffsetX-c.distanceFromAnchor+1,e)}function ot(v,e,c){const p=v+c.translation[0],m=e+c.translation[1];let b;return!c.pitchWithMap&&c.projection.useSpecialProjectionForSymbols?(b=c.projection.projectTileCoordinates(p,m,c.unwrappedTileID,c.getElevation),b.point.x=(.5*b.point.x+.5)*c.width,b.point.y=(.5*-b.point.y+.5)*c.height):(b=Ae(p,m,c.labelPlaneMatrix,c.getElevation),b.isOccluded=!1),b}function mt(v,e,c){return v._unit()._perp()._mult(e*c)}function rt(v,e,c,p,m,b,A,P,z){if(P.projectionCache.offsets[v])return P.projectionCache.offsets[v];const q=c.add(e);if(v+z.direction<p||v+z.direction>=m)return P.projectionCache.offsets[v]=q,q;const X=De(v+z.direction,P,z),K=mt(X.sub(c),A,z.direction),ae=c.add(K),me=X.add(K);return P.projectionCache.offsets[v]=o.ak(b,q,ae,me)||q,P.projectionCache.offsets[v]}function Et(v,e,c,p,m,b,A,P,z){const q=p?v-e:v+e;let X=q>0?1:-1,K=0;p&&(X*=-1,K=Math.PI),X<0&&(K+=Math.PI);let ae,me=X>0?b+m:b+m+1;P.projectionCache.cachedAnchorPoint?ae=P.projectionCache.cachedAnchorPoint:(ae=ot(P.tileAnchorPoint.x,P.tileAnchorPoint.y,P).point,P.projectionCache.cachedAnchorPoint=ae);let ve,Ee,Le=ae,ze=ae,Ne=0,Te=0;const Ge=Math.abs(q),Ke=[];let nt;for(;Ne+Te<=Ge;){if(me+=X,me<b||me>=A)return null;Ne+=Te,ze=Le,Ee=ve;const Dt={absOffsetX:Ge,direction:X,distanceFromAnchor:Ne,previousVertex:ze};if(Le=De(me,P,Dt),c===0)Ke.push(ze),nt=Le.sub(ze);else{let Nt;const Lt=Le.sub(ze);Nt=Lt.mag()===0?mt(De(me+X,P,Dt).sub(Le),c,X):mt(Lt,c,X),Ee||(Ee=ze.add(Nt)),ve=rt(me,Nt,Le,b,A,Ee,c,P,Dt),Ke.push(Ee),nt=ve.sub(Ee)}Te=nt.mag()}const bt=nt._mult((Ge-Ne)/Te)._add(Ee||ze),Ct=K+Math.atan2(Le.y-ze.y,Le.x-ze.x);return Ke.push(bt),{point:bt,angle:z?Ct:0,path:Ke}}const Yt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ri(v,e){for(let c=0;c<v;c++){const p=e.length;e.resize(p+4),e.float32.set(Yt,3*p)}}function Ri(v,e,c){const p=e[0],m=e[1];return v[0]=c[0]*p+c[4]*m+c[12],v[1]=c[1]*p+c[5]*m+c[13],v[3]=c[3]*p+c[7]*m+c[15],v}const bi=100;class zi{constructor(e,c,p=new pr(e.width+200,e.height+200,25),m=new pr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=c,this.grid=p,this.ignoredGrid=m,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+bi,this.screenBottomBoundary=e.height+bi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,c,p,m,b,A,P,z,q,X,K){const ae=e.anchorPointX+z[0],me=e.anchorPointY+z[1],ve=this.projectAndGetPerspectiveRatio(m,ae,me,b,X),Ee=p*ve.perspectiveRatio;let Le;if(A||P)Le=this._projectCollisionBox(e,Ee,m,b,A,P,z,ve,X,K);else{const Ke=ve.point.x+(K?K.x*Ee:0),nt=ve.point.y+(K?K.y*Ee:0);Le={allPointsOccluded:!1,box:[Ke+e.x1*Ee,nt+e.y1*Ee,Ke+e.x2*Ee,nt+e.y2*Ee]}}const[ze,Ne,Te,Ge]=Le.box;return this.mapProjection.useSpecialProjectionForSymbols&&(A?Le.allPointsOccluded:this.mapProjection.isOccluded(ae,me,b))||ve.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ze,Ne,Te,Ge)||c!=="always"&&this.grid.hitTest(ze,Ne,Te,Ge,c,q)?{box:[ze,Ne,Te,Ge],placeable:!1,offscreen:!1}:{box:[ze,Ne,Te,Ge],placeable:!0,offscreen:this.isOffscreen(ze,Ne,Te,Ge)}}placeCollisionCircles(e,c,p,m,b,A,P,z,q,X,K,ae,me,ve,Ee,Le){const ze=[],Ne=new o.P(c.anchorX,c.anchorY),Te=this.getPerspectiveRatio(A,Ne.x,Ne.y,P,Le),Ge=(K?b/Te:b*Te)/o.ap,Ke={getElevation:Le,labelPlaneMatrix:z,lineVertexArray:p,pitchWithMap:K,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ne,unwrappedTileID:P,width:this.transform.width,height:this.transform.height,translation:Ee},nt=Se(Ge,m,c.lineOffsetX*Ge,c.lineOffsetY*Ge,!1,c,!1,Ke);let bt=!1,Ct=!1,Dt=!0;if(nt){const Nt=.5*me*Te+ve,Lt=new o.P(-100,-100),Mt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Jt=new ai,vi=nt.first,zt=nt.last;let Rt=[];for(let Ii=vi.path.length-1;Ii>=1;Ii--)Rt.push(vi.path[Ii]);for(let Ii=1;Ii<zt.path.length;Ii++)Rt.push(zt.path[Ii]);const _i=2.5*Nt;if(q){const Ii=this.projectPathToScreenSpace(Rt,Ke,q);Rt=Ii.some(Ni=>Ni.signedDistanceFromCamera<=0)?[]:Ii.map(Ni=>Ni.point)}let gn=[];if(Rt.length>0){const Ii=Rt[0].clone(),Ni=Rt[0].clone();for(let _n=1;_n<Rt.length;_n++)Ii.x=Math.min(Ii.x,Rt[_n].x),Ii.y=Math.min(Ii.y,Rt[_n].y),Ni.x=Math.max(Ni.x,Rt[_n].x),Ni.y=Math.max(Ni.y,Rt[_n].y);gn=Ii.x>=Lt.x&&Ni.x<=Mt.x&&Ii.y>=Lt.y&&Ni.y<=Mt.y?[Rt]:Ni.x<Lt.x||Ii.x>Mt.x||Ni.y<Lt.y||Ii.y>Mt.y?[]:o.al([Rt],Lt.x,Lt.y,Mt.x,Mt.y)}for(const Ii of gn){Jt.reset(Ii,.25*Nt);let Ni=0;Ni=Jt.length<=.5*Nt?1:Math.ceil(Jt.paddedLength/_i)+1;for(let _n=0;_n<Ni;_n++){const rr=_n/Math.max(Ni-1,1),ms=Jt.lerp(rr),yn=ms.x+bi,Ir=ms.y+bi;ze.push(yn,Ir,Nt,0);const yr=yn-Nt,sr=Ir-Nt,br=yn+Nt,Rs=Ir+Nt;if(Dt=Dt&&this.isOffscreen(yr,sr,br,Rs),Ct=Ct||this.isInsideGrid(yr,sr,br,Rs),e!=="always"&&this.grid.hitTestCircle(yn,Ir,Nt,e,ae)&&(bt=!0,!X))return{circles:[],offscreen:!1,collisionDetected:bt}}}}return{circles:!X&&bt||!Ct||Te<this.perspectiveRatioCutoff?[]:ze,offscreen:Dt,collisionDetected:bt}}projectPathToScreenSpace(e,c,p){return e.map(m=>Ae(m.x,m.y,p,c.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,m=1/0,b=-1/0,A=-1/0;for(const X of e){const K=new o.P(X.x+bi,X.y+bi);p=Math.min(p,K.x),m=Math.min(m,K.y),b=Math.max(b,K.x),A=Math.max(A,K.y),c.push(K)}const P=this.grid.query(p,m,b,A).concat(this.ignoredGrid.query(p,m,b,A)),z={},q={};for(const X of P){const K=X.key;if(z[K.bucketInstanceId]===void 0&&(z[K.bucketInstanceId]={}),z[K.bucketInstanceId][K.featureIndex])continue;const ae=[new o.P(X.x1,X.y1),new o.P(X.x2,X.y1),new o.P(X.x2,X.y2),new o.P(X.x1,X.y2)];o.am(c,ae)&&(z[K.bucketInstanceId][K.featureIndex]=!0,q[K.bucketInstanceId]===void 0&&(q[K.bucketInstanceId]=[]),q[K.bucketInstanceId].push(K.featureIndex))}return q}insertCollisionBox(e,c,p,m,b,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:c},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,c,p,m,b,A){const P=p?this.ignoredGrid:this.grid,z={bucketInstanceId:m,featureIndex:b,collisionGroupID:A,overlapMode:c};for(let q=0;q<e.length;q+=4)P.insertCircle(z,e[q],e[q+1],e[q+2])}projectAndGetPerspectiveRatio(e,c,p,m,b){let A;b?(A=[c,p,b(c,p),1],o.af(A,A,e)):(A=[c,p,0,1],Ri(A,A,e));const P=A[3];return{point:new o.P((A[0]/P+1)/2*this.transform.width+bi,(-A[1]/P+1)/2*this.transform.height+bi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/P*.5,isOccluded:!1,signedDistanceFromCamera:P}}getPerspectiveRatio(e,c,p,m,b){const A=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(c,p,m,b):Ae(c,p,e,b);return .5+this.transform.cameraToCenterDistance/A.signedDistanceFromCamera*.5}isOffscreen(e,c,p,m){return p<bi||e>=this.screenRightBoundary||m<bi||c>this.screenBottomBoundary}isInsideGrid(e,c,p,m){return p>=0&&e<this.gridRightBoundary&&m>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const e=o.an([]);return o.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,c,p,m,b,A,P,z,q,X){let K=new o.P(1,0),ae=new o.P(0,1);const me=new o.P(e.anchorPointX+P[0],e.anchorPointY+P[1]);if(A&&!b){const Dt=this.projectAndGetPerspectiveRatio(p,me.x+1,me.y,m,q).point.sub(z.point).unit(),Nt=Math.atan(Dt.y/Dt.x)+(Dt.x<0?Math.PI:0),Lt=Math.sin(Nt),Mt=Math.cos(Nt);K=new o.P(Mt,Lt),ae=new o.P(-Lt,Mt)}else if(!A&&b){const Dt=-this.transform.angle,Nt=Math.sin(Dt),Lt=Math.cos(Dt);K=new o.P(Lt,Nt),ae=new o.P(-Nt,Lt)}let ve=z.point,Ee=c;if(b){ve=me;const Dt=this.transform.zoom-Math.floor(this.transform.zoom);Ee=Math.pow(2,-Dt),Ee*=this.mapProjection.getPitchedTextCorrection(this.transform,me,m),X||(Ee*=o.ac(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}X&&(ve=ve.add(K.mult(X.x*Ee)).add(ae.mult(X.y*Ee)));const Le=e.x1*Ee,ze=e.x2*Ee,Ne=(Le+ze)/2,Te=e.y1*Ee,Ge=e.y2*Ee,Ke=(Te+Ge)/2,nt=[{offsetX:Le,offsetY:Te},{offsetX:Ne,offsetY:Te},{offsetX:ze,offsetY:Te},{offsetX:ze,offsetY:Ke},{offsetX:ze,offsetY:Ge},{offsetX:Ne,offsetY:Ge},{offsetX:Le,offsetY:Ge},{offsetX:Le,offsetY:Ke}];let bt=[];for(const{offsetX:Dt,offsetY:Nt}of nt)bt.push(new o.P(ve.x+K.x*Dt+ae.x*Nt,ve.y+K.y*Dt+ae.y*Nt));let Ct=!1;if(b){const Dt=bt.map(Nt=>this.projectAndGetPerspectiveRatio(p,Nt.x,Nt.y,m,q));Ct=Dt.some(Nt=>!Nt.isOccluded),bt=Dt.map(Nt=>Nt.point)}else Ct=!0;return{box:o.ao(bt),allPointsOccluded:!Ct}}}function Si(v,e,c){return e*(o.X/(v.tileSize*Math.pow(2,c-v.tileID.overscaledZ)))}class un{constructor(e,c,p,m){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?c:-c))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class hn{constructor(e,c,p,m,b){this.text=new un(e?e.text:null,c,p,b),this.icon=new un(e?e.icon:null,c,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xe{constructor(e,c,p){this.text=e,this.icon=c,this.skipFade=p}}class di{constructor(){this.invProjMatrix=o.H(),this.viewportMatrix=o.H(),this.circles=[]}}class xi{constructor(e,c,p,m,b){this.bucketInstanceId=e,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class Bi{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const c=++this.maxGroupID;this.collisionGroups[e]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[e]}}function Ki(v,e,c,p,m){const{horizontalAlign:b,verticalAlign:A}=o.au(v);return new o.P(-(b-.5)*e+p[0]*m,-(A-.5)*c+p[1]*m)}class Ji{constructor(e,c,p,m,b,A){this.transform=e.clone(),this.terrain=p,this.collisionIndex=new zi(this.transform,c),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Bi(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const c=this.terrain;return c?(p,m)=>c.getElevation(e,p,m):null}getBucketParts(e,c,p,m){const b=p.getBucket(c),A=p.latestFeatureIndex;if(!b||!A||c.id!==b.layerIds[0])return;const P=p.collisionBoxArray,z=b.layers[0].layout,q=b.layers[0].paint,X=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),K=p.tileSize/o.X,ae=p.tileID.toUnwrapped(),me=this.transform.calculatePosMatrix(ae),ve=z.get("text-pitch-alignment")==="map",Ee=z.get("text-rotation-alignment")==="map",Le=Si(p,1,this.transform.zoom),ze=this.collisionIndex.mapProjection.translatePosition(this.transform,p,q.get("text-translate"),q.get("text-translate-anchor")),Ne=this.collisionIndex.mapProjection.translatePosition(this.transform,p,q.get("icon-translate"),q.get("icon-translate-anchor")),Te=Sr(me,ve,Ee,this.transform,Le);let Ge=null;if(ve){const nt=Tr(me,ve,Ee,this.transform,Le);Ge=o.L([],this.transform.labelPlaneMatrix,nt)}this.retainedQueryData[b.bucketInstanceId]=new xi(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,p.tileID);const Ke={bucket:b,layout:z,translationText:ze,translationIcon:Ne,posMatrix:me,unwrappedTileID:ae,textLabelPlaneMatrix:Te,labelToScreenMatrix:Ge,scale:X,textPixelRatio:K,holdingForFade:p.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:o.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const nt of b.sortKeyRanges){const{sortKey:bt,symbolInstanceStart:Ct,symbolInstanceEnd:Dt}=nt;e.push({sortKey:bt,symbolInstanceStart:Ct,symbolInstanceEnd:Dt,parameters:Ke})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ke})}attemptAnchorPlacement(e,c,p,m,b,A,P,z,q,X,K,ae,me,ve,Ee,Le,ze,Ne,Te){const Ge=o.aq[e.textAnchor],Ke=[e.textOffset0,e.textOffset1],nt=Ki(Ge,p,m,Ke,b),bt=this.collisionIndex.placeCollisionBox(c,ae,z,q,X,P,A,Le,K.predicate,Te,nt);if((!Ne||this.collisionIndex.placeCollisionBox(Ne,ae,z,q,X,P,A,ze,K.predicate,Te,nt).placeable)&&bt.placeable){let Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(Ct=this.prevPlacement.variableOffsets[me.crossTileID].anchor),me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[me.crossTileID]={textOffset:Ke,width:p,height:m,anchor:Ge,textBoxScale:b,prevAnchor:Ct},this.markUsedJustification(ve,Ge,me,Ee),ve.allowVerticalPlacement&&(this.markUsedOrientation(ve,Ee,me),this.placedOrientations[me.crossTileID]=Ee),{shift:nt,placedGlyphBoxes:bt}}}placeLayerBucketPart(e,c,p){const{bucket:m,layout:b,translationText:A,translationIcon:P,posMatrix:z,unwrappedTileID:q,textLabelPlaneMatrix:X,labelToScreenMatrix:K,textPixelRatio:ae,holdingForFade:me,collisionBoxArray:ve,partiallyEvaluatedTextSize:Ee,collisionGroup:Le}=e.parameters,ze=b.get("text-optional"),Ne=b.get("icon-optional"),Te=o.ar(b,"text-overlap","text-allow-overlap"),Ge=Te==="always",Ke=o.ar(b,"icon-overlap","icon-allow-overlap"),nt=Ke==="always",bt=b.get("text-rotation-alignment")==="map",Ct=b.get("text-pitch-alignment")==="map",Dt=b.get("icon-text-fit")!=="none",Nt=b.get("symbol-z-order")==="viewport-y",Lt=Ge&&(nt||!m.hasIconData()||Ne),Mt=nt&&(Ge||!m.hasTextData()||ze);!m.collisionArrays&&ve&&m.deserializeCollisionBoxes(ve);const Jt=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),vi=(zt,Rt,_i)=>{var gn,Ii;if(c[zt.crossTileID])return;if(me)return void(this.placements[zt.crossTileID]=new Xe(!1,!1,!1));let Ni=!1,_n=!1,rr=!0,ms=null,yn={box:null,placeable:!1,offscreen:null},Ir={placeable:!1},yr=null,sr=null,br=null,Rs=0,Na=0,mc=0;Rt.textFeatureIndex?Rs=Rt.textFeatureIndex:zt.useRuntimeCollisionCircles&&(Rs=zt.featureIndex),Rt.verticalTextFeatureIndex&&(Na=Rt.verticalTextFeatureIndex);const ja=Rt.textBox;if(ja){const rs=$n=>{let or=o.ah.horizontal;if(m.allowVerticalPlacement&&!$n&&this.prevPlacement){const qr=this.prevPlacement.placedOrientations[zt.crossTileID];qr&&(this.placedOrientations[zt.crossTileID]=qr,or=qr,this.markUsedOrientation(m,or,zt))}return or},ss=($n,or)=>{if(m.allowVerticalPlacement&&zt.numVerticalGlyphVertices>0&&Rt.verticalTextBox){for(const qr of m.writingModes)if(qr===o.ah.vertical?(yn=or(),Ir=yn):yn=$n(),yn&&yn.placeable)break}else yn=$n()},Eo=zt.textAnchorOffsetStartIndex,gs=zt.textAnchorOffsetEndIndex;if(gs===Eo){const $n=(or,qr)=>{const Ui=this.collisionIndex.placeCollisionBox(or,Te,ae,z,q,Ct,bt,A,Le.predicate,Jt);return Ui&&Ui.placeable&&(this.markUsedOrientation(m,qr,zt),this.placedOrientations[zt.crossTileID]=qr),Ui};ss(()=>$n(ja,o.ah.horizontal),()=>{const or=Rt.verticalTextBox;return m.allowVerticalPlacement&&zt.numVerticalGlyphVertices>0&&or?$n(or,o.ah.vertical):{box:null,offscreen:null}}),rs(yn&&yn.placeable)}else{let $n=o.aq[(Ii=(gn=this.prevPlacement)===null||gn===void 0?void 0:gn.variableOffsets[zt.crossTileID])===null||Ii===void 0?void 0:Ii.anchor];const or=(Ui,sa,Ua)=>{const Va=Ui.x2-Ui.x1,Sh=Ui.y2-Ui.y1,Pf=zt.textBoxScale,Th=Dt&&Ke==="never"?sa:null;let Io=null,kh=Te==="never"?1:2,_c="never";$n&&kh++;for(let kl=0;kl<kh;kl++){for(let yc=Eo;yc<gs;yc++){const bc=m.textAnchorOffsets.get(yc);if($n&&bc.textAnchor!==$n)continue;const qa=this.attemptAnchorPlacement(bc,Ui,Va,Sh,Pf,bt,Ct,ae,z,q,Le,_c,zt,m,Ua,A,P,Th,Jt);if(qa&&(Io=qa.placedGlyphBoxes,Io&&Io.placeable))return Ni=!0,ms=qa.shift,Io}$n?$n=null:_c=Te}return p&&!Io&&(Io={box:this.collisionIndex.placeCollisionBox(ja,"always",ae,z,q,Ct,bt,A,Le.predicate,Jt,new o.P(0,0)).box,offscreen:!1,placeable:!1}),Io};ss(()=>or(ja,Rt.iconBox,o.ah.horizontal),()=>{const Ui=Rt.verticalTextBox;return m.allowVerticalPlacement&&(!yn||!yn.placeable)&&zt.numVerticalGlyphVertices>0&&Ui?or(Ui,Rt.verticalIconBox,o.ah.vertical):{box:null,occluded:!0,offscreen:null}}),yn&&(Ni=yn.placeable,rr=yn.offscreen);const qr=rs(yn&&yn.placeable);if(!Ni&&this.prevPlacement){const Ui=this.prevPlacement.variableOffsets[zt.crossTileID];Ui&&(this.variableOffsets[zt.crossTileID]=Ui,this.markUsedJustification(m,Ui.anchor,zt,qr))}}}if(yr=yn,Ni=yr&&yr.placeable,rr=yr&&yr.offscreen,zt.useRuntimeCollisionCircles){const rs=m.text.placedSymbolArray.get(zt.centerJustifiedTextSymbolIndex),ss=o.ai(m.textSizeData,Ee,rs),Eo=b.get("text-padding");sr=this.collisionIndex.placeCollisionCircles(Te,rs,m.lineVertexArray,m.glyphOffsetArray,ss,z,q,X,K,p,Ct,Le.predicate,zt.collisionCircleDiameter,Eo,A,Jt),sr.circles.length&&sr.collisionDetected&&!p&&o.w("Collisions detected, but collision boxes are not shown"),Ni=Ge||sr.circles.length>0&&!sr.collisionDetected,rr=rr&&sr.offscreen}if(Rt.iconFeatureIndex&&(mc=Rt.iconFeatureIndex),Rt.iconBox){const rs=ss=>this.collisionIndex.placeCollisionBox(ss,Ke,ae,z,q,Ct,bt,P,Le.predicate,Jt,Dt&&ms?ms:void 0);Ir&&Ir.placeable&&Rt.verticalIconBox?(br=rs(Rt.verticalIconBox),_n=br.placeable):(br=rs(Rt.iconBox),_n=br.placeable),rr=rr&&br.offscreen}const ns=ze||zt.numHorizontalGlyphVertices===0&&zt.numVerticalGlyphVertices===0,gc=Ne||zt.numIconVertices===0;ns||gc?gc?ns||(_n=_n&&Ni):Ni=_n&&Ni:_n=Ni=_n&&Ni;const ku=_n&&br.placeable;if(Ni&&yr.placeable&&this.collisionIndex.insertCollisionBox(yr.box,Te,b.get("text-ignore-placement"),m.bucketInstanceId,Ir&&Ir.placeable&&Na?Na:Rs,Le.ID),ku&&this.collisionIndex.insertCollisionBox(br.box,Ke,b.get("icon-ignore-placement"),m.bucketInstanceId,mc,Le.ID),sr&&Ni&&this.collisionIndex.insertCollisionCircles(sr.circles,Te,b.get("text-ignore-placement"),m.bucketInstanceId,Rs,Le.ID),p&&this.storeCollisionData(m.bucketInstanceId,_i,Rt,yr,br,sr),zt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[zt.crossTileID]=new Xe(Ni||Lt,_n||Mt,rr||m.justReloaded),c[zt.crossTileID]=!0};if(Nt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const zt=m.getSortedSymbolIndexes(this.transform.angle);for(let Rt=zt.length-1;Rt>=0;--Rt){const _i=zt[Rt];vi(m.symbolInstances.get(_i),m.collisionArrays[_i],_i)}}else for(let zt=e.symbolInstanceStart;zt<e.symbolInstanceEnd;zt++)vi(m.symbolInstances.get(zt),m.collisionArrays[zt],zt);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const zt=this.collisionCircleArrays[m.bucketInstanceId];o.as(zt.invProjMatrix,z),zt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(e,c,p,m,b,A){if(p.textBox||p.iconBox){let P,z;this.collisionBoxArrays.has(e)?P=this.collisionBoxArrays.get(e):(P=new Map,this.collisionBoxArrays.set(e,P)),P.has(c)?z=P.get(c):(z={text:null,icon:null},P.set(c,z)),p.textBox&&(z.text=m.box),p.iconBox&&(z.icon=b.box)}if(A){let P=this.collisionCircleArrays[e];P===void 0&&(P=this.collisionCircleArrays[e]=new di);for(let z=0;z<A.circles.length;z+=4)P.circles.push(A.circles[z+0]),P.circles.push(A.circles[z+1]),P.circles.push(A.circles[z+2]),P.circles.push(A.collisionDetected?1:0)}}markUsedJustification(e,c,p,m){let b;b=m===o.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[o.at(c)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const P of A)P>=0&&(e.text.placedSymbolArray.get(P).crossTileID=b>=0&&P!==b?0:p.crossTileID)}markUsedOrientation(e,c,p){const m=c===o.ah.horizontal||c===o.ah.horizontalOnly?c:0,b=c===o.ah.vertical?c:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const P of A)e.text.placedSymbolArray.get(P).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const m=c?c.symbolFadeChange(e):1,b=c?c.opacities:{},A=c?c.variableOffsets:{},P=c?c.placedOrientations:{};for(const z in this.placements){const q=this.placements[z],X=b[z];X?(this.opacities[z]=new hn(X,m,q.text,q.icon),p=p||q.text!==X.text.placed||q.icon!==X.icon.placed):(this.opacities[z]=new hn(null,m,q.text,q.icon,q.skipFade),p=p||q.text||q.icon)}for(const z in b){const q=b[z];if(!this.opacities[z]){const X=new hn(q,m,!1,!1);X.isHidden()||(this.opacities[z]=X,p=p||q.text.placed||q.icon.placed)}}for(const z in A)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=A[z]);for(const z in P)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=P[z]);if(c&&c.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:e)}updateLayerOpacities(e,c){const p={};for(const m of c){const b=m.getBucket(e);b&&m.latestFeatureIndex&&e.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(e,c,p,m){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const b=e.layers[0],A=b.layout,P=new hn(null,0,!1,!1,!0),z=A.get("text-allow-overlap"),q=A.get("icon-allow-overlap"),X=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),K=A.get("text-rotation-alignment")==="map",ae=A.get("text-pitch-alignment")==="map",me=A.get("icon-text-fit")!=="none",ve=new hn(null,0,z&&(q||!e.hasIconData()||A.get("icon-optional")),q&&(z||!e.hasTextData()||A.get("text-optional")),!0);!e.collisionArrays&&m&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(m);const Ee=(ze,Ne,Te)=>{for(let Ge=0;Ge<Ne/4;Ge++)ze.opacityVertexArray.emplaceBack(Te);ze.hasVisibleVertices=ze.hasVisibleVertices||Te!==Fr},Le=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ze=0;ze<e.symbolInstances.length;ze++){const Ne=e.symbolInstances.get(ze),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:Ge,crossTileID:Ke}=Ne;let nt=this.opacities[Ke];p[Ke]?nt=P:nt||(nt=ve,this.opacities[Ke]=nt),p[Ke]=!0;const bt=Ne.numIconVertices>0,Ct=this.placedOrientations[Ne.crossTileID],Dt=Ct===o.ah.vertical,Nt=Ct===o.ah.horizontal||Ct===o.ah.horizontalOnly;if(Te>0||Ge>0){const Mt=Hn(nt.text);Ee(e.text,Te,Dt?Fr:Mt),Ee(e.text,Ge,Nt?Fr:Mt);const Jt=nt.text.isHidden();[Ne.rightJustifiedTextSymbolIndex,Ne.centerJustifiedTextSymbolIndex,Ne.leftJustifiedTextSymbolIndex].forEach(Rt=>{Rt>=0&&(e.text.placedSymbolArray.get(Rt).hidden=Jt||Dt?1:0)}),Ne.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Ne.verticalPlacedTextSymbolIndex).hidden=Jt||Nt?1:0);const vi=this.variableOffsets[Ne.crossTileID];vi&&this.markUsedJustification(e,vi.anchor,Ne,Ct);const zt=this.placedOrientations[Ne.crossTileID];zt&&(this.markUsedJustification(e,"left",Ne,zt),this.markUsedOrientation(e,zt,Ne))}if(bt){const Mt=Hn(nt.icon),Jt=!(me&&Ne.verticalPlacedIconSymbolIndex&&Dt);Ne.placedIconSymbolIndex>=0&&(Ee(e.icon,Ne.numIconVertices,Jt?Mt:Fr),e.icon.placedSymbolArray.get(Ne.placedIconSymbolIndex).hidden=nt.icon.isHidden()),Ne.verticalPlacedIconSymbolIndex>=0&&(Ee(e.icon,Ne.numVerticalIconVertices,Jt?Fr:Mt),e.icon.placedSymbolArray.get(Ne.verticalPlacedIconSymbolIndex).hidden=nt.icon.isHidden())}const Lt=Le&&Le.has(ze)?Le.get(ze):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Mt=e.collisionArrays[ze];if(Mt){let Jt=new o.P(0,0);if(Mt.textBox||Mt.verticalTextBox){let vi=!0;if(X){const zt=this.variableOffsets[Ke];zt?(Jt=Ki(zt.anchor,zt.width,zt.height,zt.textOffset,zt.textBoxScale),K&&Jt._rotate(ae?this.transform.angle:-this.transform.angle)):vi=!1}if(Mt.textBox||Mt.verticalTextBox){let zt;Mt.textBox&&(zt=Dt),Mt.verticalTextBox&&(zt=Nt),jn(e.textCollisionBox.collisionVertexArray,nt.text.placed,!vi||zt,Lt.text,Jt.x,Jt.y)}}if(Mt.iconBox||Mt.verticalIconBox){const vi=!!(!Nt&&Mt.verticalIconBox);let zt;Mt.iconBox&&(zt=vi),Mt.verticalIconBox&&(zt=!vi),jn(e.iconCollisionBox.collisionVertexArray,nt.icon.placed,zt,Lt.icon,me?Jt.x:0,me?Jt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ze.invProjMatrix,e.placementViewportMatrix=ze.viewportMatrix,e.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>e}setStale(){this.stale=!0}}function jn(v,e,c,p,m,b){p&&p.length!==0||(p=[0,0,0,0]);const A=p[0]-bi,P=p[1]-bi,z=p[2]-bi,q=p[3]-bi;v.emplaceBack(e?1:0,c?1:0,m||0,b||0,A,P),v.emplaceBack(e?1:0,c?1:0,m||0,b||0,z,P),v.emplaceBack(e?1:0,c?1:0,m||0,b||0,z,q),v.emplaceBack(e?1:0,c?1:0,m||0,b||0,A,q)}const si=Math.pow(2,25),Xr=Math.pow(2,24),Gn=Math.pow(2,17),Un=Math.pow(2,16),pn=Math.pow(2,9),ma=Math.pow(2,8),zn=Math.pow(2,1);function Hn(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const e=v.placed?1:0,c=Math.floor(127*v.opacity);return c*si+e*Xr+c*Gn+e*Un+c*pn+e*ma+c*zn+e}const Fr=0;function Rn(){return{isOccluded:(v,e,c)=>!1,getPitchedTextCorrection:(v,e,c)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(v,e,c,p){throw new Error("Not implemented.")},translatePosition:(v,e,c,p)=>function(m,b,A,P,z=!1){if(!A[0]&&!A[1])return[0,0];const q=z?P==="map"?m.angle:0:P==="viewport"?-m.angle:0;if(q){const X=Math.sin(q),K=Math.cos(q);A=[A[0]*K-A[1]*X,A[0]*X+A[1]*K]}return[z?A[0]:Si(b,A[0],m.zoom),z?A[1]:Si(b,A[1],m.zoom)]}(v,e,c,p),getCircleRadiusCorrection:v=>1}}class Ei{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,c,p,m,b){const A=this._bucketParts;for(;this._currentTileIndex<e.length;)if(c.getBucketParts(A,m,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((P,z)=>P.sortKey-z.sortKey));this._currentPartIndex<A.length;)if(c.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class No{constructor(e,c,p,m,b,A,P,z){this.placement=new Ji(e,Rn(),c,A,P,z),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(e,c,p){const m=y.now(),b=()=>!this._forceFullPlacement&&y.now()-m>2;for(;this._currentPlacementIndex>=0;){const A=c[e[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=P)&&(!A.maxzoom||A.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Ei(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const nr=512/o.X/2;class En{constructor(e,c,p){this.tileID=e,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<c.length;b++){const A=c.get(b),P=A.key,z=m.get(P);z?z.push(A):m.set(P,[A])}for(const[b,A]of m){const P={positions:A.map(z=>({x:Math.floor(z.anchorX*nr),y:Math.floor(z.anchorY*nr)})),crossTileIDs:A.map(z=>z.crossTileID)};if(P.positions.length>128){const z=new o.av(P.positions.length,16,Uint16Array);for(const{x:q,y:X}of P.positions)z.add(q,X);z.finish(),delete P.positions,P.index=z}this._symbolsByKey[b]=P}}getScaledCoordinates(e,c){const{x:p,y:m,z:b}=this.tileID.canonical,{x:A,y:P,z}=c.canonical,q=nr/Math.pow(2,z-b),X=(P*o.X+e.anchorY)*q,K=m*o.X*nr;return{x:Math.floor((A*o.X+e.anchorX)*q-p*o.X*nr),y:Math.floor(X-K)}}findMatches(e,c,p){const m=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let b=0;b<e.length;b++){const A=e.get(b);if(A.crossTileID)continue;const P=this._symbolsByKey[A.key];if(!P)continue;const z=this.getScaledCoordinates(A,c);if(P.index){const q=P.index.range(z.x-m,z.y-m,z.x+m,z.y+m).sort();for(const X of q){const K=P.crossTileIDs[X];if(!p[K]){p[K]=!0,A.crossTileID=K;break}}}else if(P.positions)for(let q=0;q<P.positions.length;q++){const X=P.positions[q],K=P.crossTileIDs[q];if(Math.abs(X.x-z.x)<=m&&Math.abs(X.y-z.y)<=m&&!p[K]){p[K]=!0,A.crossTileID=K;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ga{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const c=Math.round((e-this.lng)/360);if(c!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const A in m){const P=m[A];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+c),b[P.tileID.key]=P}this.indexes[p]=b}this.lng=e}addBucket(e,c,p){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const m=this.usedCrossTileIDs[e.overscaledZ];for(const b in this.indexes){const A=this.indexes[b];if(Number(b)>e.overscaledZ)for(const P in A){const z=A[P];z.tileID.isChildOf(e)&&z.findMatches(c.symbolInstances,e,m)}else{const P=A[e.scaledTo(Number(b)).key];P&&P.findMatches(c.symbolInstances,e,m)}}for(let b=0;b<c.symbolInstances.length;b++){const A=c.symbolInstances.get(b);A.crossTileID||(A.crossTileID=p.generate(),m[A.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new En(e,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(e,c){for(const p of c.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[e][m]}removeStaleBuckets(e){let c=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)e[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],c=!0)}return c}}class al{constructor(){this.layerIndexes={},this.crossTileIDs=new ga,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,c,p){let m=this.layerIndexes[e.id];m===void 0&&(m=this.layerIndexes[e.id]=new Rr);let b=!1;const A={};m.handleWrapJump(p);for(const P of c){const z=P.getBucket(e);z&&e.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(P.tileID,z,this.crossTileIDs)&&(b=!0),A[z.bucketInstanceId]=!0)}return m.removeStaleBuckets(A)&&(b=!0),b}pruneUnusedLayers(e){const c={};e.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Br=(v,e)=>o.t(v,e&&e.filter(c=>c.identifier!=="source.canvas")),tu=o.aw();class _a extends o.E{constructor(e,c={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=e,this.dispatcher=new Pi(Mi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new ce,this.imageManager.setEventedParent(this),this.glyphManager=new he(e._requestManager,c.localIdeographFontFamily),this.lineAtlas=new kt(256,512),this.crossTileSymbolIndex=new al,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.ay()),Fi().on(ct,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const A in this._layers){const P=this._layers[A];P.source===b.id&&this._validateLayer(P)}})}loadURL(e,c={},p){this.fire(new o.k("dataloading",{dataType:"style"})),c.validate=typeof c.validate!="boolean"||c.validate;const m=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;o.h(m,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,c,p)}).catch(A=>{this._loadStyleRequest=null,A&&!b.signal.aborted&&this.fire(new o.j(A))})}loadJSON(e,c={},p){this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,c.validate=c.validate!==!1,this._load(e,c,p)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(tu,{validate:!1})}_load(e,c,p){var m;const b=c.transformStyle?c.transformStyle(p,e):e;if(!c.validate||!Br(this,o.u(b))){this._loaded=!0,this.stylesheet=b;for(const A in b.sources)this.addSource(A,b.sources[A],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new lt(this.stylesheet.light),this.sky=new ht(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const e=o.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(c=>c.id),this._layers={},this._serializedLayers=null;for(const c of e){const p=o.aA(c);p.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=p}}_loadSprite(e,c=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,A,P,z){return o._(this,void 0,void 0,function*(){const q=U(b),X=P>1?"@2x":"",K={},ae={};for(const{id:me,url:ve}of q){const Ee=A.transformRequest(J(ve,X,".json"),"SpriteJSON");K[me]=o.h(Ee,z);const Le=A.transformRequest(J(ve,X,".png"),"SpriteImage");ae[me]=W.getImage(Le,z)}return yield Promise.all([...Object.values(K),...Object.values(ae)]),function(me,ve){return o._(this,void 0,void 0,function*(){const Ee={};for(const Le in me){Ee[Le]={};const ze=y.getImageCanvasContext((yield ve[Le]).data),Ne=(yield me[Le]).data;for(const Te in Ne){const{width:Ge,height:Ke,x:nt,y:bt,sdf:Ct,pixelRatio:Dt,stretchX:Nt,stretchY:Lt,content:Mt,textFitWidth:Jt,textFitHeight:vi}=Ne[Te];Ee[Le][Te]={data:null,pixelRatio:Dt,sdf:Ct,stretchX:Nt,stretchY:Lt,content:Mt,textFitWidth:Jt,textFitHeight:vi,spriteData:{width:Ge,height:Ke,x:nt,y:bt,context:ze}}}}return Ee})}(K,ae)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const A in b){this._spritesImagesIds[A]=[];const P=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter(z=>!(z in b)):[];for(const z of P)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in b[A]){const q=A==="default"?z:`${A}:${z}`;this._spritesImagesIds[A].push(q),q in this.imageManager.images?this.imageManager.updateImage(q,b[A][z],!1):this.imageManager.addImage(q,b[A][z]),c&&(this._changedImages[q]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new o.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),c&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(e){const c=this.sourceCaches[e.source];if(!c)return;const p=e.sourceLayer;if(!p)return;const m=c.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,c=!1){const p=this._serializedAllLayers();if(!e||e.length===0)return Object.values(c?o.aB(p):p);const m=[];for(const b of e)if(p[b]){const A=c?o.aB(p[b]):p[b];m.push(A)}return m}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const c=Object.keys(this._layers);for(const p of c){const m=this._layers[p];m.type!=="custom"&&(e[p]=m.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const c=this._changed;if(c){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const A in this._updatedSources){const P=this._updatedSources[A];if(P==="reload")this._reloadSource(A);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(e,this._availableImages),!b.isHidden(e.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,c&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,c){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,c={}){var p;this._checkLoaded();const m=this.serialize();if(e=c.transformStyle?c.transformStyle(m,e):e,((p=c.validate)===null||p===void 0||p)&&Br(this,o.u(e)))return!1;(e=o.aB(e)).layers=o.az(e.layers);const b=o.aC(m,e),A=this._getOperationsToPerform(b);if(A.unimplemented.length>0)throw new Error(`Unimplemented: ${A.unimplemented.join(", ")}.`);if(A.operations.length===0)return!1;for(const P of A.operations)P();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const c=[],p=[];for(const m of e)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":c.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":c.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":c.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":c.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":c.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":c.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":c.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":c.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":c.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":c.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":c.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":c.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":c.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":c.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":c.push(()=>{});break;default:p.push(m.command)}return{operations:c,unimplemented:p}}addImage(e,c){if(this.getImage(e))return this.fire(new o.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,c),this._afterImageUpdated(e)}updateImage(e,c){this.imageManager.updateImage(e,c)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,c,p={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(o.u.source,`sources.${e}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const m=this.sourceCaches[e]=new ii(e,c,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:e})),m.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===e)return this.fire(new o.j(new Error(`Source "${e}" cannot be removed while layer "${p}" is using it.`)));const c=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],c.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),c.setEventedParent(null),c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,c){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const p=this.sourceCaches[e].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(c),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,c,p={}){this._checkLoaded();const m=e.id;if(this.getLayer(m))return void this.fire(new o.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(e.type==="custom"){if(Br(this,o.aD(e)))return;b=o.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(m,e.source),e=o.aB(e),e=o.e(e,{source:m})),this._validate(o.u.layer,`layers.${m}`,e,{arrayIndex:-1},p))return;b=o.aA(e),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const A=c?this._order.indexOf(c):this._order.length;if(c&&A===-1)this.fire(new o.j(new Error(`Cannot add layer "${m}" before non-existing layer "${c}".`)));else{if(this._order.splice(A,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const P=this._removedLayers[m];delete this._removedLayers[m],P.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(e,c){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===c)return;const p=this._order.indexOf(e);this._order.splice(p,1);const m=c?this._order.indexOf(c):this._order.length;c&&m===-1?this.fire(new o.j(new Error(`Cannot move layer "${e}" before non-existing layer "${c}".`))):(this._order.splice(m,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const c=this._layers[e];if(!c)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${e}".`)));c.setEventedParent(null);const p=this._order.indexOf(e);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=c,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],c.onRemove&&c.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,c,p){this._checkLoaded();const m=this.getLayer(e);m?m.minzoom===c&&m.maxzoom===p||(c!=null&&(m.minzoom=c),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,c,p={}){this._checkLoaded();const m=this.getLayer(e);if(m){if(!o.aE(m.filter,c))return c==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.u.filter,`layers.${m.id}.filter`,c,null,p)||(m.filter=o.aB(c),this._updateLayer(m)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.aB(this.getLayer(e).filter)}setLayoutProperty(e,c,p,m={}){this._checkLoaded();const b=this.getLayer(e);b?o.aE(b.getLayoutProperty(c),p)||(b.setLayoutProperty(c,p,m),this._updateLayer(b)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,c){const p=this.getLayer(e);if(p)return p.getLayoutProperty(c);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,c,p,m={}){this._checkLoaded();const b=this.getLayer(e);b?o.aE(b.getPaintProperty(c),p)||(b.setPaintProperty(c,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,c){return this.getLayer(e).getPaintProperty(c)}setFeatureState(e,c){this._checkLoaded();const p=e.source,m=e.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new o.j(new Error(`The source '${p}' does not exist in the map's style.`)));const A=b.getSource().type;A==="geojson"&&m?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||m?(e.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,e.id,c)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,c){this._checkLoaded();const p=e.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new o.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,A=b==="vector"?e.sourceLayer:void 0;b!=="vector"||A?c&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(A,e.id,c):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const c=e.source,p=e.sourceLayer,m=this.sourceCaches[c];if(m!==void 0)return m.getSource().type!=="vector"||p?(e.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,e.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=o.aF(this.sourceCaches,b=>b.serialize()),c=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return o.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:e,layers:c,terrain:p},b=>b!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const c=A=>this._layers[A].type==="fill-extrusion",p={},m=[];for(let A=this._order.length-1;A>=0;A--){const P=this._order[A];if(c(P)){p[P]=A;for(const z of e){const q=z[P];if(q)for(const X of q)m.push(X)}}}m.sort((A,P)=>P.intersectionZ-A.intersectionZ);const b=[];for(let A=this._order.length-1;A>=0;A--){const P=this._order[A];if(c(P))for(let z=m.length-1;z>=0;z--){const q=m[z].feature;if(p[q.layer.id]<A)break;b.push(q),m.pop()}else for(const z of e){const q=z[P];if(q)for(const X of q)b.push(X.feature)}}return b}queryRenderedFeatures(e,c,p){c&&c.filter&&this._validate(o.u.filter,"queryRenderedFeatures.filter",c.filter,null,c);const m={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const z=this._layers[P];if(!z)return this.fire(new o.j(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];m[z.source]=!0}}const b=[];c.availableImages=this._availableImages;const A=this._serializedAllLayers();for(const P in this.sourceCaches)c.layers&&!m[P]||b.push(He(this.sourceCaches[P],this._layers,A,e,c,p));return this.placement&&b.push(function(P,z,q,X,K,ae,me){const ve={},Ee=ae.queryRenderedSymbols(X),Le=[];for(const ze of Object.keys(Ee).map(Number))Le.push(me[ze]);Le.sort(Pt);for(const ze of Le){const Ne=ze.featureIndex.lookupSymbolFeatures(Ee[ze.bucketInstanceId],z,ze.bucketIndex,ze.sourceLayerIndex,K.filter,K.layers,K.availableImages,P);for(const Te in Ne){const Ge=ve[Te]=ve[Te]||[],Ke=Ne[Te];Ke.sort((nt,bt)=>{const Ct=ze.featureSortOrder;if(Ct){const Dt=Ct.indexOf(nt.featureIndex);return Ct.indexOf(bt.featureIndex)-Dt}return bt.featureIndex-nt.featureIndex});for(const nt of Ke)Ge.push(nt)}}for(const ze in ve)ve[ze].forEach(Ne=>{const Te=Ne.feature,Ge=q[P[ze].source].getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=Ge});return ve}(this._layers,A,this.sourceCaches,e,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(e,c){c&&c.filter&&this._validate(o.u.filter,"querySourceFeatures.filter",c.filter,null,c);const p=this.sourceCaches[e];return p?function(m,b){const A=m.getRenderableIds().map(q=>m.getTileByID(q)),P=[],z={};for(let q=0;q<A.length;q++){const X=A[q],K=X.tileID.canonical.key;z[K]||(z[K]=!0,X.querySourceFeatures(P,b))}return P}(p,c):[]}getLight(){return this.light.getLight()}setLight(e,c={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const A in e)if(!o.aE(e[A],p[A])){m=!0;break}if(!m)return;const b={now:y.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,c),this.light.updateTransitions(b)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,c={}){const p=this.getSky();let m=!1;if(!e&&!p)return;if(e&&!p)m=!0;else if(!e&&p)m=!0;else for(const A in e)if(!o.aE(e[A],p[A])){m=!0;break}if(!m)return;const b={now:y.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,c),this.sky.updateTransitions(b)}_validate(e,c,p,m,b={}){return(!b||b.validate!==!1)&&Br(this,e.call(o.u,o.e({key:c,style:this.serialize(),value:p,styleSpec:o.v},m)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Fi().off(ct,this._rtlPluginLoaded);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this.sourceCaches){const p=this.sourceCaches[c];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const c in this.sourceCaches)this.sourceCaches[c].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,c,p,m,b=!1){let A=!1,P=!1;const z={};for(const q of this._order){const X=this._layers[q];if(X.type!=="symbol")continue;if(!z[X.source]){const ae=this.sourceCaches[X.source];z[X.source]=ae.getRenderableIds(!0).map(me=>ae.getTileByID(me)).sort((me,ve)=>ve.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(ve.tileID)?-1:1))}const K=this.crossTileSymbolIndex.addLayer(X,z[X.source],e.center.lng);A=A||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),e.zoom))&&(this.pauseablePlacement=new No(e,this.map.terrain,this._order,b,c,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A)for(const q of this._order){const X=this._layers[q];X.type==="symbol"&&this.placement.updateLayerOpacities(X,z[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,c){return o._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(c.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[c.source];return m&&m.setDependencies(c.tileID.key,c.type,c.icons),p})}getGlyphs(e,c){return o._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(c.stacks),m=this.sourceCaches[c.source];return m&&m.setDependencies(c.tileID.key,c.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,c={}){this._checkLoaded(),e&&this._validate(o.u.glyphs,"glyphs",e,null,c)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,c,p={},m){this._checkLoaded();const b=[{id:e,url:c}],A=[...U(this.stylesheet.sprite),...b];this._validate(o.u.sprite,"sprite",A,null,p)||(this.stylesheet.sprite=A,this._loadSprite(b,!0,m))}removeSprite(e){this._checkLoaded();const c=U(this.stylesheet.sprite);if(c.find(p=>p.id===e)){if(this._spritesImagesIds[e])for(const p of this._spritesImagesIds[e])this.imageManager.removeImage(p),this._changedImages[p]=!0;c.splice(c.findIndex(p=>p.id===e),1),this.stylesheet.sprite=c.length>0?c:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return U(this.stylesheet.sprite)}setSprite(e,c={},p){this._checkLoaded(),e&&this._validate(o.u.sprite,"sprite",e,null,c)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,p):(this._unloadSprite(),p&&p(null)))}}var Hs=o.Y([{name:"a_pos",type:"Int16",components:2}]);const Bn={prelude:Zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Zi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Zi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Zi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Zi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Zi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Zi(v,e){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=e.match(/attribute ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=b?b.concat(m):m,P={};return{fragmentSource:v=v.replace(c,(z,q,X,K,ae)=>(P[ae]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
varying ${X} ${K} ${ae};
#else
uniform ${X} ${K} u_${ae};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ae}
    ${X} ${K} ${ae} = u_${ae};
#endif
`)),vertexSource:e=e.replace(c,(z,q,X,K,ae)=>{const me=K==="float"?"vec2":"vec4",ve=ae.match(/color/)?"color":me;return P[ae]?q==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
uniform lowp float u_${ae}_t;
attribute ${X} ${me} a_${ae};
varying ${X} ${K} ${ae};
#else
uniform ${X} ${K} u_${ae};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${ae}
    ${ae} = a_${ae};
#else
    ${X} ${K} ${ae} = u_${ae};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ae}
    ${ae} = unpack_mix_${ve}(a_${ae}, u_${ae}_t);
#else
    ${X} ${K} ${ae} = u_${ae};
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_${ae}
uniform lowp float u_${ae}_t;
attribute ${X} ${me} a_${ae};
#else
uniform ${X} ${K} u_${ae};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${ae}
    ${X} ${K} ${ae} = a_${ae};
#else
    ${X} ${K} ${ae} = u_${ae};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ae}
    ${X} ${K} ${ae} = unpack_mix_${ve}(a_${ae}, u_${ae}_t);
#else
    ${X} ${K} ${ae} = u_${ae};
#endif
`}),staticAttributes:p,staticUniforms:A}}class ya{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,c,p,m,b,A,P,z,q){this.context=e;let X=this.boundPaintVertexBuffers.length!==m.length;for(let K=0;!X&&K<m.length;K++)this.boundPaintVertexBuffers[K]!==m[K]&&(X=!0);!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||X||this.boundIndexBuffer!==b||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==q?this.freshBind(c,p,m,b,A,P,z,q):(e.bindVertexArray.set(this.vao),P&&P.bind(),b&&b.dynamicDraw&&b.bind(),z&&z.bind(),q&&q.bind())}freshBind(e,c,p,m,b,A,P,z){const q=e.numAttributes,X=this.context,K=X.gl;this.vao&&this.destroy(),this.vao=X.createVertexArray(),X.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=z,c.enableAttributes(K,e);for(const ae of p)ae.enableAttributes(K,e);A&&A.enableAttributes(K,e),P&&P.enableAttributes(K,e),z&&z.enableAttributes(K,e),c.bind(),c.setVertexAttribPointers(K,e,b);for(const ae of p)ae.bind(),ae.setVertexAttribPointers(K,e,b);A&&(A.bind(),A.setVertexAttribPointers(K,e,b)),m&&m.bind(),P&&(P.bind(),P.setVertexAttribPointers(K,e,b)),z&&(z.bind(),z.setVertexAttribPointers(K,e,b)),X.currentNumAttributes=q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ba=(v,e,c,p,m)=>({u_matrix:v,u_texture:0,u_ele_delta:e,u_fog_matrix:c,u_fog_color:p?p.properties.get("fog-color"):o.aM.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?p.calculateFogBlendOpacity(m):0,u_horizon_color:p?p.properties.get("horizon-color"):o.aM.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1});function fo(v){const e=[];for(let c=0;c<v.length;c++){if(v[c]===null)continue;const p=v[c].split(" ");e.push(p.pop())}return e}class ll{constructor(e,c,p,m,b,A){const P=e.gl;this.program=P.createProgram();const z=fo(c.staticAttributes),q=p?p.getBinderAttributes():[],X=z.concat(q),K=Bn.prelude.staticUniforms?fo(Bn.prelude.staticUniforms):[],ae=c.staticUniforms?fo(c.staticUniforms):[],me=p?p.getBinderUniforms():[],ve=K.concat(ae).concat(me),Ee=[];for(const nt of ve)Ee.indexOf(nt)<0&&Ee.push(nt);const Le=p?p.defines():[];b&&Le.push("#define OVERDRAW_INSPECTOR;"),A&&Le.push("#define TERRAIN3D;");const ze=Le.concat(Bn.prelude.fragmentSource,c.fragmentSource).join(`
`),Ne=Le.concat(Bn.prelude.vertexSource,c.vertexSource).join(`
`),Te=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Te,ze),P.compileShader(Te),!P.getShaderParameter(Te,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(Te)}`);P.attachShader(this.program,Te);const Ge=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Ge,Ne),P.compileShader(Ge),!P.getShaderParameter(Ge,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(Ge)}`);P.attachShader(this.program,Ge),this.attributes={};const Ke={};this.numAttributes=X.length;for(let nt=0;nt<this.numAttributes;nt++)X[nt]&&(P.bindAttribLocation(this.program,nt,X[nt]),this.attributes[X[nt]]=nt);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(Ge),P.deleteShader(Te);for(let nt=0;nt<Ee.length;nt++){const bt=Ee[nt];if(bt&&!Ke[bt]){const Ct=P.getUniformLocation(this.program,bt);Ct&&(Ke[bt]=Ct)}}this.fixedUniforms=m(e,Ke),this.terrainUniforms=((nt,bt)=>({u_depth:new o.aH(nt,bt.u_depth),u_terrain:new o.aH(nt,bt.u_terrain),u_terrain_dim:new o.aI(nt,bt.u_terrain_dim),u_terrain_matrix:new o.aJ(nt,bt.u_terrain_matrix),u_terrain_unpack:new o.aK(nt,bt.u_terrain_unpack),u_terrain_exaggeration:new o.aI(nt,bt.u_terrain_exaggeration)}))(e,Ke),this.binderUniforms=p?p.getUniforms(e,Ke):[]}draw(e,c,p,m,b,A,P,z,q,X,K,ae,me,ve,Ee,Le,ze,Ne){const Te=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(p),e.setStencilMode(m),e.setColorMode(b),e.setCullFace(A),z){e.activeTexture.set(Te.TEXTURE2),Te.bindTexture(Te.TEXTURE_2D,z.depthTexture),e.activeTexture.set(Te.TEXTURE3),Te.bindTexture(Te.TEXTURE_2D,z.texture);for(const Ke in this.terrainUniforms)this.terrainUniforms[Ke].set(z[Ke])}for(const Ke in this.fixedUniforms)this.fixedUniforms[Ke].set(P[Ke]);Ee&&Ee.setUniforms(e,this.binderUniforms,me,{zoom:ve});let Ge=0;switch(c){case Te.LINES:Ge=2;break;case Te.TRIANGLES:Ge=3;break;case Te.LINE_STRIP:Ge=1}for(const Ke of ae.get()){const nt=Ke.vaos||(Ke.vaos={});(nt[q]||(nt[q]=new ya)).bind(e,this,X,Ee?Ee.getPaintVertexBuffers():[],K,Ke.vertexOffset,Le,ze,Ne),Te.drawElements(c,Ke.primitiveLength*Ge,Te.UNSIGNED_SHORT,Ke.primitiveOffset*Ge*2)}}}function jo(v,e,c){const p=1/Si(c,1,e.transform.tileZoom),m=Math.pow(2,c.tileID.overscaledZ),b=c.tileSize*Math.pow(2,e.transform.tileZoom)/m,A=b*(c.tileID.canonical.x+c.tileID.wrap*m),P=b*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[A>>16,P>>16],u_pixel_coord_lower:[65535&A,65535&P]}}const Is=(v,e,c,p)=>{const m=e.style.light,b=m.properties.get("position"),A=[b.x,b.y,b.z],P=function(){var q=new o.A(9);return o.A!=Float32Array&&(q[1]=0,q[2]=0,q[3]=0,q[5]=0,q[6]=0,q[7]=0),q[0]=1,q[4]=1,q[8]=1,q}();m.properties.get("anchor")==="viewport"&&function(q,X){var K=Math.sin(X),ae=Math.cos(X);q[0]=ae,q[1]=K,q[2]=0,q[3]=-K,q[4]=ae,q[5]=0,q[6]=0,q[7]=0,q[8]=1}(P,-e.transform.angle),function(q,X,K){var ae=X[0],me=X[1],ve=X[2];q[0]=ae*K[0]+me*K[3]+ve*K[6],q[1]=ae*K[1]+me*K[4]+ve*K[7],q[2]=ae*K[2]+me*K[5]+ve*K[8]}(A,A,P);const z=m.properties.get("color");return{u_matrix:v,u_lightpos:A,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+c,u_opacity:p}},va=(v,e,c,p,m,b,A)=>o.e(Is(v,e,c,p),jo(b,e,A),{u_height_factor:-Math.pow(2,m.overscaledZ)/A.tileSize/8}),po=v=>({u_matrix:v}),cl=(v,e,c,p)=>o.e(po(v),jo(c,e,p)),iu=(v,e)=>({u_matrix:v,u_world:e}),Zl=(v,e,c,p,m)=>o.e(cl(v,e,c,p),{u_world:m}),Wl=(v,e,c,p)=>{const m=v.transform;let b,A;if(p.paint.get("circle-pitch-alignment")==="map"){const P=Si(c,1,m.zoom);b=!0,A=[P,P]}else b=!1,A=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(e.posMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:A}},As=(v,e,c)=>({u_matrix:v,u_inv_matrix:e,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}),mo=(v,e,c=1)=>({u_matrix:v,u_color:e,u_overlay:0,u_overlay_scale:c}),Vn=v=>({u_matrix:v}),Yn=(v,e,c,p)=>({u_matrix:v,u_extrude_scale:Si(e,1,c),u_intensity:p}),go=(v,e,c,p)=>{const m=o.H();o.aP(m,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:c,u_color_ramp:p,u_opacity:e.paint.get("heatmap-opacity")}};function Qn(v,e){const c=Math.pow(2,e.canonical.z),p=e.canonical.y;return[new o.Z(0,p/c).toLngLat().lat,new o.Z(0,(p+1)/c).toLngLat().lat]}const wa=(v,e,c,p)=>{const m=v.transform;return{u_matrix:Kl(v,e,c,p),u_ratio:1/Si(e,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Gl=(v,e,c,p,m)=>o.e(wa(v,e,c,m),{u_image:0,u_image_height:p}),Xs=(v,e,c,p,m)=>{const b=v.transform,A=Xl(e,b);return{u_matrix:Kl(v,e,c,m),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Si(e,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Hl=(v,e,c,p,m,b)=>{const A=v.lineAtlas,P=Xl(e,v.transform),z=c.layout.get("line-cap")==="round",q=A.getDash(p.from,z),X=A.getDash(p.to,z),K=q.width*m.fromScale,ae=X.width*m.toScale;return o.e(wa(v,e,c,b),{u_patternscale_a:[P/K,-q.height/2],u_patternscale_b:[P/ae,-X.height/2],u_sdfgamma:A.width/(256*Math.min(K,ae)*v.pixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:X.y,u_mix:m.t})};function Xl(v,e){return 1/Si(v,1,e.tileZoom)}function Kl(v,e,c,p){return v.translatePosMatrix(p?p.posMatrix:e.tileID.posMatrix,e,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const nu=(v,e,c,p,m)=>{return{u_matrix:v,u_tl_parent:e,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(A=m.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:ru(m.paint.get("raster-hue-rotate"))};var b,A};function ru(v){v*=Math.PI/180;const e=Math.sin(v),c=Math.cos(v);return[(2*c+1)/3,(-Math.sqrt(3)*e-c+1)/3,(Math.sqrt(3)*e-c+1)/3]}const Jl=(v,e,c,p,m,b,A,P,z,q,X,K,ae,me)=>{const ve=A.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:ve.cameraToCenterDistance,u_pitch:ve.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ve.width/ve.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:z,u_coord_matrix:q,u_is_text:+K,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:ae,u_texture:0,u_translation:X,u_pitched_scale:me}},Uo=(v,e,c,p,m,b,A,P,z,q,X,K,ae,me,ve)=>{const Ee=A.transform;return o.e(Jl(v,e,c,p,m,b,A,P,z,q,X,K,ae,ve),{u_gamma_scale:p?Math.cos(Ee._pitch)*Ee.cameraToCenterDistance:1,u_device_pixel_ratio:A.pixelRatio,u_is_halo:1})},xa=(v,e,c,p,m,b,A,P,z,q,X,K,ae,me)=>o.e(Uo(v,e,c,p,m,b,A,P,z,q,X,!0,K,!0,me),{u_texsize_icon:ae,u_texture_icon:1}),Vo=(v,e,c)=>({u_matrix:v,u_opacity:e,u_color:c}),qo=(v,e,c,p,m,b)=>o.e(function(A,P,z,q){const X=z.imageManager.getPattern(A.from.toString()),K=z.imageManager.getPattern(A.to.toString()),{width:ae,height:me}=z.imageManager.getPixelSize(),ve=Math.pow(2,q.tileID.overscaledZ),Ee=q.tileSize*Math.pow(2,z.transform.tileZoom)/ve,Le=Ee*(q.tileID.canonical.x+q.tileID.wrap*ve),ze=Ee*q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:X.tl,u_pattern_br_a:X.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[ae,me],u_mix:P.t,u_pattern_size_a:X.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/Si(q,1,z.transform.tileZoom),u_pixel_coord_upper:[Le>>16,ze>>16],u_pixel_coord_lower:[65535&Le,65535&ze]}}(p,b,c,m),{u_matrix:v,u_opacity:e}),ul={fillExtrusion:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_lightpos:new o.aN(v,e.u_lightpos),u_lightintensity:new o.aI(v,e.u_lightintensity),u_lightcolor:new o.aN(v,e.u_lightcolor),u_vertical_gradient:new o.aI(v,e.u_vertical_gradient),u_opacity:new o.aI(v,e.u_opacity)}),fillExtrusionPattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_lightpos:new o.aN(v,e.u_lightpos),u_lightintensity:new o.aI(v,e.u_lightintensity),u_lightcolor:new o.aN(v,e.u_lightcolor),u_vertical_gradient:new o.aI(v,e.u_vertical_gradient),u_height_factor:new o.aI(v,e.u_height_factor),u_image:new o.aH(v,e.u_image),u_texsize:new o.aO(v,e.u_texsize),u_pixel_coord_upper:new o.aO(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(v,e.u_pixel_coord_lower),u_scale:new o.aN(v,e.u_scale),u_fade:new o.aI(v,e.u_fade),u_opacity:new o.aI(v,e.u_opacity)}),fill:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix)}),fillPattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_image:new o.aH(v,e.u_image),u_texsize:new o.aO(v,e.u_texsize),u_pixel_coord_upper:new o.aO(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(v,e.u_pixel_coord_lower),u_scale:new o.aN(v,e.u_scale),u_fade:new o.aI(v,e.u_fade)}),fillOutline:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_world:new o.aO(v,e.u_world)}),fillOutlinePattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_world:new o.aO(v,e.u_world),u_image:new o.aH(v,e.u_image),u_texsize:new o.aO(v,e.u_texsize),u_pixel_coord_upper:new o.aO(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(v,e.u_pixel_coord_lower),u_scale:new o.aN(v,e.u_scale),u_fade:new o.aI(v,e.u_fade)}),circle:(v,e)=>({u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_scale_with_map:new o.aH(v,e.u_scale_with_map),u_pitch_with_map:new o.aH(v,e.u_pitch_with_map),u_extrude_scale:new o.aO(v,e.u_extrude_scale),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_matrix:new o.aJ(v,e.u_matrix)}),collisionBox:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_pixel_extrude_scale:new o.aO(v,e.u_pixel_extrude_scale)}),collisionCircle:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_inv_matrix:new o.aJ(v,e.u_inv_matrix),u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_viewport_size:new o.aO(v,e.u_viewport_size)}),debug:(v,e)=>({u_color:new o.aL(v,e.u_color),u_matrix:new o.aJ(v,e.u_matrix),u_overlay:new o.aH(v,e.u_overlay),u_overlay_scale:new o.aI(v,e.u_overlay_scale)}),clippingMask:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix)}),heatmap:(v,e)=>({u_extrude_scale:new o.aI(v,e.u_extrude_scale),u_intensity:new o.aI(v,e.u_intensity),u_matrix:new o.aJ(v,e.u_matrix)}),heatmapTexture:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_world:new o.aO(v,e.u_world),u_image:new o.aH(v,e.u_image),u_color_ramp:new o.aH(v,e.u_color_ramp),u_opacity:new o.aI(v,e.u_opacity)}),hillshade:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_image:new o.aH(v,e.u_image),u_latrange:new o.aO(v,e.u_latrange),u_light:new o.aO(v,e.u_light),u_shadow:new o.aL(v,e.u_shadow),u_highlight:new o.aL(v,e.u_highlight),u_accent:new o.aL(v,e.u_accent)}),hillshadePrepare:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_image:new o.aH(v,e.u_image),u_dimension:new o.aO(v,e.u_dimension),u_zoom:new o.aI(v,e.u_zoom),u_unpack:new o.aK(v,e.u_unpack)}),line:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_ratio:new o.aI(v,e.u_ratio),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_units_to_pixels:new o.aO(v,e.u_units_to_pixels)}),lineGradient:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_ratio:new o.aI(v,e.u_ratio),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_units_to_pixels:new o.aO(v,e.u_units_to_pixels),u_image:new o.aH(v,e.u_image),u_image_height:new o.aI(v,e.u_image_height)}),linePattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_texsize:new o.aO(v,e.u_texsize),u_ratio:new o.aI(v,e.u_ratio),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_image:new o.aH(v,e.u_image),u_units_to_pixels:new o.aO(v,e.u_units_to_pixels),u_scale:new o.aN(v,e.u_scale),u_fade:new o.aI(v,e.u_fade)}),lineSDF:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_ratio:new o.aI(v,e.u_ratio),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_units_to_pixels:new o.aO(v,e.u_units_to_pixels),u_patternscale_a:new o.aO(v,e.u_patternscale_a),u_patternscale_b:new o.aO(v,e.u_patternscale_b),u_sdfgamma:new o.aI(v,e.u_sdfgamma),u_image:new o.aH(v,e.u_image),u_tex_y_a:new o.aI(v,e.u_tex_y_a),u_tex_y_b:new o.aI(v,e.u_tex_y_b),u_mix:new o.aI(v,e.u_mix)}),raster:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_tl_parent:new o.aO(v,e.u_tl_parent),u_scale_parent:new o.aI(v,e.u_scale_parent),u_buffer_scale:new o.aI(v,e.u_buffer_scale),u_fade_t:new o.aI(v,e.u_fade_t),u_opacity:new o.aI(v,e.u_opacity),u_image0:new o.aH(v,e.u_image0),u_image1:new o.aH(v,e.u_image1),u_brightness_low:new o.aI(v,e.u_brightness_low),u_brightness_high:new o.aI(v,e.u_brightness_high),u_saturation_factor:new o.aI(v,e.u_saturation_factor),u_contrast_factor:new o.aI(v,e.u_contrast_factor),u_spin_weights:new o.aN(v,e.u_spin_weights)}),symbolIcon:(v,e)=>({u_is_size_zoom_constant:new o.aH(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(v,e.u_is_size_feature_constant),u_size_t:new o.aI(v,e.u_size_t),u_size:new o.aI(v,e.u_size),u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_pitch:new o.aI(v,e.u_pitch),u_rotate_symbol:new o.aH(v,e.u_rotate_symbol),u_aspect_ratio:new o.aI(v,e.u_aspect_ratio),u_fade_change:new o.aI(v,e.u_fade_change),u_matrix:new o.aJ(v,e.u_matrix),u_label_plane_matrix:new o.aJ(v,e.u_label_plane_matrix),u_coord_matrix:new o.aJ(v,e.u_coord_matrix),u_is_text:new o.aH(v,e.u_is_text),u_pitch_with_map:new o.aH(v,e.u_pitch_with_map),u_is_along_line:new o.aH(v,e.u_is_along_line),u_is_variable_anchor:new o.aH(v,e.u_is_variable_anchor),u_texsize:new o.aO(v,e.u_texsize),u_texture:new o.aH(v,e.u_texture),u_translation:new o.aO(v,e.u_translation),u_pitched_scale:new o.aI(v,e.u_pitched_scale)}),symbolSDF:(v,e)=>({u_is_size_zoom_constant:new o.aH(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(v,e.u_is_size_feature_constant),u_size_t:new o.aI(v,e.u_size_t),u_size:new o.aI(v,e.u_size),u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_pitch:new o.aI(v,e.u_pitch),u_rotate_symbol:new o.aH(v,e.u_rotate_symbol),u_aspect_ratio:new o.aI(v,e.u_aspect_ratio),u_fade_change:new o.aI(v,e.u_fade_change),u_matrix:new o.aJ(v,e.u_matrix),u_label_plane_matrix:new o.aJ(v,e.u_label_plane_matrix),u_coord_matrix:new o.aJ(v,e.u_coord_matrix),u_is_text:new o.aH(v,e.u_is_text),u_pitch_with_map:new o.aH(v,e.u_pitch_with_map),u_is_along_line:new o.aH(v,e.u_is_along_line),u_is_variable_anchor:new o.aH(v,e.u_is_variable_anchor),u_texsize:new o.aO(v,e.u_texsize),u_texture:new o.aH(v,e.u_texture),u_gamma_scale:new o.aI(v,e.u_gamma_scale),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_is_halo:new o.aH(v,e.u_is_halo),u_translation:new o.aO(v,e.u_translation),u_pitched_scale:new o.aI(v,e.u_pitched_scale)}),symbolTextAndIcon:(v,e)=>({u_is_size_zoom_constant:new o.aH(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(v,e.u_is_size_feature_constant),u_size_t:new o.aI(v,e.u_size_t),u_size:new o.aI(v,e.u_size),u_camera_to_center_distance:new o.aI(v,e.u_camera_to_center_distance),u_pitch:new o.aI(v,e.u_pitch),u_rotate_symbol:new o.aH(v,e.u_rotate_symbol),u_aspect_ratio:new o.aI(v,e.u_aspect_ratio),u_fade_change:new o.aI(v,e.u_fade_change),u_matrix:new o.aJ(v,e.u_matrix),u_label_plane_matrix:new o.aJ(v,e.u_label_plane_matrix),u_coord_matrix:new o.aJ(v,e.u_coord_matrix),u_is_text:new o.aH(v,e.u_is_text),u_pitch_with_map:new o.aH(v,e.u_pitch_with_map),u_is_along_line:new o.aH(v,e.u_is_along_line),u_is_variable_anchor:new o.aH(v,e.u_is_variable_anchor),u_texsize:new o.aO(v,e.u_texsize),u_texsize_icon:new o.aO(v,e.u_texsize_icon),u_texture:new o.aH(v,e.u_texture),u_texture_icon:new o.aH(v,e.u_texture_icon),u_gamma_scale:new o.aI(v,e.u_gamma_scale),u_device_pixel_ratio:new o.aI(v,e.u_device_pixel_ratio),u_is_halo:new o.aH(v,e.u_is_halo),u_translation:new o.aO(v,e.u_translation),u_pitched_scale:new o.aI(v,e.u_pitched_scale)}),background:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_opacity:new o.aI(v,e.u_opacity),u_color:new o.aL(v,e.u_color)}),backgroundPattern:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_opacity:new o.aI(v,e.u_opacity),u_image:new o.aH(v,e.u_image),u_pattern_tl_a:new o.aO(v,e.u_pattern_tl_a),u_pattern_br_a:new o.aO(v,e.u_pattern_br_a),u_pattern_tl_b:new o.aO(v,e.u_pattern_tl_b),u_pattern_br_b:new o.aO(v,e.u_pattern_br_b),u_texsize:new o.aO(v,e.u_texsize),u_mix:new o.aI(v,e.u_mix),u_pattern_size_a:new o.aO(v,e.u_pattern_size_a),u_pattern_size_b:new o.aO(v,e.u_pattern_size_b),u_scale_a:new o.aI(v,e.u_scale_a),u_scale_b:new o.aI(v,e.u_scale_b),u_pixel_coord_upper:new o.aO(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.aO(v,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aI(v,e.u_tile_units_to_pixels)}),terrain:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_texture:new o.aH(v,e.u_texture),u_ele_delta:new o.aI(v,e.u_ele_delta),u_fog_matrix:new o.aJ(v,e.u_fog_matrix),u_fog_color:new o.aL(v,e.u_fog_color),u_fog_ground_blend:new o.aI(v,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.aI(v,e.u_fog_ground_blend_opacity),u_horizon_color:new o.aL(v,e.u_horizon_color),u_horizon_fog_blend:new o.aI(v,e.u_horizon_fog_blend)}),terrainDepth:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_ele_delta:new o.aI(v,e.u_ele_delta)}),terrainCoords:(v,e)=>({u_matrix:new o.aJ(v,e.u_matrix),u_texture:new o.aH(v,e.u_texture),u_terrain_coords_id:new o.aI(v,e.u_terrain_coords_id),u_ele_delta:new o.aI(v,e.u_ele_delta)}),sky:(v,e)=>({u_sky_color:new o.aL(v,e.u_sky_color),u_horizon_color:new o.aL(v,e.u_horizon_color),u_horizon:new o.aI(v,e.u_horizon),u_sky_horizon_blend:new o.aI(v,e.u_sky_horizon_blend)})};class Kr{constructor(e,c,p){this.context=e;const m=e.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const c=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ks={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Nr{constructor(e,c,p,m){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=m,this.context=e;const b=e.gl;this.buffer=b.createBuffer(),e.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,c){for(let p=0;p<this.attributes.length;p++){const m=c.attributes[this.attributes[p].name];m!==void 0&&e.enableVertexAttribArray(m)}}setVertexAttribPointers(e,c,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],A=c.attributes[b.name];A!==void 0&&e.vertexAttribPointer(A,b.components,e[Ks[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ms=new WeakMap;function Ps(v){var e;if(Ms.has(v))return Ms.get(v);{const c=(e=v.getParameter(v.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ms.set(v,c),c}}class Gi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zo extends Gi{getDefault(){return o.aM.transparent}set(e){const c=this.current;(e.r!==c.r||e.g!==c.g||e.b!==c.b||e.a!==c.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Yl extends Gi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Js extends Gi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class su extends Gi{getDefault(){return[!0,!0,!0,!0]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||e[3]!==c[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ql extends Gi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class ou extends Gi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class hl extends Gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const c=this.current;(e.func!==c.func||e.ref!==c.ref||e.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Sa extends Gi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class $l extends Gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;e?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=e,this.dirty=!1}}class ec extends Gi{getDefault(){return[0,1]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class tc extends Gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;e?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=e,this.dirty=!1}}class ic extends Gi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ys extends Gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;e?c.enable(c.BLEND):c.disable(c.BLEND),this.current=e,this.dirty=!1}}class Jr extends Gi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class nc extends Gi{getDefault(){return o.aM.transparent}set(e){const c=this.current;(e.r!==c.r||e.g!==c.g||e.b!==c.b||e.a!==c.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class rc extends Gi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Wo extends Gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;e?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=e,this.dirty=!1}}class au extends Gi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ta extends Gi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class lu extends Gi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class cu extends Gi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class sc extends Gi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const c=this.current;(e[0]!==c[0]||e[1]!==c[1]||e[2]!==c[2]||e[3]!==c[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class oc extends Gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ka extends Gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class _o extends Gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ac extends Gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Go extends Gi{getDefault(){return null}set(e){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Yr extends Gi{getDefault(){return null}set(e){var c;if(e===this.current&&!this.dirty)return;const p=this.gl;Ps(p)?p.bindVertexArray(e):(c=p.getExtension("OES_vertex_array_object"))===null||c===void 0||c.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Qs extends Gi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ho extends Gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Xo extends Gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ca extends Gi{constructor(e,c){super(e),this.context=e,this.parent=c}getDefault(){return null}}class fl extends Ca{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class $s extends Ca{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fs extends Ca{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class uu{constructor(e,c,p,m,b){this.context=e,this.width=c,this.height=p;const A=e.gl,P=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new fl(e,P),m)this.depthAttachment=b?new fs(e,P):new $s(e,P);else if(b)throw new Error("Stencil cannot be set without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,c=this.colorAttachment.get();if(c&&e.deleteTexture(c),this.depthAttachment){const p=this.depthAttachment.get();p&&e.deleteRenderbuffer(p)}e.deleteFramebuffer(this.framebuffer)}}class Tn{constructor(e,c,p){this.blendFunction=e,this.blendColor=c,this.mask=p}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,o.aM.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,o.aM.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],o.aM.transparent,[!0,!0,!0,!0]);class hu{constructor(e){var c,p;if(this.gl=e,this.clearColor=new Zo(this),this.clearDepth=new Yl(this),this.clearStencil=new Js(this),this.colorMask=new su(this),this.depthMask=new Ql(this),this.stencilMask=new ou(this),this.stencilFunc=new hl(this),this.stencilOp=new Sa(this),this.stencilTest=new $l(this),this.depthRange=new ec(this),this.depthTest=new tc(this),this.depthFunc=new ic(this),this.blend=new Ys(this),this.blendFunc=new Jr(this),this.blendColor=new nc(this),this.blendEquation=new rc(this),this.cullFace=new Wo(this),this.cullFaceSide=new au(this),this.frontFace=new Ta(this),this.program=new lu(this),this.activeTexture=new cu(this),this.viewport=new sc(this),this.bindFramebuffer=new oc(this),this.bindRenderbuffer=new ka(this),this.bindTexture=new _o(this),this.bindVertexBuffer=new ac(this),this.bindElementBuffer=new Go(this),this.bindVertexArray=new Yr(this),this.pixelStoreUnpack=new Qs(this),this.pixelStoreUnpackPremultiplyAlpha=new Ho(this),this.pixelStoreUnpackFlipY=new Xo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Ps(e)){this.HALF_FLOAT=e.HALF_FLOAT;const m=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(c=e.RGBA16F)!==null&&c!==void 0?c:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=e.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const m=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,c){return new Kr(this,e,c)}createVertexBuffer(e,c,p){return new Nr(this,e,c,p)}createRenderbuffer(e,c,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,e,c,p),this.bindRenderbuffer.set(null),b}createFramebuffer(e,c,p,m){return new uu(this,e,c,p,m)}clear({color:e,depth:c,stencil:p}){const m=this.gl;let b=0;e&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.aE(e.blendFunction,Tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Ps(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var c;return Ps(this.gl)?this.gl.deleteVertexArray(e):(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Li{constructor(e,c,p){this.func=e,this.mask=c,this.range=p}}Li.ReadOnly=!1,Li.ReadWrite=!0,Li.disabled=new Li(519,Li.ReadOnly,[0,1]);const eo=7680;class Qi{constructor(e,c,p,m,b,A){this.test=e,this.ref=c,this.mask=p,this.fail=m,this.depthFail=b,this.pass=A}}Qi.disabled=new Qi({func:519,mask:0},0,0,eo,eo,eo);class $i{constructor(e,c,p){this.enable=e,this.mode=c,this.frontFace=p}}let Ls;function Ko(v,e,c,p,m){const b=v.context,A=b.gl,P=v.useProgram("collisionBox"),z=[];let q=0,X=0;for(let ze=0;ze<p.length;ze++){const Ne=p[ze],Te=e.getTile(Ne).getBucket(c);if(!Te)continue;const Ge=m?Te.textCollisionBox:Te.iconCollisionBox,Ke=Te.collisionCircleArray;if(Ke.length>0){const nt=o.H();o.aQ(nt,Te.placementInvProjMatrix,v.transform.glCoordMatrix),o.aQ(nt,nt,Te.placementViewportMatrix),z.push({circleArray:Ke,circleOffset:X,transform:Ne.posMatrix,invTransform:nt,coord:Ne}),q+=Ke.length/4,X=q}Ge&&P.draw(b,A.LINES,Li.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,{u_matrix:Ne.posMatrix,u_pixel_extrude_scale:[1/(K=v.transform).width,1/K.height]},v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ne),c.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,v.transform.zoom,null,null,Ge.collisionVertexBuffer)}var K;if(!m||!z.length)return;const ae=v.useProgram("collisionCircle"),me=new o.aR;me.resize(4*q),me._trim();let ve=0;for(const ze of z)for(let Ne=0;Ne<ze.circleArray.length/4;Ne++){const Te=4*Ne,Ge=ze.circleArray[Te+0],Ke=ze.circleArray[Te+1],nt=ze.circleArray[Te+2],bt=ze.circleArray[Te+3];me.emplace(ve++,Ge,Ke,nt,bt,0),me.emplace(ve++,Ge,Ke,nt,bt,1),me.emplace(ve++,Ge,Ke,nt,bt,2),me.emplace(ve++,Ge,Ke,nt,bt,3)}(!Ls||Ls.length<2*q)&&(Ls=function(ze){const Ne=2*ze,Te=new o.aT;Te.resize(Ne),Te._trim();for(let Ge=0;Ge<Ne;Ge++){const Ke=6*Ge;Te.uint16[Ke+0]=4*Ge+0,Te.uint16[Ke+1]=4*Ge+1,Te.uint16[Ke+2]=4*Ge+2,Te.uint16[Ke+3]=4*Ge+2,Te.uint16[Ke+4]=4*Ge+3,Te.uint16[Ke+5]=4*Ge+0}return Te}(q));const Ee=b.createIndexBuffer(Ls,!0),Le=b.createVertexBuffer(me,o.aS.members,!0);for(const ze of z){const Ne=As(ze.transform,ze.invTransform,v.transform);ae.draw(b,A.TRIANGLES,Li.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,Ne,v.style.map.terrain&&v.style.map.terrain.getTerrainData(ze.coord),c.id,Le,Ee,o.a0.simpleSegment(0,2*ze.circleOffset,ze.circleArray.length,ze.circleArray.length/2),null,v.transform.zoom,null,null,null)}Le.destroy(),Ee.destroy()}$i.disabled=new $i(!1,1029,2305),$i.backCCW=new $i(!0,1029,2305);const Qr=o.an(new Float32Array(16));function Jo(v,e,c,p,m,b){const{horizontalAlign:A,verticalAlign:P}=o.au(v);return new o.P((-(A-.5)*e/m+p[0])*b,(-(P-.5)*c/m+p[1])*b)}function zs(v,e,c,p,m,b){const A=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let P=p.mult(b);c||(P=P.rotate(-m));const z=A.add(P);return Ae(z.x,z.y,e.labelPlaneMatrix,e.getElevation).point}if(c){const P=ot(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(v),z=Math.atan(P.y/P.x)+(P.x<0?Math.PI:0);return v.add(p.rotate(z))}return v.add(p)}function yo(v,e,c,p,m,b,A,P,z,q,X,K,ae,me){const ve=v.text.placedSymbolArray,Ee=v.text.dynamicLayoutVertexArray,Le=v.icon.dynamicLayoutVertexArray,ze={};Ee.clear();for(let Ne=0;Ne<ve.length;Ne++){const Te=ve.get(Ne),Ge=Te.hidden||!Te.crossTileID||v.allowVerticalPlacement&&!Te.placedOrientation?null:p[Te.crossTileID];if(Ge){const Ke=new o.P(Te.anchorX,Te.anchorY),nt={getElevation:me,width:m.width,height:m.height,labelPlaneMatrix:b,pitchWithMap:c,projection:X,tileAnchorPoint:Ke,translation:K,unwrappedTileID:ae},bt=c?Ae(Ke.x,Ke.y,A,me):ot(Ke.x,Ke.y,nt),Ct=te(m.cameraToCenterDistance,bt.signedDistanceFromCamera);let Dt=o.ai(v.textSizeData,z,Te)*Ct/o.ap;c&&(Dt*=v.tilePixelRatio/P);const{width:Nt,height:Lt,anchor:Mt,textOffset:Jt,textBoxScale:vi}=Ge,zt=Jo(Mt,Nt,Lt,Jt,vi,Dt),Rt=X.getPitchedTextCorrection(m,Ke.add(new o.P(K[0],K[1])),ae),_i=zs(bt.point,nt,e,zt,m.angle,Rt),gn=v.allowVerticalPlacement&&Te.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let Ii=0;Ii<Te.numGlyphs;Ii++)o.aj(Ee,_i,gn);q&&Te.associatedIconIndex>=0&&(ze[Te.associatedIconIndex]={shiftedAnchor:_i,angle:gn})}else ri(Te.numGlyphs,Ee)}if(q){Le.clear();const Ne=v.icon.placedSymbolArray;for(let Te=0;Te<Ne.length;Te++){const Ge=Ne.get(Te);if(Ge.hidden)ri(Ge.numGlyphs,Le);else{const Ke=ze[Te];if(Ke)for(let nt=0;nt<Ge.numGlyphs;nt++)o.aj(Le,Ke.shiftedAnchor,Ke.angle);else ri(Ge.numGlyphs,Le)}}v.icon.dynamicLayoutVertexBuffer.updateData(Le)}v.text.dynamicLayoutVertexBuffer.updateData(Ee)}function kr(v,e,c){return c.iconsInText&&e?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function dl(v,e,c,p,m,b,A,P,z,q,X,K){const ae=v.context,me=ae.gl,ve=v.transform,Ee=Rn(),Le=P==="map",ze=z==="map",Ne=P!=="viewport"&&c.layout.get("symbol-placement")!=="point",Te=Le&&!ze&&!Ne,Ge=!ze&&Ne,Ke=!c.layout.get("symbol-sort-key").isConstant();let nt=!1;const bt=v.depthModeForSublayer(0,Li.ReadOnly),Ct=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Dt=[],Nt=Ee.getCircleRadiusCorrection(ve);for(const Lt of p){const Mt=e.getTile(Lt),Jt=Mt.getBucket(c);if(!Jt)continue;const vi=m?Jt.text:Jt.icon;if(!vi||!vi.segments.get().length||!vi.hasVisibleVertices)continue;const zt=vi.programConfigurations.get(c.id),Rt=m||Jt.sdfIcons,_i=m?Jt.textSizeData:Jt.iconSizeData,gn=ze||ve.pitch!==0,Ii=v.useProgram(kr(Rt,m,Jt),zt),Ni=o.ag(_i,ve.zoom),_n=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Lt);let rr,ms,yn,Ir,yr=[0,0],sr=null;if(m)ms=Mt.glyphAtlasTexture,yn=me.LINEAR,rr=Mt.glyphAtlasTexture.size,Jt.iconsInText&&(yr=Mt.imageAtlasTexture.size,sr=Mt.imageAtlasTexture,Ir=gn||v.options.rotating||v.options.zooming||_i.kind==="composite"||_i.kind==="camera"?me.LINEAR:me.NEAREST);else{const Ui=c.layout.get("icon-size").constantOr(0)!==1||Jt.iconsNeedLinear;ms=Mt.imageAtlasTexture,yn=Rt||v.options.rotating||v.options.zooming||Ui||gn?me.LINEAR:me.NEAREST,rr=Mt.imageAtlasTexture.size}const br=Si(Mt,1,v.transform.zoom),Rs=Ge?Lt.posMatrix:Qr,Na=Sr(Rs,ze,Le,v.transform,br),mc=Tr(Rs,ze,Le,v.transform,br),ja=Tr(Lt.posMatrix,ze,Le,v.transform,br),ns=Ee.translatePosition(v.transform,Mt,b,A),gc=Ct&&Jt.hasTextData(),ku=c.layout.get("icon-text-fit")!=="none"&&gc&&Jt.hasIconData();if(Ne){const Ui=v.style.map.terrain?(Ua,Va)=>v.style.map.terrain.getElevation(Lt,Ua,Va):null,sa=c.layout.get("text-rotation-alignment")==="map";de(Jt,Lt.posMatrix,v,m,Na,ja,ze,q,sa,Ee,Lt.toUnwrapped(),ve.width,ve.height,ns,Ui)}const rs=Lt.posMatrix,ss=m&&Ct||ku,Eo=Ne||ss?Qr:Na,gs=mc,$n=Rt&&c.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=Rt?Jt.iconsInText?xa(_i.kind,Ni,Te,ze,Ne,ss,v,rs,Eo,gs,ns,rr,yr,Nt):Uo(_i.kind,Ni,Te,ze,Ne,ss,v,rs,Eo,gs,ns,m,rr,!0,Nt):Jl(_i.kind,Ni,Te,ze,Ne,ss,v,rs,Eo,gs,ns,m,rr,Nt);const qr={program:Ii,buffers:vi,uniformValues:or,atlasTexture:ms,atlasTextureIcon:sr,atlasInterpolation:yn,atlasInterpolationIcon:Ir,isSDF:Rt,hasHalo:$n};if(Ke&&Jt.canOverlap){nt=!0;const Ui=vi.segments.get();for(const sa of Ui)Dt.push({segments:new o.a0([sa]),sortKey:sa.sortKey,state:qr,terrainData:_n})}else Dt.push({segments:vi.segments,sortKey:0,state:qr,terrainData:_n})}nt&&Dt.sort((Lt,Mt)=>Lt.sortKey-Mt.sortKey);for(const Lt of Dt){const Mt=Lt.state;if(ae.activeTexture.set(me.TEXTURE0),Mt.atlasTexture.bind(Mt.atlasInterpolation,me.CLAMP_TO_EDGE),Mt.atlasTextureIcon&&(ae.activeTexture.set(me.TEXTURE1),Mt.atlasTextureIcon&&Mt.atlasTextureIcon.bind(Mt.atlasInterpolationIcon,me.CLAMP_TO_EDGE)),Mt.isSDF){const Jt=Mt.uniformValues;Mt.hasHalo&&(Jt.u_is_halo=1,to(Mt.buffers,Lt.segments,c,v,Mt.program,bt,X,K,Jt,Lt.terrainData)),Jt.u_is_halo=0}to(Mt.buffers,Lt.segments,c,v,Mt.program,bt,X,K,Mt.uniformValues,Lt.terrainData)}}function to(v,e,c,p,m,b,A,P,z,q){const X=p.context;m.draw(X,X.gl.TRIANGLES,b,A,P,$i.disabled,z,q,c.id,v.layoutVertexBuffer,v.indexBuffer,e,c.paint,p.transform.zoom,v.programConfigurations.get(c.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function ds(v,e,c,p){const m=v.context,b=m.gl,A=Qi.disabled,P=new Tn([b.ONE,b.ONE],o.aM.transparent,[!0,!0,!0,!0]),z=e.getBucket(c);if(!z)return;const q=p.key;let X=c.heatmapFbos.get(q);X||(X=Yo(m,e.tileSize,e.tileSize),c.heatmapFbos.set(q,X)),m.bindFramebuffer.set(X.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:o.aM.transparent});const K=z.programConfigurations.get(c.id),ae=v.useProgram("heatmap",K),me=v.style.map.terrain.getTerrainData(p);ae.draw(m,b.TRIANGLES,Li.disabled,A,P,$i.disabled,Yn(p.posMatrix,e,v.transform.zoom,c.paint.get("heatmap-intensity")),me,c.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,c.paint,v.transform.zoom,K)}function io(v,e,c){const p=v.context,m=p.gl;p.setColorMode(v.colorModeForRenderPass());const b=Qo(p,e),A=c.key,P=e.heatmapFbos.get(A);P&&(p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,P.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),b.bind(m.LINEAR,m.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(p,m.TRIANGLES,Li.disabled,Qi.disabled,v.colorModeForRenderPass(),$i.disabled,go(v,e,0,1),null,e.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,e.paint,v.transform.zoom),P.destroy(),e.heatmapFbos.delete(A))}function Yo(v,e,c){var p,m;const b=v.gl,A=b.createTexture();b.bindTexture(b.TEXTURE_2D,A),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const P=(p=v.HALF_FLOAT)!==null&&p!==void 0?p:b.UNSIGNED_BYTE,z=(m=v.RGBA16F)!==null&&m!==void 0?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,z,e,c,0,b.RGBA,P,null);const q=v.createFramebuffer(e,c,!1,!1);return q.colorAttachment.set(A),q}function Qo(v,e){return e.colorRampTexture||(e.colorRampTexture=new R(v,e.colorRamp,v.gl.RGBA)),e.colorRampTexture}function bo(v,e,c,p,m){if(!c||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let A=b[c.to.toString()],P=b[c.from.toString()];if(!A&&P&&(A=P),!P&&A&&(P=A),!A||!P){const z=m.getPaintProperty(e);A=b[z],P=b[z]}A&&P&&v.setConstantPatternPositions(A,P)}function $o(v,e,c,p,m,b,A){const P=v.context.gl,z="fill-pattern",q=c.paint.get(z),X=q&&q.constantOr(1),K=c.getCrossfadeParameters();let ae,me,ve,Ee,Le;A?(me=X&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ae=P.LINES):(me=X?"fillPattern":"fill",ae=P.TRIANGLES);const ze=q.constantOr(null);for(const Ne of p){const Te=e.getTile(Ne);if(X&&!Te.patternsLoaded())continue;const Ge=Te.getBucket(c);if(!Ge)continue;const Ke=Ge.programConfigurations.get(c.id),nt=v.useProgram(me,Ke),bt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ne);X&&(v.context.activeTexture.set(P.TEXTURE0),Te.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ke.updatePaintBuffers(K)),bo(Ke,z,ze,Te,c);const Ct=bt?Ne:null,Dt=v.translatePosMatrix(Ct?Ct.posMatrix:Ne.posMatrix,Te,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(A){Ee=Ge.indexBuffer2,Le=Ge.segments2;const Nt=[P.drawingBufferWidth,P.drawingBufferHeight];ve=me==="fillOutlinePattern"&&X?Zl(Dt,v,K,Te,Nt):iu(Dt,Nt)}else Ee=Ge.indexBuffer,Le=Ge.segments,ve=X?cl(Dt,v,K,Te):po(Dt);nt.draw(v.context,ae,m,v.stencilModeForClipping(Ne),b,$i.disabled,ve,bt,c.id,Ge.layoutVertexBuffer,Ee,Le,c.paint,v.transform.zoom,Ke)}}function Ea(v,e,c,p,m,b,A){const P=v.context,z=P.gl,q="fill-extrusion-pattern",X=c.paint.get(q),K=X.constantOr(1),ae=c.getCrossfadeParameters(),me=c.paint.get("fill-extrusion-opacity"),ve=X.constantOr(null);for(const Ee of p){const Le=e.getTile(Ee),ze=Le.getBucket(c);if(!ze)continue;const Ne=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ee),Te=ze.programConfigurations.get(c.id),Ge=v.useProgram(K?"fillExtrusionPattern":"fillExtrusion",Te);K&&(v.context.activeTexture.set(z.TEXTURE0),Le.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Te.updatePaintBuffers(ae)),bo(Te,q,ve,Le,c);const Ke=v.translatePosMatrix(Ee.posMatrix,Le,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),nt=c.paint.get("fill-extrusion-vertical-gradient"),bt=K?va(Ke,v,nt,me,Ee,ae,Le):Is(Ke,v,nt,me);Ge.draw(P,P.gl.TRIANGLES,m,b,A,$i.backCCW,bt,Ne,c.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,c.paint,v.transform.zoom,Te,v.style.map.terrain&&ze.centroidVertexBuffer)}}function vo(v,e,c,p,m,b,A){const P=v.context,z=P.gl,q=c.fbo;if(!q)return;const X=v.useProgram("hillshade"),K=v.style.map.terrain&&v.style.map.terrain.getTerrainData(e);P.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,q.colorAttachment.get()),X.draw(P,z.TRIANGLES,m,b,A,$i.disabled,((ae,me,ve,Ee)=>{const Le=ve.paint.get("hillshade-shadow-color"),ze=ve.paint.get("hillshade-highlight-color"),Ne=ve.paint.get("hillshade-accent-color");let Te=ve.paint.get("hillshade-illumination-direction")*(Math.PI/180);ve.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=ae.transform.angle);const Ge=!ae.options.moving;return{u_matrix:Ee?Ee.posMatrix:ae.transform.calculatePosMatrix(me.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:Qn(0,me.tileID),u_light:[ve.paint.get("hillshade-exaggeration"),Te],u_shadow:Le,u_highlight:ze,u_accent:Ne}})(v,c,p,K?e:null),K,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function wo(v,e,c,p,m,b){const A=v.context,P=A.gl,z=e.dem;if(z&&z.data){const q=z.dim,X=z.stride,K=z.getPixels();if(A.activeTexture.set(P.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||v.getTileTexture(X),e.demTexture){const me=e.demTexture;me.update(K,{premultiply:!1}),me.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else e.demTexture=new R(A,K,P.RGBA,{premultiply:!1}),e.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);A.activeTexture.set(P.TEXTURE0);let ae=e.fbo;if(!ae){const me=new R(A,{width:q,height:q,data:null},P.RGBA);me.bind(P.LINEAR,P.CLAMP_TO_EDGE),ae=e.fbo=A.createFramebuffer(q,q,!0,!1),ae.colorAttachment.set(me.texture)}A.bindFramebuffer.set(ae.framebuffer),A.viewport.set([0,0,q,q]),v.useProgram("hillshadePrepare").draw(A,P.TRIANGLES,p,m,b,$i.disabled,((me,ve)=>{const Ee=ve.stride,Le=o.H();return o.aP(Le,0,o.X,-o.X,0,0,1),o.J(Le,Le,[0,-o.X,0]),{u_matrix:Le,u_image:1,u_dimension:[Ee,Ee],u_zoom:me.overscaledZ,u_unpack:ve.getUnpackVector()}})(e.tileID,z),null,c.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function pl(v,e,c,p,m,b){const A=p.paint.get("raster-fade-duration");if(!b&&A>0){const P=y.now(),z=(P-v.timeAdded)/A,q=e?(P-e.timeAdded)/A:-1,X=c.getSource(),K=m.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),ae=!e||Math.abs(e.tileID.overscaledZ-K)>Math.abs(v.tileID.overscaledZ-K),me=ae&&v.refreshedUponExpiration?1:o.ac(ae?z:1-q,0,1);return v.refreshedUponExpiration&&z>=1&&(v.refreshedUponExpiration=!1),e?{opacity:1,mix:1-me}:{opacity:me,mix:0}}return{opacity:1,mix:0}}const ml=new o.aM(1,0,0,1),qi=new o.aM(0,1,0,1),xo=new o.aM(0,0,1,1),lc=new o.aM(1,0,1,1),Os=new o.aM(0,1,1,1);function no(v,e,c,p){ea(v,0,e+c/2,v.transform.width,c,p)}function Ia(v,e,c,p){ea(v,e-c/2,0,c,v.transform.height,p)}function ea(v,e,c,p,m,b){const A=v.context,P=A.gl;P.enable(P.SCISSOR_TEST),P.scissor(e*v.pixelRatio,c*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),A.clear({color:b}),P.disable(P.SCISSOR_TEST)}function Aa(v,e,c){const p=v.context,m=p.gl,b=c.posMatrix,A=v.useProgram("debug"),P=Li.disabled,z=Qi.disabled,q=v.colorModeForRenderPass(),X="$debug",K=v.style.map.terrain&&v.style.map.terrain.getTerrainData(c);p.activeTexture.set(m.TEXTURE0);const ae=e.getTileByID(c.key).latestRawTileData,me=Math.floor((ae&&ae.byteLength||0)/1024),ve=e.getTile(c).tileSize,Ee=512/Math.min(ve,512)*(c.overscaledZ/v.transform.zoom)*.5;let Le=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Le+=` => ${c.overscaledZ}`),function(ze,Ne){ze.initDebugOverlayCanvas();const Te=ze.debugOverlayCanvas,Ge=ze.context.gl,Ke=ze.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Te.width,Te.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(Ne,5,5),Ke.strokeText(Ne,5,5),ze.debugOverlayTexture.update(Te),ze.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(v,`${Le} ${me}kB`),A.draw(p,m.TRIANGLES,P,z,Tn.alphaBlended,$i.disabled,mo(b,o.aM.transparent,Ee),null,X,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),A.draw(p,m.LINE_STRIP,P,z,q,$i.disabled,mo(b,o.aM.red),K,X,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function gl(v,e,c){const p=v.context,m=p.gl,b=v.colorModeForRenderPass(),A=new Li(m.LEQUAL,Li.ReadWrite,v.depthRangeFor3D),P=v.useProgram("terrain"),z=e.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,v.width,v.height]);for(const q of c){const X=v.renderToTexture.getTexture(q),K=e.getTerrainData(q.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,X.texture);const ae=v.transform.calculatePosMatrix(q.tileID.toUnwrapped()),me=e.getMeshFrameDelta(v.transform.zoom),ve=v.transform.calculateFogMatrix(q.tileID.toUnwrapped()),Ee=ba(ae,me,ve,v.style.sky,v.transform.pitch);P.draw(p,m.TRIANGLES,A,Qi.disabled,b,$i.backCCW,Ee,K,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}}class So{constructor(e,c,p){this.vertexBuffer=e,this.indexBuffer=c,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Ma{constructor(e,c){this.context=new hu(e),this.transform=c,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ii.maxUnderzooming+ii.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new al}resize(e,c,p){if(this.width=Math.floor(e*p),this.height=Math.floor(c*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const e=this.context,c=new o.aX;c.emplaceBack(0,0),c.emplaceBack(o.X,0),c.emplaceBack(0,o.X),c.emplaceBack(o.X,o.X),this.tileExtentBuffer=e.createVertexBuffer(c,Hs.members),this.tileExtentSegments=o.a0.simpleSegment(0,0,4,2);const p=new o.aX;p.emplaceBack(0,0),p.emplaceBack(o.X,0),p.emplaceBack(0,o.X),p.emplaceBack(o.X,o.X),this.debugBuffer=e.createVertexBuffer(p,Hs.members),this.debugSegments=o.a0.simpleSegment(0,0,4,5);const m=new o.$;m.emplaceBack(0,0,0,0),m.emplaceBack(o.X,0,o.X,0),m.emplaceBack(0,o.X,0,o.X),m.emplaceBack(o.X,o.X,o.X,o.X),this.rasterBoundsBuffer=e.createVertexBuffer(m,Y.members),this.rasterBoundsSegments=o.a0.simpleSegment(0,0,4,2);const b=new o.aX;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(b,Hs.members),this.viewportSegments=o.a0.simpleSegment(0,0,4,2);const A=new o.aZ;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(A);const P=new o.aY;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(P);const z=this.context.gl;this.stencilClearMode=new Qi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const e=this.context,c=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=o.H();o.aP(p,0,this.width,this.height,0,0,1),o.K(p,p,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,c.TRIANGLES,Li.disabled,this.stencilClearMode,Tn.disabled,$i.disabled,Vn(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!c||!c.length)return;this.currentStencilSource=e.source;const p=this.context,m=p.gl;this.nextStencilID+c.length>256&&this.clearStencil(),p.setColorMode(Tn.disabled),p.setDepthMode(Li.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of c){const P=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A);b.draw(p,m.TRIANGLES,Li.disabled,new Qi({func:m.ALWAYS,mask:0},P,255,m.KEEP,m.KEEP,m.REPLACE),Tn.disabled,$i.disabled,Vn(A.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,c=this.context.gl;return new Qi({func:c.NOTEQUAL,mask:255},e,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(e){const c=this.context.gl;return new Qi({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(e){const c=this.context.gl,p=e.sort((A,P)=>P.overscaledZ-A.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const A={};for(let P=0;P<b;P++)A[P+m]=new Qi({func:c.GEQUAL,mask:255},P+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[A,p]}return[{[m]:Qi.disabled},p]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Tn([e.CONSTANT_COLOR,e.ONE],new o.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tn.unblended:Tn.alphaBlended}depthModeForSublayer(e,c,p){if(!this.opaquePassEnabledForLayer())return Li.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Li(p||this.context.gl.LEQUAL,c,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,c){this.style=e,this.options=c,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},A={},P={};for(const z in m){const q=m[z];q.used&&q.prepare(this.context),b[z]=q.getVisibleCoordinates(),A[z]=b[z].slice().reverse(),P[z]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<p.length;z++)if(this.style._layers[p[z]].is3D()){this.opaquePassCutoff=z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const z of p){const q=this.style._layers[z];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const X=A[q.source];(q.type==="custom"||X.length)&&this.renderLayer(this,m[q.source],q,X)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?o.aM.black:o.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(z,q){const X=z.context,K=X.gl,ae=((ze,Ne,Te)=>({u_sky_color:ze.properties.get("sky-color"),u_horizon_color:ze.properties.get("horizon-color"),u_horizon:(Ne.height/2+Ne.getHorizon())*Te,u_sky_horizon_blend:ze.properties.get("sky-horizon-blend")*Ne.height/2*Te}))(q,z.style.map.transform,z.pixelRatio),me=new Li(K.LEQUAL,Li.ReadWrite,[0,1]),ve=Qi.disabled,Ee=z.colorModeForRenderPass(),Le=z.useProgram("sky");if(!q.mesh){const ze=new o.aX;ze.emplaceBack(-1,-1),ze.emplaceBack(1,-1),ze.emplaceBack(1,1),ze.emplaceBack(-1,1);const Ne=new o.aY;Ne.emplaceBack(0,1,2),Ne.emplaceBack(0,2,3),q.mesh=new So(X.createVertexBuffer(ze,Hs.members),X.createIndexBuffer(Ne),o.a0.simpleSegment(0,0,ze.length,Ne.length))}Le.draw(X,K.TRIANGLES,me,ve,Ee,$i.disabled,ae,void 0,"sky",q.mesh.vertexBuffer,q.mesh.indexBuffer,q.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[p[this.currentLayer]],q=m[z.source],X=b[z.source];this._renderTileClippingMasks(z,X),this.renderLayer(this,q,z,X)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const z=this.style._layers[p[this.currentLayer]],q=m[z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(z))continue;const X=(z.type==="symbol"?P:A)[z.source];this._renderTileClippingMasks(z,b[z.source]),this.renderLayer(this,q,z,X)}if(this.options.showTileBoundaries){const z=function(q,X){let K=null;const ae=Object.values(q._layers).flatMap(Le=>Le.source&&!Le.isHidden(X)?[q.sourceCaches[Le.source]]:[]),me=ae.filter(Le=>Le.getSource().type==="vector"),ve=ae.filter(Le=>Le.getSource().type!=="vector"),Ee=Le=>{(!K||K.getSource().maxzoom<Le.getSource().maxzoom)&&(K=Le)};return me.forEach(Le=>Ee(Le)),K||ve.forEach(Le=>Ee(Le)),K}(this.style,this.transform.zoom);z&&function(q,X,K){for(let ae=0;ae<K.length;ae++)Aa(q,X,K[ae])}(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const q=z.transform.padding;no(z,z.transform.height-(q.top||0),3,ml),no(z,q.bottom||0,3,qi),Ia(z,q.left||0,3,xo),Ia(z,z.transform.width-(q.right||0),3,lc);const X=z.transform.centerPoint;(function(K,ae,me,ve){ea(K,ae-1,me-10,2,20,ve),ea(K,ae-10,me-1,20,2,ve)})(z,X.x,z.transform.height-X.y,Os)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const c=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=e?!o.a_(c,p):!o.a$(c,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(o.b0(c,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,A){const P=b.context,z=P.gl,q=Tn.unblended,X=new Li(z.LEQUAL,Li.ReadWrite,[0,1]),K=A.getTerrainMesh(),ae=A.sourceCache.getRenderableTiles(),me=b.useProgram("terrainDepth");P.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),P.clear({color:o.aM.transparent,depth:1});for(const ve of ae){const Ee=A.getTerrainData(ve.tileID),Le={u_matrix:b.transform.calculatePosMatrix(ve.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(b.transform.zoom)};me.draw(P,z.TRIANGLES,X,Qi.disabled,q,$i.backCCW,Le,Ee,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,A){const P=b.context,z=P.gl,q=Tn.unblended,X=new Li(z.LEQUAL,Li.ReadWrite,[0,1]),K=A.getTerrainMesh(),ae=A.getCoordsTexture(),me=A.sourceCache.getRenderableTiles(),ve=b.useProgram("terrainCoords");P.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),P.clear({color:o.aM.transparent,depth:1}),A.coordsIndex=[];for(const Ee of me){const Le=A.getTerrainData(Ee.tileID);P.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,ae.texture);const ze={u_matrix:b.transform.calculatePosMatrix(Ee.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(b.transform.zoom)};ve.draw(P,z.TRIANGLES,X,Qi.disabled,q,$i.backCCW,ze,Le,"terrain",K.vertexBuffer,K.indexBuffer,K.segments),A.coordsIndex.push(Ee.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(e,c,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,A,P,z,q){if(b.renderPass!=="translucent")return;const X=Qi.disabled,K=b.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ae,me,ve,Ee,Le,ze,Ne,Te,Ge){const Ke=me.transform,nt=Rn(),bt=Le==="map",Ct=ze==="map";for(const Dt of ae){const Nt=Ee.getTile(Dt),Lt=Nt.getBucket(ve);if(!Lt||!Lt.text||!Lt.text.segments.get().length)continue;const Mt=o.ag(Lt.textSizeData,Ke.zoom),Jt=Si(Nt,1,me.transform.zoom),vi=Sr(Dt.posMatrix,Ct,bt,me.transform,Jt),zt=ve.layout.get("icon-text-fit")!=="none"&&Lt.hasIconData();if(Mt){const Rt=Math.pow(2,Ke.zoom-Nt.tileID.overscaledZ),_i=me.style.map.terrain?(Ii,Ni)=>me.style.map.terrain.getElevation(Dt,Ii,Ni):null,gn=nt.translatePosition(Ke,Nt,Ne,Te);yo(Lt,bt,Ct,Ge,Ke,vi,Dt.posMatrix,Rt,Mt,zt,nt,gn,Dt.toUnwrapped(),_i)}}}(z,b,P,A,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),q),P.paint.get("icon-opacity").constantOr(1)!==0&&dl(b,A,P,z,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),X,K),P.paint.get("text-opacity").constantOr(1)!==0&&dl(b,A,P,z,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),X,K),A.map.showCollisionBoxes&&(Ko(b,A,P,z,!0),Ko(b,A,P,z,!1))})(e,c,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,A,P,z){if(b.renderPass!=="translucent")return;const q=P.paint.get("circle-opacity"),X=P.paint.get("circle-stroke-width"),K=P.paint.get("circle-stroke-opacity"),ae=!P.layout.get("circle-sort-key").isConstant();if(q.constantOr(1)===0&&(X.constantOr(1)===0||K.constantOr(1)===0))return;const me=b.context,ve=me.gl,Ee=b.depthModeForSublayer(0,Li.ReadOnly),Le=Qi.disabled,ze=b.colorModeForRenderPass(),Ne=[];for(let Te=0;Te<z.length;Te++){const Ge=z[Te],Ke=A.getTile(Ge),nt=Ke.getBucket(P);if(!nt)continue;const bt=nt.programConfigurations.get(P.id),Ct=b.useProgram("circle",bt),Dt=nt.layoutVertexBuffer,Nt=nt.indexBuffer,Lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ge),Mt={programConfiguration:bt,program:Ct,layoutVertexBuffer:Dt,indexBuffer:Nt,uniformValues:Wl(b,Ge,Ke,P),terrainData:Lt};if(ae){const Jt=nt.segments.get();for(const vi of Jt)Ne.push({segments:new o.a0([vi]),sortKey:vi.sortKey,state:Mt})}else Ne.push({segments:nt.segments,sortKey:0,state:Mt})}ae&&Ne.sort((Te,Ge)=>Te.sortKey-Ge.sortKey);for(const Te of Ne){const{programConfiguration:Ge,program:Ke,layoutVertexBuffer:nt,indexBuffer:bt,uniformValues:Ct,terrainData:Dt}=Te.state;Ke.draw(me,ve.TRIANGLES,Ee,Le,ze,$i.disabled,Ct,Dt,P.id,nt,bt,Te.segments,P.paint,b.transform.zoom,Ge)}})(e,c,p,m);break;case"heatmap":(function(b,A,P,z){if(P.paint.get("heatmap-opacity")===0)return;const q=b.context;if(b.style.map.terrain){for(const X of z){const K=A.getTile(X);A.hasRenderableParent(X)||(b.renderPass==="offscreen"?ds(b,K,P,X):b.renderPass==="translucent"&&io(b,P,X))}q.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(X,K,ae,me){const ve=X.context,Ee=ve.gl,Le=Qi.disabled,ze=new Tn([Ee.ONE,Ee.ONE],o.aM.transparent,[!0,!0,!0,!0]);(function(Ne,Te,Ge){const Ke=Ne.gl;Ne.activeTexture.set(Ke.TEXTURE1),Ne.viewport.set([0,0,Te.width/4,Te.height/4]);let nt=Ge.heatmapFbos.get(o.aU);nt?(Ke.bindTexture(Ke.TEXTURE_2D,nt.colorAttachment.get()),Ne.bindFramebuffer.set(nt.framebuffer)):(nt=Yo(Ne,Te.width/4,Te.height/4),Ge.heatmapFbos.set(o.aU,nt))})(ve,X,ae),ve.clear({color:o.aM.transparent});for(let Ne=0;Ne<me.length;Ne++){const Te=me[Ne];if(K.hasRenderableParent(Te))continue;const Ge=K.getTile(Te),Ke=Ge.getBucket(ae);if(!Ke)continue;const nt=Ke.programConfigurations.get(ae.id),bt=X.useProgram("heatmap",nt),{zoom:Ct}=X.transform;bt.draw(ve,Ee.TRIANGLES,Li.disabled,Le,ze,$i.disabled,Yn(Te.posMatrix,Ge,Ct,ae.paint.get("heatmap-intensity")),null,ae.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,ae.paint,X.transform.zoom,nt)}ve.viewport.set([0,0,X.width,X.height])}(b,A,P,z):b.renderPass==="translucent"&&function(X,K){const ae=X.context,me=ae.gl;ae.setColorMode(X.colorModeForRenderPass());const ve=K.heatmapFbos.get(o.aU);ve&&(ae.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,ve.colorAttachment.get()),ae.activeTexture.set(me.TEXTURE1),Qo(ae,K).bind(me.LINEAR,me.CLAMP_TO_EDGE),X.useProgram("heatmapTexture").draw(ae,me.TRIANGLES,Li.disabled,Qi.disabled,X.colorModeForRenderPass(),$i.disabled,go(X,K,0,1),null,K.id,X.viewportBuffer,X.quadTriangleIndexBuffer,X.viewportSegments,K.paint,X.transform.zoom))}(b,P)})(e,c,p,m);break;case"line":(function(b,A,P,z){if(b.renderPass!=="translucent")return;const q=P.paint.get("line-opacity"),X=P.paint.get("line-width");if(q.constantOr(1)===0||X.constantOr(1)===0)return;const K=b.depthModeForSublayer(0,Li.ReadOnly),ae=b.colorModeForRenderPass(),me=P.paint.get("line-dasharray"),ve=P.paint.get("line-pattern"),Ee=ve.constantOr(1),Le=P.paint.get("line-gradient"),ze=P.getCrossfadeParameters(),Ne=Ee?"linePattern":me?"lineSDF":Le?"lineGradient":"line",Te=b.context,Ge=Te.gl;let Ke=!0;for(const nt of z){const bt=A.getTile(nt);if(Ee&&!bt.patternsLoaded())continue;const Ct=bt.getBucket(P);if(!Ct)continue;const Dt=Ct.programConfigurations.get(P.id),Nt=b.context.program.get(),Lt=b.useProgram(Ne,Dt),Mt=Ke||Lt.program!==Nt,Jt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(nt),vi=ve.constantOr(null);if(vi&&bt.imageAtlas){const _i=bt.imageAtlas,gn=_i.patternPositions[vi.to.toString()],Ii=_i.patternPositions[vi.from.toString()];gn&&Ii&&Dt.setConstantPatternPositions(gn,Ii)}const zt=Jt?nt:null,Rt=Ee?Xs(b,bt,P,ze,zt):me?Hl(b,bt,P,me,ze,zt):Le?Gl(b,bt,P,Ct.lineClipsArray.length,zt):wa(b,bt,P,zt);if(Ee)Te.activeTexture.set(Ge.TEXTURE0),bt.imageAtlasTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE),Dt.updatePaintBuffers(ze);else if(me&&(Mt||b.lineAtlas.dirty))Te.activeTexture.set(Ge.TEXTURE0),b.lineAtlas.bind(Te);else if(Le){const _i=Ct.gradients[P.id];let gn=_i.texture;if(P.gradientVersion!==_i.version){let Ii=256;if(P.stepInterpolant){const Ni=A.getSource().maxzoom,_n=nt.canonical.z===Ni?Math.ceil(1<<b.transform.maxZoom-nt.canonical.z):1;Ii=o.ac(o.aV(Ct.maxLineLength/o.X*1024*_n),256,Te.maxTextureSize)}_i.gradient=o.aW({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:Ii,image:_i.gradient||void 0,clips:Ct.lineClipsArray}),_i.texture?_i.texture.update(_i.gradient):_i.texture=new R(Te,_i.gradient,Ge.RGBA),_i.version=P.gradientVersion,gn=_i.texture}Te.activeTexture.set(Ge.TEXTURE0),gn.bind(P.stepInterpolant?Ge.NEAREST:Ge.LINEAR,Ge.CLAMP_TO_EDGE)}Lt.draw(Te,Ge.TRIANGLES,K,b.stencilModeForClipping(nt),ae,$i.disabled,Rt,Jt,P.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,P.paint,b.transform.zoom,Dt,Ct.layoutVertexBuffer2),Ke=!1}})(e,c,p,m);break;case"fill":(function(b,A,P,z){const q=P.paint.get("fill-color"),X=P.paint.get("fill-opacity");if(X.constantOr(1)===0)return;const K=b.colorModeForRenderPass(),ae=P.paint.get("fill-pattern"),me=b.opaquePassEnabledForLayer()&&!ae.constantOr(1)&&q.constantOr(o.aM.transparent).a===1&&X.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===me){const ve=b.depthModeForSublayer(1,b.renderPass==="opaque"?Li.ReadWrite:Li.ReadOnly);$o(b,A,P,z,ve,K,!1)}if(b.renderPass==="translucent"&&P.paint.get("fill-antialias")){const ve=b.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Li.ReadOnly);$o(b,A,P,z,ve,K,!0)}})(e,c,p,m);break;case"fill-extrusion":(function(b,A,P,z){const q=P.paint.get("fill-extrusion-opacity");if(q!==0&&b.renderPass==="translucent"){const X=new Li(b.context.gl.LEQUAL,Li.ReadWrite,b.depthRangeFor3D);if(q!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Ea(b,A,P,z,X,Qi.disabled,Tn.disabled),Ea(b,A,P,z,X,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const K=b.colorModeForRenderPass();Ea(b,A,P,z,X,Qi.disabled,K)}}})(e,c,p,m);break;case"hillshade":(function(b,A,P,z){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const q=b.context,X=b.depthModeForSublayer(0,Li.ReadOnly),K=b.colorModeForRenderPass(),[ae,me]=b.renderPass==="translucent"?b.stencilConfigForOverlap(z):[{},z];for(const ve of me){const Ee=A.getTile(ve);Ee.needsHillshadePrepare!==void 0&&Ee.needsHillshadePrepare&&b.renderPass==="offscreen"?wo(b,Ee,P,X,Qi.disabled,K):b.renderPass==="translucent"&&vo(b,ve,Ee,P,X,ae[ve.overscaledZ],K)}q.viewport.set([0,0,b.width,b.height])})(e,c,p,m);break;case"raster":(function(b,A,P,z){if(b.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!z.length)return;const q=b.context,X=q.gl,K=A.getSource(),ae=b.useProgram("raster"),me=b.colorModeForRenderPass(),[ve,Ee]=K instanceof Ie?[{},z]:b.stencilConfigForOverlap(z),Le=Ee[Ee.length-1].overscaledZ,ze=!b.options.moving;for(const Ne of Ee){const Te=b.depthModeForSublayer(Ne.overscaledZ-Le,P.paint.get("raster-opacity")===1?Li.ReadWrite:Li.ReadOnly,X.LESS),Ge=A.getTile(Ne);Ge.registerFadeDuration(P.paint.get("raster-fade-duration"));const Ke=A.findLoadedParent(Ne,0),nt=A.findLoadedSibling(Ne),bt=pl(Ge,Ke||nt||null,A,P,b.transform,b.style.map.terrain);let Ct,Dt;const Nt=P.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR;q.activeTexture.set(X.TEXTURE0),Ge.texture.bind(Nt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(X.TEXTURE1),Ke?(Ke.texture.bind(Nt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),Ct=Math.pow(2,Ke.tileID.overscaledZ-Ge.tileID.overscaledZ),Dt=[Ge.tileID.canonical.x*Ct%1,Ge.tileID.canonical.y*Ct%1]):Ge.texture.bind(Nt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),Ge.texture.useMipmap&&q.extTextureFilterAnisotropic&&b.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const Lt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ne),Mt=Lt?Ne:null,Jt=Mt?Mt.posMatrix:b.transform.calculatePosMatrix(Ne.toUnwrapped(),ze),vi=nu(Jt,Dt||[0,0],Ct||1,bt,P);K instanceof Ie?ae.draw(q,X.TRIANGLES,Te,Qi.disabled,me,$i.disabled,vi,Lt,P.id,K.boundsBuffer,b.quadTriangleIndexBuffer,K.boundsSegments):ae.draw(q,X.TRIANGLES,Te,ve[Ne.overscaledZ],me,$i.disabled,vi,Lt,P.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(e,c,p,m);break;case"background":(function(b,A,P,z){const q=P.paint.get("background-color"),X=P.paint.get("background-opacity");if(X===0)return;const K=b.context,ae=K.gl,me=b.transform,ve=me.tileSize,Ee=P.paint.get("background-pattern");if(b.isPatternMissing(Ee))return;const Le=!Ee&&q.a===1&&X===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==Le)return;const ze=Qi.disabled,Ne=b.depthModeForSublayer(0,Le==="opaque"?Li.ReadWrite:Li.ReadOnly),Te=b.colorModeForRenderPass(),Ge=b.useProgram(Ee?"backgroundPattern":"background"),Ke=z||me.coveringTiles({tileSize:ve,terrain:b.style.map.terrain});Ee&&(K.activeTexture.set(ae.TEXTURE0),b.imageManager.bind(b.context));const nt=P.getCrossfadeParameters();for(const bt of Ke){const Ct=z?bt.posMatrix:b.transform.calculatePosMatrix(bt.toUnwrapped()),Dt=Ee?qo(Ct,X,b,Ee,{tileID:bt,tileSize:ve},nt):Vo(Ct,X,q),Nt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(bt);Ge.draw(K,ae.TRIANGLES,Ne,ze,Te,$i.disabled,Dt,Nt,P.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(e,0,p,m);break;case"custom":(function(b,A,P){const z=b.context,q=P.implementation;if(b.renderPass==="offscreen"){const X=q.prerender;X&&(b.setCustomLayerDefaults(),z.setColorMode(b.colorModeForRenderPass()),X.call(q,z.gl,b.transform.customLayerMatrix()),z.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),z.setColorMode(b.colorModeForRenderPass()),z.setStencilMode(Qi.disabled);const X=q.renderingMode==="3d"?new Li(b.context.gl.LEQUAL,Li.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Li.ReadOnly);z.setDepthMode(X),q.render(z.gl,b.transform.customLayerMatrix(),{farZ:b.transform.farZ,nearZ:b.transform.nearZ,fov:b.transform._fov,modelViewProjectionMatrix:b.transform.modelViewProjectionMatrix,projectionMatrix:b.transform.projectionMatrix}),z.setDirty(),b.setBaseState(),z.bindFramebuffer.set(null)}})(e,0,p)}}translatePosMatrix(e,c,p,m,b){if(!p[0]&&!p[1])return e;const A=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(A){const q=Math.sin(A),X=Math.cos(A);p=[p[0]*X-p[1]*q,p[0]*q+p[1]*X]}const P=[b?p[0]:Si(c,p[0],this.transform.zoom),b?p[1]:Si(c,p[1],this.transform.zoom),0],z=new Float32Array(16);return o.J(z,e,P),z}saveTileTexture(e){const c=this._tileTextures[e.size[0]];c?c.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const c=this._tileTextures[e];return c&&c.length>0?c.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const c=this.imageManager.getPattern(e.from.toString()),p=this.imageManager.getPattern(e.to.toString());return!c||!p}useProgram(e,c){this.cache=this.cache||{};const p=e+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new ll(this.context,Bn[e],c,ul[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new R(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:c}=this.context.gl;return this.width!==e||this.height!==c}}class Cr{constructor(e,c){this.points=e,this.planes=c}static fromInvProjectionMatrix(e,c,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const z=1/(P=o.af([],P,e))[3]/c*m;return o.b1(P,P,[z,z,1/P[3],z])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const z=function(ae,me){var ve=me[0],Ee=me[1],Le=me[2],ze=ve*ve+Ee*Ee+Le*Le;return ze>0&&(ze=1/Math.sqrt(ze)),ae[0]=me[0]*ze,ae[1]=me[1]*ze,ae[2]=me[2]*ze,ae}([],function(ae,me,ve){var Ee=me[0],Le=me[1],ze=me[2],Ne=ve[0],Te=ve[1],Ge=ve[2];return ae[0]=Le*Ge-ze*Te,ae[1]=ze*Ne-Ee*Ge,ae[2]=Ee*Te-Le*Ne,ae}([],re([],b[P[0]],b[P[1]]),re([],b[P[2]],b[P[1]]))),q=-((X=z)[0]*(K=b[P[1]])[0]+X[1]*K[1]+X[2]*K[2]);var X,K;return z.concat(q)});return new Cr(b,A)}}class mr{constructor(e,c){this.min=e,this.max=c,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(e){const c=[e%2==0,e<2],p=oe(this.min),m=oe(this.max);for(let b=0;b<c.length;b++)p[b]=c[b]?this.min[b]:this.center[b],m[b]=c[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new mr(p,m)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<e.planes.length;m++){const b=e.planes[m];let A=0;for(let P=0;P<c.length;P++)o.b2(b,c[P])>=0&&A++;if(A===0)return 0;A!==c.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let P=0;P<e.points.length;P++){const z=e.points[P][m]-this.min[m];b=Math.min(b,z),A=Math.max(A,z)}if(A<0||b>this.max[m]-this.min[m])return 0}return 1}}class To{constructor(e=0,c=0,p=0,m=0){if(isNaN(e)||e<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=c,this.left=p,this.right=m}interpolate(e,c,p){return c.top!=null&&e.top!=null&&(this.top=o.y.number(e.top,c.top,p)),c.bottom!=null&&e.bottom!=null&&(this.bottom=o.y.number(e.bottom,c.bottom,p)),c.left!=null&&e.left!=null&&(this.left=o.y.number(e.left,c.left,p)),c.right!=null&&e.right!=null&&(this.right=o.y.number(e.right,c.right,p)),this}getCenter(e,c){const p=o.ac((this.left+e-this.right)/2,0,e),m=o.ac((this.top+c-this.bottom)/2,0,c);return new o.P(p,m)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new To(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const _l=85.051129;class ko{constructor(e,c,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=e||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new To,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new ko(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const c=-o.b3(e,-180,180)*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=function(){var p=new o.A(4);return o.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var A=m[0],P=m[1],z=m[2],q=m[3],X=Math.sin(b),K=Math.cos(b);p[0]=A*K+z*X,p[1]=P*K+q*X,p[2]=A*-X+z*K,p[3]=P*-X+q*K}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const c=o.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const c=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.tileZoom=Math.max(0,Math.floor(c)),this.scale=this.zoomScale(c),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,c,p){this._unmodified=!1,this._edgeInsets.interpolate(e,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const c=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(e){const c=[new o.b4(0,e)];if(this._renderWorldCopies){const p=this.pointCoordinate(new o.P(0,0)),m=this.pointCoordinate(new o.P(this.width,0)),b=this.pointCoordinate(new o.P(this.width,this.height)),A=this.pointCoordinate(new o.P(0,this.height)),P=Math.floor(Math.min(p.x,m.x,b.x,A.x)),z=Math.floor(Math.max(p.x,m.x,b.x,A.x)),q=1;for(let X=P-q;X<=z+q;X++)X!==0&&c.push(new o.b4(X,e))}return c}coveringTiles(e){var c,p;let m=this.coveringZoomLevel(e);const b=m;if(e.minzoom!==void 0&&m<e.minzoom)return[];e.maxzoom!==void 0&&m>e.maxzoom&&(m=e.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),P=o.Z.fromLngLat(this.center),z=Math.pow(2,m),q=[z*A.x,z*A.y,0],X=[z*P.x,z*P.y,0],K=Cr.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let ae=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ae=m);const me=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,ve=Te=>({aabb:new mr([Te*z,0,0],[(Te+1)*z,z,0]),zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),Ee=[],Le=[],ze=m,Ne=e.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let Te=1;Te<=3;Te++)Ee.push(ve(-Te)),Ee.push(ve(Te));for(Ee.push(ve(0));Ee.length>0;){const Te=Ee.pop(),Ge=Te.x,Ke=Te.y;let nt=Te.fullyVisible;if(!nt){const Lt=Te.aabb.intersects(K);if(Lt===0)continue;nt=Lt===2}const bt=e.terrain?q:X,Ct=Te.aabb.distanceX(bt),Dt=Te.aabb.distanceY(bt),Nt=Math.max(Math.abs(Ct),Math.abs(Dt));if(Te.zoom===ze||Nt>me+(1<<ze-Te.zoom)-2&&Te.zoom>=ae){const Lt=ze-Te.zoom,Mt=q[0]-.5-(Ge<<Lt),Jt=q[1]-.5-(Ke<<Lt);Le.push({tileID:new o.S(Te.zoom===ze?Ne:Te.zoom,Te.wrap,Te.zoom,Ge,Ke),distanceSq:j([X[0]-.5-Ge,X[1]-.5-Ke]),tileDistanceToCamera:Math.sqrt(Mt*Mt+Jt*Jt)})}else for(let Lt=0;Lt<4;Lt++){const Mt=(Ge<<1)+Lt%2,Jt=(Ke<<1)+(Lt>>1),vi=Te.zoom+1;let zt=Te.aabb.quadrant(Lt);if(e.terrain){const Rt=new o.S(vi,Te.wrap,vi,Mt,Jt),_i=e.terrain.getMinMaxElevation(Rt),gn=(c=_i.minElevation)!==null&&c!==void 0?c:this.elevation,Ii=(p=_i.maxElevation)!==null&&p!==void 0?p:this.elevation;zt=new mr([zt.min[0],zt.min[1],gn],[zt.max[0],zt.max[1],Ii])}Ee.push({aabb:zt,zoom:vi,x:Mt,y:Jt,wrap:Te.wrap,fullyVisible:nt})}}return Le.sort((Te,Ge)=>Te.distanceSq-Ge.distanceSq).map(Te=>Te.tileID)}resize(e,c){this.width=e,this.height=c,this.pixelsToGLUnits=[2/e,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const c=o.ac(e.lat,-85.051129,_l);return new o.P(o.O(e.lng)*this.worldSize,o.Q(c)*this.worldSize)}unproject(e){return new o.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const c=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,e),b=e.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const A=p+c-b,P=Math.cos(this._pitch)*this.cameraToCenterDistance/A/o.b5(1,m.lat),z=this.scaleZoom(P/this.tileSize);this._elevation=b,this._center=m,this.zoom=z}setLocationAtPoint(e,c){const p=this.pointCoordinate(c),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(e),A=new o.Z(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,c){return c?this.coordinatePoint(this.locationCoordinate(e),c.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,c){return this.coordinateLocation(this.pointCoordinate(e,c))}locationCoordinate(e){return o.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,c){if(c){const ae=c.pointCoordinate(e);if(ae!=null)return ae}const p=[e.x,e.y,0,1],m=[e.x,e.y,1,1];o.af(p,p,this.pixelMatrixInverse),o.af(m,m,this.pixelMatrixInverse);const b=p[3],A=m[3],P=p[1]/b,z=m[1]/A,q=p[2]/b,X=m[2]/A,K=q===X?0:(0-q)/(X-q);return new o.Z(o.y.number(p[0]/b,m[0]/A,K)/this.worldSize,o.y.number(P,z,K)/this.worldSize)}coordinatePoint(e,c=0,p=this.pixelMatrix){const m=[e.x*this.worldSize,e.y*this.worldSize,c,1];return o.af(m,m,p),new o.P(m[0]/m[3],m[1]/m[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Ye().extend(this.pointLocation(new o.P(0,e))).extend(this.pointLocation(new o.P(this.width,e))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ye([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,_l])}calculateTileMatrix(e){const c=e.canonical,p=this.worldSize/this.zoomScale(c.z),m=c.x+Math.pow(2,c.z)*e.wrap,b=o.an(new Float64Array(16));return o.J(b,b,[m*p,c.y*p,0]),o.K(b,b,[p/o.X,p/o.X,1]),b}calculatePosMatrix(e,c=!1){const p=e.key,m=c?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=this.calculateTileMatrix(e);return o.L(b,c?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,b),m[p]=new Float32Array(b),m[p]}calculateFogMatrix(e){const c=e.key,p=this._fogMatrixCache;if(p[c])return p[c];const m=this.calculateTileMatrix(e);return o.L(m,this.fogMatrix,m),p[c]=new Float32Array(m),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,c){c=o.ac(+c,this.minZoom,this.maxZoom);const p={center:new o.N(e.lng,e.lat),zoom:c};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const Te=179.9999999999;m=[-Te,Te]}const b=this.tileSize*this.zoomScale(p.zoom);let A=0,P=b,z=0,q=b,X=0,K=0;const{x:ae,y:me}=this.size;if(this.latRange){const Te=this.latRange;A=o.Q(Te[1])*b,P=o.Q(Te[0])*b,P-A<me&&(X=me/(P-A))}m&&(z=o.b3(o.O(m[0])*b,0,b),q=o.b3(o.O(m[1])*b,0,b),q<z&&(q+=b),q-z<ae&&(K=ae/(q-z)));const{x:ve,y:Ee}=this.project.call({worldSize:b},e);let Le,ze;const Ne=Math.max(K||0,X||0);if(Ne){const Te=new o.P(K?(q+z)/2:ve,X?(P+A)/2:Ee);return p.center=this.unproject.call({worldSize:b},Te).wrap(),p.zoom+=this.scaleZoom(Ne),p}if(this.latRange){const Te=me/2;Ee-Te<A&&(ze=A+Te),Ee+Te>P&&(ze=P-Te)}if(m){const Te=(z+q)/2;let Ge=ve;this._renderWorldCopies&&(Ge=o.b3(ve,Te-b/2,Te+b/2));const Ke=ae/2;Ge-Ke<z&&(Le=z+Ke),Ge+Ke>q&&(Le=q-Ke)}if(Le!==void 0||ze!==void 0){const Te=new o.P(Le??ve,ze??Ee);p.center=this.unproject.call({worldSize:b},Te).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:c,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=c,this.zoom=p,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,c=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b5(1,this.center.lat)*this.worldSize;let m=o.an(new Float64Array(16));o.K(m,m,[this.width/2,-this.height/2,1]),o.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=o.an(new Float64Array(16)),o.K(m,m,[1,-1,1]),o.J(m,m,[-1,-1,0]),o.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),A=Math.min(this.elevation,this.minElevationForCurrentTile),P=b-A*this._pixelPerMeter/Math.cos(this._pitch),z=A<0?P:b,q=Math.PI/2+this._pitch,X=this._fov*(.5+e.y/this.height),K=Math.sin(X)*z/Math.sin(o.ac(Math.PI-q-X,.01,Math.PI-.01)),ae=this.getHorizon(),me=2*Math.atan(ae/this.cameraToCenterDistance)*(.5+e.y/(2*ae)),ve=Math.sin(me)*z/Math.sin(o.ac(Math.PI-q-me,.01,Math.PI-.01)),Ee=Math.min(K,ve);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Ee+z),this.nearZ=this.height/50,m=new Float64Array(16),o.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-e.x/this.width,m[9]=2*e.y/this.height,this.projectionMatrix=o.ae(m),o.K(m,m,[1,-1,1]),o.J(m,m,[0,0,-this.cameraToCenterDistance]),o.b7(m,m,this._pitch),o.ad(m,m,this.angle),o.J(m,m,[-c,-p,0]),this.mercatorMatrix=o.K([],m,[this.worldSize,this.worldSize,this.worldSize]),o.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.L(new Float64Array(16),this.labelPlaneMatrix,m),o.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=o.as([],m),this.fogMatrix=new Float64Array(16),o.b6(this.fogMatrix,this._fov,this.width/this.height,b,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,o.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),o.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b7(this.fogMatrix,this.fogMatrix,this._pitch),o.ad(this.fogMatrix,this.fogMatrix,this.angle),o.J(this.fogMatrix,this.fogMatrix,[-c,-p,0]),o.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),o.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=o.L(new Float64Array(16),this.labelPlaneMatrix,m);const Le=this.width%2/2,ze=this.height%2/2,Ne=Math.cos(this.angle),Te=Math.sin(this.angle),Ge=c-Math.round(c)+Ne*Le+Te*ze,Ke=p-Math.round(p)+Ne*ze+Te*Le,nt=new Float64Array(m);if(o.J(nt,nt,[Ge>.5?Ge-1:Ge,Ke>.5?Ke-1:Ke,0]),this.alignedModelViewProjectionMatrix=nt,m=o.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new o.P(0,0)),c=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.af(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,e))}getCameraQueryGeometry(e){const c=this.getCameraPoint();if(e.length===1)return[e[0],c];{let p=c.x,m=c.y,b=c.x,A=c.y;for(const P of e)p=Math.min(p,P.x),m=Math.min(m,P.y),b=Math.max(b,P.x),A=Math.max(A,P.y);return[new o.P(p,m),new o.P(b,m),new o.P(b,A),new o.P(p,A),new o.P(p,m)]}}lngLatToCameraDepth(e,c){const p=this.locationCoordinate(e),m=[p.x*this.worldSize,p.y*this.worldSize,c,1];return o.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function ta(v,e){let c,p=!1,m=null,b=null;const A=()=>{m=null,p&&(v.apply(b,c),m=setTimeout(A,e),p=!1)};return(...P)=>(p=!0,b=this,c=P,m||A(),m)}class Pa{constructor(e){this._getCurrentHash=()=>{const c=window.location.hash.replace("#","");if(this._hashName){let p;return c.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return c.split("/")},this._onHashChange=()=>{const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const c=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,c)},this._removeHash=()=>{const c=this._getCurrentHash();if(c.length===0)return;const p=c.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let A=window.location.href.replace(/(#.+)?$/,b);A=A.replace("&&","&"),window.history.replaceState(window.history.state,null,A)},this._updateHash=ta(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const c=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),A=Math.round(c.lng*b)/b,P=Math.round(c.lat*b)/b,z=this._map.getBearing(),q=this._map.getPitch();let X="";if(X+=e?`/${A}/${P}/${p}`:`${p}/${P}/${A}`,(z||q)&&(X+="/"+Math.round(10*z)/10),q&&(X+=`/${Math.round(q)}`),this._hashName){const K=this._hashName;let ae=!1;const me=window.location.hash.slice(1).split("&").map(ve=>{const Ee=ve.split("=")[0];return Ee===K?(ae=!0,`${Ee}=${X}`):ve}).filter(ve=>ve);return ae||me.push(`${K}=${X}`),`#${me.join("&")}`}return`#${X}`}}const La={linearity:.3,easing:o.b8(0,0,.3,1)},yl=o.e({deceleration:2500,maxSpeed:1400},La),fu=o.e({deceleration:20,maxSpeed:1400},La),bl=o.e({deceleration:1e3,maxSpeed:360},La),ro=o.e({deceleration:1e3,maxSpeed:90},La);class Co{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,c=y.now();for(;e.length>0&&c-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(c.pan.mag()){const b=na(c.pan.mag(),p,o.e({},yl,e||{}));m.offset=c.pan.mult(b.amount/c.pan.mag()),m.center=this._map.transform.center,ia(m,b)}if(c.zoom){const b=na(c.zoom,p,fu);m.zoom=this._map.transform.zoom+b.amount,ia(m,b)}if(c.bearing){const b=na(c.bearing,p,bl);m.bearing=this._map.transform.bearing+o.ac(b.amount,-179,179),ia(m,b)}if(c.pitch){const b=na(c.pitch,p,ro);m.pitch=this._map.transform.pitch+b.amount,ia(m,b)}if(m.zoom||m.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),o.e(m,{noMoveStart:!0})}}function ia(v,e){(!v.duration||v.duration<e.duration)&&(v.duration=e.duration,v.easing=e.easing)}function na(v,e,c){const{maxSpeed:p,linearity:m,deceleration:b}=c,A=o.ac(v*m/(e/1e3),-p,p),P=Math.abs(A)/(b*m);return{easing:c.easing,duration:1e3*P,amount:A*(P/2)}}class Pn extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,p,m={}){const b=k.mousePos(c.getCanvas(),p),A=c.unproject(b);super(e,o.e({point:b,lngLat:A,originalEvent:p},m)),this._defaultPrevented=!1,this.target=c}}class Be extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,p){const m=e==="touchend"?p.changedTouches:p.touches,b=k.touchPos(c.getCanvasContainer(),m),A=b.map(z=>c.unproject(z)),P=b.reduce((z,q,X,K)=>z.add(q.div(K.length)),new o.P(0,0));super(e,{points:b,point:P,lngLats:A,lngLat:c.unproject(P),originalEvent:p}),this._defaultPrevented=!1}}class O extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,c,p){super(e,{originalEvent:p}),this._defaultPrevented=!1}}class se{constructor(e,c){this._map=e,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new O(e.type,this._map,e))}mousedown(e,c){return this._mousedownPos=c,this._firePreventable(new Pn(e.type,this._map,e))}mouseup(e){this._map.fire(new Pn(e.type,this._map,e))}click(e,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new Pn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Pn(e.type,this._map,e))}mouseover(e){this._map.fire(new Pn(e.type,this._map,e))}mouseout(e){this._map.fire(new Pn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Be(e.type,this._map,e))}touchmove(e){this._map.fire(new Be(e.type,this._map,e))}touchend(e){this._map.fire(new Be(e.type,this._map,e))}touchcancel(e){this._map.fire(new Be(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oe{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Pn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Pn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ft{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(o.P.convert(e),this._map.terrain)}}class It{constructor(e,c){this._map=e,this._tr=new ft(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,c){this.isEnabled()&&e.shiftKey&&e.button===0&&(k.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(e,c){if(!this._active)return;const p=c;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=k.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const b=Math.min(m.x,p.x),A=Math.max(m.x,p.x),P=Math.min(m.y,p.y),z=Math.max(m.y,p.y);k.setTransform(this._box,`translate(${b}px,${P}px)`),this._box.style.width=A-b+"px",this._box.style.height=z-P+"px"}mouseupWindow(e,c){if(!this._active||e.button!==0)return;const p=this._startPos,m=c;if(this.reset(),k.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:e})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,c){return this._map.fire(new o.k(e,{originalEvent:c}))}}function Xt(v,e){if(v.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${e.length}`);const c={};for(let p=0;p<v.length;p++)c[v[p].identifier]=e[p];return c}class Wi{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new o.P(0,0);for(const A of m)b._add(A);return b.div(m.length)}(c),this.touches=Xt(p,c)))}touchmove(e,c,p){if(this.aborted||!this.centroid)return;const m=Xt(p,c);for(const b in this.touches){const A=m[b];(!A||A.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(e,c,p){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class on{constructor(e){this.singleTap=new Wi(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,c,p){this.singleTap.touchstart(e,c,p)}touchmove(e,c,p){this.singleTap.touchmove(e,c,p)}touchend(e,c,p){const m=this.singleTap.touchend(e,c,p);if(m){const b=e.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(m)<30;if(b&&A||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class On{constructor(e){this._tr=new ft(e),this._zoomIn=new on({numTouches:1,numTaps:2}),this._zoomOut=new on({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,c,p){this._zoomIn.touchstart(e,c,p),this._zoomOut.touchstart(e,c,p)}touchmove(e,c,p){this._zoomIn.touchmove(e,c,p),this._zoomOut.touchmove(e,c,p)}touchend(e,c,p){const m=this._zoomIn.touchend(e,c,p),b=this._zoomOut.touchend(e,c,p),A=this._tr;return m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(m)},{originalEvent:e})}):b?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(b)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class In{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const c=this._moveFunction(...e);if(c.bearingDelta||c.pitchDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(e,c){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=c.length?c[0]:c,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,c){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const m=c.length?c[0]:c;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&k.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gr={0:1,2:2};class Er{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const c=k.mouseButton(e);this._eventButton=c}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(c,p){const m=gr[p];return c.buttons===void 0||(c.buttons&m)!==m}(e,this._eventButton)}isValidEndEvent(e){return k.mouseButton(e)===this._eventButton}}class jr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const $r=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=e=>{e.preventDefault()}},_r=({enable:v,clickTolerance:e,bearingDegreesPerPixelMoved:c=.8})=>{const p=new Er({checkCorrectEvent:m=>k.mouseButton(m)===0&&m.ctrlKey||k.mouseButton(m)===2});return new In({clickTolerance:e,move:(m,b)=>({bearingDelta:(b.x-m.x)*c}),moveStateManager:p,enable:v,assignEvents:$r})},so=({enable:v,clickTolerance:e,pitchDegreesPerPixelMoved:c=-.5})=>{const p=new Er({checkCorrectEvent:m=>k.mouseButton(m)===0&&m.ctrlKey||k.mouseButton(m)===2});return new In({clickTolerance:e,move:(m,b)=>({pitchDelta:(b.y-m.y)*c}),moveStateManager:p,enable:v,assignEvents:$r})};class es{constructor(e,c){this._clickTolerance=e.clickTolerance||1,this._map=c,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,c,p){return this._calculateTransform(e,c,p)}touchmove(e,c,p){if(this._active){if(!this._shouldBePrevented(p.length))return e.preventDefault(),this._calculateTransform(e,c,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,c,p){this._calculateTransform(e,c,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,c,p){p.length>0&&(this._active=!0);const m=Xt(p,c),b=new o.P(0,0),A=new o.P(0,0);let P=0;for(const q in m){const X=m[q],K=this._touches[q];K&&(b._add(X),A._add(X.sub(K)),P++,m[q]=X)}if(this._touches=m,this._shouldBePrevented(P)||!A.mag())return;const z=A.div(P);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(P),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class za{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(e,c,p){if(!this._firstTwoTouches)return;e.preventDefault();const[m,b]=this._firstTwoTouches,A=Ur(p,c,m),P=Ur(p,c,b);if(!A||!P)return;const z=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],z,e)}touchend(e,c,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,A=Ur(p,c,m),P=Ur(p,c,b);A&&P||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ur(v,e,c){for(let p=0;p<v.length;p++)if(v[p].identifier===c)return e[p]}function vl(v,e){return Math.log(v/e)/Math.LN2}class du extends za{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,c){const p=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(vl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vl(this._distance,p),pinchAround:c}}}function pu(v,e){return 180*v.angleWith(e)/Math.PI}class mu extends za{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,c,p){const m=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pu(this._vector,m),pinchAround:c}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const c=25/(Math.PI*this._minDiameter)*360,p=pu(e,this._startVector);return Math.abs(p)<c}}function cc(v){return Math.abs(v.y)>Math.abs(v.x)}class wl extends za{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,c,p){super.touchstart(e,c,p),this._currentTouchCount=p.length}_start(e){this._lastPoints=e,cc(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,c,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=e[0].sub(this._lastPoints[0]),b=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(e,c,p){if(this._valid!==void 0)return this._valid;const m=e.mag()>=2,b=c.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=e.y>0==c.y>0;return cc(e)&&cc(c)&&A}}const gh={panStep:100,bearingStep:15,pitchStep:10};class ts{constructor(e){this._tr=new ft(e);const c=gh;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let c=0,p=0,m=0,b=0,A=0;switch(e.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:e.shiftKey?p=-1:(e.preventDefault(),b=-1);break;case 39:e.shiftKey?p=1:(e.preventDefault(),b=1);break;case 38:e.shiftKey?m=1:(e.preventDefault(),A=-1);break;case 40:e.shiftKey?m=-1:(e.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:P=>{const z=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Ds,zoom:c?Math.round(z.zoom)+c*(e.shiftKey?2:1):z.zoom,bearing:z.bearing+p*this._bearingStep,pitch:z.pitch+m*this._pitchStep,offset:[-b*this._panStep,-A*this._panStep],center:z.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ds(v){return v*(2-v)}const gu=4.000244140625;class ps{constructor(e,c){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=e,this._tr=new ft(e),this._triggerRenderFrame=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let c=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const p=y.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%gu==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(m*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),e.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=e,this._delta-=c,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=k.mousePos(this._map.getCanvas(),e),p=this._tr;this._around=c.y>p.transform.height/2-p.transform.getHorizon()?o.N.convert(this._aroundCenter?p.center:p.unproject(c)):o.N.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>gu?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&q!==0&&(q=1/q);const X=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(X*q))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,p=this._startZoom,m=this._easing;let b,A=!1;const P=y.now()-this._lastWheelEventTime;if(this._type==="wheel"&&p&&m&&P){const z=Math.min(P/200,1),q=m(z);b=o.y.number(p,c,q),z<1?this._frameId||(this._frameId=!0):A=!0}else b=c,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:b-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let c=o.b9;if(this._prevEase){const p=this._prevEase,m=(y.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),A=.27/Math.sqrt(b*b+1e-4)*.01,P=Math.sqrt(.0729-A*A);c=o.b8(A,P,.25,1)}return this._prevEase={start:y.now(),duration:e,easing:c},c}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ra{constructor(e,c){this._clickZoom=e,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tf{constructor(e){this._tr=new ft(e),this.reset()}reset(){this._active=!1}dblclick(e,c){return e.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(c)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kf{constructor(){this._tap=new on({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,c,p){if(!this._swipePoint)if(this._tapTime){const m=c[0],b=e.timeStamp-this._tapTime<500,A=this._tapPoint.dist(m)<30;b&&A?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(e,c,p)}touchmove(e,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=c[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,e.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(e,c,p)}touchend(e,c,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(e,c,p);m&&(this._tapTime=e.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _h{constructor(e,c,p){this._el=e,this._mousePan=c,this._touchPan=p}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class yh{constructor(e,c,p){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _u{constructor(e,c,p,m){this._el=e,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Oa{constructor(e,c){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=c,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=k.create("div","maplibregl-cooperative-gesture-screen",e);let c=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(c=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=c,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(k.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,c){this._enabled&&(this._map.fire(new o.k("cooperativegestureprevented",{gestureType:e,originalEvent:c})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const is=v=>v.zoom||v.drag||v.pitch||v.rotate;class Ut extends o.k{}function uc(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class yu{constructor(e,c){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=m.type==="renderFrame"?void 0:m,P={needsRenderFrame:!1},z={},q={},X=m.touches,K=X?this._getMapTouches(X):void 0,ae=K?k.touchPos(this._map.getCanvas(),K):k.mousePos(this._map.getCanvas(),m);for(const{handlerName:Ee,handler:Le,allowed:ze}of this._handlers){if(!Le.isEnabled())continue;let Ne;this._blockedByActive(q,ze,Ee)?Le.reset():Le[b||m.type]&&(Ne=Le[b||m.type](m,ae,K),this.mergeHandlerResult(P,z,Ne,Ee,A),Ne&&Ne.needsRenderFrame&&this._triggerRenderFrame()),(Ne||Le.isActive())&&(q[Ee]=Le)}const me={};for(const Ee in this._previousActiveHandlers)q[Ee]||(me[Ee]=A);this._previousActiveHandlers=q,(Object.keys(me).length||uc(P))&&(this._changes.push([P,z,me]),this._triggerRenderFrame()),(Object.keys(q).length||uc(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ve}=P;ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ve(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Co(e),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,A]of this._listeners)k.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[e,c,p]of this._listeners)k.removeEventListener(e,c,e===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(e){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new se(c,e));const m=c.boxZoom=new It(c,e);this._add("boxZoom",m),e.interactive&&e.boxZoom&&m.enable();const b=c.cooperativeGestures=new Oa(c,e.cooperativeGestures);this._add("cooperativeGestures",b),e.cooperativeGestures&&b.enable();const A=new On(c),P=new Tf(c);c.doubleClickZoom=new ra(P,A),this._add("tapZoom",A),this._add("clickZoom",P),e.interactive&&e.doubleClickZoom&&c.doubleClickZoom.enable();const z=new kf;this._add("tapDragZoom",z);const q=c.touchPitch=new wl(c);this._add("touchPitch",q),e.interactive&&e.touchPitch&&c.touchPitch.enable(e.touchPitch);const X=_r(e),K=so(e);c.dragRotate=new yh(e,X,K),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",K,["mouseRotate"]),e.interactive&&e.dragRotate&&c.dragRotate.enable();const ae=(({enable:Ne,clickTolerance:Te})=>{const Ge=new Er({checkCorrectEvent:Ke=>k.mouseButton(Ke)===0&&!Ke.ctrlKey});return new In({clickTolerance:Te,move:(Ke,nt)=>({around:nt,panDelta:nt.sub(Ke)}),activateOnStart:!0,moveStateManager:Ge,enable:Ne,assignEvents:$r})})(e),me=new es(e,c);c.dragPan=new _h(p,ae,me),this._add("mousePan",ae),this._add("touchPan",me,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&c.dragPan.enable(e.dragPan);const ve=new mu,Ee=new du;c.touchZoomRotate=new _u(p,Ee,ve,z),this._add("touchRotate",ve,["touchPan","touchZoom"]),this._add("touchZoom",Ee,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&c.touchZoomRotate.enable(e.touchZoomRotate);const Le=c.scrollZoom=new ps(c,()=>this._triggerRenderFrame());this._add("scrollZoom",Le,["mousePan"]),e.interactive&&e.scrollZoom&&c.scrollZoom.enable(e.scrollZoom);const ze=c.keyboard=new ts(c);this._add("keyboard",ze),e.interactive&&e.keyboard&&c.keyboard.enable(),this._add("blockableMapEvent",new Oe(c))}_add(e,c,p){this._handlers.push({handlerName:e,handler:c,allowed:p}),this._handlersById[e]=c}stop(e){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!is(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,c,p){for(const m in e)if(m!==p&&(!c||c.indexOf(m)<0))return!0;return!1}_getMapTouches(e){const c=[];for(const p of e)this._el.contains(p.target)&&c.push(p);return c}mergeHandlerResult(e,c,p,m,b){if(!p)return;o.e(e,p);const A={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(c.zoom=A),p.panDelta!==void 0&&(c.drag=A),p.pitchDelta!==void 0&&(c.pitch=A),p.bearingDelta!==void 0&&(c.rotate=A)}_applyChanges(){const e={},c={},p={};for(const[m,b,A]of this._changes)m.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(m.panDelta)),m.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(e.around=m.around),m.pinchAround!==void 0&&(e.pinchAround=m.pinchAround),m.noInertia&&(e.noInertia=m.noInertia),o.e(c,b),o.e(p,A);this._updateMapTransform(e,c,p),this._changes=[]}_updateMapTransform(e,c,p){const m=this._map,b=m._getTransformForUpdate(),A=m.terrain;if(!(uc(e)||A&&this._terrainMovement))return this._fireEvents(c,p,!0);let{panDelta:P,zoomDelta:z,bearingDelta:q,pitchDelta:X,around:K,pinchAround:ae}=e;ae!==void 0&&(K=ae),m._stop(!0),K=K||m.transform.centerPoint;const me=b.pointLocation(P?K.sub(P):K);q&&(b.bearing+=q),X&&(b.pitch+=X),z&&(b.zoom+=z),A?this._terrainMovement||!c.drag&&!c.zoom?c.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(P)):b.setLocationAtPoint(me,K):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(me,K)):b.setLocationAtPoint(me,K),m._applyUpdatedTransform(b),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(c,p,!0)}_fireEvents(e,c,p){const m=is(this._eventsInProgress),b=is(e),A={};for(const K in e){const{originalEvent:ae}=e[K];this._eventsInProgress[K]||(A[`${K}start`]=ae),this._eventsInProgress[K]=e[K]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const K in A)this._fireEvent(K,A[K]);b&&this._fireEvent("move",b.originalEvent);for(const K in e){const{originalEvent:ae}=e[K];this._fireEvent(K,ae)}const P={};let z;for(const K in this._eventsInProgress){const{handlerName:ae,originalEvent:me}=this._eventsInProgress[K];this._handlersById[ae].isActive()||(delete this._eventsInProgress[K],z=c[ae]||me,P[`${K}end`]=z)}for(const K in P)this._fireEvent(K,P[K]);const q=is(this._eventsInProgress),X=(m||b)&&!q;if(X&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const K=this._map._getTransformForUpdate();K.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(K)}if(p&&X){this._updatingCamera=!0;const K=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;!K||!K.essential&&y.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:z})),ae(this._map.getBearing())&&this._map.resetNorth()):(ae(K.bearing||this._map.getBearing())&&(K.bearing=0),K.freezeElevation=!0,this._map.easeTo(K,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(e,c){this._map.fire(new o.k(e,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Ut("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class bh extends o.E{constructor(e,c){super(),this._renderFrameCallback=()=>{const p=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,c){return this.jumpTo({center:e},c)}panBy(e,c,p){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},c),p)}panTo(e,c,p){return this.easeTo(o.e({center:e},c),p)}getZoom(){return this.transform.zoom}setZoom(e,c){return this.jumpTo({zoom:e},c),this}zoomTo(e,c,p){return this.easeTo(o.e({zoom:e},c),p)}zoomIn(e,c){return this.zoomTo(this.getZoom()+1,e,c),this}zoomOut(e,c){return this.zoomTo(this.getZoom()-1,e,c),this}getBearing(){return this.transform.bearing}setBearing(e,c){return this.jumpTo({bearing:e},c),this}getPadding(){return this.transform.padding}setPadding(e,c){return this.jumpTo({padding:e},c),this}rotateTo(e,c,p){return this.easeTo(o.e({bearing:e},c),p)}resetNorth(e,c){return this.rotateTo(0,o.e({duration:1e3},e),c),this}resetNorthPitch(e,c){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},e),c),this}snapToNorth(e,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,c):this}getPitch(){return this.transform.pitch}setPitch(e,c){return this.jumpTo({pitch:e},c),this}cameraForBounds(e,c){e=Ye.convert(e).adjustAntiMeridian();const p=c&&c.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),p,c)}_cameraForBoxAndBearing(e,c,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=o.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Lt=m.padding;m.padding={top:Lt,bottom:Lt,right:Lt,left:Lt}}m.padding=o.e(b,m.padding);const A=this.transform,P=A.padding,z=new Ye(e,c),q=A.project(z.getNorthWest()),X=A.project(z.getNorthEast()),K=A.project(z.getSouthEast()),ae=A.project(z.getSouthWest()),me=o.ba(-p),ve=q.rotate(me),Ee=X.rotate(me),Le=K.rotate(me),ze=ae.rotate(me),Ne=new o.P(Math.max(ve.x,Ee.x,ze.x,Le.x),Math.max(ve.y,Ee.y,ze.y,Le.y)),Te=new o.P(Math.min(ve.x,Ee.x,ze.x,Le.x),Math.min(ve.y,Ee.y,ze.y,Le.y)),Ge=Ne.sub(Te),Ke=(A.width-(P.left+P.right+m.padding.left+m.padding.right))/Ge.x,nt=(A.height-(P.top+P.bottom+m.padding.top+m.padding.bottom))/Ge.y;if(nt<0||Ke<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const bt=Math.min(A.scaleZoom(A.scale*Math.min(Ke,nt)),m.maxZoom),Ct=o.P.convert(m.offset),Dt=new o.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(o.ba(p)),Nt=Ct.add(Dt).mult(A.scale/A.zoomScale(bt));return{center:A.unproject(q.add(K).div(2).sub(Nt)),zoom:bt,bearing:p}}fitBounds(e,c,p){return this._fitInternal(this.cameraForBounds(e,c),c,p)}fitScreenCoordinates(e,c,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(e)),this.transform.pointLocation(o.P.convert(c)),p,m),m,b)}_fitInternal(e,c,p){return e?(delete(c=o.e(e,c)).padding,c.linear?this.easeTo(c,p):this.flyTo(c,p)):this}jumpTo(e,c){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,A=!1;return"zoom"in e&&p.zoom!==+e.zoom&&(m=!0,p.zoom=+e.zoom),e.center!==void 0&&(p.center=o.N.convert(e.center)),"bearing"in e&&p.bearing!==+e.bearing&&(b=!0,p.bearing=+e.bearing),"pitch"in e&&p.pitch!==+e.pitch&&(A=!0,p.pitch=+e.pitch),e.padding==null||p.isPaddingEqual(e.padding)||(p.padding=e.padding),this._applyUpdatedTransform(p),this.fire(new o.k("movestart",c)).fire(new o.k("move",c)),m&&this.fire(new o.k("zoomstart",c)).fire(new o.k("zoom",c)).fire(new o.k("zoomend",c)),b&&this.fire(new o.k("rotatestart",c)).fire(new o.k("rotate",c)).fire(new o.k("rotateend",c)),A&&this.fire(new o.k("pitchstart",c)).fire(new o.k("pitch",c)).fire(new o.k("pitchend",c)),this.fire(new o.k("moveend",c))}calculateCameraOptionsFromTo(e,c,p,m=0){const b=o.Z.fromLngLat(e,c),A=o.Z.fromLngLat(p,m),P=A.x-b.x,z=A.y-b.y,q=A.z-b.z,X=Math.hypot(P,z,q);if(X===0)throw new Error("Can't calculate camera options with same From and To");const K=Math.hypot(P,z),ae=this.transform.scaleZoom(this.transform.cameraToCenterDistance/X/this.transform.tileSize),me=180*Math.atan2(P,-z)/Math.PI;let ve=180*Math.acos(K/X)/Math.PI;return ve=q<0?90-ve:90+ve,{center:A.toLngLat(),zoom:ae,pitch:ve,bearing:me}}easeTo(e,c){var p;this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.b9},e)).animate===!1||!e.essential&&y.prefersReducedMotion)&&(e.duration=0);const m=this._getTransformForUpdate(),b=m.zoom,A=m.bearing,P=m.pitch,z=m.padding,q="bearing"in e?this._normalizeBearing(e.bearing,A):A,X="pitch"in e?+e.pitch:P,K="padding"in e?e.padding:m.padding,ae=o.P.convert(e.offset);let me=m.centerPoint.add(ae);const ve=m.pointLocation(me),{center:Ee,zoom:Le}=m.getConstrained(o.N.convert(e.center||ve),(p=e.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(Ee,m);const ze=m.project(ve),Ne=m.project(Ee).sub(ze),Te=m.zoomScale(Le-b);let Ge,Ke;e.around&&(Ge=o.N.convert(e.around),Ke=m.locationPoint(Ge));const nt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Le!==b,this._rotating=this._rotating||A!==q,this._pitching=this._pitching||X!==P,this._padding=!m.isPaddingEqual(K),this._easeId=e.easeId,this._prepareEase(c,e.noMoveStart,nt),this.terrain&&this._prepareElevation(Ee),this._ease(bt=>{if(this._zooming&&(m.zoom=o.y.number(b,Le,bt)),this._rotating&&(m.bearing=o.y.number(A,q,bt)),this._pitching&&(m.pitch=o.y.number(P,X,bt)),this._padding&&(m.interpolatePadding(z,K,bt),me=m.centerPoint.add(ae)),this.terrain&&!e.freezeElevation&&this._updateElevation(bt),Ge)m.setLocationAtPoint(Ge,Ke);else{const Ct=m.zoomScale(m.zoom-b),Dt=Le>b?Math.min(2,Te):Math.max(.5,Te),Nt=Math.pow(Dt,1-bt),Lt=m.unproject(ze.add(Ne.mult(bt*Nt)).mult(Ct));m.setLocationAtPoint(m.renderWorldCopies?Lt.wrap():Lt,me)}this._applyUpdatedTransform(m),this._fireMoveEvents(c)},bt=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(c,bt)},e),this}_prepareEase(e,c,p={}){this._moving=!0,c||p.moving||this.fire(new o.k("movestart",e)),this._zooming&&!p.zooming&&this.fire(new o.k("zoomstart",e)),this._rotating&&!p.rotating&&this.fire(new o.k("rotatestart",e)),this._pitching&&!p.pitching&&this.fire(new o.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const c=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&c!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(p-(c-(p*e+this._elevationStart))/(1-e)),this._elevationTarget=c}this.transform.elevation=o.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const c=e.getCameraPosition(),p=this.terrain.getElevationForLngLatZoom(c.lngLat,e.zoom);if(c.altitude<p){const m=this.calculateCameraOptionsFromTo(c.lngLat,p,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const c=[];if(this.terrain&&c.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&c.push(m=>this.transformCameraUpdate(m)),!c.length)return;const p=e.clone();for(const m of c){const b=p.clone(),{center:A,zoom:P,pitch:z,bearing:q,elevation:X}=m(b);A&&(b.center=A),P!==void 0&&(b.zoom=P),z!==void 0&&(b.pitch=z),q!==void 0&&(b.bearing=q),X!==void 0&&(b.elevation=X),p.apply(b)}this.transform.apply(p)}_fireMoveEvents(e){this.fire(new o.k("move",e)),this._zooming&&this.fire(new o.k("zoom",e)),this._rotating&&this.fire(new o.k("rotate",e)),this._pitching&&this.fire(new o.k("pitch",e))}_afterEase(e,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.k("zoomend",e)),m&&this.fire(new o.k("rotateend",e)),b&&this.fire(new o.k("pitchend",e)),this.fire(new o.k("moveend",e))}flyTo(e,c){var p;if(!e.essential&&y.prefersReducedMotion){const Rt=o.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rt,c)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b9},e);const m=this._getTransformForUpdate(),b=m.zoom,A=m.bearing,P=m.pitch,z=m.padding,q="bearing"in e?this._normalizeBearing(e.bearing,A):A,X="pitch"in e?+e.pitch:P,K="padding"in e?e.padding:m.padding,ae=o.P.convert(e.offset);let me=m.centerPoint.add(ae);const ve=m.pointLocation(me),{center:Ee,zoom:Le}=m.getConstrained(o.N.convert(e.center||ve),(p=e.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(Ee,m);const ze=m.zoomScale(Le-b),Ne=m.project(ve),Te=m.project(Ee).sub(Ne);let Ge=e.curve;const Ke=Math.max(m.width,m.height),nt=Ke/ze,bt=Te.mag();if("minZoom"in e){const Rt=o.ac(Math.min(e.minZoom,b,Le),m.minZoom,m.maxZoom),_i=Ke/m.zoomScale(Rt-b);Ge=Math.sqrt(_i/bt*2)}const Ct=Ge*Ge;function Dt(Rt){const _i=(nt*nt-Ke*Ke+(Rt?-1:1)*Ct*Ct*bt*bt)/(2*(Rt?nt:Ke)*Ct*bt);return Math.log(Math.sqrt(_i*_i+1)-_i)}function Nt(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function Lt(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const Mt=Dt(!1);let Jt=function(Rt){return Lt(Mt)/Lt(Mt+Ge*Rt)},vi=function(Rt){return Ke*((Lt(Mt)*(Nt(_i=Mt+Ge*Rt)/Lt(_i))-Nt(Mt))/Ct)/bt;var _i},zt=(Dt(!0)-Mt)/Ge;if(Math.abs(bt)<1e-6||!isFinite(zt)){if(Math.abs(Ke-nt)<1e-6)return this.easeTo(e,c);const Rt=nt<Ke?-1:1;zt=Math.abs(Math.log(nt/Ke))/Ge,vi=()=>0,Jt=_i=>Math.exp(Rt*Ge*_i)}return e.duration="duration"in e?+e.duration:1e3*zt/("screenSpeed"in e?+e.screenSpeed/Ge:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=A!==q,this._pitching=X!==P,this._padding=!m.isPaddingEqual(K),this._prepareEase(c,!1),this.terrain&&this._prepareElevation(Ee),this._ease(Rt=>{const _i=Rt*zt,gn=1/Jt(_i);m.zoom=Rt===1?Le:b+m.scaleZoom(gn),this._rotating&&(m.bearing=o.y.number(A,q,Rt)),this._pitching&&(m.pitch=o.y.number(P,X,Rt)),this._padding&&(m.interpolatePadding(z,K,Rt),me=m.centerPoint.add(ae)),this.terrain&&!e.freezeElevation&&this._updateElevation(Rt);const Ii=Rt===1?Ee:m.unproject(Ne.add(Te.mult(vi(_i))).mult(gn));m.setLocationAtPoint(m.renderWorldCopies?Ii.wrap():Ii,me),this._applyUpdatedTransform(m),this._fireMoveEvents(c)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(c)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,c){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,c)}return e||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(e,c,p){p.animate===!1||p.duration===0?(e(1),c()):(this._easeStart=y.now(),this._easeOptions=p,this._onEaseFrame=e,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,c){e=o.b3(e,-180,180);const p=Math.abs(e-c);return Math.abs(e-360-c)<p&&(e-=360),Math.abs(e+360-c)<p&&(e+=360),e}_normalizeCenter(e,c){if(!c.renderWorldCopies||c.lngRange)return;const p=e.lng-c.center.lng;e.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Da={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Fa{constructor(e=Da){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=c=>{!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"&&c.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,c){const p=this._map._getUIString(`AttributionControl.${c}`);e.title=p,e.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const c=this._map.style.sourceCaches;for(const m in c){const b=c[m];if(b.used||b.usedForTerrain){const A=b.getSource();A.attribution&&e.indexOf(A.attribution)<0&&e.push(A.attribution)}}e=e.filter(m=>String(m).trim()),e.sort((m,b)=>m.length-b.length),e=e.filter((m,b)=>{for(let A=b+1;A<e.length;A++)if(e[A].indexOf(m)>=0)return!1;return!0});const p=e.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,e.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class bu{constructor(e={}){this._updateCompact=()=>{const c=this._container.children;if(c.length){const p=c[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl");const c=k.create("a","maplibregl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ji{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const c=++this._id;return this._queue.push({callback:e,id:c,cancelled:!1}),c}remove(e){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const m of p)if(m.id===e)return void(m.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var vu=o.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Cf extends o.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,c){this.sourceCache.update(e,c),this._renderableTilesKeys=[];const p={};for(const m of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:c}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),o.aP(m.posMatrix,0,o.X,0,o.X,0,1),this._tiles[m.key]=new Cn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(e){for(const c in this._tiles){const p=this._tiles[c];(!e||p.tileID.equals(e)||p.tileID.isChildOf(e)||e.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const c={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(e.canonical)){const b=e.clone();b.posMatrix=new Float64Array(16),o.aP(b.posMatrix,0,o.X,0,o.X,0,1),c[p]=b}else if(m.canonical.isChildOf(e.canonical)){const b=e.clone();b.posMatrix=new Float64Array(16);const A=m.canonical.z-e.canonical.z,P=m.canonical.x-(m.canonical.x>>A<<A),z=m.canonical.y-(m.canonical.y>>A<<A),q=o.X>>A;o.aP(b.posMatrix,0,q,0,q,0,1),o.J(b.posMatrix,b.posMatrix,[-P*q,-z*q,0]),c[p]=b}else if(e.canonical.isChildOf(m.canonical)){const b=e.clone();b.posMatrix=new Float64Array(16);const A=e.canonical.z-m.canonical.z,P=e.canonical.x-(e.canonical.x>>A<<A),z=e.canonical.y-(e.canonical.y>>A<<A),q=o.X>>A;o.aP(b.posMatrix,0,o.X,0,o.X,0,1),o.J(b.posMatrix,b.posMatrix,[P*q,z*q,0]),o.K(b.posMatrix,b.posMatrix,[1/2**A,1/2**A,0]),c[p]=b}}return c}getSourceTile(e,c){const p=this.sourceCache._source;let m=e.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!b||!b.dem)&&c)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(e.scaledTo(m--).key);return b}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(c=>c.timeAdded>=e)}}class wu{constructor(e,c,p){this.painter=e,this.sourceCache=new Cf(c),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,c,p,m=o.X){var b;if(!(c>=0&&c<m&&p>=0&&p<m))return 0;const A=this.getTerrainData(e),P=(b=A.tile)===null||b===void 0?void 0:b.dem;if(!P)return 0;const z=function(ve,Ee,Le){var ze=Ee[0],Ne=Ee[1];return ve[0]=Le[0]*ze+Le[4]*Ne+Le[12],ve[1]=Le[1]*ze+Le[5]*Ne+Le[13],ve}([],[c/m*o.X,p/m*o.X],A.u_terrain_matrix),q=[z[0]*P.dim,z[1]*P.dim],X=Math.floor(q[0]),K=Math.floor(q[1]),ae=q[0]-X,me=q[1]-K;return P.get(X,K)*(1-ae)*(1-me)+P.get(X+1,K)*ae*(1-me)+P.get(X,K+1)*(1-ae)*me+P.get(X+1,K+1)*ae*me}getElevationForLngLatZoom(e,c){if(!o.bb(c,e.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(e,c);return this.getElevation(p,m%o.X,b%o.X,o.X)}getElevation(e,c,p,m=o.X){return this.getDEMElevation(e,c,p,m)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const m=this.painter.context,b=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new R(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new R(m,new o.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const c=this.sourceCache.getSourceTile(e,!0);if(c&&c.dem&&(!c.demTexture||c.needsTerrainPrepare)){const m=this.painter.context;c.demTexture=this.painter.getTileTexture(c.dem.stride),c.demTexture?c.demTexture.update(c.dem.getPixels(),{premultiply:!1}):c.demTexture=new R(m,c.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),c.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),c.needsTerrainPrepare=!1}const p=c&&c+c.tileID.key+e.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=e.canonical.z-c.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=m?b=e.canonical.z-m:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=e.canonical.x-(e.canonical.x>>b<<b),P=e.canonical.y-(e.canonical.y>>b<<b),z=o.bc(new Float64Array(16),[1/(o.X<<b),1/(o.X<<b),0]);o.J(z,z,[A*o.X,P*o.X,0]),this._demMatrixCache[e.key]={matrix:z,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:c&&c.dem&&c.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:c&&c.dem&&c.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(c&&c.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:c}}getFramebuffer(e){const c=this.painter,p=c.width/devicePixelRatio,m=c.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new R(c.context,{width:p,height:m,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new R(c.context,{width:p,height:m,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=c.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(c.context.createRenderbuffer(c.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const c=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,A=0;b<this._coordsTextureSize;b++)for(let P=0;P<this._coordsTextureSize;P++,A+=4)c[A+0]=255&P,c[A+1]=255&b,c[A+2]=P>>8<<4|b>>8,c[A+3]=0;const p=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(c.buffer)),m=new R(e,p,e.gl.RGBA,{premultiply:!1});return m.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const c=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),A=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),P=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,P-A-1,1,1,m.RGBA,m.UNSIGNED_BYTE,c),p.bindFramebuffer.set(null);const z=c[0]+(c[2]>>4<<8),q=c[1]+((15&c[2])<<8),X=this.coordsIndex[255-c[3]],K=X&&this.sourceCache.getTileByID(X);if(!K)return null;const ae=this._coordsTextureSize,me=(1<<K.tileID.canonical.z)*ae;return new o.Z((K.tileID.canonical.x*ae+z)/me+K.tileID.wrap,(K.tileID.canonical.y*ae+q)/me,this.getElevation(K.tileID,z,q,ae))}depthAtPoint(e){const c=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,c),p.bindFramebuffer.set(null),(c[0]/16777216+c[1]/65536+c[2]/256+c[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,c=new o.bd,p=new o.aY,m=this.meshSize,b=o.X/m,A=m*m;for(let K=0;K<=m;K++)for(let ae=0;ae<=m;ae++)c.emplaceBack(ae*b,K*b,0);for(let K=0;K<A;K+=m+1)for(let ae=0;ae<m;ae++)p.emplaceBack(ae+K,m+ae+K+1,m+ae+K+2),p.emplaceBack(ae+K,m+ae+K+2,ae+K+1);const P=c.length,z=P+2*(m+1);for(const K of[0,1])for(let ae=0;ae<=m;ae++)for(const me of[0,1])c.emplaceBack(ae*b,K*o.X,me);for(let K=0;K<2*m;K+=2)p.emplaceBack(z+K,z+K+1,z+K+3),p.emplaceBack(z+K,z+K+3,z+K+2),p.emplaceBack(P+K,P+K+3,P+K+1),p.emplaceBack(P+K,P+K+2,P+K+3);const q=c.length,X=q+2*(m+1);for(const K of[0,1])for(let ae=0;ae<=m;ae++)for(const me of[0,1])c.emplaceBack(K*o.X,ae*b,me);for(let K=0;K<2*m;K+=2)p.emplaceBack(q+K,q+K+1,q+K+3),p.emplaceBack(q+K,q+K+3,q+K+2),p.emplaceBack(X+K,X+K+3,X+K+1),p.emplaceBack(X+K,X+K+2,X+K+3);return this._mesh=new So(e.createVertexBuffer(c,vu.members),e.createIndexBuffer(p),o.a0.simpleSegment(0,0,c.length,p.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*o.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,c){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(e,c);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(e){const c=this.getTerrainData(e).tile,p={minElevation:null,maxElevation:null};return c&&c.dem&&(p.minElevation=c.dem.min*this.exaggeration,p.maxElevation=c.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(e,c){const p=o.Z.fromLngLat(e.wrap()),m=(1<<c)*o.X,b=p.x*m,A=p.y*m,P=Math.floor(b/o.X),z=Math.floor(A/o.X);return{tileID:new o.S(c,0,c,P,z),mercatorX:b,mercatorY:A}}}class Ef{constructor(e,c,p){this._context=e,this._size=c,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const c=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new R(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),c.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),c.colorAttachment.set(p.texture),{id:e,fbo:c,texture:p,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(c=>e.id!==c),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const c of this._recentlyUsed)if(!this._objects[c].inUse)return this._objects[c];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Ra={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class vh{constructor(e,c){this.painter=e,this.terrain=c,this.pool=new Ef(e.context,30,c.sourceCache.tileSize*c.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,c){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(p=>!e._layers[p].isHidden(c)),this._coordsDescendingInv={};for(const p in e.sourceCaches){this._coordsDescendingInv[p]={};const m=e.sourceCaches[p].getVisibleCoordinates();for(const b of m){const A=this.terrain.sourceCache.getTerrainCoords(b);for(const P in A)this._coordsDescendingInv[p][P]||(this._coordsDescendingInv[p][P]=[]),this._coordsDescendingInv[p][P].push(A[P])}}this._coordsDescendingInvStr={};for(const p of e._order){const m=e._layers[p],b=m.source;if(Ra[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const A in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][A]=this._coordsDescendingInv[b][A].map(P=>P.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const c=e.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ra[c]&&(this._prevType&&Ra[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!m))return!0;if(Ra[this._prevType]||Ra[c]&&m){this._prevType=c;const b=this._stacks.length-1,A=this._stacks[b]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(gl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[b]){const q=this.pool.getObjectForId(P.rtt[b].id);if(q.stamp===P.rtt[b].stamp){this.pool.useObject(q);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),P.rtt[b]={id:z.id,stamp:z.stamp},p.context.bindFramebuffer.set(z.fbo.framebuffer),p.context.clear({color:o.aM.transparent,stencil:0}),p.currentStencilSource=void 0;for(let q=0;q<A.length;q++){const X=p.style._layers[A[q]],K=X.source?this._coordsDescendingInv[X.source][P.tileID.key]:[P.tileID];p.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),p._renderTileClippingMasks(X,K),p.renderLayer(p,p.style.sourceCaches[X.source],X,K),X.source&&(P.rttCoords[X.source]=this._coordsDescendingInvStr[X.source][P.tileID.key])}}return gl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ra[c]}return!1}}const xu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},wh=_,If={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Da,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Su=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},Af={showCompass:!0,showZoom:!0,visualizePitch:!1};class Mf{constructor(e,c,p=!1){this.mousedown=A=>{this.startMouse(o.e({},A,{ctrlKey:!0,preventDefault:()=>A.preventDefault()}),k.mousePos(this.element,A)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.moveMouse(A,k.mousePos(this.element,A))},this.mouseup=A=>{this.mouseRotate.dragEnd(A),this.mousePitch&&this.mousePitch.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,A.targetTouches)[0],this.startTouch(A,this._startPos),k.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,A.targetTouches)[0],this.moveTouch(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=e.dragRotate._mouseRotate.getClickTolerance(),b=e.dragRotate._mousePitch.getClickTolerance();this.element=c,this.mouseRotate=_r({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:A,clickTolerance:P,bearingDegreesPerPixelMoved:z=.8})=>{const q=new jr;return new In({clickTolerance:P,move:(X,K)=>({bearingDelta:(K.x-X.x)*z}),moveStateManager:q,enable:A,assignEvents:Su})})({clickTolerance:m,enable:!0}),this.map=e,p&&(this.mousePitch=so({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:A,clickTolerance:P,pitchDegreesPerPixelMoved:z=-.5})=>{const q=new jr;return new In({clickTolerance:P,move:(X,K)=>({pitchDelta:(K.y-X.y)*z}),moveStateManager:q,enable:A,assignEvents:Su})})({clickTolerance:b,enable:!0})),k.addEventListener(c,"mousedown",this.mousedown),k.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(c,"touchcancel",this.reset)}startMouse(e,c){this.mouseRotate.dragStart(e,c),this.mousePitch&&this.mousePitch.dragStart(e,c),k.disableDrag()}startTouch(e,c){this.touchRotate.dragStart(e,c),this.touchPitch&&this.touchPitch.dragStart(e,c),k.disableDrag()}moveMouse(e,c){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(e,c)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(e,c)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(e,c){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(e,c)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(e,c)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const e=this.element;k.removeEventListener(e,"mousedown",this.mousedown),k.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend),k.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend)}}let Vr;function mn(v,e,c){const p=new o.N(v.lng,v.lat);if(v=new o.N(v.lng,v.lat),e){const m=new o.N(v.lng-360,v.lat),b=new o.N(v.lng+360,v.lat),A=c.locationPoint(v).distSqr(e);c.locationPoint(m).distSqr(e)<A?v=m:c.locationPoint(b).distSqr(e)<A&&(v=b)}for(;Math.abs(v.lng-c.center.lng)>180;){const m=c.locationPoint(v);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;v.lng>c.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&c.locationPoint(v).y>c.height/2-c.getHorizon()?v:p}const Ba={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hc(v,e,c){const p=v.classList;for(const m in Ba)p.remove(`maplibregl-${c}-anchor-${m}`);p.add(`maplibregl-${c}-anchor-${e}`)}class fc extends o.E{constructor(e){if(super(),this._onKeyPress=c=>{const p=c.code,m=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=c=>{const p=c.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=c=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((c==null?void 0:c.type)==="terrain"||(c==null?void 0:c.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?mn(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||c&&c.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${Ba[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${b}`),y.frameAsync(new AbortController).then(()=>{this._updateOpacity(c&&c.type==="moveend")}).catch(()=>{})},this._onMove=c=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=c=>{this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div");const c=k.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${p}px`),c.setAttributeNS(null,"width",`${m}px`),c.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=k.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const A=k.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const P=k.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ze of z){const Ne=k.createNS("http://www.w3.org/2000/svg","ellipse");Ne.setAttributeNS(null,"opacity","0.04"),Ne.setAttributeNS(null,"cx","10.5"),Ne.setAttributeNS(null,"cy","5.80029008"),Ne.setAttributeNS(null,"rx",ze.rx),Ne.setAttributeNS(null,"ry",ze.ry),P.appendChild(Ne)}const q=k.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);const X=k.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(X);const K=k.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"fill","#000000");const ae=k.createNS("http://www.w3.org/2000/svg","path");ae.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),K.appendChild(ae);const me=k.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");const ve=k.createNS("http://www.w3.org/2000/svg","g");ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ee=k.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#000000"),Ee.setAttributeNS(null,"opacity","0.25"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962");const Le=k.createNS("http://www.w3.org/2000/svg","circle");Le.setAttributeNS(null,"fill","#FFFFFF"),Le.setAttributeNS(null,"cx","5.5"),Le.setAttributeNS(null,"cy","5.5"),Le.setAttributeNS(null,"r","5.4999962"),ve.appendChild(Ee),ve.appendChild(Le),A.appendChild(P),A.appendChild(q),A.appendChild(K),A.appendChild(me),A.appendChild(ve),c.appendChild(A),c.setAttributeNS(null,"height",p*this._scale+"px"),c.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(c),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),hc(this._element,this._anchor,"marker"),e&&e.className)for(const c of e.className.split(" "))this._element.classList.add(c);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const m=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var c,p;if(!(!((c=this._map)===null||c===void 0)&&c.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),A=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,A)-b<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/m.transform._pixelPerMeter,z=Math.sin(m.getPitch()*Math.PI/180)*P,q=m.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),X=m.transform.lngLatToCameraDepth(this._lngLat,A+z)-q>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&X&&this._popup.remove(),this._element.style.opacity=X?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,c){return e===void 0&&c===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),c!==void 0&&(this._opacityWhenCovered=c),this._map&&this._updateOpacity(!0),this}}const xh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let xl=0,Sl=!1;const Fs={maxWidth:100,unit:"metric"};function Tl(v,e,c){const p=c&&c.maxWidth||100,m=v._container.clientHeight/2,b=v.unproject([0,m]),A=v.unproject([p,m]),P=b.distanceTo(A);if(c&&c.unit==="imperial"){const z=3.2808*P;z>5280?Kt(e,p,z/5280,v._getUIString("ScaleControl.Miles")):Kt(e,p,z,v._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Kt(e,p,P/1852,v._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Kt(e,p,P/1e3,v._getUIString("ScaleControl.Kilometers")):Kt(e,p,P,v._getUIString("ScaleControl.Meters"))}function Kt(v,e,c,p){const m=function(b){const A=Math.pow(10,`${Math.floor(b)}`.length-1);let P=b/A;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(z){const q=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*q)/q}(P),A*P}(c);v.style.width=e*(m/c)+"px",v.innerHTML=`${m}&nbsp;${p}`}const fi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},dc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pc(v){if(v){if(typeof v=="number"){const e=Math.round(Math.abs(v)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,v),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-v),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(v,0),right:new o.P(-v,0)}}if(v instanceof o.P||Array.isArray(v)){const e=o.P.convert(v);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(v.center||[0,0]),top:o.P.convert(v.top||[0,0]),"top-left":o.P.convert(v["top-left"]||[0,0]),"top-right":o.P.convert(v["top-right"]||[0,0]),bottom:o.P.convert(v.bottom||[0,0]),"bottom-left":o.P.convert(v["bottom-left"]||[0,0]),"bottom-right":o.P.convert(v["bottom-right"]||[0,0]),left:o.P.convert(v.left||[0,0]),right:o.P.convert(v.right||[0,0])}}return pc(new o.P(0,0))}const Tu=_;f.AJAXError=o.bh,f.Evented=o.E,f.LngLat=o.N,f.MercatorCoordinate=o.Z,f.Point=o.P,f.addProtocol=o.bi,f.config=o.a,f.removeProtocol=o.bj,f.AttributionControl=Fa,f.BoxZoomHandler=It,f.CanvasSource=ut,f.CooperativeGesturesHandler=Oa,f.DoubleClickZoomHandler=ra,f.DragPanHandler=_h,f.DragRotateHandler=yh,f.EdgeInsets=To,f.FullscreenControl=class extends o.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var e;let c=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=c==null?void 0:c.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)c=c.shadowRoot.fullscreenElement;c===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=H,f.GeolocateControl=class extends o.E{constructor(v){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const c=new o.N(e.coords.longitude,e.coords.latitude),p=e.coords.accuracy,m=this._map.getBearing(),b=o.e({bearing:m},this.options.fitBoundsOptions),A=Ye.fromLngLat(c,p);this._map.fitBounds(A,b,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const c=new o.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Sl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new fc({element:this._dotElement}),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},xh,v)}onAdd(v){return this._map=v,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(e=!1){if(Vr!==void 0&&!e)return Vr;if(window.navigator.permissions===void 0)return Vr=!!window.navigator.geolocation,Vr;try{Vr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Vr=!!window.navigator.geolocation}return Vr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xl=0,Sl=!1}_isOutOfMapMaxBounds(v){const e=this._map.getMaxBounds(),c=v.coords;return e&&(c.longitude<e.getWest()||c.longitude>e.getEast()||c.latitude<e.getSouth()||c.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),e=v.getSouthEast(),c=v.getNorthEast(),p=e.distanceTo(c),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xl--,Sl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xl++,xl>1?(v={maximumAge:6e5,timeout:0},Sl=!0):(v=this.options.positionOptions,Sl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.Hash=Pa,f.ImageSource=Ie,f.KeyboardHandler=ts,f.LngLatBounds=Ye,f.LogoControl=bu,f.Map=class extends bh{constructor(v){o.bf.mark(o.bg.create);const e=Object.assign(Object.assign({},If),v);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ko(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ji,this._controls=[],this._mapId=o.a4(),this._contextLost=c=>{c.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:c}))},this._contextRestored=c=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:c}))},this._onMapScroll=c=>{if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},xu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new ee(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let c=!1;const p=ta(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{c?p(m):c=!0}),this._resizeObserver.observe(this._container)}this.handlers=new yu(this,e),this._hash=e.hash&&new Pa(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,o.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Fa(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new bu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.k(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.k(`${c.dataType}dataloading`,c))}),this.on("dataabort",c=>{this.fire(new o.k("sourcedataabort",c))})}_getMapId(){return this._mapId}addControl(v,e){if(e===void 0&&(e=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[e];return e.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(v);return e>-1&&this._controls.splice(e,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,e,c,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,e,c,p)}resize(v){var e;const c=this._containerDimensions(),p=c[0],m=c[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const z=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,z),this.painter.resize(p,m,z)}this.transform.resize(p,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(p,m);const A=!this._moving;return A&&(this.stop(),this.fire(new o.k("movestart",v)).fire(new o.k("move",v))),this.fire(new o.k("resize",v)),A&&this.fire(new o.k("moveend",v)),this}_getClampedPixelRatio(v,e){const{0:c,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=v*m,A=e*m;return Math.min(b>c?c/b:1,A>p?p/A:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Ye.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(o.N.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(o.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,e,c){if(v==="mouseenter"||v==="mouseover"){let p=!1;return{layers:e,listener:c,delegates:{mousemove:b=>{const A=e.filter(z=>this.getLayer(z)),P=A.length!==0?this.queryRenderedFeatures(b.point,{layers:A}):[];P.length?p||(p=!0,c.call(this,new Pn(v,this,b.originalEvent,{features:P}))):p=!1},mouseout:()=>{p=!1}}}}if(v==="mouseleave"||v==="mouseout"){let p=!1;return{layers:e,listener:c,delegates:{mousemove:A=>{const P=e.filter(z=>this.getLayer(z));(P.length!==0?this.queryRenderedFeatures(A.point,{layers:P}):[]).length?p=!0:p&&(p=!1,c.call(this,new Pn(v,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,c.call(this,new Pn(v,this,A.originalEvent)))}}}}{const p=m=>{const b=e.filter(P=>this.getLayer(P)),A=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];A.length&&(m.features=A,c.call(this,m),delete m.features)};return{layers:e,listener:c,delegates:{[v]:p}}}}_saveDelegatedListener(v,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(e)}_removeDelegatedListener(v,e,c){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const p=this._delegatedListeners[v];for(let m=0;m<p.length;m++){const b=p[m];if(b.listener===c&&b.layers.length===e.length&&b.layers.every(A=>e.includes(A))){for(const A in b.delegates)this.off(A,b.delegates[A]);return void p.splice(m,1)}}}on(v,e,c){if(c===void 0)return super.on(v,e);const p=this._createDelegatedListener(v,typeof e=="string"?[e]:e,c);this._saveDelegatedListener(v,p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(v,e,c){if(c===void 0)return super.once(v,e);const p=typeof e=="string"?[e]:e,m=this._createDelegatedListener(v,p,c);for(const b in m.delegates){const A=m.delegates[b];m.delegates[b]=(...P)=>{this._removeDelegatedListener(v,p,c),A(...P)}}this._saveDelegatedListener(v,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(v,e,c){return c===void 0?super.off(v,e):(this._removeDelegatedListener(v,typeof e=="string"?[e]:e,c),this)}queryRenderedFeatures(v,e){if(!this.style)return[];let c;const p=v instanceof o.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(p?{}:v)||{},m instanceof o.P||typeof m[0]=="number")c=[o.P.convert(m)];else{const b=o.P.convert(m[0]),A=o.P.convert(m[1]);c=[b,new o.P(A.x,b.y),A,new o.P(b.x,A.y),b]}return this.style.queryRenderedFeatures(c,e,this.transform)}querySourceFeatures(v,e){return this.style.querySourceFeatures(v,e)}setStyle(v,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(v,e))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const e=this._locale[v];if(e==null)throw new Error(`Missing UI string '${v}'`);return e}_updateStyle(v,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,e));const c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new _a(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,e,c):this.style.loadJSON(v,e,c),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new _a(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,e){if(typeof v=="string"){const c=this._requestManager.transformRequest(v,"Style");o.h(c,new AbortController).then(p=>{this._updateDiff(p.data,e)}).catch(p=>{p&&this.fire(new o.j(p))})}else typeof v=="object"&&this._updateDiff(v,e)}_updateDiff(v,e){try{this.style.setState(v,e)&&this._update(!0)}catch(c){o.w(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(v,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(v,e){return this._lazyInitEmptyStyle(),this.style.addSource(v,e),this._update(!0)}isSourceLoaded(v){const e=this.style&&this.style.sourceCaches[v];if(e!==void 0)return e.loaded();this.fire(new o.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const e=this.style.sourceCaches[v.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&e.reload();for(const c in this.style._layers){const p=this.style._layers[c];p.type==="hillshade"&&p.source===v.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new wu(this.painter,e,v),this.painter.renderToTexture=new vh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=c=>{c.dataType==="style"?this.terrain.sourceCache.freeRtt():c.dataType==="source"&&c.tile&&(c.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(c.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:v})),this}getTerrain(){var v,e;return(e=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const e in v){const c=v[e]._tiles;for(const p in c){const m=c[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,e,c={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:A,content:P,textFitWidth:z,textFitHeight:q}=c;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:X,height:K,data:ae}=e,me=e;return this.style.addImage(v,{data:new o.R({width:X,height:K},new Uint8Array(ae)),pixelRatio:p,stretchX:b,stretchY:A,content:P,textFitWidth:z,textFitHeight:q,sdf:m,version:0,userImage:me}),me.onAdd&&me.onAdd(this,v),this}}{const{width:X,height:K,data:ae}=y.getImageData(e);this.style.addImage(v,{data:new o.R({width:X,height:K},ae),pixelRatio:p,stretchX:b,stretchY:A,content:P,textFitWidth:z,textFitHeight:q,sdf:m,version:0})}}updateImage(v,e){const c=this.style.getImage(v);if(!c)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=e instanceof HTMLImageElement||o.b(e)?y.getImageData(e):e,{width:m,height:b,data:A}=p;if(m===void 0||b===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==c.data.width||b!==c.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(e instanceof HTMLImageElement||o.b(e));return c.data.replace(A,P),this.style.updateImage(v,c),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return W.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,e){return this._lazyInitEmptyStyle(),this.style.addLayer(v,e),this._update(!0)}moveLayer(v,e){return this.style.moveLayer(v,e),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,e,c){return this.style.setLayerZoomRange(v,e,c),this._update(!0)}setFilter(v,e,c={}){return this.style.setFilter(v,e,c),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,e,c,p={}){return this.style.setPaintProperty(v,e,c,p),this._update(!0)}getPaintProperty(v,e){return this.style.getPaintProperty(v,e)}setLayoutProperty(v,e,c,p={}){return this.style.setLayoutProperty(v,e,c,p),this._update(!0)}getLayoutProperty(v,e){return this.style.getLayoutProperty(v,e)}setGlyphs(v,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,e,c={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,e,c,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,e,c=>{c||this._update(!0)}),this}setLight(v,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(v){return this._lazyInitEmptyStyle(),this.style.setSky(v),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,e){return this.style.setFeatureState(v,e),this._update()}removeFeatureState(v,e){return this.style.removeFeatureState(v,e),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,e=0;return this._container&&(v=this._container.clientWidth||400,e=this._container.clientHeight||300),[v,e]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const e=this._canvasContainer=k.create("div","maplibregl-canvas-container",v);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const c=this._containerDimensions(),p=this._getClampedPixelRatio(c[0],c[1]);this._resizeCanvas(c[0],c[1],p);const m=this._controlContainer=k.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{b[A]=k.create("div",`maplibregl-ctrl-${A} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,e,c){this._canvas.width=Math.floor(c*v),this._canvas.height=Math.floor(c*e),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{e={requestedAttributes:v},p&&(e.statusMessage=p.statusMessage,e.type=p.type)},{once:!0});const c=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!c){const p="Failed to initialize WebGL";throw e?(e.message=p,new Error(JSON.stringify(e))):new Error(p)}this.painter=new Ma(c,this.transform),I.testSupport(c)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let c=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=y.now();this.style.zoomHistory.update(m,b);const A=new o.z(m,{now:b,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=A.crossFadingFactor();P===1&&P===this._crossFadingFactor||(c=!0,this._crossFadingFactor=P),this.style.update(A)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bf.mark(o.bg.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||c)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,o.bf.mark(o.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bf.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(v=>{o.bf.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return wh}getCameraTargetElevation(){return this.transform.elevation}},f.MapMouseEvent=Pn,f.MapTouchEvent=Be,f.MapWheelEvent=O,f.Marker=fc,f.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const e=this._map.getZoom(),c=e===this._map.getMaxZoom(),p=e===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,c)=>{const p=this._map._getUIString(`NavigationControl.${c}`);e.title=p,e.setAttribute("aria-label",p)},this.options=o.e({},Af,v),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),k.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),k.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,e){const c=k.create("button",v,this._container);return c.type="button",c.addEventListener("click",e),c}},f.Popup=class extends o.E{constructor(v){super(),this.remove=()=>(this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var c;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=k.create("div","maplibregl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?mn(this._lngLat,this._flatPos,this._map.transform):(c=this._lngLat)===null||c===void 0?void 0:c.wrap(),this._trackPointer&&!e)return;const p=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=pc(this.options.offset);if(!m){const P=this._container.offsetWidth,z=this._container.offsetHeight;let q;q=p.y+b.bottom.y<z?["top"]:p.y>this._map.transform.height-z?["bottom"]:[],p.x<P/2?q.push("left"):p.x>this._map.transform.width-P/2&&q.push("right"),m=q.length===0?"bottom":q.join("-")}let A=p.add(b[m]);this.options.subpixelPositioning||(A=A.round()),k.setTransform(this._container,`${Ba[m]} translate(${A.x}px,${A.y}px)`),hc(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(fi),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=o.N.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const e=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=v;p=c.firstChild,p;)e.appendChild(p);return this.setDOMContent(e)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(dc);v&&v.focus()}},f.RasterDEMTileSource=ue,f.RasterTileSource=it,f.ScaleControl=class{constructor(v){this._onMove=()=>{Tl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Tl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Fs),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=ps,f.Style=_a,f.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=wl,f.TwoFingersTouchRotateHandler=mu,f.TwoFingersTouchZoomHandler=du,f.TwoFingersTouchZoomRotateHandler=_u,f.VectorTileSource=pt,f.VideoSource=qe,f.addSourceType=(v,e)=>o._(void 0,void 0,void 0,function*(){if(ki(v))throw new Error(`A source type called "${v}" already exists.`);((c,p)=>{st[c]=p})(v,e)}),f.clearPrewarmedResources=function(){const v=Zt;v&&(v.isPreloaded()&&v.numActive()===1?(v.release($e),Zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Fi().getRTLTextPluginStatus()},f.getVersion=function(){return Tu},f.getWorkerCount=function(){return vt.workerCount},f.getWorkerUrl=function(){return o.a.WORKER_URL},f.importScriptInWorkers=function(v){return Ti().broadcast("IS",v)},f.prewarm=function(){Mi().acquire($e)},f.setMaxParallelImageRequests=function(v){o.a.MAX_PARALLEL_IMAGE_REQUESTS=v},f.setRTLTextPlugin=function(v,e){return Fi().setRTLTextPlugin(v,e)},f.setWorkerCount=function(v){vt.workerCount=v},f.setWorkerUrl=function(v){o.a.WORKER_URL=v}});var d=n;return d})})(F0);var qw=F0.exports;const Ws=x1(qw);function Sg(r){let i;return n=>{if(n)for(let a in n){let u=i==null?void 0:i[a],d=n[a];u!==d&&r(a,d,u)}else if(i)for(let a in i)r(a,void 0,i[a]);i=n}}function Zw(r,...i){let n=[r];for(let a of i)if(a)Array.isArray(a)&&a[0]===r?n.push(...a.slice(1)):n.push(a);else continue;if(n.length!==1)return n.length===2?n[1]:n}function Ww(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}var ql=Gw;function Gw(r){var i,n,a;if(r){if(Array.isArray(r)){for(i=[],n=r.length,a=0;a<n;a++){var u=r[a];u!=null&&i.push(u)}return i}if(typeof r=="object"){i={};var d=Object.keys(r);for(n=d.length,a=0;a<n;a++){var f=d[a],o=r[f];o!=null&&(i[f]=o)}return i}}}function Tg(r){let i=r[0],n,a,u=kg(r);return{c(){u.c(),n=Mn()},m(d,f){u.m(d,f),xe(d,n,f),a=!0},p(d,f){f[0]&1&&ti(i,i=d[0])?(ln(),Ve(u,1,1,Ht),cn(),u=kg(d),u.c(),Re(u,1),u.m(n.parentNode,n)):u.p(d,f)},i(d){a||(Re(u),a=!0)},o(d){Ve(u),a=!1},d(d){d&&we(n),u.d(d)}}}function kg(r){let i;const n=r[36].default,a=vn(n,r,r[35],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d[1]&16)&&xn(a,n,u,u[35],i?wn(n,u[35],d,null):Sn(u[35]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function Hw(r){let i,n,a=r[0]&&Tg(r);return{c(){a&&a.c(),i=Mn()},m(u,d){a&&a.m(u,d),xe(u,i,d),n=!0},p(u,d){u[0]?a?(a.p(u,d),d[0]&1&&Re(a,1)):(a=Tg(u),a.c(),Re(a,1),a.m(i.parentNode,i)):a&&(ln(),Ve(a,1,1,()=>{a=null}),cn())},i(u){n||(Re(a),n=!0)},o(u){Ve(a),n=!1},d(u){u&&we(i),a&&a.d(u)}}}function Xw(r,i,n){let a,u,d,f,o,_,S,T,y,k,I,C,{$$slots:L={},$$scope:B}=i,{id:N=dh("layer")}=i,{source:F=void 0}=i,{sourceLayer:W=void 0}=i,{beforeId:ee=void 0}=i,{beforeLayerType:oe=void 0}=i,{type:$}=i,{paint:re=void 0}=i,{layout:j=void 0}=i,{filter:U=void 0}=i,{applyToClusters:J=void 0}=i,{minzoom:R=void 0}=i,{maxzoom:Z=void 0}=i,{manageHoverState:ce=!1}=i,{hovered:fe=null}=i,{interactive:ge=!0}=i,{hoverCursor:ye=void 0}=i,{eventsIfTopMost:he=!1}=i;const Fe=nl(),{map:Me,source:lt,self:Ze,minzoom:ht,maxzoom:kt,eventTopMost:$e,layerInfo:vt}=Vw();Gt(r,Me,He=>n(31,y=He)),Gt(r,lt,He=>n(32,k=He)),Gt(r,Ze,He=>n(0,T=He)),Gt(r,ht,He=>n(34,C=He)),Gt(r,kt,He=>n(33,I=He)),hs(()=>{T&&y&&(vt.delete(T),y==null||y.removeLayer(T))});let St;function Zt(He){var gi,pt;if(!ge||!T||!y||he&&$e(He)!==T)return;let Pt=He.features??[],ni=(pt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:pt.cluster_id,Ye={event:He,map:y,clusterId:ni,layer:T,source:o,features:Pt};Fe(He.type,Ye)}function oi(He){var gi,pt;if(!ge||!T||!y||he&&$e(He)!==T)return;ye&&(y.getCanvas().style.cursor=ye);let Pt=He.features??[];n(6,fe=Pt[0]??null);let ni=(pt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:pt.cluster_id;Fe("mouseenter",{event:He,map:y,clusterId:ni,layer:T,source:o,features:Pt})}function Mi(He){var gi,pt,it;if(!ge||!y)return;if(he&&$e(He)!==T){n(6,fe=null),ce&&St!==void 0&&(y==null||y.setFeatureState({source:o,sourceLayer:W,id:St},{hover:!1}),St=void 0);return}y.getCanvas().style.cursor=ye;let Pt=He.features??[],ni=(pt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:pt.cluster_id,Ye=(it=Pt[0])==null?void 0:it.id;Ye!==St&&(ce&&(St!==void 0&&(y==null||y.setFeatureState({source:o,id:St,sourceLayer:W},{hover:!1})),y==null||y.setFeatureState({source:o,id:Ye,sourceLayer:W},{hover:!0})),St=Ye,n(6,fe=Pt[0]??null)),Fe("mousemove",{event:He,map:y,clusterId:ni,layer:T,source:o,features:Pt})}function Pi(He){if(!(!ge||!T||!y)){if(ye&&(y.getCanvas().style.cursor=""),n(6,fe=null),ce&&St!==void 0){const Pt={source:o,id:St,sourceLayer:W};y==null||y.setFeatureState(Pt,{hover:!1}),St=void 0}Fe("mouseleave",{map:y,layer:T,source:o})}}let Ti=!0;function At(He){y&&(y.off("click",He,Zt),y.off("dblclick",He,Zt),y.off("contextmenu",He,Zt),y.off("mouseenter",He,oi),y.off("mousemove",He,Mi),y.off("mouseleave",He,Pi))}return hs(()=>{y&&T&&At(T)}),r.$$set=He=>{"id"in He&&n(7,N=He.id),"source"in He&&n(8,F=He.source),"sourceLayer"in He&&n(9,W=He.sourceLayer),"beforeId"in He&&n(10,ee=He.beforeId),"beforeLayerType"in He&&n(11,oe=He.beforeLayerType),"type"in He&&n(12,$=He.type),"paint"in He&&n(13,re=He.paint),"layout"in He&&n(14,j=He.layout),"filter"in He&&n(15,U=He.filter),"applyToClusters"in He&&n(16,J=He.applyToClusters),"minzoom"in He&&n(17,R=He.minzoom),"maxzoom"in He&&n(18,Z=He.maxzoom),"manageHoverState"in He&&n(19,ce=He.manageHoverState),"hovered"in He&&n(6,fe=He.hovered),"interactive"in He&&n(20,ge=He.interactive),"hoverCursor"in He&&n(21,ye=He.hoverCursor),"eventsIfTopMost"in He&&n(22,he=He.eventsIfTopMost),"$$scope"in He&&n(35,B=He.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,a=Ww(J)),r.$$.dirty[0]&1073774592&&n(24,u=Zw("all",a,U)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,d=R??C),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,f=Z??I),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,o=F||k),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&T!==N&&o){T&&(At(T),vt.delete(T));let He=ee;if(!ee&&oe){let Pt=y.getStyle().layers,ni=typeof oe=="function"?oe:gi=>gi.type===oe,Ye=Pt==null?void 0:Pt.find(ni);Ye&&(He=Ye.id)}dn(Ze,T=N,T),y.addLayer(ql({id:T,type:$,source:o,"source-layer":W,filter:u,paint:re,layout:j,minzoom:d,maxzoom:f}),He),n(23,Ti=!0),y.on("click",T,Zt),y.on("dblclick",T,Zt),y.on("contextmenu",T,Zt),y.on("mouseenter",T,oi),y.on("mousemove",T,Mi),y.on("mouseleave",T,Pi)}r.$$.dirty[0]&1048577&&T&&vt.set(T,{interactive:ge}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,_=T?Sg((He,Pt)=>y==null?void 0:y.setPaintProperty(T,He,Pt)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,S=T?Sg((He,Pt)=>y==null?void 0:y.setLayoutProperty(T,He,Pt)):void 0),r.$$.dirty[0]&268443648&&(_==null||_(re)),r.$$.dirty[0]&134234112&&(S==null||S(j)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&T&&(y==null||y.setLayerZoomRange(T,d,f)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&T&&(Ti?n(23,Ti=!1):y==null||y.setFilter(T,u))},[T,Me,lt,Ze,ht,kt,fe,N,F,W,ee,oe,$,re,j,U,J,R,Z,ce,ge,ye,he,Ti,u,f,d,S,_,o,a,y,k,I,C,B,L]}let fp=class extends ui{constructor(i){super(),ci(this,i,Xw,Hw,ti,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Kw(r){let i;const n=r[16].default,a=vn(n,r,r[24],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&16777216)&&xn(a,n,u,u[24],i?wn(n,u[24],d,null):Sn(u[24]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function Jw(r){let i,n,a;function u(f){r[17](f)}let d={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Kw]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),i=new fp({props:d}),wi.push(()=>Xi(i,"hovered",u)),i.$on("click",r[18]),i.$on("dblclick",r[19]),i.$on("contextmenu",r[20]),i.$on("mouseenter",r[21]),i.$on("mousemove",r[22]),i.$on("mouseleave",r[23]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.applyToClusters=f[9]),o&1024&&(_.minzoom=f[10]),o&2048&&(_.maxzoom=f[11]),o&4096&&(_.hoverCursor=f[12]),o&8192&&(_.manageHoverState=f[13]),o&16384&&(_.eventsIfTopMost=f[14]),o&32768&&(_.interactive=f[15]),o&16777216&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function Yw(r,i,n){let{$$slots:a={},$$scope:u}=i,{id:d=dh("circle")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:S=void 0}=i,{paint:T}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{applyToClusters:I=void 0}=i,{minzoom:C=void 0}=i,{maxzoom:L=void 0}=i,{hoverCursor:B=void 0}=i,{manageHoverState:N=!1}=i,{hovered:F=null}=i,{eventsIfTopMost:W=!1}=i,{interactive:ee=!0}=i;function oe(Z){F=Z,n(0,F)}function $(Z){Di.call(this,r,Z)}function re(Z){Di.call(this,r,Z)}function j(Z){Di.call(this,r,Z)}function U(Z){Di.call(this,r,Z)}function J(Z){Di.call(this,r,Z)}function R(Z){Di.call(this,r,Z)}return r.$$set=Z=>{"id"in Z&&n(1,d=Z.id),"source"in Z&&n(2,f=Z.source),"sourceLayer"in Z&&n(3,o=Z.sourceLayer),"beforeId"in Z&&n(4,_=Z.beforeId),"beforeLayerType"in Z&&n(5,S=Z.beforeLayerType),"paint"in Z&&n(6,T=Z.paint),"layout"in Z&&n(7,y=Z.layout),"filter"in Z&&n(8,k=Z.filter),"applyToClusters"in Z&&n(9,I=Z.applyToClusters),"minzoom"in Z&&n(10,C=Z.minzoom),"maxzoom"in Z&&n(11,L=Z.maxzoom),"hoverCursor"in Z&&n(12,B=Z.hoverCursor),"manageHoverState"in Z&&n(13,N=Z.manageHoverState),"hovered"in Z&&n(0,F=Z.hovered),"eventsIfTopMost"in Z&&n(14,W=Z.eventsIfTopMost),"interactive"in Z&&n(15,ee=Z.interactive),"$$scope"in Z&&n(24,u=Z.$$scope)},[F,d,f,o,_,S,T,y,k,I,C,L,B,N,W,ee,a,oe,$,re,j,U,J,R,u]}let Qw=class extends ui{constructor(i){super(),ci(this,i,Yw,Jw,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function $w(r){let i;const n=r[15].default,a=vn(n,r,r[23],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&8388608)&&xn(a,n,u,u[23],i?wn(n,u[23],d,null):Sn(u[23]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function ex(r){let i,n,a;function u(f){r[16](f)}let d={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[$w]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),i=new fp({props:d}),wi.push(()=>Xi(i,"hovered",u)),i.$on("click",r[17]),i.$on("dblclick",r[18]),i.$on("contextmenu",r[19]),i.$on("mouseenter",r[20]),i.$on("mousemove",r[21]),i.$on("mouseleave",r[22]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.minzoom=f[9]),o&1024&&(_.maxzoom=f[10]),o&2048&&(_.hoverCursor=f[11]),o&4096&&(_.manageHoverState=f[12]),o&8192&&(_.eventsIfTopMost=f[13]),o&16384&&(_.interactive=f[14]),o&8388608&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function tx(r,i,n){let{$$slots:a={},$$scope:u}=i,{id:d=dh("fill")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:S=void 0}=i,{paint:T}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{minzoom:I=void 0}=i,{maxzoom:C=void 0}=i,{hoverCursor:L=void 0}=i,{manageHoverState:B=!1}=i,{hovered:N=null}=i,{eventsIfTopMost:F=!1}=i,{interactive:W=!0}=i;function ee(R){N=R,n(0,N)}function oe(R){Di.call(this,r,R)}function $(R){Di.call(this,r,R)}function re(R){Di.call(this,r,R)}function j(R){Di.call(this,r,R)}function U(R){Di.call(this,r,R)}function J(R){Di.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,d=R.id),"source"in R&&n(2,f=R.source),"sourceLayer"in R&&n(3,o=R.sourceLayer),"beforeId"in R&&n(4,_=R.beforeId),"beforeLayerType"in R&&n(5,S=R.beforeLayerType),"paint"in R&&n(6,T=R.paint),"layout"in R&&n(7,y=R.layout),"filter"in R&&n(8,k=R.filter),"minzoom"in R&&n(9,I=R.minzoom),"maxzoom"in R&&n(10,C=R.maxzoom),"hoverCursor"in R&&n(11,L=R.hoverCursor),"manageHoverState"in R&&n(12,B=R.manageHoverState),"hovered"in R&&n(0,N=R.hovered),"eventsIfTopMost"in R&&n(13,F=R.eventsIfTopMost),"interactive"in R&&n(14,W=R.interactive),"$$scope"in R&&n(23,u=R.$$scope)},[N,d,f,o,_,S,T,y,k,I,C,L,B,F,W,a,ee,oe,$,re,j,U,J,u]}let ix=class extends ui{constructor(i){super(),ci(this,i,tx,ex,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function nx(r,i,n,a,u){let d=!1;r.getSource(i)&&(d=!0,r.removeSource(i));const f=()=>{a(i)&&(r.addSource(i,n),u())};if(d){const o=()=>{i&&(r.getSource(i)?setTimeout(o,1):f())};o()}else f()}function rx(r,i,n){i0().then(()=>{let a=Jy(r);if(!a)return;a.getSource(i)===n&&a.removeSource(i)})}function Cg(r){let i=r[0],n,a,u=Eg(r);return{c(){u.c(),n=Mn()},m(d,f){u.m(d,f),xe(d,n,f),a=!0},p(d,f){f&1&&ti(i,i=d[0])?(ln(),Ve(u,1,1,Ht),cn(),u=Eg(d),u.c(),Re(u,1),u.m(n.parentNode,n)):u.p(d,f)},i(d){a||(Re(u),a=!0)},o(d){Ve(u),a=!1},d(d){d&&we(n),u.d(d)}}}function Eg(r){let i;const n=r[15].default,a=vn(n,r,r[14],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&16384)&&xn(a,n,u,u[14],i?wn(n,u[14],d,null):Sn(u[14]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function sx(r){let i,n,a=r[0]&&Cg(r);return{c(){a&&a.c(),i=Mn()},m(u,d){a&&a.m(u,d),xe(u,i,d),n=!0},p(u,[d]){u[0]?a?(a.p(u,d),d&1&&Re(a,1)):(a=Cg(u),a.c(),Re(a,1),a.m(i.parentNode,i)):a&&(ln(),Ve(a,1,1,()=>{a=null}),cn())},i(u){n||(Re(a),n=!0)},o(u){Ve(a),n=!1},d(u){u&&we(i),a&&a.d(u)}}}function ox(r,i,n){let a,u,d,{$$slots:f={},$$scope:o}=i,{id:_=dh("geojson")}=i,{data:S}=i,{generateId:T=!1}=i,{promoteId:y=void 0}=i,{filter:k=void 0}=i,{lineMetrics:I=void 0}=i,{cluster:C=void 0}=i;const{map:L,cluster:B,self:N}=Uw();Gt(r,L,ee=>n(13,u=ee)),Gt(r,B,ee=>n(16,d=ee)),Gt(r,N,ee=>n(0,a=ee));let F,W=!0;return hs(()=>{a&&F&&u&&(rx(L,a,F),dn(N,a=null,a),n(11,F=void 0))}),r.$$set=ee=>{"id"in ee&&n(4,_=ee.id),"data"in ee&&n(5,S=ee.data),"generateId"in ee&&n(6,T=ee.generateId),"promoteId"in ee&&n(7,y=ee.promoteId),"filter"in ee&&n(8,k=ee.filter),"lineMetrics"in ee&&n(9,I=ee.lineMetrics),"cluster"in ee&&n(10,C=ee.cluster),"$$scope"in ee&&n(14,o=ee.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&dn(B,d=C,d),r.$$.dirty&12273&&u&&a!==_&&(dn(N,a=_,a),nx(u,a,ql({type:"geojson",data:S,filter:k,lineMetrics:I,generateId:T,promoteId:y,cluster:!!C,clusterMinPoints:C==null?void 0:C.minPoints,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius,clusterProperties:C==null?void 0:C.properties}),ee=>u&&ee===a,()=>{a&&(n(11,F=u==null?void 0:u.getSource(a)),n(12,W=!0))})),r.$$.dirty&8208&&(u==null||u.on("style.load",()=>{n(11,F=u==null?void 0:u.getSource(_))})),r.$$.dirty&6176&&F&&(W?n(12,W=!1):F.setData(S)),r.$$.dirty&3072&&(F==null||F.setClusterOptions(ql({cluster:!!C,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius})))},[a,L,B,N,_,S,T,y,k,I,C,F,W,u,o,f]}let ax=class extends ui{constructor(i){super(),ci(this,i,ox,sx,ti,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}};function lx(r){let i;const n=r[15].default,a=vn(n,r,r[23],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&8388608)&&xn(a,n,u,u[23],i?wn(n,u[23],d,null):Sn(u[23]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function cx(r){let i,n,a;function u(f){r[16](f)}let d={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[lx]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),i=new fp({props:d}),wi.push(()=>Xi(i,"hovered",u)),i.$on("click",r[17]),i.$on("dblclick",r[18]),i.$on("contextmenu",r[19]),i.$on("mouseenter",r[20]),i.$on("mousemove",r[21]),i.$on("mouseleave",r[22]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.minzoom=f[9]),o&1024&&(_.maxzoom=f[10]),o&2048&&(_.hoverCursor=f[11]),o&4096&&(_.manageHoverState=f[12]),o&8192&&(_.eventsIfTopMost=f[13]),o&16384&&(_.interactive=f[14]),o&8388608&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function ux(r,i,n){let{$$slots:a={},$$scope:u}=i,{id:d=dh("line")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:S=void 0}=i,{paint:T}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{minzoom:I=void 0}=i,{maxzoom:C=void 0}=i,{hoverCursor:L=void 0}=i,{manageHoverState:B=!1}=i,{hovered:N=null}=i,{eventsIfTopMost:F=!1}=i,{interactive:W=!0}=i;function ee(R){N=R,n(0,N)}function oe(R){Di.call(this,r,R)}function $(R){Di.call(this,r,R)}function re(R){Di.call(this,r,R)}function j(R){Di.call(this,r,R)}function U(R){Di.call(this,r,R)}function J(R){Di.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,d=R.id),"source"in R&&n(2,f=R.source),"sourceLayer"in R&&n(3,o=R.sourceLayer),"beforeId"in R&&n(4,_=R.beforeId),"beforeLayerType"in R&&n(5,S=R.beforeLayerType),"paint"in R&&n(6,T=R.paint),"layout"in R&&n(7,y=R.layout),"filter"in R&&n(8,k=R.filter),"minzoom"in R&&n(9,I=R.minzoom),"maxzoom"in R&&n(10,C=R.maxzoom),"hoverCursor"in R&&n(11,L=R.hoverCursor),"manageHoverState"in R&&n(12,B=R.manageHoverState),"hovered"in R&&n(0,N=R.hovered),"eventsIfTopMost"in R&&n(13,F=R.eventsIfTopMost),"interactive"in R&&n(14,W=R.interactive),"$$scope"in R&&n(23,u=R.$$scope)},[N,d,f,o,_,S,T,y,k,I,C,L,B,F,W,a,ee,oe,$,re,j,U,J,u]}let hx=class extends ui{constructor(i){super(),ci(this,i,ux,cx,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};var Oc=dp;function dp(r,i){return r===i||r!==r&&i!==i?!0:typeof r!=typeof i||{}.toString.call(r)!={}.toString.call(i)||r!==Object(r)||!r?!1:Array.isArray(r)?Ig(r,i):{}.toString.call(r)=="[object Set]"?Ig(Array.from(r),Array.from(i)):{}.toString.call(r)=="[object Object]"?dx(r,i):fx(r,i)}function fx(r,i){return r.toString()===i.toString()}function Ig(r,i){var n=r.length;if(n!=i.length)return!1;for(var a=0;a<n;a++)if(!dp(r[a],i[a]))return!1;return!0}function dx(r,i){var n=Object.keys(r),a=n.length;if(a!=Object.keys(i).length)return!1;for(var u=0;u<a;u++){var d=n[u];if(!(i.hasOwnProperty(d)&&dp(r[d],i[d])))return!1}return!0}var ph=Uint8Array,B0=Uint16Array,px=Int32Array,mx=new ph([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gx=new ph([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),N0=function(r,i){for(var n=new B0(31),a=0;a<31;++a)n[a]=i+=1<<r[a-1];for(var u=new px(n[30]),a=1;a<30;++a)for(var d=n[a];d<n[a+1];++d)u[d]=d-n[a]<<5|a;return{b:n,r:u}},j0=N0(mx,2),_x=j0.b,yx=j0.r;_x[28]=258,yx[258]=28;N0(gx,0);var bx=new B0(32768);for(sn=0;sn<32768;++sn)ua=(sn&43690)>>1|(sn&21845)<<1,ua=(ua&52428)>>2|(ua&13107)<<2,ua=(ua&61680)>>4|(ua&3855)<<4,bx[sn]=((ua&65280)>>8|(ua&255)<<8)>>1;var ua,sn,bf=new ph(288);for(sn=0;sn<144;++sn)bf[sn]=8;var sn;for(sn=144;sn<256;++sn)bf[sn]=9;var sn;for(sn=256;sn<280;++sn)bf[sn]=7;var sn;for(sn=280;sn<288;++sn)bf[sn]=8;var sn,vx=new ph(32);for(sn=0;sn<32;++sn)vx[sn]=5;var sn,wx=new ph(0),xx=typeof TextDecoder<"u"&&new TextDecoder,Sx=0;try{xx.decode(wx,{stream:!0}),Sx=1}catch{}function Tx(r){let i,n,a,u,d,f;return i=new ix({props:{id:"edit-polygon-fill",filter:Aw,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),a=new hx({props:{id:"edit-polygon-lines",filter:Mw,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),d=new Qw({props:{id:"edit-polygon-vertices",filter:Pw,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment),u=Qe(),yt(d.$$.fragment)},m(o,_){gt(i,o,_),xe(o,n,_),gt(a,o,_),xe(o,u,_),gt(d,o,_),f=!0},p:Ht,i(o){f||(Re(i.$$.fragment,o),Re(a.$$.fragment,o),Re(d.$$.fragment,o),f=!0)},o(o){Ve(i.$$.fragment,o),Ve(a.$$.fragment,o),Ve(d.$$.fragment,o),f=!1},d(o){o&&(we(n),we(u)),_t(i,o),_t(a,o),_t(d,o)}}}function kx(r){let i,n;return i=new ax({props:{data:r[0],$$slots:{default:[Tx]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,[u]){const d={};u&1&&(d.data=a[0]),u&2&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function Cx(r,i,n){let a;return Gt(r,L0,u=>n(0,a=u)),[a]}class Ex extends ui{constructor(i){super(),ci(this,i,Cx,kx,ti,{})}}const Ix=r=>({}),Ag=r=>({}),Ax=r=>({}),Mg=r=>({}),Mx=r=>({}),Pg=r=>({});function Px(r){let i,n,a,u,d,f,o,_;const S=r[1].top,T=vn(S,r,r[0],Pg),y=r[1].left,k=vn(y,r,r[0],Mg),I=r[1].main,C=vn(I,r,r[0],Ag);return{c(){i=ke("div"),n=ke("div"),T&&T.c(),a=Qe(),u=ke("div"),d=ke("div"),k&&k.c(),f=Qe(),o=ke("div"),C&&C.c(),_e(n,"class","top svelte-29q570"),_e(d,"class","left svelte-29q570"),_e(o,"class","main svelte-29q570"),_e(u,"class","content svelte-29q570"),_e(i,"class","flex-container svelte-29q570")},m(L,B){xe(L,i,B),be(i,n),T&&T.m(n,null),be(i,a),be(i,u),be(u,d),k&&k.m(d,null),be(u,f),be(u,o),C&&C.m(o,null),_=!0},p(L,[B]){T&&T.p&&(!_||B&1)&&xn(T,S,L,L[0],_?wn(S,L[0],B,Mx):Sn(L[0]),Pg),k&&k.p&&(!_||B&1)&&xn(k,y,L,L[0],_?wn(y,L[0],B,Ax):Sn(L[0]),Mg),C&&C.p&&(!_||B&1)&&xn(C,I,L,L[0],_?wn(I,L[0],B,Ix):Sn(L[0]),Ag)},i(L){_||(Re(T,L),Re(k,L),Re(C,L),_=!0)},o(L){Ve(T,L),Ve(k,L),Ve(C,L),_=!1},d(L){L&&we(i),T&&T.d(L),k&&k.d(L),C&&C.d(L)}}}function Lx(r,i,n){let{$$slots:a={},$$scope:u}=i;return r.$$set=d=>{"$$scope"in d&&n(0,u=d.$$scope)},[u,a]}class zx extends ui{constructor(i){super(),ci(this,i,Lx,Px,ti,{})}}const Ox=r=>({}),Lg=r=>({}),Dx=r=>({}),zg=r=>({}),Fx=r=>({}),Og=r=>({});function Rx(r){let i,n,a,u,d,f;const o=r[4].top,_=vn(o,r,r[3],Og),S=r[4].sidebar,T=vn(S,r,r[3],zg),y=r[4].map,k=vn(y,r,r[3],Lg);return{c(){i=ke("div"),_&&_.c(),n=Qe(),a=ke("div"),T&&T.c(),u=Qe(),d=ke("div"),k&&k.c()},m(I,C){xe(I,i,C),_&&_.m(i,null),r[5](i),xe(I,n,C),xe(I,a,C),T&&T.m(a,null),r[6](a),xe(I,u,C),xe(I,d,C),k&&k.m(d,null),r[7](d),f=!0},p(I,[C]){_&&_.p&&(!f||C&8)&&xn(_,o,I,I[3],f?wn(o,I[3],C,Fx):Sn(I[3]),Og),T&&T.p&&(!f||C&8)&&xn(T,S,I,I[3],f?wn(S,I[3],C,Dx):Sn(I[3]),zg),k&&k.p&&(!f||C&8)&&xn(k,y,I,I[3],f?wn(y,I[3],C,Ox):Sn(I[3]),Lg)},i(I){f||(Re(_,I),Re(T,I),Re(k,I),f=!0)},o(I){Ve(_,I),Ve(T,I),Ve(k,I),f=!1},d(I){I&&(we(i),we(n),we(a),we(u),we(d)),_&&_.d(I),r[5](null),T&&T.d(I),r[6](null),k&&k.d(I),r[7](null)}}}function Bx(r,i,n){let a,u,d;Gt(r,Dg,y=>n(0,a=y)),Gt(r,Bd,y=>n(1,u=y)),Gt(r,Nd,y=>n(2,d=y));let{$$slots:f={},$$scope:o}=i;function _(y){wi[y?"unshift":"push"](()=>{a=y,Dg.set(a)})}function S(y){wi[y?"unshift":"push"](()=>{u=y,Bd.set(u)})}function T(y){wi[y?"unshift":"push"](()=>{d=y,Nd.set(d)})}return r.$$set=y=>{"$$scope"in y&&n(3,o=y.$$scope)},[a,u,d,o,f,_,S,T]}class vf extends ui{constructor(i){super(),ci(this,i,Bx,Rx,ti,{})}}let Dg=kn(null),Bd=kn(null),Nd=kn(null);function Nx(r,i={}){if(r.bbox!=null&&i.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return A0(r,a=>{n[0]>a[0]&&(n[0]=a[0]),n[1]>a[1]&&(n[1]=a[1]),n[2]<a[0]&&(n[2]=a[0]),n[3]<a[1]&&(n[3]=a[1])}),n}var jx=Nx,Ux=Object.defineProperty,Vx=(r,i,n)=>i in r?Ux(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,pi=(r,i,n)=>Vx(r,typeof i!="symbol"?i+"":i,n);function oh(){}function U0(r){return r()}function Fg(){return Object.create(null)}function wf(r){r.forEach(U0)}function V0(r){return typeof r=="function"}function qx(r,i){return r!=r?i==i:r!==i||r&&typeof r=="object"||typeof r=="function"}function Zx(r){return Object.keys(r).length===0}function Wx(r,i){r.appendChild(i)}function Gx(r,i,n){r.insertBefore(i,n||null)}function q0(r){r.parentNode&&r.parentNode.removeChild(r)}function Rg(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Ya(r,i,n){n==null?r.removeAttribute(i):r.getAttribute(i)!==n&&r.setAttribute(i,n)}function Hx(r){return Array.from(r.childNodes)}function Kh(r,i,n){r.classList.toggle(i,!!n)}let pp;function ih(r){pp=r}const Bc=[],Bg=[];let qc=[];const Ng=[],Xx=Promise.resolve();let jd=!1;function Kx(){jd||(jd=!0,Xx.then(Z0))}function Ud(r){qc.push(r)}const Td=new Set;let Dc=0;function Z0(){if(Dc!==0)return;const r=pp;do{try{for(;Dc<Bc.length;){const i=Bc[Dc];Dc++,ih(i),Jx(i.$$)}}catch(i){throw Bc.length=0,Dc=0,i}for(ih(null),Bc.length=0,Dc=0;Bg.length;)Bg.pop()();for(let i=0;i<qc.length;i+=1){const n=qc[i];Td.has(n)||(Td.add(n),n())}qc.length=0}while(Bc.length);for(;Ng.length;)Ng.pop()();jd=!1,Td.clear(),ih(r)}function Jx(r){if(r.fragment!==null){r.update(),wf(r.before_update);const i=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,i),r.after_update.forEach(Ud)}}function Yx(r){const i=[],n=[];qc.forEach(a=>r.indexOf(a)===-1?i.push(a):n.push(a)),n.forEach(a=>a()),qc=i}const Qx=new Set;function $x(r,i){r&&r.i&&(Qx.delete(r),r.i(i))}function e2(r,i,n){const{fragment:a,after_update:u}=r.$$;a&&a.m(i,n),Ud(()=>{const d=r.$$.on_mount.map(U0).filter(V0);r.$$.on_destroy?r.$$.on_destroy.push(...d):wf(d),r.$$.on_mount=[]}),u.forEach(Ud)}function t2(r,i){const n=r.$$;n.fragment!==null&&(Yx(n.after_update),wf(n.on_destroy),n.fragment&&n.fragment.d(i),n.on_destroy=n.fragment=null,n.ctx=[])}function i2(r,i){r.$$.dirty[0]===-1&&(Bc.push(r),Kx(),r.$$.dirty.fill(0)),r.$$.dirty[i/31|0]|=1<<i%31}function n2(r,i,n,a,u,d,f=null,o=[-1]){const _=pp;ih(r);const S=r.$$={fragment:null,ctx:[],props:d,update:oh,not_equal:u,bound:Fg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(_?_.$$.context:[])),callbacks:Fg(),dirty:o,skip_bound:!1,root:i.target||_.$$.root};f&&f(S.root);let T=!1;if(S.ctx=n?n(r,i.props||{},(y,k,...I)=>{const C=I.length?I[0]:k;return S.ctx&&u(S.ctx[y],S.ctx[y]=C)&&(!S.skip_bound&&S.bound[y]&&S.bound[y](C),T&&i2(r,y)),k}):[],S.update(),T=!0,wf(S.before_update),S.fragment=a?a(S.ctx):!1,i.target){if(i.hydrate){const y=Hx(i.target);S.fragment&&S.fragment.l(y),y.forEach(q0)}else S.fragment&&S.fragment.c();i.intro&&$x(r.$$.fragment),e2(r,i.target,i.anchor),Z0()}ih(_)}class r2{constructor(){pi(this,"$$"),pi(this,"$$set")}$destroy(){t2(this,1),this.$destroy=oh}$on(i,n){if(!V0(n))return oh;const a=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return a.push(n),()=>{const u=a.indexOf(n);u!==-1&&a.splice(u,1)}}$set(i){this.$$set&&!Zx(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const s2="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(s2);function o2(r){let i,n,a;return{c(){i=Rg("svg"),n=Rg("path"),Ya(n,"stroke-width","4"),Ya(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Ya(n,"class","svelte-gzo3ar"),Ya(i,"width",a=r[0]==="list"?20:void 0),Ya(i,"viewBox","0 0 70 85"),Ya(i,"fill","none"),Ya(i,"class","svelte-gzo3ar"),Kh(i,"in-map",r[0]!=="list"),Kh(i,"list-icon",r[0]==="list")},m(u,d){Gx(u,i,d),Wx(i,n)},p(u,[d]){d&1&&a!==(a=u[0]==="list"?20:void 0)&&Ya(i,"width",a),d&1&&Kh(i,"in-map",u[0]!=="list"),d&1&&Kh(i,"list-icon",u[0]==="list")},i:oh,o:oh,d(u){u&&q0(i)}}}function a2(r,i,n){let{displayIn:a}=i;return r.$$set=u=>{"displayIn"in u&&n(0,a=u.displayIn)},[a]}class l2 extends r2{constructor(i){super(),n2(this,i,a2,o2,qx,{displayIn:0})}}function jg(r){const i=[...r];return i[2]<i[0]&&(Math.abs((i[0]+i[2]+360)/2)>Math.abs((i[0]-360+i[2])/2)?i[0]-=360:i[2]+=360),i}const c2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],u2={decimalLatitude:40.123,decimalLongitude:-74.123},h2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],f2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function d2(){const r=[];return c2.forEach(i=>{i.decimalLatitude?r.push(i):r.push({...i,...u2})}),[...r,...h2,...f2]}const p2=d2();p2.map(r=>r.verbatimCoordinates);function ah(r,i,n={}){const a={type:"Feature"};return(n.id===0||n.id)&&(a.id=n.id),n.bbox&&(a.bbox=n.bbox),a.properties=i||{},a.geometry=r,a}function mp(r,i,n={}){for(const a of r){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<a[a.length-1].length;u++)if(a[a.length-1][u]!==a[0][u])throw new Error("First and last Position are not equivalent.")}return ah({type:"Polygon",coordinates:r},i,n)}function lh(r,i={}){const n={type:"FeatureCollection"};return i.id&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.features=r,n}function W0(r,i,n={}){return ah({type:"MultiPolygon",coordinates:r},i,n)}var m2=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,kd=Math.ceil,Vs=Math.floor,as="[BigNumber Error] ",Ug=as+"Number primitive has more than 15 significant digits: ",co=1e14,Oi=14,Vg=9007199254740991,Cd=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Qa=1e7,Ss=1e9;function G0(r){var i,n,a,u=F.prototype={constructor:F,toString:null,valueOf:null},d=new F(1),f=20,o=4,_=-7,S=21,T=-1e7,y=1e7,k=!1,I=1,C=0,L={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},B="0123456789abcdefghijklmnopqrstuvwxyz",N=!0;function F(j,U){var J,R,Z,ce,fe,ge,ye,he,Fe=this;if(!(Fe instanceof F))return new F(j,U);if(U==null){if(j&&j._isBigNumber===!0){Fe.s=j.s,!j.c||j.e>y?Fe.c=Fe.e=null:j.e<T?Fe.c=[Fe.e=0]:(Fe.e=j.e,Fe.c=j.c.slice());return}if((ge=typeof j=="number")&&j*0==0){if(Fe.s=1/j<0?(j=-j,-1):1,j===~~j){for(ce=0,fe=j;fe>=10;fe/=10,ce++);ce>y?Fe.c=Fe.e=null:(Fe.e=ce,Fe.c=[j]);return}he=String(j)}else{if(!m2.test(he=String(j)))return a(Fe,he,ge);Fe.s=he.charCodeAt(0)==45?(he=he.slice(1),-1):1}(ce=he.indexOf("."))>-1&&(he=he.replace(".","")),(fe=he.search(/e/i))>0?(ce<0&&(ce=fe),ce+=+he.slice(fe+1),he=he.substring(0,fe)):ce<0&&(ce=he.length)}else{if(Fn(U,2,B.length,"Base"),U==10&&N)return Fe=new F(j),$(Fe,f+Fe.e+1,o);if(he=String(j),ge=typeof j=="number"){if(j*0!=0)return a(Fe,he,ge,U);if(Fe.s=1/j<0?(he=he.slice(1),-1):1,F.DEBUG&&he.replace(/^0\.0*|\./,"").length>15)throw Error(Ug+j)}else Fe.s=he.charCodeAt(0)===45?(he=he.slice(1),-1):1;for(J=B.slice(0,U),ce=fe=0,ye=he.length;fe<ye;fe++)if(J.indexOf(R=he.charAt(fe))<0){if(R=="."){if(fe>ce){ce=ye;continue}}else if(!Z&&(he==he.toUpperCase()&&(he=he.toLowerCase())||he==he.toLowerCase()&&(he=he.toUpperCase()))){Z=!0,fe=-1,ce=0;continue}return a(Fe,String(j),ge,U)}ge=!1,he=n(he,U,10,Fe.s),(ce=he.indexOf("."))>-1?he=he.replace(".",""):ce=he.length}for(fe=0;he.charCodeAt(fe)===48;fe++);for(ye=he.length;he.charCodeAt(--ye)===48;);if(he=he.slice(fe,++ye)){if(ye-=fe,ge&&F.DEBUG&&ye>15&&(j>Vg||j!==Vs(j)))throw Error(Ug+Fe.s*j);if((ce=ce-fe-1)>y)Fe.c=Fe.e=null;else if(ce<T)Fe.c=[Fe.e=0];else{if(Fe.e=ce,Fe.c=[],fe=(ce+1)%Oi,ce<0&&(fe+=Oi),fe<ye){for(fe&&Fe.c.push(+he.slice(0,fe)),ye-=Oi;fe<ye;)Fe.c.push(+he.slice(fe,fe+=Oi));fe=Oi-(he=he.slice(fe)).length}else fe-=ye;for(;fe--;he+="0");Fe.c.push(+he)}}else Fe.c=[Fe.e=0]}F.clone=G0,F.ROUND_UP=0,F.ROUND_DOWN=1,F.ROUND_CEIL=2,F.ROUND_FLOOR=3,F.ROUND_HALF_UP=4,F.ROUND_HALF_DOWN=5,F.ROUND_HALF_EVEN=6,F.ROUND_HALF_CEIL=7,F.ROUND_HALF_FLOOR=8,F.EUCLID=9,F.config=F.set=function(j){var U,J;if(j!=null)if(typeof j=="object"){if(j.hasOwnProperty(U="DECIMAL_PLACES")&&(J=j[U],Fn(J,0,Ss,U),f=J),j.hasOwnProperty(U="ROUNDING_MODE")&&(J=j[U],Fn(J,0,8,U),o=J),j.hasOwnProperty(U="EXPONENTIAL_AT")&&(J=j[U],J&&J.pop?(Fn(J[0],-1e9,0,U),Fn(J[1],0,Ss,U),_=J[0],S=J[1]):(Fn(J,-1e9,Ss,U),_=-(S=J<0?-J:J))),j.hasOwnProperty(U="RANGE"))if(J=j[U],J&&J.pop)Fn(J[0],-1e9,-1,U),Fn(J[1],1,Ss,U),T=J[0],y=J[1];else if(Fn(J,-1e9,Ss,U),J)T=-(y=J<0?-J:J);else throw Error(as+U+" cannot be zero: "+J);if(j.hasOwnProperty(U="CRYPTO"))if(J=j[U],J===!!J)if(J)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))k=J;else throw k=!J,Error(as+"crypto unavailable");else k=J;else throw Error(as+U+" not true or false: "+J);if(j.hasOwnProperty(U="MODULO_MODE")&&(J=j[U],Fn(J,0,9,U),I=J),j.hasOwnProperty(U="POW_PRECISION")&&(J=j[U],Fn(J,0,Ss,U),C=J),j.hasOwnProperty(U="FORMAT"))if(J=j[U],typeof J=="object")L=J;else throw Error(as+U+" not an object: "+J);if(j.hasOwnProperty(U="ALPHABET"))if(J=j[U],typeof J=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(J))N=J.slice(0,10)=="0123456789",B=J;else throw Error(as+U+" invalid: "+J)}else throw Error(as+"Object expected: "+j);return{DECIMAL_PLACES:f,ROUNDING_MODE:o,EXPONENTIAL_AT:[_,S],RANGE:[T,y],CRYPTO:k,MODULO_MODE:I,POW_PRECISION:C,FORMAT:L,ALPHABET:B}},F.isBigNumber=function(j){if(!j||j._isBigNumber!==!0)return!1;if(!F.DEBUG)return!0;var U,J,R=j.c,Z=j.e,ce=j.s;e:if({}.toString.call(R)=="[object Array]"){if((ce===1||ce===-1)&&Z>=-1e9&&Z<=Ss&&Z===Vs(Z)){if(R[0]===0){if(Z===0&&R.length===1)return!0;break e}if(U=(Z+1)%Oi,U<1&&(U+=Oi),String(R[0]).length==U){for(U=0;U<R.length;U++)if(J=R[U],J<0||J>=co||J!==Vs(J))break e;if(J!==0)return!0}}}else if(R===null&&Z===null&&(ce===null||ce===1||ce===-1))return!0;throw Error(as+"Invalid BigNumber: "+j)},F.maximum=F.max=function(){return ee(arguments,-1)},F.minimum=F.min=function(){return ee(arguments,1)},F.random=function(){var j=9007199254740992,U=Math.random()*j&2097151?function(){return Vs(Math.random()*j)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(J){var R,Z,ce,fe,ge,ye=0,he=[],Fe=new F(d);if(J==null?J=f:Fn(J,0,Ss),fe=kd(J/Oi),k)if(crypto.getRandomValues){for(R=crypto.getRandomValues(new Uint32Array(fe*=2));ye<fe;)ge=R[ye]*131072+(R[ye+1]>>>11),ge>=9e15?(Z=crypto.getRandomValues(new Uint32Array(2)),R[ye]=Z[0],R[ye+1]=Z[1]):(he.push(ge%1e14),ye+=2);ye=fe/2}else if(crypto.randomBytes){for(R=crypto.randomBytes(fe*=7);ye<fe;)ge=(R[ye]&31)*281474976710656+R[ye+1]*1099511627776+R[ye+2]*4294967296+R[ye+3]*16777216+(R[ye+4]<<16)+(R[ye+5]<<8)+R[ye+6],ge>=9e15?crypto.randomBytes(7).copy(R,ye):(he.push(ge%1e14),ye+=7);ye=fe/7}else throw k=!1,Error(as+"crypto unavailable");if(!k)for(;ye<fe;)ge=U(),ge<9e15&&(he[ye++]=ge%1e14);for(fe=he[--ye],J%=Oi,fe&&J&&(ge=Cd[Oi-J],he[ye]=Vs(fe/ge)*ge);he[ye]===0;he.pop(),ye--);if(ye<0)he=[ce=0];else{for(ce=-1;he[0]===0;he.splice(0,1),ce-=Oi);for(ye=1,ge=he[0];ge>=10;ge/=10,ye++);ye<Oi&&(ce-=Oi-ye)}return Fe.e=ce,Fe.c=he,Fe}}(),F.sum=function(){for(var j=1,U=arguments,J=new F(U[0]);j<U.length;)J=J.plus(U[j++]);return J},n=function(){var j="0123456789";function U(J,R,Z,ce){for(var fe,ge=[0],ye,he=0,Fe=J.length;he<Fe;){for(ye=ge.length;ye--;ge[ye]*=R);for(ge[0]+=ce.indexOf(J.charAt(he++)),fe=0;fe<ge.length;fe++)ge[fe]>Z-1&&(ge[fe+1]==null&&(ge[fe+1]=0),ge[fe+1]+=ge[fe]/Z|0,ge[fe]%=Z)}return ge.reverse()}return function(J,R,Z,ce,fe){var ge,ye,he,Fe,Me,lt,Ze,ht,kt=J.indexOf("."),$e=f,vt=o;for(kt>=0&&(Fe=C,C=0,J=J.replace(".",""),ht=new F(R),lt=ht.pow(J.length-kt),C=Fe,ht.c=U(ha(js(lt.c),lt.e,"0"),10,Z,j),ht.e=ht.c.length),Ze=U(J,R,Z,fe?(ge=B,j):(ge=j,B)),he=Fe=Ze.length;Ze[--Fe]==0;Ze.pop());if(!Ze[0])return ge.charAt(0);if(kt<0?--he:(lt.c=Ze,lt.e=he,lt.s=ce,lt=i(lt,ht,$e,vt,Z),Ze=lt.c,Me=lt.r,he=lt.e),ye=he+$e+1,kt=Ze[ye],Fe=Z/2,Me=Me||ye<0||Ze[ye+1]!=null,Me=vt<4?(kt!=null||Me)&&(vt==0||vt==(lt.s<0?3:2)):kt>Fe||kt==Fe&&(vt==4||Me||vt==6&&Ze[ye-1]&1||vt==(lt.s<0?8:7)),ye<1||!Ze[0])J=Me?ha(ge.charAt(1),-$e,ge.charAt(0)):ge.charAt(0);else{if(Ze.length=ye,Me)for(--Z;++Ze[--ye]>Z;)Ze[ye]=0,ye||(++he,Ze=[1].concat(Ze));for(Fe=Ze.length;!Ze[--Fe];);for(kt=0,J="";kt<=Fe;J+=ge.charAt(Ze[kt++]));J=ha(J,he,ge.charAt(0))}return J}}(),i=function(){function j(R,Z,ce){var fe,ge,ye,he,Fe=0,Me=R.length,lt=Z%Qa,Ze=Z/Qa|0;for(R=R.slice();Me--;)ye=R[Me]%Qa,he=R[Me]/Qa|0,fe=Ze*ye+he*lt,ge=lt*ye+fe%Qa*Qa+Fe,Fe=(ge/ce|0)+(fe/Qa|0)+Ze*he,R[Me]=ge%ce;return Fe&&(R=[Fe].concat(R)),R}function U(R,Z,ce,fe){var ge,ye;if(ce!=fe)ye=ce>fe?1:-1;else for(ge=ye=0;ge<ce;ge++)if(R[ge]!=Z[ge]){ye=R[ge]>Z[ge]?1:-1;break}return ye}function J(R,Z,ce,fe){for(var ge=0;ce--;)R[ce]-=ge,ge=R[ce]<Z[ce]?1:0,R[ce]=ge*fe+R[ce]-Z[ce];for(;!R[0]&&R.length>1;R.splice(0,1));}return function(R,Z,ce,fe,ge){var ye,he,Fe,Me,lt,Ze,ht,kt,$e,vt,St,Zt,oi,Mi,Pi,Ti,At,He=R.s==Z.s?1:-1,Pt=R.c,ni=Z.c;if(!Pt||!Pt[0]||!ni||!ni[0])return new F(!R.s||!Z.s||(Pt?ni&&Pt[0]==ni[0]:!ni)?NaN:Pt&&Pt[0]==0||!ni?He*0:He/0);for(kt=new F(He),$e=kt.c=[],he=R.e-Z.e,He=ce+he+1,ge||(ge=co,he=qs(R.e/Oi)-qs(Z.e/Oi),He=He/Oi|0),Fe=0;ni[Fe]==(Pt[Fe]||0);Fe++);if(ni[Fe]>(Pt[Fe]||0)&&he--,He<0)$e.push(1),Me=!0;else{for(Mi=Pt.length,Ti=ni.length,Fe=0,He+=2,lt=Vs(ge/(ni[0]+1)),lt>1&&(ni=j(ni,lt,ge),Pt=j(Pt,lt,ge),Ti=ni.length,Mi=Pt.length),oi=Ti,vt=Pt.slice(0,Ti),St=vt.length;St<Ti;vt[St++]=0);At=ni.slice(),At=[0].concat(At),Pi=ni[0],ni[1]>=ge/2&&Pi++;do{if(lt=0,ye=U(ni,vt,Ti,St),ye<0){if(Zt=vt[0],Ti!=St&&(Zt=Zt*ge+(vt[1]||0)),lt=Vs(Zt/Pi),lt>1)for(lt>=ge&&(lt=ge-1),Ze=j(ni,lt,ge),ht=Ze.length,St=vt.length;U(Ze,vt,ht,St)==1;)lt--,J(Ze,Ti<ht?At:ni,ht,ge),ht=Ze.length,ye=1;else lt==0&&(ye=lt=1),Ze=ni.slice(),ht=Ze.length;if(ht<St&&(Ze=[0].concat(Ze)),J(vt,Ze,St,ge),St=vt.length,ye==-1)for(;U(ni,vt,Ti,St)<1;)lt++,J(vt,Ti<St?At:ni,St,ge),St=vt.length}else ye===0&&(lt++,vt=[0]);$e[Fe++]=lt,vt[0]?vt[St++]=Pt[oi]||0:(vt=[Pt[oi]],St=1)}while((oi++<Mi||vt[0]!=null)&&He--);Me=vt[0]!=null,$e[0]||$e.splice(0,1)}if(ge==co){for(Fe=1,He=$e[0];He>=10;He/=10,Fe++);$(kt,ce+(kt.e=Fe+he*Oi-1)+1,fe,Me)}else kt.e=he,kt.r=+Me;return kt}}();function W(j,U,J,R){var Z,ce,fe,ge,ye;if(J==null?J=o:Fn(J,0,8),!j.c)return j.toString();if(Z=j.c[0],fe=j.e,U==null)ye=js(j.c),ye=R==1||R==2&&(fe<=_||fe>=S)?Yh(ye,fe):ha(ye,fe,"0");else if(j=$(new F(j),U,J),ce=j.e,ye=js(j.c),ge=ye.length,R==1||R==2&&(U<=ce||ce<=_)){for(;ge<U;ye+="0",ge++);ye=Yh(ye,ce)}else if(U-=fe,ye=ha(ye,ce,"0"),ce+1>ge){if(--U>0)for(ye+=".";U--;ye+="0");}else if(U+=ce-ge,U>0)for(ce+1==ge&&(ye+=".");U--;ye+="0");return j.s<0&&Z?"-"+ye:ye}function ee(j,U){for(var J,R,Z=1,ce=new F(j[0]);Z<j.length;Z++)R=new F(j[Z]),(!R.s||(J=Dl(ce,R))===U||J===0&&ce.s===U)&&(ce=R);return ce}function oe(j,U,J){for(var R=1,Z=U.length;!U[--Z];U.pop());for(Z=U[0];Z>=10;Z/=10,R++);return(J=R+J*Oi-1)>y?j.c=j.e=null:J<T?j.c=[j.e=0]:(j.e=J,j.c=U),j}a=function(){var j=/^(-?)0([xbo])(?=\w[\w.]*$)/i,U=/^([^.]+)\.$/,J=/^\.([^.]+)$/,R=/^-?(Infinity|NaN)$/,Z=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(ce,fe,ge,ye){var he,Fe=ge?fe:fe.replace(Z,"");if(R.test(Fe))ce.s=isNaN(Fe)?null:Fe<0?-1:1;else{if(!ge&&(Fe=Fe.replace(j,function(Me,lt,Ze){return he=(Ze=Ze.toLowerCase())=="x"?16:Ze=="b"?2:8,!ye||ye==he?lt:Me}),ye&&(he=ye,Fe=Fe.replace(U,"$1").replace(J,"0.$1")),fe!=Fe))return new F(Fe,he);if(F.DEBUG)throw Error(as+"Not a"+(ye?" base "+ye:"")+" number: "+fe);ce.s=null}ce.c=ce.e=null}}();function $(j,U,J,R){var Z,ce,fe,ge,ye,he,Fe,Me=j.c,lt=Cd;if(Me){e:{for(Z=1,ge=Me[0];ge>=10;ge/=10,Z++);if(ce=U-Z,ce<0)ce+=Oi,fe=U,ye=Me[he=0],Fe=Vs(ye/lt[Z-fe-1]%10);else if(he=kd((ce+1)/Oi),he>=Me.length)if(R){for(;Me.length<=he;Me.push(0));ye=Fe=0,Z=1,ce%=Oi,fe=ce-Oi+1}else break e;else{for(ye=ge=Me[he],Z=1;ge>=10;ge/=10,Z++);ce%=Oi,fe=ce-Oi+Z,Fe=fe<0?0:Vs(ye/lt[Z-fe-1]%10)}if(R=R||U<0||Me[he+1]!=null||(fe<0?ye:ye%lt[Z-fe-1]),R=J<4?(Fe||R)&&(J==0||J==(j.s<0?3:2)):Fe>5||Fe==5&&(J==4||R||J==6&&(ce>0?fe>0?ye/lt[Z-fe]:0:Me[he-1])%10&1||J==(j.s<0?8:7)),U<1||!Me[0])return Me.length=0,R?(U-=j.e+1,Me[0]=lt[(Oi-U%Oi)%Oi],j.e=-U||0):Me[0]=j.e=0,j;if(ce==0?(Me.length=he,ge=1,he--):(Me.length=he+1,ge=lt[Oi-ce],Me[he]=fe>0?Vs(ye/lt[Z-fe]%lt[fe])*ge:0),R)for(;;)if(he==0){for(ce=1,fe=Me[0];fe>=10;fe/=10,ce++);for(fe=Me[0]+=ge,ge=1;fe>=10;fe/=10,ge++);ce!=ge&&(j.e++,Me[0]==co&&(Me[0]=1));break}else{if(Me[he]+=ge,Me[he]!=co)break;Me[he--]=0,ge=1}for(ce=Me.length;Me[--ce]===0;Me.pop());}j.e>y?j.c=j.e=null:j.e<T&&(j.c=[j.e=0])}return j}function re(j){var U,J=j.e;return J===null?j.toString():(U=js(j.c),U=J<=_||J>=S?Yh(U,J):ha(U,J,"0"),j.s<0?"-"+U:U)}return u.absoluteValue=u.abs=function(){var j=new F(this);return j.s<0&&(j.s=1),j},u.comparedTo=function(j,U){return Dl(this,new F(j,U))},u.decimalPlaces=u.dp=function(j,U){var J,R,Z,ce=this;if(j!=null)return Fn(j,0,Ss),U==null?U=o:Fn(U,0,8),$(new F(ce),j+ce.e+1,U);if(!(J=ce.c))return null;if(R=((Z=J.length-1)-qs(this.e/Oi))*Oi,Z=J[Z])for(;Z%10==0;Z/=10,R--);return R<0&&(R=0),R},u.dividedBy=u.div=function(j,U){return i(this,new F(j,U),f,o)},u.dividedToIntegerBy=u.idiv=function(j,U){return i(this,new F(j,U),0,1)},u.exponentiatedBy=u.pow=function(j,U){var J,R,Z,ce,fe,ge,ye,he,Fe,Me=this;if(j=new F(j),j.c&&!j.isInteger())throw Error(as+"Exponent not an integer: "+re(j));if(U!=null&&(U=new F(U)),ge=j.e>14,!Me.c||!Me.c[0]||Me.c[0]==1&&!Me.e&&Me.c.length==1||!j.c||!j.c[0])return Fe=new F(Math.pow(+re(Me),ge?j.s*(2-Jh(j)):+re(j))),U?Fe.mod(U):Fe;if(ye=j.s<0,U){if(U.c?!U.c[0]:!U.s)return new F(NaN);R=!ye&&Me.isInteger()&&U.isInteger(),R&&(Me=Me.mod(U))}else{if(j.e>9&&(Me.e>0||Me.e<-1||(Me.e==0?Me.c[0]>1||ge&&Me.c[1]>=24e7:Me.c[0]<8e13||ge&&Me.c[0]<=9999975e7)))return ce=Me.s<0&&Jh(j)?-0:0,Me.e>-1&&(ce=1/ce),new F(ye?1/ce:ce);C&&(ce=kd(C/Oi+2))}for(ge?(J=new F(.5),ye&&(j.s=1),he=Jh(j)):(Z=Math.abs(+re(j)),he=Z%2),Fe=new F(d);;){if(he){if(Fe=Fe.times(Me),!Fe.c)break;ce?Fe.c.length>ce&&(Fe.c.length=ce):R&&(Fe=Fe.mod(U))}if(Z){if(Z=Vs(Z/2),Z===0)break;he=Z%2}else if(j=j.times(J),$(j,j.e+1,1),j.e>14)he=Jh(j);else{if(Z=+re(j),Z===0)break;he=Z%2}Me=Me.times(Me),ce?Me.c&&Me.c.length>ce&&(Me.c.length=ce):R&&(Me=Me.mod(U))}return R?Fe:(ye&&(Fe=d.div(Fe)),U?Fe.mod(U):ce?$(Fe,C,o,fe):Fe)},u.integerValue=function(j){var U=new F(this);return j==null?j=o:Fn(j,0,8),$(U,U.e+1,j)},u.isEqualTo=u.eq=function(j,U){return Dl(this,new F(j,U))===0},u.isFinite=function(){return!!this.c},u.isGreaterThan=u.gt=function(j,U){return Dl(this,new F(j,U))>0},u.isGreaterThanOrEqualTo=u.gte=function(j,U){return(U=Dl(this,new F(j,U)))===1||U===0},u.isInteger=function(){return!!this.c&&qs(this.e/Oi)>this.c.length-2},u.isLessThan=u.lt=function(j,U){return Dl(this,new F(j,U))<0},u.isLessThanOrEqualTo=u.lte=function(j,U){return(U=Dl(this,new F(j,U)))===-1||U===0},u.isNaN=function(){return!this.s},u.isNegative=function(){return this.s<0},u.isPositive=function(){return this.s>0},u.isZero=function(){return!!this.c&&this.c[0]==0},u.minus=function(j,U){var J,R,Z,ce,fe=this,ge=fe.s;if(j=new F(j,U),U=j.s,!ge||!U)return new F(NaN);if(ge!=U)return j.s=-U,fe.plus(j);var ye=fe.e/Oi,he=j.e/Oi,Fe=fe.c,Me=j.c;if(!ye||!he){if(!Fe||!Me)return Fe?(j.s=-U,j):new F(Me?fe:NaN);if(!Fe[0]||!Me[0])return Me[0]?(j.s=-U,j):new F(Fe[0]?fe:o==3?-0:0)}if(ye=qs(ye),he=qs(he),Fe=Fe.slice(),ge=ye-he){for((ce=ge<0)?(ge=-ge,Z=Fe):(he=ye,Z=Me),Z.reverse(),U=ge;U--;Z.push(0));Z.reverse()}else for(R=(ce=(ge=Fe.length)<(U=Me.length))?ge:U,ge=U=0;U<R;U++)if(Fe[U]!=Me[U]){ce=Fe[U]<Me[U];break}if(ce&&(Z=Fe,Fe=Me,Me=Z,j.s=-j.s),U=(R=Me.length)-(J=Fe.length),U>0)for(;U--;Fe[J++]=0);for(U=co-1;R>ge;){if(Fe[--R]<Me[R]){for(J=R;J&&!Fe[--J];Fe[J]=U);--Fe[J],Fe[R]+=co}Fe[R]-=Me[R]}for(;Fe[0]==0;Fe.splice(0,1),--he);return Fe[0]?oe(j,Fe,he):(j.s=o==3?-1:1,j.c=[j.e=0],j)},u.modulo=u.mod=function(j,U){var J,R,Z=this;return j=new F(j,U),!Z.c||!j.s||j.c&&!j.c[0]?new F(NaN):!j.c||Z.c&&!Z.c[0]?new F(Z):(I==9?(R=j.s,j.s=1,J=i(Z,j,0,3),j.s=R,J.s*=R):J=i(Z,j,0,I),j=Z.minus(J.times(j)),!j.c[0]&&I==1&&(j.s=Z.s),j)},u.multipliedBy=u.times=function(j,U){var J,R,Z,ce,fe,ge,ye,he,Fe,Me,lt,Ze,ht,kt,$e,vt=this,St=vt.c,Zt=(j=new F(j,U)).c;if(!St||!Zt||!St[0]||!Zt[0])return!vt.s||!j.s||St&&!St[0]&&!Zt||Zt&&!Zt[0]&&!St?j.c=j.e=j.s=null:(j.s*=vt.s,!St||!Zt?j.c=j.e=null:(j.c=[0],j.e=0)),j;for(R=qs(vt.e/Oi)+qs(j.e/Oi),j.s*=vt.s,ye=St.length,Me=Zt.length,ye<Me&&(ht=St,St=Zt,Zt=ht,Z=ye,ye=Me,Me=Z),Z=ye+Me,ht=[];Z--;ht.push(0));for(kt=co,$e=Qa,Z=Me;--Z>=0;){for(J=0,lt=Zt[Z]%$e,Ze=Zt[Z]/$e|0,fe=ye,ce=Z+fe;ce>Z;)he=St[--fe]%$e,Fe=St[fe]/$e|0,ge=Ze*he+Fe*lt,he=lt*he+ge%$e*$e+ht[ce]+J,J=(he/kt|0)+(ge/$e|0)+Ze*Fe,ht[ce--]=he%kt;ht[ce]=J}return J?++R:ht.splice(0,1),oe(j,ht,R)},u.negated=function(){var j=new F(this);return j.s=-j.s||null,j},u.plus=function(j,U){var J,R=this,Z=R.s;if(j=new F(j,U),U=j.s,!Z||!U)return new F(NaN);if(Z!=U)return j.s=-U,R.minus(j);var ce=R.e/Oi,fe=j.e/Oi,ge=R.c,ye=j.c;if(!ce||!fe){if(!ge||!ye)return new F(Z/0);if(!ge[0]||!ye[0])return ye[0]?j:new F(ge[0]?R:Z*0)}if(ce=qs(ce),fe=qs(fe),ge=ge.slice(),Z=ce-fe){for(Z>0?(fe=ce,J=ye):(Z=-Z,J=ge),J.reverse();Z--;J.push(0));J.reverse()}for(Z=ge.length,U=ye.length,Z-U<0&&(J=ye,ye=ge,ge=J,U=Z),Z=0;U;)Z=(ge[--U]=ge[U]+ye[U]+Z)/co|0,ge[U]=co===ge[U]?0:ge[U]%co;return Z&&(ge=[Z].concat(ge),++fe),oe(j,ge,fe)},u.precision=u.sd=function(j,U){var J,R,Z,ce=this;if(j!=null&&j!==!!j)return Fn(j,1,Ss),U==null?U=o:Fn(U,0,8),$(new F(ce),j,U);if(!(J=ce.c))return null;if(Z=J.length-1,R=Z*Oi+1,Z=J[Z]){for(;Z%10==0;Z/=10,R--);for(Z=J[0];Z>=10;Z/=10,R++);}return j&&ce.e+1>R&&(R=ce.e+1),R},u.shiftedBy=function(j){return Fn(j,-9007199254740991,Vg),this.times("1e"+j)},u.squareRoot=u.sqrt=function(){var j,U,J,R,Z,ce=this,fe=ce.c,ge=ce.s,ye=ce.e,he=f+4,Fe=new F("0.5");if(ge!==1||!fe||!fe[0])return new F(!ge||ge<0&&(!fe||fe[0])?NaN:fe?ce:1/0);if(ge=Math.sqrt(+re(ce)),ge==0||ge==1/0?(U=js(fe),(U.length+ye)%2==0&&(U+="0"),ge=Math.sqrt(+U),ye=qs((ye+1)/2)-(ye<0||ye%2),ge==1/0?U="5e"+ye:(U=ge.toExponential(),U=U.slice(0,U.indexOf("e")+1)+ye),J=new F(U)):J=new F(ge+""),J.c[0]){for(ye=J.e,ge=ye+he,ge<3&&(ge=0);;)if(Z=J,J=Fe.times(Z.plus(i(ce,Z,he,1))),js(Z.c).slice(0,ge)===(U=js(J.c)).slice(0,ge))if(J.e<ye&&--ge,U=U.slice(ge-3,ge+1),U=="9999"||!R&&U=="4999"){if(!R&&($(Z,Z.e+f+2,0),Z.times(Z).eq(ce))){J=Z;break}he+=4,ge+=4,R=1}else{(!+U||!+U.slice(1)&&U.charAt(0)=="5")&&($(J,J.e+f+2,1),j=!J.times(J).eq(ce));break}}return $(J,J.e+f+1,o,j)},u.toExponential=function(j,U){return j!=null&&(Fn(j,0,Ss),j++),W(this,j,U,1)},u.toFixed=function(j,U){return j!=null&&(Fn(j,0,Ss),j=j+this.e+1),W(this,j,U)},u.toFormat=function(j,U,J){var R,Z=this;if(J==null)j!=null&&U&&typeof U=="object"?(J=U,U=null):j&&typeof j=="object"?(J=j,j=U=null):J=L;else if(typeof J!="object")throw Error(as+"Argument not an object: "+J);if(R=Z.toFixed(j,U),Z.c){var ce,fe=R.split("."),ge=+J.groupSize,ye=+J.secondaryGroupSize,he=J.groupSeparator||"",Fe=fe[0],Me=fe[1],lt=Z.s<0,Ze=lt?Fe.slice(1):Fe,ht=Ze.length;if(ye&&(ce=ge,ge=ye,ye=ce,ht-=ce),ge>0&&ht>0){for(ce=ht%ge||ge,Fe=Ze.substr(0,ce);ce<ht;ce+=ge)Fe+=he+Ze.substr(ce,ge);ye>0&&(Fe+=he+Ze.slice(ce)),lt&&(Fe="-"+Fe)}R=Me?Fe+(J.decimalSeparator||"")+((ye=+J.fractionGroupSize)?Me.replace(new RegExp("\\d{"+ye+"}\\B","g"),"$&"+(J.fractionGroupSeparator||"")):Me):Fe}return(J.prefix||"")+R+(J.suffix||"")},u.toFraction=function(j){var U,J,R,Z,ce,fe,ge,ye,he,Fe,Me,lt,Ze=this,ht=Ze.c;if(j!=null&&(ge=new F(j),!ge.isInteger()&&(ge.c||ge.s!==1)||ge.lt(d)))throw Error(as+"Argument "+(ge.isInteger()?"out of range: ":"not an integer: ")+re(ge));if(!ht)return new F(Ze);for(U=new F(d),he=J=new F(d),R=ye=new F(d),lt=js(ht),ce=U.e=lt.length-Ze.e-1,U.c[0]=Cd[(fe=ce%Oi)<0?Oi+fe:fe],j=!j||ge.comparedTo(U)>0?ce>0?U:he:ge,fe=y,y=1/0,ge=new F(lt),ye.c[0]=0;Fe=i(ge,U,0,1),Z=J.plus(Fe.times(R)),Z.comparedTo(j)!=1;)J=R,R=Z,he=ye.plus(Fe.times(Z=he)),ye=Z,U=ge.minus(Fe.times(Z=U)),ge=Z;return Z=i(j.minus(J),R,0,1),ye=ye.plus(Z.times(he)),J=J.plus(Z.times(R)),ye.s=he.s=Ze.s,ce=ce*2,Me=i(he,R,ce,o).minus(Ze).abs().comparedTo(i(ye,J,ce,o).minus(Ze).abs())<1?[he,R]:[ye,J],y=fe,Me},u.toNumber=function(){return+re(this)},u.toPrecision=function(j,U){return j!=null&&Fn(j,1,Ss),W(this,j,U,2)},u.toString=function(j){var U,J=this,R=J.s,Z=J.e;return Z===null?R?(U="Infinity",R<0&&(U="-"+U)):U="NaN":(j==null?U=Z<=_||Z>=S?Yh(js(J.c),Z):ha(js(J.c),Z,"0"):j===10&&N?(J=$(new F(J),f+Z+1,o),U=ha(js(J.c),J.e,"0")):(Fn(j,2,B.length,"Base"),U=n(ha(js(J.c),Z,"0"),10,j,R,!0)),R<0&&J.c[0]&&(U="-"+U)),U},u.valueOf=u.toJSON=function(){return re(this)},u._isBigNumber=!0,u[Symbol.toStringTag]="BigNumber",u[Symbol.for("nodejs.util.inspect.custom")]=u.valueOf,r!=null&&F.set(r),F}function qs(r){var i=r|0;return r>0||r===i?i:i-1}function js(r){for(var i,n,a=1,u=r.length,d=r[0]+"";a<u;){for(i=r[a++]+"",n=Oi-i.length;n--;i="0"+i);d+=i}for(u=d.length;d.charCodeAt(--u)===48;);return d.slice(0,u+1||1)}function Dl(r,i){var n,a,u=r.c,d=i.c,f=r.s,o=i.s,_=r.e,S=i.e;if(!f||!o)return null;if(n=u&&!u[0],a=d&&!d[0],n||a)return n?a?0:-o:f;if(f!=o)return f;if(n=f<0,a=_==S,!u||!d)return a?0:!u^n?1:-1;if(!a)return _>S^n?1:-1;for(o=(_=u.length)<(S=d.length)?_:S,f=0;f<o;f++)if(u[f]!=d[f])return u[f]>d[f]^n?1:-1;return _==S?0:_>S^n?1:-1}function Fn(r,i,n,a){if(r<i||r>n||r!==Vs(r))throw Error(as+(a||"Argument")+(typeof r=="number"?r<i||r>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(r))}function Jh(r){var i=r.c.length-1;return qs(r.e/Oi)==i&&r.c[i]%2!=0}function Yh(r,i){return(r.length>1?r.charAt(0)+"."+r.slice(1):r)+(i<0?"e":"e+")+i}function ha(r,i,n){var a,u;if(i<0){for(u=n+".";++i;u+=n);r=u+r}else if(a=r.length,++i>a){for(u=n,i-=a;--i;u+=n);r+=u}else i<a&&(r=r.slice(0,i)+"."+r.slice(i));return r}var Do=G0(),g2=class{constructor(r){pi(this,"key"),pi(this,"left",null),pi(this,"right",null),this.key=r}},Zu=class extends g2{constructor(r){super(r)}},_2=class{constructor(){pi(this,"size",0),pi(this,"modificationCount",0),pi(this,"splayCount",0)}splay(r){const i=this.root;if(i==null)return this.compare(r,r),-1;let n=null,a=null,u=null,d=null,f=i;const o=this.compare;let _;for(;;)if(_=o(f.key,r),_>0){let S=f.left;if(S==null||(_=o(S.key,r),_>0&&(f.left=S.right,S.right=f,f=S,S=f.left,S==null)))break;n==null?a=f:n.left=f,n=f,f=S}else if(_<0){let S=f.right;if(S==null||(_=o(S.key,r),_<0&&(f.right=S.left,S.left=f,f=S,S=f.right,S==null)))break;u==null?d=f:u.right=f,u=f,f=S}else break;return u!=null&&(u.right=f.left,f.left=d),n!=null&&(n.left=f.right,f.right=a),this.root!==f&&(this.root=f,this.splayCount++),_}splayMin(r){let i=r,n=i.left;for(;n!=null;){const a=n;i.left=a.right,a.right=i,i=a,n=i.left}return i}splayMax(r){let i=r,n=i.right;for(;n!=null;){const a=n;i.right=a.left,a.left=i,i=a,n=i.right}return i}_delete(r){if(this.root==null||this.splay(r)!=0)return null;let i=this.root;const n=i,a=i.left;if(this.size--,a==null)this.root=i.right;else{const u=i.right;i=this.splayMax(a),i.right=u,this.root=i}return this.modificationCount++,n}addNewRoot(r,i){this.size++,this.modificationCount++;const n=this.root;if(n==null){this.root=r;return}i<0?(r.left=n,r.right=n.right,n.right=null):(r.right=n,r.left=n.left,n.left=null),this.root=r}_first(){const r=this.root;return r==null?null:(this.root=this.splayMin(r),this.root)}_last(){const r=this.root;return r==null?null:(this.root=this.splayMax(r),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(r){return this.validKey(r)&&this.splay(r)==0}defaultCompare(){return(r,i)=>r<i?-1:r>i?1:0}wrap(){return{getRoot:()=>this.root,setRoot:r=>{this.root=r},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:r=>{this.splayCount=r},splay:r=>this.splay(r),has:r=>this.has(r)}}},qg,Zg,cf=class Ku extends _2{constructor(i,n){super(),pi(this,"root",null),pi(this,"compare"),pi(this,"validKey"),pi(this,qg,"[object Set]"),this.compare=i??this.defaultCompare(),this.validKey=n??(a=>a!=null&&a!=null)}delete(i){return this.validKey(i)?this._delete(i)!=null:!1}deleteAll(i){for(const n of i)this.delete(n)}forEach(i){const n=this[Symbol.iterator]();let a;for(;a=n.next(),!a.done;)i(a.value,a.value,this)}add(i){const n=this.splay(i);return n!=0&&this.addNewRoot(new Zu(i),n),this}addAndReturn(i){const n=this.splay(i);return n!=0&&this.addNewRoot(new Zu(i),n),this.root.key}addAll(i){for(const n of i)this.add(n)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(i){if(i==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(i)<0)return this.root.key;let n=this.root.left;if(n==null)return null;let a=n.right;for(;a!=null;)n=a,a=n.right;return n.key}firstAfter(i){if(i==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(i)>0)return this.root.key;let n=this.root.right;if(n==null)return null;let a=n.left;for(;a!=null;)n=a,a=n.left;return n.key}retainAll(i){const n=new Ku(this.compare,this.validKey),a=this.modificationCount;for(const u of i){if(a!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(u)&&this.splay(u)==0&&n.add(this.root.key)}n.size!=this.size&&(this.root=n.root,this.size=n.size,this.modificationCount++)}lookup(i){return!this.validKey(i)||this.splay(i)!=0?null:this.root.key}intersection(i){const n=new Ku(this.compare,this.validKey);for(const a of this)i.has(a)&&n.add(a);return n}difference(i){const n=new Ku(this.compare,this.validKey);for(const a of this)i.has(a)||n.add(a);return n}union(i){const n=this.clone();return n.addAll(i),n}clone(){const i=new Ku(this.compare,this.validKey);return i.size=this.size,i.root=this.copyNode(this.root),i}copyNode(i){if(i==null)return null;function n(u,d){let f,o;do{if(f=u.left,o=u.right,f!=null){const _=new Zu(f.key);d.left=_,n(f,_)}if(o!=null){const _=new Zu(o.key);d.right=_,u=o,d=_}}while(o!=null)}const a=new Zu(i.key);return n(i,a),a}toSet(){return this.clone()}entries(){return new b2(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Zg=Symbol.iterator,qg=Symbol.toStringTag,Zg)](){return new y2(this.wrap())}},H0=class{constructor(r){pi(this,"tree"),pi(this,"path",new Array),pi(this,"modificationCount",null),pi(this,"splayCount"),this.tree=r,this.splayCount=r.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const r=this.path[this.path.length-1];return this.getValue(r)}rebuildPath(r){this.path.splice(0,this.path.length),this.tree.splay(r),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(r){for(;r!=null;)this.path.push(r),r=r.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let n=this.tree.getRoot();for(;n!=null;)this.path.push(n),n=n.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let r=this.path[this.path.length-1],i=r.right;if(i!=null){for(;i!=null;)this.path.push(i),i=i.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===r;)r=this.path.pop();return this.path.length>0}},y2=class extends H0{getValue(r){return r.key}},b2=class extends H0{getValue(r){return[r.key,r.key]}},X0=r=>()=>r,Vd=r=>{const i=r?(n,a)=>a.minus(n).abs().isLessThanOrEqualTo(r):X0(!1);return(n,a)=>i(n,a)?0:n.comparedTo(a)};function v2(r){const i=r?(n,a,u,d,f)=>n.exponentiatedBy(2).isLessThanOrEqualTo(d.minus(a).exponentiatedBy(2).plus(f.minus(u).exponentiatedBy(2)).times(r)):X0(!1);return(n,a,u)=>{const d=n.x,f=n.y,o=u.x,_=u.y,S=f.minus(_).times(a.x.minus(o)).minus(d.minus(o).times(a.y.minus(_)));return i(S,d,f,o,_)?0:S.comparedTo(0)}}var w2=r=>r,x2=r=>{if(r){const i=new cf(Vd(r)),n=new cf(Vd(r)),a=(d,f)=>f.addAndReturn(d),u=d=>({x:a(d.x,i),y:a(d.y,n)});return u({x:new Do(0),y:new Do(0)}),u}return w2},qd=r=>({set:i=>{pa=qd(i)},reset:()=>qd(r),compare:Vd(r),snap:x2(r),orient:v2(r)}),pa=qd(),Wu=(r,i)=>r.ll.x.isLessThanOrEqualTo(i.x)&&i.x.isLessThanOrEqualTo(r.ur.x)&&r.ll.y.isLessThanOrEqualTo(i.y)&&i.y.isLessThanOrEqualTo(r.ur.y),Zd=(r,i)=>{if(i.ur.x.isLessThan(r.ll.x)||r.ur.x.isLessThan(i.ll.x)||i.ur.y.isLessThan(r.ll.y)||r.ur.y.isLessThan(i.ll.y))return null;const n=r.ll.x.isLessThan(i.ll.x)?i.ll.x:r.ll.x,a=r.ur.x.isLessThan(i.ur.x)?r.ur.x:i.ur.x,u=r.ll.y.isLessThan(i.ll.y)?i.ll.y:r.ll.y,d=r.ur.y.isLessThan(i.ur.y)?r.ur.y:i.ur.y;return{ll:{x:n,y:u},ur:{x:a,y:d}}},rf=(r,i)=>r.x.times(i.y).minus(r.y.times(i.x)),K0=(r,i)=>r.x.times(i.x).plus(r.y.times(i.y)),uf=r=>K0(r,r).sqrt(),S2=(r,i,n)=>{const a={x:i.x.minus(r.x),y:i.y.minus(r.y)},u={x:n.x.minus(r.x),y:n.y.minus(r.y)};return rf(u,a).div(uf(u)).div(uf(a))},T2=(r,i,n)=>{const a={x:i.x.minus(r.x),y:i.y.minus(r.y)},u={x:n.x.minus(r.x),y:n.y.minus(r.y)};return K0(u,a).div(uf(u)).div(uf(a))},Wg=(r,i,n)=>i.y.isZero()?null:{x:r.x.plus(i.x.div(i.y).times(n.minus(r.y))),y:n},Gg=(r,i,n)=>i.x.isZero()?null:{x:n,y:r.y.plus(i.y.div(i.x).times(n.minus(r.x)))},k2=(r,i,n,a)=>{if(i.x.isZero())return Gg(n,a,r.x);if(a.x.isZero())return Gg(r,i,n.x);if(i.y.isZero())return Wg(n,a,r.y);if(a.y.isZero())return Wg(r,i,n.y);const u=rf(i,a);if(u.isZero())return null;const d={x:n.x.minus(r.x),y:n.y.minus(r.y)},f=rf(d,i).div(u),o=rf(d,a).div(u),_=r.x.plus(o.times(i.x)),S=n.x.plus(f.times(a.x)),T=r.y.plus(o.times(i.y)),y=n.y.plus(f.times(a.y)),k=_.plus(S).div(2),I=T.plus(y).div(2);return{x:k,y:I}},Oo=class J0{constructor(i,n){pi(this,"point"),pi(this,"isLeft"),pi(this,"segment"),pi(this,"otherSE"),pi(this,"consumedBy"),i.events===void 0?i.events=[this]:i.events.push(this),this.point=i,this.isLeft=n}static compare(i,n){const a=J0.comparePoints(i.point,n.point);return a!==0?a:(i.point!==n.point&&i.link(n),i.isLeft!==n.isLeft?i.isLeft?1:-1:ff.compare(i.segment,n.segment))}static comparePoints(i,n){return i.x.isLessThan(n.x)?-1:i.x.isGreaterThan(n.x)?1:i.y.isLessThan(n.y)?-1:i.y.isGreaterThan(n.y)?1:0}link(i){if(i.point===this.point)throw new Error("Tried to link already linked events");const n=i.point.events;for(let a=0,u=n.length;a<u;a++){const d=n[a];this.point.events.push(d),d.point=this.point}this.checkForConsuming()}checkForConsuming(){const i=this.point.events.length;for(let n=0;n<i;n++){const a=this.point.events[n];if(a.segment.consumedBy===void 0)for(let u=n+1;u<i;u++){const d=this.point.events[u];d.consumedBy===void 0&&a.otherSE.point.events===d.otherSE.point.events&&a.segment.consume(d.segment)}}}getAvailableLinkedEvents(){const i=[];for(let n=0,a=this.point.events.length;n<a;n++){const u=this.point.events[n];u!==this&&!u.segment.ringOut&&u.segment.isInResult()&&i.push(u)}return i}getLeftmostComparator(i){const n=new Map,a=u=>{const d=u.otherSE;n.set(u,{sine:S2(this.point,i.point,d.point),cosine:T2(this.point,i.point,d.point)})};return(u,d)=>{n.has(u)||a(u),n.has(d)||a(d);const{sine:f,cosine:o}=n.get(u),{sine:_,cosine:S}=n.get(d);return f.isGreaterThanOrEqualTo(0)&&_.isGreaterThanOrEqualTo(0)?o.isLessThan(S)?1:o.isGreaterThan(S)?-1:0:f.isLessThan(0)&&_.isLessThan(0)?o.isLessThan(S)?-1:o.isGreaterThan(S)?1:0:_.isLessThan(f)?-1:_.isGreaterThan(f)?1:0}}},C2=class Wd{constructor(i){pi(this,"events"),pi(this,"poly"),pi(this,"_isExteriorRing"),pi(this,"_enclosingRing"),this.events=i;for(let n=0,a=i.length;n<a;n++)i[n].segment.ringOut=this;this.poly=null}static factory(i){const n=[];for(let a=0,u=i.length;a<u;a++){const d=i[a];if(!d.isInResult()||d.ringOut)continue;let f=null,o=d.leftSE,_=d.rightSE;const S=[o],T=o.point,y=[];for(;f=o,o=_,S.push(o),o.point!==T;)for(;;){const k=o.getAvailableLinkedEvents();if(k.length===0){const L=S[0].point,B=S[S.length-1].point;throw new Error(`Unable to complete output ring starting at [${L.x}, ${L.y}]. Last matching segment found ends at [${B.x}, ${B.y}].`)}if(k.length===1){_=k[0].otherSE;break}let I=null;for(let L=0,B=y.length;L<B;L++)if(y[L].point===o.point){I=L;break}if(I!==null){const L=y.splice(I)[0],B=S.splice(L.index);B.unshift(B[0].otherSE),n.push(new Wd(B.reverse()));continue}y.push({index:S.length,point:o.point});const C=o.getLeftmostComparator(f);_=k.sort(C)[0].otherSE;break}n.push(new Wd(S))}return n}getGeom(){let i=this.events[0].point;const n=[i];for(let S=1,T=this.events.length-1;S<T;S++){const y=this.events[S].point,k=this.events[S+1].point;pa.orient(y,i,k)!==0&&(n.push(y),i=y)}if(n.length===1)return null;const a=n[0],u=n[1];pa.orient(a,i,u)===0&&n.shift(),n.push(n[0]);const d=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:n.length-1,o=this.isExteriorRing()?n.length:-1,_=[];for(let S=f;S!=o;S+=d)_.push([n[S].x.toNumber(),n[S].y.toNumber()]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const i=this.enclosingRing();this._isExteriorRing=i?!i.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var i,n;let a=this.events[0];for(let f=1,o=this.events.length;f<o;f++){const _=this.events[f];Oo.compare(a,_)>0&&(a=_)}let u=a.segment.prevInResult(),d=u?u.prevInResult():null;for(;;){if(!u)return null;if(!d)return u.ringOut;if(d.ringOut!==u.ringOut)return((i=d.ringOut)==null?void 0:i.enclosingRing())!==u.ringOut?u.ringOut:(n=u.ringOut)==null?void 0:n.enclosingRing();u=d.prevInResult(),d=u?u.prevInResult():null}}},Hg=class{constructor(r){pi(this,"exteriorRing"),pi(this,"interiorRings"),this.exteriorRing=r,r.poly=this,this.interiorRings=[]}addInterior(r){this.interiorRings.push(r),r.poly=this}getGeom(){const r=this.exteriorRing.getGeom();if(r===null)return null;const i=[r];for(let n=0,a=this.interiorRings.length;n<a;n++){const u=this.interiorRings[n].getGeom();u!==null&&i.push(u)}return i}},E2=class{constructor(r){pi(this,"rings"),pi(this,"polys"),this.rings=r,this.polys=this._composePolys(r)}getGeom(){const r=[];for(let i=0,n=this.polys.length;i<n;i++){const a=this.polys[i].getGeom();a!==null&&r.push(a)}return r}_composePolys(r){var i;const n=[];for(let a=0,u=r.length;a<u;a++){const d=r[a];if(!d.poly)if(d.isExteriorRing())n.push(new Hg(d));else{const f=d.enclosingRing();f!=null&&f.poly||n.push(new Hg(f)),(i=f==null?void 0:f.poly)==null||i.addInterior(d)}}return n}},I2=class{constructor(r,i=ff.compare){pi(this,"queue"),pi(this,"tree"),pi(this,"segments"),this.queue=r,this.tree=new cf(i),this.segments=[]}process(r){const i=r.segment,n=[];if(r.consumedBy)return r.isLeft?this.queue.delete(r.otherSE):this.tree.delete(i),n;r.isLeft&&this.tree.add(i);let a=i,u=i;do a=this.tree.lastBefore(a);while(a!=null&&a.consumedBy!=null);do u=this.tree.firstAfter(u);while(u!=null&&u.consumedBy!=null);if(r.isLeft){let d=null;if(a){const o=a.getIntersection(i);if(o!==null&&(i.isAnEndpoint(o)||(d=o),!a.isAnEndpoint(o))){const _=this._splitSafely(a,o);for(let S=0,T=_.length;S<T;S++)n.push(_[S])}}let f=null;if(u){const o=u.getIntersection(i);if(o!==null&&(i.isAnEndpoint(o)||(f=o),!u.isAnEndpoint(o))){const _=this._splitSafely(u,o);for(let S=0,T=_.length;S<T;S++)n.push(_[S])}}if(d!==null||f!==null){let o=null;d===null?o=f:f===null?o=d:o=Oo.comparePoints(d,f)<=0?d:f,this.queue.delete(i.rightSE),n.push(i.rightSE);const _=i.split(o);for(let S=0,T=_.length;S<T;S++)n.push(_[S])}n.length>0?(this.tree.delete(i),n.push(r)):(this.segments.push(i),i.prev=a)}else{if(a&&u){const d=a.getIntersection(u);if(d!==null){if(!a.isAnEndpoint(d)){const f=this._splitSafely(a,d);for(let o=0,_=f.length;o<_;o++)n.push(f[o])}if(!u.isAnEndpoint(d)){const f=this._splitSafely(u,d);for(let o=0,_=f.length;o<_;o++)n.push(f[o])}}}this.tree.delete(i)}return n}_splitSafely(r,i){this.tree.delete(r);const n=r.rightSE;this.queue.delete(n);const a=r.split(i);return a.push(n),r.consumedBy===void 0&&this.tree.add(r),a}},A2=class{constructor(){pi(this,"type"),pi(this,"numMultiPolys")}run(r,i,n){Ju.type=r;const a=[new Kg(i,!0)];for(let _=0,S=n.length;_<S;_++)a.push(new Kg(n[_],!1));if(Ju.numMultiPolys=a.length,Ju.type==="difference"){const _=a[0];let S=1;for(;S<a.length;)Zd(a[S].bbox,_.bbox)!==null?S++:a.splice(S,1)}if(Ju.type==="intersection")for(let _=0,S=a.length;_<S;_++){const T=a[_];for(let y=_+1,k=a.length;y<k;y++)if(Zd(T.bbox,a[y].bbox)===null)return[]}const u=new cf(Oo.compare);for(let _=0,S=a.length;_<S;_++){const T=a[_].getSweepEvents();for(let y=0,k=T.length;y<k;y++)u.add(T[y])}const d=new I2(u);let f=null;for(u.size!=0&&(f=u.first(),u.delete(f));f;){const _=d.process(f);for(let S=0,T=_.length;S<T;S++){const y=_[S];y.consumedBy===void 0&&u.add(y)}u.size!=0?(f=u.first(),u.delete(f)):f=null}pa.reset();const o=C2.factory(d.segments);return new E2(o).getGeom()}},Ju=new A2,hf=Ju,M2=0,ff=class sf{constructor(i,n,a,u){pi(this,"id"),pi(this,"leftSE"),pi(this,"rightSE"),pi(this,"rings"),pi(this,"windings"),pi(this,"ringOut"),pi(this,"consumedBy"),pi(this,"prev"),pi(this,"_prevInResult"),pi(this,"_beforeState"),pi(this,"_afterState"),pi(this,"_isInResult"),this.id=++M2,this.leftSE=i,i.segment=this,i.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=i,this.rings=a,this.windings=u}static compare(i,n){const a=i.leftSE.point.x,u=n.leftSE.point.x,d=i.rightSE.point.x,f=n.rightSE.point.x;if(f.isLessThan(a))return 1;if(d.isLessThan(u))return-1;const o=i.leftSE.point.y,_=n.leftSE.point.y,S=i.rightSE.point.y,T=n.rightSE.point.y;if(a.isLessThan(u)){if(_.isLessThan(o)&&_.isLessThan(S))return 1;if(_.isGreaterThan(o)&&_.isGreaterThan(S))return-1;const y=i.comparePoint(n.leftSE.point);if(y<0)return 1;if(y>0)return-1;const k=n.comparePoint(i.rightSE.point);return k!==0?k:-1}if(a.isGreaterThan(u)){if(o.isLessThan(_)&&o.isLessThan(T))return-1;if(o.isGreaterThan(_)&&o.isGreaterThan(T))return 1;const y=n.comparePoint(i.leftSE.point);if(y!==0)return y;const k=i.comparePoint(n.rightSE.point);return k<0?1:k>0?-1:1}if(o.isLessThan(_))return-1;if(o.isGreaterThan(_))return 1;if(d.isLessThan(f)){const y=n.comparePoint(i.rightSE.point);if(y!==0)return y}if(d.isGreaterThan(f)){const y=i.comparePoint(n.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(!d.eq(f)){const y=S.minus(o),k=d.minus(a),I=T.minus(_),C=f.minus(u);if(y.isGreaterThan(k)&&I.isLessThan(C))return 1;if(y.isLessThan(k)&&I.isGreaterThan(C))return-1}return d.isGreaterThan(f)?1:d.isLessThan(f)||S.isLessThan(T)?-1:S.isGreaterThan(T)?1:i.id<n.id?-1:i.id>n.id?1:0}static fromRing(i,n,a){let u,d,f;const o=Oo.comparePoints(i,n);if(o<0)u=i,d=n,f=1;else if(o>0)u=n,d=i,f=-1;else throw new Error(`Tried to create degenerate segment at [${i.x}, ${i.y}]`);const _=new Oo(u,!0),S=new Oo(d,!1);return new sf(_,S,[a],[f])}replaceRightSE(i){this.rightSE=i,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const i=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:i.isLessThan(n)?i:n},ur:{x:this.rightSE.point.x,y:i.isGreaterThan(n)?i:n}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(i){return i.x.eq(this.leftSE.point.x)&&i.y.eq(this.leftSE.point.y)||i.x.eq(this.rightSE.point.x)&&i.y.eq(this.rightSE.point.y)}comparePoint(i){return pa.orient(this.leftSE.point,i,this.rightSE.point)}getIntersection(i){const n=this.bbox(),a=i.bbox(),u=Zd(n,a);if(u===null)return null;const d=this.leftSE.point,f=this.rightSE.point,o=i.leftSE.point,_=i.rightSE.point,S=Wu(n,o)&&this.comparePoint(o)===0,T=Wu(a,d)&&i.comparePoint(d)===0,y=Wu(n,_)&&this.comparePoint(_)===0,k=Wu(a,f)&&i.comparePoint(f)===0;if(T&&S)return k&&!y?f:!k&&y?_:null;if(T)return y&&d.x.eq(_.x)&&d.y.eq(_.y)?null:d;if(S)return k&&f.x.eq(o.x)&&f.y.eq(o.y)?null:o;if(k&&y)return null;if(k)return f;if(y)return _;const I=k2(d,this.vector(),o,i.vector());return I===null||!Wu(u,I)?null:pa.snap(I)}split(i){const n=[],a=i.events!==void 0,u=new Oo(i,!0),d=new Oo(i,!1),f=this.rightSE;this.replaceRightSE(d),n.push(d),n.push(u);const o=new sf(u,f,this.rings.slice(),this.windings.slice());return Oo.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),Oo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),a&&(u.checkForConsuming(),d.checkForConsuming()),n}swapEvents(){const i=this.rightSE;this.rightSE=this.leftSE,this.leftSE=i,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,a=this.windings.length;n<a;n++)this.windings[n]*=-1}consume(i){let n=this,a=i;for(;n.consumedBy;)n=n.consumedBy;for(;a.consumedBy;)a=a.consumedBy;const u=sf.compare(n,a);if(u!==0){if(u>0){const d=n;n=a,a=d}if(n.prev===a){const d=n;n=a,a=d}for(let d=0,f=a.rings.length;d<f;d++){const o=a.rings[d],_=a.windings[d],S=n.rings.indexOf(o);S===-1?(n.rings.push(o),n.windings.push(_)):n.windings[S]+=_}a.rings=null,a.windings=null,a.consumedBy=n,a.leftSE.consumedBy=n.leftSE,a.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const i=this.prev.consumedBy||this.prev;this._beforeState=i.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const i=this.beforeState();this._afterState={rings:i.rings.slice(0),windings:i.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,a=this._afterState.windings,u=this._afterState.multiPolys;for(let o=0,_=this.rings.length;o<_;o++){const S=this.rings[o],T=this.windings[o],y=n.indexOf(S);y===-1?(n.push(S),a.push(T)):a[y]+=T}const d=[],f=[];for(let o=0,_=n.length;o<_;o++){if(a[o]===0)continue;const S=n[o],T=S.poly;if(f.indexOf(T)===-1)if(S.isExterior)d.push(T);else{f.indexOf(T)===-1&&f.push(T);const y=d.indexOf(S.poly);y!==-1&&d.splice(y,1)}}for(let o=0,_=d.length;o<_;o++){const S=d[o].multiPoly;u.indexOf(S)===-1&&u.push(S)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const i=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(hf.type){case"union":{const a=i.length===0,u=n.length===0;this._isInResult=a!==u;break}case"intersection":{let a,u;i.length<n.length?(a=i.length,u=n.length):(a=n.length,u=i.length),this._isInResult=u===hf.numMultiPolys&&a<u;break}case"xor":{const a=Math.abs(i.length-n.length);this._isInResult=a%2===1;break}case"difference":{const a=u=>u.length===1&&u[0].isSubject;this._isInResult=a(i)!==a(n);break}}return this._isInResult}},Xg=class{constructor(r,i,n){if(pi(this,"poly"),pi(this,"isExterior"),pi(this,"segments"),pi(this,"bbox"),!Array.isArray(r)||r.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=n,this.segments=[],typeof r[0][0]!="number"||typeof r[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=pa.snap({x:new Do(r[0][0]),y:new Do(r[0][1])});this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let u=a;for(let d=1,f=r.length;d<f;d++){if(typeof r[d][0]!="number"||typeof r[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const o=pa.snap({x:new Do(r[d][0]),y:new Do(r[d][1])});o.x.eq(u.x)&&o.y.eq(u.y)||(this.segments.push(ff.fromRing(u,o,this)),o.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=o.x),o.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=o.y),o.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=o.x),o.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=o.y),u=o)}(!a.x.eq(u.x)||!a.y.eq(u.y))&&this.segments.push(ff.fromRing(u,a,this))}getSweepEvents(){const r=[];for(let i=0,n=this.segments.length;i<n;i++){const a=this.segments[i];r.push(a.leftSE),r.push(a.rightSE)}return r}},P2=class{constructor(r,i){if(pi(this,"multiPoly"),pi(this,"exteriorRing"),pi(this,"interiorRings"),pi(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Xg(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,a=r.length;n<a;n++){const u=new Xg(r[n],this,!1);u.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=i}getSweepEvents(){const r=this.exteriorRing.getSweepEvents();for(let i=0,n=this.interiorRings.length;i<n;i++){const a=this.interiorRings[i].getSweepEvents();for(let u=0,d=a.length;u<d;u++)r.push(a[u])}return r}},Kg=class{constructor(r,i){if(pi(this,"isSubject"),pi(this,"polys"),pi(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof r[0][0][0]=="number"&&(r=[r])}catch{}this.polys=[],this.bbox={ll:{x:new Do(Number.POSITIVE_INFINITY),y:new Do(Number.POSITIVE_INFINITY)},ur:{x:new Do(Number.NEGATIVE_INFINITY),y:new Do(Number.NEGATIVE_INFINITY)}};for(let n=0,a=r.length;n<a;n++){const u=new P2(r[n],this);u.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=i}getSweepEvents(){const r=[];for(let i=0,n=this.polys.length;i<n;i++){const a=this.polys[i].getSweepEvents();for(let u=0,d=a.length;u<d;u++)r.push(a[u])}return r}},L2=(r,...i)=>hf.run("union",r,i),z2=(r,...i)=>hf.run("difference",r,i);pa.set;function Y0(r,i,n){if(r!==null)for(var a,u,d,f,o,_,S,T=0,y=0,k,I=r.type,C=I==="FeatureCollection",L=I==="Feature",B=C?r.features.length:1,N=0;N<B;N++){S=C?r.features[N].geometry:L?r.geometry:r,k=S?S.type==="GeometryCollection":!1,o=k?S.geometries.length:1;for(var F=0;F<o;F++){var W=0,ee=0;if(f=k?S.geometries[F]:S,f!==null){_=f.coordinates;var oe=f.type;switch(T=0,oe){case null:break;case"Point":if(i(_,y,N,W,ee)===!1)return!1;y++,W++;break;case"LineString":case"MultiPoint":for(a=0;a<_.length;a++){if(i(_[a],y,N,W,ee)===!1)return!1;y++,oe==="MultiPoint"&&W++}oe==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(a=0;a<_.length;a++){for(u=0;u<_[a].length-T;u++){if(i(_[a][u],y,N,W,ee)===!1)return!1;y++}oe==="MultiLineString"&&W++,oe==="Polygon"&&ee++}oe==="Polygon"&&W++;break;case"MultiPolygon":for(a=0;a<_.length;a++){for(ee=0,u=0;u<_[a].length;u++){for(d=0;d<_[a][u].length-T;d++){if(i(_[a][u][d],y,N,W,ee)===!1)return!1;y++}ee++}W++}break;case"GeometryCollection":for(a=0;a<f.geometries.length;a++)if(Y0(f.geometries[a],i)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function gp(r,i){var n,a,u,d,f,o,_,S,T,y,k=0,I=r.type==="FeatureCollection",C=r.type==="Feature",L=I?r.features.length:1;for(n=0;n<L;n++){for(o=I?r.features[n].geometry:C?r.geometry:r,S=I?r.features[n].properties:C?r.properties:{},T=I?r.features[n].bbox:C?r.bbox:void 0,y=I?r.features[n].id:C?r.id:void 0,_=o?o.type==="GeometryCollection":!1,f=_?o.geometries.length:1,u=0;u<f;u++){if(d=_?o.geometries[u]:o,d===null){if(i(null,k,S,T,y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(d,k,S,T,y)===!1)return!1;break}case"GeometryCollection":{for(a=0;a<d.geometries.length;a++)if(i(d.geometries[a],k,S,T,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function O2(r,i){gp(r,function(n,a,u,d,f){var o=n===null?null:n.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return i(ah(n,u,{bbox:d,id:f}),a,0)===!1?!1:void 0}var _;switch(o){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var S=0;S<n.coordinates.length;S++){var T=n.coordinates[S],y={type:_,coordinates:T};if(i(ah(y,u),a,S)===!1)return!1}})}function D2(r,i={}){const n=[];if(gp(r,u=>{n.push(u.coordinates)}),n.length<2)throw new Error("Must have at least 2 geometries");const a=L2(n[0],...n.slice(1));return a.length===0?null:a.length===1?mp(a[0],i.properties):W0(a,i.properties)}var Q0=D2;function F2(r,i={}){if(r.bbox!=null&&i.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return Y0(r,a=>{n[0]>a[0]&&(n[0]=a[0]),n[1]>a[1]&&(n[1]=a[1]),n[2]<a[0]&&(n[2]=a[0]),n[3]<a[1]&&(n[3]=a[1])}),n}var Jg=F2;function R2(r){const i=[];if(gp(r,u=>{i.push(u.coordinates)}),i.length<2)throw new Error("Must have at least two features");const n=r.features[0].properties||{},a=z2(i[0],...i.slice(1));return a.length===0?null:a.length===1?mp(a[0],n):W0(a,n)}var B2=R2;function N2(r){if(!r)throw new Error("geojson is required");var i=[];return O2(r,function(n){i.push(n)}),lh(i)}var j2=N2;function Yg(r,i){const n=B2(lh([mp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!n)return;n.properties={isMask:!0};const a=jg(Jg(r)),u=(a[2]-a[0])/360/1e3,d=a[0]<-180,f=a[2]>180,o=j2(r);if(o.features.length>1&&(d||f))for(const _ of o.features){const S=jg(Jg(_));if(f&&S[0]<-180+u)for(const T of _.geometry.coordinates)for(const y of T)y[0]+=360-u;if(d&&S[2]>180-u)for(const T of _.geometry.coordinates)for(const y of T)y[0]-=360-u}i(lh([o.features.length<2?r:Q0(o)??r,n]))}const Qg={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Qh="mtlr-gc-full-geom",$g="mtlr-gc-full-geom-fill",e_="mtlr-gc-full-geom-line";function U2(r,i,n=!0,a=!0,u={},d={},f=Qg){let o;const _=[];let S,T,y;function k(){if(!r.loaded){r.once("load",k);return}const B=f?f===!0?Qg:f:void 0;if(!(B!=null&&B.fill)&&!(B!=null&&B.line))return;const N=r.getSource(Qh);if(N)N.setData(y??lh([]));else if(y)r.addSource(Qh,{type:"geojson",data:y});else return;!r.getLayer($g)&&B!=null&&B.fill&&r.addLayer({...B==null?void 0:B.fill,id:$g,type:"fill",source:Qh}),!r.getLayer(e_)&&B!=null&&B.line&&r.addLayer({...B==null?void 0:B.line,id:e_,type:"line",source:Qh})}function I(B){y=B,k()}r.on("styledata",()=>{setTimeout(()=>{y&&k()})});const C=B=>{o==null||o({type:"mapClick",coordinates:[B.lngLat.lng,B.lngLat.lat]})};function L(B=!1){if(!i)throw new Error;const N=document.createElement("div");return B&&N.classList.add("marker-interactive"),new l2({props:{displayIn:"maplibre"},target:N}),new i.Marker({element:N,offset:[1,-13]})}return{setEventHandler(B){B?(o=B,r.on("click",C)):(o=void 0,r.off("click",C))},flyTo(B,N){r.flyTo({center:B,...N?{zoom:N}:{},...u})},fitBounds(B,N,F){r.fitBounds([[B[0],B[1]],[B[2],B[3]]],{padding:N,...F?{maxZoom:F}:{},...d})},indicateReverse(B){r.getCanvasContainer().style.cursor=B?"crosshair":""},setReverseMarker(B){!i||!n||(T?B?T.setLngLat(B):(T.remove(),T=void 0):B&&(n instanceof Function?T=n(r)??void 0:(T=(typeof n=="object"?new i.Marker(n):L()).setLngLat(B).addTo(r),T.getElement().classList.add("marker-reverse"))))},setFeatures(B,N,F){for(const W of _)W.remove();if(_.length=0,I(void 0),!!i){e:if(N){let W=!1;if(N.geometry.type==="GeometryCollection"){const ee=N.geometry.geometries.filter(oe=>oe.type==="Polygon"||oe.type==="MultiPolygon");t:if(ee.length>0){const oe=Q0(lh(ee.map($=>ah($))));if(!oe)break t;Yg({...N,geometry:oe.geometry},I),W=!0}else{const oe=N.geometry.geometries.filter($=>$.type==="LineString"||$.type==="MultiLineString");oe.length>0&&(I({...N,geometry:{type:"GeometryCollection",geometries:oe}}),W=!0)}}if(!W){if(N.geometry.type==="Polygon"||N.geometry.type==="MultiPolygon")Yg(N,I);else if(N.geometry.type==="LineString"||N.geometry.type==="MultiLineString"){I(N);break e}}if(!F&&!N.geometry.type.endsWith("Point"))break e;if(n instanceof Function){const ee=n(r,N);ee&&_.push(ee)}else n&&_.push(typeof n=="object"?new i.Marker(n):L().setLngLat(N.center).addTo(r))}if(a)for(const W of B??[]){if(W===N)continue;let ee;if(a instanceof Function){if(ee=a(r,W),!ee)continue}else ee=(typeof a=="object"?new i.Marker(a):L(!0)).setLngLat(W.center).setPopup(new i.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(W.place_type[0]==="reverse"?W.place_name:W.place_name.replace(/,.*/,""))).addTo(r);const oe=ee.getElement();oe.addEventListener("click",$=>{$.stopPropagation(),o==null||o({type:"markerClick",id:W.id})}),oe.addEventListener("mouseenter",()=>{o==null||o({type:"markerMouseEnter",id:W.id}),ee.togglePopup()}),oe.addEventListener("mouseleave",()=>{o==null||o({type:"markerMouseLeave",id:W.id}),ee.togglePopup()}),_.push(ee)}}},setSelectedMarker(B){S&&S.getElement().classList.toggle("marker-selected",!1),S=B>-1?_[B]:void 0,S==null||S.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const B=r.getCenter();return[r.getZoom(),B.lng,B.lat]}}}function V2(r){let i,n;return{c(){i=fa("svg"),n=fa("path"),_e(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),_e(i,"viewBox","0 0 14 14"),_e(i,"width","13"),_e(i,"height","13"),_e(i,"class","svelte-en2qvf")},m(a,u){xe(a,i,u),be(i,n)},p:Ht,i:Ht,o:Ht,d(a){a&&we(i)}}}class $0 extends ui{constructor(i){super(),ci(this,i,null,V2,ti,{})}}function q2(r){let i,n;return{c(){i=fa("svg"),n=fa("path"),_e(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),_e(i,"viewBox","0 0 30 30"),_e(i,"fill","none"),_e(i,"xmlns","http://www.w3.org/2000/svg"),_e(i,"class","svelte-d2loi5")},m(a,u){xe(a,i,u),be(i,n)},p:Ht,i:Ht,o:Ht,d(a){a&&we(i)}}}class eb extends ui{constructor(i){super(),ci(this,i,null,q2,ti,{})}}function Z2(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[3]+"area.svg")||_e(i,"src",n),_e(i,"alt",r[7]),_e(i,"title",r[7]),_e(i,"class","svelte-w9y5n9")},m(a,u){xe(a,i,u)},p(a,u){u&8&&!Wn(i.src,n=a[3]+"area.svg")&&_e(i,"src",n),u&128&&_e(i,"alt",a[7]),u&128&&_e(i,"title",a[7])},d(a){a&&we(i)}}}function W2(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[3]+"reverse.svg")||_e(i,"src",n),_e(i,"alt",r[7]),_e(i,"title",r[7]),_e(i,"class","svelte-w9y5n9")},m(a,u){xe(a,i,u)},p(a,u){u&8&&!Wn(i.src,n=a[3]+"reverse.svg")&&_e(i,"src",n),u&128&&_e(i,"alt",a[7]),u&128&&_e(i,"title",a[7])},d(a){a&&we(i)}}}function G2(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[3]+"poi.svg")||_e(i,"src",n),_e(i,"alt",r[7]),_e(i,"title",r[7]),_e(i,"class","svelte-w9y5n9")},m(a,u){xe(a,i,u)},p(a,u){u&8&&!Wn(i.src,n=a[3]+"poi.svg")&&_e(i,"src",n),u&128&&_e(i,"alt",a[7]),u&128&&_e(i,"title",a[7])},d(a){a&&we(i)}}}function H2(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[3]+"postal_code.svg")||_e(i,"src",n),_e(i,"alt",r[7]),_e(i,"title",r[7]),_e(i,"class","svelte-w9y5n9")},m(a,u){xe(a,i,u)},p(a,u){u&8&&!Wn(i.src,n=a[3]+"postal_code.svg")&&_e(i,"src",n),u&128&&_e(i,"alt",a[7]),u&128&&_e(i,"title",a[7])},d(a){a&&we(i)}}}function X2(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[3]+"street.svg")||_e(i,"src",n),_e(i,"alt",r[7]),_e(i,"title",r[7]),_e(i,"class","svelte-w9y5n9")},m(a,u){xe(a,i,u)},p(a,u){u&8&&!Wn(i.src,n=a[3]+"street.svg")&&_e(i,"src",n),u&128&&_e(i,"alt",a[7]),u&128&&_e(i,"title",a[7])},d(a){a&&we(i)}}}function K2(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[3]+"road.svg")||_e(i,"src",n),_e(i,"alt",r[7]),_e(i,"title",r[7]),_e(i,"class","svelte-w9y5n9")},m(a,u){xe(a,i,u)},p(a,u){u&8&&!Wn(i.src,n=a[3]+"road.svg")&&_e(i,"src",n),u&128&&_e(i,"alt",a[7]),u&128&&_e(i,"title",a[7])},d(a){a&&we(i)}}}function J2(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[3]+"housenumber.svg")||_e(i,"src",n),_e(i,"alt",r[7]),_e(i,"title",r[7]),_e(i,"class","svelte-w9y5n9")},m(a,u){xe(a,i,u)},p(a,u){u&8&&!Wn(i.src,n=a[3]+"housenumber.svg")&&_e(i,"src",n),u&128&&_e(i,"alt",a[7]),u&128&&_e(i,"title",a[7])},d(a){a&&we(i)}}}function Y2(r){let i,n,a,u;return{c(){i=ke("img"),Wn(i.src,n=r[5])||_e(i,"src",n),_e(i,"alt",r[4]),_e(i,"title",r[7]),_e(i,"class","svelte-w9y5n9")},m(d,f){xe(d,i,f),a||(u=Wt(i,"error",r[14]),a=!0)},p(d,f){f&32&&!Wn(i.src,n=d[5])&&_e(i,"src",n),f&16&&_e(i,"alt",d[4]),f&128&&_e(i,"title",d[7])},d(d){d&&we(i),a=!1,u()}}}function Q2(r){let i,n;return{c(){i=ke("div"),_e(i,"class","sprite-icon svelte-w9y5n9"),_e(i,"style",n=`
        width: ${r[6].width/Us}px;
        height: ${r[6].height/Us}px;
        background-image: url(${r[3]}sprite${Gd}.png);
        background-position: -${r[6].x/Us}px -${r[6].y/Us}px;
        background-size: ${uo.width/Us}px ${uo.height/Us}px;
      `),_e(i,"title",r[7])},m(a,u){xe(a,i,u)},p(a,u){u&72&&n!==(n=`
        width: ${a[6].width/Us}px;
        height: ${a[6].height/Us}px;
        background-image: url(${a[3]}sprite${Gd}.png);
        background-position: -${a[6].x/Us}px -${a[6].y/Us}px;
        background-size: ${uo.width/Us}px ${uo.height/Us}px;
      `)&&_e(i,"style",n),u&128&&_e(i,"title",a[7])},d(a){a&&we(i)}}}function t_(r){let i,n;return{c(){i=ke("span"),n=Tt(r[7]),_e(i,"class","secondary svelte-w9y5n9")},m(a,u){xe(a,i,u),be(i,n)},p(a,u){u&128&&Ai(n,a[7])},d(a){a&&we(i)}}}function $2(r){let i,n,a,u,d,f,o,_,S,T=(r[8]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,k,I=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[8],C,L,B=(r[8]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",N,F,W,ee,oe,$;function re(R,Z){return Z&1&&(n=null),Z&1&&(a=null),Z&1&&(u=null),Z&1&&(d=null),uo&&R[6]?Q2:R[5]?Y2:R[0].address?J2:(n==null&&(n=!!R[0].id.startsWith("road.")),n?K2:(a==null&&(a=!!R[0].id.startsWith("address.")),a?X2:(u==null&&(u=!!R[0].id.startsWith("postal_code.")),u?H2:(d==null&&(d=!!R[0].id.startsWith("poi.")),d?G2:R[8]?W2:Z2))))}let j=re(r,-1),U=j(r),J=I&&t_(r);return{c(){i=ke("li"),U.c(),f=Qe(),o=ke("span"),_=ke("span"),S=ke("span"),y=Tt(T),k=Qe(),J&&J.c(),C=Qe(),L=ke("span"),N=Tt(B),_e(S,"class","primary svelte-w9y5n9"),_e(_,"class","svelte-w9y5n9"),_e(L,"class","line2 svelte-w9y5n9"),_e(o,"class","texts svelte-w9y5n9"),_e(i,"tabindex","-1"),_e(i,"role","option"),_e(i,"aria-selected",F=r[1]==="selected"),_e(i,"aria-checked",W=r[1]==="picked"),_e(i,"class",ee=Wc(r[1])+" svelte-w9y5n9")},m(R,Z){xe(R,i,Z),U.m(i,null),be(i,f),be(i,o),be(o,_),be(_,S),be(S,y),be(_,k),J&&J.m(_,null),be(o,C),be(o,L),be(L,N),oe||($=[Wt(i,"mouseenter",r[13]),Wt(i,"focus",r[15]),Wt(i,"click",r[16])],oe=!0)},p(R,[Z]){j===(j=re(R,Z))&&U?U.p(R,Z):(U.d(1),U=j(R),U&&(U.c(),U.m(i,f))),Z&257&&T!==(T=(R[8]?R[0].place_name:R[0].place_name.replace(/,.*/,""))+"")&&Ai(y,T),Z&293&&(I=R[2]==="always"||R[2]!=="never"&&!R[0].address&&!R[0].id.startsWith("road.")&&!R[0].id.startsWith("address.")&&!R[0].id.startsWith("postal_code.")&&(!R[0].id.startsWith("poi.")||!R[5])&&!R[8]),I?J?J.p(R,Z):(J=t_(R),J.c(),J.m(_,null)):J&&(J.d(1),J=null),Z&257&&B!==(B=(R[8]?"":R[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ai(N,B),Z&2&&F!==(F=R[1]==="selected")&&_e(i,"aria-selected",F),Z&2&&W!==(W=R[1]==="picked")&&_e(i,"aria-checked",W),Z&2&&ee!==(ee=Wc(R[1])+" svelte-w9y5n9")&&_e(i,"class",ee)},i:Ht,o:Ht,d(R){R&&we(i),U.d(),J&&J.d(),oe=!1,ir($)}}}const tb=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,Gd=tb?"@2x":"",Us=tb?2:1;let uo,$h;function eS(r,i,n){let a,u,d,{feature:f}=i,{style:o="default"}=i,{showPlaceType:_}=i,{missingIconsCache:S}=i,{iconsBaseUrl:T}=i;const y=nl();let k,I,C,L;function B(){$h??($h=fetch(`${T}sprite${Gd}.json`).then(j=>j.json()).then(j=>{uo=j}).catch(()=>{uo=null}))}function N(){I&&S.add(I),F()}function F(){uo!==void 0?W():(B(),$h==null||$h.then(W))}function W(){do{if(L--,n(4,k=a==null?void 0:a[L]),n(6,C=k?uo==null?void 0:uo.icons[k]:void 0),C)break;n(5,I=k?T+k.replace(/ /g,"_")+".svg":void 0)}while(L>-1&&(!I||S.has(I)))}function ee(j){Di.call(this,r,j)}const oe=()=>N(),$=()=>y("select",void 0),re=j=>{document.activeElement!==j.target&&y("select",void 0)};return r.$$set=j=>{"feature"in j&&n(0,f=j.feature),"style"in j&&n(1,o=j.style),"showPlaceType"in j&&n(2,_=j.showPlaceType),"missingIconsCache"in j&&n(11,S=j.missingIconsCache),"iconsBaseUrl"in j&&n(3,T=j.iconsBaseUrl)},r.$$.update=()=>{var j,U,J,R,Z;r.$$.dirty&1&&n(12,a=(j=f.properties)==null?void 0:j.categories),r.$$.dirty&1&&n(8,u=f.place_type[0]==="reverse"),r.$$.dirty&1&&n(7,d=((J=(U=f.properties)==null?void 0:U.categories)==null?void 0:J.join(", "))??((Z=(R=f.properties)==null?void 0:R.place_type_name)==null?void 0:Z[0])??f.place_type[0]),r.$$.dirty&4096&&(L=(a==null?void 0:a.length)??0,F())},[f,o,_,T,k,I,C,d,u,y,N,S,a,ee,oe,$,re]}class tS extends ui{constructor(i){super(),ci(this,i,eS,$2,ti,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function iS(r){let i;return{c(){i=ke("div"),i.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',_e(i,"class","svelte-1ocfouu")},m(n,a){xe(n,i,a)},p:Ht,i:Ht,o:Ht,d(n){n&&we(i)}}}class nS extends ui{constructor(i){super(),ci(this,i,null,iS,ti,{})}}function rS(r){let i,n;return{c(){i=fa("svg"),n=fa("path"),_e(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),_e(i,"viewBox","0 0 60.006 21.412"),_e(i,"width","14"),_e(i,"height","20"),_e(i,"class","svelte-en2qvf")},m(a,u){xe(a,i,u),be(i,n)},p:Ht,i:Ht,o:Ht,d(a){a&&we(i)}}}class sS extends ui{constructor(i){super(),ci(this,i,null,rS,ti,{})}}function oS(r){let i,n,a;return{c(){i=fa("svg"),n=fa("circle"),a=fa("path"),_e(n,"cx","4.789"),_e(n,"cy","4.787"),_e(n,"r","3.85"),_e(n,"class","svelte-1aq105l"),_e(a,"d","M12.063 12.063 7.635 7.635"),_e(a,"class","svelte-1aq105l"),_e(i,"xmlns","http://www.w3.org/2000/svg"),_e(i,"width","13"),_e(i,"height","13"),_e(i,"viewBox","0 0 13 13"),_e(i,"class","svelte-1aq105l")},m(u,d){xe(u,i,d),be(i,n),be(i,a)},p:Ht,i:Ht,o:Ht,d(u){u&&we(i)}}}class aS extends ui{constructor(i){super(),ci(this,i,null,oS,ti,{})}}function lS(r,i,n){const a=i[1],u=i[0],d=a-u;return r===a&&n?r:((r-u)%d+d)%d+u}function i_(r){const i=[...r];return i[2]<i[0]&&(Math.abs((i[0]+i[2]+360)/2)>Math.abs((i[0]-360+i[2])/2)?i[0]-=360:i[2]+=360),i}let Gu;async function cS(r,i,n){const a=r==null?void 0:r.getCenterAndZoom();for(const u of i??[])if(!(a&&(u.minZoom!=null&&u.minZoom>a[0]||u.maxZoom!=null&&u.maxZoom<a[0]))){if(u.type==="fixed")return u.coordinates.join(",");e:if(u.type==="client-geolocation"){if(Gu&&u.cachedLocationExpiry&&Gu.time+u.cachedLocationExpiry>Date.now()){if(!Gu.coords)break e;return Gu.coords}let d;try{return d=await new Promise((f,o)=>{n.signal.addEventListener("abort",()=>{o(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{f([_.coords.longitude,_.coords.latitude].map(S=>S.toFixed(6)).join(","))},_=>{o(_)},u)}),d}catch{}finally{u.cachedLocationExpiry&&(Gu={time:Date.now(),coords:d})}if(n.signal.aborted)return}if(u.type==="server-geolocation")return"ip";if(a&&u.type==="map-center")return a[1].toFixed(6)+","+a[2].toFixed(6)}}const uS=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,n_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,r_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,s_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,o_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,a_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function hS(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const i=this.decimalCoordinates.split(",").map(I=>Number(I.trim())),n=Number(i[0]),a=Number(i[1]),u=Math.abs(n),d=Math.abs(a),f=n>0?"N":"S",o=a>0?"E":"W";let _;r=="DD"&&(_=`${u} ${f}, ${d} ${o}`);const S=Math.floor(u),T=Math.floor(d),y=(u-S)*60,k=(d-T)*60;if(r=="DM"){let I=l_(y,3).toFixed(3).padStart(6,"0"),C=l_(k,3).toFixed(3).padStart(6,"0");I.endsWith(".000")&&C.endsWith(".000")&&(I=I.replace(/\.000$/,""),C=C.replace(/\.000$/,"")),_=`${S} ${I}' ${f}, ${T} ${C}' ${o}`}if(r=="DMS"){const I=Math.floor(y),C=Math.floor(k);let L=((y-I)*60).toFixed(1).padStart(4,"0"),B=((k-C)*60).toFixed(1).padStart(4,"0");const N=I.toString().padStart(2,"0"),F=C.toString().padStart(2,"0");L.endsWith(".0")&&B.endsWith(".0")&&(L=L.replace(/\.0$/,""),B=B.replace(/\.0$/,"")),_=`${S} ${N}' ${L}" ${f}, ${T} ${F}' ${B}" ${o}`}return _}else throw new Error("no decimal coordinates to convert")}function l_(r,i){const n=Math.pow(10,i);return Math.round((r+Number.EPSILON)*n)/n}function _p(r,i){i||(i=5),r=r.replace(/\s+/g," ").trim();let n=null,a=null,u="",d="",f=null,o=[],_=!1;if(uS.test(r))throw new Error("invalid coordinate value");if(n_.test(r))if(o=n_.exec(r),_=Hu(o),_)n=Math.abs(o[1])+o[2]/60,Number(o[1])<0&&(n*=-1),a=Math.abs(o[3])+o[4]/60,Number(o[3])<0&&(a*=-1),f="DM";else throw new Error("invalid coordinate format");else if(r_.test(r))if(o=r_.exec(r),_=Hu(o),_){if(n=o[2],a=o[6],n.includes(",")&&(n=n.replace(",",".")),a.includes(",")&&(a=a.replace(",",".")),f="DD",Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(a))==Number(a))throw new Error("integer only coordinate provided");o[1]?(u=o[1],d=o[5]):o[4]&&(u=o[4],d=o[8])}else throw new Error("invalid decimal coordinate format");else if(s_.test(r))if(o=s_.exec(r),_=Hu(o),_)n=Math.abs(parseInt(o[2])),o[4]&&(n+=o[4]/60,f="DM"),o[6]&&(n+=o[6].replace(",",".")/3600,f="DMS"),parseInt(o[2])<0&&(n=-1*n),a=Math.abs(parseInt(o[9])),o[11]&&(a+=o[11]/60),o[13]&&(a+=o[13].replace(",",".")/3600),parseInt(o[9])<0&&(a=-1*a),o[1]?(u=o[1],d=o[8]):o[7]&&(u=o[7],d=o[14]);else throw new Error("invalid DMS coordinates format");else if(o_.test(r))if(o=o_.exec(r),_=Hu(o),_)n=Math.abs(parseInt(o[2])),o[4]&&(n+=o[4]/60,f="DM"),o[6]&&(n+=o[6]/3600,f="DMS"),parseInt(o[2])<0&&(n=-1*n),a=Math.abs(parseInt(o[10])),o[12]&&(a+=o[12]/60),o[14]&&(a+=o[14]/3600),parseInt(o[10])<0&&(a=-1*a),o[1]?(u=o[1],d=o[9]):o[8]&&(u=o[8],d=o[16]);else throw new Error("invalid DMS coordinates format");else if(a_.test(r)){if(o=a_.exec(r),_=Hu(o),o.filter(S=>S).length<=5)throw new Error("invalid coordinates format");if(_)n=Math.abs(parseInt(o[2])),o[4]&&(n+=o[4].replace(",",".")/60,f="DM"),o[6]&&(n+=o[6].replace(",",".")/3600,f="DMS"),parseInt(o[2])<0&&(n=-1*n),a=Math.abs(parseInt(o[10])),o[12]&&(a+=o[12].replace(",",".")/60),o[14]&&(a+=o[14].replace(",",".")/3600),parseInt(o[10])<0&&(a=-1*a),o[1]?(u=o[1],d=o[9]):o[8]&&(u=o[8],d=o[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(a)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if(u&&!d||!u&&d)throw new Error("invalid coordinates value");if(u&&u==d)throw new Error("invalid coordinates format");n.toString().includes(",")&&(n=n.replace(",",".")),a.toString().includes(",")&&(a=a.replace(",","."));let S=/S|SOUTH/i;S.test(u)&&n>0&&(n=-1*n),S=/W|WEST/i,S.test(d)&&a>0&&(a=-1*a);const T=o[0].trim();let y,k;const I=/[,/;\u0020]/g,C=T.match(I);if(C==null){const N=Math.floor(r.length/2);y=T.substring(0,N).trim(),k=T.substring(N).trim()}else{let N;C.length%2==1?N=Math.floor(C.length/2):N=C.length/2-1;let F=0;if(N==0)F=T.indexOf(C[0]),y=T.substring(0,F).trim(),k=T.substring(F+1).trim();else{let W=0,ee=0;for(;W<=N;)F=T.indexOf(C[W],ee),ee=F+1,W++;y=T.substring(0,F).trim(),k=T.substring(F+1).trim()}}const L=y.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");const B=k.split(".");if(B.length==2&&B[1]==0&&B[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(k))throw new Error("degree only coordinate/s provided");return n=Number(Number(n).toFixed(i)),a=Number(Number(a).toFixed(i)),Object.freeze({verbatimCoordinates:T,verbatimLatitude:y,verbatimLongitude:k,decimalLatitude:n,decimalLongitude:a,decimalCoordinates:`${n},${a}`,originalFormat:f,closeEnough:fS,toCoordinateFormat:hS})}else throw new Error("coordinates pattern match failed")}function Hu(r){if(!isNaN(r[0]))return!1;const i=[...r];if(i.shift(),i.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,a=/[eastsouthnorthwest]+/i,u=i.length/2;for(let d=0;d<u;d++){const f=i[d],o=i[d+u],_=n.test(f)&&n.test(o),S=a.test(f)&&a.test(o),T=f==o;if(!(f==null&&o==null)){if(f==null||o==null)return!1;if(_||S||T)continue;return!1}}return!0}function c_(r,i){const n=Math.abs(r-i);return Number(n.toFixed(6))<=1e-5}function fS(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const i=r.split(",");if(Number(i[0])==NaN||Number(i[1])==NaN)throw new Error("coords are not valid decimals");return c_(this.decimalLatitude,Number(i[0]))&&c_(this.decimalLongitude,i[1])}else throw new Error("coords being tested must be separated by a comma")}const dS=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});_p.to=dS;const pS=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],mS={decimalLatitude:40.123,decimalLongitude:-74.123},gS=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],_S=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function yS(){const r=[];return pS.forEach(i=>{i.decimalLatitude?r.push(i):r.push({...i,...mS})}),[...r,...gS,..._S]}const bS=yS();_p.formats=bS.map(r=>r.verbatimCoordinates);const vS=_p;function u_(r,i,n){const a=r.slice();return a[97]=i[n],a[99]=n,a}function h_(r){let i,n,a,u,d;return n=new $0({}),{c(){i=ke("button"),yt(n.$$.fragment),_e(i,"type","button"),_e(i,"title",r[3]),_e(i,"class","svelte-bz0zu3")},m(f,o){xe(f,i,o),gt(n,i,null),a=!0,u||(d=Wt(i,"click",r[78]),u=!0)},p(f,o){(!a||o[0]&8)&&_e(i,"title",f[3])},i(f){a||(Re(n.$$.fragment,f),a=!0)},o(f){Ve(n.$$.fragment,f),a=!1},d(f){f&&we(i),_t(n),u=!1,d()}}}function f_(r){let i,n;return i=new nS({}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function d_(r){let i,n,a,u,d;return n=new sS({}),{c(){i=ke("button"),yt(n.$$.fragment),_e(i,"type","button"),_e(i,"title",r[10]),_e(i,"class","svelte-bz0zu3"),Dr(i,"active",r[0])},m(f,o){xe(f,i,o),gt(n,i,null),a=!0,u||(d=Wt(i,"click",r[79]),u=!0)},p(f,o){(!a||o[0]&1024)&&_e(i,"title",f[10]),(!a||o[0]&1)&&Dr(i,"active",f[0])},i(f){a||(Re(n.$$.fragment,f),a=!0)},o(f){Ve(n.$$.fragment,f),a=!1},d(f){f&&we(i),_t(n),u=!1,d()}}}function wS(r){let i,n=[],a=new Map,u,d,f,o=Vi(r[13]);const _=S=>S[97].id+(S[97].address?","+S[97].address:"");for(let S=0;S<o.length;S+=1){let T=u_(r,o,S),y=_(T);a.set(y,n[S]=p_(y,T))}return{c(){i=ke("ul");for(let S=0;S<n.length;S+=1)n[S].c();_e(i,"class","options svelte-bz0zu3"),_e(i,"role","listbox")},m(S,T){xe(S,i,T);for(let y=0;y<n.length;y+=1)n[y]&&n[y].m(i,null);u=!0,d||(f=[Wt(i,"mouseleave",r[27]),Wt(i,"blur",r[83]),Wt(i,"keydown",r[23])],d=!0)},p(S,T){T[0]&102823936&&(o=Vi(S[13]),ln(),n=b1(n,T,_,1,S,o,a,i,y1,p_,null,u_),cn())},i(S){if(!u){for(let T=0;T<o.length;T+=1)Re(n[T]);u=!0}},o(S){for(let T=0;T<n.length;T+=1)Ve(n[T]);u=!1},d(S){S&&we(i);for(let T=0;T<n.length;T+=1)n[T].d();d=!1,ir(f)}}}function xS(r){let i,n,a,u,d,f;return n=new eb({}),{c(){i=ke("div"),yt(n.$$.fragment),a=Qe(),u=ke("div"),d=Tt(r[8]),_e(u,"class","svelte-bz0zu3"),_e(i,"class","no-results svelte-bz0zu3")},m(o,_){xe(o,i,_),gt(n,i,null),be(i,a),be(i,u),be(u,d),f=!0},p(o,_){(!f||_[0]&256)&&Ai(d,o[8])},i(o){f||(Re(n.$$.fragment,o),f=!0)},o(o){Ve(n.$$.fragment,o),f=!1},d(o){o&&we(i),_t(n)}}}function SS(r){let i="",n;return{c(){n=Tt(i)},m(a,u){xe(a,n,u)},p:Ht,i:Ht,o:Ht,d(a){a&&we(n)}}}function TS(r){let i,n,a,u,d,f,o,_,S,T,y;return n=new eb({}),_=new $0({}),{c(){i=ke("div"),yt(n.$$.fragment),a=Qe(),u=ke("div"),d=Tt(r[7]),f=Qe(),o=ke("button"),yt(_.$$.fragment),_e(u,"class","svelte-bz0zu3"),_e(o,"class","svelte-bz0zu3"),_e(i,"class","error svelte-bz0zu3")},m(k,I){xe(k,i,I),gt(n,i,null),be(i,a),be(i,u),be(u,d),be(i,f),be(i,o),gt(_,o,null),S=!0,T||(y=Wt(o,"click",r[80]),T=!0)},p(k,I){(!S||I[0]&128)&&Ai(d,k[7])},i(k){S||(Re(n.$$.fragment,k),Re(_.$$.fragment,k),S=!0)},o(k){Ve(n.$$.fragment,k),Ve(_.$$.fragment,k),S=!1},d(k){k&&we(i),_t(n),_t(_),T=!1,y()}}}function p_(r,i){var o;let n,a,u;function d(){return i[81](i[99])}function f(){return i[82](i[97])}return a=new tS({props:{feature:i[97],showPlaceType:i[11],style:i[15]===i[99]?"selected":((o=i[14])==null?void 0:o.id)===i[97].id?"picked":"default",missingIconsCache:i[21],iconsBaseUrl:i[12]}}),a.$on("mouseenter",d),a.$on("select",f),{key:r,first:null,c(){n=Mn(),yt(a.$$.fragment),this.first=n},m(_,S){xe(_,n,S),gt(a,_,S),u=!0},p(_,S){var y;i=_;const T={};S[0]&8192&&(T.feature=i[97]),S[0]&2048&&(T.showPlaceType=i[11]),S[0]&57344&&(T.style=i[15]===i[99]?"selected":((y=i[14])==null?void 0:y.id)===i[97].id?"picked":"default"),S[0]&4096&&(T.iconsBaseUrl=i[12]),a.$set(T)},i(_){u||(Re(a.$$.fragment,_),u=!0)},o(_){Ve(a.$$.fragment,_),u=!1},d(_){_&&we(n),_t(a,_)}}}function kS(r){let i,n,a,u,d,f,o,_,S,T,y,k,I,C,L,B,N,F,W,ee=!1;d=new aS({});let oe=!r[20]&&h_(r),$=r[20]&&f_(),re=r[6]==="button"&&d_(r);const j=r[70].default,U=vn(j,r,r[69],null),J=[TS,SS,xS,wS],R=[];function Z(ce,fe){var ge,ye;return ce[19]?0:!ce[16]&&!ce[4]?1:((ge=ce[13])==null?void 0:ge.length)===0?2:(ye=ce[13])!=null&&ye.length&&(ce[16]||ce[4])?3:-1}return~(C=Z(r))&&(L=R[C]=J[C](r)),{c(){i=Qe(),n=ke("form"),a=ke("div"),u=ke("button"),yt(d.$$.fragment),f=Qe(),o=ke("input"),_=Qe(),S=ke("div"),oe&&oe.c(),T=Qe(),$&&$.c(),y=Qe(),re&&re.c(),k=Qe(),U&&U.c(),I=Qe(),L&&L.c(),_e(u,"class","search-button svelte-bz0zu3"),_e(u,"type","button"),_e(o,"placeholder",r[9]),_e(o,"aria-label",r[9]),_e(o,"class","svelte-bz0zu3"),_e(S,"class","clear-button-container svelte-bz0zu3"),Dr(S,"displayable",r[1]!==""),_e(a,"class","input-group svelte-bz0zu3"),_e(n,"class",B=Wc(r[2])+" svelte-bz0zu3"),Dr(n,"can-collapse",r[5]&&r[1]==="")},m(ce,fe){xe(ce,i,fe),xe(ce,n,fe),be(n,a),be(a,u),gt(d,u,null),be(a,f),be(a,o),r[72](o),Ts(o,r[1]),be(a,_),be(a,S),oe&&oe.m(S,null),be(S,T),$&&$.m(S,null),be(a,y),re&&re.m(a,null),be(a,k),U&&U.m(a,null),be(n,I),~C&&R[C].m(n,null),N=!0,F||(W=[Wt(u,"click",r[71]),Wt(o,"input",r[73]),Wt(o,"focus",r[74]),Wt(o,"blur",r[75]),Wt(o,"click",r[76]),Wt(o,"keydown",r[23]),Wt(o,"input",r[24]),Wt(o,"change",r[77]),Wt(n,"submit",Yd(r[22]))],F=!0)},p(ce,fe){(!N||fe[0]&512)&&_e(o,"placeholder",ce[9]),(!N||fe[0]&512)&&_e(o,"aria-label",ce[9]),fe[0]&2&&o.value!==ce[1]&&Ts(o,ce[1]),ce[20]?oe&&(ln(),Ve(oe,1,1,()=>{oe=null}),cn()):oe?(oe.p(ce,fe),fe[0]&1048576&&Re(oe,1)):(oe=h_(ce),oe.c(),Re(oe,1),oe.m(S,T)),ce[20]?$?fe[0]&1048576&&Re($,1):($=f_(),$.c(),Re($,1),$.m(S,null)):$&&(ln(),Ve($,1,1,()=>{$=null}),cn()),(!N||fe[0]&2)&&Dr(S,"displayable",ce[1]!==""),ce[6]==="button"?re?(re.p(ce,fe),fe[0]&64&&Re(re,1)):(re=d_(ce),re.c(),Re(re,1),re.m(a,k)):re&&(ln(),Ve(re,1,1,()=>{re=null}),cn()),U&&U.p&&(!N||fe[2]&128)&&xn(U,j,ce,ce[69],N?wn(j,ce[69],fe,null):Sn(ce[69]),null);let ge=C;C=Z(ce),C===ge?~C&&R[C].p(ce,fe):(L&&(ln(),Ve(R[ge],1,1,()=>{R[ge]=null}),cn()),~C?(L=R[C],L?L.p(ce,fe):(L=R[C]=J[C](ce),L.c()),Re(L,1),L.m(n,null)):L=null),(!N||fe[0]&4&&B!==(B=Wc(ce[2])+" svelte-bz0zu3"))&&_e(n,"class",B),(!N||fe[0]&38)&&Dr(n,"can-collapse",ce[5]&&ce[1]==="")},i(ce){N||(Re(ee),Re(d.$$.fragment,ce),Re(oe),Re($),Re(re),Re(U,ce),Re(L),N=!0)},o(ce){Ve(ee),Ve(d.$$.fragment,ce),Ve(oe),Ve($),Ve(re),Ve(U,ce),Ve(L),N=!1},d(ce){ce&&(we(i),we(n)),_t(d),r[72](null),oe&&oe.d(),$&&$.d(),re&&re.d(),U&&U.d(ce),~C&&R[C].d(),F=!1,ir(W)}}}function CS(r,i,n){let a,u,d,{$$slots:f={},$$scope:o}=i;const _={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:S=void 0}=i,{apiKey:T=void 0}=i,{bbox:y=void 0}=i,{clearButtonTitle:k="clear"}=i,{clearOnBlur:I=!1}=i,{clearListOnPick:C=!1}=i,{keepListOpen:L=!1}=i,{collapsed:B=!1}=i,{country:N=void 0}=i,{debounceSearch:F=200}=i,{enableReverse:W="never"}=i,{errorMessage:ee="Something went wrong"}=i,{filter:oe=()=>!0}=i,{flyTo:$=!0}=i,{fuzzyMatch:re=!0}=i,{language:j=void 0}=i,{limit:U=void 0}=i;const J=41415112612;let{reverseGeocodingLimit:R=J}=i,{mapController:Z=void 0}=i,{minLength:ce=2}=i,{noResultsMessage:fe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=i,{placeholder:ge="Search"}=i,{proximity:ye=[{type:"server-geolocation"}]}=i,{reverseActive:he=W==="always"}=i,{reverseButtonTitle:Fe="toggle reverse geocoding"}=i,{searchValue:Me=""}=i,{pickedResultStyle:lt="full-geometry"}=i,{showPlaceType:Ze="if-needed"}=i,{showResultsWhileTyping:ht=!0}=i,{selectFirst:kt=!0}=i,{flyToSelected:$e=!1}=i,{markerOnSelected:vt=!0}=i,{types:St=void 0}=i;const Zt=[];let{reverseGeocodingTypes:oi=Zt}=i,{exhaustiveReverseGeocoding:Mi=!1}=i,{excludeTypes:Pi=!1}=i;const Ti=void 0;let{reverseGeocodingExcludeTypes:At=Ti}=i,{zoom:He=_}=i,{apiUrl:Pt="https://api.maptiler.com/geocoding"}=i,{fetchParameters:ni={}}=i,{iconsBaseUrl:Ye="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=i,{adjustUrlQuery:gi=()=>{}}=i,{adjustUrl:pt=()=>{}}=i;function it(Xe){ct.focus(Xe)}function ue(){ct.blur()}function H(Xe,di=!0,xi=!1){n(1,Me=Xe),di?(n(15,Vt=-1),dr()):(Se(void 0,!xi,xi),setTimeout(()=>{ct.focus(),ct.select()}))}function Y(){n(13,qe=void 0),n(14,st=void 0),n(15,Vt=-1)}function Ie(){n(64,ut=[]),n(14,st=void 0)}let qe,ut,st,ki="",ct,Vt=-1,Ci,Fi=[],Cn,xt,li,ii,tn=!1;const fr=new Set,ai=nl();hs(()=>{Z&&(Z.setEventHandler(void 0),Z.indicateReverse(!1),Z.setSelectedMarker(-1),Z.setFeatures(void 0,void 0,!1))});function dr(Xe){if(n(17,tn=!1),xt&&(clearTimeout(xt),xt=void 0),Vt>-1&&qe)n(14,st=qe[Vt]),n(1,Me=st.place_type[0]==="reverse"?st.place_name:st.place_name.replace(/,.*/,"")),n(19,Ci=void 0),n(64,ut=void 0),n(15,Vt=-1);else if(Me){const di=Xe||!pr(Me);Sr(Me,{exact:!0}).then(()=>{n(64,ut=qe),n(14,st=void 0),di&&Tr()}).catch(xi=>n(19,Ci=xi))}}function pr(Xe){try{return vS(Xe,6)}catch{return!1}}async function Sr(Xe,{byId:di=!1,exact:xi=!1}={}){var Ki,Ji,jn;n(19,Ci=void 0),Cn==null||Cn.abort();const Bi=new AbortController;n(20,Cn=Bi);try{const si=pr(Xe),Xr=new URL(Pt+"/"+encodeURIComponent(si?si.decimalLongitude+","+si.decimalLatitude:Xe)+".json"),Gn=Xr.searchParams;j!==void 0&&Gn.set("language",Array.isArray(j)?j.join(","):j??"");const[Un]=(Z==null?void 0:Z.getCenterAndZoom())??[];let pn=(Ki=!si||oi===Zt?St:oi)==null?void 0:Ki.map(Ei=>typeof Ei=="string"?Ei:Un===void 0||(Ei[0]??0)<=Un&&Un<(Ei[1]??1/0)?Ei[2]:void 0).filter(Ei=>Ei!==void 0);pn&&(pn=[...new Set(pn)],Gn.set("types",pn.join(",")));const ma=!si||At===Ti?Pi:At;if(ma&&Gn.set("excludeTypes",String(ma)),y&&Gn.set("bbox",y.map(Ei=>Ei.toFixed(6)).join(",")),N&&Gn.set("country",Array.isArray(N)?N.join(","):N),!di&&!si){const Ei=await cS(Z,ye,Bi);Ei&&Gn.set("proximity",Ei),(xi||!ht)&&Gn.set("autocomplete","false"),Gn.set("fuzzyMatch",String(re))}const zn=R===J?U:R;zn!==void 0&&zn>1&&(pn==null?void 0:pn.length)!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),si?(zn===1||zn!==void 0&&(Mi||(pn==null?void 0:pn.length)===1))&&Gn.set("limit",String(zn)):U!==void 0&&Gn.set("limit",String(U)),T&&Gn.set("key",T),gi(Gn),pt(Xr);const Hn=Xr.searchParams.get("types")===""&&Xr.searchParams.get("excludeTypes")!=="true",Fr=Xr.toString();if(Fr===ki){di?(C&&n(13,qe=void 0),n(14,st=Fi[0])):(n(13,qe=Fi),((Ji=qe[Vt])==null?void 0:Ji.id)!==(u==null?void 0:u.id)&&n(15,Vt=-1));return}ki=Fr;let Rn;if(Hn)Rn={type:"FeatureCollection",features:[]};else{const Ei=await fetch(Fr,{signal:Bi.signal,...ni});if(!Ei.ok)throw new Error(await Ei.text());Rn=await Ei.json()}ai("response",{url:Fr,featureCollection:Rn}),di?(C&&n(13,qe=void 0),n(14,st=Rn.features[0]),Fi=[st]):(n(13,qe=Rn.features.filter(oe)),si&&qe.unshift({type:"Feature",properties:{},id:"reverse_"+si.decimalLongitude+"_"+si.decimalLatitude,text:si.decimalLatitude+", "+si.decimalLongitude,place_name:si.decimalLatitude+", "+si.decimalLongitude,place_type:["reverse"],center:[si.decimalLongitude,si.decimalLatitude],bbox:[si.decimalLongitude,si.decimalLatitude,si.decimalLongitude,si.decimalLatitude],geometry:{type:"Point",coordinates:[si.decimalLongitude,si.decimalLatitude]}}),Fi=qe,((jn=qe[Vt])==null?void 0:jn.id)!==(u==null?void 0:u.id)&&n(15,Vt=-1),si&&ct.focus())}catch(si){if(si&&typeof si=="object"&&"name"in si&&si.name==="AbortError")return;throw si}finally{Bi===Cn&&n(20,Cn=void 0)}}function Tr(){var Bi;if(!(ut!=null&&ut.length)||!$)return;const Xe=[180,90,-180,-90],di=!ut.some(Ki=>!Ki.matching_text);let xi;for(const Ki of ut){const Ji=te(Ki);if(xi=xi===void 0?Ji:Ji===void 0?xi:Math.max(xi,Ji),di||!Ki.matching_text)for(const jn of[0,1,2,3])Xe[jn]=Math[jn<2?"min":"max"](Xe[jn],((Bi=Ki.bbox)==null?void 0:Bi[jn])??Ki.center[jn%2])}Z&&ut.length>0&&(st&&Xe[0]===Xe[2]&&Xe[1]===Xe[3]?Z.flyTo(st.center,te(st)):Z.fitBounds(i_(Xe),50,xi))}function Ae(){!st||!Z||(!st.bbox||st.bbox[0]===st.bbox[2]&&st.bbox[1]===st.bbox[3]?Z.flyTo(st.center,te(st)):Z.fitBounds(i_(st.bbox),50,te(st)))}function te(Xe){var xi;if(!Xe.bbox||Xe.bbox[0]!==Xe.bbox[2]&&Xe.bbox[1]!==Xe.bbox[3])return;const di=Xe.id.replace(/\..*/,"");return(Array.isArray((xi=Xe.properties)==null?void 0:xi.categories)?Xe.properties.categories.reduce((Bi,Ki)=>{const Ji=He[di+"."+Ki];return Bi===void 0?Ji:Ji===void 0?Bi:Math.max(Bi,Ji)},void 0):void 0)??He[di]}function ie(Xe){n(0,he=W==="always"),n(13,qe=void 0),n(14,st=void 0),n(15,Vt=-1),H(Xe[1].toFixed(6)+", "+lS(Xe[0],[-180,180],!0).toFixed(6),!1,!0)}function de(Xe){if(!qe)return;let di=Xe.key==="ArrowDown"?1:Xe.key==="ArrowUp"?-1:0;di&&(ct.focus(),n(17,tn=!0),Xe.preventDefault(),st&&Vt===-1&&n(15,Vt=qe.findIndex(xi=>xi.id===(st==null?void 0:st.id))),Vt===(st||kt?0:-1)&&di===-1&&n(15,Vt=qe.length),n(15,Vt+=di),Vt>=qe.length&&n(15,Vt=-1),Vt<0&&(st||kt)&&n(15,Vt=0))}function Se(Xe,di=!0,xi=!1){if(n(19,Ci=void 0),n(14,st=void 0),n(17,tn=!0),ht||xi){if(xt&&clearTimeout(xt),Me.length<ce)return;const Bi=Me;xt=window.setTimeout(()=>{Sr(Bi).catch(Ki=>n(19,Ci=Ki))},di?F:0)}else n(13,qe=void 0),n(19,Ci=void 0)}function je(Xe){st&&(st==null?void 0:st.id)===(Xe==null?void 0:Xe.id)?Ae():(n(14,st=Xe),n(1,Me=Xe.place_name))}function We(Xe){n(15,Vt=Xe)}function et(){(!kt||st)&&n(15,Vt=-1),$e&&Ae()}const De=()=>ct.focus();function ot(Xe){wi[Xe?"unshift":"push"](()=>{ct=Xe,n(18,ct)})}function mt(){Me=this.value,n(1,Me),n(17,tn),n(31,I),n(16,li)}const rt=()=>n(17,tn=!0),Et=()=>n(17,tn=!1),Yt=()=>n(17,tn=!0),ri=()=>n(14,st=void 0),Ri=()=>{n(1,Me=""),n(14,st=void 0),ct.focus()},bi=()=>n(0,he=!he),zi=()=>n(19,Ci=void 0),Si=Xe=>We(Xe),un=Xe=>je(Xe),hn=()=>{};return r.$$set=Xe=>{"class"in Xe&&n(2,S=Xe.class),"apiKey"in Xe&&n(29,T=Xe.apiKey),"bbox"in Xe&&n(30,y=Xe.bbox),"clearButtonTitle"in Xe&&n(3,k=Xe.clearButtonTitle),"clearOnBlur"in Xe&&n(31,I=Xe.clearOnBlur),"clearListOnPick"in Xe&&n(32,C=Xe.clearListOnPick),"keepListOpen"in Xe&&n(4,L=Xe.keepListOpen),"collapsed"in Xe&&n(5,B=Xe.collapsed),"country"in Xe&&n(33,N=Xe.country),"debounceSearch"in Xe&&n(34,F=Xe.debounceSearch),"enableReverse"in Xe&&n(6,W=Xe.enableReverse),"errorMessage"in Xe&&n(7,ee=Xe.errorMessage),"filter"in Xe&&n(35,oe=Xe.filter),"flyTo"in Xe&&n(36,$=Xe.flyTo),"fuzzyMatch"in Xe&&n(37,re=Xe.fuzzyMatch),"language"in Xe&&n(38,j=Xe.language),"limit"in Xe&&n(39,U=Xe.limit),"reverseGeocodingLimit"in Xe&&n(40,R=Xe.reverseGeocodingLimit),"mapController"in Xe&&n(41,Z=Xe.mapController),"minLength"in Xe&&n(42,ce=Xe.minLength),"noResultsMessage"in Xe&&n(8,fe=Xe.noResultsMessage),"placeholder"in Xe&&n(9,ge=Xe.placeholder),"proximity"in Xe&&n(43,ye=Xe.proximity),"reverseActive"in Xe&&n(0,he=Xe.reverseActive),"reverseButtonTitle"in Xe&&n(10,Fe=Xe.reverseButtonTitle),"searchValue"in Xe&&n(1,Me=Xe.searchValue),"pickedResultStyle"in Xe&&n(44,lt=Xe.pickedResultStyle),"showPlaceType"in Xe&&n(11,Ze=Xe.showPlaceType),"showResultsWhileTyping"in Xe&&n(45,ht=Xe.showResultsWhileTyping),"selectFirst"in Xe&&n(46,kt=Xe.selectFirst),"flyToSelected"in Xe&&n(47,$e=Xe.flyToSelected),"markerOnSelected"in Xe&&n(48,vt=Xe.markerOnSelected),"types"in Xe&&n(49,St=Xe.types),"reverseGeocodingTypes"in Xe&&n(50,oi=Xe.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in Xe&&n(51,Mi=Xe.exhaustiveReverseGeocoding),"excludeTypes"in Xe&&n(52,Pi=Xe.excludeTypes),"reverseGeocodingExcludeTypes"in Xe&&n(53,At=Xe.reverseGeocodingExcludeTypes),"zoom"in Xe&&n(54,He=Xe.zoom),"apiUrl"in Xe&&n(55,Pt=Xe.apiUrl),"fetchParameters"in Xe&&n(56,ni=Xe.fetchParameters),"iconsBaseUrl"in Xe&&n(12,Ye=Xe.iconsBaseUrl),"adjustUrlQuery"in Xe&&n(57,gi=Xe.adjustUrlQuery),"adjustUrl"in Xe&&n(58,pt=Xe.adjustUrl),"$$scope"in Xe&&n(69,o=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&64&&n(0,he=W==="always"),r.$$.dirty[0]&16384|r.$$.dirty[1]&8192&&lt!=="marker-only"&&st&&!st.address&&st.geometry.type==="Point"&&st.place_type[0]!=="reverse"&&Sr(st.id,{byId:!0}).catch(Xe=>n(19,Ci=Xe)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1058|r.$$.dirty[2]&8&&(Z&&st&&st.id!==ii&&$&&(Ae(),C&&n(13,qe=void 0),n(64,ut=void 0),n(15,Vt=-1)),n(65,ii=st==null?void 0:st.id)),r.$$.dirty[0]&196608|r.$$.dirty[1]&1&&setTimeout(()=>{n(16,li=tn),I&&!li&&n(1,Me="")}),r.$$.dirty[0]&8194|r.$$.dirty[1]&2048&&Me.length<ce&&(n(13,qe=void 0),n(19,Ci=void 0),n(64,ut=qe)),r.$$.dirty[0]&57344|r.$$.dirty[1]&32768&&kt&&qe!=null&&qe.length&&Vt==-1&&!st&&n(15,Vt=0),r.$$.dirty[0]&8192|r.$$.dirty[2]&4&&ut!==qe&&n(64,ut=void 0),r.$$.dirty[0]&73729|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&Z&&Z.setEventHandler(Xe=>{switch(Xe.type){case"mapClick":he&&ie(Xe.coordinates);break;case"markerClick":{const di=qe==null?void 0:qe.find(xi=>xi.id===Xe.id);di&&je(di)}break;case"markerMouseEnter":ut&&n(15,Vt=li?(qe==null?void 0:qe.findIndex(di=>di.id===Xe.id))??-1:-1);break;case"markerMouseLeave":ut&&n(15,Vt=-1);break}}),r.$$.dirty[0]&40960&&n(66,u=qe==null?void 0:qe[Vt]),r.$$.dirty[1]&66592|r.$$.dirty[2]&16&&Z&&u&&$&&$e&&Z.flyTo(u.center,te(u)),r.$$.dirty[1]&8192&&n(68,a=lt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&132096|r.$$.dirty[2]&64&&(vt||Z==null||Z.setFeatures(void 0,void 0,a)),r.$$.dirty[0]&16384|r.$$.dirty[1]&132096|r.$$.dirty[2]&84&&Z&&vt&&!ut&&(Z.setFeatures(u?[u]:void 0,st,a),Z.setSelectedMarker(u?0:-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1024|r.$$.dirty[2]&68&&Z&&Z.setFeatures(ut,st,a),r.$$.dirty[0]&32768|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&ut&&Z&&Z.setSelectedMarker(Vt),r.$$.dirty[0]&2|r.$$.dirty[1]&1024&&Z){const Xe=pr(Me);Z.setReverseMarker(Xe?[Xe.decimalLongitude,Xe.decimalLatitude]:void 0)}r.$$.dirty[2]&16&&ai("select",{feature:u}),r.$$.dirty[0]&16384&&ai("pick",{feature:st}),r.$$.dirty[0]&73744&&n(67,d=!!(qe!=null&&qe.length)&&(li||L)),r.$$.dirty[2]&32&&ai("optionsvisibilitychange",{optionsVisible:d}),r.$$.dirty[0]&8192&&ai("featureslisted",{features:qe}),r.$$.dirty[2]&4&&ai("featuresmarked",{features:ut}),r.$$.dirty[0]&1&&ai("reversetoggle",{reverse:he}),r.$$.dirty[0]&2&&ai("querychange",{query:Me}),r.$$.dirty[0]&1|r.$$.dirty[1]&1024&&Z&&Z.indicateReverse(he)},[he,Me,S,k,L,B,W,ee,fe,ge,Fe,Ze,Ye,qe,st,Vt,li,tn,ct,Ci,Cn,fr,dr,de,Se,je,We,et,_,T,y,I,C,N,F,oe,$,re,j,U,R,Z,ce,ye,lt,ht,kt,$e,vt,St,oi,Mi,Pi,At,He,Pt,ni,gi,pt,it,ue,H,Y,Ie,ut,ii,u,d,a,o,f,De,ot,mt,rt,Et,Yt,ri,Ri,bi,zi,Si,un,hn]}class ES extends ui{constructor(i){super(),ci(this,i,CS,kS,ti,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}}function m_(r){let i,n,a;return n=new ES({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){i=ke("div"),yt(n.$$.fragment),_e(i,"class","svelte-ixhnie")},m(u,d){xe(u,i,d),gt(n,i,null),a=!0},p(u,d){const f={};d&4&&(f.mapController=u[2]),d&1&&(f.apiKey=u[0]),d&2&&(f.country=u[1]),n.$set(f)},i(u){a||(Re(n.$$.fragment,u),a=!0)},o(u){Ve(n.$$.fragment,u),a=!1},d(u){u&&we(i),_t(n)}}}function IS(r){let i,n,a=r[2]&&m_(r);return{c(){a&&a.c(),i=Mn()},m(u,d){a&&a.m(u,d),xe(u,i,d),n=!0},p(u,[d]){u[2]?a?(a.p(u,d),d&4&&Re(a,1)):(a=m_(u),a.c(),Re(a,1),a.m(i.parentNode,i)):a&&(ln(),Ve(a,1,1,()=>{a=null}),cn())},i(u){n||(Re(a),n=!0)},o(u){Ve(a),n=!1},d(u){u&&we(i),a&&a.d(u)}}}function AS(r,i,n){let a,{apiKey:u}=i,{map:d}=i,{country:f}=i,o=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(S){return S?U2(S,Ws,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=S=>{"apiKey"in S&&n(0,u=S.apiKey),"map"in S&&n(4,d=S.map),"country"in S&&n(1,f=S.country)},r.$$.update=()=>{r.$$.dirty&16&&n(2,a=_(d))},[u,f,a,o,d]}class MS extends ui{constructor(i){super(),ci(this,i,AS,IS,ti,{apiKey:0,map:4,country:1})}}let PS=Date.now();function Qc(r){return`${r}-${PS++}`}const yp=Symbol.for("svelte-maplibre");function sl(){return $y(yp)}function LS(r){let i=new WeakMap;return n=>{var f;let a=i.get(n.originalEvent);if(a!==void 0)return a;let d=(f=n.target.queryRenderedFeatures(n.point).find(o=>{var _;return(_=r.get(o.layer.id))==null?void 0:_.interactive}))==null?void 0:f.layer.id;return i.set(n.originalEvent,d),d}}function zS(){let r=new Map;return $d(yp,{map:kn(null),source:Sd(null),layer:Sd(null),popupTarget:Sd(null),cluster:kn(),loadedImages:kn(new Set),minzoom:kn(0),maxzoom:kn(24),layerEvent:kn(null),layerInfo:r,eventTopMost:LS(r),markerClickManager:new RS})}function g_(r){return{subscribe:r.subscribe}}function ib({key:r,setPopupTarget:i=!1,setCluster:n=!1,setMouseEvent:a=!1}){let u=sl(),d=kn(null),f=g_(d),o={...u,[r]:g_(d)};if(i&&(o.popupTarget=f),a){let _=kn(null);o.layerEvent=_,u.layerEvent=_}return n&&(o.cluster=kn()),$d(yp,o),{...u,self:d}}function OS(){return ib({key:"source",setCluster:!0})}function DS(r=!0){return ib({key:"layer",setPopupTarget:r,setMouseEvent:r})}function FS(r){return"layerType"in r&&r.layerType==="deckgl"}class RS{constructor(){Zn(this,"_handlers",new Set)}add(i){this._handlers.add(i)}remove(i){this._handlers.delete(i)}handleClick(i){for(const n of this._handlers)n(i)}}function __(r){let i;return n=>{if(n)for(let a in n){let u=i==null?void 0:i[a],d=n[a];u!==d&&r(a,d,u)}else if(i)for(let a in i)r(a,void 0,i[a]);i=n}}function BS(r,...i){let n=[r];for(let a of i)if(a)Array.isArray(a)&&a[0]===r?n.push(...a.slice(1)):n.push(a);else continue;if(n.length!==1)return n.length===2?n[1]:n}function NS(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function df(r,i){return["case",["boolean",["feature-state","hover"],!1],i,r]}function y_(r){let i=r[0],n,a,u=b_(r);return{c(){u.c(),n=Mn()},m(d,f){u.m(d,f),xe(d,n,f),a=!0},p(d,f){f[0]&1&&ti(i,i=d[0])?(ln(),Ve(u,1,1,Ht),cn(),u=b_(d),u.c(),Re(u,1),u.m(n.parentNode,n)):u.p(d,f)},i(d){a||(Re(u),a=!0)},o(d){Ve(u),a=!1},d(d){d&&we(n),u.d(d)}}}function b_(r){let i;const n=r[36].default,a=vn(n,r,r[35],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d[1]&16)&&xn(a,n,u,u[35],i?wn(n,u[35],d,null):Sn(u[35]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function jS(r){let i,n,a=r[0]&&y_(r);return{c(){a&&a.c(),i=Mn()},m(u,d){a&&a.m(u,d),xe(u,i,d),n=!0},p(u,d){u[0]?a?(a.p(u,d),d[0]&1&&Re(a,1)):(a=y_(u),a.c(),Re(a,1),a.m(i.parentNode,i)):a&&(ln(),Ve(a,1,1,()=>{a=null}),cn())},i(u){n||(Re(a),n=!0)},o(u){Ve(a),n=!1},d(u){u&&we(i),a&&a.d(u)}}}function US(r,i,n){let a,u,d,f,o,_,S,T,y,k,I,C,{$$slots:L={},$$scope:B}=i,{id:N=Qc("layer")}=i,{source:F=void 0}=i,{sourceLayer:W=void 0}=i,{beforeId:ee=void 0}=i,{beforeLayerType:oe=void 0}=i,{type:$}=i,{paint:re=void 0}=i,{layout:j=void 0}=i,{filter:U=void 0}=i,{applyToClusters:J=void 0}=i,{minzoom:R=void 0}=i,{maxzoom:Z=void 0}=i,{manageHoverState:ce=!1}=i,{hovered:fe=null}=i,{interactive:ge=!0}=i,{hoverCursor:ye=void 0}=i,{eventsIfTopMost:he=!1}=i;const Fe=nl(),{map:Me,source:lt,self:Ze,minzoom:ht,maxzoom:kt,eventTopMost:$e,layerInfo:vt}=DS();Gt(r,Me,He=>n(31,y=He)),Gt(r,lt,He=>n(32,k=He)),Gt(r,Ze,He=>n(0,T=He)),Gt(r,ht,He=>n(34,C=He)),Gt(r,kt,He=>n(33,I=He)),hs(()=>{T&&y&&(vt.delete(T),y==null||y.removeLayer(T))});let St;function Zt(He){var gi,pt;if(!ge||!T||!y||he&&$e(He)!==T)return;let Pt=He.features??[],ni=(pt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:pt.cluster_id,Ye={event:He,map:y,clusterId:ni,layer:T,source:o,features:Pt};Fe(He.type,Ye)}function oi(He){var gi,pt;if(!ge||!T||!y||he&&$e(He)!==T)return;ye&&(y.getCanvas().style.cursor=ye);let Pt=He.features??[];n(6,fe=Pt[0]??null);let ni=(pt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:pt.cluster_id;Fe("mouseenter",{event:He,map:y,clusterId:ni,layer:T,source:o,features:Pt})}function Mi(He){var gi,pt,it;if(!ge||!y)return;if(he&&$e(He)!==T){n(6,fe=null),ce&&St!==void 0&&(y==null||y.setFeatureState({source:o,sourceLayer:W,id:St},{hover:!1}),St=void 0);return}y.getCanvas().style.cursor=ye;let Pt=He.features??[],ni=(pt=(gi=Pt[0])==null?void 0:gi.properties)==null?void 0:pt.cluster_id,Ye=(it=Pt[0])==null?void 0:it.id;Ye!==St&&(ce&&(St!==void 0&&(y==null||y.setFeatureState({source:o,id:St,sourceLayer:W},{hover:!1})),y==null||y.setFeatureState({source:o,id:Ye,sourceLayer:W},{hover:!0})),St=Ye,n(6,fe=Pt[0]??null)),Fe("mousemove",{event:He,map:y,clusterId:ni,layer:T,source:o,features:Pt})}function Pi(He){if(!(!ge||!T||!y)){if(ye&&(y.getCanvas().style.cursor=""),n(6,fe=null),ce&&St!==void 0){const Pt={source:o,id:St,sourceLayer:W};y==null||y.setFeatureState(Pt,{hover:!1}),St=void 0}Fe("mouseleave",{map:y,layer:T,source:o})}}let Ti=!0;function At(He){y&&(y.off("click",He,Zt),y.off("dblclick",He,Zt),y.off("contextmenu",He,Zt),y.off("mouseenter",He,oi),y.off("mousemove",He,Mi),y.off("mouseleave",He,Pi))}return hs(()=>{y&&T&&At(T)}),r.$$set=He=>{"id"in He&&n(7,N=He.id),"source"in He&&n(8,F=He.source),"sourceLayer"in He&&n(9,W=He.sourceLayer),"beforeId"in He&&n(10,ee=He.beforeId),"beforeLayerType"in He&&n(11,oe=He.beforeLayerType),"type"in He&&n(12,$=He.type),"paint"in He&&n(13,re=He.paint),"layout"in He&&n(14,j=He.layout),"filter"in He&&n(15,U=He.filter),"applyToClusters"in He&&n(16,J=He.applyToClusters),"minzoom"in He&&n(17,R=He.minzoom),"maxzoom"in He&&n(18,Z=He.maxzoom),"manageHoverState"in He&&n(19,ce=He.manageHoverState),"hovered"in He&&n(6,fe=He.hovered),"interactive"in He&&n(20,ge=He.interactive),"hoverCursor"in He&&n(21,ye=He.hoverCursor),"eventsIfTopMost"in He&&n(22,he=He.eventsIfTopMost),"$$scope"in He&&n(35,B=He.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,a=NS(J)),r.$$.dirty[0]&1073774592&&n(24,u=BS("all",a,U)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,d=R??C),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,f=Z??I),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,o=F||k),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&T!==N&&o){T&&(At(T),vt.delete(T));let He=ee;if(!ee&&oe){let Pt=y.getStyle().layers,ni=typeof oe=="function"?oe:gi=>gi.type===oe,Ye=Pt==null?void 0:Pt.find(ni);Ye&&(He=Ye.id)}dn(Ze,T=N,T),y.addLayer(ql({id:T,type:$,source:o,"source-layer":W,filter:u,paint:re,layout:j,minzoom:d,maxzoom:f}),He),n(23,Ti=!0),y.on("click",T,Zt),y.on("dblclick",T,Zt),y.on("contextmenu",T,Zt),y.on("mouseenter",T,oi),y.on("mousemove",T,Mi),y.on("mouseleave",T,Pi)}r.$$.dirty[0]&1048577&&T&&vt.set(T,{interactive:ge}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,_=T?__((He,Pt)=>{y!=null&&y.style._loaded?y.setPaintProperty(T,He,Pt):y==null||y.once("styledata",()=>y==null?void 0:y.setPaintProperty(T,He,Pt))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,S=T?__((He,Pt)=>{y!=null&&y.style._loaded?y.setLayoutProperty(T,He,Pt):y==null||y.once("styledata",()=>y==null?void 0:y.setLayoutProperty(T,He,Pt))}):void 0),r.$$.dirty[0]&268443648&&(_==null||_(re)),r.$$.dirty[0]&134234112&&(S==null||S(j)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&T&&(y==null||y.setLayerZoomRange(T,d,f)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&T&&(Ti?n(23,Ti=!1):y==null||y.setFilter(T,u))},[T,Me,lt,Ze,ht,kt,fe,N,F,W,ee,oe,$,re,j,U,J,R,Z,ce,ge,ye,he,Ti,u,f,d,S,_,o,a,y,k,I,C,B,L]}class xf extends ui{constructor(i){super(),ci(this,i,US,jS,ti,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function VS(r){let i;const n=r[16].default,a=vn(n,r,r[24],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&16777216)&&xn(a,n,u,u[24],i?wn(n,u[24],d,null):Sn(u[24]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function qS(r){let i,n,a;function u(f){r[17](f)}let d={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[VS]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),i=new xf({props:d}),wi.push(()=>Xi(i,"hovered",u)),i.$on("click",r[18]),i.$on("dblclick",r[19]),i.$on("contextmenu",r[20]),i.$on("mouseenter",r[21]),i.$on("mousemove",r[22]),i.$on("mouseleave",r[23]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.applyToClusters=f[9]),o&1024&&(_.minzoom=f[10]),o&2048&&(_.maxzoom=f[11]),o&4096&&(_.hoverCursor=f[12]),o&8192&&(_.manageHoverState=f[13]),o&16384&&(_.eventsIfTopMost=f[14]),o&32768&&(_.interactive=f[15]),o&16777216&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function ZS(r,i,n){let{$$slots:a={},$$scope:u}=i,{id:d=Qc("circle")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:S=void 0}=i,{paint:T}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{applyToClusters:I=void 0}=i,{minzoom:C=void 0}=i,{maxzoom:L=void 0}=i,{hoverCursor:B=void 0}=i,{manageHoverState:N=!1}=i,{hovered:F=null}=i,{eventsIfTopMost:W=!1}=i,{interactive:ee=!0}=i;function oe(Z){F=Z,n(0,F)}function $(Z){Di.call(this,r,Z)}function re(Z){Di.call(this,r,Z)}function j(Z){Di.call(this,r,Z)}function U(Z){Di.call(this,r,Z)}function J(Z){Di.call(this,r,Z)}function R(Z){Di.call(this,r,Z)}return r.$$set=Z=>{"id"in Z&&n(1,d=Z.id),"source"in Z&&n(2,f=Z.source),"sourceLayer"in Z&&n(3,o=Z.sourceLayer),"beforeId"in Z&&n(4,_=Z.beforeId),"beforeLayerType"in Z&&n(5,S=Z.beforeLayerType),"paint"in Z&&n(6,T=Z.paint),"layout"in Z&&n(7,y=Z.layout),"filter"in Z&&n(8,k=Z.filter),"applyToClusters"in Z&&n(9,I=Z.applyToClusters),"minzoom"in Z&&n(10,C=Z.minzoom),"maxzoom"in Z&&n(11,L=Z.maxzoom),"hoverCursor"in Z&&n(12,B=Z.hoverCursor),"manageHoverState"in Z&&n(13,N=Z.manageHoverState),"hovered"in Z&&n(0,F=Z.hovered),"eventsIfTopMost"in Z&&n(14,W=Z.eventsIfTopMost),"interactive"in Z&&n(15,ee=Z.interactive),"$$scope"in Z&&n(24,u=Z.$$scope)},[F,d,f,o,_,S,T,y,k,I,C,L,B,N,W,ee,a,oe,$,re,j,U,J,R,u]}class $c extends ui{constructor(i){super(),ci(this,i,ZS,qS,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function WS(r){let i,n;const a=r[7].default,u=vn(a,r,r[6],null);return{c(){i=ke("div"),u&&u.c(),_e(i,"class",r[1]),Dr(i,"maplibregl-ctrl",r[0])},m(d,f){xe(d,i,f),u&&u.m(i,null),r[8](i),n=!0},p(d,[f]){u&&u.p&&(!n||f&64)&&xn(u,a,d,d[6],n?wn(a,d[6],f,null):Sn(d[6]),null),(!n||f&2)&&_e(i,"class",d[1]),(!n||f&3)&&Dr(i,"maplibregl-ctrl",d[0])},i(d){n||(Re(u,d),n=!0)},o(d){Ve(u,d),n=!1},d(d){d&&we(i),u&&u.d(d),r[8](null)}}}function GS(r,i,n){let a,{$$slots:u={},$$scope:d}=i,{defaultStyling:f=!0}=i,{position:o="top-right"}=i,{class:_=void 0}=i;const{map:S}=sl();Gt(r,S,I=>n(5,a=I));let T,y={onAdd(){return T},onRemove(){var I;(I=T==null?void 0:T.parentNode)==null||I.removeChild(T)}};hs(()=>{a==null||a.removeControl(y)});function k(I){wi[I?"unshift":"push"](()=>{T=I,n(2,T)})}return r.$$set=I=>{"defaultStyling"in I&&n(0,f=I.defaultStyling),"position"in I&&n(4,o=I.position),"class"in I&&n(1,_=I.class),"$$scope"in I&&n(6,d=I.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&a&&T&&a.addControl(y,o)},[f,_,T,S,o,a,d,u,k]}class HS extends ui{constructor(i){super(),ci(this,i,GS,WS,ti,{defaultStyling:0,position:4,class:1})}}function XS(r){let i;const n=r[15].default,a=vn(n,r,r[23],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&8388608)&&xn(a,n,u,u[23],i?wn(n,u[23],d,null):Sn(u[23]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function KS(r){let i,n,a;function u(f){r[16](f)}let d={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[XS]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),i=new xf({props:d}),wi.push(()=>Xi(i,"hovered",u)),i.$on("click",r[17]),i.$on("dblclick",r[18]),i.$on("contextmenu",r[19]),i.$on("mouseenter",r[20]),i.$on("mousemove",r[21]),i.$on("mouseleave",r[22]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.minzoom=f[9]),o&1024&&(_.maxzoom=f[10]),o&2048&&(_.hoverCursor=f[11]),o&4096&&(_.manageHoverState=f[12]),o&8192&&(_.eventsIfTopMost=f[13]),o&16384&&(_.interactive=f[14]),o&8388608&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function JS(r,i,n){let{$$slots:a={},$$scope:u}=i,{id:d=Qc("fill")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:S=void 0}=i,{paint:T}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{minzoom:I=void 0}=i,{maxzoom:C=void 0}=i,{hoverCursor:L=void 0}=i,{manageHoverState:B=!1}=i,{hovered:N=null}=i,{eventsIfTopMost:F=!1}=i,{interactive:W=!0}=i;function ee(R){N=R,n(0,N)}function oe(R){Di.call(this,r,R)}function $(R){Di.call(this,r,R)}function re(R){Di.call(this,r,R)}function j(R){Di.call(this,r,R)}function U(R){Di.call(this,r,R)}function J(R){Di.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,d=R.id),"source"in R&&n(2,f=R.source),"sourceLayer"in R&&n(3,o=R.sourceLayer),"beforeId"in R&&n(4,_=R.beforeId),"beforeLayerType"in R&&n(5,S=R.beforeLayerType),"paint"in R&&n(6,T=R.paint),"layout"in R&&n(7,y=R.layout),"filter"in R&&n(8,k=R.filter),"minzoom"in R&&n(9,I=R.minzoom),"maxzoom"in R&&n(10,C=R.maxzoom),"hoverCursor"in R&&n(11,L=R.hoverCursor),"manageHoverState"in R&&n(12,B=R.manageHoverState),"hovered"in R&&n(0,N=R.hovered),"eventsIfTopMost"in R&&n(13,F=R.eventsIfTopMost),"interactive"in R&&n(14,W=R.interactive),"$$scope"in R&&n(23,u=R.$$scope)},[N,d,f,o,_,S,T,y,k,I,C,L,B,F,W,a,ee,oe,$,re,j,U,J,u]}class YS extends ui{constructor(i){super(),ci(this,i,JS,KS,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function QS(r,i,n){let a;const{map:u}=sl();Gt(r,u,_=>n(4,a=_));let{position:d="top-left"}=i,{container:f=void 0}=i,o=null;return hs(()=>{a!=null&&a.loaded()&&o&&a.removeControl(o)}),r.$$set=_=>{"position"in _&&n(1,d=_.position),"container"in _&&n(2,f=_.container)},r.$$.update=()=>{if(r.$$.dirty&30&&a&&!o){let _;typeof f=="string"?_=document.querySelector(f)??void 0:_=f,n(3,o=new Ws.FullscreenControl({container:_})),a.addControl(o,d)}},[u,d,f,o,a]}class $S extends ui{constructor(i){super(),ci(this,i,QS,null,ti,{position:1,container:2})}}function eT(r,i,n,a,u){let d=!1;r.getSource(i)&&(d=!0,r.removeSource(i));const f=()=>{a(i)&&(r.addSource(i,n),u())};if(d){const o=()=>{i&&(r.getSource(i)?setTimeout(o,1):f())};o()}else f()}function tT(r,i,n){i0().then(()=>{let a=Jy(r);if(!a)return;a.getSource(i)===n&&a.removeSource(i)})}function v_(r){let i=r[0],n,a,u=w_(r);return{c(){u.c(),n=Mn()},m(d,f){u.m(d,f),xe(d,n,f),a=!0},p(d,f){f&1&&ti(i,i=d[0])?(ln(),Ve(u,1,1,Ht),cn(),u=w_(d),u.c(),Re(u,1),u.m(n.parentNode,n)):u.p(d,f)},i(d){a||(Re(u),a=!0)},o(d){Ve(u),a=!1},d(d){d&&we(n),u.d(d)}}}function w_(r){let i;const n=r[19].default,a=vn(n,r,r[18],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&262144)&&xn(a,n,u,u[18],i?wn(n,u[18],d,null):Sn(u[18]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function iT(r){let i,n,a=r[0]&&v_(r);return{c(){a&&a.c(),i=Mn()},m(u,d){a&&a.m(u,d),xe(u,i,d),n=!0},p(u,[d]){u[0]?a?(a.p(u,d),d&1&&Re(a,1)):(a=v_(u),a.c(),Re(a,1),a.m(i.parentNode,i)):a&&(ln(),Ve(a,1,1,()=>{a=null}),cn())},i(u){n||(Re(a),n=!0)},o(u){Ve(a),n=!1},d(u){u&&we(i),a&&a.d(u)}}}function nT(r,i,n){let a,u,d,{$$slots:f={},$$scope:o}=i,{id:_=Qc("geojson")}=i,{data:S}=i,{generateId:T=!1}=i,{promoteId:y=void 0}=i,{filter:k=void 0}=i,{lineMetrics:I=void 0}=i,{cluster:C=void 0}=i,{maxzoom:L=void 0}=i,{attribution:B=void 0}=i,{buffer:N=void 0}=i,{tolerance:F=void 0}=i;const{map:W,cluster:ee,self:oe}=OS();Gt(r,W,j=>n(17,u=j)),Gt(r,ee,j=>n(20,d=j)),Gt(r,oe,j=>n(0,a=j));let $,re=!0;return hs(()=>{a&&$&&u&&(tT(W,a,$),dn(oe,a=null,a),n(15,$=void 0))}),r.$$set=j=>{"id"in j&&n(4,_=j.id),"data"in j&&n(5,S=j.data),"generateId"in j&&n(6,T=j.generateId),"promoteId"in j&&n(7,y=j.promoteId),"filter"in j&&n(8,k=j.filter),"lineMetrics"in j&&n(9,I=j.lineMetrics),"cluster"in j&&n(10,C=j.cluster),"maxzoom"in j&&n(11,L=j.maxzoom),"attribution"in j&&n(12,B=j.attribution),"buffer"in j&&n(13,N=j.buffer),"tolerance"in j&&n(14,F=j.tolerance),"$$scope"in j&&n(18,o=j.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&dn(ee,d=C,d),r.$$.dirty&196593&&u&&a!==_&&(dn(oe,a=_,a),eT(u,a,ql({type:"geojson",data:S,filter:k,lineMetrics:I,generateId:T,promoteId:y,cluster:!!C,clusterMinPoints:C==null?void 0:C.minPoints,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius,clusterProperties:C==null?void 0:C.properties,maxzoom:L,attribution:B,buffer:N,tolerance:F}),j=>u&&j===a,()=>{a&&(n(15,$=u==null?void 0:u.getSource(a)),n(16,re=!0))})),r.$$.dirty&131088&&(u==null||u.on("style.load",()=>{n(15,$=u==null?void 0:u.getSource(_))})),r.$$.dirty&98336&&$&&(re?n(16,re=!1):$.setData(S)),r.$$.dirty&33792&&($==null||$.setClusterOptions(ql({cluster:!!C,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius})))},[a,W,ee,oe,_,S,T,y,k,I,C,L,B,N,F,$,re,u,o,f]}class cs extends ui{constructor(i){super(),ci(this,i,nT,iT,ti,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function rT(r,i,n){let a;const{map:u}=sl();Gt(r,u,k=>n(8,a=k));let{position:d="top-left"}=i,{positionOptions:f=void 0}=i,{fitBoundsOptions:o=void 0}=i,{trackUserLocation:_=!1}=i,{showAccuracyCircle:S=!0}=i,{showUserLocation:T=!0}=i,{control:y=null}=i;return hs(()=>{a!=null&&a.loaded()&&y&&a.removeControl(y)}),r.$$set=k=>{"position"in k&&n(2,d=k.position),"positionOptions"in k&&n(3,f=k.positionOptions),"fitBoundsOptions"in k&&n(4,o=k.fitBoundsOptions),"trackUserLocation"in k&&n(5,_=k.trackUserLocation),"showAccuracyCircle"in k&&n(6,S=k.showAccuracyCircle),"showUserLocation"in k&&n(7,T=k.showUserLocation),"control"in k&&n(1,y=k.control)},r.$$.update=()=>{r.$$.dirty&510&&a&&!y&&(n(1,y=new Ws.GeolocateControl({positionOptions:f,fitBoundsOptions:o,trackUserLocation:_,showAccuracyCircle:S,showUserLocation:T})),a.addControl(y,d))},[u,y,d,f,o,_,S,T,a]}class sT extends ui{constructor(i){super(),ci(this,i,rT,null,ti,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function oT(r){let i;const n=r[15].default,a=vn(n,r,r[23],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&8388608)&&xn(a,n,u,u[23],i?wn(n,u[23],d,null):Sn(u[23]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function aT(r){let i,n,a;function u(f){r[16](f)}let d={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[oT]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),i=new xf({props:d}),wi.push(()=>Xi(i,"hovered",u)),i.$on("click",r[17]),i.$on("dblclick",r[18]),i.$on("contextmenu",r[19]),i.$on("mouseenter",r[20]),i.$on("mousemove",r[21]),i.$on("mouseleave",r[22]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.minzoom=f[9]),o&1024&&(_.maxzoom=f[10]),o&2048&&(_.hoverCursor=f[11]),o&4096&&(_.manageHoverState=f[12]),o&8192&&(_.eventsIfTopMost=f[13]),o&16384&&(_.interactive=f[14]),o&8388608&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function lT(r,i,n){let{$$slots:a={},$$scope:u}=i,{id:d=Qc("line")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:S=void 0}=i,{paint:T}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{minzoom:I=void 0}=i,{maxzoom:C=void 0}=i,{hoverCursor:L=void 0}=i,{manageHoverState:B=!1}=i,{hovered:N=null}=i,{eventsIfTopMost:F=!1}=i,{interactive:W=!0}=i;function ee(R){N=R,n(0,N)}function oe(R){Di.call(this,r,R)}function $(R){Di.call(this,r,R)}function re(R){Di.call(this,r,R)}function j(R){Di.call(this,r,R)}function U(R){Di.call(this,r,R)}function J(R){Di.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,d=R.id),"source"in R&&n(2,f=R.source),"sourceLayer"in R&&n(3,o=R.sourceLayer),"beforeId"in R&&n(4,_=R.beforeId),"beforeLayerType"in R&&n(5,S=R.beforeLayerType),"paint"in R&&n(6,T=R.paint),"layout"in R&&n(7,y=R.layout),"filter"in R&&n(8,k=R.filter),"minzoom"in R&&n(9,I=R.minzoom),"maxzoom"in R&&n(10,C=R.maxzoom),"hoverCursor"in R&&n(11,L=R.hoverCursor),"manageHoverState"in R&&n(12,B=R.manageHoverState),"hovered"in R&&n(0,N=R.hovered),"eventsIfTopMost"in R&&n(13,F=R.eventsIfTopMost),"interactive"in R&&n(14,W=R.interactive),"$$scope"in R&&n(23,u=R.$$scope)},[N,d,f,o,_,S,T,y,k,I,C,L,B,F,W,a,ee,oe,$,re,j,U,J,u]}class il extends ui{constructor(i){super(),ci(this,i,lT,aT,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function cT(r,i,n){let a;const u=nl();let{layer:d=void 0}=i;const{map:f}=sl();Gt(r,f,T=>n(2,a=T));function o(T){u(T.type,{...T,map:f})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],S=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return hs(()=>{if(a)if(d)for(const T of _)a.off(T,d,o);else for(const T of S)a.off(T,o)}),r.$$set=T=>{"layer"in T&&n(1,d=T.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&a)if(d)for(const T of _)a.on(T,d,o);else for(const T of S)a.on(T,o)},[f,d,a]}class nb extends ui{constructor(i){super(),ci(this,i,cT,null,ti,{layer:1})}}function uT(r){let i=r.getCenter(),n=Math.round(r.getZoom()*100)/100,a=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,a),d=Math.round(i.lat*u)/u,f=Math.round(i.lng*u)/u,o=`${n}/${d}/${f}`,_=r.getBearing(),S=r.getPitch();return(_||S)&&(o+=`/${Math.round(_*10)/10}`),S&&(o+=`/${Math.round(S)}`),`#${o}`}function hT(r){return r.replace("#","").split("/").map(parseFloat)}function fT(r,i,n){let a;const{map:u}=sl();Gt(r,u,T=>n(6,a=T));let{position:d="top-left"}=i,{showCompass:f=!0}=i,{showZoom:o=!0}=i,{visualizePitch:_=!1}=i,S=null;return hs(()=>{a!=null&&a.loaded()&&S&&a.removeControl(S)}),r.$$set=T=>{"position"in T&&n(1,d=T.position),"showCompass"in T&&n(2,f=T.showCompass),"showZoom"in T&&n(3,o=T.showZoom),"visualizePitch"in T&&n(4,_=T.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&a&&!S&&(n(5,S=new Ws.NavigationControl({showCompass:f,showZoom:o,visualizePitch:_})),a.addControl(S,d))},[u,d,f,o,_,S,a]}class rb extends ui{constructor(i){super(),ci(this,i,fT,null,ti,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function dT(r,i,n){let a;const{map:u}=sl();Gt(r,u,S=>n(5,a=S));let{position:d="bottom-left"}=i,{maxWidth:f=void 0}=i,{unit:o="metric"}=i,_=null;return hs(()=>{a!=null&&a.loaded()&&_&&a.removeControl(_)}),r.$$set=S=>{"position"in S&&n(1,d=S.position),"maxWidth"in S&&n(2,f=S.maxWidth),"unit"in S&&n(3,o=S.unit)},r.$$.update=()=>{r.$$.dirty&62&&a&&!_&&(n(4,_=new Ws.ScaleControl({maxWidth:f,unit:o})),a.addControl(_,d))},[u,d,f,o,_,a]}class sb extends ui{constructor(i){super(),ci(this,i,dT,null,ti,{position:1,maxWidth:2,unit:3})}}const{window:pT}=Qy,mT=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),x_=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function S_(r){let i,n,a=r[3]&&T_(r);const u=r[46].default,d=vn(u,r,r[45],x_);return{c(){a&&a.c(),i=Qe(),d&&d.c()},m(f,o){a&&a.m(f,o),xe(f,i,o),d&&d.m(f,o),n=!0},p(f,o){f[3]?a?(a.p(f,o),o[0]&8&&Re(a,1)):(a=T_(f),a.c(),Re(a,1),a.m(i.parentNode,i)):a&&(ln(),Ve(a,1,1,()=>{a=null}),cn()),d&&d.p&&(!n||o[0]&112|o[1]&16384)&&xn(d,u,f,f[45],n?wn(u,f[45],o,mT):Sn(f[45]),x_)},i(f){n||(Re(a),Re(d,f),n=!0)},o(f){Ve(a),Ve(d,f),n=!1},d(f){f&&we(i),a&&a.d(f),d&&d.d(f)}}}function T_(r){let i,n,a,u,d,f,o,_;return i=new rb({props:{position:r[7]}}),a=new sT({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),d=new $S({props:{position:r[7]}}),o=new sb({props:{position:r[7]}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment),u=Qe(),yt(d.$$.fragment),f=Qe(),yt(o.$$.fragment)},m(S,T){gt(i,S,T),xe(S,n,T),gt(a,S,T),xe(S,u,T),gt(d,S,T),xe(S,f,T),gt(o,S,T),_=!0},p(S,T){const y={};T[0]&128&&(y.position=S[7]),i.$set(y);const k={};T[0]&128&&(k.position=S[7]),a.$set(k);const I={};T[0]&128&&(I.position=S[7]),d.$set(I);const C={};T[0]&128&&(C.position=S[7]),o.$set(C)},i(S){_||(Re(i.$$.fragment,S),Re(a.$$.fragment,S),Re(d.$$.fragment,S),Re(o.$$.fragment,S),_=!0)},o(S){Ve(i.$$.fragment,S),Ve(a.$$.fragment,S),Ve(d.$$.fragment,S),Ve(o.$$.fragment,S),_=!1},d(S){S&&(we(n),we(u),we(f)),_t(i,S),_t(a,S),_t(d,S),_t(o,S)}}}function gT(r){let i,n,a,u,d,f=r[4]&&r[0]&&S_(r);return{c(){i=ke("div"),f&&f.c(),_e(i,"class",n=Wc(r[2])+" svelte-p00lfq"),_e(i,"data-testid","map-container"),Dr(i,"expand-map",!r[2])},m(o,_){xe(o,i,_),f&&f.m(i,null),r[47](i),a=!0,u||(d=[Wt(pT,"hashchange",r[11]),h1(r[10].call(null,i))],u=!0)},p(o,_){o[4]&&o[0]?f?(f.p(o,_),_[0]&17&&Re(f,1)):(f=S_(o),f.c(),Re(f,1),f.m(i,null)):f&&(ln(),Ve(f,1,1,()=>{f=null}),cn()),(!a||_[0]&4&&n!==(n=Wc(o[2])+" svelte-p00lfq"))&&_e(i,"class",n),(!a||_[0]&4)&&Dr(i,"expand-map",!o[2])},i(o){a||(Re(f),a=!0)},o(o){Ve(f),a=!1},d(o){o&&we(i),f&&f.d(),r[47](null),u=!1,ir(d)}}}function _T(r,i,n){let a,u,d,f,{$$slots:o={},$$scope:_}=i,{map:S=null}=i,{mapContainer:T=void 0}=i,{class:y=void 0}=i,{style:k}=i,{diffStyleUpdates:I=!1}=i,{center:C=void 0}=i,{zoom:L=void 0}=i,{pitch:B=0}=i,{bearing:N=0}=i,{bounds:F=void 0}=i,{hash:W=!1}=i,{updateHash:ee=it=>{window.history.replaceState(window.history.state,"",it)}}=i,{loaded:oe=!1}=i,{minZoom:$=0}=i,{maxZoom:re=22}=i,{minPitch:j=0}=i,{maxPitch:U=60}=i,{renderWorldCopies:J=void 0}=i,{dragPan:R=void 0}=i,{dragRotate:Z=void 0}=i,{pitchWithRotate:ce=void 0}=i,{antialias:fe=void 0}=i,{zoomOnDoubleClick:ge=!0}=i,{locale:ye=void 0}=i,{interactive:he=!0}=i,{attributionControl:Fe=!0}=i,{cooperativeGestures:Me=!1}=i,{preserveDrawingBuffer:lt=!1}=i,{maxBounds:Ze=void 0}=i,{images:ht=[]}=i,{standardControls:kt=!1}=i,{filterLayers:$e=void 0}=i,{transformRequest:vt=void 0}=i;const St=nl(),{map:Zt,loadedImages:oi}=zS();Gt(r,Zt,it=>n(4,d=it)),Gt(r,oi,it=>n(5,f=it));let Mi=new Set;async function Pi(it,ue=!1){if(d&&!(!d.loaded()&&!ue))if("url"in it){Mi.add(it.id);try{let H=await d.loadImage(it.url);d==null||d.addImage(it.id,H.data,it.options),f.add(it.id),oi.set(f)}catch(H){St("error",H)}finally{Mi.delete(it.id)}}else d.addImage(it.id,it.data,it.options),f.add(it.id),oi.set(f)}let Ti,At,He,Pt;function ni(it){return gi(),dn(Zt,d=new Ws.Map(ql({container:it,style:k,locale:ye,center:C,zoom:L,pitch:B,bearing:N,minZoom:$,maxZoom:re,minPitch:j,maxPitch:U,renderWorldCopies:J,dragPan:R,dragRotate:Z,pitchWithRotate:ce,antialias:fe,interactive:he,preserveDrawingBuffer:lt,maxBounds:Ze,bounds:F,attributionControl:Fe,transformRequest:vt,cooperativeGestures:Me})),d),d.on("load",ue=>{ue.target.getContainer().setAttribute("data-testid","map"),ue.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,oe=!0),St("load",d)}),d.on("error",ue=>St("error",{...ue,map:d})),d.on("movestart",ue=>St("movestart",{...ue,map:d})),d.on("moveend",ue=>{if(n(12,C=ue.target.getCenter()),n(13,L=ue.target.getZoom()),n(14,B=ue.target.getPitch()),n(15,N=ue.target.getBearing()),n(16,F=ue.target.getBounds()),St("moveend",{...ue,map:d}),W){let H=new URL(window.location.href.replace(/(#.+)?$/,uT(d)));ee(H)}}),d.on("click",ue=>St("click",{...ue,map:d})),d.on("dblclick",ue=>St("dblclick",{...ue,map:d})),d.on("contextmenu",ue=>St("contextmenu",{...ue,map:d})),d.on("zoomstart",ue=>St("zoomstart",{...ue,map:d})),d.on("zoom",ue=>{St("zoom",{...ue,map:d})}),d.on("zoomend",ue=>{St("zoomend",{...ue,map:d})}),d.on("style.load",()=>{if(d){const ue=d.getStyle();if(n(42,Ti=ue.layers.map(H=>H.id)),n(43,At=Object.keys(ue.sources)),Pt)for(const[H,Y]of Object.entries(Pt))d.addSource(H,Y);if(He)for(const H of He)d.addLayer(H);for(const H of ht)Pi(H,!0)}}),d.on("styledata",ue=>{if(d&&$e){const H=d.getStyle().layers;if(H)for(let Y of H)$e(Y)||d.setLayoutProperty(Y.id,"visibility","none")}St("styledata",{...ue,map:d})}),{destroy(){n(0,oe=!1),d==null||d.remove(),dn(Zt,d=null,d)}}}let Ye=k;function gi(){if(W){let it=hT(window.location.hash);if(it.some(isNaN))return;it.length>=3&&(n(13,L=it[0]),n(12,C=[it[2],it[1]])),it.length==5&&(n(15,N=it[3]),n(14,B=it[4]))}}function pt(it){wi[it?"unshift":"push"](()=>{T=it,n(1,T)})}return r.$$set=it=>{"map"in it&&n(17,S=it.map),"mapContainer"in it&&n(1,T=it.mapContainer),"class"in it&&n(2,y=it.class),"style"in it&&n(18,k=it.style),"diffStyleUpdates"in it&&n(19,I=it.diffStyleUpdates),"center"in it&&n(12,C=it.center),"zoom"in it&&n(13,L=it.zoom),"pitch"in it&&n(14,B=it.pitch),"bearing"in it&&n(15,N=it.bearing),"bounds"in it&&n(16,F=it.bounds),"hash"in it&&n(20,W=it.hash),"updateHash"in it&&n(21,ee=it.updateHash),"loaded"in it&&n(0,oe=it.loaded),"minZoom"in it&&n(22,$=it.minZoom),"maxZoom"in it&&n(23,re=it.maxZoom),"minPitch"in it&&n(24,j=it.minPitch),"maxPitch"in it&&n(25,U=it.maxPitch),"renderWorldCopies"in it&&n(26,J=it.renderWorldCopies),"dragPan"in it&&n(27,R=it.dragPan),"dragRotate"in it&&n(28,Z=it.dragRotate),"pitchWithRotate"in it&&n(29,ce=it.pitchWithRotate),"antialias"in it&&n(30,fe=it.antialias),"zoomOnDoubleClick"in it&&n(31,ge=it.zoomOnDoubleClick),"locale"in it&&n(32,ye=it.locale),"interactive"in it&&n(33,he=it.interactive),"attributionControl"in it&&n(34,Fe=it.attributionControl),"cooperativeGestures"in it&&n(35,Me=it.cooperativeGestures),"preserveDrawingBuffer"in it&&n(36,lt=it.preserveDrawingBuffer),"maxBounds"in it&&n(37,Ze=it.maxBounds),"images"in it&&n(38,ht=it.images),"standardControls"in it&&n(3,kt=it.standardControls),"filterLayers"in it&&n(39,$e=it.filterLayers),"transformRequest"in it&&n(40,vt=it.transformRequest),"$$scope"in it&&n(45,_=it.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&n(7,a=typeof kt=="boolean"?void 0:kt),r.$$.dirty[0]&16&&n(17,S=d),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&d&&!Oc(k,Ye)){const it=d.getStyle();if(Ti&&(He=it.layers.filter(ue=>!Ti.includes(ue.id))),At){const ue=Object.keys(it.sources).filter(H=>!At.includes(H));Pt={};for(const H of ue)Pt[H]=it.sources[H]}n(44,Ye=k),d.setStyle(k,{diff:I}),dn(oi,f=new Set,f),n(41,Mi=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&oe&&d!=null&&d.loaded())for(let it of ht)!f.has(it.id)&&!Mi.has(it.id)&&!d.hasImage(it.id)&&Pi(it);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&n(6,u=ht.every(it=>f.has(it.id))),r.$$.dirty[0]&61456&&d){let it={};C!=null&&!Oc(C,d==null?void 0:d.getCenter())&&(it.center=C),L!=null&&!Oc(L,d==null?void 0:d.getZoom())&&(it.zoom=L),N!=null&&!Oc(N,d==null?void 0:d.getBearing())&&(it.bearing=N),B!=null&&!Oc(B,d==null?void 0:d.getPitch())&&(it.pitch=B),Object.keys(it).length&&d.easeTo(it)}r.$$.dirty[0]&65552&&F&&!Oc(F,d==null?void 0:d.getBounds())&&(d==null||d.fitBounds(F)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(ge?d==null||d.doubleClickZoom.enable():d==null||d.doubleClickZoom.disable())},[oe,T,y,kt,d,f,u,a,Zt,oi,ni,gi,C,L,B,N,F,S,k,I,W,ee,$,re,j,U,J,R,Z,ce,fe,ge,ye,he,Fe,Me,lt,Ze,ht,$e,vt,Mi,Ti,At,Ye,_,o,pt]}class yT extends ui{constructor(i){super(),ci(this,i,_T,gT,ti,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const bT=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),k_=r=>{var i;return{features:r[4],data:((i=r[4])==null?void 0:i[0])??null,map:r[2],close:r[32]}};function C_(r){var u;let i,n,a=(((u=r[4])==null?void 0:u.length)||r[3]instanceof Ws.Marker)&&E_(r);return{c(){i=ke("div"),a&&a.c()},m(d,f){xe(d,i,f),a&&a.m(i,null),r[33](i),n=!0},p(d,f){var o;(o=d[4])!=null&&o.length||d[3]instanceof Ws.Marker?a?(a.p(d,f),f[0]&24&&Re(a,1)):(a=E_(d),a.c(),Re(a,1),a.m(i,null)):a&&(ln(),Ve(a,1,1,()=>{a=null}),cn())},i(d){n||(Re(a),n=!0)},o(d){Ve(a),n=!1},d(d){d&&we(i),a&&a.d(),r[33](null)}}}function E_(r){let i;const n=r[31].default,a=vn(n,r,r[30],k_);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d[0]&1073741845)&&xn(a,n,u,u[30],i?wn(n,u[30],d,bT):Sn(u[30]),k_)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function vT(r){let i,n,a=r[9].default&&C_(r);return{c(){a&&a.c(),i=Mn()},m(u,d){a&&a.m(u,d),xe(u,i,d),n=!0},p(u,d){u[9].default?a?(a.p(u,d),d[0]&512&&Re(a,1)):(a=C_(u),a.c(),Re(a,1),a.m(i.parentNode,i)):a&&(ln(),Ve(a,1,1,()=>{a=null}),cn())},i(u){n||(Re(a),n=!0)},o(u){Ve(a),n=!1},d(u){u&&we(i),a&&a.d(u)}}}function wT(r,i,n){let a,u,d,f,o,_,{$$slots:S={},$$scope:T}=i;const y=u1(S);let{closeButton:k=void 0}=i,{closeOnClickOutside:I=!0}=i,{closeOnClickInside:C=!1}=i,{closeOnMove:L=!1}=i,{openOn:B="click"}=i,{openIfTopMost:N=!0}=i,{canOpen:F=void 0}=i,{focusAfterOpen:W=!0}=i,{anchor:ee=void 0}=i,{offset:oe=void 0}=i,{popupClass:$=void 0}=i,{maxWidth:re=void 0}=i,{lngLat:j=void 0}=i,{html:U=void 0}=i,{open:J=!1}=i;const R=nl(),{map:Z,popupTarget:ce,layerEvent:fe,layer:ge,eventTopMost:ye,markerClickManager:he}=sl();Gt(r,Z,pt=>n(2,d=pt)),Gt(r,ce,pt=>n(3,o=pt)),Gt(r,fe,pt=>n(29,f=pt)),Gt(r,ge,pt=>n(36,_=pt));const Fe=["click","dblclick","contextmenu"];let Me,lt=!1,Ze;function ht(){if(!Me)return;let pt=Me.getElement();!pt||pt===Ze||(Ze=pt,B==="hover"&&(Ze.style.pointerEvents="none"),Ze.addEventListener("mouseenter",()=>{n(25,lt=!0)},{passive:!0}),Ze.addEventListener("mouseleave",()=>{n(25,lt=!1)},{passive:!0}),Ze.addEventListener("click",()=>{C&&n(0,J=!1)},{passive:!0}))}Qd(()=>{if(d)return d.on("click",He),d.on("contextmenu",He),he.add(Pt),typeof o=="string"&&(d.on("click",o,Zt),d.on("dblclick",o,Zt),d.on("contextmenu",o,Zt),d.on("mousemove",o,At),d.on("mouseleave",o,Ti),d.on("touchstart",o,Mi),d.on("touchend",o,Pi)),()=>{d!=null&&d.loaded()&&(Me==null||Me.remove(),d.off("click",He),d.off("contextmenu",He),he.remove(Pt),o instanceof Ws.Marker?o.getPopup()===Me&&o.setPopup(void 0):typeof o=="string"&&(d.off("click",o,Zt),d.off("dblclick",o,Zt),d.off("contextmenu",o,Zt),d.off("mousemove",o,At),d.off("mouseleave",o,Ti),d.off("touchstart",o,Mi),d.off("touchend",o,Pi)))}});function kt(pt){return N?!("marker"in pt)&&!FS(pt)&&ye(pt)!==_:!1}let $e=null,vt="normal";function St(pt){"layerType"in pt&&pt.layerType==="deckgl"?(n(10,j=pt.coordinate),n(4,$e=pt.object?[pt.object]:null)):(n(10,j=pt.lngLat),n(4,$e=pt.features??[]))}function Zt(pt){pt.type!==B||kt(pt)||(St(pt),setTimeout(()=>n(0,J=!0)))}let oi=null;function Mi(pt){oi=pt.point}function Pi(pt){if(!oi||B!=="hover")return;let it=oi.dist(pt.point);oi=null,it<3&&(n(10,j=pt.lngLat),n(4,$e=pt.features??[]),Me.isOpen()?n(26,vt="justOpened"):(n(26,vt="opening"),n(0,J=!0)))}function Ti(pt){B!=="hover"||oi||vt!=="normal"||(n(0,J=!1),n(4,$e=null))}function At(pt){if(!(B!=="hover"||oi||vt!=="normal")){if(kt(pt)){n(0,J=!1),n(4,$e=null);return}if(n(0,J=!0),n(4,$e=pt.features??[]),n(10,j=pt.lngLat),F&&!F(pt.features??[])){n(0,J=!1);return}}}function He(pt){if(vt==="justOpened"){n(26,vt="normal");return}if(!I)return;let it=[Ze,o instanceof Ws.Marker?o==null?void 0:o.getElement():null];J&&Me.isOpen()&&!it.some(ue=>ue==null?void 0:ue.contains(pt.originalEvent.target))&&(pt.type==="contextmenu"&&B==="contextmenu"||pt.type!=="contextmenu")&&n(0,J=!1)}function Pt(pt){I&&J&&Me.isOpen()&&pt.marker!==o&&n(0,J=!1)}hs(()=>{d&&(Me!=null&&Me.isOpen())&&Me.remove()});let ni;const Ye=()=>n(0,J=!1);function gi(pt){wi[pt?"unshift":"push"](()=>{ni=pt,n(1,ni)})}return r.$$set=pt=>{"closeButton"in pt&&n(11,k=pt.closeButton),"closeOnClickOutside"in pt&&n(12,I=pt.closeOnClickOutside),"closeOnClickInside"in pt&&n(13,C=pt.closeOnClickInside),"closeOnMove"in pt&&n(14,L=pt.closeOnMove),"openOn"in pt&&n(15,B=pt.openOn),"openIfTopMost"in pt&&n(16,N=pt.openIfTopMost),"canOpen"in pt&&n(17,F=pt.canOpen),"focusAfterOpen"in pt&&n(18,W=pt.focusAfterOpen),"anchor"in pt&&n(19,ee=pt.anchor),"offset"in pt&&n(20,oe=pt.offset),"popupClass"in pt&&n(21,$=pt.popupClass),"maxWidth"in pt&&n(22,re=pt.maxWidth),"lngLat"in pt&&n(10,j=pt.lngLat),"html"in pt&&n(23,U=pt.html),"open"in pt&&n(0,J=pt.open),"$$scope"in pt&&n(30,T=pt.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(28,a=k??(!I&&!C)),r.$$.dirty[0]&293355520&&(Me||(n(24,Me=new Ws.Popup({closeButton:a,closeOnClick:!1,closeOnMove:L,focusAfterOpen:W,maxWidth:re,className:$,anchor:ee,offset:oe})),Ze=Me.getElement(),Me.on("open",()=>{n(0,J=!0),ht(),R("open",Me)}),Me.on("close",()=>{n(0,J=!1),R("close",Me)}),Me.on("hover",()=>{R("hover",Me)}))),r.$$.dirty[0]&16809992&&Me&&o instanceof Ws.Marker&&(B==="click"?o.setPopup(Me):o.getPopup()===Me&&o.setPopup(void 0)),r.$$.dirty[0]&536903680&&Fe.includes(B)&&(f==null?void 0:f.type)===B&&(Zt(f),dn(fe,f=null,f)),r.$$.dirty[0]&536903680&&n(27,u=B==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),r.$$.dirty[0]&704675840&&B==="hover"&&fe&&(u&&f&&St(f),n(0,J=(u||lt)??!1)),r.$$.dirty[0]&25165826&&(ni?Me.setDOMContent(ni):U&&Me.setHTML(U)),r.$$.dirty[0]&16778240&&j&&Me.setLngLat(j),r.$$.dirty[0]&83886085&&d){let pt=Me.isOpen();J&&!pt?(Me.addTo(d),vt==="opening"&&n(26,vt="justOpened")):!J&&pt&&Me.remove()}},[J,ni,d,o,$e,Z,ce,fe,ge,y,j,k,I,C,L,B,N,F,W,ee,oe,$,re,U,Me,lt,vt,u,a,f,T,S,Ye,gi]}class ob extends ui{constructor(i){super(),ci(this,i,wT,vT,ti,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,canOpen:17,focusAfterOpen:18,anchor:19,offset:20,popupClass:21,maxWidth:22,lngLat:10,html:23,open:0},null,[-1,-1])}}function xT(r){let i;const n=r[16].default,a=vn(n,r,r[24],null);return{c(){a&&a.c()},m(u,d){a&&a.m(u,d),i=!0},p(u,d){a&&a.p&&(!i||d&16777216)&&xn(a,n,u,u[24],i?wn(n,u[24],d,null):Sn(u[24]),null)},i(u){i||(Re(a,u),i=!0)},o(u){Ve(a,u),i=!1},d(u){a&&a.d(u)}}}function ST(r){let i,n,a;function u(f){r[17](f)}let d={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[xT]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.hovered=r[0]),i=new xf({props:d}),wi.push(()=>Xi(i,"hovered",u)),i.$on("click",r[18]),i.$on("dblclick",r[19]),i.$on("contextmenu",r[20]),i.$on("mouseenter",r[21]),i.$on("mousemove",r[22]),i.$on("mouseleave",r[23]),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,[o]){const _={};o&2&&(_.id=f[1]),o&4&&(_.source=f[2]),o&8&&(_.sourceLayer=f[3]),o&16&&(_.beforeId=f[4]),o&32&&(_.beforeLayerType=f[5]),o&64&&(_.paint=f[6]),o&128&&(_.layout=f[7]),o&256&&(_.filter=f[8]),o&512&&(_.applyToClusters=f[9]),o&1024&&(_.minzoom=f[10]),o&2048&&(_.maxzoom=f[11]),o&4096&&(_.hoverCursor=f[12]),o&8192&&(_.manageHoverState=f[13]),o&16384&&(_.eventsIfTopMost=f[14]),o&32768&&(_.interactive=f[15]),o&16777216&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.hovered=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function TT(r,i,n){let{$$slots:a={},$$scope:u}=i,{id:d=Qc("symbol")}=i,{source:f=void 0}=i,{sourceLayer:o=void 0}=i,{beforeId:_=void 0}=i,{beforeLayerType:S=void 0}=i,{paint:T=void 0}=i,{layout:y=void 0}=i,{filter:k=void 0}=i,{applyToClusters:I=void 0}=i,{minzoom:C=void 0}=i,{maxzoom:L=void 0}=i,{hoverCursor:B=void 0}=i,{manageHoverState:N=!1}=i,{hovered:F=null}=i,{eventsIfTopMost:W=!1}=i,{interactive:ee=!0}=i;function oe(Z){F=Z,n(0,F)}function $(Z){Di.call(this,r,Z)}function re(Z){Di.call(this,r,Z)}function j(Z){Di.call(this,r,Z)}function U(Z){Di.call(this,r,Z)}function J(Z){Di.call(this,r,Z)}function R(Z){Di.call(this,r,Z)}return r.$$set=Z=>{"id"in Z&&n(1,d=Z.id),"source"in Z&&n(2,f=Z.source),"sourceLayer"in Z&&n(3,o=Z.sourceLayer),"beforeId"in Z&&n(4,_=Z.beforeId),"beforeLayerType"in Z&&n(5,S=Z.beforeLayerType),"paint"in Z&&n(6,T=Z.paint),"layout"in Z&&n(7,y=Z.layout),"filter"in Z&&n(8,k=Z.filter),"applyToClusters"in Z&&n(9,I=Z.applyToClusters),"minzoom"in Z&&n(10,C=Z.minzoom),"maxzoom"in Z&&n(11,L=Z.maxzoom),"hoverCursor"in Z&&n(12,B=Z.hoverCursor),"manageHoverState"in Z&&n(13,N=Z.manageHoverState),"hovered"in Z&&n(0,F=Z.hovered),"eventsIfTopMost"in Z&&n(14,W=Z.eventsIfTopMost),"interactive"in Z&&n(15,ee=Z.interactive),"$$scope"in Z&&n(24,u=Z.$$scope)},[F,d,f,o,_,S,T,y,k,I,C,L,B,N,W,ee,a,oe,$,re,j,U,J,R,u]}class bp extends ui{constructor(i){super(),ci(this,i,TT,ST,ti,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function kT(r){let i,n,a,u;return i=new rb({props:{showCompass:!1}}),a=new sb({}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(a,d,f),u=!0},p:Ht,i(d){u||(Re(i.$$.fragment,d),Re(a.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(a.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(a,d)}}}function CT(r,i,n){let{map:a}=i;return r.$$set=u=>{"map"in u&&n(0,a=u.map)},r.$$.update=()=>{r.$$.dirty&1&&a&&(a.keyboard.disableRotation(),a.dragRotate.disable(),a.touchZoomRotate.disableRotation())},[a]}class ET extends ui{constructor(i){super(),ci(this,i,CT,kT,ti,{map:0})}}const Hd=["==",["geometry-type"],"LineString"],ab=["==",["geometry-type"],"Point"];function pf(r,i,n){let a=["match",r];for(let[u,d]of Object.entries(i))a.push(u),a.push(d);return a.push(n),a}function Zs(){return{type:"FeatureCollection",features:[]}}function lb(r){return jx(r)}let Nc="MZEJTanw3WpxRvt7qDfo",I_=`https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=${Nc}`,cb={Blank:{version:8,sources:{},layers:[],glyphs:I_},"Maptiler Streets":`https://api.maptiler.com/maps/streets-v2/style.json?key=${Nc}`,"Maptiler Dataviz":`https://api.maptiler.com/maps/dataviz/style.json?key=${Nc}`,"Maptiler Hybrid":`https://api.maptiler.com/maps/hybrid/style.json?key=${Nc}`,"Maptiler OpenStreetMap":`https://api.maptiler.com/maps/openstreetmap/style.json?key=${Nc}`,"Maptiler OS Open Zoomstack":`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${Nc}`,"ESRI World Imagery":{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"ESRI &copy; <a href='http://www.esri.com' target='_blank'>ESRI</a>",minzoom:0,maxzoom:18}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"}],glyphs:I_}};function IT(r){let i,n,a,u,d,f,o;const _=r[2].default,S=vn(_,r,r[1],null);return{c(){i=ke("div"),n=ke("label"),a=ke("input"),u=Qe(),S&&S.c(),_e(a,"class","form-check-input"),_e(a,"type","checkbox"),_e(n,"class","form-check-label"),_e(i,"class","form-check")},m(T,y){xe(T,i,y),be(i,n),be(n,a),a.checked=r[0],be(n,u),S&&S.m(n,null),d=!0,f||(o=Wt(a,"change",r[3]),f=!0)},p(T,[y]){y&1&&(a.checked=T[0]),S&&S.p&&(!d||y&2)&&xn(S,_,T,T[1],d?wn(_,T[1],y,null):Sn(T[1]),null)},i(T){d||(Re(S,T),d=!0)},o(T){Ve(S,T),d=!1},d(T){T&&we(i),S&&S.d(T),f=!1,o()}}}function AT(r,i,n){let{$$slots:a={},$$scope:u}=i,{checked:d}=i;function f(){d=this.checked,n(0,d)}return r.$$set=o=>{"checked"in o&&n(0,d=o.checked),"$$scope"in o&&n(1,u=o.$$scope)},[d,u,a,f]}class us extends ui{constructor(i){super(),ci(this,i,AT,IT,ti,{checked:0})}}function A_(r){let i,n,a,u=r[1]!=null&&M_(r);return{c(){i=ke("div"),n=Tt(r[0]),a=Qe(),u&&u.c(),_e(i,"class","cover svelte-1w7hi45")},m(d,f){xe(d,i,f),be(i,n),be(i,a),u&&u.m(i,null)},p(d,f){f&1&&Ai(n,d[0]),d[1]!=null?u?u.p(d,f):(u=M_(d),u.c(),u.m(i,null)):u&&(u.d(1),u=null)},d(d){d&&we(i),u&&u.d()}}}function M_(r){let i,n;return{c(){i=ke("div"),n=ke("progress"),n.value=r[1],en(n,"width","100%")},m(a,u){xe(a,i,u),be(i,n)},p(a,u){u&2&&(n.value=a[1])},d(a){a&&we(i)}}}function MT(r){let i,n=r[0]&&A_(r);return{c(){n&&n.c(),i=Mn()},m(a,u){n&&n.m(a,u),xe(a,i,u)},p(a,[u]){a[0]?n?n.p(a,u):(n=A_(a),n.c(),n.m(i.parentNode,i)):n&&(n.d(1),n=null)},i:Ht,o:Ht,d(a){a&&we(i),n&&n.d(a)}}}function PT(r,i,n){let{loading:a}=i,{progress:u=null}=i;return r.$$set=d=>{"loading"in d&&n(0,a=d.loading),"progress"in d&&n(1,u=d.progress)},[a,u]}class eu extends ui{constructor(i){super(),ci(this,i,PT,MT,ti,{loading:0,progress:1})}}function LT(r){let i,n,a,u,d;const f=r[5].default,o=vn(f,r,r[4],null);return{c(){i=ke("dialog"),n=ke("div"),o&&o.c(),_e(n,"class","svelte-y9d9eu"),_e(i,"class","svelte-y9d9eu")},m(_,S){xe(_,i,S),be(i,n),o&&o.m(n,null),r[6](i),a=!0,u||(d=[Wt(i,"click",f1(r[1])),Wt(i,"keydown",r[2])],u=!0)},p(_,[S]){o&&o.p&&(!a||S&16)&&xn(o,f,_,_[4],a?wn(f,_[4],S,null):Sn(_[4]),null)},i(_){a||(Re(o,_),a=!0)},o(_){Ve(o,_),a=!1},d(_){_&&we(i),o&&o.d(_),r[6](null),u=!1,ir(d)}}}function zT(r,i,n){let{$$slots:a={},$$scope:u}=i,{show:d=!1}=i,f;function o(T){T.target==f&&n(3,d=!1)}function _(T){(T.key=="Escape"||T.key=="Enter")&&(T.stopPropagation(),n(3,d=!1))}function S(T){wi[T?"unshift":"push"](()=>{f=T,n(0,f)})}return r.$$set=T=>{"show"in T&&n(3,d=T.show),"$$scope"in T&&n(4,u=T.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&f&&(d?f.showModal():f.close())},[f,o,_,d,u,a,S]}let vp=class extends ui{constructor(i){super(),ci(this,i,zT,LT,ti,{show:3})}};function P_(r,i,n){const a=r.slice();return a[4]=i[n][0],a[5]=i[n][1],a}function L_(r){let i,n,a,u,d=r[4]+"",f,o;return{c(){i=ke("div"),n=ke("span"),u=Qe(),f=Tt(d),o=Qe(),_e(n,"class",a="color-swatch "+r[1]+" svelte-1enycr6"),en(n,"background",r[5]),en(i,"display","flex"),en(i,"align-items","center"),en(i,"gap","6px")},m(_,S){xe(_,i,S),be(i,n),be(i,u),be(i,f),be(i,o)},p(_,S){S&2&&a!==(a="color-swatch "+_[1]+" svelte-1enycr6")&&_e(n,"class",a),S&1&&en(n,"background",_[5]),S&1&&d!==(d=_[4]+"")&&Ai(f,d)},d(_){_&&we(i)}}}function OT(r){let i,n=Vi(Object.entries(r[0])),a=[];for(let u=0;u<n.length;u+=1)a[u]=L_(P_(r,n,u));return{c(){i=ke("div");for(let u=0;u<a.length;u+=1)a[u].c();en(i,"display","grid"),en(i,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),en(i,"gap","10px")},m(u,d){xe(u,i,d);for(let f=0;f<a.length;f+=1)a[f]&&a[f].m(i,null)},p(u,[d]){if(d&3){n=Vi(Object.entries(u[0]));let f;for(f=0;f<n.length;f+=1){const o=P_(u,n,f);a[f]?a[f].p(o,d):(a[f]=L_(o),a[f].c(),a[f].m(i,null))}for(;f<a.length;f+=1)a[f].d(1);a.length=n.length}d&4&&en(i,"grid-template-columns","repeat(auto-fill, calc("+u[2]+" - 10px))")},i:Ht,o:Ht,d(u){u&&we(i),tr(a,u)}}}function DT(r,i,n){let a,{labelColors:u}=i,{swatchClass:d="rectangle"}=i,{itemsPerRow:f=2}=i;return r.$$set=o=>{"labelColors"in o&&n(0,u=o.labelColors),"swatchClass"in o&&n(1,d=o.swatchClass),"itemsPerRow"in o&&n(3,f=o.itemsPerRow)},r.$$.update=()=>{r.$$.dirty&8&&n(2,a=`${100/f}%`)},[u,d,a,f]}class FT extends ui{constructor(i){super(),ci(this,i,DT,OT,ti,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function ub(r,i){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(i)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function z_(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}function RT(r){let i,n,a,u,d,f,o;return{c(){i=ke("button"),i.textContent="Import current view",n=Qe(),a=ke("p"),a.textContent="or...",u=Qe(),d=ke("button"),d.textContent="Draw an area to import on the map",_e(i,"class","btn btn-primary"),_e(i,"type","button"),_e(a,"class","fst-italic my-3"),_e(d,"class","btn btn-primary"),_e(d,"type","button")},m(_,S){xe(_,i,S),xe(_,n,S),xe(_,a,S),xe(_,u,S),xe(_,d,S),f||(o=[Wt(i,"click",r[2]),Wt(d,"click",r[3])],f=!0)},p:Ht,i:Ht,o:Ht,d(_){_&&(we(i),we(n),we(a),we(u),we(d)),f=!1,ir(o)}}}function BT(r){let i,n;return i=new Bw({props:{polygonTool:r[0]}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u&1&&(d.polygonTool=a[0]),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function NT(r){let i;return{c(){i=Tt("Save a copy of the osm.xml after importing")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function jT(r){let i,n,a,u,d,f;const o=[BT,RT],_=[];function S(k,I){return k[0]?0:1}i=S(r),n=_[i]=o[i](r);function T(k){r[5](k)}let y={$$slots:{default:[NT]},$$scope:{ctx:r}};return r[1]!==void 0&&(y.checked=r[1]),u=new us({props:y}),wi.push(()=>Xi(u,"checked",T)),{c(){n.c(),a=Qe(),yt(u.$$.fragment)},m(k,I){_[i].m(k,I),xe(k,a,I),gt(u,k,I),f=!0},p(k,[I]){let C=i;i=S(k),i===C?_[i].p(k,I):(ln(),Ve(_[C],1,1,()=>{_[C]=null}),cn(),n=_[i],n?n.p(k,I):(n=_[i]=o[i](k),n.c()),Re(n,1),n.m(a.parentNode,a));const L={};I&512&&(L.$$scope={dirty:I,ctx:k}),!d&&I&2&&(d=!0,L.checked=k[1],Hi(()=>d=!1)),u.$set(L)},i(k){f||(Re(n),Re(u.$$.fragment,k),f=!0)},o(k){Ve(n),Ve(u.$$.fragment,k),f=!1},d(k){k&&we(a),_[i].d(k),_t(u,k)}}}function Xu(r){return[r.lng,r.lat]}function UT(r,i,n){let{map:a}=i;const u=nl();let d=null,f=!1;async function o(k){try{u("loading","Loading from Overpass");let C=await(await fetch(hb(k))).text();f&&ub("osm.xml",C),u("gotXml",{xml:C,boundary:k})}catch(I){u("error",I.toString())}}function _(){let k=a.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Xu(k.getSouthWest()),Xu(k.getNorthWest()),Xu(k.getNorthEast()),Xu(k.getSouthEast()),Xu(k.getSouthWest())]],type:"Polygon"}}}async function S(){if(a){if(a.getZoom()<13){u("error","Zoom in more to import");return}await o(_())}}function T(){a&&(n(0,d=new zw(a)),d.startNew(),d.addEventListenerSuccess(async k=>{n(0,d=null),await o(k)}),d.addEventListenerFailure(()=>{n(0,d=null)}))}function y(k){f=k,n(1,f)}return r.$$set=k=>{"map"in k&&n(4,a=k.map)},[d,f,S,T,a,y]}class VT extends ui{constructor(i){super(),ci(this,i,UT,jT,ti,{map:4})}}function hb(r){let i='poly:"';if(r.geometry.type=="Polygon")for(let[a,u]of r.geometry.coordinates[0])i+=`${u} ${a} `;else if(r.geometry.type=="MultiPolygon")for(let[a,u]of r.geometry.coordinates[0][0])i+=`${u} ${a} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return i=i.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${i}); node(w)->.x; <;); out meta;`}`}let mi,Yu=null;function Zc(){return(Yu===null||Yu.byteLength===0)&&(Yu=new Uint8Array(mi.memory.buffer)),Yu}let of=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});of.decode();const qT=2146435072;let Ed=0;function ZT(r,i){return Ed+=i,Ed>=qT&&(of=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),of.decode(),Ed=i),of.decode(Zc().subarray(r,r+i))}function ls(r,i){return r=r>>>0,ZT(r,i)}function $a(r){return r==null}let Fl=null;function zo(){return(Fl===null||Fl.buffer.detached===!0||Fl.buffer.detached===void 0&&Fl.buffer!==mi.memory.buffer)&&(Fl=new DataView(mi.memory.buffer)),Fl}function Xd(r){const i=typeof r;if(i=="number"||i=="boolean"||r==null)return`${r}`;if(i=="string")return`"${r}"`;if(i=="symbol"){const u=r.description;return u==null?"Symbol":`Symbol(${u})`}if(i=="function"){const u=r.name;return typeof u=="string"&&u.length>0?`Function(${u})`:"Function"}if(Array.isArray(r)){const u=r.length;let d="[";u>0&&(d+=Xd(r[0]));for(let f=1;f<u;f++)d+=", "+Xd(r[f]);return d+="]",d}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let a;if(n&&n.length>1)a=n[1];else return toString.call(r);if(a=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:a}let jl=0;const nh=new TextEncoder;"encodeInto"in nh||(nh.encodeInto=function(r,i){const n=nh.encode(r);return i.set(n),{read:r.length,written:n.length}});function Id(r,i,n){if(n===void 0){const o=nh.encode(r),_=i(o.length,1)>>>0;return Zc().subarray(_,_+o.length).set(o),jl=o.length,_}let a=r.length,u=i(a,1)>>>0;const d=Zc();let f=0;for(;f<a;f++){const o=r.charCodeAt(f);if(o>127)break;d[u+f]=o}if(f!==a){f!==0&&(r=r.slice(f)),u=n(u,a,a=f+r.length*3,1)>>>0;const o=Zc().subarray(u+f,u+a),_=nh.encodeInto(r,o);f+=_.written,u=n(u,a,f,1)>>>0}return jl=f,u}function WT(r){const i=mi.__externref_table_alloc();return mi.__wbindgen_externrefs.set(i,r),i}function Ad(r,i){try{return r.apply(this,i)}catch(n){const a=WT(n);mi.__wbindgen_exn_store(a)}}function GT(r,i){return r=r>>>0,Zc().subarray(r/1,r/1+i)}function Or(r){const i=mi.__wbindgen_externrefs.get(r);return mi.__externref_table_dealloc(r),i}function HT(r,i){const n=i(r.length*1,1)>>>0;return Zc().set(r,n/1),jl=r.length,n}const O_=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>mi.__wbg_speedwalk_free(r>>>0,1));class ch{__destroy_into_raw(){const i=this.__wbg_ptr;return this.__wbg_ptr=0,O_.unregister(this),i}free(){const i=this.__destroy_into_raw();mi.__wbg_speedwalk_free(i,0)}editClear(){mi.speedwalk_editClear(this.__wbg_ptr)}getMetrics(){let i,n;try{const d=mi.speedwalk_getMetrics(this.__wbg_ptr);var a=d[0],u=d[1];if(d[3])throw a=0,u=0,Or(d[2]);return i=a,n=u,ls(a,u)}finally{mi.__wbindgen_free(i,n,1)}}getBoundary(){let i,n;try{const d=mi.speedwalk_getBoundary(this.__wbg_ptr);var a=d[0],u=d[1];if(d[3])throw a=0,u=0,Or(d[2]);return i=a,n=u,ls(a,u)}finally{mi.__wbindgen_free(i,n,1)}}editSetTags(i,n){const a=mi.speedwalk_editSetTags(this.__wbg_ptr,i,n);if(a[1])throw Or(a[0])}editAssumeTags(i){const n=mi.speedwalk_editAssumeTags(this.__wbg_ptr,i);if(n[1])throw Or(n[0])}getOsmTimestamp(){const i=mi.speedwalk_getOsmTimestamp(this.__wbg_ptr);return i[0]===0?void 0:i[1]}toOsmChangeJson(){let i,n;try{const d=mi.speedwalk_toOsmChangeJson(this.__wbg_ptr);var a=d[0],u=d[1];if(d[3])throw a=0,u=0,Or(d[2]);return i=a,n=u,ls(a,u)}finally{mi.__wbindgen_free(i,n,1)}}getSideLocations(i){let n,a;try{const f=mi.speedwalk_getSideLocations(this.__wbg_ptr,i);var u=f[0],d=f[1];if(f[3])throw u=0,d=0,Or(f[2]);return n=u,a=d,ls(u,d)}finally{mi.__wbindgen_free(n,a,1)}}auditCrossings(i){let n,a;try{const f=mi.speedwalk_auditCrossings(this.__wbg_ptr,i);var u=f[0],d=f[1];if(f[3])throw u=0,d=0,Or(f[2]);return n=u,a=d,ls(u,d)}finally{mi.__wbindgen_free(n,a,1)}}editAddNewCrossing(i,n){const a=mi.speedwalk_editAddNewCrossing(this.__wbg_ptr,i,n);if(a[1])throw Or(a[0])}editMakeAllSidewalks(i){const n=mi.speedwalk_editMakeAllSidewalks(this.__wbg_ptr,i);if(n[1])throw Or(n[0])}editConnectAllCrossings(){const i=mi.speedwalk_editConnectAllCrossings(this.__wbg_ptr);if(i[1])throw Or(i[0])}findConnectedComponents(){let i,n;try{const d=mi.speedwalk_findConnectedComponents(this.__wbg_ptr);var a=d[0],u=d[1];if(d[3])throw a=0,u=0,Or(d[2]);return i=a,n=u,ls(a,u)}finally{mi.__wbindgen_free(i,n,1)}}constructor(i,n){const a=HT(i,mi.__wbindgen_malloc),u=jl,d=mi.speedwalk_new(a,u,n);if(d[2])throw Or(d[1]);return this.__wbg_ptr=d[0]>>>0,O_.register(this,this.__wbg_ptr,this),this}toOsc(){let i,n;try{const a=mi.speedwalk_toOsc(this.__wbg_ptr);return i=a[0],n=a[1],ls(a[0],a[1])}finally{mi.__wbindgen_free(i,n,1)}}getWays(){let i,n;try{const d=mi.speedwalk_getWays(this.__wbg_ptr);var a=d[0],u=d[1];if(d[3])throw a=0,u=0,Or(d[2]);return i=a,n=u,ls(a,u)}finally{mi.__wbindgen_free(i,n,1)}}editUndo(){const i=mi.speedwalk_editUndo(this.__wbg_ptr);if(i[1])throw Or(i[0])}getEdits(){let i,n;try{const d=mi.speedwalk_getEdits(this.__wbg_ptr);var a=d[0],u=d[1];if(d[3])throw a=0,u=0,Or(d[2]);return i=a,n=u,ls(a,u)}finally{mi.__wbindgen_free(i,n,1)}}getNodes(){let i,n;try{const d=mi.speedwalk_getNodes(this.__wbg_ptr);var a=d[0],u=d[1];if(d[3])throw a=0,u=0,Or(d[2]);return i=a,n=u,ls(a,u)}finally{mi.__wbindgen_free(i,n,1)}}get timestamp(){const i=mi.__wbg_get_speedwalk_timestamp(this.__wbg_ptr);return i[0]===0?void 0:i[1]}set timestamp(i){mi.__wbg_set_speedwalk_timestamp(this.__wbg_ptr,!$a(i),$a(i)?BigInt(0):i)}}Symbol.dispose&&(ch.prototype[Symbol.dispose]=ch.prototype.free);const XT=new Set(["basic","cors","default"]);async function KT(r,i){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,i)}catch(a){if(r.ok&&XT.has(r.type)&&r.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a);else throw a}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,i)}else{const n=await WebAssembly.instantiate(r,i);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function JT(){const r={};return r.wbg={},r.wbg.__wbg_Error_e83987f665cf5504=function(i,n){return Error(ls(i,n))},r.wbg.__wbg___wbindgen_bigint_get_as_i64_f3ebc5a755000afd=function(i,n){const a=n,u=typeof a=="bigint"?a:void 0;zo().setBigInt64(i+8*1,$a(u)?BigInt(0):u,!0),zo().setInt32(i+4*0,!$a(u),!0)},r.wbg.__wbg___wbindgen_boolean_get_6d5a1ee65bab5f68=function(i){const n=i,a=typeof n=="boolean"?n:void 0;return $a(a)?16777215:a?1:0},r.wbg.__wbg___wbindgen_debug_string_df47ffb5e35e6763=function(i,n){const a=Xd(n),u=Id(a,mi.__wbindgen_malloc,mi.__wbindgen_realloc),d=jl;zo().setInt32(i+4*1,d,!0),zo().setInt32(i+4*0,u,!0)},r.wbg.__wbg___wbindgen_in_bb933bd9e1b3bc0f=function(i,n){return i in n},r.wbg.__wbg___wbindgen_is_bigint_cb320707dcd35f0b=function(i){return typeof i=="bigint"},r.wbg.__wbg___wbindgen_is_function_ee8a6c5833c90377=function(i){return typeof i=="function"},r.wbg.__wbg___wbindgen_is_object_c818261d21f283a4=function(i){const n=i;return typeof n=="object"&&n!==null},r.wbg.__wbg___wbindgen_jsval_eq_6b13ab83478b1c50=function(i,n){return i===n},r.wbg.__wbg___wbindgen_jsval_loose_eq_b664b38a2f582147=function(i,n){return i==n},r.wbg.__wbg___wbindgen_number_get_a20bf9b85341449d=function(i,n){const a=n,u=typeof a=="number"?a:void 0;zo().setFloat64(i+8*1,$a(u)?0:u,!0),zo().setInt32(i+4*0,!$a(u),!0)},r.wbg.__wbg___wbindgen_string_get_e4f06c90489ad01b=function(i,n){const a=n,u=typeof a=="string"?a:void 0;var d=$a(u)?0:Id(u,mi.__wbindgen_malloc,mi.__wbindgen_realloc),f=jl;zo().setInt32(i+4*1,f,!0),zo().setInt32(i+4*0,d,!0)},r.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(i,n){throw new Error(ls(i,n))},r.wbg.__wbg_call_e762c39fa8ea36bf=function(){return Ad(function(i,n){return i.call(n)},arguments)},r.wbg.__wbg_debug_f4b0c59db649db48=function(i){console.debug(i)},r.wbg.__wbg_done_2042aa2670fb1db1=function(i){return i.done},r.wbg.__wbg_entries_e171b586f8f6bdbf=function(i){return Object.entries(i)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(i,n){let a,u;try{a=i,u=n,console.error(ls(i,n))}finally{mi.__wbindgen_free(a,u,1)}},r.wbg.__wbg_error_a7f8fbb0523dae15=function(i){console.error(i)},r.wbg.__wbg_get_7bed016f185add81=function(i,n){return i[n>>>0]},r.wbg.__wbg_get_efcb449f58ec27c2=function(){return Ad(function(i,n){return Reflect.get(i,n)},arguments)},r.wbg.__wbg_info_e674a11f4f50cc0c=function(i){console.info(i)},r.wbg.__wbg_instanceof_ArrayBuffer_70beb1189ca63b38=function(i){let n;try{n=i instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_instanceof_Map_8579b5e2ab5437c7=function(i){let n;try{n=i instanceof Map}catch{n=!1}return n},r.wbg.__wbg_instanceof_Uint8Array_20c8e73002f7af98=function(i){let n;try{n=i instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbg_isArray_96e0af9891d0945d=function(i){return Array.isArray(i)},r.wbg.__wbg_isSafeInteger_d216eda7911dde36=function(i){return Number.isSafeInteger(i)},r.wbg.__wbg_iterator_e5822695327a3c39=function(){return Symbol.iterator},r.wbg.__wbg_length_69bca3cb64fc8748=function(i){return i.length},r.wbg.__wbg_length_cdd215e10d9dd507=function(i){return i.length},r.wbg.__wbg_log_8cec76766b8c0e33=function(i){console.log(i)},r.wbg.__wbg_new_5a79be3ab53b8aa5=function(i){return new Uint8Array(i)},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_next_020810e0ae8ebcb0=function(){return Ad(function(i){return i.next()},arguments)},r.wbg.__wbg_next_2c826fe5dfec6b6a=function(i){return i.next},r.wbg.__wbg_prototypesetcall_2a6620b6922694b2=function(i,n,a){Uint8Array.prototype.set.call(GT(i,n),a)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(i,n){const a=n.stack,u=Id(a,mi.__wbindgen_malloc,mi.__wbindgen_realloc),d=jl;zo().setInt32(i+4*1,d,!0),zo().setInt32(i+4*0,u,!0)},r.wbg.__wbg_value_692627309814bb8c=function(i){return i.value},r.wbg.__wbg_warn_1d74dddbe2fd1dbb=function(i){console.warn(i)},r.wbg.__wbindgen_cast_2241b6af4c4b2941=function(i,n){return ls(i,n)},r.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(i){return BigInt.asUintN(64,i)},r.wbg.__wbindgen_cast_9ae0607507abb057=function(i){return i},r.wbg.__wbindgen_init_externref_table=function(){const i=mi.__wbindgen_externrefs,n=i.grow(4);i.set(0,void 0),i.set(n+0,void 0),i.set(n+1,null),i.set(n+2,!0),i.set(n+3,!1)},r}function YT(r,i){return mi=r.exports,fb.__wbindgen_wasm_module=i,Fl=null,Yu=null,mi.__wbindgen_start(),mi}async function fb(r){if(mi!==void 0)return mi;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("/speedwalk/assets/backend_bg-DdGepR09.wasm",import.meta.url));const i=JT();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:a}=await KT(await r,i);return YT(n,a)}let ol=kn(null),hr=kn(null),ho=kn(0),rh=kn(),Kd=kn({kind:"sidewalks"}),D_=kn(!1),mf=kn(!1),el=kn(JSON.parse(JSON.stringify(cb)));function QT(r){return r.reduce((i,n)=>i+n,0)}function uh(r){return r<1e3?Math.round(r)+" m":(r/1e3).toFixed(1)+" km"}async function Ro(){await new Promise(r=>{requestAnimationFrame(()=>{requestAnimationFrame(r)})})}function $T(r){let i,n,a,u,d,f,o,_,S,T,y,k;return S=new VT({props:{map:z_(r[2])}}),S.$on("gotXml",r[4]),S.$on("loading",r[6]),S.$on("error",r[7]),{c(){i=ke("div"),n=ke("div"),a=ke("label"),u=Tt(`Load an osm.pbf or osm.xml file
        `),d=ke("input"),f=Qe(),o=ke("p"),o.textContent="or...",_=Qe(),yt(S.$$.fragment),_e(d,"class","form-control"),_e(d,"type","file"),_e(a,"class","form-label"),_e(o,"class","fst-italic my-3"),_e(i,"slot","sidebar")},m(I,C){xe(I,i,C),be(i,n),be(n,a),be(a,u),be(a,d),r[5](d),be(i,f),be(i,o),be(i,_),gt(S,i,null),T=!0,y||(k=Wt(d,"change",r[3]),y=!0)},p(I,C){const L={};C&4&&(L.map=z_(I[2])),S.$set(L)},i(I){T||(Re(S.$$.fragment,I),T=!0)},o(I){Ve(S.$$.fragment,I),T=!1},d(I){I&&we(i),r[5](null),_t(S),y=!1,k()}}}function ek(r){let i,n,a;return n=new Ex({}),{c(){i=ke("div"),yt(n.$$.fragment),_e(i,"slot","map")},m(u,d){xe(u,i,d),gt(n,i,null),a=!0},p:Ht,i(u){a||(Re(n.$$.fragment,u),a=!0)},o(u){Ve(n.$$.fragment,u),a=!1},d(u){u&&we(i),_t(n)}}}function tk(r){let i,n,a,u;return i=new eu({props:{loading:r[0]}}),a=new vf({props:{$$slots:{map:[ek],sidebar:[$T]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(a,d,f),u=!0},p(d,[f]){const o={};f&1&&(o.loading=d[0]),i.$set(o);const _={};f&1031&&(_.$$scope={dirty:f,ctx:d}),a.$set(_)},i(d){u||(Re(i.$$.fragment,d),Re(a.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(a.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(a,d)}}}function ik(r,i,n){let a,u;Gt(r,hr,I=>n(8,a=I)),Gt(r,ol,I=>n(2,u=I));let d="",f;async function o(I){try{n(0,d="Loading from file"),await Ro();let C=await f.files[0].arrayBuffer();dn(hr,a=new ch(new Uint8Array(C),null),a),S()}catch(C){window.alert(`Bad input file: ${C}`)}finally{n(0,d="")}}async function _(I){try{n(0,d="Processing Overpass data"),await Ro();let C=new TextEncoder().encode(I.detail.xml);dn(hr,a=new ch(new Uint8Array(C),I.detail.boundary),a),S()}catch(C){window.alert(`Couldn't import from Overpass: ${C}`)}finally{n(0,d="")}}function S(){u.fitBounds(lb(JSON.parse(a.getNodes())),{animate:!1,padding:10})}function T(I){wi[I?"unshift":"push"](()=>{f=I,n(1,f)})}return[d,f,u,o,_,T,I=>n(0,d=I.detail),I=>window.alert(I.detail)]}class nk extends ui{constructor(i){super(),ci(this,i,ik,tk,ti,{})}}const rk="/speedwalk/assets/favicon-DMAVMD4u.ico",sk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAApElEQVRIS+XUQQqAIBAFUOcgnaEIul/tO1kQdYau0AHsC64y4n9BIWozG/lPx0lzhT8rnO9+BnjvZ7T0NLOJbS3dIoQ3CD1i8MgiNBCCgbQou4JIQEQ61I1FZCAiPerKIFmAgmQDERlQl7eTJAAu0rMj+LAuma76gLJ7HFZvEQsgnJqkrEtmw8NmZQDh5X40NVw6Qa3HrtxzzU7XfZ18ySr0feACKA1QGcdX8MgAAAAASUVORK5CYII=";function F_(r,i,n){const a=r.slice();return a[14]=i[n],a}function R_(r){let i,n,a,u=r[14].name+"",d,f,o;function _(){return r[7](r[14])}return{c(){i=ke("div"),n=ke("button"),a=Tt("Remove "),d=Tt(u),_e(n,"class","btn btn-danger mb-3")},m(S,T){xe(S,i,T),be(i,n),be(n,a),be(n,d),f||(o=Wt(n,"click",_),f=!0)},p(S,T){r=S,T&2&&u!==(u=r[14].name+"")&&Ai(d,u)},d(S){S&&we(i),f=!1,o()}}}function ok(r){let i,n,a,u,d,f,o,_,S,T,y,k,I,C,L,B,N,F,W,ee,oe,$,re,j,U,J,R,Z,ce,fe,ge,ye,he,Fe,Me=Vi(r[1]),lt=[];for(let Ze=0;Ze<Me.length;Ze+=1)lt[Ze]=R_(F_(r,Me,Ze));return{c(){i=ke("h1"),i.textContent="Customize basemaps",n=Qe();for(let Ze=0;Ze<lt.length;Ze+=1)lt[Ze].c();a=Qe(),u=ke("div"),d=ke("div"),d.textContent="Add a basemap",f=Qe(),o=ke("div"),_=ke("p"),_.textContent=`You can add custom basemaps if you know a tile URL and that the imagery
        has a license allowing it to be used for editing OSM.`,S=Qe(),T=ke("ul"),T.innerHTML=`<li><a href="https://github.com/osmlab/editor-layer-index" target="_blank">editor-layer-index</a>
          is a great reference, or you could check in iD or JOSM and figure out which
          one you like to use for your area.</li> <li>If you copy a URL from there, you may need to manually substitute some
          parts of the URL to make it work.</li> <li><b>{zoom}</b>
          
          <b>{z}</b></li> <li><b>{proj}</b>
          
          <b>{EPSG:3857}</b></li> <li><b>{width}</b>
          
          <b>256</b></li> <li><b>{height}</b>
          
          <b>256</b></li> <li><b>{bbox}</b>
          
          <b>{bbox-epsg-3857}</b></li> <li>Some sources have CORS restrictions and won&#39;t work</li>`,y=Qe(),k=ke("div"),I=ke("label"),C=Tt(`Name:
          `),L=ke("input"),B=Qe(),N=ke("div"),F=ke("label"),W=Tt(`Tile URL:
          `),ee=ke("textarea"),oe=Qe(),$=ke("div"),re=ke("label"),j=Tt(`Attribution:
          `),U=ke("input"),J=Qe(),R=ke("button"),Z=Tt("Add basemap"),fe=Qe(),ge=ke("div"),ye=ke("button"),ye.textContent="Done",_e(d,"class","card-header"),_e(L,"class","form-control"),_e(L,"type","text"),_e(I,"class","form-label"),_e(ee,"class","form-control"),_e(ee,"rows","3"),_e(ee,"cols","80"),_e(F,"class","form-label"),_e(U,"class","form-control"),_e(U,"type","text"),_e(re,"class","form-label"),_e(R,"class","btn btn-primary"),R.disabled=ce=!r[2]||!r[3]||!r[4],_e(o,"class","card-body"),_e(u,"class","card"),_e(ye,"class","btn btn-primary"),_e(ge,"class","mt-5")},m(Ze,ht){xe(Ze,i,ht),xe(Ze,n,ht);for(let kt=0;kt<lt.length;kt+=1)lt[kt]&&lt[kt].m(Ze,ht);xe(Ze,a,ht),xe(Ze,u,ht),be(u,d),be(u,f),be(u,o),be(o,_),be(o,S),be(o,T),be(o,y),be(o,k),be(k,I),be(I,C),be(I,L),Ts(L,r[2]),be(o,B),be(o,N),be(N,F),be(F,W),be(F,ee),Ts(ee,r[3]),be(o,oe),be(o,$),be($,re),be(re,j),be(re,U),Ts(U,r[4]),be(o,J),be(o,R),be(R,Z),xe(Ze,fe,ht),xe(Ze,ge,ht),be(ge,ye),he||(Fe=[Wt(L,"input",r[8]),Wt(ee,"input",r[9]),Wt(U,"input",r[10]),Wt(R,"click",r[5]),Wt(ye,"click",r[11])],he=!0)},p(Ze,ht){if(ht&66){Me=Vi(Ze[1]);let kt;for(kt=0;kt<Me.length;kt+=1){const $e=F_(Ze,Me,kt);lt[kt]?lt[kt].p($e,ht):(lt[kt]=R_($e),lt[kt].c(),lt[kt].m(a.parentNode,a))}for(;kt<lt.length;kt+=1)lt[kt].d(1);lt.length=Me.length}ht&4&&L.value!==Ze[2]&&Ts(L,Ze[2]),ht&8&&Ts(ee,Ze[3]),ht&16&&U.value!==Ze[4]&&Ts(U,Ze[4]),ht&28&&ce!==(ce=!Ze[2]||!Ze[3]||!Ze[4])&&(R.disabled=ce)},d(Ze){Ze&&(we(i),we(n),we(a),we(u),we(fe),we(ge)),tr(lt,Ze),he=!1,ir(Fe)}}}function ak(r){let i,n,a;function u(f){r[12](f)}let d={$$slots:{default:[ok]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.show=r[0]),i=new vp({props:d}),wi.push(()=>Xi(i,"show",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,[o]){const _={};o&131103&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.show=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}let Md="speedwalk-custom-basemaps";function B_(r,i){return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[r],tileSize:256,attribution:i}},layers:[{id:"raster-basemap",type:"raster",source:"raster-tiles"},{id:"Road labels",type:"background",layout:{visibility:"none"}}],glyphs:"https://api.maptiler.com/fonts/{fontstack}/{range}.pbf?key=MZEJTanw3WpxRvt7qDfo"}}function lk(r,i,n){let a;Gt(r,el,N=>n(13,a=N));let{show:u}=i,d=JSON.parse(window.localStorage.getItem(Md)||"[]");for(let N of d)dn(el,a[N.name]=B_(N.tileURL,N.attribution),a);el.set(a);let f="",o="",_="";function S(){d.push({name:f,tileURL:o,attribution:_}),n(1,d),window.localStorage.setItem(Md,JSON.stringify(d)),dn(el,a[f]=B_(o,_),a),el.set(a),n(2,f=""),n(3,o=""),n(4,_="")}function T(N){n(1,d=d.filter(F=>F.name!=N)),window.localStorage.setItem(Md,JSON.stringify(d)),delete a[N],el.set(a)}const y=N=>T(N.name);function k(){f=this.value,n(2,f)}function I(){o=this.value,n(3,o)}function C(){_=this.value,n(4,_)}const L=()=>n(0,u=!1);function B(N){u=N,n(0,u)}return r.$$set=N=>{"show"in N&&n(0,u=N.show)},[u,d,f,o,_,S,T,y,k,I,C,L,B]}class ck extends ui{constructor(i){super(),ci(this,i,lk,ak,ti,{show:0})}}function N_(r,i,n){const a=r.slice();return a[11]=i[n],a}function j_(r,i,n){const a=r.slice();return a[11]=i[n],a}function U_(r){let i,n,a=r[11]+"",u,d,f;function o(){return r[7](r[11])}return{c(){i=ke("li"),n=ke("button"),u=Tt(a),_e(n,"class","dropdown-item"),_e(n,"type","button"),Dr(n,"active",r[0]===r[11])},m(_,S){xe(_,i,S),be(i,n),be(n,u),d||(f=Wt(n,"click",o),d=!0)},p(_,S){r=_,S&2&&a!==(a=r[11]+"")&&Ai(u,a),S&3&&Dr(n,"active",r[0]===r[11])},d(_){_&&we(i),d=!1,f()}}}function V_(r){let i,n,a,u=Vi(r[4]),d=[];for(let f=0;f<u.length;f+=1)d[f]=q_(N_(r,u,f));return{c(){i=ke("li"),i.innerHTML='<hr class="dropdown-divider"/>',n=Qe();for(let f=0;f<d.length;f+=1)d[f].c();a=Mn()},m(f,o){xe(f,i,o),xe(f,n,o);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(f,o);xe(f,a,o)},p(f,o){if(o&17){u=Vi(f[4]);let _;for(_=0;_<u.length;_+=1){const S=N_(f,u,_);d[_]?d[_].p(S,o):(d[_]=q_(S),d[_].c(),d[_].m(a.parentNode,a))}for(;_<d.length;_+=1)d[_].d(1);d.length=u.length}},d(f){f&&(we(i),we(n),we(a)),tr(d,f)}}}function q_(r){let i,n,a=r[11]+"",u,d,f,o;function _(){return r[8](r[11])}return{c(){i=ke("li"),n=ke("button"),u=Tt(a),d=Qe(),_e(n,"class","dropdown-item"),_e(n,"type","button"),Dr(n,"active",r[0]===r[11])},m(S,T){xe(S,i,T),be(i,n),be(n,u),be(i,d),f||(o=Wt(n,"click",_),f=!0)},p(S,T){r=S,T&16&&a!==(a=r[11]+"")&&Ai(u,a),T&17&&Dr(n,"active",r[0]===r[11])},d(S){S&&we(i),f=!1,o()}}}function uk(r){let i,n,a,u,d,f,o,_,S,T,y,k,I,C,L,B,N,F,W=Vi(r[1]),ee=[];for(let j=0;j<W.length;j+=1)ee[j]=U_(j_(r,W,j));let oe=r[4].length>0&&V_(r);function $(j){r[10](j)}let re={};return r[2]!==void 0&&(re.show=r[2]),C=new ck({props:re}),wi.push(()=>Xi(C,"show",$)),{c(){i=ke("div"),n=ke("div"),a=ke("button"),u=Tt(r[3]),d=Qe(),f=ke("ul");for(let j=0;j<ee.length;j+=1)ee[j].c();o=Qe(),oe&&oe.c(),_=Qe(),S=ke("li"),S.innerHTML='<hr class="dropdown-divider"/>',T=Qe(),y=ke("li"),k=ke("button"),k.innerHTML=`<i class="fa-solid fa-square-plus me-2"></i>
          Add custom basemap`,I=Qe(),yt(C.$$.fragment),_e(a,"class","btn btn-outline-secondary dropdown-toggle basemap-button svelte-1tcv6sd"),_e(a,"type","button"),_e(a,"data-bs-toggle","dropdown"),_e(a,"aria-expanded","false"),_e(k,"class","dropdown-item"),_e(k,"type","button"),_e(f,"class","dropdown-menu"),_e(n,"class","btn-group"),_e(i,"class","basemap-selector svelte-1tcv6sd")},m(j,U){xe(j,i,U),be(i,n),be(n,a),be(a,u),be(n,d),be(n,f);for(let J=0;J<ee.length;J+=1)ee[J]&&ee[J].m(f,null);be(f,o),oe&&oe.m(f,null),be(f,_),be(f,S),be(f,T),be(f,y),be(y,k),xe(j,I,U),gt(C,j,U),B=!0,N||(F=Wt(k,"click",r[9]),N=!0)},p(j,[U]){if((!B||U&8)&&Ai(u,j[3]),U&3){W=Vi(j[1]);let R;for(R=0;R<W.length;R+=1){const Z=j_(j,W,R);ee[R]?ee[R].p(Z,U):(ee[R]=U_(Z),ee[R].c(),ee[R].m(f,o))}for(;R<ee.length;R+=1)ee[R].d(1);ee.length=W.length}j[4].length>0?oe?oe.p(j,U):(oe=V_(j),oe.c(),oe.m(f,_)):oe&&(oe.d(1),oe=null);const J={};!L&&U&4&&(L=!0,J.show=j[2],Hi(()=>L=!1)),C.$set(J)},i(j){B||(Re(C.$$.fragment,j),B=!0)},o(j){Ve(C.$$.fragment,j),B=!1},d(j){j&&(we(i),we(I)),tr(ee,j),oe&&oe.d(),_t(C,j),N=!1,F()}}}function hk(r,i,n){let a,u,d,f,o;Gt(r,el,C=>n(6,o=C));let{basemap:_}=i,S=!1;const T=C=>n(0,_=C),y=C=>n(0,_=C),k=()=>n(2,S=!0);function I(C){S=C,n(2,S)}return r.$$set=C=>{"basemap"in C&&n(0,_=C.basemap)},r.$$.update=()=>{r.$$.dirty&64&&n(5,u=Object.keys(o)),r.$$.dirty&34&&n(4,d=u.filter(C=>!a.includes(C))),r.$$.dirty&33&&n(3,f=_||u[0]||"")},n(1,a=Object.keys(cb)),[_,a,S,f,d,u,o,T,y,k,I]}class fk extends ui{constructor(i){super(),ci(this,i,hk,uk,ti,{basemap:0})}}function dk(r){if(!r)return null;const i=r.getCenter();return{lat:i.lat,lng:i.lng,zoom:r.getZoom()}}function pk(r,i,n){const a=new URLSearchParams;return a.append("map",`${Math.round(r)}/${i.toFixed(6)}/${n.toFixed(6)}`),`https://www.openstreetmap.org/#${a.toString()}`}function mk(r,i,n){const a=new URLSearchParams;return a.append("map",`${Math.round(r)}/${i.toFixed(6)}/${n.toFixed(6)}`),`https://www.openstreetmap.org/edit?editor=id#${a.toString()}`}function gk(r,i,n){const a=new URLSearchParams;return a.append("map",`${Math.round(r)}/${i.toFixed(6)}/${n.toFixed(6)}`),a.append("disable_features","boundaries"),a.append("hashtags","Speedwalk"),`https://kyle.kiwi/iD/#${a.toString()}`}function _k(r,i,n){const a=new URLSearchParams;return a.append("map",`${Math.round(r)}/${i.toFixed(6)}/${n.toFixed(6)}`),a.append("disable_features","boundaries"),a.append("hashtags","Speedwalk"),`https://rapideditor.org/edit#${a.toString()}`}function yk(r,i,n,a){return`http://127.0.0.1:8111/load_and_zoom?left=${r.toFixed(6)}&right=${i.toFixed(6)}&top=${n.toFixed(6)}&bottom=${a.toFixed(6)}`}function bk(r){const i=r.getBounds();return yk(i.getWest(),i.getEast(),i.getNorth(),i.getSouth())}function vk(r,i,n){const a=new URL("https://www.mapillary.com/app/");return a.searchParams.set("lat",String(i)),a.searchParams.set("lng",String(n)),a.searchParams.set("z",String(Math.round(r))),a.toString()}function Z_(r,i,n){const a=r.slice();return a[4]=i[n],a}function W_(r){let i,n,a,u,d;function f(){return r[2](r[4])}return{c(){i=ke("li"),n=ke("a"),n.textContent=`${r[4]}`,a=Qe(),_e(n,"class","dropdown-item"),_e(n,"href","#")},m(o,_){xe(o,i,_),be(i,n),be(i,a),u||(d=Wt(n,"click",Yd(f)),u=!0)},p(o,_){r=o},d(o){o&&we(i),u=!1,d()}}}function wk(r){let i,n,a,u,d=Vi(r[0]),f=[];for(let o=0;o<d.length;o+=1)f[o]=W_(Z_(r,d,o));return{c(){i=ke("div"),n=ke("button"),n.innerHTML='<i class="fa-solid fa-pen"></i>',a=Qe(),u=ke("ul");for(let o=0;o<f.length;o+=1)f[o].c();_e(n,"class","btn btn-outline-secondary dropdown-toggle"),_e(n,"type","button"),_e(n,"data-bs-toggle","dropdown"),_e(n,"aria-expanded","false"),_e(n,"title","Open in OSM editors"),_e(u,"class","dropdown-menu"),_e(i,"class","btn-group")},m(o,_){xe(o,i,_),be(i,n),be(i,a),be(i,u);for(let S=0;S<f.length;S+=1)f[S]&&f[S].m(u,null)},p(o,[_]){if(_&3){d=Vi(o[0]);let S;for(S=0;S<d.length;S+=1){const T=Z_(o,d,S);f[S]?f[S].p(T,_):(f[S]=W_(T),f[S].c(),f[S].m(u,null))}for(;S<f.length;S+=1)f[S].d(1);f.length=d.length}},i:Ht,o:Ht,d(o){o&&we(i),tr(f,o)}}}function xk(r,i,n){let a;Gt(r,ol,o=>n(3,a=o));const u=["OSM","iD","Kiwid","Rapid","JOSM","Mapillary"];function d(o){const _=dk(a);if(!(!a||!_))return{OSM:pk(_.zoom,_.lat,_.lng),iD:mk(_.zoom,_.lat,_.lng),Kiwid:gk(_.zoom,_.lat,_.lng),Rapid:_k(_.zoom,_.lat,_.lng),JOSM:bk(a),Mapillary:vk(_.zoom,_.lat,_.lng)}[o]}return[u,d,o=>window.open(d(o),"_blank","noopener,noreferrer")]}class Sk extends ui{constructor(i){super(),ci(this,i,xk,wk,ti,{})}}function Tk(r){let i,n,a,u,d;const f=r[6].default,o=vn(f,r,r[5],null);return{c(){i=ke("dialog"),n=ke("div"),o&&o.c(),_e(n,"class","svelte-y9d9eu"),_e(i,"closedby","none"),_e(i,"class","svelte-y9d9eu")},m(_,S){xe(_,i,S),be(i,n),o&&o.m(n,null),r[7](i),a=!0,u||(d=[Wt(i,"click",r[1]),Wt(i,"keydown",r[2])],u=!0)},p(_,[S]){o&&o.p&&(!a||S&32)&&xn(o,f,_,_[5],a?wn(f,_[5],S,null):Sn(_[5]),null)},i(_){a||(Re(o,_),a=!0)},o(_){Ve(o,_),a=!1},d(_){_&&we(i),o&&o.d(_),r[7](null),u=!1,ir(d)}}}function kk(r,i,n){let{$$slots:a={},$$scope:u}=i,{show:d}=i,{closeable:f=!0}=i,o;function _(y){y.target==o&&(y.stopPropagation(),f&&n(3,d=!1))}function S(y){(y.key=="Escape"||y.key=="Enter")&&(y.stopPropagation(),f&&n(3,d=!1))}function T(y){wi[y?"unshift":"push"](()=>{o=y,n(0,o)})}return r.$$set=y=>{"show"in y&&n(3,d=y.show),"closeable"in y&&n(4,f=y.closeable),"$$scope"in y&&n(5,u=y.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&o&&(d?o.showModal():o.close())},[o,_,S,d,f,u,a,T]}class G_ extends ui{constructor(i){super(),ci(this,i,kk,Tk,ti,{show:3,closeable:4})}}function H_(r){let i;return{c(){i=Tt("You may be contacted later when this problem has been fixed.")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function Ck(r){let i,n,a,u,d,f,o,_,S=r[5]&&r[8]&&H_();return{c(){i=ke("h2"),i.textContent="Report a problem",n=Qe(),a=ke("p"),u=Tt(`Done, thank you for submitting.
    `),S&&S.c(),d=Qe(),f=ke("button"),f.textContent="OK",_e(f,"class","btn btn-primary")},m(T,y){xe(T,i,y),xe(T,n,y),xe(T,a,y),be(a,u),S&&S.m(a,null),xe(T,d,y),xe(T,f,y),o||(_=Wt(f,"click",r[12]),o=!0)},p(T,y){T[5]&&T[8]?S||(S=H_(),S.c(),S.m(a,null)):S&&(S.d(1),S=null)},d(T){T&&(we(i),we(n),we(a),we(d),we(f)),S&&S.d(),o=!1,_()}}}function Ek(r){let i;return{c(){i=Tt("Include screenshot")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function X_(r){let i,n,a;function u(f){r[16](f)}let d={$$slots:{default:[Ik]},$$scope:{ctx:r}};return r[5]!==void 0&&(d.checked=r[5]),i=new us({props:d}),wi.push(()=>Xi(i,"checked",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,o){const _={};o&4194560&&(_.$$scope={dirty:o,ctx:f}),!n&&o&32&&(n=!0,_.checked=f[5],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function Ik(r){let i,n=r[8].name+"",a,u;return{c(){i=Tt("Include your OSM username ("),a=Tt(n),u=Tt(`) in the report and be
      contacted when the problem is fixed`)},m(d,f){xe(d,i,f),xe(d,a,f),xe(d,u,f)},p(d,f){f&256&&n!==(n=d[8].name+"")&&Ai(a,n)},d(d){d&&(we(i),we(a),we(u))}}}function K_(r){let i;function n(d,f){return d[1]?Mk:Ak}let a=n(r),u=a(r);return{c(){i=ke("div"),u.c(),_e(i,"class","img-container mb-3 svelte-3bvulg")},m(d,f){xe(d,i,f),u.m(i,null)},p(d,f){a===(a=n(d))&&u?u.p(d,f):(u.d(1),u=a(d),u&&(u.c(),u.m(i,null)))},d(d){d&&we(i),u.d()}}}function Ak(r){let i;return{c(){i=ke("p"),i.textContent="Loading screenshot... (sometimes you have to cancel and try again)"},m(n,a){xe(n,i,a)},p:Ht,d(n){n&&we(i)}}}function Mk(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[1])||_e(i,"src",n),_e(i,"alt","Screenshot"),_e(i,"class","svelte-3bvulg")},m(a,u){xe(a,i,u)},p(a,u){u&2&&!Wn(i.src,n=a[1])&&_e(i,"src",n)},d(a){a&&we(i)}}}function Pk(r){let i,n,a,u,d;return{c(){i=ke("button"),n=Tt("Submit report"),_e(i,"class","btn btn-primary me-3"),i.disabled=a=!r[7]},m(f,o){xe(f,i,o),be(i,n),u||(d=Wt(i,"click",r[9]),u=!0)},p(f,o){o&128&&a!==(a=!f[7])&&(i.disabled=a)},d(f){f&&we(i),u=!1,d()}}}function Lk(r){let i;return{c(){i=ke("button"),i.innerHTML=`<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
        Submit report`,_e(i,"class","btn btn-primary me-3"),i.disabled=!0},m(n,a){xe(n,i,a)},p:Ht,d(n){n&&we(i)}}}function zk(r){let i,n,a,u,d,f,o,_,S,T,y,k,I,C,L,B,N,F,W,ee,oe,$,re;function j(ge){r[15](ge)}let U={$$slots:{default:[Ek]},$$scope:{ctx:r}};r[6]!==void 0&&(U.checked=r[6]),I=new us({props:U}),wi.push(()=>Xi(I,"checked",j));let J=r[8]&&X_(r),R=r[6]&&K_(r);function Z(ge,ye){return ge[3]?Lk:Pk}let ce=Z(r),fe=ce(r);return{c(){i=ke("div"),n=ke("h2"),n.textContent="Report a problem",a=Qe(),u=ke("button"),d=Qe(),f=ke("p"),f.textContent="You can report a problem with Speedwalk.",o=Qe(),_=ke("fieldset"),S=ke("legend"),S.innerHTML=`Please describe the problem
      <br/>
      (if it&#39;s not obvious from the screenshot below)`,T=Qe(),y=ke("textarea"),k=Qe(),yt(I.$$.fragment),L=Qe(),J&&J.c(),B=Qe(),R&&R.c(),N=Qe(),F=ke("div"),fe.c(),W=Qe(),ee=ke("button"),ee.textContent="Cancel",_e(u,"class","btn-close"),_e(u,"aria-label","Close"),_e(i,"class","d-flex justify-content-between"),_e(y,"class","form-control"),_e(y,"rows","4"),_e(y,"placeholder","Details"),_e(_,"class","mb-3"),_e(ee,"class","btn btn-secondary"),_e(F,"class","d-flex")},m(ge,ye){xe(ge,i,ye),be(i,n),be(i,a),be(i,u),xe(ge,d,ye),xe(ge,f,ye),xe(ge,o,ye),xe(ge,_,ye),be(_,S),be(_,T),be(_,y),Ts(y,r[0]),xe(ge,k,ye),gt(I,ge,ye),xe(ge,L,ye),J&&J.m(ge,ye),xe(ge,B,ye),R&&R.m(ge,ye),xe(ge,N,ye),xe(ge,F,ye),fe.m(F,null),be(F,W),be(F,ee),oe=!0,$||(re=[Wt(u,"click",r[10]),Wt(y,"input",r[14]),Wt(ee,"click",r[10])],$=!0)},p(ge,ye){ye&1&&Ts(y,ge[0]);const he={};ye&4194304&&(he.$$scope={dirty:ye,ctx:ge}),!C&&ye&64&&(C=!0,he.checked=ge[6],Hi(()=>C=!1)),I.$set(he),ge[8]?J?(J.p(ge,ye),ye&256&&Re(J,1)):(J=X_(ge),J.c(),Re(J,1),J.m(B.parentNode,B)):J&&(ln(),Ve(J,1,1,()=>{J=null}),cn()),ge[6]?R?R.p(ge,ye):(R=K_(ge),R.c(),R.m(N.parentNode,N)):R&&(R.d(1),R=null),ce===(ce=Z(ge))&&fe?fe.p(ge,ye):(fe.d(1),fe=ce(ge),fe&&(fe.c(),fe.m(F,W)))},i(ge){oe||(Re(I.$$.fragment,ge),Re(J),oe=!0)},o(ge){Ve(I.$$.fragment,ge),Ve(J),oe=!1},d(ge){ge&&(we(i),we(d),we(f),we(o),we(_),we(k),we(L),we(B),we(N),we(F)),_t(I,ge),J&&J.d(ge),R&&R.d(ge),fe.d(),$=!1,ir(re)}}}function Ok(r){let i,n,a,u,d,f;function o(y){r[13](y)}let _={$$slots:{default:[Ck]},$$scope:{ctx:r}};r[4]!==void 0&&(_.show=r[4]),i=new G_({props:_}),wi.push(()=>Xi(i,"show",o));function S(y){r[17](y)}let T={closeable:!1,$$slots:{default:[zk]},$$scope:{ctx:r}};return r[2]!==void 0&&(T.show=r[2]),u=new G_({props:T}),wi.push(()=>Xi(u,"show",S)),{c(){yt(i.$$.fragment),a=Qe(),yt(u.$$.fragment)},m(y,k){gt(i,y,k),xe(y,a,k),gt(u,y,k),f=!0},p(y,[k]){const I={};k&4194608&&(I.$$scope={dirty:k,ctx:y}),!n&&k&16&&(n=!0,I.show=y[4],Hi(()=>n=!1)),i.$set(I);const C={};k&4194795&&(C.$$scope={dirty:k,ctx:y}),!d&&k&4&&(d=!0,C.show=y[2],Hi(()=>d=!1)),u.$set(C)},i(y){f||(Re(i.$$.fragment,y),Re(u.$$.fragment,y),f=!0)},o(y){Ve(i.$$.fragment,y),Ve(u.$$.fragment,y),f=!1},d(y){y&&we(a),_t(i,y),_t(u,y)}}}function Dk(r){return new Promise((i,n)=>{r.redraw(),r.once("idle",()=>{r.getCanvas().toBlob(a=>{a?i(a):n("no blob")})})})}function Fk(r){return new Promise((i,n)=>{let a=new FileReader;a.readAsDataURL(r),a.onloadend=function(){a.result?i(a.result):n("base64 failed")}})}function Rk(r){let i=r.getCenter(),n=Math.round(r.getZoom()*100)/100,a=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,a),d=Math.round(i.lat*u)/u,f=Math.round(i.lng*u)/u,o=`${n}/${d}/${f}`,_=r.getBearing(),S=r.getPitch();return(_||S)&&(o+=`/${Math.round(_*10)/10}`),S&&(o+=`/${Math.round(S)}`),`#${o}`}function Bk(r,i,n){let a,u,d;Gt(r,rh,U=>n(8,u=U)),Gt(r,ol,U=>n(20,d=U));let f=!1,o=!1,_=!1;function S(){d&&B()}let T="",y={},k=!1,I=!0,C,L;async function B(){n(2,f=!0),y={url:window.location.toString(),viewport:Rk(d)},C=await Dk(d),n(1,L=URL.createObjectURL(C))}async function N(){let U=null;k&&u&&(U=u.name);let J=null;I&&C&&(J=await Fk(C));let R={...y,details:T,screenshot:J,username:U};try{n(3,o=!0);let Z=await fetch("https://walknet.abstreet.uk/problems/speedwalk_problems",{method:"POST",body:JSON.stringify(R),headers:{"Content-Type":"application/json"}});if(!Z.ok)throw new Error(`Bad response: ${Z.status}`)}catch(Z){window.alert(`Failed to report a problem: ${Z}`),n(3,o=!1);return}n(3,o=!1),F(),n(4,_=!0)}function F(){n(2,f=!1),n(0,T=""),y={},C=void 0,L&&(URL.revokeObjectURL(L),n(1,L=void 0))}const W=()=>n(4,_=!1);function ee(U){_=U,n(4,_)}function oe(){T=this.value,n(0,T)}function $(U){I=U,n(6,I)}function re(U){k=U,n(5,k)}function j(U){f=U,n(2,f)}return r.$$.update=()=>{r.$$.dirty&3&&n(7,a=T||L)},[T,L,f,o,_,k,I,a,u,N,F,S,W,ee,oe,$,re,j]}class Nk extends ui{constructor(i){super(),ci(this,i,Bk,Ok,ti,{triggerStart:11})}get triggerStart(){return this.$$.ctx[11]}}function J_(r){let i,n,a,u;return{c(){i=ke("div"),n=ke("button"),n.innerHTML='<i class="fa-solid fa-triangle-exclamation"></i> <span class="report-problem-text svelte-17rnyo3">Report problem</span>',_e(n,"class","btn btn-secondary report-problem-btn svelte-17rnyo3"),_e(i,"class","report-problem-wrapper svelte-17rnyo3")},m(d,f){xe(d,i,f),be(i,n),a||(u=Wt(n,"click",r[2]),a=!0)},p:Ht,d(d){d&&we(i),a=!1,u()}}}function jk(r){let i,n,a,u=r[1]&&J_(r),d={};return n=new Nk({props:d}),r[3](n),{c(){u&&u.c(),i=Qe(),yt(n.$$.fragment)},m(f,o){u&&u.m(f,o),xe(f,i,o),gt(n,f,o),a=!0},p(f,[o]){f[1]?u?u.p(f,o):(u=J_(f),u.c(),u.m(i.parentNode,i)):u&&(u.d(1),u=null);const _={};n.$set(_)},i(f){a||(Re(n.$$.fragment,f),a=!0)},o(f){Ve(n.$$.fragment,f),a=!1},d(f){f&&we(i),u&&u.d(f),r[3](null),_t(n,f)}}}function Uk(r,i,n){let a;Gt(r,ol,o=>n(1,a=o));let u=null;const d=()=>{u==null||u.triggerStart()};function f(o){wi[o?"unshift":"push"](()=>{u=o,n(0,u)})}return[u,a,d,f]}class Vk extends ui{constructor(i){super(),ci(this,i,Uk,jk,ti,{})}}function qk(r){let i,n,a,u,d,f,o,_;function S(y){r[2](y)}let T={};return r[0]!==void 0&&(T.basemap=r[0]),n=new fk({props:T}),wi.push(()=>Xi(n,"basemap",S)),d=new Sk({}),o=new Vk({}),{c(){i=ke("div"),yt(n.$$.fragment),u=Qe(),yt(d.$$.fragment),f=Qe(),yt(o.$$.fragment),_e(i,"class","action-bar svelte-nu94fm"),en(i,"bottom",r[1])},m(y,k){xe(y,i,k),gt(n,i,null),be(i,u),gt(d,i,null),be(i,f),gt(o,i,null),_=!0},p(y,[k]){const I={};!a&&k&1&&(a=!0,I.basemap=y[0],Hi(()=>a=!1)),n.$set(I),k&2&&en(i,"bottom",y[1])},i(y){_||(Re(n.$$.fragment,y),Re(d.$$.fragment,y),Re(o.$$.fragment,y),_=!0)},o(y){Ve(n.$$.fragment,y),Ve(d.$$.fragment,y),Ve(o.$$.fragment,y),_=!1},d(y){y&&we(i),_t(n),_t(d),_t(o)}}}function Zk(r,i,n){let{basemap:a}=i,{bottom:u="60px"}=i;function d(f){a=f,n(0,a)}return r.$$set=f=>{"basemap"in f&&n(0,a=f.basemap),"bottom"in f&&n(1,u=f.bottom)},[a,u,d]}class Wk extends ui{constructor(i){super(),ci(this,i,Zk,qk,ti,{basemap:0,bottom:1})}}let mh={RoadWithSeparate:"purple",RoadWithTags:"blue",RoadWithoutSidewalksExplicit:"#8B4000",RoadWithoutSidewalksImplicit:"orange",RoadUnknown:"#ff69b4",Sidewalk:"black",Crossing:"green",Other:"grey"},Y_={RoadWithSeparate:"With separate sidewalks",RoadWithTags:"With tagged sidewalks",RoadWithoutSidewalksExplicit:"Tagged as no sidewalks",RoadWithoutSidewalksImplicit:"Assumed as no sidewalks",RoadUnknown:"Totally unknown",Sidewalk:"Separate sidewalk",Crossing:"Crossing",Other:"Other"};function tl(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,pf(["get","kind"],{Sidewalk:4+r,Crossing:5+r,Other:5+r},7+r),20,pf(["get","kind"],{Sidewalk:7+r,Crossing:10+r,Other:10+r},24+r)]}function Gk(r){let i,n,a,u;return i=new il({props:{id:"pinned",beforeId:"Road labels",paint:{"line-width":tl(10),"line-color":"cyan","line-opacity":.5}}}),a=new bp({props:{minzoom:12,layout:{"icon-image":"arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0}}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(a,d,f),u=!0},p:Ht,i(d){u||(Re(i.$$.fragment,d),Re(a.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(a.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(a,d)}}}function Hk(r){let i,n;return i=new il({props:{id:"snapped-to-pinned",beforeId:"Road labels",paint:{"line-width":tl(10),"line-color":"blue","line-opacity":.5,"line-offset":["case",["get","left"],-5,5]}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p:Ht,i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function Xk(r){let i,n;return i=new il({props:{id:"ways",beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",filter:r[4],paint:{"line-width":tl(0),"line-color":pf(["get","kind"],mh,"cyan")}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u&16&&(d.filter=a[4]),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function Kk(r){let i,n;return i=new bp({props:{id:"pinned-sides",paint:{"text-color":"black","text-halo-color":"cyan","text-halo-width":4},layout:{"text-field":["get","side"],"text-size":16,"symbol-placement":"line"}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p:Ht,i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function Jk(r){let i,n;return i=new bp({props:{id:"pinned-node-order",paint:{"text-color":"white","text-halo-color":"blue","text-halo-width":5},layout:{"text-field":["get","idx"],"text-size":16,visibility:r[6]?"visible":"none"}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u&64&&(d.layout={"text-field":["get","idx"],"text-size":16,visibility:a[6]?"visible":"none"}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function Yk(r){let i,n,a,u;return i=new $c({props:{filter:ab,paint:{"circle-radius":20,"circle-color":["get","color"],"circle-opacity":.5},layout:{visibility:r[2]?"visible":"none"}}}),a=new il({props:{filter:Hd,paint:{"line-width":tl(5),"line-color":["get","color"],"line-opacity":.5},layout:{visibility:r[2]?"visible":"none"}}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(a,d,f),u=!0},p(d,f){const o={};f&4&&(o.layout={visibility:d[2]?"visible":"none"}),i.$set(o);const _={};f&4&&(_.layout={visibility:d[2]?"visible":"none"}),a.$set(_)},i(d){u||(Re(i.$$.fragment,d),Re(a.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(a.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(a,d)}}}function Qk(r){let i,n,a,u,d,f,o,_,S,T,y,k,I,C;return i=new nb({}),i.$on("click",r[7]),a=new cs({props:{data:r[0]||Zs(),$$slots:{default:[Gk]},$$scope:{ctx:r}}}),d=new cs({props:{data:r[9](r[0],r[6]),$$slots:{default:[Hk]},$$scope:{ctx:r}}}),o=new cs({props:{data:r[3],$$slots:{default:[Xk]},$$scope:{ctx:r}}}),S=new cs({props:{data:r[5],$$slots:{default:[Kk]},$$scope:{ctx:r}}}),y=new cs({props:{data:r[8](r[0]),$$slots:{default:[Jk]},$$scope:{ctx:r}}}),I=new cs({props:{data:r[1],$$slots:{default:[Yk]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment),u=Qe(),yt(d.$$.fragment),f=Qe(),yt(o.$$.fragment),_=Qe(),yt(S.$$.fragment),T=Qe(),yt(y.$$.fragment),k=Qe(),yt(I.$$.fragment)},m(L,B){gt(i,L,B),xe(L,n,B),gt(a,L,B),xe(L,u,B),gt(d,L,B),xe(L,f,B),gt(o,L,B),xe(L,_,B),gt(S,L,B),xe(L,T,B),gt(y,L,B),xe(L,k,B),gt(I,L,B),C=!0},p(L,[B]){const N={};B&1&&(N.data=L[0]||Zs()),B&16384&&(N.$$scope={dirty:B,ctx:L}),a.$set(N);const F={};B&65&&(F.data=L[9](L[0],L[6])),B&16384&&(F.$$scope={dirty:B,ctx:L}),d.$set(F);const W={};B&8&&(W.data=L[3]),B&16400&&(W.$$scope={dirty:B,ctx:L}),o.$set(W);const ee={};B&32&&(ee.data=L[5]),B&16384&&(ee.$$scope={dirty:B,ctx:L}),S.$set(ee);const oe={};B&1&&(oe.data=L[8](L[0])),B&16448&&(oe.$$scope={dirty:B,ctx:L}),y.$set(oe);const $={};B&2&&($.data=L[1]),B&16388&&($.$$scope={dirty:B,ctx:L}),I.$set($)},i(L){C||(Re(i.$$.fragment,L),Re(a.$$.fragment,L),Re(d.$$.fragment,L),Re(o.$$.fragment,L),Re(S.$$.fragment,L),Re(y.$$.fragment,L),Re(I.$$.fragment,L),C=!0)},o(L){Ve(i.$$.fragment,L),Ve(a.$$.fragment,L),Ve(d.$$.fragment,L),Ve(o.$$.fragment,L),Ve(S.$$.fragment,L),Ve(y.$$.fragment,L),Ve(I.$$.fragment,L),C=!1},d(L){L&&(we(n),we(u),we(f),we(_),we(T),we(k)),_t(i,L),_t(a,L),_t(d,L),_t(o,L),_t(S,L),_t(y,L),_t(I,L)}}}function $k(r,i,n){let a,u,d,f;Gt(r,hr,N=>n(11,u=N)),Gt(r,ol,N=>n(12,d=N)),Gt(r,mf,N=>n(6,f=N));let{pinnedWay:o}=i,{drawProblemDetails:_}=i,{showProblemDetails:S}=i,{nodes:T}=i,{ways:y}=i,{filterWays:k}=i;function I(N){n(0,o=null);for(let F of d.queryRenderedFeatures(N.detail.point,{layers:["ways"]})){n(0,o=y.features.find(W=>W.id==F.id));break}}function C(N){let F=Zs();if(N)for(let W of N.properties.problems)F.features=[...F.features,...W.details];return F}function L(N){let F=Zs();if(N)for(let[W,ee]of N.properties.node_ids.entries()){let oe=T.features.find($=>$.properties.id==ee);F.features.push({type:"Feature",geometry:oe.geometry,properties:{idx:W}})}return F}function B(N,F){if(!N||!F)return Zs();let W=parseInt(N.properties.tags["tmp:closest_way"]);if(!W)return Zs();for(let ee of y.features)if(ee.properties.id==W){let oe=JSON.parse(JSON.stringify(ee));return oe.properties.left=N.properties.tags["tmp:side"]=="Left",{type:"FeatureCollection",features:[oe]}}return Zs()}return r.$$set=N=>{"pinnedWay"in N&&n(0,o=N.pinnedWay),"drawProblemDetails"in N&&n(1,_=N.drawProblemDetails),"showProblemDetails"in N&&n(2,S=N.showProblemDetails),"nodes"in N&&n(10,T=N.nodes),"ways"in N&&n(3,y=N.ways),"filterWays"in N&&n(4,k=N.filterWays)},r.$$.update=()=>{r.$$.dirty&2049&&n(5,a=u&&o?JSON.parse(u.getSideLocations(BigInt(o.properties.id))):Zs()),r.$$.dirty&1&&n(1,_=C(o))},[o,_,S,y,k,a,f,I,L,B,T,u]}class eC extends ui{constructor(i){super(),ci(this,i,$k,Qk,ti,{pinnedWay:0,drawProblemDetails:1,showProblemDetails:2,nodes:10,ways:3,filterWays:4})}}const xr=[];for(let r=0;r<256;++r)xr.push((r+256).toString(16).slice(1));function tC(r,i=0){return(xr[r[i+0]]+xr[r[i+1]]+xr[r[i+2]]+xr[r[i+3]]+"-"+xr[r[i+4]]+xr[r[i+5]]+"-"+xr[r[i+6]]+xr[r[i+7]]+"-"+xr[r[i+8]]+xr[r[i+9]]+"-"+xr[r[i+10]]+xr[r[i+11]]+xr[r[i+12]]+xr[r[i+13]]+xr[r[i+14]]+xr[r[i+15]]).toLowerCase()}let Pd;const iC=new Uint8Array(16);function nC(){if(!Pd){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Pd=crypto.getRandomValues.bind(crypto)}return Pd(iC)}const rC=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Q_={randomUUID:rC};function sC(r,i,n){var u;r=r||{};const a=r.random??((u=r.rng)==null?void 0:u.call(r))??nC();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,tC(a)}function oC(r,i,n){return Q_.randomUUID&&!r?Q_.randomUUID():sC(r)}const aC=r=>({}),$_=r=>({}),lC=r=>({}),ey=r=>({});function cC(r){let i,n,a,u,d,f,o,_;const S=r[2].header,T=vn(S,r,r[1],ey),y=r[2].body,k=vn(y,r,r[1],$_);return{c(){i=ke("div"),n=ke("div"),a=ke("div"),u=ke("button"),T&&T.c(),d=Qe(),f=ke("div"),o=ke("div"),k&&k.c(),_e(u,"class","accordion-button"),_e(u,"type","button"),_e(u,"data-bs-toggle","collapse"),_e(u,"data-bs-target",`#${r[0]}`),_e(u,"aria-expanded","true"),_e(u,"aria-controls",r[0]),_e(a,"class","accordion-header"),_e(o,"class","accordion-body"),_e(f,"id",r[0]),_e(f,"class","accordion-collapse collapse show"),_e(n,"class","accordion-item"),_e(i,"class","accordion mb-3")},m(I,C){xe(I,i,C),be(i,n),be(n,a),be(a,u),T&&T.m(u,null),be(n,d),be(n,f),be(f,o),k&&k.m(o,null),_=!0},p(I,[C]){T&&T.p&&(!_||C&2)&&xn(T,S,I,I[1],_?wn(S,I[1],C,lC):Sn(I[1]),ey),k&&k.p&&(!_||C&2)&&xn(k,y,I,I[1],_?wn(y,I[1],C,aC):Sn(I[1]),$_)},i(I){_||(Re(T,I),Re(k,I),_=!0)},o(I){Ve(T,I),Ve(k,I),_=!1},d(I){I&&we(i),T&&T.d(I),k&&k.d(I)}}}function uC(r,i,n){let{$$slots:a={},$$scope:u}=i,d=oC();return r.$$set=f=>{"$$scope"in f&&n(1,u=f.$$scope)},[d,u,a]}class Sf extends ui{constructor(i){super(),ci(this,i,uC,cC,ti,{})}}function ty(r,i,n){const a=r.slice();return a[13]=i[n][0],a[14]=i[n][1],a}function hC(r){let i;return{c(){i=ke("div"),i.textContent="Problems",_e(i,"slot","header")},m(n,a){xe(n,i,a)},p:Ht,d(n){n&&we(i)}}}function iy(r){let i,n=r[13]+"",a,u,d=r[14]+"",f,o,_,S;return{c(){i=ke("option"),a=Tt(n),u=Tt(" ("),f=Tt(d),o=Tt(`)
        `),i.__value=_=r[13],Ts(i,i.__value),i.disabled=S=r[14]==0},m(T,y){xe(T,i,y),be(i,a),be(i,u),be(i,f),be(i,o)},p(T,y){y&4&&n!==(n=T[13]+"")&&Ai(a,n),y&4&&d!==(d=T[14]+"")&&Ai(f,d),y&4&&_!==(_=T[13])&&(i.__value=_,Ts(i,i.__value)),y&4&&S!==(S=T[14]==0)&&(i.disabled=S)},d(T){T&&we(i)}}}function ny(r){let i,n,a=r[2][r[1]]+"",u,d,f,o=r[0].features.length>0&&ry(r);return{c(){i=ke("div"),n=ke("p"),u=Tt(a),d=Tt(" problems"),f=Qe(),o&&o.c(),_e(n,"class","problem-count svelte-d7yah8"),_e(i,"class","problem-header svelte-d7yah8")},m(_,S){xe(_,i,S),be(i,n),be(n,u),be(n,d),be(i,f),o&&o.m(i,null)},p(_,S){S&6&&a!==(a=_[2][_[1]]+"")&&Ai(u,a),_[0].features.length>0?o?o.p(_,S):(o=ry(_),o.c(),o.m(i,null)):o&&(o.d(1),o=null)},d(_){_&&we(i),o&&o.d()}}}function ry(r){let i,n,a;return{c(){i=ke("button"),i.textContent="Pick next",_e(i,"class","btn btn-sm btn-primary")},m(u,d){xe(u,i,d),n||(a=Wt(i,"click",r[3]),n=!0)},p:Ht,d(u){u&&we(i),n=!1,a()}}}function fC(r){let i;return{c(){i=ke("p"),i.textContent=`These roads have separate sidewalks tagged on one side, but the other
        side is unspecified or not drawn separately. Be consistent on each road
        and use another editor to draw separate sidewalks on both sides.`},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function dC(r){let i;return{c(){i=ke("p"),i.innerHTML=`<i>sidewalk=separate</i>
        is ambiguous. Update the tagging to specify if there are separate sidewalks
        on both sides or just one.`},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function pC(r){let i,n,a,u,d;return{c(){i=ke("p"),i.textContent=`These roads aren't tagged as having separate sidewalks, but it looks
        like there's a parallel separate sidewalk already mapped.`,n=Qe(),a=ke("ol"),a.innerHTML=`<li>Check each segment. If separate sidewalks are already there, update
          the tagging here.</li> <li>If the separate sidewalks don&#39;t cover the entire length of the road,
          ideally go finish drawing the separate sidewalks in another tool, then
          update the tagging on the road.</li>`,u=Qe(),d=ke("p"),d.textContent="There are false positives. Check the full length of the road."},m(f,o){xe(f,i,o),xe(f,n,o),xe(f,a,o),xe(f,u,o),xe(f,d,o)},d(f){f&&(we(i),we(n),we(a),we(u),we(d))}}}function mC(r){let i,n,a;return{c(){i=ke("p"),i.innerHTML=`Here are footways with a crossing node, but the way needs to be split
        and tagged as <i>footway=crossing</i>
        .`,n=Qe(),a=ke("ol"),a.innerHTML=`<li>Open in another editor</li> <li>Split the way around the crossing</li> <li>Tag <i>footway=crossing</i>
          on the smaller segment</li> <li>Refresh the data here to verify</li>`},m(u,d){xe(u,i,d),xe(u,n,d),xe(u,a,d)},d(u){u&&(we(i),we(n),we(a))}}}function gC(r){let i,n,a,u,d;return{c(){i=ke("p"),i.textContent=`Here are places where part of a road has separate sidewalks tagged, but
        then the next part of the road doesn't. It's best to be consistent about
        separate sidewalks along the entire length of a road. To fix:`,n=Qe(),a=ke("ol"),a.innerHTML=`<li>Go map separate sidewalks along the entire road (in another editor)</li> <li>Update the road tagging to indicate those separate sidewalks (here or
          in another editor)</li> <li>Refresh the data here to verify</li>`,u=Qe(),d=ke("p"),d.textContent=`(This problem is detected when the road names are the same, so there are
        some false positives you can ignore.)`},m(f,o){xe(f,i,o),xe(f,n,o),xe(f,a,o),xe(f,u,o),xe(f,d,o)},d(f){f&&(we(i),we(n),we(a),we(u),we(d))}}}function _C(r){let i;return{c(){i=ke("p"),i.textContent=`When a crossing way hits a road, the node should be tagged as a
        crossing. Instructions to fix are TODO.`},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function yC(r){let i,n,a,u,d,f,o,_=Vi(Object.entries(r[2])),S=[];for(let C=0;C<_.length;C+=1)S[C]=iy(ty(r,_,C));let T=r[1]&&ny(r);function y(C,L){if(C[1]=="missing crossing node")return _C;if(C[1]=="separate sidewalks should be continued here")return gC;if(C[1]=="missing footway=crossing")return mC;if(C[1]=="possible separate sidewalk near way without it tagged")return pC;if(C[1]=="sidewalk=separate is ambiguous about the side")return dC;if(C[1]=="sidewalk:left and sidewalk:right should each be tagged as separate or no")return fC}let k=y(r),I=k&&k(r);return{c(){i=ke("div"),n=ke("select"),a=ke("option"),a.textContent="Show a type of problem";for(let C=0;C<S.length;C+=1)S[C].c();u=Qe(),T&&T.c(),d=Qe(),I&&I.c(),a.__value="",Ts(a,a.__value),_e(n,"class","form-select"),r[1]===void 0&&af(()=>r[7].call(n)),_e(i,"slot","body")},m(C,L){xe(C,i,L),be(i,n),be(n,a);for(let B=0;B<S.length;B+=1)S[B]&&S[B].m(n,null);sg(n,r[1],!0),be(i,u),T&&T.m(i,null),be(i,d),I&&I.m(i,null),f||(o=Wt(n,"change",r[7]),f=!0)},p(C,L){if(L&4){_=Vi(Object.entries(C[2]));let B;for(B=0;B<_.length;B+=1){const N=ty(C,_,B);S[B]?S[B].p(N,L):(S[B]=iy(N),S[B].c(),S[B].m(n,null))}for(;B<S.length;B+=1)S[B].d(1);S.length=_.length}L&6&&sg(n,C[1]),C[1]?T?T.p(C,L):(T=ny(C),T.c(),T.m(i,d)):T&&(T.d(1),T=null),k!==(k=y(C))&&(I&&I.d(1),I=k&&k(C),I&&(I.c(),I.m(i,null)))},d(C){C&&we(i),tr(S,C),T&&T.d(),I&&I.d(),f=!1,o()}}}function bC(r){let i,n;return i=new Sf({props:{$$slots:{body:[yC],header:[hC]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,[u]){const d={};u&131079&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function vC(r,i,n){let a,u;Gt(r,ol,B=>n(8,u=B));let{nodes:d}=i,{ways:f}=i,{drawProblems:o}=i,_=["missing crossing node","separate sidewalks should be continued here"],S=["missing footway=crossing","possible separate sidewalk near way without it tagged","sidewalk=separate is ambiguous about the side","sidewalk:left and sidewalk:right should each be tagged as separate or no"],T="",y=0;function k(B,N){let F={};for(let W of[..._,...S])F[W]=0;for(let W of[...d.features,...f.features])for(let ee of W.properties.problems)F[ee.note]+=1;return F}function I(B,N,F){let W={type:"FeatureCollection",features:[]};for(let ee of[...d.features,...f.features])ee.properties.problems.some(oe=>oe.note==T)&&W.features.push(ee);return W}function C(){if(!u||!T||o.features.length===0)return;const B=o.features[y];n(6,y=(y+1)%o.features.length);try{if(B.geometry.type==="Point"){const N=B.geometry.coordinates;u.flyTo({center:[N[0],N[1]],zoom:19,animate:!0})}else{const N=lb(B);u.fitBounds(N,{animate:!0,padding:50})}}catch(N){console.error("Error focusing on problem:",N)}}function L(){T=p1(this),n(1,T),n(2,a),n(4,d),n(5,f)}return r.$$set=B=>{"nodes"in B&&n(4,d=B.nodes),"ways"in B&&n(5,f=B.ways),"drawProblems"in B&&n(0,o=B.drawProblems)},r.$$.update=()=>{r.$$.dirty&48&&n(2,a=k()),r.$$.dirty&50&&n(0,o=I()),r.$$.dirty&2&&T&&n(6,y=0),r.$$.dirty&65&&y>=o.features.length&&o.features.length>0&&n(6,y=0)},[o,T,a,C,d,f,y,L]}class wC extends ui{constructor(i){super(),ci(this,i,vC,bC,ti,{nodes:4,ways:5,drawProblems:0})}}function xC(r){let i,n,a,u,d,f;return i=new $c({props:{filter:ab,paint:{"circle-radius":10,"circle-color":"red","circle-opacity":.5,"circle-stroke-color":"black","circle-stroke-width":1}}}),a=new il({props:{filter:Hd,maxzoom:16,paint:{"line-width":tl(15),"line-color":"red","line-opacity":r[2],"line-blur":5},layout:{visibility:r[1]?"none":"visible"}}}),d=new il({props:{filter:Hd,beforeId:"Road labels",minzoom:16,paint:{"line-width":tl(20),"line-color":"red","line-opacity":r[2],"line-blur":5},layout:{visibility:r[1]?"none":"visible"}}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment),u=Qe(),yt(d.$$.fragment)},m(o,_){gt(i,o,_),xe(o,n,_),gt(a,o,_),xe(o,u,_),gt(d,o,_),f=!0},p(o,_){const S={};_&4&&(S.paint={"line-width":tl(15),"line-color":"red","line-opacity":o[2],"line-blur":5}),_&2&&(S.layout={visibility:o[1]?"none":"visible"}),a.$set(S);const T={};_&4&&(T.paint={"line-width":tl(20),"line-color":"red","line-opacity":o[2],"line-blur":5}),_&2&&(T.layout={visibility:o[1]?"none":"visible"}),d.$set(T)},i(o){f||(Re(i.$$.fragment,o),Re(a.$$.fragment,o),Re(d.$$.fragment,o),f=!0)},o(o){Ve(i.$$.fragment,o),Ve(a.$$.fragment,o),Ve(d.$$.fragment,o),f=!1},d(o){o&&(we(n),we(u)),_t(i,o),_t(a,o),_t(d,o)}}}function SC(r){let i,n;return i=new cs({props:{data:r[0],$$slots:{default:[xC]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,[u]){const d={};u&1&&(d.data=a[0]),u&22&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function TC(r,i,n){let{drawProblems:a}=i,{pinnedWay:u}=i,d=.5;function f(o){let _=2500,S=.35,T=.85,y=(Math.sin(o/_*Math.PI*2)+1)/2;n(2,d=S+y*(T-S)),requestAnimationFrame(f)}return requestAnimationFrame(f),r.$$set=o=>{"drawProblems"in o&&n(0,a=o.drawProblems),"pinnedWay"in o&&n(1,u=o.pinnedWay)},[a,u,d]}class kC extends ui{constructor(i){super(),ci(this,i,TC,SC,ti,{drawProblems:0,pinnedWay:1})}}function CC(r){var k;let i,n,a,u,d=sy((k=r[1])==null?void 0:k.getOsmTimestamp())+"",f,o,_,S,T,y;return i=new eu({props:{loading:r[0]}}),{c(){yt(i.$$.fragment),n=Qe(),a=ke("p"),u=Tt("OSM data is from "),f=Tt(d),o=Qe(),_=ke("button"),_.textContent="Refresh OSM data",_e(_,"class","btn btn-secondary mb-3")},m(I,C){gt(i,I,C),xe(I,n,C),xe(I,a,C),be(a,u),be(a,f),xe(I,o,C),xe(I,_,C),S=!0,T||(y=Wt(_,"click",r[2]),T=!0)},p(I,[C]){var B;const L={};C&1&&(L.loading=I[0]),i.$set(L),(!S||C&2)&&d!==(d=sy((B=I[1])==null?void 0:B.getOsmTimestamp())+"")&&Ai(f,d)},i(I){S||(Re(i.$$.fragment,I),S=!0)},o(I){Ve(i.$$.fragment,I),S=!1},d(I){I&&(we(n),we(a),we(o),we(_)),_t(i,I),T=!1,y()}}}function sy(r){if(r){let i=new Date(1e3*Number(r));return`${i.toLocaleString()} (${EC(i)} ago)`}return"unknown"}function EC(r){let i=Date.now()-r.getTime(),n=Math.floor(i/1e3),a=Math.floor(n/60),u=Math.floor(a/60),d=Math.floor(u/24);return d?d==1?"1 day":`${d} days`:u?u==1?"1 hour":`${u} hours`:a?a==1?"1 minute":`${a} minutes`:"a few seconds"}function IC(r,i,n){let a;Gt(r,hr,o=>n(1,a=o));let{anyEdits:u}=i,d="";async function f(){if(!(u&&!window.confirm("Refreshing OSM data will discard your current edits. Do you want to clear the edits?")))try{n(0,d="Grabbing new OSM data from Overpass");let o=JSON.parse(a.getBoundary()),_=hb(o),S=await fetch(_);if(!S.ok)throw new Error(`Overpass failed: ${S}`);let T=await S.bytes();n(0,d="Processing Overpass data"),await Ro(),dn(hr,a=new ch(new Uint8Array(T),o),a)}catch(o){window.alert(`Couldn't import from Overpass: ${o}`)}finally{n(0,d="")}}return r.$$set=o=>{"anyEdits"in o&&n(3,u=o.anyEdits)},[d,a,f,u]}class AC extends ui{constructor(i){super(),ci(this,i,IC,CC,ti,{anyEdits:3})}}function ef(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var db={exports:{}};(function(r,i){(function(n){r.exports=n()})(function(){return function(){function n(a,u,d){function f(S,T){if(!u[S]){if(!a[S]){var y=typeof ef=="function"&&ef;if(!T&&y)return y(S,!0);if(o)return o(S,!0);var k=new Error("Cannot find module '"+S+"'");throw k.code="MODULE_NOT_FOUND",k}var I=u[S]={exports:{}};a[S][0].call(I.exports,function(C){var L=a[S][1][C];return f(L||C)},I,I.exports,n,a,u,d)}return u[S].exports}for(var o=typeof ef=="function"&&ef,_=0;_<d.length;_++)f(d[_]);return f}return n}()({1:[function(n,a,u){u.byteLength=k,u.toByteArray=C,u.fromByteArray=N;for(var d=[],f=[],o=typeof Uint8Array<"u"?Uint8Array:Array,_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",S=0,T=_.length;S<T;++S)d[S]=_[S],f[_.charCodeAt(S)]=S;f[45]=62,f[95]=63;function y(F){var W=F.length;if(W%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var ee=F.indexOf("=");ee===-1&&(ee=W);var oe=ee===W?0:4-ee%4;return[ee,oe]}function k(F){var W=y(F),ee=W[0],oe=W[1];return(ee+oe)*3/4-oe}function I(F,W,ee){return(W+ee)*3/4-ee}function C(F){var W,ee=y(F),oe=ee[0],$=ee[1],re=new o(I(F,oe,$)),j=0,U=$>0?oe-4:oe,J;for(J=0;J<U;J+=4)W=f[F.charCodeAt(J)]<<18|f[F.charCodeAt(J+1)]<<12|f[F.charCodeAt(J+2)]<<6|f[F.charCodeAt(J+3)],re[j++]=W>>16&255,re[j++]=W>>8&255,re[j++]=W&255;return $===2&&(W=f[F.charCodeAt(J)]<<2|f[F.charCodeAt(J+1)]>>4,re[j++]=W&255),$===1&&(W=f[F.charCodeAt(J)]<<10|f[F.charCodeAt(J+1)]<<4|f[F.charCodeAt(J+2)]>>2,re[j++]=W>>8&255,re[j++]=W&255),re}function L(F){return d[F>>18&63]+d[F>>12&63]+d[F>>6&63]+d[F&63]}function B(F,W,ee){for(var oe,$=[],re=W;re<ee;re+=3)oe=(F[re]<<16&16711680)+(F[re+1]<<8&65280)+(F[re+2]&255),$.push(L(oe));return $.join("")}function N(F){for(var W,ee=F.length,oe=ee%3,$=[],re=16383,j=0,U=ee-oe;j<U;j+=re)$.push(B(F,j,j+re>U?U:j+re));return oe===1?(W=F[ee-1],$.push(d[W>>2]+d[W<<4&63]+"==")):oe===2&&(W=(F[ee-2]<<8)+F[ee-1],$.push(d[W>>10]+d[W>>4&63]+d[W<<2&63]+"=")),$.join("")}},{}],2:[function(n,a,u){(function(d){(function(){var f=n("base64-js"),o=n("ieee754");u.Buffer=y,u.SlowBuffer=oe,u.INSPECT_MAX_BYTES=50;var _=2147483647;u.kMaxLength=_,y.TYPED_ARRAY_SUPPORT=S(),!y.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function S(){try{var ue=new Uint8Array(1);return ue.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},ue.foo()===42}catch{return!1}}Object.defineProperty(y.prototype,"parent",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.buffer}}),Object.defineProperty(y.prototype,"offset",{enumerable:!0,get:function(){if(y.isBuffer(this))return this.byteOffset}});function T(ue){if(ue>_)throw new RangeError('The value "'+ue+'" is invalid for option "size"');var H=new Uint8Array(ue);return H.__proto__=y.prototype,H}function y(ue,H,Y){if(typeof ue=="number"){if(typeof H=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return L(ue)}return k(ue,H,Y)}typeof Symbol<"u"&&Symbol.species!=null&&y[Symbol.species]===y&&Object.defineProperty(y,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),y.poolSize=8192;function k(ue,H,Y){if(typeof ue=="string")return B(ue,H);if(ArrayBuffer.isView(ue))return N(ue);if(ue==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ue);if(pt(ue,ArrayBuffer)||ue&&pt(ue.buffer,ArrayBuffer))return F(ue,H,Y);if(typeof ue=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var Ie=ue.valueOf&&ue.valueOf();if(Ie!=null&&Ie!==ue)return y.from(Ie,H,Y);var qe=W(ue);if(qe)return qe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ue[Symbol.toPrimitive]=="function")return y.from(ue[Symbol.toPrimitive]("string"),H,Y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ue)}y.from=function(ue,H,Y){return k(ue,H,Y)},y.prototype.__proto__=Uint8Array.prototype,y.__proto__=Uint8Array;function I(ue){if(typeof ue!="number")throw new TypeError('"size" argument must be of type number');if(ue<0)throw new RangeError('The value "'+ue+'" is invalid for option "size"')}function C(ue,H,Y){return I(ue),ue<=0?T(ue):H!==void 0?typeof Y=="string"?T(ue).fill(H,Y):T(ue).fill(H):T(ue)}y.alloc=function(ue,H,Y){return C(ue,H,Y)};function L(ue){return I(ue),T(ue<0?0:ee(ue)|0)}y.allocUnsafe=function(ue){return L(ue)},y.allocUnsafeSlow=function(ue){return L(ue)};function B(ue,H){if((typeof H!="string"||H==="")&&(H="utf8"),!y.isEncoding(H))throw new TypeError("Unknown encoding: "+H);var Y=$(ue,H)|0,Ie=T(Y),qe=Ie.write(ue,H);return qe!==Y&&(Ie=Ie.slice(0,qe)),Ie}function N(ue){for(var H=ue.length<0?0:ee(ue.length)|0,Y=T(H),Ie=0;Ie<H;Ie+=1)Y[Ie]=ue[Ie]&255;return Y}function F(ue,H,Y){if(H<0||ue.byteLength<H)throw new RangeError('"offset" is outside of buffer bounds');if(ue.byteLength<H+(Y||0))throw new RangeError('"length" is outside of buffer bounds');var Ie;return H===void 0&&Y===void 0?Ie=new Uint8Array(ue):Y===void 0?Ie=new Uint8Array(ue,H):Ie=new Uint8Array(ue,H,Y),Ie.__proto__=y.prototype,Ie}function W(ue){if(y.isBuffer(ue)){var H=ee(ue.length)|0,Y=T(H);return Y.length===0||ue.copy(Y,0,0,H),Y}if(ue.length!==void 0)return typeof ue.length!="number"||it(ue.length)?T(0):N(ue);if(ue.type==="Buffer"&&Array.isArray(ue.data))return N(ue.data)}function ee(ue){if(ue>=_)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+_.toString(16)+" bytes");return ue|0}function oe(ue){return+ue!=ue&&(ue=0),y.alloc(+ue)}y.isBuffer=function(H){return H!=null&&H._isBuffer===!0&&H!==y.prototype},y.compare=function(H,Y){if(pt(H,Uint8Array)&&(H=y.from(H,H.offset,H.byteLength)),pt(Y,Uint8Array)&&(Y=y.from(Y,Y.offset,Y.byteLength)),!y.isBuffer(H)||!y.isBuffer(Y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(H===Y)return 0;for(var Ie=H.length,qe=Y.length,ut=0,st=Math.min(Ie,qe);ut<st;++ut)if(H[ut]!==Y[ut]){Ie=H[ut],qe=Y[ut];break}return Ie<qe?-1:qe<Ie?1:0},y.isEncoding=function(H){switch(String(H).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},y.concat=function(H,Y){if(!Array.isArray(H))throw new TypeError('"list" argument must be an Array of Buffers');if(H.length===0)return y.alloc(0);var Ie;if(Y===void 0)for(Y=0,Ie=0;Ie<H.length;++Ie)Y+=H[Ie].length;var qe=y.allocUnsafe(Y),ut=0;for(Ie=0;Ie<H.length;++Ie){var st=H[Ie];if(pt(st,Uint8Array)&&(st=y.from(st)),!y.isBuffer(st))throw new TypeError('"list" argument must be an Array of Buffers');st.copy(qe,ut),ut+=st.length}return qe};function $(ue,H){if(y.isBuffer(ue))return ue.length;if(ArrayBuffer.isView(ue)||pt(ue,ArrayBuffer))return ue.byteLength;if(typeof ue!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ue);var Y=ue.length,Ie=arguments.length>2&&arguments[2]===!0;if(!Ie&&Y===0)return 0;for(var qe=!1;;)switch(H){case"ascii":case"latin1":case"binary":return Y;case"utf8":case"utf-8":return He(ue).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y*2;case"hex":return Y>>>1;case"base64":return Ye(ue).length;default:if(qe)return Ie?-1:He(ue).length;H=(""+H).toLowerCase(),qe=!0}}y.byteLength=$;function re(ue,H,Y){var Ie=!1;if((H===void 0||H<0)&&(H=0),H>this.length||((Y===void 0||Y>this.length)&&(Y=this.length),Y<=0)||(Y>>>=0,H>>>=0,Y<=H))return"";for(ue||(ue="utf8");;)switch(ue){case"hex":return kt(this,H,Y);case"utf8":case"utf-8":return Fe(this,H,Y);case"ascii":return Ze(this,H,Y);case"latin1":case"binary":return ht(this,H,Y);case"base64":return he(this,H,Y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $e(this,H,Y);default:if(Ie)throw new TypeError("Unknown encoding: "+ue);ue=(ue+"").toLowerCase(),Ie=!0}}y.prototype._isBuffer=!0;function j(ue,H,Y){var Ie=ue[H];ue[H]=ue[Y],ue[Y]=Ie}y.prototype.swap16=function(){var H=this.length;if(H%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Y=0;Y<H;Y+=2)j(this,Y,Y+1);return this},y.prototype.swap32=function(){var H=this.length;if(H%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Y=0;Y<H;Y+=4)j(this,Y,Y+3),j(this,Y+1,Y+2);return this},y.prototype.swap64=function(){var H=this.length;if(H%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Y=0;Y<H;Y+=8)j(this,Y,Y+7),j(this,Y+1,Y+6),j(this,Y+2,Y+5),j(this,Y+3,Y+4);return this},y.prototype.toString=function(){var H=this.length;return H===0?"":arguments.length===0?Fe(this,0,H):re.apply(this,arguments)},y.prototype.toLocaleString=y.prototype.toString,y.prototype.equals=function(H){if(!y.isBuffer(H))throw new TypeError("Argument must be a Buffer");return this===H?!0:y.compare(this,H)===0},y.prototype.inspect=function(){var H="",Y=u.INSPECT_MAX_BYTES;return H=this.toString("hex",0,Y).replace(/(.{2})/g,"$1 ").trim(),this.length>Y&&(H+=" ... "),"<Buffer "+H+">"},y.prototype.compare=function(H,Y,Ie,qe,ut){if(pt(H,Uint8Array)&&(H=y.from(H,H.offset,H.byteLength)),!y.isBuffer(H))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof H);if(Y===void 0&&(Y=0),Ie===void 0&&(Ie=H?H.length:0),qe===void 0&&(qe=0),ut===void 0&&(ut=this.length),Y<0||Ie>H.length||qe<0||ut>this.length)throw new RangeError("out of range index");if(qe>=ut&&Y>=Ie)return 0;if(qe>=ut)return-1;if(Y>=Ie)return 1;if(Y>>>=0,Ie>>>=0,qe>>>=0,ut>>>=0,this===H)return 0;for(var st=ut-qe,ki=Ie-Y,ct=Math.min(st,ki),Vt=this.slice(qe,ut),Ci=H.slice(Y,Ie),Fi=0;Fi<ct;++Fi)if(Vt[Fi]!==Ci[Fi]){st=Vt[Fi],ki=Ci[Fi];break}return st<ki?-1:ki<st?1:0};function U(ue,H,Y,Ie,qe){if(ue.length===0)return-1;if(typeof Y=="string"?(Ie=Y,Y=0):Y>2147483647?Y=2147483647:Y<-2147483648&&(Y=-2147483648),Y=+Y,it(Y)&&(Y=qe?0:ue.length-1),Y<0&&(Y=ue.length+Y),Y>=ue.length){if(qe)return-1;Y=ue.length-1}else if(Y<0)if(qe)Y=0;else return-1;if(typeof H=="string"&&(H=y.from(H,Ie)),y.isBuffer(H))return H.length===0?-1:J(ue,H,Y,Ie,qe);if(typeof H=="number")return H=H&255,typeof Uint8Array.prototype.indexOf=="function"?qe?Uint8Array.prototype.indexOf.call(ue,H,Y):Uint8Array.prototype.lastIndexOf.call(ue,H,Y):J(ue,[H],Y,Ie,qe);throw new TypeError("val must be string, number or Buffer")}function J(ue,H,Y,Ie,qe){var ut=1,st=ue.length,ki=H.length;if(Ie!==void 0&&(Ie=String(Ie).toLowerCase(),Ie==="ucs2"||Ie==="ucs-2"||Ie==="utf16le"||Ie==="utf-16le")){if(ue.length<2||H.length<2)return-1;ut=2,st/=2,ki/=2,Y/=2}function ct(xt,li){return ut===1?xt[li]:xt.readUInt16BE(li*ut)}var Vt;if(qe){var Ci=-1;for(Vt=Y;Vt<st;Vt++)if(ct(ue,Vt)===ct(H,Ci===-1?0:Vt-Ci)){if(Ci===-1&&(Ci=Vt),Vt-Ci+1===ki)return Ci*ut}else Ci!==-1&&(Vt-=Vt-Ci),Ci=-1}else for(Y+ki>st&&(Y=st-ki),Vt=Y;Vt>=0;Vt--){for(var Fi=!0,Cn=0;Cn<ki;Cn++)if(ct(ue,Vt+Cn)!==ct(H,Cn)){Fi=!1;break}if(Fi)return Vt}return-1}y.prototype.includes=function(H,Y,Ie){return this.indexOf(H,Y,Ie)!==-1},y.prototype.indexOf=function(H,Y,Ie){return U(this,H,Y,Ie,!0)},y.prototype.lastIndexOf=function(H,Y,Ie){return U(this,H,Y,Ie,!1)};function R(ue,H,Y,Ie){Y=Number(Y)||0;var qe=ue.length-Y;Ie?(Ie=Number(Ie),Ie>qe&&(Ie=qe)):Ie=qe;var ut=H.length;Ie>ut/2&&(Ie=ut/2);for(var st=0;st<Ie;++st){var ki=parseInt(H.substr(st*2,2),16);if(it(ki))return st;ue[Y+st]=ki}return st}function Z(ue,H,Y,Ie){return gi(He(H,ue.length-Y),ue,Y,Ie)}function ce(ue,H,Y,Ie){return gi(Pt(H),ue,Y,Ie)}function fe(ue,H,Y,Ie){return ce(ue,H,Y,Ie)}function ge(ue,H,Y,Ie){return gi(Ye(H),ue,Y,Ie)}function ye(ue,H,Y,Ie){return gi(ni(H,ue.length-Y),ue,Y,Ie)}y.prototype.write=function(H,Y,Ie,qe){if(Y===void 0)qe="utf8",Ie=this.length,Y=0;else if(Ie===void 0&&typeof Y=="string")qe=Y,Ie=this.length,Y=0;else if(isFinite(Y))Y=Y>>>0,isFinite(Ie)?(Ie=Ie>>>0,qe===void 0&&(qe="utf8")):(qe=Ie,Ie=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var ut=this.length-Y;if((Ie===void 0||Ie>ut)&&(Ie=ut),H.length>0&&(Ie<0||Y<0)||Y>this.length)throw new RangeError("Attempt to write outside buffer bounds");qe||(qe="utf8");for(var st=!1;;)switch(qe){case"hex":return R(this,H,Y,Ie);case"utf8":case"utf-8":return Z(this,H,Y,Ie);case"ascii":return ce(this,H,Y,Ie);case"latin1":case"binary":return fe(this,H,Y,Ie);case"base64":return ge(this,H,Y,Ie);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ye(this,H,Y,Ie);default:if(st)throw new TypeError("Unknown encoding: "+qe);qe=(""+qe).toLowerCase(),st=!0}},y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function he(ue,H,Y){return H===0&&Y===ue.length?f.fromByteArray(ue):f.fromByteArray(ue.slice(H,Y))}function Fe(ue,H,Y){Y=Math.min(ue.length,Y);for(var Ie=[],qe=H;qe<Y;){var ut=ue[qe],st=null,ki=ut>239?4:ut>223?3:ut>191?2:1;if(qe+ki<=Y){var ct,Vt,Ci,Fi;switch(ki){case 1:ut<128&&(st=ut);break;case 2:ct=ue[qe+1],(ct&192)===128&&(Fi=(ut&31)<<6|ct&63,Fi>127&&(st=Fi));break;case 3:ct=ue[qe+1],Vt=ue[qe+2],(ct&192)===128&&(Vt&192)===128&&(Fi=(ut&15)<<12|(ct&63)<<6|Vt&63,Fi>2047&&(Fi<55296||Fi>57343)&&(st=Fi));break;case 4:ct=ue[qe+1],Vt=ue[qe+2],Ci=ue[qe+3],(ct&192)===128&&(Vt&192)===128&&(Ci&192)===128&&(Fi=(ut&15)<<18|(ct&63)<<12|(Vt&63)<<6|Ci&63,Fi>65535&&Fi<1114112&&(st=Fi))}}st===null?(st=65533,ki=1):st>65535&&(st-=65536,Ie.push(st>>>10&1023|55296),st=56320|st&1023),Ie.push(st),qe+=ki}return lt(Ie)}var Me=4096;function lt(ue){var H=ue.length;if(H<=Me)return String.fromCharCode.apply(String,ue);for(var Y="",Ie=0;Ie<H;)Y+=String.fromCharCode.apply(String,ue.slice(Ie,Ie+=Me));return Y}function Ze(ue,H,Y){var Ie="";Y=Math.min(ue.length,Y);for(var qe=H;qe<Y;++qe)Ie+=String.fromCharCode(ue[qe]&127);return Ie}function ht(ue,H,Y){var Ie="";Y=Math.min(ue.length,Y);for(var qe=H;qe<Y;++qe)Ie+=String.fromCharCode(ue[qe]);return Ie}function kt(ue,H,Y){var Ie=ue.length;(!H||H<0)&&(H=0),(!Y||Y<0||Y>Ie)&&(Y=Ie);for(var qe="",ut=H;ut<Y;++ut)qe+=At(ue[ut]);return qe}function $e(ue,H,Y){for(var Ie=ue.slice(H,Y),qe="",ut=0;ut<Ie.length;ut+=2)qe+=String.fromCharCode(Ie[ut]+Ie[ut+1]*256);return qe}y.prototype.slice=function(H,Y){var Ie=this.length;H=~~H,Y=Y===void 0?Ie:~~Y,H<0?(H+=Ie,H<0&&(H=0)):H>Ie&&(H=Ie),Y<0?(Y+=Ie,Y<0&&(Y=0)):Y>Ie&&(Y=Ie),Y<H&&(Y=H);var qe=this.subarray(H,Y);return qe.__proto__=y.prototype,qe};function vt(ue,H,Y){if(ue%1!==0||ue<0)throw new RangeError("offset is not uint");if(ue+H>Y)throw new RangeError("Trying to access beyond buffer length")}y.prototype.readUIntLE=function(H,Y,Ie){H=H>>>0,Y=Y>>>0,Ie||vt(H,Y,this.length);for(var qe=this[H],ut=1,st=0;++st<Y&&(ut*=256);)qe+=this[H+st]*ut;return qe},y.prototype.readUIntBE=function(H,Y,Ie){H=H>>>0,Y=Y>>>0,Ie||vt(H,Y,this.length);for(var qe=this[H+--Y],ut=1;Y>0&&(ut*=256);)qe+=this[H+--Y]*ut;return qe},y.prototype.readUInt8=function(H,Y){return H=H>>>0,Y||vt(H,1,this.length),this[H]},y.prototype.readUInt16LE=function(H,Y){return H=H>>>0,Y||vt(H,2,this.length),this[H]|this[H+1]<<8},y.prototype.readUInt16BE=function(H,Y){return H=H>>>0,Y||vt(H,2,this.length),this[H]<<8|this[H+1]},y.prototype.readUInt32LE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),(this[H]|this[H+1]<<8|this[H+2]<<16)+this[H+3]*16777216},y.prototype.readUInt32BE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),this[H]*16777216+(this[H+1]<<16|this[H+2]<<8|this[H+3])},y.prototype.readIntLE=function(H,Y,Ie){H=H>>>0,Y=Y>>>0,Ie||vt(H,Y,this.length);for(var qe=this[H],ut=1,st=0;++st<Y&&(ut*=256);)qe+=this[H+st]*ut;return ut*=128,qe>=ut&&(qe-=Math.pow(2,8*Y)),qe},y.prototype.readIntBE=function(H,Y,Ie){H=H>>>0,Y=Y>>>0,Ie||vt(H,Y,this.length);for(var qe=Y,ut=1,st=this[H+--qe];qe>0&&(ut*=256);)st+=this[H+--qe]*ut;return ut*=128,st>=ut&&(st-=Math.pow(2,8*Y)),st},y.prototype.readInt8=function(H,Y){return H=H>>>0,Y||vt(H,1,this.length),this[H]&128?(255-this[H]+1)*-1:this[H]},y.prototype.readInt16LE=function(H,Y){H=H>>>0,Y||vt(H,2,this.length);var Ie=this[H]|this[H+1]<<8;return Ie&32768?Ie|4294901760:Ie},y.prototype.readInt16BE=function(H,Y){H=H>>>0,Y||vt(H,2,this.length);var Ie=this[H+1]|this[H]<<8;return Ie&32768?Ie|4294901760:Ie},y.prototype.readInt32LE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),this[H]|this[H+1]<<8|this[H+2]<<16|this[H+3]<<24},y.prototype.readInt32BE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),this[H]<<24|this[H+1]<<16|this[H+2]<<8|this[H+3]},y.prototype.readFloatLE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),o.read(this,H,!0,23,4)},y.prototype.readFloatBE=function(H,Y){return H=H>>>0,Y||vt(H,4,this.length),o.read(this,H,!1,23,4)},y.prototype.readDoubleLE=function(H,Y){return H=H>>>0,Y||vt(H,8,this.length),o.read(this,H,!0,52,8)},y.prototype.readDoubleBE=function(H,Y){return H=H>>>0,Y||vt(H,8,this.length),o.read(this,H,!1,52,8)};function St(ue,H,Y,Ie,qe,ut){if(!y.isBuffer(ue))throw new TypeError('"buffer" argument must be a Buffer instance');if(H>qe||H<ut)throw new RangeError('"value" argument is out of bounds');if(Y+Ie>ue.length)throw new RangeError("Index out of range")}y.prototype.writeUIntLE=function(H,Y,Ie,qe){if(H=+H,Y=Y>>>0,Ie=Ie>>>0,!qe){var ut=Math.pow(2,8*Ie)-1;St(this,H,Y,Ie,ut,0)}var st=1,ki=0;for(this[Y]=H&255;++ki<Ie&&(st*=256);)this[Y+ki]=H/st&255;return Y+Ie},y.prototype.writeUIntBE=function(H,Y,Ie,qe){if(H=+H,Y=Y>>>0,Ie=Ie>>>0,!qe){var ut=Math.pow(2,8*Ie)-1;St(this,H,Y,Ie,ut,0)}var st=Ie-1,ki=1;for(this[Y+st]=H&255;--st>=0&&(ki*=256);)this[Y+st]=H/ki&255;return Y+Ie},y.prototype.writeUInt8=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,1,255,0),this[Y]=H&255,Y+1},y.prototype.writeUInt16LE=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,2,65535,0),this[Y]=H&255,this[Y+1]=H>>>8,Y+2},y.prototype.writeUInt16BE=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,2,65535,0),this[Y]=H>>>8,this[Y+1]=H&255,Y+2},y.prototype.writeUInt32LE=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,4,4294967295,0),this[Y+3]=H>>>24,this[Y+2]=H>>>16,this[Y+1]=H>>>8,this[Y]=H&255,Y+4},y.prototype.writeUInt32BE=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,4,4294967295,0),this[Y]=H>>>24,this[Y+1]=H>>>16,this[Y+2]=H>>>8,this[Y+3]=H&255,Y+4},y.prototype.writeIntLE=function(H,Y,Ie,qe){if(H=+H,Y=Y>>>0,!qe){var ut=Math.pow(2,8*Ie-1);St(this,H,Y,Ie,ut-1,-ut)}var st=0,ki=1,ct=0;for(this[Y]=H&255;++st<Ie&&(ki*=256);)H<0&&ct===0&&this[Y+st-1]!==0&&(ct=1),this[Y+st]=(H/ki>>0)-ct&255;return Y+Ie},y.prototype.writeIntBE=function(H,Y,Ie,qe){if(H=+H,Y=Y>>>0,!qe){var ut=Math.pow(2,8*Ie-1);St(this,H,Y,Ie,ut-1,-ut)}var st=Ie-1,ki=1,ct=0;for(this[Y+st]=H&255;--st>=0&&(ki*=256);)H<0&&ct===0&&this[Y+st+1]!==0&&(ct=1),this[Y+st]=(H/ki>>0)-ct&255;return Y+Ie},y.prototype.writeInt8=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,1,127,-128),H<0&&(H=255+H+1),this[Y]=H&255,Y+1},y.prototype.writeInt16LE=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,2,32767,-32768),this[Y]=H&255,this[Y+1]=H>>>8,Y+2},y.prototype.writeInt16BE=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,2,32767,-32768),this[Y]=H>>>8,this[Y+1]=H&255,Y+2},y.prototype.writeInt32LE=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,4,2147483647,-2147483648),this[Y]=H&255,this[Y+1]=H>>>8,this[Y+2]=H>>>16,this[Y+3]=H>>>24,Y+4},y.prototype.writeInt32BE=function(H,Y,Ie){return H=+H,Y=Y>>>0,Ie||St(this,H,Y,4,2147483647,-2147483648),H<0&&(H=4294967295+H+1),this[Y]=H>>>24,this[Y+1]=H>>>16,this[Y+2]=H>>>8,this[Y+3]=H&255,Y+4};function Zt(ue,H,Y,Ie,qe,ut){if(Y+Ie>ue.length)throw new RangeError("Index out of range");if(Y<0)throw new RangeError("Index out of range")}function oi(ue,H,Y,Ie,qe){return H=+H,Y=Y>>>0,qe||Zt(ue,H,Y,4),o.write(ue,H,Y,Ie,23,4),Y+4}y.prototype.writeFloatLE=function(H,Y,Ie){return oi(this,H,Y,!0,Ie)},y.prototype.writeFloatBE=function(H,Y,Ie){return oi(this,H,Y,!1,Ie)};function Mi(ue,H,Y,Ie,qe){return H=+H,Y=Y>>>0,qe||Zt(ue,H,Y,8),o.write(ue,H,Y,Ie,52,8),Y+8}y.prototype.writeDoubleLE=function(H,Y,Ie){return Mi(this,H,Y,!0,Ie)},y.prototype.writeDoubleBE=function(H,Y,Ie){return Mi(this,H,Y,!1,Ie)},y.prototype.copy=function(H,Y,Ie,qe){if(!y.isBuffer(H))throw new TypeError("argument should be a Buffer");if(Ie||(Ie=0),!qe&&qe!==0&&(qe=this.length),Y>=H.length&&(Y=H.length),Y||(Y=0),qe>0&&qe<Ie&&(qe=Ie),qe===Ie||H.length===0||this.length===0)return 0;if(Y<0)throw new RangeError("targetStart out of bounds");if(Ie<0||Ie>=this.length)throw new RangeError("Index out of range");if(qe<0)throw new RangeError("sourceEnd out of bounds");qe>this.length&&(qe=this.length),H.length-Y<qe-Ie&&(qe=H.length-Y+Ie);var ut=qe-Ie;if(this===H&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(Y,Ie,qe);else if(this===H&&Ie<Y&&Y<qe)for(var st=ut-1;st>=0;--st)H[st+Y]=this[st+Ie];else Uint8Array.prototype.set.call(H,this.subarray(Ie,qe),Y);return ut},y.prototype.fill=function(H,Y,Ie,qe){if(typeof H=="string"){if(typeof Y=="string"?(qe=Y,Y=0,Ie=this.length):typeof Ie=="string"&&(qe=Ie,Ie=this.length),qe!==void 0&&typeof qe!="string")throw new TypeError("encoding must be a string");if(typeof qe=="string"&&!y.isEncoding(qe))throw new TypeError("Unknown encoding: "+qe);if(H.length===1){var ut=H.charCodeAt(0);(qe==="utf8"&&ut<128||qe==="latin1")&&(H=ut)}}else typeof H=="number"&&(H=H&255);if(Y<0||this.length<Y||this.length<Ie)throw new RangeError("Out of range index");if(Ie<=Y)return this;Y=Y>>>0,Ie=Ie===void 0?this.length:Ie>>>0,H||(H=0);var st;if(typeof H=="number")for(st=Y;st<Ie;++st)this[st]=H;else{var ki=y.isBuffer(H)?H:y.from(H,qe),ct=ki.length;if(ct===0)throw new TypeError('The value "'+H+'" is invalid for argument "value"');for(st=0;st<Ie-Y;++st)this[st+Y]=ki[st%ct]}return this};var Pi=/[^+/0-9A-Za-z-_]/g;function Ti(ue){if(ue=ue.split("=")[0],ue=ue.trim().replace(Pi,""),ue.length<2)return"";for(;ue.length%4!==0;)ue=ue+"=";return ue}function At(ue){return ue<16?"0"+ue.toString(16):ue.toString(16)}function He(ue,H){H=H||1/0;for(var Y,Ie=ue.length,qe=null,ut=[],st=0;st<Ie;++st){if(Y=ue.charCodeAt(st),Y>55295&&Y<57344){if(!qe){if(Y>56319){(H-=3)>-1&&ut.push(239,191,189);continue}else if(st+1===Ie){(H-=3)>-1&&ut.push(239,191,189);continue}qe=Y;continue}if(Y<56320){(H-=3)>-1&&ut.push(239,191,189),qe=Y;continue}Y=(qe-55296<<10|Y-56320)+65536}else qe&&(H-=3)>-1&&ut.push(239,191,189);if(qe=null,Y<128){if((H-=1)<0)break;ut.push(Y)}else if(Y<2048){if((H-=2)<0)break;ut.push(Y>>6|192,Y&63|128)}else if(Y<65536){if((H-=3)<0)break;ut.push(Y>>12|224,Y>>6&63|128,Y&63|128)}else if(Y<1114112){if((H-=4)<0)break;ut.push(Y>>18|240,Y>>12&63|128,Y>>6&63|128,Y&63|128)}else throw new Error("Invalid code point")}return ut}function Pt(ue){for(var H=[],Y=0;Y<ue.length;++Y)H.push(ue.charCodeAt(Y)&255);return H}function ni(ue,H){for(var Y,Ie,qe,ut=[],st=0;st<ue.length&&!((H-=2)<0);++st)Y=ue.charCodeAt(st),Ie=Y>>8,qe=Y%256,ut.push(qe),ut.push(Ie);return ut}function Ye(ue){return f.toByteArray(Ti(ue))}function gi(ue,H,Y,Ie){for(var qe=0;qe<Ie&&!(qe+Y>=H.length||qe>=ue.length);++qe)H[qe+Y]=ue[qe];return qe}function pt(ue,H){return ue instanceof H||ue!=null&&ue.constructor!=null&&ue.constructor.name!=null&&ue.constructor.name===H.name}function it(ue){return ue!==ue}}).call(this)}).call(this,n("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:14}],3:[function(n,a,u){const d=n("./validator"),f=n("./xmlparser/XMLParser"),o=n("./xmlbuilder/json2xml");a.exports={XMLParser:f,XMLValidator:d,XMLBuilder:o}},{"./validator":5,"./xmlbuilder/json2xml":6,"./xmlparser/XMLParser":11}],4:[function(n,a,u){const d=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",f=d+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",o="["+d+"]["+f+"]*",_=new RegExp("^"+o+"$"),S=function(y,k){const I=[];let C=k.exec(y);for(;C;){const L=[];L.startIndex=k.lastIndex-C[0].length;const B=C.length;for(let N=0;N<B;N++)L.push(C[N]);I.push(L),C=k.exec(y)}return I},T=function(y){const k=_.exec(y);return!(k===null||typeof k>"u")};u.isExist=function(y){return typeof y<"u"},u.isEmptyObject=function(y){return Object.keys(y).length===0},u.merge=function(y,k,I){if(k){const C=Object.keys(k),L=C.length;for(let B=0;B<L;B++)I==="strict"?y[C[B]]=[k[C[B]]]:y[C[B]]=k[C[B]]}},u.getValue=function(y){return u.isExist(y)?y:""},u.isName=T,u.getAllMatches=S,u.nameRegexp=o},{}],5:[function(n,a,u){const d=n("./util"),f={allowBooleanAttributes:!1,unpairedTags:[]};u.validate=function($,re){re=Object.assign({},f,re);const j=[];let U=!1,J=!1;$[0]==="\uFEFF"&&($=$.substr(1));for(let R=0;R<$.length;R++)if($[R]==="<"&&$[R+1]==="?"){if(R+=2,R=_($,R),R.err)return R}else if($[R]==="<"){let Z=R;if(R++,$[R]==="!"){R=S($,R);continue}else{let ce=!1;$[R]==="/"&&(ce=!0,R++);let fe="";for(;R<$.length&&$[R]!==">"&&$[R]!==" "&&$[R]!=="	"&&$[R]!==`
`&&$[R]!=="\r";R++)fe+=$[R];if(fe=fe.trim(),fe[fe.length-1]==="/"&&(fe=fe.substring(0,fe.length-1),R--),!W(fe)){let he;return fe.trim().length===0?he="Invalid space after '<'.":he="Tag '"+fe+"' is an invalid name.",N("InvalidTag",he,ee($,R))}const ge=k($,R);if(ge===!1)return N("InvalidAttr","Attributes for '"+fe+"' have open quote.",ee($,R));let ye=ge.value;if(R=ge.index,ye[ye.length-1]==="/"){const he=R-ye.length;ye=ye.substring(0,ye.length-1);const Fe=C(ye,re);if(Fe===!0)U=!0;else return N(Fe.err.code,Fe.err.msg,ee($,he+Fe.err.line))}else if(ce)if(ge.tagClosed){if(ye.trim().length>0)return N("InvalidTag","Closing tag '"+fe+"' can't have attributes or invalid starting.",ee($,Z));if(j.length===0)return N("InvalidTag","Closing tag '"+fe+"' has not been opened.",ee($,Z));{const he=j.pop();if(fe!==he.tagName){let Fe=ee($,he.tagStartPos);return N("InvalidTag","Expected closing tag '"+he.tagName+"' (opened in line "+Fe.line+", col "+Fe.col+") instead of closing tag '"+fe+"'.",ee($,Z))}j.length==0&&(J=!0)}}else return N("InvalidTag","Closing tag '"+fe+"' doesn't have proper closing.",ee($,R));else{const he=C(ye,re);if(he!==!0)return N(he.err.code,he.err.msg,ee($,R-ye.length+he.err.line));if(J===!0)return N("InvalidXml","Multiple possible root nodes found.",ee($,R));re.unpairedTags.indexOf(fe)!==-1||j.push({tagName:fe,tagStartPos:Z}),U=!0}for(R++;R<$.length;R++)if($[R]==="<")if($[R+1]==="!"){R++,R=S($,R);continue}else if($[R+1]==="?"){if(R=_($,++R),R.err)return R}else break;else if($[R]==="&"){const he=B($,R);if(he==-1)return N("InvalidChar","char '&' is not expected.",ee($,R));R=he}else if(J===!0&&!o($[R]))return N("InvalidXml","Extra text at the end",ee($,R));$[R]==="<"&&R--}}else{if(o($[R]))continue;return N("InvalidChar","char '"+$[R]+"' is not expected.",ee($,R))}if(U){if(j.length==1)return N("InvalidTag","Unclosed tag '"+j[0].tagName+"'.",ee($,j[0].tagStartPos));if(j.length>0)return N("InvalidXml","Invalid '"+JSON.stringify(j.map(R=>R.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return N("InvalidXml","Start tag expected.",1);return!0};function o($){return $===" "||$==="	"||$===`
`||$==="\r"}function _($,re){const j=re;for(;re<$.length;re++)if($[re]=="?"||$[re]==" "){const U=$.substr(j,re-j);if(re>5&&U==="xml")return N("InvalidXml","XML declaration allowed only at the start of the document.",ee($,re));if($[re]=="?"&&$[re+1]==">"){re++;break}else continue}return re}function S($,re){if($.length>re+5&&$[re+1]==="-"&&$[re+2]==="-"){for(re+=3;re<$.length;re++)if($[re]==="-"&&$[re+1]==="-"&&$[re+2]===">"){re+=2;break}}else if($.length>re+8&&$[re+1]==="D"&&$[re+2]==="O"&&$[re+3]==="C"&&$[re+4]==="T"&&$[re+5]==="Y"&&$[re+6]==="P"&&$[re+7]==="E"){let j=1;for(re+=8;re<$.length;re++)if($[re]==="<")j++;else if($[re]===">"&&(j--,j===0))break}else if($.length>re+9&&$[re+1]==="["&&$[re+2]==="C"&&$[re+3]==="D"&&$[re+4]==="A"&&$[re+5]==="T"&&$[re+6]==="A"&&$[re+7]==="["){for(re+=8;re<$.length;re++)if($[re]==="]"&&$[re+1]==="]"&&$[re+2]===">"){re+=2;break}}return re}const T='"',y="'";function k($,re){let j="",U="",J=!1;for(;re<$.length;re++){if($[re]===T||$[re]===y)U===""?U=$[re]:U!==$[re]||(U="");else if($[re]===">"&&U===""){J=!0;break}j+=$[re]}return U!==""?!1:{value:j,index:re,tagClosed:J}}const I=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function C($,re){const j=d.getAllMatches($,I),U={};for(let J=0;J<j.length;J++){if(j[J][1].length===0)return N("InvalidAttr","Attribute '"+j[J][2]+"' has no space in starting.",oe(j[J]));if(j[J][3]!==void 0&&j[J][4]===void 0)return N("InvalidAttr","Attribute '"+j[J][2]+"' is without value.",oe(j[J]));if(j[J][3]===void 0&&!re.allowBooleanAttributes)return N("InvalidAttr","boolean attribute '"+j[J][2]+"' is not allowed.",oe(j[J]));const R=j[J][2];if(!F(R))return N("InvalidAttr","Attribute '"+R+"' is an invalid name.",oe(j[J]));if(!U.hasOwnProperty(R))U[R]=1;else return N("InvalidAttr","Attribute '"+R+"' is repeated.",oe(j[J]))}return!0}function L($,re){let j=/\d/;for($[re]==="x"&&(re++,j=/[\da-fA-F]/);re<$.length;re++){if($[re]===";")return re;if(!$[re].match(j))break}return-1}function B($,re){if(re++,$[re]===";")return-1;if($[re]==="#")return re++,L($,re);let j=0;for(;re<$.length;re++,j++)if(!($[re].match(/\w/)&&j<20)){if($[re]===";")break;return-1}return re}function N($,re,j){return{err:{code:$,msg:re,line:j.line||j,col:j.col}}}function F($){return d.isName($)}function W($){return d.isName($)}function ee($,re){const j=$.substring(0,re).split(/\r?\n/);return{line:j.length,col:j[j.length-1].length+1}}function oe($){return $.startIndex+$[1].length}},{"./util":4}],6:[function(n,a,u){const d=n("./orderedJs2Xml"),f={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(y,k){return k},attributeValueProcessor:function(y,k){return k},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function o(y){this.options=Object.assign({},f,y),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=T),this.processTextOrObjNode=_,this.options.format?(this.indentate=S,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}o.prototype.build=function(y){return this.options.preserveOrder?d(y,this.options):(Array.isArray(y)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(y={[this.options.arrayNodeName]:y}),this.j2x(y,0).val)},o.prototype.j2x=function(y,k){let I="",C="";for(let L in y)if(Object.prototype.hasOwnProperty.call(y,L))if(typeof y[L]>"u")this.isAttribute(L)&&(C+="");else if(y[L]===null)this.isAttribute(L)?C+="":L[0]==="?"?C+=this.indentate(k)+"<"+L+"?"+this.tagEndChar:C+=this.indentate(k)+"<"+L+"/"+this.tagEndChar;else if(y[L]instanceof Date)C+=this.buildTextValNode(y[L],L,"",k);else if(typeof y[L]!="object"){const B=this.isAttribute(L);if(B)I+=this.buildAttrPairStr(B,""+y[L]);else if(L===this.options.textNodeName){let N=this.options.tagValueProcessor(L,""+y[L]);C+=this.replaceEntitiesValue(N)}else C+=this.buildTextValNode(y[L],L,"",k)}else if(Array.isArray(y[L])){const B=y[L].length;let N="",F="";for(let W=0;W<B;W++){const ee=y[L][W];if(!(typeof ee>"u"))if(ee===null)L[0]==="?"?C+=this.indentate(k)+"<"+L+"?"+this.tagEndChar:C+=this.indentate(k)+"<"+L+"/"+this.tagEndChar;else if(typeof ee=="object")if(this.options.oneListGroup){const oe=this.j2x(ee,k+1);N+=oe.val,this.options.attributesGroupName&&ee.hasOwnProperty(this.options.attributesGroupName)&&(F+=oe.attrStr)}else N+=this.processTextOrObjNode(ee,L,k);else if(this.options.oneListGroup){let oe=this.options.tagValueProcessor(L,ee);oe=this.replaceEntitiesValue(oe),N+=oe}else N+=this.buildTextValNode(ee,L,"",k)}this.options.oneListGroup&&(N=this.buildObjectNode(N,L,F,k)),C+=N}else if(this.options.attributesGroupName&&L===this.options.attributesGroupName){const B=Object.keys(y[L]),N=B.length;for(let F=0;F<N;F++)I+=this.buildAttrPairStr(B[F],""+y[L][B[F]])}else C+=this.processTextOrObjNode(y[L],L,k);return{attrStr:I,val:C}},o.prototype.buildAttrPairStr=function(y,k){return k=this.options.attributeValueProcessor(y,""+k),k=this.replaceEntitiesValue(k),this.options.suppressBooleanAttributes&&k==="true"?" "+y:" "+y+'="'+k+'"'};function _(y,k,I){const C=this.j2x(y,I+1);return y[this.options.textNodeName]!==void 0&&Object.keys(y).length===1?this.buildTextValNode(y[this.options.textNodeName],k,C.attrStr,I):this.buildObjectNode(C.val,k,C.attrStr,I)}o.prototype.buildObjectNode=function(y,k,I,C){if(y==="")return k[0]==="?"?this.indentate(C)+"<"+k+I+"?"+this.tagEndChar:this.indentate(C)+"<"+k+I+this.closeTag(k)+this.tagEndChar;{let L="</"+k+this.tagEndChar,B="";return k[0]==="?"&&(B="?",L=""),(I||I==="")&&y.indexOf("<")===-1?this.indentate(C)+"<"+k+I+B+">"+y+L:this.options.commentPropName!==!1&&k===this.options.commentPropName&&B.length===0?this.indentate(C)+`<!--${y}-->`+this.newLine:this.indentate(C)+"<"+k+I+B+this.tagEndChar+y+this.indentate(C)+L}},o.prototype.closeTag=function(y){let k="";return this.options.unpairedTags.indexOf(y)!==-1?this.options.suppressUnpairedNode||(k="/"):this.options.suppressEmptyNode?k="/":k=`></${y}`,k},o.prototype.buildTextValNode=function(y,k,I,C){if(this.options.cdataPropName!==!1&&k===this.options.cdataPropName)return this.indentate(C)+`<![CDATA[${y}]]>`+this.newLine;if(this.options.commentPropName!==!1&&k===this.options.commentPropName)return this.indentate(C)+`<!--${y}-->`+this.newLine;if(k[0]==="?")return this.indentate(C)+"<"+k+I+"?"+this.tagEndChar;{let L=this.options.tagValueProcessor(k,y);return L=this.replaceEntitiesValue(L),L===""?this.indentate(C)+"<"+k+I+this.closeTag(k)+this.tagEndChar:this.indentate(C)+"<"+k+I+">"+L+"</"+k+this.tagEndChar}},o.prototype.replaceEntitiesValue=function(y){if(y&&y.length>0&&this.options.processEntities)for(let k=0;k<this.options.entities.length;k++){const I=this.options.entities[k];y=y.replace(I.regex,I.val)}return y};function S(y){return this.options.indentBy.repeat(y)}function T(y){return y.startsWith(this.options.attributeNamePrefix)&&y!==this.options.textNodeName?y.substr(this.attrPrefixLen):!1}a.exports=o},{"./orderedJs2Xml":7}],7:[function(n,a,u){const d=`
`;function f(k,I){let C="";return I.format&&I.indentBy.length>0&&(C=d),o(k,I,"",C)}function o(k,I,C,L){let B="",N=!1;for(let F=0;F<k.length;F++){const W=k[F],ee=_(W);if(ee===void 0)continue;let oe="";if(C.length===0?oe=ee:oe=`${C}.${ee}`,ee===I.textNodeName){let J=W[ee];T(oe,I)||(J=I.tagValueProcessor(ee,J),J=y(J,I)),N&&(B+=L),B+=J,N=!1;continue}else if(ee===I.cdataPropName){N&&(B+=L),B+=`<![CDATA[${W[ee][0][I.textNodeName]}]]>`,N=!1;continue}else if(ee===I.commentPropName){B+=L+`<!--${W[ee][0][I.textNodeName]}-->`,N=!0;continue}else if(ee[0]==="?"){const J=S(W[":@"],I),R=ee==="?xml"?"":L;let Z=W[ee][0][I.textNodeName];Z=Z.length!==0?" "+Z:"",B+=R+`<${ee}${Z}${J}?>`,N=!0;continue}let $=L;$!==""&&($+=I.indentBy);const re=S(W[":@"],I),j=L+`<${ee}${re}`,U=o(W[ee],I,oe,$);I.unpairedTags.indexOf(ee)!==-1?I.suppressUnpairedNode?B+=j+">":B+=j+"/>":(!U||U.length===0)&&I.suppressEmptyNode?B+=j+"/>":U&&U.endsWith(">")?B+=j+`>${U}${L}</${ee}>`:(B+=j+">",U&&L!==""&&(U.includes("/>")||U.includes("</"))?B+=L+I.indentBy+U+L:B+=U,B+=`</${ee}>`),N=!0}return B}function _(k){const I=Object.keys(k);for(let C=0;C<I.length;C++){const L=I[C];if(k.hasOwnProperty(L)&&L!==":@")return L}}function S(k,I){let C="";if(k&&!I.ignoreAttributes)for(let L in k){if(!k.hasOwnProperty(L))continue;let B=I.attributeValueProcessor(L,k[L]);B=y(B,I),B===!0&&I.suppressBooleanAttributes?C+=` ${L.substr(I.attributeNamePrefix.length)}`:C+=` ${L.substr(I.attributeNamePrefix.length)}="${B}"`}return C}function T(k,I){k=k.substr(0,k.length-I.textNodeName.length-1);let C=k.substr(k.lastIndexOf(".")+1);for(let L in I.stopNodes)if(I.stopNodes[L]===k||I.stopNodes[L]==="*."+C)return!0;return!1}function y(k,I){if(k&&k.length>0&&I.processEntities)for(let C=0;C<I.entities.length;C++){const L=I.entities[C];k=k.replace(L.regex,L.val)}return k}a.exports=f},{}],8:[function(n,a,u){const d=n("../util");function f(C,L){const B={};if(C[L+3]==="O"&&C[L+4]==="C"&&C[L+5]==="T"&&C[L+6]==="Y"&&C[L+7]==="P"&&C[L+8]==="E"){L=L+9;let N=1,F=!1,W=!1,ee="";for(;L<C.length;L++)if(C[L]==="<"&&!W){if(F&&S(C,L))L+=7,[entityName,val,L]=o(C,L+1),val.indexOf("&")===-1&&(B[I(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(F&&T(C,L))L+=8;else if(F&&y(C,L))L+=8;else if(F&&k(C,L))L+=9;else if(_)W=!0;else throw new Error("Invalid DOCTYPE");N++,ee=""}else if(C[L]===">"){if(W?C[L-1]==="-"&&C[L-2]==="-"&&(W=!1,N--):N--,N===0)break}else C[L]==="["?F=!0:ee+=C[L];if(N!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:B,i:L}}function o(C,L){let B="";for(;L<C.length&&C[L]!=="'"&&C[L]!=='"';L++)B+=C[L];if(B=B.trim(),B.indexOf(" ")!==-1)throw new Error("External entites are not supported");const N=C[L++];let F="";for(;L<C.length&&C[L]!==N;L++)F+=C[L];return[B,F,L]}function _(C,L){return C[L+1]==="!"&&C[L+2]==="-"&&C[L+3]==="-"}function S(C,L){return C[L+1]==="!"&&C[L+2]==="E"&&C[L+3]==="N"&&C[L+4]==="T"&&C[L+5]==="I"&&C[L+6]==="T"&&C[L+7]==="Y"}function T(C,L){return C[L+1]==="!"&&C[L+2]==="E"&&C[L+3]==="L"&&C[L+4]==="E"&&C[L+5]==="M"&&C[L+6]==="E"&&C[L+7]==="N"&&C[L+8]==="T"}function y(C,L){return C[L+1]==="!"&&C[L+2]==="A"&&C[L+3]==="T"&&C[L+4]==="T"&&C[L+5]==="L"&&C[L+6]==="I"&&C[L+7]==="S"&&C[L+8]==="T"}function k(C,L){return C[L+1]==="!"&&C[L+2]==="N"&&C[L+3]==="O"&&C[L+4]==="T"&&C[L+5]==="A"&&C[L+6]==="T"&&C[L+7]==="I"&&C[L+8]==="O"&&C[L+9]==="N"}function I(C){if(d.isName(C))return C;throw new Error(`Invalid entity name ${C}`)}a.exports=f},{"../util":4}],9:[function(n,a,u){const d={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(o,_){return _},attributeValueProcessor:function(o,_){return _},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(o,_,S){return o}},f=function(o){return Object.assign({},d,o)};u.buildOptions=f,u.defaultOptions=d},{}],10:[function(n,a,u){const d=n("../util"),f=n("./xmlNode"),o=n("./DocTypeReader"),_=n("strnum");class S{constructor(J){this.options=J,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(R,Z)=>String.fromCharCode(Number.parseInt(Z,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(R,Z)=>String.fromCharCode(Number.parseInt(Z,16))}},this.addExternalEntities=T,this.parseXml=L,this.parseTextData=y,this.resolveNameSpace=k,this.buildAttributesMap=C,this.isItStopNode=W,this.replaceEntitiesValue=N,this.readStopNodeData=re,this.saveTextToParentTag=F,this.addChild=B}}function T(U){const J=Object.keys(U);for(let R=0;R<J.length;R++){const Z=J[R];this.lastEntities[Z]={regex:new RegExp("&"+Z+";","g"),val:U[Z]}}}function y(U,J,R,Z,ce,fe,ge){if(U!==void 0&&(this.options.trimValues&&!Z&&(U=U.trim()),U.length>0)){ge||(U=this.replaceEntitiesValue(U));const ye=this.options.tagValueProcessor(J,U,R,ce,fe);return ye==null?U:typeof ye!=typeof U||ye!==U?ye:this.options.trimValues?j(U,this.options.parseTagValue,this.options.numberParseOptions):U.trim()===U?j(U,this.options.parseTagValue,this.options.numberParseOptions):U}}function k(U){if(this.options.removeNSPrefix){const J=U.split(":"),R=U.charAt(0)==="/"?"/":"";if(J[0]==="xmlns")return"";J.length===2&&(U=R+J[1])}return U}const I=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function C(U,J,R){if(!this.options.ignoreAttributes&&typeof U=="string"){const Z=d.getAllMatches(U,I),ce=Z.length,fe={};for(let ge=0;ge<ce;ge++){const ye=this.resolveNameSpace(Z[ge][1]);let he=Z[ge][4],Fe=this.options.attributeNamePrefix+ye;if(ye.length)if(this.options.transformAttributeName&&(Fe=this.options.transformAttributeName(Fe)),Fe==="__proto__"&&(Fe="#__proto__"),he!==void 0){this.options.trimValues&&(he=he.trim()),he=this.replaceEntitiesValue(he);const Me=this.options.attributeValueProcessor(ye,he,J);Me==null?fe[Fe]=he:typeof Me!=typeof he||Me!==he?fe[Fe]=Me:fe[Fe]=j(he,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(fe[Fe]=!0)}if(!Object.keys(fe).length)return;if(this.options.attributesGroupName){const ge={};return ge[this.options.attributesGroupName]=fe,ge}return fe}}const L=function(U){U=U.replace(/\r\n?/g,`
`);const J=new f("!xml");let R=J,Z="",ce="";for(let fe=0;fe<U.length;fe++)if(U[fe]==="<")if(U[fe+1]==="/"){const ye=oe(U,">",fe,"Closing Tag is not closed.");let he=U.substring(fe+2,ye).trim();if(this.options.removeNSPrefix){const lt=he.indexOf(":");lt!==-1&&(he=he.substr(lt+1))}this.options.transformTagName&&(he=this.options.transformTagName(he)),R&&(Z=this.saveTextToParentTag(Z,R,ce));const Fe=ce.substring(ce.lastIndexOf(".")+1);if(he&&this.options.unpairedTags.indexOf(he)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${he}>`);let Me=0;Fe&&this.options.unpairedTags.indexOf(Fe)!==-1?(Me=ce.lastIndexOf(".",ce.lastIndexOf(".")-1),this.tagsNodeStack.pop()):Me=ce.lastIndexOf("."),ce=ce.substring(0,Me),R=this.tagsNodeStack.pop(),Z="",fe=ye}else if(U[fe+1]==="?"){let ye=$(U,fe,!1,"?>");if(!ye)throw new Error("Pi Tag is not closed.");if(Z=this.saveTextToParentTag(Z,R,ce),!(this.options.ignoreDeclaration&&ye.tagName==="?xml"||this.options.ignorePiTags)){const he=new f(ye.tagName);he.add(this.options.textNodeName,""),ye.tagName!==ye.tagExp&&ye.attrExpPresent&&(he[":@"]=this.buildAttributesMap(ye.tagExp,ce,ye.tagName)),this.addChild(R,he,ce)}fe=ye.closeIndex+1}else if(U.substr(fe+1,3)==="!--"){const ye=oe(U,"-->",fe+4,"Comment is not closed.");if(this.options.commentPropName){const he=U.substring(fe+4,ye-2);Z=this.saveTextToParentTag(Z,R,ce),R.add(this.options.commentPropName,[{[this.options.textNodeName]:he}])}fe=ye}else if(U.substr(fe+1,2)==="!D"){const ye=o(U,fe);this.docTypeEntities=ye.entities,fe=ye.i}else if(U.substr(fe+1,2)==="!["){const ye=oe(U,"]]>",fe,"CDATA is not closed.")-2,he=U.substring(fe+9,ye);Z=this.saveTextToParentTag(Z,R,ce);let Fe=this.parseTextData(he,R.tagname,ce,!0,!1,!0,!0);Fe==null&&(Fe=""),this.options.cdataPropName?R.add(this.options.cdataPropName,[{[this.options.textNodeName]:he}]):R.add(this.options.textNodeName,Fe),fe=ye+2}else{let ye=$(U,fe,this.options.removeNSPrefix),he=ye.tagName;const Fe=ye.rawTagName;let Me=ye.tagExp,lt=ye.attrExpPresent,Ze=ye.closeIndex;this.options.transformTagName&&(he=this.options.transformTagName(he)),R&&Z&&R.tagname!=="!xml"&&(Z=this.saveTextToParentTag(Z,R,ce,!1));const ht=R;if(ht&&this.options.unpairedTags.indexOf(ht.tagname)!==-1&&(R=this.tagsNodeStack.pop(),ce=ce.substring(0,ce.lastIndexOf("."))),he!==J.tagname&&(ce+=ce?"."+he:he),this.isItStopNode(this.options.stopNodes,ce,he)){let kt="";if(Me.length>0&&Me.lastIndexOf("/")===Me.length-1)he[he.length-1]==="/"?(he=he.substr(0,he.length-1),ce=ce.substr(0,ce.length-1),Me=he):Me=Me.substr(0,Me.length-1),fe=ye.closeIndex;else if(this.options.unpairedTags.indexOf(he)!==-1)fe=ye.closeIndex;else{const vt=this.readStopNodeData(U,Fe,Ze+1);if(!vt)throw new Error(`Unexpected end of ${Fe}`);fe=vt.i,kt=vt.tagContent}const $e=new f(he);he!==Me&&lt&&($e[":@"]=this.buildAttributesMap(Me,ce,he)),kt&&(kt=this.parseTextData(kt,he,ce,!0,lt,!0,!0)),ce=ce.substr(0,ce.lastIndexOf(".")),$e.add(this.options.textNodeName,kt),this.addChild(R,$e,ce)}else{if(Me.length>0&&Me.lastIndexOf("/")===Me.length-1){he[he.length-1]==="/"?(he=he.substr(0,he.length-1),ce=ce.substr(0,ce.length-1),Me=he):Me=Me.substr(0,Me.length-1),this.options.transformTagName&&(he=this.options.transformTagName(he));const kt=new f(he);he!==Me&&lt&&(kt[":@"]=this.buildAttributesMap(Me,ce,he)),this.addChild(R,kt,ce),ce=ce.substr(0,ce.lastIndexOf("."))}else{const kt=new f(he);this.tagsNodeStack.push(R),he!==Me&&lt&&(kt[":@"]=this.buildAttributesMap(Me,ce,he)),this.addChild(R,kt,ce),R=kt}Z="",fe=Ze}}else Z+=U[fe];return J.child};function B(U,J,R){const Z=this.options.updateTag(J.tagname,R,J[":@"]);Z===!1||(typeof Z=="string"&&(J.tagname=Z),U.addChild(J))}const N=function(U){if(this.options.processEntities){for(let J in this.docTypeEntities){const R=this.docTypeEntities[J];U=U.replace(R.regx,R.val)}for(let J in this.lastEntities){const R=this.lastEntities[J];U=U.replace(R.regex,R.val)}if(this.options.htmlEntities)for(let J in this.htmlEntities){const R=this.htmlEntities[J];U=U.replace(R.regex,R.val)}U=U.replace(this.ampEntity.regex,this.ampEntity.val)}return U};function F(U,J,R,Z){return U&&(Z===void 0&&(Z=Object.keys(J.child).length===0),U=this.parseTextData(U,J.tagname,R,!1,J[":@"]?Object.keys(J[":@"]).length!==0:!1,Z),U!==void 0&&U!==""&&J.add(this.options.textNodeName,U),U=""),U}function W(U,J,R){const Z="*."+R;for(const ce in U){const fe=U[ce];if(Z===fe||J===fe)return!0}return!1}function ee(U,J,R=">"){let Z,ce="";for(let fe=J;fe<U.length;fe++){let ge=U[fe];if(Z)ge===Z&&(Z="");else if(ge==='"'||ge==="'")Z=ge;else if(ge===R[0])if(R[1]){if(U[fe+1]===R[1])return{data:ce,index:fe}}else return{data:ce,index:fe};else ge==="	"&&(ge=" ");ce+=ge}}function oe(U,J,R,Z){const ce=U.indexOf(J,R);if(ce===-1)throw new Error(Z);return ce+J.length-1}function $(U,J,R,Z=">"){const ce=ee(U,J+1,Z);if(!ce)return;let fe=ce.data;const ge=ce.index,ye=fe.search(/\s/);let he=fe,Fe=!0;ye!==-1&&(he=fe.substring(0,ye),fe=fe.substring(ye+1).trimStart());const Me=he;if(R){const lt=he.indexOf(":");lt!==-1&&(he=he.substr(lt+1),Fe=he!==ce.data.substr(lt+1))}return{tagName:he,tagExp:fe,closeIndex:ge,attrExpPresent:Fe,rawTagName:Me}}function re(U,J,R){const Z=R;let ce=1;for(;R<U.length;R++)if(U[R]==="<")if(U[R+1]==="/"){const fe=oe(U,">",R,`${J} is not closed`);if(U.substring(R+2,fe).trim()===J&&(ce--,ce===0))return{tagContent:U.substring(Z,R),i:fe};R=fe}else if(U[R+1]==="?")R=oe(U,"?>",R+1,"StopNode is not closed.");else if(U.substr(R+1,3)==="!--")R=oe(U,"-->",R+3,"StopNode is not closed.");else if(U.substr(R+1,2)==="![")R=oe(U,"]]>",R,"StopNode is not closed.")-2;else{const fe=$(U,R,">");fe&&((fe&&fe.tagName)===J&&fe.tagExp[fe.tagExp.length-1]!=="/"&&ce++,R=fe.closeIndex)}}function j(U,J,R){if(J&&typeof U=="string"){const Z=U.trim();return Z==="true"?!0:Z==="false"?!1:_(U,R)}else return d.isExist(U)?U:""}a.exports=S},{"../util":4,"./DocTypeReader":8,"./xmlNode":13,strnum:15}],11:[function(n,a,u){const{buildOptions:d}=n("./OptionsBuilder"),f=n("./OrderedObjParser"),{prettify:o}=n("./node2json"),_=n("../validator");class S{constructor(y){this.externalEntities={},this.options=d(y)}parse(y,k){if(typeof y!="string")if(y.toString)y=y.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(k){k===!0&&(k={});const L=_.validate(y,k);if(L!==!0)throw Error(`${L.err.msg}:${L.err.line}:${L.err.col}`)}const I=new f(this.options);I.addExternalEntities(this.externalEntities);const C=I.parseXml(y);return this.options.preserveOrder||C===void 0?C:o(C,this.options)}addEntity(y,k){if(k.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(y.indexOf("&")!==-1||y.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(k==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[y]=k}}a.exports=S},{"../validator":5,"./OptionsBuilder":9,"./OrderedObjParser":10,"./node2json":12}],12:[function(n,a,u){function d(T,y){return f(T,y)}function f(T,y,k){let I;const C={};for(let L=0;L<T.length;L++){const B=T[L],N=o(B);let F="";if(k===void 0?F=N:F=k+"."+N,N===y.textNodeName)I===void 0?I=B[N]:I+=""+B[N];else{if(N===void 0)continue;if(B[N]){let W=f(B[N],y,F);const ee=S(W,y);B[":@"]?_(W,B[":@"],F,y):Object.keys(W).length===1&&W[y.textNodeName]!==void 0&&!y.alwaysCreateTextNode?W=W[y.textNodeName]:Object.keys(W).length===0&&(y.alwaysCreateTextNode?W[y.textNodeName]="":W=""),C[N]!==void 0&&C.hasOwnProperty(N)?(Array.isArray(C[N])||(C[N]=[C[N]]),C[N].push(W)):y.isArray(N,F,ee)?C[N]=[W]:C[N]=W}}}return typeof I=="string"?I.length>0&&(C[y.textNodeName]=I):I!==void 0&&(C[y.textNodeName]=I),C}function o(T){const y=Object.keys(T);for(let k=0;k<y.length;k++){const I=y[k];if(I!==":@")return I}}function _(T,y,k,I){if(y){const C=Object.keys(y),L=C.length;for(let B=0;B<L;B++){const N=C[B];I.isArray(N,k+"."+N,!0,!0)?T[N]=[y[N]]:T[N]=y[N]}}}function S(T,y){const{textNodeName:k}=y,I=Object.keys(T).length;return!!(I===0||I===1&&(T[k]||typeof T[k]=="boolean"||T[k]===0))}u.prettify=d},{}],13:[function(n,a,u){class d{constructor(o){this.tagname=o,this.child=[],this[":@"]={}}add(o,_){o==="__proto__"&&(o="#__proto__"),this.child.push({[o]:_})}addChild(o){o.tagname==="__proto__"&&(o.tagname="#__proto__"),o[":@"]&&Object.keys(o[":@"]).length>0?this.child.push({[o.tagname]:o.child,":@":o[":@"]}):this.child.push({[o.tagname]:o.child})}}a.exports=d},{}],14:[function(n,a,u){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */u.read=function(d,f,o,_,S){var T,y,k=S*8-_-1,I=(1<<k)-1,C=I>>1,L=-7,B=o?S-1:0,N=o?-1:1,F=d[f+B];for(B+=N,T=F&(1<<-L)-1,F>>=-L,L+=k;L>0;T=T*256+d[f+B],B+=N,L-=8);for(y=T&(1<<-L)-1,T>>=-L,L+=_;L>0;y=y*256+d[f+B],B+=N,L-=8);if(T===0)T=1-C;else{if(T===I)return y?NaN:(F?-1:1)*(1/0);y=y+Math.pow(2,_),T=T-C}return(F?-1:1)*y*Math.pow(2,T-_)},u.write=function(d,f,o,_,S,T){var y,k,I,C=T*8-S-1,L=(1<<C)-1,B=L>>1,N=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=_?0:T-1,W=_?1:-1,ee=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===1/0?(k=isNaN(f)?1:0,y=L):(y=Math.floor(Math.log(f)/Math.LN2),f*(I=Math.pow(2,-y))<1&&(y--,I*=2),y+B>=1?f+=N/I:f+=N*Math.pow(2,1-B),f*I>=2&&(y++,I/=2),y+B>=L?(k=0,y=L):y+B>=1?(k=(f*I-1)*Math.pow(2,S),y=y+B):(k=f*Math.pow(2,B-1)*Math.pow(2,S),y=0));S>=8;d[o+F]=k&255,F+=W,k/=256,S-=8);for(y=y<<S|k,C+=S;C>0;d[o+F]=y&255,F+=W,y/=256,C-=8);d[o+F-W]|=ee*128}},{}],15:[function(n,a,u){const d=/^[-+]?0x[a-fA-F0-9]+$/,f=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const o={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function _(T,y={}){if(y=Object.assign({},o,y),!T||typeof T!="string")return T;let k=T.trim();if(y.skipLike!==void 0&&y.skipLike.test(k))return T;if(y.hex&&d.test(k))return Number.parseInt(k,16);{const I=f.exec(k);if(I){const C=I[1],L=I[2];let B=S(I[3]);const N=I[4]||I[6];if(!y.leadingZeros&&L.length>0&&C&&k[2]!==".")return T;if(!y.leadingZeros&&L.length>0&&!C&&k[1]!==".")return T;{const F=Number(k),W=""+F;return W.search(/[eE]/)!==-1||N?y.eNotation?F:T:k.indexOf(".")!==-1?W==="0"&&B===""||W===B||C&&W==="-"+B?F:T:L?B===W||C+B===W?F:T:k===W||k===C+W?F:T}}else return T}}function S(T){return T&&T.indexOf(".")!==-1&&(T=T.replace(/0+$/,""),T==="."?T="0":T[0]==="."?T="0"+T:T[T.length-1]==="."&&(T=T.substr(0,T.length-1))),T}a.exports=_},{}],16:[function(n,a,u){a.exports={name:"osm-api",version:"3.3.0",contributors:["Kyle Hensel (https://github.com/k-yle)"],description:" Javascript/Typescript wrapper around the OpenStreetMap API",main:"dist",unpkg:"dist/index.min.js",types:"dist/src/index.d.ts",license:"MIT",files:["dist"],keywords:["osm","openstreetmap","openstreetmap api"],repository:"https://github.com/osmlab/osm-api-js",scripts:{build:"rm -rf dist && tsc --emitDeclarationOnly && rm -rf dist/__tests__ && browserify -s OSM src/index.ts -p tsify > dist/index.js && uglifyjs dist/index.js > dist/index.min.js",lint:"eslint .",test:"vitest",trypublish:"npm publish --provenance || true"},engines:{node:">=18"},dependencies:{"@types/geojson":"^7946.0.13","fast-xml-parser":"^4.4.1"},devDependencies:{"@types/node":"^22.5.5",browserify:"^17.0.0",eslint:"^9.10.0","eslint-config-kyle":"^25.0.0-beta3",tsify:"^5.0.4",typescript:"^5.6.2","uglify-js":"^3.19.3",vitest:"^2.1.1"},prettier:{trailingComma:"es5"}}},{}],17:[function(n,a,u){(function(d){(function(){var f=this&&this.__awaiter||function(k,I,C,L){function B(N){return N instanceof C?N:new C(function(F){F(N)})}return new(C||(C=Promise))(function(N,F){function W($){try{oe(L.next($))}catch(re){F(re)}}function ee($){try{oe(L.throw($))}catch(re){F(re)}}function oe($){$.done?N($.value):B($.value).then(W,ee)}oe((L=L.apply(k,I||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.osmFetch=y;const o=n("../auth"),_=n("../config"),S=n("./_xml"),T=k=>typeof btoa>"u"?d.from(k,"binary").toString("base64"):btoa(k);function y(k,I,C){return f(this,void 0,void 0,function*(){const{apiUrl:L,authHeader:B,basicAuth:N,userAgent:F}=(0,_.getConfig)(),W=N&&`Basic ${T(`${N.username}:${N.password}`)}`,ee=(0,o.getAuthToken)()&&`Bearer ${(0,o.getAuthToken)()}`;let oe=new URLSearchParams(I).toString();oe&&(oe=`?${oe}`);const $=yield fetch(`${L}/api${k}${oe}`,Object.assign(Object.assign({},C),{headers:Object.assign({Authorization:B||W||ee||"","User-Agent":F},C==null?void 0:C.headers)})),re=$.headers.get("Content-Type");if(re!=null&&re.startsWith("application/xml")){const U=yield $.text();return yield S.xmlParser.parse(U)}if(re!=null&&re.startsWith("application/json"))return $.json();if($.ok)return yield $.text();const j=new Error(`OSM API: ${yield $.text()}`);throw j.cause=$.status,j})}}).call(this)}).call(this,n("buffer").Buffer)},{"../auth":58,"../config":60,"./_xml":18,buffer:2}],18:[function(n,a,u){Object.defineProperty(u,"__esModule",{value:!0}),u.xmlParser=void 0;const d=n("fast-xml-parser");u.xmlParser=new d.XMLParser({ignoreAttributes:!1,attributesGroupName:"$",attributeNamePrefix:"",isArray:f=>f!=="$"})},{"fast-xml-parser":3}],19:[function(n,a,u){Object.defineProperty(u,"__esModule",{value:!0}),u.createChangesetMetaXml=o,u.createOsmChangeXml=S;const d=n("fast-xml-parser"),f=new d.XMLBuilder({ignoreAttributes:!1,attributeNamePrefix:"$",format:!0,suppressEmptyNode:!0,suppressBooleanAttributes:!1});function o(T){return f.build({osm:{changeset:{tag:Object.entries(T).map(([y,k])=>({$k:y,$v:k}))}}})}const _=(T,y,k)=>{const I=["node","way","relation"];return k==="delete"&&I.reverse(),y.reduce((C,L)=>{const B={$id:L.id,$version:k==="create"?0:L.version,$changeset:T,tag:Object.entries(L.tags||{}).map(([N,F])=>({$k:N,$v:F}))};switch(L.type){case"node":{const N=Object.assign(Object.assign({},B),{$lat:L.lat,$lon:L.lon});return Object.assign(Object.assign({},C),{node:[...C.node,N]})}case"way":{if(!L.nodes)throw new Error("Way has no nodes");const N=Object.assign(Object.assign({},B),{nd:L.nodes.map(F=>({$ref:F}))});return Object.assign(Object.assign({},C),{way:[...C.way,N]})}case"relation":{if(!L.members)throw new Error("Relation has no members");const N=Object.assign(Object.assign({},B),{member:L.members.map(F=>({$type:F.type,$ref:F.ref,$role:F.role}))});return Object.assign(Object.assign({},C),{relation:[...C.relation,N]})}default:return C}},Object.fromEntries(I.map(C=>[C,[]])))};function S(T,y,k){return f.build({osmChange:{$version:"0.6",$generator:"osm-api-js",changeset:k?{tag:Object.entries(k).map(([I,C])=>({$k:I,$v:C}))}:void 0,create:[_(T,y.create,"create")],modify:[_(T,y.modify,"modify")],delete:[Object.assign({"$if-unused":!0},_(T,y.delete,"delete"))]}})}},{"fast-xml-parser":3}],20:[function(n,a,u){Object.defineProperty(u,"__esModule",{value:!0}),u.parseOsmChangeJson=S,u.parseOsmChangeXml=T;const d=n("../_xml");function f(y){if(y!=null&&y.tag)return Object.fromEntries(y.tag.map(k=>[k.$.k,k.$.v]))}function o(y){return{changeset:+y.$.changeset,id:+y.$.id,timestamp:y.$.timestamp,uid:+y.$.uid,user:y.$.user,version:+y.$.version,tags:f(y)}}const _=y=>{const k=[];if(y.node){const I=y.node.map(C=>Object.assign(Object.assign({type:"node"},o(C)),{lat:+C.$.lat,lon:+C.$.lon}));k.push(...I)}if(y.way){const I=y.way.map(C=>{var L;return Object.assign(Object.assign({type:"way"},o(C)),{nodes:((L=C.nd)===null||L===void 0?void 0:L.map(B=>+B.$.ref))||[]})});k.push(...I)}if(y.relation){const I=y.relation.map(C=>{var L;return Object.assign(Object.assign({type:"relation"},o(C)),{members:((L=C.member)===null||L===void 0?void 0:L.map(B=>({ref:+B.$.ref,role:B.$.role,type:B.$.type})))||[]})});k.push(...I)}return k};function S(y){var k,I,C,L;const B=f((k=y.osmChange[0].changeset)===null||k===void 0?void 0:k[0]),N={create:((I=y.osmChange[0].create)===null||I===void 0?void 0:I.flatMap(_))||[],modify:((C=y.osmChange[0].modify)===null||C===void 0?void 0:C.flatMap(_))||[],delete:((L=y.osmChange[0].delete)===null||L===void 0?void 0:L.flatMap(_))||[]};return B&&(N.changeset=B),N}function T(y){const k=d.xmlParser.parse(y);return S(k)}},{"../_xml":18}],21:[function(n,a,u){Object.defineProperty(u,"__esModule",{value:!0}),u.getOsmChangeSize=_,u.chunkOsmChange=S;const d=["create","modify","delete"],f=["create-node","create-way","create-relation","delete-relation","delete-way","delete-node","modify-node","modify-way","modify-relation"],o=()=>({create:[],modify:[],delete:[]});function _(T){return T.create.length+T.modify.length+T.delete.length}function S(T,y){var k;const I=(k=y==null?void 0:y.api.changesets.maximum_elements)!==null&&k!==void 0?k:S.DEFAULT_LIMIT;if(_(T)<=I)return[T];const C={};for(const F of d)for(const W of T[F]){const ee=`${F}-${W.type}`;C[ee]||(C[ee]=[]),C[ee].push(W)}const L=[o()];function B(){var F;for(const W of f){const ee=W.split("-")[0],oe=(F=C[W])===null||F===void 0?void 0:F.pop();if(oe)return{action:ee,feature:oe}}}let N;for(;N=B();){const F=L[0];F[N.action].push(N.feature),_(F)>=I&&L.unshift(o())}return L.reverse()}S.DEFAULT_LIMIT=1e4},{}],22:[function(n,a,u){var d=this&&this.__awaiter||function(S,T,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function B(W){try{F(k.next(W))}catch(ee){L(ee)}}function N(W){try{F(k.throw(W))}catch(ee){L(ee)}}function F(W){W.done?C(W.value):I(W.value).then(B,N)}F((k=k.apply(S,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.createChangesetComment=_;const f=n("../_osmFetch"),o=n("./getChangesets");function _(S,T,y){return d(this,void 0,void 0,function*(){const k=yield(0,f.osmFetch)(`/0.6/changeset/${S}/comment.json`,void 0,Object.assign(Object.assign({},y),{method:"POST",body:`text=${encodeURIComponent(T)}`,headers:Object.assign(Object.assign({},y==null?void 0:y.headers),{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"})}));return(0,o.mapRawChangeset)(k.changeset)})}},{"../_osmFetch":17,"./getChangesets":24}],23:[function(n,a,u){var d=this&&this.__awaiter||function(S,T,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function B(W){try{F(k.next(W))}catch(ee){L(ee)}}function N(W){try{F(k.throw(W))}catch(ee){L(ee)}}function F(W){W.done?C(W.value):I(W.value).then(B,N)}F((k=k.apply(S,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getChangesetDiff=_;const f=n("../_osmFetch"),o=n("./_parseOsmChangeXml");function _(S,T){return d(this,void 0,void 0,function*(){const y=yield(0,f.osmFetch)(`/0.6/changeset/${S}/download`,void 0,T);return(0,o.parseOsmChangeJson)(y)})}},{"../_osmFetch":17,"./_parseOsmChangeXml":20}],24:[function(n,a,u){var d=this&&this.__awaiter||function(y,k,I,C){function L(B){return B instanceof I?B:new I(function(N){N(B)})}return new(I||(I=Promise))(function(B,N){function F(oe){try{ee(C.next(oe))}catch($){N($)}}function W(oe){try{ee(C.throw(oe))}catch($){N($)}}function ee(oe){oe.done?B(oe.value):L(oe.value).then(F,W)}ee((C=C.apply(y,k||[])).next())})},f=this&&this.__rest||function(y,k){var I={};for(var C in y)Object.prototype.hasOwnProperty.call(y,C)&&k.indexOf(C)<0&&(I[C]=y[C]);if(y!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,C=Object.getOwnPropertySymbols(y);L<C.length;L++)k.indexOf(C[L])<0&&Object.prototype.propertyIsEnumerable.call(y,C[L])&&(I[C[L]]=y[C[L]]);return I};Object.defineProperty(u,"__esModule",{value:!0}),u.mapRawChangeset=void 0,u.listChangesets=S,u.getChangeset=T;const o=n("../_osmFetch"),_=y=>{var{comments:k}=y,I=f(y,["comments"]);return Object.assign(Object.assign({},I),{created_at:new Date(I.created_at),closed_at:I.closed_at?new Date(I.closed_at):void 0,discussion:k==null?void 0:k.map(C=>Object.assign(Object.assign({},C),{date:new Date(C.date),uid:`${C.uid}`}))})};u.mapRawChangeset=_;function S(y,k){return d(this,void 0,void 0,function*(){const{only:I}=y,C=f(y,["only"]);return(yield(0,o.osmFetch)("/0.6/changesets.json",Object.assign(Object.assign({},I&&{[I]:!0}),C),k)).changesets.map(u.mapRawChangeset)})}function T(y){return d(this,arguments,void 0,function*(k,I=!0,C){const L=yield(0,o.osmFetch)(`/0.6/changeset/${k}.json`,I?{include_discussion:1}:{},C);return(0,u.mapRawChangeset)(L.changeset)})}},{"../_osmFetch":17}],25:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(S,T,y,k){k===void 0&&(k=y);var I=Object.getOwnPropertyDescriptor(T,y);(!I||("get"in I?!T.__esModule:I.writable||I.configurable))&&(I={enumerable:!0,get:function(){return T[y]}}),Object.defineProperty(S,k,I)}:function(S,T,y,k){k===void 0&&(k=y),S[k]=T[y]}),f=this&&this.__exportStar||function(S,T){for(var y in S)y!=="default"&&!Object.prototype.hasOwnProperty.call(T,y)&&d(T,S,y)};Object.defineProperty(u,"__esModule",{value:!0}),u.createOsmChangeXml=u.parseOsmChangeXml=void 0,f(n("./chunkOsmChange"),u),f(n("./createChangesetComment"),u),f(n("./getChangesetDiff"),u),f(n("./getChangesets"),u),f(n("./subscription"),u),f(n("./uploadChangeset"),u);var o=n("./_parseOsmChangeXml");Object.defineProperty(u,"parseOsmChangeXml",{enumerable:!0,get:function(){return o.parseOsmChangeXml}});var _=n("./_createOsmChangeXml");Object.defineProperty(u,"createOsmChangeXml",{enumerable:!0,get:function(){return _.createOsmChangeXml}})},{"./_createOsmChangeXml":19,"./_parseOsmChangeXml":20,"./chunkOsmChange":21,"./createChangesetComment":22,"./getChangesetDiff":23,"./getChangesets":24,"./subscription":26,"./uploadChangeset":27}],26:[function(n,a,u){var d=this&&this.__awaiter||function(S,T,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function B(W){try{F(k.next(W))}catch(ee){L(ee)}}function N(W){try{F(k.throw(W))}catch(ee){L(ee)}}function F(W){W.done?C(W.value):I(W.value).then(B,N)}F((k=k.apply(S,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.subscribeToChangeset=o,u.unsubscribeFromChangeset=_;const f=n("../_osmFetch");function o(S,T){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/changeset/${S}/subscribe`,{},Object.assign(Object.assign({},T),{method:"POST"}))})}function _(S,T){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/changeset/${S}/unsubscribe`,{},Object.assign(Object.assign({},T),{method:"POST"}))})}},{"../_osmFetch":17}],27:[function(n,a,u){var d=this&&this.__awaiter||function(I,C,L,B){function N(F){return F instanceof L?F:new L(function(W){W(F)})}return new(L||(L=Promise))(function(F,W){function ee(re){try{$(B.next(re))}catch(j){W(j)}}function oe(re){try{$(B.throw(re))}catch(j){W(j)}}function $(re){re.done?F(re.value):N(re.value).then(ee,oe)}$((B=B.apply(I,C||[])).next())})},f=this&&this.__rest||function(I,C){var L={};for(var B in I)Object.prototype.hasOwnProperty.call(I,B)&&C.indexOf(B)<0&&(L[B]=I[B]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,B=Object.getOwnPropertySymbols(I);N<B.length;N++)C.indexOf(B[N])<0&&Object.prototype.propertyIsEnumerable.call(I,B[N])&&(L[B[N]]=I[B[N]]);return L};Object.defineProperty(u,"__esModule",{value:!0}),u.compress=y,u.uploadChangeset=k;const o=n("../_osmFetch"),_=n("../../../package.json"),S=n("./_createOsmChangeXml"),T=n("./chunkOsmChange");function y(I){if(!globalThis.CompressionStream)return;const C=new Response(I).body.pipeThrough(new CompressionStream("gzip"));return new Response(C).blob()}function k(I,C,L){return d(this,void 0,void 0,function*(){const B=L||{},{onChunk:N,onProgress:F,disableCompression:W}=B,ee=f(B,["onChunk","onProgress","disableCompression"]),oe=(0,T.chunkOsmChange)(C),$=[],re=(0,T.getOsmChangeSize)(C);for(const[j,U]of oe.entries()){let J=I;oe.length>1&&(N?J=N({featureCount:re,changesetIndex:j,changesetTotal:oe.length}):J.chunk=`${j+1}/${oe.length}`),J.created_by||(J.created_by=`osm-api-js ${_.version}`),F==null||F({phase:"upload",step:j+1,total:oe.length});const R=+(yield(0,o.osmFetch)("/0.6/changeset/create",void 0,Object.assign(Object.assign({},ee),{method:"PUT",body:(0,S.createChangesetMetaXml)(J),headers:Object.assign(Object.assign({},ee.headers),{"content-type":"application/xml; charset=utf-8"})}))),Z=(0,S.createOsmChangeXml)(R,U),ce=!W&&(yield y(Z));yield(0,o.osmFetch)(`/0.6/changeset/${R}/upload`,void 0,Object.assign(Object.assign({},ee),{method:"POST",body:ce||Z,headers:Object.assign(Object.assign(Object.assign({},ee.headers),ce&&{"Content-Encoding":"gzip"}),{"content-type":"application/xml; charset=utf-8"})})),yield(0,o.osmFetch)(`/0.6/changeset/${R}/close`,void 0,Object.assign(Object.assign({},ee),{method:"PUT"})),$.push(R)}return $[0]})}},{"../../../package.json":16,"../_osmFetch":17,"./_createOsmChangeXml":19,"./chunkOsmChange":21}],28:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.createUserBlock=o;const f=n("../_osmFetch");function o(_,S){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/user_blocks.json",_,Object.assign(Object.assign({},S),{method:"POST"}))).user_block})}},{"../_osmFetch":17}],29:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getUserBlock=o;const f=n("../_osmFetch");function o(_,S){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user_blocks/${_}.json`,{},S)).user_block})}},{"../_osmFetch":17}],30:[function(n,a,u){var d=this&&this.__awaiter||function(S,T,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function B(W){try{F(k.next(W))}catch(ee){L(ee)}}function N(W){try{F(k.throw(W))}catch(ee){L(ee)}}function F(W){W.done?C(W.value):I(W.value).then(B,N)}F((k=k.apply(S,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.hideChangesetComment=_;const f=n("../_osmFetch"),o=n("../changesets");function _(S,T,y){return d(this,void 0,void 0,function*(){const k=yield(0,f.osmFetch)(`/0.6/changeset_comments/${S}/visibility.json`,{},Object.assign(Object.assign({},y),{method:T==="unhide"?"POST":"DELETE"}));return(0,o.mapRawChangeset)(k.changeset)})}},{"../_osmFetch":17,"../changesets":25}],31:[function(n,a,u){var d=this&&this.__awaiter||function(S,T,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function B(W){try{F(k.next(W))}catch(ee){L(ee)}}function N(W){try{F(k.throw(W))}catch(ee){L(ee)}}function F(W){W.done?C(W.value):I(W.value).then(B,N)}F((k=k.apply(S,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.hideNote=_;const f=n("../_osmFetch"),o=n("../notes");function _(S,T,y){return d(this,void 0,void 0,function*(){const k=yield(0,f.osmFetch)(`/0.6/notes/${S}.json`,T?{text:T}:{},Object.assign(Object.assign({},y),{method:"DELETE"}));return(0,o.featureToNote)(k)})}},{"../_osmFetch":17,"../notes":48}],32:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(o,_,S,T){T===void 0&&(T=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(o,T,y)}:function(o,_,S,T){T===void 0&&(T=S),o[T]=_[S]}),f=this&&this.__exportStar||function(o,_){for(var S in o)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,o,S)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./createUserBlock"),u),f(n("./getUserBlock"),u),f(n("./hideChangesetComment"),u),f(n("./hideNote"),u),f(n("./redactFeature"),u)},{"./createUserBlock":28,"./getUserBlock":29,"./hideChangesetComment":30,"./hideNote":31,"./redactFeature":33}],33:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.redactFeature=o;const f=n("../_osmFetch");function o(_,S){return d(this,arguments,void 0,function*({featureType:T,featureId:y,featureVersion:k,redactionId:I},C){yield(0,f.osmFetch)(`/0.6/${T}/${y}/${k}/redact`,I?{redaction:I}:{},Object.assign(Object.assign({},C),{method:"POST"}))})}},{"../_osmFetch":17}],34:[function(n,a,u){var d=this&&this.__awaiter||function(S,T,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function B(W){try{F(k.next(W))}catch(ee){L(ee)}}function N(W){try{F(k.throw(W))}catch(ee){L(ee)}}function F(W){W.done?C(W.value):I(W.value).then(B,N)}F((k=k.apply(S,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getApiCapabilities=o,u.getCapabilities=_;const f=n("./_osmFetch");function o(S){return d(this,void 0,void 0,function*(){return(0,f.osmFetch)("/capabilities.json",void 0,S)})}function _(){return d(this,void 0,void 0,function*(){const S=yield o();return{limits:{maxArea:S.api.area.maximum,maxNoteArea:S.api.note_area.maximum,maxTracepointPerPage:S.api.tracepoints.per_page,maxWayNodes:S.api.waynodes.maximum,maxChangesetElements:S.api.changesets.maximum_elements,maxTimeout:S.api.timeout.seconds},policy:{imageryBlacklist:S.policy.imagery.blacklist.map(y=>y.regex)}}})}},{"./_osmFetch":17}],35:[function(n,a,u){var d=this&&this.__awaiter||function(I,C,L,B){function N(F){return F instanceof L?F:new L(function(W){W(F)})}return new(L||(L=Promise))(function(F,W){function ee(re){try{$(B.next(re))}catch(j){W(j)}}function oe(re){try{$(B.throw(re))}catch(j){W(j)}}function $(re){re.done?F(re.value):N(re.value).then(ee,oe)}$((B=B.apply(I,C||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getFeature=o,u.getFeatures=_,u.getFeatureAtVersion=S,u.getFeatureHistory=T,u.getWaysForNode=y,u.getRelationsForElement=k;const f=n("./_osmFetch");function o(I,C,L,B){return d(this,void 0,void 0,function*(){const N=L&&I!=="node"?"/full":"";return(yield(0,f.osmFetch)(`/0.6/${I}/${C}${N}.json`,void 0,B)).elements})}function _(I,C,L){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/${I}s.json?${I}s=${C.join(",")}`,void 0,L)).elements})}function S(I,C,L,B){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/${I}/${C}/${L}.json`,void 0,B)).elements[0]})}function T(I,C,L){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/${I}/${C}/history.json`,void 0,L)).elements})}function y(I,C){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/node/${I}/ways.json`,void 0,C)).elements})}function k(I,C,L){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/${I}/${C}/relations.json`,void 0,L)).elements})}},{"./_osmFetch":17}],36:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getMapData=o;const f=n("./_osmFetch");function o(_,S){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/map.json",{bbox:_},S)).elements})}},{"./_osmFetch":17}],37:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getPermissions=o;const f=n("./_osmFetch");function o(_){return d(this,void 0,void 0,function*(){return(0,f.osmFetch)("/0.6/permissions.json",void 0,_)})}},{"./_osmFetch":17}],38:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getUIdFromDisplayName=o;const f=n("./changesets");function o(_){return d(this,void 0,void 0,function*(){const S=yield(0,f.listChangesets)({display_name:_});if(!S.length)throw new Error("Could not get uid because the user has never edited the map");return S[0].uid})}},{"./changesets":25}],39:[function(n,a,u){var d=this&&this.__awaiter||function(y,k,I,C){function L(B){return B instanceof I?B:new I(function(N){N(B)})}return new(I||(I=Promise))(function(B,N){function F(oe){try{ee(C.next(oe))}catch($){N($)}}function W(oe){try{ee(C.throw(oe))}catch($){N($)}}function ee(oe){oe.done?B(oe.value):L(oe.value).then(F,W)}ee((C=C.apply(y,k||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getUser=o,u.getUsers=_,u.getUserBlockById=S,u.getOwnUserBlocks=T;const f=n("./_osmFetch");function o(y,k){return d(this,void 0,void 0,function*(){const I=yield(0,f.osmFetch)(`/0.6/user/${y==="me"?"details":y}.json`,void 0,k);return Object.assign(Object.assign({},I.user),{account_created:new Date(I.user.account_created)})})}function _(y,k){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/users",{users:y},k)).users.map(C=>Object.assign(Object.assign({},C),{account_created:new Date(C.account_created)}))})}function S(y,k){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user_blocks/${y}.json`,void 0,k)).user_block})}function T(y){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/user/blocks/active",void 0,y)).user_blocks})}},{"./_osmFetch":17}],40:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(o,_,S,T){T===void 0&&(T=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(o,T,y)}:function(o,_,S,T){T===void 0&&(T=S),o[T]=_[S]}),f=this&&this.__exportStar||function(o,_){for(var S in o)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,o,S)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./changesets"),u),f(n("./dwg"),u),f(n("./messages"),u),f(n("./notes"),u),f(n("./preferences"),u),f(n("./getCapabilities"),u),f(n("./getFeature"),u),f(n("./getMapData"),u),f(n("./getPermissions"),u),f(n("./getUIdFromDisplayName"),u),f(n("./getUser"),u)},{"./changesets":25,"./dwg":32,"./getCapabilities":34,"./getFeature":35,"./getMapData":36,"./getPermissions":37,"./getUIdFromDisplayName":38,"./getUser":39,"./messages":43,"./notes":48,"./preferences":53}],41:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.deleteMessage=o;const f=n("../_osmFetch");function o(_,S){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user/messages/${_}.json`,{},Object.assign(Object.assign({},S),{method:"DELETE"}))).message})}},{"../_osmFetch":17}],42:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getMessage=o;const f=n("../_osmFetch");function o(_,S){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user/messages/${_}.json`,void 0,S)).message})}},{"../_osmFetch":17}],43:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(o,_,S,T){T===void 0&&(T=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(o,T,y)}:function(o,_,S,T){T===void 0&&(T=S),o[T]=_[S]}),f=this&&this.__exportStar||function(o,_){for(var S in o)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,o,S)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./deleteMessage"),u),f(n("./getMessage"),u),f(n("./listMessages"),u),f(n("./sendMessage"),u),f(n("./updateMessageReadStatus"),u)},{"./deleteMessage":41,"./getMessage":42,"./listMessages":44,"./sendMessage":45,"./updateMessageReadStatus":46}],44:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.listMessages=o;const f=n("../_osmFetch");function o(_,S){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user/messages/${_}.json`,void 0,S)).messages})}},{"../_osmFetch":17}],45:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.sendMessage=o;const f=n("../_osmFetch");function o(_,S){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/user/messages.json",_,Object.assign(Object.assign({},S),{method:"POST"}))).message})}},{"../_osmFetch":17}],46:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.updateMessageReadStatus=o;const f=n("../_osmFetch");function o(_,S,T){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/user/messages/${_}.json`,{read_status:S},Object.assign(Object.assign({},T),{method:"POST"}))).message})}},{"../_osmFetch":17}],47:[function(n,a,u){var d=this&&this.__awaiter||function(k,I,C,L){function B(N){return N instanceof C?N:new C(function(F){F(N)})}return new(C||(C=Promise))(function(N,F){function W($){try{oe(L.next($))}catch(re){F(re)}}function ee($){try{oe(L.throw($))}catch(re){F(re)}}function oe($){$.done?N($.value):B($.value).then(W,ee)}oe((L=L.apply(k,I||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.featureToNote=void 0,u.getNotesForQuery=S,u.getNotesForArea=T,u.getNote=y;const f=n("../_osmFetch"),o=k=>{const[I,C]=k.geometry.coordinates;return Object.assign(Object.assign({},k.properties),{location:{lat:C,lng:I}})};u.featureToNote=o;function _(k,I,C){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)(`/0.6/notes${I?"/search":""}.json`,k,C)).features.map(u.featureToNote)})}function S(k,I){return _(k,!0,I)}function T(k,I){return _({bbox:k},!1,I)}function y(k,I){return d(this,void 0,void 0,function*(){const C=yield(0,f.osmFetch)(`/0.6/notes/${k}.json`,void 0,I);return(0,u.featureToNote)(C)})}},{"../_osmFetch":17}],48:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(o,_,S,T){T===void 0&&(T=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(o,T,y)}:function(o,_,S,T){T===void 0&&(T=S),o[T]=_[S]}),f=this&&this.__exportStar||function(o,_){for(var S in o)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,o,S)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./getNotes"),u),f(n("./noteActions"),u),f(n("./subscription"),u)},{"./getNotes":47,"./noteActions":49,"./subscription":50}],49:[function(n,a,u){var d=this&&this.__awaiter||function(k,I,C,L){function B(N){return N instanceof C?N:new C(function(F){F(N)})}return new(C||(C=Promise))(function(N,F){function W($){try{oe(L.next($))}catch(re){F(re)}}function ee($){try{oe(L.throw($))}catch(re){F(re)}}function oe($){$.done?N($.value):B($.value).then(W,ee)}oe((L=L.apply(k,I||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.createNote=_,u.commentOnNote=S,u.closeNote=T,u.reopenNote=y;const f=n("../_osmFetch"),o=n("./getNotes");function _(k,I,C,L){return d(this,void 0,void 0,function*(){const B=yield(0,f.osmFetch)("/0.6/notes.json",{lat:k,lon:I,text:C},Object.assign(Object.assign({},L),{method:"POST"}));return(0,o.featureToNote)(B)})}function S(k,I,C){return d(this,void 0,void 0,function*(){const L=yield(0,f.osmFetch)(`/0.6/notes/${k}/comment.json`,I?{text:I}:{},Object.assign(Object.assign({},C),{method:"POST"}));return(0,o.featureToNote)(L)})}function T(k,I,C){return d(this,void 0,void 0,function*(){const L=yield(0,f.osmFetch)(`/0.6/notes/${k}/close.json`,I?{text:I}:{},Object.assign(Object.assign({},C),{method:"POST"}));return(0,o.featureToNote)(L)})}function y(k,I,C){return d(this,void 0,void 0,function*(){const L=yield(0,f.osmFetch)(`/0.6/notes/${k}/reopen.json`,I?{text:I}:{},Object.assign(Object.assign({},C),{method:"POST"}));return(0,o.featureToNote)(L)})}},{"../_osmFetch":17,"./getNotes":47}],50:[function(n,a,u){var d=this&&this.__awaiter||function(S,T,y,k){function I(C){return C instanceof y?C:new y(function(L){L(C)})}return new(y||(y=Promise))(function(C,L){function B(W){try{F(k.next(W))}catch(ee){L(ee)}}function N(W){try{F(k.throw(W))}catch(ee){L(ee)}}function F(W){W.done?C(W.value):I(W.value).then(B,N)}F((k=k.apply(S,T||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.subscribeToNote=o,u.unsubscribeFromNote=_;const f=n("../_osmFetch");function o(S,T){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/notes/${S}/subscription`,{},Object.assign(Object.assign({},T),{method:"POST"}))})}function _(S,T){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/notes/${S}/subscription`,{},Object.assign(Object.assign({},T),{method:"DELETE"}))})}},{"../_osmFetch":17}],51:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.deletePreferences=o;const f=n("../_osmFetch");function o(_,S){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/user/preferences/${_}.json`,{},Object.assign(Object.assign({},S),{method:"DELETE"}))})}},{"../_osmFetch":17}],52:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.getPreferences=o;const f=n("../_osmFetch");function o(_){return d(this,void 0,void 0,function*(){return(yield(0,f.osmFetch)("/0.6/user/preferences.json",void 0,_)).preferences})}},{"../_osmFetch":17}],53:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(o,_,S,T){T===void 0&&(T=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(o,T,y)}:function(o,_,S,T){T===void 0&&(T=S),o[T]=_[S]}),f=this&&this.__exportStar||function(o,_){for(var S in o)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,o,S)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./deletePreferences"),u),f(n("./getPreferences"),u),f(n("./updatePreferences"),u)},{"./deletePreferences":51,"./getPreferences":52,"./updatePreferences":54}],54:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.updatePreferences=o;const f=n("../_osmFetch");function o(_,S,T){return d(this,void 0,void 0,function*(){yield(0,f.osmFetch)(`/0.6/user/preferences/${_}.json`,{},Object.assign(Object.assign({},T),{method:"PUT",body:S}))})}},{"../_osmFetch":17}],55:[function(n,a,u){Object.defineProperty(u,"__esModule",{value:!0}),u.createPopup=f;const d="osm-api-auth-complete";function f(o){let _=!1;return new Promise(S=>{const[T,y]=[600,550],k=Object.entries({width:T,height:y,left:window.screen.width/2-T/2,top:window.screen.height/2-y/2}).map(([B,N])=>`${B}=${N}`).join(","),I=window.open("about:blank","oauth_window",k);if(!I)throw new Error("Popup was blocked");I.location=o;const C=new BroadcastChannel(d),L=B=>{_||(S(B.data),_=!0,C.removeEventListener("message",L),C.close())};C.addEventListener("message",L)})}},{}],56:[function(n,a,u){var d=this&&this.__awaiter||function(_,S,T,y){function k(I){return I instanceof T?I:new T(function(C){C(I)})}return new(T||(T=Promise))(function(I,C){function L(F){try{N(y.next(F))}catch(W){C(W)}}function B(F){try{N(y.throw(F))}catch(W){C(W)}}function N(F){F.done?I(F.value):k(F.value).then(L,B)}N((y=y.apply(_,S||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.exchangeCode=o;const f=n("./helpers");function o(_,S){return d(this,arguments,void 0,function*(T,{options:y,pkceVerifier:k,state:I}){const C=new URL(T).searchParams,L=C.get("error_description"),B=C.get("code"),N=C.get("state");if(L)throw new Error(L);if(!B)throw new Error("No code in OAuth response");if(!k||!I)throw new Error("No login in progress");if(I!==N)throw new Error("State Mismatch");const F={grant_type:"authorization_code",code:B,redirect_uri:y.redirectUrl,client_id:y.clientId,code_verifier:k},W=`${(0,f.getOAuthBaseUrl)()}/oauth2/token?${new URLSearchParams(F).toString()}`,oe=yield(yield fetch(W,{method:"POST",body:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json();if("error_description"in oe)throw new Error(oe.error_description);const $={issuedAt:new Date(oe.created_at*1e3).toISOString(),accessToken:oe.access_token,scopes:oe.scope.split(" ")};return localStorage.setItem("__osmAuth",JSON.stringify($)),$})}},{"./helpers":57}],57:[function(n,a,u){var d=this&&this.__awaiter||function(T,y,k,I){function C(L){return L instanceof k?L:new k(function(B){B(L)})}return new(k||(k=Promise))(function(L,B){function N(ee){try{W(I.next(ee))}catch(oe){B(oe)}}function F(ee){try{W(I.throw(ee))}catch(oe){B(oe)}}function W(ee){ee.done?L(ee.value):C(ee.value).then(N,F)}W((I=I.apply(T,y||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.sha256=o,u.getRandomString=_,u.getOAuthBaseUrl=S;const f=n("../config");function o(T){return d(this,void 0,void 0,function*(){const y=new TextEncoder().encode(T),k=yield window.crypto.subtle.digest("SHA-256",y);return btoa(String.fromCharCode(...new Uint8Array(k))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")})}function _(){return[...window.crypto.getRandomValues(new Uint32Array(32))].map(T=>`0${T.toString(16)}`.slice(-2)).join("")}function S(){let T=(0,f.getConfig)().apiUrl;return T==="https://api.openstreetmap.org"&&(T="https://www.openstreetmap.org"),T}},{"../config":60}],58:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(o,_,S,T){T===void 0&&(T=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(o,T,y)}:function(o,_,S,T){T===void 0&&(T=S),o[T]=_[S]}),f=this&&this.__exportStar||function(o,_){for(var S in o)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,o,S)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./oauth2"),u)},{"./oauth2":59}],59:[function(n,a,u){var d=this&&this.__awaiter||function(I,C,L,B){function N(F){return F instanceof L?F:new L(function(W){W(F)})}return new(L||(L=Promise))(function(F,W){function ee(re){try{$(B.next(re))}catch(j){W(j)}}function oe(re){try{$(B.throw(re))}catch(j){W(j)}}function $(re){re.done?F(re.value):N(re.value).then(ee,oe)}$((B=B.apply(I,C||[])).next())})};Object.defineProperty(u,"__esModule",{value:!0}),u.isLoggedIn=u.getAuthToken=u.authReady=void 0,u.login=S,u.logout=k;const f=n("./createPopup"),o=n("./exchangeCode"),_=n("./helpers");function S(I){return d(this,void 0,void 0,function*(){if(!I.redirectUrl)throw new Error("You must include the 'redirectUrl' option");if(!I.clientId)throw new Error("You must include the 'clientId' option");if(!I.scopes)throw new Error("You must include the 'scopes' option");const C=(0,_.getRandomString)(),L=(0,_.getRandomString)(),B=yield(0,_.sha256)(L),N={scope:I.scopes.join(" "),include_granted_scopes:"true",response_type:"code",state:C,redirect_uri:I.redirectUrl,client_id:I.clientId,code_challenge_method:"S256",code_challenge:B},F=`/oauth2/authorize?${new URLSearchParams(N).toString()}`,W=I.switchUser?`/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(F)}`)}`:F,ee=(0,_.getOAuthBaseUrl)()+W,oe={state:C,pkceVerifier:L,options:I};if(I.mode==="popup"){const $=yield(0,f.createPopup)(ee);return(0,o.exchangeCode)($,oe)}if(I.mode==="redirect"){localStorage.setItem("__osmAuthTemp",JSON.stringify(oe)),window.location.replace(ee);return}throw new Error("options.mode must be 'popup' or 'redirect'")})}u.authReady=d(void 0,void 0,void 0,function*(){if(typeof window>"u")return;const I=window.location.href,C=localStorage.getItem("__osmAuthTemp");if(new URL(I).searchParams.get("code")&&C)try{const L=JSON.parse(C);yield(0,o.exchangeCode)(I,L),localStorage.removeItem("__osmAuthTemp")}catch(L){console.error("OSM Auth Error",L)}});const T=()=>{try{const I=localStorage.getItem("__osmAuth");return I?JSON.parse(I).accessToken:void 0}catch{return}};u.getAuthToken=T;const y=()=>!!(0,u.getAuthToken)();u.isLoggedIn=y;function k(){localStorage.removeItem("__osmAuth")}},{"./createPopup":55,"./exchangeCode":56,"./helpers":57}],60:[function(n,a,u){Object.defineProperty(u,"__esModule",{value:!0}),u.getConfig=void 0,u.configure=o;const d={apiUrl:"https://api.openstreetmap.org",userAgent:"https://github.com/osmlab/osm-api-js"},f=()=>d;u.getConfig=f;function o(_){Object.assign(d,_)}},{}],61:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(o,_,S,T){T===void 0&&(T=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(o,T,y)}:function(o,_,S,T){T===void 0&&(T=S),o[T]=_[S]}),f=this&&this.__exportStar||function(o,_){for(var S in o)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,o,S)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./api"),u),f(n("./auth"),u),f(n("./config"),u),f(n("./types"),u)},{"./api":40,"./auth":58,"./config":60,"./types":65}],62:[function(n,a,u){Object.defineProperty(u,"__esModule",{value:!0})},{}],63:[function(n,a,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],64:[function(n,a,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],65:[function(n,a,u){var d=this&&this.__createBinding||(Object.create?function(o,_,S,T){T===void 0&&(T=S);var y=Object.getOwnPropertyDescriptor(_,S);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[S]}}),Object.defineProperty(o,T,y)}:function(o,_,S,T){T===void 0&&(T=S),o[T]=_[S]}),f=this&&this.__exportStar||function(o,_){for(var S in o)S!=="default"&&!Object.prototype.hasOwnProperty.call(_,S)&&d(_,o,S)};Object.defineProperty(u,"__esModule",{value:!0}),f(n("./changesets"),u),f(n("./features"),u),f(n("./general"),u),f(n("./messages"),u),f(n("./notes"),u),f(n("./osmPatch"),u),f(n("./user"),u)},{"./changesets":62,"./features":63,"./general":64,"./messages":66,"./notes":67,"./osmPatch":68,"./user":69}],66:[function(n,a,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],67:[function(n,a,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],68:[function(n,a,u){arguments[4][62][0].apply(u,arguments)},{dup:62}],69:[function(n,a,u){arguments[4][62][0].apply(u,arguments)},{dup:62}]},{},[61])(61)})})(db);var Qu=db.exports;const{window:MC}=Qy;function PC(r){let i,n=r[0].length+"",a,u,d=r[0].length==1?"edit":"edits",f;return{c(){i=ke("div"),a=Tt(n),u=Qe(),f=Tt(d),_e(i,"slot","header")},m(o,_){xe(o,i,_),be(i,a),be(i,u),be(i,f)},p(o,_){_&1&&n!==(n=o[0].length+"")&&Ai(a,n),_&1&&d!==(d=o[0].length==1?"edit":"edits")&&Ai(f,d)},d(o){o&&we(i)}}}function oy(r){let i,n,a,u,d,f=r[0].length+"",o,_,S,T,y,k,I,C,L,B,N,F,W,ee,oe,$=r[1]+1+"",re,j,U=r[0].length+"",J,R,Z,ce,fe,ge,ye,he=JSON.stringify(r[0][r[1]])+"",Fe,Me,lt;return{c(){i=ke("div"),n=ke("button"),n.textContent="Clear edits",a=Qe(),u=ke("button"),d=Tt("Undo ("),o=Tt(f),_=Tt(")"),T=Qe(),y=ke("div"),k=ke("button"),k.textContent="Download .osc",I=Qe(),C=ke("button"),C.textContent="Upload changeset",L=Qe(),B=ke("div"),N=ke("button"),F=Tt("Previous"),ee=Qe(),oe=ke("span"),re=Tt($),j=Tt(" / "),J=Tt(U),R=Qe(),Z=ke("button"),ce=Tt("Next"),ge=Qe(),ye=ke("p"),Fe=Tt(he),_e(n,"class","btn btn-danger"),_e(u,"class","btn btn-danger"),u.disabled=S=r[0].length==0,_e(i,"class","mb-1"),_e(k,"class","btn btn-secondary"),_e(C,"class","btn btn-secondary"),_e(y,"class","mb-1"),_e(N,"class","btn btn-secondary"),N.disabled=W=r[1]==0,_e(Z,"class","btn btn-secondary"),Z.disabled=fe=r[1]==r[0].length-1,en(B,"display","flex"),en(B,"justify-content","space-between")},m(Ze,ht){xe(Ze,i,ht),be(i,n),be(i,a),be(i,u),be(u,d),be(u,o),be(u,_),xe(Ze,T,ht),xe(Ze,y,ht),be(y,k),be(y,I),be(y,C),xe(Ze,L,ht),xe(Ze,B,ht),be(B,N),be(N,F),be(B,ee),be(B,oe),be(oe,re),be(oe,j),be(oe,J),be(B,R),be(B,Z),be(Z,ce),xe(Ze,ge,ht),xe(Ze,ye,ht),be(ye,Fe),Me||(lt=[Wt(n,"click",r[5]),Wt(u,"click",r[6]),Wt(k,"click",r[7]),Wt(C,"click",r[8]),Wt(N,"click",r[3]),Wt(Z,"click",r[4])],Me=!0)},p(Ze,ht){ht&1&&f!==(f=Ze[0].length+"")&&Ai(o,f),ht&1&&S!==(S=Ze[0].length==0)&&(u.disabled=S),ht&2&&W!==(W=Ze[1]==0)&&(N.disabled=W),ht&2&&$!==($=Ze[1]+1+"")&&Ai(re,$),ht&1&&U!==(U=Ze[0].length+"")&&Ai(J,U),ht&3&&fe!==(fe=Ze[1]==Ze[0].length-1)&&(Z.disabled=fe),ht&3&&he!==(he=JSON.stringify(Ze[0][Ze[1]])+"")&&Ai(Fe,he)},d(Ze){Ze&&(we(i),we(T),we(y),we(L),we(B),we(ge),we(ye)),Me=!1,ir(lt)}}}function LC(r){let i,n=r[0].length>0&&oy(r);return{c(){i=ke("div"),n&&n.c(),_e(i,"slot","body")},m(a,u){xe(a,i,u),n&&n.m(i,null)},p(a,u){a[0].length>0?n?n.p(a,u):(n=oy(a),n.c(),n.m(i,null)):n&&(n.d(1),n=null)},d(a){a&&we(i),n&&n.d()}}}function zC(r){let i,n,a,u,d,f;return i=new eu({props:{loading:r[2]}}),a=new Sf({props:{$$slots:{body:[LC],header:[PC]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment)},m(o,_){gt(i,o,_),xe(o,n,_),gt(a,o,_),u=!0,d||(f=Wt(MC,"keydown",r[9]),d=!0)},p(o,[_]){const S={};_&4&&(S.loading=o[2]),i.$set(S);const T={};_&16387&&(T.$$scope={dirty:_,ctx:o}),a.$set(T)},i(o){u||(Re(i.$$.fragment,o),Re(a.$$.fragment,o),u=!0)},o(o){Ve(i.$$.fragment,o),Ve(a.$$.fragment,o),u=!1},d(o){o&&we(n),_t(i,o),_t(a,o),d=!1,f()}}}function OC(r,i,n){let a,u,d;Gt(r,hr,N=>n(11,a=N)),Gt(r,rh,N=>n(13,u=N)),Gt(r,ho,N=>n(12,d=N));let{anyEdits:f}=i,o=[],_=0,S="";function T(){n(1,_--,_)}function y(){n(1,_++,_)}async function k(){if(window.confirm("Do you really want to clear your edits?")){n(2,S="Clearing edits"),await Ro();try{a.editClear(),dn(ho,d++,d)}finally{n(2,S="")}}}async function I(){n(2,S="Undoing last edit"),await Ro();try{a.editUndo(),dn(ho,d++,d)}finally{n(2,S="")}}function C(){ub("changes.osc",a.toOsc())}async function L(){if(!u){window.alert("You have to log in first");return}if(o.some(F=>!("SetTags"in F))){window.alert("You've done a bulk operation. You should NOT upload this to OSM -- it's only for testing or usage in you own tool that consumes OSM data.");return}if(!window.confirm("Do you really know what you're doing and want to upload this?"))return;let N=window.prompt("Please describe this changeset");if(N)try{let F=await Qu.uploadChangeset({created_by:"Speedwalk",comment:N},JSON.parse(a.toOsmChangeJson()));window.open(`https://www.openstreetmap.org/changeset/${F}`,"_blank"),dn(hr,a=null,a)}catch(F){window.alert(`Upload failed: ${F}`)}}async function B(N){N.key=="z"&&N.ctrlKey&&o.length>0&&await I()}return r.$$set=N=>{"anyEdits"in N&&n(10,f=N.anyEdits)},r.$$.update=()=>{r.$$.dirty&6145&&d>0&&(n(0,o=a?JSON.parse(a.getEdits()):[]),n(1,_=0),n(10,f=o.length>0))},[o,_,S,T,y,k,I,C,L,B,f,a,d]}class DC extends ui{constructor(i){super(),ci(this,i,OC,zC,ti,{anyEdits:10})}}function FC(r){let i,n,a;return{c(){i=ke("button"),i.textContent="Bulk operations",_e(i,"class","btn btn-secondary")},m(u,d){xe(u,i,d),n||(a=Wt(i,"click",r[11]),n=!0)},p:Ht,i:Ht,o:Ht,d(u){u&&we(i),n=!1,a()}}}function RC(r){let i,n;return i=new Sf({props:{$$slots:{body:[UC],header:[BC]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u&65548&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function BC(r){let i;return{c(){i=ke("div"),i.textContent="Bulk operations",_e(i,"slot","header")},m(n,a){xe(n,i,a)},p:Ht,d(n){n&&we(i)}}}function NC(r){let i;return{c(){i=Tt("Drive on the left")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function jC(r){let i;return{c(){i=Tt("Only for major roads")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function UC(r){let i,n,a,u,d,f,o,_,S,T,y,k,I,C,L,B,N,F,W,ee,oe,$,re;function j(Z){r[9](Z)}let U={$$slots:{default:[NC]},$$scope:{ctx:r}};r[2]!==void 0&&(U.checked=r[2]),f=new us({props:U}),wi.push(()=>Xi(f,"checked",j));function J(Z){r[10](Z)}let R={$$slots:{default:[jC]},$$scope:{ctx:r}};return r[3]!==void 0&&(R.checked=r[3]),L=new us({props:R}),wi.push(()=>Xi(L,"checked",J)),{c(){i=ke("div"),n=ke("div"),a=ke("div"),a.textContent="Assume old-style tags on one-ways",u=Qe(),d=ke("div"),yt(f.$$.fragment),_=Qe(),S=ke("button"),S.textContent="Autoset tags on one-ways",T=Qe(),y=ke("div"),k=ke("div"),k.textContent="Make all sidewalks",I=Qe(),C=ke("div"),yt(L.$$.fragment),N=Qe(),F=ke("button"),F.textContent="Make sidewalks",W=Qe(),ee=ke("button"),ee.textContent="Connect all crossings over major roads",_e(a,"class","card-header"),_e(S,"class","btn btn-secondary"),_e(d,"class","card-body"),_e(n,"class","card mb-3"),_e(k,"class","card-header"),_e(F,"class","btn btn-secondary"),_e(C,"class","card-body"),_e(y,"class","card mb-3"),_e(ee,"class","btn btn-secondary"),_e(i,"slot","body")},m(Z,ce){xe(Z,i,ce),be(i,n),be(n,a),be(n,u),be(n,d),gt(f,d,null),be(d,_),be(d,S),be(i,T),be(i,y),be(y,k),be(y,I),be(y,C),gt(L,C,null),be(C,N),be(C,F),be(i,W),be(i,ee),oe=!0,$||(re=[Wt(S,"click",r[8]),Wt(F,"click",r[6]),Wt(ee,"click",r[7])],$=!0)},p(Z,ce){const fe={};ce&65536&&(fe.$$scope={dirty:ce,ctx:Z}),!o&&ce&4&&(o=!0,fe.checked=Z[2],Hi(()=>o=!1)),f.$set(fe);const ge={};ce&65536&&(ge.$$scope={dirty:ce,ctx:Z}),!B&&ce&8&&(B=!0,ge.checked=Z[3],Hi(()=>B=!1)),L.$set(ge)},i(Z){oe||(Re(f.$$.fragment,Z),Re(L.$$.fragment,Z),oe=!0)},o(Z){Ve(f.$$.fragment,Z),Ve(L.$$.fragment,Z),oe=!1},d(Z){Z&&we(i),_t(f),_t(L),$=!1,ir(re)}}}function VC(r){let i,n,a,u,d,f,o,_,S;return{c(){i=ke("h2"),i.textContent="Bulk operations",n=Qe(),a=ke("p"),a.innerHTML=`Speedwalk has some experimental features that can automatically generate
    separate sidewalks on roads tagged with <i>sidewalk = left,right,both</i>
    . This is intended for use in routers and other tools that require separate sidewalks.
    This generation is very error-prone and not meant to ever replace mapping sidewalks
    properly, just as a stop-gap for areas with low coverage. Feel free to test it
    out, but do not ever upload the results to OSM.`,u=Qe(),d=ke("button"),d.textContent="I understand",f=Qe(),o=ke("button"),o.textContent="Cancel",_e(d,"class","btn btn-primary"),_e(o,"class","btn btn-secondary")},m(T,y){xe(T,i,y),xe(T,n,y),xe(T,a,y),xe(T,u,y),xe(T,d,y),xe(T,f,y),xe(T,o,y),_||(S=[Wt(d,"click",r[5]),Wt(o,"click",r[12])],_=!0)},p:Ht,d(T){T&&(we(i),we(n),we(a),we(u),we(d),we(f),we(o)),_=!1,ir(S)}}}function qC(r){let i,n,a,u,d,f,o,_;i=new eu({props:{loading:r[1]}});const S=[RC,FC],T=[];function y(C,L){return C[4]?0:1}a=y(r),u=T[a]=S[a](r);function k(C){r[13](C)}let I={$$slots:{default:[VC]},$$scope:{ctx:r}};return r[0]!==void 0&&(I.show=r[0]),f=new vp({props:I}),wi.push(()=>Xi(f,"show",k)),{c(){yt(i.$$.fragment),n=Qe(),u.c(),d=Qe(),yt(f.$$.fragment)},m(C,L){gt(i,C,L),xe(C,n,L),T[a].m(C,L),xe(C,d,L),gt(f,C,L),_=!0},p(C,[L]){const B={};L&2&&(B.loading=C[1]),i.$set(B);let N=a;a=y(C),a===N?T[a].p(C,L):(ln(),Ve(T[N],1,1,()=>{T[N]=null}),cn(),u=T[a],u?u.p(C,L):(u=T[a]=S[a](C),u.c()),Re(u,1),u.m(d.parentNode,d));const F={};L&65537&&(F.$$scope={dirty:L,ctx:C}),!o&&L&1&&(o=!0,F.show=C[0],Hi(()=>o=!1)),f.$set(F)},i(C){_||(Re(i.$$.fragment,C),Re(u),Re(f.$$.fragment,C),_=!0)},o(C){Ve(i.$$.fragment,C),Ve(u),Ve(f.$$.fragment,C),_=!1},d(C){C&&(we(n),we(d)),_t(i,C),T[a].d(C),_t(f,C)}}}function ZC(r,i,n){let a,u,d;Gt(r,ho,W=>n(14,a=W)),Gt(r,hr,W=>n(15,u=W)),Gt(r,D_,W=>n(4,d=W));let f=!1;function o(){dn(D_,d=!0,d),n(0,f=!1)}let _="",S=!0,T=!0;async function y(){n(1,_="Generating sidewalks"),await Ro();try{u.editMakeAllSidewalks(T),dn(ho,a++,a)}catch(W){window.alert(`Error: ${W}`)}finally{n(1,_="")}}async function k(){n(1,_="Connecting crossings"),await Ro();try{u.editConnectAllCrossings(),dn(ho,a++,a)}catch(W){window.alert(`Error: ${W}`)}finally{n(1,_="")}}async function I(){n(1,_="Inferring sidewalks around one-ways"),await Ro();try{u.editAssumeTags(S),dn(ho,a++,a)}catch(W){window.alert(`Error: ${W}`)}finally{n(1,_="")}}function C(W){S=W,n(2,S)}function L(W){T=W,n(3,T)}const B=()=>n(0,f=!0),N=()=>n(0,f=!1);function F(W){f=W,n(0,f)}return[f,_,S,T,d,o,y,k,I,C,L,B,N,F]}class WC extends ui{constructor(i){super(),ci(this,i,ZC,qC,ti,{})}}function ay(r,i,n){const a=r.slice();return a[11]=i[n][0],a[12]=i[n][1],a[13]=i,a[14]=n,a}function ly(r,i,n){const a=r.slice();return a[11]=i[n][0],a[12]=i[n][1],a[15]=i,a[16]=n,a}function cy(r,i,n){const a=r.slice();a[11]=i[n][0],a[17]=i[n][1];const u=a[1].total_length_meters[a[11]];return a[18]=u,a}function uy(r){let i;return{c(){i=ke("span"),_e(i,"class","svelte-m98wcc"),en(i,"width",`${100*r[18]/r[2]}%`),en(i,"height","100%"),en(i,"background-color",mh[r[11]])},m(n,a){xe(n,i,a)},p(n,a){a&6&&en(i,"width",`${100*n[18]/n[2]}%`)},d(n){n&&we(i)}}}function GC(r){let i,n,a=r[12]+"",u,d,f=uh(r[1].total_length_meters[r[11]])+"",o;return{c(){i=ke("span"),n=Qe(),u=Tt(a),d=Tt(": "),o=Tt(f),_e(i,"class","color-swatch svelte-m98wcc"),en(i,"background",mh[r[11]])},m(_,S){xe(_,i,S),xe(_,n,S),xe(_,u,S),xe(_,d,S),xe(_,o,S)},p(_,S){S&2&&f!==(f=uh(_[1].total_length_meters[_[11]])+"")&&Ai(o,f)},d(_){_&&(we(i),we(n),we(u),we(d),we(o))}}}function hy(r){let i,n,a,u;function d(o){r[8](o,r[11])}let f={$$slots:{default:[GC]},$$scope:{ctx:r}};return r[0][r[11]]!==void 0&&(f.checked=r[0][r[11]]),n=new us({props:f}),wi.push(()=>Xi(n,"checked",d)),{c(){i=ke("div"),yt(n.$$.fragment),en(i,"display","flex"),en(i,"align-items","center"),en(i,"gap","6px")},m(o,_){xe(o,i,_),gt(n,i,null),u=!0},p(o,_){r=o;const S={};_&1026&&(S.$$scope={dirty:_,ctx:r}),!a&&_&9&&(a=!0,S.checked=r[0][r[11]],Hi(()=>a=!1)),n.$set(S)},i(o){u||(Re(n.$$.fragment,o),u=!0)},o(o){Ve(n.$$.fragment,o),u=!1},d(o){o&&we(i),_t(n)}}}function HC(r){let i,n,a=r[12]+"",u,d,f=uh(r[1].total_length_meters[r[11]])+"",o;return{c(){i=ke("span"),n=Qe(),u=Tt(a),d=Tt(": "),o=Tt(f),_e(i,"class","color-swatch svelte-m98wcc"),en(i,"background",mh[r[11]])},m(_,S){xe(_,i,S),xe(_,n,S),xe(_,u,S),xe(_,d,S),xe(_,o,S)},p(_,S){S&2&&f!==(f=uh(_[1].total_length_meters[_[11]])+"")&&Ai(o,f)},d(_){_&&(we(i),we(n),we(u),we(d),we(o))}}}function fy(r){let i,n,a,u,d;function f(_){r[9](_,r[11])}let o={$$slots:{default:[HC]},$$scope:{ctx:r}};return r[0][r[11]]!==void 0&&(o.checked=r[0][r[11]]),n=new us({props:o}),wi.push(()=>Xi(n,"checked",f)),{c(){i=ke("div"),yt(n.$$.fragment),u=Qe(),en(i,"display","flex"),en(i,"align-items","center"),en(i,"gap","6px")},m(_,S){xe(_,i,S),gt(n,i,null),be(i,u),d=!0},p(_,S){r=_;const T={};S&1026&&(T.$$scope={dirty:S,ctx:r}),!a&&S&17&&(a=!0,T.checked=r[0][r[11]],Hi(()=>a=!1)),n.$set(T)},i(_){d||(Re(n.$$.fragment,_),d=!0)},o(_){Ve(n.$$.fragment,_),d=!1},d(_){_&&we(i),_t(n)}}}function XC(r){let i,n,a,u,d,f,o,_,S,T,y,k,I=Vi(r[3]),C=[];for(let re=0;re<I.length;re+=1)C[re]=uy(cy(r,I,re));let L=Vi(r[3]),B=[];for(let re=0;re<L.length;re+=1)B[re]=hy(ly(r,L,re));const N=re=>Ve(B[re],1,1,()=>{B[re]=null}),F=r[7].default,W=vn(F,r,r[10],null);let ee=Vi(r[4]),oe=[];for(let re=0;re<ee.length;re+=1)oe[re]=fy(ay(r,ee,re));const $=re=>Ve(oe[re],1,1,()=>{oe[re]=null});return{c(){i=ke("div"),n=ke("div"),n.textContent="Roads",a=Qe(),u=ke("div"),d=ke("div");for(let re=0;re<C.length;re+=1)C[re].c();f=Qe();for(let re=0;re<B.length;re+=1)B[re].c();o=Qe(),_=ke("div"),S=Qe(),W&&W.c(),T=Qe();for(let re=0;re<oe.length;re+=1)oe[re].c();y=Mn(),_e(n,"class","card-header"),_e(d,"class","row mb-1 svelte-m98wcc"),_e(_,"class","mb-3"),_e(u,"class","card-body"),_e(i,"class","card mb-3")},m(re,j){xe(re,i,j),be(i,n),be(i,a),be(i,u),be(u,d);for(let U=0;U<C.length;U+=1)C[U]&&C[U].m(d,null);be(u,f);for(let U=0;U<B.length;U+=1)B[U]&&B[U].m(u,null);be(u,o),be(u,_),be(u,S),W&&W.m(u,null),xe(re,T,j);for(let U=0;U<oe.length;U+=1)oe[U]&&oe[U].m(re,j);xe(re,y,j),k=!0},p(re,[j]){if(j&14){I=Vi(re[3]);let U;for(U=0;U<I.length;U+=1){const J=cy(re,I,U);C[U]?C[U].p(J,j):(C[U]=uy(J),C[U].c(),C[U].m(d,null))}for(;U<C.length;U+=1)C[U].d(1);C.length=I.length}if(j&11){L=Vi(re[3]);let U;for(U=0;U<L.length;U+=1){const J=ly(re,L,U);B[U]?(B[U].p(J,j),Re(B[U],1)):(B[U]=hy(J),B[U].c(),Re(B[U],1),B[U].m(u,o))}for(ln(),U=L.length;U<B.length;U+=1)N(U);cn()}if(W&&W.p&&(!k||j&1024)&&xn(W,F,re,re[10],k?wn(F,re[10],j,null):Sn(re[10]),null),j&19){ee=Vi(re[4]);let U;for(U=0;U<ee.length;U+=1){const J=ay(re,ee,U);oe[U]?(oe[U].p(J,j),Re(oe[U],1)):(oe[U]=fy(J),oe[U].c(),Re(oe[U],1),oe[U].m(y.parentNode,y))}for(ln(),U=ee.length;U<oe.length;U+=1)$(U);cn()}},i(re){if(!k){for(let j=0;j<L.length;j+=1)Re(B[j]);Re(W,re);for(let j=0;j<ee.length;j+=1)Re(oe[j]);k=!0}},o(re){B=B.filter(Boolean);for(let j=0;j<B.length;j+=1)Ve(B[j]);Ve(W,re),oe=oe.filter(Boolean);for(let j=0;j<oe.length;j+=1)Ve(oe[j]);k=!1},d(re){re&&(we(i),we(T),we(y)),tr(C,re),tr(B,re),W&&W.d(re),tr(oe,re)}}}function KC(r,i,n){let a,u,d;Gt(r,hr,C=>n(5,u=C)),Gt(r,ho,C=>n(6,d=C));let{$$slots:f={},$$scope:o}=i,{showKinds:_}=i,S=[["RoadWithSeparate","With separate sidewalks"],["RoadWithTags","With tagged sidewalks"],["RoadWithoutSidewalksExplicit","Tagged as no sidewalks"],["RoadWithoutSidewalksImplicit","Assumed as no sidewalks"],["RoadUnknown","Totally unknown"]],T=[["Sidewalk","Sidewalks"],["Crossing","Crossings"],["Other","Other"]],y=JSON.parse(u.getMetrics());function k(C,L){r.$$.not_equal(_[L],C)&&(_[L]=C,n(0,_))}function I(C,L){r.$$.not_equal(_[L],C)&&(_[L]=C,n(0,_))}return r.$$set=C=>{"showKinds"in C&&n(0,_=C.showKinds),"$$scope"in C&&n(10,o=C.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&d&&u&&n(1,y=JSON.parse(u.getMetrics())),r.$$.dirty&2&&n(2,a=QT(S.map(([C,L])=>y.total_length_meters[C])))},[_,y,a,S,T,u,d,f,k,I,o]}class JC extends ui{constructor(i){super(),ci(this,i,KC,XC,ti,{showKinds:0})}}function dy(r,i,n){const a=r.slice();return a[14]=i[n][0],a[15]=i[n][1],a}function py(r,i,n){const a=r.slice();return a[18]=i[n][0],a[19]=i[n][1],a}function my(r,i,n){const a=r.slice();return a[18]=i[n][0],a[19]=i[n][1],a}function gy(r,i,n){const a=r.slice();return a[14]=i[n][0],a[15]=i[n][1],a}function _y(r,i,n){const a=r.slice();return a[26]=i[n],a}function yy(r){let i,n,a,u,d,f,o=Vi(r[1].properties.problems),_=[];for(let T=0;T<o.length;T+=1)_[T]=by(_y(r,o,T));let S=r[2].features.length&&vy(r);return d=new FT({props:{labelColors:Object.fromEntries(r[2].features.map(Ey)),itemsPerRow:1}}),{c(){i=ke("u"),i.textContent="Problems:",n=Qe();for(let T=0;T<_.length;T+=1)_[T].c();a=Qe(),S&&S.c(),u=Qe(),yt(d.$$.fragment)},m(T,y){xe(T,i,y),xe(T,n,y);for(let k=0;k<_.length;k+=1)_[k]&&_[k].m(T,y);xe(T,a,y),S&&S.m(T,y),xe(T,u,y),gt(d,T,y),f=!0},p(T,y){if(y&2){o=Vi(T[1].properties.problems);let I;for(I=0;I<o.length;I+=1){const C=_y(T,o,I);_[I]?_[I].p(C,y):(_[I]=by(C),_[I].c(),_[I].m(a.parentNode,a))}for(;I<_.length;I+=1)_[I].d(1);_.length=o.length}T[2].features.length?S?(S.p(T,y),y&4&&Re(S,1)):(S=vy(T),S.c(),Re(S,1),S.m(u.parentNode,u)):S&&(ln(),Ve(S,1,1,()=>{S=null}),cn());const k={};y&4&&(k.labelColors=Object.fromEntries(T[2].features.map(Ey))),d.$set(k)},i(T){f||(Re(S),Re(d.$$.fragment,T),f=!0)},o(T){Ve(S),Ve(d.$$.fragment,T),f=!1},d(T){T&&(we(i),we(n),we(a),we(u)),tr(_,T),S&&S.d(T),_t(d,T)}}}function by(r){let i,n=r[26].note+"",a;return{c(){i=ke("p"),a=Tt(n)},m(u,d){xe(u,i,d),be(i,a)},p(u,d){d&2&&n!==(n=u[26].note+"")&&Ai(a,n)},d(u){u&&we(i)}}}function vy(r){let i,n,a;function u(f){r[9](f)}let d={$$slots:{default:[YC]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.checked=r[0]),i=new us({props:d}),wi.push(()=>Xi(i,"checked",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,o){const _={};o&536870912&&(_.$$scope={dirty:o,ctx:f}),!n&&o&1&&(n=!0,_.checked=f[0],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function YC(r){let i;return{c(){i=Tt("Show problem details")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function QC(r){let i,n,a,u=Vi(r[7].entries()),d=[];for(let f=0;f<u.length;f+=1)d[f]=wy(py(r,u,f));return{c(){i=ke("u"),i.textContent="Set these tags",n=Qe();for(let f=0;f<d.length;f+=1)d[f].c();a=Mn()},m(f,o){xe(f,i,o),xe(f,n,o);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(f,o);xe(f,a,o)},p(f,o){if(o&160){u=Vi(f[7].entries());let _;for(_=0;_<u.length;_+=1){const S=py(f,u,_);d[_]?d[_].p(S,o):(d[_]=wy(S),d[_].c(),d[_].m(a.parentNode,a))}for(;_<d.length;_+=1)d[_].d(1);d.length=u.length}},d(f){f&&(we(i),we(n),we(a)),tr(d,f)}}}function $C(r){let i,n,a,u,d,f,o,_=Vi(Object.entries(r[1].properties.tags)),S=[];for(let k=0;k<_.length;k+=1)S[k]=Sy(gy(r,_,k));let T=Vi(r[6].entries()),y=[];for(let k=0;k<T.length;k+=1)y[k]=Ty(my(r,T,k));return{c(){i=ke("u"),i.textContent="Current sidewalk tags",n=Qe(),a=ke("ul");for(let k=0;k<S.length;k+=1)S[k].c();u=Qe(),d=ke("u"),d.textContent="Override to these tags",f=Qe();for(let k=0;k<y.length;k+=1)y[k].c();o=Mn()},m(k,I){xe(k,i,I),xe(k,n,I),xe(k,a,I);for(let C=0;C<S.length;C+=1)S[C]&&S[C].m(a,null);xe(k,u,I),xe(k,d,I),xe(k,f,I);for(let C=0;C<y.length;C+=1)y[C]&&y[C].m(k,I);xe(k,o,I)},p(k,I){if(I&2){_=Vi(Object.entries(k[1].properties.tags));let C;for(C=0;C<_.length;C+=1){const L=gy(k,_,C);S[C]?S[C].p(L,I):(S[C]=Sy(L),S[C].c(),S[C].m(a,null))}for(;C<S.length;C+=1)S[C].d(1);S.length=_.length}if(I&96){T=Vi(k[6].entries());let C;for(C=0;C<T.length;C+=1){const L=my(k,T,C);y[C]?y[C].p(L,I):(y[C]=Ty(L),y[C].c(),y[C].m(o.parentNode,o))}for(;C<y.length;C+=1)y[C].d(1);y.length=T.length}},d(k){k&&(we(i),we(n),we(a),we(u),we(d),we(f),we(o)),tr(S,k),tr(y,k)}}}function wy(r){let i,n,a,u,d=r[19].map(iE).join(", ")+"",f,o,_,S;function T(){return r[11](r[19])}return{c(){i=ke("div"),n=ke("button"),a=ke("kbd"),a.textContent=`${r[18]+1}`,u=Qe(),f=Tt(d),o=Qe(),_e(n,"class","btn btn-secondary mb-1")},m(y,k){xe(y,i,k),be(i,n),be(n,a),be(n,u),be(n,f),be(i,o),_||(S=Wt(n,"click",T),_=!0)},p(y,k){r=y},d(y){y&&we(i),_=!1,S()}}}function xy(r){let i,n=r[14]+"",a,u,d=r[15]+"",f;return{c(){i=ke("li"),a=Tt(n),u=Tt(" = "),f=Tt(d)},m(o,_){xe(o,i,_),be(i,a),be(i,u),be(i,f)},p(o,_){_&2&&n!==(n=o[14]+"")&&Ai(a,n),_&2&&d!==(d=o[15]+"")&&Ai(f,d)},d(o){o&&we(i)}}}function Sy(r){let i=r[14].startsWith("sidewalk"),n,a=i&&xy(r);return{c(){a&&a.c(),n=Mn()},m(u,d){a&&a.m(u,d),xe(u,n,d)},p(u,d){d&2&&(i=u[14].startsWith("sidewalk")),i?a?a.p(u,d):(a=xy(u),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(u){u&&we(n),a&&a.d(u)}}}function Ty(r){let i,n,a,u,d=r[19].map(tE).join(", ")+"",f,o,_,S;function T(){return r[10](r[19])}return{c(){i=ke("div"),n=ke("button"),a=ke("kbd"),a.textContent=`${r[18]+1}`,u=Qe(),f=Tt(d),o=Qe(),_e(n,"class","btn btn-secondary mb-1")},m(y,k){xe(y,i,k),be(i,n),be(n,a),be(n,u),be(n,f),be(i,o),_||(S=Wt(n,"click",T),_=!0)},p(y,k){r=y},d(y){y&&we(i),_=!1,S()}}}function ky(r){let i,n,a=r[14]+"",u,d,f,o=r[15]+"",_,S;return{c(){i=ke("tr"),n=ke("td"),u=Tt(a),d=Qe(),f=ke("td"),_=Tt(o),S=Qe()},m(T,y){xe(T,i,y),be(i,n),be(n,u),be(i,d),be(i,f),be(f,_),be(i,S)},p(T,y){y&2&&a!==(a=T[14]+"")&&Ai(u,a),y&2&&o!==(o=T[15]+"")&&Ai(_,o)},d(T){T&&we(i)}}}function Cy(r){let i,n,a=r[1].properties.node_ids.join(", ")+"",u;return{c(){i=ke("p"),n=Tt("Nodes: "),u=Tt(a)},m(d,f){xe(d,i,f),be(i,n),be(i,u)},p(d,f){f&2&&a!==(a=d[1].properties.node_ids.join(", ")+"")&&Ai(u,a)},d(d){d&&we(i)}}}function eE(r){let i,n,a,u,d,f,o=r[1].properties.id+"",_,S,T,y,k,I,C,L=Y_[r[1].properties.kind]+"",B,N,F,W,ee,oe,$,re,j,U,J,R,Z,ce;i=new eu({props:{loading:r[3]}});let fe=r[1].properties.problems.length&&yy(r);function ge(Ze,ht){if(ht&2&&(ee=null),ee==null&&(ee=!!Ze[1].properties.kind.startsWith("Road")),ee)return $C;if(Ze[1].properties.kind=="Sidewalk"||Ze[1].properties.kind=="Other")return QC}let ye=ge(r,-1),he=ye&&ye(r),Fe=Vi(Object.entries(r[1].properties.tags)),Me=[];for(let Ze=0;Ze<Fe.length;Ze+=1)Me[Ze]=ky(dy(r,Fe,Ze));let lt=r[4]&&Cy(r);return{c(){yt(i.$$.fragment),n=Qe(),a=ke("div"),u=ke("div"),d=ke("a"),f=Tt("Way "),_=Tt(o),T=Tt(`
    (
    `),y=ke("a"),k=ke("i"),C=Tt(`
    ) : `),B=Tt(L),N=Qe(),F=ke("div"),fe&&fe.c(),W=Qe(),he&&he.c(),oe=Qe(),$=ke("table"),re=ke("thead"),re.innerHTML="<tr><th>Key</th> <th>Value</th></tr>",j=Qe(),U=ke("tbody");for(let Ze=0;Ze<Me.length;Ze+=1)Me[Ze].c();J=Qe(),lt&&lt.c(),_e(d,"href",S="https://www.openstreetmap.org/way/"+r[1].properties.id),_e(d,"target","_blank"),_e(k,"class","fa-solid fa-pencil"),_e(y,"href",I="https://www.openstreetmap.org/edit?way="+r[1].properties.id),_e(y,"target","_blank"),_e(u,"class","card-header"),_e($,"class","table table-bordered"),_e(F,"class","card-body"),_e(a,"class","card mb-5")},m(Ze,ht){gt(i,Ze,ht),xe(Ze,n,ht),xe(Ze,a,ht),be(a,u),be(u,d),be(d,f),be(d,_),be(u,T),be(u,y),be(y,k),be(u,C),be(u,B),be(a,N),be(a,F),fe&&fe.m(F,null),be(F,W),he&&he.m(F,null),be(F,oe),be(F,$),be($,re),be($,j),be($,U);for(let kt=0;kt<Me.length;kt+=1)Me[kt]&&Me[kt].m(U,null);be(F,J),lt&&lt.m(F,null),R=!0,Z||(ce=Wt(window,"keypress",r[8]),Z=!0)},p(Ze,[ht]){const kt={};if(ht&8&&(kt.loading=Ze[3]),i.$set(kt),(!R||ht&2)&&o!==(o=Ze[1].properties.id+"")&&Ai(_,o),(!R||ht&2&&S!==(S="https://www.openstreetmap.org/way/"+Ze[1].properties.id))&&_e(d,"href",S),(!R||ht&2&&I!==(I="https://www.openstreetmap.org/edit?way="+Ze[1].properties.id))&&_e(y,"href",I),(!R||ht&2)&&L!==(L=Y_[Ze[1].properties.kind]+"")&&Ai(B,L),Ze[1].properties.problems.length?fe?(fe.p(Ze,ht),ht&2&&Re(fe,1)):(fe=yy(Ze),fe.c(),Re(fe,1),fe.m(F,W)):fe&&(ln(),Ve(fe,1,1,()=>{fe=null}),cn()),ye===(ye=ge(Ze,ht))&&he?he.p(Ze,ht):(he&&he.d(1),he=ye&&ye(Ze),he&&(he.c(),he.m(F,oe))),ht&2){Fe=Vi(Object.entries(Ze[1].properties.tags));let $e;for($e=0;$e<Fe.length;$e+=1){const vt=dy(Ze,Fe,$e);Me[$e]?Me[$e].p(vt,ht):(Me[$e]=ky(vt),Me[$e].c(),Me[$e].m(U,null))}for(;$e<Me.length;$e+=1)Me[$e].d(1);Me.length=Fe.length}Ze[4]?lt?lt.p(Ze,ht):(lt=Cy(Ze),lt.c(),lt.m(F,null)):lt&&(lt.d(1),lt=null)},i(Ze){R||(Re(i.$$.fragment,Ze),Re(fe),R=!0)},o(Ze){Ve(i.$$.fragment,Ze),Ve(fe),R=!1},d(Ze){Ze&&(we(n),we(a)),_t(i,Ze),fe&&fe.d(),he&&he.d(),tr(Me,Ze),lt&&lt.d(),Z=!1,ce()}}}const Ey=r=>[r.properties.label,r.properties.color],tE=r=>`${r[0]} = ${r[1]}`,iE=r=>`${r[0]} = ${r[1]}`;function nE(r,i,n){let a,u,d;Gt(r,ho,N=>n(12,a=N)),Gt(r,hr,N=>n(13,u=N)),Gt(r,mf,N=>n(4,d=N));let{pinnedWay:f}=i,{drawProblemDetails:o}=i,{showProblemDetails:_}=i,S="";async function T(N){n(3,S="Setting tags"),await Ro();try{u.editSetTags(BigInt(f.properties.id),N),dn(ho,a++,a)}finally{n(3,S="")}}let y=[[["sidewalk:both","separate"]],[["sidewalk:left","separate"],["sidewalk:right","no"]],[["sidewalk:right","separate"],["sidewalk:left","no"]],[["sidewalk","both"]],[["sidewalk","left"]],[["sidewalk","right"]],[["sidewalk","no"]]],k=[[["footway","sidewalk"]],[["footway","crossing"]]];async function I(N){let F=[];f.properties.kind.startsWith("Road")?F=y:(f.properties.kind=="Sidewalk"||f.properties.kind=="Other")&&(F=k);let W=parseInt(N.key);Number.isInteger(W)&&W<=F.length&&await T(F[W-1])}function C(N){_=N,n(0,_)}const L=N=>T(N),B=N=>T(N);return r.$$set=N=>{"pinnedWay"in N&&n(1,f=N.pinnedWay),"drawProblemDetails"in N&&n(2,o=N.drawProblemDetails),"showProblemDetails"in N&&n(0,_=N.showProblemDetails)},[_,f,o,S,d,T,y,k,I,C,L,B]}class rE extends ui{constructor(i){super(),ci(this,i,nE,eE,ti,{pinnedWay:1,drawProblemDetails:2,showProblemDetails:0})}}function Iy(r){var a;const i=((a=r[30])==null?void 0:a.properties)??{};r[31]=i;const n=JSON.parse(r[31].problems);r[32]=n}function Ay(r,i,n){const a=r.slice();return a[33]=i[n],a}function My(r,i,n){const a=r.slice();return a[36]=i[n][0],a[37]=i[n][1],a}function Py(r){let i,n,a;function u(f){r[27](f)}let d={pinnedWay:r[2],drawProblemDetails:r[9]};return r[8]!==void 0&&(d.showProblemDetails=r[8]),i=new rE({props:d}),wi.push(()=>Xi(i,"showProblemDetails",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,o){const _={};o[0]&4&&(_.pinnedWay=f[2]),o[0]&512&&(_.drawProblemDetails=f[9]),!n&&o[0]&256&&(n=!0,_.showProblemDetails=f[8],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function sE(r){let i,n,a,u,d,f,o,_,S,T,y,k,I,C,L,B;u=new AC({props:{anyEdits:r[10]}});function N($){r[25]($)}let F={};r[10]!==void 0&&(F.anyEdits=r[10]),f=new DC({props:F}),wi.push(()=>Xi(f,"anyEdits",N));function W($){r[26]($)}let ee={nodes:r[0],ways:r[1]};r[12]!==void 0&&(ee.drawProblems=r[12]),S=new wC({props:ee}),wi.push(()=>Xi(S,"drawProblems",W));let oe=r[2]&&Py(r);return I=new WC({}),{c(){i=ke("div"),n=ke("button"),n.textContent="Load another area",a=Qe(),yt(u.$$.fragment),d=Qe(),yt(f.$$.fragment),_=Qe(),yt(S.$$.fragment),y=Qe(),oe&&oe.c(),k=Qe(),yt(I.$$.fragment),_e(n,"class","btn btn-secondary"),_e(i,"slot","sidebar")},m($,re){xe($,i,re),be(i,n),be(i,a),gt(u,i,null),be(i,d),gt(f,i,null),be(i,_),gt(S,i,null),be(i,y),oe&&oe.m(i,null),be(i,k),gt(I,i,null),C=!0,L||(B=Wt(n,"click",r[15]),L=!0)},p($,re){const j={};re[0]&1024&&(j.anyEdits=$[10]),u.$set(j);const U={};!o&&re[0]&1024&&(o=!0,U.anyEdits=$[10],Hi(()=>o=!1)),f.$set(U);const J={};re[0]&1&&(J.nodes=$[0]),re[0]&2&&(J.ways=$[1]),!T&&re[0]&4096&&(T=!0,J.drawProblems=$[12],Hi(()=>T=!1)),S.$set(J),$[2]?oe?(oe.p($,re),re[0]&4&&Re(oe,1)):(oe=Py($),oe.c(),Re(oe,1),oe.m(i,k)):oe&&(ln(),Ve(oe,1,1,()=>{oe=null}),cn())},i($){C||(Re(u.$$.fragment,$),Re(f.$$.fragment,$),Re(S.$$.fragment,$),Re(oe),Re(I.$$.fragment,$),C=!0)},o($){Ve(u.$$.fragment,$),Ve(f.$$.fragment,$),Ve(S.$$.fragment,$),Ve(oe),Ve(I.$$.fragment,$),C=!1},d($){$&&we(i),_t(u),_t(f),_t(S),oe&&oe.d(),_t(I),L=!1,B()}}}function Ly(r){let i,n,a=r[36]+"",u,d,f,o=r[37]+"",_,S;return{c(){i=ke("tr"),n=ke("td"),u=Tt(a),d=Qe(),f=ke("td"),_=Tt(o),S=Qe()},m(T,y){xe(T,i,y),be(i,n),be(n,u),be(i,d),be(i,f),be(f,_),be(i,S)},p(T,y){y[0]&1073741824&&a!==(a=T[36]+"")&&Ai(u,a),y[0]&1073741824&&o!==(o=T[37]+"")&&Ai(_,o)},d(T){T&&we(i)}}}function zy(r){let i,n,a,u=Vi(r[32]),d=[];for(let f=0;f<u.length;f+=1)d[f]=Oy(Ay(r,u,f));return{c(){i=ke("u"),i.textContent="Problems:",n=Qe();for(let f=0;f<d.length;f+=1)d[f].c();a=Mn()},m(f,o){xe(f,i,o),xe(f,n,o);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(f,o);xe(f,a,o)},p(f,o){if(o[0]&1073741824){u=Vi(f[32]);let _;for(_=0;_<u.length;_+=1){const S=Ay(f,u,_);d[_]?d[_].p(S,o):(d[_]=Oy(S),d[_].c(),d[_].m(a.parentNode,a))}for(;_<d.length;_+=1)d[_].d(1);d.length=u.length}},d(f){f&&(we(i),we(n),we(a)),tr(d,f)}}}function Oy(r){let i,n=r[33].note+"",a;return{c(){i=ke("p"),a=Tt(n)},m(u,d){xe(u,i,d),be(i,a)},p(u,d){d[0]&1073741824&&n!==(n=u[33].note+"")&&Ai(a,n)},d(u){u&&we(i)}}}function oE(r){Iy(r);let i,n,a=r[31].id+"",u,d,f,o,_=r[31].way_ids+"",S,T,y,k,I,C,L=Vi(Object.entries(JSON.parse(r[31].tags||"{}"))),B=[];for(let F=0;F<L.length;F+=1)B[F]=Ly(My(r,L,F));let N=r[32].length&&zy(r);return{c(){i=ke("h4"),n=Tt("Node "),u=Tt(a),d=Qe(),f=ke("p"),o=Tt("Ways: "),S=Tt(_),T=Qe(),y=ke("table"),k=ke("tbody");for(let F=0;F<B.length;F+=1)B[F].c();I=Qe(),N&&N.c(),C=Mn(),_e(y,"class","table table-bordered")},m(F,W){xe(F,i,W),be(i,n),be(i,u),xe(F,d,W),xe(F,f,W),be(f,o),be(f,S),xe(F,T,W),xe(F,y,W),be(y,k);for(let ee=0;ee<B.length;ee+=1)B[ee]&&B[ee].m(k,null);xe(F,I,W),N&&N.m(F,W),xe(F,C,W)},p(F,W){if(Iy(F),W[0]&1073741824&&a!==(a=F[31].id+"")&&Ai(u,a),W[0]&1073741824&&_!==(_=F[31].way_ids+"")&&Ai(S,_),W[0]&1073741824){L=Vi(Object.entries(JSON.parse(F[31].tags||"{}")));let ee;for(ee=0;ee<L.length;ee+=1){const oe=My(F,L,ee);B[ee]?B[ee].p(oe,W):(B[ee]=Ly(oe),B[ee].c(),B[ee].m(k,null))}for(;ee<B.length;ee+=1)B[ee].d(1);B.length=L.length}F[32].length?N?N.p(F,W):(N=zy(F),N.c(),N.m(C.parentNode,C)):N&&(N.d(1),N=null)},d(F){F&&(we(i),we(d),we(f),we(T),we(y),we(I),we(C)),tr(B,F),N&&N.d(F)}}}function aE(r){let i,n;return i=new ob({props:{openOn:"hover",$$slots:{default:[oE,({data:a})=>({30:a}),({data:a})=>[a?1073741824:0]]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u[0]&1073741824|u[1]&512&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function lE(r){let i,n;return i=new $c({props:{id:"nodes",beforeId:"Road labels",manageHoverState:!0,paint:{"circle-radius":7,"circle-color":["case",["get","is_crossing"],"yellow","grey"],"circle-opacity":["case",["boolean",["get","is_crossing"]],r[4]?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1},layout:{visibility:r[3]?"visible":"none"},$$slots:{default:[aE]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u[0]&16&&(d.paint={"circle-radius":7,"circle-color":["case",["get","is_crossing"],"yellow","grey"],"circle-opacity":["case",["boolean",["get","is_crossing"]],a[4]?["case",["get","modified"],1,.5]:1,0],"circle-stroke-color":["case",["has","tags"],"black","grey"],"circle-stroke-width":1}),u[0]&8&&(d.layout={visibility:a[3]?"visible":"none"}),u[1]&512&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function cE(r){let i;return{c(){i=ke("div"),i.textContent="Layers",_e(i,"slot","header")},m(n,a){xe(n,i,a)},p:Ht,d(n){n&&we(i)}}}function uE(r){let i;return{c(){i=Tt("Debug mode")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function hE(r){let i;return{c(){i=Tt("Nodes")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function fE(r){let i;return{c(){i=Tt("Only modified objects")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function dE(r){let i;return{c(){i=Tt("Only show major roads")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function pE(r){let i;return{c(){i=Tt("Show service roads")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function mE(r){let i,n,a,u,d,f;function o(y){r[22](y)}let _={$$slots:{default:[dE]},$$scope:{ctx:r}};r[5]!==void 0&&(_.checked=r[5]),i=new us({props:_}),wi.push(()=>Xi(i,"checked",o));function S(y){r[23](y)}let T={$$slots:{default:[pE]},$$scope:{ctx:r}};return r[6]!==void 0&&(T.checked=r[6]),u=new us({props:T}),wi.push(()=>Xi(u,"checked",S)),{c(){yt(i.$$.fragment),a=Qe(),yt(u.$$.fragment)},m(y,k){gt(i,y,k),xe(y,a,k),gt(u,y,k),f=!0},p(y,k){const I={};k[1]&512&&(I.$$scope={dirty:k,ctx:y}),!n&&k[0]&32&&(n=!0,I.checked=y[5],Hi(()=>n=!1)),i.$set(I);const C={};k[1]&512&&(C.$$scope={dirty:k,ctx:y}),!d&&k[0]&64&&(d=!0,C.checked=y[6],Hi(()=>d=!1)),u.$set(C)},i(y){f||(Re(i.$$.fragment,y),Re(u.$$.fragment,y),f=!0)},o(y){Ve(i.$$.fragment,y),Ve(u.$$.fragment,y),f=!1},d(y){y&&we(a),_t(i,y),_t(u,y)}}}function gE(r){let i,n,a,u,d,f,o,_,S,T,y,k,I;function C($){r[19]($)}let L={$$slots:{default:[uE]},$$scope:{ctx:r}};r[13]!==void 0&&(L.checked=r[13]),n=new us({props:L}),wi.push(()=>Xi(n,"checked",C));function B($){r[20]($)}let N={$$slots:{default:[hE]},$$scope:{ctx:r}};r[3]!==void 0&&(N.checked=r[3]),d=new us({props:N}),wi.push(()=>Xi(d,"checked",B));function F($){r[21]($)}let W={$$slots:{default:[fE]},$$scope:{ctx:r}};r[4]!==void 0&&(W.checked=r[4]),_=new us({props:W}),wi.push(()=>Xi(_,"checked",F));function ee($){r[24]($)}let oe={$$slots:{default:[mE]},$$scope:{ctx:r}};return r[7]!==void 0&&(oe.showKinds=r[7]),y=new JC({props:oe}),wi.push(()=>Xi(y,"showKinds",ee)),{c(){i=ke("div"),yt(n.$$.fragment),u=Qe(),yt(d.$$.fragment),o=Qe(),yt(_.$$.fragment),T=Qe(),yt(y.$$.fragment),_e(i,"slot","body")},m($,re){xe($,i,re),gt(n,i,null),be(i,u),gt(d,i,null),be(i,o),gt(_,i,null),be(i,T),gt(y,i,null),I=!0},p($,re){const j={};re[1]&512&&(j.$$scope={dirty:re,ctx:$}),!a&&re[0]&8192&&(a=!0,j.checked=$[13],Hi(()=>a=!1)),n.$set(j);const U={};re[1]&512&&(U.$$scope={dirty:re,ctx:$}),!f&&re[0]&8&&(f=!0,U.checked=$[3],Hi(()=>f=!1)),d.$set(U);const J={};re[1]&512&&(J.$$scope={dirty:re,ctx:$}),!S&&re[0]&16&&(S=!0,J.checked=$[4],Hi(()=>S=!1)),_.$set(J);const R={};re[0]&96|re[1]&512&&(R.$$scope={dirty:re,ctx:$}),!k&&re[0]&128&&(k=!0,R.showKinds=$[7],Hi(()=>k=!1)),y.$set(R)},i($){I||(Re(n.$$.fragment,$),Re(d.$$.fragment,$),Re(_.$$.fragment,$),Re(y.$$.fragment,$),I=!0)},o($){Ve(n.$$.fragment,$),Ve(d.$$.fragment,$),Ve(_.$$.fragment,$),Ve(y.$$.fragment,$),I=!1},d($){$&&we(i),_t(n),_t(d),_t(_),_t(y)}}}function _E(r){let i,n;return i=new Sf({props:{$$slots:{body:[gE],header:[cE]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u[0]&8440|u[1]&512&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function yE(r){let i,n,a,u,d,f,o,_,S,T,y;function k(L){r[17](L)}function I(L){r[18](L)}let C={showProblemDetails:r[8],nodes:r[0],ways:r[1],filterWays:r[14](r[5],r[4],r[6],r[7])};return r[2]!==void 0&&(C.pinnedWay=r[2]),r[9]!==void 0&&(C.drawProblemDetails=r[9]),n=new eC({props:C}),wi.push(()=>Xi(n,"pinnedWay",k)),wi.push(()=>Xi(n,"drawProblemDetails",I)),f=new kC({props:{drawProblems:r[12],pinnedWay:r[2]}}),_=new cs({props:{data:r[0],$$slots:{default:[lE]},$$scope:{ctx:r}}}),T=new HS({props:{position:"top-right",$$slots:{default:[_E]},$$scope:{ctx:r}}}),{c(){i=ke("div"),yt(n.$$.fragment),d=Qe(),yt(f.$$.fragment),o=Qe(),yt(_.$$.fragment),S=Qe(),yt(T.$$.fragment),_e(i,"slot","map")},m(L,B){xe(L,i,B),gt(n,i,null),be(i,d),gt(f,i,null),be(i,o),gt(_,i,null),be(i,S),gt(T,i,null),y=!0},p(L,B){const N={};B[0]&256&&(N.showProblemDetails=L[8]),B[0]&1&&(N.nodes=L[0]),B[0]&2&&(N.ways=L[1]),B[0]&240&&(N.filterWays=L[14](L[5],L[4],L[6],L[7])),!a&&B[0]&4&&(a=!0,N.pinnedWay=L[2],Hi(()=>a=!1)),!u&&B[0]&512&&(u=!0,N.drawProblemDetails=L[9],Hi(()=>u=!1)),n.$set(N);const F={};B[0]&4096&&(F.drawProblems=L[12]),B[0]&4&&(F.pinnedWay=L[2]),f.$set(F);const W={};B[0]&1&&(W.data=L[0]),B[0]&24|B[1]&512&&(W.$$scope={dirty:B,ctx:L}),_.$set(W);const ee={};B[0]&8440|B[1]&512&&(ee.$$scope={dirty:B,ctx:L}),T.$set(ee)},i(L){y||(Re(n.$$.fragment,L),Re(f.$$.fragment,L),Re(_.$$.fragment,L),Re(T.$$.fragment,L),y=!0)},o(L){Ve(n.$$.fragment,L),Ve(f.$$.fragment,L),Ve(_.$$.fragment,L),Ve(T.$$.fragment,L),y=!1},d(L){L&&we(i),_t(n),_t(f),_t(_),_t(T)}}}function bE(r){let i,n,a,u;return i=new eu({props:{loading:r[11]}}),a=new vf({props:{$$slots:{map:[yE],sidebar:[sE]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment)},m(d,f){gt(i,d,f),xe(d,n,f),gt(a,d,f),u=!0},p(d,f){const o={};f[0]&2048&&(o.loading=d[11]),i.$set(o);const _={};f[0]&14335|f[1]&512&&(_.$$scope={dirty:f,ctx:d}),a.$set(_)},i(d){u||(Re(i.$$.fragment,d),Re(a.$$.fragment,d),u=!0)},o(d){Ve(i.$$.fragment,d),Ve(a.$$.fragment,d),u=!1},d(d){d&&we(n),_t(i,d),_t(a,d)}}}function vE(r,i,n){let a,u,d;Gt(r,hr,he=>n(28,a=he)),Gt(r,ho,he=>n(16,u=he)),Gt(r,mf,he=>n(13,d=he));let f={type:"FeatureCollection",features:[]},o={type:"FeatureCollection",features:[]},_=null,S=!1,T=!1,y=!1,k=!0,I=Object.fromEntries(Object.keys(mh).map(he=>[he,!0])),C=!0,L=Zs(),B=!1,N="",F=Zs();async function W(he){n(11,N="Recalculating model"),await Ro();try{n(0,f=JSON.parse(a.getNodes())),n(1,o=JSON.parse(a.getWays()))}finally{n(11,N="")}if(_){let Fe=_.id;n(2,_=o.features.find(Me=>Me.id==Fe))}}function ee(he,Fe,Me,lt){let Ze=[];return y&&Ze.push(["any",["in",["get","kind"],["literal",["Sidewalk","Crossing","Other"]]],["get","is_severance"]]),k||Ze.push(["!",["get","is_service"]]),T&&Ze.push(["get","modified"]),Ze.push(["in",["get","kind"],["literal",Object.entries(I).filter(ht=>ht[1]).map(ht=>ht[0])]]),["all",...Ze]}function oe(){B&&!window.confirm("Changing areas will discard your current edits. Do you want to clear the edits?")||dn(hr,a=null,a)}function $(he){_=he,n(2,_)}function re(he){L=he,n(9,L)}function j(he){d=he,mf.set(d)}function U(he){S=he,n(3,S)}function J(he){T=he,n(4,T)}function R(he){y=he,n(5,y)}function Z(he){k=he,n(6,k)}function ce(he){I=he,n(7,I)}function fe(he){B=he,n(10,B)}function ge(he){F=he,n(12,F)}function ye(he){C=he,n(8,C)}return r.$$.update=()=>{r.$$.dirty[0]&65536&&W()},[f,o,_,S,T,y,k,I,C,L,B,N,F,d,ee,oe,u,$,re,j,U,J,R,Z,ce,fe,ge,ye]}class wE extends ui{constructor(i){super(),ci(this,i,vE,bE,ti,{},null,[-1,-1])}}function Dy(r){var n;const i=((n=r[2])==null?void 0:n.properties)??{};r[10]=i}function Fy(r,i,n){const a=r.slice();return a[11]=i[n][0],a[12]=i[n][1],a}function xE(r){let i;return{c(){i=Tt("Ignore service roads")},m(n,a){xe(n,i,a)},d(n){n&&we(i)}}}function Ry(r){let i,n,a=r[5].features.length+"",u,d,f=r[4].features.length+"",o,_;return{c(){i=ke("p"),n=Tt("Junction has "),u=Tt(a),d=Tt(" arms, "),o=Tt(f),_=Tt(" crossings"),_e(i,"class","mt-5")},m(S,T){xe(S,i,T),be(i,n),be(i,u),be(i,d),be(i,o),be(i,_)},p(S,T){T&32&&a!==(a=S[5].features.length+"")&&Ai(u,a),T&16&&f!==(f=S[4].features.length+"")&&Ai(o,f)},d(S){S&&we(i)}}}function SE(r){let i,n,a,u,d=r[6].toLocaleString()+"",f,o,_=r[2].features.length.toLocaleString()+"",S,T,y,k,I,C,L;function B(W){r[9](W)}let N={$$slots:{default:[xE]},$$scope:{ctx:r}};r[0]!==void 0&&(N.checked=r[0]),k=new us({props:N}),wi.push(()=>Xi(k,"checked",B));let F=r[1]&&Ry(r);return{c(){i=ke("div"),n=ke("h4"),n.textContent="Crossings audit (experimental)",a=Qe(),u=ke("p"),f=Tt(d),o=Tt(" / "),S=Tt(_),T=Tt(`
      junctions have all possible crossings mapped`),y=Qe(),yt(k.$$.fragment),C=Qe(),F&&F.c(),_e(i,"slot","sidebar")},m(W,ee){xe(W,i,ee),be(i,n),be(i,a),be(i,u),be(u,f),be(u,o),be(u,S),be(u,T),be(i,y),gt(k,i,null),be(i,C),F&&F.m(i,null),L=!0},p(W,ee){(!L||ee&64)&&d!==(d=W[6].toLocaleString()+"")&&Ai(f,d),(!L||ee&4)&&_!==(_=W[2].features.length.toLocaleString()+"")&&Ai(S,_);const oe={};ee&32768&&(oe.$$scope={dirty:ee,ctx:W}),!I&&ee&1&&(I=!0,oe.checked=W[0],Hi(()=>I=!1)),k.$set(oe),W[1]?F?F.p(W,ee):(F=Ry(W),F.c(),F.m(i,null)):F&&(F.d(1),F=null)},i(W){L||(Re(k.$$.fragment,W),L=!0)},o(W){Ve(k.$$.fragment,W),L=!1},d(W){W&&we(i),_t(k),F&&F.d()}}}function TE(r){let i,n,a;function u(f){r[8](f)}let d={manageHoverState:!0,paint:{"circle-radius":15,"circle-color":["case",["get","complete"],"green","black"],"circle-opacity":df(.5,1),"circle-stroke-color":"black","circle-stroke-width":3}};return r[1]!==void 0&&(d.hovered=r[1]),i=new $c({props:d}),wi.push(()=>Xi(i,"hovered",u)),{c(){yt(i.$$.fragment)},m(f,o){gt(i,f,o),a=!0},p(f,o){const _={};!n&&o&2&&(n=!0,_.hovered=f[1],Hi(()=>n=!1)),i.$set(_)},i(f){a||(Re(i.$$.fragment,f),a=!0)},o(f){Ve(i.$$.fragment,f),a=!1},d(f){_t(i,f)}}}function kE(r){let i,n;return i=new il({props:{paint:{"line-width":6,"line-color":"blue"}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p:Ht,i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function By(r){let i,n,a=r[11]+"",u,d,f,o=r[12]+"",_,S;return{c(){i=ke("tr"),n=ke("td"),u=Tt(a),d=Qe(),f=ke("td"),_=Tt(o),S=Qe()},m(T,y){xe(T,i,y),be(i,n),be(n,u),be(i,d),be(i,f),be(f,_),be(i,S)},p(T,y){y&4&&a!==(a=T[11]+"")&&Ai(u,a),y&4&&o!==(o=T[12]+"")&&Ai(_,o)},d(T){T&&we(i)}}}function CE(r){Dy(r);let i,n,a=r[10].id+"",u,d,f,o,_=Vi(Object.entries(JSON.parse(r[10].tags||"{}"))),S=[];for(let T=0;T<_.length;T+=1)S[T]=By(Fy(r,_,T));return{c(){i=ke("h4"),n=Tt("Node "),u=Tt(a),d=Qe(),f=ke("table"),o=ke("tbody");for(let T=0;T<S.length;T+=1)S[T].c();_e(f,"class","table table-bordered")},m(T,y){xe(T,i,y),be(i,n),be(i,u),xe(T,d,y),xe(T,f,y),be(f,o);for(let k=0;k<S.length;k+=1)S[k]&&S[k].m(o,null)},p(T,y){if(Dy(T),y&4&&a!==(a=T[10].id+"")&&Ai(u,a),y&4){_=Vi(Object.entries(JSON.parse(T[10].tags||"{}")));let k;for(k=0;k<_.length;k+=1){const I=Fy(T,_,k);S[k]?S[k].p(I,y):(S[k]=By(I),S[k].c(),S[k].m(o,null))}for(;k<S.length;k+=1)S[k].d(1);S.length=_.length}},d(T){T&&(we(i),we(d),we(f)),tr(S,T)}}}function EE(r){let i,n;return i=new ob({props:{openOn:"hover",$$slots:{default:[CE,({data:a})=>({2:a}),({data:a})=>a?4:0]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u&32772&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function IE(r){let i,n;return i=new $c({props:{manageHoverState:!0,paint:{"circle-radius":7,"circle-color":"yellow","circle-opacity":df(.3,1),"circle-stroke-color":"black","circle-stroke-width":1},$$slots:{default:[EE]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u&32772&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function AE(r){let i,n;return i=new $c({props:{paint:{"circle-radius":10,"circle-opacity":0,"circle-stroke-color":"red","circle-stroke-width":3}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p:Ht,i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function ME(r){let i,n,a,u,d,f,o,_,S;return n=new cs({props:{data:r[2],generateId:!0,$$slots:{default:[TE]},$$scope:{ctx:r}}}),u=new cs({props:{data:r[5],$$slots:{default:[kE]},$$scope:{ctx:r}}}),f=new cs({props:{data:r[3],generateId:!0,$$slots:{default:[IE]},$$scope:{ctx:r}}}),_=new cs({props:{data:r[4],$$slots:{default:[AE]},$$scope:{ctx:r}}}),{c(){i=ke("div"),yt(n.$$.fragment),a=Qe(),yt(u.$$.fragment),d=Qe(),yt(f.$$.fragment),o=Qe(),yt(_.$$.fragment),_e(i,"slot","map")},m(T,y){xe(T,i,y),gt(n,i,null),be(i,a),gt(u,i,null),be(i,d),gt(f,i,null),be(i,o),gt(_,i,null),S=!0},p(T,y){const k={};y&4&&(k.data=T[2]),y&32770&&(k.$$scope={dirty:y,ctx:T}),n.$set(k);const I={};y&32&&(I.data=T[5]),y&32768&&(I.$$scope={dirty:y,ctx:T}),u.$set(I);const C={};y&8&&(C.data=T[3]),y&32772&&(C.$$scope={dirty:y,ctx:T}),f.$set(C);const L={};y&16&&(L.data=T[4]),y&32768&&(L.$$scope={dirty:y,ctx:T}),_.$set(L)},i(T){S||(Re(n.$$.fragment,T),Re(u.$$.fragment,T),Re(f.$$.fragment,T),Re(_.$$.fragment,T),S=!0)},o(T){Ve(n.$$.fragment,T),Ve(u.$$.fragment,T),Ve(f.$$.fragment,T),Ve(_.$$.fragment,T),S=!1},d(T){T&&we(i),_t(n),_t(u),_t(f),_t(_)}}}function PE(r){let i,n;return i=new vf({props:{$$slots:{map:[ME],sidebar:[SE]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,[u]){const d={};u&32895&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function LE(r,i,n){let a,u,d,f,o;Gt(r,hr,I=>n(7,o=I));let _=!1,S=null,T=JSON.parse(o.getNodes());T.features=T.features.filter(I=>I.properties.is_crossing);function y(I){S=I,n(1,S)}function k(I){_=I,n(0,_)}return r.$$.update=()=>{r.$$.dirty&129&&n(2,a=JSON.parse(o.auditCrossings(_))),r.$$.dirty&4&&n(6,u=a.features.filter(I=>I.properties.complete).length),r.$$.dirty&2&&n(5,d=S?JSON.parse(S.properties.arms):Zs()),r.$$.dirty&2&&n(4,f=S?JSON.parse(S.properties.crossings):Zs())},[_,S,a,T,f,d,u,o,y,k]}class zE extends ui{constructor(i){super(),ci(this,i,LE,PE,ti,{})}}function Ny(r,i,n){const a=r.slice();return a[10]=i[n],a[12]=n,a}function jy(r){let i,n,a,u,d;function f(){return r[7](r[12])}return{c(){i=ke("li"),n=ke("a"),n.textContent=`${uh(r[10])}`,a=Qe(),_e(n,"href","#"),en(n,"color",r[3][r[12]%r[3].length])},m(o,_){xe(o,i,_),be(i,n),be(i,a),u||(d=Wt(n,"click",Yd(f)),u=!0)},p(o,_){r=o},d(o){o&&we(i),u=!1,d()}}}function OE(r){let i,n,a,u,d,f,o=Vi(r[2].component_lengths),_=[];for(let S=0;S<o.length;S+=1)_[S]=jy(Ny(r,o,S));return{c(){i=ke("div"),n=ke("h4"),n.textContent="Network disconnections",a=Qe(),u=ke("p"),u.textContent=`This shows where the separate sidewalk network is disconnected. Click a
      piece to see it:`,d=Qe(),f=ke("ul");for(let S=0;S<_.length;S+=1)_[S].c();_e(i,"slot","sidebar")},m(S,T){xe(S,i,T),be(i,n),be(i,a),be(i,u),be(i,d),be(i,f);for(let y=0;y<_.length;y+=1)_[y]&&_[y].m(f,null)},p(S,T){if(T&15){o=Vi(S[2].component_lengths);let y;for(y=0;y<o.length;y+=1){const k=Ny(S,o,y);_[y]?_[y].p(k,T):(_[y]=jy(k),_[y].c(),_[y].m(f,null))}for(;y<_.length;y+=1)_[y].d(1);_.length=o.length}},d(S){S&&we(i),tr(_,S)}}}function DE(r){let i,n;return i=new il({props:{id:"disconnections",paint:{"line-width":df(5,10),"line-color":r[4](r[0])},manageHoverState:!0,hoverCursor:"pointer"}}),i.$on("click",r[5]),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,u){const d={};u&1&&(d.paint={"line-width":df(5,10),"line-color":a[4](a[0])}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function FE(r){let i,n,a,u,d;return n=new nb({}),n.$on("click",r[6]),u=new cs({props:{data:r[2],generateId:!0,$$slots:{default:[DE]},$$scope:{ctx:r}}}),{c(){i=ke("div"),yt(n.$$.fragment),a=Qe(),yt(u.$$.fragment),_e(i,"slot","map")},m(f,o){xe(f,i,o),gt(n,i,null),be(i,a),gt(u,i,null),d=!0},p(f,o){const _={};o&8193&&(_.$$scope={dirty:o,ctx:f}),u.$set(_)},i(f){d||(Re(n.$$.fragment,f),Re(u.$$.fragment,f),d=!0)},o(f){Ve(n.$$.fragment,f),Ve(u.$$.fragment,f),d=!1},d(f){f&&we(i),_t(n),_t(u)}}}function RE(r){let i,n;return i=new vf({props:{$$slots:{map:[FE],sidebar:[OE]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,[u]){const d={};u&8195&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function BE(r,i,n){let a,u;Gt(r,ol,I=>n(1,a=I)),Gt(r,hr,I=>n(8,u=I));let d=JSON.parse(u.findConnectedComponents()),f=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],o=pf(["to-string",["%",["get","component"],f.length]],Object.fromEntries(f.map((I,C)=>[C.toString(),I])),"black"),_=null;function S(I){return I==null?o:["case",["==",["get","component"],I],o,"black"]}function T(I){n(0,_=I.detail.features[0].properties.component)}function y(I){a.queryRenderedFeatures(I.detail.point,{layers:["disconnections"]}).length==0&&n(0,_=null)}return[_,a,d,f,S,T,y,I=>{a==null||a.fitBounds(d.component_bboxes[I]),n(0,_=I)}]}class NE extends ui{constructor(i){super(),ci(this,i,BE,RE,ti,{})}}function jE(r){let i,n;return i=new YS({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p:Ht,i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function UE(r){let i,n;return i=new cs({props:{data:r[0],$$slots:{default:[jE]},$$scope:{ctx:r}}}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p(a,[u]){const d={};u&8&&(d.$$scope={dirty:u,ctx:a}),i.$set(d)},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function VE(r,i,n){let a;Gt(r,hr,f=>n(1,a=f));let u=JSON.parse(a.getBoundary());return[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],u.geometry.coordinates[0]]}}]}class qE extends ui{constructor(i){super(),ci(this,i,VE,UE,ti,{})}}function ZE(r){let i,n,a;return{c(){i=ke("button"),i.textContent="Login to OSM",_e(i,"class","btn btn-primary")},m(u,d){xe(u,i,d),n||(a=Wt(i,"click",r[1]),n=!0)},p:Ht,d(u){u&&we(i),n=!1,a()}}}function WE(r){let i,n,a,u=r[0].name+"",d,f,o,_,S,T,y,k=r[0].avatarUrl&&Uy(r);return{c(){i=ke("div"),n=ke("button"),k&&k.c(),a=Qe(),d=Tt(u),f=Qe(),o=ke("ul"),_=ke("li"),S=ke("a"),S.textContent="Logout",_e(n,"class","btn btn-outline-secondary dropdown-toggle"),_e(n,"data-bs-toggle","dropdown"),_e(n,"aria-expanded","false"),_e(S,"class","dropdown-item"),_e(S,"href","#"),_e(o,"class","dropdown-menu"),_e(i,"class","nav-item dropdown")},m(I,C){xe(I,i,C),be(i,n),k&&k.m(n,null),be(n,a),be(n,d),be(i,f),be(i,o),be(o,_),be(_,S),T||(y=Wt(S,"click",r[2]),T=!0)},p(I,C){I[0].avatarUrl?k?k.p(I,C):(k=Uy(I),k.c(),k.m(n,a)):k&&(k.d(1),k=null),C&1&&u!==(u=I[0].name+"")&&Ai(d,u)},d(I){I&&we(i),k&&k.d(),T=!1,y()}}}function Uy(r){let i,n;return{c(){i=ke("img"),Wn(i.src,n=r[0].avatarUrl)||_e(i,"src",n),_e(i,"alt","OSM avatar"),_e(i,"height","30")},m(a,u){xe(a,i,u)},p(a,u){u&1&&!Wn(i.src,n=a[0].avatarUrl)&&_e(i,"src",n)},d(a){a&&we(i)}}}function GE(r){let i;function n(d,f){return d[0]?WE:ZE}let a=n(r),u=a(r);return{c(){u.c(),i=Mn()},m(d,f){u.m(d,f),xe(d,i,f)},p(d,[f]){a===(a=n(d))&&u?u.p(d,f):(u.d(1),u=a(d),u&&(u.c(),u.m(i.parentNode,i)))},i:Ht,o:Ht,d(d){d&&we(i),u.d(d)}}}function HE(r,i,n){let a;Gt(r,rh,o=>n(0,a=o)),Qd(u);async function u(){var o;if(Qu.isLoggedIn()){let _=await Qu.getUser("me");dn(rh,a={name:_.display_name,uid:_.id,avatarUrl:((o=_.img)==null?void 0:o.href)||""},a)}}async function d(){try{await Qu.login({mode:"popup",clientId:"vyCV0t-IiskqNBgpiHvuSAmf2nC8K-zfByeFL6XtAzc",redirectUrl:`${window.location.origin}/speedwalk/land.html`,scopes:["read_prefs","write_api"]}),await u()}catch(o){window.alert(`Login failed: ${o}`)}}async function f(){dn(rh,a=void 0,a),await Qu.logout()}return[a,d,f]}class XE extends ui{constructor(i){super(),ci(this,i,HE,GE,ti,{})}}const KE="/speedwalk/assets/logo-3MjkCCFo.svg";function Vy(r,i,n){const a=r.slice();return a[8]=i[n][0],a[9]=i[n][1],a}function qy(r){let i,n=Vi(r[3]),a=[];for(let u=0;u<n.length;u+=1)a[u]=Zy(Vy(r,n,u));return{c(){for(let u=0;u<a.length;u+=1)a[u].c();i=Mn()},m(u,d){for(let f=0;f<a.length;f+=1)a[f]&&a[f].m(u,d);xe(u,i,d)},p(u,d){if(d&12){n=Vi(u[3]);let f;for(f=0;f<n.length;f+=1){const o=Vy(u,n,f);a[f]?a[f].p(o,d):(a[f]=Zy(o),a[f].c(),a[f].m(i.parentNode,i))}for(;f<a.length;f+=1)a[f].d(1);a.length=n.length}},d(u){u&&we(i),tr(a,u)}}}function Zy(r){let i,n,a,u,d;function f(){return r[4](r[8])}return{c(){i=ke("li"),n=ke("a"),n.textContent=`${r[9]}`,a=Qe(),_e(n,"class","nav-link"),_e(n,"href","#"),Dr(n,"active",JSON.stringify(r[2])==JSON.stringify(r[8])),_e(i,"class","nav-item")},m(o,_){xe(o,i,_),be(i,n),be(i,a),u||(d=Wt(n,"click",f),u=!0)},p(o,_){r=o,_&12&&Dr(n,"active",JSON.stringify(r[2])==JSON.stringify(r[8]))},d(o){o&&we(i),u=!1,d()}}}function JE(r){let i,n,a,u,d,f,o,_,S;return{c(){i=ke("h1"),i.textContent="Welcome to Speedwalk",n=Qe(),a=ke("p"),a.innerHTML=`This tool helps you quickly assess how sidewalks are mapped in OSM. You can
    find and fix common tagging problems. The tool assumes you understand the
    correct <a href="https://wiki.openstreetmap.org/wiki/Sidewalks" target="_blank">sidewalk mapping conventions</a>
    . If you are unsure about some edits you make, you can download the changeset
    file and check in JOSM, rather than uploading directly.`,u=Qe(),d=ke("p"),d.innerHTML=`This is an <a href="https://github.com/a-b-street/speedwalk" target="_blank">open source project</a>
    developed without funding by
    <a href="https://abstreet.uk" target="_blank">A/B Street Ltd</a>
    . Please file a Github issue or contact
    <a href="mailto:dustin@abstreet.uk" target="_blank">dustin@abstreet.uk</a>
    with feedback.
    <b>This is an alpha tool; there will be problems!</b>`,f=Qe(),o=ke("button"),o.textContent="Start",_e(o,"class","btn btn-primary")},m(T,y){xe(T,i,y),xe(T,n,y),xe(T,a,y),xe(T,u,y),xe(T,d,y),xe(T,f,y),xe(T,o,y),_||(S=Wt(o,"click",r[6]),_=!0)},p:Ht,d(T){T&&(we(i),we(n),we(a),we(u),we(d),we(f),we(o)),_=!1,S()}}}function YE(r){let i,n,a,u,d,f,o,_,S,T,y,k,I,C,L,B,N,F=r[1]&&qy(r);y=new XE({});function W(oe){r[7](oe)}let ee={$$slots:{default:[JE]},$$scope:{ctx:r}};return r[0]!==void 0&&(ee.show=r[0]),I=new vp({props:ee}),wi.push(()=>Xi(I,"show",W)),{c(){i=ke("ul"),n=ke("img"),u=Qe(),d=ke("h3"),d.textContent="Speedwalk",f=Qe(),F&&F.c(),o=Qe(),_=ke("li"),S=ke("a"),S.innerHTML=`<i class="fa-solid fa-circle-info"></i>
      About`,T=Qe(),yt(y.$$.fragment),k=Qe(),yt(I.$$.fragment),Wn(n.src,a=KE)||_e(n,"src",a),en(n,"height","30px"),_e(n,"alt","A/B Street logo"),_e(S,"class","nav-link"),_e(S,"href","#"),_e(_,"class","nav-item ms-auto"),_e(i,"class","nav nav-underline")},m(oe,$){xe(oe,i,$),be(i,n),be(i,u),be(i,d),be(i,f),F&&F.m(i,null),be(i,o),be(i,_),be(_,S),be(i,T),gt(y,i,null),xe(oe,k,$),gt(I,oe,$),L=!0,B||(N=Wt(S,"click",r[5]),B=!0)},p(oe,[$]){oe[1]?F?F.p(oe,$):(F=qy(oe),F.c(),F.m(i,o)):F&&(F.d(1),F=null);const re={};$&4097&&(re.$$scope={dirty:$,ctx:oe}),!C&&$&1&&(C=!0,re.show=oe[0],Hi(()=>C=!1)),I.$set(re)},i(oe){L||(Re(y.$$.fragment,oe),Re(I.$$.fragment,oe),L=!0)},o(oe){Ve(y.$$.fragment,oe),Ve(I.$$.fragment,oe),L=!1},d(oe){oe&&(we(i),we(k)),F&&F.d(),_t(y),_t(I,oe),B=!1,N()}}}function QE(r,i,n){let a,u;Gt(r,hr,y=>n(1,a=y)),Gt(r,Kd,y=>n(2,u=y));let d=!1,f=[[{kind:"sidewalks"},"Sidewalks"],[{kind:"crossings"},"Crossings"],[{kind:"disconnections"},"Network disconnections"]];const o=y=>dn(Kd,u=y,u),_=()=>n(0,d=!0),S=()=>n(0,d=!1);function T(y){d=y,n(0,d)}return[d,a,u,f,o,_,S,T]}class $E extends ui{constructor(i){super(),ci(this,i,QE,YE,ti,{})}}function eI(r){let i,n,a;return n=new $E({}),{c(){i=ke("div"),yt(n.$$.fragment),_e(i,"slot","top")},m(u,d){xe(u,i,d),gt(n,i,null),a=!0},p:Ht,i(u){a||(Re(n.$$.fragment,u),a=!0)},o(u){Ve(n.$$.fragment,u),a=!1},d(u){u&&we(i),_t(n)}}}function Wy(r){let i;return{c(){i=ke("div")},m(n,a){xe(n,i,a),r[13](i)},p:Ht,d(n){n&&we(i),r[13](null)}}}function tI(r){let i,n=r[0]&&Wy(r);return{c(){i=ke("div"),n&&n.c(),_e(i,"class","p-3"),_e(i,"slot","left")},m(a,u){xe(a,i,u),n&&n.m(i,null)},p(a,u){a[0]?n?n.p(a,u):(n=Wy(a),n.c(),n.m(i,null)):n&&(n.d(1),n=null)},d(a){a&&we(i),n&&n.d()}}}function Gy(r){let i,n,a,u,d,f;const o=[nI,iI],_=[];function S(T,y){return T[5]?0:1}return a=S(r),u=_[a]=o[a](r),{c(){i=ke("div"),n=Qe(),u.c(),d=Mn()},m(T,y){xe(T,i,y),r[10](i),xe(T,n,y),_[a].m(T,y),xe(T,d,y),f=!0},p(T,y){let k=a;a=S(T),a===k?_[a].p(T,y):(ln(),Ve(_[k],1,1,()=>{_[k]=null}),cn(),u=_[a],u?u.p(T,y):(u=_[a]=o[a](T),u.c()),Re(u,1),u.m(d.parentNode,d))},i(T){f||(Re(u),f=!0)},o(T){Ve(u),f=!1},d(T){T&&(we(i),we(n),we(d)),r[10](null),_[a].d(T)}}}function iI(r){let i,n;return i=new nk({}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},p:Ht,i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function nI(r){let i,n,a=r[6],u,d;i=new qE({});let f=Hy(r);return{c(){yt(i.$$.fragment),n=Qe(),f.c(),u=Mn()},m(o,_){gt(i,o,_),xe(o,n,_),f.m(o,_),xe(o,u,_),d=!0},p(o,_){_&64&&ti(a,a=o[6])?(ln(),Ve(f,1,1,Ht),cn(),f=Hy(o),f.c(),Re(f,1),f.m(u.parentNode,u)):f.p(o,_)},i(o){d||(Re(i.$$.fragment,o),Re(f),d=!0)},o(o){Ve(i.$$.fragment,o),Ve(f),d=!1},d(o){o&&(we(n),we(u)),_t(i,o),f.d(o)}}}function rI(r){let i,n;return i=new NE({}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function sI(r){let i,n;return i=new zE({}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function oI(r){let i,n;return i=new wE({}),{c(){yt(i.$$.fragment)},m(a,u){gt(i,a,u),n=!0},i(a){n||(Re(i.$$.fragment,a),n=!0)},o(a){Ve(i.$$.fragment,a),n=!1},d(a){_t(i,a)}}}function Hy(r){let i,n,a,u;const d=[oI,sI,rI],f=[];function o(_,S){return _[6].kind=="sidewalks"?0:_[6].kind=="crossings"?1:_[6].kind=="disconnections"?2:-1}return~(i=o(r))&&(n=f[i]=d[i](r)),{c(){n&&n.c(),a=Mn()},m(_,S){~i&&f[i].m(_,S),xe(_,a,S),u=!0},p(_,S){let T=i;i=o(_),i!==T&&(n&&(ln(),Ve(f[T],1,1,()=>{f[T]=null}),cn()),~i?(n=f[i],n||(n=f[i]=d[i](_),n.c()),Re(n,1),n.m(a.parentNode,a)):n=null)},i(_){u||(Re(n),u=!0)},o(_){Ve(n),u=!1},d(_){_&&we(a),~i&&f[i].d(_)}}}function aI(r){let i,n,a,u,d,f,o,_,S;i=new ET({props:{map:r[0]}}),a=new MS({props:{map:r[0],country:void 0,apiKey:"MZEJTanw3WpxRvt7qDfo"}});function T(I){r[9](I)}let y={};r[3]!==void 0&&(y.basemap=r[3]),d=new Wk({props:y}),wi.push(()=>Xi(d,"basemap",T));let k=r[0]&&Gy(r);return{c(){yt(i.$$.fragment),n=Qe(),yt(a.$$.fragment),u=Qe(),yt(d.$$.fragment),o=Qe(),k&&k.c(),_=Mn()},m(I,C){gt(i,I,C),xe(I,n,C),gt(a,I,C),xe(I,u,C),gt(d,I,C),xe(I,o,C),k&&k.m(I,C),xe(I,_,C),S=!0},p(I,C){const L={};C&1&&(L.map=I[0]),i.$set(L);const B={};C&1&&(B.map=I[0]),a.$set(B);const N={};!f&&C&8&&(f=!0,N.basemap=I[3],Hi(()=>f=!1)),d.$set(N),I[0]?k?(k.p(I,C),C&1&&Re(k,1)):(k=Gy(I),k.c(),Re(k,1),k.m(_.parentNode,_)):k&&(ln(),Ve(k,1,1,()=>{k=null}),cn())},i(I){S||(Re(i.$$.fragment,I),Re(a.$$.fragment,I),Re(d.$$.fragment,I),Re(k),S=!0)},o(I){Ve(i.$$.fragment,I),Ve(a.$$.fragment,I),Ve(d.$$.fragment,I),Ve(k),S=!1},d(I){I&&(we(n),we(u),we(o),we(_)),_t(i,I),_t(a,I),_t(d,I),k&&k.d(I)}}}function lI(r){let i,n,a,u;function d(o){r[11](o)}let f={style:r[4][r[3]],hash:!0,images:[{id:"arrow",url:sk}],$$slots:{default:[aI]},$$scope:{ctx:r}};return r[0]!==void 0&&(f.map=r[0]),n=new yT({props:f}),wi.push(()=>Xi(n,"map",d)),n.$on("error",r[12]),{c(){i=ke("div"),yt(n.$$.fragment),_e(i,"slot","main"),en(i,"position","relative"),en(i,"width","100%"),en(i,"height","100vh")},m(o,_){xe(o,i,_),gt(n,i,null),u=!0},p(o,_){const S={};_&24&&(S.style=o[4][o[3]]),_&16493&&(S.$$scope={dirty:_,ctx:o}),!a&&_&1&&(a=!0,S.map=o[0],Hi(()=>a=!1)),n.$set(S)},i(o){u||(Re(n.$$.fragment,o),u=!0)},o(o){Ve(n.$$.fragment,o),u=!1},d(o){o&&we(i),_t(n)}}}function cI(r){let i,n,a,u;return a=new zx({props:{$$slots:{main:[lI],left:[tI],top:[eI]},$$scope:{ctx:r}}}),{c(){i=ke("link"),n=Qe(),yt(a.$$.fragment),_e(i,"rel","icon"),_e(i,"type","image/x-icon"),_e(i,"href",rk)},m(d,f){be(document.head,i),xe(d,n,f),gt(a,d,f),u=!0},p(d,[f]){const o={};f&16511&&(o.$$scope={dirty:f,ctx:d}),a.$set(o)},i(d){u||(Re(a.$$.fragment,d),u=!0)},o(d){Ve(a.$$.fragment,d),u=!1},d(d){d&&we(n),we(i),_t(a,d)}}}function uI(r,i,n){let a,u,d,f,o;Gt(r,Nd,N=>n(7,a=N)),Gt(r,Bd,N=>n(8,u=N)),Gt(r,el,N=>n(4,d=N)),Gt(r,hr,N=>n(5,f=N)),Gt(r,Kd,N=>n(6,o=N));let _,S="Maptiler OpenStreetMap";Qd(async()=>{await fb()});let T,y;function k(N){S=N,n(3,S)}function I(N){wi[N?"unshift":"push"](()=>{y=N,n(2,y),n(7,a)})}function C(N){_=N,n(0,_)}const L=N=>{console.log(N.detail.error)};function B(N){wi[N?"unshift":"push"](()=>{T=N,n(1,T),n(8,u)})}return r.$$.update=()=>{r.$$.dirty&1&&_&&ol.set(_),r.$$.dirty&258&&T&&u&&(n(1,T.innerHTML="",T),T.appendChild(u)),r.$$.dirty&132&&y&&a&&(n(2,y.innerHTML="",y),y.appendChild(a))},[_,T,y,S,d,f,o,a,u,k,I,C,L,B]}class hI extends ui{constructor(i){super(),ci(this,i,uI,cI,ti,{})}}new hI({target:document.getElementById("app")});
